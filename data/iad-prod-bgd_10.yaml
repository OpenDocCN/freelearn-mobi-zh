- en: Chapter 10. Adding iAds into Your App
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第10章。将iAd添加到您的应用程序中
- en: Now that we've seen how awesome iAds can be for your brand, we'll take a look
    at adding them into your existing application to add an additional revenue stream.
  id: totrans-1
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 现在我们已经看到了iAd对您的品牌是多么的神奇，我们将看看如何将它们添加到您现有的应用程序中，以增加额外的收入来源。
- en: 'In this chapter, you''ll learn how to:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您将学习如何：
- en: Set up an empty placeholder iPhone application, in case you don't currently
    have an app and its source code
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置一个空的iPhone占位符应用程序，以防您目前没有应用程序及其源代码
- en: Add the iAd banner view to an application
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将iAd横幅视图添加到应用程序中
- en: Update the banner to handle device rotations
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更新横幅以处理设备旋转
- en: Hide the banner when no adverts are available
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当没有广告可用时隐藏横幅
- en: If you haven't created an iPhone application before or don't have experience
    with iOS development, don't worry; we'll give you the full code required to add
    this into an app. In fact, you're able to add the basic iAd banner into an app
    without any programming experience at all. With that said, the less adventurous
    may prefer to pass this information onto their app development team.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您之前没有创建过iPhone应用程序或者没有iOS开发经验，不要担心；我们将为您提供添加此功能所需的所有代码。实际上，您甚至可以在没有任何编程经验的情况下将基本的iAd横幅添加到应用程序中。话虽如此，不太冒险的人可能更喜欢将此信息传递给他们的应用程序开发团队。
- en: Setting up the base project
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置基本项目
- en: If you've not already got an application but would still like to try adding
    iAd into an app, we can make a quick single-screen placeholder iPhone project
    that'll be ready to have a banner added to it.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您还没有应用程序但仍然想尝试将iAd添加到应用程序中，我们可以快速创建一个单屏幕的iPhone占位符项目，以便将其添加横幅。
- en: Note
  id: totrans-10
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: We'll be using Xcode; we installed this in [Chapter 4](ch04.html "Chapter 4. Making
    Sure It Works"), *Making Sure it Works*, when we set up the iOS Simulator, so
    you should have it available (if not, then jump back and set it up now).
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用Xcode；我们在[第4章](ch04.html "第4章。确保它工作")中安装了它，即*确保它工作*，当时我们设置了iOS模拟器，所以您应该有它可用（如果没有，那么请返回并现在设置它）。
- en: If you don't want to set up the demo app, you can find the completed placeholder
    project with the book assets in the `iAd Demo App` folder.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您不想设置演示应用程序，您可以在`iAd Demo App`文件夹中找到带有书籍资源的完成占位符项目。
- en: Time for action — a placeholder app
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 行动时间——一个占位符应用程序
- en: 'Using Xcode and its inbuilt interface builder and the drag-and-drop UI designer,
    we''ll make a single screen iPhone application with some mock components to simulate
    an app:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Xcode及其内置的界面构建器和拖放UI设计器，我们将创建一个带有一些模拟组件的单屏幕iPhone应用程序来模拟应用程序：
- en: Open Xcode. If you haven't used it before, you can find it in the `Applications`
    folder, which is in the `Developer` folder on the root directory of your Mac.
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开Xcode。如果您之前没有使用过它，您可以在Mac根目录下的`Developer`文件夹中的`Applications`文件夹中找到它。
- en: Note
  id: totrans-16
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: This differs from the `Applications` folder that iAd Producer is in. If you
    can't find Xcode, then use the search function in finder to locate it.
  id: totrans-17
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这与iAd Producer所在的`Applications`文件夹不同。如果您找不到Xcode，请使用finder中的搜索功能来定位它。
- en: Xcode will open the **Welcome to Xcode** window. From here, select **Create
    a New Xcode Project**. When asked to choose a project type, click on **View Based
    Application** | **Continue**.
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Xcode将打开**欢迎使用Xcode**窗口。从这里，选择**创建一个新的Xcode项目**。当被要求选择项目类型时，点击**基于视图的应用程序**|**继续**。
- en: You'll need to enter a **Product Name** (this is what you want to call your
    application) and a **Company Identifier** (this is usually your website URL reversed).
    For example, use `Demo iAd App` as the name and `com.examplecompany` as the identifier.
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您需要输入**产品名称**（这是您想要给应用程序取的名字）和**公司标识符**（这通常是您的网站URL的反转）。例如，使用`Demo iAd App`作为名称，使用`com.examplecompany`作为标识符。
- en: Ensure that the **Device Family** is **iPhone** and deselect **Include Unit
    Tests**. When your Xcode window looks similar to the following screenshot, click
    on the **Next** button:![Time for action — a placeholder app](img/1321_10_01.jpg)
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确保选择**设备系列**为**iPhone**，并取消选择**包含单元测试**。当您的Xcode窗口看起来类似于以下截图时，点击**下一步**按钮：![行动时间——一个占位符应用程序](img/1321_10_01.jpg)
- en: Choose a location to save your project and the associated files and then click
    on **Create**.
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择一个位置来保存您的项目和关联文件，然后点击**创建**。
- en: Wait while Xcode sets up your project. It will create several files and folders
    within the directory you chose to save the project. Once the Xcode window has
    loaded, locate the file `iAd_Demo_AppViewController.xib` from the Xcode project
    navigator. The project navigator is a pane located to the left of Xcode. If you
    can't see it, select **View** | **Navigation** | **Show Project Navigator** in
    the Xcode menu bar.
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 请等待Xcode设置您的项目。它将在您选择保存项目的目录中创建几个文件和文件夹。一旦Xcode窗口加载完毕，从Xcode项目导航器中定位文件`iAd_Demo_AppViewController.xib`。项目导航器位于Xcode左侧的一个面板。如果您看不到它，请从Xcode菜单栏中选择**视图**
    | **导航** | **显示项目导航器**。
- en: This opens the XIB file—think of this file as a page in your iAd. It'll open
    in the Xcode interface builder. The interface builder is like the canvas in iAd
    Producer; you're able to drop objects from a library to build up your page. To
    add an object to our canvas, known as a view, open the object library by selecting
    **View** | **Activities** | **Object Library**. A pane will expand on the right
    of Xcode and you'll find the object library located at the bottom of it:![Time
    for action — a placeholder app](img/1321_10_02.jpg)
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将打开XIB文件——将这个文件想象成您iAd中的一个页面。它将在Xcode界面构建器中打开。界面构建器就像iAd Producer中的画布；您可以从库中拖放对象来构建页面。要向我们的画布（称为视图）添加对象，请通过选择**视图**
    | **活动** | **对象库**打开对象库。Xcode右侧将展开一个面板，您将在其底部找到对象库：![行动时间 — 一个占位符应用](img/1321_10_02.jpg)
- en: Here we can see a list of available user interface components, which we can
    add to our view. Find a label and drag it onto the view.
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这里，我们可以看到可用用户界面组件的列表，我们可以将其添加到视图中。找到一个标签并将其拖放到视图中。
- en: Note
  id: totrans-25
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: You'll notice that many of these controls are just like iAd Producer. That's
    because Apple has tried to keep parity between many of the objects on iOS to reduce
    the barrier of entry and the learning curve.
  id: totrans-26
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您会注意到许多这些控件与iAd Producer非常相似。这是因为苹果公司试图在iOS上的许多对象之间保持一致性，以降低入门门槛和学习曲线。
- en: Double-click on the label to edit its text. Change the text to something like
    `Apps With iAd Rock!` and then click outside the label to exit the editing mode.
    If you want to change the style of your label, you can use the attributes inspector,
    which behaves similarly to the properties and styles in iAd Producer. You can
    find the attribute inspector above the object library. Add a few more objects,
    such as a button, a switch, a slider, and a text field. Position these on the
    view, but leave space near the bottom. This is where our banner will appear later.
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 双击标签以编辑其文本。将文本更改为类似`Apps With iAd Rock!`的内容，然后单击标签外部以退出编辑模式。如果您想更改标签的样式，可以使用属性检查器，其行为类似于iAd
    Producer中的属性和样式。您可以在对象库上方找到属性检查器。添加一些更多对象，例如按钮、开关、滑块和文本字段。将这些对象放置在视图中，但靠近底部留出空间。这就是我们的横幅稍后会出现的地方。
- en: Your view could look something like this:![Time for action — a placeholder app](img/1321_10_03.jpg)
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您的视图可能看起来像这样：![行动时间 — 一个占位符应用](img/1321_10_03.jpg)
- en: Really, it doesn't matter how you make this page look; it's just so we have
    some context when we add our banner in the next exercise.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 实际上，页面的外观并不重要；这只是为了让我们在下一个练习中添加横幅时有上下文。
- en: Finally, we can run our app in the simulator. Select the **Run** button (with
    a play icon) from the top left of Xcode and the simulator should open. You should
    be able to toggle the switch and move the sliders around. Whenever you run a project,
    Xcode builds the app and automatically saves all the files.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，我们可以在模拟器中运行我们的应用程序。从Xcode左上角选择**运行**按钮（带有播放图标），模拟器应该会打开。您应该能够切换开关并移动滑块。每次运行项目时，Xcode都会构建应用程序并自动保存所有文件。
- en: What just happened?
  id: totrans-31
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 刚才发生了什么？
- en: We created a view-based application from the Xcode templates that gives us a
    single view app with a blank view to which we're able to add objects. We added
    some objects to the view so we have some content available when we run the app.
    With our view layout complete in the interface builder of Xcode, we simulated
    the app to see how it behaved.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从Xcode模板中创建了一个基于视图的应用程序，它给我们提供了一个带有空白视图的单视图应用程序，我们可以向其中添加对象。我们向视图中添加了一些对象，以便在运行应用程序时有一些内容可用。在Xcode的界面构建器中完成视图布局后，我们模拟了应用程序以查看其行为。
- en: Testing the iAd on the device requires you to register it with Apple to provision
    and enable it for development. This requires an active paid developer membership,
    which we signed up to in [Chapter 1](ch01.html "Chapter 1. Getting Started with
    iAd"), *Getting Started with iAd*, to gain access to iAd Producer.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 在设备上测试 iAd 需要您将其注册给 Apple 以进行配置和启用开发。这需要一个有效的付费开发者会员资格，我们在 [第 1 章](ch01.html
    "第 1 章。开始使用 iAd") 的 *开始使用 iAd* 中注册了，以获取访问 iAd Producer 的权限。
- en: Time for action — running on the device
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 行动时间 — 在设备上运行
- en: 'If you haven''t configured your device for development, we can use Xcode''s
    organizer tool to log in to the Apple provisioning portal and set up the required
    certificates and register your device:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您尚未为开发配置设备，我们可以使用 Xcode 的组织者工具登录到 Apple 配置文件门户并设置所需的证书并注册您的设备：
- en: Open Xcode, if it isn't already. Select **Window** | **Organizer** from the
    menu bar. This will open the organizer that allows us to manage our iOS devices,
    their provisioning, and app submissions.
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开 Xcode，如果尚未打开。从菜单栏中选择 **窗口** | **组织者**。这将打开组织者，允许我们管理我们的 iOS 设备、它们的配置文件和应用程序提交。
- en: Now plug an iOS device in, such as an iPhone or iPad. If it's syncing with iTunes,
    wait for it to finish. Make sure that the **device** tab of the organizer is selected
    and find your device in the list to the left.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在插入一个 iOS 设备，例如 iPhone 或 iPad。如果它与 iTunes 同步，请等待其完成。确保组织者的 **设备** 选项卡已选中，并在左侧列表中找到您的设备。
- en: Select the device and click on the **Use for Development** button to allow it
    to be set up for development.
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择设备，然后单击 **用于开发** 按钮以允许其设置为开发配置。
- en: Once the device has been configured locally, select the **+ Add to Portal**
    button to contact the Apple developer portal that will set up your device. Enter
    the **Username** and **Password** for your Apple ID/developer account:![Time for
    action — running on the device](img/1321_10_04.jpg)
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦设备在本地配置完成，选择 **+ 添加到门户** 按钮以联系 Apple 开发者门户，该门户将设置您的设备。输入您的 Apple ID/开发者帐户的
    **用户名** 和 **密码**：![行动时间 — 在设备上运行](img/1321_10_04.jpg)
- en: The organizer will now talk to Apple and enable Xcode on your device to interact.
    Once this has completed, your Mac will be able to send builds to the device.
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 组织者现在将与 Apple 通信并启用 Xcode 在您的设备上交互。一旦完成，您的 Mac 将能够向设备发送构建。
- en: Close the organizer window and change the device **Scheme** to `Your Device
    Name` from the drop-down selector next to the **Run** and **Stop** buttons. Xcode
    will build your app and you should see it running on your device shortly after.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 关闭组织者窗口，并将设备 **方案** 从 **运行** 和 **停止** 按钮旁边的下拉选择器中的 `Your Device Name` 更改为。Xcode
    将构建您的应用程序，您应该会在不久后看到它在设备上运行。
- en: What just happened?
  id: totrans-42
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 发生了什么？
- en: 'Xcode automatically added your device to the provisioning portal, which you
    can view and manage at [http://developer.apple.com](http://developer.apple.com).
    When adding a device to the portal, Xcode carries out the following steps:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: Xcode 自动将您的设备添加到配置文件门户中，您可以在 [http://developer.apple.com](http://developer.apple.com)
    查看和管理。当将设备添加到门户时，Xcode 会执行以下步骤：
- en: Submits the **Unique Device Identifier (UDID)** to the Apple provisioning portal.
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将 **唯一设备标识符 (UDID**) 提交到 Apple 配置文件门户。
- en: Adds the device to your registered devices list, which is linked to your developer
    account. Each account can add up to 100 devices.
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将设备添加到您的注册设备列表中，该列表与您的开发者帐户相关联。每个帐户最多可以添加 100 台设备。
- en: Creates and installs certificates on your behalf, which are used to secure the
    builds so only you can make them.
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 代表您创建并安装证书，这些证书用于保护构建，以确保只有您才能创建它们。
- en: Generates and sets up a development **provisioning profile**—this tells the
    device if it's allowed to run an app or not. A provisioning profile contains a
    list of UDIDs for each device, which is entitled to run the associated app.
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 代表您生成并设置开发 **配置文件**—这告诉设备是否允许运行应用程序。配置文件包含每个设备的 UDID 列表，有权运行相关应用程序。
- en: Note
  id: totrans-48
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: You'll need to repeat this process for each device that you want to test on
    and it's specific to the Mac user account. If you switch machines, you'll need
    to reconfigure Xcode and follow these steps again.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要为每个想要测试的设备重复此过程，并且这特定于 Mac 用户帐户。如果您切换了机器，您需要重新配置 Xcode 并再次执行这些步骤。
- en: With our demo app in place and running on the simulator and device, we can add
    our first iAd banner to it!
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的演示应用程序已安装并运行在模拟器和设备上后，我们可以向其中添加第一个 iAd 横幅！
- en: Adding the banner to your view
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将横幅添加到视图中
- en: We're able to add the iAd banner to a view of your app using the interface builder.
    It's a simple drag-and-drop to get the basic banner functionality.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用界面构建器将iAd横幅添加到您的应用视图中。这是一个简单的拖放操作，以获得基本的横幅功能。
- en: Time for action — adding the banner
  id: totrans-53
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 添加横幅的行动时间
- en: 'We''ll add an iAd banner into the placeholder app that we built in the last
    exercise. If you want to use your own app make sure you''re familiar with the
    interface builder in Xcode. Follow these steps in order to add the banner:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在上一练习中构建的占位符应用中添加iAd横幅。如果您想使用自己的应用，请确保您熟悉Xcode中的界面构建器。按照以下步骤添加横幅：
- en: Open your project, or our demo project in Xcode.
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开您的项目，或Xcode中的我们的演示项目。
- en: From the file list, open the file `iAd_Demo_AppViewController.xib`, if it isn't
    already. This will launch the interface builder. From the object library, drag
    the **Ad BannerView** object to the main view. The object library contains a large
    amount of items that can make it hard to navigate. You can use the search text
    area underneath it to filter results. Searching for a banner reveals any banner-related
    objects. In the following screenshot, you can see a search for **banner:**![Time
    for action — adding the banner](img/1321_10_05.jpg)
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从文件列表中打开文件`iAd_Demo_AppViewController.xib`，如果尚未打开。这将启动界面构建器。从对象库中，将**Ad BannerView**对象拖动到主视图中。对象库包含大量项目，可能会使导航变得困难。您可以使用其下方的搜索文本区域来过滤结果。搜索横幅会显示任何与横幅相关的对象。在以下屏幕截图中，您可以看到对**banner:**的搜索。[![添加横幅的行动时间](img/1321_10_05.jpg)]
- en: Reposition your banner view so it snaps into place at the bottom center of the
    screen.
  id: totrans-57
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重新定位横幅视图，使其在屏幕底部中央对齐。
- en: Apple recommends putting your banner at the top or bottom of your app and making
    sure it is static; putting it in scrollable views or lists limits the on-screen
    time of the banner, which will severely impact the revenue generated by your campaign.
    Try to run your app using the **Run** button or the keyboard shortcut *cmd* +
    *r*. You'll find that the app crashes before it's able to start up. This is due
    to there being a dependency of the banner view that we'll need to include. An
    iAd banner requires the iAd framework to be included with our application.
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 苹果建议将横幅放置在应用的顶部或底部，并确保它是静态的；将其放入可滚动的视图或列表中会限制横幅在屏幕上的显示时间，这将严重影响您活动的收入。尝试使用**运行**按钮或键盘快捷键*cmd*
    + *r*来运行您的应用。您会发现应用在启动前崩溃。这是由于存在我们需要包含的横幅视图的依赖项。iAd横幅需要将iAd框架包含在我们的应用程序中。
- en: To add the iAd framework, click on the name of your project in the project navigator
    pane on the left of Xcode. If you're using the demo project, this will be `iAd
    Demo Project` and can be found at the very top of the project navigator. This
    will open the info of your project in the main Xcode window. Select your project
    name under **TARGETS** and change the tab to **Build Phases**.
  id: totrans-59
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要添加iAd框架，点击Xcode左侧的项目导航器面板中您的项目名称。如果您使用的是演示项目，这将显示为`iAd Demo Project`，可以在项目导航器的最顶部找到。这将打开Xcode主窗口中您项目的信息。在**TARGETS**下选择您的项目名称，然后切换到**构建阶段**。
- en: Expand the **Link Binaries With Libraries** section and click on the **+** button
    at the bottom of the section to open the library/framework picker. Search for
    `iAd` and select **iAd.framework**. Then click on **add**.![Time for action —
    adding the banner](img/1321_10_06.jpg)
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 展开**链接二进制文件与库**部分，然后在该部分的底部点击**+**按钮以打开库/框架选择器。搜索`iAd`并选择**iAd.framework**。然后点击**添加**。![添加横幅的行动时间](img/1321_10_06.jpg)
- en: From the project navigator file list, drag the **iAd.framework** file to the
    `Frameworks` folder. You don't have to do this step, but it helps keep your project
    tidy.
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从项目导航器文件列表中，将**iAd.framework**文件拖动到`Frameworks`文件夹。您不必执行此步骤，但这有助于保持项目整洁。
- en: Run your app. You should see the test banner appear after a few seconds. Try
    tapping it to open the demo advertisement.
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行您的应用。您应该在几秒钟后看到测试横幅出现。尝试点击它以打开演示广告。
- en: Great work! Your project now successfully has an iAd in it!
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 干得好！您的项目现在成功添加了iAd！
- en: What just happened?
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 刚才发生了什么？
- en: We just added the Ad BannerView object to our app's view and positioned it at
    the bottom center of the screen. Using the build phases, a list of steps called
    when building and running the app, we added the iAd framework to be sure it's
    available in our app. We had to add the `iAd.framework` to our app's project or
    else the banner view wouldn't be able to access the correct components and cause
    the app to crash.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 我们刚刚将Ad BannerView对象添加到应用视图中，并将其定位在屏幕底部中央。使用构建阶段，即构建和运行应用时调用的步骤列表，我们添加了iAd框架以确保它在我们的应用中可用。我们必须将`iAd.framework`添加到我们的应用项目中，否则横幅视图将无法访问正确的组件并导致应用崩溃。
- en: 'When an app is in debug or development mode, the iAd Network automatically
    serves a test advertisement. This is to prevent **click fraud**, where artificial
    clicks (or taps) are generated to cheat the system and falsely increase revenue:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 当应用处于调试或开发模式时，iAd网络会自动提供测试广告。这是为了防止**点击欺诈**，即通过生成人工点击（或轻触）来欺骗系统并虚假增加收入：
- en: '![What just happened?](img/1321_10_07.jpg)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![发生了什么？](img/1321_10_07.jpg)'
- en: Before you submit your application to the App Store, we need to enable our ads
    for production. We'll do this in the next chapter, but first let's look at improving
    our banner experience within the app.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在你将应用提交到App Store之前，我们需要启用我们的广告以供生产。我们将在下一章中这样做，但首先让我们看看如何改进应用内的横幅体验。
- en: Handling orientation changes
  id: totrans-69
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 处理方向变化
- en: You may remember that when we built banners in iAd Producer, we checked whether
    they worked in both portrait and landscape; however, currently, our demo app only
    works in portrait. Making sure your app displays banners in any orientation will
    ensure that you get maximum exposure and revenue from the iAd Network.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能记得，当我们使用iAd Producer构建横幅时，我们检查了它们在纵向和横向是否都工作；然而，目前我们的演示应用只支持纵向。确保你的应用可以在任何方向上显示横幅，这将确保你从iAd网络中获得最大的曝光和收入。
- en: Time for action — you spin me right round
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 行动时间——你让我旋转得如此之快
- en: 'If you''re using the demo app, then let''s enable all the possible orientations.
    Make sure our banner adjusts itself accordingly:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你正在使用演示应用，那么让我们启用所有可能的方向。确保我们的横幅能够相应地调整：
- en: Open the demo app in Xcode. If you're using your own app that already supports
    multiple orientations, skip ahead to step 4.
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Xcode中打开演示应用。如果你正在使用已经支持多方向的自己的应用，请跳到步骤4。
- en: 'To enable our app to know it should spin the view when the device is rotated,
    we need to modify a simple bit of Objective C. Open the file `iAd_Demo_AppViewController.m`
    from the project navigator; you''ll see the code appear on screen. Find the method
    `(BOOL)shouldAutorotateToInterfaceOrientation`, which should be near the end of
    the function. This is called by the device when it''s rotated and we''re able
    to tell it when it should and shouldn''t update the view. Find the following line:'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了使我们的应用知道当设备旋转时应该旋转视图，我们需要修改一点Objective C代码。从项目导航器打开文件`iAd_Demo_AppViewController.m`；你会在屏幕上看到代码。找到方法`(BOOL)shouldAutorotateToInterfaceOrientation`，它应该位于函数的末尾附近。当设备旋转并且我们能够告诉它何时应该和不应该更新视图时，会调用这个方法。找到以下行：
- en: '[PRE0]'
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'At the moment, it checks if the rotation orientation is portrait, and returns
    `YES` if it is and `NO` if it isn''t. We''re able to override this check and always
    say `YES`; change the line to read:'
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 目前，它检查旋转方向是否为纵向，如果是，则返回`YES`，如果不是，则返回`NO`。我们能够覆盖这个检查并始终说`YES`；将行更改为读取：
- en: '[PRE1]'
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: This will mean the app will allow the view to rotate to any possible orientation.
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这意味着应用将允许视图旋转到任何可能的方向。
- en: Run the app and try rotating it; you'll see that the view rotates but it gets
    cropped in landscape and the banner view isn't visible. For now, we'll ignore
    the rest of the cropped content but adjust our banner to be in view regardless.
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行应用并尝试旋转它；你会看到视图旋转，但在横向时会被裁剪，横幅视图不可见。现在，我们将忽略其余被裁剪的内容，但调整横幅使其始终可见。
- en: Open your view's XIB file in the interface builder. If you're continuing with
    the demo app, it'll be `iAd_Demo_AppViewController.xib`. Click on the ad banner
    view at the bottom of the view to select it. From the menu bar, select **View**
    | **Utilities** | **Show Size Inspector**.
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在界面构建器中打开你的视图的XIB文件。如果你正在继续使用演示应用，它将是`iAd_Demo_AppViewController.xib`。点击视图底部的广告横幅视图以选择它。从菜单栏中选择**视图**
    | **实用工具** | **显示大小检查器**。
- en: This opens the size inspector that lets us modify the layout information of
    the banner view. The size inspector is a pane on the right of Xcode, above the
    object library.
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将打开大小检查器，允许我们修改横幅视图的布局信息。大小检查器位于Xcode右侧，位于对象库上方。
- en: Find the **Autosizing** box and click on the top red double-t beam shape to
    disable it. Then enable the bottom one with a click. Your auto-sizing settings
    should look like the following screenshot:![Time for action — you spin me right
    round](img/1321_10_08.jpg)
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 找到**Autosizing**框，并单击顶部的红色双倍横梁形状以禁用它。然后单击底部的一个以启用它。你的自动调整大小设置应如下截图所示：![Time
    for action — you spin me right round](img/1321_10_08.jpg)
- en: This means the banner's position will be set from the bottom of the screen instead
    of the top, so it'll always be attached to the bottom of the view no matter the
    height.
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这意味着横幅的位置将从屏幕底部设置，而不是顶部，因此无论高度如何，它始终附着在视图的底部。
- en: Test the ad again. The banner now sits at the bottom of the screen no matter
    what the orientation, but it's not dynamically updating to fill the screen correctly.
    We need to make the banner view accessible to our code so we can inform it when
    a rotation occurs. This works similarly to the outlets in iAd Producer.
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 再次测试广告。无论方向如何，横幅现在都位于屏幕底部，但它并没有动态更新以正确填充屏幕。我们需要使横幅视图可访问，以便我们可以在旋转发生时通知它。这与iAd
    Producer中的出口类似工作。
- en: 'Open the file `iAd_Demo_AppViewController.h` from the project navigator. This
    will open the code editor in Xcode. After `#import <UIKit/UIKit.h>`, add the following
    code:'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从项目导航器中打开文件`iAd_Demo_AppViewController.h`。这将打开Xcode中的代码编辑器。在`#import <UIKit/UIKit.h>`之后，添加以下代码：
- en: '[PRE2]'
  id: totrans-86
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'This tells the file that we''ll be using the iAd framework so it should import
    it. Now in-between `@interface iAd_Demo_AppViewController : UIViewController`
    and `@end`, add the following code:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '这告诉文件我们将使用iAd框架，因此它应该导入它。现在在`@interface iAd_Demo_AppViewController : UIViewController`和`@end`之间，添加以下代码：'
- en: '[PRE3]'
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: This creates a variable called `bannerView`, which will be accessible from our
    code. The `IBOutlet` tells the interface builder that the `bannerView` is available
    as an outlet.
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这创建了一个名为`bannerView`的变量，它将可以从我们的代码中访问。`IBOutlet`告诉界面构建器`bannerView`可以作为出口使用。
- en: 'Change the code editor to the file `iAd_Demo_AppViewController.m` and after
    `@implementation iAd_Demo_AppViewController`, add the following code on a new
    line:'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将代码编辑器切换到文件`iAd_Demo_AppViewController.m`，在`@implementation iAd_Demo_AppViewController`之后，在新行上添加以下代码：
- en: '[PRE4]'
  id: totrans-91
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: This will allow us to access the `bannerView's` properties.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将使我们能够访问`bannerView`的属性。
- en: Note
  id: totrans-93
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: You might find that Xcode tries to help you write the code with auto completion
    and suggestions. In order to confirm that you want it to use a suggestion, press
    the *tab* key.
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 你可能会发现Xcode尝试通过自动完成和建议来帮助你编写代码。为了确认你想要使用建议，请按*tab*键。
- en: With our outlet in place, we can connect to it in the interface builder. Open
    `iAd_Demo_AppViewController.xib` and right-click on the **File's Owner** icon—a
    wireframe cube found to the left of the interface builder. Click-and-drag the
    circle, after the **bannerView** outlet in the overlaid list, and drag to the
    **AdBannerView** on the main view, as shown in the following screenshot:![Time
    for action — you spin me right round](img/1321_10_09.jpg)
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在我们的出口就位后，我们可以在界面构建器中连接到它。打开`iAd_Demo_AppViewController.xib`，在界面构建器左侧的**File's
    Owner**图标（一个立方体线框）上右键单击。点击并拖动圆圈，在覆盖列表中的**bannerView**出口之后，将其拖到主视图上的**AdBannerView**，如图所示：![Time
    for action — you spin me right round](img/1321_10_09.jpg)
- en: 'This links the outlet we made in our code with the banner on the interface
    builder view. Now we can access our banner in the code and can inform the banner
    when a rotation occurs. Before the `@end` line near the bottom of the file, add
    the following block of code:'
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将我们在代码中创建的出口与界面构建器视图上的横幅链接起来。现在我们可以在代码中访问我们的横幅，并可以在旋转发生时通知横幅。在文件底部的`@end`行附近，添加以下代码块：
- en: '[PRE5]'
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: You may find auto complete useful when adding this code. We're taking the `willRotateToInterfaceOrientation`
    method that is called by the device just before the rotation occurs. We then check
    the orientation it's going to rotate to and update the `contentSizeIdentifier`
    property of our banner to that new orientation.
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当添加此代码时，你可能发现自动完成很有用。我们正在使用设备在旋转发生之前调用的`willRotateToInterfaceOrientation`方法。然后我们检查它将要旋转到的方向，并更新我们横幅的`contentSizeIdentifier`属性。
- en: Run the app and test by rotating the device; the banner will now update to fill
    the screen and display a landscape ad.
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行应用并旋转设备进行测试；横幅现在将更新以填充屏幕并显示横幅广告。
- en: What just happened?
  id: totrans-100
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 刚才发生了什么？
- en: 'We improved the experience and potential revenue of our app by tweaking the
    banner view to work. Your banner should dynamically update the banner creative,
    no matter what orientation the device is in:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通过调整横幅视图以使其工作，提高了我们应用的体验和潜在收入。无论设备处于何种方向，你的横幅都应该动态更新横幅创意：
- en: '![What just happened?](img/1321_10_10.jpg)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![发生了什么？](img/1321_10_10.jpg)'
- en: By making the banner view accessible from the code, we're now able to add several
    more enhancements to our app, such as hiding the view when no ads are available
    or providing fallback content.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 通过使横幅视图可以从代码中访问，我们现在能够为我们的应用添加更多增强功能，例如，在没有广告可用时隐藏视图或提供备用内容。
- en: Pop Quiz
  id: totrans-104
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 突击测验
- en: 'Xcode and Objective C can be a little overwhelming at first, but once you grasp
    the basics, you''ll notice the similarities it has with iAd Producer. See what
    you''ve learnt by trying these questions:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: Xcode和Objective-C一开始可能会有些令人不知所措，但一旦你掌握了基础知识，你会注意到它与iAd Producer的相似之处。通过尝试这些问题来检验你学到了什么：
- en: To make an object in the interface builder accessible from the code, would you?
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要在界面构建器中使一个对象可以从代码中访问，你会怎么做？
- en: a. Declare an IBOutlet in your code and then connect the outlet in the interface
    builder
  id: totrans-107
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: a. 在你的代码中声明一个IBOutlet，然后在界面构建器中连接该出口
- en: b. Rename the item in the interface builder and then use that in the code
  id: totrans-108
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: b. 在界面构建器中重命名该项，然后在代码中使用它
- en: c. Just write the code and the interface builder will add the item
  id: totrans-109
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: c. 只需编写代码，界面构建器就会添加该项
- en: d. Access the views items as `[UIView objectAtIndex:0]`, depending on their
    location on the page
  id: totrans-110
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: d. 通过`[UIView objectAtIndex:0]`访问视图项，根据它们在页面上的位置
- en: If an iAd banner is crashing our app, what is the most common cause?
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果iAd横幅导致我们的应用崩溃，最常见的原因是什么？
- en: a. No adverts are available
  id: totrans-112
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: a. 没有广告可用
- en: b. The ad downloaded is too large for the OS to cope
  id: totrans-113
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: b. 下载的广告对于操作系统来说太大，无法处理
- en: c. There's no Internet connection
  id: totrans-114
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: c. 没有互联网连接
- en: d. The project is missing the iAd framework
  id: totrans-115
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: d. 项目缺少iAd框架
- en: Handling no available ads
  id: totrans-116
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 处理无可用广告
- en: Your app will encounter scenarios where the iAd Network is unable to serve an
    ad. This could be due to poor network coverage or iAd not yet being available
    in the country of a user. We should gracefully handle this by making sure that
    we don't display an empty banner and bringing the banner back into view if one
    becomes available.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 你的应用可能会遇到iAd网络无法提供广告的情况。这可能是因为网络覆盖差或iAd尚未在用户所在的国家可用。我们应该优雅地处理这种情况，确保我们不显示空横幅，并在有广告可用时将其重新显示在视图中。
- en: Time for action — ban the banner
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 是时候行动起来——禁止横幅广告
- en: 'With a few small tweaks to our view and code, we can animate our banner on
    and off the screen, depending on the availability of ads:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 通过对我们的视图和代码进行一些小的调整，我们可以根据广告的可用性来动画化横幅的显示和隐藏：
- en: Open the demo project, or your own project containing an Ad Banner View, in
    Xcode. Open the main controller file for your view, for example, `iAd_Demo_AppViewController.m`.
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Xcode中打开示例项目，或打开包含广告横幅视图的自己的项目。打开你的视图的主控制器文件，例如，`iAd_Demo_AppViewController.m`。
- en: 'Lets'' assume that an ad is always going to fail and move the banner out of
    view as soon as the app comes into view. We''ll then wait for the successful message
    from the iAd Network and bring it into view. Add this following code around line
    30:'
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 假设广告总是会失败，并在应用进入视图时立即将横幅移出视图。然后我们将等待iAd网络的成功消息，并将其重新显示在视图中。在约第30行添加以下代码：
- en: '[PRE6]'
  id: totrans-122
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: This takes the frame of the banner and sets the `y` value to be the height of
    the current view, which repositions it off screen. Try running your app; you'll
    see that the banner never appears, even though it's likely the one loaded, because
    the banner never gets back in place when an ad loads successfully.
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将横幅的框架设置为将`y`值设置为当前视图的高度，从而将其移出屏幕。尝试运行你的应用；你会发现横幅从未出现，即使它可能是已加载的，因为当广告成功加载时，横幅永远不会回到原来的位置。
- en: 'We''ll now use the `delegate` methods of the iAd banner to handle the success
    and failure responses of the ad. A delegate is a way of interacting and receiving
    events or messages from an object; in our case, we can implement the banner''s
    delegate in our code so it notifies us of changes. Let''s update the code, so
    the banner knows what it should use for its delegate. In the `viewWillAppear`
    method we modified a few steps back, add the following to the end of the method:'
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们现在将使用 iAd 横幅的 `delegate` 方法来处理广告的成功和失败响应。委托是一种与对象交互并接收事件或消息的方式；在我们的案例中，我们可以在代码中实现横幅的委托，以便它通知我们变化。让我们更新代码，让横幅知道它应该使用什么作为其委托。在上次修改的
    `viewWillAppear` 方法中，将以下内容添加到方法末尾：
- en: '[PRE7]'
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: After adding this, you should see a yellow warning icon appear next to the line
    number. Click on this to reveal the warning:![Time for action — ban the banner](img/1321_10_11.jpg)
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加此方法后，您应该会在行号旁边看到一个黄色警告图标。单击此图标以显示警告：![行动时间 — 禁用横幅](img/1321_10_11.jpg)
- en: 'This warning tells us that although we''ve set the delegate of the banner view
    to be the current file (by saying `self)`, it currently wouldn''t be able to handle
    its role. Switch files to `iAd_Demo_AppViewController.h`, which is known as the
    header file, and find `UIViewController`. Update it to say the following:'
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这个警告告诉我们，尽管我们已经将横幅视图的委托设置为当前文件（通过说 `self`），但它目前无法处理其角色。切换到 `iAd_Demo_AppViewController.h`
    文件，它被称为头文件，并找到 `UIViewController`。将其更新为以下内容：
- en: '[PRE8]'
  id: totrans-128
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'This tells our view controller class that it can respond to requests from an
    Ad Banner View''s delegate. With our delegate in place and our view controller
    able to respond to it, we can now add the successful and failure methods that
    will handle the ad. Before the `@end` of your `iAd_Demo_AppViewController.m` file,
    add the following:'
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这告诉我们的视图控制器类它可以响应来自 Ad Banner View 的委托请求。有了我们的委托和能够响应它的视图控制器，我们现在可以添加处理广告的成功和失败方法。在您的
    `iAd_Demo_AppViewController.m` 文件中的 `@end` 之前，添加以下内容：
- en: '[PRE9]'
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: This isn't required, but it helps separate the sections of our code and highlights
    where the `delegate` methods start from.
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这不是必需的，但它有助于分离我们的代码部分，并突出显示 `delegate` 方法开始的地方。
- en: 'After our `pragma mark` line, we can add the delegate methods. Starting with
    the code to bring the banner back into view once an ad has successfully loaded.
    Add this method immediately after your `pragma mark` line:'
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在我们的 `pragma mark` 行之后，我们可以添加委托方法。从在广告成功加载后使横幅回到视图中的代码开始。在您的 `pragma mark` 行后立即添加此方法：
- en: '[PRE10]'
  id: totrans-133
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Here we've added the method `bannerViewDidLoadAd`, which is a delegate method
    of the banner. When the iAd Network successfully delivers an ad, it calls this
    code. We then take the banner's frame and adjust it to bring it back into view,
    with the added tweak of animating the change so that the banner will move in from
    the bottom of the view. Run the ad and you'll see the banner appear.
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在这里，我们添加了 `bannerViewDidLoadAd` 方法，这是横幅的委托方法。当 iAd 网络成功交付广告时，它会调用此代码。然后我们取横幅的框架并调整它，使其回到视图中，并添加了动画变化，使横幅从视图底部移动进来。运行广告，您将看到横幅出现。
- en: Note
  id: totrans-135
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Sometimes the iAd Network doesn't deliver an advert to simulate a failure. If
    you find a banner hasn't appeared, try closing and re-opening your app to trigger
    another ad.
  id: totrans-136
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 有时 iAd 网络不会交付广告来模拟失败。如果您发现横幅没有出现，请尝试关闭并重新打开您的应用程序以触发另一个广告。
- en: 'With our banner animating in, let''s make sure it can also animate out if there''s
    a problem downloading an ad. Once the banner is visible, it''ll circulate between
    various creatives, so we shouldn''t just assume once we have one ad that we''ll
    continue to receive a stream of them. Similar to the `bannerViewDidLoadAd` delegate
    method, we can use the `didFailToReceiveAdWithError` method when we''re unable
    to get an ad. Use this method with the following code, placing it beneath the
    code we added in the last step:'
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当下载广告出现问题，横幅正在动画显示时，让我们确保它也可以动画退出。一旦横幅可见，它将在各种创意之间循环，因此我们不应该假设一旦我们有一个广告，我们就会继续收到一系列的广告。类似于
    `bannerViewDidLoadAd` 委托方法，当我们无法获取广告时，我们可以使用 `didFailToReceiveAdWithError` 方法。使用以下代码，将其放置在上一步添加的代码下方：
- en: '[PRE11]'
  id: totrans-138
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: You may notice that this code is almost identical to when we receive an ad;
    except, now we're not subtracting the height of the banner from the frame, so
    it is offscreen. In the next exercise, we'll look at optimizing our code by not
    duplicating it.
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可能会注意到，此代码几乎与我们收到广告时的代码相同；只是现在我们不是从框架中减去横幅的高度，因此它处于屏幕外。在下一个练习中，我们将通过不重复代码来优化我们的代码。
- en: If you patiently watch your app, it'll eventually fail to download a banner
    and you should see the current banner slide out of view.
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果你耐心地观察你的应用，它最终会失败下载横幅，你应该看到当前的横幅从视图中滑出。
- en: What just happened?
  id: totrans-141
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 刚才发生了什么？
- en: We added some code to the `viewWillAppear` method, which is called whenever
    the view is about to become visible. This code hides the empty banner off screen
    to make more space available for additional components. Using delegates, we set
    up the view to respond to messages from the iAd Network and animate the banner
    on and off the screen, depending on the availability of ads.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在 `viewWillAppear` 方法中添加了一些代码，这个方法会在视图即将变得可见时被调用。这段代码将空横幅隐藏在屏幕之外，以便为额外的组件腾出更多空间。使用代理，我们设置了视图以响应来自iAd网络的短信，并根据广告的可用性在屏幕上动画横幅的显示和隐藏。
- en: Have a go hero
  id: totrans-143
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 尝试一下英雄
- en: 'Our app is looking great with our banner appearing in our app and correctly
    resizing on rotation, and displaying or hiding itself when ads become available.
    If you''re finding these steps simple, then try these more advanced tasks:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的app看起来很棒，横幅出现在我们的应用中，并在旋转时正确调整大小，当广告可用时显示或隐藏自己。如果你觉得这些步骤很简单，那么尝试这些更高级的任务：
- en: Update the **Autosizing** properties of the items in the placeholder app, so
    they don't get cropped in landscape.
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更新占位符应用中项目的 **自动调整大小** 属性，以便在横幅中不会裁剪。
- en: If you're comfortable with iPhone development, consider grouping all of your
    content into a view separate from the banner. This can then be a sibling of the
    banner view and it's layout can be resized, dependent on a banner's availability.
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你熟悉iPhone开发，考虑将所有内容组合到一个与横幅分开的视图中。这样，它就可以成为横幅视图的兄弟视图，并且它的布局可以根据横幅的可用性进行调整。
- en: If you have your own app, try sharing one banner object between all the pages
    in your app for efficiency.
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你有自己的应用，尝试在应用的所有页面之间共享一个横幅对象以提高效率。
- en: Create an iPad project and add a full screen banner into it. For reference,
    use:[http://developer.apple.com/library/ios/#documentation/UserExperience/Conceptual/iAd_Guide/Full-ScreenAdvertisements/Full-ScreenAdvertisements.html](http://developer.apple.com/library/ios/#documentation/UserExperience/Conceptual/iAd_Guide/Full-ScreenAdvertisements/Full-ScreenAdvertisements.html).
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建一个iPad项目，并在其中添加一个全屏横幅。作为参考，使用：[http://developer.apple.com/library/ios/#documentation/UserExperience/Conceptual/iAd_Guide/Full-ScreenAdvertisements/Full-ScreenAdvertisements.html](http://developer.apple.com/library/ios/#documentation/UserExperience/Conceptual/iAd_Guide/Full-ScreenAdvertisements/Full-ScreenAdvertisements.html)。
- en: Try the next *Time for action* section, where, for the more adventurous, we'll
    tidy up the code!
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 尝试下一个 *行动时间* 部分，在那里，对于更有冒险精神的开发者，我们将整理代码！
- en: Read more about the fundamentals of Objective C at[http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CocoaFundamentals/CommunicatingWithObjects/CommunicateWithObjects.html](http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CocoaFundamentals/CommunicatingWithObjects/CommunicateWithObjects.html).
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在[http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CocoaFundamentals/CommunicatingWithObjects/CommunicateWithObjects.html](http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CocoaFundamentals/CommunicatingWithObjects/CommunicateWithObjects.html)了解更多关于Objective
    C基础的知识。
- en: Time for action — clean the code
  id: totrans-151
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 行动时间 — 清理代码
- en: 'When you begin to duplicate code, you''re increasing the efforts required to
    maintain your app, because you have to go through every instance and change it.
    In our last exercise, we have three similar blocks of code that we can combine
    into one method that intelligently handles the situations. This function will
    handle the hiding and displaying of our ad, depending on the banner''s availability.
    Continuing with our demo app, complete the following steps to clean up the code:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 当你开始复制代码时，你正在增加维护你的应用所需的努力，因为你必须遍历每一个实例并对其进行更改。在我们的上一个练习中，我们有三个相似的代码块，我们可以将它们合并成一个智能处理这些情况的方法。这个函数将根据横幅的可用性来处理我们广告的隐藏和显示。继续使用我们的演示应用，完成以下步骤以清理代码：
- en: 'Before the delegate methods of the banner, and before the `pragma mark`, create
    an empty method by adding this code:'
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在横幅的代理方法和 `pragma mark` 之前创建一个空方法，添加以下代码：
- en: '[PRE12]'
  id: totrans-154
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'We''ll need to add the following to the header file, `iAd_Demo_AppViewController.h`,
    before the `@end` statement in the file add to tell the project that this new
    method is available:'
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们需要在文件 `iAd_Demo_AppViewController.h` 的 `@end` 语句之前添加以下内容，以便在头文件中：
- en: '[PRE13]'
  id: totrans-156
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: This will suppress any warnings from Xcode about unknown methods. Now return
    back to the main file—`iAd_Demo_AppViewController.m.`
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这将抑制Xcode关于未知方法的任何警告。现在返回到主文件——`iAd_Demo_AppViewController.m`。
- en: 'We can now build the function of this method up. It''s going to replace and
    manage the showing and hiding of the banner. Add the following content inside
    the method:'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们现在可以构建这个方法的功能。它将替换并管理横幅的显示和隐藏。在方法内部添加以下内容：
- en: '[PRE14]'
  id: totrans-159
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: This works the same the previous banner code, but in the one method. The `bannerView.bannerLoaded`
    checks if we have a banner loaded and then adjusts the offset accordingly.
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 这与之前的横幅代码工作方式相同，但都在一个方法中。`bannerView.bannerLoaded`检查我们是否已加载横幅，然后相应地调整偏移量。
- en: 'Currently, we''re adjusting the banner in the `viewWillAppear, didFailToReceiveAdWithError`,
    and `bannerViewDidLoadAd` methods. Go through each of these methods, and replace
    the banner frame code with our new method. You can call our method by using the
    following line of code:'
  id: totrans-161
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 目前，我们正在调整`viewWillAppear`、`didFailToReceiveAdWithError`和`bannerViewDidLoadAd`方法中的横幅。逐个查看这些方法，并将横幅框架代码替换为我们新的方法。您可以通过以下代码行调用我们的方法：
- en: '[PRE15]'
  id: totrans-162
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Note
  id: totrans-163
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Make sure you don't remove the `banner.delegate = self`; from the `viewWillAppear`
    method. This will stop your banner from ever appearing!
  id: totrans-164
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 确保您不要从`viewWillAppear`方法中移除`banner.delegate = self`；这将阻止您的横幅永远显示出来！
- en: 'For example your `bannerViewDidLoad` method should now look like the following:'
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 例如，您的`bannerViewDidLoad`方法现在应该看起来像以下这样：
- en: '[PRE16]'
  id: totrans-166
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: As with any change, test your app and make sure the new code works as expected!
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与任何更改一样，测试您的应用并确保新代码按预期工作！
- en: What just happened?
  id: totrans-168
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 刚才发生了什么？
- en: By combining several methods into one method, we reduce the risk for failure
    in our code due to a mistake, and can update our code in one central place without
    having to duplicate any changes. The app is now much tidier. Deleting code is
    really satisfying because it means less work in the future!
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 通过将多个方法合并为一个方法，我们减少了因错误而导致的代码失败风险，并且可以在一个中心位置更新我们的代码，而无需重复任何更改。应用现在变得更加整洁。删除代码真的很令人满意，因为这意味着未来工作量更少！
- en: Summary
  id: totrans-170
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: 'In this chapter, we used iAd to provide a simple, well recognized, and immersive
    banner and ad experience to your app users. To make the banners work elegantly
    in our app and to maximize revenue opportunities we:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们使用了iAd为您的应用用户提供了一个简单、广为人知且沉浸式的横幅和广告体验。为了使横幅在我们的应用中优雅地工作并最大化收入机会，我们：
- en: Created a placeholder app to test the iAd functionality
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建了一个占位符应用来测试iAd功能
- en: Placed our banner in a static location, using the interface builder
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用界面构建器将横幅放置在静态位置
- en: Handled displaying the banner only when it had content
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 仅在横幅有内容时处理横幅的显示
- en: Optimized our code to increase its maintainability
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 优化了代码以提高其可维护性
- en: With great visibility of our ads and handling the occasions where no ads are
    available, we should be able to generate a healthy best-possible revenue stream
    from our app. Before we can start cashing the checks, we need to activate our
    application for live ads and look at how we can track the revenue; all coming
    up in the final chapter!
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 通过提高我们广告的可见性并处理没有广告可用的情况，我们应该能够从我们的应用中生成健康的最优收入流。在我们开始兑现支票之前，我们需要激活我们的应用以投放实时广告，并查看我们如何跟踪收入；所有这些内容将在最后一章中介绍！
