- en: Chapter 1. Getting Started with Apple Pay
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第1章. 开始使用 Apple Pay
- en: Apple Pay is a mobile payment system that lets iPhone users pay for goods and
    services using Touch ID. Instead of entering or confirming payment card information
    (credit or debit card) every time they make a purchase, users can authorize payment
    for items securely by touching the Home button. It is important to note that during
    an Apple Pay transaction, payment card information never leaves the user's phone;
    this information is stored securely in the device. Instead, a payment token stores
    all the information you need to process the payment all the way from authorization
    to settlement (that is, when the user's funds are transferred to your merchant
    bank account).
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: Apple Pay 是一种移动支付系统，允许 iPhone 用户使用 Touch ID 支付商品和服务。在每次购买时，用户无需输入或确认支付卡信息（信用卡或借记卡），只需通过触摸
    Home 键即可安全地授权支付。重要的是要注意，在 Apple Pay 交易过程中，支付卡信息永远不会离开用户的手机；此信息在设备中安全存储。相反，支付令牌存储了您处理支付所需的所有信息，从授权到结算（即，当用户的资金转移到您的商户银行账户时）。
- en: Using Apple Pay, you do not have to store your customers' payment card information
    on your servers. This helps reduce your customers' misgivings about paying for
    goods within your app; they trust that their payment card information is secure
    in their devices. You benefit by not having to deal with payment card information
    at all, at least not for Apple Pay-based transactions. (When a user's device does
    not support Apple Pay, or the user has not yet added payment cards to the device,
    you may have to process payment using regular means, which may involve capturing
    and storing payment card information.)
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Apple Pay，您无需在您的服务器上存储客户的支付卡信息。这有助于减少客户在您的应用程序内支付商品时的疑虑；他们相信他们的支付卡信息在他们的设备中是安全的。您的好处是无需处理支付卡信息，至少对于基于
    Apple Pay 的交易来说是这样。（当用户的设备不支持 Apple Pay 或用户尚未将支付卡添加到设备时，您可能必须使用常规方式处理支付，这可能涉及捕获和存储支付卡信息。）
- en: Although you are freed from storing payment card details on your systems, you
    still have to deal with processing the payments, either directly or through a
    payment gateway. In either case, you need to get an Apple Pay merchant identifier
    and certificate to decrypt the payment token that Apple Pay creates with a transaction's
    payment information. To use Apple Pay in your app, you need to enable the Apple
    Pay capability in your project, which requires the Apple Pay merchant identifier.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然您从存储支付卡详情中解放出来，但您仍然需要处理支付，无论是直接处理还是通过支付网关。在两种情况下，您都需要获取 Apple Pay 商户标识符和证书来解密
    Apple Pay 与交易支付信息一起创建的支付令牌。要在您的应用程序中使用 Apple Pay，您需要在项目中启用 Apple Pay 功能，这需要 Apple
    Pay 商户标识符。
- en: This chapter describes how online payments work, online payments being a web-centric
    version of the traditional **Electronic Draft Capture** (**EDC**) system used
    to process credit card transactions. You will also learn the basics of the Apple
    Pay payment workflow, starting with displaying the **Apple Pay** button when Apple
    Pay is available on the user's device, presenting the Apple Pay payment sheet,
    and processing the transaction on your servers.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章描述了在线支付的工作原理，在线支付是传统**电子汇票捕捉**（**EDC**）系统的网络中心版本，用于处理信用卡交易。您还将学习 Apple Pay
    支付工作流程的基础，从在用户的设备上显示**Apple Pay**按钮开始，当 Apple Pay 可用，展示 Apple Pay 支付表单，并在您的服务器上处理交易。
- en: 'This chapter will do the following:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将完成以下内容：
- en: Provide an overview of the online payment process
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提供在线支付流程概述
- en: Introduce the Apple Pay payment workflow
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 介绍 Apple Pay 支付工作流程
- en: Show you how to create an Apple Pay merchant identifier and certificate
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 展示如何创建 Apple Pay 商户标识符和证书
- en: Describe how to turn on the Apple Pay capability for an app in Xcode
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 描述如何在 Xcode 中为应用程序启用 Apple Pay 功能
- en: An overview of the online payment process
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在线支付流程概述
- en: Customers usually carry payment cards (debit or credit cards) in purses or wallets,
    which they use to pay for goods and services. When a cardholder pays a merchant
    with a payment card, the merchant usually uses a payment gateway to process the
    payment. A payment gateway is an e-commerce service that authorizes payment card-based
    transactions. The *payment gateway* performs several tasks to process the transaction,
    but it's its main task is the encryption of payment card information before submitting
    the transaction for authorization to a payment processor. A *payment processor*
    interacts with the bank that issued the customer's card (known as the *issuing
    bank* or *issuer*) that ultimately authorizes or declines the transaction. The
    payment processor may be implemented by the payment gateway, a third party, or
    the merchant. A merchant would implement a custom payment processor to, for example,
    integrate with a custom inventory and ordering system.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 客户通常携带支付卡（借记卡或信用卡）在钱包或手提包中，他们使用这些卡来支付商品和服务。当持卡人用支付卡向商家付款时，商家通常使用支付网关来处理这笔交易。支付网关是一种电子商务服务，它授权基于支付卡的交易。*支付网关*在处理交易时执行多项任务，但其主要任务是提交交易授权给支付处理器之前对支付卡信息进行加密。*支付处理器*与发行客户卡的银行（称为*发行银行*或*发行者*）进行交互，最终批准或拒绝交易。支付处理器可能由支付网关、第三方或商家实现。商家可能会实现一个定制的支付处理器，例如，与定制的库存和订单系统集成。
- en: Merchants that do not manage inventory may deal only with a payment gateway.
    Payment gateways provide libraries or frameworks that apps can link to. When processing
    a payment, the app hands off a payment token to the library, which processes the
    payment and returns the result (*authorized* or *declined*) to the app. The gateway
    performs all the tasks necessary to authorize the transaction and transfer the
    payment amount from the card issuer to the merchant's acquiring bank. The *acquiring
    bank* (also known as the *acquirer*) is the bank that receives the cardholder's
    payments and credits them to the merchant's bank account (which is a special type
    of account used to receive payment from payment cards, also known as a *merchant
    account*).
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 不管理库存的商家可能只与支付网关打交道。支付网关提供库或框架，应用程序可以链接到这些库。在处理支付时，应用程序将支付令牌传递给库，库处理支付并将结果（*授权*或*拒绝*）返回给应用程序。网关执行所有必要的任务以授权交易并将支付金额从发卡行转移到商家的收单银行。*收单银行*（也称为*收单行*）是接收持卡人付款并将其记入商家银行账户（这是一种用于接收支付卡付款的特殊类型的账户，也称为*商家账户*）的银行。
- en: Merchants that need to integrate with custom ordering and inventory management
    systems need a more hands-on approach to payment processing. This is the scenario
    discussed in this book.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 需要与定制订单和库存管理系统集成的商家需要对支付处理采取更实际的方法。这正是本书讨论的场景。
- en: 'First, let''s talk about how online payment systems work. The payment process
    takes place in two phases:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们谈谈在线支付系统是如何工作的。支付过程分为两个阶段：
- en: Authorization
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 授权
- en: Settlement
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 结算
- en: In a successful authorization, an *authorization hold* is placed on the customer's
    card, reserving the funds that finance the transaction. Later, the merchant consumes
    or settles the transaction to transfer the funds from the customer's card into
    the merchant's account.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在成功的授权中，对客户的卡执行*授权保留*，以保留为交易提供资金的资金。稍后，商家消耗或结算交易，将资金从客户的卡转移到商家的账户。
- en: 'The following steps describe the authorization process:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤描述了授权过程：
- en: The customer presents a payment card to pay for a product or service.
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 客户出示支付卡以支付产品或服务。
- en: The merchant encrypts the card's information and sends an authorization request
    to the payment gateway.
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 商家加密卡信息并向支付网关发送授权请求。
- en: The payment gateway then forwards the authorization request to the payment processor.
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，支付网关将授权请求转发到支付处理器。
- en: The payment processor forwards the authorization request to the appropriate
    payment card association (Visa, MasterCard, American Express, Discover, and so
    on).
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 支付处理器将授权请求转发到适当的支付卡协会（Visa、MasterCard、American Express、Discover等）。
- en: The card association forwards the authorization request to the issuing bank,
    which ultimately approves or declines the transaction. Some card associations,
    such as Discover and American Express, are also issuing banks.
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 卡协会将授权请求转发到发行银行，该银行最终批准或拒绝交易。一些卡协会，如Discover和American Express，也是发行银行。
- en: The issuing bank receives the authorization request from the payment processor
    and sends its response (*authorized* or *declined*) to the payment processor.
    The issuing bank then holds a *transaction authorization* or authorization hold
    that links the merchant, payment card, and amount approved (the funds are reserved
    but not debited from the cardholder's account).
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 发行银行从支付处理器接收授权请求，并将其响应（*授权*或*拒绝*）发送给支付处理器。然后，发行银行保留一个*交易授权*或授权保留，将商家、支付卡和批准的金额（资金被保留但未从持卡人账户中扣除）联系起来。
- en: The payment processor forwards the issuing bank's response to the payment gateway.
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 支付处理器将发行银行的响应转发给支付网关。
- en: The payment gateway, in turn, forwards the response to the merchant, who relays
    the information to the cardholder.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 支付网关随后将响应转发给商家，商家再将信息传达给持卡人。
- en: 'Either immediately, or at the end of the day, the merchant starts the *settlement*
    process to receive the funds. This process is similar to the procedure used to
    request the payment authorization; however, instead of authorizing the transaction,
    the issuing bank moves the authorization hold to a debit and prepares the transaction
    for settlement with the acquiring bank:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 要么立即，要么在一天结束时，商家开始**结算**过程以接收资金。这个过程与请求支付授权的程序类似；然而，不是授权交易，发行银行将授权保留转换为借记，并准备与收单银行结算交易：
- en: The merchant submits the approved authorization to its acquiring bank through
    the payment processor.
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 商家通过支付处理器将其批准的授权提交给其收单银行。
- en: The acquiring bank makes a settlement request to the issuing bank.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 收单银行向发行银行发出结算请求。
- en: The issuing bank makes a settlement payment to the acquiring bank.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 发行银行向收单银行做出结算支付。
- en: The acquiring bank deposits the approved amount into the merchant's bank account.
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 收款行将批准的金额存入商家的银行账户。
- en: The Apple Pay payment workflow
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Apple Pay支付工作流程
- en: If you develop an app that is capable of interacting with a payment gateway
    to process payment cards, you or your company is a *merchant*, and the app is
    a *merchant app*.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您开发的应用能够与支付网关交互以处理支付卡，那么您或您的公司是**商家**，该应用是**商家应用**。
- en: 'This is an overview of the payment workflow:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 这是支付工作流程的概述：
- en: '**Present the** **Apple** **Pay button**: Present this button only if the user
    can make Apple Pay payments.'
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**显示** **Apple** **Pay按钮**：只有当用户可以执行Apple Pay支付时才显示此按钮。'
- en: '**Create the payment request**: This request contains essential payment information
    and details about the order.'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**创建支付请求**：此请求包含必要的支付信息和订单详情。'
- en: '**Present the payment sheet**: This sheet presents order information that the
    user can modify, such as shipping information.'
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**显示支付单据**：此单据显示了用户可以修改的订单信息，例如运费信息。'
- en: '**Respond to changes by the user**: As the user makes changes, update items
    such as shipping costs and discounts.'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**响应用户的变化**：当用户进行更改时，更新诸如运费和折扣等项目。'
- en: '**Submit payment information to payment gateway**: When the user authorizes
    the payment request, submit the payment and order information to the appropriate
    systems.'
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**将支付信息提交给支付网关**：当用户授权支付请求时，将支付和订单信息提交给适当的系统。'
- en: Presenting the Apple Pay button
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 显示Apple Pay按钮
- en: 'When a user reaches a screen in your app that lets the user purchase something,
    the app should present the **Apple** **Pay** button (if the user can use Apple
    Pay on the device) so that the user can tap the button, verify the purchase details,
    and authorize the app through Touch ID to complete the order and charge the order
    amount to the appropriate payment card. Deciding whether the user can use Apple
    Pay involves two steps:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 当用户到达您的应用中允许用户购买东西的屏幕时，如果用户可以在设备上使用Apple Pay，应用应显示**Apple** **Pay**按钮，以便用户可以轻触按钮，验证购买详情，并通过Touch
    ID授权应用以完成订单并将订单金额记入适当的支付卡。决定用户是否可以使用Apple Pay涉及两个步骤：
- en: Determining whether the device supports Apple Pay
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确定设备是否支持Apple Pay
- en: Determining whether the user has added payment cards that you support to the
    device
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确定用户是否已将您支持的支付卡添加到设备中
- en: Tip
  id: totrans-44
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: Your app must make both checks before displaying the **Apple** **Pay** button.
    If either check fails, the app must not present the **Apple** **Pay** button.
    Instead, it should offer a traditional payment method (such as obtaining a credit
    card number and a shipping address) through a Buy button.
  id: totrans-45
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您的应用必须在显示**Apple Pay**按钮之前进行两项检查。如果任一检查失败，应用不得显示**Apple Pay**按钮。相反，它应该通过购买按钮提供一个传统支付方式（例如获取信用卡号和发货地址）。
- en: Creating the payment request
  id: totrans-46
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建支付请求
- en: If the user can use Apple Pay, your app prepares a payment request. A *payment
    request* is an object that describes the items to charge for, the card associations
    that you support, and billing and shipping information.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 如果用户可以使用Apple Pay，您的应用将准备一个支付请求。一个*支付请求*是一个对象，它描述了要收费的项目、您支持的卡关联以及账单和发货信息。
- en: The main components of a payment request are *payment summary items*, which
    describe the payment request to the user. A payment summary item represents a
    component of the transaction, such as the subtotal, a discount, shipping cost,
    tax, and the grand total. Each item has a label that describes what each amount
    means. The last item is the most important because it identifies the payee and
    the debit amount that the user will see in the next payment card statement. Therefore,
    this item should have your company's name as its label.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 支付请求的主要组成部分是*支付摘要项*，它向用户描述支付请求。支付摘要项代表交易的一个组成部分，例如小计、折扣、运费、税费和总金额。每个项目都有一个标签，描述了每个金额的含义。最后一项是最重要的，因为它标识了收款人和用户将在下一张支付卡账单中看到的借记金额。因此，这个项目的标签应该是您公司的名称。
- en: In addition to the payment summary items, your app sets properties of the payment
    request that describe which card associations and online payment protocols you
    support. Your app must support at least the 3D Secure protocol. The **EMV** (**Europay,
    MasterCard, and Visa**) protocol is optional.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 除了支付摘要项之外，您的应用还设置了支付请求的属性，描述了您支持哪些卡关联和在线支付协议。您的应用必须至少支持3D Secure协议。**EMV**（**欧联、万事达卡和维萨卡**）协议是可选的。
- en: The payment request also lets you indicate that you want the user to specify
    particular order details, such as shipping or billing information. For example,
    you may require an e-mail or postal address.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 支付请求还允许您指示用户指定特定的订单详情，例如发货或账单信息。例如，您可能需要电子邮件地址或邮政地址。
- en: If your ordering system requires additional information, such as the order number,
    you can include this information in the payment request as custom application
    data. Apple Pay includes a hash of this information in the payment token you receive
    when the user authorizes the payment. If your ordering system requires this information
    later, your app must be able to provide it separately.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的订单系统需要额外的信息，例如订单号，您可以将这些信息包含在支付请求中作为自定义应用程序数据。当用户授权支付时，Apple Pay会将这些信息的哈希值包含在您收到的支付令牌中。如果您的订单系统稍后需要这些信息，您的应用必须能够单独提供它们。
- en: Presenting the payment sheet
  id: totrans-52
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 展示支付单据
- en: Once your app creates the payment request and the user taps the **Apple Pay**
    button, the app presents a payment sheet to the user. The *payment sheet* (formally
    known as the *payment authorization view controller*) presents the payment summary
    items in the payment request to the user for review. The user can change aspects
    of the order before authorizing payment. The user may also decide not to purchase
    the goods and cancel the transaction.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您的应用创建了支付请求并且用户点击了**Apple Pay**按钮，应用就会向用户展示一个支付单据。*支付单据*（正式名称为*支付授权视图控制器*）向用户展示支付请求中的支付摘要项以供审查。用户在授权支付之前可以更改订单的某些方面。用户也可能决定不购买商品并取消交易。
- en: Responding to order changes and payment authorization
  id: totrans-54
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 响应订单变更和支付授权
- en: Your app implements a delegate of the payment sheet to respond to the user's
    actions by, for example, updating the order shipping cost and grand total when
    the user chooses a different shipping method.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 您的应用实现了一个支付单据的代理，通过例如，当用户选择不同的发货方式时更新订单的运费和总金额来响应用户的操作。
- en: Note
  id: totrans-56
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: When the user authorizes the payment request with Touch ID, Apple Pay interacts
    with the device's secure element (the chip that securely stores payment card details
    on the device, details that not even Apple has access to) and Apple's servers
    to generate a one-time-use payment token. The *payment information* describes
    the payment transaction and contains all the information needed to charge the
    payment amount to the user's payment card (but this does not contain card numbers).
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 当用户使用Touch ID授权支付请求时，Apple Pay会与设备的安全元素（在设备上安全存储支付卡详情的芯片，即使是苹果也无法访问的详情）和苹果的服务器交互，以生成一个一次性使用的支付令牌。*支付信息*描述了支付交易，并包含所有将支付金额记在用户支付卡上所需的信息（但此信息不包含卡号）。
- en: Apple encrypts the information in the token on its servers using your merchant
    certificate.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 苹果使用您的商户证书在其服务器上加密令牌中的信息。
- en: Submitting the payment information to the payment gateway
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 将支付信息提交给支付网关
- en: When the payment sheet tells its delegate that the user has authorized the payment
    request and sends the user the payment information, the delegate calls a synchronous
    method that forwards the payment information to your payment gateway. When the
    method returns, it provides the delegate with the result of the payment request.
    If the payment request is approved, the payment sheet displays a confirmation
    to the user that the transaction is approved and informs its delegate. The delegate
    then dismisses the payment sheet and displays a custom confirmation screen; such
    a screen may display the order number and a *thank you* message. If the payment
    request is not approved, the delegate must display an appropriate screen and ask
    the user for another form of payment.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 当支付单告诉其代表用户已授权支付请求并发送支付信息给用户时，代表调用一个同步方法，该方法将支付信息转发到您的支付网关。当方法返回时，它向代表提供支付请求的结果。如果支付请求被批准，支付单向用户显示确认信息，告知交易已批准，并通知其代表。然后代表关闭支付单并显示一个自定义确认屏幕；这样的屏幕可能显示订单号和一条*感谢*信息。如果支付请求未被批准，代表必须显示适当的屏幕并要求用户提供另一种支付方式。
- en: Enabling Apple Pay in your app
  id: totrans-61
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在您的应用中启用Apple Pay
- en: For your app to be able to use Apple Pay, you must have an Apple merchant identifier
    and merchant certificate. Apple uses the certificate to encrypt payment information
    in the payment token. Your payment gateway (Stripe, Worldpay, and so on) uses
    the certificate to decrypt information in the payment token.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 为了您的应用能够使用Apple Pay，您必须有一个Apple商户标识符和商户证书。苹果使用证书来加密支付令牌中的支付信息。您的支付网关（Stripe、Worldpay等）使用证书来解密支付令牌中的信息。
- en: Creating your app's Apple Pay merchant identifier
  id: totrans-63
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建您的应用Apple Pay商户标识符
- en: You must have access to your team's **Member Center** portal and your payment
    gateway's certificate management facilities.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 您必须能够访问您的团队**成员中心**门户和您的支付网关的证书管理设施。
- en: 'Create your merchant identifier in your team''s **Member Center** page through
    the following steps:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 在您的团队**成员中心**页面通过以下步骤创建您的商户标识符：
- en: In **Member Center**, click on **Certificates, Identifiers & Profiles**.
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**成员中心**，点击**证书、标识符和配置文件**。
- en: Under **iOS Apps**, click on **Identifiers**.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**iOS应用**下，点击**标识符**。
- en: Under **Identifiers**, click on **Merchant IDs**.
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**标识符**下，点击**商户ID**。
- en: Click on **Continue** (if this is your first merchant identifier) or on the
    plus sign (**+**) button in the upper-right corner of the page.
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**继续**（如果这是您的第一个商户标识符）或在页面右上角的加号（**+**）按钮。
- en: Enter a description for the merchant identifier in the **Description** field,
    for example `MerchantApp merchant identifier`.
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**描述**字段中为商户标识符输入描述，例如`MerchantApp merchant identifier`。
- en: Enter the identifier string in the ID field, for example `merchant.com.company.merchantapp`.
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在ID字段中输入标识符字符串，例如`merchant.com.company.merchantapp`。
- en: Click on **Continue** and then click on **Register**.
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**继续**然后点击**注册**。
- en: Click on **Done**.
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**完成**。
- en: 'Request an Apple Pay certificate from your payment gateway by performing the
    following:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 通过执行以下操作从您的支付网关请求Apple Pay证书：
- en: In your payment gateway's certificate management page, create an Apple Pay certificate.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的支付网关的证书管理页面中创建一个Apple Pay证书。
- en: Download the **Certificate Signing Request** (**CSR**) file to your Mac.
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将**证书签名请求**（**CSR**）文件下载到您的Mac上。
- en: 'Now, follow these steps to create your app merchant certificate in Member Center:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，按照以下步骤在成员中心创建您的应用商户证书：
- en: In the **Certificates, Identifiers & Profiles** page, under **iOS Apps**, under
    **Certificates**, click on **All**.
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**证书、标识符和配置文件**页面，在**iOS应用**下，在**证书**下，点击**所有**。
- en: Then, select **Apple Pay Certificate** and click on **Continue**.
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，选择**Apple Pay证书**并点击**继续**。
- en: Under **Which Merchant ID would you like to use?**, select the appropriate merchant
    identifier and click on **Continue**.
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**您想使用哪个商家ID？**下，选择适当的商家标识符并点击**继续**。
- en: Under **Generate your certificate**, click on **Choose File**.
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**生成您的证书**下，点击**选择文件**。
- en: Choose the CSR file you obtained from your payment gateway.
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择您从支付网关获得的CSR文件。
- en: Next, click on **Generate** and then click on **Download** to download your
    app merchant certificate to your Mac.
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，点击**生成**，然后点击**下载**以将您的应用商家证书下载到您的Mac。
- en: 'Upload your app merchant certificate to your payment gateway via the following
    steps:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 通过以下步骤将您的应用商家证书上传到您的支付网关：
- en: In your payment gateway's certificate management page, upload the merchant certificate
    you downloaded from the **Member Center** portal.
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的支付网关的证书管理页面上，上传您从**会员中心**门户下载的商家证书。
- en: Confirm that your merchant certificate is listed in your payment gateway account.
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 确认您的商家证书已列在您的支付网关账户中。
- en: Installing your app's Apple Pay merchant certificate on your Mac
  id: totrans-87
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在您的Mac上安装应用的Apple Pay商家证书
- en: Double-click on the merchant certificate you downloaded earlier from **Member
    Center**. **Keychain Access** will then open and install the certificate along
    with your other certificates.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 双击您之前从**会员中心**下载的商家证书。此时，**密钥链访问**将打开并安装证书，包括您的其他证书。
- en: Enabling Apple Pay in your app's Xcode project
  id: totrans-89
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在您的应用Xcode项目中启用Apple Pay
- en: 'To provide your app with access to Apple Pay, you need to turn on the Apple
    Pay capability in the Xcode project. Perform the following:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 要为您的应用提供访问Apple Pay的权限，您需要在Xcode项目中启用Apple Pay功能。执行以下操作：
- en: First, open your project in Xcode.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，在Xcode中打开您的项目。
- en: Select the target that builds the app to open the target editor.
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择构建应用的target以打开target编辑器。
- en: Then, click on **Capabilities**.
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，点击**功能**。
- en: Find the **Apple Pay** capability and toggle the corresponding switch to its
    on position.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 找到**Apple Pay**功能，并将相应的开关切换到开启位置。
- en: In the dialog that appears, select the appropriate development team, and click
    on **Choose**.![Enabling Apple Pay in your app's Xcode project](img/B05093_01_01.png.jpg)
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在出现的对话框中，选择适当的开发团队，并点击**选择**。[在您的应用Xcode项目中启用Apple Pay](img/B05093_01_01.png.jpg)
- en: Summary
  id: totrans-96
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, you learned about the online payment process followed by merchants
    to obtain card-based payments. The chapter introduced general online payment concepts
    to describe how an app uses Apple Pay to perform a similar function but more securely.
    Finally, you learned how to create the Apple Pay merchant identifier and merchant
    certificate to enable Apple Pay payment in your apps.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你学习了商家获取基于卡的支付所遵循的在线支付流程。本章介绍了通用的在线支付概念，以描述应用如何使用Apple Pay执行类似功能但更加安全。最后，你学习了如何创建Apple
    Pay商家标识符和商家证书，以在你的应用中启用Apple Pay支付。
- en: The next chapter focuses on the payment request workflow, where you present
    the **Apple** **Pay** button when Apple Pay is available on the device, create
    the payment request, and present the payment sheet based on that request.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 下一章重点介绍支付请求工作流程，其中当设备上可用Apple Pay时，您将展示**Apple** **Pay**按钮，创建支付请求，并根据该请求展示支付表单。
