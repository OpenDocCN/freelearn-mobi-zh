# 第一章. Swift 编程语言

游戏开发的核心理念是游戏代码。它是项目的灵魂，除了艺术、声音和各种资产开发之外。你将在那里花费大部分时间创建和测试你的游戏。直到 2014 年 6 月的苹果公司**全球开发者大会 WWDC14**，iOS 游戏和应用程序开发的代码选择一直是**Objective-C**。在*WWDC14*上，宣布了一种新的更快编程语言 Swift，现在它是所有当前和未来 iOS 游戏以及通用应用程序创建的推荐语言。

到目前为止，你仍然可以使用 Objective-C 来设计你的游戏，但无论是新手还是经验丰富的程序员，都会看到为什么用 Swift 编写不仅更容易表达游戏逻辑，而且更加规范。保持游戏在关键性的 60 fps 运行取决于快速代码和逻辑。苹果公司的工程师从头开始开发 Swift 编程语言，考虑到性能和可读性，因此这种语言可以比 Objective-C 更快地执行某些代码迭代，同时将代码歧义降到最低。Swift 还使用了更多现代语言中找到的许多方法和语法，例如 Scala、JavaScript、Ruby 和 Python。

那么，让我们深入探讨 Swift 语言。

### 注意

建议在之前对面向对象编程（OOP）有一些基本了解，但我们将努力使代码构建和解释简单易懂，随着我们转向与游戏开发相关的更高级主题。

# Hello World!

在学习编程语言时，从**Hello World**示例开始是一种相当传统的做法。Hello World 程序只是使用你的代码来显示或记录文本“Hello World”。它一直是通用起点，因为有时只是设置你的代码环境并确保代码正确执行就是战斗的一半。至少，这在较老的编程语言中更为常见。

Swift 使得这一切变得比以往任何时候都更容易，而且不需要深入了解 Swift 文件的结构（我们将在稍后进行，这比 Objective-C 和过去使用的语言都要简单得多），以下是如何创建一个 Hello World 程序的方法：

```swift
print("Hello, World!")
```

就这样！这就是你需要在 Xcode 的调试区域输出中看到文本`Hello World`的全部内容。

# 不再需要分号

我们这些编程一段时间的人可能会注意到通常至关重要的分号（`;`）不见了。这不是一个错误；在 Swift 中，我们不需要使用分号来标记表达式的结束。如果我们想，我们可以这样做，有些人可能仍然会这样做作为一种习惯，但 Swift 已经省略了这种常见的担忧。

### 注意

使用分号标记表达式结束的做法源于编程的早期，当时代码是在简单的文字处理器中编写的，需要特殊字符来表示代码的表达式何时结束以及何时开始。

# 变量、常量和原始数据类型

在编程任何应用程序时，无论是编程新手还是试图学习不同的语言，首先我们应该了解一种语言如何处理变量、常量和各种数据类型，例如布尔值、整数、浮点数、字符串和数组。你可以把程序中的数据想象成信息或容器。这些容器可以是不同风味或类型的。在整个游戏的生命周期中，数据可以改变（变量、对象等）或者保持不变。

例如，玩家拥有的生命值将作为变量存储，因为预计在游戏过程中会发生变化。这个变量将是原始数据类型整数，基本上是整数。存储诸如游戏中某种武器或增强效果的名称的数据将存储在所谓的常量中，因为这个项目的名称永远不会改变。在玩家可以更换武器或增强效果的游戏中，表示当前装备物品的最佳方式是使用变量。变量是一段会变化的绑定数据。这种武器或增强效果可能还会包含比名称或数字更多的信息；我们之前提到的原始类型。当前装备的物品将由属性组成，例如其名称、力量、效果、索引号以及代表它的精灵或 3D 模型。因此，当前装备的物品不仅是一个原始数据类型的变量，而是一种称为对象类型的类型。编程中的对象可以包含许多属性和功能，可以将其视为功能和信息的一种*黑盒*。在我们的例子中，当前装备的物品将是一种*占位符*，可以持有该类型的物品并在需要时进行交换，从而完成其作为可替换物品的用途。

### 注意

Swift 是一种被称为*类型安全语言*的语言，因此我们应该跟踪数据的精确类型及其未来的使用（即，数据是否或将是`NULL`），因为在与其他语言相比使用 Swift 时，这非常重要。苹果让 Swift 以这种方式运行，以帮助将应用程序中的运行时错误和错误降到最低，这样我们就可以在开发过程中更早地发现它们。

## 变量

让我们看看 Swift 中如何声明变量。

```swift
var lives = 3      //variable of representing the player's lives
lives = 1          //changes that variable to a value of 1
```

对于那些在 JavaScript 中开发过的人来说，这里会感到非常熟悉。就像 JavaScript 一样，我们使用关键字`var`来表示一个变量，并将其命名为`lives`。

编译器隐式地知道这个变量的类型是一个整数，原始数据类型`Int`。

类型可以显式地声明如下：

```swift
var lives: Int = 3    //variable of type Int
```

我们也可以将生命值表示为浮点数据类型 double 或 float，如下所示：

```swift
// lives are represented here as 3.0 instead of 3
var lives: Double = 3           //of type Double
var lives: Float = 3            //of type Float
```

在变量名称声明后使用冒号允许我们显式地进行类型转换。

## 常量

在你的游戏中，将会有一些数据在整个游戏生命周期或当前关卡/场景中不会改变。这些可以是各种数据，例如重力、**抬头显示**（**HUD**）中的文本标签、角色 2D 动画的中心点、事件声明或游戏检查新触摸/滑动之前的时间。

声明常量几乎与声明变量相同。

在变量名声明后使用冒号允许我们显式地进行类型转换。

```swift
let gravityImplicit  = -9.8         //implicit declaration
let gravityExplicit: Float  =  -9.8 //explicit declaration
```

如我们所见，我们使用关键字 `let` 来声明常量。

这里还有一个使用字符串的例子，它可以代表在阶段开始或结束时在屏幕上显示的消息：

```swift
let stageMessage  = "Start!"
stageMessage      = "You Lose!"   //error
```

由于字符串 `stageMessage` 是一个常量，一旦声明后我们无法更改它。像这样使用 `var` 而不是 `let` 的变量会更好。

### 小贴士

“为什么我们不把所有东西都声明为变量？”

这是一些新开发者经常提出的问题，为什么会有这样的疑问是可以理解的，尤其是考虑到游戏应用通常比普通应用有更多的变量和可交换的状态。当编译器构建它内部的游戏对象和数据列表时，在变量方面比在常量方面幕后发生的事情更多。

不深入探讨诸如程序的堆栈和其他细节等主题，简而言之，使用 `let` 关键字将对象、事件和数据声明为常量比使用 `var` 更有效率。尽管在今天最新的设备上的小型应用中不推荐这样做，但我们可能在不看到大量性能损失的情况下做到这一点。然而，当涉及到视频游戏时，性能是关键。尽可能多地恢复性能可以允许更好的玩家体验。苹果建议，在不确定的情况下，始终在声明时使用 `let`，让编译器决定何时改为 `var`。

## 关于常量的更多信息...

在 Swift 版本 1.2 中，常量可以有一个条件控制的初始值。

在此更新之前，我们必须使用单个起始值初始化常量，或者被迫将属性变为变量。在 Xcode 6.3 及更高版本中，我们可以执行以下逻辑：

```swift
let x : SomeThing

if condition
{
  x = foo()
}
else
{
  x = bar()
}
use(x)
```

在游戏中，这样的例子可以是：

```swift
let stageBoss : Boss

if (stageDifficulty == gameDifficulty.hard)
{
  stageBoss = Boss.toughBoss()
}
else
{
  stageBoss = Boss.normalBoss()
}
loadBoss(stageBoss)
```

使用此功能，常量的初始化可以有一个可变性的层级，同时仍然保持其不可变性，或者通过其使用保持不变。在这里，常量 `stageBoss` 可以根据游戏难度是两种类型之一：`Boss.toughBoss()` 或 `Boss.normalBoss()`。在这个阶段过程中，Boss 不会改变，所以将其保持为常量是有意义的。关于 **if 和 else 语句** 的更多内容将在本章后面介绍。

# 数组、矩阵、集合和字典

变量和常量可以表示各种属性和对象的集合。最常见的集合类型有数组、矩阵、集合和字典。数组是有序的不同对象的列表；矩阵简而言之，是数组的数组；集合是无序的不同对象的列表；而字典是无序的列表，它利用了 *键 : 值* 关联来存储数据。

## 数组

下面是一个 Swift 中数组的示例：

```swift
let stageNames : [String] = ["Downtown Tokyo","Heaven Valley","Nether"]
```

对象 `stageNames` 是一个表示游戏阶段名称的字符串集合。数组通过下标从 `0` 到数组长度 `-1` 进行排序。因此，`stageNames[0]` 将会是 `Downtown Tokyo`；`stageNames[2]` 将会是 `Nether`；而 `stageNames[4]` 会引发错误，因为那超出了数组的范围且不存在。我们使用 `[]` 方括号包围 `stageNames` 的类类型 `[String]`，以告诉编译器我们正在处理字符串数组。方括号也用于包围这个数组的各个成员。
