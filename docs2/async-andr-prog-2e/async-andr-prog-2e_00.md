# 前言

无论你是 Android 初学者开发者还是经验丰富的 Android 程序员，这本书都将探讨如何实现高效且可靠的多线程 Android 应用程序。

我们将探讨 Android 开发者社区常用的最佳异步结构和技巧，以在主线程之外执行计算密集型或阻塞任务，保持 UI 响应，告诉用户事情进展情况，确保我们完成开始的工作，利用那些强大的多核处理器，并且所有这些都不浪费电池。

通过使用正确的异步结构，许多复杂性被从开发者中抽象出来，使得应用程序源代码更易于阅读和维护，并且更不容易出错。

通过使用逐步指南和代码示例，你将学习如何管理多个线程之间的交互，并避免在两个或更多线程访问共享资源以完成后台工作、更新 UI 或检索最新应用程序数据时可能出现的并发和同步问题。

在这段旅程的终点，你将了解如何构建行为良好的应用程序，拥有平滑、响应式的用户界面，使用户通过快速的结果和始终新鲜的数据感到愉悦。

# 本书涵盖的内容

第一章，*Android 中的异步编程*，概述了 Android 进程和线程模型，并描述了一些关于并发的一般挑战和好处，然后讨论了特定于 Android 的问题。

第二章，*使用 Looper、Handler 和 HandlerThread 执行工作*详细介绍了`Handler`、`HandlerThread`和`Looper`的基本和相关主题，并说明了如何使用它们在主线程上调度任务，以及如何在协作的后台线程之间协调和通信工作。

第三章，*探索 AsyncTask*，涵盖了 Android 编程中最常见的并发结构。我们学习了`AsyncTask`的工作原理，如何正确使用它，以及如何避免即使是经验丰富的开发者也容易陷入的常见陷阱。

第四章，*探索加载器*，介绍了`Loader`框架，并处理了异步加载数据以保持用户界面响应和避免故障的重要任务。

第五章，*与服务交互*，我们探讨了非常强大的 Android 组件`Service`，将其用于执行带有或没有可配置并发级别的长时间运行的后台任务。这个组件为我们提供了在单个`Activity`生命周期之外执行后台操作的手段，并确保即使在用户离开应用程序的情况下，我们的工作也能完成。

第六章，*使用 AlarmManager 安排工作*，向我们介绍了一个系统 API，该 API 可用于延迟工作或创建周期性任务。安排的任务可以唤醒设备以完成工作或提醒用户有新内容。

第七章，*探索 JobScheduler API*，介绍了 Android Lollipop 中引入的一个作业调度系统 API，该 API 允许我们在满足一系列设备条件（如能源或网络）时启动后台工作。

第八章，*与网络交互*，我们详细介绍了`HttpUrlConnection` Android HTTP 客户端。使用`HttpUrlConnection` HTTP 客户端，我们将创建一个异步工具包，能够从远程服务器获取 JSON 文档、XML 或文本。

第九章，*在本地层进行异步工作*，介绍了 JNI 接口，这是一个 Java 标准接口，将允许我们在本地代码（C/C++）上执行并发任务，从本地层与 Java 代码交互或从本地代码更新 UI。

第十章，*使用 GCM 进行网络交互*，我们将学习如何使用 Google GCM 高效地从您的服务器推送和拉取实时消息，以及如何使用 Google Play 服务框架安排工作。

第十一章，*探索基于总线通信*，我们将向读者介绍发布/订阅消息模式和 Event Bus 库，这是一个发布/订阅实现，允许我们在 Android 应用程序组件之间传递异步消息。

第十二章，*使用 RxJava 进行异步编程*，我们将介绍 RxJava，这是一个库，通过使用可观察数据流，可以轻松地在 Java 中组合异步和基于事件的任务。

# 您需要为此本书准备的东西

要跟随示例进行实验，您需要一个装有 Java 7（或 8）SE 开发套件和 Android 软件开发套件版本 9 或更高版本的开发计算机（您至少需要版本 21 才能尝试所有示例）。

您还需要 Android Studio IDE。示例已使用 Google 的新 Android Studio IDE 开发，并使用其集成的构建系统 Gradle。

虽然您可以使用 Android SDK 提供的模拟器运行示例，但这只是真实设备的糟糕替代品。物理 Android 设备是开发并测试 Android 应用程序更快、更愉快的方式！

许多示例可以在运行任何版本 Android 2.3（姜饼）或更高版本的设备上运行。一些示例演示了较新的 API，因此需要更近期的 Android 版本——最高到 Android 5，Lollipop。

# 这本书面向的对象

本书是为希望学习如何使用高级异步技术和概念构建多线程和可靠 Android 应用程序的 Android 开发者而编写的。

他们想学习这项技术，因为他们想了解如何使用 Android 标准构造和 API 构建能够有序与内部/外部服务和框架交互的高效应用程序。

不需要具备并发和异步编程的先验知识。本书也针对新接触 Android 的 Java 专家。

# 约定

在本书中，您将找到许多文本样式，用于区分不同类型的信息。以下是一些这些样式的示例及其含义。

文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称按照以下方式显示：“我们可以通过使用`include`指令包含其他上下文。”

代码块按照以下方式设置：

```java
[default]
exten => s,1,Dial(Zap/1|30)
exten => s,2,Voicemail(u100)
exten => s,102,Voicemail(b100)
exten => i,1,Voicemail(s0)
```

当我们希望将您的注意力引向代码块中的特定部分时，相关的行或项目将以粗体显示：

```java
[default]
exten => s,1,Dial(Zap/1|30)
exten => s,2,Voicemail(u100)
exten => s,102,Voicemail(b100)
exten => i,1,Voicemail(s0)
```

任何命令行输入或输出都按照以下方式编写：

```java
# cp /usr/src/asterisk-addons/configs/cdr_mysql.conf.sample
 /etc/asterisk/cdr_mysql.conf

```

**新术语**和**重要词汇**以粗体显示。屏幕上显示的单词，例如在菜单或对话框中，在文本中显示如下：“点击**下一步**按钮将您带到下一个屏幕。”

### 注意

警告或重要提示会出现在这样的框中。

### 提示

技巧和窍门看起来像这样。

# 读者反馈

我们始终欢迎读者的反馈。请告诉我们您对这本书的看法——您喜欢或不喜欢的地方。读者反馈对我们很重要，因为它帮助我们开发出您真正能从中获得最大价值的标题。

要向我们发送一般反馈，只需发送电子邮件至`<feedback@packtpub.com>`，并在邮件主题中提及书籍的标题。

如果您在某个主题上具有专业知识，并且您有兴趣撰写或为书籍做出贡献，请参阅我们的作者指南[www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

现在您已经是 Packt 书籍的骄傲拥有者，我们有一些事情可以帮助您从您的购买中获得最大收益。

## 下载示例代码

您可以从[`www.packtpub.com`](http://www.packtpub.com)的账户下载本书的示例代码文件。如果您在其他地方购买了此书，您可以访问[`www.packtpub.com/support`](http://www.packtpub.com/support)并注册，以便将文件直接通过电子邮件发送给您。

您可以通过以下步骤下载代码文件：

1.  使用您的电子邮件地址和密码登录或注册我们的网站。

1.  将鼠标指针悬停在顶部的**支持**标签上。

1.  点击**代码下载与勘误**。

1.  在**搜索**框中输入书籍名称。

1.  选择您想要下载代码文件的书籍。

1.  从下拉菜单中选择您购买此书的来源。

1.  点击**代码下载**。

您也可以通过点击 Packt Publishing 网站上书籍网页上的**代码文件**按钮下载代码文件。您可以通过在**搜索**框中输入书籍名称来访问此页面。请注意，您需要登录您的 Packt 账户。

文件下载完成后，请确保使用最新版本的软件解压或提取文件夹：

+   WinRAR / 7-Zip for Windows

+   Zipeg / iZip / UnRarX for Mac

+   7-Zip / PeaZip for Linux

该书的代码包也托管在 GitHub 上，网址为[`github.com/PacktPublishing/Asynchronous-Android-Programming`](https://github.com/PacktPublishing/Asynchronous-Android-Programming)。我们还有其他丰富的图书和视频代码包，可在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。请查看它们！

## 错误清单

尽管我们已经尽一切努力确保我们内容的准确性，但错误仍然可能发生。如果您在我们的某本书中找到错误——可能是文本或代码中的错误——如果您能向我们报告，我们将不胜感激。这样做可以节省其他读者的挫败感，并帮助我们改进本书的后续版本。如果您发现任何错误清单，请通过访问[`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)，选择您的书籍，点击**错误清单提交表单**链接，并输入您的错误清单详情。一旦您的错误清单得到验证，您的提交将被接受，错误清单将被上传到我们的网站或添加到该标题的错误清单部分。

要查看之前提交的错误清单，请访问[`www.packtpub.com/books/content/support`](https://www.packtpub.com/books/content/support)，在搜索字段中输入书籍名称。所需信息将在**错误清单**部分显示。

## 盗版

互联网上对版权材料的盗版是一个持续存在的问题，在所有媒体中都是如此。在 Packt，我们非常重视我们版权和许可证的保护。如果您在互联网上发现我们作品的任何非法副本，请立即提供位置地址或网站名称，以便我们可以追究补救措施。

请通过发送电子邮件至`<copyright@packtpub.com>`并附上疑似盗版材料的链接与我们联系。

我们感谢您的帮助，保护我们的作者和提供有价值内容的能力。

## 询问

如果您在这本书的任何方面遇到问题，您可以通过发送电子邮件至`<questions@packtpub.com>`与我们联系，我们将尽力解决问题。
