# 第一章：Arduino 和 iOS – 平台和集成

本章将简要介绍 Arduino 和 iOS 平台及其之间的集成方法。此外，你将学习如何在两个平台上设置开发环境，并为下一章的项目做好准备。

我们假设你已经对这两个平台和电子学有一些基本知识，并且能够至少使用面包板搭建电路。然而，本章的主要目的是学习如何将这两个平台集成在一起。

Arduino 自其早期起源以来一直是一款开放硬件设备，你可以轻松找到关于它的任何所需信息。相反，iOS 平台在硬件方面并不开放。你无法设计并构建一个与 iOS 设备兼容的硬件设备，除非加入苹果的专用项目（MFi）。该计划要求严格，只有大公司才能满足。

### 提示

**关于 Arduino 和 iOS 的更多信息**

关于 Arduino 和 iOS 开发的更多信息可以在[`www.arduino.cc`](http://www.arduino.cc)和[`apple.co/1HThS1O`](http://apple.co/1HThS1O)分别找到。

尽管如此，在章节的结尾，你将学习如何在两种平台之间以允许你的应用程序在 iTunes App Store 上销售的方式传输数据。这并不复杂。我们将使用 TCP/IP 或蓝牙 BLE。

本章将涵盖以下主题：

+   硬件和软件要求

+   Arduino 和开发环境设置

+   iOS 和开发环境设置

+   Arduino 和 iOS 设备之间的通信方法

# 硬件和软件要求

为了实现本书中的所有项目，你需要一些硬件和软件组件，这些组件可以从你当地的任何商店或通过互联网轻松购买。

## Arduino 平台的硬件要求

为了执行本书中的项目，你主要需要 Arduino UNO 和以下额外的硬件组件：

1.  Arduino UNO R3 ([`bit.ly/1IInOke`](http://bit.ly/1IInOke))。

1.  一条 USB 线（A 到 B 类型）。

1.  一个 9V 外部直流电源（可选但推荐）。

1.  一块官方 Wi-Fi 盾牌 ([`bit.ly/1UQgq9v`](http://bit.ly/1UQgq9v), [`bit.ly/1i5k1Cn`](http://bit.ly/1i5k1Cn))。

1.  一块来自 Adafruit 的蓝牙 BLE nRF8001 扩展板 ([`bit.ly/1MvkyJm`](http://bit.ly/1MvkyJm))。

1.  一个数字万用表（可选但强烈推荐）。

1.  一个面包板（越大越好）。

1.  一些工具（斜口钳、钳子、镊子、剪钳等）。

1.  一些公对公和公对母的跳线（越多越好；它们永远不够！）

1.  一些电子组件，将在每一章中展示。

1.  一个用于第五章项目的巡游机器人，“电视恒定音量控制器”。

1.  第六章中的项目 *自动车库门开启器* 的 iBeacon ([`apple.co/1GXnt7Z`](http://apple.co/1GXnt7Z))。

### 小贴士

**仅购买正品！**

许多 Arduino 产品被伪造，尤其是在网上，售价仅为几美元。除了道德考虑之外，正品将为您提供更多质量和确保正确功能的确信。本书中的项目是在正品上开发和测试的。您已被警告！

**官方 Wi-Fi 扩展板**

官方 Wi-Fi 扩展板并不便宜，有时与 iOS 一起使用可能会很困难。许多其他产品更便宜。有些是兼容的，有些则不是。如果您选择使用不同的 Wi-Fi 扩展板，请确保它与 Arduino IDE 中包含的 Wi-Fi 库兼容。否则，您将不得不自行修改本书中的 Arduino 代码。您也可以在 [`bit.ly/1i5k1Cn`](http://bit.ly/1i5k1Cn) 购买此扩展板。

**Arduino.cc 与 Arduino.org 冲突**

在撰写本书时，Arduino 分裂为两家公司——arduino.cc 和 arduino.org。它们正处于法律斗争中，关于两家公司销售的同名产品存在很多混淆。尽管在美国和亚洲的情况正在变得清晰，但在欧洲仍然不可预测。在这本书中，我们将使用 arduino.cc 的产品和开发环境。

**蓝牙断路板**

我们选择的蓝牙设备已在多个项目中进行了多次测试，表现良好。市场上还有许多其他设备，可以完成完全相同的工作。如果您决定使用不同的蓝牙设备，请确保它是一个 BLE（蓝牙低功耗）设备，也称为蓝牙 4.0、蓝牙低功耗和蓝牙智能。只有当它是蓝牙 BLE 时，您才能轻松编写仅通过蓝牙通信的 iOS 应用程序。

## Arduino 平台的软件要求

您所需的一切是 Arduino IDE 1.6.4、IDE 中包含的库以及一些可在网上获得的附加库。当需要时，您将被告知下载它们。

## iOS 平台的硬件要求

编写 iOS 应用程序所需的 Apple 开发环境（Xcode）仅适用于 Mac OS X 操作系统（10.10.3 Yosemite 版本）。因此，您需要一个配备最新英特尔处理器的 Mac 计算机来运行 Yosemite。

此外，您需要一个运行 iOS 8.4 且支持蓝牙 4.0 的 iOS 设备（iPhone、iPad 或 iPod touch）。

如果你已经是 iOS（每年约 99 美元）的**Apple Developer Program**（ADP）成员，你的生活将会变得简单。不幸的是，如果你不是 ADP 的成员，苹果不允许你将使用 Xcode 编写的程序上传到自己的设备。即使你不是 ADP 的成员，你仍然可以在设备模拟器中运行程序，但它将无法模拟蓝牙 BLE 子系统。这将是一个使用蓝牙 BLE 的项目的问题。无论如何，将本书中展示的代码修改为使用 Wi-Fi 而不是蓝牙 BLE 不应该太复杂。

### 小贴士

**Xcode 和新的苹果规则**

在本书编写时，苹果宣布了一个新的 iOS 版本（版本 9）和 Xcode 版本（版本 7），它们现在处于测试版本。这些版本将取消一些限制规则，用户即使没有订阅 Apple Developer Program，也应该能够将自编写的应用程序上传到自己的设备。

## iOS 平台的软件要求

如前所述，要为 iOS 平台编写应用程序，你需要 Xcode（本书编写时的版本为 6.4）和一些可在网上找到的额外开源库。当需要时，你将被告知下载它们。Xcode 仅在 Mac 的 OS X（版本 10.10.3 Yosemite 或更高版本）上运行。即使本书中的大部分代码可以在 iOS 的早期版本上运行，但你的 iOS 设备必须能够运行 iOS 8.3 及以上版本，因为本书中使用的正是这个版本。

# Arduino 和开发环境设置

Arduino 是一个非常基础但功能强大的微处理器板。它允许你获取数字和模拟输入，处理它们，并控制外部设备。

你可以在[`bit.ly/1IInOke`](http://bit.ly/1IInOke)找到有关此设备的所有详细信息。

它与市场上许多其他类似（甚至更强大）的设备的不同之处在于，它有一个非常简单的开发环境（IDE）和大量的库，这允许你只需几小时就能完成项目。这些库中的大多数已经在 IDE 中可用，或者很容易添加。

### 小贴士

**Arduino UNO – Arduino MEGA**

在本书中，我们将参考 Arduino UNO。Arduino 还有许多其他具有不同硬件特性、FLASH 和 RAM 内存大小的板。本书中的大多数项目在 Arduino MEGA 上运行时，代码无需更改，硬件只需做少量修改。

**其他平台**

每隔几周，就会推出一个与 Arduino 兼容的新平台。其中两个与本书中的项目兼容的平台是 RFduino，它支持蓝牙 BLE 而无需任何额外硬件（更多信息，请访问[`www.rfduino.com`](http://www.rfduino.com)）和 Teensy（了解更多关于 Teensy 的信息，请访问[`www.pjrc.com/teensy`](https://www.pjrc.com/teensy)）。与这些平台一起工作可能需要进行一些硬件和/或软件的更改。

## IDE 安装

安装 IDE 的过程非常快速且简单，尤其是在您不需要在 OS X 上安装额外的驱动程序的情况下。

您可以使用以下步骤在几分钟内准备好开发环境：

1.  确保您已安装可以打开 ZIP 文件的应用程序。如果您没有此类应用程序，您可以在 App Store 中免费找到它们（The Unarchiver 可能是一个选择，可以从 [`apple.co/1gT7W2D`](http://apple.co/1gT7W2D) 下载）。

1.  从 [`bit.ly/1gT8u8E`](http://bit.ly/1gT8u8E) 下载 Arduino IDE 1.6.4。

1.  通常，浏览器会在您的 `下载` 文件夹中下载文件。打开此文件夹并解压 ZIP 文件（`Arduino-1.6.4-macosx.zip`）。

1.  将 `Arduino.app` 文件移动到您的应用程序文件夹。

开发环境现在已准备好运行。

为了确保一切按预期工作，请将包含的示例之一（闪烁即可）上传到您的 UNO。请参考 [`bit.ly/1KsUhqv`](http://bit.ly/1KsUhqv) 以正确配置 IDE 中的板和端口。

### 小贴士

**要使用的 IDE 版本**

本书中的代码是在 IDE 1.6.4 上测试的，这是撰写本书时的最新版本。即使有新的 IDE 版本可用，您也应该使用建议的版本。不同版本的 IDE 中包含的库通常不同，这可能会导致意外的行为。您可以在完全构建和测试 Arduino 和 iOS 上的项目后测试新的 IDE。

# iOS 和开发环境设置

在过去几年中，通常称为智能手机的设备已成为最常用的个人设备。iPhone 是全球使用最广泛的智能手机之一，而在许多情况下，iPad 已取代了个人电脑。

iPhone、iPad 和 iPod touch 运行相同的操作系统，称为 iOS。它们拥有整洁且统一的用户界面，允许用户通过简单的手势（如轻触和双击屏幕）或复杂的手势（如滑动或捏合屏幕）与设备交互。

可以在 iPhone 和 iPad 上运行的应用程序可以轻松编写，并且这两个平台都非常强大，几乎任何应用程序都可以在上面运行。

我们可以直接进入安装开发环境的过程，这样我们就可以开始享受 iOS 和 Arduino 的乐趣了。

## Xcode 安装

您可以执行以下步骤在几分钟内安装 Xcode：

1.  打开 App Store 应用程序。通常，您可以在 Dock 中找到它。或者，您可以从 Launchpad 运行它，或者通过导航到 **查找器** | **应用程序** | **App Store**。

1.  使用您的账户连接到 App Store（浏览 **商店** | **登录**）。

1.  定位 Xcode（导航到 **类别** | **开发者工具** 或搜索它）。

1.  点击 **获取** 按钮开始下载。

在很短的时间内，应用程序将被下载并安装（取决于您的互联网连接速度）。

# Arduino 与 iOS 设备之间的通信方法

iOS 平台并不那么开放，尤其是从硬件角度来看。苹果要求连接到 iPhone 或 iPad 的硬件设备不仅应符合直接要求，而且还需要苹果本身的认证。为此，他们需要加入苹果的专用计划（MFi：[`apple.co/1PwSeWO`](http://apple.co/1PwSeWO)）。加入该计划的要求非常严格，只有大公司才能满足这些要求。

尽管如此，苹果允许使用 TCP/IP 和蓝牙 BLE 与任何外部设备通信。这些是我们将在整本书中使用来通过 Arduino 传输数据的方法。在 Arduino 的一侧，我们必须选择与这两种方法兼容的附加硬件，或者用更技术性的术语来说，这两种协议。

Arduino 提供了以下两种盾以进行 TCP/IP 通信：

+   以太网盾

+   Wi-Fi 盾

这两种盾都包括一个 SD 卡槽来存储数据。

以太网盾相对便宜且非常可靠。由于它使用以太网连接，它的缺点是需要物理线连接到你的家庭网络或路由器。这减少了你项目的灵活性。

相反，Wi-Fi 盾允许你在家里任何地方安装 Arduino 板，而不需要线缆的尴尬。这就是我们选择在这本书中使用 Wi-Fi 盾的原因。

苹果允许的另一种将数据传输到外部设备的方法是蓝牙 BLE（也称为蓝牙 4.0）。此协议消耗的能源更少，但它与之前的版本不兼容。如果你的 iOS 设备相当新，它将支持蓝牙 BLE。请在苹果网站上的设备页面上检查这一点。

### 小贴士

**支持 BLE 的设备**

如果你希望检查设备是否支持 BLE，请访问[`bit.ly/1blI106`](http://bit.ly/1blI106)。

Arduino 没有提供蓝牙 BLE 盾，但其他供应商有。我们选择了 Adafruit 的蓝牙 BLE nRF8001 分线板。

### 小贴士

**蓝牙 4.0**

你可以通过访问[`bit.ly/1Pj9caw`](http://bit.ly/1Pj9caw)了解更多关于蓝牙 4.0 的信息。

## TCP/IP 与蓝牙

你可能会想知道 iOS 和 Arduino 的最佳通信方法。没有正确答案。这实际上取决于你的项目和你的需求。以下表格显示了每种方法的主要优缺点：

| 方法 | 优点 | 缺点 |
| --- | --- | --- |
| **Wi-Fi** |

+   Arduino 可以放在你家里的几乎任何地方。

+   iOS 设备可以无处不在（如果网络设置得当，甚至在世界另一端）。

+   SD 卡可以用来存储数据。

|

+   这很贵。

+   即使数据可以以高达 54 Mbps 的速度传输，Wi-Fi 盾在传输数据方面并不那么响应。

+   功耗如此之高，以至于你不能使用电池来为 Arduino 和 Wi-Fi 盾供电。

|

| **蓝牙** |
| --- |

+   Arduino 几乎可以放在您家的任何地方。

+   蓝牙设备消耗的电量要少得多。因此，可以使用电池为其供电。

+   数据传输速度可达 1 Mbps，但无延迟。

|

+   iOS 设备必须靠近 Arduino（大约 100 米；室内则更短）。

+   如果您希望存储额外的数据，则板上没有 SD 卡可用。

|

# 摘要

在本章中，您主要学习了将 Arduino 和 iOS 设备集成的基础知识。在接下来的章节中，您将学习如何在实践中编写此集成的代码。

此外，您已安装 Arduino IDE 以编写和上传程序到 Arduino，以及 Xcode 以编写和上传程序到您的 iOS 设备。

所以，放松一下。我们刚刚开始！让我们开始吧！
