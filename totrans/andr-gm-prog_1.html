<html><head></head><body><div><div><div><div><h1 class="title"><a id="part01"/>Part 1. Module 1</h1></div></div></div><div><div><div><blockquote class="blockquote"><p><em><strong>Learning Java by Building Android Games</strong></em></p><p><em>Get ready for a fun-filled experience of learning Java by developing games for the Android platform</em></p></blockquote></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Why Java, Android, and Games?</h1></div></div></div><p>Welcome to <em>Learning Java by Building Android Games</em>, which I hope is just the beginning of your exciting journey into designing and writing games. By the end of this book, we will have made four complete games: a math quiz with dynamically increasing difficulty, a memory game in the style of the classic Simon toy, a pong-style squash game, and a clone of the classic <em>Snake</em> game.</p><p>Besides these games, we will build more than a dozen working apps to practice and demonstrate individual concepts to aid our learning of Java, Android, and games. Our games and apps will feature sound FX, graphics, and animations. We will learn everything <a class="indexterm" id="id0"/>from using the standard Android <strong>User Interface</strong> (<strong>UI</strong>) designer to creating smooth animations by plotting individual pixels.</p><p>Although I will encourage you to work with me and implement the specific projects that are detailed step by step throughout the book, I fully expect that once you grasp the different concepts, you will want to use them in your own unique creations without delay. This is exactly what I hope you will be inspired to do.</p><p>The game projects themselves are not the objective of the book but the means to a much loftier goal. By the end of the book, you will be able to design and implement your own 2D Android games, to sell or just to give away, on Google Play.</p><div><div><h3 class="title"><a id="tip02"/>Tip</h3><p>There is a bit of ground work to cover first, but I promise it won't take long and it won't be complicated either. Anyone can learn to program.</p></div></div><p>However, there are so many differing opinions among experts, which breeds confusion among beginners concerning the best ways of learning to program. So it is a good idea to look at why learning Java, Android, and games is an ideal pathway for beginners. This will be the first thing we will discuss in this book.</p><p>Here is what we will learn in this chapter:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Is this book for me?</li><li class="listitem" style="list-style-type: disc">Why should I use games to learn to program?</li><li class="listitem" style="list-style-type: disc">Why should I learn Java and Android?</li><li class="listitem" style="list-style-type: disc">Setting up our development environment</li></ul></div><div><div><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Is this book for me?</h1></div></div></div><p>If you have already decided that Java, Android, or games are what you want to learn, then the next question might be, "Is this specific book for me?".</p><p>There are plenty of Java books for beginners and books by much more accomplished authors and programmers than myself. I have read many of them and admire the authors. However, when these books drift away—which they all do—to topics such as Java-native interfaces, web browser applets, or server-side remote communication, I sometimes find myself questioning their immediate relevance to me.</p><p>At this point, at least subconsciously, my commitment would wane and the learning process would slow or stop.</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec08"/>If you just want to learn pure Java</h2></div></div></div><p>If you just want to learn <a class="indexterm" id="id1"/>Java on its own, this book will be a solid start. Although the Android stuff might be considered overhead to your pure Java learning, this is much less than the multitude of potentially unnecessary topics that would be introduced in any other Java book. The only caveat with this book is that the necessary overhead is all at the beginning. But once this minimal overhead is cleared, we can focus quite intently on Java.</p><p>With regard to the amount of overhead:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">It will take about six pages to set up our programming environment in this chapter</li><li class="listitem" style="list-style-type: disc">It will take <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>, to get familiar with the Android tools, create your first working project, and glimpse your first real Java code</li><li class="listitem" style="list-style-type: disc">From then on, it will be nearly pure Java and building games</li></ul></div><p>You will soon see that the tiny amount of overhead is not excessive and is well worthwhile.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec09"/>If Android is your focus</h2></div></div></div><p>If it was Android <a class="indexterm" id="id2"/>itself that made you look at this book, then I am proud to say this is the first book that will teach you Android without assuming you have any prior Java or programming knowledge whatsoever.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec10"/>Where this book will take you</h2></div></div></div><p>By the end of this book, you <a class="indexterm" id="id3"/>will be able to easily take one of many paths including these:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Learning Java at a higher level for any platform</li><li class="listitem" style="list-style-type: disc">Intermediate level <a class="indexterm" id="id4"/>Android learning including pure game frameworks (which will be covered in more detail in <a class="link" href="ch09.html" title="Chapter 9. Making Your Game the Next Big Thing">Chapter 9</a>, <em>Making Your Game the Next Big Thing</em>)</li><li class="listitem" style="list-style-type: disc">A higher level of games development</li><li class="listitem" style="list-style-type: disc">Much easier tackling of any modern object-oriented language for things such as iOS, Windows, or web development</li></ul></div><p>So if you know you want to learn Android or Java, hopefully, I have gone some way to make you commit to the way this book will help you. But why games, Android, or Java at all?</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Why build games to learn to program?</h1></div></div></div><p>Fun, of course! But there are other reasons too. Successfully running any program we have written <a class="indexterm" id="id5"/>is immensely satisfying, even more so when it involves using some code that we previously didn't understand.</p><p>But making our own games, as you will soon realize, creates a feeling of pleasure that is not easy to describe—it has to be experienced. Then there are added bonuses of sharing our creations with friends on a phone or tablet or even sharing them publicly on the Google Play Store, and you might realize that once you start making games, you can't stop.</p><p>As we create more complex games steadily, you'll realize that all techniques and pieces of code can be rehashed to create other games, and you can then start planning your very own unique masterpieces. This is exhilarating to say the least.</p><p>And as with many subjects, the more we practice the better we get. So games are a perfect way to start learning to program Java. However, most beginners' books for Android games require a fairly high level of Java knowledge. But as we will see, it is perfectly possible to keep the practical examples as fun game projects and still start with the very basics of Java.</p><p>There is a slight trade-off in doing things this way. We will not always approach the working game examples in a "by-the-book" manner. This is to avoid the problem of doing cartwheels before mastering the forward roll.</p><p>The learning outcome priority will always be the Java programming concept, followed by understanding the Android environment and game design principles. Having said that, we will closely examine and practice plenty of Android and game programming fundamentals.</p><p>Of course, from what we have just discussed, you can probably surmise that it would have been possible to teach a bit more Java in the same number of pages if we hadn't been making games.</p><p>This is true, but then we lose all the benefits that come with using games as the subject matter. Making <a class="indexterm" id="id6"/>games really can be a joy, and when our brains are open and eager for information, we will learn much faster. The minimal overhead of learning this way is negated a hundred times over. If games don't interest you in the slightest, then there are plenty of Java beginners' guides out there that take the traditional approach. Just don't expect quite the same thrill as when you publish your first game with online leaderboards and achievements.</p></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Why Android and Java?</h1></div></div></div><p>A part of <a class="indexterm" id="id7"/>successful learning is the commitment by the student, not just to do the work, but in their belief that they are doing the right thing in the right way. So many <a class="indexterm" id="id8"/>technology-based courses and books don't get that commitment from the reader, not subconsciously anyway.</p><p>The problem is the students' belief that they might be, partly at least, wasting their time with something that is or will soon become outdated or perhaps is not quite right for them. This can be true to a large extent with programming. So why should you spend your finite time learning Java, on Android?</p><div><div><div><div><h2 class="title"><a id="ch01lvl2sec11"/>Android is the fastest evolving and growing OS ever</h2></div></div></div><p>At one time, Android <a class="indexterm" id="id9"/>updates emerged almost every two months. Even now, they emerge about once in six months. By comparison, Windows takes years between versions and even iOS updates come only yearly and usually change relatively little between versions. Android is obviously evolving and improving at an unprecedented rate.</p><div><div><h3 class="title"><a id="tip03"/>Tip</h3><p>Look at the <a class="indexterm" id="id10"/>history of Android versions since Version 1 at <a class="ulink" href="http://www.cnet.com/news/history-of-android/">http://www.cnet.com/news/history-of-android/</a>.</p></div></div><p>The first humble version of Android was released in 2008, around the same time when consumers were already quite excited about the then much flashier iPhone. News stories were also reporting that developers were getting rich by selling apps in the iTunes app store.</p><p>But in the last full year <a class="indexterm" id="id11"/>before this book was written, Samsung alone shipped more Android units than Apple sold all iOS devices combined. I am not joining the war on whose devices are best. I enjoy aspects of both Android and Apple, but purely in terms of picking a platform to learn on, you are probably in the right place at the right time with Android.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec12"/>Android developers have great prospects</h2></div></div></div><p>Now you might have picked up this book just for the fun and satisfaction that comes with learning to program games. But if you decide to develop your learning further, you will find that the demand for Android programmers is enormous and therefore very lucrative too.</p><div><div><h3 class="title"><a id="tip04"/>Tip</h3><p>Some data suggests salaries in excess of 100,000 US dollars. For more information, go to <a class="ulink" href="http://www.indeed.com/salary?q1=Android+Developer&amp;l1=United+States">http://www.indeed.com/salary?q1=Android+Developer&amp;l1=United+States</a>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec13"/>Android is open source</h2></div></div></div><p>What open source means is that although Google develops all the flavors of Android that are used on the newest devices, once the code is released, anybody can do whatever they like with it. Google only exerts control for a limited amount of time.</p><p>In practice, most Android users have the pure Google OS or the modified versions turned out by big manufacturers <a class="indexterm" id="id12"/>such as Samsung and HTC, but there is nothing to stop anybody taking the OS and changing, adapting, or converting it into whatever they like. In short, Android could never be taken away from the programming community.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec14"/>Java is here to stay</h2></div></div></div><p>Okay, so we see Android isn't likely to disappear but could Java become redundant? And will your significant time investment be wasted? On Android, as with most platforms, you can use many languages and <a class="indexterm" id="id13"/>tools. Android, however, was designed from the ground up to facilitate Java development. All other languages and tools are not invalid but tend to serve a fairly specific purpose, rather than be a real alternative to Java. In fact, as far as games are concerned, many of the alternatives to a pure Java development environment are also Java-based and require a good level of skill in Java to use. For example, the popular LibGDX game development library, which allows you to simultaneously make games for Android, iOS, Windows, Linux, Mac and even the Web, still uses Java! We will talk more about this in <a class="link" href="ch09.html" title="Chapter 9. Making Your Game the Next Big Thing">Chapter 9</a>, <em>Making Your Game the Next Big Thing</em>. The point is that Java <a class="indexterm" id="id14"/>and Android are tied together and will likely thrive together.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec15"/>Java is not just for Android</h2></div></div></div><p>Java has been around a lot longer than Android, since the beginning of the 1990s in fact. Although what Java has been used for has evolved and diversified over more than two decades, the originally implemented strengths of the language itself remain the same today.</p><p>Java was designed to be platform- or computer-independent. This is achieved by the use of a <strong>virtual machine</strong> (<strong>VM</strong>). This is a program written in another language that decodes the Java program that we write and interacts with the computer platform it is running on. So as long as there is a VM for the computer you want to run your Java program on, with a few caveats, your Java program will work. So if you learn Java, you are learning a language that is used everywhere from the smart fridge to the Web and most places in between.</p><p>It is true, however, that the VM on each platform can and usually does implement features to specifically suit the uses it is likely to be put to. A clear example of this would be mobile-device-specific features such as sensors, GPS, or the built-in camera on many Android devices. Using Java <a class="indexterm" id="id15"/>with Android, you can take photos, detect the air pressure, and work out exactly where in the world you are. Most fridge VMs probably will not do this. So you can't always just run a Java program designed for device x on device y, but the language and syntax is the same. Learning Java on Android prepares you in a large part for Java in any situation. So rest assured that Java isn't going away any time soon.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec16"/>Java is fast and easy to use</h2></div></div></div><p>There is a decades-long debate over which language is the best overall or which language is the best to learn programming. Critics of Java will likely say things about Java's speed. It is true that the Java <a class="indexterm" id="id16"/>memory management along with the VM interpretation process does have some speed cost. However, these things have benefits; they significantly improve our productivity and the way that the Android VM interacts with a device largely negates the minor speed penalty. And since Android 4.4, it does so completely with <strong>Android Run Time</strong> (<strong>ART</strong>), which installs <a class="indexterm" id="id17"/>apps written in Java as fully native applications. Now Java programmers can build games in a friendly, interpreted language and have them run as if they were written in a more challenging natively compiled language.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec17"/>A summary of Java and Android</h2></div></div></div><p>In a rapidly <a class="indexterm" id="id18"/>changing world, if you are worried about where to invest your precious learning time, it is hard to have more confidence. Here we have a language (Java) whose fundamentals have remained almost the same for nearly a quarter of a century, and a platform (Android) that is backed by the biggest names in hardware, software, and retail, and though it's admittedly hugely influenced, it's not actually owned by anyone.</p><p>I am not an evangelist of any technology over another although it is true that I love doing stuff on Android. But <a class="indexterm" id="id19"/>you can be sure in your mind that if you are considering the best path to begin learning programming, there is a very strong argument that Java and Android are the best choice.</p><p>If you want to learn Java for any of its numerous uses, then this is a very good place to start. If you want to develop for Android or get into Android development of any sort, then Java is the absolute fundamental way to start, and making games has the enormous benefits we have already discussed.</p><p>By the end of the book, you will be able to write Java code for almost any Java-supported platform. You will be able use almost everything you learn in this book, away from the Android environment.</p><p>If you are planning to pursue a career or business by making Android games or any Android apps, then this book is possibly the only place to start for beginners.</p><p>If you are completely new to Java and want the easiest possible path to mastering it—the fastest growing platform on the planet—then <em>Learning Java by Building Android Games</em> will probably be just right for you.</p><p>So hopefully you are assured that the path this book will take to learn Java is as easy, fun, and thorough as learning Java can be. Let's get set up so we can start building games.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Setting up our development environment</h1></div></div></div><p>The first thing we <a class="indexterm" id="id20"/>need to do is prepare our PC to develop <a class="indexterm" id="id21"/>for Android using Java. Fortunately, this is made quite simple for us.</p><div><div><h3 class="title"><a id="tip05"/>Tip</h3><p>If you are learning on Mac or Linux, everything in this book will still work. The next two tutorials have Windows-specific instructions and screenshots. However, it shouldn't be too difficult to vary the steps slightly to suit Mac or Linux.</p></div></div><p>All we need to do is:</p><div><ol class="orderedlist arabic"><li class="listitem">Install a software package called the <strong>Java Development Kit</strong> (<strong>JDK</strong>), which allows us to develop in Java.</li><li class="listitem">Install Android Studio, a program designed to make Android development fast and easy. Android Studio uses the JDK and some other Android-specific tools that <a class="indexterm" id="id22"/>automatically get installed <a class="indexterm" id="id23"/>when we install Android Studio.</li></ol></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec18"/>Installing the JDK</h2></div></div></div><p>The first thing we <a class="indexterm" id="id24"/>need to do is get the latest version of the JDK. To complete this guide, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">You <a class="indexterm" id="id25"/>need to be on the Java website, so visit <a class="ulink" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a>.</li><li class="listitem">Find the three buttons shown in the following screenshot and click on the one that says <strong>JDK</strong> (highlighted). They are on the right-hand side of the web page. Click on the <strong>DOWNLOAD</strong> button under the <strong>JDK</strong> option:<div><img alt="Installing the JDK" src="img/8859OS_01_01.jpg"/></div></li><li class="listitem">You will be taken to a page that has multiple options to download the JDK. In the <strong>Product/File description</strong> column, you need to click on the option that matches your operating system. Windows, Mac, Linux and some other less common options are all listed.</li><li class="listitem">A common question here is, "do I have 32- or 64-bit windows?". To find out, right-click on your <strong>My Computer</strong> (This PC on Windows 8) icon, click on the <strong>Properties</strong> option, and look under the <strong>System</strong> heading in the <strong>System type</strong> entry, as shown in the following screenshot:<div><img alt="Installing the JDK" src="img/8859OS_01_02.jpg"/></div></li><li class="listitem">Click on the somewhat hidden <strong>Accept</strong> <strong>License Agreement</strong> checkbox:<div><img alt="Installing the JDK" src="img/8859OS_01_03.jpg"/></div></li><li class="listitem">Now click on the <a class="indexterm" id="id26"/>download option for your OS and system type as previously determined. Wait for the download to finish.</li><li class="listitem">In your <code class="literal">Downloads</code> folder, double-click on the file you just downloaded. The latest version at time of writing this for a 64-bit Windows PC was <code class="literal">jdk-8u5-windows-x64</code>. If you are using Mac/Linux or have a 32-bit OS, your filename will vary accordingly.</li><li class="listitem">In the first of several install dialogs, click on the <strong>Next</strong> button and you will see the next dialog box:<div><img alt="Installing the JDK" src="img/8859OS_01_05.jpg"/></div></li><li class="listitem">Accept the defaults shown in the previous screenshot by clicking on <strong>Next</strong>. In the next dialog box, you can accept the default install location by clicking on <strong>Next</strong>.</li><li class="listitem">Next is the last dialog of the Java installer. Click on <strong>Close</strong>.<p>The JDK is now installed. Next we will make sure that Android Studio is able to use the JDK.</p></li><li class="listitem">Right-click on your <strong>My Computer</strong> (This PC on Windows 8) icon and navigate to <strong>Properties</strong> | <strong>Advanced system settings</strong> | <strong>Environment variables</strong> | <strong>New</strong> (under <strong>System variables, </strong>not under <strong>User variables</strong>). Now you can see the <strong>New </strong><a class="indexterm" id="id27"/><strong>System Variable</strong> dialog, as shown in the following screenshot:<div><img alt="Installing the JDK" src="img/8859OS_01_07.jpg"/></div></li><li class="listitem">Type <code class="literal">JAVA_HOME</code> for <strong>Variable name</strong> and enter <code class="literal">C:\Program Files\Java\jdk1.8.0_05</code> for the <strong>Variable value</strong> field. If you installed the JDK somewhere else, then the file path you enter in the <strong>Variable value:</strong> field will need to point to wherever you put it. Your exact file path will likely have a different ending to match the latest version of Java at the time you downloaded it.</li><li class="listitem">Click on <strong>OK</strong> to save your new settings. Now click on <strong>OK</strong> again to clear the <strong>Advanced system settings</strong> dialog.</li></ol></div><p>Now we have the JDK installed on our PC. We are about half way towards starting to learn Java programming, but we need a friendly way to interact with the JDK and to help us make Android games in Java.</p></div><div><div><div><div><h2 class="title"><a id="ch01lvl2sec19"/>Android Studio</h2></div></div></div><p>We learned that Android <a class="indexterm" id="id28"/>Studio is a tool that simplifies Android development and uses the JDK to allow us to write and build Java programs. There are other tools you can use instead of Android Studio. There are pros and cons in them all. For example, another extremely popular option is Eclipse. And as with so many things in programming, a strong argument can be made as to why you should use Eclipse instead of Android Studio. I use both, but what I hope you will love about Android Studio are the following elements:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">It is a very neat and, despite still being under development, a very refined and clean interface.</li><li class="listitem" style="list-style-type: disc">It is much easier to get started compared to Eclipse because several Android tools that would otherwise need to be installed separately are already included in the package.</li><li class="listitem" style="list-style-type: disc">Android Studio is being <a class="indexterm" id="id29"/>developed by Google, based on another product called IntelliJ IDEA. There is a chance it will be the standard way to develop Android in the not-too-distant future.</li></ul></div><div><div><h3 class="title"><a id="tip06"/>Tip</h3><p>If you want to use Eclipse, that's fine; all of the code in this book will work. However, some the keyboard shortcuts and user interface buttons will obviously be different. If you do not have Eclipse installed already and have no prior experience with Eclipse, then I even more strongly recommend you to go ahead with Android Studio.</p></div></div><div><div><div><div><h3 class="title"><a id="ch01lvl3sec01"/>Installing Android Studio</h3></div></div></div><p>So without any delay, let's get <a class="indexterm" id="id30"/>Android Studio installed and then we can <a class="indexterm" id="id31"/>begin our first game project. To do this, let's visit <a class="ulink" href="https://developer.android.com/sdk/installing/studio.html">https://developer.android.com/sdk/installing/studio.html</a>.</p><div><ol class="orderedlist arabic"><li class="listitem">Click on the button labeled <strong>Download Android Studio</strong> to start the Android studio download. This will take you to another web page with a very similar-looking button to the one you just clicked on.</li><li class="listitem">Accept the license by checking in the checkbox, commence the download by clicking on the button labeled <strong>Download Android Studio for Windows</strong>, and wait for the download to complete. The exact text on the button will probably vary depending on the current latest version.</li><li class="listitem">In the folder in which you just downloaded Android Studio, right-click on the <code class="literal">android-studio-bundle-135.12465-windows.exe</code> file and click on <strong>Run as administrator</strong>. The end of your filename will vary depending upon the version of Android Studio and your operating system.</li><li class="listitem">When asked if you want to <strong>Allow the following program from an unknown publisher to make changes to your computer</strong>, click on <strong>Yes</strong>. On the next screen, click on <strong>Next</strong>.</li><li class="listitem">On the screen shown in the following screenshot, you can choose which users of your PC can use Android Studio. Choose whatever is right for you as all options will work, and then click on <strong>Next</strong>:<div><img alt="Installing Android Studio" src="img/8859OS_01_10.jpg"/></div></li><li class="listitem">In the next dialog, leave the default settings and then click on <strong>Next</strong>.</li><li class="listitem">Then on the <strong>Choose start menu folder</strong> dialog box, leave the defaults and click on <strong>Install</strong>.</li><li class="listitem">On the <strong>Installation complete</strong> dialog, click on <strong>Finish</strong> to run Android Studio for the first time.</li><li class="listitem">The next dialog is for users who have already used Android Studio, so assuming you are a first time user, select the <strong>I do not have a previous version of Android Studio or I do not want to import my settings</strong> checkbox, and then <a class="indexterm" id="id32"/>click on <strong>OK</strong>:<div><img alt="Installing Android Studio" src="img/8859OS_01_11.jpg"/></div></li></ol></div><p>That was the last piece of software we needed. The simple nine-step process we just went through has actually set up a whole range of Android tools that we will begin to use in the next chapter.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Summary</h1></div></div></div><p>We discussed why games, Java, and Android are not only extremely exciting but also arguably the best way to learn to program. This is because games can be an extremely motivating subject matter and Java and Android have enormous strengths with regards to popularity and longevity, and are open to all of us to use for free.</p><p>We also set up the Java development kit and installed Android Studio, getting ready for the next chapter where we will actually create a part of a working game and take our first look at some Java code.</p></div>
<div><div><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Getting Started with Android</h1></div></div></div><p>In this chapter, we will take a roller coaster ride through all the Android topics that you need to learn in order to get started with Java. It won't just be theoretical though. We will be designing <a class="indexterm" id="id33"/>a <strong>user interface</strong> (<strong>UI</strong>) of a game menu and we will see and edit our first Java code as well.</p><p>In addition, we will see how we can run our apps in either an Android emulator on our PC/Mac or on a real Android device if we have one.</p><p>Some of what we will cover in this chapter will be the tip of the iceberg. That is, there is a lot more below the surface to some of the topics we discuss than would be appropriate for the second chapter of a learning Java book. Sometimes, we might need to take a bit of information on faith.</p><p>This will then enable us to actually design and run our very own Android app by the end of this chapter. Then we can start learning Java for real at the beginning of the next chapter.</p><p>If this chapter seems a little tough, then don't worry; keep going because each subsequent chapter lifts the lid a bit more from some of the less clear topics.</p><p>For this chapter and the next two, we will be building a math game. We will start simply and by the end of <a class="link" href="ch04.html" title="Chapter 4. Discovering Loops and Methods">Chapter 4</a>, <em>Discovering Loops and Methods</em>, we will scale to game features that use significant Java skills.</p><p>In this chapter, we will:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Start our first game project</li><li class="listitem" style="list-style-type: disc">Explore Android Studio</li><li class="listitem" style="list-style-type: disc">Use the Android Studio visual designer to make our game UI</li><li class="listitem" style="list-style-type: disc">Learn about structuring our code for Android</li><li class="listitem" style="list-style-type: disc">Take our first look at some Java code</li><li class="listitem" style="list-style-type: disc">Build and install our game on an emulator and a real device</li></ul></div><div><div><div><div><h1 class="title"><a id="ch02lvl1sec13"/>Our first game project</h1></div></div></div><p>Now we will <a class="indexterm" id="id34"/>get straight down to actually doing something with Android Studio. Run Android Studio by double-clicking on the Android Studio icon either on your desktop's start menu or in the folder where you installed it.</p><div><div><h3 class="title"><a id="note02"/>Note</h3><p>If you get any errors in a dialog box mentioning <strong>Privilege elevation</strong>, then try running Android Studio with administrator privileges. To do this, find the Android Studio icon by clicking on the Windows <strong>Start</strong> button and searching for <strong>Android Studio</strong>. Now right-click on the icon and click on <strong>Run as administrator</strong>. Do this every time you run Android Studio.</p></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec20"/>Preparing Android Studio</h2></div></div></div><p>So with<a class="indexterm" id="id35"/> Android Studio and Java installed, we just need to<a class="indexterm" id="id36"/> add the latest versions of the Android API that we will use to make our first game. Here is what to do to install the API:</p><div><ol class="orderedlist arabic"><li class="listitem">From the menu bar at the top of the Android Studio UI, navigate to <strong>Tools</strong> | <strong>Android</strong> | <strong>SDK Manager</strong>. Scroll down in the <strong>Android SDK Manager</strong> window and select the checkbox for <strong>Android 4.4.2 (API 19)</strong>.<div><div><h3 class="title"><a id="note03"/>Note</h3><p>Note that because Android is evolving so quickly, by the time you read this chapter, there might be APIs newer than 19—20, 21, and so on. If this is the case for you, select the newer (higher numbered) API instead.</p><div><img alt="Preparing Android Studio" src="img/8859OS_02_21.jpg"/></div></div></div></li><li class="listitem">Click on <strong>Install Packages</strong>.</li><li class="listitem">On the next screen, click on the <strong>Accept license</strong> checkbox and then click on the <strong>Install</strong> button. Android Studio will download and install the appropriate packages.</li></ol></div><p>What we just did was setting up Android Studio to make available the latest, prewritten code called an API that we will interact with throughout the book.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec21"/>Building the project</h2></div></div></div><div><ol class="orderedlist arabic"><li class="listitem">Click<a class="indexterm" id="id37"/> on <strong>New Project...</strong> as indicated in the following screenshot:<div><img alt="Building the project" src="img/8859OS_02_01.jpg"/></div></li><li class="listitem">The <strong>Create New Project</strong> configuration window will appear. Fill in the <strong>Application name</strong> field with <code class="literal">Math Game Chapter 2</code> and <strong>Company Domain</strong> with <code class="literal">packtpub.com</code> (or you could use your own company website name here), as shown in the following screenshot:<div><img alt="Building the project" src="img/8859OS_02_18.jpg"/></div></li><li class="listitem">Now <a class="indexterm" id="id38"/>click on the <strong>Next</strong> button. On the next screen, check that the <strong>Phone and Tablet</strong> checkbox has a tick in it. Now we have to choose the earliest version of Android we want to build our app for. Go ahead and play with a few options in the drop-down selector. You will see that the earlier the version we select, the greater is the percentage of devices our app can support. However, the trade-off here is that the earlier the version we select, the fewer are the cutting-edge Android features available in our apps. A good balance is to select <strong>API 8: Android 2.2 (Froyo)</strong>. Go ahead and do that now as shown in the next screenshot:<div><img alt="Building the project" src="img/8859OS_02_19.jpg"/></div></li><li class="listitem">Click <a class="indexterm" id="id39"/>on <strong>Next</strong>. Now select <strong>Blank Activity</strong> as shown in the next screenshot and click on <strong>Next</strong> again:<div><img alt="Building the project" src="img/8859OS_02_20.jpg"/></div></li><li class="listitem">On the<a class="indexterm" id="id40"/> next screen, simply change <strong>Activity Name</strong> to <code class="literal">MainActivity</code> and click on <strong>Finish</strong>.<div><div><h3 class="title"><a id="tip07"/>Tip</h3><p>By default, Android Studio shows a <strong>Tip of the day</strong> dialog every time it starts. Some of the tips might not make sense while you are still learning Java but many of them are really useful and reveal great shortcuts and other time savers. It is well worth taking a few seconds to read them when they show up. As already discussed, Android Studio is built from IntelliJ IDEA, and you can find a complete list of keyboard shortcuts at <a class="ulink" href="http://www.jetbrains.com/idea/webhelp/keyboard-shortcuts-you-cannot-miss.html">http://www.jetbrains.com/idea/webhelp/keyboard-shortcuts-you-cannot-miss.html</a>.</p></div></div></li><li class="listitem">Clear<a class="indexterm" id="id41"/> <strong>Tip of the day</strong> by clicking on <strong>Close</strong>.</li></ol></div><p>If you <a class="indexterm" id="id42"/>are completely new to programming, then the code, options, and files might seem a bit daunting. Don't worry; stick to them as we don't need to concern ourselves with most of them in order to learn Java. When the time does come to interact with the finer details, we will do things one step at a time.</p><p>It might be hard to believe that at this stage, but we have just created our first working app. We could build and run it on an Android device, and soon we will.</p><p>Let's take a deeper look at Android Studio before we progress with our game.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec14"/>Exploring Android Studio</h1></div></div></div><p>Android Studio is <a class="indexterm" id="id43"/>a very deep tool, but it is only necessary to learn one part at a time in order to get started. What might be useful for us is naming a few parts of the UI so that we can refer to them easily as we progress through the book.</p><p>Take a look at this numbered diagram and a quick explanation of some of the key parts of Android Studio. If you can, try and memorize the parts to make future discussions of them easier for you.</p><div><img alt="Exploring Android Studio" src="img/8859OS_02_04.jpg"/></div><p>Here is a<a class="indexterm" id="id44"/> handy table that you can quickly refer to and remember which part of Android Studio we are referring to. What follows is a more detailed explanation of each area.</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Number</p>
</th><th style="text-align: left" valign="bottom">
<p>Name</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>1</p>
</td><td style="text-align: left" valign="top">
<p>Project Explorer</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>2</p>
</td><td style="text-align: left" valign="top">
<p>The editor</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>3</p>
</td><td style="text-align: left" valign="top">
<p>Menu bar</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>4</p>
</td><td style="text-align: left" valign="top">
<p>Toolbar</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>5</p>
</td><td style="text-align: left" valign="top">
<p>Navigation bar</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>6</p>
</td><td style="text-align: left" valign="top">
<p>Important tool windows</p>
</td></tr></tbody></table></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Project Explorer</strong> (<strong>1</strong>): This is shown as <strong>1</strong> in the screenshot and is a bit like Windows Explorer. It shows us all the files and folders that have been generated<a class="indexterm" id="id45"/> for our project. We will do a number of things from here as the book continues. Actually, if you delve into the files and folders that Android Studio creates, the Project Explorer is not an exact mapping. It is slightly simplified and highlighted to make managing and exploring our project easier.</li><li class="listitem" style="list-style-type: disc"><strong>The Editor</strong> (<strong>2</strong>): As the name suggests, we will edit our Java code files here in the editor. However, as we will soon see, the <strong>Editor</strong> window changes depending <a class="indexterm" id="id46"/>on the type of file we are editing. We will also be viewing and editing UI designs here.</li><li class="listitem" style="list-style-type: disc"><strong>Menu bar</strong> (<strong>3</strong>): Like<a class="indexterm" id="id47"/> most programs, the <strong>Menu</strong> bar gives us access to the full functionality of Android Studio.</li><li class="listitem" style="list-style-type: disc"><strong>Tool bar</strong> (<strong>4</strong>): This contains lots of really useful one-click options to do things<a class="indexterm" id="id48"/> such as deploying and debugging our games. Hover the mouse cursor over an icon to get a pop-up tip and gain greater insight into each toolbar icon.</li><li class="listitem" style="list-style-type: disc"><strong>Navigation bar</strong> (<strong>5</strong>): Like a file path, this shows exactly where the file that is currently<a class="indexterm" id="id49"/> in the editor is located within the project.</li><li class="listitem" style="list-style-type: disc"><strong>Important tool windows</strong> (<strong>6</strong>): These are a number of tabs that can be popped up and <a class="indexterm" id="id50"/>popped down again by clicking on them. If you like, try some of them now to see how they work.</li></ul></div><p>Let's talk a bit more about the parts of the Android Studio UI and how the editor window can <a class="indexterm" id="id51"/>transform itself into a visual UI designer. After that, when we are familiar enough, we will look at building a simple menu screen for our math game.</p></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec15"/>Using the Android Studio visual designer</h1></div></div></div><p>The Android Studio editor window is a very dynamic area. It presents different file types in the most <a class="indexterm" id="id52"/>useful way possible. A little earlier, when we created our project, it also made a basic UI for us. UIs in Android can be built-in Java code or, as we will see, in a visual designer without the need for a single line of Java. However, as we will investigate after we have built the UI of our game menu, to get the UI to do anything useful, we need to interact with it. This interaction is always done with Java code. The visual designer also generates the UI code for us. We will take a very quick look at that too.</p><p>As the book progresses, we will mainly shy away from Android UI development, as that is a staple of more non-game apps. We will instead spend more time looking at directly drawing pixels and images to make our games. Nonetheless, the regular Android UI has its uses, and the Android Studio visual designer is the quickest way to get started.</p><p>Let's have a look at that now:</p><div><ol class="orderedlist arabic"><li class="listitem">In the Android Studio Project Explorer, double-click on the <code class="literal">layout</code> folder to reveal the <code class="literal">activity_main.xml</code> file within it. This should be easy to see unless you have collapsed the directories. If you can't see the <code class="literal">layout</code> folder, navigate to it using the Project Explorer. It can be found at <code class="literal">Math Game Chapter2/src/main/res/layout</code> via the Android Studio Project Explorer, as shown in the following screenshot:<div><img alt="Using the Android Studio visual designer" src="img/8859OS_02_05.jpg"/></div></li><li class="listitem">Now<a class="indexterm" id="id53"/> double-click on <strong>activity_main.xml</strong> to open it in the editor window. After a brief loading time, you will see something very similar to the next screenshot. The following screenshot shows the entire contents of what previously contained just our code. As you can see, what was just a text window now has multiple parts. Let's take a closer look at this screenshot:<div><img alt="Using the Android Studio visual designer" src="img/8859OS_02_06.jpg"/></div><p>In the preceding screenshot labeled (<strong>1</strong>), called <strong>Palette</strong>, you can choose from the available Android UI elements and simply click and drag them<a class="indexterm" id="id54"/> onto your UI design. Area (2) is the visual view of the UI you are building, where you will click and drag elements from the palette. To the right of the visual UI view, you will see the <strong>Component Tree</strong> area (3). The component tree allows you to examine the structure of the complex UI and select specific elements more easily. Under this tree is the <strong>Properties</strong> panel (4). Here you can adjust the properties of the currently selected UI element. These can be simple things such as color and size or much more advanced properties.</p><div><div><h3 class="title"><a id="note04"/>Note</h3><p>Note the tabs labelled (<strong>5</strong>). These tabs allow you to switch between the two main views that Android Studio provides for this type of layout file. These views, as you can see, are <strong>Design</strong> and <strong>Text</strong>. The design view is the default view and is shown in the previous screenshot. The text view also shows your under-construction UI, but it shows the code that has been autogenerated for us instead of the <strong>Palette</strong> element and the component tree.</p><p>We don't need to worry about this code as it is all handled for us. It can be good to look on this tab from time to time so that we can begin to understand what the design tool generates for us. But it is not necessary to do<a class="indexterm" id="id55"/> this to learn Java. This code is called <strong>eXtensible Markup Language</strong> (<strong>XML</strong>).</p></div></div></li><li class="listitem">Take a quick look at the <strong>Text</strong> tab, click on the <strong>Design</strong> tab when you're done, and we will move on.</li></ol></div><p>Now<a class="indexterm" id="id56"/> we have seen an overview of the visual designer and an even briefer glimpse of the automatically generated code that it generates for us. We can take a closer look at some of the actual UI elements that we will be using in our project.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec22"/>Android UI types</h2></div></div></div><p>We will <a class="indexterm" id="id57"/>now take a whirlwind tour of some really useful<a class="indexterm" id="id58"/> Android UI elements, a few key properties, and how to add them together to make a UI. These will introduce us to some of the possibilities as well as how to use them. We will then quickly use what we know to make our menu.</p><div><div><div><div><h3 class="title"><a id="ch02lvl3sec02"/>TextView</h3></div></div></div><p>On the <a class="indexterm" id="id59"/>visual UI area, click on the words <strong>Hello world!</strong>. What <a class="indexterm" id="id60"/>we have just selected is a widget known as a TextView. TextViews can be small text like this one or large heading type text, which might be useful in our game menu.</p><p>Let's try dragging and dropping another TextView onto our visual UI:</p><div><ol class="orderedlist arabic"><li class="listitem">Directly under the <strong>Widgets</strong> heading in our palette, you can see there are multiple types of TextView. They are presented in the palette as <strong>Plain TextView</strong>, <strong>Large Text</strong>, <strong>Medium Text</strong> and <strong>Small Text</strong>. Drag and drop a <strong>Large Text</strong> widget onto our visual design. Don't let go straightaway. As you drag it around the image of the phone, notice how Android Studio graphically shows you different positioning options. In the following screenshot, you can see what the designer looks like when the widget being dragged is positioned at the center:<div><img alt="TextView" src="img/8859OS_02_07.jpg"/></div></li><li class="listitem">Let go <a class="indexterm" id="id61"/>of the left mouse button where you want<a class="indexterm" id="id62"/> the widget to go. If you let go when it is positioned as shown in the previous screenshot, then the text will appear in the center as expected.</li><li class="listitem">Now we can play with the properties. In the <strong>Properties</strong> window, click just to the right of <strong>textSize</strong>. You might need to scroll to find it. Type <code class="literal">100sp</code> as the value and press the <em>Enter</em> key. Notice that the text gets much larger. We can refine the size of our text by increasing and decreasing the value entered here. The unit <code class="literal">sp</code> stands for scaled pixels, and is simply a measuring system that attempts to scale the text to an appropriate equivalent actual size across different screen densities.<div><img alt="TextView" src="img/8859OS_02_08.jpg"/></div></li><li class="listitem">Play<a class="indexterm" id="id63"/> with some more properties if you like and when<a class="indexterm" id="id64"/> you're done, click on the TextView we just created in the visual designer to highlight it. Then tap on the <em>Delete</em> key to get rid of it. Now delete the TextView that was present when we started—the one that says <strong>Hello world!</strong>.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec03"/>Layout elements</h3></div></div></div><p>Now <a class="indexterm" id="id65"/>you have an apparently empty screen. However, if you <a class="indexterm" id="id66"/>click anywhere on the design preview, you will see that we still have some options in the <strong>Properties</strong> window. This element is called a RelativeLayout. It is one of several layout element types provided as a base to control and align the layout widgets such as buttons, text, and so on. If you look at the top of the <strong>Palette</strong> window, you will see the main layout options. We will use this layout element when we actually build our game menu in a moment.</p></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec04"/>ImageView widgets</h3></div></div></div><p>ImageViews<a class="indexterm" id="id67"/> unsurprisingly are for displaying images. In the<a class="indexterm" id="id68"/> standard Android UI, this is a really quick way to add our designers' artwork to our game:</p><div><ol class="orderedlist arabic"><li class="listitem">Drag and drop an <strong>ImageView</strong> element onto the design in the same way as you positioned the TextView a moment ago. The <strong>ImageView</strong> element can be found below the <strong>Widgets</strong> heading. Now position it centrally as before or play with the options by dragging it around the design. We will delete it in a minute; we are just having a bit of an exploration before we do this for real.</li><li class="listitem">In the <strong>Properties</strong> window, select the <strong>src</strong> property in the same way as you selected the <strong>textSize</strong> property previously.</li><li class="listitem">Notice that after you select it, you have the option to click on <strong>...</strong> to give you more options. Click on <strong>...</strong> and scroll to the bottom of the list of options. These are all the image files that we can display in this ImageView. Just for fun, scroll to the bottom of the list, choose <strong>ic_launcher</strong>, and click on <strong>OK</strong>. We can make any image we like available and this is a simple, powerful way to build an attractive game menu screen.</li><li class="listitem">Change the <strong>layout:width</strong> property to <code class="literal">150dp</code> and the <strong>layout:height</strong> property to <code class="literal">150dp</code>. The unit <strong>dp</strong> is a way of sizing elements and widgets that remains relatively constant across devices with screens that have very different numbers of pixels.</li><li class="listitem">Delete the<a class="indexterm" id="id69"/> ImageView in exactly the same way<a class="indexterm" id="id70"/> as you deleted the other views previously.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec05"/>ButtonView</h3></div></div></div><p>The use <a class="indexterm" id="id71"/>of ButtonView is probably given away by its name. Try<a class="indexterm" id="id72"/> to click and drag a few buttons onto our layout. Notice that there are a few types of ButtonView, such as <strong>Small Button</strong>, <strong>Button</strong>, and, if you look further down the <strong>Widget</strong> list, <strong>ImageButton</strong>. We will be using the regular ButtonView, labelled simply as <strong>Button</strong>.</p><p>Now we will do something with each of these Android UI elements combined to make our game menu.</p><div><div><h3 class="title"><a id="note05"/>Note</h3><p>You can download the entire sample from the code download section of the book's companion website.</p></div></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec06"/>Using the sample code</h3></div></div></div><p>All of the code in this book is organized in projects. If a project spans more than one chapter, a <a class="indexterm" id="id73"/>project is provided for each chapter in its finished state. This helps you see the progression and not just the end result. All you need to do to open the project in Android Studio is explained as follows:</p><div><ol class="orderedlist arabic"><li class="listitem">Download the code for this book.</li><li class="listitem">In <strong>Android Studio</strong> from the menu bar, navigate to <strong>File</strong> | <strong>Close project</strong>.</li><li class="listitem">Now create a new blank project as we did previously. Browse to where you downloaded the code for this book.</li><li class="listitem">Navigate to the <code class="literal">Chapter2</code> folder. Here you will find the code for all the files we create in this chapter.</li><li class="listitem">Open the code files using a plain text editor such as the free Notepad++.</li><li class="listitem">Copy and paste in your Android Studio project or just compare the code as you see it.</li></ol></div><div><div><h3 class="title"><a id="tip08"/>Tip</h3><p>Although every line of code required in this book is supplied for your convenience, you still need to create each project for yourself through Android Studio. You can then simply copy and paste either the code in its<a class="indexterm" id="id74"/> entirety in the file with the matching name, or just the part of the code that you might be struggling with. Keep in mind that if you create a project with a different package name, then you must <em>omit</em> the line of code that is the package name from the supplied code files. The reasons for this will be clearer when we talk more about packages later in the chapter.</p></div></div><p>Let's actually see how to do it all for ourselves.</p></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec23"/>Making our game menu</h2></div></div></div><p>For now <a class="indexterm" id="id75"/>we will just make our game<a class="indexterm" id="id76"/> menu functional. Later in <a class="link" href="ch05.html" title="Chapter 5. Gaming and Java Essentials">Chapter 5</a>, <em>Gaming and Java Essentials</em>,we will see how we can make it look good by adding some cool animation to make the menu more visually interesting and fun.</p><p>Here is what we are aiming for in this tutorial:</p><div><img alt="Making our game menu" src="img/8859OS_02_10.jpg"/></div><p>Before <a class="indexterm" id="id77"/>you start coding, you should<a class="indexterm" id="id78"/> design your layouts on paper first. However, the Android Studio designer is so friendly there is a strong argument, especially for simple layouts, to refine your design actually in the layout designer. Perform the following steps to create the game menu:</p><div><ol class="orderedlist arabic"><li class="listitem">Delete all widgets from your designer by clicking on them one at a time and then tapping the <em>Delete</em> key on each in turn. Be careful not to delete the <strong>RelativeLayout</strong> layout element as we are going to use it as a base for all the other elements.</li><li class="listitem">Click and drag a <strong>Large Text</strong> element from the palette to the top center of the design area and give it the following properties. Remember that you can change properties in the <strong>Properties</strong> panel by clicking to the right of the property to be changed. Change the <strong>text</strong> property to <code class="literal">My Math Game</code> and <strong>size</strong> to <code class="literal">30sp</code>.</li><li class="listitem">Click and drag an <strong>ImageView</strong> element from the palette to the center of the design, slightly below the previous TextView. Change the <strong>layout:width</strong> property to <code class="literal">150dp</code> and the <strong>layout:height</strong> property to <code class="literal">150dp</code>.</li><li class="listitem">Now click and drag three buttons for <strong>Play</strong>, <strong>High Scores</strong> and <strong>Quit</strong>. Center them vertically, below the previous ImageView and one below the other, as per our design shown previously.</li><li class="listitem">Click<a class="indexterm" id="id79"/> on the top <a class="indexterm" id="id80"/>button, configure the <strong>text</strong> property, and enter the value <code class="literal">Play</code>.</li><li class="listitem">Click on the middle button, configure the <strong>text</strong> property, and enter the value <code class="literal">High Scores</code>.</li><li class="listitem">Click on the lowest button, configure the <strong>text</strong> property, and enter the value <code class="literal">Quit</code>.</li><li class="listitem">As the buttons now contain different amounts of text relative to each other, they will be of slightly different sizes. You can even them up to match the intended layout by clicking and dragging the edges of the smaller buttons to match the larger ones. This is done in mostly the same way as you might resize an application window in Windows.</li><li class="listitem">Save the project with <em>Ctrl</em> + <em>S</em> or by navigating to <strong>File</strong> | <strong>Save All</strong>.<div><div><h3 class="title"><a id="tip09"/>Tip</h3><p>If you are going to be testing your games on a much larger or much smaller screen than the Nexus 4 shown in the designer, then you might like to adjust the values of the <code class="literal">sp</code> and <code class="literal">dp</code> units used in this tutorial.</p><p>A full discussion of Android UI on multiple devices is beyond the scope of this book and is<a class="indexterm" id="id81"/> not necessary to make any of the games in this book. If you want to start designing for different screens right away, take a look at <a class="ulink" href="http://developer.android.com/training/multiscreen/index.html">http://developer.android.com/training/multiscreen/index.html</a>.</p></div></div></li></ol></div><p>You can view what your menu looks like on other devices simply by selecting the device from the drop-down menu shown in the following screenshot:</p><div><img alt="Making our game menu" src="img/8859OS_02_11.jpg"/></div><p>Before <a class="indexterm" id="id82"/>we make our menu come to<a class="indexterm" id="id83"/> life on an actual device, let's take a look at the structure of an Android app and how we can use that structure when writing our Java code.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Structuring our code for Android</h1></div></div></div><p>If you have ever used an Android device, you have probably noticed that it works quite differently <a class="indexterm" id="id84"/>from many other operating systems. For example, you are using an application—say you're checking what people are doing on Facebook. Then you get an e-mail notification and you tap the e-mail icon to read it. Midway through reading the e-mail, you might get a Twitter notification and because you're waiting on important news from someone you follow, you interrupt your e-mail reading and change the app to Twitter with a touch.</p><p>After reading the tweet, you fancy a game of Angry Birds, but midway through the first daring fling, you suddenly remember that Facebook post. So you quit Angry Birds and tap the Facebook icon.</p><p>Then you resume Facebook, probably at the same point you left it. You could have resumed reading the e-mail, decided to reply to the tweet, or started an entirely new app. All this<a class="indexterm" id="id85"/> backwards and forwards takes quite a lot of management on the part of the operating system, apparently independent from the individual apps themselves.</p><p>The difference between a Windows PC and Android in the context we have just discussed is that with Android, although the user decides which app they are using, the Android OS decides if and when to actually close down (destroy) an application. We just need to consider this when coding our games.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec24"/>Life cycle phases – what we need to know</h2></div></div></div><p>The <a class="indexterm" id="id86"/>Android system has different <strong>phases</strong> that any given app <a class="indexterm" id="id87"/>can be in. Depending on the phase, the Android system determines how the app is viewed by the user or whether it is viewed at all. Android has these phases so that it can decide which app is in current use and then allocate the right amount of resources such as memory and processing power. But also allow us as game developers to interact with these phases. What if someone quits our game to answer a phone call? Will they lose their progress?</p><p>Android has a fairly complex system that, when simplified a little for the purpose of explanation, ensures that every app on an Android device is in one of the following phases:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Being created</li><li class="listitem" style="list-style-type: disc">Starting</li><li class="listitem" style="list-style-type: disc">Resuming</li><li class="listitem" style="list-style-type: disc">Running</li><li class="listitem" style="list-style-type: disc">Pausing</li><li class="listitem" style="list-style-type: disc">Stopping</li><li class="listitem" style="list-style-type: disc">Being destroyed</li></ul></div><p>The list of phases will hopefully appear fairly logical. As an example, the user presses the Facebook <a class="indexterm" id="id88"/>app icon and the app is <strong>created</strong>. Then<a class="indexterm" id="id89"/> it is <em>started</em>. All are fairly straightforward <a class="indexterm" id="id90"/>so far but next in the list is <strong>resuming</strong>! It<a class="indexterm" id="id91"/> is not as illogical as it might first appear if, for a moment, we can just accept that the app resumes after it starts, and then all <a class="indexterm" id="id92"/>will become clear as we proceed.</p><p>After <strong>resuming,</strong> the app is <em>running</em>. This is when the Facebook app has control over the screen <a class="indexterm" id="id93"/>and probably the greater share of system <a class="indexterm" id="id94"/>memory and processing power. Now what about our example where we switched from the Facebook app to the e-mail app?</p><p>As we tap to go to read our e-mail, the Facebook app will probably have entered the <strong>paused</strong> phase, and the e-mail app will enter the <strong>being created</strong> phase followed by <strong>resuming</strong> and then <strong>running</strong>. If we decide to revisit Facebook, as in the scenario earlier, the Facebook app will probably then go straight to the <strong>resume</strong> phase and then <strong>running</strong> again, most likely exactly on the post where we left it.</p><p>Note<a class="indexterm" id="id95"/> that at any time, Android can decide to <em>stop</em> or <em>destroy</em> an<a class="indexterm" id="id96"/> app, in which case, when we run the app again, it will need to be <em>created</em> all over again. So had the Facebook app been inactive long enough or had Angry Birds required so many system resources that Android would have <em>destroyed</em> the Facebook app, then our experience of finding the exact post we were previously reading might have been different.</p><p>Now, if all this phase stuff is starting to get confusing, then you will be pleased to know that the only reasons to mention are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You know it exists</li><li class="listitem" style="list-style-type: disc">We occasionally need to interact with it</li><li class="listitem" style="list-style-type: disc">We will take things step by step when we do</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec25"/>Life cycle phases – what we need to do</h2></div></div></div><p>When we are making games, how do we possibly interact with this complexity? The good news is that the Android code that was autogenerated when we created our first project does <a class="indexterm" id="id97"/>most of the interaction for us.</p><p>All we have to do as game developers is make sure that Android knows what to do with our app in each phase when it happens. Even more good news is that all of these phases are handled by default, unless we override the default handling.</p><p>This means we can go ahead with learning Java and making games until we come to one of the few instances where we need to do something in our game, specifically in one of the phases.</p><div><div><div><div><h3 class="title"><a id="ch02lvl3sec07"/>Dividing our game into activities</h3></div></div></div><p>The Java <a class="indexterm" id="id98"/>code that we write will <a class="indexterm" id="id99"/>be divided into sections or parts called <strong>activities</strong>. We can think of activities as different screens for our game. For example, during the book, we will often create an activity for a home screen, an activity for the game screen and an activity for the high score screen.</p><p>Each activity will have its own life cycle and will be further divided into parts that will correspond to (go into) one of the Android phases we just discussed. The parts in Java are known as <a class="indexterm" id="id100"/>
<strong>methods</strong>. Methods are a significant concept in Java programming.</p><p>At this stage, however, all we need to know is that methods are used to compartmentalize the Java code we write and that some methods are provided by the Android system so that we can easily handle the otherwise complex Android life cycle.</p><p>The forthcoming list is a quick explanation of the methods provided by Android for our convenience, to manage the phases of the life cycle. To clarify our discussion of life cycle phases methods are listed next to their corresponding phases that we have been discussing. However, as you will see, the method names make it fairly clear on their own where they fit in.</p><p>In the list, there is also a brief explanation or suggestion about when we should use a given method and thereby interact during a specific phase. We will meet most of these methods as we progress through the book. We will see the <code class="literal">onCreate</code> method later in this chapter. Here is the list:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">onCreate</code>: This <a class="indexterm" id="id101"/>method is executed when the activity is<a class="indexterm" id="id102"/> being created. Here we get everything ready for the game, including graphics, sound, and perhaps the high scores.</li><li class="listitem" style="list-style-type: disc"><code class="literal">onStart</code>: This <a class="indexterm" id="id103"/>method is executed when the app is in the<a class="indexterm" id="id104"/> starting phase.</li><li class="listitem" style="list-style-type: disc"><code class="literal">onResume</code>: This<a class="indexterm" id="id105"/> method runs after <code class="literal">onStart</code> but can also be <a class="indexterm" id="id106"/>entered, perhaps most logically, after our activity is resumed after being previously paused. We might reload a previously saved game situation when the app had been interrupted, perhaps by a phone call or the user running another app.</li><li class="listitem" style="list-style-type: disc"><code class="literal">onPause</code>: This <a class="indexterm" id="id107"/>occurs when our app is pausing. Here we<a class="indexterm" id="id108"/> might want to save the current game. You are probably getting the hang of these methods.</li><li class="listitem" style="list-style-type: disc"><code class="literal">onStop</code>: This <a class="indexterm" id="id109"/>relates to the stopping phase. This is where we<a class="indexterm" id="id110"/> might undo everything we did in <code class="literal">onCreate</code>. If we reach here, our activity will probably get destroyed sometime soon.</li><li class="listitem" style="list-style-type: disc"><code class="literal">onDestroy</code>: This<a class="indexterm" id="id111"/> is when our activity is finally being <a class="indexterm" id="id112"/>destroyed—our last chance to dismantle our game. If we reach here, we will definitely be going through the phases of the life cycle from the beginning again.</li></ul></div><p>All the <a class="indexterm" id="id113"/>method descriptions <a class="indexterm" id="id114"/>and their related phases should appear straightforward. Perhaps, the only real question is about the running phase. As we will see, when we write our code in other methods/phases, the <code class="literal">onCreate</code>, <code class="literal">onStart</code>, and <code class="literal">onResume</code> methods will prepare the game, which persists, forming the running phase. The <code class="literal">onPause</code>, <code class="literal">onStop</code>, and <code class="literal">onDestroy</code> methods will occur afterwards. Now we can actually take a look at one of these methods and some other methods as well.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Our first look at Java</h1></div></div></div><p>So what about all that code that Android Studio generated when we created our new project earlier? This is the code that will bring our game menu to life. Let's take a closer look. The <a class="indexterm" id="id115"/>very first line of code in the editor window is this:</p><div><pre class="programlisting">package com.packtpub.mathgamechapter2;</pre></div><p>This line of code defines the package that we named when we first created the project. As the book progresses, we will write more complex code that spans more than one file. All the code files we create will need the package they belong to, clearly defined like the previous line of code, at the top. The code doesn't actually <em>do</em> anything in our game. Notice also that the line ends with a semicolon (<code class="literal">;</code>). This is a part of the Java syntax and it denotes the end of a line of code. Remove a semicolon and you will get an error because Android Studio tries to make sense of two lines together. Try it if you like.</p><div><div><h3 class="title"><a id="tip10"/>Tip</h3><p>Remember that if you are going to be copying and pasting the code from the download bundle, this is the one line of code that might vary depending on how you set up your project. If the package name in the code file is different from the package name you created, always use the package name from when you created the project.</p></div></div><p>To see the next four lines of code, you might need to click on the small <strong>+</strong> icon to reveal them. Android Studio tries to be helpful by simplifying our view of the code. Notice that there are several little <strong>-</strong> icons as well down the side of the editor window. You can expand and collapse them to suit yourself without affecting the functionality of the program. This is shown in the following screenshot:</p><div><img alt="Our first look at Java" src="img/8859OS_02_12.jpg"/></div><p>Once you have expanded the code, you will see these four lines:</p><div><pre class="programlisting">import android.support.v7.app.ActionBarActivity;
import android.os.Bundle;
import android.view.Menu;
import android.view.MenuItem; </pre></div><p>Notice that<a class="indexterm" id="id116"/> all the preceding lines start with the word <code class="literal">import</code>. This is an instruction to include other packages in our game, not just our own. This is very significant because it makes available to us all of the hard work of other programmers, the Android development team in this case. It is precisely these imports that give us the ability to use the methods we discussed earlier, and allow us to interact with the Android life cycle phases. Notice again that all the lines end with a semicolon (<code class="literal">;</code>).</p><p>The next line introduces a fundamental building block of Java known as a <strong>class</strong>. Classes are something that we will continually expand our knowledge and understanding of throughout the book. For now, take a look at this line of code, then we will discuss it in detail:</p><div><pre class="programlisting">public class MainActivity extends ActionBarActivity {</pre></div><p>Word by word, here is what is going on. The preceding line is saying: make me a new <code class="literal">public class</code> called <code class="literal">MainActivity</code> and base it upon (<code class="literal">extends</code>) <code class="literal">ActionBarActivity</code>.</p><p>You might remember that <code class="literal">MainActivity</code> is the name we chose while creating this project. <code class="literal">ActionBarActivity</code> is the code (known as a class) written by the Android development team that enables us to put our Java into Android.</p><p>If you have a keen eye, you might notice there is no semicolon at the end of this line. There is, however, an opening curly brace (<code class="literal">{</code>). This is because <code class="literal">MainActivity</code> encompasses the rest of the code. In effect, everything is part of our <code class="literal">MainActivity</code> class, which is built based on the <code class="literal">ActionBarActivity</code> class/code. If you scroll down to the bottom of the editor window, you will see a closing curly brace (<code class="literal">}</code>). This denotes the end of our class called <code class="literal">MainActivity</code>.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We do not need to know how a class works yet</li><li class="listitem" style="list-style-type: disc">We will use classes to access some methods contained within its code and without doing any more, we are already, by default, taking advantage of the Android life cycle methods we discussed earlier</li><li class="listitem" style="list-style-type: disc">We can now pick and choose if, when, and which methods defined in these classes we wish to override or leave as default</li></ul></div><p>So, it is<a class="indexterm" id="id117"/> the <code class="literal">ActionBarActivity</code> class that contains the methods that enable us to interact with the Android life cycle. Actually, there are a number of different classes that enable us to do this and in a moment, we will change from using <code class="literal">ActionBarActivity</code> to a more appropriate class that also does all the things just mentioned.</p><div><div><h3 class="title"><a id="tip11"/>Tip</h3><p>It is not important at this point to properly understand Java classes; just understand that you can import a package and a package can contain one or more classes that you can then use the functionality of or base your own Java programs on.</p><p>We will bump into classes regularly in the next few chapters. Think of them as programming black boxes that do stuff. In <a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work">Chapter 6</a>, <em>OOP – Using Other People's Hard Work</em>, we will open the black box and really get to grips with them and we will even start making our own classes.</p></div></div><p>Moving on with the code, let's look at what the code that is contained within our class actually does.</p><p>Here is the code chunk directly after the crucial line we have just been discussing:</p><div><pre class="programlisting">@Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
    }</pre></div><p>Hopefully, some of this code will start to make sense now and tie in with what we have already discussed. Although the precise syntax will still feel a little alien, we can continue learning Java as long as we are aware of what is happening.</p><p>The first thing we notice in the preceding code is the word <code class="literal">@override</code>. Remember when we said that all the methods that interact with the Android life cycle were implemented by default and we can pick and choose if and when to override them? This is what we are doing here with the <code class="literal">onCreate</code> method.</p><p>The <code class="literal">@override</code> word says that the method that follows next is being overridden. The <code class="literal">protected void onCreate(Bundle savedInstanceState) {</code> line contains the method we are overriding. You might be able to guess that the action starts with the opening <code class="literal">{</code> at the end of the line in question and ends with the closing <code class="literal">}</code> three lines later.</p><p>The somewhat odd-looking <code class="literal">protected void</code> before the method name <code class="literal">onCreate</code> and <code class="literal">(Bundle savedInstanceState)</code> after the method name are unimportant at this time because <a class="indexterm" id="id118"/>they are handled for us. It is to do with the data that travels between various parts of our program. We just need to know that what happens here will take place in the creating phase of the Android lifecycle. The rest will become clear in <a class="link" href="ch04.html" title="Chapter 4. Discovering Loops and Methods">Chapter 4</a>, <em>Discovering Loops and Methods</em>. Let's move on to the line:</p><div><pre class="programlisting">super.onCreate(savedInstanceState);</pre></div><p>Here, the <code class="literal">super</code> keyword is referencing the code in the original <code class="literal">onCreate</code> method, which is still there even though we can't see it. The code is saying: even though I am overriding you, I want you to set things up, just like you normally do first. Then, after <code class="literal">onCreate</code> has done loads of work that we don't see and don't need to see, the method continues and we actually get to do something ourselves with this line of code:</p><div><pre class="programlisting">setContentView(R.layout.activity_main);</pre></div><p>Here we are telling Android to set the main content view (our users screen), which is the cool game menu we created earlier. To be specific, we are stating it is an <code class="literal">R</code> or resource in the <code class="literal">layout</code> folder and the file is called <code class="literal">activity_main</code>.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec26"/>Cleaning up our code</h2></div></div></div><p>The next two blocks of code were created by Android Studio on the assumption that we would want to override another two methods. We don't, because they are methods more often <a class="indexterm" id="id119"/>used in non-gaming apps:</p><div><ol class="orderedlist arabic"><li class="listitem">Delete the entire content shown in the following code. Be careful not to delete the closing curly brace of our <code class="literal">MainActivity</code> class:<div><pre class="programlisting">@Override
    public boolean onCreateOptionsMenu(Menu menu) {
        
        // Inflate the menu; this adds items to the action bar if it is present.
        getMenuInflater().inflate(R.menu.main, menu);
        return true;
    }

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
        // Handle action bar item clicks here. The action bar will
        // automatically handle clicks on the Home/Up button, so long
        // as you specify a parent activity in AndroidManifest.xml.
        int id = item.getItemId();
        if (id == R.id.action_settings) {
            return true;
        }
        return super.onOptionsItemSelected(item);
    }</pre></div></li><li class="listitem">Now <a class="indexterm" id="id120"/>we can delete a couple of the <code class="literal">@import</code> statements. The reason for this is that we just deleted the overridden methods of classes (imported earlier) we no longer need. Notice that the following lines in the editor window are grey. Note that the program would still work if you leave them in. Delete them both now to make your code as clear as possible:<div><pre class="programlisting">import android.view.Menu;
import android.view.MenuItem;</pre></div></li><li class="listitem">Some final amendments before our code is done: at this point, you might be thinking that we have deleted and changed so much of our code that we might as well have started from an empty page and typed it in. This is almost true. But the process of having Android Studio create a new project for us and then making these amendments is more thorough and also avoids quite a few steps. Here are the last code changes. Change the <code class="literal">import android.support.v7.app.ActionBarActivity;</code> line to <code class="literal">import android.support.app.Activity;</code>.</li><li class="listitem">Now you will get several red lines underlining our code and indicating errors. This is because we are attempting to use a class we have not yet imported. Simply amend the <code class="literal">public class MainActivity extends ActionBarActivity {</code> line to <code class="literal">public class MainActivity extends Activity {</code>.</li></ol></div><p>What we did with those last two changes was using a slightly more appropriate version of the <code class="literal">Activity</code> class. To do this, we also had to change what we imported.</p><p>When you're done, your editor window should look exactly like this:</p><div><pre class="programlisting">package com.packtpub.mathgamechapter2.mathgamechapter2; 
import android.app.Activity; 
import android.os.Bundle; 
public class MainActivity extends Activity { 

    @Override 
    protected void onCreate(Bundle savedInstanceState) { 
        super.onCreate(savedInstanceState); 
        setContentView(R.layout.activity_main); 
    } 
}</pre></div><p>Now that <a class="indexterm" id="id121"/>we know what's going on and our code is clean and lean, we can actually take a look at the beginnings of our game in action!</p><div><div><h3 class="title"><a id="tip13"/>Tip</h3><p>If any of what we have just discussed seemed complicated, there is no need for concern. Android forces us to work within the Activity lifecycle, so the previous steps were unavoidable. Even if you didn't follow all the explanations about classes and methods and so on, you are still perfectly placed to learn Java from here. All the classes and methods will seem much more straightforward as the book progresses.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Building and installing our game</h1></div></div></div><p>Soon, we <a class="indexterm" id="id122"/>will actually see our menu in action. But before we do that, we <a class="indexterm" id="id123"/>need to find out how to use the Android emulators and how to build our game. Then we will put these together and put our game into an emulator or real device to see it as our players would.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec27"/>Emulators and devices</h2></div></div></div><p>Now we<a class="indexterm" id="id124"/> have the first part of our game ready to<a class="indexterm" id="id125"/> run. We need to test it to check for any errors, crashes, or anything else unintended. It is also important to ensure that it looks good and <a class="indexterm" id="id126"/>runs correctly on the device types/sizes and that you want to target.</p><div><div><h3 class="title"><a id="note06"/>Note</h3><p>We will not go into any details about handling different device types. All our games are fullscreen and we will later lock the orientation and dynamically calculate aspects such as screen resolution. So we can get away with writing for a single device type and focus on learning Java.</p><p>It might be useful to know for now that you can create a different layout file for any screen size categorization or pixel density. All you need to do is place the layout file using exactly the same filename in the appropriate folder. The Android device will then <em>know</em> the most appropriate layout for it to use. For a detailed discussion, see the Google developers <a class="indexterm" id="id127"/>website at <a class="ulink" href="http://developer.android.com/guide/practices/screens_support.html">http://developer.android.com/guide/practices/screens_support.html</a>.</p><p>Note that you do not need to understand any of the information at the preceding link to learn Java and publish your first games.</p></div></div><p>There <a class="indexterm" id="id128"/>are a few options to do this and we will look<a class="indexterm" id="id129"/> at two. First, we will use Android Studio and the Android Development Tools to make a device emulator so that we can use, test, and<a class="indexterm" id="id130"/> debug our games on a wide range of device emulators on the same PC/Mac we are developing on. So we don't need to own a device. This will allow us to get crash reports from our games.</p><p>Then we will install the game directly to a real device so that we can see exactly what the owner of that device will see when they download our app.</p><p>There are more options. For example, you can connect a real device via USB and debug directly on the device with the errors and syntactical feedback in Android Studio. The process for this might vary for different devices and since we won't be focusing on anything but basic debugging, we will not cover that in this book.</p><div><div><div><div><h3 class="title"><a id="ch02lvl3sec08"/>Creating an emulator</h3></div></div></div><p>Let's get<a class="indexterm" id="id131"/> our emulator up and emulating:</p><div><ol class="orderedlist arabic"><li class="listitem">On the right-hand side of the Android Studio quick launch bar, find the AVD manager icon:<div><img alt="Creating an emulator" src="img/8859OS_02_13.jpg"/></div></li><li class="listitem">Click on the icon to start the Android Virtual Device Manager. Then click on the <strong>Create Virtual Device...</strong> button on the bottom-left side to bring up the <strong>Virtual Device Configuration</strong> window.</li><li class="listitem">Now click on the <strong>Nexus 4</strong> option and then click on <strong>Next</strong>.</li><li class="listitem">Now we need to choose the version of Android we will use to build and test our games on. The latest version (at time of writing) is <strong>Lollipop - 21 - x86</strong>. It is the only option where we don't need to complete a download to continue. So select it (or whatever the default is at the time you are reading this) and then click on <strong>Next</strong> to continue.</li><li class="listitem">On the next screen we can leave all the default settings. So click on <strong>Finish</strong>.</li></ol></div><p>We now have a <a class="indexterm" id="id132"/>ready-to-run Android emulator.</p></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec09"/>Running the emulator</h3></div></div></div><p>Now we <a class="indexterm" id="id133"/>will launch (switch on) our virtual device then actually run our game that we made earlier by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Click on <strong>Nexus 4 API 21</strong> under the <strong>Name</strong> column. Now click on the triangular play icon to the right of the description of our emulator.<div><div><h3 class="title"><a id="note07"/>Note</h3><p>Android emulators take a long time to start. Even on a high-specification PC. Expect to wait at least a few minutes or even 10.</p></div></div></li><li class="listitem">Once it has started, unlock the device by clicking and dragging anywhere on the screen of the emulated device. This is analogous to swiping to unlock a real Nexus 4. Here is what our Nexus 4 virtual device looks like when it is running and unlocked:<div><img alt="Running the emulator" src="img/8859OS_02_16.jpg"/></div></li></ol></div><p>You can<a class="indexterm" id="id134"/> play with this emulator in almost the same way as you can a real Android device. However, you cannot download apps from Google Play. You might notice that the emulator is a bit slow compared to a real device, even compared to an old one. Shortly, we will look at running our apps on a real device.</p></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec10"/>Running our game on the emulator</h3></div></div></div><p>Once the<a class="indexterm" id="id135"/> emulator is running, it's usually best to leave it<a class="indexterm" id="id136"/> running so that each time we want to use it, we don't have to wait for it to start. Let's use the emulator:</p><div><ol class="orderedlist arabic"><li class="listitem">Launch the emulator if it is not already running and make sure the device is unlocked as described previously.</li><li class="listitem">Click on the run icon in the toolbar (shown next) to run your app. You can achieve the same thing by navigating to <strong>Run</strong> | <strong>Math Game Chapter 2</strong> from the menu bar:<div><img alt="Running our game on the emulator" src="img/8859OS_02_17.jpg"/></div></li><li class="listitem">After a pause while Android Studio builds our application, a pop-up dialog will ask you which device you want to run the app on. Choose the device with <strong>Nexus 4 API 21</strong> in the description. This is the already running device that we created earlier. Now press <strong>OK</strong>.</li><li class="listitem">Notice at this point that the useful Android window appears at the bottom section of Android Studio. In the unlikely event of you having any problems, just check for typos in the code. If things really don't work out, just go back to the <em>Using the sample code</em> section to compare with or copy and paste the supplied code.</li></ol></div><p>After <a class="indexterm" id="id137"/>another pause, our game menu screen will appear <a class="indexterm" id="id138"/>on the emulator. Of course, it doesn't do anything yet, but it is running and the buttons can be pressed.</p><p>When you're done, you can press the back or home icons to quit the application, just as you would on a real Android device.</p><p>Now we have seen one of the ways we can test our app by running it in the Android emulator. Let's find out how to make our code into an app we can distribute and use on a real device.</p></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec28"/>Building our game</h2></div></div></div><p>To run <a class="indexterm" id="id139"/>our game on a real Android device, we need to create a <code class="literal">.apk</code> file, that is, a file that ends with the extension <code class="literal">.apk</code>. A <code class="literal">.apk</code> file is a compressed archive of files and folders that the Android system uses to run and install our app. These are the steps to use Android Studio to make a <code class="literal">.apk</code> of our game:</p><div><ol class="orderedlist arabic"><li class="listitem">From the menu bar, navigate to <strong>Build</strong> | <strong>Generate Signed APK</strong>.</li><li class="listitem">A slightly verbose window will pop up and say: <strong>For Gradle-based projects, the signing configuration should be specified in the Gradle build scripts</strong>. You can safely dismiss this window by clicking on <strong>OK</strong>.</li><li class="listitem">Next up is the <strong>Generate Signed APK Wizard</strong> dialog. Here, we are creating a key that identifies the key holder as authorized to distribute the APK. At the end of this process, you will have a <code class="literal">.keys</code> file that you can use each time you build a <code class="literal">.apk</code> file. So this step can be missed out in future. Click on the <strong>Create new</strong> button.</li><li class="listitem">In the <strong>Key Store Path</strong> field, type or go to a location on your hard drive where you would like to store your key. You will then be prompted to choose a filename for the keystore. This is arbitrary. Type <code class="literal">MyKeystore</code> and click on <strong>OK</strong>.</li><li class="listitem">Type a password in the <strong>Password</strong> field and then retype it in the <strong>Confirm</strong> field. This is the password to a store that will help protect your key.</li><li class="listitem">Next, in the <strong>Alias</strong> field, type a memorable alias. You can think of this as a kind of username for your key. Again type a password in the <strong>Password</strong> field and then retype it in the <strong>Confirm</strong> field. This is the password to your key.</li><li class="listitem">Leave<a class="indexterm" id="id140"/> the <strong>Validity Years</strong> dropdown at the default of <strong>25</strong>.</li><li class="listitem">You can then fill out your Name and organization details (if any) and click on <strong>OK</strong>.</li><li class="listitem">Now our key and keystore are complete, and we can click on <strong>OK</strong> on the <strong>Generate Signed APK wizard</strong> dialog.</li><li class="listitem">We are then prompted to select <strong>Run Proguard</strong>. Encrypting and optimizing our <code class="literal">.apk</code> is unnecessary at this time. So just click on <strong>Finish</strong> to generate our app's <code class="literal">.apk</code> file.</li><li class="listitem">The generated <code class="literal">.apk</code> file will be put in the same directory that you chose to put the project files. For example, <code class="literal">MathGameChapter2/app</code>.</li></ol></div><p>We have now built a <code class="literal">.apk</code> file that can be run on any Android device that was specified when we first created the project.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec29"/>Installing the setup to a device</h2></div></div></div><p>So we have our <code class="literal">.apk</code> file and we know were to find it. Here is how we will run it on our Android<a class="indexterm" id="id141"/> device.</p><p>We can use one of a number of methods to get the <code class="literal">.apk</code> file into the device. The method I find one of the easiest is the use of a cloud storage service such as Dropbox. You can then simply click and drag the <code class="literal">.apk</code> file to your Dropbox folder and you're done. Alternatively, your Android device probably came with PC synchronization software that allows you to drag and drop files to and from your device. After you have placed the <code class="literal">.apk</code> file on your Android device, continue with the tutorial.</p><p>Most Android phones are set not to install apps from anywhere except the Google Play Store. So we need to change this. The exact menus you will navigate to might vary very slightly on your device but the following options tend to be almost the same on most devices, old <a class="indexterm" id="id142"/>and new:</p><div><ol class="orderedlist arabic"><li class="listitem">Find and tap the <strong>Settings</strong> app. Most Android phones also have a <strong>Settings</strong> menu option. Either will do. Now select <strong>Security</strong> and scroll down to the <strong>Unknown sources</strong> option. Tap the <strong>Unknown sources</strong> checkbox to allow apps to be installed from unknown sources.</li><li class="listitem">Locate the file on your Android device using the Dropbox app or your devices file browser depending on the method you chose to put the APK on your device. Tap the <code class="literal">MathGameChapter2.apk</code> file.</li><li class="listitem">You can now install the app just like any other. When prompted, press <strong>Install</strong> and then <strong>Open</strong>. The game will now be running on your device.</li></ol></div><p>Hold your device in a portrait orientation as this is how the UI was designed. Congratulations on running your very own Android app on your own device. In a later version of the math game, we will lock the orientation to make this more user friendly.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec30"/>Future projects</h2></div></div></div><p>Throughout the book, we will test and run our game projects. It is entirely up to you which of the methods we discussed you prefer. If you are getting crashes or unexplained bugs, then you will need to use an emulator. If all is working well, then the quickest and probably most pleasing way will be to run it on a device you own.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Self-test questions</h1></div></div></div><p>Q1) What should you do if all this talk of life cycles, classes, and methods is a bit bemusing?</p><p>Q2) What exactly is a Java class?</p><p>Q3) What is the difference between a method and a class?</p><p>Q4) Take a look at the Android developer site and its more technical explanation of the phases of the life cycle at <a class="ulink" href="http://developer.android.com/reference/android/app/Activity.html">http://developer.android.com/reference/android/app/Activity.html</a>. Can you see<a class="indexterm" id="id143"/> the phase and its related method that we haven't discussed? When would it be triggered in an app? What is the precise pathway an activity takes from creation to destruction?</p></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Summary</h1></div></div></div><p>We discussed that so far, it has not been not important to completely understand exactly how the code works. This is because it will act just as a container for the code we write in the rest of the book. However, as we cover in detail topics such as methods in <a class="link" href="ch04.html" title="Chapter 4. Discovering Loops and Methods">Chapter 4</a>, <em>Discovering Loops and Methods</em>, and classes in <a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work">Chapter 6</a>, <em>OOP – Using Other People's Hard Work</em>, we will begin to make sense of all of the code in our games.</p><p>We discussed the somewhat complex Android life cycle in detail. We learned that all we need to understand at this stage is that we must write our code within the correct methods that relate to different phases of the life cycle. Then we will have no trouble making good progress with learning Java. As with classes and methods, all will be explained along the way and become clearer with practice.</p><p>We also learned the key areas of the Android Studio UI. We built our start menu for our math game using the Android Studio designer. Furthermore, we created the Java code necessary to make the game appear on the player's device. This was achieved mainly by modifying the code that was automatically generated for us.</p><p>This was probably the most difficult chapter of the book because it was necessary to introduce a few things such as Java classes, Java methods, and the Android life cycle. We did this because we need to know what is going on around us as we learn Java.</p><p>From now on, however, we can take things a step at a time in a very logical manner. If you have reached this point, you will have no problem completing the toughest of the projects in this book.</p><p>If this chapter made your brain ache a little, rest assured that the fact that you have made it this far is a very good indication that you are going to be a Java ace someday soon. Starting from the basics, let's learn some Java now.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Speaking Java – Your First Game</h1></div></div></div><p>In this chapter, we will start writing our very own Java code at the same time as we begin understanding Java syntax. We will learn how to store, retrieve, and manipulate different types of values stored in the memory. We will also look at making decisions and branching the flow of our code based on the values of this data.</p><p>In this order, we will:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Learn some Java syntax and see how it is turned into a running app by the compiler</li><li class="listitem" style="list-style-type: disc">Store data and use it with variables</li><li class="listitem" style="list-style-type: disc">Learn how to express yourself in Java with expressions</li><li class="listitem" style="list-style-type: disc">Continue with the math game by asking a question</li><li class="listitem" style="list-style-type: disc">Learn about decisions in Java</li><li class="listitem" style="list-style-type: disc">Continue with the math game by getting and checking the answer</li></ul></div><p>Acquiring the preceding Java skills will enable us to build the next two phases of our math game. This game will be able to ask the player a question on multiplication, check the answer and give feedback based on the answer given, as shown in the following screenshot:</p><div><img alt="Speaking Java – Your First Game" src="img/8859OS_03_06.jpg"/></div><div><div><div><div><h1 class="title"><a id="ch03lvl1sec21"/>Java syntax</h1></div></div></div><p>Throughout this book, we will use plain English to discuss some fairly technical things. You will never be <a class="indexterm" id="id144"/>asked to read a technical explanation of a Java or Android concept that has not been previously explained in a non-technical way.</p><p>Occasionally, I might ask or imply that you accept a simplified explanation in order to offer a fuller explanation at a more appropriate time, like the Java class as a black box; however, you will never need to scurry to Google in order to get your head around a big word or a jargon-filled sentence.</p><p>Having said that, the Java and Android communities are full of people who speak in technical terms and to join in and learn from these communities, you need to understand the terms they use. So the approach this book takes is to learn a concept or appreciate an idea using an entirely plain speaking language, but at the same time, it introduces the jargon as part of the learning.</p><p>Then, much of the jargon will begin to reveal its usefulness, usually as a way of clarification or keeping the explanation/discussion from becoming longer than it needs to be.</p><p>The very term, "Java syntax," could be considered technical or jargon. So what is it? The Java syntax is the way we put together the language elements of Java in order to produce code that works in the Java/Dalvik virtual machine. Syntax should also be as clear as possible to a human reader, not least ourselves when we revisit our programs in the future. The Java syntax is a combination of the words we use and the formation of those words into sentence like structures.</p><p>These Java elements or words are many in number, but when taken in small chunks are almost certainly easier to learn than any human-spoken language. The reason for this is that the Java language and its syntax were specifically designed to be as straightforward as possible. We also have Android Studio on our side, which will often let us know if we make a mistake and will even sometimes think ahead and prompt us.</p><p>I am confident that if <a class="indexterm" id="id145"/>you can read, you can learn Java; because learning Java is very easy. What then separates someone who has finished an elementary Java course from an expert programmer? The same things that separate a student of language from a master poet. Mastery of the language comes through practice and further study.</p><p>In the last chapter, I will show you the right direction if you want to go on to master Java yourself.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec31"/>The compiler</h2></div></div></div><p>The compiler is what turns our human-readable Java code into another piece of code that can be run in a virtual <a class="indexterm" id="id146"/>machine. This is called <strong>compiling</strong>. The Dalvik virtual machine will run this compiled code when our players tap on our app icon. Besides compiling Java code, the compiler will also check for mistakes. Although we might still have mistakes in our released app, many are discovered when our code is compiled.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec32"/>Making code clear with comments</h2></div></div></div><p>As you become more <a class="indexterm" id="id147"/>advanced in writing Java programs, the solutions you use to create your programs will become longer and more complicated. Furthermore, as we will see in later chapters, Java was designed to manage complexity by having us divide our code into separate chunks, very often across multiple files.</p><p><strong>Comments</strong> are a part of the Java program that do not have any function in the program itself. The compiler ignores them. They serve to help the programmer to document, explain, and clarify their code to make it more understandable to themselves at a later date or to other programmers who might need to use or modify the code.</p><p>So, a good piece of code will be liberally sprinkled with lines like this:</p><div><pre class="programlisting">//this is a comment explaining what is going on</pre></div><p>The preceding <a class="indexterm" id="id148"/>comment begins with the two forward slash characters, <code class="literal">//</code>. The comment ends at the end of the line. It is known as a single-line comment. So anything on that line is for humans only, whereas anything on the next line (unless it's another comment) needs to be syntactically correct Java code:</p><div><pre class="programlisting">//I can write anything I like here
but this line will cause an error</pre></div><p>We can use multiple single-line comments:</p><div><pre class="programlisting">//Below is an important note
//I am an important note
//We can have as many single line comments like this as we like</pre></div><p>Single-line comments are also useful if we want to temporarily disable a line of code. We can put <code class="literal">//</code> in front of the code and it will not be included in the program. Recall this code, which tells Android to load our menu UI:</p><div><pre class="programlisting">//setContentView(R.layout.activity_main);</pre></div><p>In the preceding situation, the menu will not be loaded and the app will have a blank screen when run, as <a class="indexterm" id="id149"/>the entire line of code is ignored by the compiler. There is another type of comment in Java—the multiline comment. This is useful for longer comments and also to add things such as copyright information at the top of a code file. Also like the single-line comment, it can be used to temporarily disable code, in this case usually multiple lines.</p><p>Everything in between the leading <code class="literal">/*</code> signs and the ending <code class="literal">*/</code> signs is ignored by the compiler. Here are some examples:</p><div><pre class="programlisting">/*
This program was written by a Java expert
You can tell I am good at this because my
code has so many helpful comments in it.
*/</pre></div><p>There is no limit to the number of lines in a multiline comment. Which type of comment is best to use will depend upon the situation. In this book, I will always explain every line of code explicitly but you will often find liberally sprinkled comments within the code itself that add further explanation, insight or clarification. So it's always a good idea to read all of the code:</p><div><pre class="programlisting">/*
The winning lottery numbers for next Saturday are
9,7,12,34,29,22
But you still want to learn Java? Right?
*/</pre></div><div><div><h3 class="title"><a id="tip14"/>Tip</h3><p>All the best Java programmers liberally sprinkle their code with comments.</p></div></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec22"/>Storing data and using it with variables</h1></div></div></div><p>We can <a class="indexterm" id="id150"/>think of a variable as a labeled storage box. They are also like a programmer's window to the memory of the Android device, or whatever device we are <a class="indexterm" id="id151"/>programming. Variables can store data in memory (the storage box), ready to be recalled or altered when necessary by using the appropriate label.</p><p>Computer memory has a highly complex system of addressing that we, fortunately, do not need to interact with in Java. Java variables allow us to make up convenient names for all the data that we want our program to work with; the JVM will handle all the technicalities that interact with the operating system, which in turn, probably through several layers of buck passing, will interact with the hardware.</p><p>So we can think of our Android device's memory as a huge warehouse. When we assign names to our variables, they are stored in the warehouse, ready when we need them. When we use our variable's name, the device knows exactly what we are referring to. We can then tell it to do things such as "get box A and add it to box C, delete box B," and so on.</p><p>In a game, we will likely have a variable named as something along the lines of <code class="literal">score</code>. It would be this <code class="literal">score</code> variable that we use to manage anything related to the user's score, such as adding to it, subtracting or perhaps just showing it to the player.</p><p>Some of the following situations that might arise:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The player gets a question right, so add 10 to their existing <code class="literal">score</code></li><li class="listitem" style="list-style-type: disc">The player views their stats screen, so print <code class="literal">score</code> on the screen</li><li class="listitem" style="list-style-type: disc">The player gets the best score ever, so make <code class="literal">hiScore</code> the same as their current <code class="literal">score</code></li></ul></div><p>These are fairly arbitrary examples of names for variables and as long as you don't use any of the characters keywords that Java restricts, you can actually call your variables whatever you like. However, in practice, it is best to adopt a naming convention so that your variable names will be consistent. In this book, we will use a loose convention of variable names starting with a lowercase letter. When there is more than one word in the variable's name, the second word will begin with an uppercase letter. This is called "camel casing."</p><p>Here are some examples of camel casing:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">score</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">hiScore</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">playersPersonalBest</code></li></ul></div><p>Before we <a class="indexterm" id="id152"/>look at some real Java code with some variables, we need to first <a class="indexterm" id="id153"/>look at the types of variables we can create and use.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec33"/>Types of variables</h2></div></div></div><p>It is not hard <a class="indexterm" id="id154"/>to imagine that even a simple game will probably have quite a few variables. In the previous section, we introduced the <code class="literal">hiScore</code> variable as an example. What if the game has a high score table that remembers the names of the top 10 players? Then we might need variables for each player.</p><p>And what about the case when a game needs to know if a playable character is dead or alive, or perhaps has any lives/retries left? We might need code that tests for life and then ends the game with a nice blood spurt animation if the playable character is dead.</p><p>Another common requirement in a computer program, including games, is the right or wrong calculation: true or false.</p><p>To cover these and many other types of information you might want to keep track of, Java has <strong>types</strong>. There are many types of variables and, as we will see in<a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work"> Chapter 6</a>, <em>OOP – Using Other People's Hard Work</em>, we can also invent our own types or use other people's types. But for now, we will look at the built-in Java types. To be fair, they cover just about every situation we are likely to run into for a while. Some examples are the best way to explain this type of stuff.</p><p>We have already discussed the hypothetical but highly likely <code class="literal">score</code> variable. The variable <code class="literal">score</code> is likely to be a number, so we have to convey this (that the score is a number) to the Java compiler by giving the score an appropriate type. The hypothetical but equally likely <code class="literal">playerName</code> will, of course, hold the characters that make up the player's name. Jumping <a class="indexterm" id="id155"/>ahead a couple of paragraphs, the type that holds a regular number is called <code class="literal">int</code>, and the type that <a class="indexterm" id="id156"/>holds name-like data is called <code class="literal">String</code>. And if we try and store a player name, perhaps "Ada Lovelace" in <code class="literal">score</code>, which is meant for numbers, we will certainly run into trouble.</p><p>The compiler says no! Actually, the error would say this:</p><div><img alt="Types of variables" src="img/8859OS_03_05.jpg"/></div><p>As we can see, Java was designed to make it impossible for such errors to make it to a running program. Did you also spot in the previous screenshot that I had forgotten the semicolon at the end of the line? With this compiler identifying our errors, what could possibly go wrong?</p><p>Here are the main types in Java. Later, we will see how to start using them:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">int</code>: This type <a class="indexterm" id="id157"/>is used to store integers. It uses 32 pieces (<strong>bits</strong>) of memory and can therefore store values with a magnitude a little in excess of <a class="indexterm" id="id158"/>2 billion, including negative values.</li><li class="listitem" style="list-style-type: disc"><code class="literal">long</code>: As the <a class="indexterm" id="id159"/>name hints at, this data type can be used when even larger numbers are required. A <code class="literal">long</code> data type uses 64 bits of memory and 2 to the power of 63 is what we can store in this type. If you want to see <a class="indexterm" id="id160"/>what that looks like, try this: <code class="literal">9,223,372,036,854,775,807</code>. Perhaps surprisingly, there are uses for <code class="literal">long</code> variables but if a smaller variable will do, we should use it so that our program uses less memory.<div><div><h3 class="title"><a id="note08"/>Note</h3><p>You might be wondering when you might use numbers of this magnitude. The obvious examples would be math or science applications that do complex calculations but another use might be for timing. When you time how long something takes, the Java <code class="literal">Date</code> class uses the number of milliseconds since January 1, 1970. The <code class="literal">long</code> data type could be useful to subtract a start time from an end time to determine an elapsed time. We will use <code class="literal">long</code> in <a class="link" href="ch05.html" title="Chapter 5. Gaming and Java Essentials">Chapter 5</a>, <em>Gaming and Java Essentials</em>.</p></div></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">float</code>: This is for floating-point numbers, that is, numbers where there is precision beyond the decimal point. As the fractional part of a number takes memory <a class="indexterm" id="id161"/>space just as the whole number portion, the range of <a class="indexterm" id="id162"/>numbers possible in a float is therefore decreased compared to non-floating-point numbers. So, unless our variable will definitely use the extra precision, float would not be our data type of choice.</li><li class="listitem" style="list-style-type: disc"><code class="literal">double</code>: When the <a class="indexterm" id="id163"/>precision in <code class="literal">float</code> is not enough we <a class="indexterm" id="id164"/>have <code class="literal">double</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">short</code>: When <a class="indexterm" id="id165"/>even an <code class="literal">int</code> data type is overkill, the super-skinny <a class="indexterm" id="id166"/>short fits into the tiniest of storage boxes, but we can only store around 64,000 values, from -32,768 to 32,767.</li><li class="listitem" style="list-style-type: disc"><code class="literal">byte</code>: This is <a class="indexterm" id="id167"/>an even smaller storage box than a short type. There is <a class="indexterm" id="id168"/>plenty of room for these in memory but a byte can only store values from -128 to 127.</li><li class="listitem" style="list-style-type: disc"><code class="literal">boolean</code>: We will <a class="indexterm" id="id169"/>be using plenty of Booleans throughout the <a class="indexterm" id="id170"/>book. A Boolean variable can be either true or <a class="indexterm" id="id171"/>false—nothing else. Perhaps Booleans answer questions such as:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Is the player alive?</li><li class="listitem" style="list-style-type: disc">Has a new high score been reached?</li><li class="listitem" style="list-style-type: disc">Are two examples for a Boolean variable enough?</li></ul></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">char</code>: This <a class="indexterm" id="id172"/>stores a single alphanumeric character. It's not going to <a class="indexterm" id="id173"/>change anything on its own but it could be useful if we put lots of them together.<div><div><h3 class="title"><a id="tip15"/>Tip</h3><p>I have kept this discussion of data types to a practical level that is useful in the context of this book. If you are interested in how a data type's value is stored and why the limits are what they are, visit the Oracle Java tutorials site at <a class="ulink" href="http://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html">http://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html</a>. Note that you do not need any more information than we have already discussed to continue with this book.</p></div></div></li></ul></div><p>As we just learned, each type of data that we might want to store will require a specific amount of memory. So we must let the Java compiler know the type of the variable before we begin to use it.</p><p>The preceding <a class="indexterm" id="id174"/>variables are known as the <strong>primitive</strong> types. They <a class="indexterm" id="id175"/>use predefined amounts of memory and so, using our storage analogy, fit into predefined sizes of the storage box.</p><p>As the "primitive" label suggests, they are not as sophisticated as the reference types.</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec11"/>Reference types</h3></div></div></div><p>You might have <a class="indexterm" id="id176"/>noticed that we didn't cover the <code class="literal">String</code> variable type that we previously used to introduce the concept of variables.</p><p>Strings are a <a class="indexterm" id="id177"/>special type of variable known as a reference type. They quite simply refer to a place in memory where the storage of the variable begins, but the reference type itself does not define a specific amount of memory. The reason for this is fairly straightforward: we don't always know how much data will need to be stored until the program is actually run.</p><p>We can think of strings and other reference types as continually expanding and contracting storage boxes. So won't one of these <code class="literal">String</code> reference types bump into another variable eventually? If you think about the devices memory as a huge warehouse full of racks of labeled storage boxes, then you can think of the Dalvik virtual machine as a super-efficient forklift truck driver that puts the different types of storage boxes in the most appropriate place.</p><p>And if it becomes necessary, the virtual machine will quickly move stuff around in a fraction of a second to avoid collisions. It will even incinerate unwanted storage boxes when appropriate. This happens at the same time as constantly unloading new storage boxes of all types and placing them in the best place, for that type of variable. Dalvik tends to keep reference variables in a part of the warehouse that is different from the part for the primitive variables, and we will learn more details about this in <a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work">Chapter 6</a>, <em>OOP – Using Other People's Hard Work</em>.</p><p>So strings can be used to store any keyboard character, like a <code class="literal">char</code> data type but of almost any length. Anything from a player's name to an entire book can be stored in a single string. We will be using strings regularly including in this chapter.</p><p>There are a couple more reference types we will explore. Arrays are a way to store lots of variables of the same type, ready for quick and efficient access. We will look at arrays in <a class="link" href="ch05.html" title="Chapter 5. Gaming and Java Essentials">Chapter 5</a>, <em>Gaming and Java Essentials</em>.</p><p>Think of an array as an aisle in our warehouse with all the variables of a certain type lined up in a precise order. Arrays are reference types, so Dalvik keeps these in the same part of the warehouse as strings.</p><p>The other reference type is the mysterious object or class that we will look at in <a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work">Chapter 6</a>, <em>OOP – </em>
<em>Using Other People's Hard Work</em>.</p><p>So we know that each type of data that we might want to store will require an amount of memory. Hence, we <a class="indexterm" id="id178"/>must let the Java compiler know the type of the variable before we begin to use it.</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec12"/>Declaration</h3></div></div></div><p>That's enough <a class="indexterm" id="id179"/>of theory. Let's see how we would actually use our variables and types. Remember that each primitive type requires a specific amount of real <a class="indexterm" id="id180"/>device memory. This is one of the reasons that the compiler needs to know what type a variable will be of. So we must first <strong>declare</strong> a variable and its type before we attempt to do anything with it.</p><p>To declare a variable of type <code class="literal">int</code> with the name <code class="literal">score</code>, we would type:</p><div><pre class="programlisting">int score;</pre></div><p>That's it! Simply state the type, in this case <code class="literal">int</code>, then leave a space, and type the name you want to use for this variable. Also note the semicolon on the end of the line as usual to show the compiler that we are done with this line and what follows, if anything, is not part of the declaration.</p><p>For almost all the other variable types, declaration would occur in the same way. Here are some examples. The variable names are arbitrary. This is like reserving a labeled storage box in the warehouse:</p><div><pre class="programlisting">long millisecondsElapsed;
float gravity;
double accurateGravity;
boolean isAlive;
char playerInitial;
String playerName;</pre></div></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec13"/>Initialization</h3></div></div></div><p>Here, for each <a class="indexterm" id="id181"/>type, we initialize a value to the variable. Think about <a class="indexterm" id="id182"/>placing a value inside the storage box, as shown in the following code:</p><div><pre class="programlisting">score = 0;
millisecondsElapsed = 1406879842000;//1st Aug 2014 08:57:22
gravity = 1.256;
accurateGravity =1.256098;
isAlive = true;
playerInitial = 'C';
playerName = "Charles Babbage";</pre></div><p>Notice that the <code class="literal">char</code> variable uses single quotes (<code class="literal">'</code>) around the initialized value while the <code class="literal">String</code> uses double quotes (<code class="literal">"</code>).</p><p>We can also combine the declaration and initialization steps. In the following snippet of code, we declare <a class="indexterm" id="id183"/>and initialize the same variables as we did previously, but <a class="indexterm" id="id184"/>in one step each:</p><div><pre class="programlisting">int score = 0;
long millisecondsElapsed = 1406879842000;//1st Aug 2014 08:57:22
float gravity = 1.256;
double accurateGravity =1.256098;
boolean isAlive = true;
char playerInitial = 'C';
String playerName = "Charles Babbage";</pre></div><div><div><h3 class="title"><a id="note09"/>Note</h3><p>Whether we declare and initialize separately or together is probably dependent upon the specific situation. The important thing is that we must do both:</p><div><pre class="programlisting">int a;
//The line below attempts to output a to the console
Log.i("info", "int a = " + a);</pre></div><p>The preceding code would cause the following result:</p><div><pre class="programlisting">
<strong>Compiler Error: Variable a might not have been initialized</strong>
</pre></div><p>There is a significant exception to this rule. Under certain circumstances variables can have <strong>default values</strong>. We will see this in <a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work">Chapter 6</a>, <em>OOP – Using Other People's Hard Work</em>. But it is good practice to both declare and initialize variables.</p></div></div><div><div><div><div><h4 class="title"><a id="ch03lvl4sec01"/>Changing variables with operators</h4></div></div></div><p>Of course, in <a class="indexterm" id="id185"/>almost any program, we are going to need to do something with these values. Here is a list of perhaps the most common Java <a class="indexterm" id="id186"/>operators that allow us to manipulate variables. You do not need to memorize them as we will look at every line of code when we use them for the first time:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>The assignment operator (=)</strong>: This makes the variable to the left of the operator <a class="indexterm" id="id187"/>the same as the value to the right. For example, <code class="literal">hiScore = score;</code> or <code class="literal">score = 100;</code>.</li><li class="listitem" style="list-style-type: disc"><strong>The addition operator (+)</strong>: This adds the values on either side of the operator. It <a class="indexterm" id="id188"/>is usually used in conjunction with the assignment operator, such as <code class="literal">score = aliensShot + wavesCleared;</code> or <code class="literal">score = score + 100;</code>. Notice that it is perfectly acceptable to use the same <a class="indexterm" id="id189"/>variable simultaneously on both sides of an operator.</li><li class="listitem" style="list-style-type: disc"><strong>The subtraction operator (-)</strong>: This subtracts the value on the right side of the <a class="indexterm" id="id190"/>operator from the value on the left. It is usually used in conjunction with the assignment operator, such as <code class="literal">lives = lives - 1;</code> or <code class="literal">balance = income - outgoings;</code>.</li><li class="listitem" style="list-style-type: disc"><strong>The division operator (/)</strong>: This divides the number on the left by the number on the <a class="indexterm" id="id191"/>right. Again, it is usually used in conjunction with the assignment operator, as shown in <code class="literal">fairShare = numSweets / numChildren;</code> or <code class="literal">recycledValueOfBlock = originalValue / .9;</code>.</li><li class="listitem" style="list-style-type: disc"><strong>The multiplication operator (*)</strong>: This multiplies variables and numbers, such <a class="indexterm" id="id192"/>as <code class="literal">answer = 10 * 10;</code> or <code class="literal">biggerAnswer = 10 * 10 * 10;</code>.</li><li class="listitem" style="list-style-type: disc"><strong>The increment operator (++)</strong>: This is a really neat way to add <code class="literal">1</code> to the value of a <a class="indexterm" id="id193"/>variable. The <code class="literal">myVariable = myVariable + 1; </code>statement is the same as <code class="literal">myVariable++;</code>.</li><li class="listitem" style="list-style-type: disc"><strong>The decrement operator (--)</strong>: You guessed it: a really neat way to subtract <code class="literal">1</code> from <a class="indexterm" id="id194"/>something. The <code class="literal">myVariable = myVariable -1;</code> statement is the same as <code class="literal">myVariable--;</code>.</li></ul></div><div><div><h3 class="title"><a id="note12"/>Note</h3><p>The formal names for these operators are slightly different from the names used here for explanation. For example, the division operator is actually one of the multiplicative operators. But the preceding names are far more useful for the purpose of learning Java and if you used the term "division operator", while conversing with someone from the Java community, they would know exactly what you mean.</p></div></div><p>There are <a class="indexterm" id="id195"/>actually many more operators than these in Java. We <a class="indexterm" id="id196"/>will see a whole bunch later in this chapter when we learn about decisions in Java.</p><div><div><h3 class="title"><a id="tip16"/>Tip</h3><p>If you are curious about operators there is a complete list of them on the Java website at <a class="ulink" href="http://docs.oracle.com/javase/tutorial/java/nutsandbolts/operators.html">http://docs.oracle.com/javase/tutorial/java/nutsandbolts/operators.html</a>. All the operators required to complete the projects in this book will be fully explained in this book. The link is provided for the curious among us.</p></div></div></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Expressing yourself in Java</h1></div></div></div><p>Let's try <a class="indexterm" id="id197"/>using some declarations, assignments and operators. When we bundle these elements together into some meaningful syntax, we call it an expression. So let's write a quick app to try some out.</p><p>Here we will make a little side project so we can play with everything we have learned so far. We will need to create a new project, just as we did in the previous chapter but we will not need a UI this time.</p><p>Instead, we will simply write some Java code and examine its effects by outputting the values of variables to <a class="indexterm" id="id198"/>the Android console, called <strong>logcat</strong>. We will see exactly how this works by building the simple project and examining the code and the console output:</p><div><div><h3 class="title"><a id="tip17"/>Tip</h3><p>The following is a quick reminder of how to create a new project.</p></div></div><div><ol class="orderedlist arabic"><li class="listitem">Close any currently open projects by navigating to <strong>File</strong> | <strong>Close Project</strong>.</li><li class="listitem">Click on <strong>Start a</strong> <strong>new Android Studio project</strong>.</li><li class="listitem">The <strong>Create New Project</strong> configuration window will appear. Fill in the <strong>Application name</strong> field and <strong>Company Domain</strong> with <code class="literal">packtpub.com</code> or you could use your own company website name here instead.</li><li class="listitem">Now click on the <strong>Next</strong> button. On the next screen, make sure the <strong>Phone and Tablet</strong> checkbox has a tick in it. Now we have to choose the earliest version of Android we want to build our app for. Go ahead and play with a few options in the drop-down selector. You will see that the earlier the version we select, the greater is the percentage of devices our app can support. However, the trade-off here is that the earlier the version we select fewer cutting-edge Android features will be available in our apps. A good balance is to select <strong>API 8: Android 2.2 (Froyo)</strong>.</li><li class="listitem">Click on <strong>Next</strong>. Now select <strong>Blank Activity</strong> and click on <strong>Next</strong> again.</li><li class="listitem">On the next screen, simply change <strong>Activity Name</strong> to <code class="literal">MainActivity</code> and click on <strong>Finish</strong>.</li><li class="listitem">As we did in <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>, to keep our code clear and simple, you can delete the two unneeded methods (<code class="literal">onCreateOptionsMenu</code> and <code class="literal">onOptionsItemSelected</code>) and their associated <code class="literal">@override</code> and <code class="literal">@import</code> statements. However, this is not necessary for the example to work.</li></ol></div><div><div><h3 class="title"><a id="tip18"/>Tip</h3><p>For a detailed explanation and images of creating a new project, see <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>.</p></div></div><p>As with all the examples and projects in this book, you can copy or review the code from the download bundle. You will find the code for this tutorial in the <code class="literal">Chapter3/ExpressionsInJava/MainActivity.java</code> file. Just create the project as described previously and paste the code from <code class="literal">MainActivity.java</code> file from the download bundle to the <code class="literal">MainActivity.java</code> file that was generated when you created the project in Android Studio. Just ensure that the package name is the same as the one you chose when the project was created. However, I strongly recommend going along with the tutorial so that we can <a class="indexterm" id="id199"/>learn how to do everything for ourselves.</p><div><div><h3 class="title"><a id="note13"/>Note</h3><p>As this app uses the logcat console to show its output, you should run this app on the emulator only and not on a real Android device. The app will not harm a real device, but you just won't be able to see anything happening.</p></div></div><div><ol class="orderedlist arabic"><li class="listitem">Create a new blank project called <code class="literal">Expressions In Java</code>.</li><li class="listitem">Now, in the <code class="literal">onCreate</code> method just after the line where we use the <code class="literal">setContentView</code> method, add this code to declare and initialize some variables:<div><pre class="programlisting">//first we declare and initialize a few variables
int a = 10;
String b = "Alan Turing";
boolean c = true;</pre></div></li><li class="listitem">Now add the following code. This code simply outputs the value of our variables in a form where we can closely examine them in a minute:<div><pre class="programlisting">//Let's look at how Android 'sees' these variables
//by outputting them, one at a time to the console
Log.i("info", "a = " + a);
Log.i("info", "b = " + b);
Log.i("info", "c = " + c);</pre></div></li><li class="listitem">Now let's change our variables using the addition operator and another new operator. See if you can work out the output values for variables <code class="literal">a</code>, <code class="literal">b</code>, and <code class="literal">c</code> before looking at the output and the code explanation:<div><pre class="programlisting">//Now let's make some changes
a++;
a = a + 10;
b = b + " was smarter than the average bear Booboo";
b = b + a;
c = (1 + 1 == 3);//1 + 1 is definitely 2! So false.</pre></div></li><li class="listitem">Let's output the values once more in the same way we did in step 3, but this time, the output should be different:<div><pre class="programlisting">//Now to output them all again
Log.i("info", "a = " + a);
Log.i("info", "b = " + b);
Log.i("info", "c = " + c);</pre></div></li><li class="listitem">Run the program on an emulator in the usual way. You can see the output by clicking on the <strong>Android</strong> tab from our "useful tabs" area below the Project Explorer.</li></ol></div><p>Here is the <a class="indexterm" id="id200"/>output, with some of the unnecessary formatting stripped off:</p><div><pre class="programlisting">
<strong>info﹕ a = 10</strong>
<strong>info﹕ b = Alan Turing</strong>
<strong>info﹕ c = true</strong>
<strong>info﹕ a = 21</strong>
<strong>info﹕ b = Alan Turing was smarter than the average bear Booboo21</strong>
<strong>info﹕ c = false</strong>
</pre></div><p>Now let's discuss what happened. In step 2, we declared and initialized three variables:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">a</code>: This is an int that holds the value 10</li><li class="listitem" style="list-style-type: disc"><code class="literal">b</code>: This is a string that holds the name of an eminent computer scientist.</li><li class="listitem" style="list-style-type: disc"><code class="literal">c</code>: This is a Boolean that holds the value false</li></ul></div><p>So when we output the values in step 3, it should be no surprise that we get the following:</p><div><pre class="programlisting">
<strong>info﹕ a = 10</strong>
<strong>info﹕ b = Alan Turing</strong>
<strong>info﹕ c = true</strong>
</pre></div><p>In step 4, all the fun stuff happens. We add 1 to the value of our int <code class="literal">a</code> using the increment operator like this: <code class="literal">a++;</code>. Remember that <code class="literal">a++</code> is the same as <code class="literal">a = a + 1</code>.</p><p>We then add 10 to <code class="literal">a</code>. Note we are adding 10 to <code class="literal">a</code> after having already added 1. So we get this output for a 10 + 1 + 10 operation:</p><div><pre class="programlisting">
<strong>info﹕ a = 21</strong>
</pre></div><p>Now let's examine our string, <code class="literal">b</code>. We appear to be using the addition operator on our eminent scientist. What is happening is what you could probably guess. We are adding together two strings <code class="literal">"Alan Turing"</code> and <code class="literal">"was smarter than the average bear Booboo."</code> When you add two strings together it is called <strong>concatenating</strong> and the <code class="literal">+</code> symbol doubles as the concatenation operator.</p><p>Finally, for <a class="indexterm" id="id201"/>our string, we appear to be adding <code class="literal">int a</code> to it. This is allowed and the value of <code class="literal">a</code> is concatenated to the end of <code class="literal">b</code>.</p><div><pre class="programlisting">
<strong>info﹕ b = Alan Turing was smarter than the average bear Booboo21</strong>
</pre></div><div><div><h3 class="title"><a id="note14"/>Note</h3><p>This does not work the other way round; you cannot add a string to an <code class="literal">int</code>. This makes sense as there is no logical answer.</p><p><code class="literal">a = a + b</code></p><div><img alt="Expressing yourself in Java" src="img/8859OS_03_07.jpg"/></div></div></div><p>Finally, let's look at the code that changes our Boolean, <code class="literal">c</code>, from true to false: <code class="literal">c = (1+1=3);</code>. Here, we are assigning to <code class="literal">c</code> the value of the expression contained within the brackets. This would be straightforward, but why the double equals (<code class="literal">==</code>)? We have jumped ahead of ourselves a little. The double equals sign is another operator called the <strong>comparison</strong> <a class="indexterm" id="id202"/>operator.</p><p>So we are really asking, <em>does</em> 1+1 equal 3? Clearly the answer is false. You might ask, "why use <code class="literal">==</code> instead of <code class="literal">=</code>?" Simply to make it clear to the compiler when we mean to assign and when we mean to compare.</p><div><div><h3 class="title"><a id="tip19"/>Tip</h3><p>Inadvertently using <code class="literal">=</code> instead of <code class="literal">==</code> is a very common error.</p><p>The assignment operator (<code class="literal">=</code>) assigns the value on the right to the value on the left, while the comparison operator (<code class="literal">==</code>) compares the values on either side.</p><p>The compiler will warn us with an error when we do this but at first glance you might swear the compiler is wrong. We will learn more on this comparison operator and others later in the chapter and throughout the book.</p></div></div><p>Now let's use <a class="indexterm" id="id203"/>everything we know and a bit more to make our math game project.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Math game – asking a question</h1></div></div></div><p>Now that we have <a class="indexterm" id="id204"/>all that knowledge under our belts, we can use it to improve our math game. First, we will create a new Android activity to be the actual game screen as opposed to the start menu screen. We will then use the UI designer to lay out a simple game screen so that we can use our Java skills with variables, types, declaration, initialization, operators, and expressions to make our math game generate a question for the player. We can then link the start menu and game screens together with a push button.</p><p>If you want to save typing and just review the finished project, you can use the code downloaded from the Packt Publishing website. If you have any trouble getting any of the code to work, you can review, compare, or copy and paste the code from the already completed code provided in the download bundle.</p><p>The completed code is in the following files that correspond to the filenames we will be using in this tutorial:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Chapter3/MathGameChapter3a/java/MainActivity.java</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Chapter3/MathGameChapter3a/java/GameActivity.java</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Chapter3/MathGameChapter3a/layout/activity_main.xml</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Chapter3/MathGameChapter3a/layout/activity_game.xml</code></li></ul></div><p>As usual, I recommend following this tutorial to see how we can create all of the code for ourselves.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec34"/>Creating the new game activity</h2></div></div></div><p>We will first <a class="indexterm" id="id205"/>need to create a new Java file for the game activity code and a related layout file to hold the game activity UI.</p><div><ol class="orderedlist arabic"><li class="listitem">Run Android Studio and select your <code class="literal">Math Game Chapter 2</code> project that we built in <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>. It might have been opened by default. Now we will create the new Android activity that will contain the actual game screen, which will run when the player taps the <strong>Play</strong> button on our main menu screen.</li><li class="listitem">To create a new activity, we now need another layout file and another Java file. Fortunately Android Studio will help us do this. To get started with creating all the files we need for a new activity, right-click on the <code class="literal">src</code> folder in the Project Explorer and then go to <strong>New</strong> | <strong>Activity</strong>. Now click on <strong>Blank Activity</strong> and then on <strong>Next</strong>.</li><li class="listitem">We now need to tell Android Studio a little bit about our new activity by entering information in the above dialog box. Change the <strong>Activity Name</strong> field to <code class="literal">GameActivity</code>. Notice how the <strong>Layout Name</strong> field is automatically changed for us to <code class="literal">activity_game</code> and the <strong>Title</strong> field is automatically changed to <code class="literal">GameActivity</code>.</li><li class="listitem">Click on <strong>Finish</strong>. Android Studio has created two files for us and has also registered our new activity in a manifest file, so we don't need to concern ourselves with it.</li><li class="listitem">If you <a class="indexterm" id="id206"/>look at the tabs at the top of the editor window, you will see that <code class="literal">GameActivity.java</code> has been opened up ready for us to edit, as shown in the following screenshot:<div><img alt="Creating the new game activity" src="img/8859OS_03_02.jpg"/></div></li><li class="listitem">Ensure that <code class="literal">GameActivity.java</code> is active in the editor window by clicking on the <strong>GameActivity.java</strong> tab shown previously.</li><li class="listitem">Back in <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>, we talked about how Android overrides some methods for us by default, and that most of them were not necessary. Here again, we can see the code that is unnecessary. If we remove it, then it will make our working environment simpler and cleaner. You might also remember from <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>, that the process of deleting and amending sections of code, although not complex, is a fairly long process. To avoid this here, we will simply use the code from <code class="literal">MainActivity.java</code> as a template for <code class="literal">GameActivity.java</code>. We can then make some minor changes.</li><li class="listitem">Click on the <strong>MainActivity.java</strong> tab in the editor window. Highlight all of the code in the editor window using <em>Ctrl</em> + <em>A</em> on the keyboard.</li><li class="listitem">Now copy all of the code in the editor window using the <em>Ctrl</em> + <em>C</em> on the keyboard.</li><li class="listitem">Now click on the <strong>GameActivity.java</strong> tab.</li><li class="listitem">Highlight all of the code in the editor window using <em>Ctrl</em> + <em>A</em> on the keyboard.</li><li class="listitem">Now paste the copied code and overwrite the currently highlighted code using <em>Ctrl</em> + <em>V</em> on the keyboard.</li><li class="listitem">Notice that there is an error in our code denoted by the red underlining as shown in the following screenshot. This is because we pasted the code referring <a class="indexterm" id="id207"/>to <code class="literal">MainActivity</code> in our file that is called <code class="literal">GameActivity</code>.<div><img alt="Creating the new game activity" src="img/8859OS_03_03.jpg"/></div><p>Simply change the text <strong>MainActivity</strong> to <strong>GameActivity</strong> and the error will disappear. Take a moment to see if you can work out what other minor change is necessary, before I tell you.</p></li><li class="listitem">Remember that <code class="literal">setContentView</code> loads our UI design. Well what we need to do is change <code class="literal">setContentView</code> to load the new design (that we will build next) instead of the home screen design. Change <code class="literal">setContentView(R.layout.activity_main);</code> to <code class="literal">setContentView(R.layout.activity_game);</code>.</li><li class="listitem">Save your work and we are ready to move on.</li></ol></div><p>Note the Project Explorer where Android Studio puts the two new files it created for us. I have highlighted two folders in the next screenshot. In future, I will simply refer to them as our <code class="literal">java</code> code folder or <code class="literal">layout</code> files folder.</p><div><img alt="Creating the new game activity" src="img/8859OS_03_04.jpg"/></div><div><div><h3 class="title"><a id="note15"/>Note</h3><p>You might wonder why we didn't simply copy and paste the <code class="literal">MainActivity.java</code> file to begin with and saved going through the process of creating a new activity? The reason is that Android Studio does things behind the scenes. Firstly, it makes the layout template for us. It also registers the new activity for use through a file we will see later, called <code class="literal">AndroidManifest.xml</code>. This is necessary for the new activity to be able to work in the first place. All things considered, the way we did it is probably the quickest.</p></div></div><p>The code at <a class="indexterm" id="id208"/>this stage is exactly the same as the code for the home menu screen. We state the package name and import some useful classes provided by Android:</p><div><pre class="programlisting">package com.packtpub.mathgamechapter3a.mathgamechapter3a;

import android.app.Activity;
import android.os.Bundle;</pre></div><p>We create a new activity, this time called <code class="literal">GameActivity</code>:</p><div><pre class="programlisting">public class GameActivity extends Activity {</pre></div><p>Then we override the <code class="literal">onCreate</code> method and use the <code class="literal">setContentView</code> method to set our UI design as the contents of the player's screen. Currently, however, this UI is empty:</p><div><pre class="programlisting">super.onCreate(savedInstanceState);
setContentView(R.layout.activity_game);</pre></div><p>We can now <a class="indexterm" id="id209"/>think about the layout of our actual game screen.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec35"/>Laying out the game screen UI</h2></div></div></div><p>As we <a class="indexterm" id="id210"/>know, our math game will ask questions and offer the player some multiple choices to choose answers from. There are lots of extra features we could add, such as difficulty levels, high scores, and much more. But for now, let's just stick to asking a simple, predefined question and offering a choice of three predefined possible answers.</p><p>Keeping the UI design to the bare minimum suggests a layout. Our target UI will look somewhat like this:</p><div><img alt="Laying out the game screen UI" src="img/8859OS_03_10.jpg"/></div><p>The layout is hopefully self-explanatory, but let's ensure that we are really clear; when we come to building this layout in Android Studio, the section in the mock-up that displays <strong>2 x 2</strong> is the question and will be made up of three text views (both numbers, and the <strong>=</strong> sign is also a separate view). Finally, the three options for the answer are made up of <strong>Button</strong> layout elements. We used all of these UI elements in the previous chapter, but this time, as we are going to be controlling them using our Java code, there are a few extra things we need to do to them. So let's go through it step by step:</p><div><ol class="orderedlist arabic"><li class="listitem">Open the file that will hold our game UI in the editor window. Do this by double-clicking on <code class="literal">activity_game.xml</code>. This is located in our UI <code class="literal">layout</code> folder, which can be found in the project explorer.</li><li class="listitem">Delete the <strong>Hello World</strong> TextView, as it is not required.</li><li class="listitem">Find the <strong>Large Text</strong> element on the palette. It can be found under the <strong>Widgets</strong> section. Drag three elements onto the UI design area and arrange them near the top of the design as shown in the next screenshot. It does not have to be exact; just ensure that they are in a row and not overlapping, as shown in <a class="indexterm" id="id211"/>the following screenshot:<div><img alt="Laying out the game screen UI" src="img/8859OS_03_11.jpg"/></div></li><li class="listitem">Notice in the <strong>Component Tree</strong> window that each of the three TextViews has been assigned a name automatically by Android Studio. They are <strong>textView</strong> , <strong>textView2</strong>, and <strong>textView3</strong>:<div><img alt="Laying out the game screen UI" src="img/8859OS_03_12.jpg"/></div></li><li class="listitem">Android Studio refers to these element names as an <strong>id</strong>. This is an important concept that we will be making use of. So to confirm this, select any one of the textViews by clicking on its name (id), either in the component tree as shown in the preceding screenshot or directly on it in the UI designer shown previously. Now look at the <strong>Properties</strong> window and find the <strong>id</strong> property. You might <a class="indexterm" id="id212"/>need to scroll a little to do this:<div><img alt="Laying out the game screen UI" src="img/8859OS_03_15.jpg"/></div><p>Notice that the value for the <strong>id</strong> property is <strong>textView</strong>. It is this <code class="literal">id</code> that we will use to interact with our UI from our Java code. So we want to change all the IDs of our TextViews to something useful and easy to remember.</p></li><li class="listitem">If you look back at our design, you will see that the UI element with the <strong>textView</strong> id is going to hold the number for the first part of our math question. So change the id to <code class="literal">textPartA</code>. Notice the lowercase <code class="literal">t</code> in <code class="literal">text</code>, the uppercase <code class="literal">P</code> in <code class="literal">Part</code>, and the uppercase <code class="literal">A</code>. You can use any combination of cases and you can actually name the IDs anything you like. But just as with naming conventions with Java variables, sticking to conventions here will make things less error-prone as our program gets more complicated.</li><li class="listitem">Now select <strong>textView2</strong> and change <strong>id</strong> to <code class="literal">textOperator</code>.</li><li class="listitem">Select the element currently with id <strong>textView3</strong> and change it to <code class="literal">textPartB</code>. This TextView will hold the later part of our question.</li><li class="listitem">Now add another <strong>Large Text</strong> from the palette. Place it after the row of the three TextViews that we have just been editing.<p>This <strong>Large Text</strong> will simply hold our equals to sign and there is no plan to ever change it. So we don't need to interact with it in our Java code. We don't even need to concern ourselves with changing the ID or knowing what it is. If this situation changed, we could always come back at a later time and edit its ID.</p></li><li class="listitem">However, this new TextView currently displays <strong>Large Text</strong> and we want it to display an equals to sign. So in the <strong>Properties</strong> window, find the <strong>text</strong> property and enter the value <strong>=</strong>. We have changed the <strong>text</strong> property before in <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>, and you might also like to change the text property for <code class="literal">textPartA</code>,<code class="literal"> textPartB</code>, and <code class="literal">textOperator</code>. This is not absolutely essential because we will soon see how we can change it via our Java code; however, if we change the <strong>text</strong> property to something more appropriate, then our UI designer will look more like it will when the game runs on a real device.</li><li class="listitem">So change the <a class="indexterm" id="id213"/>text property of <strong>textPartA</strong> to <code class="literal">2</code>, <strong>textPartB</strong> to <code class="literal">2</code>, and <strong>textOperator</strong> to <code class="literal">x</code>. Your UI design and Component tree should now look like this:<div><img alt="Laying out the game screen UI" src="img/8859OS_03_14.jpg"/></div></li><li class="listitem">For the buttons to contain our multiple choice answers, drag three buttons in a row, below the <strong>=</strong> sign. Line them up neatly like our target design.</li><li class="listitem">Now, just as we did for the TextViews, find the <strong>id</strong> properties of each button, and from left to right, change the <strong>id</strong> properties to <code class="literal">buttonChoice1</code>, <code class="literal">buttonChoice2</code>, and <code class="literal">buttonChoice3</code>.</li><li class="listitem">Why not enter some arbitrary numbers for the <strong>text</strong> property of each button so that the designer more accurately reflects what our game will look like, just as we did for our other TextViews? Again, this is not absolutely essential as our Java code will control the button appearance.</li><li class="listitem">We are now actually ready to move on. But you probably agree that the UI elements look a little lost. It would look better if the buttons and text were bigger. All we need to do is adjust the textSize property for each TextView and for each Button. Then, we just need to find the textSize property for each element and enter a number with the sp syntax. If you want your design to look just like our target design from earlier, enter <code class="literal">70sp</code> for each of the TextView textSize properties and <code class="literal">40sp</code> for each of the Buttons textSize properties. When you run the game on your real device, you might want to come back and adjust the sizes up or down a bit. But we have a bit more to do before we can actually try out our game.</li><li class="listitem">Save the <a class="indexterm" id="id214"/>project and then we can move on.</li></ol></div><p>As before, we have built our UI. This time, however, we have given all the important parts of our UI a unique, useful, and easy to identify ID. As we will see we are now able to communicate with our UI through our Java code.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec36"/>Coding a question in Java</h2></div></div></div><p>With our <a class="indexterm" id="id215"/>current knowledge of Java, we are not yet able to complete our math game but we can make a significant start. We will look at how we can ask the player a question and offer them some multiple choice answers (one correct and two incorrect).</p><p>At this stage, we know enough of Java to declare and initialize some variables that will hold the parts of our question. For example, if we want to ask the times tables question <em>2 x 2</em>, we could have the following variable initializations to hold the values for each part of the question:</p><div><pre class="programlisting">int partA = 2;
int partB = 2;</pre></div><p>The preceding code declares and initializes two variables of the <code class="literal">int</code> type, each to the value of 2. We use <code class="literal">int</code> because we will not be dealing with any decimal fractions. Remember that the variable names are arbitrary and were just chosen because they seemed appropriate. Clearly, any math game worth downloading is going to need to ask more varied and advanced questions than <em>2 x 2</em>, but it is a start.</p><p>Now we know that our math game will offer multiple choices as answers. So, we need a variable for the correct answer and two variables for two incorrect answers. Take a look at these combined declarations and initializations:</p><div><pre class="programlisting">int correctAnswer = partA * partB;
int wrongAnswer1 = correctAnswer - 1;
int wrongAnswer2 = correctAnswer + 1; </pre></div><p>Note that the initialization of the variables for the wrong answers depends on the value of the correct answer, and the variables for the wrong answers are initialized after initializing the <code class="literal">correctAnswer</code> variable.</p><p>Now we need <a class="indexterm" id="id216"/>to put these values, held in our variables, into the appropriate elements on our UI. The question variables (<code class="literal">partA</code> and <code class="literal">partB</code>) need to be displayed in our UI elements, <code class="literal">textPartA</code> and <code class="literal">textPartB</code>, and the answer variables (<code class="literal">correctAnswer</code>, <code class="literal">wrongAnswer1</code>, and <code class="literal">wrongAnswer2</code>) need to be displayed in our UI elements with the following IDs: <code class="literal">buttonChoice1</code>, <code class="literal">buttonChoice2</code>, and <code class="literal">buttonChoice3</code>. We will see how we do this in the next step-by-step tutorial. We will also implement the variable declaration and initialization code that we discussed a moment ago:</p><div><ol class="orderedlist arabic"><li class="listitem">First, open <code class="literal">GameActivity.java</code> in the editor window. Remember that you can do this by double-clicking on <strong>GameActivity</strong> in our <code class="literal">java</code> folder or clicking on its tab above the editor window if <code class="literal">GameActivity.java</code> is already open.</li><li class="listitem">All of our code will go into the <code class="literal">onCreate</code> method. It will go after the <code class="literal">setContentView(R.layout.activity_game);</code> line but before the closing curly brace <code class="literal">}</code> of the <code class="literal">onCreate</code> method. Perhaps, it's a good idea to leave a blank line for clarity and a nice explanatory comment as shown in the following code. We can see the entire <code class="literal">onCreate</code> method as it stands after the latest amendments. The parts in bold are what you need to add. Feel free to add helpful comments like mine if you wish:<div><pre class="programlisting">@Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        //The next line loads our UI design to the screen
        setContentView(R.layout.activity_game);

<strong>        //Here we initialize all our variables</strong>
<strong>        int partA = 9;</strong>
<strong>        int partB = 9;</strong>
<strong>        int correctAnswer = partA * partB;</strong>
<strong>        int wrongAnswer1 = correctAnswer - 1;</strong>
<strong>        int wrongAnswer2 = correctAnswer + 1;</strong>

    }//onCreate ends here</pre></div></li><li class="listitem">Now we need to add the values contained within the variables to the <code class="literal">TextView</code> and <code class="literal">Button</code> of our UI. But first, we need to get access to the UI elements we created. We do that by creating a variable of the appropriate class and linking it via the ID property of the appropriate UI element. We already know the class of our UI elements: <code class="literal">TextView</code> and <code class="literal">Button</code>. Here is the code that creates our special class variables for each of the necessary UI elements. Take a close look at the code, but don't worry if you don't understand all of it now. We will dissect the code in detail once everything is working. Enter the code immediately after the code entered in the previous step. You <a class="indexterm" id="id217"/>can leave a blank line for clarity if you wish. Just before you proceed, note that at two points while typing in this code, you will be prompted to import another class. Go ahead and do so on both occasions:<div><pre class="programlisting">/*Here we get a working object based on either the button
or TextView class and base as well as link our new objects directly to the appropriate UI elements that we created previously*/

TextView textObjectPartA = (TextView)findViewById(R.id.textPartA);

TextView textObjectPartB = (TextView)findViewById(R.id.textPartB);

Button buttonObjectChoice1 = (Button)findViewById(R.id.buttonChoice1);

Button buttonObjectChoice2 = (Button)findViewById(R.id.buttonChoice2);

Button buttonObjectChoice3 = (Button)findViewById(R.id.buttonChoice3);</pre></div><div><div><h3 class="title"><a id="note16"/>Note</h3><p>In the preceding code, if you read the multiline comment, you will see that I used the term <strong>object</strong>. When we create a variable type based on a class, we call it an object. Once we have an object of a class, we can do anything that that class was designed to do. This is very powerful and is explored thoroughly in <a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work">Chapter 6</a>, <em>OOP – Using Other People's Hard Work</em>.</p></div></div></li><li class="listitem">Now we have five new objects linked to the elements of our UI that we need to manipulate. What precisely are we going to do with them? We need to display the values of our variables in the text of the UI elements. We can use the objects we just created combined with a method provided by the class, and use our variables as values for that text. As usual, we will dissect this code further at the end of this tutorial. Here is the code to enter directly after the code in <a class="indexterm" id="id218"/>the previous step. Try and work out what is going on before we look at it together:<div><pre class="programlisting">//Now we use the setText method of the class on our objects
//to show our variable values on the UI elements.
//Just like when we output to the console in the exercise -
//Expressions in Java, only now we use setText method
//to put the values in our variables onto the actual UI.
textObjectPartA.setText("" + partA);
textObjectPartB.setText("" + partB);

//which button receives which answer, at this stage is arbitrary.

buttonObjectChoice1.setText("" + correctAnswer);
buttonObjectChoice2.setText("" + wrongAnswer1);
buttonObjectChoice3.setText("" + wrongAnswer2);</pre></div></li><li class="listitem">Save your work.</li></ol></div><p>If you play with the assignment values for <code class="literal">partA</code> and <code class="literal">partB</code>, you can make them whatever you like and the game adjusts the answers accordingly. Obviously, we shouldn't need to reprogram our game each time we want a new question and we will solve that problem soon. All we need to do now is link the game section we have just made to the start screen menu. We will do that in the next tutorial.</p><p>Now let's explore the trickier and newer parts of our code in more detail.</p><p>In step 2, we declared and initialized the variables required so far:</p><div><pre class="programlisting">//Here we initialize all our variables
int partA = 9;
int partB = 9;
int correctAnswer = partA * partB;
int wrongAnswer1 = correctAnswer - 1;
int wrongAnswer2 = correctAnswer + 1;</pre></div><p>Then in step 3, we got a reference to our UI design through our Java code. For the TextViews, it was done like this:</p><div><pre class="programlisting">TextView textObjectPartA = (TextView)findViewById(R.id.textPartA);</pre></div><p>For each of the buttons, a reference to our UI design was obtained like this:</p><div><pre class="programlisting">Button buttonObjectChoice1 = 
    (Button)findViewById(R.id.buttonChoice1);</pre></div><p>In step 4, we did something new. We used a the <code class="literal">setText</code> method to show the values of our variables on our UI elements (<code class="literal">TextView</code> and <code class="literal">Button</code>) to the player. Let's break down one line completely to see how it works. Here is the code that shows the <code class="literal">correctAnswer</code> variable being displayed on <code class="literal">buttonObjectChoice1</code>.</p><div><pre class="programlisting">buttonObjectChoice1.setText("" + correctAnswer);</pre></div><p>By typing <code class="literal">buttonObjectChoice1</code> and adding a period, as shown in the following line of code, we have <a class="indexterm" id="id219"/>access to all the preprogrammed methods of that object's class type that are provided by Android:</p><div><pre class="programlisting">buttonObjectChoice1.</pre></div><div><div><h3 class="title"><a id="tip20"/>Tip</h3><p><strong>The power of Button and the Android API</strong></p><p>There are actually lots of methods that we can perform on an object of the Button type. If you are feeling brave, try this to get a feeling of just how much functionality there is in Android.</p><p>Type the following code:</p><div><pre class="programlisting">buttonObjectChoice1.</pre></div><p>Be sure to type the period on the end. Android Studio will pop up a list of possible methods to use on this object. Scroll through the list and get a feel of the number and variety of options:</p><div><img alt="Coding a question in Java" src="img/8859OS_03_09.jpg"/></div><p>If a mere button can do all of this, think of the possibilities for our games once we have mastered all the classes contained in Android. A collection of classes designed to be used by others is collectively known as an <strong>Application Programming Interface(API)</strong>. Welcome to the Android API!</p></div></div><p>In this case, we <a class="indexterm" id="id220"/>just want to set the button's text. So, we use <code class="literal">setText</code> and concatenate the value stored in our <code class="literal">correctAnswer</code> variable to the end of an empty string, like this:</p><div><pre class="programlisting">setText("" + correctAnswer);</pre></div><p>We do this for each of the UI elements we require to show our variables.</p><div><div><h3 class="title"><a id="tip23"/>Tip</h3><p><strong>Playing with autocomplete</strong></p><p>If you tried the previous tip, <em>The power of Button and the Android API</em>, and explored the methods available for objects of the Button type, you will already have some insight into autocomplete. Note that as you type, Android Studio is constantly making suggestions for what you might like to type next. If you pay attention to this, you can save a lot of time. Simply select the correct code completion statement that is suggested and press <em>Enter</em>. You can even see how much time you saved by selecting <strong>Help</strong> | <strong>Productivity Guide</strong> from the menu bar. Here you will see statistics for every aspect of code completion and more. Here are a few entries from mine:</p><div><img alt="Coding a question in Java" src="img/8859OS_03_08.jpg"/></div><p>As you can see, if you get used to using shortcuts early on, you can save a lot of time in the long run.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec37"/>Linking our game from the main menu</h2></div></div></div><p>At the <a class="indexterm" id="id221"/>moment, if we run the app, we have no way for the player to actually arrive at our new game activity. We want the game activity to run when the player clicks on the <strong>Play</strong> button on the main <code class="literal">MainActivity</code> UI. Here is what we need to do to make that happen:</p><div><ol class="orderedlist arabic"><li class="listitem">Open the file <code class="literal">activity_main.xml</code>, either by double-clicking on it in the Project Explorer or by clicking on its tab in the editor window.</li><li class="listitem">Now, just like we did when building the game UI, assign an ID to the <strong>Play</strong> button. As a reminder, click on the <strong>Play</strong> button either on the UI design or in the component tree. Find the <strong>id</strong> property in the <strong>Properties</strong> window. Assign the <code class="literal">buttonPlay</code> value to it. We can now make this button do stuff by referring to it in our Java code.</li><li class="listitem">Open the file <code class="literal">MainActivity.java</code>, either by double-clicking on it in the Project Explorer or clicking on its tab in the editor window.</li><li class="listitem">In our <code class="literal">onCreate</code> method, just after the line where we <code class="literal">setContentView</code>, add the following highlighted line of code:<div><pre class="programlisting">setContentView(R.layout.activity_main);
<strong>Button buttonPlay = (Button)findViewById(R.id.buttonPlay);</strong>
</pre></div></li><li class="listitem">We will dissect this code in detail once we have got this working. Basically we are making a connection to the <strong>Play</strong> button by creating a reference variable to a <code class="literal">Button</code> object. Notice that both words are highlighted in red indicating an error. Just as before, we need to import the Button class to make this code work. Use the <em>Alt</em> + <em>Enter</em> keyboard combination. Now click on <strong>Import class</strong> from the popped-up list of options. This will automatically add the required import directive at the top of our <code class="literal">MainActivity.java</code> file.</li><li class="listitem">Now for something new. We will give the button the ability to <em>listen</em> to the user clicking on it. Type this immediately after the last line of code we entered:<div><pre class="programlisting">buttonPlay.setOnClickListener(this);</pre></div></li><li class="listitem">Notice how the <code class="literal">this</code> keyword is highlighted in red indicating an error. This introduces another Java feature that will be more thoroughly explored in <a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work">Chapter 6</a>,<em>OOP – Using Other People's Hard Work</em>. Setting that aside, we need to make a modification to our code now in order to allow the use of an interface that is a special code element that allows us to add a functionality, such as listening for button clicks. Edit the line as follows. When prompted to import another class, click on <strong>OK</strong>:<div><pre class="programlisting">public class MainActivity extends Activity {</pre></div><p>to</p><div><pre class="programlisting">public class MainActivity extends Activity implements View.OnClickListener{</pre></div><p>Now we have the entire line underlined in red. This indicates an error but it's where we should be at this point. We mentioned that by adding <code class="literal">implements View.OnClickListener</code>, we have implemented an interface. We can think of this like a class that we can use but with extra rules. The rules of the <code class="literal">OnClickListener</code> interface state that we <em>must</em> implement/use one of its methods. Notice that until now, we have <a class="indexterm" id="id222"/>optionally overridden/used methods as and when they have suited us. If we wish to use the functionality this interface provides, namely listening for button presses, then we have to add/implement the <code class="literal">onClick</code> method.</p></li><li class="listitem">This is how we do it. Notice the opening curly brace, <code class="literal">{</code>, and the closing curly brace, <code class="literal">}</code>. These denote the start and end of the method. Notice that the method is empty and it doesn't do anything, but an empty method is enough to comply with the rules of the <code class="literal">OnClickListener</code> interface, and the red line indicating that our code has an error has gone. The syntax of these methods we have been using, as promised, will be explained in the next chapter when we start to write our own methods. Make sure that you type the following code, outside the closing curly brace (<code class="literal">}</code>) of the <code class="literal">onCreate</code> method but inside the closing curly brace of our <code class="literal">MainActivity</code> class:<div><pre class="programlisting">@Override
    public void onClick(View view) {

        
    }</pre></div></li><li class="listitem">Notice that we have an empty line between <code class="literal">{</code> and <code class="literal">}</code> of the <code class="literal">onClick</code> method. We can now add code in here to make the button actually do something. Type the following highlighted code between <code class="literal">{</code> and <code class="literal">}</code> of <code class="literal">onClick</code>:<div><pre class="programlisting">@Override
    public void onClick(View view) {
        <strong>Intent i;</strong>
<strong>        i = new Intent(this, GameActivity.class);</strong>
<strong>        startActivity(i);</strong>
    }</pre></div></li><li class="listitem">OK, so that code is a bit of a mouthful to comprehend all at once. See if you can guess what is happening. The clue is in the method named <code class="literal">startActivity</code> and the hopefully familiar term, <code class="literal">GameActivity</code>. Notice that we are assigning something to <code class="literal">i</code>. We will quickly get our app working and then diagnose the code in full. Its understanding will be complete when we explore <a class="indexterm" id="id223"/>how classes work in <a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work">Chapter 6</a>, <em>OOP – Using Other People's Hard Work</em>.</li><li class="listitem">Notice that we have an error: all instances of the word <code class="literal">Intent</code> are red. We can solve this by importing the classes required to make <code class="literal">Intent</code> work. As before press <em>Alt</em> + <em>Enter</em>.</li><li class="listitem">Run the game in the emulator or on your device.</li></ol></div><p>Our app will now work. This is what the new game screen looks like after pressing <strong>Play</strong> on the menu screen:</p><div><img alt="Linking our game from the main menu" src="img/8859OS_03_20.jpg"/></div><p>Almost every <a class="indexterm" id="id224"/>part of our code has changed a little and we have added a lot to it as well. Let's go over the contents of <code class="literal">MainActivity.java</code> and look at it line by line. For context, here it is in full:</p><div><pre class="programlisting">package com.packtpub.mathgamechapter3a.mathgamechapter3a;

import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;


public class MainActivity extends Activity implements View.OnClickListener{

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        final Button buttonPlay = (Button)findViewById(R.id.buttonPlay);
        buttonPlay.setOnClickListener(this);
    }

    @Override
    public void onClick(View view) {
        Intent i;
        i = new Intent(this, GameActivity.class);
        startActivity(i);
    }

}</pre></div><p>We have seen much of this code before, but let's just go over it a chunk at a time before moving on so <a class="indexterm" id="id225"/>that it is absolutely clear. The code works like this:</p><div><pre class="programlisting">package com.packtpub.mathgamechapter3a.mathgamechapter3a;

import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;</pre></div><p>You would probably remember that this first block of code defines what our package is called and makes available all the Android API stuff we need for Button, TextView, and Activity.</p><p>From our <code class="literal">MainActivity.java</code> file, we have this:</p><div><pre class="programlisting">public class MainActivity extends Activity implements View.OnClickListener{</pre></div><p>Our <code class="literal">MainActivity</code> declaration with our new bit of code implements <code class="literal">View.OnClickListener</code> that gives us the ability to detect button clicks.</p><p>Next in our code is this:</p><div><pre class="programlisting">@Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main); </pre></div><p>This previous bit of code hasn't changed since <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>. It is at the start of our <code class="literal">onCreate</code> method where we first ask the hidden code of <code class="literal">onCreate</code> to do its stuff using <code class="literal">super.onCreate(savedInstanceState);</code>. Then we set our UI to the screen with <code class="literal">setContentView(R.layout.activity_main);</code>.</p><p>Next, we get a reference to our button with an ID of <code class="literal">buttonPlay</code>:</p><div><pre class="programlisting">Button buttonPlay = (Button)findViewById(R.id.buttonPlay);
buttonPlay.setOnClickListener(this);</pre></div><p>Finally, our <code class="literal">onClick</code> method uses the <code class="literal">Intent</code> class to send the player to our <code class="literal">GameActivity</code> class and the related UI when the user clicks on the <strong>Play</strong> button:</p><div><pre class="programlisting">    @Override
    public void onClick(View view) {
        Intent i;
        i = new Intent(this, GameActivity.class);
        startActivity(i);
    }</pre></div><p>If you run the app, you will notice that we can now click on the <strong>Play</strong> button and our math game will ask us a question. Of course, we can't answer it yet. Although we have very briefly looked at how to deal with button presses, we need to learn more of Java in order to intelligently <a class="indexterm" id="id226"/>react to them. We will also reveal how to write code to handle presses from several buttons. This will be necessary to receive input from our multiple-choice-centric <code class="literal">game_activity</code> UI.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec25"/>Decisions in Java</h1></div></div></div><p>We can now summon <a class="indexterm" id="id227"/>enough of Java prowess to ask a question but a real math game must obviously do much more than this. We need to capture the player's answer, and we are nearly there with that—we can detect button presses. From there, we need to be able to <strong>decide</strong> <a class="indexterm" id="id228"/>whether their answer is right or wrong. Then, based on this decision, we have to <strong>choose</strong> an appropriate course of action.</p><p>Let's leave the math game aside for now and look at how Java might help us by learning some more fundamentals and syntax of the Java language.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec38"/>More operators</h2></div></div></div><p>Let's look at <a class="indexterm" id="id229"/>some more operators: we can already add (+), take away (-), multiply (*), divide (/), assign (=), increment (++), compare (==), and decrement (--) with operators. Let's introduce some more super-useful operators, and then we will go straight to actually understanding how to use them in Java.</p><div><div><h3 class="title"><a id="tip25"/>Tip</h3><p>Don't worry about memorizing every operator given here. Glance at them and their explanations and then move quickly on to the next section. There, we will put some operators to use and they will become much clearer as we see a few examples of what they allow us to do. They are presented here in a list just to make the variety and scope of operators plain from the start. The list will also be more convenient to refer back to when not intermingled with the discussion about implementation that follows it.</p></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>==</strong>: This is a comparison operator we saw this very briefly before. It tests for equality and is either true or false. An expression like <code class="literal">(10 == 9);</code>, for example, is false.</li><li class="listitem" style="list-style-type: disc"><strong>!</strong>: The logical NOT operator. The expression, <code class="literal">! (2+2==5)</code>.<code class="literal">)</code>, is true because 2+2 is NOT 5.</li><li class="listitem" style="list-style-type: disc"><strong>!=</strong>: This is another comparison operator, which tests if something is NOT equal. For example, the expression, <code class="literal">(10 != 9);)</code>, is true, that is, 10 is not equal to 9.</li><li class="listitem" style="list-style-type: disc"><strong>&gt;</strong>: This is another comparison operator, which tests if something is greater than something else. The expression, <code class="literal">(10 &gt; 9);)</code>, is true. There are a few more comparison operators as well.</li><li class="listitem" style="list-style-type: disc"><strong>&lt;</strong>: You guessed it. This tests whether the value to the left is less than the value to the right or not. The expression, <code class="literal">(10 &lt; 9);</code>, is false.</li><li class="listitem" style="list-style-type: disc"><strong>&gt;=</strong>: This operator tests whether one value is greater than or equal to the other, and if either is true, the result is true. For example, the expression, <code class="literal">(10 &gt;= 9);</code>, is true. The expression, <code class="literal">(10 &gt;= 10);</code>, is also true.</li><li class="listitem" style="list-style-type: disc"><strong>&lt;=</strong>: Like the <a class="indexterm" id="id230"/>preceding operator, this operator tests for two conditions but this time, less than and equal to. The expression, <code class="literal">(10 &lt;= 9);</code>, is false. The expression, <code class="literal">(10 &lt;= 10);</code>, is true.</li><li class="listitem" style="list-style-type: disc"><strong>&amp;&amp;</strong>: This operator is known as logical AND. It tests two or more separate parts of an expression and all parts must be true in order for the result to be true. Logical AND is usually used in conjunction with the other operators to build more complex tests. The expression, <code class="literal">((10 &gt; 9) &amp;&amp; (10 &lt; 11));</code>, is true because both parts are true. The expression,<code class="literal"> ((10 &gt; 9) &amp;&amp; (10 &lt; 9));</code>, is false because only one part of the expression is true and the other is false.</li><li class="listitem" style="list-style-type: disc"><strong>||</strong>: This operator is called logical OR. It is just like logical AND except that only one of two or more parts of an expression need to be true for the expression to be true. Let's look at the last example we used but replace the &amp;&amp; sign with ||. The expression, <code class="literal">((10 &gt; 9) || (10 &lt; 9));</code>, is now true because one part of the expression is true.</li></ul></div><p>All of these operators <a class="indexterm" id="id231"/>are virtually useless without a way of properly using them to make real decisions that affect real variables and code. Let's look at how to make decisions in Java.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec39"/>Decision 1 – If they come over the bridge, shoot them</h2></div></div></div><p>As we saw, operators serve hardly any purpose on their own but it was probably useful to see just a part of <a class="indexterm" id="id232"/>the wide and varied range available to us. Now, when we look at putting the most common operator, <code class="literal">==</code>, to use, we can start to see the powerful yet fine control that operators offer us.</p><p>Let's make the previous examples less abstract using the Java <code class="literal">if</code> keyword and a few conditional operators with a fun story and some code.</p><p>The captain is dying and, knowing that his remaining subordinates are not very experienced, he decides to write a Java program to convey his last orders after he has died. The troops must hold one side of a bridge while awaiting reinforcements.</p><p>The first command the captain wants to make sure his troops understand is this: If they come over the bridge, shoot them.</p><p>So how do we simulate this situation in Java? We need a Boolean variable <code class="literal">isComingOverBridge</code>. The next bit of code assumes that the <code class="literal">isComingOverBridge</code> variable has been declared and initialized.</p><p>We can then use it like this:</p><div><pre class="programlisting">if(isComingOverBridge){
  //Shoot them
}</pre></div><p>If the <code class="literal">isComingOverBridge</code> Boolean is true, the code inside the opening and closing curly braces will run. If not, the program continues after the <code class="literal">if</code> block without running it.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec40"/>Decision 2 – Else, do this</h2></div></div></div><p>The captain also wants <a class="indexterm" id="id233"/>to tell his troops what to do (stay put) if the enemy is not coming over the bridge.</p><p>Now we introduce another Java keyword, <code class="literal">else</code>. When we want to explicitly do something and the <code class="literal">if</code> block does not evaluate to true, we can use <code class="literal">else</code>.</p><p>For example, to tell the troops to stay put if the enemy is not coming over the bridge, we use <code class="literal">else</code>:</p><div><pre class="programlisting">if(isComingOverBridge){
  //Shoot them
}else{
  //Hold position
}</pre></div><p>The captain then realized that the problem wasn't as simple as he first thought. What if the enemy comes over the bridge and has more troops? His squad will be overrun. So, he came up with this code (we'll use some variables as well this time):</p><div><pre class="programlisting">boolean isComingOverTheBridge;
int enemyTroops;
int friendlyTroops;
//Code that initializes the above variables one way or another

//Now the if
if(isComingOverTheBridge &amp;&amp; friendlyTroops &gt; enemyTroops){
  //shoot them
}else if(isComingOverTheBridge &amp;&amp; friendlyTroops &lt; enemyTroops) {
  //blow the bridge
}else{
  //Hold position
}</pre></div><p>Finally, the captain's last concern was that if the enemy came over the bridge waving the white flag of surrender and were promptly slaughtered, then his men would end up as war criminals. The Java code <a class="indexterm" id="id234"/>needed was obvious. Using the <code class="literal">wavingWhiteFlag</code> Boolean variable he wrote this test:</p><div><pre class="programlisting">if (wavingWhiteFlag){
  //Take prisoners
}</pre></div><p>But where to put this code was less clear. In the end, the captain opted for the following nested solution and changing the test for <code class="literal">wavingWhiteFlag</code> to logical NOT, like this:</p><div><pre class="programlisting">if (!wavingWhiteFlag){//not surrendering so check everything else
  if(isComingOverTheBridge &amp;&amp; friendlyTroops &gt; enemyTroops){
    //shoot them
  }else if(isComingOverTheBridge &amp;&amp; friendlyTroops &lt; enemyTroops) {
    //blow the bridge
  }
}else{//this is the else for our first if
  //Take prisoners
{
//Holding position</pre></div><p>This demonstrates that we can nest <code class="literal">if</code> and <code class="literal">else</code> statements inside of one another to create even deeper decisions.</p><p>We could go on making more and more complicated decisions but what we have seen is more than sufficient as an introduction. Take the time to reread this if anything is unclear. Who knows, there might even be a tricky logic question in the self-test at the end of the chapter. It is also important to point out that very often, there are two or more ways to arrive at the solution. The <em>right</em> <a class="indexterm" id="id235"/>way will usually be the way that solves the problem in the clearest and simplest manner.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec41"/>Switching to make decisions</h2></div></div></div><p>We have seen <a class="indexterm" id="id236"/>the vast and virtually limitless possibilities of combining the Java operators with <code class="literal">if</code> and <code class="literal">else</code> statements. But sometimes a decision in Java can be better made in other ways.</p><p>When we have to make a decision based on a clear list of possibilities that doesn't involve complex combinations, then <strong>switch</strong> is usually the way to go.</p><p>We start a <code class="literal">switch</code> decision like this:</p><div><pre class="programlisting">switch(argument){

}</pre></div><p>In the previous example, an argument could be an expression or a variable. Then within the curly braces, we can make decisions based on the argument with case and break elements:</p><div><pre class="programlisting">case x:
  //code to for x
  break;

case y:
  //code for y
  break;</pre></div><p>You can see that in the previous example, each case states a possible result and each break denotes the end of that case as well as the point at which no further case statements should be evaluated. The first break encountered takes us out of the switch block to proceed with the next line of code.</p><p>We can also use <strong>default</strong> without a value to run some code if none of the case statements evaluate to true, like this:</p><div><pre class="programlisting">default://Look no value
  //Do something here if no other case statements are true
break;</pre></div><p>Supposing we are writing an old-fashioned text adventure game—the kind of game where the player types commands such as <code class="literal">"Go East"</code>, <code class="literal">"Go West"</code>, <code class="literal">"Take Sword"</code>, and so on. In this case, switch could handle that situation like this example code and we could use <code class="literal">default</code> to <a class="indexterm" id="id237"/>handle the case of the player typing a command that is not specifically handled:</p><div><pre class="programlisting">//get input from user in a String variable called command
switch(command){

  case "Go East":
  //code to go east
  break;

  case "Go West":
  //code to go west
  break;
  case "Take sword":
  //code to take the sword
  break;

  //more possible cases

  default:
  //Sorry I don't understand your command
  break;

}</pre></div><p>In the next section, we will use <code class="literal">switch</code> so that our <code class="literal">onClick</code> method can handle the different multiple-choice buttons of our math game.</p><div><div><h3 class="title"><a id="tip26"/>Tip</h3><p>Java has even more operators than we have covered here. We have looked at all the operators we are going to need in this book and probably the most used in general. If you want the complete lowdown on operators, take a look at the official Java documentation at <a class="ulink" href="http://docs.oracle.com/javase/tutorial/java/nutsandbolts/operators.html">http://docs.oracle.com/javase/tutorial/java/nutsandbolts/operators.html</a>.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Math game – getting and checking the answer</h1></div></div></div><p>Here we <a class="indexterm" id="id238"/>will detect the right or wrong answer and provide a pop-up message to the player. Our Java is getting quite good now, so let's dive in and add these features. I will explain things as we go and then, as usual, dissect the code thoroughly at the end.</p><p>The already <a class="indexterm" id="id239"/>completed code is in the download bundle, in the following files that correspond to the filenames we will create/autogenerate in Android Studio in a moment:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Chapter3/MathGameChapter3b/java/MainActivity.java</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Chapter3/MathGameChapter3b/java/GameActivity.java</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Chapter3/MathGameChapter3b/layout/activity_main.xml</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Chapter3/MathGameChapter3b/layout/activity_game.xml</code></li></ul></div><p>As usual, I recommend following this tutorial step by step to see how we can create all of the code for ourselves.</p><div><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">GameActivity.java</code> file visible in the editor window.</li><li class="listitem">Now we need to add the click detection functionality to our <code class="literal">GameActivity</code>, just as we did for our <code class="literal">MainActivity</code>. However, we will go a little further than the last time. So let's do it step by step as if it is totally new. Once again, we will give the buttons the ability to <em>listen</em> to the user clicking on them. Type this immediately after the last line of code we entered in the <code class="literal">onCreate</code> method but before the closing <code class="literal">}</code>. This time of course, we need to add some code to listen to three buttons:<div><pre class="programlisting">buttonObjectChoice1.setOnClickListener(this);
buttonObjectChoice2.setOnClickListener(this);
buttonObjectChoice3.setOnClickListener(this);</pre></div></li><li class="listitem">Notice how the <code class="literal">this</code> keyword is highlighted in red indicating an error. Again, we need to make a modification to our code in order to allow the use of an interface, the special code element that allows us to add functionalities such as listening to button clicks. Edit the line as follows. When prompted to import another class, click on <strong>OK</strong>. Consider this line of code:<div><pre class="programlisting">public class GameActivity extends Activity {</pre></div><p>Change it to the following line:</p><div><pre class="programlisting">public class GameActivity extends Activity implements View.OnClickListener{</pre></div></li><li class="listitem">Now we have the entire preceding line underlined in red. This indicates an error but it is where we should be at this point. We mentioned that by adding <code class="literal">implements View.OnClickListener</code>, we have implemented an interface. We can think of this like a class that we can use, but with extra rules. One of the rules of the <code class="literal">OnClickListener</code> interface is that we must implement one of its methods, as you might remember. Now we will add the <code class="literal">onClick</code> method.</li><li class="listitem">Type the <a class="indexterm" id="id240"/>following code. Notice the opening curly brace, <code class="literal">{</code>, and the closing curly brace, <code class="literal">}</code>. These denote the start and end of the method. Notice that the method is empty; it doesn't do anything but an empty method is enough to comply with the rules of the <code class="literal">OnClickListener</code> interface and the red line that indicated an error has gone. Make sure that you type the following code outside the closing curly brace (<code class="literal">}</code>) of the <code class="literal">onCreate</code> method but inside the closing curly brace of our <code class="literal">GameActivity</code> class:<div><pre class="programlisting">@Override
    public void onClick(View view) {

        
    }</pre></div></li><li class="listitem">Notice that <a class="indexterm" id="id241"/>we have an empty line between the <code class="literal">{</code> and <code class="literal">}</code> braces of our <code class="literal">onClick</code> method. We can now put some code in here to make the buttons actually do something. Type the following in between <code class="literal">{</code> and <code class="literal">}</code> of <code class="literal">onClick</code>. This is where things get different from our code in <code class="literal">MainActivity</code>. We need to differentiate between the three possible buttons that could be pressed. We will do this with the <code class="literal">switch</code> statement that we discussed earlier. Look at the <code class="literal">case</code> criteria; they should look familiar. Here is the code that uses the switch statements:<div><pre class="programlisting">switch (view.getId()) {

            case R.id.buttonChoice1:
            //button 1 stuff goes here
                break;

            case R.id.buttonChoice2:
            //button 2 stuff goes here
                break;

            case R.id.buttonChoice3:
           //button 3 stuff goes here
                break;

        }</pre></div></li><li class="listitem">Each <code class="literal">case</code> element handles a different button. For each button case, we need to get the value stored in the button that was just pressed and see if it matches our <code class="literal">correctAnswer</code> variable. If it does, we must tell the player they got it right, and if not, we must tell them they got it wrong. However, there is still one problem we have to solve. The <code class="literal">onClick</code> method is separate from the <code class="literal">onCreate</code> method and the Button objects. In fact, all the variables are declared in the <code class="literal">onCreate</code> method. If you try typing the code from step 9 now, you will get lots of errors. We need to make all the variables that we need in <code class="literal">onClick</code> available in <code class="literal">onClick</code>. To do this, we will move their declarations <a class="indexterm" id="id242"/>from above the <code class="literal">onCreate</code> method to just below the opening <code class="literal">{</code> of <code class="literal">GameActivity</code>. This means that these variables become variables of the <code class="literal">GameActivity</code> class and can be seen anywhere within <code class="literal">GameActivity</code>. Declare the following variables like this:<div><pre class="programlisting">int correctAnswer;
Button buttonObjectChoice1;
Button buttonObjectChoice2;
Button buttonObjectChoice3;</pre></div></li><li class="listitem">Now change the <a class="indexterm" id="id243"/>initialization of these variables within <code class="literal">onCreate</code> as follows. The actual parts of code that need to be changed are highlighted. The rest is shown for context:<div><pre class="programlisting">//Here we initialize all our variables
int partA = 9;
int partB = 9;
<strong>correctAnswer = partA * partB;</strong>
int wrongAnswer1 = correctAnswer - 1;
int wrongAnswer2 = correctAnswer + 1;</pre></div><p>and</p><div><pre class="programlisting">TextView textObjectPartA = (TextView)findViewById(R.id.textPartA);

TextView textObjectPartB = (TextView)findViewById(R.id.textPartB);

<strong>buttonObjectChoice1 = (Button)findViewById(R.id.buttonChoice1);</strong>
<strong>        </strong>
<strong>buttonObjectChoice2 = (Button)findViewById(R.id.buttonChoice2);</strong>
<strong>        </strong>
<strong>buttonObjectChoice3 = (Button)findViewById(R.id.buttonChoice3);</strong>
</pre></div></li><li class="listitem">Here is <a class="indexterm" id="id244"/>the top of our <code class="literal">onClick</code> method as well as the first <code class="literal">case</code> statement for our <code class="literal">onClick</code> method:<div><pre class="programlisting">@Override
    public void onClick(View view) {
        //declare a new int to be used in all the cases
        int answerGiven=0;
        switch (view.getId()) {

            case R.id.buttonChoice1:
            //initialize a new int with the value contained in buttonObjectChoice1
            //Remember we put it there ourselves previously
                answerGiven = Integer.parseInt("" + buttonObjectChoice1.getText());

                //is it the right answer?
                if(answerGiven==correctAnswer) {//yay it's the right answer
                    Toast.makeText(getApplicationContext(), "Well done!", Toast.LENGTH_LONG).show();
                }else{//uh oh!
                    Toast.makeText(getApplicationContext(),"Sorry that's wrong", Toast.LENGTH_LONG).show();
                }
                break;</pre></div></li><li class="listitem">Here are the <a class="indexterm" id="id245"/>rest of the <code class="literal">case</code> statements that do the same steps as the code in the previous step except handling the last two buttons. Enter the following code after the code entered in the previous step:<div><pre class="programlisting">            case R.id.buttonChoice2:
                //same as previous case but using the next button
                answerGiven = Integer.parseInt("" + buttonObjectChoice2.getText());
                if(answerGiven==correctAnswer) {
                    Toast.makeText(getApplicationContext(), "Well done!", Toast.LENGTH_LONG).show();
                }else{
                    Toast.makeText(getApplicationContext(),"Sorry that's wrong", Toast.LENGTH_LONG).show();
                }
                break;

            case R.id.buttonChoice3:
                //same as previous case but using the next button
                answerGiven = Integer.parseInt("" + buttonObjectChoice3.getText());
                if(answerGiven==correctAnswer) {
                    Toast.makeText(getApplicationContext(), "Well done!", Toast.LENGTH_LONG).show();
                }else{
                    Toast.makeText(getApplicationContext(),"Sorry that's wrong", Toast.LENGTH_LONG).show();
                }
                break;

        }</pre></div></li><li class="listitem">Run the <a class="indexterm" id="id246"/>program, and then we will look at the <a class="indexterm" id="id247"/>code carefully, especially that odd-looking <code class="literal">Toast</code> thing. Here is what happens when we click on the leftmost button:<div><img alt="Math game – getting and checking the answer" src="img/8859OS_03_25.jpg"/></div></li></ol></div><p>This is how we did it: In steps 1 through 6, we set up handling for our multi-choice buttons, including adding the ability to listen to clicks using the <code class="literal">onClick</code> method and a <code class="literal">switch</code> block to handle decisions depending on the button pressed.</p><p>In steps 7 and 8, we had to alter our code to make our variables available in the <code class="literal">onClick</code> method. We did this by making them member variables of our <code class="literal">GameActivity</code> class.</p><div><div><h3 class="title"><a id="tip27"/>Tip</h3><p>When we make a variable a member of a class, we call it a <strong>field</strong>. We will discuss exactly when a variable should be a field and when it shouldn't in <a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work">Chapter 6</a>, <em>OOP – Using Other People's Hard Work</em>.</p></div></div><p>In steps 9 and <a class="indexterm" id="id248"/>10, we implemented the code that actually does the work in our switch statement in <code class="literal">onClick</code>. Let's take a line-by-line look at the code that <a class="indexterm" id="id249"/>runs when <code class="literal">button1</code> is pressed.</p><div><pre class="programlisting">case R.id.buttonChoice1:</pre></div><p>First, the <code class="literal">case</code> statement is true when the button with an id of <code class="literal">buttonChoice1</code> is pressed. Then the next line of code to execute is this:</p><div><pre class="programlisting">answerGiven = Integer.parseInt(""+ buttonObjectChoice1.getText());</pre></div><p>The preceding line gets the value on the button using two methods. First, <code class="literal">getText</code> gets the number as a string and then <code class="literal">Integer.parseInt</code> converts it to an integer. The value is stored in our <code class="literal">answerGiven</code> variable. The following code executes next:</p><div><pre class="programlisting">if(answerGiven==correctAnswer) {//yay it's the right answer
  Toast.makeText(getApplicationContext(), "Well done!", Toast.LENGTH_LONG).show();
}else{//uh oh!
    Toast.makeText(getApplicationContext(),"Sorry that's wrong", Toast.LENGTH_LONG).show();
                }</pre></div><p>The <code class="literal">if</code> statement tests to see if the <code class="literal">answerGiven</code> variable is the same as <code class="literal">correctAnswer</code> using the <code class="literal">==</code> operator. If so, the <code class="literal">makeText</code> method of the <code class="literal">Toast</code> object is used to display a congratulatory message. If the values of the two variables are not the same, the message displayed is a bit more negative one.</p><div><div><h3 class="title"><a id="note17"/>Note</h3><p>The <code class="literal">Toast</code> line of code is possibly the most evil thing we have seen thus far. It looks exceptionally complicated and it does need a greater knowledge of Java than we have at the moment to understand. All we need to know for now is that we can use the code as it is and just change the message, and it is a great tool to announce something to the player. By the end of <a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work">Chapter 6</a>, <em>OOP – Using Other People's Hard Work</em>, the code for <code class="literal">Toast</code> will be clear. If you really want an explanation now, you can think of it like this: when we made button objects, we got to use all the button methods. But with Toast, we used the class directly to access its <code class="literal">makeText</code> method without creating an object first. We can do this process when the class and its methods are designed to allow it.</p></div></div><p>Finally, we break out of the whole <code class="literal">switch</code> statement as follows:</p><div><pre class="programlisting">break;</pre></div><p>Now that we have improved the project as far as we can with what we learned in this chapter, why <a class="indexterm" id="id250"/>not test your understanding of everything <a class="indexterm" id="id251"/>you've learned so far?</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec27"/>Self-test questions</h1></div></div></div><p>Q1) What does this code do?</p><div><pre class="programlisting">// setContentView(R.layout.activity_main);</pre></div><p>Q2) Which of these lines causes an error?</p><div><pre class="programlisting">String a = "Hello";
String b = " Vinton Cerf";
int c = 55;
a = a + b
c = c + c + 10;
a = a + c;
c = c + a;</pre></div><p>Q3) We talked a lot about operators and how different operators can be used together to build complicated expressions. Expressions, at a glance, can sometimes make the code look complicated. However, when looked at closely, they are not as tough as they seem. Usually, it is just a case of splitting the expressions into smaller pieces to work out what is going on. Here is an expression that is more convoluted than anything else you will ever see in this book. As a challenge, can you work out: what will <code class="literal">x</code> be?</p><div><pre class="programlisting">int x = 10;
int y = 9;
boolean isTrueOrFalse = false;
isTrueOrFalse = (((x &lt;=y)||(x == 10))&amp;&amp;((!isTrueOrFalse) || (isTrueOrFalse)));</pre></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec28"/>Summary</h1></div></div></div><p>We covered a lot in this chapter. We went from knowing nothing about Java syntax to learning about comments, variables, operators, and decision making.</p><p>As with any language, mastery of Java can be achieved by simply practicing, learning, and increasing our vocabulary. At this point, the temptation might be to hold back until mastery of the current Java syntax has been achieved, but the best way is to move on to new syntax at the same time as revisiting what we have already begun to learn.</p><p>In the next chapter, we will finally finish our math game by adding random questions of multiple difficulties as well as using more appropriate and random wrong answers for the multiple choice buttons.</p><p>To enable us to do this, we will first learn some more Java.</p></div>
<div><div><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Discovering Loops and Methods</h1></div></div></div><p>In this chapter, we will learn how to repeatedly execute portions of our code in a controlled and precise way by looking at different types of loops in Java. These include <code class="literal">while</code> loops, <code class="literal">do-while</code> loops, and <code class="literal">for</code> loops. We will learn about the best occasions to use the different types of loops.</p><p>Then we will briefly cover the topic of random numbers. We will also see how the Java <code class="literal">Random</code> class can be used. This will obviously be of great help in enhancing our math game.</p><p>Next, we will look <a class="indexterm" id="id252"/>at <strong>methods</strong>. They allow us to compartmentalize our code into more manageable blocks. We will then see how to share data between methods and divide programming tasks to simplify problems.</p><p>We will then use all that we have learned about loops, random numbers and methods on our math game project. For example, we will make the game change the question after each time we attempt the answer.</p><p>We will also add question difficulty levels and random questions within a range appropriate for a given difficulty level. We will show and update our score. The score goes up faster depending upon the difficulty level of the question answered (correctly). Eventually, even the best mathematicians among us should be beaten by the game. Nevertheless, most of us will hopefully get a bit further than what is shown in the next screenshot.</p><p>If the player gets a question wrong, the difficulty goes back to the easiest level and the score to zero. This is what the game will look like when we are done:</p><div><img alt="Discovering Loops and Methods" src="img/8859OS_04_01.jpg"/></div><p>In this chapter we will:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Learn about looping in multiple types of loops</li><li class="listitem" style="list-style-type: disc">Learn how to generate random numbers in Java</li><li class="listitem" style="list-style-type: disc">Learn everything about Java methods, including how to write and call them</li><li class="listitem" style="list-style-type: disc">Significantly enhance our math game</li></ul></div><div><div><div><div><h1 class="title"><a id="ch04lvl1sec29"/>Looping with loops</h1></div></div></div><p>It would be <a class="indexterm" id="id253"/>completely reasonable to ask what loops have to do with programming, but they are exactly what the name implies. They are a way of performing the same part of the code more than once, or looping over the same part of code, but potentially for a different outcome each time.</p><p>This can simply mean doing the same thing until the code being looped over prompts the loop to end. It could prompt the loop after a predetermined number of times as specified by the loop code itself. It could also prompt the loop when a predetermined situation or <strong>condition</strong> is met. Or there could be a combination of more than one of these ways of prompting the loop to end. Along with <code class="literal">if</code>, <code class="literal">else</code>, and <code class="literal">switch</code>, loops are part of the Java <strong>control flow statements</strong>.</p><p>We will look at all the major types of loop that Java offers us to control our code, and after we have looked at methods, we will use some of them to implement the enhancements to our math game. Let's proceed to our first type of loop.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec42"/>While loops</h2></div></div></div><p>A <code class="literal">while</code> <a class="indexterm" id="id254"/>loop has the simplest syntax. Recollect the <code class="literal">if</code> statements in <a class="link" href="ch03.html" title="Chapter 3. Speaking Java – Your First Game">Chapter 3</a>, <em>Speaking Java – Your First Game</em>. We can put virtually any combination of operators and variables in the conditional expression of the <code class="literal">if</code> statement. If the expression <a class="indexterm" id="id255"/>evaluated to <code class="literal">true</code>, then the code in the body of the <code class="literal">if</code> block is executed. Similarly, in the <code class="literal">while</code> loop, we put an expression that can evaluate to <code class="literal">true</code> or <code class="literal">false</code>, as shown in this code:</p><div><pre class="programlisting">int x = 10;

while(x &gt; 0){
  x--;
  //x decreases by one each pass through the loop
}</pre></div><p>What is happening here is that outside the <code class="literal">while</code> loop, an integer, <code class="literal">x</code>, is declared and initialized to <code class="literal">10</code>. Then the <code class="literal">while</code> loop begins. Its condition is <code class="literal">x &gt; 0</code>, so it will continue looping through the code in its body until the condition evaluates to <code class="literal">false</code>. Hence, the code will execute 10 times.</p><p>On the first pass, <code class="literal">x</code> is equal to <code class="literal">10</code>, then <code class="literal">9</code>, then <code class="literal">8</code>, and so on. But once <code class="literal">x</code> becomes equal to <code class="literal">0</code>, it is obviously no longer greater than <code class="literal">0</code>. So the program will exit the <code class="literal">while</code> loop and continue with the first line of code after the loop.</p><p>Just like an <code class="literal">if</code> statement, it is possible that the <code class="literal">while</code> loop will not execute even once. Take a look at this example of a <code class="literal">while</code> loop that never executes:</p><div><pre class="programlisting">int x = 10;

while(x &gt; 10){
  //more code here.
  //but it will never run unless x is greater than 10.
}</pre></div><p>Moreover, there is no limit to the complexity of the condition expression or the amount of code that can be written in the loop body:</p><div><pre class="programlisting">int playerLives = 3;
int alienShips = 10;

while(playerLives &gt;0 &amp;&amp; alienShips &gt;0){
  //Entire game code here.
  //...
  //...
  //etc.
}
//continue here when either playerLives or alienShips = 0</pre></div><p>The preceding <code class="literal">while</code> loop would continue to execute until either <code class="literal">playerLive</code>s or<code class="literal"> alienShips</code> becomes equal to or less than zero. As soon as one of these conditions occurs, the expression evaluates to <code class="literal">false</code> and the program continues to execute from the first line of code after the <code class="literal">while</code> loop.</p><p>It is worth noting <a class="indexterm" id="id256"/>that once the body of the loop has been entered, it will always complete, even if the expression evaluates to <code class="literal">false</code> somewhere in between, as the condition is <a class="indexterm" id="id257"/>not checked again until the code tries to start another pass:</p><div><pre class="programlisting">int x = 1;

while(x &gt; 0){
  x--;
  //x is now 0 so the condition is false
  //But this line still runs
  //and this one
  //and me!

}</pre></div><p>The preceding loop body will execute exactly once. We can also set a <code class="literal">while</code> loop that will run forever (which is unsurprisingly called an <strong>infinite loop</strong>), like this:</p><div><pre class="programlisting">int x = 0;

while(true){
  x++; //I am going to get mighty big!
}</pre></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec14"/>Breaking out of a loop</h3></div></div></div><p>We might use an <a class="indexterm" id="id258"/>infinite loop like the loop in the preceding example so that we can decide when to exit the loop from within its body. We would do this using the <code class="literal">break</code> keyword when we are ready to leave the loop body, as shown in the following code:</p><div><pre class="programlisting">int x = 0;

while(true){
  x++; //I am going to get mighty big!
  break; //No you're not haha.
  //code doesn't reach here
}</pre></div><p>You might have been able to guess that we can combine any of the decision making tools like <code class="literal">if</code>, <code class="literal">else</code>, and <a class="indexterm" id="id259"/>
<code class="literal">switch</code> within our <code class="literal">while</code> loops and the rest of the loops we will look at in a minute:</p><div><pre class="programlisting">int x = 0;
int tooBig = 10;

while(true){
  x++; //I am going to get mighty big!
  if(x == tooBig){
    break;
  } //No you're not haha.
  
  //code reaches here only until x = 10
}</pre></div><p>It would be simple to go on for many more pages demonstrating the versatility of <code class="literal">while</code> loops, but at some point, we want to get back to doing some real programming. So here is one last concept, combined with <code class="literal">while</code> loops.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec15"/>The continue keyword</h3></div></div></div><p>The <code class="literal">continue</code> <a class="indexterm" id="id260"/>keyword acts in a way similar to <code class="literal">break</code>—up to a point. The <code class="literal">continue</code> keyword will break out of the loop body but will also check the <a class="indexterm" id="id261"/>condition expression afterwards, so the loop <em>could</em> run again. The following example will show the use of <code class="literal">continue</code>:</p><div><pre class="programlisting">int x = 0;
int tooBig = 10;
int tooBigToPrint = 5;

while(true){
  x++; //I am going to get mighty big!
  if(x == tooBig){
    break;
  } //No your not haha.
  
  //code reaches here only until x = 10

  if(x &gt;= tooBigToPrint){
    //No more printing but keep looping
    continue;
  }
  //code reaches here only until x = 5

  //Print out x 

}</pre></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec43"/>Do-while loops</h2></div></div></div><p>A <code class="literal">do-while</code> <a class="indexterm" id="id262"/>loop is very much the same as a <code class="literal">while</code> loop with the exception that it evaluates its expression after the body. This means that a <code class="literal">do-while</code> loop will <a class="indexterm" id="id263"/>always execute at least once, as demonstrated in the following code:</p><div><pre class="programlisting">int x= 0;
do{
  x++;
}while(x &lt; 10);
//x now = 10 </pre></div><div><div><h3 class="title"><a id="note18"/>Note</h3><p>The <code class="literal">break</code> and <code class="literal">continue</code> keywords can also be used in <code class="literal">do-while</code> loops.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec44"/>For loops</h2></div></div></div><p>A <code class="literal">for</code> loop has a <a class="indexterm" id="id264"/>slightly more complicated syntax than a <code class="literal">while</code> and <code class="literal">do-while</code> loop <a class="indexterm" id="id265"/>as it take three parts to initialize. Take a look at the following <code class="literal">for</code> loop first. Then we will break it apart:</p><div><pre class="programlisting">for(int i = 0; i &lt; 10; i++){
  //Something that needs to happen 10 times goes here
}</pre></div><p>The apparently obscure form of the <code class="literal">for</code> loop is clearer when put like this:</p><div><pre class="programlisting">for(<strong>declaration and initialization; condition; change after each pass through loop</strong>)</pre></div><p>To clarify further, we have the following in a <code class="literal">for</code> loop:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Declaration and initialization</strong>: We create a new <code class="literal">int</code> variable, <code class="literal">i</code>, and initialize <a class="indexterm" id="id266"/>it to 0.</li><li class="listitem" style="list-style-type: disc"><strong>Condition</strong>: Just <a class="indexterm" id="id267"/>like the other loops, this refers to the condition that must be evaluated to true for the loop to continue.</li><li class="listitem" style="list-style-type: disc"><strong>Change after each pass through loop</strong>: In the preceding example, <code class="literal">i++</code> means <a class="indexterm" id="id268"/>that 1 is added to <code class="literal">i</code> on each pass. We could also use <code class="literal">i--</code> to reduce/decrement <code class="literal">i</code> on each pass, which is shown in the following code:<div><pre class="programlisting">for(int i = 10; i &gt; 0; i--){
  //countdown
}
//blast off i = 0</pre></div></li></ul></div><div><div><h3 class="title"><a id="note19"/>Note</h3><p>Note that <code class="literal">break</code> and <code class="literal">continue</code> can also be used in <code class="literal">for</code> loops.</p></div></div><p>The <code class="literal">for</code> loop essentially takes control of initialization, condition evaluation, and the control variable on <a class="indexterm" id="id269"/>itself. We will be using a <code class="literal">for</code> loop to enhance our math game right after we take a look at random numbers and methods.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec45"/>Random numbers in Java</h2></div></div></div><p>Before we <a class="indexterm" id="id270"/>dive into methods, we will first take a look at <a class="indexterm" id="id271"/>how we can create random numbers because this is how we will generate our random questions.</p><p>All the hard work is done for us by the <code class="literal">Random</code> class. First we need to create an object of the <code class="literal">Random</code> type:</p><div><pre class="programlisting">Random randInt = new Random();</pre></div><p>Then we use our new object's <code class="literal">nextInt</code> method to generate a random number within a certain range:</p><div><pre class="programlisting">int ourRandomNumber = randInt.nextInt(10);</pre></div><p>The range for the number that we enter starts from zero. So the preceding line of code will generate a random number between 0 and 9. If we want a random number between 1 and 10, we just do this:</p><div><pre class="programlisting">ourRandomNumber++;</pre></div><div><div><h3 class="title"><a id="tip28"/>Tip</h3><p>Often in these early chapters, we need to accept there is a bit of magic going on in objects like Random. In <a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work">Chapter 6</a>, <em>OOP – Using Other People's Hard Work</em>, we will be ripping open the black boxes and even making our own. We will be able to write our own classes and our own methods within those classes.</p></div></div><p>A good start is a <a class="indexterm" id="id272"/>look at regular vanilla methods, which we <a class="indexterm" id="id273"/>will do next.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec30"/>Methods</h1></div></div></div><p>So what exactly <a class="indexterm" id="id274"/>are Java methods? A method is a collection of variables, expressions, and control flow statements. We have already been using lots of methods; we just haven't looked inside any yet.</p><p>Learning about Java methods will be the last topic for this chapter before we get practical and use what we have learned to enhance our math game.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec46"/>The structure of a method</h2></div></div></div><p>The first part of <a class="indexterm" id="id275"/>a method that we write is called the <strong>signature</strong>. Here is a made-up example of a signature:</p><div><pre class="programlisting">public boolean shootLazers(int number, string type)</pre></div><p>Add an opening <a class="indexterm" id="id276"/>and closing pair of curly braces with some code that the method performs, and we have a complete method, or a <strong>definition</strong>. Here is a made-up but syntactically correct method:</p><div><pre class="programlisting">private void setCoordinates(int x, int y){
  //code to set coordinates goes here
}</pre></div><p>We could then use our new method from another part of our code, like this:</p><div><pre class="programlisting">//I like it here

<strong>setCoordinates(4,6);</strong>//now I am going off to setCoordinates method

//Phew, I'm back again - code continues here</pre></div><p>At the point where we call <code class="literal">setCoordinates</code>, our program's execution would branch to the code contained within that method, which would run until it reaches its end or is told to return. Then the code would continue running from the first line after the method call.</p><p>Here is another example of a method, complete with the code to make the method return to the code that called it:</p><div><pre class="programlisting">int addAToB(int a, int b){
  int answer = a + b;
  return answer;
}</pre></div><p>The call to use the preceding method could look like this:</p><div><pre class="programlisting">int myAnswer = addAToB(2,4); </pre></div><p>Clearly, we don't need to write methods to add two <code class="literal">int</code> variables together, but the preceding example helps us see a little more of the working of methods. First, we pass the values <code class="literal">2</code> and <code class="literal">4</code>. In the signature of the method, the value, <code class="literal">2</code>, is assigned to <code class="literal">int a</code> and the value, <code class="literal">4</code>, is assigned to <code class="literal">int b</code>.</p><p>Within the method body, the <code class="literal">a</code> and <code class="literal">b</code> variables are added and used to initialize a new variable, which is the <code class="literal">int</code> answer. The <code class="literal">return answer</code> line does just that. It returns the value stored in <code class="literal">answer</code> to the calling code, causing <code class="literal">myAnswer</code> to be initialized with the value of <code class="literal">6</code>.</p><p>Notice that each of the method signatures in the preceding examples varies a little. The reason for this is that <a class="indexterm" id="id277"/>the Java method signature is quite flexible, allowing us to build exactly the methods we require.</p><p>Exactly how the method signature defines how the method must be called and how a method must return a <a class="indexterm" id="id278"/>value, if it must, deserves further discussion. Let's give each part of that signature a name so that we can break it into chunks and learn about the parts separately.</p><div><div><h3 class="title"><a id="tip29"/>Tip</h3><p>Here is a method signature with its parts labeled and ready for discussion. You can also take a look at the following table to further identify which part of the signature is which. This will make the rest of our discussion on methods straightforward.</p><p><strong>Modifier</strong> | <strong>return type</strong> | <strong>name of the method</strong> (<strong>parameters</strong>)</p></div></div><p>Here are a few examples that we have used so far so that you can clearly identify the part of the signature under discussion:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Part of signature</p>
</th><th style="text-align: left" valign="bottom">
<p>Examples</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Modifier</p>
</td><td style="text-align: left" valign="top">
<p><code class="literal">public</code>, <code class="literal">private</code>, and <a class="indexterm" id="id279"/>so on</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Return type</p>
</td><td style="text-align: left" valign="top">
<p><code class="literal">int</code>, <code class="literal">boolean</code>, <code class="literal">float</code>, and <a class="indexterm" id="id280"/>so on, or any Java type, expression, or object</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Name of the method</p>
</td><td style="text-align: left" valign="top">
<p><code class="literal">shootLazers</code>, <code class="literal">setCoordinates</code>, <code class="literal">addAToB</code>, and so on</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Parameters</p>
</td><td style="text-align: left" valign="top">
<p>(<code class="literal">int number</code>, <code class="literal">string type</code>), (<code class="literal">int x</code>, <code class="literal">int y</code>), (<code class="literal">int a</code>, <code class="literal">int b</code>), and so <a class="indexterm" id="id281"/>on</p>
</td></tr></tbody></table></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec16"/>Modifier</h3></div></div></div><p>In our previous <a class="indexterm" id="id282"/>examples, we only used a modifier twice, partly <a class="indexterm" id="id283"/>because the method doesn't have to use the modifier. The modifier is a way of specifying which code can use your method. Some of the types of modifiers are <code class="literal">public</code> and <code class="literal">private</code>. Actually, regular variables can have modifiers too, such as these:</p><div><pre class="programlisting">//Most code can see me
public int a;

//Code in other classes can't see me
private string secret = "Shhh, I am private";</pre></div><p>Modifiers (for methods and variables) are an essential Java topic but they are best dealt with when we discuss the other vital Java topic we have skirted around a few times so far—objects and classes.</p><div><div><h3 class="title"><a id="note20"/>Note</h3><p>As previously promised, these mysterious objects will be revealed in <a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work">Chapter 6</a>, <em>OOP – Using Other People's Hard Work</em>. However, as we can see from our example methods and from the fact that all the examples we have written so far work just fine, modifiers are not necessary to facilitate our learning so far.</p></div></div></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec17"/>Return type</h3></div></div></div><p>Next up is the <a class="indexterm" id="id284"/>
<code class="literal">return</code> type. Like a modifier, a <code class="literal">return</code> type <a class="indexterm" id="id285"/>is also optional, although it is more immediately useful to us. So let's look a bit closer. We have seen that our methods can get anything done. But what if we need the result from what they have done? The simplest example of a return type we have seen so far was this:</p><div><pre class="programlisting">
<strong>int</strong> addAToB(int a, int b){
  int answer = a + b;
  return answer;
}</pre></div><p>In this code, the <code class="literal">return</code> type in the signature is highlighted. So the <code class="literal">return</code> type is <code class="literal">int</code>. The <code class="literal">addAToB</code> method sends back (returns) to the code that called it a value that will fit in an <code class="literal">int</code> variable.</p><p>The <code class="literal">return</code> type can be any Java type we have seen so far. The method, however, does not have to return a value at all. In this case, the signature must use the <code class="literal">void</code> keyword as the <code class="literal">return</code> type. When the <code class="literal">void</code> keyword is used, the method body must not attempt to return a value as this will cause a compiler error. It can, however, use the <code class="literal">return</code> keyword without a value. Here are some combinations of return type and uses of the <code class="literal">return</code> keyword <a class="indexterm" id="id286"/>that are valid:</p><div><pre class="programlisting">void doSomething(){
  //our code

  //I'm done going back to calling code here
  //no return is necessary
}</pre></div><p>Another combination <a class="indexterm" id="id287"/>of <code class="literal">return</code> and <code class="literal">void</code> is as follows:</p><div><pre class="programlisting">void doSomethingElse(){
  //our code

  //I can do this as long as I don't try and add a value
  return;
}</pre></div><p>The following code is yet another combination of <code class="literal">return</code> and <code class="literal">void</code>:</p><div><pre class="programlisting">void doYetAnotherThing(){
  //some code
  if(someCondition){
    //if someCondition is true returning to calling code 
    //before the end of the method body
    return;
  }
  //More code that might or might not get executed
    
  return;
  //As I'm at the bottom of the method body 
  //and the return type is void, I'm 
  //really not necessary but I suppose I make it 
  //clear that the method is over.
}

String joinTogether(String firstName, String lastName){
  return firstName + lastName;
}</pre></div><p>We can call each of the <a class="indexterm" id="id288"/>preceding methods one by one, like this:</p><div><pre class="programlisting">//OK time to call some methods
doSomething();
doSomethingElse();
doYetAnotherThing();
String fullName = joinTogether("Jeff ","Minter")
//fullName now = Jeff Minter
//continue with code from here</pre></div><div><div><h3 class="title"><a id="note21"/>Note</h3><p>The preceding code would execute all the code statements in each method one by one. If the <a class="indexterm" id="id289"/>method signature had parameters, the code that calls the method would look slightly different.</p></div></div></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec18"/>Name of a method</h3></div></div></div><p>When we design <a class="indexterm" id="id290"/>our own methods, the method name is arbitrary, but there is a convention to use verbs that clearly explain what the method will do. Another <a class="indexterm" id="id291"/>convention is of the first letter of the first word in the name being lower case, and the first letter of each of the subsequent words being uppercase. This is <a class="indexterm" id="id292"/>called <strong>camel case</strong> because the shape the name can form has a hump in it:</p><div><pre class="programlisting">XGHHY78802c(){
  //code here
}</pre></div><p>This name is perfectly legitimate and will work. However, let's take a look at a much clearer example that uses the conventions:</p><div><pre class="programlisting">doSomeVerySpecificTask(){
  //code here
}

getMySpaceShipHealth(){
  //code here
}

startNewGame(){
  //code here
}</pre></div><p>These are much clearer method names.</p><p>Now let's take a <a class="indexterm" id="id293"/>look at parameters.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec19"/>Parameters</h3></div></div></div><p>We know that a <a class="indexterm" id="id294"/>method can return a result to the calling code. What if we need to share some data values from the calling code with the method? Parameters <a class="indexterm" id="id295"/>allow us to share values with the method. We have already seen an example with parameters when looking at return types. We will look at the same example but a little more closely:</p><div><pre class="programlisting">int addAToB(<strong>int a, int b</strong>){
  int answer = a + b;
  return answer;
}</pre></div><p>The parameters in this code are highlighted. Notice that in the first line of the method body, we use <code class="literal">a + b</code> as if they are already declared and initialized. Well, that's because they are. The parameters of the method signature is their declaration, and the code that calls the method initializes them:</p><div><pre class="programlisting">int returnedAnswer = addAToB(<strong>10,5</strong>);</pre></div><p>Also, as we have partly seen in previous examples, we don't have to use <code class="literal">int</code> in our parameters. We can use any Java type, including types we design ourselves. We can mix and match types as well. We can also use as many parameters as necessary to solve our problem. An example of mixed Java types might help:</p><div><pre class="programlisting">void addToAddressBook(char firstInitial, String lastName, String city, int age){
  //all the parameters are now living breathing,
  //declared and initialized variables

  //code to add details to address book goes here
}</pre></div><p>It's now time to get serious about our body.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec20"/>Getting things done in the method body</h3></div></div></div><p>The body is the <a class="indexterm" id="id296"/>part we have been avoiding so far with comments like this:</p><div><pre class="programlisting">//code here
    //some code</pre></div><p>But actually, we know exactly what to do here already. Any Java syntax we have learned so far will work in the body of a method. In fact, if we look back, all of the code we have written so far has been in a method, albeit somebody else's method. For example, we wrote code in the <code class="literal">onCreate</code> and <code class="literal">onClick</code> methods.</p><p>The best thing we can do next is write some methods that actually do something in the body.</p></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec47"/>Using methods</h2></div></div></div><p>We don't <a class="indexterm" id="id297"/>have to mess around with our math game project. We will quickly create a new blank project for each of the next two explorations into methods.</p><p>We also don't need to spend time making a UI. We will use the Android console to view the results and discuss the implications of our examples of methods. As we are using the Android console to view the results of our work with methods, we will need to run all of these examples on the Android emulator, not on a real device.</p><div><div><h3 class="title"><a id="note22"/>Note</h3><p>It is possible to set up a real device to output to the console, but we have not covered that in this book. If you want to find out more about using your actual device for debugging, take a look at the article at <a class="ulink" href="http://developer.android.com/tools/device.html">http://developer.android.com/tools/device.html</a>.</p></div></div><p>As usual, you can open the already typed code files in the usual way. The next two examples on methods can be found in the Packt Publishing code download in the <code class="literal">Chapter4</code> folder and the <code class="literal">AWorkingMethod</code> and <code class="literal">ExploringMethodOverloading</code> subfolders.</p><div><div><h3 class="title"><a id="tip30"/>Tip</h3><p>The following is a quick reminder on how to create a new blank project.</p></div></div><div><ol class="orderedlist arabic"><li class="listitem">Close any currently open projects by navigating to <strong>File</strong> | <strong>Close Project</strong>.</li><li class="listitem">Click on <strong>New Project...</strong>.</li><li class="listitem">The <strong>Create New Project</strong> configuration window will appear. Fill in the <strong>Application name</strong> field and <strong>Company Domain</strong> with <code class="literal">packtpub.com</code>, or you could use your own company website's name here instead.</li><li class="listitem">Now click on the <strong>Next</strong> button. On the next screen, ensure that the <strong>Phone and tablet</strong> checkbox has a tick in it. Now we have to choose the earliest version of Android we want to build our app for. Go ahead and play with a few options in the drop-down selector. You will see that the earlier the version we select, the greater the percentage of devices our app can support. However, the trade-off here is that the earlier the version we select, the fewer cutting-edge Android features we can have in our apps. A good balance is to select <strong>API 8: Android 2.2 (Froyo)</strong>. Go ahead and do that now as shown in the next screenshot.</li><li class="listitem">Click on <strong>Next</strong>. Now select <strong>Blank Activity </strong>and click on <strong>Next</strong> again.</li><li class="listitem">On the next screen, simply change <strong>Activity Name</strong> to <code class="literal">MainActivity</code> and click on <strong>Finish</strong>.</li><li class="listitem">As we did in <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>, to keep our code clear and simple, you can delete the two unneeded methods (<code class="literal">onCreateOptionsMenu</code> and <code class="literal">onOptionsItemSelected</code>) and their associated <code class="literal">@override</code> and <code class="literal">@import</code> statements, but this is not necessary for the example to work.</li></ol></div><p>For a detailed <a class="indexterm" id="id298"/>explanation and images of creating a new project, see <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>,
<em>Getting Started with Android</em>.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec21"/>A working method</h3></div></div></div><p>First, let's <a class="indexterm" id="id299"/>make ourselves a simple working method, complete with return types and a fully functioning body.</p><p>This method will take three numbers as parameters and return a <code class="literal">true</code> or <code class="literal">false</code> value to the calling code depending upon whether one of the three numbers was randomly generated within the method or not:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new blank project called <code class="literal">A Working Method</code>.</li><li class="listitem">In this method, we will use the <code class="literal">Random</code> class we saw earlier and its <code class="literal">randInt</code> method as a part of the demonstration. Copy the code for this method after the closing bracket of <code class="literal">onCreate</code> but before the closing bracket of <code class="literal">MainActivity</code>. When you are prompted to import any classes, simply click on <strong>OK</strong>:<div><pre class="programlisting">  boolean guessANumber(int try1, int try2, int try3){
  //all the Log.i lines print to the Android console
  Log.i("info", "Hi there, I am in the method body");
  //prove our parameters have arrived in the method
  //By printing them in the console
  Log.i("info", "try1 = " + try1);
  Log.i("info", "try2 = " + try2);
  Log.i("info", "try3 = " + try3);</pre></div></li><li class="listitem">Now we declare a Boolean variable called <code class="literal">found</code> and initialize it to <code class="literal">false</code>. We will change <a class="indexterm" id="id300"/><code class="literal">found</code> to <code class="literal">true</code> if and when we guess the random number correctly. Next, we declare our random number and print some useful values to the console:<div><pre class="programlisting">  //we use the found variable to store our true or false
  //setting it to false to begin with
  boolean found = false;
  
  //Create an object of the Random class so we can use it
  Random randInt = new Random();
  //Generate a random number between 0 and 5
  int randNum = randInt.nextInt(6);
  //show our random number in the console
  Log.i("info", "Our random number = " + randNum);</pre></div></li><li class="listitem">The last portion of code in our method tests to see whether there is a match for any of our passed-in parameters, prints some output, and then returns <code class="literal">true</code> or <code class="literal">false</code> using the <code class="literal">found</code> variable to the calling code in the <code class="literal">onCreate</code> method:<div><pre class="programlisting">  //Check if any of our guesses are the same as randNum
  if(try1 == randNum || try2 == randNum || try3 == randNum){
    found = true;
    Log.i("info", "aha!");
   }else{
     Log.i("info", "hmmm");
   }

  return found;
 }</pre></div></li><li class="listitem">Now write this code just before the closing bracket of the <code class="literal">onCreate</code> method to call the code and print some values to the Android console:<div><pre class="programlisting">//all the Log.i lines print to the Android console
Log.i("info", "I am in the onCreate method");

//Call guessANumber with three values
//and if true is returned output - Found it!
if(guessANumber( 1,2,3 )) {
  Log.i("info", "Found It!");
}else{//guessANumber returned false -didn't find it
  Log.i ("info", "Can't find it");
}

//continuing with the rest of the program now
Log.i("info", "Back in onCreate");</pre></div></li><li class="listitem">Launch an emulator.</li><li class="listitem">Run the app on the emulator.</li><li class="listitem">All our console messages have a tag called <strong>info</strong>. The console window will already have appeared underneath the editor window. We can filter its contents to <a class="indexterm" id="id301"/>only show our messages by typing <code class="literal">info</code> in the search box, as shown in the following screenshot:<div><img alt="A working method" src="img/8859OS_04_02.jpg"/></div></li></ol></div><p>In the preceding screenshot, you can see the search filter and the console output. We will now run through the code and explain the output.</p><p>For clarity, here is the precise console output, without the extraneous date, time, and package name added to the beginning of each line. Remember that we are dealing with a random number, so your output may vary:</p><div><pre class="programlisting">
<strong>info: I am in the onCreate method</strong>
<strong>info﹕Hi there, I am in the method body</strong>
<strong>info﹕try1 = 1</strong>
<strong>info﹕try2 = 2</strong>
<strong>info﹕try3 = 3</strong>
<strong>info﹕Our random number = 0</strong>
<strong>info﹕hmmm</strong>
<strong>info﹕Can't find it</strong>
<strong>info﹕Back in onCreate</strong>
</pre></div><p>Here is what is happening. In step 2, we started writing our first method. We called it <code class="literal">guessANumber</code>. It has three <code class="literal">int</code> parameters and will return a Boolean. Remember that these three <code class="literal">int</code> <a class="indexterm" id="id302"/>parameters become fully initialized variables. First of all, however, in our method, we simply output the values of the new variables passed in as parameters as well as a message confirming that the code in our method is currently being executed:</p><div><pre class="programlisting">boolean guessANumber(int try1, int try2, int try3){
  //all the Log.i lines print to the Android console
  Log.i("info", "Hi there, I am in the method body");
  //prove our parameters have arrived in the method
  //By printing them in the console
  Log.i("info", "try1 = " + try1);
  Log.i("info", "try2 = " + try2);
  Log.i("info", "try3 = " + try3);</pre></div><p>In step 3, we added more code to our method. We declared and initialized a Boolean variable called <code class="literal">found</code>, which we will use to return a value to the calling code and let the calling code know whether one of the parameters passed in was the same as the random number:</p><div><pre class="programlisting">//we use the found variable to store our true or false
//setting it to false to begin with
boolean found = false;</pre></div><p>Next (still in step 3), we generated a random number in the same way as we did earlier in the chapter. We also used <code class="literal">Log</code> to output the random number so that we can examine what went on:</p><div><pre class="programlisting">//Create an object of the Random class so we can use it
Random randInt = new Random();
//Generate a random number between 0 and 5
int randNum = randInt.nextInt(6);
//show our random number in the console
Log.i("info", "Our random number = " + randNum);</pre></div><p>In step 4, we used an <code class="literal">if</code> statement with the logical OR operator to detect whether any of the passed-in parameters matches the random number we just generated, as shown in the following code:</p><div><pre class="programlisting">//Check if any of our guesses are the same as randNum
if(try1 == randNum || try2 == randNum || try3 == randNum){</pre></div><p>If the condition is true, that is, if any of <code class="literal">try1</code>, <code class="literal">try2</code>, or <code class="literal">try3</code> equals <code class="literal">randNum</code>, then the following code is run. Our <code class="literal">found</code> Boolean value is set to <code class="literal">true</code> and a message is printed:</p><div><pre class="programlisting">found = true;
Log.i("info", "aha!");</pre></div><p>If the condition is not true, the <code class="literal">else</code> statement is executed, a different message is printed, and the <code class="literal">found</code> variable is left the same as it was—<code class="literal">false</code>:</p><div><pre class="programlisting">}else{
  Log.i("info", "hmmm");
}</pre></div><p>Finally, in our <a class="indexterm" id="id303"/>method, we return the <code class="literal">found</code> variable, which will be either <code class="literal">true</code> or <code class="literal">false</code>, to the calling code:</p><div><pre class="programlisting">  return found;
 }</pre></div><p>Now we look at step 5, which is the code in the <code class="literal">onCreate</code> method, which calls our <code class="literal">guessANumber</code> method in the first place. We start by simply printing a message saying that we are in <code class="literal">onCreate</code> at the moment:</p><div><pre class="programlisting">//all the Log.i lines print to the Android console
Log.i("info", "I am in the onCreate method");</pre></div><p>Then we make the call to <code class="literal">guessANumber</code> with the three parameters. In this case, we use 1, 2, and 3, but any <code class="literal">int</code> values would have worked. However, we wrap the call in an <code class="literal">if</code> statement. This means that the <code class="literal">return</code> value from the method will be used to evaluate the <code class="literal">if</code> statement. Simply put, if <code class="literal">true</code> is returned, the <code class="literal">if</code> statement will be executed and "<strong>Found It</strong>!" will be printed:</p><div><pre class="programlisting">//Call guessANumber with three values
//and if true is returned output - Found it!
if(guessANumber(1,2,3)){
  Log.i("info", "Found It!");
  }</pre></div><p>On the contrary, if <code class="literal">false</code> is returned, the <code class="literal">else</code> statement gets executed and "<strong>Can't find it</strong>" is printed:</p><div><pre class="programlisting">else{//guessANumber returned false -didn't find it
  Log.i ("info", "Can't find it");
}

//continuing with the rest of the program now
Log.i("info", "Back in onCreate");</pre></div><p>Remember that <a class="indexterm" id="id304"/>we are dealing with random numbers, so you might need to run it a few times before you see this output:</p><div><img alt="A working method" src="img/8859OS_04_03.jpg"/></div><p>Of course, you should note that the guesses sent to the function as parameters are arbitrary. As long as all the numbers are between 0 and 5 and are not duplicated, they will together have a 50 percent chance of finding the random number.</p><p>On a closing note, if you've to read only one tip in this whole book, it should be this one.</p><div><div><h3 class="title"><a id="tip31"/>Tip</h3><p>Printing variable values to the console is a great way to examine what is going on inside your game and to find bugs.</p></div></div><p>Let's look at <a class="indexterm" id="id305"/>another example of methods.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec22"/>Exploring method overloading</h3></div></div></div><p>As we are learning, methods are really diverse and deep as a topic, but hopefully, taking a step at a time, we <a class="indexterm" id="id306"/>will see they are not daunting in any way. We will be using what we have learned about methods when we enhance our math game. We will be exploring methods even more deeply in <a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work">Chapter 6</a>, <em>OOP – Using Other People's Hard Work</em>. For now, however, it will serve us well to look at one more topic on methods. Let's <a class="indexterm" id="id307"/>create a new project to explore <strong>method</strong> <strong>overloading</strong>.</p><p>As we will now see, we can create more than one method with the same name, provided the parameters are different. The code in this project is vastly simpler than that of the last project. It is how this code works that might appear slightly curious until we analyze it later:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new blank project called <code class="literal">Exploring Method Overloading</code>.</li><li class="listitem">In the first method, we will simply call it <code class="literal">printStuff</code> and pass an <code class="literal">int</code> variable via a parameter to be printed. Copy the code for this method after the closing bracket of <code class="literal">onCreate</code> but before the closing bracket of <code class="literal">MainActivity</code>. When you are prompted to import any classes, simply click on <strong>OK</strong>:<div><pre class="programlisting">void printStuff(int myInt){
  Log.i("info", "This is the int only version");
  Log.i("info", "myInt = "+ myInt);
}</pre></div></li><li class="listitem">We will also call the second method <code class="literal">printStuff</code> but pass a <code class="literal">string</code> variable to be printed. Copy the code for this method after the closing bracket of <code class="literal">onCreate</code> but before the closing bracket of <code class="literal">MainActivity</code>. Again, when you are prompted to import any classes, simply click on <strong>OK</strong>:<div><pre class="programlisting">void printStuff(String myString){
  Log.i("info", "This is the String only version");
  Log.i("info", "myString = "+ myString);
}</pre></div></li><li class="listitem">Yet again, we will call this third method <code class="literal">printStuff</code> but pass a <code class="literal">string</code> variable and an <code class="literal">int</code> variable to be printed. As before, copy the code for this method after the closing bracket of <code class="literal">onCreate</code> but before the closing bracket of <code class="literal">MainActivity</code>:<div><pre class="programlisting">void printStuff(int myInt, String myString){
  Log.i("info", "This is the combined int and String version");
  Log.i("info", "myInt = "+ myInt);
  Log.i("info", "myString = "+ myString);
}</pre></div></li><li class="listitem">Now write <a class="indexterm" id="id308"/>this code just before the closing <a class="indexterm" id="id309"/>bracket of the <code class="literal">onCreate</code> method to call the methods and print some values to the Android console:<div><pre class="programlisting">//declare and initialize a String and an int
int anInt = 10;
String aString = "I am a string";
        
//Now call the different versions of printStuff
//The name stays the same, only the parameters vary
printStuff(anInt);
printStuff(aString);
printStuff(anInt, aString);</pre></div></li><li class="listitem">Launch an emulator.</li><li class="listitem">Run the app on the emulator.</li></ol></div><p>Here is the console output:</p><div><pre class="programlisting">
<strong>info﹕ This is the int only version</strong>
<strong>info﹕ myInt = 10</strong>
<strong>info﹕ This is the String only version</strong>
<strong>info﹕ myString = I am a string</strong>
<strong>info﹕ This is the combined int and String version</strong>
<strong>info﹕ myInt = 10</strong>
<strong>info﹕ myString = I am a string</strong>
</pre></div><p>As you can see, Java has treated three methods with the same name as totally different methods. This, as we have just demonstrated, can be really useful. It is called <strong>method overloading</strong>.</p><div><div><h3 class="title"><a id="tip32"/>Tip</h3><p><strong>Method overloading and overriding confusion</strong></p><p>Overloading and overriding are defined as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Overloading occurs when we have more than one method with the same name but different parameters</li><li class="listitem" style="list-style-type: disc">Overriding occurs when we essentially replace a method with the same name and the same parameter list</li></ul></div><p>We know enough about overloading and overriding to complete this book, but if you are brave and your mind is wandering, you can override an overloaded method. However, that is something for another time.</p></div></div><p>This is how the <a class="indexterm" id="id310"/>preceding code works. In each of the three steps (2, 3, and 4), we create a method called <code class="literal">printStuff</code>, but each <code class="literal">printStuff</code> method <a class="indexterm" id="id311"/>has different parameters, so each is a different method that can be called individually:</p><div><pre class="programlisting">void printStuff(int myInt){
...
}

void printStuff(String myString){
...
}

void printStuff(int myInt, String myString){
...
}</pre></div><p>The body of each of the methods is simple. It just prints the passed-in parameters and confirms which version of the method is being called currently.</p><p>The next important part of our code is when we make it plain which method we want to call, using the appropriate parameters. In step 5, we call each of them in turn, using the appropriate parameters so that Java knows the exact method required:</p><div><pre class="programlisting">printStuff(anInt);
printStuff(aString);
printStuff(anInt, aString);</pre></div><p>Now we know more than enough about methods, loops, and random numbers to make some <a class="indexterm" id="id312"/>improvements to our math game.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec31"/>Enhancing our math game</h1></div></div></div><p>We are going to <a class="indexterm" id="id313"/>add some features to our math game using what we have just learned about methods and loops.</p><p>As usual, the code is available for copying in the <code class="literal">Chapter4</code> folder of the code download. The project is in the <code class="literal">MathGameChapter4</code> subfolder and encompasses all the remaining phases of improvement covered in this chapter, including enhancing the UI, amending our game activity, <code class="literal">setQuestion</code>, <code class="literal">updateScoreAndLevel</code>, <code class="literal">isCorrect</code>, and calling our new methods.</p><p>We will make the game change the question after each time we attempt the answer.</p><p>We will also add difficulty levels to questions and random questions but within a range appropriate for that difficulty level.</p><p>We will show and update our score. The score goes up faster depending on the difficulty level of the question answered correctly.</p><p>If the player gets a question wrong, the difficulty goes back to the easiest level and the score to zero.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec48"/>Enhancing the UI</h2></div></div></div><p>Let's get on <a class="indexterm" id="id314"/>with modifying our math game UI to incorporate our new game features. We will be adding a TextView to display the score and another TextView to display the level.</p><div><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">activity_game.xml</code> file in the editor window. We will add a new TextView to the very bottom of our UI for our score.</li><li class="listitem">Drag a <strong>Large Text</strong> element from <strong>Palette</strong> and place it to the left, below our three answer buttons.</li><li class="listitem">Now we need to change the <strong>id</strong> property so that we can access our new TextView from our Java code. Ensure that the new TextView is selected by clicking on it. Now, in the <strong>Properties</strong> window, change the <strong>id</strong> property to <code class="literal">textScore</code>.</li><li class="listitem">For the sake of clarity (although this step serves no use in programming), change the <strong>text</strong> property to <code class="literal">Score:999</code>.</li><li class="listitem">Now put another <strong>Large Text</strong> element to the right of the one we just configured and change the <strong>id</strong> property to <code class="literal">textLevel</code>. The lower part of our UI should now look like this:<div><img alt="Enhancing the UI" src="img/8859OS_04_10.jpg"/></div></li><li class="listitem">Once again, for the sake of clarity (although this step serves no use in programming), change the <strong>text</strong> property to <code class="literal">Level:4</code>.</li><li class="listitem">Save the project.</li></ol></div><p>We have just added <a class="indexterm" id="id315"/>two new TextView elements and assigned them both an ID that we can refer to in our Java code.</p><div><div><h3 class="title"><a id="tip34"/>Tip</h3><p>You have probably realized by now that the precise layout and size of our UI elements are unimportant as far as getting the game to work is concerned. This gives us a lot of flexibility in designing layouts for different screen sizes. As long as each layout for each screen size contains the same element types with the same IDs, the same Java code will work for different layouts. If you want to know more about designing for multiple screen sizes, take a look at <a class="ulink" href="http://developer.android.com/training/multiscreen/screensizes.html">http://developer.android.com/training/multiscreen/screensizes.html</a>.</p></div></div><p>Now that we have our enhanced UI and an understanding of how the Java <code class="literal">Random</code> class works, we can add the Java code to implement our new features.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec49"/>The new Java code</h2></div></div></div><p>As previously <a class="indexterm" id="id316"/>explained, the project code is available in the <code class="literal">Chapter4</code> folder of the downloadable code. The project is called <code class="literal">MathGameChapter4</code> and encompasses all the improvements covered in this chapter.</p><p>In this phase, we will be adding lots of new code, moving some existing code, and modifying some existing code too. As so much is changing, we are going to approach the code from the very beginning. The new code will be explained completely, the code that has moved will be pointed out with a reason, and the code that has stayed the same and in the same place will have the least explanation.</p><p>We will first make some modifications and deletions to our existing code. We will then look at designing and implementing each of our new methods to improve our code and add our new features.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec23"/>Amending GameActivity</h3></div></div></div><p>First, let's <a class="indexterm" id="id317"/>perform the necessary amendments and deletions to our current code:</p><div><ol class="orderedlist arabic"><li class="listitem">Open <a class="indexterm" id="id318"/>the <code class="literal">GameActivity.java</code> file in the editor window.</li><li class="listitem">We now need to consider the scope of the objects that represent our UI elements. Both <code class="literal">textObjectPartA</code> and <code class="literal">textObjectPartB</code> need to be accessible from the methods we will be creating soon. So let's move their declarations, as we did with the multi-choice buttons in the previous chapter, out of the <code class="literal">onCreate</code> method so that they are accessible everywhere in our <code class="literal">GameActivity</code> class. The following code shows all our declarations so far. They are present immediately after the start of the <code class="literal">GameActivity</code> class. The recently added (or moved) declarations are highlighted. Notice that we have also added declarations for our two new TextViews and for the score and level displays. In addition, there are two new <code class="literal">int</code> variables that we can manipulate for our score and to keep track of our level. They are <code class="literal">currentScore</code> and <code class="literal">currentLevel</code>:<div><pre class="programlisting">public class GameActivity extends Activity implements View.OnClickListener{

    int correctAnswer;
    Button buttonObjectChoice1;
    Button buttonObjectChoice2;
    Button buttonObjectChoice3;
    <strong>TextView textObjectPartA;</strong>
<strong>    TextView textObjectPartB;</strong>
<strong>    TextView textObjectScore;</strong>
<strong>    TextView textObjectLevel;</strong>
<strong>  </strong>
<strong>    int currentScore = 0;</strong>
<strong>    int currentLevel = 1;</strong>
</pre></div></li><li class="listitem">All of the code that assigns text to our Buttons or TextViews objects, and the code that <a class="indexterm" id="id319"/>initializes the parts of our question and assigns the values for our wrong answers, are now going to change <a class="indexterm" id="id320"/>and move, so we need to delete it all. Everything shown in the following code is to be deleted:<div><pre class="programlisting">//Here we initialize all our variables
int partA = 9;
int partB = 9;
correctAnswer = partA * partB;
int wrongAnswer1 = correctAnswer - 1;
int wrongAnswer2 = correctAnswer + 1;</pre></div></li><li class="listitem">The following code snippet needs to be deleted too:<div><pre class="programlisting">//Now we use the setText method of the class on our objects
//to show our variable values on the UI elements.
textObjectPartA.setText("" + partA);
textObjectPartB.setText("" + partA);

//which button receives which answer, at this stage is arbitrary.
buttonObjectChoice1.setText("" + correctAnswer);
buttonObjectChoice2.setText("" + wrongAnswer1);
buttonObjectChoice3.setText("" + wrongAnswer2);</pre></div></li><li class="listitem">For clarity and context, here is the entire <code class="literal">onCreate</code> method as it currently stands. There is nothing new here, but you can see your code, which links our Button and TextView objects that we declared in step 2. Again, this code includes our two new TextViews, which are highlighted, but everything else, which is described in steps 3 and 4, is deleted. As before, there is a piece of code that makes our game listen to button clicks:<div><pre class="programlisting">protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        //The next line loads our UI design to the screen
        setContentView(R.layout.activity_game);


        /*Here we get a working object based on either the button
          or TextView class and base as well as link our new objects
          directly to the appropriate UI elements that we created previously*/
        textObjectPartA = (TextView)findViewById(R.id.textPartA);

        textObjectPartB = (TextView)findViewById(R.id.textPartB);

<strong>        textObjectScore = (TextView)findViewById(R.id.textScore);</strong>

<strong>        textObjectLevel = (TextView)findViewById(R.id.textLevel);</strong>

        buttonObjectChoice1 = (Button)findViewById(R.id.buttonChoice1);

        buttonObjectChoice2 = (Button)findViewById(R.id.buttonChoice2);

        buttonObjectChoice3 = (Button)findViewById(R.id.buttonChoice3);

        buttonObjectChoice1.setOnClickListener(this);
        buttonObjectChoice2.setOnClickListener(this);
        buttonObjectChoice3.setOnClickListener(this);

}//onCreate ends here</pre></div></li><li class="listitem">Now we will delete some more code that we don't need because we are going to make it more efficient by compartmentalizing it into our new methods and adding our new features at the same time. So in our <code class="literal">onClick</code> method, in each case of <a class="indexterm" id="id321"/>our <code class="literal">switch</code> statement, we want to <a class="indexterm" id="id322"/>delete the <code class="literal">if</code> and the <code class="literal">else</code> statements. We will be completely rewriting these, but we will leave in place the code that initializes our <code class="literal">answerGiven</code> variable. Our <code class="literal">onClick</code> method will now look like this:<div><pre class="programlisting">@Override
    public void onClick(View view) {
        //declare a new int to be used in all the cases
        int answerGiven=0;
        switch (view.getId()) {

            case R.id.buttonChoice1:
                //initialize a new int with the value contained in buttonObjectChoice1
                //Remember we put it there ourselves previously
                answerGiven = Integer.parseInt("" + buttonObjectChoice1.getText());
                
                break;

            case R.id.buttonChoice2:
                //same as previous case but using the next button
                answerGiven = Integer.parseInt("" + buttonObjectChoice2.getText());
                
                break;

            case R.id.buttonChoice3:
                //same as previous case but using the next button
                answerGiven = Integer.parseInt("" + buttonObjectChoice3.getText());
                
                break;

        }

    }</pre></div></li><li class="listitem">Save your project.</li></ol></div><p>Wow! That was a lot of code, but as we saw along the way, there were no new concepts. In step 2, we <a class="indexterm" id="id323"/>simply moved the initialization of our Button and <a class="indexterm" id="id324"/>TextView objects to a place where they will now be visible from anywhere within our class.</p><p>In steps 3 and 4, we did a fair bit of deletion because we will no longer be making the question or populating the multi-choice buttons in <code class="literal">onCreate</code>, as this is not flexible enough. We will soon see how we improve on this.</p><p>In step 6, we deleted the code that tested whether the answer was correct or incorrect. However, as we saw, we still initialized the <code class="literal">answerGiven</code> variable in the same way—in the appropriate case of our <code class="literal">switch</code> statement in the <code class="literal">onClick</code> method.</p><p>Great! Now <a class="indexterm" id="id325"/>we are ready to consider and design some new <a class="indexterm" id="id326"/>methods to compartmentalize our code, avoid repetitions in it, and add our extra features. Consider the following methods that we will soon implement.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec24"/>The methods</h3></div></div></div><p>We will <a class="indexterm" id="id327"/>now walk through writing some methods. As we will see, the methods will compartmentalize our code and prevent the implementation of our new features from causing the code to become too long and sprawling:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We will write a <code class="literal">setQuestion</code> method to prepare a question of appropriate difficulty.</li><li class="listitem" style="list-style-type: disc">We will write an <code class="literal">updateScoreAndLevel</code> method that will do just that. We will also write an <code class="literal">isCorrect</code> method that one of our other methods will use to evaluate the correctness of the answer.</li><li class="listitem" style="list-style-type: disc">Then we will strategically place the code that calls our new methods.</li></ul></div><p>We will do each of these tasks one at a time and explain the code along the way, as leaving the explanation to the end will make referring to individual steps cumbersome.</p><p>We will use many of the features of Java that we learned in this chapter and the previous chapter. These include the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Methods</li><li class="listitem" style="list-style-type: disc">A <code class="literal">for</code> loop</li><li class="listitem" style="list-style-type: disc">The switch control structure</li></ul></div><p>So let's get started with our first method.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec25"/>The setQuestion method</h3></div></div></div><p>We determined <a class="indexterm" id="id328"/>that we needed a method to prepare a <a class="indexterm" id="id329"/>question for us; <code class="literal">setQuestion</code> seems like a decent name for such a method. Every time our player gives an answer by tapping one of the three multi-choice buttons, a new question will need to be prepared.</p><p>This method will need to generate values for our <code class="literal">partA</code> and <code class="literal">partB</code> variables as well as show them in our TextViews referenced by the <code class="literal">textObjectPartA</code> and <code class="literal">textObjectPartB</code> objects. In addition, the method will need to assign the new correct answer to our <code class="literal">correctAnswer</code> variable, which will then be used to calculate some suitable incorrect answers. Finally, the method will show both the correct and incorrect answers on our multi-choice buttons.</p><p>Furthermore, our <code class="literal">setQuestion</code> method will need to take into account the level held in <code class="literal">currentLevel</code> to determine the range or difficulty of the question it will ask. Let's go through the code. If you want to type this code as we go, then just make sure you place it after the closing <a class="indexterm" id="id330"/>bracket of <code class="literal">onClick</code> but before the closing bracket of our <code class="literal">GameActivity</code> class:</p><div><ol class="orderedlist arabic"><li class="listitem">First of <a class="indexterm" id="id331"/>all, we have the method signature and the opening curly brace before the body of our method:<div><pre class="programlisting">void setQuestion(){</pre></div></li><li class="listitem">This tells us that the return type is <code class="literal">void</code>, so <code class="literal">setQuestion</code> will not return a value to the code that calls it. Also, there are no parameters here, so it does not need any value passed for it to work. Let's see what it does. Now we enter the code to generate the two parts of the question:<div><pre class="programlisting">//generate the parts of the question
int numberRange = currentLevel * 3;
Random randInt = new Random();

int partA = randInt.nextInt(numberRange);
partA++;//don't want a zero value

int partB = randInt.nextInt(numberRange);
partB++;//don't want a zero value</pre></div></li><li class="listitem">In the previous step, we declared a new <code class="literal">int</code> variable, <code class="literal">numberRange</code>, and initialized it by multiplying the player's <code class="literal">currentLevel</code> value by <code class="literal">3</code>. Then we got a new <code class="literal">Random</code> object called <code class="literal">randInt</code> and used it to generate new values based on <code class="literal">numberRange</code>. We did this to the <code class="literal">partA</code> and <code class="literal">partB</code> variables. As the value of <code class="literal">currentLevel</code> increases, so potentially does the difficulty of the question. Now, just as we have written in the past, we write this:<div><pre class="programlisting">correctAnswer = partA * partB;
int wrongAnswer1 = correctAnswer-2;
int wrongAnswer2 = correctAnswer+2;

textObjectPartA.setText(""+partA);
textObjectPartB.setText(""+partB);</pre></div></li><li class="listitem">We assigned the answer of our new multiplication question to <code class="literal">correctAnswer</code>. Then we declared and assigned two incorrect answers to the new <code class="literal">int</code> variables, <code class="literal">wrongAnswer1</code> and <code class="literal">wrongAnswer2</code>. We also used the <code class="literal">setText</code> method of our TextView objects to display the question to the player. Notice <a class="indexterm" id="id332"/>that we have not yet displayed <a class="indexterm" id="id333"/>the correct and incorrect answers. Here it is. Try to work out what is happening here:<div><pre class="programlisting">//set the multi choice buttons
//A number between 0 and 2
int buttonLayout = randInt.nextInt(3);
switch (buttonLayout){
  
case 0:
buttonObjectChoice1.setText(""+correctAnswer);
buttonObjectChoice2.setText(""+wrongAnswer1);
buttonObjectChoice3.setText(""+wrongAnswer2);
   break;

   
case 1:

buttonObjectChoice2.setText(""+correctAnswer);
buttonObjectChoice3.setText(""+wrongAnswer1);
buttonObjectChoice1.setText(""+wrongAnswer2);
   break;


case 2:
buttonObjectChoice3.setText(""+correctAnswer);
buttonObjectChoice1.setText(""+wrongAnswer1);
buttonObjectChoice2.setText(""+wrongAnswer2);
   break;
 }

}</pre></div></li><li class="listitem">In the preceding code, we used our <code class="literal">Rando</code>m object, <code class="literal">randInt</code>, to generate a number between 0 and 2, and assigned the value to a new <code class="literal">int</code> variable called<code class="literal"> buttonLayou</code>t. We then used <code class="literal">buttonLayou</code>t to switch between all its possible values: 0, 1, or 2. Each <code class="literal">case</code> statement sets the correct and incorrect answers to the multi-choice buttons in a slightly different order, so the player can't just keep tapping the same button over and over to achieve a massive score. Notice the extra closing bracket after the closing bracket of the switch. This is the end of our <code class="literal">setQuestion</code> method.</li></ol></div><p>We explained the code fairly thoroughly as we went through it but it might be worthwhile to just take a closer look at some parts again.</p><p>In step 1, we saw our method signature with a <code class="literal">void</code> return type and no parameters. In step 2, we generated some random numbers that will be within a certain range. This range isn't as obvious as it might seem at first. First, we assigned, declared, and initialized <code class="literal">numberRange</code> like this:</p><div><pre class="programlisting">int numberRange = currentLevel * 3;</pre></div><p>So if the player is <a class="indexterm" id="id334"/>at the first question, then <code class="literal">currentLevel</code> <a class="indexterm" id="id335"/>will hold the value <code class="literal">1</code> and <code class="literal">numberRange</code> will be initialized as <code class="literal">3</code>. Then we made a new <code class="literal">Random</code> object as previously discussed and entered this line of code:</p><div><pre class="programlisting">int partA = randInt.nextInt(numberRange);</pre></div><p>What occurs here is that the <code class="literal">nextInt</code> method of the <code class="literal">Random</code> object, <code class="literal">randInt</code>, will return a value of either 0, 1, or 2 because we have given it a seed of 3. We don't want any zeros in our game because they result in very easy multiplication, so we enter this:</p><div><pre class="programlisting">partA++;//don't want a zero value</pre></div><p>This operator, which you probably remember from <a class="link" href="ch03.html" title="Chapter 3. Speaking Java – Your First Game">Chapter 3</a>, <em>Speaking Java – Your First Game</em>, when we discussed operators, adds 1 to <code class="literal">partA</code>. We then do exactly the same to our <code class="literal">partB</code> variable, which means that assuming that the player is still on level 1, they will have a question that will be one of the following:</p><p>1 x 1, 1 x 2, 1 x 3, 2 x 1, 2 x 2, 2 x 3, 3 x 1, 3 x 2, or 3 x 3</p><p>As the level increases, the potential range of the question increases significantly. So at level 2, the options are that either part of the question could be from 1 to 6; for level 3, from 1 to 9; and so on. It is still possible to get an easy question on a higher level but it becomes less likely as the levels advance. Finally in this step, we display the question to the player using the <code class="literal">setText</code> method.</p><p>In step 3, we have seen before but this time we varied it slightly. We calculate and assign a value for <code class="literal">correctAnswer</code>, and declare and assign values to <code class="literal">wrongAnswer1</code> and <code class="literal">wrongAnswer2</code>, which will hold the wrong answer choices for our buttons.</p><p>Part 3 varies very slightly from what we did in <code class="literal">onCreate</code> in the previous chapter because we subtract and add 2 to <code class="literal">wrongAnswer1</code> and <code class="literal">wrongAnswer2</code>, respectively. This makes guessing the answer to multiplication questions a little harder because you can't eliminate answers based on whether they are odd or even.</p><p>Step 4 simply randomizes which buttons the correct and incorrect answers will be placed on. We don't need to keep track of this because when the time comes to compare the value on the button <a class="indexterm" id="id336"/>pressed with the correct answer, we can simply <a class="indexterm" id="id337"/>use our Java code to discover it as we did in <a class="link" href="ch03.html" title="Chapter 3. Speaking Java – Your First Game">Chapter 3</a>, <em>Speaking Java – Your First Game</em>.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec26"/>The updateScoreAndLevel method</h3></div></div></div><p>The <a class="indexterm" id="id338"/>name of this method speaks for itself. Because <a class="indexterm" id="id339"/>the keeping of the score is not simple and because we want higher levels to yield higher scores, we will compartmentalize the code to keep our program readable. If we then want to make modifications to the scoring system, they can all take place in there.</p><p>Let's write the code.</p><div><ol class="orderedlist arabic"><li class="listitem">This code can go anywhere within the opening and closing braces of <code class="literal">GameActivity {}</code>, but it is good practice to place them in the approximate order they will be used. So why not start adding your code after the closing brace of <code class="literal">setQuestion</code> but obviously before the closing brace of <code class="literal">GameActivity</code>? Here is the method signature with the opening brace:<div><pre class="programlisting">void updateScoreAndLevel(int answerGiven){</pre></div></li><li class="listitem">This tells us that our method does not return a value but that it does receive an <code class="literal">int</code>, which it will require to do its stuff. The name of the parameter is a big clue to what we will be passing. We will see that in action in the body in a minute, but if passing the player's answer to this method instead of the <code class="literal">isCorrect</code> method is a bit confusing, we will see things become clearer in the next chunk of code. Here is the next part of the code to add:<div><pre class="programlisting">if(isCorrect(answerGiven)){
  for(int i = 1; i &lt;= currentLevel; i++){
    currentScore = currentScore + i;
   }

   currentLevel++;
}</pre></div></li><li class="listitem">There is a lot happening here, so we will dissect it more once we have the method completed. Basically, it calls the <code class="literal">isCorrect</code> method (which we will write soon) and if the response is <code class="literal">true</code>, adds to the player's score in a <code class="literal">for</code> loop. After that, the method adds 1 to <code class="literal">currentLevel</code>. Here comes the <code class="literal">else</code> part of the code in case the response from <code class="literal">isCorrect</code> is <code class="literal">false</code>:<div><pre class="programlisting">else{
  currentScore = 0;
  currentLevel = 1;
}</pre></div></li><li class="listitem">If the <a class="indexterm" id="id340"/>response is <code class="literal">false</code>, that is, if the player got the answer wrong, the <code class="literal">currentScore</code> variable is set to <code class="literal">0</code> and the level back to <code class="literal">1</code>. Finally for this method, we type the following:<div><pre class="programlisting">  //Actually update the two TextViews
  textObjectScore.setText("Score: " + currentScore);
  textObjectLevel.setText("Level: " + currentLevel);
}</pre></div></li><li class="listitem">In the previous step, we updated the actual TextViews that the player sees with the <a class="indexterm" id="id341"/>newly determined score and level. The method then ended and the control of the program returned to the code that called <code class="literal">updateScoreAndLevel</code> to begin with. Save your project.</li></ol></div><p>We explained most of the code as we went but it might be good to quickly review it and dig a bit deeper into certain parts, especially the call to <code class="literal">isCorrect</code> in that odd-looking <code class="literal">if</code> statement.</p><p>In step 1, we began with the method signature. Then in step 2, we began with the aforementioned curious <code class="literal">if</code>:</p><div><pre class="programlisting">if(isCorrect(answerGiven)){</pre></div><p>We have seen this type of statement before in the <em>A working method</em> example in the <em>Methods</em> section of this chapter. What is happening here is that the call to <code class="literal">isCorrect</code> is replacing the statement to be evaluated, or rather it <em>is</em> the statement to be evaluated. So <code class="literal">isCorrect</code> is called with the <code class="literal">answerGiven</code> variable. The <code class="literal">answerGiven</code> variable, as you might remember, was passed to <code class="literal">updateScoreAndLevel</code>. This time, it is passed to the <code class="literal">isCorrect</code> method, which will do some work with it and perhaps a few other things. Then it will return to the <code class="literal">if</code> statement a value of <code class="literal">true</code> or <code class="literal">false</code>. The value will be true if the question is answered correctly and false if not.</p><p>Assuming the <code class="literal">if</code> statement evaluates to true, the program runs this bit of code (also from step 2):</p><div><pre class="programlisting">for(int i = 1; i &lt;= currentLevel; i++){
  currentScore = currentScore + i;
}

currentLevel++;</pre></div><p>The code enters a <code class="literal">for</code> loop where the starting variable <code class="literal">i</code> is initialized to 1 like this: <code class="literal">int i = 1;</code>. Furthermore, the loop is instructed to continue as long as <code class="literal">i</code> is less than or equal to our <code class="literal">currentLevel</code> variable. Then within the <code class="literal">for</code> loop, we add <code class="literal">i</code> to the current score. As an example, let's assume that the player has just got a question correct and we enter the <code class="literal">for</code> loop <a class="indexterm" id="id342"/>with <code class="literal">currentLevel</code> at 1. The player's <a class="indexterm" id="id343"/>score is still at 0 because this is their first correct answer.</p><p>At pass 1, we get the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">i = 1</code>, so it is equal to <code class="literal">currentLevel</code>, which is also 1. So we enter the <code class="literal">for</code> loop</li><li class="listitem" style="list-style-type: disc"><code class="literal">i = 1</code>, so <code class="literal">currentScore</code> equals 0</li><li class="listitem" style="list-style-type: disc">We add <code class="literal">i</code>, which is <code class="literal">1</code>, to <code class="literal">currentScore</code></li><li class="listitem" style="list-style-type: disc">Our <code class="literal">currentScore</code> variable is now equal to <code class="literal">1</code></li></ul></div><p>At pass 2, the following steps take place:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">i</code> is incremented to 2, so it is now greater than <code class="literal">currentLevel</code>, which is 1</li><li class="listitem" style="list-style-type: disc">The <code class="literal">for</code> loop condition evaluates to <code class="literal">false</code> and we continue with the code after the <code class="literal">for</code> loop</li><li class="listitem" style="list-style-type: disc"><code class="literal">currentLevel</code> is increased by 1 to 2</li></ul></div><p>Now let's look at that <code class="literal">for</code> loop again assuming that the player gets the next question correct as well, and we are back in <code class="literal">updateScoreAndLevel</code>. This time, <code class="literal">isCorrect</code> has evaluated true and we enter the <code class="literal">for</code> loop but with a slightly different situation than the last time.</p><p>At pass 1, the following steps take place:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">i = 1</code>, so <code class="literal">i</code> is less than <code class="literal">currentLevel</code> is 2 and we enter the <code class="literal">for</code> loop</li><li class="listitem" style="list-style-type: disc"><code class="literal">i = 1</code>, <code class="literal">currentScore</code> <code class="literal">= 1</code></li><li class="listitem" style="list-style-type: disc">We add <code class="literal">i</code>, which is equal to 1, to <code class="literal">currentScore</code></li><li class="listitem" style="list-style-type: disc">Our <code class="literal">currentScore</code> variable is now equal to 2</li></ul></div><p>At pass 2, we have the following steps happening:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">i</code> is incremented to 2 and it is now equal to <code class="literal">currentLevel</code>, which is also 2</li><li class="listitem" style="list-style-type: disc"><code class="literal">i = 2</code>, <code class="literal">currentScore = 2</code></li><li class="listitem" style="list-style-type: disc">We add <code class="literal">i</code>, which is now equal to 2, to <code class="literal">currentScore</code></li><li class="listitem" style="list-style-type: disc">Our <code class="literal">currentScore</code> variable is now equal to 4</li></ul></div><p>At pass 3, the <a class="indexterm" id="id344"/>following steps take place:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">i</code> is incremented to 3 and it is now greater than <code class="literal">currentLevel</code>, which is 2.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">for</code> loop condition evaluates to false and we continue with the code after the <code class="literal">for</code> loop.</li><li class="listitem" style="list-style-type: disc">The value of <code class="literal">currentLevel</code> is increased by 1 to 3. So the next time, we will have an extra pass through our <code class="literal">for</code> loop.</li></ul></div><p>What is happening is that with each level, the player is being rewarded with another pass through the <code class="literal">for</code> <a class="indexterm" id="id345"/>loop, and each pass through the <code class="literal">for</code> loop adds a greater value to their score. To summarize what happens in the <code class="literal">for</code> loop, here is a brief table of values showing how the player's score is increased based on the <code class="literal">currentLevel</code> variable:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>currentLevel</p>
</th><th style="text-align: left" valign="bottom">
<p>Added to currentScore</p>
</th><th style="text-align: left" valign="bottom">
<p>currentScore after for loop</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>1</p>
</td><td style="text-align: left" valign="top">
<p>1</p>
</td><td style="text-align: left" valign="top">
<p>1</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>2</p>
</td><td style="text-align: left" valign="top">
<p>3 (1 + 2)</p>
</td><td style="text-align: left" valign="top">
<p>4</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>3</p>
</td><td style="text-align: left" valign="top">
<p>6 (1 + 2 + 3)</p>
</td><td style="text-align: left" valign="top">
<p>10</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>4</p>
</td><td style="text-align: left" valign="top">
<p>10 (1 + 2 + 3 + 4)</p>
</td><td style="text-align: left" valign="top">
<p>20</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>5</p>
</td><td style="text-align: left" valign="top">
<p>15 (1 + 2 + 3 + 4 + 5)</p>
</td><td style="text-align: left" valign="top">
<p>35</p>
</td></tr></tbody></table></div><div><div><h3 class="title"><a id="note23"/>Note</h3><p>Of course, we could have kept it really simple and not used a <code class="literal">for</code> loop. We could just use <code class="literal">currentScore = currentScore + level</code> perhaps, but that doesn't offer an ever increasing reward in the same way as our current solution does and we wouldn't have been able to practice our <code class="literal">for</code> loops either.</p></div></div><p>If <code class="literal">if(isCorrect(answerGiven))</code> evaluates to <code class="literal">false</code>, it simply resets the score to 0 and the level to 1 in step 3. Step 4 then updates our TextViews for the score and the level using the variables we have just discussed.</p><p>Now we <a class="indexterm" id="id346"/>have just one more method to write. Of course, this <a class="indexterm" id="id347"/>is the <code class="literal">isCorrect</code> method, which we just called.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec27"/>The isCorrect method</h3></div></div></div><p>This <a class="indexterm" id="id348"/>method is nice and simple because we have seen all of the <a class="indexterm" id="id349"/>relevant code before. It is just the method signature and the return value that we need to look at carefully:</p><div><ol class="orderedlist arabic"><li class="listitem">Enter the code just after the closing brace of the <code class="literal">updateScoreAndLevel</code> method but before the closing brace of the <code class="literal">GameActivity</code> class. Type the method signature like this:<div><pre class="programlisting">boolean isCorrect(int answerGiven){</pre></div></li><li class="listitem">Here we can see that the method must return a Boolean value, <code class="literal">true</code> or <code class="literal">false</code>. If it doesn't, then the program won't compile. This guarantees that when we use this method as the evaluation expression in the <code class="literal">updateScoreAndLevel</code> method, we will definitely get a result. It can be true or false. The signature also shows us the <code class="literal">answerGiven</code> variable passed in, ready for us to use. Type this code, which will determine that result:<div><pre class="programlisting">boolean correctTrueOrFalse;
if(answerGiven == correctAnswer){//YAY!
  Toast.makeText(getApplicationContext(), "Well done!", Toast.LENGTH_LONG).show();
   correctTrueOrFalse=true;
}else{//Uh-oh!
    Toast.makeText(getApplicationContext(), "Sorry", Toast.LENGTH_LONG).show();
    correctTrueOrFalse=false;
}</pre></div></li><li class="listitem">We have seen almost all of the preceding code before. The exception is that we declare a Boolean variable, <code class="literal">correctTrueOrFalse</code>, which we assign to <code class="literal">true</code> if the player answers correctly and to <code class="literal">false</code> if not. We know whether the player is correct or not because we compare <code class="literal">answerGiven</code> to <code class="literal">correctAnswer</code> in the <code class="literal">if</code> statement. Notice that we have also triggered the appropriate Android pop-up toast message as we did before. Finally, we do this:<div><pre class="programlisting">  return correctTrueOrFalse;
}</pre></div></li></ol></div><p>We just returned whatever value is contained within <code class="literal">correctTrueOrFalse</code>. So the critical <code class="literal">if</code> statement in <code class="literal">updateScoreAndLevel</code>, which we discussed in detail, will know what to do next.</p><p>To make sure <a class="indexterm" id="id350"/>we understand what is happening in <code class="literal">isCorrect</code>, let's go through the sequence of events in our code. In step 1 we have the method signature. We see that we will return a <code class="literal">true</code> or <code class="literal">false</code> value and receive <code class="literal">int</code>.</p><p>In step 2, we declare a Boolean variable called <code class="literal">correctTrueOrFalse</code> to hold the value we will soon return. Then we test for a right or wrong answer with <code class="literal">if(answerGiven == correctAnswer)</code>. If <a class="indexterm" id="id351"/>the two compared values match, a congratulatory message pops up and we assign <code class="literal">true</code> to our Boolean variable. Of course, if the <code class="literal">if</code> statement is <code class="literal">false</code>, we offer commiserations to the player and assign <code class="literal">false</code> to our important Boolean.</p><p>Finally in step 3, we send back <code class="literal">true</code> or <code class="literal">false</code> so that the <code class="literal">updateScoreAndLevel</code> method can proceed with its work.</p><p>We have now implemented all our methods. It's time to put them to work.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec28"/>Calling our new methods</h3></div></div></div><p>Of course, our <a class="indexterm" id="id352"/>shiny new methods won't do anything until we call them. So here is the plan to call these methods:</p><div><ol class="orderedlist arabic"><li class="listitem">When the game starts, we want to set a new question for the player. Therefore, as the last line of code in our <code class="literal">onCreate</code> method, we can call our <code class="literal">setQuestion</code> method like this:<div><pre class="programlisting">  setQuestion();

}//onCreate ends here</pre></div></li><li class="listitem">Then we turn our attention to the <code class="literal">onClick</code> method, which already detects which button has been pressed and loads the player's answer into our <code class="literal">answerGiven</code> variable. So at the end of the <code class="literal">onClick</code> method, after the closing brace of the <code class="literal">switch</code> statement, we just call this function:<div><pre class="programlisting">updateScoreAndLevel(answerGiven);</pre></div></li><li class="listitem">This sends our player's attempted answer to <code class="literal">updateScoreAndLevel</code>, which evaluates the answer using <code class="literal">isCorrect</code>, adds points, and increments the score if the answer is correct or resets the score and level if not. All that we need now is another question. Add this line. It will ask another question:<div><pre class="programlisting">setQuestion();</pre></div></li></ol></div><p>So now what happens is that the player starts our math game by clicking on its icon on their Android device. Our <code class="literal">GameActivity</code> class declares a few variables that we need access to throughout:</p><div><pre class="programlisting">int correctAnswer;
Button buttonObjectChoice1;
Button buttonObjectChoice2;
Button buttonObjectChoice3;
TextView textObjectPartA;
TextView textObjectPartB;
TextView textObjectScore;
TextView textObjectLevel;

int currentScore = 0;
int currentLevel = 1;</pre></div><p>Then <code class="literal">onCreate</code> initializes some variables and gets our buttons ready to receive clicks from the player before asking the first question by calling <code class="literal">setQuestion</code>. The game then waits for the <a class="indexterm" id="id353"/>player to attempt an answer. When the player <a class="indexterm" id="id354"/>attempts an answer, it is dealt with by <code class="literal">onClick</code>, <code class="literal">updateScoreAndLevel</code>, and <code class="literal">isCorrect</code>. Then the program control comes back to <code class="literal">onClick</code> again, <code class="literal">setQuestion</code> is called again, and we wait for the player's answer once more.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec32"/>Finishing touches</h1></div></div></div><p>Our math <a class="indexterm" id="id355"/>game is coming along nicely. Unfortunately, we have to move on soon. The project has served its purpose to demonstrate some fundamentals of Java programming as well as some key Android features. Now we need to start introducing some more game-related topics.</p><p>Before we go on, there are two really easy things to make our game a bit more cool and complete. In case you are wondering about the High Scores button, we will see how that can be implemented when we look at our next game project in <a class="link" href="ch05.html" title="Chapter 5. Gaming and Java Essentials">Chapter 5</a>, <em>Gaming and Java Essentials</em>. You will then have enough information to easily come back and implement high scores on your own.</p><p>The other feature that would really round off our game and make it more playable is an overall or per question time limit. Perhaps even increasing the score based on how quickly the correct answer is given will help. We need some new Java tricks up our sleeves before we can do that, but we will see how we can measure and respond to time in <a class="link" href="ch05.html" title="Chapter 5. Gaming and Java Essentials">Chapter 5</a>, <em>Gaming and Java Essentials</em>, when we talk about threads.</p><p>Now we will <a class="indexterm" id="id356"/>quickly learn two improvements:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Locking the screen orientation</li><li class="listitem" style="list-style-type: disc">Changing the home screen image</li></ul></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec50"/>Going full screen and locking orientation</h2></div></div></div><p>You might have <a class="indexterm" id="id357"/>noticed that if you rotate your device while the app is running, not only does your game UI get distorted but the game progress is also lost. What goes wrong is that when the device is rotated, the <code class="literal">onPause</code> and <code class="literal">onStop</code> methods are called. Then the app is restarted. We could handle this by overriding the <code class="literal">onPause</code> method and saving our data. We will do this later. For now we don't want the screen to rotate anyway, so if we stop it we solve two problems in one.</p><p>While adding code to this file, Android Studio may try to "help" by adding extra formatting. If you get red error indicators, you can compare your <code class="literal">AndroidManifest.xml</code> file with the one in the code download in the <code class="literal">Chapter4/MathGameChapter4</code> folder. Alternatively, you can simply replace the contents of your file with the contents of the file in the download. The step-by-step changes are detailed in this guide just to highlight what is changing:</p><div><ol class="orderedlist arabic"><li class="listitem">This is the first step in locking the app to portrait. Open the <code class="literal">AndroidManifest.xml</code> file. It is located directly below the <code class="literal">res</code> folder in the Project Explorer. Find the first opening <code class="literal">&lt;activity</code> in the code.</li><li class="listitem">Enter a new line as follows:<div><pre class="programlisting">android:screenOrientation="portrait"</pre></div></li><li class="listitem">Repeat step 2 after the second instance of <code class="literal">&lt;activity</code>. We have now locked both the menu and game screens in portrait mode.</li><li class="listitem">To make the game full screen, in the same file, find the following text and add the line in bold after it but before the closing <code class="literal">&gt;</code> sign:<div><pre class="programlisting">&lt;activity
android:name="com.packtpub.mathgamechapter4.app.MainActivity"
android:label="@string/app_name"
<strong>android:theme="@android:style/Theme.NoTitleBar.Fullscreen"&gt;</strong>

<strong>&lt;/activity&gt;</strong>
</pre></div></li><li class="listitem">Make the same change to the <code class="literal">GameActivity</code> activity like this. Again, here is the code in context in order to avoid mistakes with these <code class="literal">&gt;</code> signs:<div><pre class="programlisting">&lt;activity
android:name="com.packtpub.mathgamechapter4.app.GameActivity"
android:label="@string/title_activity_game"
<strong>android:theme="@android:style/Theme.NoTitleBar.Fullscreen"&gt;</strong>
<strong>&lt;/activity&gt;</strong>
</pre></div></li><li class="listitem">Save the project.</li></ol></div><p>Now, when you <a class="indexterm" id="id358"/>rotate the device during gameplay, the portrait orientation will be fixed.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec51"/>Adding a custom image (instead of the Android icon)</h2></div></div></div><p>We probably <a class="indexterm" id="id359"/>don't want to have the Android image on our finished game home screen, so here is the procedure to change it. This quick guide relies on you having an image you would like to use:</p><div><ol class="orderedlist arabic"><li class="listitem">First, we need to add the required image to the layout folder. Copy your image file by clicking on it in <strong>Windows Explorer</strong> and using <em>Ctrl</em> + <em>C</em>.</li><li class="listitem">Now find the <code class="literal">drawable-mdpi</code> folder in the Android Studio Project Explorer. Click on the folder.</li><li class="listitem">Paste the image to the folder using <em>Ctrl</em> + <em>V</em>.</li><li class="listitem">Now the image is a part of our project. We simply need to choose it in the same way as we chose the image of the Android robot previously. Open <code class="literal">activity_main.xml</code> in the editor window and click on <strong>ImageView</strong> (currently an Android robot).</li><li class="listitem">In the <strong>Properties</strong> window, find the <strong>src</strong> property. Click on it and then on <strong>...</strong>.</li><li class="listitem">Search for your image and select it.</li><li class="listitem">Save your project.</li><li class="listitem">You now have the image of your choice on the home screen.</li></ol></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec33"/>Self-test questions</h1></div></div></div><p>Q1) Guess what is wrong with this method:</p><div><pre class="programlisting">void doSomething(){
  return 4;
}</pre></div><p>Q2) What will <code class="literal">x</code> be equal to at the end of this code snippet?</p><div><pre class="programlisting">int x=19;
do{
  x=11;
  x++;
}while(x&lt;20)</pre></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Summary</h1></div></div></div><p>We came a really long way in this chapter. You got a serious handle on Java loops and took your first, fairly deep look into Java methods and how to use them. You learned how to generate random numbers and significantly enhanced your math game using all of the knowledge you gained.</p><p>As the chapters proceed, the games will get more and more real-game-like. In the next chapter, we will make a game to test the player's memory. It will have sound, animation and will actually save the player's high scores too.</p><p>Congratulations on your progress so far but let's keep going.</p></div>
<div><div><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Gaming and Java Essentials</h1></div></div></div><p>In this chapter, we will cover a diverse and interesting range of topics. We will learn about Java arrays, which allow us to manipulate a potentially huge amount of data in an organized and efficient manner.</p><p>Then, we will look at the role threads can play in games, in order to do more than one thing apparently simultaneously.</p><p>If you thought that our math game was a bit on the quiet side, then we will look at adding sound effects to our games as well as introducing a cool open source app to generate authentic sound effects.</p><p>The last new thing we will learn will be persistence. This is what happens when the player quits our game or even turns off their Android device. What happens to the score then? How will we load the right level the next time they play?</p><p>Once we have done all this, we will use all the new techniques and knowledge along with what we already know to create a neat memory game.</p><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Java arrays—an array of variables</li><li class="listitem" style="list-style-type: disc">Timing with threads</li><li class="listitem" style="list-style-type: disc">Creating and using beeps 'n' buzzes—Android sound</li><li class="listitem" style="list-style-type: disc">A look at life after destruction—persistence</li><li class="listitem" style="list-style-type: disc">Building the memory game</li></ul></div><div><div><div><div><h1 class="title"><a id="ch05lvl1sec35"/>Java arrays – an array of variables</h1></div></div></div><p>You might be <a class="indexterm" id="id360"/>wondering what happens when we have a game with lots of variables to keep track of. How about a table of high scores with the top 100 scores? We could declare and initialize 100 separate variables like this:</p><div><pre class="programlisting">int topScore1;
int topScore2;
int topScore3;
//96 more lines like the above
int topScore100;</pre></div><p>Straightaway, this can seem unwieldy, and what about the case when someone gets a new top score and we have to shift the scores in every variable down one place? A nightmare begins:</p><div><pre class="programlisting">topScore100 = topScore99;
topScore99 = topScore98;
topScore98 = topScore97;
//96 more lines like the above
topScore1 = score;</pre></div><p>There must be a better way to update the scores. When we have a large set of variables, what we need is a Java <strong>array</strong>. An array is a reference variable that holds up to a fixed maximum number of elements. Each element is a variable with a consistent type.</p><p>The following line <a class="indexterm" id="id361"/>of code declares an array that can hold <code class="literal">int</code> type variables, even a high score table perhaps:</p><div><pre class="programlisting">int [] intArray;</pre></div><p>We can also declare arrays of other types, like this:</p><div><pre class="programlisting">String [] classNames;
boolean [] bankOfSwitches;
float [] closingBalancesInMarch;</pre></div><p>Each of these arrays would need to have a fixed maximum amount of storage space allocated before it is used, like this:</p><div><pre class="programlisting">intArray = new int [100];</pre></div><p>The preceding line of code allocates up to a maximum of 100 integer-sized storage spaces. Think of a long aisle of 100 consecutive storage spaces in our variable warehouse. The spaces would probably be labeled <code class="literal">intArray[0]</code>, <code class="literal">intArray[1]</code>, <code class="literal">intArray[2]</code>, and so on, with each space holding a single <code class="literal">int</code> value. Perhaps the slightly surprising thing here is that the storage spaces start off at 0, not 1. Therefore, in an array of size 100, the storage spaces would run from 0 to 99.</p><p>We can actually initialize some of these storage spaces like this:</p><div><pre class="programlisting">intArray[0] = 5;
intArray[1] = 6;
intArray[2] = 7;</pre></div><p>Note that we can only put the declared type into an array and the type that an array holds can never change:</p><div><pre class="programlisting">intArray[3]= "John Carmack";//Won't compile</pre></div><p>So when we have an array of <code class="literal">int</code> types, what are each of the <code class="literal">int</code> variables called? The array notation syntax replaces the name. We can do anything with a variable in an array that we could do with a regular variable with a name:</p><div><pre class="programlisting">intArray[3] = 123;</pre></div><p>Here is another example of array variables being used like normal variables:</p><div><pre class="programlisting">intArray[10] = intArray[9] - intArray[4];</pre></div><p>We can also assign a value from an array to a regular variable of the same type, like this:</p><div><pre class="programlisting">int myNamedInt = intArray [3];</pre></div><p>Note, however, that <code class="literal">myNamedInt</code> is a separate and distinct primitive variable, so any changes made to it <a class="indexterm" id="id362"/>do not affect the value stored in the <code class="literal">intArray</code> reference. It has its own space in the warehouse and is not connected to the array.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec52"/>Arrays are objects</h2></div></div></div><p>We said that <a class="indexterm" id="id363"/>arrays are reference variables. Think of an array variable as an address to a group of variables of a given type. Perhaps, using the warehouse analogy, <code class="literal">someArray</code> is an aisle number. So each of <code class="literal">someArray[0]</code>, <code class="literal">someArray[1]</code>, and so on is the aisle number followed by the position number in the aisle.</p><p>Arrays are also objects. This means that they have methods and properties that we can use:</p><div><pre class="programlisting">int lengthOfSomeArray = someArray.length;</pre></div><p>In the previous line of code, we assigned the length of <code class="literal">someArray</code> to the <code class="literal">int</code> variable called <code class="literal">lengthOfSomeArray</code>.</p><p>We can even declare an array of arrays. This is an array that, in each of its elements, stores another array, like this:</p><div><pre class="programlisting">String[][] countriesAndCities;</pre></div><p>In the preceding array, we could hold a list of cities within each country. Let's not go array-crazy just yet. Just remember that an array holds up to a predetermined number of variables of any predetermined type and their values are accessed using this syntax:</p><div><pre class="programlisting">someArray[someLocation];</pre></div><p>Let's actually use some arrays to try and get an understanding of how to use them in real code and what we might use them for.</p><div><div><div><div><h3 class="title"><a id="ch05lvl3sec29"/>A simple example of an array</h3></div></div></div><p>Let's write a <a class="indexterm" id="id364"/>really simple working example of an array by performing the following steps. You can get the complete code for this example in the downloadable code bundle. It's at <code class="literal">Chapter5/SimpleArrayExample/MainActivity.java</code>:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a project with a blank activity, just as we did in <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>. Also, clean up the code by deleting the unnecessary parts, but this isn't essential.</li><li class="listitem">First, we declare our array, allocate five spaces, and initialize some values to each of the elements:<div><pre class="programlisting">//Declaring an array
int[] ourArray;

//Allocate memory for a maximum size of 5 elements
ourArray = new int[5];

//Initialize ourArray with values
//The values are arbitrary as long as they are int
//The indexes are not arbitrary 0 through 4 or crash!

ourArray[0] = 25;
ourArray[1] = 50;
ourArray[2] = 125;
ourArray[3] = 68;
ourArray[4] = 47;</pre></div></li><li class="listitem">We output each of the values to the <strong>logcat</strong> console. Notice that when we add the array elements together, we are doing so over multiple lines. This is fine because we have omitted a semicolon until the last operation, so the Java compiler treats the lines as one statement:<div><pre class="programlisting">//Output all the stored values
Log.i("info", "Here is ourArray:");
Log.i("info", "[0] = "+ourArray[0]);
Log.i("info", "[1] = "+ourArray[1]);
Log.i("info", "[2] = "+ourArray[2]);
Log.i("info", "[3] = "+ourArray[3]);
Log.i("info", "[4] = "+ourArray[4]);

//We can do any calculation with an array element
//As long as it is appropriate to the contained type
//Like this:
int answer = ourArray[0] +
    ourArray[1] +
    ourArray[2] +
    ourArray[3] +
    ourArray[4];

Log.i("info", "Answer = "+ answer);</pre></div></li><li class="listitem">Run the example on an emulator.</li></ol></div><p>Remember that nothing will happen on the emulator display because the entire output will be sent to our <a class="indexterm" id="id365"/>
<strong>logcat</strong> console window in Android Studio. Here is the output of the preceding code:</p><div><pre class="programlisting">
<strong>info﹕ Here is ourArray:</strong>
<strong>info﹕ [0] = 25</strong>
<strong>info﹕</strong>
<strong> [1] = 50</strong>
<strong>info﹕ [2] = 125</strong>
<strong>info﹕ [3] = 68</strong>
<strong>info﹕ [4] = 47</strong>
<strong>info﹕ Answer = 315 </strong>
</pre></div><p>In step 2, we declared an array called <code class="literal">ourArray</code> to hold <code class="literal">int</code> variables, and allocated space for up to five variables of that type.</p><p>Next, we assigned a value to each of the five spaces in our array. Remember that the first space is <code class="literal">ourArray[0]</code> and the last space is <code class="literal">ourArray[4]</code>.</p><p>In step 3, we simply printed the value in each array location to the console. From the output, we can see that they hold the value we initialized in the previous step. Then we added each of the elements in <code class="literal">ourArray</code> and initialized their value to the <code class="literal">answer</code> variable. We then printed <code class="literal">answer</code> to the console and saw that all the values where added together, just as if they were plain old <code class="literal">int</code> types stored in a slightly different manner, which is exactly what they are.</p></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec53"/>Getting dynamic with arrays</h2></div></div></div><p>As we <a class="indexterm" id="id366"/>discussed at the beginning of all this array stuff, if we need to declare and initialize each element of an array individually, there isn't a huge amount of benefit in an array over regular variables. Let's look at an example of declaring and initializing arrays dynamically.</p><div><div><div><div><h3 class="title"><a id="ch05lvl3sec30"/>Dynamic array example</h3></div></div></div><p>Let's make a <a class="indexterm" id="id367"/>really simple dynamic array by performing the following steps. You can find the working project for this example in the download bundle. It is at <code class="literal">Chapter5/DynamicArrayExample/MainActivity.java</code>:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a project with a blank activity, just as we did in <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>,<em>Getting Started with Android</em>. Also, clean up the code by deleting the unnecessary parts, but this isn't essential.</li><li class="listitem">Type the following between the opening and closing curly braces of <code class="literal">onCreate</code>. See if you can work out what the output will be before we discuss it and analyze the code:<div><pre class="programlisting">//Declaring and allocating in one step
int[] ourArray = new int[1000];

//Let's initialize ourArray using a for loop
//Because more than a few variables is allot of typing!
for(int i = 0; i &lt; 1000; i++){
   //Put the value of ourValue into our array
   //At the position determined by i.
   ourArray[i] = i*5;

            //Output what is going on
            Log.i("info", "i = " + i);
            Log.i("info", "ourArray[i] = " + ourArray[i]);
}</pre></div></li><li class="listitem">Run the example on an emulator. Remember that nothing will happen on the emulator display because the entire output will be sent to our <strong>logcat</strong> console window in Android Studio. Here is the output of the preceding code:<div><pre class="programlisting">
<strong>info﹕ i = 0</strong>
<strong>info﹕ ourArray[i] = 0</strong>
<strong>info﹕ i = 1</strong>
<strong>info﹕ ourArray[i] = 5</strong>
<strong>info﹕ i = 2</strong>
<strong>info﹕</strong>
<strong> ourArray[i] = 10</strong>
</pre></div><p>I have removed 994 iterations of the loop for brevity:</p><div><pre class="programlisting">
<strong>info﹕ ourArray[i] = 4985</strong>
<strong>info﹕ i = 998</strong>
<strong>info﹕ ourArray[i] = 4990</strong>
<strong>info﹕ i = 999</strong>
<strong>info﹕ ourArray[i] = 4995</strong>
</pre></div></li></ol></div><p>All the action happened in step 2. We declared and allocated an array called <code class="literal">ourArray</code> to hold up to 1,000 <code class="literal">int</code> values. This time, however, we did the two steps in one line of code:</p><div><pre class="programlisting">int[] ourArray = new int[1000];</pre></div><p>Then we used a <code class="literal">for</code> loop that was set to loop 1,000 times:</p><div><pre class="programlisting">(int i = 0; i &lt; 1000; i++){</pre></div><p>We initialized the spaces in the array from 0 to 999 with the value of <code class="literal">i</code> multiplied by <code class="literal">5</code>, as follows:</p><div><pre class="programlisting">ourArray[i] = i*5;</pre></div><p>To demonstrate the value of <code class="literal">i</code> and the value held in each position of the array, we output the value of <code class="literal">i</code> <a class="indexterm" id="id368"/>followed by the value held in the corresponding position in the array as follows:</p><div><pre class="programlisting">Log.i("info", "i = " + i);
Log.i("info", "ourArray[i] = " + ourArray[i]);</pre></div><p>All of this happened 1,000 times, producing the output we saw.</p></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec54"/>Entering the nth dimension with arrays</h2></div></div></div><p>We very <a class="indexterm" id="id369"/>briefly mentioned that an array can even hold other arrays at each of its positions. Now, if an array holds lots of arrays that hold lots of some other type, how do we access the values in the contained arrays? And why would we ever need this anyway? Take a look at the next example of where multidimensional arrays can be useful.</p><div><div><div><div><h3 class="title"><a id="ch05lvl3sec31"/>An example of a multidimensional array</h3></div></div></div><p>Let's <a class="indexterm" id="id370"/>create a really simple multidimensional <a class="indexterm" id="id371"/>array by performing the following steps. You can find the working project for this example in the download bundle. It is at <code class="literal">Chapter5/MultidimensionalArrayExample/MainActivity.java</code>:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a project with a blank activity, just as we did in <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>. Also, clean up the code by deleting the unnecessary methods, but this isn't essential.</li><li class="listitem">After the call to <code class="literal">setContentView</code>, declare and initialize a two-dimensional array, like this:<div><pre class="programlisting">//A Random object for generating question numbers later
Random randInt = new Random();
//And a variable to hold the random value generated
int questionNumber;

//We declare and allocate in separate stages for clarity
//but we don't have to
String[][] countriesAndCities;
//Here we have a 2 dimensional array

//Specifically 5 arrays with 2 elements each
//Perfect for 5 "What's the capital city" questions
countriesAndCities = new String[5][2];

//Now we load the questions and answers into our arrays
//You could do this with less questions to save typing
//But don't do more or you will get an exception
countriesAndCities [0][0] = "United Kingdom";
countriesAndCities [0][1] = "London";

countriesAndCities [1][0] = "USA";
countriesAndCities [1][1] = "Washington";

countriesAndCities [2][0] = "India";
countriesAndCities [2][1] = "New Delhi";

countriesAndCities [3][0] = "Brazil";
countriesAndCities [3][1] = "Brasilia";

countriesAndCities [4][0] = "Kenya";
countriesAndCities [4][1] = "Nairobi";</pre></div></li><li class="listitem">Now we <a class="indexterm" id="id372"/>output the contents of the <a class="indexterm" id="id373"/>array using a <code class="literal">for</code> loop and a <code class="literal">Random</code> class object. Note how we ensure that although the question is random, we can always pick the correct answer:<div><pre class="programlisting">//Now we know that the country is stored at element 0
//The matching capital at element 1
//Here are two variables that reflect this
int country = 0;
int capital = 1;

//A quick for loop to ask 3 questions
for(int i = 0; i &lt; 3; i++){
   //get a random question number between 0 and 4
   questionNumber = randInt.nextInt(5);

   //and ask the question and in this case just
   //give the answer for the sake of brevity
  Log.i("info", "The capital of " +countriesAndCities[questionNumber][country]);

  Log.i("info", "is " +countriesAndCities[questionNumber][capital]);

}//end of for loop</pre></div></li></ol></div><p>Run the example on an emulator. Once again, nothing will happen on the emulator display because the output will be sent to our <strong>logcat</strong> console window in Android Studio. Here is the output of the previous code:</p><div><pre class="programlisting">
<strong>info﹕ The capital of USA</strong>
<strong>info﹕ is Washington</strong>
<strong>info﹕ The capital of India</strong>
<strong>info﹕ is New Delhi</strong>
<strong>info﹕ The capital of United Kingdom</strong>
<strong>info﹕ is London</strong>
</pre></div><p>What just happened? Let's go through this chunk by chunk so that we know exactly what is going on.</p><p>We make a <a class="indexterm" id="id374"/>new object of the <code class="literal">Random</code> type, called <code class="literal">randInt</code>, ready to generate random numbers later in the program:</p><div><pre class="programlisting">Random randInt = new Random();</pre></div><p>We declare a <a class="indexterm" id="id375"/>simple <code class="literal">int</code> variable to hold a question number:</p><div><pre class="programlisting">int questionNumber;</pre></div><p>Then we declare <code class="literal">countriesAndCities</code>, our array of arrays. The outer array holds arrays:</p><div><pre class="programlisting">String[][] countriesAndCities;</pre></div><p>Now we allocate space within our arrays. The first outer array will be able to hold five arrays and each of the inner arrays will be able to hold two strings:</p><div><pre class="programlisting">countriesAndCities = new String[5][2];</pre></div><p>Next, we initialize our arrays to hold countries and their corresponding capital cities. Notice that with each pair of initializations, the outer array number stays the same, indicating that each country/capital pair is within one inner array (a string array). Of course, each of these inner arrays is held in one element of the outer array (which holds arrays):</p><div><pre class="programlisting">countriesAndCities [0][0] = "United Kingdom";
countriesAndCities [0][1] = "London";

countriesAndCities [1][0] = "USA";
countriesAndCities [1][1] = "Washington";

countriesAndCities [2][0] = "India";
countriesAndCities [2][1] = "New Delhi";

countriesAndCities [3][0] = "Brazil";
countriesAndCities [3][1] = "Brasilia";

countriesAndCities [4][0] = "Kenya";
countriesAndCities [4][1] = "Nairobi";</pre></div><p>To make the upcoming <code class="literal">for</code> loop clearer, we declare and initialize <code class="literal">int</code> variables to represent the country and the capital from our arrays. If you glance back at the array initialization, all the countries are held in position <code class="literal">0</code> of the inner array and all the corresponding <a class="indexterm" id="id376"/>capital cities are held at position <code class="literal">1</code>:</p><div><pre class="programlisting">int country = 0;
int capital = 1;</pre></div><p>Now we create <a class="indexterm" id="id377"/>a <code class="literal">for</code> loop that will run three times. Note that this number does not mean we access the first three elements of our array. It is rather the number of times we go through the loop. We could make it loop one time or a thousand times, but the example would still work:</p><div><pre class="programlisting">for(int i = 0; i &lt; 3; i++){</pre></div><p>Next, we actually determine which question to ask, or more specifically, which element of our outer array. Remember that <code class="literal">randInt.nextInt(5)</code> returns a number between 0 and 4. This is just what we need as we have an outer array with five elements, from 0 to 4:</p><div><pre class="programlisting">questionNumber = randInt.nextInt(5);</pre></div><p>Now we can ask a question by outputting the strings held in the inner array, which in turn is held by the outer array that was chosen in the previous line by the randomly generated number:</p><div><pre class="programlisting">  Log.i("info", "The capital of " +countriesAndCities[questionNumber][country]);

  Log.i("info", "is " +countriesAndCities[questionNumber][capital]);

}//end of for loop</pre></div><p>For the record, we will not be using any multidimensional arrays in the rest of this book. So if there is still a little bit of murkiness around these arrays inside arrays, then that doesn't matter. You <a class="indexterm" id="id378"/>know they exist and what they <a class="indexterm" id="id379"/>can do, so you can revisit them if necessary.</p></div><div><div><div><div><h3 class="title"><a id="ch05lvl3sec32"/>Array-out-of-bounds exceptions</h3></div></div></div><p>An <a class="indexterm" id="id380"/>array-out-of-bounds exception occurs when we attempt to access an element of an array that does not exist. Whenever we try this, we get <a class="indexterm" id="id381"/>an error. Sometimes, the compiler will catch it to prevent the error from going into a working game, like this:</p><div><pre class="programlisting">int[] ourArray = new int[1000];
int someValue = 1;//Arbitrary value
ourArray[1000] = someValue;//Won't compile as compiler knows this won't work.
//Only locations 0 through 999 are valid</pre></div><p>Guess what happens if we write something like this:</p><div><pre class="programlisting">int[] ourArray = new int[1000];
int someValue = 1;//Arbitrary value
int x = 999;
if(userDoesSomething){x++;//x now equals 1000
}
ourArray[x] = someValue;
//Array out of bounds exception if userDoesSomething evaluates to true! This is because we end up referencing position 1000 when the array only has positions 0 through 999
//Compiler can't spot it and game will crash on player - yuck!</pre></div><p>The only way we can avoid this problem is to know the rule. The rule is that arrays start at zero and go up to the number obtained by subtracting one from the allocated number. We can also use clear, readable code where it is easy to evaluate what we have done and spot the problems.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec36"/>Timing with threads</h1></div></div></div><p>So what is a <a class="indexterm" id="id382"/>thread? You can think of threads in Java programming just like threads in a story. In one thread of a story, we have the primary character battling the enemy on the front line, and in another thread, the soldier's family are getting by, day to day. Of course, a story doesn't have to have just two threads. We could introduce a third thread. Perhaps the story also tells of the politicians and military commanders making decisions. These decisions subtly, or not so subtly, affect what happens in the other threads.</p><p>Threads in programming are just like this. We create parts/threads in our program and they control different aspects for us. We introduce threads to represent these different aspects because of the following reasons:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">They make sense from an organizational point of view</li><li class="listitem" style="list-style-type: disc">They are a proven way of structuring a program that works</li><li class="listitem" style="list-style-type: disc">The nature of the system we are working on forces us to use them</li></ul></div><p>In Android, we use threads for all of these reasons simultaneously. It makes sense, it works, and we have to use it because of the design of the system.</p><p>In gaming, think about a thread that receives the player's button taps for "left", "right", and "shoot", a thread that represents the alien thinking where to move next, and yet another thread that draws all the graphics on the screen.</p><p>Programs with multiple threads can have problems. Like the threads of a story, if proper synchronization does not occur, then things go wrong. What if our soldier went into battle before the battle or even the war existed? Weird!</p><p>What if we have a variable, <code class="literal">int x</code>, that represents a key piece of data that say three threads of our program use? What happens if one thread gets slightly ahead of itself and makes the data "wrong" for the other two? This problem is the problem of <strong>correctness</strong>, caused by multiple threads racing to completion, oblivious of each other—because they are just dumb code after all.</p><p>The problem of <a class="indexterm" id="id383"/>correctness can be solved by close oversight of the threads and <strong>locking</strong>. Locking means temporarily preventing execution in one thread to ensure that things are <a class="indexterm" id="id384"/>working in a synchronized manner. It's like freezing the soldier from boarding a ship to war until the ship has actually docked and the plank has been lowered, avoiding an embarrassing splash.</p><p>The other <a class="indexterm" id="id385"/>problem with programs with multiple threads is the problem of <strong>deadlock</strong>, where one or more threads become locked, waiting for the right moment to access <code class="literal">x</code>, but that moment never comes and the entire program eventually grinds to a halt.</p><p>You might have noticed that it was the solution to the first problem (correctness) that is the cause of the second problem (deadlock). Now consider all that we have just been discussing and mix it in with the Android Activity lifecycle. It's possible that you start to feel a little nauseous with the complexity.</p><p>Fortunately, the problem has been solved for us. Just as we use the <code class="literal">Activity</code> class and override its methods to interact with the Android lifecycle, we can also use other classes to create and manage our threads. Just as with <code class="literal">Activity</code>, we only need to know how to use them, not how they work.</p><p>So why tell me all this stuff about threads when I didn't need to know, you would rightly ask. It's simply because we will be writing code that looks different and is structured in an unfamiliar manner. We will have no sweat writing our Java code to create and work within our threads if we can do the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Accept that the new concepts we will introduce are what we need to work with in order to create an Android-specific solution to the problems related to working with threads</li><li class="listitem" style="list-style-type: disc">Understand the general concept of a thread, which is mostly the same as a story thread that happens almost simultaneously</li><li class="listitem" style="list-style-type: disc">Learn the few rules of using some of the Android thread classes</li></ul></div><p>Notice that I said classes, plural, in the third bullet. Different thread classes work best in different situations. You could write a whole book on just threads in Android. We will use two thread classes in this book. In this chapter, we will use <code class="literal">Handler</code>. In <a class="link" href="ch07.html" title="Chapter 7. Retro Squash Game">Chapter 7</a>, <em>Retro Squash Game</em>, and <a class="link" href="ch08.html" title="Chapter 8. The Snake Game">Chapter 8</a>, <em>The Snake Game</em>, we will use the <code class="literal">Runnable</code> class. All we need to remember is that we will be writing parts of our program that run at almost the same time as each other.</p><div><div><h3 class="title"><a id="tip35"/>Tip</h3><p>What do I <a class="indexterm" id="id386"/>mean by "almost"? What is actually happening is that the CPU switches between threads in turn. However, this happens so fast that we will not be able to perceive anything but simultaneity.</p></div></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec55"/>A simple thread timer example with the Handler class</h2></div></div></div><p>After this <a class="indexterm" id="id387"/>example, we can heave a sigh of relief when we realize that threads are not as complicated as first feared. When using threads in a real game, we will have to add a bit of extra code alongside the code in this simple example, but it's not much, and we will talk about it when we get to it.</p><p>As usual, you can simply use the complete code from the download bundle. This project is located in <code class="literal">Chapter5</code>/<code class="literal">SimpleThreadTimer/MainActivity.java</code>.</p><p>As the name suggests, we will be creating a timer—quite a useful feature in a lot of games:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a project with a blank activity, just as we did in <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>. Also, clean up the code by deleting the unnecessary parts, but this isn't essential.</li><li class="listitem">Immediately after the class declaration, enter the three highlighted lines:<div><pre class="programlisting">public class MainActivity extends Activity {

    <strong>private Handler myHandler;</strong>
<strong>    boolean gameOn;</strong>
<strong>    long startTime;</strong>
</pre></div></li><li class="listitem">Enter this code inside the <code class="literal">onCreate</code> method. It will create a thread with something else going on in the <code class="literal">if(gameOn)</code> block:<div><pre class="programlisting">//How many milliseconds is it since the UNIX epoch
        startTime = System.currentTimeMillis();

        myHandler = new Handler() {
            public void handleMessage(Message msg) {
                super.handleMessage(msg);

                if (gameOn) {
                    long seconds = ((System.currentTimeMillis() - startTime)) / 1000;
                    Log.i("info", "seconds = " + seconds);
                }

                myHandler.sendEmptyMessageDelayed(0, 1000);
            }

        };

        gameOn = true;
        myHandler.sendEmptyMessage(0);
    }</pre></div></li><li class="listitem">Run the <a class="indexterm" id="id388"/>app. Quit with the home or back button on the emulator. Notice that it is still printing to the console. We will deal with this anomaly when we implement our memory game.</li></ol></div><p>When you run the example on an emulator, remember that nothing will happen on the emulator display because all of the output will be sent to our <strong>logcat</strong> console window in Android Studio. Here is the output of the previous code:</p><div><pre class="programlisting">
<strong>info﹕ seconds = 1</strong>
<strong>info﹕ seconds = 2</strong>
<strong>info﹕ seconds = 3</strong>
<strong>info﹕ seconds = 4</strong>
<strong>info﹕ seconds = 5</strong>
<strong>info﹕ seconds = 6</strong>
</pre></div><p>So what just happened? After 1-second intervals, the number of seconds elapsed was printed to the console. Let's learn how this happened.</p><p>First, we declare a new object, called <code class="literal">myHandler</code>, of the <code class="literal">Handler</code> type. We then declare a Boolean variable called <code class="literal">gameOn</code>. We will use this to keep track of when our game is running. Finally, the last line of this block of code declares a variable of the <code class="literal">long</code> type. You might remember the <code class="literal">long</code> type from <a class="link" href="ch03.html" title="Chapter 3. Speaking Java – Your First Game">Chapter 3</a>, <em>Speaking Java – Your First Game</em>. We can use <code class="literal">long</code> variables to store very large whole numbers, and this is what we do here with <code class="literal">startTime</code>:</p><div><pre class="programlisting">private Handler myHandler;
boolean gameOn;
long startTime;</pre></div><p>Next, we initialized <code class="literal">startTime</code> using<code class="literal"> currentTimeMillis</code>, a method of the <code class="literal">System</code> class. This method holds the number of milliseconds since January 1, 1970. We will see how we use this value in the next line of code.</p><div><pre class="programlisting">startTime = System.currentTimeMillis();</pre></div><p>Next is the important code. Everything up to <code class="literal">if(gameOn)</code> marks the code to define our thread. Certainly, the code is a bit of a mouthful, but it is not as bad as it looks at first glance. Also, remember that we only need to use the threads; we don't need to understand every aspect of how they do their work.</p><p>Let's dissect <a class="indexterm" id="id389"/>the preceding code to demystify it a bit. The <code class="literal">myHandler = new Handler()</code> line simply initializes our <code class="literal">myHandler</code> object. What is different from what we have seen before is that we go on to customize the object immediately afterwards. We override the <code class="literal">handleMessage</code> method (which is where we put our code that runs in the thread) and then we call <code class="literal">super.handleMessage</code>, which calls the default version of <code class="literal">handleMessage</code> before it runs our custom code. This is much like we do for the <code class="literal">onCreate</code> method every time we call <code class="literal">super.onCreate</code>.</p><p>Then we have the <code class="literal">if(gameOn)</code> block. Everything in that <code class="literal">if</code> block is the code that we want to run in the thread. The <code class="literal">if(gameOn)</code> block simply gives us a way to control whether we want to run our code at all. For example, we might want the thread up and running but only sometimes run our code. The <code class="literal">if</code> statement gives us the power to easily choose. Take a look at the code now. We will analyze what is happening in the <code class="literal">if</code> block later:</p><div><pre class="programlisting">myHandler = new Handler() {
     public void handleMessage(Message msg) {
       super.handleMessage(msg);
         
       if (gameOn) {
         long seconds = ((System.currentTimeMillis() - startTime)) / 1000;
             Log.i("info", "seconds = " + seconds);
         }

       myHandler.sendEmptyMessageDelayed(0, 1000);
      }

 };</pre></div><p>Inside the <code class="literal">if</code> block, we declare and initialize another <code class="literal">long</code> variable called <code class="literal">seconds</code>, and do a little bit of math with it:</p><div><pre class="programlisting">long seconds = ((System.currentTimeMillis() - startTime)) / 1000;</pre></div><p>First, we get the current number of milliseconds since January 1, 1970, and then subtract <code class="literal">startTime</code> from it. This gives us the number of milliseconds since we first initialized <code class="literal">startTime</code>. Then we divide the answer by 1000 and get a value in seconds. We print this value to the console with the following line:</p><div><pre class="programlisting">Log.i("info", "seconds = " + seconds);</pre></div><p>Next, just after our <code class="literal">if</code> block, we have this line:</p><div><pre class="programlisting">myHandler.sendEmptyMessageDelayed(0, 1000);</pre></div><p>The previous <a class="indexterm" id="id390"/>line tells the Android system that we want to run the code in the <code class="literal">handleMessage</code> method once every 1000 milliseconds (once a second).</p><p>Back in <code class="literal">onCreate</code>, after the closing curly braces of the <code class="literal">handleMessage</code> method and the <code class="literal">Handler</code> class, we finally set <code class="literal">gameOn</code> to <code class="literal">true</code> so that it is possible to run the code in the <code class="literal">if</code> block:</p><div><pre class="programlisting">gameOn = true;</pre></div><p>Then, this last line of the code starts the flow of messages between our thread and the Android system:</p><div><pre class="programlisting">myHandler.sendEmptyMessage(0);</pre></div><p>It is worth pointing out that the code inside the <code class="literal">if</code> block can be as minimal or as extensive as we need. When we implement our memory game, we will see much more code in our <code class="literal">if</code> block.</p><p>All we really need to know is that the somewhat elaborate setup we have just seen allows us to run the contents of the <code class="literal">if</code> block in a new thread. That's it! Perhaps apart from brushing over that <code class="literal">System</code> class a bit quickly.</p><div><div><h3 class="title"><a id="note24"/>Note</h3><p>The <code class="literal">System</code> class has many uses. In this case, we use it to get the number of milliseconds since January 1, 1970. This is a common system used to measure time in a computer. It is known as Unix time, and the first millisecond of January 1, 1970, is known as the Unix Epoch. We will bump into this concept a few more times throughout the book.</p></div></div><p>Enough on threads, let's make some noise!</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec37"/>Beeps n buzzes – Android sound</h1></div></div></div><p>This section <a class="indexterm" id="id391"/>will be divided into two parts—creating and using sound FX. So let's get on with it.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec56"/>Creating sound FX</h2></div></div></div><p>Years <a class="indexterm" id="id392"/>ago, whenever I made a game, I would spend many hours trawling websites offering royalty-free sound FX. Although there are many good ones out there, the really great ones are always costly, and no matter how much you pay, they are never exactly what you want. Then a friend pointed out a simple open source app called Bfxr, and I have never wasted another moment looking for sound effects since. We can make our own.</p><p>Here is a very fast guide to making your own sound effects using Bfxr. Grab a free copy of Bfxr from <a class="ulink" href="http://www.bfxr.net">www.bfxr.net</a>.</p><p>Follow the simple instructions on the website to set it up. Try out a few of these examples to make cool sound effects:</p><div><div><h3 class="title"><a id="tip36"/>Tip</h3><p>This is a seriously condensed tutorial. You can do much more with Bfxr. To learn more, read the tips on the website at the previous URL.</p></div></div><div><ol class="orderedlist arabic"><li class="listitem">Run <code class="literal">bfxr.exe</code>:<div><img alt="Creating sound FX" src="img/8859OS_05_10.jpg"/></div></li><li class="listitem">Try out all <a class="indexterm" id="id393"/>the preset types, which generate a random sound of that type. When you have a sound that is close to what you want, move to the next step:<div><img alt="Creating sound FX" src="img/8859OS_05_11.jpg"/></div></li><li class="listitem">Use the <a class="indexterm" id="id394"/>sliders to fine-tune the pitch, duration, and other aspects of your new sound:<div><img alt="Creating sound FX" src="img/8859OS_05_12.jpg"/></div></li><li class="listitem">Save your <a class="indexterm" id="id395"/>sound by clicking on the <strong>Export Wav</strong> button. Despite the name of this button, as we will see, we can save in formats other than <code class="literal">.wav</code>.<div><img alt="Creating sound FX" src="img/8859OS_05_13.jpg"/></div></li><li class="listitem">Android likes to work with sounds in the OGG format, so when asked to name your file, use the <code class="literal">.ogg</code> extension on the end of whatever you decide to call it.</li><li class="listitem">Repeat steps 2 to 5 as often as required.</li></ol></div><div><div><h3 class="title"><a id="tip37"/>Tip</h3><p>Every project in this book that requires sound samples comes with the sound samples provided, but as we have seen, it is much more fun to make our own samples. All <a class="indexterm" id="id396"/>you need to do is to save them with the same filename as the provided samples.</p></div></div><div><div><div><div><h3 class="title"><a id="ch05lvl3sec33"/>Playing sounds in Android</h3></div></div></div><p>To <a class="indexterm" id="id397"/>complete this brief example, you will need three sound effects saved in the <code class="literal">.ogg</code> format. So if you don't have them to hand, go back to the <em>Creating sound FX</em> section to make some. Alternatively, you can use the sounds provided in the <code class="literal">Chapter5/ PlayingSounds/assets</code> folder of the code bundle. As usual, you can view or <a class="indexterm" id="id398"/>use the already completed code at <code class="literal">Chapter5/PlayingSounds/java/MainActivity.java</code> and <code class="literal">Chapter5/PlayingSounds/layout/activity_main.xml</code>. Now perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a project with a blank activity, just as we did in <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>. Also, clean up the code by deleting the unnecessary parts, although this isn't essential.</li><li class="listitem">Create three sound files and save them as <code class="literal">sample1.ogg</code>, <code class="literal">sample2.ogg</code>, and <code class="literal">sample3.ogg</code>.</li><li class="listitem">In the <code class="literal">main</code> folder in the Project Explorer window, we need to add a folder called <code class="literal">assets</code>. So in the Project Explorer window, right-click on the <strong>main</strong> folder and navigate to <strong>New</strong> | <strong>Directory</strong>. Type <code class="literal">assets</code> in the <strong>New Directory</strong> dialog box.</li><li class="listitem">Now copy and paste the three sound files to the newly created <code class="literal">assets</code> folder. Alternatively, select the three files, right-click on them, and click on <strong>Copy</strong>. Then click on the <strong>assets</strong> folder in the Android Studio Project Explorer. Now right-click on the <strong>assets</strong> folder and click on <strong>Paste</strong>.</li><li class="listitem">Open <code class="literal">activity_main.xml</code> in the editor window and drag three button widgets onto your UI. It doesn't matter where they are or how they are aligned. When you look at the <strong>id</strong> property in the <strong>Properties</strong> window for any of our three new buttons, you will notice that they have automatically been assigned <strong>id</strong> properties. They are <code class="literal">button</code>, <code class="literal">button2</code>, and <code class="literal">button3</code>. As we will see, this is just what we need.</li><li class="listitem">Let's enable our activity to listen to the buttons being clicked by implementing <code class="literal">onClickListener</code> as we have done in all our other examples with buttons. Open <strong>MainActivity.java</strong> in the editor window. Replace the <code class="literal">public class MainActivity extends Activity {</code> line with the following line of code:<div><pre class="programlisting">public class MainActivity extends Activity implements View.
    OnClickListener {</pre></div></li><li class="listitem">As before, we get an unsightly red underline on our new line of code. The last time this happened, we typed in the empty body of the <code class="literal">onClick</code> method that we must implement and all was well. This time, because we already know what is going on here, we will learn a shortcut. Hover your mouse cursor <a class="indexterm" id="id399"/>over the error and right-click on it. Now click on <strong>Generate...</strong> and then select <strong>Implement methods...</strong>. In the <strong>Select </strong><a class="indexterm" id="id400"/><strong>Methods To Implement</strong> dialog box, <strong>onClick(View):void </strong>will already be selected:<div><img alt="Playing sounds in Android" src="img/8859OS_05_03.jpg"/></div></li><li class="listitem">Select this option by clicking on <strong>OK</strong>. Now scroll to the bottom of your code and see that Android Studio has very kindly implemented the <code class="literal">onClick</code> method for you and the error is also gone.</li><li class="listitem">Type this code after the <code class="literal">MainActivity</code> declaration to declare some variables for our sound effects:<div><pre class="programlisting">private SoundPool soundPool;
int sample1 = -1;
int sample2 = -1;
int sample3 = -1;</pre></div></li><li class="listitem">Type this code in the <code class="literal">onCreate</code> method to load our sounds into memory:<div><pre class="programlisting">soundPool = new SoundPool(10, AudioManager.STREAM_MUSIC,0);
  try{
    //Create objects of the 2 required classes
          AssetManager assetManager = getAssets();
          AssetFileDescriptor descriptor;

          //create our three fx in memory ready for use
          descriptor = assetManager.openFd("sample1.ogg");
          sample1 = soundPool.load(descriptor, 0);

          descriptor = assetManager.openFd("sample2.ogg");
          sample2 = soundPool.load(descriptor, 0);


          descriptor = assetManager.openFd("sample3.ogg");
          sample3 = soundPool.load(descriptor, 0);


        }catch(IOException e){
            //catch exceptions here
        }</pre></div></li><li class="listitem">Now add the <a class="indexterm" id="id401"/>code to grab a reference to the buttons in <a class="indexterm" id="id402"/>our UI and listen to clicks on them:<div><pre class="programlisting">  //Make a button from each of the buttons in our layout
     Button button1 =(Button) findViewById(R.id.button);
     Button button2 =(Button) findViewById(R.id.button2);
     Button button3 =(Button) findViewById(R.id.button3);

     //Make each of them listen for clicks
     button1.setOnClickListener(this);
     button2.setOnClickListener(this);
     button3.setOnClickListener(this);</pre></div></li><li class="listitem">Finally, type this code in the <code class="literal">onClick</code> method that we autogenerated:<div><pre class="programlisting">switch (view.getId()) {

  case R.id.button://when the first button is pressed
    //Play sample 1
          soundPool.play(sample1, 1, 1, 0, 0, 1);
          break;

          //Now the other buttons
          case R.id.button2:
          soundPool.play(sample2, 1, 1, 0, 0, 1);
          break;

          case R.id.button3:
          soundPool.play(sample3, 1, 1, 0, 0, 1);
          break;
        }</pre></div></li></ol></div><p>Run the example on an emulator or on a real Android device. Notice that by clicking on a button, you can play any of your three sound samples at will. Of course, sounds can be played at almost any time, not just on button presses. Perhaps they can be played from a thread as well. We will see more sound samples when we implement the memory game later in the chapter.</p><p>This is how <a class="indexterm" id="id403"/>the code works. We started off by setting up a new project in the usual way. In steps 2 to 5, however, we created some sounds with Bfxr, created an <code class="literal">assets</code> folder, and placed the files within it. This is the folder where Android expects to find sound files. So when we write the code in the next steps that refers to the sound files, the Android system will be able to find them.</p><p>In steps 6 to 8, we <a class="indexterm" id="id404"/>enabled our activity to listen to button clicks as we have done several times before. Only this time, we got Android Studio to autogenerate the <code class="literal">onClick</code> method.</p><p>Then we saw this code:</p><div><pre class="programlisting">private SoundPool soundPool;</pre></div><p>First, we create an object of the <code class="literal">SoundPool</code> type, called <code class="literal">soundPool</code>. This object will be the key to making noises with our Android device. Next, we have this code:</p><div><pre class="programlisting">int sample1 = -1;
int sample2 = -1;
int sample3 = -1;</pre></div><p>The preceding code is very simple; we declared three <code class="literal">int</code> variables. However, they serve a slightly deeper purpose than a regular <code class="literal">int</code> variable. As we will see in the next block of code we analyze, they will be used to hold a reference to a sound file that is loaded into memory. In other words, the Android system will assign a number to each variable that will refer to a place in memory where our sound file will reside.</p><p>We can think of this as a location in our variable warehouse. So we know the name of the <code class="literal">int</code> variable, and contained within it is what Android needs to find our sound. Here is how we load our sounds into memory and use the references we've just been discussing.</p><p>Let's break the code in step 10 into a few parts. Take a close look and then we will examine what is going on:</p><div><pre class="programlisting">soundPool = new SoundPool(10, AudioManager.STREAM_MUSIC,0);</pre></div><p>Here, we initialize our <code class="literal">soundPool</code> object and request up to 10 simultaneous streams of sound. We should be able to really mash the app buttons and get a sound every time. <code class="literal">AudioManager.STREAM_MUSIC</code> describes the type of stream. This is typical for applications of this type. Finally, the <code class="literal">0</code> argument indicates we would like default quality sound.</p><p>Now we see something new. Notice that the next chunk of code is wrapped into two blocks, <code class="literal">try</code> and <code class="literal">catch</code>. This means that if the code in the <code class="literal">try</code> block fails, we want the code in the <code class="literal">catch</code> block to run. As you can see, there is nothing but a comment in the <code class="literal">catch</code> block.</p><p>We must do <a class="indexterm" id="id405"/>this because of the way the <code class="literal">SoundPool</code> class is designed. If you try to write the code without the <code class="literal">try</code> and <code class="literal">catch</code> blocks, it won't work. This is typical of Java classes involved in reading from files. It is a fail-safe process to check whether the file is readable or even whether it exists. You could put a line of code to <a class="indexterm" id="id406"/>output to the console that an error has occurred.</p><div><div><h3 class="title"><a id="tip38"/>Tip</h3><p>If you want to experiment with <code class="literal">try/catch</code>, then put a line of code to output a message in the <code class="literal">catch</code> block and remove one of the sound files from the assets folder. When you run the app, the loading will fail and the code in the <code class="literal">catch</code> block will be triggered.</p></div></div><p>We will throw caution to the wind because we are quite sure that the files will be there and will work . Let's examine what is inside the <code class="literal">try</code> block. Take a close look at the following code and then we will dissect it:</p><div><pre class="programlisting">  try{
    //Create objects of the 2 required classes
          AssetManager assetManager = getAssets();
          AssetFileDescriptor descriptor;

          //create our three fx in memory ready for use
          descriptor = assetManager.openFd("sample1.ogg");
          sample1 = soundPool.load(descriptor, 0);

          descriptor = assetManager.openFd("sample2.ogg");
          sample2 = soundPool.load(descriptor, 0);


          descriptor = assetManager.openFd("sample3.ogg");
          sample3 = soundPool.load(descriptor, 0);


        }catch(IOException e){
            //catch exceptions here
        }</pre></div><p>First, we create an object called <code class="literal">assetManager</code> of the <code class="literal">AssetManager</code> type and an <code class="literal">AssetFileDescriptor</code> object called <code class="literal">descriptor</code>. We then use these two objects combined to load our first sound sample like this:</p><div><pre class="programlisting">          descriptor = assetManager.openFd("sample1.ogg");
          sample1 = soundPool.load(descriptor, 0);</pre></div><p>We now have a sound sample loaded in memory and its location saved in our <code class="literal">int</code> variable called <code class="literal">sample1</code>. The first sound file, <code class="literal">sample1.ogg</code>, is now ready to use. We perform the <a class="indexterm" id="id407"/>same procedure for <code class="literal">sample2</code> and <code class="literal">sample3</code> and we <a class="indexterm" id="id408"/>are ready to make some noise!</p><p>In step 11, we set up our buttons, which we have seen several times before. In step 12, we have our switch block ready to perform a different action depending upon which button is pressed. You can probably see that the single action each button takes is the playing of a sound. For example, <strong>Button1</strong> does this:</p><div><pre class="programlisting">soundPool.play(sample1, 1, 1, 0, 0, 1);</pre></div><p>This line of code plays the sound that is loaded in memory at the location referred to by <code class="literal">int sample1</code>.</p><div><div><h3 class="title"><a id="note25"/>Note</h3><p>The arguments of the method from left to right define the following: the sample to play, left volume, right volume, priority over other playing sounds, loop or not, rate of playback. You can have some fun with these if you like. Try setting the loop argument to <code class="literal">3</code> and the rate argument to perhaps <code class="literal">1.5</code>.</p></div></div><p>We handle each button in the same way. Now let's learn something serious.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec38"/>Life after destruction – persistence</h1></div></div></div><p>Okay, this is <a class="indexterm" id="id409"/>not as heavy as it sounds, but it is an important topic when making games. You have probably noticed that the slightest thing can reset our math game, such as an incoming phone call, a battery that ran flat, or even tilting the device to a different orientation.</p><p>When these events occur, we might like our game to remember the exact state it was in so that when the player comes back, it is in exactly the same place as they left off. If you were using a word-processing app, you would definitely expect this type of behavior.</p><p>We are not going to go to that extent with our game, but as a bare minimum, shouldn't we at least remember the high score? This gives the player something to aim for, and most importantly, a reason to come back to our game.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec57"/>An example of persistence</h2></div></div></div><p>Android and <a class="indexterm" id="id410"/>Java have many different ways to achieve persistence of data, from reading and writing to files to setting up and using whole databases through our code. However, the neatest, simplest, and most suitable way for the examples in this book is by using the <code class="literal">SharedPreferences</code> class.</p><p>In this example, we will use the <code class="literal">SharedPreferences</code> class to save data. Actually, we will be reading and writing to files, but the class hides all of the complexity from us and allows us to focus on the game.</p><p>We will see a somewhat abstract example of persistence so that we are familiar with the code before we use something similar to save the high score in our memory game. The complete code for this example can be found in the code bundle at <code class="literal">Chapter5/Persistence/java/MainActivity.java</code> and <code class="literal">Chapter5/Persistence/layout/activity_main.xml</code>:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a project with a blank activity, just as we did in <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>. Also, clean up the code by deleting the unnecessary parts, but this isn't essential.</li><li class="listitem">Open <code class="literal">activity_main.xml</code> in the editor window and click and drag one button from the palette to the design. The default ID of the button that is assigned is perfect for our uses, so no further work is required on the UI.</li><li class="listitem">Open <code class="literal">MainActivity.java</code> in the editor window. Implement <code class="literal">View.OnClickListener</code> and autogenerate the required <code class="literal">onClick</code> method, just as we did in steps 6 and 7 of the <em>Playing sound in Android</em> example previously.</li><li class="listitem">Type the following code just after the <code class="literal">MainActivity</code> declaration. This declares our two objects that will do all the complex stuff behind the scenes: a bunch of strings that will be useful and a button:<div><pre class="programlisting">SharedPreferences prefs;
SharedPreferences.Editor editor;
String dataName = "MyData";
String stringName = "MyString";
String defaultString = ":-(";
String currentString = "";//empty
Button button1;</pre></div></li><li class="listitem">Add the next block of code to the <code class="literal">onCreate</code> method after the call to <code class="literal">setContentView</code>. We initialize our objects and set up our button. We will look closely at this code once the example is done:<div><pre class="programlisting">//initialize our two SharedPreferences objects
prefs = getSharedPreferences(dataName,MODE_PRIVATE);
editor = prefs.edit();

//Either load our string or
//if not available our default string
currentString = prefs.getString(stringName, defaultString);

 //Make a button from the button in our layout
 button1 =(Button) findViewById(R.id.button);

 //Make each it listen for clicks
 button1.setOnClickListener(this);

 //load currentString to the button
 button1.setText(currentString);</pre></div></li><li class="listitem">Now the action takes place in our <code class="literal">onClick</code> method. Add this code, which generates a random number and adds it to the end of <code class="literal">currentString</code>. Then it saves the string <a class="indexterm" id="id411"/>and sets the value of the string to the button as well:<div><pre class="programlisting">//we don't need to switch here!
//There is only one button
//so only the code that actually does stuff

//Get a random number between 0 and 9
Random randInt = new Random();
int ourRandom = randInt.nextInt(10);

//Add the random number to the end of currentString
currentString = currentString + ourRandom;

//Save currentString to a file in case the user 
//suddenly quits or gets a phone call
editor.putString(stringName, currentString);
editor.commit();

 //update the button text
 button1.setText(currentString);</pre></div></li></ol></div><p>Run the example on an emulator or a device. Notice that each time you press the button, a random number is appended to the text of the button. Now quit the app, or even shut down the device if you like. When you restart the app, our cool <code class="literal">SharedPreferences</code> class simply loads the last saved string.</p><p>Here is how the code works. There is nothing we haven't seen several times before until step 4:</p><div><pre class="programlisting">SharedPreferences prefs;
SharedPreferences.Editor editor;</pre></div><p>Here, we declare two types of <code class="literal">SharedPreferences</code> objects called <code class="literal">prefs</code> and <code class="literal">editor</code>. We will see exactly how we use them in a minute.</p><p>Next, we declare the <code class="literal">dataName</code> and <code class="literal">stringName</code> strings. We do this because to use the facilities of <code class="literal">SharedPreferences</code>, we need to refer to our collection of data, as well as any individual pieces of data within it, using a consistent name. By initializing <code class="literal">dataName</code> and <code class="literal">stringName</code>, we can use them as a name for our data store as well as a specific item within that data store, respectively. The sad face in <code class="literal">defaultString</code> gets used any time the <code class="literal">SharedPreferences</code> object needs a default because either nothing has been previously saved or the loading process fails for some reason. The <code class="literal">currentString</code> variable will hold the value of the string we will be saving and loading as well as displaying to the user <a class="indexterm" id="id412"/>of our app. Our button<code class="literal"> </code>is<code class="literal"> button1</code>:</p><div><pre class="programlisting">String dataName = "MyData";
String stringName = "MyString";
String defaultString = ":-(";
String currentString = "";//empty
Button button1;</pre></div><p>In step 5, the real action starts with this code:</p><div><pre class="programlisting">prefs = getSharedPreferences(dataName,MODE_PRIVATE);
editor = prefs.edit();

currentString = prefs.getString(stringName, defaultString);</pre></div><p>The previous code does stuff that would take a lot more code if we didn't have the useful <code class="literal">SharedPreferences</code> class. The first two lines initialize the objects and the third loads the value from our data store item, whose name is contained in <code class="literal">stringName</code>, to our <code class="literal">currentString</code> variable. The first time this happens, it uses the <code class="literal">defaultString</code> value because nothing is stored there yet, but once there is a value stored, this single line of code that will load up our saved string.</p><p>At the end of step 5, we set up our button as we have done many times before. Moving on to step 6 in the <code class="literal">onClick</code> method, there is no <code class="literal">switch</code> block because there is only one button. So if a click is detected, it must be our button. Here are the first three lines from <code class="literal">onClick</code>:</p><div><pre class="programlisting">Random randInt = new Random();
int ourRandom = randInt.nextInt(10);
currentString = currentString + ourRandom;</pre></div><p>We generate a random number and append it to the <code class="literal">currentString</code> variable. Next, still in <code class="literal">onClick</code>, we do this:</p><div><pre class="programlisting">editor.putString(stringName, currentString);
editor.commit();</pre></div><p>This is like the opposite of the code that loaded our string in <code class="literal">onCreate</code>. The first of the previous two lines identifies the place in the data store to write the value to (<code class="literal">stringName</code>) and the value to be written there (<code class="literal">currentString</code>). The next line, <code class="literal">editor.commit();</code>, simply says, "go ahead and do it."</p><p>The following line <a class="indexterm" id="id413"/>displays <code class="literal">currentString</code> as text on our button so that we can see what is going on:</p><div><pre class="programlisting">button1.setText(currentString);</pre></div><div><div><h3 class="title"><a id="tip39"/>Tip</h3><p>For more on persistence, take a look at the second question of the <em>Self-test questions</em> section at the end of this chapter.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec39"/>The memory game</h1></div></div></div><p>The code in the <a class="indexterm" id="id414"/>memory game shouldn't challenge us too much because we have done the background research on threads, arrays, sound, and persistence. There will be some new-looking code and we will examine it in detail when it crops up.</p><p>Here is a screenshot of our finished game:</p><div><img alt="The memory game" src="img/8859OS_05_15.jpg"/></div><p>This is the home <a class="indexterm" id="id415"/>screen. It shows the high score, which persists between play sessions and when the device is shut down. It also shows a <strong>Play</strong> button, which will take the player to the main game screen. Take a look at the following screenshot:</p><div><img alt="The memory game" src="img/8859OS_05_16.jpg"/></div><p>The game screen itself will play a sequence of sounds and numbers. The corresponding button will <em>wobble</em> in time with the corresponding sound. Then the player will be able to interact with the <a class="indexterm" id="id416"/>buttons and attempt to copy the sequence. For every part of the sequence that the player gets right, they will be awarded points.</p><p>If the sequence is copied in its entirety, then a new and longer sequence will be played and again the player will attempt to repeat the sequence. This continues until the player gets a part of a sequence wrong.</p><p>As the score increases, it is displayed in the relevant TextView, and when a sequence is copied correctly, the level is increased and displayed below the score.</p><p>The player can start a new game by pressing the <strong>Replay</strong> button. If a high score is achieved, it will be saved to a file and displayed on the home screen.</p><p>The implementation of the game is divided into five phases. The end of a phase would be a good place to take a break. Here are the different phases of the game:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Phase 1</strong>: This implements the UI and some basics.</li><li class="listitem" style="list-style-type: disc"><strong>Phase 2</strong>: This prepares our variables and presents the pattern (to be copied) to the player.</li><li class="listitem" style="list-style-type: disc"><strong>Phase 3</strong>: In this phase, we will handle the player's response when they try to copy the pattern.</li><li class="listitem" style="list-style-type: disc"><strong>Phase 4</strong>: Here, we will use what we just learned about persistence to maintain the player's high score when they quit the game or turn off their device.</li><li class="listitem" style="list-style-type: disc"><strong>Phase 5</strong>: At the end of phase 4, we will have a fully working memory game. However, to add to our repertoire of Android skills, after we have discussed Android UI animations near the end of this chapter, we will complete this phase, which will enhance our memory game.</li></ul></div><p>All the files containing the complete code and the sound files after all five stages can be found in the download <a class="indexterm" id="id417"/>bundle in the <code class="literal">Chapter5/MemoryGame</code> folder. In this project, however, there is a lot to be learned from going through each of the stages.</p><div><div><div><div><h2 class="title"><a id="ch05lvl2sec58"/>Phase 1 – the UI and the basics</h2></div></div></div><p>Here, we <a class="indexterm" id="id418"/>will lay out a home menu screen UI and a UI for the game itself. We will also configure some IDs for some of the UI elements so that we can control them in our Java code later:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new application called <code class="literal">Memory Game</code> and clean up the code if you wish.</li><li class="listitem">Now we create a new activity and call it <code class="literal">GameActivity</code>. So right-click on the <code class="literal">java</code> folder in Project Explorer, navigate to <strong>New</strong> |<strong> Activity</strong>, then click on <strong>Next</strong>, name the activity as <code class="literal">GameActivity</code>, and click on <strong>Finish</strong>. For clarity, clean up this activity in the same way as we cleaned up all our others.</li><li class="listitem">Make the game fullscreen and lock the orientation as we did in the <em>Going fullscreen and locking orientation</em> tutorial at the end of <a class="link" href="ch04.html" title="Chapter 4. Discovering Loops and Methods">Chapter 4</a>, <em>Discovering Loops and Methods</em>.</li><li class="listitem">Open the <code class="literal">activity_main.xml</code> file from the <code class="literal">res/layout</code> folder.</li></ol></div><p>Let's quickly create our home screen UI by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">activity_main.xml</code> in the editor and delete the <strong>Hello World</strong> TextView.</li><li class="listitem">Click and drag the following: <strong>Large Text</strong> to the top center (to create our title text), <strong>Image</strong> just below that, another <strong>LargeText</strong> below that (for our high score), and a <strong>Button</strong> (for our player to click to play). Your UI should look a bit like <a class="indexterm" id="id419"/>what is shown in the following screenshot:<div><img alt="Phase 1 – the UI and the basics" src="img/8859OS_05_04.jpg"/></div></li><li class="listitem">Adjust the <strong>text</strong> properties of the two TextViews and the Button element to make it plain what each will be used for. As usual, you can replace the Android icon in the <strong>ImageView</strong> with any image you choose (as we did in <a class="link" href="ch04.html" title="Chapter 4. Discovering Loops and Methods">Chapter 4</a>, <em>Discovering Loops and Methods</em>, in the <em>Adding a custom image</em> tutorial).</li><li class="listitem">Tweak the sizes of the elements in the usual way to suit the emulator or device you will be running the game on.</li><li class="listitem">Let's make the ID for our <strong>Hi Score</strong> TextView more relevant to its purpose. Left-click to select the <strong>Hi Score</strong> TextView, find its <strong>id</strong> property in the <strong>Properties</strong> window, and change it to <code class="literal">textHiScore</code>. The IDs of the image and the title are not required, and the existing ID of the play button is <code class="literal">button</code>, which seems appropriate already. So there is nothing else to change here.</li></ol></div><p>Let's wire up the <strong>Play</strong> button to create a link between the home and the game screens, as follows:</p><div><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">MainActivity.java</code> in the editor.</li><li class="listitem">Add <code class="literal">implements View.onClickListener</code> to the end of the <code class="literal">MainActivity</code> declaration so that it now looks like this:<div><pre class="programlisting">  public class MainActivity extends Activity implements View.OnClickListener {</pre></div></li><li class="listitem">Now hover your mouse over the line you just typed and right-click on it. Now click on <strong>Generate</strong>, then on <strong>Implement methods...</strong>, and then on <strong>OK</strong> to have Android Studio autogenerate the <code class="literal">onClick</code> method we must implement.</li><li class="listitem">At the end of <a class="indexterm" id="id420"/>our <code class="literal">onCreate</code> method, before the closing curly brace, enter the following code to get a reference to our <strong>Play</strong> button and listen to clicks:<div><pre class="programlisting">  //Make a button from the button in our layout
   Button button =(Button) findViewById(R.id.button);

   //Make each it listen for clicks
   button.setOnClickListener(this);</pre></div></li><li class="listitem">Scroll down to our <code class="literal">onClick</code> method and enter the following code in its body to have the <strong>Play</strong> button take the player to our <code class="literal">GameActivity</code>, which we will design soon:<div><pre class="programlisting">  Intent i;
   i = new Intent(this, GameActivity.class);
   startActivity(i);</pre></div></li></ol></div><p>At this point, the app will run and the player can click on the <strong>Play</strong> button to take them to our game screen. So let's quickly create our game screen UI:</p><div><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">activity_game.xml</code> in the editor and delete the <strong>Hello World</strong> TextView.</li><li class="listitem">Drag three <strong>Large Text</strong> elements one below the other and center them horizontally. Below them, add four buttons stacked one on top of the other, and finally, add another button below that but offset it to the right-hand side so that it looks like what is shown in the next screenshot. I have also adjusted the text properties for the UI elements to make it clear what each will be used for, but this is optional because our Java code will do all of the work for us. You can also tweak the sizes of the elements in the usual way to suit the emulator or device you will be running the game on.<div><img alt="Phase 1 – the UI and the basics" src="img/8859OS_05_05.jpg"/></div></li><li class="listitem">Now let's assign some useful IDs to our UI elements so that we can do some Java magic with them in the next tutorial. Here is a table that matches the UI elements <a class="indexterm" id="id421"/>shown in the last screenshot with the <strong>id</strong> property value that you need to assign. Assign the following <strong>id</strong> property values to the corresponding UI elements:<div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Purpose</p>
</th><th style="text-align: left" valign="bottom">
<p>Default id property</p>
</th><th style="text-align: left" valign="bottom">
<p>New id to assign</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Score indicator</p>
</td><td style="text-align: left" valign="top">
<p>textView</p>
</td><td style="text-align: left" valign="top">
<p>textScore</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Difficulty indicator</p>
</td><td style="text-align: left" valign="top">
<p>textView2</p>
</td><td style="text-align: left" valign="top">
<p>textDifficulty</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Watch/go indicator</p>
</td><td style="text-align: left" valign="top">
<p>textView3</p>
</td><td style="text-align: left" valign="top">
<p>textWatchGo</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Button 1</p>
</td><td style="text-align: left" valign="top">
<p>button</p>
</td><td style="text-align: left" valign="top">
<p>Leave at default</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Button 2</p>
</td><td style="text-align: left" valign="top">
<p>button2</p>
</td><td style="text-align: left" valign="top">
<p>Leave at default</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Button 3</p>
</td><td style="text-align: left" valign="top">
<p>button3</p>
</td><td style="text-align: left" valign="top">
<p>Leave at default</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Button 4</p>
</td><td style="text-align: left" valign="top">
<p>button4</p>
</td><td style="text-align: left" valign="top">
<p>Leave at default</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Replay button</p>
</td><td style="text-align: left" valign="top">
<p>button5</p>
</td><td style="text-align: left" valign="top">
<p>buttonReplay</p>
</td></tr></tbody></table></div></li></ol></div><p>Now that we have our game menu and actual game UI ready to go, we can start to make it work.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec59"/>Phase 2 – preparing our variables and presenting the pattern</h2></div></div></div><p>Here, we <a class="indexterm" id="id422"/>will set up a whole load of variables and objects for us to use, both in this phase and in the later phases. We will also implement the parts of the code that present a pattern to the player. We will add code that enables the player to respond in a later phase:</p><div><ol class="orderedlist arabic"><li class="listitem">Open <a class="indexterm" id="id423"/><code class="literal">GameActivity.java</code> in the editor window.</li><li class="listitem">I made the sounds by finding a pleasing one then slowly increasing the <strong>Frequency</strong> slider for each subsequent sample. You can use my sound from the <code class="literal">assets</code> folder in the <code class="literal">MemoryGame</code> project or create your own sound using Bfxr.</li><li class="listitem">In the <code class="literal">main</code> folder in the project explorer window, we need to add a folder called <code class="literal">assets</code>. So in the project explorer window, right-click on the <code class="literal">main</code> folder and navigate to <strong>New</strong> | <strong>Directory</strong>. Type <code class="literal">assets</code> in the <strong>New Directory</strong> dialog box.</li><li class="listitem">Now copy and paste the four sound files to the newly created <code class="literal">assets</code> folder. You can do so like this: select the files, right-click on them, and then click on <strong>Copy</strong>. Then click on the <code class="literal">assets</code> folder in the Android Studio project explorer. Now right-click on the <code class="literal">assets</code> folder and click on <strong>Paste</strong>.</li></ol></div><p>Let's prepare <code class="literal">GameActivity</code> to listen to button clicks just as we did for <code class="literal">MainActivity</code>, as follows:</p><div><ol class="orderedlist arabic"><li class="listitem">Add <code class="literal">implementsView.onClickListener</code> to the end of the <code class="literal">GameActivity</code> declaration so that it now looks like this:<div><pre class="programlisting">  public class GameActivity extends Activity implements View.OnClickListener {</pre></div></li><li class="listitem">Now hover your mouse over the line you just typed and right-click on it. Now click on <strong>Generate</strong>, then on <strong>Implement methods...</strong>, and then on <strong>OK</strong> to have Android Studio autogenerate the <code class="literal">onClick</code> method that we will use shortly.</li><li class="listitem">Let's declare some objects that we need to reference our UI and our <code class="literal">int</code> references for the sound effects we will load soon. Write the code just after the declaration for <code class="literal">GameActivity</code>. By putting them here, they will be available to all parts of our code in <code class="literal">GameActivity.java</code>. Here is the code in context:<div><pre class="programlisting">public class GameActivity extends Activity implements View.OnClickListener {

//Prepare objects and sound references

    //initialize sound variables
    private SoundPool soundPool;
    int sample1 = -1;
    int sample2 = -1;
    int sample3 = -1;
    int sample4 = -1;

    //for our UI
    TextView textScore;
    TextView textDifficulty;
    TextView textWatchGo;

    Button button1;
    Button button2;
    Button button3;
    Button button4;
    Button buttonReplay;</pre></div></li><li class="listitem">Now, after <a class="indexterm" id="id424"/>the last line of code from the previous step, enter the following code snippet, which will declare and initialize <a class="indexterm" id="id425"/>some variables for use in our thread. Notice that at the end, we also declare <code class="literal">myHandler</code>, which will be our thread, and <code class="literal">gameOn</code> to control whether our code within the thread is executed:<div><pre class="programlisting">//Some variables for our thread
int difficultyLevel = 3;
//An array to hold the randomly generated sequence
int[] sequenceToCopy = new int[100];

private Handler myHandler;
//Are we playing a sequence at the moment?
boolean playSequence = false;
//And which element of the sequence are we on
int elementToPlay = 0;

//For checking the players answer
int playerResponses;
int playerScore;
boolean isResponding;</pre></div></li><li class="listitem">Just after our call to <code class="literal">setContentView</code> in the <code class="literal">onCreate</code> method, we make our <a class="indexterm" id="id426"/>sound effects ready to be played:<div><pre class="programlisting">soundPool = new SoundPool(10, AudioManager.STREAM_MUSIC,0);
try{
  //Create objects of the 2 required classes
  AssetManager assetManager = getAssets();
  AssetFileDescriptor descriptor;

  //create our three fx in memory ready for use
  descriptor = assetManager.openFd("sample1.ogg");
  sample1 = soundPool.load(descriptor, 0);

        descriptor = assetManager.openFd("sample2.ogg");
        sample2 = soundPool.load(descriptor, 0);


        descriptor = assetManager.openFd("sample3.ogg");
        sample3 = soundPool.load(descriptor, 0);

        descriptor = assetManager.openFd("sample4.ogg");
        sample4 = soundPool.load(descriptor, 0);


        }catch(IOException e){
            //catch exceptions here
        }</pre></div></li><li class="listitem">Just after <a class="indexterm" id="id427"/>the code in the last step and still within the <code class="literal">onCreate</code> method, we initialize our objects and set click listeners for the buttons:<div><pre class="programlisting">//Reference all the elements of our UI 
//First the TextViews
textScore = (TextView)findViewById(R.id.textScore);
textScore.setText("Score: " + playerScore);
textDifficulty = (TextView)findViewById(R.id.textDifficulty);

textDifficulty.setText("Level: " + difficultyLevel);
textWatchGo = (TextView)findViewById(R.id.textWatchGo);
        
//Now the buttons
button1 = (Button)findViewById(R.id.button);
button2 = (Button)findViewById(R.id.button2);
button3 = (Button)findViewById(R.id.button3);
button4 = (Button)findViewById(R.id.button4);
buttonReplay = (Button)findViewById(R.id.buttonReplay);

//Now set all the buttons to listen for clicks
button1.setOnClickListener(this);
button2.setOnClickListener(this);
button3.setOnClickListener(this);
button4.setOnClickListener(this);
buttonReplay.setOnClickListener(this);</pre></div></li><li class="listitem">Now, after the last line of the code from the previous step, enter the code that will create <a class="indexterm" id="id428"/>our thread. We will add the details in the next step within the <code class="literal">if(playSequence)</code> block. Notice that the thread is run every nine-tenths of a second (900 milliseconds). Notice that we <a class="indexterm" id="id429"/>start the thread but do not set <code class="literal">playSequence</code> to <code class="literal">true</code>. So it will not do anything yet:<div><pre class="programlisting">//This is the code which will define our thread
myHandler = new Handler() {
  public void handleMessage(Message msg) {
    super.handleMessage(msg);

          if (playSequence) {
          //All the thread action will go here

          }

          myHandler.sendEmptyMessageDelayed(0, 900);
  }
};//end of thread

myHandler.sendEmptyMessage(0);</pre></div></li><li class="listitem">Before we look at the code that will run in our thread, we need a way to generate a random sequence appropriate for the difficulty level. This situation sounds like a candidate for a method. Enter this method just before the closing curly brace of the <code class="literal">GameActivity</code> class:<div><pre class="programlisting">public void createSequence(){
  //For choosing a random button
   Random randInt = new Random();
   int ourRandom;
   for(int i = 0; i &lt; difficultyLevel; i++){
   //get a random number between 1 and 4
         ourRandom = randInt.nextInt(4);
         ourRandom ++;//make sure it is not zero
         //Save that number to our array
         sequenceToCopy[i] = ourRandom;
   }

}</pre></div></li><li class="listitem">We also need <a class="indexterm" id="id430"/>a method to prepare and start our thread. Type the following method after the closing curly brace of <code class="literal">createSequence</code>:<div><div><h3 class="title"><a id="tip40"/>Tip</h3><p>Actually, the order of implementation of the methods is unimportant. However, following along in order will mean our code will look the same. Even if you are referring to the downloaded code, the order will be the same.</p></div></div><div><pre class="programlisting">public void playASequence(){
    createSequence();
    isResponding = false;
    elementToPlay = 0;
    playerResponses = 0;
    textWatchGo.setText("WATCH!");
    playSequence = true;
}</pre></div></li><li class="listitem">Just before we look at the details of the thread code, we need a method to tidy up our variables after the sequence has been played. Enter this method after the <a class="indexterm" id="id431"/>closing curly brace of <code class="literal">playASequence</code>:<div><pre class="programlisting">public void sequenceFinished(){
        playSequence = false;
        //make sure all the buttons are made visible
        button1.setVisibility(View.VISIBLE);
        button2.setVisibility(View.VISIBLE);
        button3.setVisibility(View.VISIBLE);
        button4.setVisibility(View.VISIBLE);
        textWatchGo.setText("GO!");
        isResponding = true;
    }</pre></div></li><li class="listitem">Finally, we will implement our thread. There is some new code in this part, which we will go through in detail after we finish this phase of the project. Enter this code between the opening and closing curly braces of the <code class="literal">if(playSequence){ }</code> block:<div><pre class="programlisting">if (playSequence) {
  //All the thread action will go here
  //make sure all the buttons are made visible
  button1.setVisibility(View.VISIBLE);
  button2.setVisibility(View.VISIBLE);
  button3.setVisibility(View.VISIBLE);
  button4.setVisibility(View.VISIBLE);

  switch (sequenceToCopy[elementToPlay]){
    case 1:
      //hide a button 
button1.setVisibility(View.INVISIBLE);
       //play a sound
       soundPool.play(sample1, 1, 1, 0, 0, 1);
       break;

    case 2:
      //hide a button 
button2.setVisibility(View.INVISIBLE)
      //play a sound
      soundPool.play(sample2, 1, 1, 0, 0, 1);
      break;

    case 3:
      //hide a button button3.setVisibility(View.INVISIBLE);
      //play a sound
      soundPool.play(sample3, 1, 1, 0, 0, 1);
      break;

  case 4:
      //hide a button 
button4.setVisibility(View.INVISIBLE);
      //play a sound
      soundPool.play(sample4, 1, 1, 0, 0, 1);
         break;
   }

   elementToPlay++;
   if(elementToPlay == difficultyLevel){
   sequenceFinished();
   }
}

    myHandler.sendEmptyMessageDelayed(0, 900);
}

};</pre></div></li></ol></div><div><div><h3 class="title"><a id="tip41"/>Tip</h3><p>Just before the closing curly brace of <code class="literal">onCreate</code>, we could initiate a sequence by calling our <code class="literal">playASequence</code> method, like this:</p><div><pre class="programlisting">playASequence();</pre></div><p>We could then run our app, click on <strong>Play</strong> on the home screen, and watch as a sequence of four random buttons and their matching sounds begins, with the sounds being played. In the next phase, we will wire up the <strong>Replay</strong> button so that the player can start the sequence when they are ready.</p></div></div><p>Phew! That was a <a class="indexterm" id="id432"/>long one. Actually, there is not much new there, but we did cram in just about everything we ever learned about Java and Android into one place, and we used it in new ways too. So we will look at it step by step and give extra focus to the parts that might seem tricky.</p><p>Let's look at each <a class="indexterm" id="id433"/>new piece of code in turn.</p><p>From steps 1 to 7, we initialized our variables, set up our buttons, and loaded our sounds as we have done before. We also put in the outline of the code for our thread.</p><p>In step 8, we implemented the <code class="literal">createSequence</code> method. We used a <code class="literal">Random</code> object to generate a sequence of random numbers between 1 and 4. We did this in a <code class="literal">for</code> loop, which loops until a sequence the length of <code class="literal">difficultyLevel</code> has been created. The sequence is stored in an array called <code class="literal">sequenceToCopy</code>, which we can later use to compare to the player's response:</p><div><pre class="programlisting">public void createSequence(){
        //For choosing a random button
        Random randInt = new Random();
        int ourRandom;
        for(int i = 0; i &lt; difficultyLevel; i++){
            //get a random number between 1 and 4
            ourRandom = randInt.nextInt(4);
            ourRandom ++;//make sure it is not zero
            //Save that number to our array
            sequenceToCopy[i] = ourRandom;
        }

    }</pre></div><p>In step 9, we implemented <code class="literal">playASequence</code>. First, we call <code class="literal">createSequence</code> to load our <code class="literal">sequenceToCopy</code> array. Then we set <code class="literal">isResponding</code> to <code class="literal">false</code> because we don't want the player to bash buttons while the sequence is still playing. We set <code class="literal">elementToPlay</code> to <code class="literal">0</code> as this is the first element of our array. We also set <code class="literal">playerResponses</code> to <code class="literal">0</code>, ready to count the player's responses. Next, we set some text on the UI to <code class="literal">"WATCH!"</code> to make it clear to the player that the <a class="indexterm" id="id434"/>sequence is playing. Finally, we set <code class="literal">playSequence</code> to <code class="literal">true</code>, which allows the code in our thread to run once every 900 milliseconds. Here is the code we have just analyzed:</p><div><pre class="programlisting">public void playASequence(){
        createSequence();
        isResponding = false;
        elementToPlay = 0;
        playerResponses = 0;
        textWatchGo.setText("WATCH!");
        playSequence = true;

    }</pre></div><p>In step 10, we <a class="indexterm" id="id435"/>handle <code class="literal">sequenceFinished</code>. We set <code class="literal">playSequence</code> to <code class="literal">false</code>, which prevents the code in our thread from running. We set all the buttons back to visible because, as we will see in the thread code, we set them to invisible to emphasize which button comes next in the sequence. We set our UI text to <strong>GO!</strong> to make it clear. It is time for the player to try and copy the sequence. For the code in the <code class="literal">checkElement</code> method to run, we set <code class="literal">isResponding</code> to <code class="literal">true</code>. We will look at the code in the <code class="literal">checkElement</code> method in the next phase:</p><div><pre class="programlisting">public void sequenceFinished(){
        playSequence = false;
        //make sure all the buttons are made visible
        button1.setVisibility(View.VISIBLE);
        button2.setVisibility(View.VISIBLE);
        button3.setVisibility(View.VISIBLE);
        button4.setVisibility(View.VISIBLE);
        textWatchGo.setText("GO!");
        isResponding = true;
    }</pre></div><p>In step 11, we implement our thread. It's quite long but not too complicated. First, we set all the buttons to visible as this is quicker than checking which one of them is currently invisible and setting just that one:</p><div><pre class="programlisting">if (playSequence) {
  //All the thread action will go here
  //make sure all the buttons are made visible
  button1.setVisibility(View.VISIBLE);
  button2.setVisibility(View.VISIBLE);
  button3.setVisibility(View.VISIBLE);
  button4.setVisibility(View.VISIBLE);</pre></div><p>Then we switch based on what number is next in our sequence, hide the appropriate button, and play the appropriate sound. Here is the first case in the <code class="literal">switch</code> block for reference. The other <a class="indexterm" id="id436"/>case elements perform the same function but on a different button and with a different sound:</p><div><pre class="programlisting">switch (sequenceToCopy[elementToPlay]){
  case 1:
    //hide a buttonbutton1.setVisibility(View.INVISIBLE);
         //play a sound
         soundPool.play(sample1, 1, 1, 0, 0, 1);
         break;

    //case 2, 3 and 4 go here</pre></div><p>Now we increment <code class="literal">elementToPlay</code>, ready to play the next part of the sequence when the thread runs again in approximately 900 milliseconds:</p><div><pre class="programlisting">   elementToPlay++;</pre></div><p>Next, we check <a class="indexterm" id="id437"/>whether we have played the last part of the sequence. If we have, we call our <code class="literal">sequenceFinished</code> method to set things up for the player to attempt their answer:</p><div><pre class="programlisting">   if(elementToPlay == difficultyLevel){
   sequenceFinished();
   }
}</pre></div><p>Finally, we tell the thread when we would like to run our code again:</p><div><pre class="programlisting">    myHandler.sendEmptyMessageDelayed(0, 900);
}

};</pre></div><p>When you ran a sequence (see the previous tip), did you notice an imperfection/bug with our game operation? This has to do with the way the last element of the sequence is animated. It is because our <code class="literal">sequenceFinished</code> method makes all the buttons visible so soon after the button has just been made invisible that looks like the button is never made invisible at all. We will solve the problem of the button that doesn't stay invisible long enough when we <a class="indexterm" id="id438"/>learn about UI animation in phase 5.</p><p>Now let's <a class="indexterm" id="id439"/>handle the player's response.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec60"/>Phase 3 – the player's response</h2></div></div></div><p>We now <a class="indexterm" id="id440"/>have an app that plays a random sequence of button flashes and matching sounds. It also stores that sequence in an array. So what we have to do now is enable the player to attempt to replicate the sequence and score points if successful.</p><p>We can do all of this in two phases. First, we need to handle the button presses, which can pass all the hard work to a method that will do everything else.</p><p>Let's write the code and look at it as we go. Afterwards, we will closely examine the less obvious parts:</p><div><ol class="orderedlist arabic"><li class="listitem">Here is how we handle the button presses. We have the empty body of the <code class="literal">switch</code> statement with an extra <code class="literal">if</code> statement that checks whether there is a sequence currently being played. If there is a sequence, then no input is accepted. We will start to fill the code in the empty body in the next step:<div><pre class="programlisting">if(!playSequence) {//only accept input if sequence not playing
            switch (view.getId()) {
                //case statements here...
            }
}</pre></div></li><li class="listitem">Now, here is the code that handles <code class="literal">button1</code>. Notice that it just plays the sound related to <code class="literal">button1</code> and then calls the <code class="literal">checkElement</code> method, passing a value of 1. This is all we have to do for the buttons 1 through 4: play a sound and then tell our new method (<code class="literal">checkElement</code>) which numbered button was pressed, and <code class="literal">checkElement</code> will do the rest:<div><pre class="programlisting">case R.id.button:
  //play a sound
   soundPool.play(sample1, 1, 1, 0, 0, 1);
   checkElement(1);
   break;</pre></div></li><li class="listitem">Here is the near-identical code for buttons 2 through 4. Notice that the value passed to <code class="literal">checkElement</code> and the sound sample that is played are the only differences from the previous step. Enter this code directly after the code in the previous step:<div><pre class="programlisting">case R.id.button2:
  //play a sound
   soundPool.play(sample2, 1, 1, 0, 0, 1);
   checkElement(2);
   break;

case R.id.button3:
   //play a sound
   soundPool.play(sample3, 1, 1, 0, 0, 1);
   checkElement(3);
   break;

case R.id.button4:
   //play a sound
   soundPool.play(sample4, 1, 1, 0, 0, 1);
   checkElement(4);
   break;</pre></div></li><li class="listitem">Here is the last part of the code in our <code class="literal">onClick</code> method. This handles the <strong>Restart</strong> button. The code just resets the score and the difficulty level and then calls our <code class="literal">playASequence</code> method, which does the rest of the work of starting the <a class="indexterm" id="id441"/>game again. Enter this code directly after the code in the previous step:<div><pre class="programlisting">case R.id.buttonReplay:
   difficultyLevel = 3;
   playerScore = 0;
   textScore.setText("Score: " + playerScore);
   playASequence();
   break;</pre></div></li><li class="listitem">Finally, here is our do-everything method. This is quite a long method compared to most of our previous methods, but it helps to see its entire structure. We will break this down line by line in a minute. Enter the following code, after which you will actually be able to play the game and get a score:<div><pre class="programlisting">public void checkElement(int thisElement){

if(isResponding) {
  playerResponses++;
   if (sequenceToCopy[playerResponses-1] == thisElement) { //Correct
   playerScore = playerScore + ((thisElement + 1) * 2);
   textScore.setText("Score: " + playerScore);
   if (playerResponses == difficultyLevel) {//got the whole sequence
   //don't checkElement anymore
   isResponding = false;
   //now raise the difficulty
   difficultyLevel++;
   //and play another sequence
   playASequence();
    }

} else {//wrong answer
  textWatchGo.setText("FAILED!");
    //don't checkElement anymore
    isResponding = false;
}
}</pre></div></li></ol></div><p>We covered the methods fairly comprehensively as we went through the tutorial. The one elephant in the room, however, is the apparent sprawl of code in the <code class="literal">checkElement</code> method. So let's go through all of the code in step 6, line by line.</p><p>First, we have the method signature. Notice that it does not return a value but it receives an <code class="literal">int</code> value. Remember that it is the <code class="literal">onClick</code> method that calls this method and it passes a <code class="literal">1</code>, <code class="literal">2</code>, <code class="literal">3</code>, or <code class="literal">4</code>, depending upon which button was clicked:</p><div><pre class="programlisting">public void checkElement(int thisElement){</pre></div><p>Next, we wrap the rest of this code into an <code class="literal">if</code> statement. Here is the <code class="literal">if</code> statement. We enter the block <a class="indexterm" id="id442"/>when the <code class="literal">isResponding</code> Boolean is <code class="literal">true</code>, and <code class="literal">isResponding</code> is set to <code class="literal">true</code> when the <code class="literal">sequenceFinnished</code> method completes, which is just what we need so that the player can't mash the buttons until it is time to do so and our game is ready to listen:</p><div><pre class="programlisting">if(isResponding) {</pre></div><p>Here is what happens inside the <code class="literal">if</code> block. We increment the number of the player's responses received in the <code class="literal">playerResponses</code> variable:</p><div><pre class="programlisting">playerResponses++;</pre></div><p>Now we check whether the number passed to the <code class="literal">checkElement</code> method and stored in <code class="literal">thisElement</code> matches the appropriate part of the sequence the player is trying to copy. If it matches, we increase <code class="literal">playerScore</code> by an amount relative to the number of correctly matched parts of the sequence so far. Then we set the score on the screen. Notice that if the response does not match, there is an <code class="literal">else</code> block to go with this <code class="literal">if</code> block that we will explain soon:</p><div><pre class="programlisting">   if (sequenceToCopy[playerResponses-1] == thisElement) {  //Correct
      playerScore = playerScore + ((thisElement + 1) * 2);
      textScore.setText("Score: " + playerScore);
      </pre></div><p>Next, we have another <code class="literal">if</code> block. Note that this <code class="literal">if</code> block is nested inside the <code class="literal">if</code> block we just described. So it will only be tested and potentially run if the player's response was correct. This <code class="literal">if</code> statement checks whether it is the last part of the sequence, like this:</p><div><pre class="programlisting">      if (playerResponses == difficultyLevel) {</pre></div><p>If it is the last part of the sequence, it executes the following lines:</p><div><pre class="programlisting">//got the whole sequence
         //don't checkElement anymore
         isResponding = false;
         //now raise the difficulty
         difficultyLevel++;
         //and play another sequence
         playASequence();
   }</pre></div><p>What is happening <a class="indexterm" id="id443"/>inside the nested <code class="literal">if</code> statement, which checks whether the whole sequence has been correctly copied, is the following: It sets <code class="literal">isResponding</code> to <code class="literal">false</code>, so the player gets no response from the buttons. It then raises the difficulty level by 1 so that the sequence is a bit tougher next time. Finally, it calls the <code class="literal">playSequence</code> method to play another sequence and the whole process starts again.</p><p>Here is the <code class="literal">else</code> block, which runs if the player gets part of the sequence wrong:</p><div><pre class="programlisting">} else {
  //wrong answer
  textWatchGo.setText("FAILED!");
  //don't checkElement anymore
  isResponding = false;
  }
}</pre></div><p>Here, we set some text on the screen and set <code class="literal">isResponding</code> to <code class="literal">false</code>.</p><p>Now let's use what we learned about the <code class="literal">SharedPreferences</code> class to preserve the high scores.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec61"/>Phase 4 – preserving the high score</h2></div></div></div><p>This phase <a class="indexterm" id="id444"/>is nice and short. We will use what we learned earlier in the chapter to save the player's score if it is a new high score, and then display the best score in the <strong>hi-score</strong> TextView in our <code class="literal">MainActivity</code>:</p><div><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">MainActivity.java</code> in the editor window.</li><li class="listitem">Then we declare our objects used to read from a file just after the class declaration, like this:<div><pre class="programlisting">public class MainActivity extends Activity implements View.OnClickListener{

    <strong>//for our hiscore (phase 4)</strong>
<strong>    SharedPreferences prefs;</strong>
<strong>    String dataName = "MyData";</strong>
<strong>    String intName = "MyInt";</strong>
<strong>    int defaultInt = 0;</strong>
<strong>    //both activities can see this</strong>
<strong>    public static int hiScore;</strong>
</pre></div></li><li class="listitem">Now, just after our call to <code class="literal">setContentView</code> in the <code class="literal">onCreate</code> method, we initialize our <a class="indexterm" id="id445"/>objects, read from our file, and set the result to our <code class="literal">hiScore</code> variable. We then display it to the player:<div><pre class="programlisting">//for our high score (phase 4)
//initialize our two SharedPreferences objects
prefs = getSharedPreferences(dataName,MODE_PRIVATE);

//Either load our High score or
//if not available our default of 0
hiScore = prefs.getInt(intName, defaultInt);

//Make a reference to the Hiscore textview in our layout
TextView textHiScore =(TextView) findViewById(R.id.textHiScore);
//Display the hi score
textHiScore.setText("Hi: "+ hiScore);</pre></div></li><li class="listitem">Next, we <a class="indexterm" id="id446"/>need to go back to the <code class="literal">GameActivity.java</code> file.</li><li class="listitem">We declare our objects to edit our file, this time like this:<div><pre class="programlisting">//for our hiscore (phase 4)
SharedPreferences prefs;
SharedPreferences.Editor editor;
String dataName = "MyData";
String intName = "MyInt";
int defaultInt = 0;
int hiScore;</pre></div></li><li class="listitem">Just after the call to <code class="literal">setContentView</code> in the <code class="literal">onCreate</code> method, we instantiate our objects and assign a value to <code class="literal">hiScore</code>:<div><pre class="programlisting">//phase 4
//initialize our two SharedPreferences objects
prefs = getSharedPreferences(dataName,MODE_PRIVATE);
editor = prefs.edit();
hiScore = prefs.getInt(intName, defaultInt);</pre></div></li><li class="listitem">The only thing that is different to what we have already learned is that we need to consider where we put the code to test for a high score and where to write to our file if appropriate. Consider this: eventually, every player must fail. Furthermore, the point at which they fail is the point when their score is at its highest, yet before it is reset when they try again. Place the following code in the <code class="literal">else</code> block, which handles a wrong answer from the player. The highlighted <a class="indexterm" id="id447"/>code is the new code; the rest is there to help you with the context:<div><pre class="programlisting">} else {//wrong answer

  textWatchGo.setText("FAILED!");
    //don't checkElement anymore
    isResponding = false;

<strong>   //for our high score (phase 4)</strong>
<strong>   if(playerScore &gt; hiScore) {</strong>
<strong>    hiScore = playerScore;</strong>
<strong>         editor.putInt(intName, hiScore);</strong>
<strong>         editor.commit();</strong>
<strong>         Toast.makeText(getApplicationContext(), "New Hi-score", Toast.LENGTH_LONG).show();</strong>
<strong>   }</strong>

}</pre></div></li></ol></div><p>Play the game and get a high score. Now quit the app or even restart the phone. When you come back to the app, your high score is still there.</p><p>The code we added in this phase is nearly the same as the code we wrote in our previous example of persistence, the only difference being that we wrote to the data store when a new <a class="indexterm" id="id448"/>high score was achieved instead of when a button was pressed. In addition, we used the <code class="literal">editor.putInt</code> method because we were saving an integer instead of <code class="literal">editor.putString</code> when we were saving a string.</p></div><div><div><div><div><h2 class="title"><a id="ch05lvl2sec62"/>Animating our game</h2></div></div></div><p>Before <a class="indexterm" id="id449"/>we go ahead, let's just think about animation. What is it exactly? The word probably conjures up images of moving cartoon characters and in-game characters of a video game.</p><p>We need to animate our buttons (make them move) to make it clear when they are part of the sequence. We saw that simply making one disappear and then reappear was inadequate.</p><p>The thought of controlling the movement of UI elements might make us imagine complex <code class="literal">for</code> loops and per-pixel calculations.</p><p>Fortunately, Android provides us with the <code class="literal">Animation</code> class, which allows us to animate UI objects without <a class="indexterm" id="id450"/>any such per-pixel awkwardness. Here is how it works.</p><div><div><h3 class="title"><a id="note26"/>Note</h3><p>Of course, to fully control the shape and size of in-game objects, we must eventually learn to manipulate individual pixels and lines. We will do so from <a class="link" href="ch07.html" title="Chapter 7. Retro Squash Game">Chapter 7</a>, <em>Retro Squash Game</em>, onwards, when we make a retro pong-style squash game.</p></div></div><div><div><div><div><h3 class="title"><a id="ch05lvl3sec34"/>UI animation in Android</h3></div></div></div><p>Animations <a class="indexterm" id="id451"/>in the Android UI can be divided into three phases:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Describing <a class="indexterm" id="id452"/>the animation in a file using a special syntax we will see shortly</li><li class="listitem" style="list-style-type: disc">Referencing that animation by creating an object of it in our Java code</li><li class="listitem" style="list-style-type: disc">Applying the animation to a UI element when the animation is required to run</li></ul></div><p>Let's take a look at some code that describes an animation. We will soon be reusing this same code in our memory game. The purpose of showing it is not so much that we understand each and every line of it. After all, learning Java should be enough of an accomplishment without mastering this too. Moreover, the purpose is to demonstrate that whatever animation you can describe can then be used in our games using the same Java.</p><p>We can quickly search the Web to find the code to perform the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Fading in and out</li><li class="listitem" style="list-style-type: disc">Sliding</li><li class="listitem" style="list-style-type: disc">Rotating</li><li class="listitem" style="list-style-type: disc">Expanding or shrinking</li><li class="listitem" style="list-style-type: disc">Morphing color</li></ul></div><p>Here is some code that causes a wobble effect. We will use it on a button, but you can also use it on any UI element or even the whole screen:</p><div><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;rotate 
    android:duration="100"
    android:fromDegrees="-5"
    android:pivotX="50%"
    android:pivotY="50%"
    android:repeatCount="8"
    android:repeatMode="reverse"
    android:toDegrees="5" /&gt;</pre></div><p>The first line simply states that this is a file written in XML format. The next states that we will be performing a rotation. Then we state that the duration will be 100 milliseconds, the rotation will be from -5 degrees, the pivot will be on the <em>x</em> and <em>y</em> axes by 50 percent, repeat eight times, and reverse to positive 5 degrees.</p><p>This is quite a <a class="indexterm" id="id453"/>mouthful, but the point is that it is easy to grab a template that works and then customize it to fit our situation. We could save the preceding code with a filename like <code class="literal">wobble.xml</code>.</p><p>Then we could simply reference it as follows:</p><div><pre class="programlisting">Animation wobble = AnimationUtils.loadAnimation(this, R.anim.wobble);</pre></div><p>Now we can <a class="indexterm" id="id454"/>play the animation like this on our chosen UI object, in this case our <code class="literal">button1</code> object:</p><div><pre class="programlisting">button1.startAnimation(wobble);</pre></div></div><div><div><div><div><h3 class="title"><a id="ch05lvl3sec35"/>Phase 5 – animating the UI</h3></div></div></div><p>Let's add <a class="indexterm" id="id455"/>an animation that causes a button to wobble when a button sound is played. At the same time, we can remove the code that makes the button invisible and the code that makes it reappear. That wasn't the best way to do it, but it served a purpose while developing the game:</p><div><ol class="orderedlist arabic"><li class="listitem">We need to add a new folder to our project, called <code class="literal">anim</code>. So right-click on the <code class="literal">res</code> folder in the Project Explorer window. Navigate to <strong>New</strong> | <strong>Android resource directory</strong> and click on <strong>OK</strong> to create the new <code class="literal">anim</code> folder.</li><li class="listitem">Now right-click on the <code class="literal">anim</code> folder and navigate to <strong>New</strong> | <strong>Animation resource file</strong>. Enter <code class="literal">wobble</code> in the <strong>File name</strong> field and click on <strong>OK</strong>. We now have a new file called <strong>wobble.xml</strong> open in the editor window.</li><li class="listitem">Replace all but the first line of <code class="literal">wobble.xml</code> with this code:<div><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
<strong>&lt;rotate </strong>
<strong>    android:duration="100"</strong>
<strong>    android:fromDegrees="-5"</strong>
<strong>    android:pivotX="50%"</strong>
<strong>    android:pivotY="50%"</strong>
<strong>    android:repeatCount="8"</strong>
<strong>    android:repeatMode="reverse"</strong>
<strong>    android:toDegrees="5" /&gt;</strong>
</pre></div></li><li class="listitem">Now switch to <code class="literal">GameActivity.java</code>.</li><li class="listitem">Add the following code just after the declaration of our <code class="literal">GameActivity</code> class:<div><pre class="programlisting">//phase 5 - our animation object
Animation wobble;</pre></div></li><li class="listitem">Just after the call to <code class="literal">setContentView</code> in our <code class="literal">onCreate</code> method, add this piece of code:<div><pre class="programlisting">//phase5 - animation
wobble = AnimationUtils.loadAnimation(this, R.anim.wobble);</pre></div></li><li class="listitem">Now, near the start of our thread code, find the calls to make our buttons reappear. Comment them out like this:<div><pre class="programlisting">//code not needed as using animations
//make sure all the buttons are made visible
//button1.setVisibility(View.VISIBLE);
//button2.setVisibility(View.VISIBLE);
//button3.setVisibility(View.VISIBLE);
//button4.setVisibility(View.VISIBLE);</pre></div></li><li class="listitem">Next, directly after our code in the previous step, within each of the four <code class="literal">case</code> <a class="indexterm" id="id456"/>statements, we need to comment out the lines that call <code class="literal">setVisibility</code> and replace them with our wobble animation. The following code is slightly abbreviated but shows exactly where to comment and where to add the new lines:<div><pre class="programlisting">switch (sequenceToCopy[elementToPlay]){
  case 1:
    //hide a button - not any more
    <strong>//button1.setVisibility(View.INVISIBLE);</strong>
<strong>    button1.startAnimation(wobble);</strong>
   ...
   ...
  case 2:
    //hide a button - not any more
    <strong>//button2.setVisibility(View.INVISIBLE);</strong>
<strong>    button2.startAnimation(wobble);</strong>
   ...
   ...
  case 3:
    //hide a button - not any more
    <strong>//button3.setVisibility(View.INVISIBLE);</strong>
<strong>    button3.startAnimation(wobble);</strong>
   ...
   ...
  case 4:
    //hide a button - not any more
    <strong>//button4.setVisibility(View.INVISIBLE);</strong>
<strong>    button4.startAnimation(wobble);</strong>
</pre></div></li><li class="listitem">Finally, in our <code class="literal">sequenceFinished</code> method, we can comment out all the <code class="literal">setVisibility</code> calls, just as we did in our thread, like this:<div><pre class="programlisting">//button1.setVisibility(View.VISIBLE);
//button2.setVisibility(View.VISIBLE);
//button3.setVisibility(View.VISIBLE);
//button4.setVisibility(View.VISIBLE);</pre></div></li></ol></div><p>That was not too tough. We added the wobble animation to the <code class="literal">anim</code> folder, declared an animation object, and initialized it. Then we used it whenever it was required on the appropriate button.</p><p>There are <a class="indexterm" id="id457"/>obviously loads of improvements we could make to this game, especially to its appearance. I'm sure you can think of more. And certainly, if this was to be your app, you were trying to make it big on the Play Store. That is exactly what you should do.</p><p>Constantly improve all aspects and strive to be the best in your genre. If you feel the urge, then why not improve upon it?</p><p>Here are a few self-test questions that look at ways we could do more with some of the examples from this chapter.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec40"/>Self-test questions</h1></div></div></div><p>Q1) Suppose that we want to have a quiz where the question could be to name the president as well as capital city. How can we do this with multidimensional arrays?</p><p>Q2) In our <em>Persistence example</em> section, we saved a continually updating string to a file so that it persisted after the app had been shut down and restarted. This is like asking the user to click on a Save button. Summoning all your knowledge of <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>, can you think of a way to save the string without saving it in the button click but just when the user quits the app?</p><p>Q3) Other than increasing the difficulty level, how could we increase the challenge of our memory game for our players?</p><p>Q4) Using the plain Android UI with the dull grey buttons isn't very exciting. Take a look at the UI elements in the visual designer and try and work out how we could quickly improve the visual appearance of our UI.</p></div>
<div><div><div><div><h1 class="title"><a id="ch05lvl1sec41"/>Summary</h1></div></div></div><p>That was a bit of a hefty chapter, but we learned lots of new techniques such as storing and manipulating with arrays, creating and using sound effects, and saving important data such as a high score, in our game. We also took a very brief look at the powerful but simple-to-use <code class="literal">Animation</code> class.</p><p>In the next chapter, we will be taking a more theoretical approach, but we will have plenty of working samples too. We will finally be opening the black box of Java classes so that we can gain an understanding of what is going on when we declare and use objects of a class.</p></div>
<div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. OOP – Using Other People's Hard Work</h1></div></div></div><p>OOP stands for <strong>object-oriented programming</strong>. In this chapter, you don't need to even try and remember everything. Why do I say this? Surely, that's what learning is. The more important thing is to grasp the concepts and begin to understand the <em>why</em> of OOP rather than memorize rules, syntax, and jargon.</p><p>The more <a class="indexterm" id="id458"/>important thing is to actually start to use some of the concepts, even though you might have to keep referring back and your code might not properly adhere to every OOP principal that we discuss. Neither does the code in this book. The code in this chapter is here to help you explore and grasp the concepts of OOP.</p><p>If you try to memorize this chapter, you will have to make a lot of room in your brain, and you will probably forget something really important in its place such as going to work or thanking the author for telling you not to try and memorize this stuff.</p><p>A good goal will be to try and almost get it. Then we will start to recognize examples of OOP in action so that our understanding becomes more rounded. You can then often refer back to this chapter for a refresher.</p><p>So what is all this OOP stuff we will learn about? Actually, we have already learned loads about OOP. Until now, we have been using classes such as <code class="literal">Button</code>, <code class="literal">Random</code>, and <code class="literal">Activity</code>, overriding methods of classes (mainly <code class="literal">onCreate</code>) and using an <strong>interface</strong> as well; remember implementing <code class="literal">onClickListener</code> a few times in the first five chapters?</p><p>This chapter just helps to make sense of OOP and expands our understanding, and finally, we will make our own classes.</p><p>Then we will be in a good position in the next two chapters to make two cool retro arcade games using lots of other people's hard work. This chapter will be mainly theory, but with a few practical console examples using LogCat so that we can see OOP in action.</p><p>In this chapter, we will do the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Look at what OOP is.</li><li class="listitem" style="list-style-type: disc">Write our first class.</li><li class="listitem" style="list-style-type: disc">Look at what encapsulation is and how we achieve it as well as look more deeply at variables and the different types. We will also take a short break to throw out the garbage.</li><li class="listitem" style="list-style-type: disc">Learn about inheritance and how we can extend and even improve upon a class before we use it.</li><li class="listitem" style="list-style-type: disc">Take a look at polymorphism, which is a way of being more than one thing at a time and is really useful in programming.</li></ul></div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec42"/>What is OOP?</h1></div></div></div><p>OOP is a way of <a class="indexterm" id="id459"/>programming that involves breaking our requirements down into chunks that are more manageable than the whole.</p><p>Each chunk is self-contained yet potentially reusable by other programs while working together as a whole with the other chunks.</p><p>These chunks are what we have been referring to as objects. When we plan an object, we do so with a class. A class can be thought of as the blueprint of an object.</p><p>We implement an object of a class. This is called an <strong>instance</strong> of a class. Think about a house blueprint. You <a class="indexterm" id="id460"/>can't live in it, but you can build a house from it, which means you build an instance of it. However, OOP is more than this. It is also a methodology that defines best practices such as the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Encapsulation</strong>: This means keeping the internal workings of your code safe from <a class="indexterm" id="id461"/>interference from the programs that use it, and allowing <a class="indexterm" id="id462"/>only the variables and methods you choose to be accessed. This means your code can always be updated, extended, or improved without affecting the programs that use it, as long as the exposed parts are still accessed in the same way.</li><li class="listitem" style="list-style-type: disc"><strong>Inheritance</strong>: Just like it sounds, inheritance means we can harness all the features and <a class="indexterm" id="id463"/>benefits of other people's hard work, including <a class="indexterm" id="id464"/>encapsulation and polymorphism, while refining their code specifically for our situation. Actually, we have done this already every time we used the <code class="literal">extends</code> keyword.</li><li class="listitem" style="list-style-type: disc"><strong>Polymorphism</strong>: This allows us to write code that is less dependent on the types we are <a class="indexterm" id="id465"/>trying to manipulate, making our code clearer and <a class="indexterm" id="id466"/>more efficient. Some examples later in the chapter will make this clear.</li></ul></div><div><div><h3 class="title"><a id="tip43"/>Tip</h3><p>When we talk about using other people's hard work, we are not talking about a magical way to abuse copyright and get away with it. Some code is plain and simple, someone else's property. What we are taking about is the vast array of free-to-use code, particularly in the context of this book, in the Java and Android APIs. If you want some code that does a certain thing, it has probably been done before. We just have to find it, then use it or modify it.</p></div></div><p>Java was designed from the start with all of this in mind, so we are fairly significantly constrained to using OOP. However, this is a good thing because we learn how to use the best practices.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec63"/>Why do it like this?</h2></div></div></div><p>When written properly, all this OOP allows you to add new features without worrying as much about how they interact with existing features. When you do have to change a class, its self-contained nature means less, or perhaps zero, consequences for other parts of the program. This is the encapsulation part.</p><p>You can use other people's code without knowing or perhaps even caring how it works. Think about the Android lifecycle, buttons, threads, and so on. The <code class="literal">Button</code> class is quite complicated, with nearly 50 methods—do we really want to write all that just for a button?</p><p>OOP allows you to write apps for highly complex situations without breaking a sweat. You can create multiple similar yet different versions of a class without starting the class from scratch using inheritance, and you can still use the methods intended for the original type of object with your new object because of polymorphism.</p><p>Makes sense, really! Let's write some classes and then make some objects out of them.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec43"/>Our first class and first object</h1></div></div></div><p>So what exactly is a <a class="indexterm" id="id467"/>class? A class is a bunch of code that can contain methods, variables, loops, and all other types of Java syntax. A class is part of a package and most <a class="indexterm" id="id468"/>packages will normally have multiple classes. Usually, but not always, each new class will be defined in its own <code class="literal">.java</code> code file with the same name as the class.</p><p>Once we have written a class, we can use it to make as many objects from it as we need. Remember, the class is the blueprint, and we make objects based on the blueprint. The house isn't the blueprint just as the object isn't the class; it is an object made from the class.</p><p>Here is the code for a <a class="indexterm" id="id469"/>class. We call it a class implementation:</p><div><pre class="programlisting">public class Soldier {
  int health;
  String soldierType;

  void shootEnemy(){
    //bang bang
  }
  
}</pre></div><p>The preceding snippet of code is a class implementation for a class called <code class="literal">Soldier</code>. There are two variables, an <code class="literal">int</code> variable called <code class="literal">health</code> and a <code class="literal">string</code> variable called <code class="literal">soldierType</code>.</p><p>There is also a method called <code class="literal">shootEnemy</code>. The method has no parameters and a <code class="literal">void return</code> type, but class methods can be of any shape or size that we discussed in <a class="link" href="ch05.html" title="Chapter 5. Gaming and Java Essentials">Chapter 5</a>, <em>Gaming and Java Essentials</em>.</p><p>When we <a class="indexterm" id="id470"/>declare variables in a class, they are known as <strong>fields</strong>. When the class is instantiated into a real object, the fields become variables of the object itself, so we call them <strong>instance</strong> <a class="indexterm" id="id471"/>variables. Whichever fancy name they are referred to by, they are just variables of the class. However, the difference between fields and variables declared in methods (called the <strong>local </strong>variables) becomes more important as we progress. We <a class="indexterm" id="id472"/>will look at all types of variables again in the <em>Variables revisited</em> section.</p><p>Remember, this is just a class, not an object. It is a blueprint for a soldier, not an actual <code class="literal">soldier</code> object. This is how we make an object of the <code class="literal">Soldier</code> type from our <code class="literal">Soldier</code> class:</p><div><pre class="programlisting">Soldier mySoldier = new Soldier();</pre></div><p>In the first part of the code, <code class="literal">Soldier mySoldier</code> declares a new reference type variable of type <code class="literal">Soldier</code>, called <code class="literal">mySoldier</code>, and in the last part of the code, <code class="literal">new Soldier()</code> creates an actual <code class="literal">Soldier</code> object. Of course, the assignment operator, <code class="literal">=</code>, in the middle of the two parts assigns the result of the second part to that of the first. Just like regular variables, we could also have performed the preceding steps like this:</p><div><pre class="programlisting">Soldier mySoldier;
mySoldier = new Soldier();</pre></div><p>This is how we would assign and use the variables:</p><div><pre class="programlisting">mySoldier.health = 100;
mySoldier.soldierType = "sniper";
//Notice that we use the object name mySoldier.
//Not the class name Soldier.
//We didn't do this:
// Soldier.health = 100; ERROR!</pre></div><p>In the preceding code <a class="indexterm" id="id473"/>snippet, the dot operator, <code class="literal">.</code>, is used to access the variables of the class, and this is how we would call the method. Again, we use the object name and not the class name, followed by the dot operator:</p><div><pre class="programlisting">mySoldier.shootEnemy();</pre></div><div><div><h3 class="title"><a id="tip44"/>Tip</h3><p>As a rough guide, a class's methods are what it can <em>do</em> and its instance variables are what it <em>knows</em> about itself.</p></div></div><p>We can also go ahead by making another <code class="literal">Soldier</code> object and accessing its methods and variables:</p><div><pre class="programlisting">Soldier mySoldier2 = new Soldier();
mySoldier2.health = 150;
mySoldier2.soldierType = "special forces";
mySoldier2.shootEnemy();</pre></div><p>It is important to realize that <code class="literal">mySoldier2</code> is a totally separate object with totally separate instance variables.</p><p>Also notice that everything is done on the object itself. We must create objects of classes in order to make them useful.</p><div><div><h3 class="title"><a id="note27"/>Note</h3><p>As always, there are exceptions to this rule, but they are in the minority, and we will look at the exceptions later in the chapter. In fact, we have already seen an exception way back in <a class="link" href="ch03.html" title="Chapter 3. Speaking Java – Your First Game">Chapter 3</a>, <em>Speaking Java – Your First Game</em>. Think of <code class="literal">Toast</code>.</p></div></div><p>Let's explore basic classes a little more deeply.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec64"/>Basic classes</h2></div></div></div><p>What happens <a class="indexterm" id="id474"/>when we want an army of <code class="literal">Soldier</code> objects? We will instantiate multiple objects. We will also demonstrate the use of the dot operator on variables and methods, and show that different objects have different instance variables.</p><p>You can get the working project for this example in the code download. It is in the <code class="literal">chapter6</code> folder and is called simply <code class="literal">BasicClasses</code>. Or read on to create your own working example:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a project with a blank activity, just as we did in <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>. Clean up the code by deleting the unnecessary parts, but this isn't essential. Call the application <code class="literal">BasicClasses</code>.</li><li class="listitem">Now we create a new class called <code class="literal">Soldier</code>. Right-click on the <code class="literal">com.packtpub.basicclasses</code> folder in the Project Explorer window. Click on <strong>New</strong>, then on <strong>Java Class</strong>. In the <strong>Name</strong> field, type <code class="literal">Soldier</code> and click on <strong>OK</strong>. The new class is created for us, with a code template ready to put our implementation within, just like what is shown in the following screenshot:<div><img alt="Basic classes" src="img/8859OS_06_01.jpg"/></div></li><li class="listitem">Notice that Android Studio has put the class in the same package as the rest of our app. Now we can write its implementation. Write the following class implementation code within the opening and closing curly braces of the <code class="literal">Soldier</code> class:<div><pre class="programlisting">public class Soldier {
    int health;
    String soldierType;

    void shootEnemy(){
        //lets print which type of soldier is shooting
        Log.i(soldierType, " is shooting");
    }
}</pre></div></li><li class="listitem">Now that we <a class="indexterm" id="id475"/>have a class, a blueprint for our future objects of the <code class="literal">Soldier</code> type, we can start to build our army. In the editor window, click on the tab of <strong>MainActivity.java</strong>. We will write this code, as so often, within the <code class="literal">onCreate</code> method just after the call to <code class="literal">setContentView</code>:<div><pre class="programlisting">//first we make an object of type soldier
   Soldier rambo = new Soldier();
   rambo.soldierType = "Green Beret";
   rambo.health = 150;// It takes a lot to kill Rambo

   //Now we make another Soldier object
   Soldier vassily = new Soldier();
   vassily.soldierType = "Sniper";
   vassily.health = 50;//Snipers have less armor

   //And one more Soldier object
   Soldier wellington = new Soldier();
   wellington.soldierType = "Sailor";
   wellington.health = 100;//He's tough but no green beret</pre></div><div><div><h3 class="title"><a id="tip45"/>Tip</h3><p>This is a really good time to start taking advantage of the autocomplete feature in Android Studio. Notice that after you have declared and created a new object, all you have to do is begin typing the object's name and all the autocomplete options will present themselves.</p></div></div></li><li class="listitem">Now that we have our extremely varied and somewhat unlikely army, we can use it and also verify the identity of each object. Type the following code below the code in the previous step:<div><pre class="programlisting">Log.i("Rambo's health = ", "" + rambo.health);
Log.i("Vassily's health = ", "" + vassily.health);
Log.i("Wellington's health = ", "" + wellington.health);

rambo.shootEnemy();
vassily.shootEnemy();
wellington.shootEnemy();</pre></div></li><li class="listitem">Now we can <a class="indexterm" id="id476"/>run our app on an emulator. Remember, all the output will be in the <strong>LogCat</strong> console window.</li></ol></div><p>This is how the preceding pieces of code work. In step 2, Android Studio created a template for our new <code class="literal">Soldier</code> class. In step 3, we implemented our class in quite the same way that we have before—two variables, an <code class="literal">int</code> and a <code class="literal">string</code>, called <code class="literal">health</code> and <code class="literal">soldierType</code>, respectively.</p><p>We also have a method in our class called <code class="literal">shootEnemy</code>. Let's look at it again and examine what is going on:</p><div><pre class="programlisting">void shootEnemy(){
        //lets print which type of soldier is shooting
        Log.i(soldierType, " is shooting");
    }</pre></div><p>In the body of the method, we print the <code class="literal">soldierType</code> string to the console first, and then the arbitrary <code class="literal">" is shooting"</code> string. What's neat here is that the <code class="literal">soldierType</code> string will be different depending on which object we call the <code class="literal">shootEnemy</code> method on.</p><p>In step 4, we declared, created, and assigned three new objects of type <code class="literal">Soldier</code>. They where <code class="literal">rambo</code>, <code class="literal">vassily</code>, and <code class="literal">wellington</code>. In step 5, we initialized each with a different value for <code class="literal">health</code> as well as <code class="literal">soldierType</code>.</p><p>Here is the output:</p><div><pre class="programlisting">
<strong>Rambo's health =﹕ 150</strong>
<strong>Vassily's health =﹕ 50</strong>
<strong>Wellington's health =﹕ 100</strong>
<strong>Green Beret﹕ is shooting</strong>
<strong>Sniper﹕ is shooting</strong>
<strong>Sailor﹕ is shooting</strong>
</pre></div><p>Notice that each time we access the <code class="literal">health</code> variable of each <code class="literal">Soldier</code> object, it is printed to the value we assigned it, demonstrating that although the three objects are of the same type, they are completely separate individual objects.</p><p>Perhaps more interesting are the three calls to <code class="literal">shootEnemy</code>. One call by each of our <code class="literal">Soldier </code>objects' <code class="literal">shootEnemy</code> method is made, and we print the <code class="literal">soldierType</code> variable to the console. The method has the appropriate value for each individual object, further demonstrating that we <a class="indexterm" id="id477"/>have three distinct objects, albeit created from the same <code class="literal">Soldier</code> class.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec65"/>More things we can do with our first class</h2></div></div></div><p>We can treat a <a class="indexterm" id="id478"/>class much like other variables. Assuming we have already implemented our <code class="literal">Soldier</code> class, we can make an array of <code class="literal">Soldier</code> objects like this:</p><div><pre class="programlisting">//Declare an array called myArmy to hold 10 Soldier objects
Soldier [] myArmy = new Soldier[10];

//Then we can add the Soldier objects
//We use the familiar array notation on the left
//And the newly learnt new Soldier() syntax on the right
myArmy[0] = new Soldier();
myArmy[1] = new Soldier();
myArmy[2] = new Soldier();
myArmy[3] = new Soldier();
//Initialize more here
//..</pre></div><p>Then we can use an object from an array using the same style of array notation as we did for regular variables, like this:</p><div><pre class="programlisting">myArmy[0].health = 125;
myArmy[0].soldierType = "Pilot";
myArmy[0].shootEnemy();
// Pilot﹕ is shooting</pre></div><p>We can also use a class as an argument in a method call. Here is a hypothetical call to a <code class="literal">healSoldier</code> method:</p><div><pre class="programlisting">healSoldier(rambo);
//Perhaps healSoldier could add to the health instance variable</pre></div><div><div><h3 class="title"><a id="tip46"/>Tip</h3><p>Of course, the preceding example might raise questions like should the <code class="literal">healSoldier</code> method be a method of a class?</p><div><pre class="programlisting">someHospitalObjectPerhaps.healSoldier(rambo);</pre></div><p>It could be or not (as shown in the previous example). It would depend upon what is the best solution for the situation. We will look at more OOP, and then the best solution for lots of similar conundrums should present themselves more easily.</p></div></div><p>As you might have come to expect by now, we can use an object as the return value of a method. Here is what <a class="indexterm" id="id479"/>the hypothetical <code class="literal">healSoldier</code> method might look like:</p><div><pre class="programlisting">Soldier healSoldier(Soldier soldierToBeHealed){
  soldierToBeHealed.health++;

  return soldierToBeHealed;
}</pre></div><p>All of this information will likely raise a few questions. OOP is like that, so to try and consolidate all this class stuff with what we already know, let's take another look at variables and encapsulation.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec44"/>Encapsulation</h1></div></div></div><p>So far, what we <a class="indexterm" id="id480"/>have really seen is what amounts to a kind of code-organizing convention, although we did discuss the wider goals of all this OOP stuff. Now we will take things further and begin to see how we actually manage to achieve encapsulation with OOP.</p><div><div><h3 class="title"><a id="tip48"/>Tip</h3><p><strong>Definition of encapsulation</strong></p><p>As we have learned encapsulation means keeping the internal workings of your code safe from interference from the programs that use it, allowing only the variables and methods you choose to be accessed. This means your code can always be updated, extended, or improved without affecting the programs that use it, as long as the exposed parts are still made available in the same way. It also allows the code that uses your encapsulated code to be much simpler and easier to maintain because much of the complexity of the task is encapsulated in your code.</p></div></div><p>But didn't I say that we don't have to know what is going on inside? So you might question what we have seen so far. If we are constantly setting the instance variables like this <code class="literal">rambo.health = 100;</code>, isn't it possible that eventually things could start to go wrong, perhaps like the following line of code?</p><div><pre class="programlisting">rambo.soldierType = "ballerina";</pre></div><p>Encapsulation protects your class from being used in a way that it wasn't meant to be. By strictly controlling the way that your code is used, it can only ever do what you want it to do, with values you can control. It can't be forced into errors or crashes. Also, you are then free to make changes to the way your code works internally, without <a class="indexterm" id="id481"/>breaking any programs that are using an older version of the code or the rest of your program:</p><div><pre class="programlisting">weighlifter.legstrength = 100;
weighlifter.armstrength = -100;
weightlifter.liftHeavyWeight();
//one typo and weightlifter rips own arms off</pre></div><p>We can encapsulate our classes to avoid this, and here is how.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec66"/>Controlling the use of classes with access modifiers</h2></div></div></div><p>The designer <a class="indexterm" id="id482"/>of the class controls what <a class="indexterm" id="id483"/>can be seen and manipulated <a class="indexterm" id="id484"/>by any program that uses their class. We can add an <strong>access modifier</strong> before the <code class="literal">class</code> keyword, like this:</p><div><pre class="programlisting">
<strong>public</strong> class Soldier{
  //Implementation goes here
}</pre></div><p>There are two class access modifiers. Let's briefly look at each in turn:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">public</code>: This is straightforward. A class declared as <code class="literal">public</code> can be seen by all other classes.</li><li class="listitem" style="list-style-type: disc"><code class="literal">default</code>: A class has default access when no access modifier is specified. This will make it public but only to classes in the same package, and inaccessible to all others.</li></ul></div><p>Now we can make a start with this encapsulation thing. However, even at a glance, the access modifiers described are not very fine-grained. We seem to be limited to complete lockdown to anything outside the package or a complete free-for-all.</p><p>Actually, the benefits here are easily taken advantage of. The idea would be to design a package that fulfills a set of tasks. Then all the complex inner workings of the package, the stuff that shouldn't be messed with by anybody but our package, should have default access (only <a class="indexterm" id="id485"/>accessible to classes <a class="indexterm" id="id486"/>within the package). We can then provide a <a class="indexterm" id="id487"/>careful selection of public classes that can be used by others (or other distinct parts of our program).</p><div><div><h3 class="title"><a id="tip49"/>Tip</h3><p>For the size and complexity of the games in this book, multiple packages are almost certainly overkill.</p></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec36"/>Class access in a nutshell</h3></div></div></div><p>A well-designed <a class="indexterm" id="id488"/>app will probably consist of one or more packages, each containing only default or default and public classes.</p><p>In addition to class-level privacy controls, Java gives us very fine-grained controls, but to use these controls, we have to look at variables in more detail.</p></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec67"/>Controlling the use of variables with access modifiers</h2></div></div></div><p>To <a class="indexterm" id="id489"/>build on class visibility controls, we have variable access modifiers. Here is a variable with the private access <a class="indexterm" id="id490"/>modifier being declared:</p><div><pre class="programlisting">private int myInt;</pre></div><p>Note also <a class="indexterm" id="id491"/>that all of our discussion of variable access modifiers applies to object variables too. For example, here is an instance of our <code class="literal">Soldier</code> class being declared, created, and assigned. As you can see, the access specified in this case is public:</p><div><pre class="programlisting">public Soldier mySoldier = new Soldier(); </pre></div><p>Before you apply a modifier to a variable, you must first consider the class visibility. If class <code class="literal">a</code> is not visible to class <code class="literal">b</code>, say because class <code class="literal">a</code> has default access and class <code class="literal">b</code> is in another package, then it doesn't make any difference what access modifiers you use on the variables in class <code class="literal">a</code>; class <code class="literal">b</code> still can't see it.</p><p>Thus, it makes sense to show a class to another class when necessary, but you should only expose the variables that are needed—not everything.</p><p>We have a bit more to cover on access modifiers, and then we will look at a few examples to help clarify things. For now, here is an explanation of the different variable access modifiers. They are more numerous and fine-grained than the class access modifiers. Most of the explanations are straightforward, and the ones that might raise questions will become clearer when we look at an example.</p><p>The depth and complexity of access modification is not so much in the range of modifiers, but by using them in smart ways, we can combine them to achieve the worthy goals of <a class="indexterm" id="id492"/>encapsulation. Here <a class="indexterm" id="id493"/>are the variable access modifiers:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">public</code>: You <a class="indexterm" id="id494"/>guessed it! Any class or method from any package can see this variable. Use <code class="literal">public</code> only when you are sure that this is what you want.</li><li class="listitem" style="list-style-type: disc"><code class="literal">protected</code>: This is the next least restrictive modifier after <code class="literal">public</code>. <code class="literal">protected</code> Variables set as protected can be seen by any class and any method as long as they are in the same package.</li><li class="listitem" style="list-style-type: disc"><code class="literal">default</code>: This doesn't sound as restrictive as <code class="literal">protected</code>, but it is more so. A variable has default access when no access is specified. The fact that <code class="literal">default</code> is restrictive perhaps implies that we should be thinking on the side of hiding our variables rather than exposing them. At this point, we need to introduce a new concept. Do you remember that we briefly discussed inheritance, and how we can quickly take on the attributes of a class and yet refine it using the <code class="literal">extends</code> keyword? Just for the record, default access variables are not visible to subclasses. This means that when we extend a class like we did with <code class="literal">Activity</code>, we cannot see its default variables. We will look at inheritance in more detail later in the chapter.</li><li class="listitem" style="list-style-type: disc"><code class="literal">private</code>: These variables can only be seen within the class they are declared. Like default access, they cannot be seen by subclasses (inherited classes).</li></ul></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec37"/>Variable access in a nutshell</h3></div></div></div><p>A well-designed <a class="indexterm" id="id495"/>app will probably consist of <a class="indexterm" id="id496"/>one or more packages, each containing only default or default and public classes. Within these classes, variables will have carefully chosen and most likely varied access modifiers.</p><p>There's one more <a class="indexterm" id="id497"/>twist in all this access modification stuff before we get practical with it.</p></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec68"/>Methods have access modifiers too</h2></div></div></div><p>It makes <a class="indexterm" id="id498"/>sense that methods are the things that our classes can do. We will want to control what users of our class can and can't do. The general idea here is that some methods will do things internally only and are therefore not needed by users of the class, and some methods will be fundamental to how users use your class.</p><p>The access modifiers <a class="indexterm" id="id499"/>for methods are the same as those for the class variables. This makes things easy to remember but suggests again that successful encapsulation is a matter of design rather than any specific set of rules.</p><p>As an example, the method in the following code snippet, provided in a public class, can be used by any other class:</p><div><pre class="programlisting">public useMeEverybody(){
  //do something everyone needs to do here
}</pre></div><p>However, the following method can only be used internally by the class that created it:</p><div><pre class="programlisting">private secretInternalTask(){
  //do something that helps the class function internally
  //Perhaps, if it is part of the same class,
  //useMeEverybody could use this method...
  //On behalf of the classes outside of this class.
  //Neat!
}</pre></div><p>The next method has default visibility with no access specified. It can be used only by other classes in the same package. If we extend the class containing this default access method, the class will not have access to this method:</p><div><pre class="programlisting">fairlySecretTask(){
  //allow just the classes in the package
  //Not for external use
}</pre></div><p>Here is a last example <a class="indexterm" id="id500"/>before we move on. It contains a <code class="literal">protected</code> method, only visible to the package, but <a class="indexterm" id="id501"/>usable by our classes that extend it:</p><div><pre class="programlisting">protected familyTask(){
  //allow just the classes in the package
  //And you can use me if you extend me too
}</pre></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec38"/>Method access in a nutshell</h3></div></div></div><p>Method <a class="indexterm" id="id502"/>access should be chosen to best enforce the <a class="indexterm" id="id503"/>principles we have already discussed. It should provide the <a class="indexterm" id="id504"/>users of your class with just the access they need, and preferably nothing more. Thereby, we achieve our encapsulation goals such as keeping the internal workings of your code safe from interference from the programs that use it, for all the reasons we have discussed.</p></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec69"/>Accessing private variables with the getter and setter methods</h2></div></div></div><p>So if it <a class="indexterm" id="id505"/>is best practice <a class="indexterm" id="id506"/>to hide our variables <a class="indexterm" id="id507"/>away as private, how do <a class="indexterm" id="id508"/>we allow access to them without spoiling our encapsulation? What if an object of the <code class="literal">Hospital</code> class wanted access to the <code class="literal">health</code> member variable from an object of type <code class="literal">Soldier</code> so that it could increase it? The <code class="literal">health</code> variable should be private, right?</p><p>In order to be able to make as many member variables as possible private and yet allow some kind of limited access to some of them, we use <strong>getters</strong> and <strong>setters</strong>. Getters and setters are methods that just get and set variable values.</p><p>This is not some special or new Java thing we have to learn. It is just a convention for the use of what we already know. Let's take a look at getters and setters using the example of our <code class="literal">Soldier</code> and <code class="literal">Hospital</code> classes.</p><p>In this example, each of our two classes are created in their own file but the same package. First of all, here is our hypothetical <code class="literal">Hospital</code> class:</p><div><pre class="programlisting">class Hospital{
  private void healSoldier(Soldier soldierToHeal){
    int health = soldierToHeal.getHealth();
    health = health + 10;
    soldierToHeal.setHealth(health);
  }
}</pre></div><p>Our implementation of the <code class="literal">Hospital</code> class has just one method, <code class="literal">healSoldier</code>. It receives a reference to a <code class="literal">Soldier</code> object as a parameter, so this method will work on whichever <code class="literal">Soldier</code> object is passed in: <code class="literal">vassily</code>, <code class="literal">wellington</code>, <code class="literal">rambo</code>, or whoever.</p><p>It also has a <code class="literal">health</code> variable. It uses this variable to temporarily hold and increase the soldier's health. In the same line, it initializes the <code class="literal">health</code> variable to the <code class="literal">Soldier</code> object's current health. The <code class="literal">Soldier</code> object's <code class="literal">health</code> is private, so the public getter method is used instead.</p><p>Then <code class="literal">health</code> is increased by 10 and the <code class="literal">setHealth</code> setter method loads the new <code class="literal">health</code> value back to the <code class="literal">Soldier</code> object.</p><p>The key <a class="indexterm" id="id509"/>here is that although a <code class="literal">Hospital</code> object can change a <code class="literal">Soldier</code> object's health, it does so within the bounds of the getter and setter methods. The getter and setter methods can be written to control and check for potentially erroneous or harmful values.</p><p>Next comes <a class="indexterm" id="id510"/>our hypothetical <a class="indexterm" id="id511"/>
<code class="literal">Soldier</code> class, with the simplest implementation possible of it's getter and setter methods:</p><div><pre class="programlisting">public class Soldier{
  private int health;
  public int getHealth(){
    return health;
  }

  public void setHealth(int newHealth){
    health = newHealth;
  }
}</pre></div><p>We have one <a class="indexterm" id="id512"/>instance variable called <code class="literal">health</code> and it is private. Private means it can only be changed by methods of the <code class="literal">Soldier</code> class. We then have a public <code class="literal">getHealth</code> method, which unsurprisingly returns the value held in the private <code class="literal">health</code> variable of the <code class="literal">int</code> type. As this method is public, anyone with access to the <code class="literal">Soldier</code> class can use it.</p><p>Next, the <code class="literal">setHealth</code> method is implemented. Again it is public, but this time, it takes <code class="literal">int</code> as a parameter and assigns whatever value is passed to the private <code class="literal">health</code> variable. In a more life-like example, we would write some more code here to ensure that the value passed is within the bounds we expect.</p><p>Now we will declare, create, and assign to make an object of each of our two new classes and see how our getters and setters work:</p><div><pre class="programlisting">Soldier mySoldier = new Soldier();
//mySoldier.health = 100;//Doesn't work private
//we can use the public setter setHealth()
mySoldier.setHealth(100);//That's better

Hospital militaryHospital = new Hospital();

//Oh no mySoldier has been wounded
mySoldier.setHealth(10);

//Take him to the hospital
//But my health variable is private
//And Hospital won't be able to access it
//I'm doomed - tell Laura I love her

//No wait- what about my public getters and setters?
//We can use the public getters and setters from another class

militaryHospital.healSoldier(mySoldier);

//mySoldiers private variable health has been increased by 10
//I'm feeling much better thanks!</pre></div><p>We see that we <a class="indexterm" id="id513"/>can call our public <code class="literal">setHealth</code> and <code class="literal">getHealth</code> methods directly on our object of type <code class="literal">Soldier</code>. Not only <a class="indexterm" id="id514"/>that, we can also call the <code class="literal">healSoldier</code> method of the <code class="literal">Hospital</code> object, passing in a reference to the <code class="literal">Soldier</code> object, which can use the public getters and setters to manipulate the private <code class="literal">health</code> variable.</p><p>We see that the private <code class="literal">health</code> variable is simply accessible, yet totally within the control of the designer of the <code class="literal">Soldier</code> class.</p><p>If you want to <a class="indexterm" id="id515"/>play around with this example, there is a working app in the code bundle in the <code class="literal">Chapter6</code> folder, called <code class="literal">Getters And Setters</code>. I have added a few lines of code to print <a class="indexterm" id="id516"/>to the console. We deliberately covered this the way we did to keep the key parts of the code as clear as possible. We will soon build some real working examples that explore class, variable, and method access.</p><div><div><h3 class="title"><a id="note28"/>Note</h3><p>Getters and setters are sometimes referred to by their more correct names, <strong>Accessors</strong> and <strong>Mutators</strong>. We will stick to getters and setters. Just thought you might like to know.</p></div></div><p>Yet again, our example and the explanation are probably raising more questions. That's good! Previously, I said that:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">There are two access modifiers for a class, default and public</li><li class="listitem" style="list-style-type: disc">Objects of classes are a type of reference variable</li><li class="listitem" style="list-style-type: disc">Variables (including objects) have even more access possibilities</li></ul></div><p>We need to <a class="indexterm" id="id517"/>look more closely at reference <a class="indexterm" id="id518"/>and primitive variables as well as local and instance variables. We will do so in a moment in the <em>Variables revisited</em> section. In that section, we will consolidate our information further to get a tighter grip on this OOP stuff. First let's remind ourselves of a bit about encapsulation.</p><p>Using encapsulation features (such as access control) is like signing a really important deal about how to use and access a class, its methods, and its variables. The contract is not just an <a class="indexterm" id="id519"/>agreement about the present but an implied guarantee for the future. We will see that as we <a class="indexterm" id="id520"/>proceed through this chapter, there are more ways that we refine and strengthen this contract.</p><div><div><h3 class="title"><a id="note29"/>Note</h3><p>It is perfectly possible to rewrite every example in this book without thinking or caring about encapsulation. In fact, the projects in this book outside of this chapter are quite lax about encapsulation.</p><p>Use encapsulation where it is needed or, of course, if you are being paid to use it by an employer. Often encapsulation is overkill on small learning projects, such as the games in this book, except when the topic you are learning is encapsulation itself.</p><p>We are learning this Java OOP stuff under the assumption that you will one day want to write much more complex apps, whether on Android or some other platform that uses OOP.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec70"/>Setting up our objects with constructors</h2></div></div></div><p>With <a class="indexterm" id="id521"/>all of these private variables and <a class="indexterm" id="id522"/>their getters and setters, does it mean that we need a getter and a setter for every private variable? What about a class with lots of variables that need initializing at the start? Think about this:</p><div><pre class="programlisting">mySoldier.name
mysoldier.type
mySoldier.weapon
mySoldier.regiment
...</pre></div><p>We could go on like this. Some of these variables might need getters and setters, but what if we just want to set things up when the object is first created to make the object function correctly? Do we need two methods (a getter and a setter) for each?</p><p>For this, we have a special method called a constructor. Here, we create an object of type <code class="literal">Soldier</code> and assign it to an object called <code class="literal">mySoldier</code>:</p><div><pre class="programlisting">Soldier mySoldier = new Soldier();</pre></div><p>There's nothing new here, but look at the last part of that line of code:</p><div><pre class="programlisting">...Soldier();</pre></div><p>This looks suspiciously like a method.</p><p>We have <a class="indexterm" id="id523"/>called a special method called a constructor that has been supplied automatically for us by the compiler.</p><p>However (and this is getting to the point now), like a method, we can override it, which means we can do really useful things to set up our new object <em>before</em> it is used and any of its methods are placed on the stack:</p><div><pre class="programlisting">public Soldier(){
  health = 200;
  //more setup here
}</pre></div><p>This is a constructor. It has a lot of syntactical similarities to a method. It can only be run with the use of the <code class="literal">new</code> keyword. It is created for us automatically by the compiler unless we create our own like in the previous code.</p><p>Constructors have the following properties:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">They have no return type</li><li class="listitem" style="list-style-type: disc">They <a class="indexterm" id="id524"/>have the same name as the class</li><li class="listitem" style="list-style-type: disc">They can have parameters</li><li class="listitem" style="list-style-type: disc">They can be overloaded</li></ul></div><p>We will play with constructors in the next demo.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec71"/>Variables revisited</h2></div></div></div><p>You probably <a class="indexterm" id="id525"/>remember, back in the math game project, that we kept changing where we declared our variables. First, we declared some in <code class="literal">onCreate</code>, then we moved them to just below the class declaration, and then we were making them member or instance variables.</p><p>Because we didn't specify the access, they were of default access and visible to the whole class, and as everything took place in the one class, we could access them everywhere. For example, we <a class="indexterm" id="id526"/>could update our TextView type objects from <code class="literal">onClick</code>, but why couldn't we do that when they were declared in <code class="literal">onCreate</code>? Further explanation about when and how we can access different variables is probably going to be useful.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec39"/>The stack and the heap</h3></div></div></div><p>The VM inside every Android device takes care of memory allocation to our games. In addition, it stores different types of variables in different places.</p><p>Variables that we <a class="indexterm" id="id527"/>declare and initialize in methods are stored on the area of memory known as the <code class="literal">stack</code>. We can stick to our warehouse analogy when talking about the stack—almost. We already know how we can manipulate the stack.</p><p>Let's talk <a class="indexterm" id="id528"/>about the heap and what is stored there. All reference type objects, which <a class="indexterm" id="id529"/>include objects (of classes) and arrays, are stored in the heap. Think of the heap as a separate area of the same warehouse. The heap has lots of floor space for odd-shaped objects, racks for smaller objects, lots of long rows with smaller sized cube-shaped holes for arrays, and so on. This is where our objects are stored. The problem is that we have no direct access to the heap.</p><p>Let's look again at what exactly a reference variable is. It is a variable that we refer to and use via a reference. A reference can be loosely (but usefully) defined as an address or location. The reference (address or location) of the object is on the stack. When we use the dot operator, we are asking Dalvik to perform a task at a specific location as stored in the reference.</p><div><div><h3 class="title"><a id="note30"/>Note</h3><p>Reference variables are just that—a reference. They are a way to access and manipulate the object (variables or methods), but they are not the actual variable. An analogy might be that primitives are right there (on the stack) but references are an address, and we say what to do at the address. In this analogy, all addresses are on the heap.</p></div></div><p>Why would we ever <a class="indexterm" id="id530"/>want a system like this? Just give me my objects on the stack <a class="indexterm" id="id531"/>already!</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec40"/>A quick break to throw out the trash</h3></div></div></div><p>Remember <a class="indexterm" id="id532"/>way back in the first chapter when I said Java was easier to learn than some languages because it helps us manage the memory? Well, this whole stack and heap thing does that for us.</p><p>As we know, the VM keeps track of all our objects for us and stores them in the heap—a special area of our warehouse. Periodically, the VM will scan the stack, or the regular racks of our warehouse, and match references to objects. If it finds any objects without a matching reference, it destroys them. In Java terminology, it performs garbage collection. Think of a very discriminating refuse vehicle driving through the middle of our heap, scanning objects to match to references. No reference? You're garbage now! After all, if an object has no reference variable, we can't possibly do anything with it anyway. This system of garbage collection helps our games run more efficiently by freeing unused memory.</p><p>So variables declared in a method are local, on the stack, and only visible within the method they were declared. A member variable is on the heap and can be referenced from any place where there is a reference to it, provided the access specification allows the referencing.</p><p>Now we can take a closer look at the variable scope—what can be seen from where.</p><p>There are more twists and turns to be learned with regard to variables. In the next demo, we will explore all we have learned so far in this chapter and some new ideas too.</p><p>We will look at the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Static variables that are consistent (the same) across every instance of a class</li><li class="listitem" style="list-style-type: disc">Static methods <a class="indexterm" id="id533"/>of a class where you can use the methods of a class without an object of that class type</li><li class="listitem" style="list-style-type: disc">We will demonstrate the scope of class and local variables, and where they can and can't be seen by different parts of the program</li><li class="listitem" style="list-style-type: disc">We will look at the <code class="literal">this</code> keyword, which allows us to write code that refers to variables that belong to a specific instance of a class, but without keeping track of which instance we are currently using</li></ul></div><p>The following is the demo.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec41"/>Access, scope, this, static, and constructors demo</h3></div></div></div><p>We have <a class="indexterm" id="id534"/>looked at the intricate way by which access to variables and their scope is controlled, and it would probably serve us well to look at an example of them in action. These will not be very practical real-world examples of variable use, but more of a demonstration to help understand access modifiers for <a class="indexterm" id="id535"/>classes, methods, and variables, alongside the different types of variables such as reference (or primitive) and local (or instance). Then we will cover the new concepts of static and final variables and the <code class="literal">this</code> keyword. The completed project is in the <code class="literal">Chapter6</code> folder of the code download. It is called <code class="literal">AccessScopeThisAndStatic</code>. We will now perform the following steps to implement it:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new blank activity project and call it <code class="literal">AccessScopeThisAndStatic</code>.</li><li class="listitem">Create a new class by right-clicking on the existing <code class="literal">MainActivity</code> class in the Project Explorer and navigating to <strong>New</strong> | <strong>Class</strong>. Name the new class <code class="literal">AlienShip</code>.</li><li class="listitem">Now we declare our new class and some member variables. Note that <code class="literal">numShips</code> is private and static. We will soon see how this variable is the same across all instances of the class. The <code class="literal">shieldStrength</code> variable is <code class="literal">private</code> and <code class="literal">shipName</code> is <code class="literal">public</code>:<div><pre class="programlisting">public class AlienShip {
private static int numShips;
private int shieldStrength;
public String shipName;</pre></div></li><li class="listitem">Next is the <a class="indexterm" id="id536"/>constructor. We can see that the constructor is public, has no return type, and has the same name as the class, as per the rules. In it, we increment the private static <code class="literal">numShips</code> variable. Remember that this will happen each time we create a new object of the <code class="literal">AlienShip</code> type. The constructor also sets a value for the <code class="literal">shieldStrength</code> private variable using the private <code class="literal">setShieldStrength</code> method:<div><pre class="programlisting">public AlienShip(){
  numShips++;

  //Can call private methods from here because I am part
  //of the class
  //If didn't have "this" then this call might be less clear
  //But this "this" isn't strictly necessary
  this.setShieldStrength(100);
  //Because of "this" I am sure I am setting 
  //the correct shieldStrength
}</pre></div></li><li class="listitem">Here is the public static getter method that classes outside <code class="literal">AlienShip</code> can use to find out how many <code class="literal">AlienShip</code> objects are there. We will also see the unusual way in which we use static methods:<div><pre class="programlisting">    public static int getNumShips(){
        return numShips;

    }</pre></div></li><li class="listitem">The following <a class="indexterm" id="id537"/>code shows our private <code class="literal">setShieldStrength</code> method. We could have just set <code class="literal">shieldStrength</code> directly from within the class, but this code shows how we can distinguish between the <code class="literal">shieldStrength</code> local variable/parameter and the <code class="literal">shieldStrength</code> member variable using the <code class="literal">this</code> keyword:<div><pre class="programlisting">private void setShieldStrength(int shieldStrength){
    //"this" distinguishes between the 
    //member variable shieldStrength
    //And the local variable/parameter of the same name
    this.shieldStrength = shieldStrength;
    
}</pre></div></li><li class="listitem">This next <a class="indexterm" id="id538"/>method is the getter, so other classes can read but not alter the shield strength of each <code class="literal">AlienShip</code> object:<div><pre class="programlisting">public int getShieldStrength(){
    return this.shieldStrength;
}</pre></div></li><li class="listitem">Now we have a public method that can be called every time an <code class="literal">AlienShip</code> object is hit. It just prints to the console and then checks whether that particular object's <code class="literal">shieldStrength</code> is zero. If it is zero, it calls the <code class="literal">destroyShip</code> method, which we look at next:<div><pre class="programlisting">public void hitDetected(){

    shieldStrength -=25;
    Log.i("Incoming: ","Bam!!");
    if (shieldStrength == 0){
        destroyShip();
    }

}</pre></div></li><li class="listitem">Finally, we <a class="indexterm" id="id539"/>will look at the <code class="literal">destroyShip</code> method for our <code class="literal">AlienShip</code> class. We print a message that indicates which ship has been destroyed, based on its <code class="literal">shipName</code>, as well as increment the <code class="literal">numShips</code> static variable so that we can keep track of the number of objects of the <code class="literal">AlienShip</code> type we have:<div><pre class="programlisting">private void destroyShip(){
    numShips--;
    Log.i("Explosion: ", ""+this.shipName + " destroyed");
    }
}</pre></div></li><li class="listitem">Now we <a class="indexterm" id="id540"/>switch over to our <code class="literal">MainActivity</code> class and write some code that uses our new <code class="literal">AlienShip</code> class. All of the code goes in the <code class="literal">onCreate</code> method after the call to <code class="literal">setContentView</code>. First, we create two new <code class="literal">AlienShip</code> objects called <code class="literal">girlShip</code> and <code class="literal">boyShip</code>:<div><pre class="programlisting">//every time we do this the constructor runs
AlienShip girlShip = new AlienShip();
AlienShip boyShip = new AlienShip();</pre></div></li><li class="listitem">Look how we get the value in <code class="literal">numShips</code>. We use the <code class="literal">getNumShips</code> method as we might expect. However, look closely at the syntax. We are using the class name and not an object. We can also access static variables with methods that are not static. We did it this way to see a static method in action:<div><pre class="programlisting">//Look no objects but using the static method
Log.i("numShips: ", "" + AlienShip.getNumShips());</pre></div></li><li class="listitem">Now we assign names to our public <code class="literal">shipName</code> string variables:<div><pre class="programlisting">//This works because shipName is public
girlShip.shipName = "Corrine Yu";
boyShip.shipName = "Andre LaMothe";</pre></div></li><li class="listitem">If we attempt <a class="indexterm" id="id541"/>to assign a value directly to a private variable, it won't work. Therefore, we use the public <code class="literal">getShieldStrength</code> getter method to print the value of <code class="literal">shieldStrength</code>, which was assigned to the constructor:<div><pre class="programlisting">//This won't work because shieldStrength is private
//girlship.shieldStrength = 999;

//But we have a public getter
Log.i("girlShip shieldStrngth: ", "" + girlShip.getShieldStrength());

Log.i("boyShip shieldStrngth: ", "" + boyShip.getShieldStrength());

//And we can't do this because it's private
//boyship.setShieldStrength(1000000);</pre></div><p>Finally, we get to blow some stuff up by playing with the <code class="literal">hitDetected</code> method and occasionally checking the shield strength of our two objects:</p><div><pre class="programlisting">//let's shoot some ships
girlShip.hitDetected();
Log.i("girlShip shieldStrngth: ", "" + girlShip.getShieldStrength());
        
Log.i("boyShip shieldStrngth: ", "" + boyShip.getShieldStrength());
        
boyShip.hitDetected();
boyShip.hitDetected();
boyShip.hitDetected();
        
Log.i("girlShip shieldStrngth: ", "" + girlShip.getShieldStrength());
        
Log.i("boyShip shieldStrngth: ", "" + boyShip.getShieldStrength());
        
boyShip.hitDetected();//ahhh
        
Log.i("girlShip shieldStrngth: ", "" + girlShip.getShieldStrength());

Log.i("boyShip shieldStrngth: ", "" + boyShip.getShieldStrength());</pre></div></li><li class="listitem">When we <a class="indexterm" id="id542"/>think we have destroyed a ship, we again use our static <code class="literal">getNumShips</code> method to check whether our static variable <code class="literal">numShips</code> was changed by the <code class="literal">destroyShip</code> method:<div><pre class="programlisting">  
Log.i("numShips: ", "" + AlienShip.getNumShips());</pre></div></li><li class="listitem">Run the demo and look at the console output.</li></ol></div><p>Here is the output <a class="indexterm" id="id543"/>of the preceding blocks of code:</p><div><pre class="programlisting">
<strong>numShips:﹕ 2</strong>
<strong>girlShip shieldStrngth:﹕ 100</strong>
<strong>boyShip shieldStrngth:﹕ 100</strong>
<strong>Incomiming:﹕ Bam!!</strong>
<strong>girlShip shieldStrngth:﹕ 75</strong>
<strong>boyShip shieldStrngth:﹕ 100</strong>
<strong>Incomiming:﹕ Bam!!</strong>
<strong>Incomiming:﹕ Bam!!</strong>
<strong>Incomiming:﹕ Bam!!</strong>
<strong>girlShip shieldStrngth:﹕ 75</strong>
<strong>boyShip shieldStrngth:﹕ 25</strong>
<strong>Incomiming:﹕ Bam!!</strong>
<strong>Explosion:﹕ Andre LaMothe destroyed</strong>
<strong>girlShip shieldStrngth:﹕ 75</strong>
<strong>boyShip shieldStrngth:﹕ 0</strong>
<strong>numShips:﹕ 1</strong>
<strong>boyShip shieldStrngth:﹕ 0</strong>
<strong>numShips:﹕ 1</strong>
</pre></div><p>In the previous example, we saw that we can distinguish between local and member variables of the same name using the <code class="literal">this</code> keyword. We can also use the <code class="literal">this</code> keyword to write code that refers to the current object being acted upon.</p><p>We saw that a static variable, in this case <code class="literal">numShips</code>, is consistent across all instances. Moreover, by incrementing it in the constructor and decrementing it in our <code class="literal">destroyShip</code> method, we can <a class="indexterm" id="id544"/>keep track of the number of <code class="literal">AlienShip</code> objects we created.</p><p>We also saw that we <a class="indexterm" id="id545"/>can use static methods by writing the class name with the dot operator instead of an object.</p><p>Finally, we demonstrated how we could hide and expose certain methods and variables using an access specifier.</p><p>Let's take a look <a class="indexterm" id="id546"/>at a quick review of the stack and the heap before we move on to something new.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec42"/>A quick summary on stack and heap</h3></div></div></div><p>Let's look at <a class="indexterm" id="id547"/>what we learned about the stack and the heap:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You don't delete <a class="indexterm" id="id548"/>objects but the VM sends the garbage collector when it thinks it is appropriate. This is usually done when there is no active reference to the object.</li><li class="listitem" style="list-style-type: disc">Local variables and <a class="indexterm" id="id549"/>methods are on the stack, and local variables are local to the specific method within which they were declared.</li><li class="listitem" style="list-style-type: disc">Instance or class variables are on the heap (with their objects) but the reference to the object (address) is a local variable on the stack.</li><li class="listitem" style="list-style-type: disc">We control what goes inside the stack. We can use the objects on the heap but only by referencing them.</li><li class="listitem" style="list-style-type: disc">The heap is maintained by the garbage collector.</li><li class="listitem" style="list-style-type: disc">An object is garbage collected when there is no longer a valid reference to it. Therefore, when a reference variable, local or instance, is removed from the stack, then its related object becomes viable for garbage collection, and when the virtual machine decides the time is right (usually very promptly), it will free the RAM <a class="indexterm" id="id550"/>memory to avoid running out.</li><li class="listitem" style="list-style-type: disc">If we try to <a class="indexterm" id="id551"/>reference an object that doesn't exist, we will get a <strong>null pointer exception</strong> and <a class="indexterm" id="id552"/>the game will crash.</li></ul></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec45"/>Inheritance</h1></div></div></div><p>We have seen <a class="indexterm" id="id553"/>how we can use other people's hard work by instantiating/creating objects from the classes of an API such as that of Android, but this whole OOP thing goes even further than that.</p><p>What if there is a class that has loads of useful functionality in it but not quite what we want? We can inherit from the class and then further refine or add to how it works and what it does.</p><p>You might be surprised to hear that we have done this already. In fact, we have done this with every single game and demo we looked at. When we use the <code class="literal">extends</code> keyword, we are inheriting, for example, in this line of code:</p><div><pre class="programlisting">public class MainActivity extends Activity ...</pre></div><p>Here, we are inheriting the <code class="literal">Activity</code> class along with all its functionality, or more specifically, all of the functionality that the class designers want us to have access to. Here are some of the things we can do to classes we have extended.</p><p>We can override a method and still rely in part on the overridden method in the class we inherit from. For example, we overrode the <code class="literal">onCreate</code> method every time we extended the <code class="literal">Activity</code> class, but we also called the default implementation provided by the class designers when we did this:</p><div><pre class="programlisting">super.onCreate(... </pre></div><p>In the next chapter, we will also be overriding some more methods of the <code class="literal">Activity</code> class. Specifically, we'll override the methods that handle the lifecycle.</p><p>If we or the designer of a class wants to force us to inherit before we use their class, they can declare a class as <a class="indexterm" id="id554"/>
<strong>abstract</strong>. Then we cannot make an object from it. Therefore, we must extend it first and make an object from the subclass. We will do this in our inheritance example and discuss it further when we look at polymorphism.</p><p>We can also declare a method abstract, and that method must be overridden in any class that extends the class with the abstract method. We will do this as well in our inheritance example.</p><p>In our game projects, we will not be designing any classes that we will be extending. We have no need of that in the context of learning about building simple games. However, we will be extending classes designed by others in every future game.</p><p>We discuss inheritance <a class="indexterm" id="id555"/>mainly so that we understand what is going on around us and as the first step towards being able to eventually design useful classes that we or others can extend. With this in mind, let's make some simple classes and see how we can extend them, just to play around with the syntax as a first step, and also to be able to say we have done it. When we look at the last major topic of this chapter, polymorphism, we will also dig a little deeper into inheritance.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec72"/>An example of inheritance</h2></div></div></div><p>We have <a class="indexterm" id="id556"/>looked at the way we can create hierarchies of classes to model the system that fits our game or software project, so let's try out some simple code that uses inheritance. The completed project is in the <code class="literal">Chapter6</code> folder of the code download. It is called <code class="literal">InheritanceExample</code>. We will now perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create three new classes in the usual way. Call one <code class="literal">AlienShip</code>, another <code class="literal">Fighter</code>, and the last one <code class="literal">Bomber</code>.</li><li class="listitem">Here is the code for the <code class="literal">AlienShip</code> class. It is very similar to our previous <code class="literal">AlienShip</code> class demo. The differences are that the constructor now takes an <code class="literal">int</code> parameter, which it uses to set the shield strength. The constructor also outputs a message to the console so that we can see when it is being used. The <code class="literal">AlienShip</code> class also has a new method, <code class="literal">fireWeapon</code>, that is declared <code class="literal">abstract</code>. This guarantees that any class that subclasses <code class="literal">AlienShip</code> must implement their own version of <code class="literal">fireWeapon</code>. Notice that the class has the <code class="literal">abstract</code> keyword as part of its declaration. We have to do this because one of its methods also uses the keyword <code class="literal">abstract</code>. We will explain the <code class="literal">abstract</code> method when discussing this demo and the <code class="literal">abstract</code> class when we talk about polymorphism:<div><pre class="programlisting">public abstract class AlienShip {
    private static int numShips;
    private int shieldStrength;
    public String shipName;

    public AlienShip(int shieldStrength){
        Log.i("Location: ", "AlienShip constructor");
        numShips++;
        setShieldStrength(shieldStrength);
    }

    public abstract void fireWeapon();//Ahh my body

    public static int getNumShips(){
        return numShips;
    }

    private void setShieldStrength(int shieldStrength){
        this.shieldStrength = shieldStrength;
    }


    public int getShieldStrength(){
        return this.shieldStrength;
    }

    public void hitDetected(){
        shieldStrength -=25;
        Log.i("Incomiming: ", "Bam!!");
        if (shieldStrength == 0){
            destroyShip();
        }

    }

    private void destroyShip(){
        numShips--;
        Log.i("Explosion: ", "" + this.shipName + " destroyed");
    }

}</pre></div></li><li class="listitem">Now we will <a class="indexterm" id="id557"/>implement the <code class="literal">Bomber</code> class. Notice the call to <code class="literal">super(100)</code>. This calls the constructor of the superclass with the value for <code class="literal">shieldStrength</code>. We could do further specific <code class="literal">Bomber</code> initialization in this constructor, but for now, we just print the location so that we can see when the <code class="literal">Bomber</code> constructor is being executed. We also implement a <code class="literal">Bomber</code> class-specific version of the abstract <code class="literal">fireWeapon</code> method because we must do so:<div><pre class="programlisting">public class Bomber extends AlienShip {

    public Bomber(){
        super(100);
        //Weak shields for a bomber
        Log.i("Location: ", "Bomber constructor");
    }

    public void fireWeapon(){
        Log.i("Firing weapon: ", "bombs away");
    }
}</pre></div></li><li class="listitem">Now we will implement the <code class="literal">Fighter</code> class. Notice the call to <code class="literal">super(400)</code>. This calls the constructor of the superclass with the value of <code class="literal">shieldStrength</code>. We <a class="indexterm" id="id558"/>could do further <code class="literal">Fighter</code> class-specific initialization in this constructor, but for now, we just print the location so that we can see when the <code class="literal">Fighter</code> constructor is being executed. We also implement a <code class="literal">Fighter</code> specific version of the abstract <code class="literal">fireWeapon</code> method because we must do so:<div><pre class="programlisting">public class Fighter extends AlienShip{

    public Fighter(){
        super(400);
        //Strong shields for a fighter
        Log.i("Location: ", "Fighter constructor");
    }

    public void fireWeapon(){
        Log.i("Firing weapon: ", "lasers firing");
    }

}</pre></div></li><li class="listitem">Here is our code in the <code class="literal">onCreate</code> method of <code class="literal">MainActivity</code>. As usual, we enter this code after the call to <code class="literal">setContentView</code>. This is the code that uses our three new classes. It looks quite ordinary, but there's nothing new; it is the output that is interesting:<div><pre class="programlisting">Fighter aFighter = new Fighter();
Bomber aBomber = new Bomber();

//Can't do this AlienShip is abstract -
//Literally speaking as well as in code
//AlienShip alienShip = new AlienShip(500);

//But our objects of the subclasses can still do
//everything the AlienShip is meant to do
aBomber.shipName = "Newell Bomber";
aFighter.shipName = "Meier Fighter";

//And because of the overridden constructor
//That still calls the super constructor
//They have unique properties
Log.i("aFighter Shield:", ""+ aFighter.getShieldStrength());
Log.i("aBomber Shield:", ""+ aBomber.getShieldStrength());

    //As well as certain things in certain ways
    //That are unique to the subclass
    aBomber.fireWeapon();
    aFighter.fireWeapon();

    //Take down those alien ships
    //Focus on the bomber it has a weaker shield
    aBomber.hitDetected();
    aBomber.hitDetected();
    aBomber.hitDetected();
    aBomber.hitDetected();</pre></div></li></ol></div><p>Here is the <a class="indexterm" id="id559"/>output of the preceding snippets of code:</p><div><pre class="programlisting">
<strong>Location:﹕ AlienShip constructor</strong>
<strong>Location:﹕ Fighter constructor</strong>
<strong>Location:﹕ AlienShip constructor</strong>
<strong>Location:﹕ Bomber constructor</strong>
<strong>aFighter Shield:﹕ 400</strong>
<strong>aBomber Shield:﹕ 100</strong>
<strong>Firing weapon:﹕ bombs away</strong>
<strong>Firing weapon:﹕ lasers firing</strong>
<strong>Incomiming:﹕ Bam!!</strong>
<strong>Incomiming:﹕ Bam!!</strong>
<strong>Incomiming:﹕ Bam!!</strong>
<strong>Incomiming:﹕ Bam!!</strong>
<strong>Explosion:﹕ Newell Bomber destroyed</strong>
</pre></div><p>We can see how the constructor of the subclass can call the constructor of the superclass. We can also clearly see that the individual implementations of the <code class="literal">fireWeapon</code> method work exactly as expected.</p><p>As if OOP where not useful enough already! We can now model real-world objects and design them to interact with each other. We have also seen how we can make OOP even more useful by <a class="indexterm" id="id560"/>subclassing/extending/inheriting from other classes. The terminology we might like to learn here is that the class that is extended from is the <strong>superclass</strong> and the <a class="indexterm" id="id561"/>class that inherits from the superclass is the <strong>subclass</strong>. We can also call them parent and child classes.</p><div><div><h3 class="title"><a id="tip50"/>Tip</h3><p>As usual, we might find ourselves asking this question about inheritance: Why? We can write common code once, in the parent class, and we can update that common code. All the classes that inherit from it are also updated. Furthermore, a subclass only inherits public instance variables and methods. When designed properly, this further enhances the goals of encapsulation.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec46"/>Polymorphism</h1></div></div></div><p>Polymorphism <a class="indexterm" id="id562"/>roughly means different forms. But what does it mean to us?</p><p>In the simplest words possible, any subclass can be used as a part of the code that uses the superclass.</p><p>For example, if we have an array of animals, we could put any object that is of a type that is a subclass of <code class="literal">Animal</code> in the <code class="literal">Animal</code> array, perhaps cats and dogs.</p><p>This means that we can write code that is simpler and easier to understand and modify:</p><div><pre class="programlisting">//This code assumes we have an Animal class
//And we have a Cat and Dog class that extends Animal
Animal myAnimal = new Animal();
Dog myDog = new Dog();
Cat myCat = new Cat();
Animal [] myAnimals = new Animal[10];
myAnimals[0] = myAnimal;//As expected
myAnimals[1] = myDog;//This is OK too
myAnimals[2] = myCat;//And this is fine as well</pre></div><p>We can also write code for the superclass and rely on the fact that no matter how many times it is subclassed, within certain parameters, the code will still work. Let's continue our previous example:</p><div><pre class="programlisting">//6 months later we need elephants
//with its own unique aspects
//As long as it extends Animal we can still do this
Elephant myElephant = new Elephant();
myAnimals[3] = myElephant;//And this is fine as well</pre></div><p>You can also write methods with polymorphic return types and arguments:</p><div><pre class="programlisting">Animal feedAnimal(Animal animalToFeed){
  //Feed any animal here
  return animalToFeed;
}</pre></div><p>So you can even <a class="indexterm" id="id563"/>write code <em>today</em> and make another subclass in a week, month, or year, and the very same methods and data structures will still work.</p><p>Further, we can enforce on our subclasses a set of rules as to what they can and cannot do, and also how they should do it. Thus, good design in one stage can influence our subclasses at other stages.</p><p>If you do suddenly find yourself with a flappy-bird-sized phenomenon, and you have a lot of OOP in your code, right from the start, it will be much easier to bring in hired help to move the project forward and still maintain control of the project.</p><p>What if you have an idea for a game with lots of features but you want to get a simple version of the game out as soon as possible? Smart, object-oriented design would certainly be the solution. It could enable you to write the working bare bones of a game and then gradually extend it.</p><p>Moving on, let's look at <a class="indexterm" id="id564"/>another OOP concept: abstract classes. We can now get to the bottom of what was going on with that <code class="literal">AlienShip</code> code:</p><div><pre class="programlisting">public abstract class AlienShip{...</pre></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec73"/>Abstract classes</h2></div></div></div><p>An abstract <a class="indexterm" id="id565"/>class is a class that cannot be instantiated, or cannot be made into an object. We mentioned that <code class="literal">AlienShip</code> was abstract in the <a class="indexterm" id="id566"/>previous example. So is it a blueprint that will never be used then? But that's like paying an architect to design your home and then never building it! I kind of got the idea of an abstract method but this is just silly!</p><p>It might seem like this at first. We make a class abstract by declaring it with the <code class="literal">abstract</code> keyword, like this:</p><div><pre class="programlisting">abstract class someClass{
  //All methods and variables here as usual
  //Just don't try and make an object out of me!
}</pre></div><p>But why?</p><p>Sometimes, we want a class that can be used as a polymorphic type but we need to ensure that it can never be used as an object. For example, <code class="literal">Animal</code> doesn't really make sense on its own.</p><p>We don't talk about animals; we talk about types of animals. We don't say, "Ooh, look at that lovely, fluffy, white animal", or "Yesterday, we went to the pet shop and got an animal and an animal bed." It's just too abstract.</p><p>So an abstract class is like a template to be used by any class that extends it (inherits from it).</p><p>We might want a <code class="literal">Worker</code> class and extend to make classes such as <code class="literal">Miner</code>, <code class="literal">Steelworker</code>, <code class="literal">OfficeWorker</code>, and of course <code class="literal">Programmer</code>. But what exactly does a plain <code class="literal">Worker</code> class do? Why would we ever want to instantiate one?</p><p>The answer is that we wouldn't want to instantiate it, but we might want to use it as a polymorphic type so that we can pass multiple worker subclasses between methods and have data structures that can hold all types of workers.</p><p>We call this type of class an abstract class, and when a class has even one abstract method, like <code class="literal">AlienShip</code> did, it must be declared abstract itself. As we saw, all abstract methods must be overridden by any class that extends the abstract class. This means that the abstract class <a class="indexterm" id="id567"/>can provide some of the common functionality that would be available in all its subclasses. For example, the <code class="literal">Worker</code> class might have the <code class="literal">height</code>, <code class="literal">weight</code>, and <code class="literal">age</code> member variables.</p><p>It might have the <code class="literal">getPayCheck</code> method, which is the same in all the subclasses, and the <code class="literal">doWork</code> method, which is abstract and must be overridden because all the different types of worker do work very differently.</p><p>This leads us neatly <a class="indexterm" id="id568"/>on to another area of polymorphism that deserves an honorable mention because we have been using it in every game so far.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec74"/>Interfaces</h2></div></div></div><p>An interface is <a class="indexterm" id="id569"/>like a class. Phew! Nothing complicated here then. However, it's like a class that is always abstract and with only abstract methods.</p><p>We can think of an <a class="indexterm" id="id570"/>interface as an entirely abstract class with all its methods abstract too. Okay, so you can just about wrap your head round an abstract class because it can at least pass on some functionality in its methods that are not abstract and serve as a polymorphic type.</p><p>But seriously, this interface seems a bit pointless. Bear with me.</p><p>To define an interface, we type the following code:</p><div><pre class="programlisting">public interface myInterface{
  void someAbstractMethod();//omg I've got no body
  int anotherAbstractMethod();//Ahh! Me too

//Interface methods are always abstract and public implicitly 
//but we could make it explicit if we prefer

  public abstract explicitlyAbstractAndPublicMethod();//still no body though


}</pre></div><p>The methods of an interface have no body because they are abstract, but they can still have return types and parameters, or not.</p><p>To use an interface, we use the <code class="literal">implements</code> keyword after the class declaration. Yes, we already did this for <code class="literal">onClickListener</code> a few times:</p><div><pre class="programlisting">public class someClass implements someInterface{

//class stuff here

//better implement the methods of the interface or the red error lines will not go away
  public void someAbstractMethod(){
    //code here if you like but just an empty implementation will do
  }

  public int anotherAbstractMethod(){
    //code here if you like but just an empty implementation will do

    //Must have a return type though as that is part of the contract
    return 1;}
}</pre></div><p>This enables us to use <a class="indexterm" id="id571"/>polymorphism with multiple different objects that are from completely unrelated inheritance hierarchies. As long as it implements an interface, the whole thing can be passed along as if it is that thing, which it is. We can even have a class implement multiple different interfaces at the same time. Just add a comma between each interface and <a class="indexterm" id="id572"/>list them after the <code class="literal">implements</code> keyword. Just be sure to implement all the necessary methods.</p><p>Let's go back to the <code class="literal">onClickListener</code> interface. Any thing might like to know when it is being clicked on; a <a class="indexterm" id="id573"/>Button, a TextView, and so on. We don't want different <code class="literal">onClick</code> methods for every type.</p><div><div><h3 class="title"><a id="tip51"/>Tip</h3><p>When using Android, for games or for more regular GUI-based apps (a bit like ours so far), 9 times out of 10, you will be implementing interfaces rather than writing your own. However, knowing what is happening is quite important, not so much from a point of view of technical awareness, as we have just seen that the interface specifies a contract and the compiler enforces it, but more as a matter of sanity in knowing what is actually happening when you use the <code class="literal">implements</code> keyword and write a method (or methods) with a name that you didn't choose.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec47"/>More about OOP and classes</h1></div></div></div><p>It is possible to <a class="indexterm" id="id574"/>write a whole book on OOP, and many authors have already done so, but the best way to learn OOP is probably to practice it; practice it <em>before</em> we have learned all of the theory. Anyway, before we get on with some more practical examples, here is one more slightly theoretical OOP example that will leave us scratching our heads later if not mentioned.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec75"/>Inner classes</h2></div></div></div><p>When we looked <a class="indexterm" id="id575"/>at our basic classes demo app, we declared and implemented the class in a separate file to our <code class="literal">MainActivity</code> class. That file had the same name as the class.</p><p>We can also <a class="indexterm" id="id576"/>declare and implement a class within a class. The only question remaining, of course, is why would we do this? When we implement an inner class, the inner class can access the member variables of the enclosing class and the enclosing class can access the members of the inner class. We will see this in action in the next two chapters.</p><p>If you are not modeling deep or real-world systems, then inner classes are often the way to go. In fact, all the classes we will write ourselves in the rest of this book will be extended inner classes. This means that we will extend a type to make our own class within our <code class="literal">Activity</code> class. This makes our code nice and simple.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec48"/>Self-test questions</h1></div></div></div><p>Q1) Find out what is wrong with this class declaration:</p><div><pre class="programlisting">  private class someClass{
    //class implementation goes here
  }</pre></div><p>Q2) What is encapsulation?</p><p>Q3) I don't get it all, and actually, I have more questions now than I had at the start of the chapter. What should I do?</p></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec49"/>Summary</h1></div></div></div><p>In this chapter, we covered more theory than in any other chapter. If you haven't memorized everything, then you have succeeded completely. If you just understand that OOP is about writing reusable, extendable, and efficient code through encapsulation, inheritance, and polymorphism, then you have the potential to be a Java master. Simply put, OOP enables us to use other people's hard work even when those people were not aware of exactly what we would be doing at the time they did the work. All you have to do is keep practicing, so let's make a retro game in the next chapter.</p></div>
<div><div><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Retro Squash Game</h1></div></div></div><p>This chapter is <a class="indexterm" id="id577"/>where the fun starts. Although a retro squash game is obviously a step or two down from the latest big-budget game, it is the point when we start to look at some fundamentals—drawing, detecting when objects we have drawn bump into each other, and having animation that is actually controlled by us.</p><p>Once you can draw a pixel and move it, it only needs a bit of imagination and work and you have the potential to draw anything. Then, when we combine this knowledge with some really simple math to simulate the physics of collision and gravity, we will be close to being able to implement our squash game.</p><div><div><h3 class="title"><a id="tip52"/>Tip</h3><p>Sadly, this book does not have the time to go into the mathematics of turning a dot on the screen into realistic three-dimensional characters moving around in a three-dimensional world. Certainly, the technology and math behind big-budget titles is very advanced and complicated. However, the basics of turning pixels into lines and lines into triangles, texturing a triangle, building objects out of triangles, and positioning them in a three-dimensional world are within the grasp of anybody who has learned high-school-level math. Often, we hear that great graphics don't make a great game, which is true, but great graphics (at least for me) are one of the most exciting aspects of video games, even when they are displayed on a game that could be more fun to play by itself. If you want to see how to turn pixels into magical worlds, and start to appreciate what goes on behind the scenes of the top game engines and graphics libraries, you could start with <em>Computer Graphics: Mathematical First Steps</em>, <em>P.A. Egerton and W.S Hall</em>, <em>Prentice Hall</em>.</p></div></div><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Explore the Android <code class="literal">Canvas</code> class, which makes drawing easy and fun</li><li class="listitem" style="list-style-type: disc">Write a simple Canvas demo app</li><li class="listitem" style="list-style-type: disc">Learn about detecting touches on the screen</li><li class="listitem" style="list-style-type: disc">Create the retro squash game</li><li class="listitem" style="list-style-type: disc">Implement the retro squash game</li></ul></div><div><div><div><div><h1 class="title"><a id="ch07lvl1sec50"/>Drawing with Android Canvas</h1></div></div></div><p>So far, we have been using the Android UI designer to implement all our graphics. This is fine when all we need are objects such as buttons and text.</p><p>It is true that there is <a class="indexterm" id="id578"/>more to the Android UI elements than we have explored so far. For example, we know we can do a lot more with the <code class="literal">Animation</code> class, and we very briefly saw that we can assign any image we like to represent one of the UI elements.</p><p>As an example, we could assign game characters such as spaceships to UI elements and animate them.</p><p>However, if we want smoothly moving spaceships with accurate collision detection, cute characters, and gruesome baddies with multiframe, cartoon-like animation, then we are going to need to move away from predefined UI elements.</p><p>We are going to need to start looking at and designing with individual pixels, lines, bitmaps, and sprite sheets. Fortunately, as you might have guessed, Android has some classes to make this nice and easy for us. We will be learning how to get started with the <code class="literal">Canvas</code> and <code class="literal">Paint</code> classes.</p><p>Bitmaps and sprite sheets will be covered in the next chapter. In this chapter, we will learn how to draw pixels and lines to make a simple, smoothly moving pong-style game of squash.</p><p>To achieve this, we will learn about the coordinate system we use to draw our pixels and lines. Then we will look at the <code class="literal">Paint</code> and <code class="literal">Canvas</code> classes themselves.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec76"/>The Android coordinate system</h2></div></div></div><p>A pixel is the <a class="indexterm" id="id579"/>smallest graphical element we can manipulate using the <code class="literal">Paint</code> and <code class="literal">Canvas</code> classes. It is essentially a dot. If your device resolution is 1920 x 1080, like some of the newer Google-branded tablets or high-end Samsung phones, then we have 1920 pixels across the longest length of the device and 1080 pixels across the width.</p><p>We can therefore think of our screen on which we will be drawing as a grid. We draw using the <code class="literal">Canvas</code> and <code class="literal">Paint</code> classes on a virtual canvas. We will do so by plotting points (pixels), lines, shapes, and text using coordinates on this grid.</p><p>The coordinate system starts in the top-left corner of the screen.</p><p>As an example, take a look at this line of code:</p><div><pre class="programlisting">drawPoint(0, 0); //Not actual syntax (but very close)</pre></div><p>In this, we would plot a single pixel in the top-left corner of the screen. Now look at the following code:</p><div><pre class="programlisting">drawPoint(1920, 1080); //Not actual syntax (but very close)</pre></div><p>If we use it like this, we could draw a point in the bottom-right corner of one of these high-end devices (while in the landscape position).</p><p>We could also draw <a class="indexterm" id="id580"/>lines by specifying a start and end coordinate position, a bit like this:</p><div><pre class="programlisting">drawLine(0,0,1920, 1080); //Not actual syntax (but very close)</pre></div><p>This would draw a line from the top-left corner of the screen to the bottom right.</p><p>You might have noticed some potential problems. Firstly, not all Android devices have such a high resolution; in fact, most are significantly lower. Even devices with high resolution will have totally different coordinates when held in landscape or portrait positions. How will we write code that adapts to these devices regardless of the screen resolution? We will see the solution soon.</p><div><div><div><div><h3 class="title"><a id="ch07lvl3sec43"/>Animating our pixels</h3></div></div></div><p>Drawing shapes, lines, and pixels is all very well, but how do we make them appear to move? We <a class="indexterm" id="id581"/>will be using the same animation trick used in cartoons, movies, and other video games:</p><div><ol class="orderedlist arabic"><li class="listitem">Draw an object.</li><li class="listitem">Rub it out.</li><li class="listitem">Draw the object in its new position.</li><li class="listitem">Repeat fast enough to trick the player's brain that the game objects are moving.</li></ol></div><p>The theory makes all of this sound more complicated than it is. Let's take a quick look at the <code class="literal">Paint</code> and <code class="literal">Canvas</code> classes and a quick introductory demo app. Then we can implement our retro squash game for real.</p></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec77"/>Getting started with Canvas and Paint</h2></div></div></div><p>The aptly named <code class="literal">Canvas</code> class provides just what you would expect—a virtual canvas to draw our graphics on.</p><p>We can make a <a class="indexterm" id="id582"/>virtual canvas using the <code class="literal">Canvas</code> class from any Android UI element. In our demo app, we will draw on an ImageView, and when we make our game, we <a class="indexterm" id="id583"/>will draw straight on a special type of view, which will bring some extra advantages, as we will see.</p><p>To get started, we need a view to draw on. We already know how to get a view from our UI layout using Java code:</p><div><pre class="programlisting">ImageView ourView = (ImageView) findViewById(R.id.imageView);</pre></div><p>This line of code grabs a reference to an ImageView placed in the UI design and assigns it to our object in our Java code. As we have seen, the ImageView in the UI design has an assigned ID of <code class="literal">imageView</code>, and our controllable ImageView object in our Java code is called <code class="literal">ourView</code>.</p><p>Now we need a bitmap. A bitmap itself has a coordinate system like the screen. We are creating a bitmap to turn it into a canvas:</p><div><pre class="programlisting">Bitmap ourBitmap = Bitmap.createBitmap(300,600, Bitmap.Config.ARGB_8888);</pre></div><p>The previous line of code declares and creates an object of the <code class="literal">Bitmap</code> type. It will have a size of 300 by 600 pixels. We will keep this in mind when we draw on it shortly.</p><div><div><h3 class="title"><a id="tip53"/>Tip</h3><p>The last argument in the <code class="literal">createBitmap</code> method, <code class="literal">Bitmap.Config.ARGB_8888</code>, is simply a format, and we can create some great games without getting into the different options for bitmap formats.</p></div></div><p>Now we can prepare our bitmap for drawing by creating a <code class="literal">Canvas</code> object from it:</p><div><pre class="programlisting">Canvas ourCanvas = new Canvas(ourBitmap);</pre></div><p>Next, we get ourselves an object of the <code class="literal">Paint</code> type. We can think of this object as the brush and the paint for our virtual canvas:</p><div><pre class="programlisting">Paint paint = new Paint();</pre></div><p>At this point, we are ready to use our <code class="literal">Paint</code> and <code class="literal">Canvas</code> objects to do some drawing. The actual code to draw a pixel in the top-left corner of the screen will look like this:</p><div><pre class="programlisting">ourCanvas.drawPoint(0, 0, paint);//How simple is that?</pre></div><p>Let's now look at a working example.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec51"/>Android Canvas demo app</h1></div></div></div><p>Let's make an <a class="indexterm" id="id584"/>app that uses the <code class="literal">Canvas</code> and <code class="literal">Paint</code> classes and do a bit of drawing. This example will be completely static (no animation), so we can clearly see how to use <code class="literal">Canvas</code> and <code class="literal">Paint</code> without cluttering the code with things we will learn later.</p><p>In this demo app, we use some conceptually helpful variable names to help us grasp the role that each object is playing, but we will go through the whole thing at the end to make sure we know exactly what is going on at each stage. Of course, you don't have to type all of this. You can open the completed code files from the <code class="literal">CanvasDemo</code> folder in the <code class="literal">Chapter7</code> folder of the download bundle:</p><div><ol class="orderedlist arabic"><li class="listitem">Start a new project and call it <code class="literal">CanvasDemo</code>. Tidy up the unnecessary imports and overrides if you want to.</li><li class="listitem">Open <code class="literal">activity_main.xml</code> in the editor. Drag an <strong>ImageView</strong> from the palette to the layout. The ImageView has an ID by default, which is <code class="literal">imageView</code>. Now we will use this ID in our code.</li><li class="listitem">Switch to <code class="literal">MainActivity.java</code> in the editor. First, we will create our <code class="literal">Bitmap</code>, <code class="literal">Canvas</code>, and <code class="literal">Paint</code> objects as we discussed earlier. Here is the first part of the code. Enter it directly after the call to the <code class="literal">setContentView</code> method:<div><pre class="programlisting">//Get a reference to our ImageView in the layout
ImageView ourFrame = (ImageView) findViewById(R.id.imageView);

//Create a bitmap object to use as our canvas
Bitmap ourBitmap = Bitmap.createBitmap(300,600, Bitmap.Config.ARGB_8888);
Canvas ourCanvas = new Canvas(ourBitmap);

//A paint object that does our drawing, on our canvas
Paint paint = new Paint();</pre></div></li><li class="listitem">Here, we try out some of the cool things we can draw. Enter the code directly after the code in the previous step:<div><pre class="programlisting">//Set the background color
ourCanvas.drawColor(Color.BLACK);

//Change the color of the virtual paint brush
paint.setColor(Color.argb(255, 255, 255, 255));

//Now draw a load of stuff on our canvas
ourCanvas.drawText("Score: 42 Lives: 3 Hi: 97", 10, 10, paint);
ourCanvas.drawLine(10, 50, 200, 50, paint);
ourCanvas.drawCircle(110, 160, 100, paint);
ourCanvas.drawPoint(10, 260, paint);

//Now put the canvas in the frame
  ourFrame.setImageBitmap(ourBitmap);</pre></div></li><li class="listitem">Run the demo on an emulator or a device.</li></ol></div><p>Your output will <a class="indexterm" id="id585"/>look like what is shown in the following screenshot:</p><div><img alt="Android Canvas demo app" src="img/8859OS_07_05.jpg"/></div><p>Let's go through the code again. In steps 1 and 2, we created a new project and placed an ImageView object with an ID of <code class="literal">imageView</code> on our UI layout.</p><p>In step 3, we started by getting a reference to the <code class="literal">ImageView</code> object in our layout. However, we have done this often, usually with TextViews and Buttons. We named our ImageView <code class="literal">ourFrame</code> because it will hold our canvas:</p><div><pre class="programlisting">ImageView ourFrame = (ImageView) findViewById(R.id.imageView);</pre></div><p>Then we created a bitmap to be used to make a canvas:</p><div><pre class="programlisting">Bitmap ourBitmap = Bitmap.createBitmap(300,600, Bitmap.Config.ARGB_8888);
Canvas ourCanvas = new Canvas(ourBitmap);</pre></div><p>After that, we <a class="indexterm" id="id586"/>created our new <code class="literal">Paint</code> object:</p><div><pre class="programlisting">Paint paint = new Paint();</pre></div><p>In step 4, we were ready to draw, and we did so in a few different ways. First, we painted the entire canvas black:</p><div><pre class="programlisting">ourCanvas.drawColor(Color.BLACK);</pre></div><p>Then we chose the color with which we will be painting. <code class="literal">(255, 255, 255, 255)</code> is a numerical representation of white with full opacity (no transparency):</p><div><pre class="programlisting">paint.setColor(Color.argb(255, 255, 255, 255));</pre></div><p>Now we see something new, but it is quite easy to understand. We can also draw strings of text to the screen and position that text at precise screen coordinates, just like we can with a pixel.</p><p>You will notice that with the <code class="literal">drawText</code> method and all other drawing methods of the <code class="literal">Canvas</code> class, we always pass our <code class="literal">Paint</code> object as an argument. Just to make what is going on in the next line of code absolutely clear, I am stating that <code class="literal">"Score: 42 Lives:3 Hi: 97</code>" is the string that will be drawn on the screen,<code class="literal"> 10, 10</code> are the screen coordinates, and<code class="literal"> paint</code> is our <code class="literal">Paint</code> object:</p><div><pre class="programlisting">ourCanvas.drawText("Score: 42 Lives: 3 Hi: 97", 10, 10, paint);</pre></div><p>Next, we draw a line. The argument list here can be described as follows: (start <em>x</em> coordinate, start <em>y</em> coordinate, end <em>x</em> coordinate, end <em>y</em> coordinate, our <code class="literal">Paint</code> object):</p><div><pre class="programlisting">ourCanvas.drawLine(10, 50, 200, 50, paint);</pre></div><p>Now we see that we can draw circles. We can also draw other shapes. The argument list here can be described as follows: (start <em>x</em> coordinate, start <em>y</em> coordinate, radius of circle, our <code class="literal">Paint</code> object):</p><div><pre class="programlisting">ourCanvas.drawCircle(110, 160, 100, paint);</pre></div><p>Then we draw a humble, lonely pixel (point). The arguments we use are in this format: (<em>x</em> coordinate, <em>y</em> coordinate, <code class="literal">Paint</code> object):</p><div><pre class="programlisting">ourCanvas.drawPoint(10, 260, paint);</pre></div><p>Finally, we place our bitmap canvas on our ImageView frame:</p><div><pre class="programlisting">ourFrame.setImageBitmap(ourBitmap);</pre></div><p>We still need to get smarter with managing screen resolution and orientation, and we will do so in our retro <a class="indexterm" id="id587"/>squash game. Also, we need to look for a system that will allow us to rub out and redraw our images at a set interval to create the illusion of movement. Actually, we already know one such system. Think about how we might use threads to achieve this illusion. First of all, let's take a look at how the player will control the game. After all, we are not going to have any handy UI buttons to press for this game.</p></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec52"/>Detecting touches on the screen</h1></div></div></div><p>In our <a class="indexterm" id="id588"/>retro squash game, we will have no UI buttons, so we cannot use the <code class="literal">OnClickListener</code> interface and override the <code class="literal">onClick</code> method. This is not a problem, however. We will just use another interface to suit our situation. We will use <code class="literal">OnTouchListener</code> and override the <code class="literal">onTouchEvent</code> method. It works a bit differently, so let's take a look at implementing it before we dive into the game code.</p><p>We must implement the <code class="literal">OnTouchListener</code> interface for the activity we want to listen to touches in, like this:</p><div><pre class="programlisting">public class MainActivity extends Activity implements View.OnTouchListener{</pre></div><p>Then we can override the <code class="literal">onTouchEvent</code> method, perhaps a bit like this.</p><div><pre class="programlisting">@Override
public boolean onTouchEvent(MotionEvent motionEvent) {
  float x = motionEvent.getX();
  float y = motionEvent.getY();
  //do something with the x and y values
  return false;
}</pre></div><p>The <code class="literal">x</code> variable will hold the horizontal value of the position on the screen that was touched, and <code class="literal">y</code> will hold the vertical position. It is worth noting that the <code class="literal">motionEvent</code> object parameter contains lots of information as well as the <em>x</em> and <em>y</em> location, for example, whether the screen was touched or released. We can make some really useful switch statements with this information, as we will see later.</p><p>Knowing <a class="indexterm" id="id589"/>exactly how we use this to achieve our goals in the squash game requires us to first consider the design of the game.</p></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec53"/>Preparing to make the retro squash game</h1></div></div></div><p>Now we are ready to <a class="indexterm" id="id590"/>discuss the making of our next game. We actually know everything we need to. We just need to think about how to use the different techniques we have learned.</p><p>Let's first look at exactly what we want to achieve so that we have something to aim for.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec78"/>The design of the game</h2></div></div></div><p>Let's look at a <a class="indexterm" id="id591"/>screenshot of the game as a good starting point. When you design your own games, drawing sketches of the in-game objects and mechanics of the game will be an invaluable part of the design process. Here, we can cheat a bit by taking a look at the end result.</p><div><img alt="The design of the game" src="img/8859OS_07_15.jpg"/></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec44"/>The UI</h3></div></div></div><p>Starting from the top, we <a class="indexterm" id="id592"/>have <strong>Score</strong>. Every time the player successfully hits the ball, a point is added. Next, we have <strong>Lives</strong>. The player starts with three lives, and every time they let a ball go past their racket, they lose one life. When the player has zero lives, their score is set to zero, lives are set back to three, and the game begins again. Next to this, we have <strong>FPS</strong>. FPS stands for frames per second. It would be nice if we monitor on the screen the number of times our screen is being redrawn every second, as this is the first time we are animating our very own graphics.</p><p>Approximately in the middle of the previous screenshot is the ball. It is a square ball, in keeping with the traditional pong style. Squares are also easier when you have to perform realistic-looking collision detection.</p></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec45"/>Physics</h3></div></div></div><p>We will detect <a class="indexterm" id="id593"/>when the ball hits any of the four sides of the screen as well as when it hits the racket. Depending on what the ball hits and its current direction at the time of the collision, we will determine what happens to the ball. Here is a rough outline of what each type of collision will do:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Hit the top of the screen</strong>: The ball will maintain the same horizontal (<em>x</em>) direction of travel but reverse the vertical (<em>y</em>) direction of travel.</li><li class="listitem" style="list-style-type: disc"><strong>Hit either side of the screen</strong>: The ball will maintain its <em>y</em> direction of travel but reverse its <em>x</em> direction.</li><li class="listitem" style="list-style-type: disc"><strong>Hit the bottom of the screen</strong>: The ball will disappear and restart at the top of the screen with a downward <em>y</em> direction of travel and a random <em>x</em> direction of travel.</li><li class="listitem" style="list-style-type: disc"><strong>Hit the player's racket</strong>: We will check whether the ball has hit the left or the right of the racket and alter the <em>x</em> direction of travel to match. We will also reverse the <em>y</em> direction of travel to send the ball back to the top again.</li></ul></div><p>By enforcing these crude virtual rules of physics, we can simply create a ball that behaves almost as we would expect a real ball to do. We will add a few properties such as slightly increasing the ball speed after hitting the racket. These rules will work just as well in portrait or landscape orientations.</p><p>The player's racket will be a simple rectangle that the player can slide left by holding anywhere on the left half of the screen, and right by holding anywhere on the right of the screen.</p><p>For brevity, we will not be making a main menu screen to implement high scores. In our final game, which we <a class="indexterm" id="id594"/>start in the next chapter, we will go ahead and have an animated menu screen, online high scores, and achievements. However, this squash game will simply restart when the player reaches zero lives.</p></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec46"/>The structure of the code</h3></div></div></div><p>Here, we will <a class="indexterm" id="id595"/>take a quick theoretical look at some aspects of the implementation that might be raising questions. When we finally get down to the implementation, we should find most of the code quite straightforward, with only a few bits that might need extra explanation.</p><p>We have discussed everything we need to know, and we will also discuss specifics in the code as we go through the implementation. We will go over the trickier parts of the code at the end of each phase of implementation.</p><p>As usual, all the completed code files can be found in the download bundle. The files encompassing all the phases of this project are in the <code class="literal">Chapter7/RetroSquash</code> folder.</p><p>We have learned that in an application using classes and their methods, different parts of the code will be dependent on other parts. Therefore, rather than jumping back and forth in the code, we will lay it out from the first line to the last in order. Of course, we will also refer to the related parts of code as we go along. I definitely recommend studying the code in its entirety to fully grasp what is going on and which parts of the code call which other parts.</p><p>To prevent this implementation from spreading into an enormous to-do list, it has been broken into four phases. This should provide convenient places to stop and take a break.</p><p>There is no layout file and only one <code class="literal">.java</code> file. This file is called <code class="literal">MainActivity.java</code>. The <code class="literal">MainActivity.java</code> file has a structure as indicated in the following overview of the code. I have indented some parts to show what parts are enclosed within others. This is a high-level view, and it omits quite a lot of detail:</p><div><pre class="programlisting">Package name and various import statements
MainActivity class starts{
    Declare some member variables
    OnCreate method{
      Initialization and setup
    }
    SquashCourtView class{
      Constructor
      Multiple methods of SquashCourtView
    }
    Some Android lifecycle method overrides
}</pre></div><p>As previously stated, we can see that everything is in the <code class="literal">MainActivity.java</code> file. As usual, at the top of our file, we will have a package name and a load of imports for the different classes we will be using.</p><p>Next, as per all our other projects, we have the <code class="literal">MainActivity</code> class. It encompasses everything else, even the <code class="literal">SquashCourtView</code> class. This makes the <code class="literal">SquashCourtView</code> class an inner class and will therefore be able to access the member variables of the <code class="literal">MainActivity</code> class, which will be essential in this implementation.</p><p>Before the <code class="literal">SquashCourtView</code> class, however, comes the declaration of all the member variables in the <a class="indexterm" id="id596"/>
<code class="literal">MainActivity</code> class, followed by a fairly in-depth <code class="literal">onCreate</code> method.</p><p>We could implement the other Android lifecycle methods next, and you are welcome to do so. However, the code within the other Android lifecycle methods will make more sense once we have seen the code in the <code class="literal">SquashCourtView</code> class methods.</p><p>After <code class="literal">onCreate</code>, we will implement the <code class="literal">SquashCourtView</code> class. This has some fairly long methods in it, so we will break it into phases 2 and 3.</p><p>Finally, we will implement the remaining Android lifecycle methods. They are short but important.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec54"/>The four implementation phases in detail</h1></div></div></div><p>Let's take an even closer look at the implementation before we actually get to it. Here is how we will divide the implementation into the four phases, this time with a bit more detail as to what to expect in each:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Phase 1 – MainActivity and onCreate</strong>: In this phase, we will create the project itself as <a class="indexterm" id="id597"/>well as implement the <a class="indexterm" id="id598"/>following steps:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We will add our imports and create the body of our <code class="literal">MainActivity</code> class</li><li class="listitem" style="list-style-type: disc">Within this, we will declare the member variables that the game needs</li><li class="listitem" style="list-style-type: disc">We will <a class="indexterm" id="id599"/>implement our <code class="literal">onCreate</code> method, which does loads of setup work but nothing that is hard to understand</li></ul></div></li><li class="listitem" style="list-style-type: disc"><strong>Phase 2 – SquashCourtView part 1</strong>: In this phase, we will start work on our key class, <code class="literal">SquashCourtView</code>. Specifically, we will:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Implement <a class="indexterm" id="id600"/>the declaration of the <code class="literal">SquashCourtView</code> class and its member variables.</li><li class="listitem" style="list-style-type: disc">Write a simple constructor.</li><li class="listitem" style="list-style-type: disc">Implement the <code class="literal">run</code> method to control the flow of the game.</li><li class="listitem" style="list-style-type: disc">Implement the lengthy but fairly easy-to-understand <code class="literal">updateCourt</code> method. This is the method that handles collision detection and keeps track of our ball and racket.</li></ul></div></li><li class="listitem" style="list-style-type: disc"><strong>Phase 3 – SquashCourtView part 2</strong>: In this phase, we will finish the <code class="literal">SquashCourtView</code> class by implementing the following:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">drawCourt</code> method, which unsurprisingly does all the drawing</li><li class="listitem" style="list-style-type: disc">The <a class="indexterm" id="id601"/><code class="literal">controlFPS</code> method, which makes the game run at similar speeds on devices that have different CPUs</li><li class="listitem" style="list-style-type: disc">Next, we will quickly write a couple of methods that help the Android lifecycle methods with similar names—the <code class="literal">pause</code> and <code class="literal">resume</code> methods</li><li class="listitem" style="list-style-type: disc">Finally for this phase, we will easily handle the touch controls of the game by overriding the <code class="literal">onTouchEvent</code> method we looked at earlier</li></ul></div></li><li class="listitem" style="list-style-type: disc"><strong>Phase 4 – Remaining lifecycle methods</strong>: In this short phase we will add the finishing touches:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Quickly implement what happens in the <code class="literal">onPause</code>, <code class="literal">onResume</code>, and <code class="literal">onStop</code> methods by overriding them</li><li class="listitem" style="list-style-type: disc">We will also handle what happens when the player presses the back button on their phone or tablet</li></ul></div></li></ul></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec79"/>Phase 1 – MainActivity and onCreate</h2></div></div></div><p>Now that we have <a class="indexterm" id="id602"/>seen what we will do in each of the phases, let's actually get started with building our game by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new project, just as we have before, but with one slight difference. This time, on the <strong>New Project</strong> dialog, change <strong>Minimum required SDK</strong> to <strong>API 13: Android 3.2 (Honeycomb)</strong>. Call the project <code class="literal">RetroSquash</code>. Delete the unnecessary overridden methods if you like.</li><li class="listitem">Edit the <code class="literal">AndroidManifest.xml</code> file, just as we did at the end of <a class="link" href="ch04.html" title="Chapter 4. Discovering Loops and Methods">Chapter 4</a>, <em>Discovering Loops and Methods</em>, to make the app use the full screen. Check back for full details <a class="indexterm" id="id603"/>if needed. Note that we are <em>not</em> locking orientation because this game is fun in both portrait and landscape. Here is the line of code to add:<div><pre class="programlisting">android:theme="@android:style/Theme.NoTitleBar.Fullscreen"&gt;</pre></div></li><li class="listitem">Make some sound effects using Bfxr, as we did in <a class="link" href="ch05.html" title="Chapter 5. Gaming and Java Essentials">Chapter 5</a>, <em>Gaming and Java Essentials</em>. Four will be enough, but there is nothing stopping you from adding more sounds. For authentic 1970s-style sounds, try the <strong>Blip/Select</strong> button shown in the following screenshot. Name the samples <code class="literal">sample1.ogg</code>, <code class="literal">sample2.ogg</code>, <code class="literal">sample3.ogg</code>, and <code class="literal">sample4.ogg</code>. Or you can just use my samples. They are in the <code class="literal">assets</code> folder of the folder named <code class="literal">RetroSquash</code> in the code bundle.<div><img alt="Phase 1 – MainActivity and onCreate" src="img/8859OS_07_10.jpg"/></div></li><li class="listitem">In Project Explorer, create a directory called <code class="literal">assets</code> within the <code class="literal">main</code> directory. Copy the four sound files you created in the previous step to the newly created <code class="literal">assets</code> folder.</li><li class="listitem">Type the following import statements at the top of the <code class="literal">MainActivity.java</code> file but just after your package name, as shown in the following code:<div><pre class="programlisting">package com.packtpub.retrosquash.app;

import android.app.Activity;
import android.content.Context;
import android.content.res.AssetFileDescriptor;
import android.content.res.AssetManager;
import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.Paint;
import android.graphics.Point;
import android.media.AudioManager;
import android.media.SoundPool;
import android.os.Bundle;
import android.view.Display;
import android.view.KeyEvent;
import android.view.MotionEvent;
import android.view.SurfaceHolder;
import android.view.SurfaceView;
import java.io.IOException;
import java.util.Random;</pre></div></li><li class="listitem">Now type your <a class="indexterm" id="id604"/>class declaration and declare the following member variables. We will discuss the member variables in <a class="indexterm" id="id605"/>detail at the end of this phase:<div><pre class="programlisting">public class MainActivity extends Activity {

    Canvas canvas;
    SquashCourtView squashCourtView;

    //Sound
    //initialize sound variables
    private SoundPool soundPool;
    int sample1 = -1;
    int sample2 = -1;
    int sample3 = -1;
    int sample4 = -1;

    //For getting display details like the number of pixels
    Display display;
    Point size;
    int screenWidth;
    int screenHeight;

    //Game objects
    int racketWidth;
    int racketHeight;
    Point racketPosition;

    Point ballPosition;
    int ballWidth;

    //for ball movement
    boolean ballIsMovingLeft;
    boolean ballIsMovingRight;
    boolean ballIsMovingUp;
    boolean ballIsMovingDown;

    //for racket movement
    boolean racketIsMovingLeft;
    boolean racketIsMovingRight;

    //stats
    long lastFrameTime;
    int fps;
    int score;
    int lives;</pre></div></li><li class="listitem">Next, we will enter the <code class="literal">onCreate</code> method in its entirety. We are initializing many of the member variables that we declared in the previous step, as well as creating an object from our <code class="literal">SquashCourtView</code> class, which we will begin to implement in the next phase. Perhaps the most notable line in this block of code is the <a class="indexterm" id="id606"/>somewhat different call to <code class="literal">setContentView</code>. Look at the argument for <code class="literal">setContentView</code>. We will learn more <a class="indexterm" id="id607"/>about this argument at the end of this phase. This phase also sets up <code class="literal">SoundPool</code> and loads the sound samples. Type the first part of the <code class="literal">onCreate</code> code:<div><pre class="programlisting">protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        squashCourtView = new SquashCourtView(this);
        <strong>setContentView(squashCourtView);</strong>

        //Sound code
        soundPool = new SoundPool(10, AudioManager.STREAM_MUSIC, 0);
        try {
            //Create objects of the 2 required classes
            AssetManager assetManager = getAssets();
            AssetFileDescriptor descriptor;

            //create our three fx in memory ready for use
            descriptor = assetManager.openFd("sample1.ogg");
            sample1 = soundPool.load(descriptor, 0);

            descriptor = assetManager.openFd("sample2.ogg");
            sample2 = soundPool.load(descriptor, 0);


            descriptor = assetManager.openFd("sample3.ogg");
            sample3 = soundPool.load(descriptor, 0);

            descriptor = assetManager.openFd("sample4.ogg");
            sample4 = soundPool.load(descriptor, 0);


        } catch (IOException e) {
            //catch exceptions here
        }</pre></div></li><li class="listitem">Now we initialize the variables we created earlier. Notice that there are some good potential <a class="indexterm" id="id608"/>candidates for a bit of encapsulation. However, to keep the code readable, we will not do so at this stage. Enter this code:<div><pre class="programlisting">        //Could this be an object with getters and setters
        //Don't want just anyone changing screen size.
        //Get the screen size in pixels
        display = getWindowManager().getDefaultDisplay();
        size = new Point();
        display.getSize(size);
        screenWidth = size.x;
        screenHeight = size.y;


        //The game objects
        racketPosition = new Point();
        racketPosition.x = screenWidth / 2;
        racketPosition.y = screenHeight - 20;
        racketWidth = screenWidth / 8;
        racketHeight = 10;

        ballWidth = screenWidth / 35;
        ballPosition = new Point();
        ballPosition.x = screenWidth / 2;
        ballPosition.y = 1 + ballWidth;

        lives = 3;

    }</pre></div></li></ol></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec47"/>Phase 1 code explained</h3></div></div></div><p>Let's look at what we did. From steps 1 to 4, we simply created a project and some sound files. Then we added the sound files to the <code class="literal">assets</code> folder as we have done before on other projects. In step 5, <a class="indexterm" id="id609"/>we added all the necessary imports for the classes we will be using.</p><p>In step 6, we created a <a class="indexterm" id="id610"/>whole load of member variables. Let's take a closer look at them. We declared an object of the <code class="literal">Canvas</code> type called <code class="literal">canvas</code>. We will use this object to set up our drawing system. We also declared an instance of <code class="literal">SquashCourtView</code> called <code class="literal">squashCourtView</code>. This will be underlined as an error because we haven't implemented the class yet.</p><p>Here, we declared and initialized variables to be references to our sound files, just as we did in other projects. After this, we did something new:</p><div><pre class="programlisting">//For getting display details like the number of pixels
Display display;
Point size;
int screenWidth;
int screenHeight;</pre></div><p>We declared a <code class="literal">Display</code> object and a <code class="literal">Point</code> object. We see these in action in our <code class="literal">onCreate</code> method in a minute, alongside the two <code class="literal">int</code> variables, <code class="literal">screenWidth</code> and <code class="literal">screenHeight</code>. We use them to get the screen size in pixels so that we can make our game work on a screen with any resolution.</p><p>Here, we declared some variables whose purpose is plain from their names. Their actual usage becomes clearer when we initialize them in step 8 and use them throughout our <code class="literal">SquashCourtView</code> class:</p><div><pre class="programlisting">//Game objects
int racketWidth;
int racketHeight;
Point racketPosition;

Point ballPosition;
int ballWidth;</pre></div><p>Here, we have a bunch of Boolean variables to control the logic of the movement of both the racket and the ball. Notice that there is a variable for each possible direction for both the racket and the ball. Notice <a class="indexterm" id="id611"/>also that the racket can move in two directions—left and right—and the ball in four. Of course, the ball can travel in two directions at the same time. All will become clear when we write the <code class="literal">updateCourt</code> method in <a class="indexterm" id="id612"/>phase 2. Here is that code again:</p><div><pre class="programlisting">//for ball movement
boolean ballIsMovingLeft;
boolean ballIsMovingRight;
boolean ballIsMovingUp;
boolean ballIsMovingDown;

//for racket movement
 boolean racketIsMovingLeft;
 boolean racketIsMovingRight;</pre></div><p>In the last part of step 6, we declared two fairly obvious variables, <code class="literal">lives</code> and <code class="literal">score</code>. But what about <code class="literal">lastFrameTime</code> and <code class="literal">fps</code>? These will be used in the <code class="literal">controlFPS</code> method, which we will write in phase 3. They will be used along with some local variables to measure how fast our game loop runs. We can then lock it to run at a consistent rate so that players on devices with different CPU speeds get a similar experience.</p><p>In step 7, we entered the <code class="literal">onCreate</code> method, but this time, things are different. We initialize <code class="literal">squashCourtView</code> as a new <code class="literal">SquashCourtView</code> object. It's fine so far, but then we seem to be telling <code class="literal">setContentView</code> to make this the entire view that the player will see, instead of the usual view created in the Android Studio designer, which we have become used to. We are not using any Android UI components in this game, so the visual designer and all of its generated XML are of no use to us. As you will see right at the start of phase 2, our <code class="literal">SquashCourtView</code> class extends (inherits from) <code class="literal">SurfaceView</code>.</p><p>We created an object with all the facilities of a <code class="literal">SurfaceView</code>. We will just customize it to play our squash game. Neat! Therefore, it is perfectly acceptable and logical to set our <code class="literal">squashCourtView</code> object as the entire view that the player will see:</p><div><pre class="programlisting">squashCourtView = new SquashCourtView(this);
<strong>setContentView(squashCourtView);</strong>
</pre></div><p>We then set up our sound effects as we have done before.</p><p>In step 8, we initialized many of the variables that we declared in step 6. Let's look at the values and the order in which we initialized them. You might have noticed that we don't initialize every variable here; some will be initialized later. Remember that we don't have to initialize member variables and that they also have default values.</p><p>In the following code, we <a class="indexterm" id="id613"/>get the number of pixels (wide and high) for the device. The <code class="literal">display</code> object holds the details of the display after the first line has been executed. Then we create a new object called <code class="literal">size</code> of the <code class="literal">Point</code> type. We send <code class="literal">size</code> as an <a class="indexterm" id="id614"/>argument to the <code class="literal">display.getSize</code> method. The <code class="literal">Point</code> type has an <code class="literal">x</code> and <code class="literal">y</code> member variable, and so does the <code class="literal">size</code> object, which now holds the width and height (in pixels) of the display. These values are then assigned to <code class="literal">screenWidth</code> and <code class="literal">screenHeight</code> respectively. We will use <code class="literal">screenWidth</code> and <code class="literal">screenHeight</code> quite extensively in the <code class="literal">SquashCourtView</code> class:</p><div><pre class="programlisting">display = getWindowManager().getDefaultDisplay();
size = new Point();
display.getSize(size);
screenWidth = size.x;
screenHeight = size.y;</pre></div><p>Next, we initialize the variables that determine the size and position of the ball and racket. Here, we initialize our <code class="literal">racketPosition</code> object, which is of the <code class="literal">Point</code> type. Remember that it has an <code class="literal">x</code> and a <code class="literal">y</code> member variable:</p><div><pre class="programlisting">racketPosition = new Point();</pre></div><p>We initialize <code class="literal">racketPosition.x</code> to be whatever the current screen width in pixels might be, but divided by two, so the racket will start in a horizontal and central position regardless of the resolution of the screen:</p><div><pre class="programlisting">racketPosition.x = screenWidth / 2;</pre></div><p>In the next line of code, <code class="literal">racketPosition.y</code> is put at the bottom of the screen with a small 20-pixel gap:</p><div><pre class="programlisting">racketPosition.y = screenHeight - 20;</pre></div><p>We make the width of the racket to one-eighth the width of the screen. We will see when we get to run the game that this is a fairly effective size, but we could make it bigger by dividing it by a lower number, or smaller by dividing it by a larger number. The point is that it will be the same fraction of <code class="literal">screenWidth</code> regardless of the resolution of the device:</p><div><pre class="programlisting">racketWidth = screenWidth / 8;</pre></div><p>In the following line of code, we choose an arbitrary height for our racket:</p><div><pre class="programlisting">racketHeight = 10;</pre></div><p>Then we make our ball as small as 1/35th of the screen. Again, we could make it larger or smaller:</p><div><pre class="programlisting">ballWidth = screenWidth / 35;</pre></div><p>In the next line of code, we will create a new point object to hold the position of the ball:</p><div><pre class="programlisting">ballPosition = new Point();</pre></div><p>As we did with the racket, we start the ball in the center of the screen, like this:</p><div><pre class="programlisting">ballPosition.x = screenWidth / 2;</pre></div><p>However, we set it to <a class="indexterm" id="id615"/>start at the top of the screen just far enough to see <a class="indexterm" id="id616"/>the top of the ball:</p><div><pre class="programlisting">ballPosition.y = 1 + ballWidth;</pre></div><p>The player starts the game with three lives:</p><div><pre class="programlisting">lives = 3;</pre></div><p>Phew! That was a fairly chunky section. Take a break if you like, and then we will move on to phase 2.</p></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec80"/>Phase 2 – SquashCourtView part 1</h2></div></div></div><p>Finally, we get to the secret weapon of our game—the <code class="literal">SquashCourtView</code> class. The first three methods are presented here, and explained more fully once we have implemented them:</p><div><ol class="orderedlist arabic"><li class="listitem">Here is a class declaration that extends <code class="literal">SurfaceView</code>, giving our class all the methods and properties of <code class="literal">SurfaceView</code>. It also implements <code class="literal">Runnable</code>, which allows it <a class="indexterm" id="id617"/>to run in a separate thread. As you will see, we will put the bulk of the functionality in the <code class="literal">run</code> method. After the declaration, we have a constructor. Remember that the constructor is a method that has the same name as the class and is called when we initialize a new object of its type. The code in the constructor initializes some objects and then sends the ball off in a random direction. We will look at that part in detail after we have implemented this phase. Enter the following <a class="indexterm" id="id618"/>code before the closing curly brace of the <code class="literal">MainActivity</code> class:<div><pre class="programlisting">class SquashCourtView extends SurfaceView implements Runnable {
        Thread ourThread = null;
        SurfaceHolder ourHolder;
        volatile boolean playingSquash;
        Paint paint;

        public SquashCourtView(Context context) {
            super(context);
            ourHolder = getHolder();
            paint = new Paint();
            ballIsMovingDown = true;

            //Send the ball in random direction
            Random randomNumber = new Random();
            int ballDirection = randomNumber.nextInt(3);
            switch (ballDirection) {
                case 0:
                    ballIsMovingLeft = true;
                    ballIsMovingRight = false;
                    break;

                case 1:
                    ballIsMovingRight = true;
                    ballIsMovingLeft = false;
                    break;

                case 2:
                    ballIsMovingLeft = false;
                    ballIsMovingRight = false;
                    break;
            }


        }</pre></div></li><li class="listitem">Now we have this short and sweet overriding of the <code class="literal">run</code> method. Remember that the <code class="literal">run</code> method contains the functionality of the thread. In this case, it has three <a class="indexterm" id="id619"/>calls, one to each of <code class="literal">updateCourt</code>, <code class="literal">drawCourt</code>, and <code class="literal">controlFPS</code>, the three key methods of our class. Enter this code:<div><pre class="programlisting">@Override
        public void run() {
            while (playingSquash) {
                updateCourt();
                drawCourt();
                controlFPS();

            }

        }</pre></div></li><li class="listitem">We will implement just one more method in this phase (<code class="literal">updateCourt</code>), but it is quite long. We will split it into chunks and briefly mention what is going on in each chunk before we type the code. We will perform a closer examination of how it works when the phase is implemented. In this next chunk of code, we handle the left and right movement of the racket as well as detecting and reacting when the ball hits either the left or the right of the screen. Enter the following code after the code from the previous step:<div><pre class="programlisting">public void updateCourt() {
            if (racketIsMovingRight) {
                racketPosition.x = racketPosition.x + 10;
            }

            if (racketIsMovingLeft) {
                racketPosition.x = racketPosition.x - 10;
            }


            //detect collisions

            //hit right of screen
            if (ballPosition.x + ballWidth &gt; screenWidth) {
                ballIsMovingLeft = true;
                ballIsMovingRight = false;
                soundPool.play(sample1, 1, 1, 0, 0, 1);
            }

            //hit left of screen
            if (ballPosition.x &lt; 0) {
                ballIsMovingLeft = false;
                ballIsMovingRight = true;
                soundPool.play(sample1, 1, 1, 0, 0, 1);
            }</pre></div></li><li class="listitem">In this next <a class="indexterm" id="id620"/>chunk of code, we check whether the ball has hit the bottom of the screen, that is, the player has failed to return the ball. Enter this code directly after the code in the previous step:<div><pre class="programlisting">//Edge of ball has hit bottom of screen
            if (ballPosition.y &gt; screenHeight - ballWidth) {
                lives = lives - 1;
                if (lives == 0) {
                    lives = 3;
                    score = 0;
                    soundPool.play(sample4, 1, 1, 0, 0, 1);
                }
                ballPosition.y = 1 + ballWidth;//back to top of screen

                //what horizontal direction should we use
                //for the next falling ball
                Random randomNumber = new Random();
                int startX = randomNumber.nextInt(screenWidth - ballWidth) + 1;
                ballPosition.x = startX + ballWidth;

                int ballDirection = randomNumber.nextInt(3);
                switch (ballDirection) {
                    case 0:
                        ballIsMovingLeft = true;
                        ballIsMovingRight = false;
                        break;

                    case 1:
                        ballIsMovingRight = true;
                        ballIsMovingLeft = false;
                        break;

                    case 2:
                        ballIsMovingLeft = false;
                        ballIsMovingRight = false;
                        break;
                }
            }</pre></div></li><li class="listitem">In this chunk of code, we handle whether the ball has hit the top of the screen. We <a class="indexterm" id="id621"/>also calculate all the possible movements of the ball for this frame. Now type the following code:<div><pre class="programlisting">//we hit the top of the screen
            if (ballPosition.y &lt;= 0) {
                ballIsMovingDown = true;
                ballIsMovingUp = false;
                ballPosition.y = 1;
                soundPool.play(sample2, 1, 1, 0, 0, 1);
            }

            //depending upon the two directions we should
            //be moving in adjust our x any positions
            if (ballIsMovingDown) {
                ballPosition.y += 6;
            }

            if (ballIsMovingUp) {
                ballPosition.y -= 10;
            }

            if (ballIsMovingLeft) {
                ballPosition.x -= 12;
            }

            if (ballIsMovingRight) {
                ballPosition.x += 12;
            }</pre></div></li><li class="listitem">Finally, we handle collision detection and the reaction of the racket and the ball. We also close the <code class="literal">updateCourt</code> method, and this is the last chunk of code for this <a class="indexterm" id="id622"/>phase. Enter the following after your code from the previous step:<div><pre class="programlisting">//Has ball hit racket
            if (ballPosition.y + ballWidth &gt;= (racketPosition.y - racketHeight / 2)) {
                int halfRacket = racketWidth / 2;
                if (ballPosition.x + ballWidth &gt; (racketPosition.x - halfRacket)
                    &amp;&amp; ballPosition.x - ballWidth &lt; (racketPosition.x + halfRacket)) {
                    //rebound the ball vertically and play a sound
                    soundPool.play(sample3, 1, 1, 0, 0, 1);
                    score++;
                    ballIsMovingUp = true;
                    ballIsMovingDown = false;
                    //now decide how to rebound the ball horizontally
                    if (ballPosition.x &gt; racketPosition.x) {
                        ballIsMovingRight = true;
                        ballIsMovingLeft = false;

                    } else {
                        ballIsMovingRight = false;
                        ballIsMovingLeft = true;
                    }

                }
            }
        }
}</pre></div></li></ol></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec48"/>Phase 2 code explained</h3></div></div></div><p>The code in this phase was <a class="indexterm" id="id623"/>lengthy, but there is nothing too challenging when we break it down. Possibly, the only challenge is in unravelling some of those nested <code class="literal">if</code> statements. We will do this now.</p><p>In step 1, we declare our <code class="literal">SquashCourView</code> class. This implements the <code class="literal">Runnable</code> interface. You might remember from <a class="link" href="ch05.html" title="Chapter 5. Gaming and Java Essentials">Chapter 5</a>, <em>Gaming and Java Essentials</em>, that <code class="literal">Runnable</code> provides us with a thread. All we need to do is override the <code class="literal">run</code> method, and whatever is within it will work in a new thread.</p><p>Then we created a new <code class="literal">Thread</code> object called <code class="literal">ourThread</code>, and a <code class="literal">SurfaceHolder</code> object to hold our surface and enable us to control or lock our surface for use within our thread. Next, we have <code class="literal">playingSquash</code> of the <code class="literal">boolean</code> type. This wraps the inside of our overridden <code class="literal">run</code> method to control when the game is running. The odd-looking <code class="literal">volatile</code> modifier means that we will be able to change its value from the outside and inside of our thread.</p><p>Lastly, for the currently <a class="indexterm" id="id624"/>discussed block of code, we declare an object of the <code class="literal">Paint</code> type, called <code class="literal">paint</code>, to do our painting:</p><div><pre class="programlisting">class SquashCourtView extends SurfaceView implements Runnable {
        Thread ourThread = null;
        SurfaceHolder ourHolder;
        volatile boolean playingSquash;
        Paint paint;</pre></div><p>Next, we implemented the constructor of our class, so that when we initialized a new <code class="literal">SquashCourtView</code> object back in <code class="literal">onCreate</code>, this is the code that runs. First, we see that we run the constructor of the superclass. Then we initialize <code class="literal">ourHolder</code> using the <code class="literal">getHolder</code> method. Next, we initialize our <code class="literal">paint</code> object:</p><div><pre class="programlisting">        public SquashCourtView(Context context) {
            super(context);
            ourHolder = getHolder();
            paint = new Paint();</pre></div><p>Now, still within the constructor, we get things moving. We set our <code class="literal">ballIsMovingDown</code> variable to <code class="literal">true</code>. At the start of each game, we always want the ball to be moving down. We will see soon that the <code class="literal">updateCourt</code> method will perform the ball movement. Next, we send the ball in a random horizontal direction. This is achieved by getting a random number between 0 and 2. We then switch for each possible case: 0, 1, or 2. In each case statement, we set the Boolean variables that control horizontal movement differently. In <code class="literal">case 0</code>, the ball moves left, and in <code class="literal">case 1</code> and <code class="literal">case 3</code>, the ball will move right and straight down, respectively. Then we close our constructor:</p><div><pre class="programlisting">            ballIsMovingDown = true;

            //Send the ball in random direction
            Random randomNumber = new Random();
            int ballDirection = randomNumber.nextInt(3);
            switch (ballDirection) {
                case 0:
                    ballIsMovingLeft = true;
                    ballIsMovingRight = false;
                    break;

                case 1:
                    ballIsMovingRight = true;
                    ballIsMovingLeft = false;
                    break;

                case 2:
                    ballIsMovingLeft = false;
                    ballIsMovingRight = false;
                    break;
            }


        }</pre></div><p>In step 2, we have some really simple code, but this is the code that runs everything else. The overridden <code class="literal">run</code> method is what <code class="literal">ourThread</code> calls at defined intervals. As you can see, the code is wrapped in a <code class="literal">while</code> block controlled by our <code class="literal">playingSquash</code> variable of the <code class="literal">boolean</code> type. Then <a class="indexterm" id="id625"/>the code simply calls <code class="literal">updateCourt</code>, which controls movement and collision detection; <code class="literal">drawCourt</code>, which will draw everything; and <code class="literal">controlFPS</code>, which will lock our game to a consistent frame rate. That's it for <code class="literal">run</code>:</p><div><pre class="programlisting">@Override
        public void run() {
            while (playingSquash) {
                updateCourt();
                drawCourt();
                controlFPS();

            }

        }</pre></div><p>Then in step 3, we begin the <code class="literal">updateCourt</code> method. It was quite long, so we broke it down into a few manageable chunks. The first two <code class="literal">if</code> blocks check to see whether either the <code class="literal">racketIsMovingRight</code> or the <code class="literal">racketIsMovingLeft</code> Boolean variables is true. If one of them is true, the blocks add <code class="literal">10</code> to or subtract <code class="literal">10</code> from <code class="literal">racketPosition.x</code>. The effect of this will be seen by the player when the racket is drawn in the <code class="literal">drawCourt</code> method. How the Boolean variables are manipulated in the <code class="literal">onTouchEvent</code> method will be discussed soon:</p><div><pre class="programlisting">public void updateCourt() {
            if (racketIsMovingRight) {
                racketPosition.x = racketPosition.x + 10;
            }

            if (racketIsMovingLeft) {
                racketPosition.x = racketPosition.x - 10;
            }</pre></div><p>Now, still in the <code class="literal">updateCourt</code> method, we detect and handle collisions with the left and right side of the screen. Checking whether <code class="literal">ballPosition.x</code> is larger than <code class="literal">screenWidth</code> would be enough to see whether the ball bounces back the other way. However, by being a bit more precise and testing for <code class="literal">ballPosition.x + ballWidth &gt; screenWidth</code>, we are testing whether the right <a class="indexterm" id="id626"/>edge of the ball hits the right side of the screen. This creates a much more pleasing effect as it looks more <em>real</em>. When a collision occurs with the right side, we simply reverse the direction of our ball and play a sound. The reason that the <code class="literal">if</code> code for the left-side detection is simpler is because we have drawn the ball using <code class="literal">drawRect</code>, so <code class="literal">ballPosition.x</code> is the precise left side of the ball. When the ball collides with the left side, we simply reverse its direction and play a beep sound:</p><div><pre class="programlisting">            //detect collisions

            //hit right of screen
            if (ballPosition.x + ballWidth &gt; screenWidth) {
                ballIsMovingLeft = true;
                ballIsMovingRight = false;
                soundPool.play(sample1, 1, 1, 0, 0, 1);
            }

            //hit left of screen
            if (ballPosition.x &lt; 0) {
                ballIsMovingLeft = false;
                ballIsMovingRight = true;
                soundPool.play(sample1, 1, 1, 0, 0, 1);
            }</pre></div><p>In step 4, we implemented what happens when the ball hits the bottom of the screen. This occurs when the player fails to return the ball, so a fair few things need to happen here. However, there is nothing overly complicated in this section. First comes the collision test. We check whether the underside of the ball has hit the bottom of the screen:</p><div><pre class="programlisting">//Edge of ball has hit bottom of screen
if (ballPosition.y &gt; screenHeight - ballWidth) {</pre></div><p>If it has hit, we deduct a life. Then we check whether the player has lost all their lives:</p><div><pre class="programlisting">   lives = lives - 1;
   if (lives == 0) {</pre></div><p>If all lives are lost, we start the game again by resetting lives to 3 and score to 0. We also play a low beep sound:</p><div><pre class="programlisting">          lives = 3;
          score = 0;
          soundPool.play(sample4, 1, 1, 0, 0, 1);
       }</pre></div><p>As of now, we are still <a class="indexterm" id="id627"/>within the <code class="literal">if</code> block because the ball hit the bottom of the screen, but outside the <code class="literal">if </code>block for the player who has zero lives. Whether the player has zero lives or still has some lives left, we need to put the ball back at the top of the screen and send it in a downward trajectory and a random horizontal direction. This code is similar to but not the same as the code we have seen in the constructor to start the ball moving at the beginning of the game:</p><div><pre class="programlisting">ballPosition.y = 1 + ballWidth;//back to top of screen
//what horizontal direction should we use
//for the next falling ball
Random randomNumber = new Random();
int startX = randomNumber.nextInt(screenWidth - ballWidth) + 1;
                ballPosition.x = startX + ballWidth;

                int ballDirection = randomNumber.nextInt(3);
                switch (ballDirection) {
                    case 0:
                        ballIsMovingLeft = true;
                        ballIsMovingRight = false;
                        break;

                    case 1:
                        ballIsMovingRight = true;
                        ballIsMovingLeft = false;
                        break;

                    case 2:
                        ballIsMovingLeft = false;
                        ballIsMovingRight = false;
                        break;
                }
            }</pre></div><p>In step 5, we handle the event of the ball hitting the top of the screen. Reverse the values held by <code class="literal">ballIsMovingDown</code> and <code class="literal">ballIsMovingUp</code> to reverse the direction of the ball. Tweak the <a class="indexterm" id="id628"/>ball position with <code class="literal">ballPosition.y = 1</code>. This stops the ball from getting stuck and plays a nice beep:</p><div><pre class="programlisting">//we hit the top of the screen
            if (ballPosition.y &lt;= 0) {
                ballIsMovingDown = true;
                ballIsMovingUp = false;
                ballPosition.y = 1;
                soundPool.play(sample2, 1, 1, 0, 0, 1);
            }</pre></div><p>Now, after all this collision detection and switching around of our Boolean variables, we actually move the ball. For each direction that is true, we add to or subtract from the <code class="literal">ballPosition.x</code> and <code class="literal">ballPosition.y</code> accordingly. Notice that the ball travels up faster than it travels down. This is done to shorten the time the player is waiting to get back into the action, and also crudely simulates the act of acceleration after the ball is hit by the racket:</p><div><pre class="programlisting">            //depending upon the two directions we should be
            //moving in adjust our x any positions
            if (ballIsMovingDown) {
                ballPosition.y += 6;
            }

            if (ballIsMovingUp) {
                ballPosition.y -= 10;
            }

            if (ballIsMovingLeft) {
                ballPosition.x -= 12;
            }

            if (ballIsMovingRight) {
                ballPosition.x += 12;
            }</pre></div><div><div><h3 class="title"><a id="tip54"/>Tip</h3><p>You might have noticed that by hardcoding the number of pixels the ball moves, we create an inconsistent speed for the ball between high-resolution  and low-resolution screens. Take a look at the self-test questions at the end of the chapter to see how we can solve this.</p></div></div><p>We have one last bit of collision detection to do. Has the ball hit the racket? This detection is done in a couple of stages. First, we check whether the underside of the ball has reached or <a class="indexterm" id="id629"/>gone past the top side of the racket:</p><div><pre class="programlisting">if (ballPosition.y + ballWidth &gt;= (racketPosition.y - racketHeight / 2)) {</pre></div><p>If this condition is true, we perform some more tests. First, we declare and initialize an <code class="literal">int</code> variable called <code class="literal">halfRacket</code> to hold half the width of the racket. We will use this in the upcoming tests:</p><div><pre class="programlisting">int halfRacket = racketWidth / 2;</pre></div><p>The next <code class="literal">if</code> block checks whether the right-hand side of the ball is greater than the far left corner of the racket, and whether it is touching it. Using the AND operator (<code class="literal">&amp;&amp;</code>), the block verifies that the ball's left edge is not past the far right of the racket. If this condition is true, we definitely have a hit and can think about how to handle the rebound:</p><div><pre class="programlisting">if (ballPosition.x + ballWidth &gt; (racketPosition.x - halfRacket)
  &amp;&amp; ballPosition.x - ballWidth &lt; (racketPosition.x + halfRacket)) {</pre></div><p>The first bit of code inside the <code class="literal">if</code> block, which determined a definite hit, is simple. Play a sound, increase the score, and set the ball on an upwards trajectory, like this:</p><div><pre class="programlisting">//rebound the ball vertically and play a sound
                    soundPool.play(sample3, 1, 1, 0, 0, 1);
                    score++;
                    ballIsMovingUp = true;
                    ballIsMovingDown = false;</pre></div><p>Now we have an <code class="literal">if</code>-<code class="literal">else</code> condition, which simply checks whether the left-hand edge of the ball is past the <a class="indexterm" id="id630"/>center of the racket. If it is, we send the ball to the right. Otherwise, we send the ball to the left:</p><div><pre class="programlisting">                    //now decide how to rebound the ball horizontally
                    if (ballPosition.x &gt; racketPosition.x) {
                        ballIsMovingRight = true;
                        ballIsMovingLeft = false;

                    } else {
                        ballIsMovingRight = false;
                        ballIsMovingLeft = true;
                    }

                }
            }
        }</pre></div></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec81"/>Phase 3 – SquashCourtView part 2</h2></div></div></div><p>In this <a class="indexterm" id="id631"/>phase, we will complete our <code class="literal">SquashCourtView</code> class. There are two methods remaining that are called from the <code class="literal">run</code> method, <code class="literal">drawCourt</code> and <code class="literal">controlFPS</code>. Then there are a few short methods to interact with the Android lifecycle methods that we will implement in the fourth and final phase:</p><div><ol class="orderedlist arabic"><li class="listitem">Here is the code that draws, in the following order, the text at the top of the screen, the ball, and the bat. All is contained within the <code class="literal">drawCourt</code> method, which is called from the <code class="literal">run</code> method, right after the call to <code class="literal">updateCourt</code>. Here is the code for <code class="literal">drawCourt</code>. Type the following code before the closing curly brace of the <code class="literal">SquashCourtView</code> class:<div><pre class="programlisting">public void drawCourt() {

            if (ourHolder.getSurface().isValid()) {
                canvas = ourHolder.lockCanvas();
                //Paint paint = new Paint();
                canvas.drawColor(Color.BLACK);//the background
                paint.setColor(Color.argb(255, 255, 255, 255));
                paint.setTextSize(45);
                canvas.drawText("Score:" + score + " Lives:" + lives + " fps:" + fps, 20, 40, paint);


                //Draw the squash racket
                canvas.drawRect(racketPosition.x - (racketWidth / 2),
                  racketPosition.y - (racketHeight / 2), racketPosition.x + (racketWidth / 2),
                      racketPosition.y + racketHeight, paint);

                //Draw the ball
                canvas.drawRect(ballPosition.x, ballPosition.y,
                        ballPosition.x + ballWidth, ballPosition.y + ballWidth, paint);


                ourHolder.unlockCanvasAndPost(canvas);
            }

        }</pre></div></li><li class="listitem">And now the <code class="literal">controlFPS</code> method locks our frame rate to something smooth and <a class="indexterm" id="id632"/>consistent. We will soon go through its exact working. Type the following code after the code in the previous step:<div><pre class="programlisting">public void controlFPS() {
            long timeThisFrame = (System.currentTimeMillis() - lastFrameTime);
            long timeToSleep = 15 - timeThisFrame;
            if (timeThisFrame &gt; 0) {
                fps = (int) (1000 / timeThisFrame);
            }
            if (timeToSleep &gt; 0) {

                try {
                    ourThread.sleep(timeToSleep);
                } catch (InterruptedException e) {
                }
                
            }

            lastFrameTime = System.currentTimeMillis();
        }</pre></div></li><li class="listitem">Next, we write the code for <code class="literal">pause</code> and <code class="literal">resume</code>. These are called by their related Android lifecycle methods (<code class="literal">onPause</code> and <code class="literal">onResume</code>). We ensure that our thread is ended or started safely when the player has finished or resumed our game, respectively. Now type this code after the code in the previous step:<div><pre class="programlisting">public void pause() {
            playingSquash = false;
            try {
                ourThread.join();
            } catch (InterruptedException e) {
            }

        }

        public void resume() {
            playingSquash = true;
            ourThread = new Thread(this);
            ourThread.start();
        }</pre></div></li><li class="listitem">Finally, we have the method that controls what happens when the player touches our <a class="indexterm" id="id633"/>customized <code class="literal">SurfaceView</code>. Remember that when we discussed the design of the game, we said that a press anywhere on the left of the screen would move the racket to the left, and a press anywhere on the right will move the racket to the right. Type the following code after the code in the preceding step:<div><pre class="programlisting">@Override
        public boolean onTouchEvent(MotionEvent motionEvent) {

            switch (motionEvent.getAction() &amp; MotionEvent.ACTION_MASK) {
                case MotionEvent.ACTION_DOWN:

                    if (motionEvent.getX() &gt;= screenWidth / 2) {
                        racketIsMovingRight = true;
                        racketIsMovingLeft = false;
                    } else {
                        racketIsMovingLeft = true;
                        racketIsMovingRight = false;
                    }

                    break;


                case MotionEvent.ACTION_UP:
                    racketIsMovingRight = false;
                    racketIsMovingLeft = false;
                    break;
            }
            return true;
        }


    }</pre></div></li></ol></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec49"/>Phase 3 code explained</h3></div></div></div><p>In step 1, we <a class="indexterm" id="id634"/>do all the drawing. We have seen what all the different drawing methods of the <code class="literal">Canvas</code> class can do, and their names are self-explanatory as well. However, the manner in which we arrived at the coordinates needs some explanation. First, inside <code class="literal">drawCourt</code>, we use <code class="literal">ourHolder</code> to get a drawing surface, and we check its validity (usability). Then we initialize our <code class="literal">canvas</code> and <code class="literal">paint</code> objects:</p><div><pre class="programlisting">public void drawCourt() {

            if (ourHolder.getSurface().isValid()) {
                canvas = ourHolder.lockCanvas();
                //Paint paint = new Paint();</pre></div><p>Next, we clear the screen from the previous frame of drawing:</p><div><pre class="programlisting">       canvas.drawColor(Color.BLACK);//the background</pre></div><p>Now we set the paint color to white:</p><div><pre class="programlisting">        paint.setColor(Color.argb(255, 255, 255, 255));</pre></div><p>This is new but simple to explain—we set a size for our text:</p><div><pre class="programlisting">                paint.setTextSize(45);</pre></div><p>Now we can draw a line of text at the top of the screen. It shows the <code class="literal">score</code> and <code class="literal">lives</code> variables. We have already seen how to control their values. It also shows the value of the <code class="literal">fps</code> variable. We will see how we can assign a value to that when we look at the next method, <code class="literal">controlFPS</code>:</p><div><pre class="programlisting">  canvas.drawText("Score:" + score + " Lives:" + lives + " fps:" +fps, 20, 40, paint);</pre></div><p>Then we draw the racket. Notice that we calculate the <code class="literal">x</code> start position by subtracting half the racket width from <code class="literal">racketPosition.x</code>, and the <code class="literal">x</code> end position by adding the width to <code class="literal">x</code>. This makes our collision detection code simple because <code class="literal">racketPosition.x</code> refers to the center of the racket:</p><div><pre class="programlisting">//Draw the squash racket
  canvas.drawRect(racketPosition.x - (racketWidth / 2),
                  racketPosition.y - (racketHeight / 2), 
                  racketPosition.x + (racketWidth / 2),
                  racketPosition.y + racketHeight, paint);</pre></div><p>Next, we draw <a class="indexterm" id="id635"/>the ball. Notice that the starting <em>x</em> and <em>y</em> coordinates are the same as the values held in <code class="literal">ballPosition.x</code> and <code class="literal">ballPosition.y</code>. Therefore, these coordinates correspond to the top-left corner of the ball. This is just what we need for our simple collision detection code:</p><div><pre class="programlisting">                //Draw the ball
                canvas.drawRect(ballPosition.x, ballPosition.y,
                  ballPosition.x + ballWidth, ballPosition.y + ballWidth, paint);</pre></div><p>This final line draws what we have just done to the screen:</p><div><pre class="programlisting">                ourHolder.unlockCanvasAndPost(canvas);
            }

        }</pre></div><p>In step 2, we essentially pause the game. We want to decide the number of times we recalculate the position of our objects and redraw them. Here is how it works.</p><p>First, we enter the <code class="literal">controlFPS</code> method when it is called from the <code class="literal">run</code> method. We declare and initialize a <code class="literal">long</code> variable with the time in milliseconds, and then take away the time that the last frame took in milliseconds. The time is calculated in the previous run through this method, at the end, as we will see:</p><div><pre class="programlisting">public void controlFPS() {
long timeThisFrame = (System.currentTimeMillis() - lastFrameTime);</pre></div><p>We then calculate how long we want to pause between frames, and initialize that value to <code class="literal">timeToSleep</code>, a new long variable. Here is how the calculation works: 15 milliseconds of pause gives us around 60 frames per second, which works well for our game and provides a very smooth animation. Therefore, <code class="literal">15 - timeThisFrame</code> equals the number of milliseconds we should pause for to make the frame last for 15 milliseconds:</p><div><pre class="programlisting">long timeToSleep = 15 - timeThisFrame; </pre></div><p>Of course, some <a class="indexterm" id="id636"/>devices will not cope with this speed. Neither do we want to pause for a negative number, nor do we want to calculate the frames per second when <code class="literal">timeThisFrame</code> is equal to zero. Next, we wrap the calculation of frames per second within an <code class="literal">if</code> statement that prevents us from dividing by zero or a negative number:</p><div><pre class="programlisting">            if (timeThisFrame &gt; 0) {
                fps = (int) (1000 / timeThisFrame);
            }</pre></div><p>Likewise, we wrap the instruction to our thread to pause within a similar cautionary <code class="literal">if</code> statement:</p><div><pre class="programlisting">            if (timeToSleep &gt; 0) {

                try {
                    ourThread.sleep(timeToSleep);
                } catch (InterruptedException e) {
                }
                
            }</pre></div><p>Finally, we see how we initialize <code class="literal">lastFrameTime</code>, ready for the next time <code class="literal">controlFPS</code> is called:</p><div><pre class="programlisting">            lastFrameTime = System.currentTimeMillis();
        }</pre></div><p>In step 3, we quickly implement two methods. They are <code class="literal">pause</code> and <code class="literal">resume</code>. These are not to be confused with the Android Activity lifecycle methods called <code class="literal">onPause</code> and <code class="literal">onResume</code>. However, the <code class="literal">pause</code> and <code class="literal">resume</code> methods are called from their near-namesakes. They handle stopping and starting <code class="literal">ourThread</code>, respectively. We should always clean up our threads. Otherwise, they can keep running even after the activity has finished:</p><div><pre class="programlisting">public void pause() {
            playingSquash = false;
            try {
                ourThread.join();
            } catch (InterruptedException e) {
            }

        }

        public void resume() {
            playingSquash = true;
            ourThread = new Thread(this);
            ourThread.start();
        }</pre></div><p>In step 4, we handle touches on the screen. This is how we initialize our <code class="literal">racketIsMovingLeft</code> and <code class="literal">racketIsMovingRight</code> Boolean variables, which the <code class="literal">updateCourt</code> method uses to decide whether to slide the player's racket left or right, or to keep it still. We have talked about the <code class="literal">onTouchEvent</code> method before, but let's see how we set the values in those variables.</p><p>First, we override <a class="indexterm" id="id637"/>the method and switch to get the type of event and the <em>x</em>, <em>y</em> coordinates of the event:</p><div><pre class="programlisting">@Override
    public boolean onTouchEvent(MotionEvent motionEvent) {

    switch (motionEvent.getAction() &amp; MotionEvent.ACTION_MASK) {</pre></div><p>If the event type is <code class="literal">ACTION_DOWN</code>, that is, the screen has been touched, we enter this case:</p><div><pre class="programlisting">    case MotionEvent.ACTION_DOWN:</pre></div><p>Then we handle the coordinates. If the player has touched a position on the screen with an x coordinate greater than <code class="literal">screenWidth / 2</code>, then it means they have touched the right-hand side of the screen, so we set <code class="literal">isMovingRight</code> to <code class="literal">true</code> and <code class="literal">isMovingLeft</code> to <code class="literal">false</code>. The <code class="literal">updateCourt</code> method will handle changes in the necessary coordinates, and the <code class="literal">drawCourt</code> method will draw the racket in the appropriate place:</p><div><pre class="programlisting">    if (motionEvent.getX() &gt;= screenWidth / 2) {
        racketIsMovingRight = true;
        racketIsMovingLeft = false;</pre></div><p>The <code class="literal">else</code> statement sets our two Boolean variables in the opposite manner because a touch must have occurred on the left of the screen:</p><div><pre class="programlisting">                } else {
                    racketIsMovingLeft = true;
                    racketIsMovingRight = false;
                }

                    break;</pre></div><p>Now we handle the case for the <code class="literal">ACTION_UP</code> event. But why do we care about two events? With the buttons, we just cared about a click and that was all, but by handling the <code class="literal">ACTION_UP</code> event, we can enable the functionality that allows our player to hold the screen to slide left <a class="indexterm" id="id638"/>or right, just as we discussed in the section <em>The design of the game</em> of this chapter. Thus, the <code class="literal">ACTION_DOWN</code> case sets the racket moving one way or the other, and the <code class="literal">ACTION_UP</code> case simply stops the slide completely:</p><div><pre class="programlisting">                case MotionEvent.ACTION_UP:
                    racketIsMovingRight = false;
                    racketIsMovingLeft = false;
                    break;
            }
            return true;
        }


    }</pre></div><p>Notice that we don't care about the <em>y</em> coordinate. Anywhere on the left we go left, anywhere on the right we go right.</p><div><div><h3 class="title"><a id="note31"/>Note</h3><p>Notice also that all of the code will work whether a device is held in the portrait or landscape form, and will function the same regardless of the resolution of the device. However (and it is quite an important "however"), the game will be slightly harder on low-resolution screens. The solution to this problem is quite complicated and will not be discussed until the final chapter, but it might well help us make some decisions about the future path to learn Android, gaming, and Java.</p></div></div></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec82"/>Phase 4 – Remaining lifecycle methods</h2></div></div></div><p>We are nearly <a class="indexterm" id="id639"/>there; just a few more steps and we will have a working retro squash game. I can almost smell the nostalgia! As these remaining methods are quite straightforward, we will explain them as we write them:</p><div><ol class="orderedlist arabic"><li class="listitem">As we previously learned, the <code class="literal">onStop</code> method is called by the Android system when the app is stopped. It is implemented for us already. The only reason we override it here is to ensure that our thread is stopped. We do so with the line highlighted. Enter the following code before the closing curly brace of the <code class="literal">MainActivity</code> class:<div><pre class="programlisting">@Override
    protected void onStop() {
        super.onStop();

        while (true) {
            <strong>squashCourtView.pause();</strong>
            break;
        }

        finish();
    }</pre></div></li><li class="listitem">The <code class="literal">onPause</code> method is called by the Android system when the app is paused. This too is implemented for us already, and the only reason we override it here is to ensure that our thread is stopped. We do so with the line highlighted. Enter this code after the preceding code:<div><pre class="programlisting">@Override
    protected void onPause() {
        super.onPause();
        <strong>squashCourtView.pause();</strong>
    }</pre></div></li><li class="listitem">The <code class="literal">onResume</code> method is called by the Android system when the app is resumed. Again, this method is implemented for us already. The only reason we override it <a class="indexterm" id="id640"/>here is to ensure that our thread is resumed, and we do so with the line highlighted. Enter the following code after the code in the previous step:<div><pre class="programlisting">@Override
    protected void onResume() {
        super.onResume();
        <strong>squashCourtView.resume();</strong>
    }</pre></div></li><li class="listitem">Finally, we do something completely new. We handle what happens should the player press the back button on their device. As you might have guessed, there is a method we can override to achieve this— <code class="literal">onKeyDown</code>. We pause our thread, just as we did in the overridden lifecycle methods, and then call <code class="literal">finish()</code>, which ends the activity and our app. Enter this code after the code in the previous step:<div><pre class="programlisting">public boolean onKeyDown(int keyCode, KeyEvent event) {
        if (keyCode == KeyEvent.KEYCODE_BACK) {
            squashCourtView.pause();
            finish();
            return true;
        }
        return false;
    }</pre></div></li></ol></div><p>We covered the code <a class="indexterm" id="id641"/>in this phase as we went through it, and this was the shortest phase so far. So why didn't we encapsulate everything?</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec83"/>Good object-oriented design</h2></div></div></div><p>Perhaps simple <a class="indexterm" id="id642"/>games are not the best way to demonstrate good object-oriented design in action, but a simple code design with fewer private variables actually enhances the project. It certainly makes the teaching aspects of coding games simpler to explain.</p><p>However, when a game becomes more complex and more people work on the code, principles of object-oriented programming become more necessary.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec55"/>Self-test questions</h1></div></div></div><p>Q1) Can you explain how to make ball speed relative between different screen resolutions?</p></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec56"/>Summary</h1></div></div></div><p>I hope you enjoyed animating your first game. You achieved a lot to get to this point. You learned not only all the Java topics but also the way the different classes of Android can be used to make games relatively simple.</p><p>In the next chapter, we will move on to a new, more complex game. I hope you are ready.</p></div>
<div><div><div><div><h1 class="title"><a id="ch08"/>Chapter 8. The Snake Game</h1></div></div></div><p>In this chapter, we will get straight down to designing and implementing a clone of the highly addictive <em>Snake</em> game. We will look at the design of the game and learn how to animate some bitmaps. Then we will look at a few aspects of the code that are new, such as our coordinate system. After that, we will whiz through the implementation of the game. Finally, we will look at how we could enhance our game.</p><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Examine the design of our game</li><li class="listitem" style="list-style-type: disc">Look at the coordinate system of our <em>Snake</em> game</li><li class="listitem" style="list-style-type: disc">Examine the code structure so that when we come to implement the game, it will be more straightforward</li><li class="listitem" style="list-style-type: disc">Learn about animation with sprite sheets at the same time as implementing the home screen of our game</li><li class="listitem" style="list-style-type: disc">Break the code for the <em>Snake</em> game into manageable chunks and run through its full implementation</li><li class="listitem" style="list-style-type: disc">Enhance the game a little</li></ul></div><div><div><div><div><h1 class="title"><a id="ch08lvl1sec57"/>Game design</h1></div></div></div><p>If you haven't <a class="indexterm" id="id643"/>played the excellent <em>Snake</em> game before, here is an explanation of how it works. You control a very small snake. In our version, there is just a head, one body segment, and a tail. Here is a screenshot of our snake, made out of three segments:</p><div><img alt="Game design" src="img/8859OS_08_01.jpg"/></div><p>The following screenshot shows the three segments individually:</p><div><img alt="Game design" src="img/8859OS_08_02.jpg"/></div><p>Now, here is the <a class="indexterm" id="id644"/>thing; our snake is very hungry and also a very quick grower. Every time he eats an apple, he grows a body segment. This is a screenshot of the apple:</p><div><img alt="Game design" src="img/8859OS_08_03.jpg"/></div><p>Life is great! Our snake just eats and grows! The problem that the player of our game needs to solve is that the snake is a little hyperactive. It never stops moving! What exacerbates this problem is that if the snake touches the side of the screen, it dies.</p><p>At first, this doesn't seem like too much of a problem, but as he grows longer and longer, he can't just keep going around in circles because he will bump inevitably into himself. This would again <a class="indexterm" id="id645"/>result in his demise:</p><div><img alt="Game design" src="img/8859OS_08_04.jpg"/></div><p>For each apple eaten, we add an increasingly large amount to the score. Here is a sneak peek at what the game will look like after the basic implementation and before the enhancements:</p><div><img alt="Game design" src="img/8859OS_08_08.jpg"/></div><p>The player controls the snake by tapping on the left or the right side of the screen. The snake will respond by turning left or right. The turn directions are relative to the direction the snake is traveling, which adds to the challenge because the player needs to think like a snake—kind of!</p><p>At the end of the chapter, we will also take a brief look at enhancing the game, use that enhanced version in the <a class="indexterm" id="id646"/>next chapter to publish it to the Google Play Store, and add leaderboards and achievements.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec58"/>The coordinate system</h1></div></div></div><p>In the previous <a class="indexterm" id="id647"/>chapter, we drew all our game objects directly <a class="indexterm" id="id648"/>to points on the screen, and we used real screen coordinates to detect collisions, bounces, and so on. This time, we will be doing things slightly differently. This is partly out of necessity, but as we will see, collision detection and keeping track of our game objects will also get simpler. This might be surprising when we think about the potential of our snake to be many blocks long.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec84"/>Keeping track of the snake segments</h2></div></div></div><p>To keep track <a class="indexterm" id="id649"/>of all the snake segments, we will first define a block size to define a portion of a grid for the entire game area. Every game <a class="indexterm" id="id650"/>object will reside at an (x,y) coordinate, based not on the pixel resolution of the screen but on a position within our virtual grid. In the game, we define a grid that is 40 blocks wide, like this:</p><div><pre class="programlisting">//Determine the size of each block/place on the game board
 blockSize = screenWidth/40;</pre></div><p>So we know that:</p><div><pre class="programlisting">numBlocksWide = 40;</pre></div><p>The height of the game screen in blocks will then simply be calculated by dividing the height of the screen in pixels by the previously determined value of <code class="literal">blockSize</code> minus a bit of space at the top for the score:</p><div><pre class="programlisting">numBlocksHigh = ((screenHeight - topGap ))/blockSize;</pre></div><p>This then allows us to keep track of our snake using two arrays for <em>x</em> and <em>y</em> coordinates, where element zero is the head and the last used element is the tail, a bit like this:</p><div><pre class="programlisting">//An array for our snake
snakeX = new int[200];
snakeY = new int[200];</pre></div><p>As long as we have a system for moving the head, perhaps something similar to the squash ball but based on our new game grid, we can do the following to make the body follow the head:</p><div><pre class="programlisting">//move the body starting at the back
for(int i = snakeLength; i &gt;0 ; i--){
  snakeX[i] = snakeX[i-1];
  snakeY[i] = snakeY[i-1];
}</pre></div><p>The previous code simply starts at the back section of the snake and creates its location in the grid irrespective of what the section in front of it was. It proceeds up the body doing the same until everything has been moved to the location of the section that used to be just ahead of it.</p><p>This also makes <a class="indexterm" id="id651"/>collision detection (even for a very <a class="indexterm" id="id652"/>long snake) nice and easy.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec85"/>Detecting collisions</h2></div></div></div><p>Using our grid based on <code class="literal">blockSize</code>, we can detect a collision, for example, with the right side of the screen, like this:</p><div><pre class="programlisting">if(snakeX[0] &gt;= numBlocksWide)dead=true;</pre></div><p>The previous <a class="indexterm" id="id653"/>code simply checks whether the first element of our array, which holds the <em>x</em> coordinate of the snake, is equal to or greater than the width of our game grid in blocks. Try to work out the code for collision with the left, top, and bottom before we see it during the implementation.</p><p>Detecting the event of the snake bumping into itself is quick too. We just need to check whether the first element of our array (the head) is in exactly the same position as any of the other sections, like this:</p><div><pre class="programlisting">//Have we eaten ourselves?
for (int i = snakeLength-1; i &gt; 0; i--) {
  if ((i &gt; 4) &amp;&amp; (snakeX[0] == snakeX[i]) &amp;&amp; (snakeY[0] == snakeY[i])) {
    dead = true;
    }
}</pre></div></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec86"/>Drawing the snake</h2></div></div></div><p>We simply draw <a class="indexterm" id="id654"/>every section of the snake relative to its grid location multiplied by the size in pixels of a block. The <code class="literal">blockSize</code> variable handles the entire challenge of making the game work on different screen sizes, like this:</p><div><pre class="programlisting">//loop through every section of the snake and draw it
//a block at a time.
canvas.drawBitmap(bodyBitmap, snakeX[i]*blockSize, (snakeY[i]*blockSize)+topGap, paint);</pre></div><p>Admittedly, there are probably more questions about how our implementation will work, but they are probably best answered by actually building the game.</p><p>Thus, we can easily follow along by either writing the code or just reading from the completed project. Let's take a look at the overall structure of our code.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec59"/>The code structure</h1></div></div></div><p>We will have two <a class="indexterm" id="id655"/>activities, one for the menu screen and one for the game screen. The menu screen activity will be called <code class="literal">MainActivity</code>, and the game screen <a class="indexterm" id="id656"/>activity will be called <code class="literal">GameActivity</code>. You can find all the completed code files as well as all the assets such as images, sprite sheets, and sound files in the <code class="literal">Chapter8/Snake</code> folder in the download bundle.</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec87"/>MainActivity</h2></div></div></div><p>In contrast to our <a class="indexterm" id="id657"/>other projects, the menu screen will not have a UI designed in the Android Studio UI designer. It will consist of an animated snake head, a title, and a high score. The player will proceed to <code class="literal">GameActivity</code> by tapping <a class="indexterm" id="id658"/>anywhere on the screen. As we need to accomplish animations and user interactions, even the home screen will have a thread, a view object, and methods normally associated with our game screens, like this:</p><div><pre class="programlisting">MainActivity.java file
    Imports
    MainActivity class
        Declare some variables and objects
        onCreate
        SnakeAnimView class
            Constructor
            Run method
            Update method
            Draw method
            controlFPS method
            pause method
            resume method
            onTouchEvent method
        onStop method
        onResume method
        onPause method
        onKeyDown method</pre></div><p>We will not go deeper <a class="indexterm" id="id659"/>into the menu screen for now because at the <a class="indexterm" id="id660"/>end of this section, we will implement it line by line.</p></div><div><div><div><div><h2 class="title"><a id="ch08lvl2sec88"/>GameActivity</h2></div></div></div><p>The game screen <a class="indexterm" id="id661"/>structure has many similarities to our Squash game and to the structure of the menu screen, although the internals of this structure vary a <a class="indexterm" id="id662"/>lot (as we have discussed and as we will see). There are some differences towards the end of the structure, most notably, a <code class="literal">loadSound</code> method and a <code class="literal">configureDisplay</code> method. Here is the structure (we will see afterwards why the two extra methods are there):</p><div><pre class="programlisting">MainActivity.java file
    Imports
    GameActivity class
        Declare some variables and objects
        onCreate
        SnakeView class
            Constructor
            getSnake method
            getApple method
            Run method
            updateGame method
            drawGame method
            controlFPS method
            pause method
            resume method
            onTouchEvent method
        onStop method
        onResume method
        onPause method
        onKeyDown method
        loadSOund method
        configureDisplay method</pre></div><div><div><div><div><h3 class="title"><a id="ch08lvl3sec50"/>Tidying up onCreate</h3></div></div></div><p>One of the <a class="indexterm" id="id663"/>first things you might notice when you examine the code from the <code class="literal">GameActivity</code> class we will soon implement is just how short the <code class="literal">onCreate</code> method is:</p><div><pre class="programlisting">@Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        loadSound();
        configureDisplay();
        snakeView = new SnakeView(this);
        setContentView(snakeView);

    }</pre></div><p>We have written <a class="indexterm" id="id664"/>two methods, <code class="literal">loadSound</code> and <code class="literal">configureDisplay</code>. They do most of the initialization and setup present in our squash game. This makes our code less cluttered. All that is left in <code class="literal">onCreate</code> is the initialization of our <code class="literal">SnakeView</code> <a class="indexterm" id="id665"/>object and a call to <code class="literal">setContentView</code>.</p><p>We will look in detail at our <code class="literal">loadSound</code> and <code class="literal">configureDisplay</code> methods when we implement them.</p><p>As we have had <a class="indexterm" id="id666"/>advanced sight of the structure as well as previous experience of this type of implementation, we will just go through all of the implementation of our game activity in one phase.</p><p>Let's quickly implement the menu screen.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec60"/>Animation, sprite sheets, and the Snake home screen</h1></div></div></div><p>In the <a class="indexterm" id="id667"/>previous chapter, we used a bitmap to draw text, a circle, a line, and a single pixel on the blank bitmap we created in Java code. We then displayed the bitmap with all of its doodling using the <code class="literal">Canvas</code> class. Now we will look at a technique to <a class="indexterm" id="id668"/>draw two dimensional images, sometimes referred to as sprites. These are made from predrawn images. The images can be as simple as <a class="indexterm" id="id669"/>a plain pong ball or as complex as a glorious two-dimensional <a class="indexterm" id="id670"/>character with muscle definition, elaborate clothing, weapons, and hair.</p><p>So far, we have animated with unchanging objects, that is, we have moved a static unchanging image around the screen. In this section, we will see how to not only display a predrawn bitmap image on the screen but also continually alter it to create the illusion of on-the-spot animation.</p><p>Of course, the ultimate combination would be to animate the bitmap both by changing its image and moving it around at the same time. We will see that briefly when we look at an enhanced version of this chapter's <em>Snake</em> game, but will not be analyzing the code.</p><p>To do this on-the-spot bitmap animation, we need some bitmaps, as you might expect. For example, to <a class="indexterm" id="id671"/>draw a snake's tail swishing back and forth, we would <a class="indexterm" id="id672"/>need at least two frames of animation, showing the tail in <a class="indexterm" id="id673"/>different positions. In the following screenshot, the <a class="indexterm" id="id674"/>flower's head is towards the left:</p><div><img alt="Animation, sprite sheets, and the Snake home screen" src="img/8859OS_08_05.jpg"/></div><p>In this screenshot, the flower has been flipped:</p><div><img alt="Animation, sprite sheets, and the Snake home screen" src="img/8859OS_08_06.jpg"/></div><p>If the two bitmaps were shown one after the other, repeatedly, they would create the basic effect of a flower <a class="indexterm" id="id675"/>blowing in the wind. Of course, two frames of animation aren't going to contest for any animation awards, and there is another problem with these images as well, as we will learn, so we should add in more frames to make the animation as life-like as is practical.</p><p>We have just one <a class="indexterm" id="id676"/>more thing to discuss before we make an animated <a class="indexterm" id="id677"/>snake head for our game's home screen. How do we <a class="indexterm" id="id678"/>get Android to switch between these bitmaps?</p><div><div><div><div><h2 class="title"><a id="ch08lvl2sec89"/>Animating with sprite sheets</h2></div></div></div><p>Firstly, we need to <a class="indexterm" id="id679"/>present the frames in a manner that is easy to manipulate in code. This is where sprite sheets come in. The following image shows <a class="indexterm" id="id680"/>some frames from a basic snake head animation that we will use on our game home screen. This time, they are presented in a strip of frames. All of them are parts of the same image, a bit like a series of images in a film. Also, notice in the following image that the frames are centered relative to each other and are exactly equal in size:</p><div><img alt="Animating with sprite sheets" src="img/8859OS_08_07.jpg"/></div><p>If we were to actually show the two previous flower images consecutively, they would not only would they sway but also jump around from one side to another on their stems, which is probably not the effect we were looking for.</p><p>Thus, with regard to the snake sprite sheet, as long as we show one frame after another, we will create a basic animation.</p><p>So how do we make our code jump from one part of the sprite sheet to the next? Each frame is exactly the same size, 64 x 64 pixels in this case, so we just need a way to display pixels from 0 to 63, then 64 to 127, then 128 to 192, and so on. As each frame of the sprite sheet image is subtly different, it allows us to use one image file with multiple frames to create our animation. Fortunately, we have a class to handle this, which is nothing quite as <a class="indexterm" id="id681"/>luxurious as a specific sprite sheet class but almost.</p><div><div><h3 class="title"><a id="tip55"/>Tip</h3><p>Regarding sprite sheet classes, such a thing does exist, although not in the regular Android classes. An API specifically designed for two-dimensional games will usually contain classes for sprite sheets. We will look at examples of this in the next chapter.</p></div></div><p>The <code class="literal">Rect</code> class holds the coordinates of a rectangle. Here, we create a new object of the <code class="literal">Rect</code> type, and initialize it to start at 0, 0 and end at 63, 63:</p><div><pre class="programlisting">Rect rectToBeDrawn = new Rect(0, 0, 63, 63);</pre></div><p>The <code class="literal">Canvas</code> class can then actually use our <code class="literal">Rect</code> object to define a portion of a previously loaded bitmap:</p><div><pre class="programlisting">canvas.drawBitmap(headAnimBitmap, rectToBeDrawn, destRect, paint);</pre></div><p>The preceding code is much simpler than it looks. First, we see <code class="literal">canvas.drawBitmap</code>. We are using the <code class="literal">drawBitmap</code> method of the <code class="literal">Canvas</code> class just as we have before. Then we pass <code class="literal">headAnimBitmap</code>, which is our sprite sheet containing all the frames we want to animate, as an argument. Rect <code class="literal">rectToBeDrawn</code> represents the coordinates of the currently relevant frame within <code class="literal">headAnimationBitmap</code>. <code class="literal">destRect</code> simply represents the screen coordinates at which we want to draw the current frame, and of course, <code class="literal">paint</code> is our object of the <code class="literal">Paint</code> class.</p><p>All we have to do <a class="indexterm" id="id682"/>now is change the coordinates of <code class="literal">rectToBeDrawn</code> and control the frame rate with a thread and we are done! Let's do that and create an animated home screen for our <em>Snake</em> game.</p><div><div><div><div><h3 class="title"><a id="ch08lvl3sec51"/>Implementing the Snake home screen</h3></div></div></div><p>With the <a class="indexterm" id="id683"/>background information we just covered and our detailed look at the structure of the code we are about to write, there shouldn't be any surprises <a class="indexterm" id="id684"/>in this code. We will break things up into chunks just to make sure we follow exactly what is going on:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new project of API level 13. Call it <code class="literal">Snake</code>.</li><li class="listitem">Make the activity full screen as we have done before, and put your graphics into the <code class="literal">drawable/mdpi</code> folder. Of course, you can use my graphics as usual. They are supplied in the code download in the <code class="literal">graphics</code> folder of the <code class="literal">Snake</code> project.</li><li class="listitem">Here, you will find our <code class="literal">MainActivity</code> class declaration and member variables. Notice the variables for our <code class="literal">Canvas</code> and <code class="literal">Bitmap</code> class as well, we are declaring variables to hold frame size (width and height) as well as the number of frames. We also have a <code class="literal">Rect</code> object to hold the coordinates of the current frame of the sprite sheet. We will see these variables in action soon. Type the following code:<div><pre class="programlisting">public class MainActivity extends Activity {

    Canvas canvas;
    SnakeAnimView snakeAnimView;

    //The snake head sprite sheet
    Bitmap headAnimBitmap;
    //The portion of the bitmap to be drawn in the current frame
    Rect rectToBeDrawn;
    //The dimensions of a single frame
    int frameHeight = 64;
    int frameWidth = 64;
    int numFrames = 6;
    int frameNumber;

    int screenWidth;
    int screenHeight;

    //stats
    long lastFrameTime;
    int fps;
    int hi;

    //To start the game from onTouchEvent
    Intent i;</pre></div></li><li class="listitem">The following is the implementation of the overridden <code class="literal">onCreate</code> method. We get the <a class="indexterm" id="id685"/>screen dimensions in the usual way. We load our sprite sheet into the <code class="literal">headAnimBitmap</code> Bitmap. Finally, we create a new <code class="literal">SnakeAnimView</code> and set it as the content view. Type the following code after the code from the previous step:<div><pre class="programlisting">@Override
    protected void onCreate(Bundle savedInstanceState) {
      super.onCreate(savedInstanceState);

        //find out the width and height of the screen
        Display display = getWindowManager().getDefaultDisplay();
        Point size = new Point();
        display.getSize(size);
        screenWidth = size.x;
        screenHeight = size.y;

        headAnimBitmap = BitmapFactory.decodeResource(getResources(), R.drawable.head_sprite_sheet);

        
        snakeAnimView = new SnakeAnimView(this);
        setContentView(snakeAnimView);

        i = new Intent(this, GameActivity.class);

    }</pre></div></li><li class="listitem">Here is the declaration of our <code class="literal">SurfaceView</code> class, called <code class="literal">SnakeAnimView</code>, along with its member variables. Notice that it extends <code class="literal">SurfaceView</code> and implements <code class="literal">Runnable</code>. All its methods follow in the next steps. Type this code <a class="indexterm" id="id686"/>after the code from the preceding <a class="indexterm" id="id687"/>step:<div><pre class="programlisting">class SnakeAnimView extends SurfaceView implements Runnable {
        Thread ourThread = null;
        SurfaceHolder ourHolder;
        volatile boolean playingSnake;
        Paint paint;</pre></div></li><li class="listitem">Here is the constructor that gets the <code class="literal">frameWidth</code> value by dividing the bitmap width by the number of frames, and the <code class="literal">frameHeight</code> value using the <code class="literal">getHeight</code> method. Type this code after the code from the previous step:<div><pre class="programlisting">public SnakeAnimView(Context context) {
    super(context);
    ourHolder = getHolder();
    paint = new Paint();
    frameWidth = headAnimBitmap.getWidth()/numFrames;
    frameHeight = headAnimBitmap.getHeight();
}</pre></div></li><li class="listitem">Now we implement the short but crucial <code class="literal">run</code> method. It calls each of the key methods of this class one after the other. These three methods are implemented in the following three steps after this step. Type the following code after the code from the preceding step:<div><pre class="programlisting">@Override
        public void run() {
            while (playingSnake) {
                update();
                draw();
                controlFPS();

            }

        }</pre></div></li><li class="listitem">Here is the <code class="literal">update</code> method. It tracks and chooses the frame number that needs to be displayed. Each time through the <code class="literal">update</code> method, we calculate the coordinates of the sprite sheet to be drawn using <code class="literal">frameWidth</code>, <code class="literal">frameHeight</code>, and <code class="literal">frameNumber</code>. If you are wondering why we subtract <code class="literal">1</code> from <a class="indexterm" id="id688"/>each horizontal coordinate, it is <a class="indexterm" id="id689"/>because like the screen coordinates, bitmaps start their coordinates at 0, 0:<div><pre class="programlisting">public void update() {

  //which frame should we draw
  rectToBeDrawn = new Rect((frameNumber * frameWidth)-1, 0,(frameNumber * frameWidth +frameWidth)-1, frameHeight);

  //now the next frame
  frameNumber++;

  //don't try and draw frames that don't exist
  if(frameNumber == numFrames){
    frameNumber = 0;//back to the first frame
  }
}</pre></div></li><li class="listitem">Next is the <code class="literal">draw</code> method, which does nothing new until the end, when it calculates the place on the screen to draw the bitmap by dividing the <code class="literal">screenHeight</code> and <code class="literal">screenWidth</code> variables by 2. These coordinates are then saved in <code class="literal">destRect</code>. Both <code class="literal">destRect</code> and <code class="literal">rectToDraw</code> are then passed to the <code class="literal">drawBitmap</code> method, which draws the frame required at the location required. Type this <a class="indexterm" id="id690"/>code after the code from the previous step:<div><pre class="programlisting">public void draw() {

            if (ourHolder.getSurface().isValid()) {
                canvas = ourHolder.lockCanvas();
                //Paint paint = new Paint();
                canvas.drawColor(Color.BLACK);//the background
                paint.setColor(Color.argb(255, 255, 255, 255));
                paint.setTextSize(150);
                canvas.drawText("Snake", 10, 150, paint);
                paint.setTextSize(25);
                canvas.drawText("  Hi Score:" + hi, 10, screenHeight-50, paint);

                //Draw the snake head
                //make this Rect whatever size and location you like
                //(startX, startY, endX, endY)
                Rect destRect = new Rect(screenWidth/2-100, screenHeight/2-100, screenWidth/2+100, screenHeight/2+100);

                canvas.drawBitmap(headAnimBitmap, rectToBeDrawn, destRect, paint);

                ourHolder.unlockCanvasAndPost(canvas);
            }

        }</pre></div></li><li class="listitem">Our trusty old <code class="literal">controlFPS</code> method ensures that our animation appears at a sensible rate. The only change in this code is that the initialization of <code class="literal">timeTosleep</code> is changed to create a 500-millisecond pause between each frame. Type <a class="indexterm" id="id691"/>the following code after the code from the preceding step:<div><pre class="programlisting">public void controlFPS() {
            long timeThisFrame = (System.currentTimeMillis() - lastFrameTime);
            long timeToSleep = 500 - timeThisFrame;
            if (timeThisFrame &gt; 0) {
                fps = (int) (1000 / timeThisFrame);
            }
            if (timeToSleep &gt; 0) {

                try {
                    ourThread.sleep(timeToSleep);
                } catch (InterruptedException e) {
                }

            }

            lastFrameTime = System.currentTimeMillis();
        }</pre></div></li><li class="listitem">Next are our <code class="literal">pause</code> and <code class="literal">resume</code> methods, which work with the Android lifecycle methods to <a class="indexterm" id="id692"/>start and stop our thread. Type this code after the code from the previous step:<div><pre class="programlisting">public void pause() {
            playingSnake = false;
            try {
                ourThread.join();
            } catch (InterruptedException e) {
            }

        }

        public void resume() {
            playingSnake = true;
            ourThread = new Thread(this);
            ourThread.start();
        }</pre></div></li><li class="listitem">For our <code class="literal">SnakeAnimView</code> class and our <code class="literal">onTouchEvent</code> method, which simply starts the game when the screen is touched anywhere, we enter the following code. Obviously, we don't have a <code class="literal">GameActivity</code> yet:<div><pre class="programlisting">@Override
        public boolean onTouchEvent(MotionEvent motionEvent) {


            startActivity(i);
            return true;
        }
}</pre></div></li><li class="listitem">Finally, back in the <code class="literal">MainActivity</code> class, we handle some Android lifecycle methods. We <a class="indexterm" id="id693"/>also handle what happens when the player presses the back button:<div><pre class="programlisting">@Override
    protected void onStop() {
        super.onStop();

        while (true) {
            snakeAnimView.pause();
            break;
        }

        finish();
    }

    @Override
    protected void onResume() {
        super.onResume();
        snakeAnimView.resume();
    }

    @Override
    protected void onPause() {
        super.onPause();
        snakeAnimView.pause();
    }

    public boolean onKeyDown(int keyCode, KeyEvent event) {
        if (keyCode == KeyEvent.KEYCODE_BACK) {
            snakeAnimView.pause();
            finish();
            return true;
        }
        return false;
    }</pre></div></li><li class="listitem">Now you <a class="indexterm" id="id694"/>must temporarily comment out this <a class="indexterm" id="id695"/>line from step 4 to test the animation. The reason for this is that it causes an error until we implement the <code class="literal">GameActivity</code> class:<div><pre class="programlisting">//i = new Intent(this, GameActivity.class);</pre></div></li><li class="listitem">Test the app.</li><li class="listitem">Uncomment the line from step 14 when we have implemented the <code class="literal">GameActivity</code> class. Here is our completed home screen:<div><img alt="Implementing the Snake home screen" src="img/8859OS_08_10.jpg"/></div></li></ol></div><p>In this exercise, we set up a class that extended <code class="literal">SurfaceView</code>, just like we did for our squash game. We had a <code class="literal">run</code> method, which controlled the thread, as well as an <code class="literal">update</code> method, which calculated the coordinates of the current animation within our sprite sheet. The <code class="literal">draw</code> <a class="indexterm" id="id696"/>method simply drew to the screen using the coordinates calculated by the <code class="literal">update</code> method.</p><p>As in the squash game, we had an <code class="literal">onTouchUpdate</code> method, but the code this time was very simple. As a touch of <a class="indexterm" id="id697"/>any type in any location was all we needed to detect, we added just one line of code to the method.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec61"/>Implementing the Snake game activity</h1></div></div></div><p>Not all of this code <a class="indexterm" id="id698"/>is new. In fact, we have either used most of it before or discussed it earlier in the chapter. However, I wanted to present every line to you in order and in context with at least a brief explanation, even when we have seen it before. Having said that, I haven't included the long list of imports as we will either be prompted to add them automatically or we can just press <em>Alt</em> + <em>Enter</em> when needed.</p><p>This way, we can remind ourselves how the whole thing comes together without any blanks in our understanding. As usual, I will summarize as we proceed through the implementation, and go into a few bits of extra depth at the end:</p><div><ol class="orderedlist arabic"><li class="listitem">Add an activity called <code class="literal">GameActivity</code>. Select a blank activity when asked.</li><li class="listitem">Make the activity full screen as we have done before.</li><li class="listitem">As usual, create some sound effects or use mine. Create an <code class="literal">assets</code> directory in the <code class="literal">main</code> directory in the usual way. Copy and paste the sound files (<code class="literal">sample1.ogg</code>, <code class="literal">sample2.ogg</code>, <code class="literal">sample3.ogg</code>, and <code class="literal">sample4.ogg</code>) into it.</li><li class="listitem">Create individual non-sprite-sheet versions of graphics or use mine. Copy and paste them in the <code class="literal">res/drawable-mdpi</code> folder.</li><li class="listitem">Here is the <code class="literal">GameActivity</code> class declaration with the member variables. There is nothing <a class="indexterm" id="id699"/>new here until we declare our arrays for our snake (<code class="literal">snakeX</code> and <code class="literal">snakeY</code>). Also, notice our variables used to control our game grid (<code class="literal">blockSize</code>, <code class="literal">numBlocksHigh</code>, and <code class="literal">numBlocksWide</code>). Now type this code:<div><pre class="programlisting">public class GameActivity extends Activity {

    Canvas canvas;
    SnakeView snakeView;

    Bitmap headBitmap;
    Bitmap bodyBitmap;
    Bitmap tailBitmap;
    Bitmap appleBitmap;

    //Sound
    //initialize sound variables
    private SoundPool soundPool;
    int sample1 = -1;
    int sample2 = -1;
    int sample3 = -1;
    int sample4 = -1;

    //for snake movement
    int directionOfTravel=0;
    //0 = up, 1 = right, 2 = down, 3= left


    int screenWidth;
    int screenHeight;
    int topGap;

    //stats
    long lastFrameTime;
    int fps;
    int score;
    int hi;

    //Game objects
    int [] snakeX;
    int [] snakeY;
    int snakeLength;
    int appleX;
    int appleY;

    //The size in pixels of a place on the game board
    int blockSize;
    int numBlocksWide;
    int numBlocksHigh;</pre></div></li><li class="listitem">As explained previously, our new, small <code class="literal">onCreate</code> method has very little to do because <a class="indexterm" id="id700"/>much of the work is done in the <code class="literal">loadSound</code> and <code class="literal">configureDisplay</code> methods. Type this code after the code from the previous step:<div><pre class="programlisting">@Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        loadSound();
        configureDisplay();
        snakeView = new SnakeView(this);
        setContentView(snakeView);

    }</pre></div></li><li class="listitem">Here is the class declaration, member variables, and constructor for our <code class="literal">SnakeView</code> class. We allocate 200 <code class="literal">int</code> variables to the <code class="literal">snakeX</code> and <code class="literal">snakeY</code> arrays, and call the <code class="literal">getSnake</code> and <code class="literal">getApple</code> methods, which will place an apple and our snake on the screen. This is just what we want when the class is constructed:<div><pre class="programlisting">  class SnakeView extends SurfaceView implements Runnable {
      Thread ourThread = null;
      SurfaceHolder ourHolder;
      volatile boolean playingSnake;
      Paint paint;

      public SnakeView(Context context) {
          super(context);
          ourHolder = getHolder();
          paint = new Paint();

            //Even my 9 year old play tester couldn't
            //get a snake this long
            snakeX = new int[200];
            snakeY = new int[200];

            //our starting snake
            getSnake();
            //get an apple to munch
            getApple();
        }</pre></div></li><li class="listitem">Here is how we spawn a snake and an apple in our coordinate system. In the <code class="literal">getSnake</code> method, we place the snake's head in the approximate center of the screen by initializing <code class="literal">snakeX[0]</code> and <code class="literal">snakeY[0]</code> to the number of blocks high and wide divided by 2. We then place a body segment and the tail segment immediately behind. Notice that we don't need to make any special <a class="indexterm" id="id701"/>arrangement for the different types of segments. As long as the drawing code <em>knows</em> that the first segment is a head, the last segment is a tail, and everything in between is a body, then that will do. In the <code class="literal">getApple</code> method, the integer variables <code class="literal">appleX</code> and <code class="literal">appleY</code> are initialized to random locations within our game grid. This method is called from the constructor, as we saw in the previous step. It will also be called to place a new apple every time our snake manages to eat an apple, as we will see. Type this code after the code from the previous step:<div><pre class="programlisting">public void getSnake(){
            snakeLength = 3;
            //start snake head in the middle of screen
            snakeX[0] = numBlocksWide / 2;
            snakeY[0] = numBlocksHigh / 2;

            //Then the body
            snakeX[1] = snakeX[0]-1;
            snakeY[1] = snakeY[0];

            //And the tail
            snakeX[1] = snakeX[1]-1;
            snakeY[1] = snakeY[0];
        }

        public void getApple(){
            Random random = new Random();
            appleX = random.nextInt(numBlocksWide-1)+1;
            appleY = random.nextInt(numBlocksHigh-1)+1;
        }</pre></div></li><li class="listitem">Next comes the <code class="literal">run</code> method, which controls the flow of the game. Type the following <a class="indexterm" id="id702"/>code after the code from the previous step:<div><pre class="programlisting">@Override
        public void run() {
            while (playingSnake) {
                updateGame();
                drawGame();
                controlFPS();

            }

        }</pre></div></li><li class="listitem">Now we will look at <code class="literal">updateGame</code>, the most complex method of the entire app. Having said that, it is probably slightly less complex than the same method in <a class="indexterm" id="id703"/>our squash game. This is because of our coordinate system, which leads to simpler collision detection. Here is the code for <code class="literal">updateGame</code>. Study it carefully, and we will dissect it line by line at the end:<div><pre class="programlisting">public void updateGame() {

    //Did the player get the apple
    if(snakeX[0] == appleX &amp;&amp; snakeY[0] == appleY){
        //grow the snake
        snakeLength++;
        //replace the apple
        getApple();
        //add to the score
        score = score + snakeLength;
        soundPool.play(sample1, 1, 1, 0, 0, 1);
    }

    //move the body - starting at the back
    for(int i=snakeLength; i &gt;0 ; i--){
        snakeX[i] = snakeX[i-1];
        snakeY[i] = snakeY[i-1];
    }

    //Move the head in the appropriate direction
    switch (directionOfTravel){
        case 0://up
        snakeY[0]  --;
        break;

        case 1://right
        snakeX[0] ++;
        break;

        case 2://down
        snakeY[0] ++;
        break;

        case 3://left
        snakeX[0] --;
        break;
        }

        //Have we had an accident
        boolean dead = false;
        //with a wall
        if(snakeX[0] == -1)dead=true;
        if(snakeX[0] &gt;= numBlocksWide) dead = true;
        if(snakeY[0] == -1)dead=true;
        if(snakeY[0] == numBlocksHigh) dead = true;
        //or eaten ourselves?
        for (int i = snakeLength-1; i &gt; 0; i--) {
            if ((i &gt; 4) &amp;&amp; (snakeX[0] == snakeX[i]) &amp;&amp; (snakeY[0] == snakeY[i])) {
            dead = true;
        }
    }


        if(dead){
        //start again
        soundPool.play(sample4, 1, 1, 0, 0, 1);
        score = 0;
        getSnake();

        }

        }</pre></div></li><li class="listitem">We have worked out where our game objects are on the screen, so now we can draw them. This <a class="indexterm" id="id704"/>code is easy to understand as we have seen most of it before:<div><pre class="programlisting">public void drawGame() {

    if (ourHolder.getSurface().isValid()) {
        canvas = ourHolder.lockCanvas();
        //Paint paint = new Paint();
        canvas.drawColor(Color.BLACK);//the background
        paint.setColor(Color.argb(255, 255, 255, 255));
        paint.setTextSize(topGap/2);
        canvas.drawText("Score:" + score + "  Hi:" + hi, 10, topGap-6, paint);

        //draw a border - 4 lines, top right, bottom , left
        paint.setStrokeWidth(3);//3 pixel border
        canvas.drawLine(1,topGap,screenWidth-1,topGap,paint);
        canvas.drawLine(screenWidth-1,topGap,screenWidth-1,topGap+(numBlocksHigh*blockSize),paint);
        canvas.drawLine(screenWidth-1,topGap+(numBlocksHigh*blockSize),1,topGap+(numBlocksHigh*blockSize),paint);
        canvas.drawLine(1,topGap, 1,topGap+(numBlocksHigh*blockSize), paint);

        //Draw the snake
        canvas.drawBitmap(headBitmap, snakeX[0]*blockSize, (snakeY[0]*blockSize)+topGap, paint);
        //Draw the body
        for(int i = 1; i &lt; snakeLength-1;i++){
            canvas.drawBitmap(bodyBitmap, snakeX[i]*blockSize, (snakeY[i]*blockSize)+topGap, paint);
        }
        //draw the tail
        canvas.drawBitmap(tailBitmap, snakeX[snakeLength-1]*blockSize, (snakeY[snakeLength-1]*blockSize)+topGap, paint);

        //draw the apple
        canvas.drawBitmap(appleBitmap, appleX*blockSize, (appleY*blockSize)+topGap, paint);

        ourHolder.unlockCanvasAndPost(canvas);
    }

        }</pre></div></li><li class="listitem">Here is the <code class="literal">controlFPS</code> method, unchanged from our squash game's <code class="literal">controlFPS</code> <a class="indexterm" id="id705"/>method, except that we have a different target frame rate. Type this code after the code from the preceding step:<div><pre class="programlisting">public void controlFPS() {
    long timeThisFrame = (System.currentTimeMillis() - lastFrameTime);
    long timeToSleep = 100 - timeThisFrame;
    if (timeThisFrame &gt; 0) {
        fps = (int) (1000 / timeThisFrame);
    }
    if (timeToSleep &gt; 0) {

        try {
            ourThread.sleep(timeToSleep);
        } catch (InterruptedException e) {
        }

        }

        lastFrameTime = System.currentTimeMillis();
        }</pre></div></li><li class="listitem">Here are our unchanged <code class="literal">pause</code> and <code class="literal">resume</code> methods. Type the following code after the code from the previous step:<div><pre class="programlisting">public void pause() {
            playingSnake = false;
            try {
                ourThread.join();
            } catch (InterruptedException e) {
            }

        }

        public void resume() {
            playingSnake = true;
            ourThread = new Thread(this);
            ourThread.start();
        }</pre></div></li><li class="listitem">Then we have the <code class="literal">onTouchEvent</code> method, similar to that of our squash game. There are no new concepts here, but the way it works in this game is as follows. We switch on the <code class="literal">ACTION_UP</code> event. This is broadly the same as detecting a click. We then check whether the press was on the left or the right. If it was on the right, we increment <code class="literal">directionOfTravel</code>. If it was on the left, we decrement <code class="literal">directionOfTravel</code>. If you looked carefully at the <code class="literal">updateGame</code> method, you would have seen that <code class="literal">directionOfTravel</code> indicates the direction in which to move the snake. Remember, the snake never stops. This <a class="indexterm" id="id706"/>is why we did it differently from our squash game. Type this code after the code from the previous step:<div><pre class="programlisting">@Override
    public boolean onTouchEvent(MotionEvent motionEvent) {

        switch (motionEvent.getAction() &amp; MotionEvent.ACTION_MASK) {
            case MotionEvent.ACTION_UP:
            if (motionEvent.getX() &gt;= screenWidth / 2) {
                //turn right
                directionOfTravel ++;
                //no such direction

                if(directionOfTravel == 4)
                //loop back to 0(up)
                directionOfTravel = 0;
            }
        else {
            //turn left
            directionOfTravel--;
            if(directionOfTravel == -1) {//no such direction
            //loop back to 0(up)
            directionOfTravel = 3;
                        }
                    }
            }
            return true;
        }</pre></div></li><li class="listitem">Back in the <code class="literal">GameActivity</code> class, we now handle the Android lifecycle methods and the "back" button functionality. Type this code after the code from the preceding step:<div><pre class="programlisting">@Override
    protected void onStop() {
        super.onStop();

        while (true) {
            snakeView.pause();
            break;
        }

        finish();
    }


    @Override
    protected void onResume() {
        super.onResume();
        snakeView.resume();
    }

    @Override
    protected void onPause() {
        super.onPause();
        snakeView.pause();
    }

    public boolean onKeyDown(int keyCode, KeyEvent event) {
        if (keyCode == KeyEvent.KEYCODE_BACK) {

           snakeView.pause();



            Intent i = new Intent(this, MainActivity.class);
            startActivity(i);
            finish();
            return true;
        }
        return false;
    }</pre></div></li><li class="listitem">Here is our <code class="literal">loadSound</code> method, which simply tidies up the <code class="literal">onCreate</code> method by <a class="indexterm" id="id707"/>moving all of the sound initialization to here. Type this code after the code from the previous step:<div><pre class="programlisting">public void loadSound(){
    soundPool = new SoundPool(10, AudioManager.STREAM_MUSIC, 0);
    try {
        //Create objects of the 2 required classes
        AssetManager assetManager = getAssets();
        AssetFileDescriptor descriptor;

        //create our three fx in memory ready for use
        descriptor = assetManager.openFd("sample1.ogg");
        sample1 = soundPool.load(descriptor, 0);

        descriptor = assetManager.openFd("sample2.ogg");
        sample2 = soundPool.load(descriptor, 0);


        descriptor = assetManager.openFd("sample3.ogg");
        sample3 = soundPool.load(descriptor, 0);

        descriptor = assetManager.openFd("sample4.ogg");
        sample4 = soundPool.load(descriptor, 0);


        } catch (IOException e) {
        //Print an error message to the console
        Log.e("error", "failed to load sound files);
        }
    }</pre></div></li><li class="listitem">Then we have the <code class="literal">configureDisplay</code> method, which is called from <code class="literal">onCreate</code> and does the entire setup of bitmaps and screen size calculations. We will look at <a class="indexterm" id="id708"/>this in more detail later. Type the following code after the code from the previous step:<div><pre class="programlisting">public void configureDisplay(){
        //find out the width and height of the screen
        Display display = getWindowManager().getDefaultDisplay();
        Point size = new Point();
        display.getSize(size);
        screenWidth = size.x;
        screenHeight = size.y;
        topGap = screenHeight/14;
        //Determine the size of each block/place on the game board
        blockSize = screenWidth/40;

        //Determine how many game blocks will fit into the 
        //height and width
        //Leave one block for the score at the top
        numBlocksWide = 40;
        numBlocksHigh = ((screenHeight - topGap ))/blockSize;

        //Load and scale bitmaps
        headBitmap = BitmapFactory.decodeResource(getResources(), R.drawable.head);
        bodyBitmap = BitmapFactory.decodeResource(getResources(), R.drawable.body);
        tailBitmap = BitmapFactory.decodeResource(getResources(), R.drawable.tail);
        appleBitmap = BitmapFactory.decodeResource(getResources(), R.drawable.apple);

        //scale the bitmaps to match the block size
        headBitmap = Bitmap.createScaledBitmap(headBitmap, blockSize, blockSize, false);
        bodyBitmap = Bitmap.createScaledBitmap(bodyBitmap, blockSize, blockSize, false);
        tailBitmap = Bitmap.createScaledBitmap(tailBitmap, blockSize, blockSize, false);
        appleBitmap = Bitmap.createScaledBitmap(appleBitmap, blockSize, blockSize, false);

    }</pre></div></li><li class="listitem">Now run the app. The game is much more playable on an actual device than it is on the emulator.</li></ol></div><p>We covered the code as we progressed, but as usual, here is a piece-by-piece dissection of a few of the more complicated methods, starting with the <code class="literal">updateGame</code> method.</p><p>First, we check whether the player has eaten an apple. More specifically, is the snake's head in the same grid location as the apple? The <code class="literal">if</code> statement checks whether this has occurred, and then does the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Increases the length of the snake</li><li class="listitem" style="list-style-type: disc">Puts another <a class="indexterm" id="id709"/>apple on the screen by calling <code class="literal">getApple</code></li><li class="listitem" style="list-style-type: disc">Adds a value to the player's score, relative to the length of the snake, making each apple worth more than the previous one</li><li class="listitem" style="list-style-type: disc">Plays a beep</li></ul></div><p>Here is the code for the actions that we have just described:</p><div><pre class="programlisting">public void updateGame() {

            //Did the player get the apple
            if(snakeX[0] == appleX &amp;&amp; snakeY[0] == appleY){
                //grow the snake
                snakeLength++;
                //replace the apple
                getApple();
                //add to the score
                score = score + snakeLength;
                soundPool.play(sample1, 1, 1, 0, 0, 1);
            }</pre></div><p>Now we simply <a class="indexterm" id="id710"/>move each segment of the snake, starting from the back, to the position of the segment in front of it. We do this with a <code class="literal">for</code> loop:</p><div><pre class="programlisting">            //move the body - starting at the back
            for(int i = snakeLength; i &gt;0 ; i--){
                snakeX[i] = snakeX[i-1];
                snakeY[i] = snakeY[i-1];
            }</pre></div><p>Of course, we better move the head too! We move the head last because the leading section of the body would move to the wrong place if we move the head earlier. As long as the entire move is made before any drawing is done, all will be well. Our <code class="literal">run</code> method ensures that this is always the case. Here is the code to move the head in the direction determined by <code class="literal">directionOfTravel</code>. As we saw, <code class="literal">directionOfTravel</code> is manipulated by the player in the <code class="literal">onTouchEvent</code> method:</p><div><pre class="programlisting">            //Move the head in the appropriate direction
            switch (directionOfTravel){
                case 0://up
                    snakeY[0]  --;
                    break;

                case 1://right
                    snakeX[0] ++;
                    break;

                case 2://down
                    snakeY[0] ++;
                    break;

                case 3://left
                    snakeX[0] --;
                    break;
            }</pre></div><p>Next, we check for a collision with a wall. We saw this code when we looked at collision detection earlier. Here <a class="indexterm" id="id711"/>is the complete solution, starting with the left wall, then right, then top, and then bottom:</p><div><pre class="programlisting">            //Have we had an accident
            boolean dead = false;
            //with a wall
            if(snakeX[0] == -1)dead=true;
            if(snakeX[0] &gt;= numBlocksWide)dead=true;
            if(snakeY[0] == -1)dead=true;
            if(snakeY[0] == numBlocksHigh)dead=true;</pre></div><p>Then we check whether the snake has collided with itself. Initially, this seemed awkward, but as we previously saw, we just loop through our snake array to check whether any of the segments are in the same place as the head, in both <em>x</em> and <em>y</em> coordinates:</p><div><pre class="programlisting">           //or eaten ourselves?
            for (int i = snakeLength-1; i &gt; 0; i--) {
                if ((i &gt; 4) &amp;&amp; (snakeX[0] == snakeX[i]) &amp;&amp; (snakeY[0] == snakeY[i])) {
                    dead = true;
                }
            }</pre></div><p>If any part of our collision detection code sets <code class="literal">dead</code> to <code class="literal">true</code>, we simply play a sound, set the <code class="literal">score</code> to <code class="literal">0</code>, and get a new baby snake:</p><div><pre class="programlisting">            if(dead){
                //start again
                soundPool.play(sample4, 1, 1, 0, 0, 1);
                score = 0;
                getSnake();

            }

        }</pre></div><p>Now we take a closer look at the <code class="literal">drawGame</code> method. First, we get ready to draw by clearing the screen:</p><div><pre class="programlisting">public void drawGame() {

            if (ourHolder.getSurface().isValid()) {
                canvas = ourHolder.lockCanvas();
                //Paint paint = new Paint();
                canvas.drawColor(Color.BLACK);//the background
                paint.setColor(Color.argb(255, 255, 255, 255));
                paint.setTextSize(topGap/2);</pre></div><p>Now we draw the text for the player's score, just above <code class="literal">topGap</code> that we define in <code class="literal">configureDisplay</code>:</p><div><pre class="programlisting">    canvas.drawText("Score:" + score + "  Hi:" + hi, 10, topGap-6, paint);</pre></div><p>Now, using <code class="literal">drawLine</code>, we <a class="indexterm" id="id712"/>draw a visible border around our game grid:</p><div><pre class="programlisting"> //draw a border - 4 lines, top right, bottom, left
                paint.setStrokeWidth(3);//4 pixel border
                canvas.drawLine(1,topGap,screenWidth-1,topGap,paint);
                canvas.drawLine(screenWidth-1,topGap,screenWidth-1,topGap+(numBlocksHigh*blockSize),paint);
                canvas.drawLine(screenWidth-1,topGap+(numBlocksHigh*blockSize),1,topGap+(numBlocksHigh*blockSize),paint);
                canvas.drawLine(1,topGap, 1,topGap+(numBlocksHigh*blockSize), paint);</pre></div><p>Next, we draw the snake's head:</p><div><pre class="programlisting">//Draw the snake
canvas.drawBitmap(headBitmap, snakeX[0]*blockSize, (snakeY[0]*blockSize)+topGap, paint);</pre></div><p>The snake's head will be followed by all the body segments. Look at the condition of the <code class="literal">for</code> loop. This starts at <code class="literal">1</code>, which means it is not redrawing the head position, and ends at <code class="literal">snakeLength - 1</code>, which means it is not drawing the tail segment. Here is the code used to draw the body section:</p><div><pre class="programlisting">//Draw the body
for(int i = 1; i &lt; snakeLength-1; i++){
    canvas.drawBitmap(bodyBitmap, snakeX[i]*blockSize, (snakeY[i]*blockSize)+topGap, paint);
}</pre></div><p>Here, we draw the tail of the snake:</p><div><pre class="programlisting">//draw the tail
canvas.drawBitmap(tailBitmap, snakeX[snakeLength-
    1]*blockSize, (snakeY[snakeLength-1]*blockSize)+topGap, paint);</pre></div><p>Finally, we draw the apple as follows:</p><div><pre class="programlisting">                //draw the apple
                canvas.drawBitmap(appleBitmap, appleX*blockSize, 
                    (appleY*blockSize)+topGap, paint);

                ourHolder.unlockCanvasAndPost(canvas);
            }

        }</pre></div><p>Next, we will go through the <code class="literal">configureDisplay</code> method.</p><p>First, we get the screen resolution and store the results in <code class="literal">screenWidth</code> and <code class="literal">screenHeight</code> as normal:</p><div><pre class="programlisting">public void configureDisplay(){
        //find out the width and height of the screen
        Display display = getWindowManager().getDefaultDisplay();
        Point size = new Point();
        display.getSize(size);
        screenWidth = size.x;
        screenHeight = size.y;</pre></div><p>Here, we define a gap <a class="indexterm" id="id713"/>called <code class="literal">topGap</code>. It will be a space at the top of the screen and will not be a part of the game area. This gap is used for the score. We saw <code class="literal">topGap</code> used fairly extensively in the <code class="literal">drawGame</code> method. After this, we calculate the width and height of the remaining area in blocks:</p><div><pre class="programlisting">        topGap = screenHeight/14;
        //Determine the size of each block/place on the game board
        blockSize = screenWidth/40;

        //Determine how many game blocks will fit into the height and width
        //Leave one block for the score at the top
        numBlocksWide = 40;
        numBlocksHigh = (screenHeight - topGap )/blockSize;</pre></div><p>In the following part of the code, we load all our image files into <code class="literal">Bitmap</code> objects:</p><div><pre class="programlisting">//Load and scale bitmaps
        headBitmap = BitmapFactory.decodeResource(getResources(), R.drawable.head);
        bodyBitmap = BitmapFactory.decodeResource(getResources(), R.drawable.body);
        tailBitmap = BitmapFactory.decodeResource(getResources(), R.drawable.tail);
        appleBitmap = BitmapFactory.decodeResource(getResources(), R.drawable.apple);</pre></div><p>Finally, we scale each bitmap to be the same width and height as <code class="literal">blockSize</code>:</p><div><pre class="programlisting">        //scale the bitmaps to match the block size
        headBitmap = Bitmap.createScaledBitmap(headBitmap, blockSize, 
            blockSize, false);
        bodyBitmap = Bitmap.createScaledBitmap(bodyBitmap, blockSize, 
            blockSize, false);
tailBitmap = Bitmap.createScaledBitmap(tailBitmap, blockSize, 
    blockSize, false);
appleBitmap = Bitmap.createScaledBitmap(appleBitmap, 
    blockSize, blockSize, false);

    }</pre></div><p>Now we <a class="indexterm" id="id714"/>can take a quick look at a few different ways we can improve the game.</p></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec62"/>Enhancing the game</h1></div></div></div><p>Here is a series of <a class="indexterm" id="id715"/>questions and answers to lead us to an improved version of our <em>Snake</em> game. It doesn't matter if you can't answer some (or even all) of the questions. Just take a look at the questions and answers, after which you can take a look at the new game and the code.</p></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec63"/>Self-test questions</h1></div></div></div><p>Q1) What can be used to provide a visual improvement for our game screen? Can we use a nice light green, grassy background instead of just black?</p><p>Q2) How about some nice flowers?</p><p>Q3) If you're feeling brave, make the flowers sway. Think about what we have learned about sprite sheets. The theory is exactly the same as that of the animated snake head. We just need a few lines of code to control the frame rate separately from the game frame rate.</p><p>Q4) We could set up another counter and use our snake head animation in <code class="literal">GameActivity</code>, but it wouldn't be that useful because the subtle tongue movements would be barely visible at the smaller size. But could we swish the tail segment?</p><p>Q5) Here is a slightly trickier enhancement. You can't help notice that when the snake sprites are headed in three out of the four possible directions, they don't look right. Can you fix this?</p></div>
<div><div><div><div><h1 class="title"><a id="ch08lvl1sec64"/>Summary</h1></div></div></div><p>This is the end of yet another successful game project. You now know how to create and animate sprite sheets to add more realism to our games. Now we have an enhanced <em>Snake</em> game.</p><p>In the next chapter, we will see how simple it is to add leaderboards and achievements. This will make our game social and compelling by letting the player see the high scores and achievements of their friends and compare them with their own.</p></div>
<div><div><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Making Your Game the Next Big Thing</h1></div></div></div><p>The day has finally come when we can publish our first game. This chapter, despite being shorter than others, is probably the longest chapter to complete. It would be a good idea to scan through the different exercises to see what is involved before actually diving into them. Most of these tutorials are not suitable to do during the advertisements of your favorite TV program or when you get in from work and you are really tired.</p><p>Read the chapter and make a plan of when to perform each stage. The stages are arranged so you should be able to leave the project in between each of them. If you are really determined, have understood all the code until now, are confident with files and folders, and have no interruptions, you can probably get the work in this chapter completed in about a day.</p><p>As always, the completed code is in the relevant folder in the download bundle, in this case the <code class="literal">Chapter9</code> folder.</p><div><div><h3 class="title"><a id="note32"/>Note</h3><p>Note that because I cannot share the login credentials for my developer account, had to mask some ID numbers within the code with a series of black lines. You will see these in the code in this chapter when talking about the <code class="literal">ids.xml</code> file which is NOT in the code bundle because of its confidential nature. However, as you will see in the <em>Setting up the Snake project ready for implementation</em> section, it is easy to get your own ID codes. Also note that a lot of the work in this chapter involves set up that takes place in your developer console. The leaderboards and achievements will not function until you have completed the necessary steps. However, you can review the entire code in the <code class="literal">Chapter9</code> folder and download the enhanced version of the game from <a class="link" href="ch08.html" title="Chapter 8. The Snake Game">Chapter 8</a>, <em>The Snake Game</em>, complete with working leaderboards and achievements from <a class="link" href="ch09.html" title="Chapter 9. Making Your Game the Next Big Thing">Chapter 9</a>, <em>Making Your Game the Next Big Thing</em>, from <a class="ulink" href="https://play.google.com/store/apps/details?id=com.packtpub.enhancedsnakegame.enhancedsnakegame">https://play.google.com/store/apps/details?id=com.packtpub.enhancedsnakegame.enhancedsnakegame</a>.</p></div></div><p>If you want to implement everything yourself and also want to start with the enhanced version of the game, including all the improvements from the self-test questions from the previous chapter, then grab the <code class="literal">EnhancedSnakeGame</code> code from the <code class="literal">Chapter8</code> folder, and update your working project from <code class="literal">Chapter8</code>.</p><p>In this chapter, you will learn the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">How to publish your app</li><li class="listitem" style="list-style-type: disc">Marketing your app, including making it social with leaderboards and public achievements</li><li class="listitem" style="list-style-type: disc">Implementing leaderboards and achievements with the Google Play Game Services API</li><li class="listitem" style="list-style-type: disc">Looking at what to do next depending on what you want to achieve</li></ul></div><div><div><div><div><h1 class="title"><a id="ch09lvl1sec65"/>How to publish your app</h1></div></div></div><p>Some of the <a class="indexterm" id="id716"/>steps in this guide involve writing descriptions and supplying screenshots, so you might like to read through the entire guide before implementing any of the steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create an icon. Exactly how to design an icon is beyond the scope of this book, but simply put, you need to create a nice image for each of the Android screen density categories. This is easier than it sounds. Using a simple image, such as the snake head bitmap, you can customize and download a set from <a class="ulink" href="http://romannurik.github.io/AndroidAssetStudio/icons-launcher.html">http://romannurik.github.io/AndroidAssetStudio/icons-launcher.html</a>. There are many sites that offer a similar free service. Of course, you can just use the images in the enhanced snake project, and skip this step and the next.</li><li class="listitem">Once you have downloaded your <code class="literal">.zip</code> file from the preceding link, you can simply copy the <code class="literal">res</code> folder from within the download to the <code class="literal">main</code> folder within the project explorer. All icons at all densities will now be updated.</li><li class="listitem">Before we proceed further, optionally you will need to prepare some screenshots of the game. You will be prompted to upload a screenshot for several screen types, but since the game is nearly identical on all screen types, one image should do fine. You will also need an image of dimension 512 x 512 for a high-resolution icon and an image of dimension 1024 x 500 for a feature graphic. They don't need to be great, but you do need them to proceed. Create your own or grab a copy of my very simple graphics in the <code class="literal">Chapter9</code> folder.</li><li class="listitem">Now, unfortunately, you will need to spend $ 25 to open a Google Play account. You <a class="indexterm" id="id717"/>can sign up at <a class="ulink" href="https://play.google.com/apps/publish/">https://play.google.com/apps/publish/</a>.</li><li class="listitem">Once you have signed up, you can log in to your developer console at the same URL as mentioned in the previous step.</li><li class="listitem">Once in your console, click on the <strong>+ Add new application</strong> button:<div><img alt="How to publish your app" src="img/8859OS_09_01.jpg"/></div></li><li class="listitem">In the <strong>Add New Application</strong> dialog, type a name for your application, such as <code class="literal">Snake Game</code>. Now click on <strong>Upload APK</strong>.</li><li class="listitem">We now <a class="indexterm" id="id718"/>need to make our app into the release version. Open the <code class="literal">AndroidManifest.xml</code> file and add the highlighted line of code in the location shown:<div><pre class="programlisting">&lt;application
        <strong>android:debuggable="false"</strong>
        android:allowBackup="true"</pre></div></li><li class="listitem">Rebuild your signed APK for the latest version of the <em>Snake</em> game, as discussed in <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>.</li><li class="listitem">Now click on <strong>Upload your first APK to production</strong>.</li><li class="listitem">Now go to your Snake game APK.</li><li class="listitem">Wait for the APK to finish uploading. You can now see your game summary screen. Notice the highlighted progress indicator to the top-left corner of the next image. We have a green tick, indicating that the APK has been uploaded successfully:<div><img alt="How to publish your app" src="img/8859OS_09_02.jpg"/></div></li><li class="listitem">The next thing we need to do is configure our Store Listing, so click on the <strong>Store Listing</strong> link, just below the APK link.</li><li class="listitem">Write a short description and a long description. Also upload your screenshots, feature graphics, and high-resolution icon.</li><li class="listitem">In the <strong>Application Type</strong> drop-down menu, select <strong>Games</strong>. In the <strong>Category</strong> drop-down menu, <strong>Arcade</strong> is probably most appropriate. For <strong>Content Rating</strong>, select <strong>Everyone</strong>, and for <strong>Privacy Policy</strong>, click on the checkbox for <strong>Not submitting a privacy policy at this time</strong>.</li><li class="listitem">Add your website and email address to the relevant boxes.</li><li class="listitem">Back at the top of the web page, click on the <strong>Save</strong> button.</li><li class="listitem">Now we <a class="indexterm" id="id719"/>are at the final stage of this guide. Click on the <strong>Pricing and distribution</strong> link. It is just underneath the <strong>Store Listing</strong> link from step 13.</li><li class="listitem">Click on the <strong>Free</strong> button at the top of the page.</li><li class="listitem">Click on the checkbox of all the countries you want your game to be listed in.</li><li class="listitem">Scroll down to the bottom of the page and click on the checkboxes for <strong>Content guidelines</strong> and <strong>US Export laws</strong>.</li><li class="listitem">Click on <strong>Save</strong> at the top of the page.</li><li class="listitem">Finally, from the <strong>Ready to publish</strong> drop-down menu at the top right corner of the page, click on <strong>Publish this app</strong> and you are done.<div><img alt="How to publish your app" src="img/88590S_09_03.jpg"/></div></li></ol></div><p>Congratulations! Your <a class="indexterm" id="id720"/>game will be live on Google Play somewhere between the next 5 minutes and 24 hours.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec66"/>Marketing your app</h1></div></div></div><p>The temptation <a class="indexterm" id="id721"/>at this stage is to sit back and wait for our game to hit the top position in the best-selling apps. This never happens.</p><p>To ensure that our app achieves its full potential, we need to do the following continuously:</p><p><strong>Improve it</strong></p><p>We have already made quite a few improvements to the <em>Snake</em> game but there are many more, such as difficulty settings, music, debugging (did you see the occasionally wonky body segments?), settings menu, and so on. You can pay a professional to design backgrounds and sprites, or add more sound effects. When you have improved your Android and Java skills further, you can rewrite the entire game using a smoother engine and call it Version 2.</p><p><strong>Promote it</strong></p><p>This could be the subject of another book but there are so many ways we can spread the word about our app. We can create a page/profile on all the social media sites—Facebook, Twitter, Flickr, and so on. Add regular updates, announcements, challenges (see compulsion). We can create a website to promote our app and promote it in all the ways we would promote any other website. We can add a message in the app itself asking players to rate it, perhaps pop up a message just after they have got a high score or achievement. We can ask everyone we know and everyone who visits our social media/website to give a rating and leave a review. There are many more ways to promote an app as well. The secret to all of them is this: keep doing it. For example, don't create a Facebook page and then expect it to grow in popularity on its own. Keep adding to all of your channels of promotion.</p><p><strong>Keep the players' level of compulsion</strong></p><p>Besides improving the game in the ways we have briefly mentioned, we need to give players a compelling reason to keep coming back to our game. One way might be to add new levels. For example, it won't be hard to implement levels in our <em>Snake</em> game. Each level could have walls in different places and the layouts could get progressively more challenging. All we would need to do is make an array of obstacles, draw them on the screen, and detect collisions. Then set a target for the snake length for each level and move on to the next level when it is achieved.</p><p>We could offer different snake designs to be be unlocked for certain challenges. How about the player <a class="indexterm" id="id722"/>saving all the apples they collect as a form of currency, and then strategically spending that currency to get a chance to continue after they have died?</p><p>How about offering time-limited challenges? For example, complete level 10 by the end of the month to receive a thousand bonus apples. Perhaps, we could come up with more things the apples could be spent on. Cool snake accessories or levels that can only be unlocked with apples. The point is that all of this compulsion can be added and updated at the same time as we upload our improvements. Nothing mentioned in this discussion about compulsion would be unachievable with the skills we have learned so far.</p><p>Probably, the most compelling aspect we can add to our game is online leaderboards and achievements so that players can compare themselves to their friends and the rest of the world. Google is aware of this and have done a lot of work to make it as easy as possible to add leaderboards and achievements to games. We will see how we can yet again take advantage of other people's hard work.</p><p>What's more, all the achievements that players of your game earn are fed into their overall Google Play profile. Here is a screenshot of my rather poor Google Play achievements profile:</p><div><img alt="Marketing your app" src="img/88590S_09_50.jpg"/></div><p>You might have noticed a few <em>Snake</em> achievements in that lot. This feature makes your game potentially <a class="indexterm" id="id723"/>even more compelling.</p><div><div><h3 class="title"><a id="tip56"/>Tip</h3><p>Let's do a quick reality check—I am not actually suggesting that you spend significant amounts of time trying to make a real business out of our humble Snake game. It just serves as a useful example for discussion. Also, if we can come up with so many ideas for a game this old and simple, then we can surely come up with some really amazing stuff for a game we are passionate about. When you have an idea you are passionate about, then that would be the time to go for it and expand the brief marketing plan we have discussed.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec67"/>Adding leaderboards and achievements</h1></div></div></div><p>So we know <a class="indexterm" id="id724"/>why leaderboards and achievements <a class="indexterm" id="id725"/>are a good thing. The first thing we need to do <a class="indexterm" id="id726"/>here is plan our achievements. A leaderboard is a <a class="indexterm" id="id727"/>high score table, and that's it! There isn't a great deal of things we can do to make them different. The achievements, however, deserve some discussion.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec90"/>Planning the Snake achievements</h2></div></div></div><p>At first, it might <a class="indexterm" id="id728"/>seem that a really simple implementation of a really simple game, like our <em>Snake</em> game, isn't deep enough to have many, or even <a class="indexterm" id="id729"/>any, achievements. So what follows is a quick brainstorming session of achievement ideas:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Score 10, 25, 50, 100, and so on</strong>: Simply unlock achievements at different levels of high score.</li><li class="listitem" style="list-style-type: disc"><strong>Snake length</strong>: Simply unlock achievements at different snake lengths.</li><li class="listitem" style="list-style-type: disc"><strong>Cannibal</strong>: Unlock an achievement the first time the player collides with their own tail segment.</li><li class="listitem" style="list-style-type: disc"><strong>Collect x apples in total</strong>: Keep a tally of all the apples ever collected, and unlock achievements at significant milestones.</li><li class="listitem" style="list-style-type: disc"><strong>Play 10, 25, 50, 100 games</strong>: Reward the player for keeping on going. Whether they win or lose, achievements are unlocked for effort.</li><li class="listitem" style="list-style-type: disc"><strong>Treasure hunt</strong>: What if there was a hidden spot in every game? It could give the player a reason to explore each level. They could be rewarded with points and apples. They could then unlock real achievements, perhaps for every 5, 10, or 20 hidden spots that they find.</li></ul></div><p>Some of the achievements suggest that we would be required to keep a record of the player's progress. Surprisingly, Google Play Game Services can actually do this for us. These are known as incremental achievements. The number of apples collected in total is a good example of an incremental achievement. Others, such as snake length, are just dependent on the player's performance in any one game.</p><p>We will implement the total number of apples and the snake length achievements so that we can see how to implement both types.</p><p>We can have five achievements for reaching each of the following snake lengths: 5, 10, 20, 35, and 50. There can also be five incremental achievements for the total number of apples collected. Specifically, the player will get an achievement at 10, 25, 50, 100, 150, and 250 apples collected. Soon, we will see how to do it.</p><p>Finally, we need to decide how many points each achievement will be worth, out of the 1,000-point limit per game. As I might come back and add some more achievements later I am going to allocate 250 points to the apples' achievements, like this:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Number of eaten apples</p>
</th><th style="text-align: left" valign="bottom">
<p>Achievement points</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>10</p>
</td><td style="text-align: left" valign="top">
<p>10</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>20</p>
</td><td style="text-align: left" valign="top">
<p>30</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>50</p>
</td><td style="text-align: left" valign="top">
<p>40</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>100</p>
</td><td style="text-align: left" valign="top">
<p>70</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>250</p>
</td><td style="text-align: left" valign="top">
<p>100</p>
</td></tr></tbody></table></div><p>I will also allocate 250 points to the snake length achievements, as shown in the following table:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Length of snake</p>
</th><th style="text-align: left" valign="bottom">
<p>Achievement points</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>5</p>
</td><td style="text-align: left" valign="top">
<p>10</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>10</p>
</td><td style="text-align: left" valign="top">
<p>30</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>25</p>
</td><td style="text-align: left" valign="top">
<p>40</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>35</p>
</td><td style="text-align: left" valign="top">
<p>70</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>50</p>
</td><td style="text-align: left" valign="top">
<p>100</p>
</td></tr></tbody></table></div><p>Once you see how to <a class="indexterm" id="id730"/>implement these achievements in both the code and the developer console, it will be fairly simple to design and implement <a class="indexterm" id="id731"/>your own different achievements.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec91"/>Step-by-step leaderboards and achievements</h2></div></div></div><p>This is probably the longest part of the book to complete. However, once you have been through this process, it will be significantly easier the next time you do it.</p><div><div><div><div><h3 class="title"><a id="ch09lvl3sec52"/>Installing the Google Play Services API on your PC</h3></div></div></div><p>First, we <a class="indexterm" id="id732"/>need to add the tools <a class="indexterm" id="id733"/>and the libraries needed to use the Game Services classes. This is nice and easy with Android Studio:</p><div><ol class="orderedlist arabic"><li class="listitem">Click on the SDK Manager icon in the Android Studio toolbar:<div><img alt="Installing the Google Play Services API on your PC" src="img/88590S_09_05.jpg"/></div></li><li class="listitem">The <a class="indexterm" id="id734"/>SDK manager will start. It looks a bit like this:<div><img alt="Installing the Google Play Services API on your PC" src="img/88590S_09_06.jpg"/></div></li><li class="listitem">Scroll <a class="indexterm" id="id735"/>to the very bottom and underneath <strong>Extras</strong>, you will see <strong>Google Play Services</strong>. Check the box that is shown as highlighted in the following screenshot by clicking on it:<div><img alt="Installing the Google Play Services API on your PC" src="img/88590S_09_07.jpg"/></div></li><li class="listitem">Now click on the checkbox for <strong>Google Repository</strong>, just below <strong>Google Play Services</strong>.</li><li class="listitem">Click on <strong>Install packages</strong> and wait for the packages to download and install.</li><li class="listitem">Save your project and restart Android Studio.</li></ol></div><p>We now have the tools installed to start developing Google Play Game Services apps. Next, we <a class="indexterm" id="id736"/>need to set up our <a class="indexterm" id="id737"/>developer console to communicate with our app, ready for the features we will soon write code for.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec53"/>Configuring the Google Play developer console</h3></div></div></div><p>Here, we <a class="indexterm" id="id738"/>will prepare your <a class="indexterm" id="id739"/>developer console by creating a new Game Services application. This might sound a little counterintuitive; surely, Snake is our application, isn't it? Yes, but Google Play is structured in such a way that you create a Game Services application, and it is with this application that your actual games (Snake in this case) will communicate. It is the Game Services application that will have the achievements and leaderboards that we will award and display from our Snake Game:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in to your Google Play developer console at <a class="ulink" href="https://play.google.com/apps/publish/">https://play.google.com/apps/publish/</a>.</li><li class="listitem">Click on the <strong>Game services</strong> tab on the left of the web page.<div><img alt="Configuring the Google Play developer console" src="img/88590S_09_15.jpg"/></div></li><li class="listitem">Now click on the <strong>Add a new game</strong> button.</li><li class="listitem">Enter <a class="indexterm" id="id740"/><code class="literal">Snake</code> <a class="indexterm" id="id741"/>as the name of your game and choose <strong>Arcade</strong> from the <strong>Category</strong> drop-down menu. Now click on <strong>Continue</strong>. All of this is shown in the next screenshot:<div><img alt="Configuring the Google Play developer console" src="img/88590S_09_16.jpg"/></div></li><li class="listitem">Now <a class="indexterm" id="id742"/>we can configure our game. Type a game description in the <strong>Description</strong> field, and add the same high-resolution icon and feature graphic that we added when we uploaded the game.</li><li class="listitem">Click <a class="indexterm" id="id743"/>on the <strong>Save</strong> button at the top of the screen.</li><li class="listitem">Now we will link our Snake Game Services app with our actual <em>Snake</em> game. On the left of the web page, click on the <strong>Linked apps</strong> tab.<div><img alt="Configuring the Google Play developer console" src="img/88590S_09_17.jpg"/></div></li><li class="listitem">Google <a class="indexterm" id="id744"/>Play Game Services can be used with almost any platform, even Apple. We are <a class="indexterm" id="id745"/>using it for Android here, so click on the <strong>Android</strong> button.<div><img alt="Configuring the Google Play developer console" src="img/88590S_09_18.jpg"/></div></li><li class="listitem">All we need to do on this screen is click on the <strong>Package Name</strong> search box and click on our <strong>Snake game</strong> option.<div><img alt="Configuring the Google Play developer console" src="img/88590S_09_19.jpg"/></div></li><li class="listitem">Click on <strong>Save and continue </strong>at the top of the screen.</li><li class="listitem">We're <a class="indexterm" id="id746"/>nearing the end of this phase. Click on <strong>Authorize your app now</strong> and review <a class="indexterm" id="id747"/>the information.<div><img alt="Configuring the Google Play developer console" src="img/88590S_09_20.jpg"/></div></li><li class="listitem">Finally, click on <strong>Continue</strong>.<div><img alt="Configuring the Google Play developer console" src="img/88590S_09_21.jpg"/></div></li></ol></div><p>We now <a class="indexterm" id="id748"/>have a Google Game <a class="indexterm" id="id749"/>Services app set up, and linked to our <em>Snake</em> game.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec54"/>Implementing the leaderboard in the Google Play developer console</h3></div></div></div><p>Now <a class="indexterm" id="id750"/>we <a class="indexterm" id="id751"/>need to create our leaderboard in our developer console so that we can later interact with it in our Java code:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in to your developer console.</li><li class="listitem">Click on <strong>Game Services</strong>, then on <strong>Snake</strong>, and then on <strong>Leaderboards</strong>.</li><li class="listitem">Now click on <strong>Add Leaderboard</strong>. This is the <strong>NEW LEADERBOARD</strong> screen:<div><img alt="Implementing the leaderboard in the Google Play developer console" src="img/88590S_09_25.jpg"/></div></li><li class="listitem">This might look like a bit of a marathon ahead, but all we need to do is enter a name (<code class="literal">Snake</code> will do) in the <strong>Name</strong> field, and we are done. It might seem strange entering a name for our leaderboard, but this is because it is possible to <a class="indexterm" id="id752"/>have multiple leaderboards for one game.</li><li class="listitem">Read <a class="indexterm" id="id753"/>through all the options. You will see that they are just right for us and no further action is required. Click on<strong> Save</strong>.</li></ol></div><p>Our leaderboard is now ready to communicate with our <em>Snake</em> app.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec55"/>Implementing the achievements in the Google Play developer console</h3></div></div></div><p>Here, we <a class="indexterm" id="id754"/>will set up in our developer console the achievements that we discussed previously.</p><p>You <a class="indexterm" id="id755"/>might like to prepare some graphics to represent each of these achievements. They need to be 512 x 512 pixels each. Alternatively, you can use an enlarged apple bitmap and perhaps a snake body segment for the apples and snake length achievements, respectively:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in to your developer console. Click on <strong>Game Services</strong>, then on <strong>Snake</strong>, and then on <strong>Achievements</strong>.</li><li class="listitem">Click <a class="indexterm" id="id756"/>on <strong>Add Achievement</strong> and you will see the <strong>New Achievement</strong> screen:<div><img alt="Implementing the achievements in the Google Play developer console" src="img/88590S_09_30.jpg"/></div></li><li class="listitem">As we are implementing the incremental apple achievements, the first thing to do is to enter something in the <strong>New Achievement</strong> form. In the <strong>Name</strong> field, enter <code class="literal">Apple Muncher 1</code>.</li><li class="listitem">In the <a class="indexterm" id="id757"/><strong>Description</strong> field, enter <code class="literal">Munch 10 apples</code>.</li><li class="listitem">Click on the <strong>Add Icon</strong> button and select your preferred 512 x 512 graphic.</li><li class="listitem">Click <a class="indexterm" id="id758"/>on the <strong>Incremental achievements</strong> checkbox and enter <code class="literal">5</code> in the <strong>How many steps are needed</strong> field. This is because the first achievement is for eating 5 apples. This step is shown in the next screenshot:<div><img alt="Implementing the achievements in the Google Play developer console" src="img/88590S_09_31.jpg"/></div></li><li class="listitem">Enter <code class="literal">10</code> for the number of achievement points in the <strong>Points</strong> field.</li><li class="listitem">Click on <strong>Save</strong> and repeat steps 2 to 7 four more times for all the apple achievements, varying the <strong>Name</strong>, <strong>Description</strong>, <strong>How many steps are needed?</strong>, and <strong>Points</strong> fields as per our plans and tables of values for achievements.</li><li class="listitem">Now we can move on to our snake length achievements. Click on <strong>New Achievement</strong>. In the <strong>Name</strong> field, enter <code class="literal">Super Snake 1</code>.</li><li class="listitem">In the <a class="indexterm" id="id759"/><strong>Description</strong> field, enter <code class="literal">Grow your snake to 5 segments</code>.</li><li class="listitem">Click on the <strong>Add Icon</strong> button and browse to your preferred image.</li><li class="listitem">Finally, enter <code class="literal">10</code> for the number of achievement points in the <strong>Points</strong> field.</li><li class="listitem">Click on <strong>Save</strong> and repeat steps 9 to 13 four more times for each of the snake length <a class="indexterm" id="id760"/>achievements, varying the <strong>Name</strong>, <strong>Description</strong>, and <strong>Points</strong> fields as per our plans and tables of values for achievements.</li></ol></div><p>We have now set up our achievements, ready to be implemented in code.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec56"/>Setting up the Snake project ready for implementation</h3></div></div></div><p>What we <a class="indexterm" id="id761"/>will do in this section is prepare our app to communicate with the Google Play servers:</p><div><ol class="orderedlist arabic"><li class="listitem">Add this highlighted code to the <code class="literal">AndroidManifest.xml</code> file, just before the closing <code class="literal">&lt;/application&gt;</code> tag:<div><pre class="programlisting">
<strong>&lt;meta-data android:name="com.google.android.gms.games.APP_ID"</strong>
<strong>    android:value="@string/app_id" /&gt;</strong>
<strong>&lt;meta-data android:name="com.google.android.gms.version"</strong>
<strong>    android:value="@integer/google_play_services_version"/&gt;</strong>

&lt;/application&gt;</pre></div></li><li class="listitem">Create the <code class="literal">ids.xml</code> file in the <code class="literal">values</code> folder in the Project Explorer. Now you need to get your unique code for your game to go to this file. Log in to your developer console, click on <strong>Game Services</strong>, and then click on <strong>Snake</strong>. Now click on <strong>Achievements</strong>.</li><li class="listitem">Just <a class="indexterm" id="id762"/>below your list of achievements is a small <strong>Get resources</strong> link:<div><img alt="Setting up the Snake project ready for implementation" src="img/88590S_09_32.jpg"/></div></li><li class="listitem">Click on the <strong>Get resources</strong> link.<div><img alt="Setting up the Snake project ready for implementation" src="img/88590S_09_33.jpg"/></div></li><li class="listitem">Copy and paste the code into the <code class="literal">ids.xml</code> file. Then click on the <strong>Finished</strong> button in the developer console.</li><li class="listitem">Now we need to get four code files from the Google Play Game Services GitHub <a class="indexterm" id="id763"/>repository. We will copy and paste the files directly into our project.</li><li class="listitem">Create three new empty files in the <code class="literal">java</code> folder. Right-click on <strong>GameActivity</strong> in the project explorer and navigate to <strong>New</strong> | <strong>Java class file</strong>. Name the new file <code class="literal">BaseGameActivity</code>. Repeat this step and name the file <code class="literal">GameHelper</code>. Repeat this once more and name the file <code class="literal">GameHelperUtils</code>.</li><li class="listitem">Now we will get the Java code to copy into the three files we just made. To get the code for <code class="literal">BaseGameActivity.java</code>, visit <a class="ulink" href="https://github.com/playgameservices/android-basic-samples/tree/master/BasicSamples/libraries/BaseGameUtils/src/main/java/com/google/example/games/basegameutils">https://github.com/playgameservices/android-basic-samples/tree/master/BasicSamples/libraries/BaseGameUtils/src/main/java/com/google/example/games/basegameutils</a>, where you can see further links to the code for the three files we created in step 7:<div><img alt="Setting up the Snake project ready for implementation" src="img/88590S_09_34.jpg"/></div></li><li class="listitem">Click on <strong>BaseGameActivity.java</strong> as shown in the preceding screenshot. Select all of the code and copy and paste it into the identically named file that we created in Android Studio. Note that when we created the file, Android Studio created some basic template code. We need to delete all of this, except our package name at the top. When we paste in the copied code, we need to delete the Google package name.</li><li class="listitem">Click on <strong>GameHelper.java</strong>, as shown in the previous screenshot, and repeat step 9.</li><li class="listitem">Click on <strong>GameHelperUtils.java</strong>, as shown in the preceding screenshot, and repeat step 9.</li><li class="listitem">There's <a class="indexterm" id="id764"/>one more file to create. Right-click on the <strong>values</strong> folder in the project explorer. Navigate to <strong>New</strong> | <strong>File</strong>. Name the file <code class="literal">gamehelper_strings.xml</code>.</li><li class="listitem">Get the code that we need for this file in the same way as we did for the previous three Java files from but from this link: <a class="ulink" href="https://github.com/playgameservices/android-basic-samples/blob/master/BasicSamples/libraries/BaseGameUtils/src/main/res/values/gamehelper_strings.xml">https://github.com/playgameservices/android-basic-samples/blob/master/BasicSamples/libraries/BaseGameUtils/src/main/res/values/gamehelper_strings.xml</a>.</li><li class="listitem">Paste the code in <code class="literal">gamehelper_strings.xml</code>, which we created in step 12.</li><li class="listitem">Now change the <code class="literal">MainActivity</code> declaration in the <code class="literal">MainActivity.java</code> file.<p>Consider this code:</p><div><pre class="programlisting">public class MainActivity extends Activity {</pre></div><p>Change it to the following code so that we can now extend the version of Activity that handles all the hard work of the Game Services API:</p><div><pre class="programlisting">public class MainActivity extends BaseGameActivity {</pre></div></li><li class="listitem">Now check out the code in the <code class="literal">GameActivity.java</code> file:<div><pre class="programlisting">public class GameActivity extends Activity {</pre></div><p>Change the preceding code to the following code so that we can now extend the version of Activity that handles all the hard work of the Game Services API:</p><div><pre class="programlisting">public class GameActivity extends BaseGameActivity {</pre></div></li><li class="listitem">Notice that for both Activities, we have an error in the class declaration we just typed. If you hover the mouse cursor over the code we typed in the previous step, you can see the reason. We need to implement some abstract methods <a class="indexterm" id="id765"/>of a class we are using. Recall from <a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work">Chapter 6</a>, OOP – <em>Using Other People's Hard Work</em>, that if a method in a class is declared abstract, then the class that extends it must implement it. That's us! Let's perform an empty implementation for now. Right-click on the line of code with the error and navigate to <strong>Generate</strong> | <strong>Implement Methods</strong>. Now click on <strong>OK</strong>. Perform this step for the <code class="literal">MainActivity.java</code> file and the <code class="literal">GameActivity.java</code> file. Our empty methods are now ready for our code. We will write the code in the next tutorial.</li><li class="listitem">Next, using the project explorer, find the <code class="literal">build.gradle</code> file. Be careful; there are two files with the same name. The file that we need to find is a couple of lines below the <code class="literal">AndroidManifest.xml</code> file. It is highlighted in the next screenshot. Open it by double-clicking on the <code class="literal">build.gradle</code> file:<div><img alt="Setting up the Snake project ready for implementation" src="img/88590S_09_10.jpg"/></div></li><li class="listitem">Find the section of code shown here and add the line that is highlighted. This makes all the classes we downloaded in the previous guide available for use in our <em>Snake</em> game:<div><pre class="programlisting">dependencies {
    <strong>compile 'com.google.android.gms:play-services:+'</strong>
    compile 'com.android.support:appcompat-v7:+'
    compile fileTree(dir: 'libs', include: ['*.jar'])
}</pre></div></li></ol></div><p>Okay, I agree that was a fairly tough tutorial, but we are now ready to implement our code in three final steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Player sign-in and buttons.</li><li class="listitem">Leaderboards.</li><li class="listitem">Achievements.</li></ol></div><p>We will then be <a class="indexterm" id="id766"/>able to upload our updated app and use our new leaderboards and achievements.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec57"/>Implementing the player's sign-in, achievements, and leaderboard buttons</h3></div></div></div><p>By the <a class="indexterm" id="id767"/>end of this section, players will be able to log in through the game to our empty leaderboards and achievements. The guides that <a class="indexterm" id="id768"/>follow this section will actually make the leaderboards and achievements work.</p><div><ol class="orderedlist arabic"><li class="listitem">First, let's <a class="indexterm" id="id769"/>enable our Game Services. All of the work we have done so far in the developer console needs to be published before we can use it. Log in to your developer console. Navigate to <strong>Game Services</strong> | <strong>Snake</strong> | <strong>Ready to publish</strong> | <strong>Publish game</strong>. Then you will be shown a <strong>Publish your game</strong> button. Click on it. Finally, read the brief disclaimer and click on <strong>Publish now</strong>.</li><li class="listitem">Now we need to build a UI that has <strong>Sign in</strong>, <strong>Sign out</strong>, <strong>Leaderboards</strong>, and <strong>Achievements</strong> buttons. Open the <code class="literal">layout_main.xml</code> file and edit it on the <strong>Text</strong> tab of the editor window by adding the following code. Obviously, there is a lot to type. You might like to copy and paste the code from the download package at <code class="literal">Chapter9\EnhancedSnakeGame\layout</code>. Here is the code. Type it in or copy and paste it:<div><pre class="programlisting">&lt;RelativeLayout 
    
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:paddingLeft="@dimen/activity_horizontal_margin"
    android:paddingRight="@dimen/activity_horizontal_margin"
    android:paddingTop="@dimen/activity_vertical_margin"
    android:paddingBottom="@dimen/activity_vertical_margin"
    tools:context="com.packtpub.enhancedsnakegame.enhancedsnakegame.MainActivity"&gt;

    &lt;Button

        android:id="@+id/llPlay"
        android:layout_width="140dp"
        android:layout_height="wrap_content"
        android:text="Leaderboards"
        android:layout_alignParentBottom="true"
        android:layout_alignParentRight="true"
        android:layout_alignParentEnd="true"
        android:visibility="gone"/&gt;

    &lt;Button
        android:id="@+id/awardsLink"
        android:layout_width="140dp"
        android:layout_height="wrap_content"
        android:text="Achievements"
        android:layout_gravity="center_vertical"
        android:layout_alignTop="@+id/llPlay"
        android:layout_toLeftOf="@+id/llPlay"
        android:visibility="gone"/&gt;


    &lt;!-- sign-in button --&gt;
    &lt;com.google.android.gms.common.SignInButton
        android:id="@+id/sign_in_button"
        android:layout_width="140dp"
        android:layout_gravity="center_horizontal"
        android:layout_height="wrap_content"
        android:layout_alignParentTop="true"
        android:layout_alignParentRight="true"
        android:layout_alignParentEnd="true"
         /&gt;

    &lt;!-- sign-out button --&gt;
    &lt;Button
        android:id="@+id/sign_out_button"
        android:layout_width="140dp"
        android:layout_height="wrap_content"
        android:text="Sign Out"
        android:layout_alignParentTop="true"
        android:layout_alignParentRight="true"
        android:layout_alignParentEnd="true"
        android:layout_gravity="center_horizontal"
        android:visibility="gone"
        /&gt;

&lt;/RelativeLayout&gt;</pre></div></li><li class="listitem">Explaining <a class="indexterm" id="id770"/>the code line by line <a class="indexterm" id="id771"/>is beyond the scope of the book, but this is not much different from the code we have been autogenerating when using the UI designer since <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>. Each block of the code in the last step defines a button <a class="indexterm" id="id772"/>and its position on the screen. You can switch to the design tab and move the buttons around to suit yourself. Note that the reason some of the buttons are not visible in the designer is that they are hidden until the player signs in. The reason we have done things this way is to make sure we implement the sign in button in just the right way. Note the <code class="literal">id</code> attribute for each of the buttons. We will be manipulating them in our Java code next. With some buttons set to <code class="literal">visibility = gone</code>, we see something like this:<div><img alt="Implementing the player's sign-in, achievements, and leaderboard buttons" src="img/88590S_09_40.jpg"/></div></li><li class="listitem">With <a class="indexterm" id="id773"/>some buttons set to <code class="literal">visibility = visible</code>, we see something like what is shown in the following <a class="indexterm" id="id774"/>screenshot:<div><img alt="Implementing the player's sign-in, achievements, and leaderboard buttons" src="img/88590S_09_41.jpg"/></div></li><li class="listitem">You might be wondering why we are designing a UI when <code class="literal">SnakeAnimView</code> is what the <a class="indexterm" id="id775"/>user sees. We could have implemented all our own buttons with bitmaps and used their screen coordinates to detect presses, but what we will do now is load our UI on top of <code class="literal">SnakeAnimView</code>, which will greatly simplify things. Switch to the <strong>MainActivity</strong> tab in the editor window.</li><li class="listitem">First of all, we want to implement the <code class="literal">onClickListener</code> interface to handle our button clicks. To achieve this, change the class declaration to this:<div><pre class="programlisting">public class MainActivity extends BaseGameActivity implements View.OnClickListener{</pre></div></li><li class="listitem">Now we can get Android Studio to quickly implement the required <code class="literal">onClick</code> method by right-clicking on the class declaration, navigating to <strong>Add</strong> | <strong>Implement methods</strong>, and then clicking on <strong>OK</strong>.</li><li class="listitem">Immediately <a class="indexterm" id="id776"/>after the <a class="indexterm" id="id777"/>previous line of <a class="indexterm" id="id778"/>code, we declare our four new buttons. Add this code after the code in the previous step:<div><pre class="programlisting">//Our google play buttons
    Button llPlay;
    Button awardsLink;
    com.google.android.gms.common.SignInButton sign_in_button;
    Button sign_out_button;</pre></div></li><li class="listitem">In the <code class="literal">onCreate</code> method, just after the call to the <code class="literal">setContent</code> view, we use an object of the <code class="literal">LayoutInflater</code> class to load our UI on top of our <code class="literal">SnakeAnimView</code>. Add the highlighted code after the call to <code class="literal">setContentView</code>:<div><pre class="programlisting">setContentView(snakeAnimView);

<strong>  //Load our UI on top of our SnakeAnimView</strong>
<strong>  LayoutInflater mInflater = LayoutInflater.from(this);</strong>
<strong>  View overView = mInflater.inflate(R.layout.activity_main, null);</strong>
<strong>  this.addContentView(overView, new ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT));</strong>
</pre></div></li><li class="listitem">Immediately after the code in the previous step, we can get a reference to all our buttons and listen to clicks in the usual way:<div><pre class="programlisting">//game services buttons
        sign_in_button = (com.google.android.gms.common.SignInButton)findViewById(R.id.sign_in_button);
        sign_in_button.setOnClickListener(this);
        sign_out_button = (Button)findViewById(R.id.sign_out_button);
        sign_out_button.setOnClickListener(this);
        awardsLink = (Button) findViewById(R.id.awardsLink);
        awardsLink.setOnClickListener(this);
        llPlay = (Button)findViewById(R.id.llPlay);
        llPlay.setOnClickListener(this);</pre></div></li><li class="listitem">Remember that in the previous guide, we overrode two abstract methods that we inherited when we extended the <code class="literal">BaseGameActivity</code> class. Now we will put some code into their implementation. The code is very straightforward. We <a class="indexterm" id="id779"/>hide the sign <a class="indexterm" id="id780"/>out button and show the <a class="indexterm" id="id781"/>sign in button when the sign-in fails, and we hide the sign in button and show all the other three buttons when the sign-in succeeds. Here are the two methods in their entirety. Type the highlighted code within the methods shown:<div><pre class="programlisting">@Override
    public void onSignInFailed() {
        <strong>// Sign in failed. So show the sign-in button.</strong>
<strong>        sign_in_button.setVisibility(View.VISIBLE);</strong>
<strong>        sign_out_button.setVisibility(View.GONE);</strong>
    }

    @Override
    public void onSignInSucceeded() {
        <strong>// show sign-out button, hide the sign-in button</strong>
<strong>        sign_in_button.setVisibility(View.GONE);</strong>
<strong>        sign_out_button.setVisibility(View.VISIBLE);</strong>
<strong>        llPlay.setVisibility(View.VISIBLE);</strong>
<strong>        awardsLink.setVisibility(View.VISIBLE);</strong>
    }</pre></div></li><li class="listitem">Now we deal with the <code class="literal">onClick</code> method and what happens when the player clicks on any one of our four buttons. First, we type the code for our switch block. We will fill in the <code class="literal">case</code> statements in the next step:<div><pre class="programlisting">switch (v.getId()) {

}</pre></div></li><li class="listitem">Here, we handle the sign in button. We simply call the <code class="literal">beginUserInitiatedSignIn</code> method. It is implemented for us in the <code class="literal">BaseGameActivity</code> class. Type this code in the <code class="literal">switch</code> block from the previous step:<div><pre class="programlisting">    case R.id.sign_in_button:
                // start the sign
                beginUserInitiatedSignIn();
                break;</pre></div></li><li class="listitem">Now we handle what happens when the player signs out. We just call <code class="literal">signOut</code>, which is implemented for us in the <code class="literal">BaseGameActivity</code> class. We then <a class="indexterm" id="id782"/>hide all our <a class="indexterm" id="id783"/>buttons and show <a class="indexterm" id="id784"/>the sign in button again. Type the following code after the code from the previous step:<div><pre class="programlisting">case R.id.sign_out_button:
                // sign out.
                signOut();

                // show sign-in button, hide the sign-out button
                sign_in_button.setVisibility(View.VISIBLE);
                sign_out_button.setVisibility(View.GONE);
                llPlay.setVisibility(View.GONE);
                awardsLink.setVisibility(View.GONE);
                break;</pre></div></li><li class="listitem">Next, we handle what happens when the player clicks on the achievements button. One line of code gives us all of the achievement functionality. This is what OOP is all about—someone else's hard work doing everything for us. Type this code after the preceding code:<div><pre class="programlisting">case R.id.awardsLink:

                startActivityForResult(Games.Achievements.getAchievementsIntent(getApiClient()), 0);

                break;</pre></div></li><li class="listitem">Finally, we handle what happens when the player clicks on the <strong>Leaderboards</strong> button. Again, one line of code gives us all of the leaderboard's functionality:<div><pre class="programlisting">
case R.id.llPlay:
                        startActivityForResult(Games.Leaderboards.getLeaderboardIntent(getApiClient(), getResources().getString(R.string.leaderboard_snake)),0);
                        break;</pre></div></li></ol></div><p>We explained the code as we went, but let's summarize:</p><div><ol class="orderedlist arabic"><li class="listitem">We <a class="indexterm" id="id785"/>designed a simple UI.</li><li class="listitem">We <a class="indexterm" id="id786"/>loaded the UI on top of <code class="literal">SnakeAnimView</code>.</li><li class="listitem">We <a class="indexterm" id="id787"/>got a reference to our four buttons and listened for clicks.</li><li class="listitem">We handled what happens when people click on our buttons, which amounted to nothing more than hiding and showing buttons as appropriate, calling methods from <code class="literal">BaseGameActivity</code>, and using the <code class="literal">Intent</code> class to implement all our leaderboard and achievement functionalities.</li></ol></div><p>You can actually run the <em>Snake</em> game and see the leaderboards and achievements screens. Of course, at this point, nobody will have any achievements or high scores yet. We will fix this now.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec58"/>Implementing the leaderboards in code</h3></div></div></div><p>Once <a class="indexterm" id="id788"/>more, we will witness the simplicity <a class="indexterm" id="id789"/>of using other people's well-designed code. Admittedly, there was some complexity to arrive at this point, but once you have set it all up, then your next game will take a fraction of the time you took setting up:</p><div><ol class="orderedlist arabic"><li class="listitem">We want to submit a score to the <code class="literal">leaderboards</code> at the end of a game. Google Play will handle the process to check whether or not it is a high score. Google Play will even determine if it is a new high score for the week or month. Open the <code class="literal">GameActivity.java</code> file in the code editor window.</li><li class="listitem">Find the <code class="literal">updateGame</code> method and add the highlighted code among all the other things we do when the game is over (when <code class="literal">dead</code> equals <code class="literal">true</code>). We wrap just one line of code within a check to ensure that the current player is signed in:<div><pre class="programlisting">if(dead){
<strong>     if (isSignedIn()) {</strong>
<strong>         Games.Leaderboards.submitScore(getApiClient(),</strong>
<strong>             getResources().getString(R.string.leaderboard_snake), </strong>
<strong>             score);</strong>
<strong>     }</strong>
</pre></div></li><li class="listitem">That's it! Build the game and play it on a real Android device. You can now visit the leaderboards on Google Play and see your high score.</li></ol></div><p>That was nice and easy. Here, we can see the login screen:</p><div><img alt="Implementing the leaderboards in code" src="img/88590S_09_45.jpg"/></div><p>Then comes <a class="indexterm" id="id790"/>the welcome message <a class="indexterm" id="id791"/>and our <strong>Achievements</strong> and <strong>Leaderboards</strong> buttons as shown in the following screenshot:</p><div><img alt="Implementing the leaderboards in code" src="img/88590S_09_46.jpg"/></div><p>Finally, we can see our new leaderboards with just one player—me.</p><div><img alt="Implementing the leaderboards in code" src="img/88590S_09_47.jpg"/></div><p>Just in <a class="indexterm" id="id792"/>case you're wondering, I can do a <a class="indexterm" id="id793"/>lot better than 39.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec59"/>Implementing the achievements in code</h3></div></div></div><p>This <a class="indexterm" id="id794"/>brief tutorial will first set up our <a class="indexterm" id="id795"/>game to post incremental updates to the progress of the apple achievements and the one-off achievement of the snake segment length:</p><div><ol class="orderedlist arabic"><li class="listitem">In the <code class="literal">GameActivity.java</code> file, add an <code class="literal">applesMunchedThisTurn</code> variable just after the class declaration, as shown here:<div><pre class="programlisting">public class GameActivity extends BaseGameActivity {

    int applesMunchedThisTurn;</pre></div></li><li class="listitem">Find the <code class="literal">updateGame</code> method.</li><li class="listitem">Add a line of code to increment <code class="literal">applesMunchedThisTurn</code> each time an apple is eaten by adding the highlighted line of code where it is shown:<div><pre class="programlisting">//Did the player get the apple
            if(snakeX[0] == appleX &amp;&amp; snakeY[0] == appleY){
                <strong>applesMunchedThisTurn++;</strong>
                //grow the snake
                snakeLength++;
                //replace the apple
                getApple();
                //add to the score
                score = score + snakeLength;
                soundPool.play(sample1, 1, 1, 0, 0, 1);
            }</pre></div></li><li class="listitem">Notice that we place this highlighted line among the code that executes when the <a class="indexterm" id="id796"/>player dies (the <code class="literal">if(dead)</code> block). We could do it at the point the player eats an apple, but if we send five messages to the Google Play servers every time the player eats an apple, we might risk Google considering it as spam. We simply increment each achievement by the number of apples that have been eaten, and then reset the <code class="literal">applesMunchedThisTurn</code> variable to zero. We wrap our achievement method calls with a check that the player is signed in and <a class="indexterm" id="id797"/>that <code class="literal">applesMunchedThisTurn</code> is greater than zero. Now add the highlighted code:<div><pre class="programlisting">if(dead){
//start again
<strong>if (isSignedIn())</strong>
<strong>if(applesMunchedTisTurn &gt; 0){//can't increment zero</strong>
    <strong>Games.Achievements.increment(getApiClient(), getResources().getString(R.string.achievement_apple_muncher_1), applesMunchedThisTurn);</strong>
<strong>    Games.Achievements.increment(getApiClient(), getResources().getString(R.string.achievement_apple_muncher_2), applesMunchedThisTurn);</strong>
<strong>    Games.Achievements.increment(getApiClient(), getResources().getString(R.string.achievement_apple_muncher_3), applesMunchedThisTurn);</strong>
<strong>    Games.Achievements.increment(getApiClient(), getResources().getString(R.string.achievement_apple_muncher_4), applesMunchedThisTurn);</strong>
<strong>    Games.Achievements.increment(getApiClient(), getResources().getString(R.string.achievement_apple_muncher_5), applesMunchedThisTurn);</strong>
<strong>    applesMunchedThisTurn = 0;</strong>
<strong>}//end if(applesMunchedThisTurn &gt; 0)</strong>


    Games.Leaderboards.submitScore(getApiClient(), getResources().getString(R.string.leaderboard_snake),score);
 
}//end if(isSignedIn)
               soundPool.play(sample4, 1, 1, 0, 0, 1);
                score = 0;
                getSnake();

            }

        }</pre></div></li><li class="listitem">Now <a class="indexterm" id="id798"/>we will handle the segment length achievements. In the <code class="literal">updateGame</code> method, in the part of the code that executes when the player eats an apple, just after the line of code that increments <code class="literal">snakeLength</code>, we test for any of the lengths that warrant a Super Snake achievement. When the desired length is achieved (5, 10, 25, 35, or 50 segments), we ask Google Play to award it (if it hasn't been awarded yet). We wrap our achievement method calls with a check that the player is <a class="indexterm" id="id799"/>signed in and that at least one apple has been eaten. The highlighted code is the new code to add:<div><pre class="programlisting">//grow the snake
snakeLength++;
<strong>if (isSignedIn()){</strong>
<strong>if(applesMunchedThisTurn &gt; 0) {//can't increment by zero</strong>
<strong>                //Are we long enough for a new SuperSnake achievement?</strong>
<strong>                if(snakeLength == 5){</strong>
<strong>                    Games.Achievements.unlock(getApiClient(), getResources().getString(R.string.achievement_super_snake_1));</strong>
<strong>                }</strong>
<strong>                if(snakeLength == 10){</strong>
<strong>                    Games.Achievements.unlock(getApiClient(), getResources().getString(R.string.achievement_super_snake_2));</strong>
<strong>                }</strong>
<strong>                if(snakeLength == 25){</strong>
<strong>                    Games.Achievements.unlock(getApiClient(), getResources().getString(R.string.achievement_super_snake_3));</strong>
<strong>                }</strong>
<strong>                if(snakeLength == 35){</strong>
<strong>                    Games.Achievements.unlock(getApiClient(), getResources().getString(R.string.achievement_super_snake_4));</strong>
<strong>                }</strong>
<strong>                if(snakeLength == 50){</strong>
<strong>                    Games.Achievements.unlock(getApiClient(), getResources().getString(R.string.achievement_super_snake_5));</strong>
<strong>                }</strong>
<strong>}</strong>
</pre></div></li><li class="listitem">That's it! You <a class="indexterm" id="id800"/>can now play <a class="indexterm" id="id801"/>the game and earn achievements:<div><img alt="Implementing the achievements in code" src="img/88590S_09_48.jpg"/></div></li></ol></div><p>Again, that was nice and easy. You can probably see how simple it would be to implement all other achievement ideas that we discussed earlier in the chapter. Let's move on and update our game on Google Play.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec60"/>Uploading the updated Snake game to Google Play</h3></div></div></div><p>This is <a class="indexterm" id="id802"/>nice and easy and is performed as follows:</p><div><ol class="orderedlist arabic"><li class="listitem">First, we <a class="indexterm" id="id803"/>need to let Google Play know this is a new version. We do this by changing the version number. Open the <code class="literal">Build.gradle</code> file and find these lines of code:<div><pre class="programlisting">versionCode 1
        versionName "1.0"
Change them to the following:
versionCode 2
        versionName "1.1"</pre></div></li><li class="listitem">Build your APK in the usual way.</li><li class="listitem">Log in to your developer console.</li><li class="listitem">Click on <strong>Snake Game 1.0</strong>, then on <strong>APK</strong>, and then on <strong>Upload new APK to production</strong>.</li><li class="listitem">Go to your newly updated APK.</li><li class="listitem">In the <strong>What's new in this version</strong> field, enter <code class="literal">Added leaderboards and achievements</code>.</li><li class="listitem">Click on <strong>Publish now to production</strong>.</li></ol></div><p>From now <a class="indexterm" id="id804"/>onwards, everyone who downloads <a class="indexterm" id="id805"/>your game will get the updated version. With our first game, complete with sprite sheet animations, leaderboards and achievements, it is time to take a break and do a little theory.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec68"/>What next?</h1></div></div></div><p>You should be proud of your creations to date, especially if this was your first attempt at programming. If some of the concepts, syntax, or projects are still not clear, then consider revisiting them after a break.</p><p>The one thing we haven't talked about is the even more new skills we need to progress further. The reason for this is that it very much depends on your initial motivation for reading this book.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec92"/>Getting a programmer's job</h2></div></div></div><p>If you <a class="indexterm" id="id806"/>want to be a Java employee, that is, working full time with a professional capacity for a medium or large company, then you will probably need a college degree, and this book hopefully has given you a glimpse into the world of programming and Java itself. If this describes you, then for further study, you could consider a more formal Java book, followed by a pure OOP book about object-oriented analysis and design. You could then move on to study design patterns.</p><p>Some of the best books that fit into these categories are <em>Head First Object-Oriented Analysis and Design: A Brain Friendly Guide to OOA&amp;D, Brett McLaughlin and Gary Pollice; Head First Design Patterns</em>; <em>Eric Freeman and Elisabeth Robson</em>, <em>O'Reilly</em>; and <em>Design Patterns CD: Elements of Reusable Object-Oriented Software</em>, <em>Erich Gamma, Richard Helm, Ralph Johnson, and John Vlissides</em>, <em>Addison Wesley</em>. The first two are very beginner-friendly. The latter is highly regarded but a much more challenging read for a beginner.</p><p>My guess is that most likely, you didn't pick up a beginners' book on games and Java because you <a class="indexterm" id="id807"/>were headed in that direction, so let's consider our <em>piece de resistance</em> so far—our Snake game.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec93"/>Building bigger and better games</h2></div></div></div><p>If you compare our <a class="indexterm" id="id808"/>Snake game to a modern, professional title, even a two-dimensional game, never mind a modern big-budget First Person Shooter (FPS), then we still have a lot of learning to do. Let's consider some inadequacies of our <em>Snake</em> game compared to a professional game.</p><p>Think about our flower and tail animations. They worked because we set up a crude timing system within our <code class="literal">controlFPS</code> method. But what if we had a dozen or more game objects that needed to be animated?</p><p>Then what if they all had different frame counts and frame rates? We can further complicate things if some of the animations need to work on a loop and others need to reverse through each frame before restarting.</p><p>Now imagine a character that has to jump. How do we synchronize whatever frame happens to be displayed at the time the player jumps?</p><p>Actually, all of these problems and more are solvable with a quick web search and some study. The point is that things are starting to get fairly complicated, and we have only talked about animation.</p><p>What about physics? How will objects in our future games behave when they bounce? We were able to cheat with our Squash game because the environment and the objects were few and simple. What if the ball was round and there were lots of objects of different sizes and shapes, some moving fast and some stationary? How would we simulate this physics model?</p><p>Again, the answers are all out there but they add complexity. What about other environmental factors such as light and shadow? What happens when our screen needs to scroll to the left and right? What about up and down?</p><p>Now consider all of these problems and imagine implementing a solution in a virtual three-dimensional world. Once again, the solutions are out there, but it would take a determined beginner many months to implement their own solution using the raw mathematics involved in three-dimensional calculations.</p><p>Next, imagine that you want your new three-dimensional, physics-based, superbly animated game to be available on Android, Apple, and PC platforms.</p><p>If I have discouraged you from seeking some of these solutions but you are fascinated to find out the answer, then my advice would be to go and find it out anyway. It will definitely be a fascinating journey and make you a better game developer. Think twice, however, before implementing any of this stuff for any reason other than curiosity, self-improvement, or fun.</p><p>The reason for this is because we are not the first people to have these and many other problems—the solutions have already been implemented. And guess what? We can use those solutions, often at no cost to ourselves.</p><p>For example, there is a library called OpenGL that has one purpose—drawing in a three-dimensional coordinate system. It has classes and methods for everything you will ever need. There is even a version of OpenGL for mobile, called OpenGL ES, that you can program in Java. It is true that OpenGL has some complexities of its own, but they can be learned in a logical and straightforward manner from easy to hard.</p><p>If you got this far with this book, take a quick refresher on <a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work">Chapter 6</a>, <em>OOP – Using Other People's Hard Work</em>, and then grab a copy of <em>OpenGL ES2 for Android</em>, <em>K. Brothaler</em>, <em>Pragmatic Bookshelf</em>. The <a class="indexterm" id="id809"/>book explores the code library and some of the mathematics behind it, so it should satisfy both the curious and the purely practical reader. Alternatively, you can check out loads of free tutorials at <a class="ulink" href="http://www.learnopengles.com/">http://www.learnopengles.com/</a>.</p><p>If you just want to make more games and are not particularly fussed about the three-dimensional features, then the next logical step would be a Java-based game library. There are many, but one in particular uses pure Java to build games on Android, iPhone, PC, and the Web.</p><p>Indeed, you can build one Java game and it will run on almost any device in the world, even a web page. It also has classes that simplify the use of the aforementioned OpenGL ES. The library is called <a class="indexterm" id="id810"/>LibGDX, and I had loads of fun making a platform game following along with <em>Learning Libgdx Game development</em> (<a class="ulink" href="https://www.packtpub.com/game-development/learning-libgdx-game-development">https://www.packtpub.com/game-development/learning-libgdx-game-development</a>). LibGDX also solves all our animation, scrolling, and physics conundrums without any math, although it doesn't really address three-dimensional features.</p><div><div><h3 class="title"><a id="tip57"/>Tip</h3><p>Note that both books have some quite in-depth OOP, but this is not out of reach if you understood <a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work">Chapter 6</a>, <em>OOP – Using Other People's Hard Work</em>, and are determined.</p></div></div><p>If you want to go 3D straightaway, then a really fun option is the Unreal Engine. Unreal Engine is used in lots of really big-budget games and can involve immense complexity in another programming language. However, for a way to make two-dimensional and three-dimensional games within a GUI development environment, it is probably unbeatable. Unreal Engine 4 uses a system called Blueprint, where you can drag and drop elements of flow chart-like <a class="indexterm" id="id811"/>elements, instead of coding. It still uses all the concepts of OOP as well as loops and branching, but you can do loads without a single line of <em>real</em> code. Take a look at the Unreal Engine version of Flappy Bird created without a single line of code, at <a class="ulink" href="https://play.google.com/store/apps/details?id=com.epicgames.TappyChicken">https://play.google.com/store/apps/details?id=com.epicgames.TappyChicken</a>.</p><p>Unreal Engine can also build games for multiple platforms, but unfortunately, there is a small monthly fee, and most restrictively of all, any commercial project you make will be subject to an agreement. Here, you pay 30 percent to Epic games, but for learning and having fun, it probably can't be beaten.</p><p>Alternatively, take a look at my blog (<a class="ulink" href="http://www.gamecodeschool.com">www.gamecodeschool.com</a>), where I regularly add articles and fun game building guides aimed at beginner to intermediate game programmers. My blog discusses lots of different programming languages, target platforms, all the tools previously mentioned, and more.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec69"/>Self-test questions</h1></div></div></div><p>Q1) Try to implement local high scores on the device.</p><p>Q2) How many eminent computer scientists have made cameo appearances in the code throughout this book?</p><p>Q3) As a final challenge, try to beat my high score on the Snake leaderboards.</p></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec70"/>Summary</h1></div></div></div><p>In this chapter, we covered a lot. We published our <em>Snake</em> game on Google Play. Then we added some online leaderboards and achievements. We also updated our publication. The process showed how very complicated tasks such as communication over the Internet can be made really simple using an API.</p><p>While putting the finishing touches to this book, I watched a YouTube video of a lecture from John Carmack, a software legend. He was a key engineer in the development of the <em>Doom</em> game, which was published in June 1995. I had to laugh, as did his audience, when he explained that while in school, he felt he was missing out on the technology revolution, and by the time he was old enough to work, it would all be over.</p><p>It is certainly true that lots of technology revolutions have come and many have gone. At least, many of the early adopters' opportunities have faded. John Carmack explained that there is always going to be another revolution just around the corner.</p><p>So you are probably going to develop your skills and watch out for the next big thing. Or perhaps, you just want a bit of fun programming anything in any language for any platform.</p><p>I hope you have enjoyed our journey through Android and Java, and that you will continue this journey as well. I sincerely wish you well, whichever path you choose for your future. Feel free to come and share your experiences and knowledge at <a class="ulink" href="http://www.gamecodeschool.com">www.gamecodeschool.com</a>. The perfect sequel to this book will be published mid 2015 called <em>Android Game Programming by Example</em>.</p></div>
<div><div><div><div><h1 class="title"><a id="app"/>Appendix A. Self-test Questions and Answers</h1></div></div></div><p>Here, we have included some questions you could ask yourself to see whether you have understood each chapter. Don't worry! The answers are also included.</p><div><div><div><div><h1 class="title"><a id="ch09lvl1sec71"/>Chapter 2</h1></div></div></div><p>Q1) What <a class="indexterm" id="id812"/>should you do if all this talk of life cycles, classes, and methods is a bit confusing?</p><p>A) Don't worry about them. Understanding comes a bit at a time, and if they are not entirely clear at this stage, it will not hold you back from thoroughly learning Java, and all will become clearer as we progress.</p><p>Q2) What exactly is a Java class?</p><p>A) Classes are a fundamental building block of Java programs. They are like containers for our Java code, and we can even use other people's classes to simplify the programs we write, even without seeing or understanding the code contained within those classes.</p><p>Q3) What is the difference between a method and a class?</p><p>A) Methods are contained within classes and represent the specific functionality of the class, like another container within a container. As an example from a game, we might have a <code class="literal">Tank</code> class with <code class="literal">shoot</code>, <code class="literal">drive</code>, and <code class="literal">selfDestruct</code> methods. We can use a class and its methods by making our own class, as we will in <a class="link" href="ch06.html" title="Chapter 6. OOP – Using Other People's Hard Work">Chapter 6</a>, <em>OOP – Using Other People's Hard Work</em>, or by using the <code class="literal">@import</code> statement as we did earlier in this chapter.</p><p>Q4) Take a look at the Android developer site and its more technical explanation of the lifecycle phases, at <a class="ulink" href="http://developer.android.com/reference/android/app/Activity.html">http://developer.android.com/reference/android/app/Activity.html</a>. Can you see the phase and its related method that we haven't discussed? When would it be triggered in an app? What is the precise pathway an activity takes from creation to destruction?</p><p>A) It's the restarting phase. Its corresponding method is <code class="literal">onRestart</code>. It is triggered when an app has been stopped and then restarted. We won't need the <code class="literal">onRestart</code> method in this book, but this exercise hopefully helped clarify the concept of life cycles. The precise pathway will vary; we just need to handle the phases that are relevant to our game. So far, we have just tinkered with <code class="literal">onCreate</code>.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec72"/>Chapter 3</h1></div></div></div><p>Q1) What does this code do?</p><div><pre class="programlisting">// setContentView(R.layout.activity_main);</pre></div><p>A) Nothing, because it is commented out with //.</p><p>Q2) Which of these <a class="indexterm" id="id813"/>lines causes an error?</p><div><pre class="programlisting">String a = "Hello";
String b = " Vinton Cerf";
int c = 55;
a = a + b
c = c + c + 10;
a = a + c;
c = c + a;</pre></div><p>A) The fourth line, <code class="literal">a = a + b</code>, has no semicolon, so it will cause an error. The last line, <code class="literal">c = c + a;</code>, will also cause an error because you cannot assign a string to an <code class="literal">int</code> value.</p><p>Q3) We talked a lot about operators and how different operators can be used together to build complicated expressions. Expressions, at a glance, can sometimes make code look complicated. However, when looked at closely, they are not as tough as they seem. Usually, it is just a case of splitting the expressions into smaller pieces to work out what is going on. Here is an expression that is more convoluted than anything else you will ever meet in this book. As a challenge, can you work out what <code class="literal">x</code> will be?</p><div><pre class="programlisting">int x = 10;
int y = 9;
boolean isTrueOrFalse = false;
isTrueOrFalse = (((x &lt;=y)||(x == 10))&amp;&amp;((!isTrueOrFalse) || (isTrueOrFalse)));</pre></div><p>A) You can run the <code class="literal">SelfTestC3Q3</code> project in the <code class="literal">Chapter3</code> folder of the code bundle to check out the answer in the console, but <code class="literal">isTrueOrFalse</code> evaluates to true; here's why.</p><p>First, let's break down the nasty line into manageable sections defined by the brackets:</p><div><pre class="programlisting">((x &lt;=y)||(x == 10))</pre></div><p>Previously, we were asking the question, "is <code class="literal">x</code> less than or equal to <code class="literal">y</code> or is <code class="literal">x</code> exactly equal to <code class="literal">10</code>?". Clearly, <code class="literal">x</code> is not equal to or less than <code class="literal">y</code> but <code class="literal">x</code> is exactly equal to <code class="literal">10</code>, so our use of the logical OR operator, <code class="literal">||</code>, in the middle causes the entire part of the expression to evaluate to <code class="literal">true</code>.</p><p>&amp;&amp;</p><p>Both sides of an <code class="literal">&amp;&amp;</code> operator must evaluate to <code class="literal">true</code> for the overall expression to be true. So let's look at the other side:</p><div><pre class="programlisting">((!isTrueOrFalse) || (isTrueOrFalse)))</pre></div><p>Well, <code class="literal">isTrueOrFalse</code> is a Boolean. It can only be true or false so this part of the expression must be true because we are essentially asking, "is <code class="literal">isTrueOrFalse</code> false or is <code class="literal">isTrueOrFalse</code> true?". It must be one or the other. So, regardless of how we initialized <code class="literal">isTrueOrFalse</code>, the last part of the expression will be true.</p><p>So the overall expression <a class="indexterm" id="id814"/>evaluates to <code class="literal">true</code>, and <code class="literal">true</code> is assigned to <code class="literal">isTrueOrFalse</code>.</p></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec73"/>Chapter 4</h1></div></div></div><p>Q1) What is wrong with this method?</p><div><pre class="programlisting">void doSomething(){
  return 4;
}</pre></div><p>A) It returns a value but has a <code class="literal">void</code> return type.</p><p>Q2) What will <code class="literal">x</code> be equal to at the end of this code snippet?</p><div><pre class="programlisting">int x=19;
do{
  x=11;
  x++;
}while(x&lt;20)</pre></div><p>A) Okay, this was a slightly tricky question. Regardless of the value of <code class="literal">x</code>, the <code class="literal">do</code> block always executes at least once. Then <code class="literal">x</code> is set to <code class="literal">11</code>, and after that, it is incremented to <code class="literal">12</code>. So when the <code class="literal">while</code> expression is evaluated, it is true and the <code class="literal">do</code> block executes again. Once more, <code class="literal">x</code> is set to <code class="literal">11</code> and then incremented to <code class="literal">12</code>. The program is stuck in a never-ending (infinite) loop. This code is most likely a bug.</p></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec74"/>Chapter 5</h1></div></div></div><p>Q1) Suppose we wanted to have a quiz where the question could be about naming the president, the capital city, and so on. How would we do this with multidimensional arrays?</p><p>A) We would just make the inner array hold three strings, perhaps like this:</p><div><pre class="programlisting">String[][] countriesCitiesAndPresidents;
//now allocate like this
countriesAndCities = new String[5][3];
//and initialize like this
countriesCitiesAndPresidents [0][0] = "United Kingdom";
countriesCitiesAndPresidents [0][1] = "London";
countriesCitiesAndPresidents [0][3] = "Cameron";//at time of writing</pre></div><p>Q2) In our persistence example, we saved a continually updating string to a file so that it persisted after the app had <a class="indexterm" id="id815"/>been shut down and restarted. This is like asking the user to click on a <strong>Save</strong> button. Summoning all your knowledge of <a class="link" href="ch02.html" title="Chapter 2. Getting Started with Android">Chapter 2</a>, <em>Getting Started with Android</em>, can you think of a way to save the string without saving it by the button click but just when the user quits the app?</p><p>A) Override the <code class="literal">onPause</code> life cycle method and put the code to save the string in there, like this:</p><div><pre class="programlisting">@Override
    protected void onPause() {
        editor.putString(stringName, currentString);
        editor.commit();
    }</pre></div><p>Q3) Other than increasing the difficulty level, how could we make the memory game harder?</p><p>A) We could simply alter the pause in our thread execution to mention a lower number, giving the player less thinking time, like this:</p><div><pre class="programlisting">myHandler.sendEmptyMessageDelayed(0, 450);
//This halves the players thinking time</pre></div><p>Q4) Using the plain Android UI with the dull grey buttons isn't very exciting. Take a look at the UI elements in the visual designer. Can you work out how to use an image for our button background?</p><p>A) Simply add some <code class="literal">.png</code> graphics to the <code class="literal">drawable-mdpi</code> folder and then find the background property in the <strong>Properties</strong> window while your button is selected. Click to edit the property in the usual way and choose the graphic you added to the <code class="literal">drawable-mdpi</code> folder.</p></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec75"/>Chapter 6</h1></div></div></div><p>Q1) What is encapsulation?</p><p>A) Encapsulation is the way we pack our variables, code, and methods in a manner that exposes just the parts and functionality we want to the parts of our app (or any app that uses our classes) that we want.</p><p>Q2) I don't get all this, and actually, I have more questions now than I had at the start of the chapter. What should I do?</p><p>A) You know enough about <a class="indexterm" id="id816"/>OOP to make significant progress with games and any other type of Java programming. If you are desperate to know more OOP right now, there are plenty of highly rated books that discuss nothing but OOP. However, practice and familiarity with the syntax will go a long way to achieving the same thing and will probably be more fun. The deciding factor in whether you rush off and learn the intricate details of OOP now will really depend on your personal goals and what you want to do with your programming skills in the future. Read the last few pages of <a class="link" href="ch09.html" title="Chapter 9. Making Your Game the Next Big Thing">Chapter 9</a>, <em>Making Your Game the Next Big Thing</em>, for more discussion.</p></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec76"/>Chapter 7</h1></div></div></div><p>Q1) The speed of the ball is calculated in pixels. Different devices have different numbers of pixels. Can you explain how to make the ball speed approximately the same on different screen resolutions?</p><p>A) A simple way to accommodate different screen resolutions would be to devise a system that that takes into account the number of pixels the screen has. We have already done this for the racket and ball sizes. We could declare a member variable like this:</p><div><pre class="programlisting">int pixelsPerFrameX;
int pixelsPerFrameY;</pre></div><p>We could then initialize these variables in <code class="literal">onCreate</code> after we have obtained the screen dimensions:</p><div><pre class="programlisting">pixelsPerFrameX = screenWidth/50;
pixelsPerFrameY = screenHeight/50;</pre></div><p>Then we can move our ball a bit, like this:</p><div><pre class="programlisting">//moving in adjust our x any positions
            if (ballIsMovingDown) {
                ballPosition.y += pixelsPerFrameX;
            }

            //etc...</pre></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec77"/>Chapter 8</h1></div></div></div><p>Q1) What about a visual improvement for our game screen, perhaps a nice, light green grassy background instead of just black?</p><p>A) You can use most graphics programs such as Gimp or Photoshop to get the RGB value of a nice, light green grassy color. Alternatively, you can use an online color picker such as <a class="ulink" href="http://www.colorpicker.com/">http://www.colorpicker.com/</a>. Then look at this line in our <code class="literal">drawGame</code> method:</p><div><pre class="programlisting">canvas.drawColor(Color.BLACK);//the background</pre></div><p>Change it to the following line:</p><div><pre class="programlisting">canvas.drawColor(Color.argb(255,186,230,177));//the background</pre></div><p>Q2) How about adding some <a class="indexterm" id="id817"/>nice flowers to the background?</p><p>A) Here is the way to do this. Create a flower bitmap (or use mine), load it, and scale it in the usual way, in the <code class="literal">configureDisplay</code> method. Decide how many flowers to draw. Choose and store locations on the board in the <code class="literal">SnakeView</code> constructor (or write and call a special method, perhaps <code class="literal">plantFlowers</code>).</p><p>Draw them before the snake and the apple in the <code class="literal">drawGame</code> method. This will ensure that they can never hide an apple or a part of the snake. You can see my specific implementation in the methods mentioned and a copy of the flower bitmap in the <code class="literal">EnhancedSnakeGame</code> project in the <code class="literal">Chapter8</code> folder.</p><p>Q3) If you're feeling brave, make the flowers sway. Think of sprite sheets. The theory is exactly the same as that of the animated snake head. We just need a few lines of code to control the frame rate separately from the game frame rate.</p><p>A) Take a look at the new code in the <code class="literal">controlFPS</code> method. We simply set up a new counter for flower animations to switch flower frames once every six game frames. You can also copy the sprite sheet from the <code class="literal">EnhancedSnakeGame</code> project in the <code class="literal">Chapter8</code> folder.</p><p>Q4) We could set up another counter and use our snake head animation, but it wouldn't be that useful because the subtle tongue movements would be barely visible due to the smaller size. Nevertheless, we could quite easily swish the tail segment.</p><p>A) There is a two-frame tail bitmap in the <code class="literal">EnhancedSnakeGame</code> project in the <code class="literal">Chapter8</code> folder. As this is also two frames, we could use the same frame timer as that used for the flower. Take a look at the implementation in the <code class="literal">EnhancedSnakeGame</code> project in the <code class="literal">Chapter8</code> folder. The only required changes are in <code class="literal">configureDisplay</code> and <code class="literal">drawGame</code>.</p><p>Q5) Here is a slightly trickier enhancement. You can't help notice that when the snake sprites are headed in three out of the four possible directions, they don't look right. Can you fix this?</p><p>A) We need to rotate them depending upon the way they are heading. Android has a <code class="literal">Matrix</code> class, which allows us to easily rotate Bitmaps, and the <code class="literal">Bitmap</code> class has an overloaded version of the <code class="literal">createBitmap</code> method that takes a <code class="literal">Matrix</code> object as an argument.</p><p>So we can create a matrix for each angle we need to handle, like this:</p><div><pre class="programlisting">Matrix matrix90 = new Matrix();
matrix90.postRotate(90);</pre></div><p>Then we can rotate a bitmap using the following code:</p><div><pre class="programlisting">rotatedBitmap = Bitmap.createBitmap(regularBitmap , 0, 0, regularBitmap .getWidth(), regularBitmap .getHeight(), matrix90, true);</pre></div><p>Another problem is that as <a class="indexterm" id="id818"/>the snake twists and turns, how do we keep track of the individual orientation of each segment? We already have a direction finding scheme: 0 is up, 1 is right, and so on. So we can just create another array for the orientation of each segment that corresponds to a body segment in the <code class="literal">snakeX</code> and <code class="literal">snakeY</code> arrays. Then all we need to do is to ensure that the head has the correct direction, and update from the back on each frame just as we do for the snake's coordinates. You can see this implemented in the <code class="literal">EnhancedSnakeGame</code> project in the <code class="literal">Chapter8</code> folder.</p><p>The finished project with a few more enhancements is in the <code class="literal">EnhancedSnakeGame</code> project in the <code class="literal">Chapter8</code> folder. This is the version we will be using as a starting point in the next and final chapter. You can also download the game from Google Play at <a class="ulink" href="https://play.google.com/store/apps/details?id=com.packtpub.enhancedsnakegame.enhancedsnakegame">https://play.google.com/store/apps/details?id=com.packtpub.enhancedsnakegame.enhancedsnakegame</a>.</p><div><img alt="Chapter 8" src="img/8859OS_Appendix_01.jpg"/></div><div><img alt="Chapter 8" src="img/8859OS_Appendix_02.jpg"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec78"/>Chapter 9</h1></div></div></div><p>Q1) Try to implement the local high scores on the device.</p><p>A) You already know how to do this. Just go back to <a class="link" href="ch05.html" title="Chapter 5. Gaming and Java Essentials">Chapter 5</a>, <em>Gaming and Java Essentials</em> in case you are unsure. The implementation is in the code for this chapter's project as well.</p><p>Q2) How many eminent <a class="indexterm" id="id819"/>computer scientists have made cameo appearances in the code throughout this book?</p><p>A) 9</p><p>Ada Lovelace</p><p>Charles Babbage</p><p>Alan Turing</p><p>Vinton Cerf</p><p>Jeff Minter</p><p>Corrine Yu</p><p>André LaMothe</p><p>Gabe Newell</p><p>Sid Meier</p><p>Why not search on the Web <a class="indexterm" id="id820"/>for some of these names? There are some interesting stories about each of them.</p></div></body></html>