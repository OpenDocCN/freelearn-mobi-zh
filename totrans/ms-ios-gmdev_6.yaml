- en: Chapter 6. Making Our Game More Efficient
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第六章：使我们的游戏更高效
- en: We have discussed quite a few debugging techniques, and there are a lot of them.
    Not all of them, however, help us when it comes to efficiency. What do we mean
    by efficiency? Your app can run great, but that doesn't mean it's going to cause
    the device to run great. Overheating, extreme battery drain, and other such things
    can ruin the gameplay experience.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经讨论了很多调试技术，而且有很多。然而，并非所有这些技术都能提高效率。我们所说的效率是什么意思？你的应用可以运行得很好，但这并不意味着它会让设备运行得很好。过热、电池耗尽过快以及其他类似的事情可能会破坏游戏体验。
- en: 'With that in mind, let''s get an idea of what we will cover in this chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑到这一点，让我们了解一下本章将涵盖的内容：
- en: Optimizing our game
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 优化我们的游戏
- en: Preventing extreme battery drain
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 防止电池耗尽
- en: Preventing lag (or at least minimizing it)
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 防止卡顿（或至少最小化它）
- en: This is a critical step in your game development, as you don't want people to
    complain and delete your app because it's too laggy (or causes the app to stutter
    because the device is having issues rendering the current scene) or it kills the
    battery.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 这是你游戏开发中的一个关键步骤，因为你不希望人们因为太卡顿（或者因为设备在渲染当前场景时出现问题而导致应用卡顿）或者耗尽电池而抱怨并删除你的应用。
- en: I know you may have never experienced such an issue, but it happens more often
    than not.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 我知道你可能从未遇到过这样的问题，但这种情况比不常见的情况要多。
- en: What would happen if you had downloaded a game that was extremely laggy and
    killed your battery after an hour of gameplay? You'd, no doubt, delete it off
    your phone or request a refund.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你下载了一个非常卡顿的游戏，在玩了一个小时后电池耗尽，会发生什么？毫无疑问，你会从手机上删除它或要求退款。
- en: So, let's dive into how we can optimize things!
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，让我们深入了解如何优化这些内容！
- en: Managing effects
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 管理效果
- en: As we've been programming our game so far, we have been haphazardly creating
    without thinking about how our effects will run on older devices.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们一直在随意编写代码，没有考虑我们的效果在旧设备上的运行情况。
- en: Have no fear! Because we can detect which device the player is using and adjust
    our particle effects and the number of enemies that will spawn on the screen at
    a time.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 不要害怕！因为我们可以检测玩家正在使用的设备，并调整屏幕上同时出现的粒子效果和敌人数量。
- en: 'To begin, in our `GameLevelScene.m` file, we will add the following line of
    code at the top:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，在我们的 `GameLevelScene.m` 文件中，我们将在顶部添加以下代码行：
- en: '[PRE0]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: This framework will allow us access to detecting the exact device we are working
    on.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 这个框架将允许我们访问检测我们正在工作的确切设备。
- en: 'Just under the `@implementation` line, add the following function:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `@implementation` 行下面，添加以下函数：
- en: '[PRE1]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Now, if you want to see which device appears, you can add the `deviceName()`
    function to the `NSLog` function in our init section, which would look like this:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，如果你想查看哪个设备出现，你可以在初始化部分将 `deviceName()` 函数添加到 `NSLog` 函数中，它看起来像这样：
- en: '[PRE2]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'So, your log will now display the device on which you are running, as shown
    in the following figure:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，你的日志现在将显示你正在运行的设备，如下图所示：
- en: '![Managing effects](img/B03553_06_01.jpg)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![管理效果](img/B03553_06_01.jpg)'
- en: Not sure what **x86_64** means? In this case, because I am running off the simulator,
    **x86_64** will be displayed on a 64-bit iMac, or if you are running a 32-bit
    machine (for older Macs), you will see **i386**.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 不确定 **x86_64** 是什么意思？在这种情况下，因为我正在运行模拟器，**x86_64** 将会在 64 位 iMac 上显示，或者如果你正在运行
    32 位机器（对于较旧的 Mac），你将看到 **i386**。
- en: 'Here''s a breakdown of what will appear for each device:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 下面是每个设备将显示的内容概述：
- en: '**i386** on 32-bit Machine'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**i386** 在 32 位机器上'
- en: '**x86_64** on 64-bit Machine'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**x86_64** 在 64 位机器上'
- en: '**iPod1,1** on iPod Touch'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPod1,1** 在第一代 iPod Touch 上'
- en: '**iPod2,1** on iPod Touch Second Generation'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPod2,1** 在第二代 iPod Touch 上'
- en: '**iPod3,1** on iPod Touch Third Generation'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPod3,1** 在第三代 iPod Touch 上'
- en: '**iPod4,1** on iPod Touch Fourth Generation'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPod4,1** 在第四代 iPod Touch 上'
- en: '**iPhone1,1** on iPhone'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPhone1,1** 在 iPhone 上'
- en: '**iPhone1,2** on iPhone 3G'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPhone1,2** 在 iPhone 3G 上'
- en: '**iPhone2,1** on iPhone 3GS'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPhone2,1** 在 iPhone 3GS 上'
- en: '**iPad1,1** on iPad'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPad1,1** 在 iPad 上'
- en: '**iPad2,1** on iPad 2'
  id: totrans-34
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPad2,1** 在 iPad 2'
- en: '**iPad3,1** on 3rd Generation iPad'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPad3,1** 在第三代 iPad 上'
- en: '**iPhone3,1** on iPhone 4 (GSM)'
  id: totrans-36
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPhone3,1** 在 iPhone 4（GSM）'
- en: '**iPhone3,3** on iPhone 4 (CDMA/Verizon/Sprint)'
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPhone3,3** 在 iPhone 4（CDMA/Verizon/Sprint）'
- en: '**iPhone4,1** on iPhone 4s'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPhone4,1** 在 iPhone 4s'
- en: '**iPhone5,1** on iPhone 5 (model A1428, AT&T/Canada)'
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPhone5,1** 在 iPhone 5（型号 A1428，AT&T/Canada）'
- en: '**iPhone5,2** on iPhone 5 (model A1429, everything else)'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPhone5,2** 在 iPhone 5（型号 A1429，其他所有设备）'
- en: '**iPad3,4** on 4th Generation iPad'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPad3,4** 在第四代 iPad 上'
- en: '**iPad2,5** on iPad Mini'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPad2,5** 在 iPad Mini 上'
- en: '**iPhone5,3** on iPhone 5c (model A1456, A1532 | GSM)'
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPhone5,3** 在 iPhone 5c（型号 A1456, A1532 | GSM）'
- en: '**iPhone5,4** on iPhone 5c (model A1507, A1516, A1526 (China), A1529 | Global)'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPhone5,4** 在iPhone 5c（型号A1507、A1516、A1526（中国）、A1529 | 全球）'
- en: '**iPhone6,1** on iPhone 5s (model A1433, A1533 | GSM)'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPhone6,1** 在iPhone 5s（型号A1433、A1533 | GSM）'
- en: '**iPhone6,2** on iPhone 5s (model A1457, A1518, A1528 (China), A1530 | Global)'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPhone6,2** 在iPhone 5s（型号A1457、A1518、A1528（中国）、A1530 | 全球）'
- en: '**iPad4,1** on 5th Generation iPad (iPad Air) - Wifi'
  id: totrans-47
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPad4,1** 在第5代iPad（iPad Air）- Wifi'
- en: '**iPad4,2** on 5th Generation iPad (iPad Air) - Cellular'
  id: totrans-48
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPad4,2** 在第5代iPad（iPad Air）- Cellular'
- en: '**iPad4,4** on 2nd Generation iPad Mini - Wifi'
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPad4,4** 在第2代iPad Mini - Wifi'
- en: '**iPad4,5** on 2nd Generation iPad Mini - Cellular'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPad4,5** 在第2代iPad Mini - Cellular'
- en: '**iPhone7,1** on iPhone 6 Plus'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPhone7,1** 在iPhone 6 Plus上'
- en: '**iPhone7,2** on iPhone 6'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**iPhone7,2** 在iPhone 6'
- en: Pretty extensive, isn't it? However, it will help when it comes to developing
    for all devices.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 非常全面，不是吗？然而，当涉及到为所有设备开发时，它会很有帮助。
- en: 'Now, we can begin setting up the functions to change our particle emission
    according to the device we are running. For example, as we saw in the previous
    screenshot, we are running **x86_64**, or in other words, a Mac computer. So,
    to test this function (while running our game via the simulator), in our `GameLevelScene.m`
    file, scroll down to the `- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent
    *)event` function and add this block of code just before the `[self addChild:rainEmitter];`
    function where we create our rain emitter:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们可以开始设置根据我们运行的设备来改变我们的粒子发射的功能。例如，正如我们在之前的屏幕截图中所看到的，我们正在运行 **x86_64**，换句话说，就是一台Mac电脑。所以，为了测试这个功能（在通过模拟器运行我们的游戏时），在我们的
    `GameLevelScene.m` 文件中，向下滚动到 `- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent
    *)event` 函数，并在我们创建雨发射器的 `[self addChild:rainEmitter];` 函数之前添加以下代码块：
- en: '[PRE3]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'You can now play with the birthrate number to see what looks good and performs
    well. If you adjust the birthrate and test your project, you will see the particles
    adjust accordingly, as shown in the following screenshot:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 你现在可以调整出生率数字，看看什么看起来好，表现良好。如果你调整出生率并测试你的项目，你会看到粒子相应地调整，如下面的屏幕截图所示：
- en: '![Managing effects](img/B03553_06_02.jpg)'
  id: totrans-57
  prefs: []
  type: TYPE_IMG
  zh: '![管理效果](img/B03553_06_02.jpg)'
- en: For example, in the preceding image, the birth rate is set to `15,000`. While
    it does look like torrential downpours, the frame rate suffers considerably. Keep
    in mind that when I take a screenshot, the framerate does plummet quite a bit,
    but you get the idea that it was averaging about 25fps, because there was such
    an immense amount for the device to render.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，在先前的图像中，出生率设置为 `15,000`。虽然它看起来像是一场倾盆大雨，但帧率会大大下降。请注意，当我截图时，帧率会大幅下降，但你应该明白它平均大约是25fps，因为设备需要渲染的量非常大。
- en: 'Now if we drop it down to `1500`, we see quite a different result:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，如果我们将其降低到 `1500`，我们会看到相当不同的结果：
- en: '![Managing effects](img/B03553_06_03.jpg)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![管理效果](img/B03553_06_03.jpg)'
- en: It doesn't look as torrential as it did previously, but we see a major increase
    in the framerate.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 它看起来不像之前那么猛烈，但我们看到帧率有显著提高。
- en: 'Don''t want to crank down the rain? Let''s try adjusting the fire effects on
    the screen in the same way that we reduced the rain by adding the following code:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 不想增加雨量？让我们尝试以相同的方式调整屏幕上的火焰效果，就像我们通过添加以下代码减少雨量一样：
- en: '[PRE4]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: This drops the original birthrate that was set to `200` down to `100`. While
    a difference of 100 may seem like a huge number, and our particles won't look
    as good; it's just enough to reduce the lag and not affect the visual appeal of
    the flames themselves.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 这将原始的出生率从设置为 `200` 降低到 `100`。虽然100的差异可能看起来像是一个很大的数字，而且我们的粒子看起来不会那么好；但这足以减少延迟，并且不会影响火焰本身的视觉吸引力。
- en: Nice! A solid 60 fps *while* taking the screenshot! It looks pretty good too!
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 很好！截图时稳定的60 fps！看起来也很不错！
- en: '![Managing effects](img/B03553_06_04.jpg)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![管理效果](img/B03553_06_04.jpg)'
- en: Now, let's keep in mind that this is set for the iOS simulator on our Mac, so
    you can even expect the app to run a little differently, but it does give you
    a great idea of how it will perform.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，请记住，这是为我们的Mac上的iOS模拟器设置的，所以你甚至可以期待应用程序的运行会有一些不同，但它确实能给你一个很好的想法，了解它将如何表现。
- en: Hoping that we have already decided which devices we will support on our game,
    we will now add the functions to test the supported devices. For this example,
    I will only support the iPhone 4S and up, including the iPad 4th generation and
    up.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 希望我们已经决定在游戏中支持哪些设备，我们现在将添加测试支持设备的函数。对于这个例子，我将只支持iPhone 4S及以上，包括iPad第4代及以上。
- en: 'The code that would be added to test these devices is as follows:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 测试这些设备要添加的代码如下：
- en: '[PRE5]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: I know it's a lot to have to write and test as well. These numbers were all
    guesstimated, as I don't own all these devices. However, I did run test them on
    each simulator and all of them seemed to run at a solid framerate.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 我知道写和测试这些内容确实很多。这些数字都是估算的，因为我并不拥有所有这些设备。然而，我确实在每个模拟器上测试了它们，并且它们似乎都能以稳定的帧率运行。
- en: We begin with an `if` statement to check which device we are running. If we
    do not detect the device checked, we use an `else if` statement. This will cause
    the code to check the next line for the device. When it finds the running device,
    it will adjust the birth rate accordingly.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从一个 `if` 语句开始，检查我们正在运行哪个设备。如果我们没有检测到检查的设备，我们使用 `else if` 语句。这将导致代码检查下一行以查找设备。当它找到正在运行的设备时，它将相应地调整出生率。
- en: You can do the same when it comes to the fire effects or any other effect that
    you have running in your game.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 当涉及到火焰效果或你在游戏中运行的任何其他效果时，你也可以这样做。
- en: 'You can also limit the amount of enemies being spawned simply by changing your
    update timer function, as shown in the following code:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以通过更改你的更新计时器函数来简单地限制生成的敌人数量，如下面的代码所示：
- en: '[PRE6]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Simply adjusting the `if (self.lastSpawnTimeInterval > 2)` statement to a higher
    number will reduce the amount of enemies being spawned at a time, as we are increasing
    the time we will spawn a new enemy. So, the higher the interval, the longer it
    takes to spawn enemies.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 简单地调整 `if (self.lastSpawnTimeInterval > 2)` 语句到一个更高的数字将减少一次生成的敌人数量，因为我们正在增加生成新敌人的时间。所以，间隔越高，生成敌人所需的时间就越长。
- en: By reducing these simple things, we will greatly improve the performance of
    the device, especially older ones that are getting tired and are unable to perform
    as they used to.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 通过减少这些简单的事情，我们将极大地提高设备的性能，特别是那些变得疲惫且无法像以前那样运行的旧设备。
- en: Remember, better performance (the device not running so hard) equals extended
    battery life, extended play time, and happier customers.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，更好的性能（设备运行不那么费力）等于更长的电池寿命、更长的播放时间和更满意的客户。
- en: There are a plethora of other ways in which we can optimize things; for example,
    as we mentioned earlier in this book, we can look at the sprites we created, and
    if they are large files, we can try saving other formats to save space and make
    it easier for the device to render them.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有其他很多方法可以优化事物；例如，正如我们在本书前面提到的，我们可以查看我们创建的精灵，如果它们是大型文件，我们可以尝试保存其他格式以节省空间，并使设备更容易渲染它们。
- en: You've come here to master iOS development, and you want to learn everything!
    So, let me explain everything.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 你来这里是为了掌握 iOS 开发，你想要学习一切！所以，让我来解释一切。
- en: The first thing we will discuss is how to prevent, or at least how to limit
    the amount our app runs in the background.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先讨论的是如何防止，或者至少如何限制我们的应用在后台运行的数量。
- en: Battery management – doing less in the background
  id: totrans-82
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 电池管理 – 在后台做更少的事情
- en: When the user isn't actively using your game/app, the device will place it into
    a background state. The device may eventually suspend the app if it's not performing
    important tasks, such as finishing a task the user initiated (for example, sending
    photos or updating a newsfeed) or running in a specially declared background execution
    mode.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 当用户没有积极使用你的游戏/应用时，设备会将其置于后台状态。如果应用没有执行重要任务，例如完成用户发起的任务（例如发送照片或更新新闻源）或在特别声明的后台执行模式下运行，设备最终可能会挂起应用。
- en: To save further battery life, your app shouldn't wait to be suspended by the
    device. It should begin pausing activity immediately once the app has notified
    that the state has changed (refer to the following image).
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 为了进一步节省电池寿命，你的应用不应该等待被设备挂起。一旦应用通知状态已更改，它应该立即开始暂停活动（参考以下图像）。
- en: When your app completes any queued tasks, it should notify the device that the
    background activity is complete. Failing to do so causes the app to remain active
    and draw energy unnecessarily, unnecessarily, as can be summed up perfectly in
    the following image:.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 当你的应用完成任何排队的任务时，它应该通知设备后台活动已完成。未能这样做会导致应用保持活跃并浪费不必要的能量，这可以从以下图像中完美总结出来：。
- en: '![Battery management – doing less in the background](img/B03553_06_05.jpg)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![电池管理 – 在后台做更少的事情](img/B03553_06_05.jpg)'
- en: Why don't the batteries last longer? It plagues us all...Well, yes, they are
    improving the battery usage with each new iPhone released, but they are adding
    more things in the OS that drains the battery, so you're not really getting anywhere.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么电池的续航时间不长？这困扰着我们所有人...好吧，是的，随着每一款新iPhone的发布，它们正在改善电池使用效率，但它们在操作系统中添加了更多消耗电池的功能，所以你实际上并没有真正得到任何好处。
- en: 'The *Common Causes of Energy Wasted by Background Apps* section of *The Energy
    Efficiency Guide for iOS App* states:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 《iOS应用能效指南》中的“*后台应用能耗的常见原因*”部分指出：
- en: '*Apps performing unnecessary background activity (like music, Facebook or news
    apps constantly working in the background) waste energy. The following are the
    common causes of wasted energy in background refreshing apps:*'
  id: totrans-89
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*执行不必要的后台活动（如音乐、Facebook或新闻应用在后台持续运行）会消耗能量。以下是在后台刷新应用中浪费能量的常见原因：*'
- en: Not notifying the system when background activity is complete
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在后台活动完成后不通知系统
- en: Playing silent audio
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 播放静音音频
- en: Performing location updates
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 执行位置更新
- en: Interacting with Bluetooth accessories
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与蓝牙配件交互
- en: 'These are all things, regardless of whether you are creating a game or an app,
    that you should keep in mind when developing:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 这些都是无论你是在创建游戏还是应用时，都应该在开发时记住的事情：
- en: '**Notifying the system when background activity is complete**: For apps, if
    you are pulling information from a website, you will need to either pause it until
    the app resumes or set a refresh interval.'
  id: totrans-95
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**在后台活动完成后通知系统**：对于应用，如果你正在从网站获取信息，你需要暂停它直到应用恢复，或者设置一个刷新间隔。'
- en: '**Playing silent audio**: For our games, again, when the app enters the background,
    the sounds and music need to be paused.'
  id: totrans-96
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**播放静音音频**：对于我们的游戏，当应用进入后台时，声音和音乐需要暂停。'
- en: '**Performing location updates**: Have you noticed that annoying arrow icon
    on the status bar? That equals battery drainage. When the app enters the background,
    turn location services off.'
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**执行位置更新**：你是否注意到了状态栏上那个讨厌的箭头图标？那等于电池消耗。当应用进入后台时，关闭位置服务。'
- en: '**Interacting with Bluetooth accessories**: This applies for apps and games,
    especially for something as intensive as Bluetooth speakers or even a Bluetooth
    keyboard or gamepad. Ensure that Bluetooth disconnects and goes into a rest mode
    when the app goes into the background. Don''t forget to resume once the app reenters
    the foreground!'
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**与蓝牙配件交互**：这适用于应用和游戏，特别是对于像蓝牙扬声器甚至蓝牙键盘或游戏手柄这样密集型的设备。确保当应用进入后台时，蓝牙断开连接并进入休眠模式。别忘了当应用重新进入前台时恢复！'
- en: 'Firstly, you can to scan for peripherals, such as bluetooth controllers, or
    other devices only when needed. To do this, use the following block of code:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，你可以在需要时扫描外围设备，例如蓝牙控制器或其他设备。为此，请使用以下代码块：
- en: '[PRE7]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Pretty easy stuff, eh? I know, this is a lot to take in. Trust me, though, this
    is all super important stuff.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 这很简单，对吧？我知道，这需要吸收很多东西。但请相信我，这些都是非常重要的事情。
- en: 'Then, when you are finished with the Bluetooth device, simply use the following
    two methods to disconnect:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，当你完成蓝牙设备的操作后，只需使用以下两个方法来断开连接：
- en: '[PRE8]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: How do you suspend activity when your app becomes inactive or moves to the background?
    Implementing the `UIApplicationDelegate` methods in your app delegate (if it hasn't
    been already, since our app already has this method in the `AppDelegate.m` file)
    will allow the device to receive notifications and suspend activity when your
    app becomes inactive or transitions from the foreground to the background.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 当你的应用变得不活跃或移动到后台时，你如何挂起活动？通过在你的应用代理中实现`UIApplicationDelegate`方法（如果尚未实现，因为我们的应用已经在`AppDelegate.m`文件中实现了这个方法），可以让设备在应用变得不活跃或从前台过渡到后台时接收通知并挂起活动。
- en: The `applicationWillResignActive` method is called when the app enters an inactive
    state, such as when a telemarketer calls you to clean your ducts, a text comes
    in, or the player switches to another app and your app begins the transition to
    a background state.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 当应用进入非活动状态时，会调用`applicationWillResignActive`方法，例如当电话推销员打电话来清理你的通风管道，收到短信，或者玩家切换到另一个应用，你的应用开始过渡到后台状态。
- en: 'This is where you want to pause any activity, save data, and prepare for any
    suspension:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 这是你想要暂停任何活动、保存数据并为任何挂起做好准备的地方：
- en: '[PRE9]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Now, one big thing to keep in mind, is you don't want to rely strictly on saving
    data when the application enters the background. You always want to save data
    at proper points during the gameplay, such as at the end of the level. If you
    rely strictly on saving data during a state change, such as a level change, or
    the player pausing or exiting the game, the game won't save as reliably and the
    poor player could lose some information. For example, let's say you're playing
    your favourite game, but the game only saves when you finish 3 levels, you could
    lose important high score, or collected items. Plus the player wouldn't want to
    have to replay those completed levels.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 现在有一个重要的事情需要记住，那就是当应用进入后台时，你不想仅仅依赖于保存数据。你总是希望在游戏过程中在适当的时机保存数据，比如在关卡结束时。如果你严格依赖于在状态变化时保存数据，比如关卡变化，或者玩家暂停或退出游戏，游戏可能无法可靠地保存，玩家可能会丢失一些信息。例如，假设你正在玩你最喜欢的游戏，但游戏只有在完成3个关卡后才会保存，你可能会丢失重要的高分或收集到的物品。此外，玩家也不希望不得不重玩那些已经完成的关卡。
- en: 'Another state, `applicationDidEnterBackground:` is called as soon as your app
    enters the background. With this method, you can stop operations, animations,
    and update methods immediately, using the following code:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个状态，`applicationDidEnterBackground:`在应用进入后台时立即被调用。使用这个方法，你可以立即停止操作、动画和更新方法，以下代码所示：
- en: '[PRE10]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: This method is only called for a few seconds, so if the app requires more time
    to complete called requests, you would have to request more execution time using
    the `beginBackgroundTaskWithExpirationHandler:` method, which is to be called
    if extra time is required.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 这个方法只调用几秒钟，所以如果应用需要更多时间来完成调用的请求，你将不得不使用`beginBackgroundTaskWithExpirationHandler:`方法请求更多的执行时间，这个方法在需要额外时间时被调用。
- en: When the background tasks are completed, you will be required to call the `endBackgroundTask:`
    method to let the device know the tasks are finished. If you don't call the method,
    iOS will allow the app a little more time to complete any additional functions.
    If any saving or unloading methods don't complete in the additional time iOS provides,
    the app will be suspended.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 当后台任务完成后，你需要调用`endBackgroundTask:`方法来让设备知道任务已完成。如果你不调用该方法，iOS会允许应用有更多的时间来完成任何额外的功能。如果在iOS提供的额外时间内，任何保存或卸载方法没有完成，应用将被挂起。
- en: To expand, if your app is still wrapping up any methods by the time your app
    enters the background and the app becomes suspended, all the important performance
    tweaks, save game, will not occur. Potentially ruining the user's experience.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 进一步来说，如果你的应用在进入后台时仍然在处理任何方法，并且应用被挂起，所有重要的性能调整、保存游戏可能都不会发生，这可能会破坏用户的体验。
- en: Now that we have talked about what to do when the app enters the background,
    it's time to talk about what to do (or how to do it) when the app resumes.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经讨论了当应用进入后台时应该做什么，现在是时候讨论当应用恢复时应该做什么（或如何做）了。
- en: 'We have two methods that will allow us to call any reconnection methods that
    we may have disconnected, such as Bluetooth devices, location services, and many
    more:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有两种方法可以让我们调用可能已经断开连接的任何重新连接方法，例如蓝牙设备、位置服务等等：
- en: '[PRE11]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'This method is called immediately before the app transitions from the background
    to active. Start resuming operations, loading data, reinitializing the User Interface,
    and getting your app ready for the user:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 这个方法在应用从后台过渡到活动状态之前立即被调用。开始恢复操作、加载数据、重新初始化用户界面，并让应用为用户做好准备：
- en: '[PRE12]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The `ApplicationDidBecomeActive` function is called immediately after the app
    becomes an active app after being launched by the device or transitioning from
    a background or inactive state. Essentially, we are fully resuming any operations
    that were halted.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: '`ApplicationDidBecomeActive`函数在应用被设备启动或从后台或非活动状态过渡到活动状态后立即被调用。本质上，我们正在全面恢复任何被中断的操作。'
- en: These functions are a few great things to keep in mind when developing timers,
    Bluetooth connections, and so on.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 这些功能是在开发计时器、蓝牙连接等时需要记住的几个重要事项。
- en: Another thing to keep in mind, is avoiding extreme graphics and animations.
    As you have seen in our game, we haven't used any intensive animations. Instead,
    a majority of our characters have two to four images per animation.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个需要注意的事情是避免使用极端的图形和动画。正如你在我们的游戏中看到的，我们没有使用任何密集的动画。相反，我们的大多数角色每个动画有两到四张图像。
- en: If your app uses only the standard windows and controls, such as an app like
    notes, you don't really need to worry about updates to your content, as the system
    APIs are created with maximum efficiency in mind.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用的是仅包含标准窗口和控制的程序，比如笔记应用，你实际上不需要担心内容更新，因为系统 API 是以最大效率为前提创建的。
- en: If you have custom windows and controls, let's say **Shazam** for example, you
    really have to ensure that the code in which you draw everything is efficient.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用的是自定义窗口和控制，比如**Shazam**，你真的必须确保你绘制所有内容的代码是高效的。
- en: For example, you don't want to be refreshing everything on the screen all the
    time, especially items that are hidden, or even by going overkill on your animations.
    I know they look good, but they do waste battery life.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，你不想总是刷新屏幕上的所有内容，特别是隐藏的项目，或者过度使用动画。我知道它们看起来很好，但它们确实会浪费电池电量。
- en: Keep in mind that every time an app draws images and text to the screen, it
    requires CPU usage, GPU usage, and the screen needs to be active. Ergo, the more
    you are displaying and refreshing, the more the battery will drain, hence why
    certain apps murder battery life.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，每次应用将图像和文本绘制到屏幕上时，都需要 CPU 使用、GPU 使用，并且屏幕需要保持活跃。因此，你显示和刷新的内容越多，电池耗尽得越快，这就是为什么某些应用会耗尽电池寿命的原因。
- en: So you should be mindful of over updating or even inefficient content drawing,
    as it will draw significant power from the battery.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，你应该注意过度更新或甚至低效的内容绘制，因为这会从电池中消耗大量电量。
- en: Here are some more things to keep in mind. You should always reduce the number
    of views that are in the app (all of which will be drawing power from the battery).
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 这里还有一些需要注意的事情。你应该始终减少应用中视图的数量（所有这些都会从电池中消耗电量）。
- en: If you can help it at all, which I know isn't always possible, you should tune
    down the number of onscreen effects you use, such as opacity, transparency, and
    so on. If effects are needed, you should avoid using them on items that refresh
    frequently, as this will again draw battery power because both the opacity objects
    and the content underneath need to be updated.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 如果可能的话，你应该减少屏幕上使用的特效数量，例如不透明度、透明度等。如果需要使用特效，应避免在频繁刷新的项目上使用，因为这会再次消耗电池电量，因为不透明度对象和下面的内容都需要更新。
- en: In regards to animations, use a maximum of 60fps per animation, anything faster
    will be troublesome when rendering, as it will require more CPU/GPU to boost the
    framerate. Also, try to keep all your animation speeds at the same frame rate
    so the engine isn't struggling to render your character at 60fps and an enemy
    at 30fps, for example. While having extra frames in the animation may look great,
    those extra frames are inefficient and will require extra computing, which you
    guessed it, equals more battery drainage.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 关于动画，每个动画最多使用 60fps，任何更快的速度在渲染时都会带来麻烦，因为它需要更多的 CPU/GPU 来提升帧率。此外，尽量保持所有动画速度在相同的帧率，这样引擎就不会在
    60fps 渲染角色和在 30fps 渲染敌人时感到吃力，例如。虽然动画中的额外帧看起来很棒，但这些额外的帧效率低下，需要额外的计算，这会导致更多的电池耗电。
- en: It's even recommended to only use SpriteKit, SceneKit, and Metal when developing
    games, as these frameworks are made to give you the best performance and efficiency.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 在开发游戏时，甚至建议只使用 SpriteKit、SceneKit 和 Metal，因为这些框架是为了提供最佳性能和效率而设计的。
- en: This doesn't mean that you can't use a framework, such as Cocos2d. Cocos2D is
    actually built on top of the SpriteKit framework and is just as easy to use and
    just as powerful.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 这并不意味着你不能使用框架，例如 Cocos2d。实际上，Cocos2D 是建立在 SpriteKit 框架之上的，并且同样易于使用且功能强大。
- en: When testing your app, keep a keen eye set on the debugging tools we discussed
    in the previous chapter.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 在测试你的应用时，请密切关注我们在上一章中讨论的调试工具。
- en: 'Watch out for these signs:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 注意这些迹象：
- en: Battery drain
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 电池耗尽
- en: Activity when you expect your app to be idle
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 当你期望应用处于空闲状态时的活动
- en: An unresponsive or slow user interface
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 响应慢或用户界面不灵敏
- en: Large amounts of work on the main thread
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主线程上的大量工作
- en: High use of animations
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 动画使用量高
- en: High use of view opacity
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 视图不透明度使用量高
- en: Swapping
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 交换
- en: Memory stalls and cache misses
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 内存停滞和缓存未命中
- en: Memory warnings
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 内存警告
- en: Lock contention
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 锁竞争
- en: Excessive context switches
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 过度上下文切换
- en: Excessive use of timers
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定时器使用过度
- en: Excessive drawing to screen
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 过度绘制到屏幕
- en: Excessive or repeated small disk I/O
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 过度或重复的小磁盘 I/O
- en: High-overhead communication, such as network activity with small packets and
    buffers
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 高开销的通信，例如带有小数据包和缓冲区的网络活动
- en: Preventing device sleep
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 防止设备休眠
- en: In the previous chapter, we didn't look at measuring the energy usage with Instruments
    in Xcode.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们没有查看使用Xcode中的Instruments测量能量使用情况。
- en: Instruments provide us with a graphical timeline of the usage on our device.
    You will be able to gather info about the app's CPU usage, network usage, disk
    usage, and the graphic usage.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: Instruments为我们提供了设备使用的图形时间线。您将能够收集有关应用CPU使用、网络使用、磁盘使用和图形使用的相关信息。
- en: By viewing this timeline, you will be able to analyze the performance of your
    app, and glean certain points in your app which may be causing lag, slow downs,
    or potential drops in frame rate so you can make adjustments at those exact moments.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 通过查看这个时间线，您将能够分析您应用的性能，并找出可能导致延迟、减速或帧率下降的某些应用中的点，这样您就可以在这些确切的时刻进行调整。
- en: To access these energy diagnostics, launch Instruments, connect it to your app,
    and then click on the **Energy Diagnostics** template.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 要访问这些能量诊断，启动Instruments，将其连接到您的应用，然后点击**能量诊断**模板。
- en: The **Energy Diagnostics** template monitors factors that affect energy usage
    on an iOS device, as mentioned earlier, including the CPU and network activity,
    screen brightness, and much more. Then, you can see the areas in which the usage
    is highest, and check whether you can reduce the impact in those areas. For example,
    you might find an opportunity to defer certain Bluetooth tasks until more energy-efficient
    times, such as when the device is plugged in or connected to Wi-Fi.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: '**能量诊断**模板监控影响iOS设备能量使用的因素，如前所述，包括CPU和网络活动、屏幕亮度等等。然后，您可以看到使用率最高的区域，并检查您是否可以减少这些区域的影响。例如，您可能会发现将某些蓝牙任务推迟到更节能的时间的机会，比如设备插上电源或连接到Wi-Fi时。'
- en: 'It''s all discretionary; as you start to play with the debugging Instruments,
    you will see what works for you and when is the best time to use certain methods.
    As you can see by the following image, there are so many excellent tools at your
    disposal to make your app the most efficient app possible:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 这都是可选的；当您开始使用调试Instruments时，您将看到哪些方法适合您，以及何时使用这些方法是最合适的。正如您可以从以下图像中看到的那样，您有如此多的优秀工具可供使用，以使您的应用尽可能高效：
- en: '![Battery management – doing less in the background](img/B03553_06_07.jpg)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![电池管理 – 在后台做更少的事情](img/B03553_06_07.jpg)'
- en: With our fantastic game running, click on **Choose a profiling template for**
    and select the device you are running on (which is the only way you can test battery
    usage), then select your app.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的精彩游戏运行时，点击**选择配置文件模板用于**，然后选择您正在运行的设备（这是测试电池使用的唯一方法），然后选择您的应用。
- en: Double-click on the **Energy Diagnostics** profile template. Then, at the top
    of the new window that pops up, click on the red record button to begin recording
    our energy usage. Play your game as you normally would. Don't worry, **Instruments**
    will be recording all your data as you play, so you can focus on looking for bugs
    while recording your energy usage.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 双击**能量诊断**配置文件模板。然后，在新弹出的窗口顶部，点击红色记录按钮开始记录我们的能量使用。像平时一样玩游戏。不用担心，**Instruments**会在您玩游戏时记录所有数据，这样您就可以在记录能量使用情况的同时寻找bug。
- en: Awesome!
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 太棒了！
- en: When you have completed testing, simply click on the **Stop** button or press
    *Command* + *R* to stop recording.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 当您完成测试后，只需单击**停止**按钮或按*Command* + *R*键即可停止记录。
- en: Now, you will have a complete log of all the data that was recorded. Scroll
    through and check whether there are any spikes in the log. If so, go back and
    check the code in those areas where there was a spike to check whether there is
    an issue causing the spike.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您将有一个记录所有已记录数据的完整日志。滚动查看日志中是否有任何峰值。如果有，请返回并检查那些出现峰值的代码区域，以检查是否存在导致峰值的任何问题。
- en: 'As a side note, the energy usage template shows readings from 0-20 which will
    indicate how much your app is using the energy at that time:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一个旁注，能量使用模板显示了从0到20的读数，这将表明您的应用在那时正在使用多少能量：
- en: '![Battery management – doing less in the background](img/B03553_06_08.jpg)'
  id: totrans-163
  prefs: []
  type: TYPE_IMG
  zh: '![电池管理 – 在后台做更少的事情](img/B03553_06_08.jpg)'
- en: If, let's say you have some awesome particles flying around, and you are connected
    to a Bluetooth device during gameplay, you will no doubt see that your energy
    usage is high all the time. This doesn't mean that your app has an issue. It just
    means your app requires more power to run everything you've implemented.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 假设您有一些很棒的粒子在游戏中四处飞舞，并且您在游戏过程中连接了一个蓝牙设备，您无疑会看到您的能量使用始终很高。这并不意味着您的应用有问题。这只意味着您的应用需要更多的电量来运行您所实现的所有功能。
- en: I'll take a certain app I use on a regular basis as an example. The app is from
    a website loaded with some cool and funny photos. Anyways, when I use this app,
    my phone heats up within minutes and the battery level starts to plummet. Does
    this mean something is wrong with the app? No! Especially not when you start to
    figure what the app is doing as you are using it.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 我将以我经常使用的一个应用为例。这个应用来自一个充满有趣照片的网站。无论如何，当我使用这个应用时，我的手机几分钟内就会变热，电池电量开始急剧下降。这难道意味着应用有问题吗？不！尤其是当你开始使用它时了解应用在做什么。
- en: Not only does the app need to load photos from the server, but it uses your
    Wi-Fi and location services and shows ads—all this while keeping you logged in
    to their website so that you can make comments on the photos.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 应用不仅需要从服务器加载照片，还使用你的 Wi-Fi 和位置服务，并显示广告——所有这些同时保持你登录到他们的网站，这样你就可以对照片进行评论。
- en: Now, this does not equate to the ideal user experience, but if you want access
    photos, you need to expect this type of performance. So don't worry if your device
    gets warm or the battery drains a little bit—this is a normal byproduct of device
    usage.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，这并不等同于理想的用户体验，但如果你想访问照片，你需要预期这种性能。所以如果你的设备变热或电池消耗得有点多，不要担心——这是设备使用过程中的正常副作用。
- en: Don't have access to your computer and need to log energy? Log the usage right
    on your device!
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 没有访问你的电脑并需要记录能量消耗？直接在你的设备上记录使用情况！
- en: 'If you have already connected your device to Xcode, you will now have access
    to developer options on your device, as shown in the following screenshot:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你已经将你的设备连接到 Xcode，你现在将能够访问设备上的开发者选项，如下面的截图所示：
- en: '![Battery management – doing less in the background](img/B03553_06_09.jpg)'
  id: totrans-170
  prefs: []
  type: TYPE_IMG
  zh: '![电池管理 – 在后台做更少的事情](img/B03553_06_09.jpg)'
- en: 'From this option, you can select **Logging** under the **Instruments** section,
    then click on **Energy** to enable logging, and then click on the **Start Recording**
    button to begin logging your energy usage, as shown in the following screenshot:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 从这个选项中，你可以在 **Instruments** 部分下选择 **Logging**，然后点击 **Energy** 来启用记录，然后点击 **Start
    Recording** 按钮开始记录你的能量使用情况，如下面的截图所示：
- en: '![Battery management – doing less in the background](img/B03553_06_10.jpg)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![电池管理 – 在后台做更少的事情](img/B03553_06_10.jpg)'
- en: Again, use your app the same way you normally would, and **Instruments** will
    log the data for you as your play.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 再次强调，使用你的应用的方式应该和平时一样，**Instruments** 会为你记录数据，在你操作时进行记录。
- en: To finish, go back to this setting. You will see that the **Start Recording**
    button has now changed to **Stop Recording**. Simply click on **Stop Recording**.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，回到这个设置。你会看到 **Start Recording** 按钮现在已更改为 **Stop Recording**。只需点击 **Stop Recording**。
- en: Now, back in Xcode Instruments, in the **Energy Diagnostics** option, navigate
    to **File** | **Import Logged Data from Device**.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，回到 Xcode Instruments 中，在 **Energy Diagnostics** 选项下，导航到 **File** | **Import
    Logged Data from Device**。
- en: Now, you will be greeted with the same data log as you would if you ran the
    test directly in Xcode.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你将看到与你在 Xcode 中直接运行测试时相同的数据日志。
- en: Whew! That's a lot to consider!
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 呼！这有很多需要考虑的！
- en: I know I've been talking a lot, it's all extremely important information.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 我知道我一直在说很多，这些都是极其重要的信息。
- en: As I've been testing the app, everything ran just perfectly. In fact, the only
    issued that seemed to bog the device down at all were the particles! And we managed
    to fix that programmatically by checking what device we are running and then adjusting
    our crazy particles accordingly.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 在我测试应用的过程中，一切运行得都非常完美。事实上，唯一似乎拖慢设备速度的问题就是那些粒子！我们通过检查我们正在运行的设备并相应地调整我们的疯狂粒子来程序化地解决了这个问题。
- en: Summary
  id: totrans-180
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: We've discussed a lot in this chapter, a lot of which was best practices on
    how to manage your device's performance and battery drainage.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在本章中讨论了很多内容，其中很多是关于如何管理设备性能和电池耗电的最佳实践。
- en: You are now well prepared to tackle the testing process and ensure that your
    device is running as efficiently as possible so that no customers return your
    app or give you low ratings because of how terribly your app affects their device.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 你现在已经做好了应对测试过程并确保你的设备尽可能高效运行的准备，这样就不会有客户因为你的应用对他们的设备造成了极大的影响而退回应用或给出低评分。
- en: Get excited for the next chapter boys and girls! We will talk about the awesomeness
    that is deploying your app and monetizing it so that you can make bajillions of
    dollars! Well, maybe not, but at least enough to pay for your developer cost would
    be OK.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 男孩们和女孩们，为下一章感到兴奋吧！我们将讨论部署您的应用程序并从中盈利的奇妙之处，这样您就可以赚得数不尽的美元！好吧，可能不会那么多，但至少足够支付您的开发成本就足够了。
- en: Get ready because now is the time when it gets fun, and you get to see all your
    hard work come together.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 准备好，因为现在是最有趣的时候，您将看到所有辛勤工作的成果汇聚在一起。
- en: I'll see you in the next chapter my friends!
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 下一章见，我的朋友们！
