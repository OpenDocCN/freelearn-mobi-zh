<html><head></head><body><h1 id="e-BBw0">Chapter 3. Creating the Points Of Interest App</h1>
<p id="e-Q1UG">In this chapter, we will move to the practical side of creating an app and cover the facilities that Xamarin.Android provides developers for creating, executing, and debugging applications. This chapter covers the following topics:</p>
<ul id="e-m8sS">
<li id="e-GRKE">An overview of the sample app</li>
<li id="e-Rigk">Installing and configuring Xamarin.Android</li>
<li id="e-vB3e">Creating the sample app</li>
<li id="e-Jnog">Running and debugging apps</li>
</ul>
<h1 id="e-Az0m">The sample POIApp</h1>
<p id="e-MayA">In this chapter, we will begin by building a sample <strong>Points Of Interest</strong> (<strong>POIApp</strong>) app that will be completed through the remaining chapters of this book. This app will allow the user to capture, save, and manage the <code>POIApp</code> and it supports the following features:</p>
<ul id="e-OAcM">
<li id="e-R7R0">It captures information about the <code>POIApp</code>, including name, description, address, latitude, longitude, and photos</li>
<li id="e-bS2b">It captures the address, latitude, and longitude of the <code>POIApp</code> using the devices location capabilities</li>
<li id="e-D5Vy">It captures and saves a photo of the <code>POIApp</code> using the devices camera</li>
<li id="e-Z8U9">It saves details of the <code>POIApp</code> on the Cloud</li>
<li id="e-lAnh">It fetches and displays a list of the <code>POIApp</code> from the Cloud</li>
<li id="e-CECN">It stores/caches the <code>POIApp</code> for offline viewing</li>
</ul>

<h1 id="e-kb3s">Installing Xamarin.Android</h1>
<p id="e-oKbo">Before we move on, we need to get Xamarin.Android installed. This section walks you through installing the latest Xamarin development platform (Xamarin.Android Version 5.1.3 and Xamarin Studio Version 5.9.3) on the Mac operating system.</p>
<h3 id="e-gg5B">Tip</h3>
<p id="e-PAcO">At the time of writing this book, the installation instructions presented in this chapter are accurate. However, the tools are being updated rapidly, so these instructions may be out of date by the time you read this. You can refer to the official Xamarin website for the updated installation instructions.</p>
<p id="e-u9yW">You may choose to install Xamarin.Android and work through the samples on Windows OS; in which case, you will encounter only minor deviations in some of the directions. If you choose to install on the Windows operating system, you may refer to the installation guide from the official Xamarin developer portal at <a href="http://developer.xamarin.com/guides/android/getting_started/installation/windows/">http://developer.xamarin.com/guides/android/getting_started/installation/windows/</a>.</p>
<p id="e-KS9i">To install Xamarin.Android, perform the following steps:</p>
<ol id="e-v1Xo">
<li id="e-aJ6Z">The Xamarin Studio IDE and Xamarin.Android platforms are the prerequisites to develop an Android application using Xamarin. Go to the download section of <a href="http://xamarin.com/">http://xamarin.com/</a>, fill in your personal details, download the unified installer for your operating system, and launch it:<img data-width="401" data-height="456" src="gwSDQ08o.jpg"/>
</li>
<li id="e-Zst0">Click on the installer page and the agreement page until you come to the <strong>Product Selection</strong> page. The installer allows the installation of both Xamarin.Android and Xamarin.iOS, as shown in the following screenshot:<img data-width="800" data-height="518" src="p4RVHvwp.jpg"/>
</li>
<li id="e-meMI">Xamarin.iOS will not be needed for the exercises in this book; you may uncheck Xamarin.iOS for the installer window and click on <strong>Continue</strong>.</li>
<li id="e-ZwGT">Now the installer will proceed to configure the installation directory. You may either change the installation location on your computer, or continue with the installation:<img data-width="799" data-height="518" src="yQTqASqe.jpg"/>
</li>
<li id="e-Wuor">Next, the prerequisites for the installation will be listed, as shown in the following screenshot. It requires installing the Mono framework, the Android SDK, Xamarin Studio, and the Xamarin.Android component. Click on <strong>Continue</strong> to proceed with the installation:<img data-width="800" data-height="516" src="MiJEzsQf.jpg"/>
</li>
<li id="e-rZkj">You will now see the Android SDK agreement page. Just accept and click on <strong>Continue</strong> for installation. An installation progress page will be displayed depicting the component installation in progress:<img data-width="800" data-height="516" src="pE7iykJy.jpg"/><h3 id="e-kGLt">Note</h3>
<p id="e-k1N9">During installation of Xamarin.Android, if you're encountering Android SDK download issues, please ensure that downloads are not blocked by your corporate network or firewall. For such events, you can download and install the standalone Android SDK from <a href="https://developer.android.com/sdk/index.html">https://developer.android.com/sdk/index.html</a>. Once Android SDK is installed on your computer, you can resume with Xamarin package installer.</p>
</li>
<li id="e-dfYc">As each component is installed, a check mark will be placed next to the component, and once all the items are installed, a final installation completion page will be displayed.</li>
<li id="e-asif">Now click on <strong>Launch Xamarin Studio</strong>:<img data-width="800" data-height="517" src="bz1WuN11.jpg"/>
</li>
</ol>

<h1 id="e-aceW">Installing platforms and tools</h1>
<p id="e-UgSg">The Android platform installation comes with the Android SDK manager toolkit that allows you to select and download the tools and platforms that are required to build the Android apps. For example, when a new version of Android is released, you can test your application against the new platform by downloading the new bundles using the SDK manager.</p>
<p id="e-x49e">The <strong>Android SDK Manager</strong> can be launched from Xamarin Studio by navigating to the <strong>Tools</strong> | <strong>Open Android SDK Manager...</strong> option:</p>
<img data-width="800" data-height="289" src="RsEs57fP.jpg"/><p id="e-G1Dj">Notice that the Android SDK Manager has now opened and it lists the following options for you to install or delete.</p>
<h2 id="e-gc6K">Tools</h2>
<p id="e-z2HK">The <strong>Tools</strong> section is one of the core parts of the Android installation. This is required to build, install, and debug the Android application on the device:</p>
<img data-width="624" data-height="275" src="sMawMDQJ.jpg"/><p id="e-EETM">A brief description of the tools is as follows:</p>
<ul id="e-LaMh">
<li id="e-KnaF">
<strong>Android SDK Tools</strong>: These are the development tools that must be installed to compile Xamarin.Android applications. When you install the Xamarin platform, it automatically gets installed; however, you may need to keep this updated.</li>
<li id="e-kbQ1">
<strong>Android SDK Platform-tools</strong>: The SDK platform tools are required to connect the devices to deploy builds and debug applications. You should always have the latest version of the platform tools to ensure compatibility with the latest version of the Android APIs; so keep this up to date as well.</li>
<li id="e-KKcI">
<strong>Android SDK Build-tools</strong>: Build tools are required to compile the source code to the application that can be run on the Android devices or emulators. By default, Xamarin Studio installs the most recent version of the build tools. It is always recommended that you install the latest version of the SDK build tools as well.</li>
</ul>
<p id="e-pRat">For more information, you may visit the following official Android documentation:</p>
<ul id="e-ttLf">
<li id="e-lYab"><a href="https://developer.android.com/tools/revisions/build-tools.html">https://developer.android.com/tools/revisions/build-tools.html</a></li>
<li id="e-rB3a"><a href="http://developer.android.com/tools/sdk/tools-notes.html">http://developer.android.com/tools/sdk/tools-notes.html</a></li>
</ul>
<h2 id="e-b3JT">The Android platform APIs</h2>
<p id="e-qPOi">Each successive release of Android operating system also includes the Android framework API for developers to take advantage of the set of new packages, classes to build apps. The platform API section lists all the Android API versions along with the API levels:</p>
<img data-width="709" data-height="260" src="GgmQ2Kwt.jpg"/><p id="e-VLEa">A brief description of the various platforms is as follows:</p>
<ul id="e-Ic0a">
<li id="e-wTYg">
<strong>SDK Platform</strong>: The SDK Platform for a given API level allows you to compile against that version of Android. When a new platform is released, it requires the newer version of the SDK Platform tools and SDK tools; and hence, you need to keep those up to date.</li>
<li id="e-ZVNs">
<strong>Samples for SDK</strong>: These are Android sample applications for each API level developed using Java. They are not required by Xamarin developers. You don't need to install these samples unless you have a specific need or if you want to analyze and port the Java samples to C#.</li>
<li id="e-GXDg">
<strong>System Images</strong>: System images are used with <strong>Android</strong><strong>Virtual Device</strong> (<strong>AVD</strong>). All the recent Android versions include both the ARM and x86 system images. The x86 images run significantly faster and are preferred over the ARM. Notice that some of the system images are prefixed with <strong>Google APIs</strong>. They include the Google Play services runtime and are useful for testing the apps that use Google Play services features such as map, in-app purchases, and so on.</li>
</ul>
<h2 id="e-zXLj">The Android platform Extras</h2>
<p id="e-clRU">The <strong>Extras</strong> section includes some of the additional optional tools you may require during development, which are shown in the following screenshot:</p>
<img data-width="741" data-height="230" src="bVX5qBKg.jpg"/><p id="e-k3Bn">The following section will brief you on some of the important sections of the Android platform extra tools:</p>
<ul id="e-SPPJ">
<li id="e-IQSL">
<strong>Android Support Library</strong>: The <strong>Android Support Library</strong> is a set of code libraries that are used to provide backward compatibility for new API features on older devices. It is considered as a best practice to use the support libraries while developing some of the features, as it makes the app compatible with the older versions of devices.</li>
<li id="e-ox8o">
<strong>Google Play services</strong>: The Google Play services runtime provides the set of APIs to develop certain Android features such as Google Maps, integrating with Google+, Google Play subscription, and so on. All the Android devices include the Google Play service runtime. However, the Android emulators don't include the Google Play services runtime by default but it can be installed separately.</li>
<li id="e-xPVW">
<strong>Google USB Driver</strong>: If you are running Windows OS, you will need to install these drivers to enable USB debugging for Android devices. For some devices, you may also need to install the specific device driver's software provided by the device manufacturers. You don't need to install this driver if you are using Mac OS X for development.</li>
</ul>

<h1 id="e-ohZc">Creating Android Virtual Devices</h1>
<p id="e-INkJ">The Android emulator, also known as <strong>Android Virtual Device</strong> (<strong>AVD</strong>), is used to test the Android application in the absence of a device. Emulators get installed as part of the Xamarin installation. You can create your own emulator or customize an existing one with the required device configurations for the device being emulated.</p>
<p id="e-m1YX">In order to create or modify an existing emulator, perform the following steps:</p>
<ol id="e-PhIm">
<li id="e-Zphf">From the main menu bar, navigate to <strong>Tools</strong> and open <strong>Google Emulator Manager</strong>. It will open the <strong>Android Virtual Device Manager</strong> window:<img data-width="653" data-height="418" src="IbzvPhuY.jpg"/>
</li>
<li id="e-RFh8">To create a new emulator, click on the <strong>Create</strong> button, on the right-hand side panel. Provide the configurations, such as <strong>AVD Name</strong>, <strong>Device</strong>, <strong>Target</strong>, <strong>Memory Options</strong>, and so on.</li>
<li id="e-qMHW">To edit an existing emulator, select the emulator you wish to edit and click on the <strong>Edit</strong> button:<img data-width="574" data-height="665" src="hK3dxKpi.jpg"/>
</li>
<li id="e-uGXs">Note the <strong>Target</strong> setting; this specifies the version of the Android platform and the API level that will be used for the emulator.</li>
<li id="e-sDKw">Select the device skin from the <strong>Device</strong> field drop-down menu. In my case, I have selected <strong>Nexus 5</strong>.</li>
<li id="e-Vqer">Set the <strong>Target</strong> field to <strong>Android 4.4.2</strong>. If needed, uncheck the <strong>Hardware keyboard present</strong> option, and click on <strong>OK</strong>.</li>
<li id="e-Egex">Check the <strong>Use Host GPU</strong> option. This option makes the emulator use the host computer's OpenGL implementation, which makes the rendering significantly faster.</li>
<li id="e-fPut">You may select the <strong>Snapshot</strong> option to speed up the emulator's boot time. When this option is enabled, it saves a snapshot of its RAM on the first boot and restores from that snapshot on future use. You cannot have both the <strong>Snapshot</strong> and <strong>Use Host GPU</strong> options enabled at the same time.</li>
</ol>

<h1 id="e-pTer">Cloning a virtual device</h1>
<p id="e-DU3L">There are many options that can be modified in order to emulate any device and configuration needed. The Android Virtual Device Manager dialog box also has a tab named <strong>Device Definitions</strong> that can be used to set up the devices that are available when configuring an AVD. The following screenshot shows you what can be configured as part of the device definition:</p>
<img data-width="721" data-height="533" src="K5JFlUIs.jpg"/>
<h1 id="e-FgoW">Speeding up the Android emulator</h1>
<p id="e-B9VJ">The default Android emulator that comes with the Android development toolkit is quite sluggish. It is often disappointing and painful to test an application in the Android device emulators. The wiser choice for developers is to have a real Android device to test on. However, because the Android ecosystem has various form factors and device manufactures, it is practically impossible to buy each targeted device to test the app. You have to go for some cost effective solution to test your app on all targeted devices.</p>
<p id="e-pY14">The following section will guide you through some of the tips to make your Android emulator faster and other alternative options available to test Android apps.</p>
<h2 id="e-NRGM">Using the x86 emulator</h2>
<p id="e-ZWF2">Android provides an x86 emulator that can speed up the development considerably due to faster start and execution times for the AVD. The x86 emulator is not a part of the base Xamarin installation, but the directions for the installation can be found on the Xamarin website as well as the Android developer website. A very specific version may be required, particularly if you are using OS X Mavericks, so we will not replicate the directions here.</p>
<p id="e-UGE9">Once installed, you can take advantage of the x86 emulator by the selected Intel Atom (x86) for the CPU/ABI when editing an AVD configuration.</p>
<h2 id="e-lMGv">Third-party emulator solutions</h2>
<p id="e-WdsV">The x86 solution should work just fine on the computer with a decent memory. Apart from the native Android emulators, you can use some of the third-party tools such as the Xamarin Android Player or Genymotion.</p>
<h3 id="e-SEzh">The Xamarin Android Player</h3>
<p id="e-eOJt">Xamarin recently announced its own Android emulator called the Xamarin Android Player. The Xamarin Player runs on Android x86 hardware accelerated virtualization and OpenGL 2.0 for fast booting and a smooth user interface. This works on both the Windows and Mac platforms. Your system requires to have an OpenGL 2.0 compatible graphics card with at least 2 GB hard disk space and at least 2 GB or RAM to install and run the Xamarin player.</p>
<p id="e-ACiB">The following screenshot shows the Xamarin Android Player with the player settings pane:</p>
<img data-width="800" data-height="709" src="doyFofN7.jpg"/><p id="e-xjVH">The Xamarin player settings pane allows you to simulate some of the emulator controls, such as battery life, geo locations, volume, and power control.</p>
<h3 id="e-epG9">Genymotion</h3>
<p id="e-aXYp">Genymotion is yet another alternative in the race of faster Android emulators. Genymotion is based on the open source project Android VM, developed by a French company Genymobile. It also works on all major platforms, including Mac, Windows, and Linux. The basic version of Genymotion is free to download; however, the commercial version does much more than the free version. The paid version of Genymotion can simulate multitouch, camera, GPS, network quality simulation, accelerometer, and much more. This can be the best alternative replacement for Android AVD.</p>
<p id="e-sQWi">The following screenshot shows the Xamarin Android Player on Mac OS:</p>
<img data-width="449" data-height="722" src="xTCcuSm3.jpg"/>
<h1 id="e-ZB6E">Creating the POI app</h1>
<p id="e-RclT">Now that we already have our development environment ready, let's begin by building the <code>POIApp</code>.</p>
<p id="e-Hrzm">The following section will walk you through the several steps involved to create, build, and deploy the POI application into the Android device:</p>
<ol id="e-jGXa">
<li id="e-T7RI">Launch Xamarin Studio.</li>
<li id="e-EQla">From the <strong>File</strong> menu, navigate to <strong>New</strong> | <strong>Solution</strong>. The <strong>New Solution</strong> view will be presented, as shown in the following screenshot:<img data-width="800" data-height="582" src="ok5VFH5B.jpg"/>
</li>
<li id="e-Exdf">Select the <strong>Android</strong> section on the left-hand side of the screen, navigate to <strong>App</strong> | <strong>Android App</strong>, and then click on <strong>Next</strong>.</li>
<li id="e-JvSt">Enter the app name as <code>POIApp</code> and the application identifier as <code>com.packt.poiapp</code>.</li>
<li id="e-b7tc">From the <strong>Compatibility</strong> selection, select <strong>Maximum Compatibility</strong> to make your application compatible on a full range of devices.</li>
<li id="e-oN8Q">From the <strong>Themes</strong> drop-down menu, you may select from the range of available themes and click on <strong>Next</strong>:<img data-width="800" data-height="582" src="xCa6W6im.jpg"/>
</li>
<li id="e-DabF">Review the project location and adjust it if desired. Click on <strong>Create</strong>:<img data-width="800" data-height="583" src="T8KJ7IqJ.jpg"/>
</li>
<li id="e-wbmU">Xamarin Studio will create a solution and the required project folders. The project folder will contain a default <code>MainActivity.cs</code> class and a <code>Main.axml</code> layout file.</li>
</ol>

<h1 id="e-FzBR">The Xamarin Studio IDE</h1>
<p id="e-W1Ai">After creating <code>POIApp</code>, the project will be opened within the environment.</p>
<p id="e-Bn5U">The following screenshot depicts Xamarin Studio after the project has been created:</p>
<img data-width="800" data-height="569" src="PHw0i0FT.jpg"/><p id="e-gb6y">Like any other modern IDE, Xamarin Studio is organized with a set of menus at the top of the screen, a context-sensitive toolbar below it, and a series of dockable pads for viewing and manipulating various types of content. By default, Xamarin Studio is configured with the following options:</p>
<ul id="e-GzKW">
<li id="e-D8Dx">The <strong>Solution</strong> pad is docked on the left-hand side and allows you to explore the structure and content contained in the project</li>
<li id="e-bbPm">Editor windows are in the middle and present the content of files for viewing and manipulation</li>
<li id="e-J5mf">Task-specific pads are collapsed on the right-hand side and bottom and can be expanded by hovering over the icon and caption</li>
</ul>
<p id="e-C1KO">Additional pads can be accessed by navigating to <strong>View</strong> | <strong>Pads</strong>.</p>

<h1 id="e-ppAS">The Project Options view</h1>
<p id="e-RaXH">There are numerous options that can be set, which would affect the way the application is built and executed. These options can be adjusted from within the <strong>Project Options</strong> view. The following section will show you how to use the different options available in the Xamarin Studio project explorer to set various project configurations.</p>
<h2 id="e-xIeV">Understanding the project structure</h2>
<p id="e-RgPU">A project is an organizational unit that represents the complete Xamarin Android application in the <strong>Solution</strong> pad. It contains not just the source code, but also contains the dependent libraries, resources, and other project configurations. Before we begin with writing any code, we must understand the Xamarin.Android project structure and significance of each folder. The following screenshot depicts the different components a Xamarin Android application is composed of:</p>
<img data-width="800" data-height="577" src="q89OffyQ.jpg"/><p id="e-wkxF">Xamarin Studio project wizard creates the default project structure and adds the required files and directory to <strong>Solution</strong> pad. The most important building blocks of a Xamarin.Android project includes:</p>
<ul id="e-Sz1R">
<li id="e-wlQL">The main project (<code>POIApp</code>) is the root directory that contains the entire project context. Right-click on the project name to get various options, such as clean, build, run, options for project configurations, and so on.</li>
<li id="e-zLAU">The <code>References</code> directory contains the references to the lists of the base class libraries and assemblies used in the application. Right-click on <strong>Edit References</strong> to add a base class library or third-party assembly.</li>
<li id="e-LKNM">The <code>Components</code> folder contains reusable pieces of code that are built by community developers and shared on the Xamarin component store. A component gives you the ability to quickly add new controls and functionality to Xamarin applications. For example, if your application uses the database operation, you can quickly integrate the SQLite.Net component to perform SQL operations by writing a few lines of code. We will discuss how to add a component to your application from the Xamarin component store in Chapter 4, <em>Adding a List View</em>.</li>
<li id="e-v6k1">The <code>Assets</code> folder contains the raw assets that can be bundled with the application. It can contain files such as third-party <code>.ttf</code> fonts, game textures, and so on.</li>
<li id="e-r4JZ">The <code>Properties</code> folder generally contains two files: the <code>AndroidManifest.xml</code> and <code>AssemblyInfo.cs</code> files. The <code>AndroidManifest.xml</code> file contains the metadata of the Android application and <code>AssemblyInfo.cs</code> contains information about the assembly, such as the name, description, version, and so on.</li>
<li id="e-THpE">The <code>Resources</code> folder is the main building block composed of images (named as drawables in Android), layout descriptors, strings, colors, themes, and so on. All the resources added are grouped into different folders and are referenced with a unique resource ID.<p id="e-y5i8">Xamarin Studio automatically creates a new <code>Resource.designer.cs</code> file under the <code>Resources</code> directory. This file holds the unique IDs for each resource. This is similar to the <code>R.java</code> file that is created automatically in the native Android application. This file is maintained by Xamarin.Android and is periodically regenerated whenever there is a change made to the application's resources.</p>
<p id="e-r6qK">The following are some of the subdirectories you can create inside the <code>Resources</code> directory:</p>
<ul id="e-EYPc">
<li id="e-KlcZ">
<strong>Resources/drawable-xxx</strong>: The drawable folders are used to hold the images such as <code>.png</code>, <code>.jpeg</code>, and so on. Notice that the default project structure contains multiple drawable folder suffixes with qualifiers, such as hdpi, mdpi, xhdpi, and so on. The qualifier indicates that the resources inside that directory will be used in certain circumstances only. You can create another directory <code>Resources/drawable</code> to place the images that are not required for different device configurations.<p id="e-Y8Q7">A more detailed discussion on resource qualifiers are explained in Chapter 7, <em>Designing for Multiple Screen Sizes</em>.</p>
</li>
<li id="e-M1Hn">
<strong>Resources/layout</strong>: This folder contains the XML layout descriptor files. In our example, the <code>Main.axml</code> file is created.</li>
<li id="e-GC1K">
<strong>Resources/values</strong>: This folder contains files, such as <code>string.xml</code>, to declare all the strings used in an app. This is helpful for app localization.</li>
<li id="e-SmlH">
<strong>Resources/menu</strong>: The menu folder holds the XML-based menu specification for each activity.</li>
</ul>
</li>
<li id="e-WAv2">The application source code can be managed inside multiple different folders. By default, the Xamarin Studio project template is created in the <code>MainActivity.cs</code> file.</li>
<li id="e-lXjj">The newer version of Xamarin Studio creates the <code>Xamarin.UITest</code> project, which is used for automated UI acceptance testing. The <code>Xamarin.UITest</code> framework is based on Calabash, using which you can write a test case in C# and NUnit and execute for both the Android and iOS platforms. This book covers Android unit testing using NUnitLite in Chapter 8, <em>Creating Data Storage Mechanisms</em>. For now, if you wish, you can safely delete the test project.</li>
</ul>

<h1 id="e-wANc">The Xamarin Studio layout designer</h1>
<p id="e-d1Di">Open the <code>Main.axml</code> file located at <code>Resources/layout/Main.axml</code> from the solution explorer. Notice that the graphical layout editor will be the default layout editor. Currently, the <code>Main.axml</code> layout contains a button inside <code>LinearLayout</code>. Let's now proceed to understand the different Xamarin Studio layout designer options.</p>
<h2 id="e-AsQZ">The designer content layout</h2>
<p id="e-vjvi">The Android Studio layout designer contains two buttons: <strong>Content</strong> and <strong>Source</strong>, which are at the bottom of the designer view. These buttons allow you to switch between a visual representation of the layout (<strong>Content</strong>) and an XML source code view of the layout. This is very useful as some tasks are just quicker to edit directly in the XML source view; however, the content view is useful to view and arrange widgets.</p>
<p id="e-ZT2b">The content view's usefulness is somewhat limited only because most of the time portions of a view must be constructed with the code at runtime; however, when the view can be specified completely in XML, the content view is very useful. In the content view, you will notice a set of a few useful tools arranged at the top of the window, as shown in the following screenshot:</p>
<img data-width="800" data-height="487" src="Z4ACJxVR.jpg"/><p id="e-oJiZ">In the upper-right corner, you will find a set of zoom controls. These allow you to zoom the layout in or out, depending on your monitor's size and the level of details you would like to view. At the top of the page, you will find drop-down menus that also let you select things, such as the screen size of the device to simulate, orientation of the device, and the version of the Android platform to simulate.</p>
<h2 id="e-ChKL">The Document Outline and Properties pads</h2>
<p id="e-FL9Y">On the bottom right-hand side of the IDE, you will notice the <strong>Document Outline</strong> and <strong>Properties</strong> pads.</p>
<p id="e-a9Ko">The <strong>Document Outline</strong> pad provides a convenient means of navigating and selecting widgets, particularly as layouts get more complex. Select <strong>listView1</strong> and then click on the <strong>Properties</strong> tab. Activate the <strong>Document Outline</strong> pad to see your layout outline, listing all the widgets, Views, or view groups contained in it.</p>
<p id="e-QioQ">Select any view on the designer window and click on the <strong>Properties</strong> tab to activate the <strong>Properties</strong> window. The <strong>Properties</strong> window allows you to edit/select the attributes for the selected view. Xamarin Studio takes care of generating the source code to reflect the changes made in the designer view.</p>
<h2 id="e-zNqN">Toolbox</h2>
<p id="e-oKMn">The <strong>Toolbox</strong> pad is organized with the basic widgets at the top of the list and container widgets such as ListViews further down the list.</p>
<p id="e-Phik">By default, the <strong>Toolbox</strong> pad is displayed on the top right-hand side of the Xamarin Studio IDE. There is a search box at the top that allows you to filter the widgets in the list, and there are two buttons on the right-hand side of the search box that allow you to adjust the way widgets are listed.</p>
<h2 id="e-eMmb">Setting the target framework</h2>
<p id="e-K7sL">The target framework setting determines which API level will be available to you during development and testing. Let's select the automatic setting; use the target framework version. In this case, it automatically selected <code>API level 19 Android 4.4</code>.</p>
<p id="e-SBRM">The minimum SDK version tells you which minimum API level is required for the application to run. Based on the value specified in the minimum SDK, the Google Play Store prevents the user from installing the application if the system's API level is lower than the value specified.</p>
<p id="e-HJMX">In order to set the target framework, perform the following steps:</p>
<ol id="e-gYJe">
<li id="e-KABF">Select the <code>POIApp</code> project under the <code>POIApp</code> solution in the <strong>Solution</strong> pad.</li>
<li id="e-uXhM">Right-click on it and click on <strong>Options</strong>.</li>
<li id="e-OygN">Navigate to <strong>Build</strong> | <strong>General</strong> on the left-hand side of the page:<img data-width="764" data-height="604" src="Z6GYOSY8.jpg"/>
</li>
<li id="e-wbxt">In the <strong>Target framework</strong> field, select <strong>Use latest installed platform</strong> and click on <strong>OK</strong>.</li>
</ol>

<h1 id="e-rcJO">Setting the app icon and package name</h1>
<p id="e-B2c3">Xamarin.Android provides a default icon and package name for apps. The icon will be displayed on the Android device's home drawer alongside other application lists, as well as on the action bar at the top of each view.</p>
<p id="e-hUCh">In order to adjust the defaults for these settings, perform the following steps:</p>
<ol id="e-KISs">
<li id="e-lJ5k">The application icon images are provided in the <code>Assets</code> folder of the code bundle.</li>
<li id="e-c4UF">Using <strong>Finder/Windows Explorer</strong>, copy <code>ic_launcher.png</code> from your computer's hard disk to the respective <code>Resources\drawable</code> folders.</li>
<li id="e-disr">From Xamarin Studio, navigate to <code>Resources\drawable</code>, right-click on it, and click on <strong>Add Files</strong> or alternatively, you can drag and drop the launcher images to the Xamarin Studio <code>Resource/drawable</code> folders.</li>
<li id="e-h3rR">You should now see <code>ic_launcher.png</code> listed under <code>drawable</code> in the <strong>Solution</strong> pad.</li>
<li id="e-xVT3">Select the <code>POIApp</code> project, right-click on it, and click on <strong>Options</strong>.</li>
<li id="e-Bzht">Navigate to <strong>Build</strong> | <strong>Android Application</strong>.</li>
<li id="e-KtPZ">Change the application name to <code>POIApp</code>. This will cause the resulting APK file to be named <code>POIApp.apk</code>.</li>
<li id="e-LUk1">Change the application icon selection to <code>@drawable/ic_launcher</code>.</li>
<li id="e-Q9FX">Click on <strong>OK</strong>.</li>
</ol>
<p id="e-YB05">We will cover additional options in Chapter 11, <em>Publishing an App to the App Store</em>, as we prepare the app for deployment.</p>

<h1 id="e-WB6w">The launcher activity</h1>
<p id="e-E4o3">When an app is launched from the home screen on an Android device, the Android OS creates an instance of the activity in the application you have declared to be the launcher activity. When developing with the Android SDK, this is specified in the <code>AndroidManifest.xml</code> file. The following code excerpt from <code>AndroidManifest.xml</code>shows how to specify an activity as a launcher activity:</p>
<pre id="e-QDq8">&amp;lt;?xml version="1.0" encoding="utf-8"?&amp;gt;
&amp;lt;manifest 
package="com.paket.POIApp" &amp;gt;
&amp;lt;application
android:allowBackup="true"
android:icon="@drawable/ic_launcher"
android:label="POIApp"
android:theme="@style/AppTheme" &amp;gt;
&amp;lt;activity
android:name=".MainActivity"
android:label="POIApp" &amp;gt;
&amp;lt;intent-filter&amp;gt;
&amp;lt;action android:name="android.intent.action.MAIN" /&amp;gt;
&amp;lt;category android:name="android.intent.category.LAUNCHER" /&amp;gt;
&amp;lt;/intent-filter&amp;gt;
&amp;lt;/activity&amp;gt;
&amp;lt;/application&amp;gt;
&amp;lt;/manifest&amp;gt;</pre>
<p id="e-Rf4E">Xamarin.Android provides a more convenient method of specifying this by the use of .NET attributes. These .NET attributes are used at build time to construct the <code>ApplicationManifest.xml</code> file so that you rarely ever need to worry about working with the file directly. In the case of specifying the initial activity to launch, setting <code>MainLauncher</code> to <code>true</code> does the job, as seen in the following code example:</p>
<pre id="e-sYbo">[Activity (Label = "POIApp", MainLauncher = true)]
public class MainActivity : Activity
{
 ... 
}</pre>

<h1 id="e-W6Dd">Running and debugging the app</h1>
<p id="e-VQJt">The way in which you run and debug apps is very important to developers as it has a big impact on productivity and timelines. Xamarin Studio and the Android emulator team up to make the testing and debugging cycle as painless as possible. Let's go through the following steps:</p>
<ol id="e-AYOt">
<li id="e-sRRI">Start a debugging session by clicking on the <strong>Play</strong> button on the left-hand side of the taskbar, by pressing <em>F5</em>, or by navigating to <strong>Run</strong> | <strong>Start Debugging</strong>:<img data-width="526" data-height="145" src="YGX0g1hq.jpg"/>
</li>
<li id="e-Zhhv">Select <strong>Nexus 6</strong> (emulator) from the list and click on the <strong>Start emulator</strong> button. It might take a little longer for the emulator to start up. Let's wait until it is fully loaded.</li>
<li id="e-j5zZ">Select <strong>Nexus 6</strong> at the top of the devices list and click on <strong>OK</strong>. Xamarin Studio will deploy the compiled app to the emulator. The progress of the deployment can be monitored from the status view in the middle of the toolbar and from the <strong>Application Output</strong> pad at the bottom of the IDE.</li>
<li id="e-w4x5">Toggle to the Android emulator and unlock the screen. The POI app will be present:<img data-width="689" data-height="800" src="uoPqTLdR.jpg"/><h3 id="e-JX9y">Note</h3>
<p id="e-taEz">The Android emulator is used for testing Android apps during the development process. The left-hand side of the screen depicts what would be seen on a device and the right-hand side provides keys that replicate the device hardware.</p>
</li>
<li id="e-NgL5">Click on the <strong>Hello World</strong> button and the app will increment a counter and update the button's caption.</li>
<li id="e-BnUL">Toggle back to Xamarin Studio and stop the app by clicking on the <strong>Stop</strong> button at the extreme left of the toolbar.</li>
<li id="e-XFyz">Open <code>MainActivity.cs</code> and set a breakpoint on line 21 by clicking on the left margin of the editor, just to the left of the line number.</li>
<li id="e-VmgY">Restart the app by clicking on the <strong>Start</strong> button. Since the Android emulator is still running, you will not need to make a device selection. The app will stop at the breakpoint previously set:<img data-width="481" data-height="71" src="XlKlnUGv.jpg"/>
</li>
<li id="e-ad4L">You will notice a set of debug controls present in the toolbar. There are controls to continue the execution, namely, step over the current line, step into the current function, and step out of the current function:<img data-width="139" data-height="44" src="oJ0HE6fc.jpg"/>
</li>
<li id="e-gMen">You will also notice a new set of pads related to the debugging apps present at the bottom of the IDE. These pads allow you to view objects, breakpoints, threads, and the call stack:<img data-width="800" data-height="172" src="v1pXKN3w.jpg"/>
</li>
<li id="e-l17k">Click on <strong>Step Over</strong> twice to watch the progress of the execution, and then click on <strong>Continue</strong> to let the app start.</li>
</ol>
<p id="e-O85Y">As you can see from this section, Xamarin Studio and the Android emulator facilitate a robust and intuitive way of executing and debugging applications.</p>

<h1 id="e-SXkx">Debugging with an Android device</h1>
<p id="e-hILG">Apps can be executed and debugged on actual devices with the same simplicity of working with an emulator. To prepare for using a physical device, you need to perform a few steps as follows:</p>
<ol id="e-uBuw">
<li id="e-PGii">Enable USB debugging on the device.</li>
<li id="e-DgdK">Install an appropriate USB driver for the device (Windows only).</li>
</ol>
<h2 id="e-TpPP">Enabling USB debugging</h2>
<p id="e-m711">In order to enable USB debugging on a device with Android 4.0 and newer, perform the following steps:</p>
<ol id="e-ya4D">
<li id="e-w3cq">For devices running Android 4.2 or newer, there is an extra step; <code>Developer options</code> are initially hidden. Navigate to <strong>Settings</strong> | <strong>About phone</strong> and tap <strong>Build number</strong> seven times. On some configurations, the exact menu structure may differ. On my HTC One with Android 4.3, the menu is <strong>Settings</strong> | <strong>About</strong> | <strong>Software information</strong> | <strong>More</strong>.</li>
<li id="e-SiXv">Navigate to <strong>Settings</strong> | <strong>Developer</strong> options.</li>
<li id="e-yxr8">Click on <strong>USB debugging</strong>.</li>
</ol>
<h2 id="e-HGvM">Installing a USB driver</h2>
<p id="e-jtR5">Windows users are required to install a USB driver provided by the device's manufacturer. You can refer to the Android developer website under a section titled <strong>Using Hardware Devices</strong> for more details or consult your device's manufacturer at <a href="http://developer.android.com/tools/device.html">http://developer.android.com/tools/device.html</a>.</p>
<p id="e-HEsn">OS X users should be good to go.</p>
<h2 id="e-x4Td">Running apps on a device</h2>
<p id="e-OdFA">After completing the previous steps, simply connect the device to your development computer with a USB cable, start the app from Xamarin Studio, and choose the actual hardware device from the device selection view rather than starting an emulator.</p>
<h2 id="e-Y7gN">Behind the scenes</h2>
<p id="e-Zynj">It is interesting at this point to take a quick look at a few of the things that go on behind the scenes, which we previously discussed in Chapter 2, <em>The Xamarin.Android Architecture</em>.</p>
<h2 id="e-O2E8">The peer object</h2>
<p id="e-vc9Z">Let's start with the peer object (the proxy object) discussed in Chapter 2, <em>The Xamarin.Android Architecture</em>. Navigate to the <code>POIApp\POIApp\obj\Debug\android\src\poiapp</code> directory code bundle in your <code>Finder/Windows Explorer</code> window, open <code>MainActivity.java</code> using Notepad.</p>
<p id="e-Ajxu">The following code snippet depicts some of the key pieces of the source file:</p>
<pre id="e-JjSM">packagepoiapp;
public class MainActivity extends android.app.Activity implements
mono.android.IGCUserPeer
{
. . .
public void onCreate (android.os.Bundle p0)
{
n_onCreate (p0);
}
private native void n_onCreate (android.os.Bundle p0);
. . .
}</pre>
<p id="e-dNJj">Note the following points:</p>
<ul id="e-P4hG">
<li id="e-CSai">The <code>MainActivity</code> class extends <code>android.app.Activity</code>, which is what you would expect</li>
<li id="e-O9mG">An <code>onCreate()</code> proxy method is created that calls the native <code>n_onCreate()</code> method, which points to the overridden <code>OnCreate()</code> method in our managed C# class</li>
<li id="e-NQ7l">The <code>MainActivity</code> class has a static initialization block and a constructor that establishes the link between the Java class and its managed C# peer, including initializing <code>n_onCreate()</code>
</li>
</ul>

<h1 id="e-HeSu">The AndroidManifest.xml file</h1>
<p id="e-fZJV">Navigate to <code>POIApp\POIApp\obj\Debug\android</code> in the code bundle and open the <code>AndroidManifest.xml</code> file. The following code snippet depicts a portion of the manifest file:</p>
<pre id="e-P6OY">&amp;lt;?xml version="1.0" encoding="utf-8"?&amp;gt;
&amp;lt;manifest  android:versionCode="1" android:versionName="1.0" package="com.packt.poiapp"&amp;gt;
  &amp;lt;uses-sdk android:minSdkVersion="10" /&amp;gt;
  &amp;lt;application android:label="POIApp" android:name="mono.android.app.Application" android:debuggable="true"&amp;gt;
    &amp;lt;activity android:icon="@drawable/icon" android:label="POIApp" android:name="md56a0a1b7026a61848924491193f52dfa6.MainActivity"&amp;gt;
      &amp;lt;intent-filter&amp;gt;
        &amp;lt;action android:name="android.intent.action.MAIN" /&amp;gt;
        &amp;lt;category android:name="android.intent.category.LAUNCHER" /&amp;gt;
      &amp;lt;/intent-filter&amp;gt;
    &amp;lt;/activity&amp;gt;
    &amp;lt;provider android:name="mono.MonoRuntimeProvider" android:exported="false" android:initOrder="2147483647" android:authorities="com.packt.poiapp.mono.MonoRuntimeProvider.__mono_init__" /&amp;gt;
    &amp;lt;receiver android:name="mono.android.Seppuku"&amp;gt;
      &amp;lt;intent-filter&amp;gt;
        &amp;lt;action android:name="mono.android.intent.action.SEPPUKU" /&amp;gt;
        &amp;lt;category android:name="mono.android.intent.category.SEPPUKU.com.packt.poiapp" /&amp;gt;
      &amp;lt;/intent-filter&amp;gt;
    &amp;lt;/receiver&amp;gt;
  &amp;lt;/application&amp;gt;
  &amp;lt;uses-permission android:name="android.permission.INTERNET" /&amp;gt;
  &amp;lt;uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" /&amp;gt;
&amp;lt;/manifest&amp;gt;</pre>
<p id="e-mbVZ">Note the following points:</p>
<ul id="e-xHeu">
<li id="e-zxdd">The minimum SDK is set to <code>15</code> in the <code>&amp;lt;uses-sdk\&amp;gt;</code> element</li>
<li id="e-zs1O">The initial activity is set using the <code>&amp;lt;category\&amp;gt;</code> element within the activity definition</li>
</ul>
<p id="e-vUJr">We covered a lot about the structure of the Xamarin.Android project created using Xamarin Studio. We used Xamarin Studio on the Mac platform to complete all the examples in this book. We can confirm that all the previously mentioned project configuration options are also available in the Visual Studio IDE.</p>

<h1 id="e-L1sR">Summary</h1>
<p id="e-W7Zv">In this chapter, we started with a sample app that we will complete through the remaining chapters of the book, and we demonstrated the facilities we have for executing and debugging apps.</p>
<p id="e-sr1e">In the next chapter, we will start with creating the basic layout and building <code>ListView</code> to display the <code>POIApp</code> fetched from the server.</p>
</body></html>