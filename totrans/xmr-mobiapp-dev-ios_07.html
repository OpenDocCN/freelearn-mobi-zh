<html><head></head><body>
  <div class="book" title="Chapter&#xA0;7.&#xA0;Gestures">
    <div class="book">
      <div class="book">
        <div class="book">
          <h1 class="title"><a class="calibre1" id="ch07"/>Chapter 7. Gestures</h1>
        </div>
      </div>
    </div>

    <p class="calibre9">While there are ongoing arguments in the courts of America at the time of writing over who invented the likes of dragging images, it is without a doubt that a key feature of iOS is the ability to use <span class="strong"><strong class="calibre2">gestures</strong></span>. To put it simply, when you tap the screen to start an app or select a part of an image to enlarge it or anything like that, you are using gestures.</p>

    <p class="calibre9">We will be covering the following topics in this chapter:</p>

    <div class="book">
      <ul class="itemizedlist">
        <li class="listitem">What is a gesture?</li>

        <li class="listitem">Adding gestures to the UI</li>

        <li class="listitem">Handling gestures</li>

        <li class="listitem">Handling drag-and-drop</li>
      </ul>
    </div>

    <div class="book" title="Gestures">
      <div class="book">
        <div class="book">
          <div class="book">
            <h1 class="title"><a class="calibre1" id="ch07lvl1sec30"/>Gestures</h1>
          </div>
        </div>
      </div>

      <p class="calibre9">A gesture (in terms of iOS) is any <a class="calibre1" id="id746"/>touch interaction between the UI and the device. With iOS 6, there are six gestures the user has the ability to use. These gestures, along with brief explanations, have been listed in the following table:</p>

      <div class="informalexample">
        <table border="1" class="calibre16">
          <colgroup class="calibre17">
            <col class="calibre18"/>
            <col class="calibre18"/>
            <col class="calibre18"/>
          </colgroup>

          <thead class="calibre19">
            <tr class="calibre20">
              <th class="calibre21" valign="bottom">
                <p class="calibre22">Class</p>
              </th>

              <th class="calibre21" valign="bottom">
                <p class="calibre22">Name and type</p>
              </th>

              <th class="calibre21" valign="bottom">
                <p class="calibre22">Gesture</p>
              </th>
            </tr>
          </thead>

          <tbody class="calibre23">
            <tr class="calibre20">
              <td class="calibre24" valign="top">
                <p class="calibre22"><code class="literal">UIPanGestureRecognizer</code></p>
              </td>

              <td class="calibre24" valign="top">
                <p class="calibre22"><code class="literal">PanGesture</code>;</p>

                <p class="calibre22">Continuous <a class="indexterm" id="id747"/>type</p>
              </td>

              <td class="calibre24" valign="top">
                <p class="calibre22">Pan images or <a class="indexterm" id="id748"/>over-sized views by dragging across the screen</p>
              </td>
            </tr>

            <tr class="calibre20">
              <td class="calibre24" valign="top">
                <p class="calibre22"><code class="literal">UISwipeGestureRecognizer</code></p>
              </td>

              <td class="calibre24" valign="top">
                <p class="calibre22"><code class="literal">SwipeGesture</code>;</p>

                <p class="calibre22">Continuous <a class="indexterm" id="id749"/>type</p>
              </td>

              <td class="calibre24" valign="top">
                <p class="calibre22">Similar to panning, <a class="indexterm" id="id750"/>except it is a swipe</p>
              </td>
            </tr>

            <tr class="calibre20">
              <td class="calibre24" valign="top">
                <p class="calibre22"><code class="literal">UITapGestureRecognizer</code></p>
              </td>

              <td class="calibre24" valign="top">
                <p class="calibre22"><code class="literal">TapGesture</code>;</p>

                <p class="calibre22">Discrete <a class="indexterm" id="id751"/>type</p>
              </td>

              <td class="calibre24" valign="top">
                <p class="calibre22">Tap the screen <a class="indexterm" id="id752"/>a number of times (configurable)</p>
              </td>
            </tr>

            <tr class="calibre20">
              <td class="calibre24" valign="top">
                <p class="calibre22"><code class="literal">UILongPressGestureRecognizer</code></p>
              </td>

              <td class="calibre24" valign="top">
                <p class="calibre22"><code class="literal">LongPressGesture</code>;</p>

                <p class="calibre22">Discrete <a class="indexterm" id="id753"/>type</p>
              </td>

              <td class="calibre24" valign="top">
                <p class="calibre22">Hold the <a class="indexterm" id="id754"/>finger down on the screen</p>
              </td>
            </tr>

            <tr class="calibre20">
              <td class="calibre24" valign="top">
                <p class="calibre22"><code class="literal">UIPinchGestureRecognizer</code></p>
              </td>

              <td class="calibre24" valign="top">
                <p class="calibre22"><code class="literal">PinchGesture</code>;</p>

                <p class="calibre22">Continuous <a class="indexterm" id="id755"/>type</p>
              </td>

              <td class="calibre24" valign="top">
                <p class="calibre22">Zoom by <a class="indexterm" id="id756"/>pinching an area and moving your fingers in or out</p>
              </td>
            </tr>

            <tr class="calibre20">
              <td class="calibre24" valign="top">
                <p class="calibre22"><code class="literal">UIRotationGestureRecognizer</code></p>
              </td>

              <td class="calibre24" valign="top">
                <p class="calibre22"><code class="literal">RotationGesture</code>;</p>

                <p class="calibre22">Continuous <a class="indexterm" id="id757"/>type</p>
              </td>

              <td class="calibre24" valign="top">
                <p class="calibre22">Rotate by <a class="indexterm" id="id758"/>moving your fingers in opposite directions</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <p class="calibre9">Gestures can be added by programming or via <a class="calibre1" id="id759"/>Xcode. The available gestures are listed in the following screenshot with the rest of the widgets on the right-hand side of the designer:</p>

      <div class="mediaobject"><img alt="Gestures" class="calibre11" src="../Images/00036.jpeg"/></div>

      <p class="calibre12"/>

      <p class="calibre9">To add a gesture, drag the gesture <a class="calibre1" id="id760"/>you want to use under the view on the View bar (shown in the following screenshot):</p>

      <div class="mediaobject"><img alt="Gestures" class="calibre11" src="../Images/00037.jpeg"/></div>

      <p class="calibre12"/>

      <p class="calibre9">Design the UI as you want and while pressing the <span class="strong"><em class="calibre15">Ctrl</em></span> key, drag the gesture to what you want to recognize using the gesture. In my example, the object you want to recognize is anywhere on the screen. Once you have connected the gesture to what you want to recognize, you will see the configurable options of the gesture.</p>

      <p class="calibre9">The <span class="strong"><strong class="calibre2">Taps</strong></span> field is the number of taps required before the Recognizer is triggered, and the <span class="strong"><strong class="calibre2">Touches</strong></span> field is the number of points onscreen required to be touched for the Recognizer to be triggered.</p>

      <p class="calibre9">When you come to connect up the UI, <a class="calibre1" id="id761"/>the gesture must also be added.</p>

      <div class="book" title="Gesture code">
        <div class="book">
          <div class="book">
            <div class="book">
              <h2 class="title1"><a class="calibre1" id="ch07lvl2sec38"/>Gesture code</h2>
            </div>
          </div>
        </div>

        <p class="calibre9">When using Xcode, it is simple to <a class="calibre1" id="id762"/>code gestures. The class defined in the Xcode design for the tapping gesture is <a class="calibre1" id="id763"/>called <a class="calibre1" id="id764"/> <code class="email">tapGesture</code> and is used in the following code:</p>

        <div class="informalexample">
          <pre class="programlisting">private int tapped = 0;
public override void ViewDidLoad()
{
    base.ViewDidLoad();
    tapGesture.AddTarget(this, new Selector("screenTapped"));
    View.AddGestureRecognizer(tapGesture);
}
[Export("screenTapped")]public void SingleTap(UIGestureRecognizer s)
{
    tapped++;
    lblCounter.Text = tapped.ToString();
}</pre>
        </div>

        <p class="calibre9">There is nothing really amazing to the code; it just displays how many times the screen has been tapped.</p>

        <p class="calibre9">The <code class="email">Selector</code> <a class="calibre1" id="id765"/>method is <a class="calibre1" id="id766"/>called by the code when the tap has been seen. The method name doesn't make any difference as long <a class="calibre1" id="id767"/>as the <code class="email">Selector</code> and <code class="email">Export</code> names are the same.</p>
      </div>

      <div class="book" title="Types">
        <div class="book">
          <div class="book">
            <div class="book">
              <h2 class="title1"><a class="calibre1" id="ch07lvl2sec39"/>Types</h2>
            </div>
          </div>
        </div>

        <p class="calibre9">When the gesture types were originally <a class="calibre1" id="id768"/>described, they were given a type. The type reflects the number of messages sent to the <code class="email">Selector</code> method. A discrete one generates a single message. A continuous one generates multiple messages, which requires the <code class="email">Selector</code> method to be more complex. The complexity is added by the <code class="email">Selector</code> method having to check the <span class="strong"><strong class="calibre2">State</strong></span> of the gesture to decide on what to do with what message and whether it has been completed.</p>
      </div>

      <div class="book" title="Adding a gesture in code">
        <div class="book">
          <div class="book">
            <div class="book">
              <h2 class="title1"><a class="calibre1" id="ch07lvl2sec40"/>Adding a gesture in code</h2>
            </div>
          </div>
        </div>

        <p class="calibre9">It is not a requirement that Xcode <a class="calibre1" id="id769"/>be used to add a gesture. To perform the same task in the following code as my preceding code did in Xcode is easy. The code will be as follows:</p>

        <div class="informalexample">
          <pre class="programlisting">UITapGestureRecognizer t'pGesture = new UITapGestureRecognizer()
{
    NumberOfTapsRequired = 1
};</pre>
        </div>

        <p class="calibre9">The rest of the code from <code class="email">AddTarget</code> can then be used.</p>
      </div>

      <div class="book" title="Continuous types">
        <div class="book">
          <div class="book">
            <div class="book">
              <h2 class="title1"><a class="calibre1" id="ch07lvl2sec41"/>Continuous types</h2>
            </div>
          </div>
        </div>

        <p class="calibre9">The following code, a Pinch <a class="calibre1" id="id770"/>Recognizer, shows a simple rescaling. There are a couple of other states that I'll explain after the code. The only difference in the designer code is that I have <code class="email">UIImageView</code> instead of a label and a <code class="email">UIPinchGestureRecognizer</code> class instead of a <code class="email">UITapGestureRecognizer</code> class.</p>

        <div class="informalexample">
          <pre class="programlisting">public override void ViewDidLoad()
{
    base.ViewDidLoad();
    uiImageView.Image =UIImage.FromFile("graphics/image.jpg")Scale(new SizeF(160f, 160f);
    pinchGesture.AddTarget(this, new Selector("screenTapped"));
    uiImageView.AddGestureRecognizer(pinchGesture);
}
[Export("screenTapped")]public void SingleTap(UIGestureRecognizer s)
{
    UIPinchGestureRecognizer pinch = (UIPinchGestureRecognizer)s;
    float scale = 0f;
    PointF location;
    switch(s.State)
    {
        case UIGestureRecognizerState.Began:
            Console.WriteLine("Pinch begun");
            location = s.LocationInView(s.View);
            break;
         case UIGestureRecognizerState.Changed:
             Console.WriteLine("Pinch value changed");
             scale = pinch.Scale;
             uiImageView.Image = UIImageFromFile("graphics/image.jpg")Scale(new SizeF(160f, 160f), scale);
             break;
         case UIGestureRecognizerState.Cancelled:
             Console.WriteLine("Pinch cancelled");
             uiImageView.Image = UIImageFromFile("graphics/image.jpg")Scale(new SizeF(160f, 160f));
             scale = 0f;
             break;
         case UIGestureRecognizerState.Recognized:
             Console.WriteLine("Pinch recognized");
             break;
    }
}</pre>
        </div>

        <div class="book" title="Other UIGestureRecognizerState values">
          <div class="book">
            <div class="book">
              <div class="book">
                <h3 class="title2"><a class="calibre1" id="ch07lvl3sec100"/>Other UIGestureRecognizerState values</h3>
              </div>
            </div>
          </div>

          <p class="calibre9">The following table gives a list of other Recognizer states:</p>

          <div class="informalexample">
            <table border="1" class="calibre16">
              <colgroup class="calibre17">
                <col class="calibre18"/>
                <col class="calibre18"/>
                <col class="calibre18"/>
              </colgroup>

              <thead class="calibre19">
                <tr class="calibre20">
                  <th class="calibre21" valign="bottom">
                    <p class="calibre22">State</p>
                  </th>

                  <th class="calibre21" valign="bottom">
                    <p class="calibre22">Description</p>
                  </th>

                  <th class="calibre21" valign="bottom">
                    <p class="calibre22">Notes</p>
                  </th>
                </tr>
              </thead>

              <tbody class="calibre23">
                <tr class="calibre20">
                  <td class="calibre24" valign="top">
                    <p class="calibre22">Possible</p>
                  </td>

                  <td class="calibre24" valign="top">
                    <p class="calibre22">Default <a class="indexterm" id="id771"/>state; gesture hasn't been recognized</p>
                  </td>

                  <td class="calibre24" valign="top">
                    <p class="calibre22">Used <a class="indexterm" id="id772"/>by all gestures</p>
                  </td>
                </tr>

                <tr class="calibre20">
                  <td class="calibre24" valign="top">
                    <p class="calibre22">Failed</p>
                  </td>

                  <td class="calibre24" valign="top">
                    <p class="calibre22">Gesture <a class="indexterm" id="id773"/>failed</p>
                  </td>

                  <td class="calibre24" valign="top">
                    <p class="calibre22">No <a class="indexterm" id="id774"/>messages sent for this state</p>
                  </td>
                </tr>

                <tr class="calibre20">
                  <td class="calibre24" valign="top">
                    <p class="calibre22">Translation</p>
                  </td>

                  <td class="calibre24" valign="top">
                    <p class="calibre22">Direction of <a class="indexterm" id="id775"/>pan</p>
                  </td>

                  <td class="calibre24" valign="top">
                    <p class="calibre22">Used in <a class="indexterm" id="id776"/>the pan gesture</p>
                  </td>
                </tr>

                <tr class="calibre20">
                  <td class="calibre24" valign="top">
                    <p class="calibre22">Velocity</p>
                  </td>

                  <td class="calibre24" valign="top">
                    <p class="calibre22">Speed of <a class="indexterm" id="id777"/>pan</p>
                  </td>

                  <td class="calibre24" valign="top">
                    <p class="calibre22">Used in <a class="indexterm" id="id778"/>the pan gesture</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <p class="calibre9">In addition to these, it should be noted that discrete types only use Possible and Recognized states.</p>
        </div>
      </div>
    </div>
  </div>


  <div class="book" title="Handling drag-and-drop">
    <div class="book">
      <div class="book">
        <div class="book">
          <h1 class="title"><a class="calibre1" id="ch07lvl1sec31"/>Handling drag-and-drop</h1>
        </div>
      </div>
    </div>

    <p class="calibre9">Drag-and-drop can be handled <a class="calibre1" id="id779"/>using a gesture or by using the <code class="email">TouchesBegan</code>, <code class="email">TouchesMoved</code>, and <code class="email">TouchesEnded</code> handlers. Essentially, a custom <code class="email">UIImageView</code> class can be used, as shown <a class="calibre1" id="id780"/>in the following code:</p>

    <div class="informalexample">
      <pre class="programlisting">public class myDragImage : UIImageView 
{
    private PointF myLoc, myStartLoc;
    private bool TouchedOnce = false;

    public myDragImage (RectangleF frame)
    {
        this.Frame = frame;
        myStartLoc = this.Frame.Location;
    }
    public override void TouchesBegan(NSSet touches, UIEvent e)
    {
        myLoc = Frame.Location;

        var touch = (UITouch)e.TouchesForView(this).AnyObject;
        var bounds = Bounds;

        myStartLoc = touch.LocationInView(this);
        Frame = new RectangleF(Location,bounds.Size);
    }
    public override void TouchesMoved(NSSet touches, UIEvent e)
    {
        var bounds = Bounds;
        var touch = (UITouch)e.TouchesForView(this).AnyObject;

        myLoc.X += touch.LocationInView(this).X - myStartLoc.X;
        myLoc.Y += touch.LocationInView(this).Y - myStartLoc.Y;

        Frame = new RectangleF(myLoc, bounds.Size);
        TouchedOnce = true;
    }

    public override void TouchesEnded(NSSet touches, UIEvent e)
    {
        myStartLoc = myLoc;
    }
}</pre>
    </div>

    <p class="calibre9">This is used as a simple way to <a class="calibre1" id="id781"/>handle drag-and-drop. For a gesture, a Continuous type should be <a class="calibre1" id="id782"/>used.</p>
  </div>


  <div class="book" title="Summary">
    <div class="book">
      <div class="book">
        <div class="book">
          <h1 class="title"><a class="calibre1" id="ch07lvl1sec32"/>Summary</h1>
        </div>
      </div>
    </div>

    <p class="calibre9">Gestures certainly can add a lot to your apps. They can enable the user to speed around an image, move about a map, enlarge and reduce, as well as select areas of anything on a view. Their flexibility underpins why iOS is recognized as being an extremely versatile device for users to manipulate images, video, and anything else on-screen.</p>
  </div>
</body></html>