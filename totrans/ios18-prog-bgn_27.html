<html><head></head><body><div><div><div><h1 class="chapterNumber">23</h1>
    <h1 id="_idParaDest-290" class="chapterTitle">Getting Started with SwiftData</h1>
    <p class="normal">During Apple’s <strong class="keyWord">World</strong> <strong class="keyWord">Wide Developer Conference</strong> (<strong class="keyWord">WWDC</strong>) in 2023, they introduced <strong class="keyWord">SwiftData</strong>, an all-new<a id="_idIndexMarker977"/> framework for saving app data. Previously, developers had to use an editor to create data models, but SwiftData allows developers to describe data models and manipulate model instances using regular Swift code. Features such as relationship management, undo/redo support, iCloud synchronization, and more are provided automatically. In 2024, Apple added new APIs that enable developers to build custom data stores, work with transaction history, model indices and compound uniqueness constraints, and more.</p>
    <p class="normal">In this chapter, you’re going to modify the <em class="italic">JRNL</em> app that you completed in <em class="chapterRef">Chapter 16</em>, <em class="italic">Passing Data between View Controllers</em>, to save journal entries using SwiftData. This means that when you add new journal entries to the app, they will reappear the next time the app is launched.</p>
    <p class="normal">First, you’ll learn about SwiftData and its components. Next, you’ll modify the <code class="inlineCode">JournalEntry</code> class to make it compatible with SwiftData and modify the <code class="inlineCode">JournalListViewController</code> class to work with the modified <code class="inlineCode">JournalEntry</code> class. After that, you’ll implement SwiftData by adding code that will allow you to read, write, and delete journal entries; and finally, you’ll modify the <code class="inlineCode">JournalViewController</code> class to read, save, and delete stored journal entries.</p>
    <p class="normal">By the end of this chapter, you’ll have learned how to save app data using SwiftData and will be able to implement it in your own apps.</p>
    <p class="normal">The following topics will be covered in this chapter:</p>
    <ul>
      <li class="bulletList">Introducing SwiftData</li>
      <li class="bulletList">Modifying the <code class="inlineCode">JournalEntry</code> class</li>
      <li class="bulletList">Implementing SwiftData components</li>
      <li class="bulletList">Modifying the <code class="inlineCode">JournalListViewController</code> class</li>
    </ul>
    <h1 id="_idParaDest-291" class="heading-1">Technical requirements</h1>
    <p class="normal">You will continue working on the <code class="inlineCode">JRNL</code> project that you modified in <em class="chapterRef">Chapter 16</em>, <em class="italic">Passing Data between View Controllers</em>.</p>
    <p class="normal">The resource files and completed Xcode project for this chapter are in the <code class="inlineCode">Chapter23</code> folder of the code bundle for this book, which can be downloaded here:</p>
    <p class="normal"><a href="https://github.com/PacktPublishing/iOS-18-Programming-for-Beginners-Ninth-Edition%0D">https://github.com/PacktPublishing/iOS-18-Programming-for-Beginners-Ninth-Edition</a></p>
    <p class="normal">Check out the following video to see the code in action:</p>
    <p class="normal"><a href="https://youtu.be/VFYb8Yohh6g%0D">https://youtu.be/VFYb8Yohh6g</a></p>
    <p class="normal">Let’s start by learning more about SwiftData.</p>
    <h1 id="_idParaDest-292" class="heading-1">Introducing SwiftData</h1>
    <p class="normal">SwiftData is Apple’s all-new<a id="_idIndexMarker978"/> framework for saving app data to your device. It automatically provides relationship management, undo/redo support, iCloud synchronization, and more. You can model your data using regular Swift types, and SwiftData will then build a custom schema using your specified model and map its fields to device storage. You can query and filter your data using expressions that are type-checked by the compiler, resulting in fewer typos or mistakes.</p>
    <div><p class="normal">You can learn more about SwiftData at <a href="https://developer.apple.com/documentation/swiftdata">https://developer.apple.com/documentation/swiftdata</a>.</p>
    </div>
    <p class="normal">During WWDC 2024, Apple added new APIs to SwiftData. These enable you to model indices and compound unique constraints using macros, build custom data stores using your own document format, keep track of transaction history, and more.</p>
    <div><p class="normal">You can learn more about what’s new in SwiftData at <a href="https://developer.apple.com/videos/play/wwdc2024/10137/">https://developer.apple.com/videos/play/wwdc2024/10137/</a>.</p>
    </div>
    <p class="normal">Several steps are required to implement SwiftData for an app. First, existing classes are turned into models with the <code class="inlineCode">@Model</code> macro. Primitive types such as <code class="inlineCode">Bool</code>, <code class="inlineCode">Int</code>, and <code class="inlineCode">String</code> are supported, as well as complex value types such as structures and enumerations. Next, model attributes are customized as required using annotations such as <code class="inlineCode">@Attribute(.unique)</code> to ensure the property’s value is unique and <code class="inlineCode">@Attribute(.externalStorage)</code> to store the property’s value adjacent to model storage as binary data. Then, models to be persisted are specified and a <code class="inlineCode">ModelContainer</code> instance is created, which manages an app’s schema and model storage configuration. </p>
    <p class="normal">After that, a <code class="inlineCode">ModelContext</code> instance is used to fetch, insert, and delete model instances and save any changes to device storage while the app is running. Finally, to fetch specific instances from device storage, a <code class="inlineCode">FetchDescriptor</code> instance containing a search predicate and a sort order is used.</p>
    <div><p class="normal">You can learn more about preserving your app’s model data across launches at <a href="https://developer.apple.com/documentation/swiftdata/preserving-your-apps-model-data-across-launches">https://developer.apple.com/documentation/swiftdata/preserving-your-apps-model-data-across-launches</a>.</p>
    </div>
    <p class="normal">Before you implement SwiftData for the <em class="italic">JRNL</em> app, here’s an example to help you visualize what you need to do to save journal entries.</p>
    <p class="normal">Imagine you’re saving a <a id="_idIndexMarker979"/>journal entry using Microsoft Word. You first create a new Word document template with the relevant fields for a journal entry. You then create new Word documents based on the templates and fill in the data. You make whatever changes are necessary, perhaps changing the text of the journal entry, or changing the photo. When you are happy with your document, you save it to the hard disk of your computer. The next time you want to view your journal entry, you search your hard disk for the relevant document and double-click it to open it in Word so you can see it once more.</p>
    <p class="normal">Now that you have an idea of what you need to do, let’s review the steps required to implement SwiftData for your app.</p>
    <p class="normal">First, you turn the existing <code class="inlineCode">JournalEntry</code> class into a model, which is like a Microsoft Word template. You do this by annotating the <code class="inlineCode">JournalEntry</code> class with the <code class="inlineCode">@Model</code> macro. The properties of the <code class="inlineCode">JournalEntry</code> class are like fields in the Microsoft Word template and you will customize properties with the <code class="inlineCode">@Attribute</code> macro if required.</p>
    <p class="normal">Next, you will create a <code class="inlineCode">ModelContainer</code> instance, which will be used to store <code class="inlineCode">JournalEntry</code> model instances on your device’s storage, and create a <code class="inlineCode">ModelContext</code> instance, which will be used to store <code class="inlineCode">JournalEntry</code> model instances in memory. This is like the way Microsoft Word files created from Microsoft Word templates can be stored on your computer’s hard disk or kept in memory as they are being edited.</p>
    <p class="normal">After that, you will add code so that when you create a new journal entry, a <code class="inlineCode">JournalEntry</code> model instance is created and added to the <code class="inlineCode">ModelContext</code> instance, which then coordinates with the <code class="inlineCode">ModelContainer</code> instance to save it to device storage. This is like saving Word documents to your hard disk when you’re done with them.</p>
    <div><p class="normal">You can learn more about how to build an app with SwiftData by watching the following video: <a href="https://developer.apple.com/videos/play/wwdc2023/10154/">https://developer.apple.com/videos/play/wwdc2023/10154/</a>.</p>
    </div>
    <p class="normal">Now that you have a <a id="_idIndexMarker980"/>basic understanding of how SwiftData works, you’ll use the <code class="inlineCode">JournalEntry</code> class to create the <code class="inlineCode">JournalEntry</code> model in the next section.</p>
    <h1 id="_idParaDest-293" class="heading-1">Modifying the JournalEntry class</h1>
    <p class="normal">Currently, when <a id="_idIndexMarker981"/>you create a new journal entry using the Add New Journal Entry screen and click the <strong class="screenText">Save</strong> button, the entry will appear on the Journal List screen:</p>
    <figure class="mediaobject"><img src="img/B31371_23_01.png" alt="" width="463" height="825"/></figure>
    <p class="packt_figref">Figure 23.1: Simulator showing new entries added to the Journal List screen</p>
    <p class="normal">If you quit and restart <a id="_idIndexMarker982"/>your app, the newly added entries will disappear:</p>
    <figure class="mediaobject"><img src="img/B31371_23_02.png" alt="" width="463" height="825"/></figure>
    <p class="packt_figref">Figure 23.2: Simulator showing new entries disappearing after the app is relaunched</p>
    <p class="normal">This is because the <a id="_idIndexMarker983"/>contents of the <code class="inlineCode">journalEntries</code> array are only kept in memory and not saved to device storage when the app is closed. To resolve this, you will implement SwiftData for your app. The first step in implementing SwiftData is to create model objects from your existing <code class="inlineCode">JournalEntry</code> class, modifying this and other classes in your app as needed. </p>
    <p class="normal">Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">In the Project navigator, click the <strong class="screenText">JournalEntry</strong> file (located in the <strong class="screenText">Journal List Scene</strong> | <strong class="screenText">Model</strong> group). Import the <code class="inlineCode">SwiftData</code> framework and annotate the <code class="inlineCode">JournalEntry</code> class with the <code class="inlineCode">@Model</code> macro, as shown:
        <pre class="programlisting code-one"><code class="hljs-code">import UIKit
<strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> SwiftData</strong>
<strong class="hljs-con-attribute-slc">@Model</strong>
class JournalEntry {
    //MARK: - Properties
    let date: Date
</code></pre>
      </li>
      <li class="numberedList">Choose <strong class="screenText">Build</strong> from Xcode’s <strong class="screenText">Product</strong> menu. You will see error messages appear in the Navigator area. Click any one of the first three error messages to expand the <a id="_idIndexMarker984"/>macro and display the error:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B31371_23_03.png" alt="" width="812" height="448"/></figure>
    <p class="packt_figref">Figure 23.3: Editor area showing errors</p>
    <p class="normal-one">These errors appear because SwiftData at present does not support the <code class="inlineCode">UIImage</code> class. To fix this, you will need to modify the <code class="inlineCode">JournalEntry</code> class to use <code class="inlineCode">Data</code> instances in place of <code class="inlineCode">UIImage</code> instances.</p>
    <ol>
      <li class="numberedList" value="3">Replace the <code class="inlineCode">photo</code> property in the <code class="inlineCode">JournalEntry</code> class with a <code class="inlineCode">photoData</code> property of type <code class="inlineCode">Data?</code>, as shown:
        <pre class="programlisting code-one"><code class="hljs-code">let body: String
<strong class="hljs-con-attribute-slc">@Attribute</strong><strong class="hljs-slc">(.</strong><strong class="hljs-con-attribute-slc">externalStorage</strong><strong class="hljs-slc">) </strong><strong class="hljs-keyword-slc">let</strong><strong class="hljs-slc"> </strong><strong class="hljs-template-variable-slc">photoData</strong><strong class="hljs-slc">: </strong><strong class="hljs-type-slc">Data</strong><strong class="hljs-slc">?</strong>
let latitude: Double?
</code></pre>
      </li>
    </ol>
    <p class="normal-one">The <code class="inlineCode">@Attribute(.externalStorage) </code>annotation will store the data for the photo in a binary file adjacent to the model data, which makes it more efficient.</p>
    <ol>
      <li class="numberedList" value="4">Next, you will address <a id="_idIndexMarker985"/>the other error messages, which say <strong class="screenText">Cannot expand accessors on variable declared with ‘let’</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B31371_23_04.png" alt="" width="812" height="315"/></figure>
    <p class="packt_figref">Figure 23.4: Navigator area showing errors</p>
    <ol>
      <li class="numberedList" value="5">To resolve this, replace all the <code class="inlineCode">let</code> keywords for the <code class="inlineCode">JournalEntry</code> class properties with <code class="inlineCode">var</code>, as shown:
        <pre class="programlisting code-one"><code class="hljs-code">// MARK: - Properties
<strong class="hljs-keyword-slc">var</strong> date: Date
<strong class="hljs-keyword-slc">var</strong> rating: Int
<strong class="hljs-keyword-slc">var</strong> title: String
<strong class="hljs-keyword-slc">var</strong> body: String
@Attribute(.externalStorage) <strong class="hljs-keyword-slc">var</strong> photoData: Data?
<strong class="hljs-keyword-slc">var</strong> latitude: Double?
<strong class="hljs-keyword-slc">var</strong> longitude: Double?
</code></pre>
      </li>
      <li class="numberedList">There will be an error in the initializer for the <code class="inlineCode">JournalEntry</code> class. To fix it, modify the code in the initializer, as shown:
        <pre class="programlisting code-one"><code class="hljs-code">self.body = body
<strong class="hljs-keyword-slc">self</strong><strong class="hljs-slc">.</strong><strong class="hljs-variable-slc">photoData</strong><strong class="hljs-slc"> </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> ph</strong><strong class="hljs-slc"/><strong class="hljs-slc"/><strong class="hljs-slc">oto</strong><strong class="hljs-operator-slc">?</strong><strong class="hljs-slc">.jpegData(compressionQuality: </strong><strong class="hljs-number-slc">1.0</strong><strong class="hljs-slc">)</strong>
self.latitude = latitude
</code></pre>
      </li>
    </ol>
    <p class="normal-one">This statement will convert a <code class="inlineCode">UIImage</code> instance into a <code class="inlineCode">Data</code> instance using JPEG encoding, which can be stored in the <code class="inlineCode">photoData</code> property.</p>
    <ol>
      <li class="numberedList" value="7">If you build the project now, more errors will appear. Click the <strong class="screenText">JournalEntryDetailViewController</strong> file in the Project navigator. Modify the <code class="inlineCode">viewDidLoad()</code> method as shown:
        <pre class="programlisting code-one"><code class="hljs-code">titleLabel.text = selectedJournalEntry?.title
bodyTextView.text = selectedJournalEntry?.body
<strong class="hljs-keyword-slc">if</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">let</strong><strong class="hljs-slc"> photoData </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc">selectedJournalEntry</strong><strong class="hljs-operator-slc">?</strong><strong class="hljs-slc">.</strong><strong class="hljs-variable-slc">photoData</strong><strong class="hljs-slc"> {</strong>
<strong class="hljs-slc">  </strong><strong class="hljs-variable-slc">photoImageView</strong><strong class="hljs-slc">.</strong><strong class="hljs-con-attribute-slc">image</strong><strong class="hljs-slc"> </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> </strong><strong class="hljs-type-slc">UIImage</strong><strong class="hljs-slc">(</strong><strong class="hljs-con-attribute-slc">data</strong><strong class="hljs-slc">: </strong><strong class="hljs-variable-slc">photoData</strong><strong class="hljs-slc">)</strong>
<strong class="hljs-slc">}</strong>
</code></pre>
      </li>
    </ol>
    <p class="normal-one">This code checks to see if the <code class="inlineCode">JournalEntry</code> instance’s <code class="inlineCode">photoData</code> property has a value. If this is the case, it is converted into a <code class="inlineCode">UIImage</code> instance and assigned to <a id="_idIndexMarker986"/>the <code class="inlineCode">photoImageView</code> instance’s <code class="inlineCode">image</code> property.</p>
    <ol>
      <li class="numberedList" value="8">Click the <strong class="screenText">JournalListViewController</strong> file in the Project navigator. Modify the <code class="inlineCode">tableView(_:cellForRowAt:)</code> method as follows:
        <pre class="programlisting code-one"><code class="hljs-code">let journalEntry = journalEntries[indexPath.row]
<strong class="hljs-keyword-slc">if</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">let</strong><strong class="hljs-slc"> photoData </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> journalEntry.</strong><strong class="hljs-variable-slc">photoData</strong><strong class="hljs-slc"> {</strong>
<strong class="hljs-slc">  </strong><strong class="hljs-type-slc">Task</strong><strong class="hljs-slc"> {</strong>
<strong class="hljs-slc">    journalCell.</strong><strong class="hljs-variable-slc">photoImageView.</strong><strong class="hljs-con-attribute-slc">image</strong><strong class="hljs-slc"> </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> </strong><strong class="hljs-type-slc">UIImage</strong><strong class="hljs-slc">(</strong><strong class="hljs-con-attribute-slc">data</strong><strong class="hljs-slc">: </strong><strong class="hljs-slc">    photoData)</strong>

<strong class="hljs-slc">  }</strong>
<strong class="hljs-slc">}</strong>
journalCell.dateLabel.text = journalEntry.date.formatted(
  .dateTime.month().day().year()
)
</code></pre>
      </li>
    </ol>
    <p class="normal-one">This code checks to see if the <code class="inlineCode">JournalEntry</code> instance’s <code class="inlineCode">photoData</code> property has a value. If this is the case, it is converted into a <code class="inlineCode">UIImage</code> instance and assigned to <code class="inlineCode">journalCell.photoImageView.image</code>. Since this process is repeated for every row in the table view and decoding JPEG data into a <code class="inlineCode">UIImage</code> instance can be slow, a <code class="inlineCode">Task</code> block is used to make this process asynchronous.</p>
    <p class="normal">All errors should now be resolved. You may need to quit and reopen your project before all the errors disappear.</p>
    <p class="normal">If you were to build and<a id="_idIndexMarker987"/> run your project now, you would get an error because the SwiftData <code class="inlineCode">ModelContainer</code> instance has not been created. You’ll learn how to do that in the next section.</p>
    <h1 id="_idParaDest-294" class="heading-1">Implementing SwiftData components</h1>
    <p class="normal">Now that you have <a id="_idIndexMarker988"/>used the <code class="inlineCode">JournalEntry</code> class to create a <code class="inlineCode">JournalEntry</code> model, you will create<a id="_idIndexMarker989"/> a <strong class="keyWord">singleton</strong> class that contains a <code class="inlineCode">ModelContainer</code> object and a <code class="inlineCode">ModelContext</code> instance. You will then add methods to manipulate instances of the <code class="inlineCode">JournalEntry</code> model stored in <code class="inlineCode">ModelContext</code>.</p>
    <div><p class="normal">The term <strong class="keyWord">singleton</strong> means that there is only one instance of this class in your app.</p>
    </div>
    <p class="normal">Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">Right-click the <code class="inlineCode">JRNL</code> folder in the Project navigator and choose <strong class="screenText">New File from Template...</strong> from the pop-up menu.</li>
      <li class="numberedList"><strong class="screenText">iOS</strong> should already be selected. Choose <strong class="screenText">Swift File</strong> and then click <strong class="screenText">Next</strong>.</li>
      <li class="numberedList">Name this file <code class="inlineCode">SharedData</code>. Click <strong class="screenText">Create</strong>. The <code class="inlineCode">SharedData</code> file appears in the Project navigator. Move the file so that it is under the <code class="inlineCode">SceneDelegate</code> file.</li>
      <li class="numberedList">Add the following code after the <code class="inlineCode">import</code> statement:
        <pre class="programlisting code-one"><code class="hljs-code">import SwiftData
</code></pre>
      </li>
    </ol>
    <p class="normal-one">This lets you use the SwiftData framework.</p>
    <ol>
      <li class="numberedList" value="5">Add the following code after the <code class="inlineCode">import</code> statements to declare and define the <code class="inlineCode">SharedData</code> class:
        <pre class="programlisting code-one"><code class="hljs-code">class SharedData {
  // MARK: - Properties
  @MainActor static let shared = SharedData()
  let container: ModelContainer
  let context: ModelContext
   
  // MARK: - Initialization
  private init() {
    do {
      container = try ModelContainer(for:       JournalEntry.self)
      context = ModelContext(container)   
    } catch {
      fatalError("Could not create SwiftData model 
      container or context")
    }
  } 
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">This class creates a singleton instance that will be available throughout your app and assigns it to the <code class="inlineCode">shared</code> static variable. It also creates and initializes <code class="inlineCode">ModelContainer</code> and <code class="inlineCode">ModelContext</code> instances and assigns them to the <code class="inlineCode">container</code> and <code class="inlineCode">context</code> properties, respectively.</p>
    <p class="normal">Next, you’ll add methods for <a id="_idIndexMarker990"/>loading, adding, and deleting <code class="inlineCode">JournalEntry</code> model instances. Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">Add the following code after the initializer to implement the <code class="inlineCode">loadJournalEntries()</code> method:
        <pre class="programlisting code-one"><code class="hljs-code">func loadJournalEntries() -&gt; [JournalEntry] {
  let descriptor = FetchDescriptor&lt;JournalEntry&gt;(sortBy:  
  [SortDescriptor&lt;JournalEntry&gt;(\.date, order: .reverse)])
  do {
    let journalEntries = try context.fetch(descriptor)
    return journalEntries
  } catch {
    return []
  }
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">Let’s break this down:</p>
    <pre class="programlisting code-one"><code class="hljs-code">func loadJournalEntries() -&gt; [JournalEntry] {
</code></pre>
    <p class="normal-one">This method returns an array of <code class="inlineCode">JournalEntry</code> instances.</p>
    <pre class="programlisting code-one"><code class="hljs-code">let descriptor = FetchDescriptor&lt;JournalEntry&gt;(sortBy:  
[SortDescriptor&lt;JournalEntry&gt;(\.date, order: .reverse)])
</code></pre>
    <p class="normal-one">This statement creates a <code class="inlineCode">FetchDescriptor</code> instance that specifies that all <code class="inlineCode">JournalEntry</code> model instances stored in the <code class="inlineCode">ModelContext</code> instance are to be fetched and sorted by date, from newest to oldest.</p>
    <pre class="programlisting code-one"><code class="hljs-code">do {
  let journalEntries = try context.fetch(descriptor)
  return journalEntries
} catch {
  return []
  }
}
</code></pre>
    <p class="normal-one">This block of code gets all the <code class="inlineCode">JournalEntry</code> model instances specified by the <code class="inlineCode">FetchDescriptor</code> instance from the <code class="inlineCode">ModelContext</code> instance and assigns them to <code class="inlineCode">journalEntries</code>, a constant of type <code class="inlineCode">[JournalEntry]</code>, which is then returned. If the operation fails, an empty array will be returned.</p>
    <ol>
      <li class="numberedList" value="2">Implement the <code class="inlineCode">saveJournalEntry(_:)</code> method by adding the following code before the<a id="_idIndexMarker991"/> final curly brace:
        <pre class="programlisting code-one"><code class="hljs-code">func saveJournalEntry(_ journalEntry: JournalEntry) {
  context.insert(journalEntry)
  try? context.save()
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">This method inserts the <code class="inlineCode">journalEntry</code> instance passed to it into the <code class="inlineCode">ModelContext</code> instance as a <code class="inlineCode">JournalEntry</code> model instance.</p>
    <ol>
      <li class="numberedList" value="3">Implement the <code class="inlineCode">deleteJournalEntry(_:)</code> method by adding the following code before the final curly brace:
        <pre class="programlisting code-one"><code class="hljs-code">func deleteJournalEntry(_ journalEntry: JournalEntry) {
  context.delete(journalEntry)
  try? context.save()
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">This method removes the corresponding <code class="inlineCode">JournalEntry</code> model instance from the <code class="inlineCode">ModelContext</code> instance.</p>
    <p class="normal">You’ve created a <code class="inlineCode">SharedData</code> class that creates a <code class="inlineCode">ModelContainer</code> instance and implemented methods to fetch, add, and delete <code class="inlineCode">JournalEntry</code> model instances from a <code class="inlineCode">ModelContext</code> object. You can build your app to test for errors, but you can’t run it yet.</p>
    <p class="normal">At this point, you’ve implemented all the required SwiftData components in your app. In the next section, you’ll configure the <code class="inlineCode">JournalListViewController</code> class to fetch all journal entries stored in the <code class="inlineCode">ModelContainer</code> instance when the app is run, add new <code class="inlineCode">JournalEntry</code> model instances to the <code class="inlineCode">ModelContext</code> instance when you add a new journal entry, and <a id="_idIndexMarker992"/>remove <code class="inlineCode">JournalEntry</code> model instances from the <code class="inlineCode">ModelContext</code> instance when you delete a journal entry.</p>
    <h1 id="_idParaDest-295" class="heading-1">Modifying the JournalListViewController class</h1>
    <p class="normal">Previously, when you<a id="_idIndexMarker993"/> added or removed journal entries from your app, the changes made would be gone when you stopped and ran the app again because the code in the <code class="inlineCode">JournalListViewController</code> class had no way to save app data to your device. You will add code to the <code class="inlineCode">JournalListViewController</code> class to save app data using SwiftData in this section.</p>
    <p class="normal">You will update the <code class="inlineCode">viewDidLoad()</code> method to fetch all journal entries from device storage when you run the app, update the <code class="inlineCode">unwindNewEntrySave(segue:)</code> method to add a new journal entry to the <code class="inlineCode">ModelContext</code> instance, and update the <code class="inlineCode">tableView(_:commit:forRowAt:)</code> method to remove the specified journal entry from the <code class="inlineCode">ModelContext</code> instance. Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">Click the <code class="inlineCode">JournalListViewController</code> file in the Project navigator and add a method to fetch all journal entries from device storage before the closing curly brace:
        <pre class="programlisting code-one"><code class="hljs-code">func fetchJournalEntries() {
  journalEntries =
  SharedData.shared.loadJournalEntries()
  tableView.reloadData()
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">This method calls the <code class="inlineCode">loadJournalEntries()</code> method in the <code class="inlineCode">SharedData</code> singleton, which returns an array of <code class="inlineCode">JournalEntry</code> instances. This array is then assigned to the <code class="inlineCode">journalEntries</code> array, and the table view is reloaded.</p>
    <ol>
      <li class="numberedList" value="2">Modify the <code class="inlineCode">viewDidLoad()</code> method as follows to call the <code class="inlineCode">fetchJournalEntries()</code> method:
        <pre class="programlisting code-one"><code class="hljs-code">override func viewDidLoad() {
  super.viewDidLoad()
  <strong class="hljs-variable-slc">fetchJournalEntries</strong><strong class="hljs-slc">()</strong>
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">Since the journal entries you add to the app will now be persistent, you no longer need to call the method used to create sample data for your app.</p>
    <ol>
      <li class="numberedList" value="3">Modify the <code class="inlineCode">unwindNewEntrySave(segue:)</code> method to add the new journal entry to device storage and update the table view:
        <pre class="programlisting code-one"><code class="hljs-code">@IBAction func unwindNewEntrySave(segue: UIStoryboardSegue) {
  if let sourceViewController = segue.source as?
  AddJournalEntryViewController, let newJournalEntry =
  sourceViewController.newJournalEntry {
<strong class="hljs-slc">    </strong><strong class="hljs-con-class-slc">SharedData</strong><strong class="hljs-slc">.</strong><strong class="hljs-variable-slc">shared</strong><strong class="hljs-slc">.</strong><strong class="hljs-variable-slc">saveJournalEntry</strong><strong class="hljs-slc">(newJournalEntry)</strong>
<strong class="hljs-slc">    </strong><strong class="hljs-variable-slc">fetchJournalEntries</strong><strong class="hljs-slc">()</strong>
  }
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">The new <code class="inlineCode">JournalEntry</code> instance<a id="_idIndexMarker994"/> is passed to the <code class="inlineCode">saveJournalEntry</code> method in the <code class="inlineCode">SharedData</code> singleton, where it is inserted into the <code class="inlineCode">ModelContext</code> instance as a <code class="inlineCode">JournalEntry</code> model instance. The <code class="inlineCode">fetchJournalEntries()</code> method then updates the <code class="inlineCode">journalEntries</code> array and reloads the table view.</p>
    <ol>
      <li class="numberedList" value="4">Modify the <code class="inlineCode">tableView(_:commit:forRowAt:)</code> method to delete the specified journal entry from device storage and update the table view:
        <pre class="programlisting code-one"><code class="hljs-code">func tableView(_ tableView: UITableView, commit editingStyle: UITableViewCell.EditingStyle, forRowAt indexPath: IndexPath) {
  if editingStyle == .delete {
    <strong class="hljs-con-class-slc">SharedData</strong><strong class="hljs-slc">.</strong><strong class="hljs-variable-slc">shared</strong><strong class="hljs-slc">.</strong><strong class="hljs-variable-slc">deleteJournalEntry</strong><strong class="hljs-slc">(</strong><strong class="hljs-slc">    </strong><strong class="hljs-variable-slc">journalEntries</strong><strong class="hljs-slc">[indexPath.</strong><strong class="hljs-con-attribute-slc">row</strong><strong class="hljs-slc">])</strong>

    <strong class="hljs-variable-slc">fetchJournalEntries</strong><strong class="hljs-slc">()</strong>
  }
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">The <code class="inlineCode">JournalEntry</code> instance to be removed is passed to the <code class="inlineCode">deleteJournalEntry</code> method in the <code class="inlineCode">SharedData</code> singleton, where the corresponding <code class="inlineCode">JournalEntry</code> model instance is removed from the <code class="inlineCode">ModelContext</code> instance. The <code class="inlineCode">fetchJournalEntries()</code> method then updates the <code class="inlineCode">journalEntries</code> array and reloads the table view.</p>
    <ol>
      <li class="numberedList" value="5">You have made all the changes required for the <code class="inlineCode">JournalListViewController</code> class. Build and run your app, and you should see a blank table view on<a id="_idIndexMarker995"/> the Journal List screen. Add a few journal entries using the Add New Journal Entry screen, and they will appear on the Journal List screen. Stop and run your app again. The journal entries you added will still be there:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B31371_23_05.png" alt="" width="463" height="825"/></figure>
    <p class="packt_figref">Figure 23.5: Simulator showing that new entries are still present after your app has been relaunched</p>
    <ol>
      <li class="numberedList" value="6">Swipe a row to<a id="_idIndexMarker996"/> delete a journal entry. Stop and run your app again. The journal entry you removed will still be gone.</li>
    </ol>
    <figure class="mediaobject"><img src="img/Image15494.png" alt="" width="463" height="825"/></figure>
    <p class="packt_figref">Figure 23.6: Simulator showing that deleted entries do not reappear after your app has been relaunched</p>
    <p class="normal">You have successfully <a id="_idIndexMarker997"/>implemented SwiftData in your app, and now journal entries added to your app will still be there when your app is relaunched. Congratulations!</p>
    <h1 id="_idParaDest-296" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, you modified the <em class="italic">JRNL</em> app that you completed in <em class="chapterRef">Chapter 16</em>, <em class="italic">Passing Data between View Controllers</em>, to use SwiftData to save journal entries to your device storage, so that any changes you make will still be there when you next launch the app. First, you learned about SwiftData and its different components. Next, you modified the <code class="inlineCode">JournalEntry</code> class to make it work with SwiftData and modified your <code class="inlineCode">JournalListViewController</code> class to work with the modified <code class="inlineCode">JournalEntry</code> class. After that, you added code that allowed you to fetch, add, and delete journal entries from a SwiftData model container, and finally, you modified the <code class="inlineCode">JournalViewController</code> class so it can read, save, and delete stored journal entries.</p>
    <p class="normal">You now have a basic understanding of how SwiftData works, and you will now be able to write your own apps that use SwiftData to save app data. Great job!</p>
    <p class="normal">In the next chapter, you’ll learn about the latest developments in <strong class="keyWord">SwiftUI</strong>.</p>
    <h1 id="_idParaDest-297" class="heading-1">Join us on Discord!</h1>
    <p class="normal">Read this book alongside other users, experts, and the author himself. Ask questions, provide solutions to other readers, chat with the author via Ask Me Anything sessions, and much more. Scan the QR code or visit the link to join the community.</p>
    <p class="normal"><a href="https://packt.link/ios-Swift%0D">https://packt.link/ios-Swift</a></p>
    <p class="normal"><a href="https://packt.link/ios-Swift%0D"><img src="img/QR_Code2370024260177612484.png" alt="" width="177" height="177"/></a></p>
  </div>
</div></div></body></html>