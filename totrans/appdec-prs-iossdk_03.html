<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Subclasses and Files"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Subclasses and Files</h1></div></div></div><p>Parse provides you with the quick Plug and Play approach to get started with your application development. You can save and fetch data on Parse using <code class="literal">PFObject</code>, and any data field of your object can be accessed using the <code class="literal">objectForKey</code> method.<a id="id71" class="indexterm"/> To reduce the complexity along with improving readability and scalability to the codebase, you can use subclass for your <code class="literal">PFObject</code>. This also helps you to mold the application architecture in model view controller architecture. In this chapter, we will learn how to subclass <code class="literal">PFObject</code> along with ways of saving your files on the Parse Cloud.</p><div class="section" title="Subclassing PFObject"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec20"/>Subclassing PFObject</h1></div></div></div><p>PFObject can<a id="id72" class="indexterm"/> be subclassed to provide the flexibility to the code. Basically<a id="id73" class="indexterm"/> it helps you to mold the backend code in an object-oriented format to improve the readability and application architecture. It also helps to make your code re-usable. For example, you can save your data on Parse by following the traditional way:</p><div class="informalexample"><pre class="programlisting">       // Create/Save course data  
PFObject *myCourse = [PFObject objectWithClassName:@"Course"];
[myCourse setObject:@"MBA" forKey:@"courseName"];
[myCourse setObject:@"2 years" forKey:@"courseDuration"];
[myCourse saveInBackground];</pre></div><p>After subclassing, you can transform the previous code into the following code:</p><div class="informalexample"><pre class="programlisting">Course *courseObject = [Course object];
courseObject.courseName = @"MBA";
courseObject.courseDuration = @"2 years";
[courseObject saveInBackground];</pre></div><p>By subclassing PFObject to create the <code class="literal">Course object</code>, you can easily interact with business objects. Additionally, by using the properties in the code, it increases the readability to your codebase, and, as a result, it simplifies your code architecture.</p><p>Perform the following steps to create a subclass of PFObject:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a subclass of <code class="literal">PFObject</code> to follow the PFSubclassing protocol.</li><li class="listitem">Implement the class method <code class="literal">parseClassName</code>. This method will return the name of the class as <code class="literal">string</code>, which you would pass to <code class="literal">initWithClassName:</code>.</li><li class="listitem">The <a id="id74" class="indexterm"/>implementation file (<code class="literal">.m</code> file) imports <code class="literal">PFObject + Subclass</code>. This class includes all the methods in PFSubclassing.</li><li class="listitem">In <code class="literal">ApplicationDelegate</code> before <code class="literal">userInfo setApplicationId:clientKey:</code> call the <code class="literal">[YourClass registerSubclass]</code> method.</li><li class="listitem">The following code demonstrates the <code class="literal">Course</code> subclass of <code class="literal">PFObject</code>:<div class="informalexample"><pre class="programlisting">// Course.h
@interface Course : PFObject&lt;PFSubclassing&gt;
+ (NSString *)parseClassName;
@end

// Course.m
// Import this header to let your Course class know that PFObject privately 
// provides most of the methods for PFSubclassing.
#import &lt;Parse/PFObject+Subclass.h&gt;
 
@implementation  Course
+ (NSString *)parseClassName {
  return @"Course";
}
@end

// AppDelegate.m 
#import &lt;Parse/Parse.h&gt;
#import "Course.h"
 
- (BOOL)application:(UIApplication *)application
didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
  [Course registerSubclass];
  [Parse setApplicationId:parseAppId clientKey:parseClientKey];
}</pre></div></li></ol></div></div></div>
<div class="section" title="Customizing properties and methods"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec21"/>Customizing properties and methods</h1></div></div></div><p>To<a id="id75" class="indexterm"/> encapsulate your custom business logic, you can add custom properties and methods to your <code class="literal">PFObject</code> subclass. By using the PFSubclassing approach, you can<a id="id76" class="indexterm"/> simplify and organize your code in one place instead of having it scattered in different classes. PFObject supports dynamic synthesis of the properties. You can declare properties as you would normally declare; however, this time you need to use <code class="literal">@dynamic</code> in place of <code class="literal">@synthesis</code> in your implementation file. Dynamic properties tell the compiler that the setter and getter methods are not implemented by class, but somewhere else as a superclass. Let's say you need to add a property in your <code class="literal">Course</code> class. The following code will add the properties to your <code class="literal">Course</code> class:</p><div class="informalexample"><pre class="programlisting">// Course.h
@interface Course : PFObject&lt;PFSubclassing&gt;
+ (NSString *)parseClassName;
@property (nonatomic, strong) NSString *courseName;
@property (nonatomic, strong) NSString *courseDuration;
@end
 
// Course.m
@dynamic courseName;
@dynamic courseDuration;</pre></div><p>You can access the <code class="literal">courseName</code> and <code class="literal">courseDuration</code> properties using <code class="literal">course.courseName</code> or <code class="literal">[course courseName]</code>, whereas if you want to set the data to properties you can use <code class="literal">course.courseName = @"MBA"</code> or <code class="literal">[course setCourseName:@"MBA"]</code>.</p><p>In case you have <code class="literal">NSNumber</code> as a data type, you can implement it in the following way:</p><div class="informalexample"><pre class="programlisting">@property BOOL isGameOver;
@property float amount;</pre></div><p>While fetching the data you can use <code class="literal">course [object objectForKey:@"isGameOver"]</code>, which will return <code class="literal">NSNumber</code>, which can be accessed using <code class="literal">boolValue</code>. Whereas in case of an amount, you can access it using the <code class="literal">floatValue</code> method. The dynamic getter methods will automatically convert the <code class="literal">float</code> or <code class="literal">bool</code> value, and the dynamic setter methods will wrap all the primitive data type methods under <code class="literal">NSNumber</code>.</p><div class="section" title="Initializing subclasses"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec25"/>Initializing subclasses</h2></div></div></div><p>Create <a id="id77" class="indexterm"/>new objects using the <code class="literal">object</code> class method<a id="id78" class="indexterm"/>. This will automatically create an auto-released instance of provided types, and handles further subclassing. You can use this <code class="literal">objectWithoutDataWithObjectId:</code> method for creating the reference of the current object:</p><div class="informalexample"><pre class="programlisting">PFObject *parseObject = [PFObject objectWithoutDataWithClassName:@"Course" objectId:courseObject.objectId];</pre></div><p>The <a id="id79" class="indexterm"/>previous line of code will create a reference of your existing Parse object; that is <code class="literal">Course</code> in our case.</p></div><div class="section" title="Creating queries"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec26"/>Creating queries</h2></div></div></div><p>You <a id="id80" class="indexterm"/>can create a query for the subclass objects using the <code class="literal">query</code> class method. Parse provides you with the <code class="literal">PFQuery</code> class<a id="id81" class="indexterm"/>, which allows you to fetch and save data on the Parse Cloud. PFQuery provides you with lots of methods to set and get data from the Parse Cloud. Let's say you need to create a query for your <code class="literal">Course</code> class, you need to use the following method to create a query:</p><div class="informalexample"><pre class="programlisting">PFQuery *query = [Course query];
[query whereKey:@"courseName" isEqualTo:PFUser.currentUser.courseName];
[query findObjectsInBackgroundWithBlock:^(NSArray *objects, NSError *error) {
  if (!error) {
   Course *firstCourse = [objects objectAtIndex:0];
    // Your code here
  }
}];</pre></div><p>The previous code creates a query to fetch your <code class="literal">Course</code> class data with the <code class="literal">courseName</code> filter. You will get an array of all the courses subscribed by the current user. This operation will be executed asynchronously as we are executing this on the background thread. PFQuery provides you with variations of methods to fetch and save data on the Parse Cloud.</p></div></div>
<div class="section" title="Handling files"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec22"/>Handling files</h1></div></div></div><p>In applications, <a id="id82" class="indexterm"/>sometimes we need to store our files and data in the database or backend. The file can be of any type, it can be our image file, video file, audio file or data file. Parse provides us with the Plug and Play feature to save data and files on the cloud.</p><div class="section" title="PFFile"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec27"/>PFFile</h2></div></div></div><p>The Parse<a id="id83" class="indexterm"/> application<a id="id84" class="indexterm"/> can support any type of file such as images, video files, audio files or any other kind of data file, but their size should be less than 10 megabytes. PFFile helps you to store your application-related files on the Parse Cloud.</p><p>For saving <a id="id85" class="indexterm"/>the data on the cloud, you need to convert your files into NSData. Then you can create a PFFile object from that and pass NSData to the PFFile object to save on the cloud:</p><div class="informalexample"><pre class="programlisting">NSData *data = [@"Hello world!" dataUsingEncoding:NSUTF8StringEncoding];
PFFile *exampleFile = [PFFile fileWithName:@"brochure.txt" data:data];</pre></div><p>PFFile provides the <code class="literal">fileWithName: data:</code> method to save your files on the Parse Cloud. You can save any kind of file on Parse such as images, text files, and data files. You need to convert all your files to NSData before saving them on Parse. In the previous code, we have converted our <code class="literal">Hello world!</code> string into NSData before saving it to the Parse Cloud. The filename should be in NSString format, in our case, we have used <code class="literal">brochure.txt</code> as the filename.</p><p>In the previous lines of code, we have used the name of the file as <code class="literal">demo.txt</code>. Remember the following key points:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You don't need to worry about the filename collision on the cloud, as Parse will automatically take care of these things by providing a unique identifier for all your files, so you can have multiple files of the same name.</li><li class="listitem" style="list-style-type: disc">It's recommended to provide an extension to your data files, as this will help Parse to understand your file format and handle the files appropriately. So while storing images you should use <code class="literal">.png</code> or <code class="literal">.jpg</code> as extensions.</li></ul></div><p>Now you can save your file to the cloud. All the save methods are available to PFFile as well. You can use any method that fits your requirement:</p><div class="informalexample"><pre class="programlisting">[file saveInBackground];</pre></div><p>After successfully saving your file, you can associate your file with PFObject just as you associate other data:</p><div class="informalexample"><pre class="programlisting">PFObject *parseObject = [PFObject objectWithClassName:@"Course"]
[parseObject setObject:@"MBA" forKey:@"courseName"];
[parseObject setObject:exampleFile forKey:@"brochure"];
[parseObject saveInBackground];</pre></div><p>The previous lines of code will associate your <code class="literal">brochure</code> file with the <code class="literal">Course</code> class. You can fetch the same file from Parse by using the following code:</p><div class="informalexample"><pre class="programlisting">PFFile *fetchObj = [parseObject objectForKey:@"brochure"];
NSData *resumeData = [fetchObj getData];</pre></div><p>To fetch data from the Parse Cloud you can use the <code class="literal">getData:</code> method and its variants. Parse provides you with all the variants of the <code class="literal">getData</code> method just like what we have seen for saving PFObject on the cloud.</p></div><div class="section" title="Saving images"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec28"/>Saving images</h2></div></div></div><p>To<a id="id86" class="indexterm"/> save your images on the cloud, you have to convert your images into NSData <a id="id87" class="indexterm"/>and then you can save that data to the cloud. Let's say you have an image and you have to save it to the cloud, then you should perform the following steps:</p><div class="informalexample"><pre class="programlisting">UIImage *imageObj = [UIImage imageNamed:@"picture.png"];
NSData *imageData = UIImagePNGRepresentation(imageObj);
PFFile *imageFile = [PFFile fileWithName:@"picture.png" data:imageData];
[imageFile save];
 
PFObject *userPhoto = [PFObject objectWithClassName:@"UserPhoto"];
[userPhoto setObject:@"Test Image" forKey:@"imageName"];
[userPhoto setObject:imageFile forKey:@"imageFile"];
[userPhoto save];</pre></div><p>In the previous lines of code, we started by converting an image file into NSData. Then we created a PFFile object with that data as the value for the image key named as <code class="literal">picture.png</code>. Then we called the <code class="literal">save</code> function on the PFFile object to save the file. So now this PFFile object can be used as a value for any other Parse object. Next we created an object on the <code class="literal">UserPhoto</code> class and saved the PFFile object as a value for our <code class="literal">imageFile</code> key. Then finally we have invoked the <code class="literal">save</code> method on the <code class="literal">UserPhoto</code> parse object.</p></div></div>
<div class="section" title="Tracking progress"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Tracking progress</h1></div></div></div><p>Parse <a id="id88" class="indexterm"/>helps you to track the progress of your uploads and downloads from your PFFile using the following provided methods:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Using the following method you can track the progress of the data you are saving on the cloud:<div class="informalexample"><pre class="programlisting">saveInBackgroundWithBlock:progressBlock</pre></div></li><li class="listitem">Using the following method you can track the progress while fetching data from the cloud:<div class="informalexample"><pre class="programlisting">getDataInBackgroundWithBlock:progressBlock</pre></div></li></ol></div><p>Let's take an example to illustrate how to use your application in progress tracking:</p><div class="informalexample"><pre class="programlisting">NSData *data = [@"Progress tracking of files is Easy!" dataUsingEncoding:NSUTF8StringEncoding];
PFFile *file = [PFFile fileWithName:@"brochure.txt" data:data];
[file saveInBackgroundWithBlock:^(BOOL succeeded, NSError *error) {
  // Handle success or failure here ...
} progressBlock:^(int percentDone) {
  // Update your progress spinner here. percentDone will be between 0 and 100.
}];</pre></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Summary</h1></div></div></div><p>In this chapter, we've explored the various ways to save our data to Parse. Data can be anything, such as an image file, audio file, video files or simple binary data files.</p><p>We started by exploring the steps to subclass our PFObject. Then we learned about the <code class="literal">PFFile</code> class, which allows us to save our data to the cloud. We also learned about saving our data to the cloud and saving images to the cloud.</p><p>Finally, we saw various ways to track the progress of our file.</p><p>In the next chapter, we will learn about Parse analytics and the various ways to track your application.</p></div></body></html>