<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Telephony, Networks, and the Web</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>How to make a phone call</li>
<li>Monitoring phone call events</li>
<li>How to send SMS (text) messages</li>
<li>Receiving SMS messages</li>
<li>Displaying a web page in your application</li>
<li>Checking online status and connection type</li>
<li>Phone number blocking API</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p><span>We'll start this chapter by looking at telephony functionality with <em><span class="ItalicsPACKT">How to make a phone call</span></em>. After exploring how to make a call, we'll look at how to monitor a phone call with m<span class="ItalicsPACKT">onitoring phone call events</span>. We'll move on to SMS messaging in the <span class="ItalicsPACKT">How to send SMS messages section</span>, and then we'll cover receiving SMS messages in the <span class="ItalicsPACKT">Receiving SMS messages section.</span></span></p>
<p>We'll then explore <kbd>WebView</kbd> for adding browser functionality to your app. At its basic level, <kbd>WebView</kbd> is a basic HTML viewer. We'll show how you can extend a <kbd><span class="CodeInTextPACKT">WebViewClient</span></kbd> class and modify the settings through <kbd><span class="CodeInTextPACKT">WebSettings</span></kbd> to create full browser functionality, including JavaScript and Zoom features.</p>
<p>The last recipe of this chapter will explore a new API (added in Android 7.0 Nougat) for blocking phone numbers at the OS level.  </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to make a phone call</h1>
                </header>
            
            <article>
                
<p>As we've seen in previous recipes, we can call the default applications simply by using an Intent. There are two Intents for phone calls:</p>
<ul>
<li><kbd>ACTION_DIAL</kbd>: Uses the default phone application to make the phone call (no permission required)</li>
<li><kbd>CALL_PHONE</kbd>: Bypasses the UI to directly dial the number (requires permission)</li>
</ul>
<p>Here's the code to set and call the Intent for using the default Phone app:</p>
<pre>Intent intent = new Intent(Intent.ACTION_DIAL); 
intent.setData(Uri.parse("tel:" + number)); 
startActivity(intent); </pre>
<p>Since your application is not doing the dialing and the user must press the <span class="ScreenTextPACKT">Dial</span> button, your app does not need any dialing permissions. The recipe that follows will show you how to place a call directly, bypassing the Dialer app.  </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Create a new project in Android Studio and call it <kbd><span class="CodeInTextPACKT">DialPhone</span></kbd>. Use the default <span class="ScreenTextPACKT"><span class="packt_screen">Phone &amp; Tablet</span></span> option and select <span class="ScreenTextPACKT"><span class="packt_screen">Empty Activity</span></span> when prompted for <span class="ScreenTextPACKT"><span class="packt_screen">Activity Type</span></span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>First, we need to add the appropriate permission to make the call. Then, we need to add a button to call our <span class="CodeInTextPACKT">Dial</span> method. Start by opening the Android Manifest and follow these steps:</p>
<ol>
<li>Add the following permission:</li>
</ol>
<pre style="padding-left: 60px"><span>&lt;uses-permission </span><span>android</span><span>:name=</span><span>"android.permission.CALL_PHONE"</span><span>/&gt;</span></pre>
<ol start="2">
<li>Open <kbd><span class="CodeInTextPACKT">acti</span><span class="CodeInTextPACKT">vity_main.xml</span></kbd> and replace the existing <kbd><span class="CodeInTextPACKT">TextView</span></kbd> <span>with the following button:</span></li>
</ol>
<pre style="padding-left: 60px"><span>&lt;Button<br/></span><span>    </span><span>android</span><span>:id=</span><span>"@+id/button"<br/></span><span>    </span><span>android</span><span>:layout_width=</span><span>"wrap_content"<br/></span><span>    </span><span>android</span><span>:layout_height=</span><span>"wrap_content"<br/></span><span>    </span><span>android</span><span>:text=</span><span>"Dial"<br/></span><span>    </span><span>android</span><span>:onClick=</span><span>"dialPhone"<br/></span><span>    </span><span>app</span><span>:layout_constraintBottom_toBottomOf=</span><span>"parent"<br/></span><span>    </span><span>app</span><span>:layout_constraintLeft_toLeftOf=</span><span>"parent"<br/></span><span>    </span><span>app</span><span>:layout_constraintRight_toRightOf=</span><span>"parent"<br/></span><span>    </span><span>app</span><span>:layout_constraintTop_toTopOf=</span><span>"parent" </span><span>/&gt;</span></pre>
<ol start="3">
<li>Add this meth<span>od, which will check whether your app has been granted the </span><kbd><span class="CodeInTextPACKT">CALL_PHONE</span></kbd> permission:</li>
</ol>
<pre style="padding-left: 60px"><span>private boolean </span><span>checkPermission</span>(String permission) {<br/>    <span>int </span>permissionCheck = ContextCompat.<span>checkSelfPermission</span>(<span>this, </span>permission)<span>;<br/></span><span>    return </span>(permissionCheck == PackageManager.<span>PERMISSION_GRANTED</span>)<span>;<br/></span>}</pre>
<ol start="4">
<li>Add the code to dial the number:</li>
</ol>
<pre style="padding-left: 60px"><span>public void </span><span>dialPhone</span>(View view){<br/>    <span>if </span>(checkPermission(Manifest.permission.<span>CALL_PHONE</span>)) {<br/>        Intent intent = <span>new </span>Intent(Intent.<span>ACTION_CALL</span>)<span>;<br/></span><span>        </span>intent.setData(Uri.<span>parse</span>(<span>"tel:0123456789"</span>))<span>;<br/></span><span>        </span>startActivity(intent)<span>;<br/></span><span>    </span>} <span>else </span>{<br/>        ActivityCompat.<span>requestPermissions</span>(<span>this, new </span>String[] {Manifest.permission.<span>CALL_PHONE</span>}<span>,</span><span>1</span>)<span>;<br/></span><span>    </span>}<br/>}</pre>
<ol start="5">
<li>Before running this on your device, be sure to replace <span class="CodeInTextPACKT">0123456789</span> <span>with a valid number.</span></li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>As we discussed in the introduction, using the <kbd>CALL_PHONE</kbd> Intent requires the appropriate permission. We add the required permission to the manifest in step 1 and use the method in step 3 to verify the permission before actually calling the Intent in step 4. <span>Starting with Android 6.0 Marshmallow (API 23), permissions are no longer granted during installation. Therefore, we check whether the application has permission before attempting to dial.  </span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li><span>Refer to <em>The Android 6.0 <span class="ItalicsPACKT">Runtime Permission Model</span></em> recipe in <span class="ChapterrefPACKT"><a href="98c7bc7b-43e2-43de-aed4-fe2fb6dc72f3.xhtml" target="_blank">Chapter 15</a>, <em>Getting Your App Ready for the Play Store</em>, for more information on the new runtime permissions </span></span></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Monitoring phone call events</h1>
                </header>
            
            <article>
                
<p>In the previous recipe, we demonstrated how to make a phone call, both with an Intent to call the default application, as well as by directly dialing the number with no UI.</p>
<p>What if you want to be notified when the calls ends? This is where it gets a bit more complicated, as you'll need to monitor the Telephony events and track the phone state. In this recipe, we'll demonstrate how to create a <kbd><span class="CodeInTextPACKT">PhoneStateListener</span></kbd> to read phone state events.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Create a new project in Android Studio and call it <kbd><span class="CodeInTextPACKT">PhoneStateListener</span></kbd>. <span class="s1">Use the default </span><span class="packt_screen"><span class="s2">Phone &amp; Tablet</span><span class="s1"> options</span></span> <span class="s1">and select </span><span class="s2"><span class="packt_screen">Empty Activity</span></span><span class="s1"> in the </span><span class="s2"><span class="packt_screen">Add an Activity</span> to <span class="packt_screen">Mobile</span></span><span class="s1"> dialog.</span></p>
<p><span>Although it's not required, you can use the previous recipe to initiate a phone call. Otherwise, use the default dialer and/or watch the events from an incoming call. </span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We only need a single <kbd><span class="CodeInTextPACKT">TextView</span></kbd> on the layout to display the event information. Open the <kbd><span class="CodeInTextPACKT">activity_main.xml</span></kbd> file and follow these steps:</p>
<ol>
<li>Add or modify the <kbd><span class="CodeInTextPACKT">TextView</span></kbd> as follows:</li>
</ol>
<pre style="padding-left: 60px"><span>&lt;TextView<br/></span><span>    </span><span>android</span><span>:id=</span><span>"@+id/textView"<br/></span><span>    </span><span>android</span><span>:layout_width=</span><span>"wrap_content"<br/></span><span>    </span><span>android</span><span>:layout_height=</span><span>"wrap_content"<br/></span><span>    </span><span>app</span><span>:layout_constraintLeft_toLeftOf=</span><span>"parent"<br/></span><span>    </span><span>app</span><span>:layout_constraintTop_toTopOf=</span><span>"parent" </span><span>/&gt;</span></pre>
<ol start="2">
<li>Add the following permission to the Android Manifest:</li>
</ol>
<pre style="padding-left: 60px"><span>&lt;uses-permission </span><span>android</span><span>:name=</span><span>"android.permission.READ_PHONE_STATE"</span><span>/&gt;</span></pre>
<ol start="3">
<li>Open <kbd><span class="CodeInTextPACKT">MainActivity.jav</span><span class="CodeInTextPACKT">a</span></kbd> and add the following <kbd><span class="CodeInTextPACKT">PhoneStateListener</span></kbd> class to the <kbd><span class="CodeInTextPACKT">MainActivity</span></kbd> class:</li>
</ol>
<pre style="padding-left: 60px">PhoneStateListener <span>mPhoneStateListener </span>= <span>new </span>PhoneStateListener() {<br/>    <span>@Override<br/></span><span>    </span><span>public void </span><span>onCallStateChanged</span>(<span>int </span>state<span>, </span>String number) {<br/>        String phoneState = number<span>;<br/></span><span>        switch </span>(state) {<br/>            <span>case </span>TelephonyManager.<span>CALL_STATE_IDLE</span>:<br/>                phoneState += <span>"CALL_STATE_IDLE</span><span>\n</span><span>"</span><span>;<br/></span><span>                break;<br/></span><span>            case </span>TelephonyManager.<span>CALL_STATE_RINGING</span>:<br/>                phoneState += <span>"CALL_STATE_RINGING</span><span>\n</span><span>"</span><span>;<br/></span><span>                break;<br/></span><span>            case </span>TelephonyManager.<span>CALL_STATE_OFFHOOK</span>:<br/>                phoneState += <span>"CALL_STATE_OFFHOOK</span><span>\n</span><span>"</span><span>;<br/></span><span>                break;<br/></span><span>        </span>}<br/>        TextView textView = findViewById(R.id.<span>textView</span>)<span>;<br/></span><span>        </span>textView.append(phoneState)<span>;<br/></span><span>    </span>}<br/>}<span>;</span></pre>
<ol start="4">
<li>Modify <kbd><span class="CodeInTextPACKT">onC</span><span class="CodeInTextPACKT">reate()</span></kbd> to set up the listener:</li>
</ol>
<pre style="padding-left: 60px"><span>final </span>TelephonyManager telephonyManager = <br/>        (TelephonyManager) getSystemService(Context.<span>TELEPHONY_SERVICE</span>)<span>;<br/></span>telephonyManager.listen(<span>mPhoneStateListener</span><span>, </span>PhoneStateListener.<span>LISTEN_CALL_STATE</span>)<span>;</span></pre>
<ol start="5">
<li>Run the application <span>on a device and initiate and/or receive phone calls. Upon returning to this app, you'll see the list of events.</span></li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>To demonstrate using the listener, we create the Telephony listener in the <kbd><span class="CodeInTextPACKT">onCreate()</span></kbd> <span>method with this code:</span></p>
<pre><span>final </span>TelephonyManager telephonyManager =<br/>        (TelephonyManager) getSystemService(Context.<span>TELEPHONY_SERVICE</span>)<span>;<br/></span>telephonyManager.listen(<span>mPhoneStateListener</span><span>, </span>PhoneStateListener.<span>LISTEN_CALL_STATE</span>)<span>;</span></pre>
<p>When a <kbd><span class="CodeInTextPACKT">PhoneState</span></kbd> event occurs, it is sent to our <kbd><span class="CodeInTextPACKT">PhoneStateListener</span></kbd> class.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>In this recipe, we are monitoring the Call State events, as indicated with this constant: <kbd><span class="CodeInTextPACKT">LISTEN_CALL_STATE</span></kbd>. The other interesting options include the following:</p>
<ul>
<li><kbd>LISTEN_CALL_FORWARDING_INDICATOR</kbd></li>
<li><kbd>LISTEN_DATA_CONNECTION_STATE</kbd></li>
<li><kbd>LISTEN_SIGNAL_STRENGTHS</kbd></li>
</ul>
<p>Take a look at the <kbd><span class="CodeInTextPACKT">PhoneStateListener</span></kbd> link in <em>See also</em> for a complete list.</p>
<p>When we're done listening for events, call the <kbd><span class="CodeInTextPACKT">listen()</span></kbd> method and pass <kbd><span class="CodeInTextPACKT">LISTEN_NONE</span></kbd><span>, as shown here:</span></p>
<pre>telephonyManager.listen(mPhoneStateListener,PhoneStateListener.LISTEN_NONE); </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li><span class="ScreenTextPACKT">Developer Docs: <kbd>PhoneStateListener</kbd></span> at <a href="https://developer.android.com/reference/android/telephony/PhoneStateListener.html"><span class="URLPACKT">https://developer.android.com/reference/android/telephony/PhoneStateListener.html</span></a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to send SMS (text) messages</h1>
                </header>
            
            <article>
                
<p>Since <span>you're probably already familiar with SMS (or text) messages, we won't spend time explaining what they are or why they are important. (If you're not familiar with SMS or want more information, see the link provided in the <span class="ItalicsPACKT">See also</span> section of this recipe.) This recipe will demonstrate how to send an SMS message. (The next recipe will demonstrate how to receive notifications of new messages and how to read existing messages.)</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Create a new project in Android Studio and call it <kbd><span class="CodeInTextPACKT">SendSMS</span></kbd>. <span class="s1">Use the default </span><span class="s2"><span class="packt_screen">Phone &amp; Tablet</span></span><span class="s1"> options and select <span class="packt_screen">Empty Activity</span> in the <span class="packt_screen">Add an Activity</span></span> <span class="s2">to <span class="packt_screen">Mobile</span></span><span class="s1"> dialog.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>First, we need to add the necessary permissions for sending an SMS. Then, we'll create a layout with p<span class="ScreenTextPACKT">hone number</span> and m<span class="ScreenTextPACKT">essage</span> fields and a S<span class="ScreenTextPACKT">end</span> button. When the Send button is clicked, we'll create and send the SMS. Here are the steps:</p>
<ol>
<li>Open the Android Manifest and add the following permission:</li>
</ol>
<pre style="padding-left: 60px"><span>&lt;uses-permission </span><span>android</span><span>:name=</span><span>"android.permission.SEND_SMS"</span><span>/&gt;</span></pre>
<ol start="2">
<li>Open <kbd><span class="CodeInTextPACKT">activity_</span><span class="CodeInTextPACKT">main.xml</span></kbd> and replace the existing <span class="CodeInTextPACKT">layout</span> <span>with the following XML:</span></li>
</ol>
<pre style="padding-left: 60px"><span>&lt;?</span><span>xml version=</span><span>"1.0" </span><span>encoding=</span><span>"utf-8"</span><span>?&gt;<br/></span><span>&lt;RelativeLayout <br/></span><span>    </span><span>xmlns:</span><span>android</span><span>=</span><span>"http://schemas.android.com/apk/res/android"<br/></span><span>    </span><span>android</span><span>:layout_width=</span><span>"match_parent"<br/></span><span>    </span><span>android</span><span>:layout_height=</span><span>"match_parent" </span><span>&gt;<br/></span><span>    &lt;EditText<br/></span><span>        </span><span>android</span><span>:id=</span><span>"@+id/editTextNumber"<br/></span><span>        </span><span>android</span><span>:layout_width=</span><span>"match_parent"<br/></span><span>        </span><span>android</span><span>:layout_height=</span><span>"wrap_content"<br/></span><span>        </span><span>android</span><span>:inputType=</span><span>"number"<br/></span><span>        </span><span>android</span><span>:ems=</span><span>"10"<br/></span><span>        </span><span>android</span><span>:layout_alignParentTop=</span><span>"true"<br/></span><span>        </span><span>android</span><span>:layout_centerHorizontal=</span><span>"true"<br/></span><span>        </span><span>android</span><span>:hint=</span><span>"Number"</span><span>/&gt;<br/></span><span>    &lt;EditText<br/></span><span>        </span><span>android</span><span>:id=</span><span>"@+id/editTextMsg"<br/></span><span>        </span><span>android</span><span>:layout_width=</span><span>"match_parent"<br/></span><span>        </span><span>android</span><span>:layout_height=</span><span>"wrap_content"<br/></span><span>        </span><span>android</span><span>:layout_below=</span><span>"@+id/editTextNumber"<br/></span><span>        </span><span>android</span><span>:layout_centerHorizontal=</span><span>"true"<br/></span><span>        </span><span>android</span><span>:hint=</span><span>"Message"</span><span>/&gt;<br/></span><span>    &lt;Button<br/></span><span>        </span><span>android</span><span>:id=</span><span>"@+id/buttonSend"<br/></span><span>        </span><span>android</span><span>:layout_width=</span><span>"wrap_content"<br/></span><span>        </span><span>android</span><span>:layout_height=</span><span>"wrap_content"<br/></span><span>        </span><span>android</span><span>:text=</span><span>"Send"<br/></span><span>        </span><span>android</span><span>:layout_below=</span><span>"@+id/editTextMsg"<br/></span><span>        </span><span>android</span><span>:layout_centerHorizontal=</span><span>"true"<br/></span><span>        </span><span>android</span><span>:onClick=</span><span>"send"</span><span>/&gt;<br/></span><span>&lt;/RelativeLayout&gt;</span></pre>
<ol start="3">
<li>Open <kbd><span class="CodeInTextPACKT">MainAc</span><span class="CodeInTextPACKT">tivity.java</span></kbd> and add the following global variables:</li>
</ol>
<pre style="padding-left: 60px">final int SEND_SMS_PERMISSION_REQUEST_CODE=1; 
Button mButtonSend; </pre>
<ol start="4">
<li>Add the following code to the existing <kbd><span class="CodeInTextPACKT">onCreate()</span></kbd> callback:</li>
</ol>
<pre style="padding-left: 60px"><span>mButtonSend </span>= findViewById(R.id.<span>buttonSend</span>)<span>;<br/></span><span>mButtonSend</span>.setEnabled(<span>false</span>)<span>;<br/></span><span><br/></span><span>if </span>(checkPermission(Manifest.permission.<span>SEND_SMS</span>)) {<br/>    <span>mButtonSend</span>.setEnabled(<span>true</span>)<span>;<br/></span>} <span>else </span>{<br/>    ActivityCompat.<span>requestPermissions</span>(<span>this, new </span>String[]{Manifest.permission.<span>SEND_SMS</span>}<span>, <br/></span><span>            </span><span>SEND_SMS_PERMISSION_REQUEST_CODE</span>)<span>;<br/></span>}</pre>
<ol start="5">
<li>Add the following method to check the permissions:</li>
</ol>
<pre style="padding-left: 60px"><span>private boolean </span><span>checkPermission</span>(String permission) {<br/>    <span>int </span>permissionCheck = ContextCompat.<span>checkSelfPermission</span>(<span>this,</span>permission)<span>;<br/></span><span>    return </span>(permissionCheck == PackageManager.<span>PERMISSION_GRANTED</span>)<span>;<br/></span>}</pre>
<ol start="6">
<li>Override <kbd><span class="CodeInTextPACKT">onRe</span><span class="CodeInTextPACKT">questPermissionsResult()</span></kbd> <span>to handle the permission<br/>
request response:</span></li>
</ol>
<pre style="padding-left: 60px"><span>@Override<br/></span><span>public void </span><span>onRequestPermissionsResult</span>(<span>int </span>requestCode<span>, </span>String permissions[]<span>, int</span>[] grantResults) {<br/>    <span>switch </span>(requestCode) {<br/>        <span>case </span><span>SEND_SMS_PERMISSION_REQUEST_CODE</span>: {<br/>            <span>if </span>(grantResults.<span>length </span>&gt; <span>0<br/></span><span>                    </span>&amp;&amp; grantResults[<span>0</span>] ==<br/>                    PackageManager.<span>PERMISSION_GRANTED</span>) {<br/>                <span>mButtonSend</span>.setEnabled(<span>true</span>)<span>;<br/></span><span>            </span>}<br/>            <span>return;<br/></span><span>        </span>}<br/>    }<br/>}</pre>
<ol start="7">
<li>And finally, add the method to actually send the SMS:</li>
</ol>
<pre style="padding-left: 60px"><span>public void </span><span>send</span>(View view) {<br/>    String phoneNumber = ((EditText)findViewById(R.id.<span>editTextNumber</span>)).getText().toString()<span>;<br/></span><span>    </span>String msg = ((EditText)findViewById(R.id.<span>editTextMsg</span>)).getText().toString()<span>;<br/></span><span><br/></span><span>    if </span>(phoneNumber==<span>null </span>|| phoneNumber.length()==<span>0 </span>|| msg==<span>null </span>|| msg.length()==<span>0 </span>) {<br/>        <span>return;<br/></span><span>    </span>}<br/><br/>    <span>if </span>(checkPermission(Manifest.permission.<span>SEND_SMS</span>)) {<br/>        SmsManager smsManager = SmsManager.<span>getDefault</span>()<span>;<br/></span><span>        </span>smsManager.sendTextMessage(phoneNumber<span>, null, </span>msg<span>, null, null</span>)<span>;<br/></span><span>    </span>} <span>else </span>{<br/>        Toast.<span>makeText</span>(MainActivity.<span>this, </span><span>"No Permission"</span><span>, </span>Toast.<span>LENGTH_SHORT</span>).show()<span>;<br/></span><span>    </span>}<br/>}</pre>
<ol start="8">
<li>You're ready to run the application on a device or emulator. (Use the emulator device number when sending to another emulator. The first emulator is 5554; the second is 5556, and it continues incrementing by two for each additional emulator.)</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The code for sending an SMS is only two lines, as shown here:</p>
<pre>SmsManager smsManager = SmsManager.getDefault(); 
smsManager.sendTextMessage(phoneNumber, null, msg, null, null); </pre>
<p>The <kbd><span class="CodeInTextPACKT">sendTextMessage()</span></kbd> <span>method does the actual sending. Most of the code for this recipe is for checking and obtaining the required permissions.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>As simple as it is to send SMS messages, we still have a few more options.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Multipart messages</h1>
                </header>
            
            <article>
                
<p>Although it can vary depending on the carrier, 160 is typically the maximum characters allowed per text message. You could modify the preceding code to check whether the message exceeds 160 characters, and if so, you can call the SMSManager <span class="CodeInTextPACKT">divideMessage()</span> method. The method returns <kbd><span class="CodeInTextPACKT">ArrayList</span></kbd>, which you can send to <kbd><span class="CodeInTextPACKT">sendMultipartTextMessage()</span></kbd>. Here's an example:</p>
<pre>ArrayList&lt;String&gt; messages=smsManager.divideMessage(msg)<span>;<br/></span>smsManager.sendMultipartTextMessage(phoneNumber<span>, null, </span>messages<span>, null, null</span>)<span>;</span></pre>
<div class="packt_tip">Note that messages sent with <kbd><span class="CodeInTextPACKT">sendMultipartTextMessage()</span></kbd> may not work correctly when using an emulator, so be sure to test on a real device.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Delivery status notification</h1>
                </header>
            
            <article>
                
<p>If you'd like to be notified of the status of the messages, there are two optional fields you can use. Here's the <kbd><span class="CodeInTextPACKT">sendTextMessage()</span></kbd> method as defined in the <span class="ScreenTextPACKT">SMSManager</span> documentation:</p>
<pre>sendTextMessage(String destinationAddress<span>, </span>String scAddress<span>, </span>String text<span>, <br/></span><span>        </span>PendingIntent sentIntent<span>, </span>PendingIntent deliveryIntent)</pre>
<p>You can include a pending Intent to be notified of the send status and/or delivery status. Upon receipt of your pending Intent, it will include a result code with either <span class="CodeInTextPACKT">Activity. <kbd>RESULT_OK</kbd></span>, if it sent successfully, or an error code as defined in the <span class="ScreenTextPACKT">SMSManager</span> <span>documentation (see the following links):</span></p>
<ul>
<li><kbd><span class="CodeInTextPACKT">RESULT_ERROR_GENERIC_FAILURE</span></kbd>: Generic failure cause</li>
<li><kbd><span class="CodeInTextPACKT">RESULT_ERROR_NO_SERVICE</span></kbd>: Failed because service is currently unavailable</li>
<li><kbd><span class="CodeInTextPACKT">RESULT_ERROR_NULL_PDU</span></kbd>: Failed because no PDU was provided</li>
<li><kbd><span class="CodeInTextPACKT">RESULT_ERROR_RADIO_OFF</span></kbd>: Failed because radio was explicitly turned off</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li>Short Message Service on Wikipedia at <a href="https://en.wikipedia.org/wiki/Short_Message_Service"><span class="URLPACKT">https://en.wikipedia.org/wiki/Short_Message_Service</span></a></li>
<li><span class="ScreenTextPACKT">Developer Docs: SMSManager</span> at <a href="https://developer.android.com/reference/android/telephony/SmsManager.html"><span class="URLPACKT">https://developer.android.com/reference/android/telephony/SmsManager.html</span></a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Receiving SMS messages</h1>
                </header>
            
            <article>
                
<p>This recipe will demonstrate how to set up a broadcast receiver to notify you of new SMS messages. It's useful to note that your app does not need to be running to receive the SMS Intent. Android will start your service to process the SMS.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Create a new project in Android Studio and call it <kbd><span class="CodeInTextPACKT">ReceiveSMS</span></kbd>. <span class="s1">Use the default </span><span class="s2"><span class="packt_screen">Phone &amp; Tablet</span></span><span class="s1"> options and select <span class="packt_screen">Empty Activity</span> in the <span class="packt_screen">Add an Activity</span></span> <span class="s2">to <span class="packt_screen">Mobile</span></span><span class="s1"> dialog.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p><span>We won't be using a layout in this demonstration as all the work will be in the Broadcast Receiver. We'll use Toasts to display incoming SMS messages. Open the Android Manifest and follow these steps:</span></p>
<ol>
<li>Add the following permission:</li>
</ol>
<pre style="padding-left: 60px"><span>&lt;uses-permission </span><span>android</span><span>:name=</span><span>"android.permission.RECEIVE_SMS" </span><span>/&gt;</span></pre>
<ol start="2">
<li>Add the following declaration for the broadcast receiver to the <span class="CodeInTextPACKT">application</span> element:</li>
</ol>
<pre style="padding-left: 60px"><span>&lt;receiver </span><span>android</span><span>:name=</span><span>".SMSBroadcastReceiver"</span><span>&gt;<br/></span><span>    &lt;intent-filter&gt;<br/></span><span>        &lt;action </span><span>android</span><span>:name=</span><span>"android.provider.Telephony.SMS_RECEIVED"</span><span>/&gt;<br/></span><span>    &lt;/intent-filter&gt;<br/></span><span>&lt;/receiver&gt;</span></pre>
<ol start="3">
<li>Open <kbd><span class="CodeInTextPACKT">Main</span><span class="CodeInTextPACKT">Activity.java</span></kbd> and add the following method:</li>
</ol>
<pre style="padding-left: 60px"><span>private boolean </span><span>checkPermission</span>(String permission) {<br/>    <span>int </span>permissionCheck = ContextCompat.<span>checkSelfPermission</span>(<span>this, </span>permission)<span>;<br/></span><span>    return </span>(permissionCheck == PackageManager.<span>PERMISSION_GRANTED</span>)<span>;<br/></span>}</pre>
<ol start="4">
<li>Modify the existing <kbd><span class="CodeInTextPACKT">o</span><span class="CodeInTextPACKT">nCreate()</span></kbd> callback to check the permission:</li>
</ol>
<pre style="padding-left: 60px"><span>if </span>(!checkPermission(Manifest.permission.<span>RECEIVE_SMS</span>)) {<br/>    ActivityCompat.<span>requestPermissions</span>(<span>this, new </span>String[]{Manifest.permission.<span>RECEIVE_SMS</span>}<span>, </span><span>0</span>)<span>;<br/></span>}</pre>
<ol start="5">
<li>Add a new Java class to the project, called <span class="CodeInTextPACKT"><kbd>SMSBroadcastReceiver</kbd>,</span> using the following code:</li>
</ol>
<pre style="padding-left: 60px"><span>public class </span>SMSBroadcastReceiver <span>extends </span>BroadcastReceiver {<br/>    <span>final </span>String <span>SMS_RECEIVED </span>= <span>"android.provider.Telephony.SMS_RECEIVED"</span><span>;<br/></span><span><br/></span><span>    </span><span>@Override<br/></span><span>    </span><span>public void </span><span>onReceive</span>(Context context<span>, </span>Intent intent) {<br/>        <span>if </span>(<span>SMS_RECEIVED</span>.equals(intent.getAction())) {<br/>            Bundle bundle = intent.getExtras()<span>;<br/></span><span>            if </span>(bundle != <span>null</span>) {<br/>                Object[] pdus = (Object[]) bundle.get(<span>"pdus"</span>)<span>;<br/></span><span>                </span>String format = bundle.getString(<span>"format"</span>)<span>;<br/></span><span>                final </span>SmsMessage[] messages = <span>new </span>SmsMessage[pdus.<span>length</span>]<span>;<br/></span><span>                for </span>(<span>int </span>i = <span>0</span><span>; </span>i &lt; pdus.<span>length</span><span>; </span>i++) {<br/>                    <span>if </span>(Build.VERSION.<span>SDK_INT </span>&gt;= Build.VERSION_CODES.<span>M</span>) {<br/>                        messages[i] = SmsMessage.<span>createFromPdu</span>((<span>byte</span>[]) pdus[i]<span>, </span>format)<span>;<br/></span><span>                    </span>} <span>else </span>{<br/>                        messages[i] = SmsMessage.<span>createFromPdu</span>((<span>byte</span>[]) pdus[i])<span>;<br/></span><span>                    </span>}<br/>                    Toast.<span>makeText</span>(context<span>, </span>messages[<span>0</span>].getMessageBody()<span>, </span>Toast.<span>LENGTH_SHORT</span>)<br/>                            .show()<span>;<br/></span><span>                </span>}<br/>            }<br/>        }<br/>    }<br/>}</pre>
<p style="padding-left: 60px">6. You're ready to run the application on a device or emulator.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p><span>Just like in the previous recipe on sending SMS messages, we first need to check whether the app has permission. (On pre-Android 6.0 devices, the manifest declaration will automatically provide the permission, but for Marshmallow and later, we'll need to prompt the user as we do here.)</span></p>
<p><span>As you can see, the Broadcast receiver receives the notification of new SMS messages. We tell the system we want to receive the new SMS Received Broadcasts using this code in the Android Manifest:</span></p>
<pre><span>&lt;receiver </span><span>android</span><span>:name=</span><span>".SMSBroadcastReceiver"</span><span>&gt;<br/></span><span>    &lt;intent-filter&gt;<br/></span><span>        &lt;action </span><span>android</span><span>:name=</span><span>"android.provider.Telephony.SMS_RECEIVED"</span><span>/&gt;<br/></span><span>    &lt;/intent-filter&gt;<br/></span><span>&lt;/receiver&gt;</span></pre>
<p>The notification comes in through the standard <kbd><span class="CodeInTextPACKT">onRecieve()</span></kbd> callback so we check the action using this code:</p>
<pre>if (SMS_RECEIVED.equals(intent.getAction())) {} </pre>
<p>This is probably the most complicated line of code in this recipe:</p>
<pre>messages[i] = SmsMessage.createFromPdu((byte[]) pdus[i]); </pre>
<p>Basically, it calls the <span class="CodeInTextPACKT">SmsMessage</span> library to create an SMSMessage object from the PDU. (The PDU, short for Protocol Data Unit, is the binary data format for SMS messages.) If you're not familiar with the PDU formation, you don't need to be. The <span class="CodeInTextPACKT">SmsMessage</span> library will take care of it for you and return an SMSMessage object.</p>
<div class="packt_tip">If your app is not receiving SMS broadcast messages, an existing application may be blocking your app. You can try increasing the priority value in <span class="CodeInTextPACKT">intent-filter</span> as shown here, or disabling/uninstalling the other app(s):<br/>
<pre>&lt;intent-filter   android:priority="100"&gt;   
<span>    &lt;action android:name=<br/>           "android.provider.Telephony.SMS_RECEIVED" /&gt;</span>   
&lt;/intent-filter&gt;   </pre></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>This recipe demonstrates displaying SMS messages as they are received, but what about reading existing messages?</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Reading existing SMS messages</h1>
                </header>
            
            <article>
                
<p>First, to read existing messages, you'll need the following permission:</p>
<pre>&lt;uses-permission android:name="android.permission.READ_SMS" /&gt; </pre>
<p>Here's an example of getting a cursor using the SMS content provider:</p>
<pre>Cursor cursor = getContentResolver().query(<br/>        Uri.<span>parse</span>(<span>"content://sms/"</span>)<span>, null, null, null, null</span>)<span>;<br/></span><span>while </span>(cursor.moveToNext()) {<br/>    textView.append(<span>"From :" </span>+ cursor.getString(<span>1</span>) + <span>" : " </span>+ cursor.getString(<span>11</span>)+<span>"</span><span>\n</span><span>"</span>)<span>;<br/></span>}</pre>
<p>At the time of writing, the SMS content provider has over 30 columns. Here are the first 12, which are the most useful (remember, the column count starts at zero):</p>
<ol start="0">
<li><kbd><span class="CodeInTextPACKT">_id</span></kbd></li>
<li><kbd>thread_id</kbd></li>
<li><kbd>address</kbd></li>
<li><kbd>person</kbd></li>
<li><kbd>date</kbd></li>
<li><kbd>protocol</kbd></li>
<li><kbd>read</kbd></li>
<li><kbd>status</kbd></li>
<li><kbd>type</kbd></li>
<li><kbd>reply_path_present</kbd></li>
<li><kbd>subject</kbd></li>
<li><kbd>body</kbd></li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li><span class="ScreenTextPACKT">Developer Docs: <kbd>SmsManager</kbd></span> at <a href="https://developer.android.com/reference/android/telephony/SmsManager.html"><span class="URLPACKT">https://developer.android.com/reference/android/telephony/SmsManager.html</span></a></li>
<li><span class="ScreenTextPACKT"><strong>Protocol Data Unit</strong> (<strong>PDU</strong>)</span> at <a href="https://en.wikipedia.org/wiki/Protocol_data_unit"><span class="URLPACKT">https://en.wikipedia.org/wiki/Protocol_data_unit</span></a></li>
<li><span class="ScreenTextPACKT">Developer Docs: <kbd>Telephony.Sms.Intents</kbd></span> at <a href="https://developer.android.com/reference/android/provider/Telephony.Sms.Intents.html"><span class="URLPACKT">https://developer.android.com/reference/android/provider/Telephony.Sms.Intents.html</span></a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Displaying a web page in your application</h1>
                </header>
            
            <article>
                
<p>When you want to show a web page, you have two choices: call the default browser or display the content in your app. If you just want to call the default browser, use an Intent as follows:</p>
<pre>Uri uri = Uri.parse("https://www.packtpub.com/"); 
Intent intent = new Intent(Intent.ACTION_VIEW, uri); 
startActivity(intent); </pre>
<p>If you need to display the content in your own application, you can use <kbd>WebView</kbd>. This recipe will show how to display a web page in your application, as can be seen in this screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/bac4a050-ddd1-431b-adfa-0c824a1b451c.png" style="width:14.83em;height:29.83em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Create a new project in Android Studio and call it <kbd><span class="CodeInTextPACKT">WebView</span></kbd>. <span class="s1">Use the default </span><span class="packt_screen"><span class="s2">Phone &amp; Tablet</span><span class="s1"> </span></span><span class="s1">options and select <span class="packt_screen">Empty Activity</span> in the <span class="packt_screen">Add an Activity</span></span> <span class="s2">to <span class="packt_screen">Mobile</span></span><span class="s1"> dialog.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We're going to create the <span class="CodeInTextPACKT">WebView</span> <span>through code so we won't be modifying the layout. We'll start by opening the Android Manifest and following these steps:</span></p>
<ol>
<li>Add the following permission:</li>
</ol>
<pre style="padding-left: 60px"><span>&lt;uses-permission </span><span>android</span><span>:name=</span><span>"android.permission.INTERNET"</span><span>/&gt;</span></pre>
<ol start="2">
<li>Modify the existing <kbd><span class="CodeInTextPACKT">onCreate()</span></kbd> to include the following code:</li>
</ol>
<pre style="padding-left: 60px">WebView webview = <span>new </span>WebView(<span>this</span>)<span>;<br/></span>setContentView(webview)<span>;<br/></span>webview.loadUrl(<span>"https://www.packtpub.com/"</span>)<span>;</span></pre>
<ol start="3">
<li>You're ready to run the application on a device or emulator.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>We create a <span class="CodeInTextPACKT">WebView</span> to use as our layout and load our webpage with <kbd><span class="CodeInTextPACKT">loadUrl()</span></kbd><span>. The preceding code works, but, at this level, it is very basic and only displays the first page. If you click on any links, the default browser will handle the request.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>What if you want full web browsing functionality so any link the user clicks on still loads in your <kbd><span class="CodeInTextPACKT">WebView</span></kbd>? Create <kbd>WebViewClient</kbd> as shown in this code:</p>
<pre>webview.setWebViewClient(new WebViewClient()); </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Controlling page navigation</h1>
                </header>
            
            <article>
                
<p>If you want more control over the page navigation, you can create your own <kbd><span class="CodeInTextPACKT">WebViewClient</span></kbd> class. If you want to only allow links <span>within your own website,</span> override the <kbd><span class="CodeInTextPACKT">shouldOverrideUrlLoading()</span></kbd> callback as shown here:</p>
<pre><span>private class </span>mWebViewClient <span>extends </span>WebViewClient {<br/>    <span>@Override<br/></span><span>    </span><span>public boolean </span><span>shouldOverrideUrlLoading</span>(WebView view<span>, </span>String url) {<br/>        <span>if </span>(Uri.<span>parse</span>(url).getHost().equals(<span>"www.packtpub.com"</span>)) {<br/>            <span>return false;  </span><span>//Don't override since it's the same host <br/></span><span>        </span>} <span>else </span>{<br/>            <span>return true; </span><span>//Stop the navigation since it's a different <br/>            //site <br/></span><span>        </span>}<br/>    }<br/>}</pre>
<p><span>Then, use the following code to set the client:</span></p>
<pre>webview.setWebViewClient(<span>new </span>mWebViewClient())<span>;</span></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to enable JavaScript</h1>
                </header>
            
            <article>
                
<p>There are many other <span>WebView </span>options we can customize through <span class="CodeInTextPACKT">WebSetting</span>. If you want to enable JavaScript, get <kbd>w<span class="CodeInTextPACKT">ebSettings</span></kbd> from the <span class="CodeInTextPACKT">WebView</span> and call <kbd><span class="CodeInTextPACKT">setJavaScriptEnabled()</span></kbd><span>, as shown here:</span></p>
<pre>WebSettings webSettings = webview.getSettings(); 
webSettings.setJavaScriptEnabled(true); </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Enable built-in zoom</h1>
                </header>
            
            <article>
                
<p>Another <kbd><span class="CodeInTextPACKT">webSettings</span></kbd> option is <kbd><span class="CodeInTextPACKT">setBuiltInZoomControls()</span></kbd>. Continuing from the preceding code, just add this:</p>
<pre>webSettings.setBuiltInZoomControls(true); </pre>
<p>Check the <span class="packt_screen"><span class="CodeInTextPACKT">webSettings</span></span> link in the next section for a large list of additional options.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li><span class="ScreenTextPACKT">Developer Docs: <kbd>WebView</kbd></span> at <a href="https://developer.android.com/reference/android/webkit/WebView.html"><span class="URLPACKT">https://developer.android.com/reference/android/webkit/WebView.html</span></a></li>
<li><span class="ScreenTextPACKT">Developer Docs:</span> <kbd>w<span class="ScreenTextPACKT">ebSettings</span></kbd> at <a href="https://developer.android.com/reference/android/webkit/WebSettings.html"><span class="URLPACKT">https://developer.android.com/reference/android/webkit/WebSettings.html</span></a></li>
<li><span class="ScreenTextPACKT">Developer Docs: <kbd>android.webkit</kbd></span> at <a href="https://developer.android.com/reference/android/webkit/package-summary.html"><span class="URLPACKT">https://developer.android.com/reference/android/webkit/package-summary.html</span></a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Checking online status and connection type</h1>
                </header>
            
            <article>
                
<p>This is a simple recipe, but one that is very common and will probably be included in every internet application you build: checking online status. While checking online status, we can also check the connection type: <kbd>WIFI</kbd> or <kbd>MOBILE</kbd>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Create a new project in Android Studio and call it <kbd><span class="CodeInTextPACKT">isOnline</span></kbd>. <span class="s1">Use the default</span><span class="packt_screen"><span class="s1"> </span><span class="s2">Phone &amp; Tablet</span></span><span class="s1"> options and select <span class="packt_screen">Empty Activity</span> in the <span class="packt_screen">Add an Activity</span></span> <span class="s2">to <span class="packt_screen">Mobile</span></span><span class="s1"> dialog.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>First, we need to add the necessary permissions to access the network. Then, we'll create a simple layout with <kbd>Button</kbd> and <kbd><span class="CodeInTextPACKT">TextView</span></kbd>. To get started, open the Android Manifest and follow these steps:</p>
<ol>
<li>Add the following permissions:</li>
</ol>
<pre style="padding-left: 60px"><span>&lt;uses-permission </span><span>android</span><span>:name=</span><span>"android.permission.INTERNET"</span><span>/&gt;<br/></span><span>&lt;uses-permission </span><span>android</span><span>:name=</span><span>"android.permission.ACCESS_NETWORK_STATE" </span><span>/&gt;</span></pre>
<ol start="2">
<li>Open the <kbd><span class="CodeInTextPACKT">a</span><span class="CodeInTextPACKT">ctivity_main.xml</span></kbd> file and replace the existing layout with the following:</li>
</ol>
<pre style="padding-left: 60px"><span>&lt;?</span><span>xml version=</span><span>"1.0" </span><span>encoding=</span><span>"utf-8"</span><span>?&gt;<br/></span><span>&lt;RelativeLayout<br/></span><span>    </span><span>xmlns:</span><span>android</span><span>=</span><span>"http://schemas.android.com/apk/res/android"<br/></span><span>    </span><span>android</span><span>:layout_width=</span><span>"match_parent"<br/></span><span>    </span><span>android</span><span>:layout_height=</span><span>"match_parent" </span><span>&gt;<br/></span><span>    &lt;TextView<br/></span><span>        </span><span>android</span><span>:id=</span><span>"@+id/textView"<br/></span><span>        </span><span>android</span><span>:layout_width=</span><span>"wrap_content"<br/></span><span>        </span><span>android</span><span>:layout_height=</span><span>"wrap_content"<br/></span><span>        </span><span>android</span><span>:text=</span><span>"" </span><span>/&gt;<br/></span><span>    &lt;Button<br/></span><span>        </span><span>android</span><span>:layout_width=</span><span>"wrap_content"<br/></span><span>        </span><span>android</span><span>:layout_height=</span><span>"wrap_content"<br/></span><span>        </span><span>android</span><span>:text=</span><span>"Check"<br/></span><span>        </span><span>android</span><span>:layout_centerInParent=</span><span>"true"<br/></span><span>        </span><span>android</span><span>:onClick=</span><span>"getStatus"</span><span>/&gt;<br/></span><span>&lt;/RelativeLayout&gt;</span></pre>
<ol start="3">
<li>Add this method to check the connection status:</li>
</ol>
<pre style="padding-left: 60px"><span>private boolean </span><span>isOnline</span>() {<br/>    ConnectivityManager connectivityManager = (ConnectivityManager)<br/>                    getSystemService(Context.<span>CONNECTIVITY_SERVICE</span>)<span>;<br/></span><span>    </span>NetworkInfo networkInfo = connectivityManager.getActiveNetworkInfo()<span>;<br/></span><span>    return </span>(networkInfo != <span>null </span>&amp;&amp; networkInfo.isConnected())<span>;<br/></span>}</pre>
<ol start="4">
<li>Add the following method to handle the button click:</li>
</ol>
<pre style="padding-left: 60px"><span>public void </span><span>getStatus</span>(View view) {<br/>    TextView textView = findViewById(R.id.<span>textView</span>)<span>;<br/></span><span>    if </span>(isOnline()) {<br/>        ConnectivityManager connectivityManager =<br/>                (ConnectivityManager) getSystemService(Context.<span>CONNECTIVITY_SERVICE</span>)<span>;<br/></span><span>        </span>NetworkInfo networkInfo = connectivityManager.getActiveNetworkInfo()<span>;<br/></span><span>        </span>textView.setText(networkInfo.getTypeName())<span>;<br/></span><span>    </span>} <span>else </span>{<br/>        textView.setText(<span>"Offline"</span>)<span>;<br/></span><span>    </span>}<br/>}</pre>
<ol start="5">
<li>You're ready to run the application on a device or emulator.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>We created the <kbd><span class="CodeInTextPACKT">isOnline()</span></kbd> method to make it easy to reuse this code.</p>
<p>To check the status, we get an instance of <kbd><span class="CodeInTextPACKT">ConnectivityManager</span></kbd> to read the <kbd><span class="CodeInTextPACKT">NetworkInfo</span></kbd> <span>state. If it reports we are connected, we get the name of the active network by calling</span> <kbd><span class="CodeInTextPACKT">getType()</span></kbd>, which returns one of the following constants:</p>
<ul>
<li><kbd>TYPE_MOBILE</kbd></li>
<li><kbd>TYPE_WIFI</kbd></li>
<li><kbd>TYPE_WIMAX</kbd></li>
<li><kbd>TYPE_ETHERNET</kbd></li>
<li><kbd>TYPE_BLUETOOTH</kbd></li>
</ul>
<p>Also, see the <kbd><span class="CodeInTextPACKT">ConnectivityManager</span></kbd> link later for additional constants. For display purposes, we call <kbd><span class="CodeInTextPACKT">getTypeName()</span></kbd>. We could call <kbd><span class="CodeInTextPACKT">getType()</span></kbd> <span>to get a numeric constant instead.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>We can also set it up so our app will be notified when the network status changes.  </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Monitoring network state changes</h1>
                </header>
            
            <article>
                
<p>If your application needs to respond to changes in the network status, take a look at <kbd>CONNECTIVITY_ACTION</kbd> in <kbd><span class="CodeInTextPACKT">ConnectivityManager</span></kbd><span>.  There are two ways to set up the filters to be notified of connectivity change events:</span></p>
<ul>
<li><span>Through the Android Manifest</span></li>
<li>Through code</li>
</ul>
<p><span>Here's an example of how to include the action in the receiver's intent filter through the Android Manifest:</span></p>
<pre>&lt;receiver android:name=".MyBroadcastReceiver"&gt; 
    &lt;intent-filter&gt; 
<span>        &lt;action android:name="android.net.conn.CONNECTIVITY_CHANGE" /&gt;</span> 
    &lt;/intent-filter&gt; 
&lt;/receiver&gt; </pre>
<p><span>Be careful using the Android Manifest as it will notify your app every time the network state changes, even if your app isn't being used. This can cause unnecessary drain on the battery.   </span></p>
<div class="packt_infobox">Apps targeting Android 7.0 and later will no longer receive <kbd>CONNECTIVITY_CHANGE</kbd> when declared in the Manifest. (This is to prevent unnecessary battery drain). Instead, register the Intent Filter through code as shown next.</div>
<p>The better solution (and required for Android 7.0 and later) is to register your intent filter through code. Here is an example:</p>
<pre>registerReceiver(<span>mReceiver</span><span>, new </span>IntentFilter(ConnectivityManager.<span>CONNECTIVITY_ACTION</span>))<span>;</span></pre>
<p>Take a look at the recipe in the file downloads for an example of logging <kbd>CONNECTIVITY_CHANGE</kbd> events.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li><span class="ScreenTextPACKT">Developer Docs: <kbd>ConnectivityManager</kbd></span> at <a href="https://developer.android.com/reference/android/net/ConnectivityManager.html"><span class="URLPACKT">https://developer.android.com/reference/android/net/ConnectivityManager.html</span></a></li>
<li><span class="ScreenTextPACKT">Developer Docs: <kbd>NetworkInfo</kbd></span> at <a href="https://developer.android.com/reference/android/net/NetworkInfo.html"><span class="URLPACKT">https://developer.android.com/reference/android/net/NetworkInfo.html</span></a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Phone number blocking API</h1>
                </header>
            
            <article>
                
<p>A new feature introduced in Android Nougat (API 24) is the ability to handle blocking phone numbers at the OS level. This provides a consistent experience for the user across multiple devices with the following:</p>
<ul>
<li>Blocked Numbers block both incoming calls and text messages</li>
<li>Blocked Numbers can be backed up using the Backup &amp; Restore feature</li>
<li>All apps on the device share the same Blocked Numbers list</li>
</ul>
<p>In this recipe, we will look at the code to add a number to block, remove the number, and how to check whether the number is already blocked.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Create a new project in Android Studio and call it<span> </span><kbd>BlockedCallList</kbd>. In the<span> </span><span class="packt_screen">Target Android Devices</span><span> </span>dialog, select the<span> </span><span class="packt_screen">Phone &amp; Tablet</span><span> </span>option and choose<span> </span><span class="packt_screen">API 24: Android 7.0 Nougat</span><span> </span>(or higher) for the Minimum SDK. S<span class="s1">elect </span><span class="s2"><span class="packt_screen">Empty Activity</span></span><span class="s1"> in the </span><span class="s2"><span class="packt_screen">Add an Activity</span> to <span class="packt_screen">Mobile</span></span><span class="s1"> dialog.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We will start by creating a UI with an <kbd>EditText</kbd> to enter a phone number and three buttons: <kbd>Block</kbd>, <kbd>Unblock</kbd>, and <kbd>isBlocked</kbd>. To start, open<span> </span><kbd>activity_main.xml</kbd><span> </span>and follow these steps:</p>
<ol>
<li>Replace the existing layout with the following XML code:</li>
</ol>
<pre style="padding-left: 60px"><span>&lt;?</span><span>xml version=</span><span>"1.0" </span><span>encoding=</span><span>"utf-8"</span><span>?&gt;<br/></span><span>&lt;RelativeLayout<br/></span><span>    </span><span>xmlns:</span><span>android</span><span>=</span><span>"http://schemas.android.com/apk/res/android"<br/></span><span>    </span><span>xmlns:</span><span>app</span><span>=</span><span>"http://schemas.android.com/apk/res-auto"<br/></span><span>    </span><span>xmlns:</span><span>tools</span><span>=</span><span>"http://schemas.android.com/tools"<br/></span><span>    </span><span>android</span><span>:layout_width=</span><span>"match_parent"<br/></span><span>    </span><span>android</span><span>:layout_height=</span><span>"match_parent"<br/></span><span>    </span><span>tools</span><span>:context=</span><span>".MainActivity"</span><span>&gt;<br/></span><span>    &lt;EditText<br/></span><span>        </span><span>android</span><span>:id=</span><span>"@+id/editTextNumber"<br/></span><span>        </span><span>android</span><span>:layout_width=</span><span>"wrap_content"<br/></span><span>        </span><span>android</span><span>:layout_height=</span><span>"wrap_content"<br/></span><span>        </span><span>android</span><span>:inputType=</span><span>"phone"<br/></span><span>        </span><span>android</span><span>:ems=</span><span>"10"<br/></span><span>        </span><span>android</span><span>:layout_alignParentTop=</span><span>"true"<br/></span><span>        </span><span>android</span><span>:layout_centerHorizontal=</span><span>"true"<br/></span><span>        </span><span>android</span><span>:layout_marginTop=</span><span>"36dp" </span><span>/&gt;<br/></span><span>    &lt;Button<br/></span><span>        </span><span>android</span><span>:id=</span><span>"@+id/buttonblock"<br/></span><span>        </span><span>android</span><span>:layout_width=</span><span>"wrap_content"<br/></span><span>        </span><span>android</span><span>:layout_height=</span><span>"wrap_content"<br/></span><span>        </span><span>android</span><span>:text=</span><span>"Block"<br/></span><span>        </span><span>android</span><span>:layout_above=</span><span>"@+id/buttonUnblock"<br/></span><span>        </span><span>android</span><span>:layout_centerHorizontal=</span><span>"true"<br/></span><span>        </span><span>android</span><span>:onClick=</span><span>"onClickBlock"</span><span>/&gt;<br/></span><span>    &lt;Button<br/></span><span>        </span><span>android</span><span>:id=</span><span>"@+id/buttonUnblock"<br/></span><span>        </span><span>android</span><span>:layout_width=</span><span>"wrap_content"<br/></span><span>        </span><span>android</span><span>:layout_height=</span><span>"wrap_content"<br/></span><span>        </span><span>android</span><span>:text=</span><span>"Block"<br/></span><span>        </span><span>android</span><span>:layout_centerVertical=</span><span>"true"<br/></span><span>        </span><span>android</span><span>:layout_centerHorizontal=</span><span>"true"<br/></span><span>        </span><span>android</span><span>:onClick=</span><span>"onClickUnblock"</span><span>/&gt;<br/></span><span>    &lt;Button<br/></span><span>        </span><span>android</span><span>:id=</span><span>"@+id/buttonIsBlocked"<br/></span><span>        </span><span>android</span><span>:layout_width=</span><span>"wrap_content"<br/></span><span>        </span><span>android</span><span>:layout_height=</span><span>"wrap_content"<br/></span><span>        </span><span>android</span><span>:text=</span><span>"isBlocked"<br/></span><span>        </span><span>android</span><span>:layout_below=</span><span>"@+id/buttonUnblock"<br/></span><span>        </span><span>android</span><span>:layout_centerHorizontal=</span><span>"true"<br/></span><span>        </span><span>android</span><span>:onClick=</span><span>"onClickIsBlocked"</span><span>/&gt;<br/></span><span>&lt;/RelativeLayout&gt;</span></pre>
<ol start="2">
<li>Open <kbd>MainActivity.java</kbd> and add the following code to the class declaration:</li>
</ol>
<pre style="padding-left: 60px"><span>private </span>EditText <span>mEditTextNumber</span><span>;</span></pre>
<ol start="3">
<li>Add the following line of code to the end of the<span> </span><kbd>onCreate()</kbd><span> </span>method:</li>
</ol>
<pre style="padding-left: 60px"><span>mEditTextNumber</span>=findViewById(R.id.<span>editTextNumber</span>)<span>;</span></pre>
<ol start="4">
<li>Add the three methods to handle the button clicks:</li>
</ol>
<pre style="padding-left: 60px"><span>public void </span><span>onClickBlock</span>(View view) {<br/>    String number = <span>mEditTextNumber</span>.getText().toString()<span>;<br/></span><span>    if </span>(number!=<span>null </span>&amp;&amp; number.length()&gt;<span>0</span>) {<br/>        blockNumber(number)<span>;<br/></span><span>    </span>}<br/>}<br/><span>public void </span><span>onClickUnblock</span>(View view) {<br/>    String number = <span>mEditTextNumber</span>.getText().toString()<span>;<br/></span><span>    if </span>(number!=<span>null </span>&amp;&amp; number.length()&gt;<span>0</span>) {<br/>        unblockNumber(number)<span>;<br/></span><span>    </span>}<br/>}<br/><span>public void </span><span>onClickIsBlocked</span>(View view) {<br/>    String number = <span>mEditTextNumber</span>.getText().toString()<span>;<br/></span><span>    if </span>(number!=<span>null </span>&amp;&amp; number.length()&gt;<span>0</span>) {<br/>        isBlocked(number)<span>;<br/></span><span>    </span>}<br/>}</pre>
<ol start="5">
<li>Add the following function to block the number:</li>
</ol>
<pre style="padding-left: 60px"><span>private void </span><span>blockNumber</span>(String number) {<br/>    <span>if </span>(BlockedNumberContract.<span>canCurrentUserBlockNumbers</span>(<span>this</span>)) {<br/>        ContentValues values = <span>new </span>ContentValues()<span>;<br/></span><span>        </span>values.put(BlockedNumberContract.BlockedNumbers.<span>COLUMN_ORIGINAL_NUMBER</span><span>, </span>number)<span>;<br/></span><span>        </span>getContentResolver().insert(BlockedNumberContract.BlockedNumbers.<span>CONTENT_URI</span><span>, </span>values)<span>;<br/></span><span>    </span>}<br/>}</pre>
<ol start="6">
<li>Add the following function to unblock the number:</li>
</ol>
<pre style="padding-left: 60px"><span>private void </span><span>unblockNumber</span>(String number) {<br/>    <span>if </span>(BlockedNumberContract.<span>canCurrentUserBlockNumbers</span>(<span>this</span>)) {<br/>        ContentValues values = <span>new </span>ContentValues()<span>;<br/></span><span>        </span>values.put(BlockedNumberContract.BlockedNumbers.<span>COLUMN_ORIGINAL_NUMBER</span><span>, </span>number)<span>;<br/></span><span>        </span>Uri uri = getContentResolver()<br/>                .insert(BlockedNumberContract.BlockedNumbers.<span>CONTENT_URI</span><span>, </span>values)<span>;<br/></span><span>        </span>getContentResolver().delete(uri<span>, null, null</span>)<span>;<br/></span><span>    </span>}<br/>}</pre>
<ol start="7">
<li>Add the following function to check whether the number is blocked:</li>
</ol>
<pre style="padding-left: 60px"><span>public void </span><span>isBlocked</span>(String number) {<br/>    <span>if </span>(BlockedNumberContract.<span>canCurrentUserBlockNumbers</span>(<span>this</span>)) {<br/>        <span>boolean </span>blocked = BlockedNumberContract.<span>isBlocked</span>(<span>this,</span>number)<span>;<br/></span><span>        </span>Toast.<span>makeText</span>(MainActivity.<span>this, </span>number + <span>"blocked: " </span>+ blocked<span>, <br/></span><span>                </span>Toast.<span>LENGTH_SHORT</span>).show()<span>;<br/></span><span>    </span>} <span>else </span>{<br/>        Toast.<span>makeText</span>(MainActivity.<span>this, </span><span>"User cannot perform this operation"</span><span>, <br/></span><span>                </span>Toast.<span>LENGTH_SHORT</span>).show()<span>;<br/></span><span>    </span>}<br/>}</pre>
<ol start="8">
<li>You're ready to run the application on a device or emulator running at least Android 7.0.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Before we call the <kbd>BlockedNumberContract</kbd> APIs, we check to make sure we have permission by calling <kbd>canCurrentUserBlockNumbers()</kbd><span>, </span>as shown in this code:</p>
<pre><span>if </span>(BlockedNumberContract.<span>canCurrentUserBlockNumbers</span>(<span>this</span>)) {</pre>
<p>If true, we make the actual API call.</p>
<div class="mce-root packt_infobox">Important: Only the following apps can read and write to the <kbd>BlockedNumber</kbd> provider: the <span>default SMS application, the default phone app, and carrier apps. </span><span>The user can choose their default SMS and Phone app.</span></div>
<p>Adding and deleting numbers from the <kbd>BlockedNumber</kbd> list uses the standard Service Provider format. </p>
<div>
<p>The Update method is not supported; use the <kbd>Add</kbd> and <kbd>Delete</kbd> methods instead.</p>
</div>
<p>To check whether a number is already in the block list, call the<span> </span><kbd>isBlocked()</kbd><span> </span>method, passing in the current context and the number to check, as we do in this code:</p>
<pre><span>boolean </span>blocked = BlockedNumberContract.<span>isBlocked</span>(<span>this,</span>number)<span>;</span></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>To get the list of all currently blocked numbers, use the following code to create a cursor with the list:</p>
<pre>Cursor cursor = getContentResolver().query(<br/>        BlockedNumberContract.BlockedNumbers.<span>CONTENT_URI</span><span>,<br/></span><span>        new </span>String[]{BlockedNumberContract.BlockedNumbers.<span>COLUMN_ID</span><span>,<br/></span><span>                </span>BlockedNumberContract.BlockedNumbers.<span>COLUMN_ORIGINAL_NUMBER</span><span>,<br/></span><span>                </span>BlockedNumberContract.BlockedNumbers.<span>COLUMN_E164_NUMBER</span>}<span>,<br/></span><span>        null, null, null</span>)<span>;</span></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<p>For more information, see the <kbd>BlockedNumberContract</kbd> reference documentation: <a href="https://developer.android.com/reference/android/provider/BlockedNumberContract">https://developer.android.com/reference/android/provider/BlockedNumberContract</a></p>


            </article>

            
        </section>
    </body></html>