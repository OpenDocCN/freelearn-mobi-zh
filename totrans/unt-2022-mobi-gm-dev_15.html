<html><head></head><body>
		<div><h1 id="_idParaDest-157" class="chapter-number"><a id="_idTextAnchor453"/>15</h1>
			<h1 id="_idParaDest-158"><a id="_idTextAnchor454"/>Augmented Reality</h1>
			<p>Made popular with Niantic’s <em class="italic">Pokemon GO</em> and on Snapchat filters, <strong class="bold">Augmented Reality</strong> (<strong class="bold">AR</strong>) is a way of blending digital elements with the real world. Specifically, it is a technology that <a id="_idIndexMarker925"/>superimposes a computer-generated image on a user’s view of the real world, hence providing a composite view, meaning that both the real world and then digital elements put on top of it are displayed to the player.</p>
			<p>In this chapter, we will explore how to set up our project to utilize AR for both Android and iOS devices and how we can customize them. This project will be a simple AR project in which the player can look at various surfaces in the game environment and spawn objects on top of them. The goal of this chapter will be to explore the basic concepts of AR and see how they can be used in a project.</p>
			<p>This chapter will be split into several topics. It will contain a simple, step-by-step process from beginning to end. Here is the outline of our tasks:</p>
			<ul>
				<li>Setting up a project for AR</li>
				<li>Detecting surfaces</li>
				<li>Interacting with the AR environmen<a id="_idTextAnchor455"/>t</li>
				<li>Spawning objects in AR</li>
			</ul>
			<p>By the end of this chapter, you will have a good understanding of AR technology and how to create a basic AR project. Whether you’re a beginner or an experienced developer, this chapter will provide you with a solid foundation for further exploration and experimentation with AR which should come useful not only for mobile development but also for those looking to get experience with the same technology used in headsets from Meta as well as Apple's Vision Pro.<a id="_idTextAnchor456"/><a id="_idTextAnchor457"/></p>
			<h1 id="_idParaDest-159"><a id="_idTextAnchor458"/>Technical requirements</h1>
			<p>This book utilizes Unity 2022.1.0b16 and Unity Hub 3.3.1, but the steps should work with minimal changes in future versions of the editor. If you would like to download the exact version used in this book, and there is a new version out, you can visit Unity’s download archive at <a href="https://unity3d.com/get-unity/download/archive">https://unity3d.com/get-unity/download/archive</a>. You can also find the system requirements for Unity at <a href="https://docs.unity3d.com/2022.1/Documentation/Manual/system-requirements.html">https://docs.unity3d.com/2022.1/Documentation/Manual/system-requirements.html</a> in the <strong class="bold">Unity Editor system requirements</strong> section. To deploy your project, you will need an Android or iOS device.</p>
			<p>You can find the code files present in this chapter on GitHub at <a href="https://github.com/PacktPublishing/Unity-2022-Mobile-Game-Development-3rd-Edition/tree/main/Chapter15">https://github.com/PacktPublishing/Unity-2022-Mobile-Game-Development-3rd-Edition/tree/main/Chapter15</a>.</p>
			<h1 id="_idParaDest-160"><a id="_idTextAnchor459"/>Setting up a project for AR</h1>
			<p>Before we can start <a id="_idIndexMarker926"/>adding notifications to our project, we will need to add <a id="_idIndexMarker927"/>three packages that Unity makes available to enable AR for both iOS and Android devices. In our case, we are going to be utilizing both ARCore and ARKit to create our project, and the AR Foundation package to act as an intermediary so we can use both ARCore and ARKit while using a similar connection. Since this is a brand new way to create projects, we will actually create a new Unity project to demonstrate how to use it. Please follow the steps given here:</p>
			<ol>
				<li>To get started, open Unity Hub on your computer.</li>
				<li>From startup, we’ll opt to create a new project by clicking on the <strong class="bold">New</strong> button.</li>
				<li>Next, under <code>Mobile AR</code>), and under <strong class="bold">Templates</strong>, make sure that <strong class="bold">3D</strong> is selected:</li>
			</ol>
			<div><div><img src="img/B18868_15_01.jpg" alt="Figure 15.1 – Creating a 3D project"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.1 – Creating a 3D project</p>
			<ol>
				<li value="4">Afterward, click on <strong class="bold">Create Project</strong> and wait for Unity to load up.</li>
				<li>From the Unity Editor, go to <strong class="bold">Window</strong> | <strong class="bold">Package Manager</strong>.</li>
				<li>If it hasn’t <a id="_idIndexMarker928"/>been set already, click on the <strong class="bold">In Project</strong> drop-down <a id="_idIndexMarker929"/>menu from the toolbar of the <strong class="bold">Packages</strong> menu and select <strong class="bold">Unity Registry</strong>.</li>
				<li>From here, go to the search bar in the top right and type in <code>XR</code>. From there, you will need to select either <strong class="bold">ARKit XR Plugin</strong> if you want to support iOS devices or <strong class="bold">ARCore XR Plugin</strong> for Android, and click <strong class="bold">Install</strong>. Afterward, scroll down the available options until you reach <strong class="bold">AR Foundation</strong> and select it. Once there, click the <strong class="bold">Install</strong> button:</li>
			</ol>
			<div><div><img src="img/B18868_15_02.jpg" alt="Figure 15.2 – Installing packages"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.2 – Installing packages</p>
			<p>We now have all of the packages we need so we can exit <strong class="bold">Package Manager</strong>.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">While AR Foundation does most things that you’d want to do with AR, there are a few things that are for iOS or Android only. For more information on what AR Foundation can do and <a id="_idIndexMarker930"/>what ARCore and ARKit provide individually, check out <a href="https://docs.unity3d.com/Packages/com.unity.xr.arfoundation@5.0/manual/index.html#platform-support">https://docs.unity3d.com/Packages/com.unity.xr.arfoundation@5.0/manual/index.html#platform-support</a>.</p>
			<ol>
				<li value="8">Next, open up the <strong class="bold">Build Settings</strong> menu by going to <strong class="bold">File</strong> | <strong class="bold">Build Settings</strong>. From there, change your <a id="_idIndexMarker931"/>platform to either <strong class="bold">iOS</strong> or <strong class="bold">Android</strong> and click <a id="_idIndexMarker932"/>on the <strong class="bold">Switch Platform</strong> button. Afterward, click on the <strong class="bold">Player </strong><strong class="bold">Settings...</strong> option.</li>
				<li>Next, complete <em class="italic">step 10</em> if you are planning on using iOS or <em class="italic">step 11</em> if you are planning on using Android, or complete both steps if you plan on using both iOS and Android.</li>
				<li>If you are using iOS, make sure that, in the iOS <strong class="bold">Platform Settings</strong> section, the <strong class="bold">Requires ARKit support</strong> option is checked as well.</li>
				<li>For those using Android, go to the Android <strong class="bold">Player Settings...</strong> and under <strong class="bold">Other Settings</strong>, go to <strong class="bold">Rendering</strong> and uncheck the <strong class="bold">Auto Graphics API</strong> option. Then, under the <strong class="bold">Graphics APIs</strong> section, select the <strong class="bold">Vulkan</strong> option and press the <strong class="bold">–</strong> button to remove it from the list. Then, scroll down and uncheck the <strong class="bold">Multithreaded </strong><strong class="bold">Rendering</strong> option.</li>
			</ol>
			<div><div><img src="img/B18868_15_03.jpg" alt="Figure 15.3 – Android Player Settings setup"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.3 – Android Player Settings setup</p>
			<ol>
				<li value="12">The reason we have to disable this functionality is that, as of the time of writing, it is not compatible with ARCore. You’ll also want to set <strong class="bold">Minimum API Level</strong> to <strong class="bold">Android 7.0 ‘Nougat’ (API level 24)</strong> or higher.</li>
			</ol>
			<p>When working on <a id="_idIndexMarker933"/>ARCore projects in Unity, it’s recommended that you <a id="_idIndexMarker934"/>enable the ARM64 target architecture. If your app only supports the 32-bit ARMv7 architecture, it may not work properly on 64-bit devices, and it may not be available for download from the Google Play Store. This is because some 64-bit devices don’t support 32-bit ARCore libraries. So, to avoid any issues, it’s best to enable the ARM64 target architecture in your Unity project.</p>
			<p>Under <strong class="bold">Configuration</strong>, set <strong class="bold">Scripting Backend</strong> to <strong class="bold">IL2CPP</strong>. Next, under <strong class="bold">Target Architectures</strong>, enable the <strong class="bold">ARM64</strong> option.</p>
			<div><div><img src="img/B18868_15_04.jpg" alt="Figure 15.4 – Changing Target Architectures"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.4 – Changing Target Architectures</p>
			<ol>
				<li value="13">Now, from the <strong class="bold">Player Settings...</strong> menu, select the <strong class="bold">XR Plugin Management</strong> option, and <a id="_idIndexMarker935"/>then, under <strong class="bold">Plug-in Providers</strong>, check the <strong class="bold">ARCore</strong> field, <a id="_idIndexMarker936"/>and for iOS, check the <strong class="bold">ARKit</strong> option.</li>
			</ol>
			<div><div><img src="img/B18868_15_05.jpg" alt="Figure 15.5 – Enabling ARCore"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.5 – Enabling ARCore</p>
			<p>With that, we’ve taken care <a id="_idIndexMarker937"/>of all of the settings needed to support our project <a id="_idIndexMarker938"/>and have it export correctly!</p>
			<p>Now that we have included AR Foundation, we can now create a basic scene<a id="_idTextAnchor460"/> for a VR <a id="_idTextAnchor461"/>project.</p>
			<h1 id="_idParaDest-161"><a id="_idTextAnchor462"/>Basic setup</h1>
			<p>Since the player <a id="_idIndexMarker939"/>can be anywhere when the game starts, we can’t use a camera in the traditional sense, so we will start by removing the original one. Follow the steps given here:</p>
			<ol>
				<li>From the <strong class="bold">Hierarchy</strong> panel, select the <strong class="bold">Main Camera</strong> object and delete it by right-clicking and selecting <strong class="bold">Delete</strong> or pressing the <em class="italic">Delete</em> key.</li>
			</ol>
			<p>There are two key objects that we will need to create before we can start implementing our own features: <strong class="bold">AR Session</strong> and <strong class="bold">AR </strong><strong class="bold">Sessio<a id="_idTextAnchor463"/>n Origin</strong>.</p>
			<ol>
				<li value="2">Right-click in the <strong class="bold">Hierarchy</strong> panel and select <strong class="bold">XR</strong> | <strong class="bold">AR Session</strong>:</li>
			</ol>
			<div><div><img src="img/B18868_15_06.jpg" alt="Figure 15.6 – Creating an AR session"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.6 – Creating an AR session</p>
			<p><strong class="bold">AR Session</strong> is what <a id="_idIndexMarker940"/>controls the life cycle of any AR experience, which allows us to enable or disable AR features depending on the platform we are working on.</p>
			<p class="callout-heading">Note</p>
			<p class="callout"><strong class="bold">AR Session </strong>is also responsible <a id="_idIndexMarker941"/>for telling you whether your device supports AR. For information on handling this, check out <a href="https://docs.unity3d.com/Packages/com.unity.xr.arfoundation@4.2/manual/index.html#checking-for-device-support">https://docs.unity3d.com/Packages/com.unity.xr.arfoundation@4.2/manual/index.html#checking-for-device-support</a>.</p>
			<ol>
				<li value="3">Create an <strong class="bold">AR Session Origin</strong> object by right-clicking and selecting <strong class="bold">XR</strong> | <strong class="bold">AR </strong><strong class="bold">Session Origin</strong>.</li>
			</ol>
			<p><strong class="bold">AR Session Origin</strong> is used to scale and offset virtual content while the game itself is playing. You <a id="_idIndexMarker942"/>may notice that the object has a child, <strong class="bold">AR Camera</strong>, which is the camera that will follow the game as it is running.</p>
			<p>Before we deploy to the device to ensure everything is working correctly, let’s add a cube to our scene so we can see that it is working correctly.</p>
			<ol>
				<li value="4">Switch to the <strong class="bold">Scene</strong> view if you haven’t done so already. Then, from the top menu, click on <strong class="bold">GameObject</strong> | <strong class="bold">3D Object</strong> | <strong class="bold">Cube</strong>:</li>
			</ol>
			<div><div><img src="img/B18868_15_07.jpg" alt="Figure 15.7 – Creat﻿ing a cube"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.7 – Creat<a id="_idTextAnchor464"/>ing a cube</p>
			<ol>
				<li value="5">Now, build your project and put the game on the device in the same manner as discussed in <a href="B18868_02.xhtml#_idTextAnchor087"><em class="italic">Chapter 2</em></a>, <em class="italic">Project Setup for Android and </em><em class="italic">iOS Development</em>.</li>
			</ol>
			<p class="callout-heading">Tip</p>
			<p class="callout">For iOS users, you may notice when you build the project, it will tell you that the project is lacking a <code>.xml</code> file. If this appears, click on the <strong class="bold">Yes, fix and build</strong> option when prompted.</p>
			<p class="callout">For Android users, you may need to install the Google Play Services for AR if it is not installed.</p>
			<ol>
				<li value="6">Upon running your <a id="_idIndexMarker943"/>project, give access to the camera if needed and open the game. Once the project shows your environment, step back as the game starts:</li>
			</ol>
			<div><div><img src="img/B18868_15_08.jpg" alt="Figure 15.8 – Our first AR result"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.8 – Our first AR result</p>
			<p>The reason why we have to step back to see the cube is that the position of all objects is based on the area the phone was physically at when the game started. The cube is also quite large because, at a default scale of 1,1,1, that means that it is 1 meter (or around 3.3 feet) wide on each side in relation to real-sized objects. We obviously don’t want to require the user to step back upon starting the game so we will need to keep track of where usable surfaces are in our environment, which is what we will be d<a id="_idTextAnchor465"/><a id="_idTextAnchor466"/><a id="_idTextAnchor467"/>oing next.</p>
			<p>To detect surfaces within <a id="_idIndexMarker944"/>our real-world environment, we will need to make use of a new component, <strong class="bold">AR Plane Manager</strong>. This component allows us to create, remove, or update GameObjects in our scene based on the surfaces within the real-world environment. The following steps will automatically create invisible planes with colliders that we could possibly use for gameplay reasons:</p>
			<ol>
				<li>We no longer need the original cube we created, so we can delete it from the scene by right-clicking it and selecting <strong class="bold">Delete</strong> or by selecting it and pressing the <em class="italic">Delete</em> key.</li>
				<li>From the <strong class="bold">Hierarchy</strong> panel, select the <strong class="bold">AR Session Origin</strong> object. From there, add the <strong class="bold">AR Plane Manager</strong> component to it by clicking on the <strong class="bold">Add Component</strong> button at the bottom of the <strong class="bold">Inspector</strong> window and then typing in the name of the component and pressing <em class="italic">Enter</em>.</li>
			</ol>
			<p>At this point, we will have surfaces being generated to our scene while being run, but for things such as debugging, it would be a good idea to visually see the planes that are being generated. So, that’s what we will do next using the following steps:</p>
			<ol>
				<li>From the top menu, go to <strong class="bold">GameObject</strong> | <strong class="bold">XR</strong> | <strong class="bold">AR </strong><strong class="bold">Default Plane</strong>.</li>
			</ol>
			<p>This object has several different components that are used in creating a visual plane; of note, are the <strong class="bold">AR Plane</strong> and <strong class="bold">AR Plane Mesh Visualizer </strong>components. <strong class="bold">AR Plane</strong> represents a plane detected by the AR device, and <strong class="bold">AR Plane Mesh Visualizer</strong> is in charge of using the data from <strong class="bold">AR Plane</strong> to modify the <strong class="bold">MeshFilter</strong> and <strong class="bold">MeshCollider</strong> components to overlay the detected wall, and the <strong class="bold">Line Renderer</strong> component to display the boundaries. The <strong class="bold">Mesh Renderer</strong> component <a id="_idIndexMarker945"/>will draw the information displayed from these modifications.</p>
			<ol>
				<li value="2">From the <code>Prefabs</code>.</li>
				<li>Drag and drop the <code>Prefabs</code> folder to turn it into a Prefab. If it is done correctly, you should notice the GameObject’s text in the <strong class="bold">Hierarchy</strong> window is now blue:</li>
			</ol>
			<div><div><img src="img/B18868_15_09.jpg" alt="Figure 15.9 – Creating a Prefab"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.9 – Creating a Prefab</p>
			<ol>
				<li value="4">Once created, you <a id="_idIndexMarker946"/>can delete the <strong class="bold">AR Default Plane</strong> object in the <strong class="bold">Hier<a id="_idTextAnchor469"/>archy</strong> window.</li>
				<li>Select the <strong class="bold">AR Session Origin</strong> object. Click the <strong class="bold">Add Component</strong> button and add an <strong class="bold">AR Plane Manager</strong> component. Afterward, drag and drop the <strong class="bold">AR Default Plane</strong> Prefab into the <strong class="bold">Plane Prefab</strong> property of the <strong class="bold">AR Plane </strong><strong class="bold">Manager</strong> component:</li>
			</ol>
			<div><div><img src="img/B18868_15_10.jpg" alt="Figure 15.10 – Assigning the Plane Prefab"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.10 – Assigning the Plane Prefab</p>
			<p>This will tell <strong class="bold">Plane Manager</strong> that, any time it detects a new plane within the scene, it should spawn <a id="_idIndexMarker947"/>a Plane Prefab and have it draw the details for it.</p>
			<ol>
				<li value="6">Save your project and build your game again. Once it is running on your device, walk around your room, moving the camera as<a id="_idTextAnchor470"/> you do so:</li>
			</ol>
			<div><div><img src="img/B18868_15_11.jpg" alt="Figure 15.11 – Plane creation in AR"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.11 – Plane creation in AR</p>
			<p>The longer you stay <a id="_idIndexMarker948"/>within an area with movement, the longer the phone will have to build a more realistic depiction of the surfaces in your environment.</p>
			<p>Feel free to open the Prefab we created and modify how your planes will be visualized!</p>
			<p>It’s great that we can now see things happening in the game environment, but we currently have no way to actually interact with the world—that is what we will be lookin<a id="_idTextAnchor471"/>g into in the ne<a id="_idTextAnchor472"/>xt section.</p>
			<h1 id="_idParaDest-162"><a id="_idTextAnchor473"/>Interacting with the AR environment</h1>
			<p>One of the ways that we can have the player interact with the world is by allowing them to spawn objects <a id="_idIndexMarker949"/>within the scene to help players see where items will spawn. We can create an indicator to show where they will actually spawn to. Let’s look at the steps to do just that:</p>
			<ol>
				<li>Create a quad using <strong class="bold">GameObject</strong> | <strong class="bold">3D Object</strong> | <strong class="bold">Quad</strong>.</li>
			</ol>
			<p>Quads represent a plane, the simplest type of geometry. In our case, we will use the quad as an indicator to the player where they will be spawning an object if they tap on the screen.</p>
			<ol>
				<li value="2">With the quad selected, go to the <code>(0,0,0)</code>, <code>90</code>, and <code>(0.2,0.2,1)</code>.</li>
			</ol>
			<p>We made the quad smaller to be 20 centimeters long and rotated it so it could represent a floor better. We do not want these values to change but we will eventually want to move and rotate this object to follow our player when they move the camera. To protect this data, we can instead create a parent object for it. That way, whenever the parent moves or rotates, the child will move and rotate in the same manner.</p>
			<ol>
				<li value="3">Create an empty GameObject by selecting <code>Placement Indicator</code>. Then, go to the <code>(0,0,0)</code>.</li>
				<li>From the <strong class="bold">Hierarchy</strong> window, drag and drop the <strong class="bold">Quad</strong> GameObject on top of the <strong class="bold">Placement Indicator</strong> object to make it a child:</li>
			</ol>
			<div><div><img src="img/B18868_15_12.jpg" alt="Figure 15.12 – Creating the Placement Indi﻿cator object"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.12 – Creating the Placement Indi<a id="_idTextAnchor474"/>cator object</p>
			<p>Now that we have an object to work with, we need some way to figure out where the player’s camera is facing so we can move the object. We can do this through the use of a new component, <strong class="bold">AR </strong><strong class="bold">Raycast Manager</strong>.</p>
			<ol>
				<li value="5">From the <strong class="bold">Hierarchy</strong> window, select the <strong class="bold">AR Session Origin</strong> object. From there, add the <strong class="bold">AR Raycast Manager</strong> component to it.</li>
			</ol>
			<p>The <strong class="bold">AR Raycast Manager</strong> component exposes the ability to raycast to AR Foundation. This will allow us to perform a Raycast within the physical environment that <a id="_idIndexMarker950"/>we are in. A Raycast, also known as hit testing, allows <a id="_idIndexMarker951"/>us to create a ray, which is an invisible line that allows us to check whether there is something that collides from its point of origin and direction. This is used oftentimes in games for things such as checking whether a bullet would hit the player.</p>
			<p>Now that we have this setup done, let’s see how we can work with these components in code and see how we can use the information to place AR objects within real-world spaces using the following steps:</p>
			<ol>
				<li>Go to the <code>Assets</code> folder. From there, create a new folder called <code>Scripts</code>.</li>
				<li>Go inside the <code>Scripts</code> folder and create a new C# script called <code>PlaceARObject</code>.</li>
				<li>At the top of the file, add the following <code>using</code> statements:<pre class="source-code">
using UnityEngine.XR.ARFoundation; /* ARRaycastManager */
using UnityEngine.XR.ARSubsystems; /* TrackableType */</pre></li>
				<li>Add the <a id="_idIndexMarker952"/>following properties to the class:<pre class="source-code">
/// &lt;summary&gt;
/// A reference to the Raycast Manager for being able
/// to perform raycasts
/// &lt;/summary&gt;
ARRaycastManager raycastManager;
/// &lt;summary&gt;
/// A reference to the AR camera to know where to draw
/// raycasts from
/// &lt;/summary&gt; Camera arCamera;</pre></li>
				<li>Then, we need to initialize the properties in the <code>Start</code> function:<pre class="source-code">
/// &lt;summary&gt;
/// Start is called before the first frame update.
/// Initialize our private variables
/// &lt;/summary&gt;
void Start()
{
    raycastManager = GameObject.FindObjectOfType
        &lt;ARRaycastManager&gt;();
    arCamera = GameObject.FindObjectOfType&lt;Camera&gt;();
}</pre></li>
				<li>Finally, we need <a id="_idIndexMarker953"/>to replace our <code>Update</code> function and use <code>LateUpdate</code> instead:<pre class="source-code">
/// &lt;summary&gt;
/// LateUpdate is called once per frame after all
/// Update functions have been called
/// &lt;/summary&gt;
private void LateUpdate()
{
    /* Figure out where the center of the screen is */
    var viewportCenter = new Vector2(0.5f, 0.5f);
    var screenCenter =
       arCamera.ViewportToScreenPoint(viewportCenter);
    /* Check if there is something in front of the
       center of the screen and update the placement
       indicator if needed */
    UpdateIndicator(screenCenter);
}</pre></li>
				<li>In the preceding <a id="_idIndexMarker954"/>snippet, we are using an <code>UpdateIndicator</code> function that currently doesn’t exist, so let’s add that next:<pre class="source-code">
/// &lt;summary&gt;
/// Will update the placement indicator's position and
/// rotation to be on the floor of any plane surface
/// &lt;/summary&gt;
/// &lt;param name="screenPosition"&gt;A position in screen
/// space&lt;/param&gt;
private void UpdateIndicator(Vector2 screenPosition)
{
    var hits = new List&lt;ARRaycastHit&gt;();
    raycastManager.Raycast(screenPosition,
        hits, TrackableType.Planes);
    /* If there is at least one hit position */
    if (hits.Count &gt; 0)
    {
        // Get the pose data
        var placementPose = hits[0].pose;
        var camForward = arCamera.transform.forward;
        /* We want the object to be flat */
        camForward.y = 0;
        /* Scale the vector be have a size of 1 */
        camForward = camForward.normalized;
        /* Rotate to face in front of the camera */
        placementPose.rotation =
            Quaternion.LookRotation(camForward);
        transform.SetPositionAndRotation
            (placementPose.position,
                placementPose.rotation);
    }
}</pre></li>
				<li>Save the script <a id="_idIndexMarker955"/>and return to the Unity Editor. Attach the <code>PlaceARObject</code> script to the <strong class="bold">Placement </strong><strong class="bold">Indicator</strong> GameObject.</li>
				<li>Export your game to your device of choice and verify that it is working:</li>
			</ol>
			<div><div><img src="img/B18868_15_13.jpg" alt="Figure 15.13 – Placement Indicator in AR"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.13 – Placement Indicator in AR</p>
			<p>As you can see, the plane will now move and rotate so that it is always facing us! You may notice the plane has a flickery texture. This is due to the z-fighting concept we discussed previously in <a href="B18868_04.xhtml#_idTextAnchor165"><em class="italic">Chapter 4</em></a>, <em class="italic">Resolution-Independent UI</em>. Basically, both <a id="_idIndexMarker956"/>objects have the same position so it’s up to Unity to decide what order to draw them in. We can fix this by placing the quad slightly above the plane’s position, whi<a id="_idTextAnchor475"/>ch we will do now.</p>
			<ol>
				<li value="10">Update the <code>UpdateIndicator</code> function to use the following code at the end:<pre class="source-code">
        /* Rotate to face in front of the camera */
        placementPose.rotation =
            Quaternion.LookRotation(camForward);
        /* Move the quad slightly above the floor to
           avoid z-fighting */
        var newPosition = placementPose.position;
        newPosition.y += 0.001f;
        transform.SetPositionAndRotation(newPosition,
            placementPose.rotation);
    }
}</pre></li>
				<li>Save the script and <a id="_idIndexMarker957"/>export the game again. As you can see, now the quad is placed cleanly above the given surface:</li>
			</ol>
			<div><div><img src="img/B18868_15_14.jpg" alt="Figure 15.14 – Adjusted Placement Indicator"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.14 – Adjusted Placement Indicator</p>
			<p>Now that we have an <a id="_idIndexMarker958"/>indicator of sorts, let’s make it so we can actuall<a id="_idTextAnchor476"/>y spa<a id="_idTextAnchor477"/>wn an object in AR.</p>
			<h1 id="_idParaDest-163"><a id="_idTextAnchor478"/>Spawning objects in AR</h1>
			<p>The simplest way <a id="_idIndexMarker959"/>to spawn an object in AR would be to make it so that when <a id="_idIndexMarker960"/>the player taps on the screen, it will spawn an object where our <strong class="bold">Placement Indicator</strong> object is. But before we do that, we first need to make an object that we’d want to cre<a id="_idTextAnchor479"/>ate within the scene.</p>
			<p>Follow the steps given here:</p>
			<ol>
				<li>Create a sphere by going to <strong class="bold">GameObject</strong> | <strong class="bold">3D Object</strong> | <strong class="bold">Sphere</strong>.</li>
				<li>From the <code>(0,0,0)</code> and set <code>(0.2,0.2,0.2)</code>.</li>
				<li>Add a <strong class="bold">Rigidbody</strong> component to the sphere by going to <strong class="bold">Component</strong> | <strong class="bold">Physics</strong> | <strong class="bold">Rigidbody</strong>.</li>
			</ol>
			<p>By adding the <strong class="bold">Rigidbody</strong> component, we are letting Unity know that we want this object to be <a id="_idIndexMarker961"/>affected by things such as gravity and react to <a id="_idIndexMarker962"/>collision events and forces being applied to it. At this point, you could customize the object as much as you’d like, change the mesh and collider, and so on.</p>
			<ol>
				<li value="4">Go to the <code>Prefabs</code> folder. Create a Prefab of our sphere by dragging and dropping it from the <strong class="bold">Hierarchy</strong> window to the <strong class="bold">Project</strong> window:</li>
			</ol>
			<div><div><img src="img/B18868_15_15.jpg" alt="Figure 15.15 – Creatin﻿g a 3D object to spawn"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.15 – Creatin<a id="_idTextAnchor480"/>g a 3D object to spawn</p>
			<ol>
				<li value="5">Now that the object is a Prefab, we can delete it from the <strong class="bold">Hierarchy</strong> window.</li>
				<li>Open the <code>PlaceARObject</code> script <a id="_idIndexMarker963"/>and add the following property to it:<pre class="source-code">
[Tooltip("The object to spawn when the screen is tapped")] public GameObject objectToSpawn;</pre></li>
				<li>Then, update <a id="_idIndexMarker964"/>the <code>LateUpdate</code> function to the following:<pre class="source-code">
    /// &lt;summary&gt;
    /// LateUpdate is called once per frame after all
    /// Update functions have been called
    /// &lt;/summary&gt;
    private void LateUpdate()
    {
        /* Figure out where the center of the screen
           is */
        var viewportCenter = new Vector2(0.5f, 0.5f);
        var screenCenter =
            arCamera.ViewportToScreenPoint(
                viewportCenter);
        /* Check if there is something in front of the
           center of the screen and update the
           placement indicator if needed */
        UpdateIndicator(screenCenter);
<strong class="bold">        /* If we tap on the screen, spawn an object */</strong>
<strong class="bold">        if (Input.GetMouseButtonDown(0))</strong>
<strong class="bold">        {</strong>
<strong class="bold">            /* Spawn the object above the floor to see</strong>
<strong class="bold">               it fall */</strong>
<strong class="bold">            Vector3 objPos = transform.position +</strong>
<strong class="bold">                </strong><strong class="bold">Vector3.up;</strong>
<strong class="bold">            if (objectToSpawn)</strong>
<strong class="bold">            {</strong>
<strong class="bold">                Instantiate(objectToSpawn, objPos,</strong>
<strong class="bold">                    transform.rotation);</strong>
<strong class="bold">            }</strong>
<strong class="bold">        }</strong>
    }</pre></li>
				<li>Save the <a id="_idIndexMarker965"/>script and return <a id="_idIndexMarker966"/>to the Unity Editor.</li>
				<li>From the <strong class="bold">Hierarchy</strong> window, select the <strong class="bold">Placement Indicator</strong> object. From the <strong class="bold">Inspector</strong> window, set the <strong class="bold">Object To Spawn</strong> property to our <strong class="bold">Sphere </strong>Prefab:</li>
			</ol>
			<div><div><img src="img/B18868_15_16.jpg" alt="Figure 15.16 – Se﻿tting the object to spawn"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.16 – Se<a id="_idTextAnchor481"/>tting the object to spawn</p>
			<ol>
				<li value="10">Save your <a id="_idIndexMarker967"/>project and build it to your device, and tap the <a id="_idIndexMarker968"/>screen to have spheres spawn onto the screen:</li>
			</ol>
			<div><div><img src="img/B18868_15_17.jpg" alt="Figure 15.17 – Objects spawning in our AR environment"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.17 – Objects spawning in our AR environment</p>
			<p>As you can see, we <a id="_idIndexMarker969"/>can now spawn objects into our scene, and we can see <a id="_idIndexMarker970"/>them interact with each other correctly! Taking this further, you can cre<a id="_idTextAnchor482"/>ate whatever type of gam<a id="_idTextAnchor483"/>eplay experience you’d like!</p>
			<h1 id="_idParaDest-164"><a id="_idTextAnchor484"/>Summary</h1>
			<p>Throughout this chapter, you have learned how to utilize Unity’s AR toolsets to augment reality by adding artificial computer-generated objects into the real world. This new and growing technology is still being developed, and the skills gained from working in it will likely grow in importance in the future as things such as <strong class="bold">Virtual Reality</strong> (<strong class="bold">VR</strong>), <strong class="bold">Mixed Reality</strong> (<strong class="bold">MR</strong>), and other forms of <strong class="bold">Extended Reality</strong> (<strong class="bold">XR</strong>) become more and more commonplace.</p>
			<p>In this chapter, you learned how to install ARKit for iOS, ARCore for Android, and AR Foundation for a multiplatform AR solution. Once installed, you learned how to set the platform settings for both iOS and Android AR development. Afterward, we did the basic setup to have Unity use its AR tools to allow users to add a simple mesh to the environment. We then built upon that to detect surfaces within the real world using the AR Plane Manager and learned how to visualize it by using the AR Default Plane object. We then learned how to interact with the AR environment using the AR Raycast Manager to detect when we hit the meshes within the real world and have objects in the computer- generated world react to it. Finally, we saw how to spawn objects in AR using this information.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">In addition to AR Foundation, ARCore, and ARKit, there are several other frameworks and plugins available for adding AR to Unity apps.</p>
			<p class="callout">If your project requires specific functionalities beyond what Unity provides, alternative frameworks can offer the necessary tools or better support and performance for your specific use case. For example, Vuforia (<a href="https://www.ptc.com/en/products/vuforia">https://www.ptc.com/en/products/vuforia</a>) is known for its robust marker-based tracking, while Wikitude (<a href="https://www.wikitude.com/download-wikitude-sdk-for-unity/">https://www.wikitude.com/download-wikitude-sdk-for-unity/</a>) specializes in location-based AR experiences.</p>
			<p class="callout">Ultimately, the choice of AR framework depends on factors such as platform support, required features, developer expertise, and project-specific needs. It’s essential to evaluate the strengths and limitations of each framework to select the one that best aligns with your goals and requirements.</p>
			<p>This should give you all of the information you need to start experimenting on your own and see whether you can create your own games for both mobile devices and games within an AR environment. So, go forth and use the knowledge from this book to make your games the best they can be and I look forward to playing them!</p>
		</div>
	</body></html>