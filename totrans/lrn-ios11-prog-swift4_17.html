<html><head></head><body>
      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Working with an API</h1>
            
         </header>
         
         
         <article>
            
            
            <p>When building iOS apps, data can be the most critical part. Typically, the apps you
               make require getting data from an online data source, known as an <strong>Application Programming Interface</strong> (<strong>API</strong>). In the previous chapters, we have only worked with a plist to supply our data.
               Using a plist bridges the gap to understanding how to work with an API, as you will
               see shortly. In this chapter, we will work with an API that is in <strong>JavaScript Object Notation</strong> (<strong>JSON</strong>) format. This format is typical no matter which backend service was used to create
               the JSON. In this chapter, we will cover:
            </p>
            
            <ul>
               
               <li>What a JSON file is and the different components of this data feed</li>
               
               <li>Passing data using segues</li>
               
               <li>What extensions are and how to use them to clean up your code</li>
               
            </ul>
            
            <p class="mce-root">For our app, we need one class to handle our data, but we need to share it with both
               our Explore View Controller and Map View Controller. Let's first understand the responsibility
               of our API Manager.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Creating an API Manager</h1>
            
         </header>
         
         
         <article>
            
            
            <p>In this chapter, we will be building an API Manager. This manager will be responsible
               for anything that has to do with getting data from online. When dealing with data
               online, you will typically get it in a particular format, which you then need to convert
               into something that your app can read.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">What is an API?</h1>
            
         </header>
         
         
         <article>
            
            
            <p>A RESTful API is a web service from which an app can receive data. Typically, when
               you are dealing with APIs, such as YELP, they tend to change often. For our purposes,
               we want to use static files so that we can work on this project without having to
               be concerned about changes to the API. Therefore, most of the data we are going to
               use comes from the site, <a href="http://opentable.herokuapp.com/">http://opentable.herokuapp.com/</a>, which is not managed full time and does not change often. The site's API, however,
               is missing some data that we need; therefore, I have updated these files (which are
               in the project files for this chapter) to include that missing data.
            </p>
            
            <p>APIs are typically in JSON format, and working with them is similar to working with
               plists. The transition from one to the other should be pretty seamless. Let's get
               familiar with the JSON format.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Understanding a JSON file</h1>
            
         </header>
         
         
         <article>
            
            
            <p>Before we write any code, we need to take a look at the structure of a simple JSON
               file. Let's create a new group inside the <kbd>Misc</kbd> folder in the <kbd>Navigator</kbd> panel called <kbd>JSON</kbd>. Then, drag and drop all of the JSON files found in the project files for this chapter
               into the new <kbd>JSON</kbd> folder, by clicking on <span class="packt_screen">Finish</span> in the screen that appears. Lastly, open up the <kbd>Charleston.json</kbd> file and let's review the first part of it, including the first restaurant listing:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="359" src="assets/1ba669d0-d3d2-4e86-8fbd-d9391b2b6b78.png" width="583"/></div>
            
            <p>This file has four nodes inside it, <kbd>total_entries</kbd>, <kbd>per_page</kbd>, <kbd>current_page</kbd>, and <kbd>restaurants</kbd>. When you work with a feed, it will split items up into pages so that you are not
               trying to load all the data at once. This feed tells us that there are 67 total pages
               with 25 restaurants per page and that we are currently on page one. We do not need
               the first three nodes in this book since we are just going to load 25 restaurants.
            </p>
            
            <p>The <kbd>restaurant</kbd>'s  node, on the other hand, is essential for the purposes of this book. The restaurant's
               node is an array of data, recognizable as such by the brackets (<kbd>[ ]</kbd>) used in the node. If you review the individual items in the restaurant's node, you
               will notice that everything needed for our app's name, address, city, and so on, is
               covered. This structure is the same as that which we saw in the plists earlier in
               this book. If you look at cuisines, you will notice that it is wrapped inside brackets
               (<kbd>[ ]</kbd>). Again, this is what we had in our plist data previously. We have an idea of what
               a JSON file looks like; let's see how we can work with it.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Exploring the API Manager file</h1>
            
         </header>
         
         
         <article>
            
            
            <p>We just created our <kbd>API Manager</kbd> folder; now, let's create the <kbd>API Manager</kbd> file:
            </p>
            
            <ol>
               
               <li>Right-click on the <kbd>Misc</kbd> folder in the <kbd>Common</kbd> folder of the Navigator panel and select <span class="packt_screen">New File</span>.
               </li>
               
               <li>Inside the <span class="packt_screen">Choose a template for your new file</span> screen, select <span class="packt_screen">iOS</span> at the top. Then, select <span class="packt_screen">Swift File</span>. Hit <span class="packt_screen">Next</span> after.
               </li>
               
               <li>Name this file <kbd>RestaurantAPIManager</kbd>, and hit <span class="packt_screen">Create</span>.
               </li>
               
            </ol>
            
            <p>We need to define our class definition first; therefore, add the following to the
               <kbd>import</kbd> statement:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/64fe9f01-76ea-4d0b-9eff-8dcecb4ec560.png"/></div>
            
            <ul>
               
               <li><span><strong>Part A</strong>: Here, we defined the class.</span></li>
               
            </ul>
            <pre style="padding-left: 60px">struct RestaurantAPIManager {</pre>
            <ul>
               
               <li><strong>Part B</strong>: <span>The <kbd>loadJSON()</kbd> method is known as a type method because it has the <kbd>static</kbd> keyword in front of it. Type methods are called using the dot syntax. Static functions
                     cannot be overridden. </span></li>
               
            </ul>
            <pre style="padding-left: 60px">static func loadJSON(file name:String) -&gt; [[String:AnyObject]] {</pre>
            <p style="padding-left: 60px">The next bullet list explains what we need to write when we want to call the <kbd>loadJSON</kbd> method inside the <kbd>RestaurantAPIManager</kbd> file.
            </p>
            
            <ul>
               
               <li><strong>Part C</strong>: Calling this method will return an array of dictionary objects. If this sounds familiar,
                  it is because our plist data returns the same thing.
               </li>
               
            </ul>
            <pre style="padding-left: 60px">var items = [[String: AnyObject]]()</pre>
            <ul>
               
               <li><strong>Part D</strong>: <span>On this line, we are declaring an array of dictionary objects.</span></li>
               
            </ul>
            <pre style="padding-left: 60px">guard let path = Bundle.main.path(forResource: name, ofType: "json"), let data = NSData(contentsOfFile: path) else {<br/>   return [[:]]<br/>}</pre>
            <ul>
               
               <li><strong>Part E</strong>: Since we are not loading from the internet, we need to make sure to call the right
                  filename. If the path is found and there is nothing wrong with the data, we will use
                  the data. Otherwise, we will return an empty array with no dictionary objects.
               </li>
               
            </ul>
            
            <p style="padding-left: 60px">Here, we are using a <kbd>do...catch</kbd>. To employ it, we must utilize it with what is known as a try. We first try to serialize
               or convert the data from the JSON file;  if that is successful, we can then access
               the information inside that file. To obtain the restaurant items in the JSON file
               (all of which are located inside the restaurant's node), we used <kbd>json["restaurants"]</kbd>.
            </p>
            
            <p style="padding-left: 60px">Next, we cast this using the <kbd>as?</kbd> as an array of dictionary objects. Also, since our data types are mixed, we used
               <kbd>AnyObject</kbd> to accept the dictionary of mixed data types. Finally, we set our data to the array
               of items. We now have the same structure, an array of dictionary objects that we had
               in the <kbd>Map</kbd> section.
            </p>
            <pre style="padding-left: 60px">do {<br/>let json = try JSONSerialization.jsonObject(with: data as Data, options: .allowFragments) as AnyObject<br/>if let restaurants = json["restaurants"] as? [[String: AnyObject]] {<br/>      items = restaurants as [[String : AnyObject]]<br/>  }<br/>}</pre>
            <ul>
               
               <li><strong>Part F</strong>: This <kbd>catch</kbd> will run only if there is a problem serializing the data from the file. If there
                  is a problem, we will return an empty array with no dictionary objects. This allows
                  for our app to keep running without crashing.
               </li>
               
            </ul>
            <pre style="padding-left: 60px">catch {<br/>  print("error serializing JSON: \(error)")<br/>  items = [[:]]<br/>}</pre>
            <ul>
               
               <li><strong>Part G</strong>: Finally, if all goes well, we return the array of dictionary items back. 
               </li>
               
            </ul>
            <pre style="padding-left: 60px">return items</pre>
            <p> </p>
            
            <p>This entire class is built so that we can pass any name we want; it will return data
               if it finds the file.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Location list</h1>
            
         </header>
         
         
         <article>
            
            
            <p>Let's review how our app will work. A user will select a cuisine and location. Then,
               the location is passed to the Explore view. The user will get restaurants from the
               selected location filtered by the selected cuisine.
            </p>
            
            <p>If this were online, we would pass the location to the API, and the API would return
               the JSON data. As you can see, we are doing the same. When you eventually deal with
               an API, the transition of working with online data will be seamless.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Selecting a location</h1>
            
         </header>
         
         
         <article>
            
            
            <p>Therefore, as stated earlier, to get data, we need a location. To get the location,
               we need to get it from the <kbd>LocationViewController</kbd>. When a location is selected, we will show a checkmark. We will need this checkmark
               to update each time a new item is set. Finally, when the <span class="packt_screen">Done</span> button is tapped, we need to pass this location to <kbd>ExploreViewController</kbd>.
            </p>
            
            <p>Let's update our <kbd>LocationViewController</kbd> first. We need a variable to keep track of the selected location. Add the following
               inside the <kbd>LocationViewController.swift</kbd> file, under the constant manager:
            </p>
            <pre>var selectedCity:String?</pre>
            <p>Then, we need to create a new extension for <kbd>UITableViewDelegate</kbd>, as follows. Add the following after our <kbd>UITableViewDataSource</kbd> extension:
            </p>
            <pre>//MARK: UITableViewDelegate<br/>extension LocationViewController: UITableViewDelegate {<br/>}</pre>
            <p>As we discussed earlier in the book, delegates supply the behavior. Here, we want
               a behavior for when the user selects a Table View row and another behavior for when
               the user deselects the row. First, let's add the selection behavior into our new extension
               by adding the following code:
            </p>
            <pre>func tableView(_ tableView: UITableView, didSelectRowAt indexPath:IndexPath) {<br/>   if let cell = tableView.cellForRow(at: indexPath) {<br/>          cell.accessoryType = .checkmark<br/>          selectedCity = manager.locationItem(at:indexPath)<br/>          tableView.reloadData()<br/>   }<br/>}</pre>
            <p>Here, we will get the cell of the selected row and set its <kbd>accessoryType</kbd> to a <kbd>checkmark</kbd>. Then, we will get the location and set it to the <kbd>selectedCity</kbd> variable. To only see the <kbd>checkmark</kbd> in our Table View cell, we need to remove the disclosure arrow and gray cell selection.
               Let's update this by doing the following:
            </p>
            
            <ol>
               
               <li>Open <kbd>Explore.storyboard</kbd>.
               </li>
               
               <li>Select the Table View <kbd>locationCell</kbd> in the <span class="packt_screen">Location View Controller</span>.
               </li>
               
               <li>Select the Attributes inspector in the Utilities panel, and update the <span class="packt_screen">Selection</span> field from <span class="packt_screen">Gray</span> to <span class="packt_screen">None</span>.
               </li>
               
               <li>Next, update the <span class="packt_screen">Accessory</span> field from <span class="packt_screen">Disclosure Indicator</span> to <span class="packt_screen">None</span>.
               </li>
               
            </ol>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Adding a Header view</h1>
            
         </header>
         
         
         <article>
            
            
            <p>Our <span class="packt_screen">Explore</span> has a header, and we need to pass data over to it. To do that, we need to create
               a header class for it: 
            </p>
            
            <ol>
               
               <li>Right-click on the <span class="packt_screen">Explore</span> folder and select <span class="packt_screen">New File</span>.
               </li>
               
               <li>Inside the <span class="packt_screen">Choose a template for your new file</span> screen, select <span class="packt_screen">iOS</span> at the top. Then, select <span class="packt_screen">Cocoa Touch Class</span>. Hit <span class="packt_screen">Next</span> after.
               </li>
               
               <li>In the options screen that appears, add the following:</li>
               
            </ol>
            
            <p style="padding-left: 30px">        New file:</p>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">Class</span>: <kbd>ExploreHeaderView</kbd></li>
                     
                     <li><span class="packt_screen">Subclass</span>: <kbd>UICollectionReusableView</kbd></li>
                     
                     <li><span class="packt_screen">Also create XIB</span>: Unchecked
                     </li>
                     
                     <li><span class="packt_screen">Language</span>: <kbd>Swift</kbd></li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="4">
               
               <li>Click <span class="packt_screen">Next</span> and then <span class="packt_screen">Create</span>.
               </li>
               
               <li>Add the following to this file:</li>
               
            </ol>
            <pre style="padding-left: 60px">import UIKit<br/>class ExploreHeaderView: UICollectionReusableView {<br/>    @IBOutlet weak var lblLocation:UILabel!<br/>}</pre>
            <ol start="6">
               
               <li>Next, open the <kbd>Explore.storyboard</kbd> file and under the Identity inspector in the Utilities panel, update the <span class="packt_screen">Class</span> to <kbd>ExploreHeaderView</kbd>.
               </li>
               
            </ol>
            
            <p>Now, let's work on passing data from a location to explore and display the selected
               location in our header.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Passing a selected location back to Explore View</h1>
            
         </header>
         
         
         <article>
            
            
            <p>Now, we need to be able to send the selected city back to our <kbd>ExploreViewController</kbd>. Therefore, we need a selected city, as well as an unwind for the <span class="packt_screen">Done</span> button inside <kbd>ExploreViewController</kbd>. First, let's get our selected city to display in our <span class="packt_screen">Explore</span> view:
            </p>
            
            <ol>
               
               <li>Add the following variable under the constant manager in our <kbd>ExploreViewController.swift</kbd> file:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">var selectedCity:String?<br/>var headerView: ExploreHeaderView!</pre>
            <ol start="2">
               
               <li>Next, open <kbd>Explore.storyboard</kbd> and select the <span class="packt_screen">Explore Header View</span> in the Outline view.               
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/8c228ae7-e49a-440b-adbb-c6788dcd9d86.png"/></div>
            
            <ol start="3">
               
               <li>Then, select the Connections inspector in the Utilities panel, and click and drag
                  from the empty circle <kbd>lblLocation</kbd> under Outlets to the label in the <span class="packt_screen">Explore View Controller Header</span> scene:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="200" src="assets/08226f33-93c5-4bbd-a825-33e80c63d0df.png" width="563"/></div>
            
            <ol start="4">
               
               <li>While we are here, let's also update this label to say, <kbd>PLEASE SELECT A LOCATION</kbd>, and the label below it to say <kbd>EXPLORE</kbd>:
               </li>
               
            </ol>
            
            <div class="mce-root CDPAlignCenter CDPAlign"><img height="334" src="assets/e3a1a8ad-6850-4b0e-8c9c-d032c2388213.png" width="188"/></div>
            
            <p>Next, let's unwind our <span class="packt_screen">Done</span> button in our <span class="packt_screen">Explore View Controller</span>.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Unwinding our Done button</h1>
            
         </header>
         
         
         <article>
            
            
            <p>Earlier in the book, we added an unwind for our <span class="packt_screen">Cancel</span> button. Now we need to make it so that our <span class="packt_screen">Done</span> button can also dismiss the modal, but we also want to capture the selected location
               when the user is done. Let's add this code next:
            </p>
            
            <ol>
               
               <li>Open the <kbd>ExploreViewController.swift</kbd> file again and, in the <kbd>private</kbd> extension under the <kbd>unwindLocationCancel()</kbd> function, add the following code:
               </li>
               
            </ol>
            
            <p> </p>
            <pre style="padding-left: 60px">@IBAction func unwindLocationDone(segue:UIStoryboardSegue) {<br/>    if let viewController = segue.source as? LocationViewController {<br/>        selectedCity = viewController.selectedCity<br/>        if let location = selectedCity {<br/>            headerView.lblLocation.text = location<br/>        }<br/>    }<br/>}</pre>
            <p style="padding-left: 60px">The code we just added is checking the source of the segue. If its source is a class
               of <kbd>LocationViewController</kbd>, then we want to grab the selected city and set the <kbd>selectedCity</kbd> variable inside <kbd>ExploreViewController</kbd> to that city. We then use an <kbd>if...let</kbd> statement to make sure that <kbd>selectedCity</kbd> is not <kbd>nil</kbd>; if it is not, then we set the label in the header to the currently selected city.
               Now, we need to hook up this <kbd>IBAction</kbd>.
            </p>
            
            <ol start="2">
               
               <li>In your <kbd>UICollectionViewDataSource</kbd> extension, update <kbd>collectionView:viewForSupplementaryElementOfKind:atIndexPath:</kbd> with the following:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">func collectionView(_ collectionView: UICollectionView, viewForSupplementaryElementOfKind kind: String, at indexPath: IndexPath) -&gt; UICollectionReusableView {<br/>    let header = collectionView.dequeueReusableSupplementaryView(ofKind: kind, withReuseIdentifier: "header", for: indexPath)<br/>    headerView = header as! LocationHeaderView<br/>    return headerView<br/>}</pre>
            <ol start="3">
               
               <li>Next, open <kbd>Locations.storyboard</kbd>.
               </li>
               
               <li>Now, <em>Ctrl</em> + drag from the <span class="packt_screen">Done</span> button in the <span class="packt_screen">Location View Controller</span> to <span class="packt_screen">Exit</span> in the <span class="packt_screen">Location View Controller</span> scene:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="432" src="assets/31b6309a-a35c-440f-b72b-d3dd331e0951.png" width="233"/></div>
            
            <ol start="5">
               
               <li>When you let go, select <kbd>unwindLocationDoneWithSegue:</kbd> in the menu that appears:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="72" src="assets/2b80d297-c248-464f-921f-7ee0c78c2ebe.png" width="281"/></div>
            
            <p>Let's build and run the project by hitting the Play button (or use <em>cmd</em> + <em>R</em>). You should now be able to select a location; when you hit <span class="packt_screen">Done</span>, the Explore Header view should show you the selected location:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="475" src="assets/dae8d5d2-b75e-452c-97c6-bcfb96100e9c.jpg" width="271"/></div>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Getting the last selected location</h1>
            
         </header>
         
         
         <article>
            
            
            <p>We have a couple of issues that we need to correct under <span class="packt_screen">Select a location</span>. You will notice that when you click on <span class="packt_screen">Select a location</span>, you can check multiple locations. We only want the user to be able to select one
               location. Also, the checkmark next to your selected location disappears if you click
               on <span class="packt_screen">Done</span> in <span class="packt_screen">Location View</span> and then click to choose a location again. We need to set the last selected location
               so that it is saved when you go back to your location list. We can address these issues
               at the same time:
            </p>
            
            <ol>
               
               <li>Open <kbd>Explore.storyboard</kbd>:
               </li>
               
               <li>Select the segue that is connected to the <kbd>LocationViewController</kbd>.
               </li>
               
               <li>Then, select the Attributes inspector in the Utilities panel and set <span class="packt_screen">Identifier</span> under <span class="packt_screen">Storyboard Segue</span> to <span class="packt_screen">locationList</span>. Then, hit <em>Enter</em>:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="422" src="assets/f077eeee-f935-4add-935c-5765f42e9f34.png" width="569"/></div>
            
            <ol start="4">
               
               <li>Now, select the segue that is connected to the <kbd>RestaurantViewController</kbd> and set <span class="packt_screen">Identifier</span> to <kbd>restaurantList</kbd>. Then, hit <em>Enter</em>:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="562" src="assets/be2106b9-5c44-4fdd-8c80-428fd97e7c68.png" width="651"/></div>
            
            <ol start="5">
               
               <li>Next, we need to set up these identifiers. We are going to update the segue enum,
                  which we created in the last chapter. Add the following code inside the <kbd>Segue.swift</kbd> file under the <kbd>Misc</kbd> folder in the <kbd>Common</kbd> folder:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">case restaurantList<br/>case locationList</pre>
            <ol start="6">
               
               <li>Then, open up the <kbd>LocationDataManager.swift</kbd> file and add the following code before the last curly brace:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">func findLocation(by name:String) -&gt; (isFound:Bool, position:Int) {<br/>                guard let index = arrLocations.index(of: name) else <br/>                { return (isFound:false, position:0) }<br/>                return (isFound:true, position:index)<br/>}</pre>
            <ol start="7">
               
               <li>This method will allow us to find the location, and then obtain its index position
                  within the array. We will return a tuple, which is a compound type in Swift, meaning
                  that it can hold multiple values. Tuples allow you to combine different data types
                  into one. The method will check the tuple to see whether or not we found the data.
                  If we found the data, then we will use the index position; if not, we will not do
                  anything.
               </li>
               
               <li>Next, we need to check whether or not a previous location was set. Open up the <kbd>LocationViewController.swift</kbd> file and create the following method after the <kbd>viewDidLoad()</kbd> method:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="173" src="assets/aa97e540-b16b-4448-84e6-a90d5dba8094.png" width="468"/></div>
            
            <p>Let's break this method down:</p>
            
            <ul>
               
               <li><strong>Part A</strong>: <span>In the parameters of this method, we are taking in a cell and an index path:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">set(cell:at)<br/>if let city = selectedCity</pre>
            <ul>
               
               <li><strong>Part B</strong>: <span>Here, we are checking to make sure that the selected city is set.</span></li>
               
            </ul>
            <pre style="padding-left: 60px">let data = manager.findLocation(by: city)</pre>
            <ul>
               
               <li><strong>Part C</strong>: <span>Then, we are calling the method we created in <kbd>LocationDataManager</kbd>, passing the selected city into the manager, and getting back a tuple of data.</span></li>
               
            </ul>
            <pre style="padding-left: 60px">if data.isFound {<br/>   if indexPath.row == data.position {<br/>          cell.accessoryType = .checkmark<br/>   }<br/>   else { cell.accessoryType = .none }<br/>}</pre>
            <ul>
               
               <li><strong>Part D</strong>: <span>Next, we are checking to see if data was found in the tuple; if so, we are checking
                     to see if the selected row is the same as the position in the array. If the row and
                     position are the same, we are directing the cell to set its accessoryType to a checkmark;
                     otherwise, the accessoryType will be set to none.</span></li>
               
            </ul>
            <pre style="padding-left: 60px">else { cell.accessoryType = .none }</pre>
            <ul>
               
               <li><strong>Part E</strong>: Finally, if no data is found, we are setting <kbd>accessoryType</kbd> to none. Add the following inside <kbd>cellForRowAt()</kbd> after we set the text for the cell:
               </li>
               
            </ul>
            <pre style="padding-left: 60px">set(selected: cell, at: indexPath)</pre>
            <p>Build and run the project by hitting the Play button (or use <em>cmd</em> + <em>R</em>). You should see that you can only select one location now. However, after you select
               the location, if you click on <span class="packt_screen">Done</span> in the <span class="packt_screen">Location</span> view and then click to show locations again, your last selected location is not saved.
               We still need to address that issue, which we will do next.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Passing location and cuisine to the restaurant list</h1>
            
         </header>
         
         
         <article>
            
            
            <p>Open the <kbd>ExploreViewController.swift</kbd> file, and inside the <kbd>private</kbd> extension add the following method above the <kbd>unwindLocationCancel()</kbd> method:
            </p>
            <pre>func showLocationList(segue:UIStoryboardSegue) {<br/>   guard let navController = segue.destination as? UINavigationController,<br/>          let viewController = navController.topViewController as? LocationViewController else {<br/>                 return<br/>   }</pre>
            <pre>   guard let city = selectedCity else { return }<br/>   viewController.selectedCity = city<br/>} </pre>
            <p>Our <kbd>showLocationList()</kbd> method will be called whenever our destination view has a Navigation Controller.
               Then, it checks to see if the <kbd>topViewController</kbd> is of the class <kbd>LocationViewController</kbd>. If either of these two statements is <kbd>false</kbd>, we do nothing. If both are <kbd>true</kbd>, we check the <kbd>selectedCity;</kbd>. If it is <kbd>nil</kbd>, then we also do nothing. If the <kbd>selectedCity</kbd> has a location, we set the <kbd>selectedCity</kbd> variable inside the <kbd>LocationViewController</kbd> to the <kbd>selectedCity</kbd> in the <kbd>ExploreViewController</kbd>. This will save the last selected location if we return to the locations list after
               having selected a location earlier.
            </p>
            
            <p>We also need to pass the selected city over to the <kbd>RestaurantViewController</kbd>. Therefore, add the following variables inside the <kbd>RestaurantViewController.swift</kbd> file above your <kbd>@IBOutlet var collectionView</kbd>:
            </p>
            <pre>var selectedRestaurant:RestaurantItem?<br/>var selectedCity:LocationItem?<br/>var selectedType:String? </pre>
            <p>While still in the <kbd>RestaurantViewController.swift</kbd> file, add the following code under the <kbd>viewDidLoad()</kbd> method:
            </p>
            <pre>override func viewDidAppear(_ animated: Bool) {<br/>  super.viewDidAppear(animated)<br/>  print("selected city \(selectedCity as Any)")<br/>  print("selected type \(selectedType as Any)")<br/>} </pre>
            <p>The <kbd>viewDidAppear()</kbd> method will get called every time we load the View Controller, whereas the <kbd>viewDidLoad()</kbd> method only gets called once. We can print the <kbd>selectedCity</kbd> variable to verify that we are, in fact, passing the location over correctly.
            </p>
            
            <p>Next, open the <kbd>ExploreViewController.swift</kbd> file again and add the following under the <kbd>showLocationList()</kbd> method inside :
            </p>
            <pre>func showRestaurantListing(segue:UIStoryboardSegue) {<br/>   if let viewController = segue.destination as? RestaurantViewController, let city = selectedCity,<br/>          let index = collectionView.indexPathsForSelectedItems?.first, let type = manager.explore(at: index).name {<br/>          viewController.selectedType = type<br/>          viewController.selectedCity = city<br/>   }<br/>} </pre>
            <p>We now check to see if the segue destination is <kbd>RestaurantViewController</kbd>, and we make sure that <kbd>selectedCity</kbd> is set in <kbd>ExploreViewController</kbd>. Next, we get the selected <kbd>indexPath</kbd> of the Collection view. Once we have that, we then get the item from the <kbd>ExploreDataManager</kbd> at the <kbd>index</kbd> position. Finally, we get the name from the item. If we get all those items back,
               then we pass the <kbd>selectedCity</kbd> and <kbd>selectedType</kbd> variables to the <kbd>RestaurantViewController</kbd>. If we do not, then we will display an alert, letting the user know that they need
               to select a location first. Let's create the three methods that will display such
               an alert:
            </p>
            
            <ol>
               
               <li>First, we will create the actual alert. While still in the <kbd>ExploreViewController</kbd>, add the following code before <kbd>unwindLocationCancel()</kbd>:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">func showAlert() {<br/>                let alertController = UIAlertController(title: "Location Needed", message:"Please select a location.", preferredStyle: .alert)<br/>                let okAction = UIAlertAction(title: "OK", style: .default, handler: nil)<br/>                alertController.addAction(okAction)<br/>                present(alertController, animated: true, completion: nil)<br/>} </pre>
            <ol start="2">
               
               <li>Then, we need to check that we have a location; if not, we want to make sure that
                  the user cannot go to the restaurant list. Inside the <kbd>ExploreViewController</kbd>, add the following method after the <kbd>viewDidLoad()</kbd> method:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">override func shouldPerformSegue(withIdentifier identifier: String, sender: Any?) -&gt; Bool {<br/>    if identifier == Segue.restaurantList.rawValue {<br/>        guard selectedCity != nil else {<br/>            showAlert()<br/>            return false<br/>        }<br/>        return true<br/>    }<br/>    return true<br/>} </pre>
            <p style="padding-left: 60px">Here, we check whether the segue equals <kbd>restaurantList;</kbd>. If it does, we check to see if the <kbd>selectedCity</kbd> variable is set. If we return <kbd>true</kbd>, then the segue will be performed, and we will go to the restaurant list. If we return
               <kbd>false</kbd>, then we display our alert, letting the users know that they need to select a location
               first.
            </p>
            
            <ol start="3">
               
               <li>Lastly, we need to show either the location list or restaurant list, depending on
                  whether or not the user chose a location before trying to see the restaurant list.
                  Add the following method after <kbd>viewDidLoad()</kbd>, and before the <kbd>shouldPerformSegue</kbd> method we just added:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">override func prepare(for segue: UIStoryboardSegue, sender: Any?){<br/>    switch segue.identifier! {<br/>        case Segue.locationList.rawValue:<br/>            showLocationList(segue: segue)<br/>        case Segue.restaurantList.rawValue:<br/>            showRestaurantListing(segue: segue)<br/>        default:<br/>        print("Segue not added")<br/>    }<br/>}</pre>
            <p>The <kbd>prepare()</kbd> method checks which identifier is called. If it is the location list, then we call
               the <kbd>showLocationList()</kbd> method; if it is the restaurant list, then we call the <kbd>showRestaurantListing()</kbd> method.
            </p>
            
            <p>Now, build and run the project by hitting the Play button (or use <em>cmd</em> + <em>R</em>). If you try to select a cuisine first, you should not be able to go to the restaurant
               list. Instead, you should receive an alert, stating that you need to select a location:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="137" src="assets/5e9970d4-1084-4194-bf57-fdfa4b84ee4f.png" width="286"/></div>
            
            <p>If you pick a location, hit <span class="packt_screen">Done</span>, and then tap the locations list again, you should see your location still selected.
               Now, if you select a cuisine, you should be directed to the restaurant listing and
               see the selected location printing in the Debug panel. If you do not see that panel,
               you can open it using the toggle or <em>cmd</em> + <em>Shift</em> + <em>Y</em> .
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/77999151-869f-4e1e-9627-fc12eefdf1f0.png"/></div>
            
            <p>Now that we have the location, we need to check our <kbd>RestaurantAPIManager</kbd> for data. Therefore, let's update our <kbd>print</kbd> statement inside the <kbd>RestaurantViewController</kbd> by revising the <kbd>viewDidAppear()</kbd> method to the following:
            </p>
            <pre>override func viewDidAppear(_ animated: Bool) {<br/>   guard let location = selectedCity?.city, let type = selectedType else {<br/>          return<br/>   }<br/><br/>   print("type \(type)")<br/>   print(RestaurantAPIManager.loadJSON(file: location))<br/>}</pre>
            <p>You should now see the type selected, along with an array of dictionary objects, in
               the Debug panel:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/94899a3b-6f88-480a-9073-383601230f9a.png"/></div>
            
            <p>Now that we have our data, let's get that data to display in our <kbd>RestaurantViewController</kbd>. To do this, we need to set up our cell as well as a restaurant data manager. The
               restaurant data manager, rather than the <kbd>RestaurantViewController</kbd>, will be the class that uses our <kbd>RestaurantAPIManager</kbd>.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Creating our restaurant cell class</h1>
            
         </header>
         
         
         <article>
            
            
            <p>Now, we need to create a file so that we can connect to the cell:</p>
            
            <ol>
               
               <li>Inside the <kbd>Restaurants</kbd> folder in the Navigator panel, right-click on the <kbd>View</kbd> folder and select <span class="packt_screen">New File</span>.
               </li>
               
               <li>Inside the <span class="packt_screen">Choose a template for your new file</span> screen, select <span class="packt_screen">iOS</span> at the top and then <span class="packt_screen">Cocoa Touch Class</span>. Then, hit <span class="packt_screen">Next</span>.
               </li>
               
            </ol>
            
            <p> </p>
            
            <ol start="3">
               
               <li>In the options screen that appears, add the following:</li>
               
            </ol>
            
            <p style="padding-left: 60px">New file:</p>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">Class</span>: <kbd>RestaurantCell</kbd></li>
                     
                     <li><span class="packt_screen">Subclass</span>: <kbd>UICollectionViewCell</kbd></li>
                     
                     <li><span class="packt_screen">Also create XIB file</span>: Unchecked
                     </li>
                     
                     <li><span class="packt_screen">Language</span>: <kbd><kbd>Swift</kbd></kbd></li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="4">
               
               <li>Click <span class="packt_screen">Next</span> and then <span class="packt_screen">Create</span>. Your file should look like the following:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">import UIKit<br/>class RestaurantCell: UICollectionViewCell {<br/>} </pre>
            <ol start="5">
               
               <li>Inside the class declaration, add the following:</li>
               
            </ol>
            <pre style="padding-left: 60px">@IBOutlet weak var lblTitle:UILabel!<br/>@IBOutlet weak var lblCuisine:UILabel!<br/>@IBOutlet weak var imgRestaurant: UIImageView! </pre>
            <ol start="6">
               
               <li>Save the file.</li>
               
            </ol>
            
            <p>Now that our file is set up, let's get our outlets connected.</p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Setting up restaurant list cell outlets</h1>
            
         </header>
         
         
         <article>
            
            
            <p>We need to set up our <kbd>restaurantCell</kbd> outlets:
            </p>
            
            <ol>
               
               <li>Open <kbd>Explore.storyboard</kbd> and select our <kbd>restaurantCell</kbd> again in the Outline view.
               </li>
               
               <li>Now, in the Utilities panel, select the Identity inspector.</li>
               
               <li>Under <span class="packt_screen">Custom Class</span>, in the <span class="packt_screen">Class</span> drop-down menu, select <span class="packt_screen">RestaurantCell</span> and hit <em>Enter</em> in order connect the <span class="packt_screen">Cell</span> to the class.
               </li>
               
               <li>Now, select the Connections inspector.</li>
               
            </ol>
            
            <p> </p>
            
            <ol start="5">
               
               <li>Click on and drag from the empty circle <kbd>lblTitle</kbd> under Outlets to the top label in our <kbd>restaurantCell</kbd>:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="303" src="assets/459cb759-c69b-4723-a20c-490d42223a1b.png" width="690"/></div>
            
            <ol start="6">
               
               <li>Click on and drag from the empty circle <kbd>lblCuisine</kbd> under Outlets to the other label in our <kbd>restaurantCell</kbd>:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="350" src="assets/a5ce9f0a-c4e7-4d2f-96aa-bc86251daaa0.png" width="681"/></div>
            
            <ol start="7">
               
               <li>Click on and drag from the empty circle <kbd>imgRestaurant</kbd> under Outlets to the image in our <kbd>restaurantCell</kbd>:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="403" src="assets/0c755fdd-659c-4c0d-968e-43d64b3fe119.png" width="664"/></div>
            
            <p>Now that we have our <kbd>restaurantListCell</kbd> outlets set up, let's get some data into our cell. We previously created our <kbd>RestaurantItem.swift</kbd> file; we will use this in our restaurant list.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Creating a restaurant data manager</h1>
            
         </header>
         
         
         <article>
            
            
            <p>We need to create a data manager for our restaurants, but before we do that we need
               to update a few things. In Swift 4, we have a more natural way to parse JSON using
               what is called <strong>Decodable</strong>.  We need first to update our <kbd>RestaurantItem</kbd>, but before we get into what this code looks like, our <kbd>RestaurantItem</kbd> needs to conform to Decodable. Open <kbd>RestaurantItem</kbd>. Open <kbd>RestaurantItem</kbd> and update it to the following:
            </p>
            <pre>class RestaurantItem: NSObject, MKAnnotation, Decodable {<br/>  var name: String?<br/>  var cuisines:[String] = []<br/>  var latitude: Double?<br/>  var longitude:Double?<br/>  var address:String?<br/>  var postalCode:String?<br/>  var state:String?<br/>  var imageURL:String?<br/> <br/>  var title: String? {<br/>    return name<br/>  }<br/> <br/>  var subtitle: String? {<br/>    if cuisines.isEmpty { return "" }<br/>    else if cuisines.count == 1 { return cuisines.first }<br/>    else { return cuisines.joined(separator: ", ") }<br/>  }<br/> <br/>  var coordinate: CLLocationCoordinate2D {<br/>    guard let lat = latitude, let long = longitude else {<br/>      return CLLocationCoordinate2D() }<br/>    return CLLocationCoordinate2D(latitude: lat, longitude: long )<br/>  }<br/>}</pre>
            <p>Now we have a <kbd>Location</kbd> object that returns an <kbd>RestaurantItems</kbd> array, just like our JSON data. 
            </p>
            
            <p>Let's create the <kbd>RestaurantDataManager</kbd> file now:
            </p>
            
            <ol>
               
               <li>Right-click on the <kbd>Restaurants</kbd> folder and select <span class="packt_screen">New File</span>.
               </li>
               
               <li>Inside the <span class="packt_screen">Choose a template for your new file</span> screen, select <span class="packt_screen">iOS</span> at the top and then <span class="packt_screen">Swift File</span>. Then, hit <span class="packt_screen">Next</span>:
               </li>
               
               <li>Name this file <kbd>RestaurantDataManager</kbd>, and hit <span class="packt_screen">Create</span>.
               </li>
               
            </ol>
            
            <p>We need to define our class definition first, so add the following under the <kbd>import</kbd> statement in this new file:
            </p>
            <pre>class RestaurantDataManager {<br/>}</pre>
            <p>Inside the class declaration, add the following variable:</p>
            <pre>private var items:[RestaurantItem] = []</pre>
            <p>Here, we keep our array <kbd>private</kbd>, since there is no reason to have to access this outside of the class.
            </p>
            
            <p>Now, let's add the following three methods:</p>
            <pre>func fetch(by location:String, withFilter:String="All",  completionHandler:() -&gt; Swift.Void) {<br/>   var restaurants:[RestaurantItem] = []<br/>   for restaurant in RestaurantAPIManager.loadJSON(file: location) {<br/>          restaurants.append(RestaurantItem(dict: restaurant))<br/>   }<br/><br/>   if withFilter != "All" {<br/>          items = restaurants.filter({ $0.cuisines.contains(withFilter) })<br/>   }<br/>   else { items = restaurants }<br/>   completionHandler()<br/>}<br/>func numberOfItems() -&gt; Int {<br/>   return items.count<br/>}<br/><br/>func restaurantItem(at index:IndexPath) -&gt; RestaurantItem {<br/>   return items[index.item]<br/>}</pre>
            <p>The first method here differs from the one we looked at in <kbd>ExploreDataManager</kbd>, whereas the last two methods here are the same as those in <kbd>ExploreDataManager</kbd>. 
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="363" src="assets/17ef04dd-438b-486e-9764-778fede6ebcf.png" width="584"/></div>
            
            <p><span>Let's break these methods down to better understand what we are doing:</span></p>
            
            <ul>
               
               <li><strong>Part A</strong>: <span>In the parameters of this method, we are passing in a cell and an index path.</span></li>
               
            </ul>
            <pre style="padding-left: 60px">private var items:[RestaurantItem] = []</pre>
            <ul>
               
               <li><strong>Part B</strong>: <span>This function is pretty long; however, we are simply fetching restaurants with a location
                     as a filter. We have a closure block, which will allow us to let the function run
                     until it is complete.</span></li>
               
            </ul>
            <pre style="padding-left: 60px">fetch(location:withFilter:completionHandler)</pre>
            <ul>
               
               <li><strong>Part C</strong>: <span>In this parameter, we are setting a default. If we do not pass anything into this
                     parameter, it will use </span><kbd>All</kbd><span>; otherwise, it will use whatever we give it.</span></li>
               
            </ul>
            <pre style="padding-left: 60px">withFilter:String="All" </pre>
            <p style="padding-left: 60px">As you type your code, Xcode will provide code hints (choices) that it believes that
               you might want. When you type this method, Xcode gives you two hints, one that includes
               the <kbd>withFilter</kbd> parameter, and one that does not:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="68" src="assets/b8864c73-93a1-4443-8480-e4d2fe0b67b3.png" width="622"/></div>
            
            <ul>
               
               <li><strong>Part D</strong>: <span>Here, we get restaurants from the JSON file.</span></li>
               
            </ul>
            <pre style="padding-left: 60px">for restaurant in RestaurantAPIManager.loadJSON(file: location) {<br/>   restaurants.append(RestaurantItem(dict: restaurant))<br/>} </pre>
            <ul>
               
               <li><strong>Part E</strong>: <span>Here, we are filtering the restaurants by cuisine. Since our restaurants have multiple
                     cuisines, we must check each cuisine, which is why we use contains.</span></li>
               
            </ul>
            <pre style="padding-left: 60px">if withFilter != "All" {<br/>   items = restaurants.filter({ $0.cuisines.contains(withFilter) })<br/>}<br/>else { items = restaurants }</pre>
            <ul>
               
               <li><strong>Part F</strong>: This is used to tell our method that we are finished.
               </li>
               
            </ul>
            <pre style="padding-left: 60px">completionHandler()</pre>
            <ul>
               
               <li><strong>Part G</strong>: <span>This method tells us how many restaurant items we have.</span></li>
               
            </ul>
            <pre style="padding-left: 60px">numberOfItems()</pre>
            <ul>
               
               <li><strong>Part H</strong>: <span>This method allows us to get the restaurant at the index position at which it is located.</span></li>
               
            </ul>
            <pre style="padding-left: 60px">restaurantItem(at:)  </pre>
            <p style="padding-left: 60px">Now we have a greater understanding of our restaurant data manager. We have done a
               lot of code, and some of it may not make full sense, but as long as you have a basic
               understanding then you will be fine.
            </p>
            
            <p style="padding-left: 60px">Now we need to get the data displaying in our restaurant list. One of the most common
               things when displaying data is how to handle a Table View or Collection View when
               there is no data. Some of the filtering we are doing may return no results, so we
               should handle both cases. We are going to do this next.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Handling no data</h1>
            
         </header>
         
         
         <article>
            
            
            <p>It is common to want to create a custom view that you can reuse, but also have a visual
               representation of it as well. There are two common ways to do this; the first way
               we will do now, and the other we will do later in the book. You can create a <kbd>UIView</kbd> that comes with a <strong>XIB</strong> (pronounced zib or nib). This was the common way to create elements before storyboards,
               and it is still effective today. Let's create one now:
            </p>
            
            <ol>
               
               <li>Right-click on the <kbd>Misc</kbd> folder and select <span class="packt_screen">New Group</span> and call it <kbd>No Data</kbd>.
               </li>
               
               <li>Then, right-click on the <kbd>No Data</kbd> folder and create a new file.
               </li>
               
               <li>Inside the <span class="packt_screen">Choose a template for your new file</span> screen, select <span class="packt_screen">iOS</span> at the top. Then, select <span class="packt_screen">Cocoa Touch Class</span>. Hit <span class="packt_screen">Next</span> after.
               </li>
               
               <li>In the options screen that appears, add the following:</li>
               
            </ol>
            
            <p style="padding-left: 60px">New file:</p>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">Class</span>: <kbd>NoDataView</kbd></li>
                     
                     <li><span class="packt_screen">Subclass</span>: <kbd>UIView</kbd></li>
                     
                     <li><span class="packt_screen">Language</span>: <kbd>Swift</kbd></li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="5">
               
               <li>Click <span class="packt_screen">Next</span> and then <span class="packt_screen">Create</span>.
               </li>
               
               <li>Next, right-click on the <kbd>No Data</kbd> folder again and create a new file.
               </li>
               
               <li>Inside the <span class="packt_screen">Choose a template for your new file</span> screen, select <span class="packt_screen"><strong>iOS</strong></span> at the top. Then, select <span class="packt_screen">View</span> under <span class="packt_screen">User Interface</span>. Hit <span class="packt_screen">Next</span> after.
               </li>
               
               <li>Name the file <kbd>NoDataView</kbd> and hit <span class="packt_screen">Create</span>.
               </li>
               
               <li>First, open the <kbd>NoDataView.swift</kbd> file and add the following into this file:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">class NoDataView: UIView {<br/>    var view: UIView!<br/>    @IBOutlet var lblTitle: UILabel!<br/>    @IBOutlet var lblDesc: UILabel!<br/><br/>    override init(frame: CGRect) {<br/>        super.init(frame: frame)<br/>        setupView()<br/>    }<br/><br/>    required init?(coder aDecoder: NSCoder) {<br/>        super.init(coder: aDecoder)!<br/>        setupView()<br/>    }<br/><br/>    func loadViewFromNib() -&gt; UIView {<br/>        let nib = UINib(nibName: "NoDataView", bundle: Bundle.main)<br/>        let view = nib.instantiate(withOwner: self, options: nil) [0] as! UIView<br/>        return view<br/>    }<br/><br/>    func setupView() {<br/>        view = loadViewFromNib()<br/>        view.frame = bounds<br/>        view.autoresizingMask = [.flexibleWidth, .flexibleHeight]<br/>        addSubview(view)<br/>    }<br/><br/>    func set(title: String) {<br/>        lblTitle.text = title<br/>    }<br/><br/>    func set(desc: String) {<br/>        lblDesc.text = desc<br/>    }<br/>}</pre>
            <p>Our two <kbd>init</kbd> methods are required; just simply call <kbd>setupView()</kbd>. The <kbd>loadViewFromNib()</kbd> method is used to get our XIB file. Our <kbd>setupView()</kbd> is used to take the NIB and add it to the <kbd>UIView()</kbd>. Finally, we have two methods that set up our two labels. The first four methods
               are boilerplate code that you will write every time you want to create a <kbd>UIView</kbd> with a NIB (XIB) file. Next, let's get this set up:
            </p>
            
            <ol>
               
               <li>Open <kbd>NoDataView.xib</kbd>.
               </li>
               
               <li>Select <span class="packt_screen">Files Owner</span> in the Outline. Then, open the Identity inspector and update <span class="packt_screen">Class</span> to <kbd>NoDataView</kbd> and hit <em>Enter.</em></li>
               
               <li>Next, in the filter field of the object library, type <kbd>label</kbd>.
               </li>
               
               <li>Then, drag out two labels into the view.</li>
               
            </ol>
            
            <p> </p>
            
            <ol start="5">
               
               <li>Select one of the labels; then, in the Attributes inspector, update the following
                  values:
               </li>
               
            </ol>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">Text</span>: Add <kbd>TITLE GOES HERE</kbd> into the empty text field under the text
                     </li>
                     
                     <li><span class="packt_screen">Color</span>: <kbd>Black</kbd></li>
                     
                     <li><span class="packt_screen">Alignment</span>: <kbd>Center</kbd></li>
                     
                     <li><span class="packt_screen">Font</span>: <kbd>Avenir Next Condensed Bold 26</kbd></li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="6">
               
               <li>Then in the Size inspector, update the following values:</li>
               
            </ol>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">Width</span>: <kbd>355</kbd></li>
                     
                     <li><span class="packt_screen">Height</span>: <kbd>36</kbd></li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="7">
               
               <li>Select one of the labels; then, in the Attributes inspector, update the following
                  values:
               </li>
               
            </ol>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">Text</span>: Add <kbd>TITLE GOES HERE</kbd> into the empty text field under the text
                     </li>
                     
                     <li><span class="packt_screen">Color</span>: <kbd>Black</kbd></li>
                     
                     <li><span class="packt_screen">Alignment</span>: <kbd>Center</kbd></li>
                     
                     <li><span class="packt_screen">Font</span>: <kbd>Avenir Next Condensed Regular 17</kbd></li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="8">
               
               <li>Then in the Size inspector, update the following values:</li>
               
            </ol>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">Width</span>: <kbd>355</kbd></li>
                     
                     <li><span class="packt_screen">Height</span>: <kbd>21</kbd></li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="9">
               
               <li>Select both labels and then the Pin icon. Enter the value of <span class="packt_screen">Height</span> (should be checked).
               </li>
               
            </ol>
            
            <ol start="10">
               
               <li>Now with both labels selected, hit the Stack View icon or you can go to <span class="packt_screen">Editor</span> | <span class="packt_screen">Embed In</span> | <span class="packt_screen">Stack View</span>.
               </li>
               
               <li>Select the Stack View in the Outline view, and then the Pin icon. Enter the following
                  values: 
               </li>
               
            </ol>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">Right</span>: <kbd>10</kbd></li>
                     
                     <li><span class="packt_screen">Left</span>: <kbd><kbd>10</kbd></kbd></li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="12">
               
               <li>Then, the Align icon. Enter the following values:</li>
               
            </ol>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">Horizontally in container</span>: (should be checked)
                     </li>
                     
                     <li><span class="packt_screen">Vertically in container</span>: (should be checked)
                     </li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="13">
               
               <li>Select the <span class="packt_screen">Files Owner</span> in the Outline view.
               </li>
               
               <li>Then, open the Identity inspector and connect <kbd>lblTitle</kbd> to the label that says <kbd>TITLE GOES HERE</kbd>.
               </li>
               
               <li>Connect <kbd>lblDesc</kbd> to the other label.
               </li>
               
            </ol>
            
            <p>When you are done, you should see the following:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="418" src="assets/0d5fd76a-e155-495c-b5c0-5ba3be44787e.png" width="243"/></div>
            
            <p>Now, let's finally connect everything. Open the <kbd>RestaurantViewController.swift</kbd> file.
            </p>
            
            <ol>
               
               <li>Above the <kbd>selectedRestaurant</kbd> variable, add the following:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">var manager = RestaurantDataManager()</pre>
            <ol start="2">
               
               <li>Next, add the following method inside the <kbd>private</kbd> extension:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">func createData() {<br/>    guard let location = selectedCity?.city, let filter = selectedType else { return }<br/>    manager.fetch(by: location, with: filter) { _ in<br/>        if manager.numberOfItems() &gt; 0 {<br/>            collectionView.backgroundView = nil<br/>        }<br/><br/>        else {<br/>            let view = NoDataView(frame: CGRect(x: 0, y: 0, width: collectionView.frame.width, height: collectionView.frame.height))<br/>            view.set(title: "Restaurants")<br/>            view.set(desc: "No restaurants found.")<br/>            collectionView.backgroundView = view<br/>        }<br/><br/>        collectionView.reloadData()<br/>    }<br/>}</pre>
            <p style="padding-left: 60px">This method is checking to see if we have a selected location and a filter. Then,
               we run the fetch method we created earlier. If we have items, we make sure our background
               view is <kbd>nil</kbd>. If not, we will create our <kbd>NoDataView</kbd> and set it to display <kbd>No restaurants found</kbd>. Finally, we reload the Collection View.
            </p>
            
            <ol start="3">
               
               <li>Next, lets update <kbd>-collectionView:cellForItemAtIndexPath:</kbd> by adding the following:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell {<br/>    let cell = collectionView.dequeueReusableCell(withReuseIdentifier: "restaurantCell", for: indexPath) as! RestaurantCell<br/>    let item = manager.restaurantItem(at: indexPath)<br/>    if let name = item.name { cell.lblTitle.text = name }<br/>    if let cuisine = item.subtitle { cell.lblCuisine.text = cuisine }<br/>    if let image = item.imageURL {<br/>        if let url = URL(string: image) {<br/>            let data = try? Data(contentsOf: url)<br/>            if let imageData = data {<br/>                DispatchQueue.main.async {<br/>                    cell.imgRestaurant.image = UIImage(data: imageData)<br/>                }<br/>            }<br/>        }<br/>    }<br/>    return cell<br/>}</pre>
            <p style="padding-left: 60px">Here, we are just passing data into our cell. We are displaying the title, cuisine,
               and the image.
            </p>
            
            <ol start="4">
               
               <li>Finally, update <kbd>-collectionView:numberOfItemsInSection:</kbd> to the following:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -&gt; Int {<br/>    return manager.numberOfItems()<br/>}</pre>
            <ol start="5">
               
               <li>Build and run the project, and you should now see the following either with data or
                  without:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="426" src="assets/3ba090ad-ef49-4193-a6d8-ef862e65f652.png" width="481"/></div>
            
            <p>Before we wrap it up, let's add one more thing. When you select a location, let's
               display it on this view using the new iOS 11 large titles. Add the following into
               the private extension under <kbd>createData()</kbd>:
            </p>
            <pre>func setupTitle() {<br/>    navigationController?.setNavigationBarHidden(false, animated: false)<br/>    if let city = selectedCity?.city, let state = selectedCity?.state {<br/>        title = "\(city.uppercased()), \(state.uppercased())"<br/>    }<br/>    navigationController?.navigationBar.prefersLargeTitles = true<br/>}</pre>
            <p>Then, call <kbd>setupTitle()</kbd> after <kbd>createData</kbd> in the <kbd>viewDidAppear()</kbd> method. Build and run the project again, and you should now see the selected city.
               When you scroll, the large title will appear in the title view:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="493" src="assets/981c2be4-45de-4de9-b5f9-9d3582c5c3c0.png" width="556"/></div>
            
            <p>We are done with this chapter; good work. We did a lot, but you should be starting
               to see this app coming to life.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Summary </h1>
            
         </header>
         
         
         <article>
            
            
            <p>Well, we finally have data working in our app. We are not using a service, but if
               we wanted to, it would not be hard to add it. Working with local JSON files is the
               same as working with an API feed. You should feel confident having to do either. One
               thing I love to do is when I know what the feed is like, but I do not want to write
               that portion yet, I will create static JSON files of the feed and work with those.
               This allows me to focus on getting the app to where it needs to be, and not be stopped
               because of the API data layer.
            </p>
            
            <p>In this chapter, we learned what JSON is and how to use that JSON feed to make data
               for our app. We also looked at how to pass data using segues. Finally, we looked at
               extensions and how they are useful for cleaning up and organizing code.
            </p>
            
            <p>In the next chapter, we will look at how to display even more data.</p>
            
            
            
         </article>
         
         
         
      </section>
      
   </body></html>