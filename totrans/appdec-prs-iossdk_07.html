<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Social Media Integration"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Social Media Integration</h1></div></div></div><p>These days, social media integration<a id="id181" class="indexterm"/> is a common feature that all mobile applications incorporate. Some applications allow users to share data and updates to their social profiles such as Facebook and Twitter.</p><p>Nowadays, the traditional login process for the application using an e-mail ID and password is turning out to be cumbersome for the users. So to target such issues, many applications use Facebook and Twitter as their base login. Users can sign up using their Facebook or Twitter account. This even simplifies the steps of the login process and provides one-click sign up and login to the user. Keeping such things in mind, Parse provides you with the Plug and Play approach to integrate with social media, both for sharing and for the login process. In this chapter, you will learn in detail about social media integration using Parse.</p><div class="section" title="Integrating Facebook"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec45"/>Integrating Facebook</h1></div></div></div><p>It's easy to <a id="id182" class="indexterm"/>integrate Facebook with your <a id="id183" class="indexterm"/>Parse application. The Facebook SDK can be used with the Parse SDK. You can link your <code class="literal">PFUser</code> with the Facebook user identities. You can use Facebook for sign up processes as well. Parse allows you to authenticate the user from Facebook and associate the user in your <code class="literal">PFUser</code> class.</p><p>In this section you will learn the integration of Facebook from your Parse application.</p><div class="section" title="Prerequisites"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec55"/>Prerequisites</h2></div></div></div><p>To get <a id="id184" class="indexterm"/>started with the integration of Facebook with Parse, you need to set up the following things:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Register on the Facebook developer portal<a id="id185" class="indexterm"/> (<a class="ulink" href="https://developers.facebook.com/">https://developers.facebook.com/</a>) and create a Facebook application (<a class="ulink" href="https://developers.facebook.com/docs/ios/getting-started/">https://developers.facebook.com/docs/ios/getting-started/</a>), if you have not created it already.</li><li class="listitem" style="list-style-type: disc">Facebook provides step-by-step procedure to create an app (<a class="ulink" href="https://developers.facebook.com/apps">https://developers.facebook.com/apps</a>) and link it with the Facebook SDK.</li></ul></div></div><div class="section" title="Setting up the application"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec56"/>Setting up the application</h2></div></div></div><p>To get started <a id="id186" class="indexterm"/>with Facebook, you need to configure the following in your application:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select your project file from the left-hand side panel, click on <span class="strong"><strong>Targets</strong></span> and navigate to the <span class="strong"><strong>Info</strong></span> tab.</li><li class="listitem">Under the <span class="strong"><strong>Custom iOS Target Properties</strong></span> section, add a new key with <span class="strong"><strong>Facebook App Id</strong></span> as a string value and provide your Facebook app ID as the value.</li><li class="listitem">Now add another key name with <span class="strong"><strong>URL</strong></span> <span class="strong"><strong>Type</strong></span>. Expand the key and at last you will see the <span class="strong"><strong>URL identifier</strong></span>. Replace the <span class="strong"><strong>URL identifier</strong></span> with <span class="strong"><strong>URL Schemes</strong></span> and fill it with <code class="literal">fbYour_App_Id</code> (for example, Fb1234567890).</li></ol></div><p>After updating your application with the Facebook keys, perform the following steps for setting up the code in your application:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In your <code class="literal">application:didFinishLaunchingWithOptions:</code> method, add the following line of code to initialize Facebook, just below the code where you have initialized the Parse SDK:<div class="informalexample"><pre class="programlisting">[PFFacebookUtils initializeFacebook];</pre></div></li><li class="listitem">Add the following methods in your <code class="literal">AppDelegate</code> file to handle the single sign-on feature of the Facebook SDK:<div class="informalexample"><pre class="programlisting">- (BOOL)application:(UIApplication *)application openURL:(NSURL *)url
  sourceApplication:(NSString *)sourceApplication annotation:(id)annotation {
    return [PFFacebookUtils handleOpenURL:url];
}

- (BOOL)application:(UIApplication *)application handleOpenURL:(NSURL *)url {
    return [PFFacebookUtils handleOpenURL:url];
}</pre></div></li></ol></div></div><div class="section" title="Signing up on Facebook"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec57"/>Signing up on Facebook</h2></div></div></div><p>Using the <a id="id187" class="indexterm"/>Parse SDK you can allow users to sign up using Facebook. The user object will also be created and saved for you by Parse. The following method will allow you to log in with Facebook:</p><div class="informalexample"><pre class="programlisting">[PFFacebookUtils logInWithPermissions:permissions block:^(PFUser *user, NSError *error) {
    if (!user) {
        NSLog(@"Uh oh. The user cancelled the Facebook login.");
    } else if (user.isNew) {
        NSLog(@"User signed up and logged in through Facebook!");
    } else {
        NSLog(@"User logged in through Facebook!");
    }
}];</pre></div><p>In the previous code, <code class="literal">permissions</code> is an array of strings that specify what data your application wants to access from Facebook.</p><p>The following code will demonstrate the way you log in or sign up using Facebook:</p><div class="informalexample"><pre class="programlisting">- (IBAction)loginButtonTouchHandler:(id)sender  {
    // The permissions requested from the user
    NSArray *permissionsArray = @[ @"user_about_me", @"user_relationships", @"user_birthday", @"user_location"];
     
    // Login PFUser using Facebook
    [PFFacebookUtils logInWithPermissions:permissionsArray block:^(PFUser *user, NSError *error) {
        [_activityIndicator stopAnimating]; // Hide loading indicator
         
        if (!user) {
            if (!error) {
                NSLog(@"Uh oh. The user cancelled the Facebook login.");
            } else {
                NSLog(@"Uh oh. An error occurred: %@", error);
            }
        } else if (user.isNew) {
            NSLog(@"User with facebook signed up and logged in!");
            [self.navigationController pushViewController:[[UserDetailsViewController alloc] initWithStyle:UITableViewStyleGrouped] animated:YES];
        } else {
            NSLog(@"User with facebook logged in!");
            [self.navigationController pushViewController:[[UserDetailsViewController alloc] initWithStyle:UITableViewStyleGrouped] animated:YES];
        }
    }];
}</pre></div><p>On the button action you can add the previous code to log in or sign up using Facebook. In the previous code, we have used <code class="literal">permissionsArray</code>. This array will hold the strings to indicate the user data needed from Facebook.</p><p>After executing the preceding function, the following steps will take place:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The app will be redirected to Facebook or will prompt for permissions to access the data from Facebook.</li><li class="listitem">When the user authenticates via Facebook, your application will receive a callback using the <code class="literal">handleOpenUrl</code> method that we had configured in the previous section.</li><li class="listitem">The Parse SDK will fetch the data and save it to the <code class="literal">PFUser</code> class and will save the data on Parse if the user is new.</li><li class="listitem">Your code block will be called with the user.</li></ol></div><p>Parse <a id="id188" class="indexterm"/>provides you with a very deep integration with Facebook, as Parse has been acquired by Facebook, Inc. This also spells for even greater and deeper integration with Parse in future.</p></div><div class="section" title="Publishing on Facebook"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec58"/>Publishing on Facebook</h2></div></div></div><p>To post <a id="id189" class="indexterm"/>some updates on the user wall, you need to acquire publishing permissions from the user. The following code will acquire the publishing permission from the users:</p><div class="informalexample"><pre class="programlisting">[PFFacebookUtils reauthorizeUser:[PFUser currentUser]
                 withPermissions:@["publish_stream"]
                        audience:PF_FBSessionDefaultAudienceFriends
                           block:^(BOOL succeeded, NSError *error) {
    if (succeeded) {
        //Your app now has publishing permissions for the user
    }
}];</pre></div></div><div class="section" title="Requesting user data"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec59"/>Requesting user data</h2></div></div></div><p>After user<a id="id190" class="indexterm"/> login, you can start fetching the user data from Facebook using the Graph API. The following code will demonstrate the way to fetch the user data from Facebook:</p><div class="informalexample"><pre class="programlisting">- (void)fetchUserData {
    // ...
    // Create request for user's Facebook data
    FBRequest *request = [FBRequest requestForMe];
 
    // Send request to Facebook
    [request startWithCompletionHandler:^(FBRequestConnection *connection, id result, NSError *error) {
        if (!error) {
            // result is a dictionary with the user's Facebook data
            NSDictionary *userData = (NSDictionary *)result;
 
            NSString *facebookID = userData[@"id"];
            NSString *name = userData[@"name"];
            NSString *location = userData[@"location"][@"name"];
            NSString *gender = userData[@"gender"];
            NSString *birthday = userData[@"birthday"];
            NSString *relationship = userData[@"relationship_status"];
 
            NSURL *pictureURL = [NSURL URLWithString:[NSString stringWithFormat:@"https://graph.facebook.com/%@/picture?type=large&amp;return_ssl_resources=1", facebookID]];
  
            // Now add the data to the UI elements
            // ...
        }
    }];
}</pre></div><p>The <code class="literal">result</code> dictionary <a id="id191" class="indexterm"/>will hold all the requested data. You can fetch the data by querying with the key.</p></div><div class="section" title="Linking users"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec60"/>Linking users</h2></div></div></div><p>In case <a id="id192" class="indexterm"/>of anonymous login or sign up using an e-mail ID and password, you can associate the existing <code class="literal">PFUser</code> to a Facebook account. The following code will illustrate a way to link an existing user to Facebook:</p><div class="informalexample"><pre class="programlisting">if (![PFFacebookUtils isLinkedWithUser:user]) {
    [PFFacebookUtils linkUser:user permissions:nil block:^(BOOL succeeded, NSError *error) {
        if (succeeded) {
            NSLog(@"User logged in with Facebook!");
        }
    }];
}</pre></div><p>After successful log in the <code class="literal">PFUser</code> class will be updated with the Facebook information.</p><p>The following <a id="id193" class="indexterm"/>code will unlink a Facebook account from a current user:</p><div class="informalexample"><pre class="programlisting">[PFFacebookUtils unlinkUserInBackground:user block:^(BOOL succeeded, NSError *error) {
    if (succeeded) {
        NSLog(@"The user is no longer associated with their Facebook account.");
    }
}];</pre></div></div><div class="section" title="Logging out"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec61"/>Logging out</h2></div></div></div><p>To<a id="id194" class="indexterm"/> log out the current user from the application, you simply need to call the <code class="literal">logOut</code> method on the <code class="literal">PFUser</code> class. The following code will log out the user from the application:</p><div class="informalexample"><pre class="programlisting">- (void)logoutButtonAction:(id)sender  {
    [PFUser logOut]; // Log out
    // Return to login page
}</pre></div></div><div class="section" title="Keeping users logged in"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec62"/>Keeping users logged in</h2></div></div></div><p>It's cumbersome<a id="id195" class="indexterm"/> for the user to log in every time while launching the application. This is because Facebook session information is not stored in between launches. Parse makes this easy for us by internally saving the session in the <code class="literal">currentUser</code> object of the <code class="literal">PFUser</code> class.</p><p>In the launch view controller, you can check for the current session. If it exists, you can bypass the log in. The following code will illustrate how to bypass the log in:</p><div class="informalexample"><pre class="programlisting">- (void)viewDidLoad {
    ...
    if ([PFUser currentUser] &amp;&amp; // Check if a user is cached
        [PFFacebookUtils isLinkedWithUser:[PFUser currentUser]]) // Check if user is linked to Facebook
    {
        // Push the next view controller without animation
        [self.navigationController pushViewController:
                                       [[UserDetailsViewController alloc]
                                       initWithStyle:UITableViewStyleGrouped]
                                   animated:NO];
    }
}</pre></div></div></div></div>
<div class="section" title="Integrating Twitter"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec46"/>Integrating Twitter</h1></div></div></div><p>Just like <a id="id196" class="indexterm"/>Facebook integration, Parse provides <a id="id197" class="indexterm"/>an easy way to integrate Twitter authentication as well. Just after a few lines of code, you will be able to log in with Twitter and save the data over the Parse Cloud.</p><div class="section" title="Setting up Twitter"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec63"/>Setting up Twitter</h2></div></div></div><p>You need to <a id="id198" class="indexterm"/>perform the following steps to set up Twitter authentication using Parse:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">If you have not created your application on Twitter already, you need to create your application on the Twitter developer portal<a id="id199" class="indexterm"/> (<a class="ulink" href="https://d">https://d</a><a class="ulink" href="http://ev.twitter.com/apps">ev.twitter.com/apps</a>).</li><li class="listitem">Add your Twitter application's <span class="strong"><strong>Consumer Key</strong></span> on the Parse application's settings page.</li><li class="listitem">Enter a valid <span class="strong"><strong>Callback URL</strong></span> for the Twitter application. This value is important for you to have control over this callback URL, so that the information isn't hijacked along the way. So, in this way, this value is used for authentication purposes by Twitter.</li><li class="listitem">Add the following code in your <code class="literal">application:didFinishLaunchingWithOptions:</code> method, just below the code where you initialized Parse:<div class="informalexample"><pre class="programlisting">[PFTwitterUtils initializeWithConsumerKey:@"YOUR CONSUMER KEY"
                           consumerSecret:@"YOUR CONSUMER SECRET"];</pre></div></li></ol></div><p>This is all you need to do to set up Twitter in your application. Now, we can allow the user to log in using Twitter.</p></div><div class="section" title="Signing up and logging in"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec64"/>Signing up and logging in</h2></div></div></div><p>Parse provides<a id="id200" class="indexterm"/> you with the <code class="literal">PFTwitterUtils</code> class to allow your<a id="id201" class="indexterm"/> users to log in using Twitter. The following code will allow the user to sign up using Twitter:</p><div class="informalexample"><pre class="programlisting">[PFTwitterUtils logInWithBlock:^(PFUser *user, NSError *error) {
    if (!user) {
        NSLog(@"Uh oh. The user cancelled the Twitter login.");
        return;
    } else if (user.isNew) {
        NSLog(@"User signed up and logged in with Twitter!");
    } else {
        NSLog(@"User logged in with Twitter!");
    }     
}];</pre></div><p>On executing <a id="id202" class="indexterm"/>the previous code, the following should happen:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The user will be prompted for the permission to access Twitter authentication through an alert box or login dialog box</li><li class="listitem" style="list-style-type: disc">After authorizing the application, the application will receive a callback</li><li class="listitem" style="list-style-type: disc">Parse will receive the data on successful log in and will save it to the <code class="literal">PFUser</code> class on the cloud</li></ul></div></div><div class="section" title="Linking users"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec65"/>Linking users</h2></div></div></div><p>In case of<a id="id203" class="indexterm"/> anonymous login or sign up using an e-mail ID and password, you can associate the existing PFUser to a Twitter account. The following code will illustrate a way to link an existing user to Twitter:</p><div class="informalexample"><pre class="programlisting">if (![PFTwitterUtils isLinkedWithUser:user]) {
    [PFTwitterUtils linkUser:user block:^(BOOL succeeded, NSError *error) {
        if ([PFTwitterUtils isLinkedWithUser:user]) {
            NSLog(@"User logged in with Twitter!");
        }
    }];
}</pre></div><p>After successful log in the <code class="literal">PFUser</code> class will be updated with the Twitter information.</p><p>The following code will unlink the Twitter account from a current user:</p><div class="informalexample"><pre class="programlisting">[PFTwitterUtils unlinkUserInBackground:user block:^(BOOL succeeded, NSError *error) {
    if (!error &amp;&amp; succeeded) {
        NSLog(@"The user is no longer associated with their Twitter account.");
    }
}];</pre></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec47"/>Summary</h1></div></div></div><p>In this chapter, we explored the integration of the Facebook and Twitter SDK with the Parse SDK.</p><p>We started by exploring Facebook integration with setting up an application on the Facebook developer portal and then saw the login setup.</p><p>Then, we learned about publishing posts on Facebook, and linking users from Facebook.</p><p>Next, we learned about integrating in the application.</p><p>Finally, we explored Twitter integration and log in in our application.</p><p>In the next chapter, we will learn about the cloud functions and its usage in our application.</p></div></body></html>