<html><head></head><body>
      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Just a Peek</h1>
            
         </header>
         
         
         <article>
            
            
            <p>In 2015, when the iPhone 6S and 6S Plus were announced, Apple also introduced 3D Touch.
               3D Touch uses a Taptic Engine with haptic feedback, which allows the device to sense
               the pressure of a touch, thereby triggering specific actions. For example, pressing
               hard on an icon will enable us to quickly open an action menu.
            </p>
            
            <p>This chapter will cover the following topics:</p>
            
            <ul>
               
               <li>Adding 3D Touch quick actions</li>
               
               <li>Understanding the difference between static and dynamic quick actions</li>
               
               <li>Adding 3D Touch support inside of a Collection View</li>
               
            </ul>
            
            <p>The first thing we will do for our app is to add quick actions for our app icon.</p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Adding 3D Touch quick actions </h1>
            
         </header>
         
         
         <article>
            
            
            <p>For our app, we are going to add four quick actions (which is the maximum amount that
               you can have). These actions will do the following:
            </p>
            
            <ul>
               
               <li>Launch the map</li>
               
               <li>Launch the locations</li>
               
               <li>Select <span class="packt_screen">Los Angeles</span> as a location
               </li>
               
               <li>Select <span class="packt_screen">Las Vegas</span> as a location
               </li>
               
            </ul>
            
            <p>There are two types of quick actions: static and dynamic. Static means that they cannot
               be changed and dynamic means that they can. For example, Apple has 3D Touch on their
               <em>Messages</em> app. If you press hard on the <em>Messages</em> app, you will see one static quick action, <span class="packt_screen">New Message</span>, and three dynamic quick actions, the three most-texted contacts. In our app, we
               will have two static quick actions, launching the <span class="packt_screen">Map</span> tab and the locations list, and two dynamic quick actions, launching Los Angeles
               and Las Vegas as locations. Let's start setting up our quick actions:
            </p>
            
            <ol>
               
               <li>Right-click the <kbd>Misc</kbd> folder and select <span class="packt_screen">New File</span>.
               </li>
               
               <li>Inside of the <span class="packt_screen">Choose a template for your new file screen</span>, select <span class="packt_screen">iOS</span> at the top and then <span class="packt_screen">Swift File</span>. Then, hit <span class="packt_screen">Next</span>.
               </li>
               
               <li>Name this file <span class="packt_screen">Shortcut</span> and hit <span class="packt_screen">Create</span>.
               </li>
               
            </ol>
            
            <p style="padding-left: 60px">Inside of this file, add the following <kbd>enum</kbd> after the <kbd>import</kbd> statement:
            </p>
            <pre style="padding-left: 60px">enum Shortcut: String {<br/>      case openMap<br/>      case openLocations<br/>      case openLosAngeles<br/>      case openLasVegas<br/><br/>      init?(with identifier: String) {<br/>            guard let shortIdentifier = identifier.components(separatedBy: ".").last else { return nil }<br/>            self.init(rawValue: shortIdentifier)<br/>      }<br/><br/>      var type: String {<br/>            guard let identifier = Bundle.main.bundleIdentifier else { return "" }<br/>            return identifier + ".\(self.rawValue)"<br/>      }<br/>}</pre>
            <p style="padding-left: 60px">This <kbd>enum</kbd> is used for our quick actions. As we discussed, we will have four quick actions for
               our app.
            </p>
            
            <ol start="4">
               
               <li>Now, open your <kbd>AppDelegate.swift</kbd> file. After the <kbd>window</kbd> variable, add the following: 
               </li>
               
            </ol>
            <pre style="padding-left: 60px">var launchedShortcutItem: UIApplicationShortcutItem?<br/>static let applicationShortcutUserInfoIconKey = "applicationShortcutUserInfoIconKey"</pre>
            <p style="padding-left: 60px">Here, we have a variable for our shortcut item and a constant for our user info key.
               When the application launches, we need to check to see if the app was launched using
               a quick action.
            </p>
            
            <p>Next, we need to create a method to handle our shortcuts. Add the following after
               the <kbd>checkNotifications()</kbd> method: 
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/bc59d75b-7c95-4c9f-bc82-fdd458bc47ca.png"/></div>
            
            <p>Now, let's break down our code and have a look at each part:</p>
            
            <ul>
               
               <li><strong>Part A</strong>: <span>Here is where we check for a shortcut item. If we have a shortcut item, then the rest
                     of the code inside of this <kbd>if...let</kbd> statement will run:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">if let shortcutItem = launchOptions?[UIApplicationLaunchOptionsKey.shortcutItem] as? UIApplicationShortcutItem</pre>
            <ul>
               
               <li><strong>Part B</strong>: <span>This is our first dynamic shortcut. This will set our current selected location to
                     <span class="packt_screen">Los Angeles</span>. We will also set the icon image here to a custom image that is in our image assets:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">let laShortcut = UIMutableApplicationShortcutItem(type: Shortcut.openLosAngeles.type, localizedTitle: "Los Angeles", localizedSubtitle: "", icon: UIApplicationShortcutIcon(templateImageName: "shortcut-city"), userInfo:nil)</pre>
            <ul>
               
               <li><strong>Part C</strong>: <span>This is our second dynamic shortcut. This will set our current selected location to
                     <span class="packt_screen">Las Vegas</span>. We will also set the icon image here to a custom image that is in our image assets:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">let lvShortcut = UIMutableApplicationShortcutItem(type: Shortcut.openLasVegas.type, localizedTitle: "Las Vegas", localizedSubtitle: "", icon: UIApplicationShortcutIcon(templateImageName: "shortcut-city"), userInfo: nil)</pre>
            <ul>
               
               <li><strong>Part D</strong>: <span>Finally, when we are done, we will return <kbd>true</kbd> or <kbd>false</kbd>. <kbd>True</kbd> will be sent if a shortcut icon was not selected, and <kbd>false</kbd> will be sent if one was selected:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">return isPerformingAdditionalDelegateHandling</pre>
            <p>Now that we have our method created, let's update our return value inside of <kbd>didFinishLaunchingWithOptions</kbd>. Update the return from the current value of <kbd>true</kbd> to the following:
            </p>
            <pre>return checkShortCut(application, launchOptions: launchOptions)</pre>
            <p>Next, we need to add a few more methods for our application to handle shortcuts. Let's
               add a method that will handle any shortcut links that are selected. Add the following
               method after the <kbd>checkShortCut()</kbd> method:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="641" src="assets/630ab91e-83cc-49cd-8f18-b9d698d56f6d.png" width="713"/></div>
            
            <p>Let's break down this code, so that  you can better understand the different parts
               of the code:
            </p>
            
            <ul>
               
               <li><strong>Part A</strong>: <span>Here, we are ensuring  that we have a shortcut item, shortcut type, and a Tab Bar
                     controller. If we do not have any of these things, we will return <kbd>false</kbd> and not  go any further:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">guard Shortcut(with: item.type) != nil, let shortCutType = item.type as String?, let tabBarController = self.window?.rootViewController as? UITabBarController else { return false }</pre>
            <ul>
               
               <li><strong>Part B</strong>: <span>This shortcut will allow us to launch the location list view. We are setting the selected
                     index of the Tab Bar controller and then using the <kbd>performSegue</kbd> to enable the modal to appear:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">tabBarController.selectedIndex = 0<br/>let navController = self.window?.rootViewController?.childViewControllers.first as! UINavigationController<br/>let viewController = navController.childViewControllers.first as! ExploreViewController<br/>viewController.performSegue(withIdentifier: "locationList", sender: self)</pre>
            <ul>
               
               <li><strong>Part C</strong>: <span>This shortcut will allow us to go directly to the <span class="packt_screen">Map</span> tab:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">tabBarController.selectedIndex = 1<br/>isHandled = true</pre>
            <ul>
               
               <li><strong>Part D</strong>: <span>This shortcut will allow us to launch the explore view with <span class="packt_screen">Los Angeles</span> already selected:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">let navController = self.window?.rootViewController?.childViewControllers.first as! UINavigationController<br/>let viewController = navController.childViewControllers.first as! ExploreViewController<br/>viewController.selectedCity = LocationItem(state: "CA", city: "Los Angeles")<br/><br/>tabBarController.selectedIndex = 1<br/>tabBarController.selectedIndex = 0<br/>isHandled = true</pre>
            <ul>
               
               <li><strong>Part E</strong>: <span>This shortcut will allow us to launch the explore view with <span class="packt_screen">Las Vegas</span> already selected.</span></li>
               
            </ul>
            <pre style="padding-left: 60px">let navController = self.window?.rootViewController?.childViewControllers.first as! UINavigationController<br/>let viewController = navController.childViewControllers.first as! ExploreViewController<br/>viewController.selectedCity = LocationItem(state: "NV", city: "Las Vegas")<br/><br/>tabBarController.selectedIndex = 1<br/>tabBarController.selectedIndex = 0<br/>isHandled = true</pre>
            <p>Now that we can have a method for handling any shortcut links, add the following method
               after the <kbd>applicationWillTerminate()</kbd> method:
            </p>
            <pre>func application(_ application: UIApplication, performActionFor shortcutItem: UIApplicationShortcutItem, completionHandler: @escaping (Bool) -&gt; Void) {<br/>   let handledShortCutItem = handleShortCut(shortcutItem)<br/>   completionHandler(handledShortCutItem)<br/>}</pre>
            <p>This method gets called every time a shortcut action is performed.</p>
            
            <p>Finally, we need to add code to check when the app becomes active. Find the <kbd>applicationDidBecomeActive()</kbd> method and add the following inside of the curly braces:
            </p>
            <pre>guard let item = launchedShortcutItem else { return }<br/>_ = handleShortCut(item)<br/><br/>launchedShortcutItem = nil<br/>if (application.applicationIconBadgeNumber != 0) {<br/>  application.applicationIconBadgeNumber = 0<br/>}</pre>
            <p>Here, we are handling any shortcut actions. Also, we are checking whether the badge
               icon is set to a number other than <kbd>0</kbd>, and, if so, we reset it to <kbd>0</kbd>.
            </p>
            
            <p>If you are keeping track, you will see that we have only added two items so far—our
               dynamic items. We still need to add our static items; however, these will actually
               be added to your <kbd>Info.plist</kbd>.
            </p>
            
            <p>Open the <kbd>Info.plist</kbd> in the <kbd>Assets</kbd> folder of the Navigator panel. Hover over <span class="packt_screen">Privacy - Camera Usage Description</span> and then click on the <span class="packt_screen">+</span> button to add the key <kbd>UIApplicationShortcutItems</kbd>. Make the type an array:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/7a3565c3-f1ed-4541-8e5a-6e8080afbe16.png"/></div>
            
            <p>Next, hover over <kbd>UIApplicationShortcutItems</kbd> and click on the <span class="packt_screen">+</span> button to add an item to this array. Change the type to <span class="packt_screen">Dictionary</span>:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/ae8265db-c7a9-4508-b8a8-632c3256973d.png"/></div>
            
            <p>Hover over <span class="packt_screen">Item 0</span> and click on the <span class="packt_screen">+</span> button three times to add three strings. Give the three keys the following names:
            </p>
            <pre>UIApplicationShortcutItemIconFile<br/>UIApplicationShortcutItemTitle<br/>UIApplicationShortcutItemType</pre>
            <div class="CDPAlignCenter CDPAlign"><img src="assets/ec0e6de0-71d4-478a-a0ca-fd5c98567805.png"/></div>
            
            <p>Now, copy <span class="packt_screen">Item 0</span> (⌘ + <em>C</em>) and paste it (⌘ + <em>V</em>) into <kbd>UIApplicationShortcutItems</kbd>. You should now have <span class="packt_screen">Item 0</span> and <span class="packt_screen">Item 1</span>, each with the same three Strings:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/789625c6-dd48-488e-91ac-87186790a661.png"/></div>
            
            <p>Next, set their values to the following for <span class="packt_screen">Item 0</span>: 
            </p>
            
            <ul>
               
               <li><span class="packt_screen">UIApplicationShortcutItemIconFile</span>: <kbd>shortcut-map</kbd></li>
               
               <li><span class="packt_screen">UIApplicationShortcutItemTitle</span>: <kbd>Map</kbd></li>
               
               <li><span class="packt_screen">UIApplicationShortcutItemType</span>: <kbd>$(PRODUCTBUNDLEIDENTIFIER).openMap</kbd></li>
               
            </ul>
            
            <p>For <span class="packt_screen">Item 1</span>, set their values as follows: 
            </p>
            
            <ul>
               
               <li><span class="packt_screen">UIApplicationShortcutItemIconFile</span>: <kbd>shortcut-location</kbd></li>
               
               <li><span class="packt_screen">UIApplicationShortcutItemTitle</span>: <kbd>Locations</kbd></li>
               
               <li><span class="packt_screen">UIApplicationShortcutItemType</span>: <kbd>$(PRODUCTBUNDLEIDENTIFIER).openLocations</kbd></li>
               
            </ul>
            
            <p>When you are finished, your file should look like the following:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/3facc9ac-fd95-4103-a7ca-fae200f86e0a.png"/></div>
            
            <p>Save your file, and build and run the project on your device. If you have a MacBook
               or a MacBook Pro with a Force Touch mouse, you can run this in the simulator.
            </p>
            
            <p>If you are building your phone, you might encounter errors. These errors occur because
               you have not built the framework for your phone. Just switch to the framework, then
               hit ⌘ + <em>B</em>, then switch to your <em>iMessages</em> app and do the same again. Then, build and run the project on your device.
            </p>
            
            <p>Once your app launches, hit ⌘ + <em>H</em> (if you are in a simulator) or the home button on your device. 3D Touch  the <em>Let's Eat</em> app icon, and you should now see the following:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="409" src="assets/93d893a3-784e-4b5a-97f2-27a55b383c81.png" width="233"/></div>
            
            <p>If you select <span class="packt_screen">Los Angeles</span> or <span class="packt_screen">Las Vegas</span>, you will see that the location is now set for you at the top. If you select the
               <span class="packt_screen">Map</span> shortcut, you will be taken to the <span class="packt_screen">Map</span> tab. If you select the <span class="packt_screen">Locations</span> shortcut, you will be taken to the <span class="packt_screen">Locations</span> list. We have now added 3D Touch quick actions to our app. Let's add 3D Touch to
               one more place. 
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Adding favorites </h1>
            
         </header>
         
         
         <article>
            
            
            <p>A nice feature for our app would be to use 3D Touch to allow users to add favorites
               to our restaurant list view. We already have the heart  in our restaurant detail page.
               Therefore, let's add 3D Touch to the heart  to add favorites. This is how we want
               it to look when we are finished:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="403" src="assets/f1783136-e1e6-4b46-81db-61016027e18a.png" width="413"/></div>
            
            <p>The first thing we need to do is add a new model object so that we can save our restaurant
               favorites to Core Data.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Creating a new model object  </h1>
            
         </header>
         
         
         <article>
            
            
            <p>Let's look at how to create a new model object:</p>
            
            <ol>
               
               <li>In the Navigator panel, open the <kbd>LetsEatModel.xcdatamodel</kbd> file, which can be found in the Core Data folder in the <kbd>Common</kbd> folder.
               </li>
               
               <li>Make sure that you have the <span class="packt_screen">Graph Style</span> selected:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="454" src="assets/40ffdddf-2c79-4a27-a430-431dcba585dd.png" width="727"/></div>
            
            <ol start="3">
               
               <li>Click the <span class="packt_screen">+</span> button for <span class="packt_screen">Add Entity</span> and then double-click on <span class="packt_screen">Entity</span>, and update it to <span class="packt_screen">Favorite</span>:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="475" src="assets/c6dca44a-1ac3-463d-94d9-7db7b6c75e05.png" width="761"/></div>
            
            <ol start="4">
               
               <li>Next, ensure that the <span class="packt_screen">Favorite</span> entity is selected and click the <span class="packt_screen">+</span> button for <span class="packt_screen">Add Attribute</span>:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="474" src="assets/860d240b-e711-4681-b5d8-99795333476d.png" width="759"/></div>
            
            <ol start="5">
               
               <li>In the box in the center of the screen, under <span class="packt_screen">Attributes</span>, you should now see the word attribute. Double-click on <span class="packt_screen">Attributes</span> and change it to <kbd>restaurantID</kbd>:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="478" src="assets/9f563382-8fa7-41a2-ae93-c8216f1cb426.png" width="766"/></div>
            
            <ol start="6">
               
               <li>Next, select the favorite entity again and then the Data Model inspector in the Utilities
                  panel.
               </li>
               
            </ol>
            
            <p> </p>
            
            <ol start="7">
               
               <li>Under <span class="packt_screen">Class</span>, update the following:
               </li>
               
            </ol>
            
            <ul>
               
               <li>
                  
                  <ul>
                     
                     <li><span class="packt_screen">Name</span>: <kbd>Favorite</kbd></li>
                     
                     <li><span class="packt_screen">Codegen</span>: <kbd>Class definition</kbd></li>
                     
                     <li><span class="packt_screen">Constraints</span>: <kbd>restaurantID</kbd> (you add this constraint by hitting the <span class="packt_screen">+</span> button in <span class="packt_screen">Constraints</span> and then replacing the default constraint, which autopopulates, with this new constraint)
                     </li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <p style="padding-left: 60px">Your entity settings should now look like the following:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="447" src="assets/08935e84-7685-4e92-9ba4-d68533ab91d3.png" width="716"/></div>
            
            <ol start="8">
               
               <li>Finally, select the <kbd>restaurantID</kbd> attribute, and under the Data Model inspector in the Utilities panel, select <span class="packt_screen">Integer 32</span> under <span class="packt_screen">Attribute Type</span>. The error regarding this attribute should now disappear:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="363" src="assets/445c4f82-1fab-471f-819f-7cf4d9478998.png" width="580"/></div>
            
            <p>Now, build the project using ⌘ + <em>B</em>. This will create our <kbd>Favorite</kbd> class that we created in Core Data. You will not see the file anywhere, but it has
               been created.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Updating our Core Data manager </h1>
            
         </header>
         
         
         <article>
            
            
            <p>Now that we have our favorite entity created, we need to update our Core Data manager
               to actually save restaurants as favorites. Inside of the <kbd>CoreData-Manager.swift</kbd> file, add the following before the last curly brace:
            </p>
            <pre>func addFavorite(by restaurantID:Int) {<br/>   let item = Favorite(context: container.viewContext)<br/>   item.restaurantID = Int32(restaurantID)<br/><br/></pre>
            <pre>   save()<br/>}</pre>
            <p>This method creates a <kbd>Favorite</kbd> object and then calls the <kbd>save()</kbd> method.
            </p>
            
            <p>Now, let's add one more method to this file by adding the following before the last
               curly brace:
            </p>
            <pre>func isFavorite(with identifier:Int) -&gt; Bool {<br/>   let moc = container.viewContext<br/>   let request:NSFetchRequest&lt;Favorite&gt; = Favorite.fetchRequest()<br/>   let predicate = NSPredicate(format: "restaurantID = %i", Int32(identifier))<br/>   request.predicate = predicate<br/><br/>   do {<br/>         let count = try moc.count(for: request)<br/>         if count == 0 { return false }<br/>         else { return true }<br/>   } catch {<br/>         fatalError("Failed to fetch reviews: \(error)")<br/>   }<br/>}</pre>
            <p>In this method, we are going to fetch a favorite restaurant by passing a <kbd>restaurantID</kbd>. The method will check Core Data, and if we get data back, that restaurant will be
               set as a favorite. Otherwise, if we get back no data, we return <kbd>false</kbd>. We can now save favorite restaurants.
            </p>
            
            <p>Next, open the <kbd>RestaurantViewController.swift</kbd> file and define a new extension after the extension we created for our Collection
               View by adding the following code:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="202" src="assets/a4852306-ec18-48eb-bf34-737566845e1a.png" width="536"/></div>
            
            <p>Let's discuss what we just added:</p>
            
            <ul>
               
               <li><strong>Part A</strong>: <span>First, we are getting an instance of our <kbd>RestaurantDetail.storyboard</kbd>. Then, we are obtaining a current index path. Once we have an index path, we are
                     checking that we have a cell. Finally, we are creating an instance to our <kbd>RestaurantDetailViewController</kbd>:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">let restaurantDetail : UIStoryboard = UIStoryboard(name: "RestaurantDetail", bundle: nil)<br/>guard let indexPath = collectionView?.indexPathForItem(at: location), let cell = collectionView?.cellForItem(at: indexPath), let detailVC = restaurantDetail.instantiateViewController(withIdentifier: "RestaurantDetail") as? RestaurantDetailViewController else { return nil }</pre>
            <ul>
               
               <li><strong>Part B</strong>: <span>Here, we are setting our <kbd>selectedRestaurant</kbd>, and then, we are passing the <kbd>selectedRestaurant</kbd> over to the detail view. We are then setting the height that we want and passing
                     the cell frame to the previewing context:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">selectedRestaurant = manager.restaurantItem(at: indexPath)<br/>detailVC.selectedRestaurant = selectedRestaurant<br/>detailVC.preferredContentSize = CGSize(width: 0.0, height: 450)<br/>previewingContext.sourceRect = cell.frame</pre>
            <ul>
               
               <li><strong>Part C</strong>: <span>This method is called so that we can prepare the presentation of the view controller,
                     which here is the commit view controller. In our case, we are preparing the <kbd>RestaurantDetailViewController</kbd> to be shown (or <kbd>popped</kbd>):</span></li>
               
            </ul>
            <pre style="padding-left: 60px">func previewingContext(_ previewingContext: UIViewControllerPreviewing, commit viewControllerToCommit: UIViewController) {   <br/>   show(viewControllerToCommit, sender: self)<br/>}</pre>
            <p>Next, open the <kbd>RestaurantDetail.storyboard</kbd> and select the <kbd>RestaurantDetailViewController</kbd>. Open the Identity inspector in the Utilities panel and, in storyboard ID under <span class="packt_screen">Identity</span>, add <kbd>RestaurantDetail</kbd>.
            </p>
            
            <p>Then, hit <em>Enter</em>:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/59f150ed-34d7-4aeb-977f-a968185c1339.png"/></div>
            
            <p>Now, return to the <kbd>RestaurantViewController.swift</kbd> file and add the following code after the <kbd>showRestaurantDetail()</kbd> method:
            </p>
            <pre>func setup3DTouch() {<br/>   if( traitCollection.forceTouchCapability == .available){<br/>         registerForPreviewing(with: self, sourceView: view)<br/>   }<br/>}</pre>
            <p>Here, we need to ensure that our <kbd>RestaurantViewController</kbd> can accept 3D Touch. We need to call this inside of the <kbd>initialize()</kbd> method after our <kbd>if</kbd> statement. We have finished our setup inside of the <kbd>RestaurantViewController</kbd>.
            </p>
            
            <p>Finally, we need to update our <kbd>RestaurantDetailViewController.swift</kbd> file. Open this file and add the following variable above the <kbd>viewDidLoad()</kbd> method:
            </p>
            <pre>override var previewActionItems: [UIPreviewActionItem] {<br/>   let favorite = UIPreviewAction(title: "Favorite", style: .default) { (action, viewController) -&gt; Void in<br/>         let manager = CoreDataManager()<br/>         if let id = self.selectedRestaurant?.restaurantID { manager.addFavorite(by: id) }<br/>   }<br/><br/>   let cancel = UIPreviewAction(title: "Cancel", style: .destructive) { (action, viewController) -&gt; Void in<br/>         print("You hit cancel")<br/>   }<br/><br/>   return [favorite, cancel]<br/>}</pre>
            <p>This variable will allow us to have two actions, <span class="packt_screen">Favorite</span> and <span class="packt_screen">Cancel</span>, when we <kbd>peek</kbd> at a restaurant. If the user taps <span class="packt_screen">Favorite</span>, we will get the <kbd>restaurantID</kbd> and save it to Core Data. If the user taps <span class="packt_screen">Cancel</span>, we will dismiss the view.
            </p>
            
            <p>Next, add the following code above the <kbd>createRating()</kbd> method:
            </p>
            <pre>func checkFavorites() {<br/>   let manager = CoreDataManager()<br/>   if let id = selectedRestaurant?.restaurantID {<br/>         let isFavorite = manager.isFavorite(with: id)<br/>         let btnImage = UIButton()<br/>         btnImage.frame = CGRect(x: 0, y: 0, width: 30, height: 30)<br/>         btnImage.addTarget(self, action: #selector(getter: UIDynamicBehavior.action), for: .touchUpInside)<br/><br/><br/>         if isFavorite {<br/>               btnImage.setImage(UIImage(named: "heart-selected"), for: .normal)<br/>               btnHeart.customView = btnImage<br/>         }<br/>         else {<br/>               btnImage.setImage(UIImage(named: "heart-unselected"), for: .normal)<br/>               btnHeart.customView = btnImage<br/>         }<br/>   }<br/>}</pre>
            <p>This method will now be run whenever we go to a detail view. First, we check Core
               Data to see if the current restaurant is a favorite. If it is a favorite, we will
               show a filled-in heart, and if it is not, we will show a heart with just an outline.
               This method will be called after the <kbd>createRating()</kbd> method inside of the <kbd>initialize()</kbd> method.
            </p>
            
            <p>Build and run the project by hitting the Play button (or use ⌘ + <em>R</em>). When you get to the restaurant list, touch  one of the restaurant items and you
               will see the following:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="549" src="assets/f5154fe8-5462-42e4-8655-a937625c6aca.png" width="294"/></div>
            
            <p>If you swipe up while touching, you will see that we now have two buttons:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="546" src="assets/e491c900-fc78-4026-9ba5-7527ab77f0a1.png" width="311"/></div>
            
            <p>If you tap <span class="packt_screen">Cancel</span>, it will dismiss the view. If you tap <span class="packt_screen">Favorite</span> and select the same restaurant, you will now see that the heart will change to a
               filled-in one.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Summary</h1>
            
         </header>
         
         
         <article>
            
            
            <p>We are officially done with the building of our app. In this chapter, we learned about
               the two different types of 3D Touch quick actions that we can add to our app. We also
               added 3D Touch support to our Collection View. Our restaurant list now has 3D Touch
               support so that we can add favorite restaurants from the restaurants  list.
            </p>
            
            <p>It is now time to move on to the most exciting part of this app, and that is  getting
               our app into the App Store. In the next chapter, we will discuss everything you will
               need to know regarding  how to submit your app to the App Store. 
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   </body></html>