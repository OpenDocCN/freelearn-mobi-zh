<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;1.&#xA0;iOS Game Development"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01" class="calibre1"/>Chapter 1. iOS Game Development</h1></div></div></div><p class="calibre8">Since the launch of iOS devices, game development has always attracted developers in ever-increasing numbers. There are various game engines available in the market, which allow developers to start developing their games for iOS devices.</p><p class="calibre8">In this chapter, we will be focusing on the following topics:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Getting started with the SpriteKit game framework</li><li class="listitem">Developing a mini game using SpriteKit</li></ul></div></div>

<div class="book" title="Chapter&#xA0;1.&#xA0;iOS Game Development">
<div class="book" title="Introduction"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch01lvl1sec09" class="calibre1"/>Introduction</h1></div></div></div><p class="calibre8">Apple has launched its first game engine that allows you to create games for iOS without being dependent on the third-party game libraries. It is a very powerful framework similar to other iOS frameworks and is similar to other frameworks when it comes to its usage. It's also very easy to adopt and learn. It also supports lots of features such as physics simulations, texture atlas, gravity, restitution, animations, particle emitters, game center support, and many more. Moreover, it comes with very rich developer documentation for SpriteKit at the Apple development center. It's very useful and very well written. You might need to understand the anatomy of game development first to get started with game development in <a id="id0" class="calibre1"/>SpriteKit. There are two basic and most important terms here; one is scenes and the other is sprites. Scenes can be considered as the layers in the games. Therefore, in any game there are various layers such as the score layer, hud layer, and gameplay layer that can act as different scenes. However, any object in the scene such as a player or an enemy can be considered as a sprite.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Getting started with the SpriteKit game framework"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec10" class="calibre1"/>Getting started with the SpriteKit game framework</h1></div></div></div><p class="calibre8">With the<a id="id1" class="calibre1"/> release of iOS 7.0, Apple has introduced its own native 2D game framework called SpriteKit. SpriteKit is a great 2D game engine, which has support for sprite, animations, filters, masking, and most important is the physics engine to provide a real-world simulation for the game.</p><p class="calibre8">Apple provides a sample game to get started with the SpriteKit called <a id="id2" class="calibre1"/>Adventure Game. The download URL for this example<a id="id3" class="calibre1"/> project is <a class="calibre1" href="http://bit.ly/Rqaeda">http://bit.ly/Rqaeda</a>.</p><p class="calibre8">This sample<a id="id4" class="calibre1"/> project provides a glimpse of the capability of this framework. However, the project is complicated to understand and for learning you just want to make something simple. To have a deeper understanding of SpriteKit-based games, we will be building a bunch of mini games in this book. To understand the basics of the SpriteKit game programming, we will build a mini <a id="id5" class="calibre1"/>AntKilling game in this chapter.</p></div>

<div class="book" title="Getting started with the SpriteKit game framework">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec13" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre8">To get started with iOS game development, you have the following <a id="id6" class="calibre1"/>prerequisites for SpriteKit:</p><div class="book"><ul class="itemizedlist"><li class="listitem">You will need the Xcode 5.x</li><li class="listitem">The targeted device family should be iOS 7.0+</li><li class="listitem">You should be running OS X 10.8.X or later</li></ul></div><p class="calibre8">If all the above requisites are fulfilled, then you are ready to go with the iOS game development. So let's start with game development using iOS native game framework. We will be building a mini game in the chapter and will be taking it forward in every chapter to add more and more features and enhancements.</p></div></div>

<div class="book" title="Getting started with the SpriteKit game framework">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec14" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre8">Let's start building the <a id="id7" class="calibre1"/>AntKilling game. Perform the following steps to create your new SpriteKit project:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Start your Xcode. Navigate to <span class="strong"><strong class="calibre2">File</strong></span> | <span class="strong"><strong class="calibre2">New</strong></span> | <span class="strong"><strong class="calibre2">Project...</strong></span>.<div class="mediaobject"><img src="../images/00002.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="2">Then <a id="id8" class="calibre1"/>from the <a id="id9" class="calibre1"/>prompt window, navigate to <span class="strong"><strong class="calibre2">iOS</strong></span> | <span class="strong"><strong class="calibre2">Application</strong></span> | <span class="strong"><strong class="calibre2">SpriteKit Game</strong></span> and click on <span class="strong"><strong class="calibre2">Next</strong></span>.<div class="mediaobject"><img src="../images/00003.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="3">Fill all the <a id="id10" class="calibre1"/>project <a id="id11" class="calibre1"/>details in the prompt window and provide <code class="email">AntKilling</code> as the project name with your <span class="strong"><strong class="calibre2">Organization Name</strong></span>, device as <span class="strong"><strong class="calibre2">iPhone</strong></span>, and <span class="strong"><strong class="calibre2">Class Prefix</strong></span> as <code class="email">AK</code>. Click on <span class="strong"><strong class="calibre2">Next</strong></span>.<div class="mediaobject"><img src="../images/00004.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="4">Select a <a id="id12" class="calibre1"/>location on the drive to save the project and click on <span class="strong"><strong class="calibre2">Create</strong></span>.</li><li class="listitem" value="5">Then build<a id="id13" class="calibre1"/> the sample project to check the output of the sample project. Once you build and run the project with the play button, you should see the following on your device:<div class="mediaobject"><img src="../images/00005.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div></div></div>

<div class="book" title="Getting started with the SpriteKit game framework">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch01lvl2sec15" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre8">The following are the observations<a id="id14" class="calibre1"/> of the starter project:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">As you have seen, the sample project of SpriteKit plays a label with a background color.</li><li class="listitem" value="2">SpriteKit works on the concept of scenes, which can be understood as the layers or the screens of the game. There can be multiple scenes working at the same time; for example, there can be a gameplay scene, hud scene, and the score scene running at the same time in the game.</li></ol><div class="calibre14"/></div><p class="calibre8">Now we can look into the project for more <a id="id15" class="calibre1"/>detail arrangements of the starter project. The following are the observations:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">In the main directory, you already have one scene created by default called <span class="strong"><strong class="calibre2">AKMyScene</strong></span>.</li><li class="listitem" value="2">Now click on <code class="email">AKMyScene.m</code> to explore the code to add the label on the screen. You should see something similar to the following screenshot:<div class="mediaobject"><img src="../images/00006.jpeg" alt="How it works..." class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="3">Now we will be updating this file with our code to create our AntKilling game in the next sections.</li><li class="listitem" value="4">We have to <a id="id16" class="calibre1"/>fulfill a few prerequisites to get started with the code, such as locking the orientation to landscape as we want a landscape orientation game.</li><li class="listitem" value="5">To change the orientation of the game, navigate to AntKilling project settings | <span class="strong"><strong class="calibre2">TARGETS</strong></span> | <span class="strong"><strong class="calibre2">General</strong></span>. You should see something similar to the following screenshot:<div class="mediaobject"><img src="../images/00007.jpeg" alt="How it works..." class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="6">Now in the <a id="id17" class="calibre1"/><span class="strong"><strong class="calibre2">General</strong></span> tab, uncheck <span class="strong"><strong class="calibre2">Portrait</strong></span> from the device orientation so that the final settings should look similar to the following screenshot:<div class="mediaobject"><img src="../images/00008.jpeg" alt="How it works..." class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="7">Now build and run the project. You should be able to see the app running in landscape orientation.<div class="mediaobject"><img src="../images/00009.jpeg" alt="How it works..." class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="8">The <a id="id18" class="calibre1"/>bottom-right corner of the screen shows the number of nodes with the frame rate.</li></ol><div class="calibre14"/></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Developing a mini game using SpriteKit"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch01lvl1sec11" class="calibre1"/>Developing a mini game using SpriteKit</h1></div></div></div><p class="calibre8">Now you <a id="id19" class="calibre1"/>have learned enough about SpriteKit. To explore this in more depth, let's create a mini game that will help you to<a id="id20" class="calibre1"/> understand the concepts in much more detail. We are going to create an AntKilling game. In this game, we will place an ant on the screen; the ant will animate when you click on it.</p></div>

<div class="book" title="Developing a mini game using SpriteKit">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch01lvl2sec16" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre8">We will use the project we created in the previous section. To create a mini game, we will have to update the source files we have got with the starter project. Now it's time to update AKMyScene to hold our ant sprites.</p><p class="calibre8">Before getting into the steps to update the code, download all the resources for this chapter and check for the <code class="email">assets</code> folder, which has all the images used in this project.</p></div></div>

<div class="book" title="Developing a mini game using SpriteKit">
<div class="book" title="How to do it..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch01lvl2sec17" class="calibre1"/>How to do it...</h2></div></div></div><p class="calibre8">Execute the<a id="id21" class="calibre1"/> following steps sequentially to create a mini game:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open the <code class="email">Resources</code> folder and add them to your Xcode project.</li><li class="listitem" value="2">While <a id="id22" class="calibre1"/>adding the resources to the Xcode, make sure that the selected target is <span class="strong"><strong class="calibre2">AntKilling</strong></span> and <span class="strong"><strong class="calibre2">Copy items into destination group's folder (if needed)</strong></span> is checked.<div class="mediaobject"><img src="../images/00010.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="3">Now delete all the existing code from <code class="email">AKMyScene.m</code> and make it look similar to the following screenshot:<div class="mediaobject"><img src="../images/00011.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="4">Now, firstly, we<a id="id23" class="calibre1"/> have <a id="id24" class="calibre1"/>created a private interface to declare private variables:<div class="informalexample"><pre class="programlisting">@interface AKMyScene ()
@property (nonatomic) SKSpriteNode *ant;
@end</pre></div></li><li class="listitem" value="5">Then, in the <code class="email">init</code> method, we have printed a log to print the size of the screen:<div class="informalexample"><pre class="programlisting">NSLog(@"Size: %@", NSStringFromCGSize(size));</pre></div></li><li class="listitem" value="6">Now we will change the screen background color to white using the following line of code:<div class="informalexample"><pre class="programlisting">self.backgroundColor = [SKColor colorWithRed:1.0 green:1.0 blue:1.0 alpha:1.0];</pre></div></li><li class="listitem" value="7">Then we will change the screen background color to white using the <code class="email">backgroundColor</code> property in the following line of code.<div class="informalexample"><pre class="programlisting">self.backgroundColor = [SKColor colorWithRed:1.0 green:1.0 blue:1.0 alpha:1.0];</pre></div></li><li class="listitem" value="8">In the following line of code, we are creating a sprite object using the <code class="email">spriteNodeWithImageNamed</code> method and passing the image name to the same. Then we have positioned it to <code class="email">100, 100</code> of the screen, which is in the bottom-left corner of the screen. Then finally we have added it as a child.<div class="informalexample"><pre class="programlisting">self.ant = [SKSpriteNode spriteNodeWithImageNamed:@"ant.jpg"];
self.ant.position = CGPointMake(100, 100);
[self addChild:self.ant];</pre></div></li></ol><div class="calibre14"/></div><div class="informalexample" title="Note"><h3 class="title2"><a id="tip02" class="calibre1"/>Tip</h3><p class="calibre8">
<span class="strong"><strong class="calibre2">Downloading the example code</strong></span>
</p><p class="calibre8">You can download the example code files from your account at <a class="calibre1" href="http://www.packtpub.com">http://www.packtpub.com</a> for all the Packt Publishing books you have purchased. If you purchased this book elsewhere, you can visit <a class="calibre1" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div><p class="calibre8">In games, we <a id="id25" class="calibre1"/>have to keep two sets of images, one<a id="id26" class="calibre1"/> for the normal display and the second for the retina display. In the preceding block of code, we have provided the name of the sprite as <code class="email">ant.jpg</code>, which is going to autoreference to <code class="email">ant@2x.jpg</code> for the retina devices.</p><p class="calibre8">Now build and run your application; you should see something similar to the following screenshot:</p><div class="mediaobject"><img src="../images/00012.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">Now as you can see, the screen color has changed to white but there is no ant on the screen. This means something has gone wrong in the code. So, now let's check our logs, which should be printing the following:</p><div class="informalexample"><pre class="programlisting">2014-07-22 19:13:27.019 AntKilling[1437:60b] Size: {320, 568}</pre></div><p class="calibre8">So the scene size is <a id="id27" class="calibre1"/>wrong. The scene should print 568 as the width and 320 as the height but it's printing the opposite. To debug this, navigate to your <code class="email">AKViewController.m</code> <code class="email">viewDidLoad</code> method. You can find the complete code for this function at <code class="email">AntKilling/AntKilling/AKViewController.m</code>.</p><p class="calibre8">So, from this method, we can see that our scene is absorbing the size from the bounds of the view and <a id="id28" class="calibre1"/>this <code class="email">viewDidLoad</code> method is invoked even before the view has been added to the view hierarchy. So it has not responded to the layout changes. Thus, because of the inconsistent view bounds our scene is getting started with wrong bounds.</p><p class="calibre8">To solve this issue, we have to move the scene startup code in the <code class="email">viewWillLayoutSubviews</code> method. After removing the code from the <code class="email">viewDidLoad</code> method and pasting it to <code class="email">viewWillLayoutSubviews</code>, you can find the complete code for this function at <code class="email">AntKilling/AntKilling/AKViewController.m</code>.</p><p class="calibre8">Now, once again build and run the app; you should see the following output:</p><div class="mediaobject"><img src="../images/00013.jpeg" alt="How to do it..." class="calibre10"/></div><p class="calibre11"> </p></div></div>

<div class="book" title="Developing a mini game using SpriteKit">
<div class="book" title="How it works..."><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch01lvl2sec18" class="calibre1"/>How it works...</h2></div></div></div><p class="calibre8">So, congrats! You have fixed the issue. Your ant has now appeared on the screen at the given location. If you observe closely, you can see that the status bar is at the top of the game, which does not look great. To remove the status bar from the screen, open your <code class="email">AntKilling-Info.plist</code> file and add an <code class="email">UIViewControllerBasedStatusBarAppearance</code> attribute with value <code class="email">NO</code>. Your <code class="email">.plist</code> file should look<a id="id29" class="calibre1"/> like the following screenshot:</p><div class="mediaobject"><img src="../images/00014.jpeg" alt="How it works..." class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">Build and run<a id="id30" class="calibre1"/> your project again; you should be able to see the game without the status bar now:</p><div class="mediaobject"><img src="../images/00015.jpeg" alt="How it works..." class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">This looks perfect now; our ant has been residing on the screen as expected. So now our next objective is to animate the ant when we tap on it. To accomplish this, we need to add the following code in the <code class="email">AKMyScene.m</code> file, just below your <code class="email">initWithSize</code> method:</p><div class="informalexample"><pre class="programlisting">- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event
{
  UITouch *touch = [touches anyObject];
  CGPoint positionInScene = [touch locationInNode:self];
  SKSpriteNode *touchedNode = (SKSpriteNode *)[self nodeAtPoint:positionInScene];
  if (touchedNode == self.ant) {
    SKAction *sequence = [SKAction sequence:@[[SKAction rotateByAngle:degreeToRadian(-3.0f) duration:0.2],
    [SKAction rotateByAngle:0.0 duration:0.1],
    [SKAction rotateByAngle:degreeToRadian(3.0f) duration:0.2]]];
    [touchedNode runAction:[SKAction repeatActionForever:sequence]];
  }
}

float degreeToRadian(float degree) {
  return degree / 180.0f * M_PI;
}</pre></div><p class="calibre8">You can find the<a id="id31" class="calibre1"/> complete code for this function at <code class="email">AntKilling/AntKilling/AKMyScene.m</code>.</p><p class="calibre8">So, now let's go line-by-line to understand what we have done so far. To begin with, we have added the <code class="email">- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event</code> method to the grab all the touches on the scene.</p><p class="calibre8">Now in the <a id="id32" class="calibre1"/>function the first line allowed you to grab touch using <code class="email">CGPoint positionInScene = [touch locationInNode:self];</code>.</p><p class="calibre8">In the next line, we grabbed the touch and converting it to the <code class="email">CGPoint positionInScene = [touch locationInNode:self];</code> location.</p><p class="calibre8">In the following line, we fetched the sprite, which has been touched:</p><div class="informalexample"><pre class="programlisting">SKSpriteNode *touchedNode = (SKSpriteNode *)[self nodeAtPoint:positionInScene];</pre></div><p class="calibre8">Now, once you have the sprite object, compare and check whether the select object is the ant bug. If it's the ant bug, then animate the object by adding the following line of code:</p><div class="informalexample"><pre class="programlisting">SKAction *sequence = [SKAction sequence:@[[SKAction rotateByAngle:degreeToRadian(-3.0f) duration:0.2],[SKAction rotateByAngle:0.0 duration:0.1],[SKAction rotateByAngle:degreeToRadian(3.0f) duration:0.2]]];
[touchedNode runAction:[SKAction repeatActionForever:sequence]];</pre></div><p class="calibre8">Using the <code class="email">SKAction</code> class, you can execute various sequence of animations such as <code class="email">rotation</code>, <code class="email">moveBy</code>, <code class="email">moveTo</code>, and so on. Also all the rotate methods accept the angle in radians. So to achieve the rotation, we must convert the degree to radians before passing to any <code class="email">rotate</code> function.</p><p class="calibre8">Now, this code <a id="id33" class="calibre1"/>will animate the selected sprite. Build and run the project and you will see the ant animating on tap.</p><p class="calibre8">You will soon notice that <a id="id34" class="calibre1"/>on tapping the ant, it starts animating, but there is no way to stop this. So now let's add a way to stop this animation once you click anywhere on the scene. Navigate to the <code class="email">- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)</code> event method, and update it to the following code:</p><div class="informalexample"><pre class="programlisting">- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event
{
  UITouch *touch = [touches anyObject];
  CGPoint positionInScene = [touch locationInNode:self];
  SKSpriteNode *touchedNode = (SKSpriteNode *)[self nodeAtPoint:positionInScene];
  if (touchedNode == self.ant) {
    SKAction *sequence = [SKAction sequence:@[[SKAction rotateByAngle:degreeToRadian(-3.0f)duration:0.2],
    [SKAction rotateByAngle:0.0 duration:0.1],
    [SKAction rotateByAngle:degreeToRadian(3.0f) duration:0.2]]];
    [touchedNode runAction:[SKAction repeatActionForever:sequence]];
  } else {
  [self.ant removeAllActions];
  }
}</pre></div><p class="calibre8">Now if you observe closely, you can see that we have added an <code class="email">if-else</code> condition to check whether the touch is made on the ant, which allows it to animate; when the touch is made anywhere outside the screen, stop all the actions. To stop all the actions on the sprite, we can use the <code class="email">removeAllActions</code> method on the sprite.</p></div></div></body></html>