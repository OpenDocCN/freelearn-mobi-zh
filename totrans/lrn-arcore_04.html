<html><head></head><body>
        

                            
                    <h1 class="header-title">ARCore on the Web</h1>
                
            
            
                
<p class="mce-root">Previously, most AR development would need to be done on a native installed app. Except, with the advent of ARCore, Google has added support for AR development on the web, which, allows users to access AR applications through a browser. Of course, AR web applications may never be as robust or feature rich as a similar app done with Android or Unity. Yet ARCore extends its browser support to include iOS as well as Android. So if you need a cross-platform AR app, then you likely want to focus on ARCore web development.</p>
<p>In this chapter, we continue our work of setting up our environment for ARCore web development. Listed here are the main topics we will cover in this chapter:</p>
<ul>
<li>Installing WebARonARCore </li>
<li>Installing Node.js</li>
<li>Exploring the samples</li>
<li>Debugging web apps on Android</li>
<li>3D and three.js</li>
</ul>
<p>Even if you have no interest in web development, you should still review this chapter. We will be using elements from this chapter in the final project, <a href="6a8f64fb-080f-47a2-9565-4099269831b1.xhtml" target="_blank">Chapter 10</a>, <em>Mixing in Mixed Reality</em>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Installing WebARonARCore</h1>
                
            
            
                
<p>In order to run ARCore from the web, we also need a browser that supports ARCore or ARKit. At the time of writing (beta preview), no browser supports ARCore or ARKit, and therefore, we need to install a special or experimental browser. The experimental browser we will install is called WebARonARCore.</p>
<p>At the time of writing, Google ARCore is in the beta preview. If Google ARCore is in full release (1.0) and supported in a browser on your device, then you can bypass this section.</p>
<p>Installing WebARonARCore is quite simple and just requires you to point a browser on your device and install an APK. Follow the given steps to install WebARonARCore:</p>
<ol>
<li>Point a browser on your device to <a href="https://github.com/google-ar/WebARonARCore">https://github.com/google-ar/WebARonARCore</a> or just Google <kbd>git WebARonARCore</kbd>.</li>
<li>Follow the instructions in the <kbd>README</kbd> file to find and click on the WebARonARCore APK download link. This will download the APK to your device. If you get a security warning about the APK file type, just bypass it.</li>
<li>Click on Open after the file downloads. If your device is set to block installation of apps from unknown sources, you will get a warning. To bypass the warning, do this:
<ol>
<li>Tap on Settings.</li>
<li>Tap on Unknown sources to enable it.</li>
</ol>
</li>
<li>Click on Install to install the APK to your device.</li>
<li>Locate the WebARonARCore app on your device and open it.</li>
<li>Tap on Allow, through the security warnings.</li>
</ol>
<p>This will launch the WebARCore experimental browser and point it at the same GitHub page we pulled the APK from. Leave the app open on your device as we will use it in an upcoming section. In the next section, we will learn to install Node.js.</p>
<p>You can test your web development on an iOS device by installing WebARonARKit. Unfortunately, the code for WebARonARKit source must be built, compiled, and deployed manually. These steps are not covered in this book, but if you are interested in setting up for an iOS device, follow <a href="https://github.com/google-ar/WebARonARKit">https://github.com/google-ar/WebARonARKit</a>.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Installing Node.js</h1>
                
            
            
                
<p>Unlike the other platforms, we don't need to install anything more on the device to use an AR web app. However, we do need a way to serve up our web application pages to a device. Typically, this is done with a web server, like IIS, Tomcat, Jetty, Node, or others. For our purpose, we just need a simple HTTP server to serve up static HTML content. Fortunately, Node provides a package just for running a simple HTTP server from a folder. In order to get this package, we first need to install Node. Follow the given steps to install Node:</p>
<ol>
<li>Download and install the <strong>Long Term Support</strong> (<strong>LTS</strong>) version of Node.js from <a href="http://nodejs.org">Nodejs.org</a>. Just follow the instructions on the page and installer. Ensure that you set the <kbd>PATH</kbd> when installing to Windows.</li>
</ol>
<p>Node.js is a lightweight, non-blocking, and event-driven JavaScript runtime built on top of Chrome's JavaScript runtime. It has become hugely popular due to its massive library of modules or packages. We are installing Node.js just to use a Node.js package.</p>
<ol start="2">
<li>Open Command Prompt or shell and enter the following:</li>
</ol>
<pre style="padding-left: 60px"><strong>npm</strong></pre>
<ol start="3">
<li>If you have everything installed correctly, you should see a message showing the <kbd>npm</kbd> usage.</li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">The Node Package Manager</h1>
                
            
            
                
<p><strong>Node Package Manager</strong> (<strong>npm</strong>) is a command-line tool used to install the packages for Node.js. We will use this tool to download and install our simple HTTP server. Follow the given steps to install the HTTP server:</p>
<ol>
<li>From your device, open Command Prompt or shell and enter this:</li>
</ol>
<pre style="padding-left: 60px"><strong>npm install http-server -g</strong></pre>
<ol start="2">
<li>This will download and install <kbd>http-server</kbd> as a global tool. Now, let's test it.</li>
</ol>
<ol start="3">
<li>Use your Command Prompt or shell and change your folder to <kbd>Android</kbd>, like this:</li>
</ol>
<pre style="padding-left: 60px">//WINDOWS<br/><strong>cd c:\Android</strong></pre>
<ol start="4">
<li>Run <kbd>http-server</kbd> from the <kbd>Android</kbd> folder by entering the following:</li>
</ol>
<pre style="padding-left: 60px"><strong>http-server -p 9999</strong></pre>
<ol start="5">
<li>You will see a list of endpoint URLs. Choose an endpoint that is on the same subnet as your Wi-Fi, the same subnet as your device. Copy or write down the text of the endpoint, as shown in the following excerpt:</li>
</ol>
<div><img src="img/40a69ca4-c713-4fbb-9759-19c44cf7b720.png" style="font-family: 'Times New Roman', times, serif;font-size: 10pt;text-align: center;"/></div>
<p>Picking an endpoint URL</p>
<ol start="6">
<li>Open a web browser on your device and enter the endpoint you selected in the preceding step. After you start making connections, you will see the log output shown in the preceding screen excerpt.</li>
</ol>
<p>If you are unable to connect with your device, ensure that you are entering the full endpoint including the protocol, <kbd>http://192.168.1.118:9999</kbd> in the example, but your endpoint will likely be different. Ensure that you allow any exceptions in your firewall for port <kbd>9999</kbd>. Alternatively, you can turn off your firewall for testing. Just don't leave it off.</p>
<ol start="7">
<li>You should see the <kbd>Android</kbd> folder listing in your browser, as we have configured our server to just list the contents of the <kbd>Android</kbd> folder. The following is an example of how this will look in your browser:</li>
</ol>
<div><img src="img/7d5d6dae-e1c7-41a6-a915-549ab5c6fbfc.png" style="font-family: 'Times New Roman', times, serif;font-size: 10pt;text-align: center;width:27.75em;height:18.00em;"/></div>
<p>Browser showing the Android folder listing</p>
<p>Good! Now we have a way to simply server up any static web pages we need. In the next section, we will pull down the web ARCore examples and review them.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Exploring the samples</h1>
                
            
            
                
<p>Now that we have an AR-enabled web browser, we can proceed to exploring some examples. Follow the instructions in the mentioned steps to explore the samples:</p>
<ol>
<li>Open Command Prompt or shell to the <kbd>Android</kbd> folder and enter this:</li>
</ol>
<pre style="padding-left: 60px"><strong>git clone https://github.com/google-ar/three.ar.js.git</strong></pre>
<ol start="2">
<li>Ensure that your <kbd>http-server</kbd> web browser is running from the <kbd>Android</kbd> folder. If you need to start the server again, just run the command from the last exercise.</li>
<li>Point your web AR-enabled browser (WebARCore) on your device to a valid endpoint URL. Again, check the last exercise if you forgot how to do this. If the page goes black or is unresponsive, you may have to reset the app. Just shut down the WebARCore browser app and restart it.</li>
</ol>
<ol start="4">
<li>Browse to the <kbd>three.ar.js/examples/</kbd> folder. Inside this folder, you will find a set of example HTML pages of AR apps developed with <kbd>three.js</kbd> and <kbd>three.ar.js</kbd>. The following table outlines each of the examples, with a description of what they do:</li>
</ol>
<table>
<tbody>
<tr>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>Page</strong></p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>Description</strong></p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign"><strong>Concepts</strong></p>
</td>
</tr>
<tr>
<td>
<div><kbd>boilerplate.html</kbd></div>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">A simple project for building on</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">Basic</p>
</td>
</tr>
<tr>
<td>
<div><kbd>graffiti.html</kbd></div>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">Touch interaction and drawing in AR</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">Touch, environment</p>
</td>
</tr>
<tr>
<td>
<div><kbd>record-at-camera.html</kbd></div>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">Record 3D spatial audio at a point</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">Touch, spatial audio</p>
</td>
</tr>
<tr>
<td>
<div><kbd>reticle.html</kbd></div>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">Tracks the pose of a surface</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">Motion, pose tracking – environment</p>
</td>
</tr>
<tr>
<td>
<div><kbd>spawn-at-camera.html</kbd></div>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">Touch spawn an object at the camera position</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">Touch, environment</p>
</td>
</tr>
<tr>
<td>
<div><kbd>spawn-at-surface.html</kbd></div>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">Touch spawn object on a identified surface or plane</p>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">Touch, environment</p>
</td>
</tr>
<tr>
<td>
<div><kbd>surfaces.html</kbd></div>
</td>
<td>
<p class="CDPAlignCenter CDPAlign">Identifies surfaces or planes in the environment</p>
</td>
<td>
<p class="mce-root CDPAlignCenter CDPAlign">Environment</p>
</td>
</tr>
</tbody>
</table>
<p>At the time of writing these were the examples available. There likely will be some new samples added that have some of the newer features or other ways of doing things. Be sure to check your folder and spend some time exploring each of those samples.</p>
<ol start="5">
<li>Browse through each of the samples on your device. These samples are excellent examples of the concepts we will cover in the later chapters.</li>
</ol>
<p>If the screen goes black while running the WebAR browser, then just force close the app and restart it. What typically happens is that Chrome's <strong>Developer tools</strong> (<strong>DevTools</strong>) and the app get out of sync and just need to be restarted.</p>
<p>We now have an HTTP server running on our development machine serving up web AR apps to our device. This is great, but how will we edit the code and debug? Being able to debug code will also be critical to our success when we start writing new code. Therefore, in the next section, we will learn how to set up remote web debugging to an Android device.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Debugging web apps on Android</h1>
                
            
            
                
<p>As we mentioned at the end of the last section, debugging/logging will be critical for us when we start writing new code. If you have ever tried to fix an issue blind without a log or ability to debug, then you will quickly appreciate the value of a good debugger. As it so happens, Chrome has a great set of tools that will help us do just that. Work through the following steps to set up remote web debugging on your Android device:</p>
<ol>
<li>Connect your device to your computer with a USB.</li>
<li>Open Command Prompt window.</li>
<li>Validate your connection by entering this:</li>
</ol>
<pre style="padding-left: 60px"><strong>adb devices</strong></pre>
<ol start="4">
<li>The output of that command should show your connected device. You may be able to get away with bypassing this step, but you can avoid plenty of frustration later by just running this simple check.</li>
<li>Ensure that all instances of the Chrome browser on your Android device are shut down.</li>
<li>Open an instance of the WebARCore browser. Remember that this browser is just an experimental extension of Chrome.</li>
<li>Using the open browser, navigate to one of the samples. It really doesn't matter which just yet. This example will use <kbd>spawn-at-camera.html</kbd>.</li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">Connecting Chrome Developer tools</h1>
                
            
            
                
<p>So, believe it or not, we are connected and ready to debug at this point. Now, we just need to set up our debugging tools on the development machine:</p>
<ol>
<li>Open Chrome on your development machine. If you don't have Chrome installed, you will need to do this. Of course, if you are reading a book on Google ARCore, you likely already have Chrome installed, right?</li>
<li>Open the Chrome Developer tools by pressing <em>command</em> + <em>option</em> + <em>I</em> (Mac), <em>Ctrl</em> + <em>Shift</em> + <em>I</em> (Windows, Linux), or from the menu: More tools | Developer tools.</li>
</ol>
<ol start="3">
<li>From Chrome's Developer tools menu, select More tools | Remote devices, as shown:</li>
</ol>
<div><img src="img/42c433e0-1784-4d5b-afc5-75e40855d0de.png" style="font-family: 'Times New Roman', times, serif;font-size: 10pt;text-align: center;width:52.17em;height:27.83em;"/></div>
<p>Locating the remote debugging menu option</p>
<ol start="4">
<li>A new tab, Remote devices, will open and should show your connected device, as follows:</li>
</ol>
<div><img src="img/9b0e8bfc-a2e5-4f6f-800a-49ac690bca03.png" style="font-family: 'Times New Roman', times, serif;font-size: 10pt;text-align: center;width:50.58em;height:15.00em;"/></div>
<p>The Remote devices tab showing the connected device and page</p>
<ol start="5">
<li>At the bottom of the tab, you should see the address you are currently pointing to on your device. If this is not the case, there may be a text box allowing you to manually enter it and then connect.</li>
<li>Click on the Inspect button. This will open a new Chrome window with Developers Tools on one side and an image of your device on the other.</li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">Debugging with Chrome</h1>
                
            
            
                
<p>At this point, if you have experience using the Chrome DevTools, you are good to start debugging. Of course, if this is all relatively new to you, follow the given steps to learn how to debug in DevTools:</p>
<ol>
<li>Switch your view to the Chrome window we opened in the last section.</li>
<li>Click on the Sources tab of the DevTools window.</li>
<li>Select <kbd>spawn-at-camera.html</kbd> or the one you used in your testing.</li>
<li>Scroll down through the HTML and JavaScript until you see the <kbd>onClick()</kbd> function.</li>
<li>Click on the line number 229 (229 in the example, but yours may differ), just left of the highlighted code to set a break point. This is also demonstrated in the following excerpt:</li>
</ol>
<div><img src="img/e3862532-e405-482e-892d-d63ce9f4ebaa.png" style="font-family: 'Times New Roman', times, serif;font-size: 10pt;text-align: center;"/></div>
<p>Setting a JavaScript break point</p>
<ol start="6">
<li>Switch back to the device that is running the app. Touch on the screen to spawn an object. When you do this, your app should display a Paused in debugger message at the top and then graciously freeze.</li>
<li>Switch back to your development machine and the Developer Tools window. You will see the app paused at your break point. Now, you can use your mouse to hover over code to inspect variables and anything else you may be debugging.</li>
</ol>
<p>Feel free to explore setting other break points and even stepping through the code. We will leave it up to the reader to explore more of the DevTools functionality on their own.</p>
<p>Now you can remote debug an AR web app running on your device. This also completes most of our initial basic setup. We can now get into the details of working with AR in 3D, starting in the next section.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">3D and three.js</h1>
                
            
            
                
<p>We live in a 3D world. Therefore, for us to convincingly fool our users into believing that their reality is being augmented or altered, we need to work with their world in three dimensions. Now, each of the platforms we are working with (web, Android, and Unity), all have 3D engines we will be using. In the case of Unity, it is the 3D engine and without a doubt the easiest to use with little or no programming or math knowledge required. Android and OpenGL ES is a distant second, as it will require some knowledge of 3D math. The third and last option is our 3D engine for web, which will be <kbd>three.js</kbd> library. The <kbd>three.js</kbd> will be the most difficult platform to work with when using 3D, which makes it our perfect candidate to start with.</p>
<p>The Unreal platform, as we mentioned in <a href="0286da30-b952-456e-9a59-75cd7a909933.xhtml" target="_blank">Chapter 1</a>, <em>Getting Started</em>, is another ARCore platform option. Unreal is similar to Unity in the manner that it provides great tools to work in 3D, although those tools are more technical and will require understanding of 3D maths to be successful.</p>
<p>Unlike in the previous chapters, we will not do just a simple text change to test our ability to change and deploy code. Instead, in this section, we will modify the 3D object we spawn. This will be a good dive into the deep end of 3D and get us ready for the rest of the book. Let's get started by following the given steps:</p>
<ol>
<li>Use a text editor such as Notepad, Notepad++, vi, or something else to open the <kbd>spawn-at-camera.html</kbd> file located in the <kbd>Android/three.ar.js/example</kbd> folder.</li>
<li>Scroll down in the code until you see the following section:</li>
</ol>
<pre style="padding-left: 60px">var geometry = new THREE.BoxGeometry( 0.05, 0.05, 0.05 );<br/>var faceIndices = ['a', 'b', 'c'];<br/>for (var i = 0; i &lt; geometry.faces.length; i++) <br/>{<br/>  var f  = geometry.faces[i];<br/>  for (var j = 0; j &lt; 3; j++) <br/>{<br/>    var vertexIndex = f[faceIndices[ j ]];<br/>    f.vertexColors[j] = colors[vertexIndex];<br/>  }<br/>}<br/>var material = new THREE.MeshBasicMaterial({ vertexColors:       <br/>                                           THREE.VertexColors });</pre>
<ol start="3">
<li>Comment out or delete the entire section of code. Use <kbd>//</kbd> to convert a line as a comment.</li>
<li>Enter the new code just before the highlighted line:</li>
</ol>
<pre style="padding-left: 60px">var geometry = new THREE.TorusGeometry( 10, 3, 16, 100 );<br/>var material = new THREE.MeshBasicMaterial( { color: 0xffff00 } );<br/><strong>cube = new THREE.Mesh(geometry, material);</strong></pre>
<ol start="5">
<li>This first new line replaces the geometry with a torus. The <kbd>TorusGeometry</kbd> is a helper function for creating a torus. There are plenty of other helpers for creating many other geometries or even loading mesh objects. The second line creates a new basic single color material. Then, it wraps that material around the geometry and creates our object (mesh), which for now, we will keep calling cube. If you feel the need to change the variable name, then by all means go ahead, but do be careful.</li>
<li>Save your code changes.</li>
</ol>
<ol start="7">
<li>Switch back to your device and refresh the page. Then, tap the screen to spawn the new object. At first, you may think that nothing worked; walk away and move around. You will likely only see the edges of a very large bright yellow torus. If you still have some issues, just ensure that you saved changes and try reconnecting everything.</li>
</ol>
<p>At this point, we have a number of problems to understand and solve, as outlined in the following list:</p>
<ul>
<li>The object is too big or out of scale</li>
<li>The object is orientated or rotated wrong</li>
<li>The object needs to be moved or transformed to just in front of the camera</li>
<li>We want to change the color</li>
</ul>


            

            
        
    

        

                            
                    <h1 class="header-title">Understanding left- or right-handed coordinate systems</h1>
                
            
            
                
<p>While a good understanding of 3D math will certainly be helpful, it isn't entirely essential. All you need to know, for now, is that we define an object in three dimensions (hence, 3D) using a common notation of x, y, and z, where x is the position along the <em>x</em> axis, y along <em>y</em> axis, and z along <em>z</em> axis. Furthermore, we define the position of these axes using a term called left-handed or right-handed coordinate system, as shown in the following diagram:</p>
<div><img src="img/a465e4c5-b6ca-4006-a40e-1aa9ad2ebc5d.png" style="width:25.92em;height:19.58em;"/><br/>
<br/>
Definition of left-handed and right-handed coordinate systems</div>
<p>Hold up your left hand, as shown in the preceding diagram, and point your middle finger at the screen. Your thumb now points to positive x, your index finger points to positive y, and your middle finger to positive z. Many times, to avoid confusion between left- or right-hand systems, we will just denote the axis by the direction they are pointing. Thus, right is used for positive x, up for positive y, and forward for positive z. Fortunately, for all of our platforms, we will use the left-hand coordinate system.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">3D scale, rotation, and transformation</h1>
                
            
            
                
<p>The next thing we need to understand is how to apply scale, rotation, and transformation to an object and thus solve the problems we identified. Without getting deep into the math, let's just understand what those terms mean:</p>
<ul>
<li><strong>Scale</strong>: It allows us to define how large or small an object is. In our example, our object is too big and thus we need to scale the object down. We will learn how to do that shortly.</li>
<li><strong>Rotation</strong>: It defines how an object is orientated or posed. We will use both terms interchangeably. Rotation is a bit more complex, and we won't worry about it for this example.</li>
<li><strong>Transformation</strong>: It defines the position of an object, where a position of 0,0,0 represents the origin. In our example, we want to position the torus slightly in front of the camera.</li>
</ul>
<p>We use a mathematical concept called a matrix to apply operations of scale, rotation, and transformation to a 3D object in 3D space. The cool thing about matrices is that they can represent all three operations of scale, rotation, and transformation simultaneously. However, this also means that we have to be careful about the order in which we apply these operations. Let's get back into the code and see how we can apply each of these operations to our torus:</p>
<ol>
<li>Open up your text editor to the <kbd>spawn-at-camera.html</kbd> example.</li>
<li>Scroll to the highlighted code and enter the following lines right after it:</li>
</ol>
<pre style="padding-left: 60px">scene.add(clone); //near the bottom of the file<br/>clone.scale.copy(new THREE.Vector3(.15,.15,.15));<br/>clone.position.copy(new THREE.Vector3(0,0,10));</pre>
<ol start="3">
<li>Comment out the line of code beneath that, like this:</li>
</ol>
<pre style="padding-left: 60px">//clone.position.copy(pos);</pre>
<ol start="4">
<li>Save your work and run the app in your device. You can now see how we move and scale our spawned object. Feel free to try and move, scale, and even rotate the object further.</li>
</ol>
<p>As for changing the color from that blinding yellow to something else more appealing, we leave that up to the reader for their homework. Here's the line of code that needs to be changed:</p>
<pre>var material = new THREE.MeshBasicMaterial( { color: 0xffff00 } );</pre>
<p>If you struggled with any of the material in the last section, you really should pick up a book, read a blog/wiki, or take a course on 3D and/or 3D math. Another good option for learning 3D concepts is working with 3D modeling software like Blender, SketchUp, Max, and so on.</p>
<p>We will, of course, cover more 3D concepts throughout the book and in much more detail in the later chapters. For now though, if this is your first exposure to 3D programming, welcome aboard and get ready for a bumpy ride.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Summary</h1>
                
            
            
                
<p>In this chapter, we completed the last of our major setup tasks for the ARCore environments we will explore in later chapters. We first jumped in and installed the prerequisite AR-enabled experimental Chrome browser. Then, we downloaded and installed Node.js as a requirement for running a simple HTTP server. This gave us the ability to pull the examples from the <kbd>three.ar.js</kbd> source onto our local machine. We then used the HTTP server to serve up the sample AR web-enabled applications to our device. Next, we tackled the problem of debugging JavaScript code remotely to an Android device. After that, we took a brief tour of 3D and explored ways in which we could scale and transform 3D objects in our AR scenes. Then, we finally learned that good knowledge of 3D concepts and/or math is essential for our success as AR developers.</p>
<p>Now that we are done with the essential setup tasks, it is time to move on to building AR applications of our own. In the next chapter, we will explore the AR concept of motion tracking using our web platform.</p>


            

            
        
    </body></html>