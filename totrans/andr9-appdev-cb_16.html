<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Getting Started with Kotlin</h1>
                </header>
            
            <article>
                
<p>This chapter covers the following<span> </span>recipes:</p>
<ul>
<li>
<p>How to create an Android project with Kotlin</p>
</li>
<li>
<p>Creating a Toast in Kotlin</p>
</li>
<li>Runtime permission in Kotlin</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>Kotlin is probably the biggest change to come to Android development in the last few years, since the change from Eclipse to Android Studio anyway. Kotlin was announced by JetBrains in July 2011 and released as open source in February 2012. Version 1.0 was released in February 2016, with Google announcing first-class support for the language at Google I/O 2017. Android Studio 3.0 came with full support for Kotlin already included (and is the minimum requirement for the following recipes.)</p>
<p><strong>Why Kotlin?</strong></p>
<p>With so many existing languages already available, why did JetBrains create another? According to their own announcements, they were looking for an alternative to Java. Since over 70% of their existing code was already in Java, starting from scratch wasn't an option. They wanted a modern language that was compatible with Java. After comparing the many options and finding nothing that met all their needs, they decided to create Kotlin. One interesting aspect of Kotlin is that it was created by developers using the language, and not academics. Here are some of the features Kotlin brings to Android development:</p>
<ul>
<li>Simpler, more concise code</li>
<li>Full JVM support and can be used anywhere Java is used</li>
<li>Full support included in the IDE, especially since JetBrains is the creator of both the Kotlin language and Android Studio</li>
</ul>
<ul>
<li>Safer code: Nullability built in to the language</li>
<li>Rising popularity: Many big companies are adopting Kotlin</li>
<li>Modern language: Offers many features found in the latest language offerings</li>
<li>More enjoyable: Many surveys are finding Kotlin to have the highest satisfaction rating</li>
</ul>
<p>Hopefully, these reasons are enough to at least take a look at Kotlin, especially since Java developers can usually follow the code without too much difficulty. As you'll see with the first recipe in this chapter, it's very easy to add Kotlin support to an Android project.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to create an Android project with Kotlin</h1>
                </header>
            
            <article>
                
<p>Developing in Kotlin couldn't be easier! As you'll see from the simple step here, full Kotlin support is already built into the Android Studio IDE.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Kotlin support requires Android Studio 3.0 or later, so there are no additional requirements needed for this recipe or any of the recipes in this chapter.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>It's actually very simple to add Kotlin support to an Android project and you may have noticed the checkbox already. When creating a new project, Android Studio gives you an option. In fact, it's so obvious, you may not even notice it anymore so we'll start at the beginning and show a screenshot. To begin, launch Android Studio and click <span class="packt_screen">Start a new Android project</span>:</p>
<ol>
<li>In the <span class="packt_screen">Create Android Project</span> dialog, click the <span class="packt_screen">Include Kotlin support</span> checkbox, as shown here:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/310b7c47-f7c4-4132-926a-b9d94b0f3211.png" style="width:71.42em;height:49.17em;"/></p>
<ol start="2">
<li>That's it! Click through the remaining dialogs and you'll have your first Kotlin project for Android.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>The IDE already handles everything you need to do to start developing in Kotlin. Even the first Activity is now created using Kotlin code, as you can see when you open the <kbd>MainActivity.kt</kbd> file:</p>
<pre><span>class </span>MainActivity : AppCompatActivity() {<br/><br/>    <span>override fun </span><span>onCreate</span>(savedInstanceState: Bundle?) {<br/>        <span>super</span>.onCreate(savedInstanceState)<br/>        setContentView(R.layout.<span>activity_main</span>)<br/>    }<br/>}</pre>
<p>As you can see, this is very similar to the Java code. Java developers will likely be able to read and at least understand Kotlin code. A few items worth mentioning if this is your first look at Kotlin include that semicolons are not needed for line termination. Another point worth noting is that variable types comes after the variable name, separated with a colon. What about that question mark after <kbd>Bundle</kbd>? That signifies the variable may be null.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>If you already have an existing project and want to add Kotlin code, this can be done with the <span class="packt_screen">File</span> | <span class="packt_screen">New</span> | <span class="packt_screen">Kotlin File/Class</span> menu option, as shown here: </p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/e5cf5e6d-d8f8-4a41-9311-3307037bb866.png" style="width:31.42em;height:11.00em;"/></p>
<p>Android Studio (3.0 and above) give two options to easily convert Java code to Kotlin:</p>
<ol>
<li>Open a Java file and select the <span class="packt_screen">Code</span> | <span class="packt_screen">Convert to Kotlin</span> menu item.</li>
<li>In Android Studio, copy your Java code to the clipboard, then paste the code into your Kotlin file. Select <span class="packt_screen">Yes</span> when you see the following dialog asking if you want to convert the code: </li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/c1f7f0cc-32f6-4f3e-8547-9f9867352654.png" style="width:32.00em;height:7.08em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<p>Here are some resources to get you started on Kotlin development:</p>
<ul>
<li>The Kotlin website: <a href="https://kotlinlang.org">https://kotlinlang.org</a></li>
<li>The Kotlin GitHub repository: <a href="https://github.com/jetbrains/kotlin">https://github.com/jetbrains/kotlin</a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a Toast in Kotlin</h1>
                </header>
            
            <article>
                
<p>Toasts are such a useful tool when developing an application, especially when learning a new language, that we're going to revisit the Toast. This recipe will show you the Kotlin way of displaying the very familiar Toast, as shown here:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/52064701-a463-442e-beb6-a8b15af15e51.png" style="width:20.42em;height:40.67em;"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Create a new project in Android Studio and call it<span> </span><kbd>KotlinToast</kbd>. Use the default<span> </span><span class="packt_screen">Phone &amp; Tablet</span><span> </span>options and select<span> </span><span class="packt_screen">Empty Activity</span><span> </span>when prompted for the<span> </span><span class="packt_screen">Activity Type. </span>Remember to check the <span class="packt_screen">Include Kotlin support</span> checkbox in the <span class="packt_screen">Create Android Project</span> dialog.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We'll keep this simple by using the default Toast layout and focus on the Kotlin code. Start by opening<span> </span><kbd>activity_main.xml</kbd><span> </span>and follow these steps:</p>
<ol>
<li>Replace the existing<span> </span><kbd>&lt;TextView&gt;</kbd><span> </span>element with a<span> </span><kbd>&lt;Button&gt;</kbd><span> </span>as follows:</li>
</ol>
<pre style="padding-left: 60px"><span>&lt;Button<br/></span><span> </span><span>android</span><span>:id=</span><span>"@+id/button"<br/></span><span> </span><span>android</span><span>:layout_width=</span><span>"wrap_content"<br/></span><span> </span><span>android</span><span>:layout_height=</span><span>"wrap_content"<br/></span><span> </span><span>android</span><span>:text=</span><span>"Show Toast"<br/></span><span> </span><span>android</span><span>:onClick=</span><span>"showToast"<br/></span><span> </span><span>app</span><span>:layout_constraintLeft_toLeftOf=</span><span>"parent"<br/></span><span> </span><span>app</span><span>:layout_constraintRight_toRightOf=</span><span>"parent"<br/></span><span> </span><span>app</span><span>:layout_constraintTop_toTopOf=</span><span>"parent" </span><span>/&gt;</span></pre>
<ol start="2">
<li>Now, open<span> </span><kbd>ActivityMain.kt</kbd><span> </span>and add the following code to the existing <kbd>onCreate()</kbd> method:</li>
</ol>
<pre style="padding-left: 60px"><span>val </span>button = findViewById&lt;Button&gt;(R.id.<span>button</span>)<br/>button.setOnClickListener <span>{<br/></span><span>    </span>Toast.makeText(<span>this, </span><span>"First Toast in Kotlin"</span><span>, </span>Toast.<span>LENGTH_LONG</span>).show()<br/><span>}</span></pre>
<ol start="3">
<li>Run the program on a device or emulator.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>There's really only two parts to showing the Toast: creating the event listener and calling the Toast itself. We create the event listener using <kbd>setOnClickListener</kbd>. It's the same concept as in Java, just much cleaner code syntax. In the braces, we have code that will be called. In our example, it's the Toast. This basically looks the same because it's calling the exact same library, as you'll see if you check the import statement:</p>
<pre><span>import </span>android.widget.Toast</pre>
<p>If you've used a Toast in Java, or gone through the <em>Creating a Toast using a custom layout</em> recipe in <a href="3d708b9b-223b-493a-bf48-48fc306aa0a5.xhtml" target="_blank">Chapter 8</a>, <em>Alerts and Notifications</em>, then you'll notice this looks very similar. It is. But you'll also notice it's much simpler and cleaner code. This is one of the big appeals of Kotlin. What if you want to create a custom layout, like the earlier Java example? Basically, it's the same since the resources (the layout XML and drawables) are not Kotlin or Java specific; they are Android specific. So, use the same resources as the previous example.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<ul>
<li><em>Creating a Toast using a custom layout</em><span> recipe in <a href="3d708b9b-223b-493a-bf48-48fc306aa0a5.xhtml" target="_blank">Chapter 8</a>, Alerts and Notifications </span></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Runtime permission in Kotlin</h1>
                </header>
            
            <article>
                
<p>Even though the Runtime permission model was released back in Android 6.0 (API 23), this topic still receives many queries. Since it's basically a requirement for all future apps, you'll likely need to implement this in Kotlin as well. Take a look at the previous recipe (see links below) for information on the APIs and this recipe for the Kotlin code.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Create a new project in Android Studio and call it<span> </span><kbd>KotlinRuntimePermission</kbd>. Use the default<span> </span><span class="packt_screen">Phone &amp; Tablet</span><span> </span>option, select<span> </span><span class="packt_screen">Empty Activity</span><span> </span>when prompted for<span> </span><span class="packt_screen">Activity Type</span>, and remember to check the <span class="packt_screen">Include Kotlin support</span> checkbox.</p>
<p>The sample source code sets the minimum API to 23, but this is not required. If your<span> </span><kbd>compileSdkVersion</kbd><span> </span>is API 23 or above, the compiler will flag your code for the new security model.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We need to start by adding our required permission to the manifest, then we'll add a button to call our check permission code. Open the Android Manifest and follow these steps:</p>
<ol>
<li>Add the following permission:</li>
</ol>
<pre style="padding-left: 60px"><span>&lt;uses-permission </span><span>android</span><span>:name=</span><span>"android.permission.SEND_SMS"</span><span>/&gt;</span></pre>
<ol start="2">
<li>Open<span> </span><kbd>activity_main.xml</kbd><span> </span>and replace the existing<span> </span><kbd>TextView</kbd><span> </span>with this button:</li>
</ol>
<pre style="padding-left: 60px"><span>&lt;Button<br/></span><span>    </span><span>android</span><span>:id=</span><span>"@+id/button"<br/></span><span>    </span><span>android</span><span>:layout_width=</span><span>"wrap_content"<br/></span><span>    </span><span>android</span><span>:layout_height=</span><span>"wrap_content"<br/></span><span>    </span><span>android</span><span>:text=</span><span>"Do Something"<br/></span><span>    </span><span>android</span><span>:onClick=</span><span>"doSomething"<br/></span><span>    </span><span>app</span><span>:layout_constraintBottom_toBottomOf=</span><span>"parent"<br/></span><span>    </span><span>app</span><span>:layout_constraintLeft_toLeftOf=</span><span>"parent"<br/></span><span>    </span><span>app</span><span>:layout_constraintRight_toRightOf=</span><span>"parent"<br/></span><span>    </span><span>app</span><span>:layout_constraintTop_toTopOf=</span><span>"parent" </span><span>/&gt;</span></pre>
<ol start="3">
<li>Open<span> </span><kbd>MainActivity.kt</kbd><span> </span>and add the following constant above (outside) the MainActivity class:</li>
</ol>
<pre style="padding-left: 60px"><span>private const val </span><span>REQUEST_PERMISSION </span>= <span>1</span></pre>
<ol start="4">
<li>Add this method for a permission check:</li>
</ol>
<pre style="padding-left: 60px"><span>private fun </span><span>checkPermission</span>(permission: String): Boolean {<br/>    <span>val </span>permissionCheck = ContextCompat.checkSelfPermission(<span>this, </span>permission)<br/>    <span>return </span>permissionCheck == PackageManager.<span>PERMISSION_GRANTED<br/></span>}</pre>
<ol start="5">
<li>Add this method to request the permission:</li>
</ol>
<pre style="padding-left: 60px"><span>private fun </span><span>requestPermission</span>(permissionName: String<span>, </span>permissionRequestCode: Int) {<br/>    ActivityCompat.requestPermissions(<span>this, </span><span>arrayOf</span>(permissionName)<span>,<br/></span><span>            </span>permissionRequestCode)<br/>}</pre>
<ol start="6">
<li>Add this method to show the explanation dialog:</li>
</ol>
<pre style="padding-left: 60px"><span>private fun </span><span>showExplanation</span>(title: String<span>, </span>message: String<span>,<br/></span><span>                            </span>permission: String<span>,<br/></span><span>                            </span>permissionRequestCode: Int) {<br/>    <span>val </span>builder = AlertDialog.Builder(<span>this</span>)<br/>    builder.setTitle(title)<br/>            .setMessage(message)<br/>            .setPositiveButton(android.R.string.<span>ok<br/></span><span>            </span>) <span>{ </span>dialog<span>, </span>id <span>-&gt; </span>requestPermission(permission<span>, </span>permissionRequestCode) <span>}<br/></span><span>    </span>builder.create().show()<br/>}</pre>
<ol start="7">
<li>Add this method to handle the button click:</li>
</ol>
<pre style="padding-left: 60px"><span>fun </span><span>doSomething</span>(view: View) {<br/>    <span>if </span>(!checkPermission(Manifest.permission.<span>SEND_SMS</span>)) {<br/>        <span>if </span>(ActivityCompat.shouldShowRequestPermissionRationale(<span>this,<br/></span><span>                        </span>Manifest.permission.<span>SEND_SMS</span>)) {<br/>            showExplanation(<span>"Permission Needed"</span><span>, </span><span>"Rationale"</span><span>,<br/></span><span>                    </span>Manifest.permission.<span>SEND_SMS</span><span>, </span><span>REQUEST_PERMISSION</span>)<br/>        } <span>else </span>{<br/>            requestPermission(Manifest.permission.<span>SEND_SMS</span><span>,<br/></span><span>                    </span><span>REQUEST_PERMISSION</span>)<br/>        }<br/>    } <span>else </span>{<br/>        Toast.makeText(<span>this</span><span>@MainActivity</span><span>, </span><span>"Permission (already) Granted!"</span><span>, </span>Toast.<span>LENGTH_SHORT</span>)<br/>                .show()<br/>    }<br/>}</pre>
<ol start="8">
<li>Override<span> </span><kbd>onRequestPermissionsResult()</kbd><span> </span>as follows:</li>
</ol>
<pre style="padding-left: 60px"><span>override fun </span><span>onRequestPermissionsResult</span>(requestCode: Int<span>,<br/></span><span>                                        </span>permissions: Array&lt;String&gt;<span>,<br/></span><span>                                        </span>grantResults: IntArray) {<br/>    <span>when </span>(requestCode) {<br/>        <span>REQUEST_PERMISSION </span>-&gt; {<br/>            <span>if </span>(grantResults.<span>isNotEmpty</span>() &amp;&amp; grantResults[<span>0</span>] == <br/>                    PackageManager.<span>PERMISSION_GRANTED</span>) {<br/>                Toast.makeText(<span>this</span><span>@MainActivity</span><span>, </span><span>"Granted!"</span><span>, </span>Toast.<span>LENGTH_SHORT</span>)<br/>                        .show()<br/>            } <span>else </span>{<br/>                Toast.makeText(<span>this</span><span>@MainActivity</span><span>, </span><span>"Denied!"</span><span>, </span>Toast.<span>LENGTH_SHORT</span>)<br/>                        .show()<br/>            }<br/>            <span>return<br/></span><span>        </span>}<br/>    }<br/>}</pre>
<ol start="9">
<li>Now, you're ready to run the application on a device or emulator.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How it works...</h1>
                </header>
            
            <article>
                
<p>Using the new runtime permission model involves the following:</p>
<ol>
<li>Check to see whether you have the desired permissions</li>
<li>If not, check whether we should display the rationale (meaning the request was previously denied)</li>
<li>Request the permission; only the OS can display the permission request</li>
<li>Handle the request response</li>
</ol>
<p>Here are the corresponding methods:</p>
<ul>
<li><kbd>ContextCompat.checkSelfPermission</kbd></li>
<li><kbd>ActivityCompat.requestPermissions</kbd></li>
<li><kbd>ActivityCompat.shouldShowRequestPermissionRationale</kbd></li>
<li><kbd>onRequestPermissionsResult</kbd></li>
</ul>
<div class="packt_infobox">Even though you are requesting permissions at runtime, the desired permission must be listed in the Android Manifest. If the permission is not specified, the OS will automatically deny the request.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article>
                
<div>
<ul>
<li>For the Java version, see the <em>The Android 6.0 Runtime Permission Model</em> recipe in <a href="98c7bc7b-43e2-43de-aed4-fe2fb6dc72f3.xhtml" target="_blank"/><a href="98c7bc7b-43e2-43de-aed4-fe2fb6dc72f3.xhtml" target="_blank">Chapter 15</a>, Getting Your App Ready for the Play Store</li>
</ul>
</div>


            </article>

            
        </section>
    </body></html>