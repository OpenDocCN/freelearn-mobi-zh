<html><head></head><body>
		<div><h1 id="_idParaDest-115" class="chapter-number"><a id="_idTextAnchor313"/>10</h1>
			<h1 id="_idParaDest-116"><a id="_idTextAnchor314"/>Using Unity Analytics</h1>
			<p>Making a game is a wonderful experience and a lot of hard work, but when designing projects, you have to rely on your experience and gut feelings in order to make it as awesome as possible. Often, in the game industry, we will use playtesting – a process where select people play a game and give feedback, and then we use the feedback we receive to improve the project.</p>
			<p>This playtesting is most often done in person; however, by creating games for mobile, a lot of people will be playing your game after release, and most of them will have an internet connection. With this combination of people playing the game and also being online, we can send data about how the game is being played to ourselves. This will still allow us to do playtesting with a large variety of people. Being able to look at our data will allow us to check whether the choices that are made to change the game are the right ones, and we will be able to make adjustments to our games on the fly.</p>
			<p>This data could be about something as simple as where players tend to die in the game or things such as how often they come back to play, the daily average time they spend playing, the number of users we have at a time, how long people play the game before stopping, and what choices they made. Over the course of this chapter, we will learn how to become able to learn what our users are doing through the use of Unity’s Gaming Services platform and built-in Analytics system.</p>
			<p><a id="_idTextAnchor315"/>This chapter will cover a number of topics. The chapter itself is a simple step-by-step process from beginning to end. Here is an outline of our tasks:</p>
			<ul>
				<li>Setting up Unity Analytics</li>
				<li>Tracking custom events</li>
				<li>Working with the Funnel Analyzer</li>
				<li>Tweaking properties with Remote Config</li>
			</ul>
			<h1 id="_idParaDest-117"><a id="_idTextAnchor316"/>Technical requirements</h1>
			<p>This book utilizes Unity 2022.1.0b16 and Unity Hub 3.3.1, but the steps should work with minimal changes in future versions of the editor. If you would like to download the exact version used in this book, and there is a new version out, you can visit Unity’s download archive at <a href="https://unity3d.com/get-unity/download/archive">https://unity3d.com/get-unity/download/archive</a>. You can also find the system requirements for Unity at <a href="https://docs.unity3d.com/2022.1/Documentation/Manual/system-requirements.html">https://docs.unity3d.com/2022.1/Documentation/Manual/system-requirements.html</a> in the <em class="italic">Unity Editor system requirements</em> section. To deploy your project, you will need an Android or iOS device.</p>
			<p>You can find the code files present in this chapter on GitHub at <a href="https://github.com/PacktPublishing/Unity-2022-Mobile-Game-Development-3rd-Edition/tree/main/Chapter10">https://github.com/PacktPublishing/Unity-2022-Mobile-Game-Development-3rd-Edition/tree/main/Chapter10</a>.</p>
			<h1 id="_idParaDest-118"><a id="_idTextAnchor317"/>Setting up Analytics</h1>
			<p>Although we <a id="_idIndexMarker604"/>activated the Analytics option from Unity Gaming Services in order to use Unity’s Ads system in <a href="B18868_07.xhtml#_idTextAnchor232"><em class="italic">Chapter 7</em></a> <em class="italic">Advertising Using Unity Ads</em>, we didn’t really dig deep into the system itself. Let’s finish the setup for that now using the following steps:</p>
			<ol>
				<li>To start, we need to install the Unity Analytics package in our project. We can do so by returning to the Unity Editor and opening the package manager, by going to <strong class="bold">Window</strong> | <strong class="bold">Package Manager</strong>.</li>
				<li>There is a bug with the version of Unity this book was written for, with the Analytics package not showing up by default; instead, Unity shows the legacy Analytics Library package. However, it is possible to add the new package by clicking on the <code>com.unity.services.analytics</code>. If all goes well, you should be able to see that the Analytics package has been installed <a id="_idIndexMarker605"/>correctly by checking the <strong class="bold">Package </strong><strong class="bold">Manager</strong> window:</li>
			</ol>
			<div><div><img src="img/B18868_10_01.jpg" alt="Figure 10.1: Analytics attached"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.1: Analytics attached</p>
			<p>The next step is to initialize the SDK and ensure that consent is given by our users to log events that they cause to happen. To do this, we will need to write some code.</p>
			<ol>
				<li value="3">From the <code>Assets/Scripts</code> folder and create a new C# script, naming it <code>AnalyticsManager</code>.</li>
				<li>Double-click on the newly added script to open it with the code editor of your choice, and use the following code:<pre class="source-code">
using System.Collections.Generic; /* List */
using Unity.Services.Analytics; /* AnalyticsService, ConsentCheckException */
using Unity.Services.Core; /* UnityServices */
using UnityEngine;
public class AnalyticsManager : MonoBehaviour
{
    // Start is called before the first frame update
    async void Start()
    {
        try
        {
            await UnityServices.InitializeAsync();
            List&lt;string&gt; consentIdentifiers = await
                AnalyticsService.Instance
                    .CheckForRequiredConsents();
        }
        catch (ConsentCheckException)
        {
            /* Something went wrong */
        }
    }
}</pre></li>
				<li>Save the script and return to the Unity Editor.</li>
			</ol>
			<p>This is the minimum amount of code that is required for us to be able to initialize the SDK, as well as for us to be able to send events to Unity Gaming Services.</p>
			<p>Note that <a id="_idIndexMarker606"/>several keywords here haven’t been utilized previously. For instance, our <code>Start</code> function has <code>async</code> before the return type. Likewise, there’s also <code>await</code> before two function calls. Here, we’re utilizing something called asynchronous programming. The <code>await</code> keyword allows us to wait for the <code>async</code> method until it returns a value. So, the main application thread stops there until it receives a return value. If we did not use the <code>await</code> keyword, the next function would be called immediately afterward, and since we need the result to be figured out before we can continue, that’s why we’re utilizing it. The <code>async</code> keyword enables the <code>await</code> keyword. So, any method using <code>await</code> must be marked <code>async</code>.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">For more info on <code>async</code> and <code>await</code>, check out the official MSDN docs at <a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/">https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/</a>.</p>
			<p>In addition, note that we have a <code>try</code> and <code>catch</code> block. When we use <code>try</code> and then a block of code, we are noting that there is a possibility that the code that we are putting inside of there has a chance of failure. For example, it’s possible that there could be an exception that is thrown. If an exception of type <code>ConsentCheckException</code> is caught during the execution of the <code>try</code> block, it means something went wrong with the consent check.</p>
			<p>If that were to happen normally, Unity would throw an error to the console. The code within the <code>catch</code> block handles this exceptional situation. The <code>catch</code> block is where, instead of throwing  an error to the console and causing issues in the game, this is a way for us to attempt to remedy the situation instead. In our case, we would want to handle how we would run our game without using Unity Services, which would likely mean that we just wouldn’t log events.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">For more info on <code>try</code> and <code>catch</code>, check out the official MSDN docs at <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/try-catch">https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/try-catch</a>.</p>
			<p>Of course, just having this code doesn’t do anything. We have to actually run it. So to do that, we’re going to need to add the script to an object. And for ease of use, we’re going <a id="_idIndexMarker607"/>to create a new object to attach this to.</p>
			<ol>
				<li value="6">Back in the Unity Editor, create an empty game object by going to <code>Analytics Manager</code>, reset its position, and then add the Analytics Manager script to that object.</li>
			</ol>
			<div><div><img src="img/B18868_10_02.jpg" alt="Figure 10.2: The Analytics Manager setup"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.2: The Analytics Manager setup</p>
			<p>As long as <strong class="bold">Analytics</strong> is enabled, the Editor sends an App Start event to the Analytics service when we press the <strong class="bold">Play</strong> button to start the game:</p>
			<p>The nice thing about this is that we can ensure that this feature works correctly without having to export our game. However, this message is not shown to us by default. We can enable logging to the Editor console to allow us some extra visibility while we are experimenting by enabling a scripting define symbol.</p>
			<ol>
				<li value="7">Go to <code>UNITY_ANALYTICS_EVENT_LOGS</code>. Once completed, hit the <strong class="bold">Apply</strong> button and wait for it to finish compiling scripts.</li>
			</ol>
			<p class="callout-heading">Tip</p>
			<p class="callout">If, for some reason, your scripting define symbols disappear on the Android platform, switching to the PC settings and putting the value in first seems to correct the issue.</p>
			<ol>
				<li value="8">Save the project and run the game. If all goes well, you should see the events appear in the <strong class="bold">Console</strong> window:</li>
			</ol>
			<div><div><img src="img/B18868_10_03.jpg" alt="Figure 10.3: The console receiving our default events"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.3: The console receiving our default events</p>
			<p>Now that <a id="_idIndexMarker609"/>we have this working, we can go check to see if the events are happening via the game side.</p>
			<ol>
				<li value="9">From the top bar of Unity go to <strong class="bold">Services</strong> | <strong class="bold">General Settings</strong>. From there go to<strong class="bold"> Analytics – Gaming Services </strong>and then click on <strong class="bold">Go to Dashboard</strong>. Once there click on the <strong class="bold">Event Browser</strong> button, you should see the most recent 100 events that Unity has received:</li>
			</ol>
			<div><div><img src="img/B18868_10_04.jpg" alt="Figure 10.4: The Event Browser page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.4: The Event Browser page</p>
			<p>Now that <a id="_idIndexMarker610"/>we have Unity Analytics set up, let’s start creating our own custom events to tra<a id="_idTextAnchor318"/>c<a id="_idTextAnchor319"/><a id="_idTextAnchor320"/>k!</p>
			<h1 id="_idParaDest-119"><a id="_idTextAnchor321"/>Tracking custom events</h1>
			<p>Unity Analytics does a number of different things automatically to make it easy to work with. However, as a game designer, you may often want to check whether certain aspects of a <a id="_idIndexMarker611"/>game are being used or whether players are reaching certain <a id="_idIndexMarker612"/>pieces of content. To keep track of this, we can make use of the <strong class="bold">custom </strong><strong class="bold">events</strong> system.</p>
			<p>Custom events are pieces of data that users send to the cloud as they play a game. Each custom event can have its own parameters, which will allow us to filter the data that we send when it is generated. We will discuss how you can send information over the <a id="_idTextAnchor322"/>cloud through the use of co<a id="_idTextAnchor323"/>de.</p>
			<h2 id="_idParaDest-120"><a id="_idTextAnchor324"/>Sending basic CustomEvents</h2>
			<p>The first kind of event we are going to send is just an event name. This can be used for something <a id="_idIndexMarker613"/>such as tracking the number of times people access a certain place or checking whether something invalid appears to be happening. To make it easy to trigger and track for testing purposes, we will cause an event to happen each time a game is paused. Let’s look at the steps:</p>
			<ol>
				<li>Open the <code>PauseScreenBehaviour</code> script and add the following <code>using</code> statement to the top of the script:<pre class="source-code">
using Unity.Services.Analytics; /* AnalyticsService */</pre></li>
			</ol>
			<p>This namespace contains all of the functions used by Unity’s Analytics system.</p>
			<ol>
				<li value="2">Update the <code>SetPauseMenu</code> function to include the following highlighted code:<pre class="source-code">
/// &lt;summary&gt;
/// Will turn our pause menu on or off
/// &lt;/summary&gt;
/// &lt;param name="isPaused"&gt;is the game currently paused&lt;/param&gt;
public void SetPauseMenu(bool isPaused)
{
    paused = isPaused;
    /* If the game is paused, timeScale is 0,
       otherwise 1 */
    Time.timeScale = (paused) ? 0 : 1;
    pauseMenu.SetActive(paused);
    onScreenControls.SetActive(!paused);
<strong class="bold">    /* Send custom gamePaused event */</strong>
<strong class="bold">    if (paused &amp;&amp; (AnalyticsService.Instance != null))</strong>
<strong class="bold">    {</strong>
<strong class="bold">        AnalyticsService.Instance.CustomData(</strong>
<strong class="bold">            "gamePaused");</strong>
<strong class="bold">        AnalyticsService.Instance.Flush();</strong>
<strong class="bold">    }</strong>
}</pre></li>
			</ol>
			<p>This code will call the <code>AnalyticsService.Instance.CustomData</code> function when <code>pauseMenu</code> has been turned on. The first parameter of <code>AnalyticsService.Instance.CustomData</code> is a string, which is the name that <a id="_idIndexMarker614"/>you wish the event to have. This name will be used within Unity Analytics. Events are automatically sent every 60 seconds if there’s an internet connection available. However, if you want to immediately upload all recorded events to the server, there’s also the <code>AnalyticsService.Instance.Flush</code> function, which will immediately upload the events when called.</p>
			<ol>
				<li value="3">Save the script and then return to the Unity Editor. Once there, play the game and then pause it. As you can see, the event was sent over the cloud successfully!</li>
			</ol>
			<div><div><img src="img/B18868_10_05.jpg" alt="Figure 10.5: Paused events uploaded succes﻿sfully"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.5: Paused events uploaded succes<a id="_idTextAnchor325"/>sfully</p>
			<p>Previously, Unity Analytics used to accept any event that you were to send it. However, with this new system, you have to actually define the event in the dashboard ahead of time, or it will ignore the information. So, we are going to need to <a id="_idIndexMarker615"/>go to the dashboard and define this event as well before we start seeing it trigger in the Event Manager.</p>
			<p>As mentioned before, it can take quite some time before information shows up on the Unity dashboard, but it’s a good idea at this point to see where this information can be received later on.</p>
			<ol>
				<li value="4">From the <strong class="bold">Dashboard</strong>, go to <strong class="bold">Analytics</strong>, and then select <strong class="bold">Event Manager</strong>.</li>
			</ol>
			<p>This is the place where you can see the custom events and parameters that have been received from the game.</p>
			<ol>
				<li value="5">From there, select <strong class="bold">Add New</strong>, and then select <strong class="bold">Custom Event</strong>.</li>
			</ol>
			<div><div><img src="img/B18868_10_06.jpg" alt="Figure 10.6: Adding a new custom event"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.6: Adding a new custom event</p>
			<ol>
				<li value="6">Name the <a id="_idIndexMarker616"/>custom event <code>gamePaused</code>, spelled exactly the same as we’ve done here, for the string that we’ve been passing into the <code>CustomData</code> function in the <code>SetPauseMenu</code> function. We’ll also add an event description of the event for our future reference. Afterward, click on the <strong class="bold">Create</strong> button, and the event should be ready for us to work with.</li>
			</ol>
			<div><div><img src="img/B18868_10_07.jpg" alt="Figure 10.7: ﻿Setting Custom Event Details"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.7: Setting Custom Event Details</p>
			<ol>
				<li value="7">Lastly, scroll <a id="_idIndexMarker617"/>down to the event and double check that the <strong class="bold">Enabled</strong> option is turned on; otherwise, the events will only show up in the <strong class="bold">Invalid Events</strong> area of the event browser.</li>
			</ol>
			<div><div><img src="img/B18868_10_08.jpg" alt="Figure 10.8: Enabling the event"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.8: Enabling the event</p>
			<ol>
				<li value="8">Go back to the Unity Editor and play your game again, triggering the <code>gamePaused</code> event so that it will show up correctly.</li>
				<li>Wait 15 minutes or so, go back to the event browser, and hit the <code>gamePaused</code> event there! To make it easier to see, you can also click on the <code>gamePaused</code>, and then hit the <strong class="bold">Apply</strong> button to isolate the event browser to only show those events.</li>
			</ol>
			<p>If not, it may <a id="_idIndexMarker618"/>take some time before the events are updated in the event browser, but they should show up eventually.</p>
			<div><div><img src="img/B18868_10_09.jpg" alt="Figure 10.9: Our simple custom events in the event browser"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.9: Our simple custom events in the event browser</p>
			<ol>
				<li value="10">Next, click on the <strong class="bold">Data </strong><strong class="bold">Explorer</strong> option.</li>
			</ol>
			<p>In the <code>gamePaused</code> event is called.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">If you have just created the event, it may take up to 12 hours for the information to be received. Go ahead and check back later if that’s the case. In the past, I’ve had to wait up to even 48 hours for the data, so do not be alarmed if it takes a while for it to show up, although I have not had this issue with the newest iteration of Unity Gaming Serv<a id="_idTextAnchor326"/>ices.</p>
			<ol>
				<li value="11">Click on the <strong class="bold">+</strong> button to the left of <strong class="bold">Add Event</strong> to add a custom event to this graph. Then, select the <strong class="bold">Add Event</strong> dropdown and then <strong class="bold">gamePaused</strong>. Since we have just made the event, we won’t see it on previous dates in Analytics, but we can <a id="_idIndexMarker619"/>see it a little easier if we click on the <strong class="bold">Column Chart</strong> button to change how the data is displayed:</li>
			</ol>
			<div><div><img src="img/B18868_10_10.jpg" alt="Figure 10.10: Add Event"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.10: Add Event</p>
			<p>Now, when we scroll down, we <a id="_idIndexMarker620"/>can see that <code>gamePaused</code> event has been cal<a id="_idTextAnchor327"/>led!</p>
			<h2 id="_idParaDest-121"><a id="_idTextAnchor328"/>Sending custom events with properties</h2>
			<p>One additional <a id="_idIndexMarker621"/>thing that we may want to track is how far players get before they lose. Let’s take a look at how to do that now:</p>
			<ol>
				<li>In the Dashboard, first, go to the Event Manager. Click on <code>gameOver</code>, and then fill in the <strong class="bold">Event description</strong> field with something like Records when the players causes a game over event to occur. Afterward, click on the <strong class="bold">Create</strong> button.</li>
				<li>From there, you’ll be brought to a page for the event. Click on the <strong class="bold">Assign Parameter</strong> button, and from there, under the <strong class="bold">Parameter</strong> dropdown, select <strong class="bold">Add </strong><strong class="bold">New Parameter</strong>.</li>
			</ol>
			<div><div><img src="img/B18868_10_11.jpg" alt="Figure 10.11: Add New Parameter"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.11: Add New Parameter</p>
			<ol>
				<li value="3">For the <a id="_idIndexMarker622"/>parameter name, type in <code>score</code>, and then fill in a description for the parameter. For the parameter type, select <strong class="bold">Float</strong>, and then click the <strong class="bold">Create</strong> button.</li>
			</ol>
			<div><div><img src="img/B18868_10_12.jpg" alt="Figure 10.12: Adding a custom parameter"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.12: Adding a custom parameter</p>
			<ol>
				<li value="4">Create a <a id="_idIndexMarker623"/>new event called <code>gameOver</code> and a custom parameter, which we will call <code>score</code> and will be a float. Then, click on the <code>score</code>, and then click <strong class="bold">Assign</strong>.</li>
			</ol>
			<div><div><img src="img/B18868_10_13.jpg" alt="Figure 10.13: Assigning the score parameter"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.13: Assigning the score parameter</p>
			<ol>
				<li value="5">Finally, click <a id="_idIndexMarker624"/>on the <code>gameOver</code> event will be saved when it occurs. Unity will ask whether you’re sure you want to enable the event; click on the <strong class="bold">Enable</strong> button to ensure that it will happen.</li>
			</ol>
			<div><div><img src="img/B18868_10_14.jpg" alt="Figure 10.14: Enabling the event"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.14: Enabling the event</p>
			<ol>
				<li value="6">Now, return to <a id="_idIndexMarker625"/>the Unity Editor. First, we will need to open up the <code>ObstacleBehaviour</code> script to modify what happens when the game ends.</li>
				<li>To utilize Unity Analytics with parameters, at the top of the file, we will add the following <code>using</code> declarations:<pre class="source-code">
using Unity.Services.Analytics; /* AnalyticsService */
using System.Collections.Generic; /* Dictionary */</pre></li>
			</ol>
			<p>The top option is obvious, but we are also adding <code>System.Collections.Generic</code> in order to get access to the <code>Dictionary</code> class, which we will use in the next piece of code.</p>
			<ol>
				<li value="8">Next, we will update the <code>OnCollisionEnter</code> function to the following:<pre class="source-code">
private void OnCollisionEnter(Collision collision)
{
    var go = collision.gameObject;
    var playerBehaviour =
        go.GetComponent&lt;PlayerBehaviour&gt;();
    // First check if we collided with the player
    if (playerBehaviour)
    {
        // Destroy the player
        //Destroy(collision.gameObject);
        // Destroy (Hide) the player
        player = go;
        player.SetActive(false);
        /* If Unity Analytics doesn't exist will throw
           an exception */
        try
        {
            /* Define Custom Parameters */
            var eventData = new Dictionary&lt;string,
                object&gt;
            {
                { "score", playerBehaviour.Score }
            };
    <a id="_idTextAnchor329"/>        AnalyticsService.Instance.CustomData("game
                Over", eventData);
            AnalyticsService.Instance.Flush();
        }
        catch(ServicesInitializationException e)
        {
            /* Displays the exception but doesn't
               break * the game */
            Debug.LogWarning(e.Message);
        }
        /* Call the function ResetGame after waitTime
           has passed */
        Invoke("ResetGame", waitTime);
    }
}</pre></li>
			</ol>
			<p>We’ve done a number of things within this script. To start off with, we have rewritten <a id="_idIndexMarker626"/>our check that the player uses the component as a variable now, so we don’t have to call <code>GetComponent</code> again for the same thing. Aside from that, the main addition is the calling of the <code>AnalyticsService.Instance.CustomData</code> function with a second parameter. The second parameter (which is optional) is a dictionary, which we haven’t discussed yet.</p>
			<p>A <code>string</code> class as the key type so that you can refer to some other data type.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">For more information on dictionaries, check out <a href="http://csharp.net-informations.com/collection/dictionary.htm">http://csharp.net-informations.com/collection/dictionary.htm</a>.</p>
			<p>We’ve wrapped this code in a <code>try</code> and <code>catch</code> block because if <code>AnalyticsService.Instance</code> is called and it is <code>null</code>, the code written by Unity will throw an exception. This will cause the game to break and no longer work. The game currently works fine if we start the game from the title screen, but if we start the game from the gameplay scene, it will no longer work correctly due to Analytics not being initialized. This time, instead of doing nothing like the previous example, I added a line to actually print out the message that the error gives us as a warning. It’s always a good idea to have our code be as robust as possible, so that’s why we added this check.</p>
			<ol>
				<li value="9">Save the script and return to the Unity Editor.</li>
				<li>Play the game and lose it. Note in the <code>gameOver</code><strong class="bold"> </strong>event:</li>
			</ol>
			<div><div><img src="img/B18868_10_15.jpg" alt="Figure 10.15: A Game Over event being disp﻿atched"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.15: A Game Over event being disp<a id="_idTextAnchor330"/>atched</p>
			<p>You can <a id="_idIndexMarker628"/>also dive into the dashboard to see the information as well, but Unity says it may take up to 6 hours before it becomes visible, although I usually see it within 15 minutes or so. You will see the messages instantly in the <strong class="bold">Console</strong> window, but they don’t populate in Analytics until the backend calculations have been processed at Unity’s end, due to all of the events it receives.</p>
			<ol>
				<li value="11">After you’ve waited, go to the <code>gameOver</code> events.</li>
				<li>To be able to see the value of the <code>score</code> parameter we created on the far right, click on the button that looks like <strong class="bold">&lt;&gt;</strong> to access the JSON event content for the particular event. Note that we can see the value of our score here:</li>
			</ol>
			<div><div><img src="img/B18868_10_16.jpg" alt="Figure 10.16: The score value in the event content"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.16: The score value in the event content</p>
			<p>And with that, we now know how to access events!</p>
			<p>This information <a id="_idIndexMarker629"/>is formatted in the manner of a JSON file. <code>Dictionary</code> class that we used previously.</p>
			<p>One of the <a id="_idIndexMarker631"/>limitations of the event browser is the fact that we are only able to see the most recent 100 events. As our project becomes more and more popular, it is likely that we’re going to have more and more events. With that in mind, we will likely want to have some way to be able to interpret that information. One of the ways that we can use do this is th<a id="_idTextAnchor331"/>rough the SQL Data Explorer. This allows us to access all the events <a id="_idIndexMarker632"/>that are created, but we have to utilize <strong class="bold">Structured Query Language</strong> (<strong class="bold">SQL</strong>), which is a domain-specific language that was created to manage data held within a database.</p>
			<ol>
				<li value="13">Click on the <strong class="bold">SQL Data Explorer</strong> button to open the menu. Note that the <strong class="bold">Query</strong> field contains some default text.</li>
			</ol>
			<div><div><img src="img/B18868_10_17.jpg" alt="Figure 10.17: SQL Data Explorer"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.17: SQL Data Explorer</p>
			<ol>
				<li value="14">Hit the <strong class="bold">Run</strong> button <a id="_idIndexMarker633"/>to see the default result and how it works. Once the query finishes, you’ll be able to create a chart using the data it interpreted from this query.</li>
				<li>To get a feel for how this can work with chart data, under <strong class="bold">Chart Setup</strong>, set <strong class="bold">X-axis column</strong> to <strong class="bold">EVENT_DATE</strong> and <strong class="bold">Y-axis 1 column</strong> to <strong class="bold">COUNT(DISTINCT USER_ID)</strong>, and then click the <strong class="bold">Apply</strong> button.</li>
			</ol>
			<div><div><img src="img/B18868_10_18.jpg" alt="Figure 10.18: Chart Setup"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.18: Chart Setup</p>
			<p>This will <a id="_idIndexMarker634"/>allow you to create a chart in a similar manner to what we saw earlier with the Data Explorer, but this gives us more fine-tuned control if we want to use the power of SQL.</p>
			<p>There are entire books out there about SQL for those that are interested in exploring it further, but in our case, we want to extract the score values from our custom events. Therefore, instead of a chart, we want to create a table so that, in addition to writing some custom queries, we can also see how to export the data as well.</p>
			<ol>
				<li value="16">In the <strong class="bold">Query</strong> field, replace the code with the following:<pre class="source-code">
SELECT EVENT_JSON:score::FLOAT
FROM EVENTS
WHERE EVENT_NAME = 'gameOver'</pre></li>
			</ol>
			<p>This code is going to go through every single event and check whether the name of the event is <code>gameOver</code>. If so, it will isolate the <code>score</code> property from it. This will allow us to create a list of all of the <code>score</code> properties from the entire project.</p>
			<ol>
				<li value="17">Hit the <strong class="bold">Run</strong> button and wait for it to execute. Once done, you’ll see the <strong class="bold">Share</strong> button on the top has turned blue and you can press it. Once selected, click on the <strong class="bold">Export as CSV </strong><strong class="bold">file</strong> option.</li>
			</ol>
			<p><strong class="bold">CSV</strong> stands for <strong class="bold">comma-separated values</strong>. This is a file type that uses commas <a id="_idIndexMarker635"/>to separate each of the different values <a id="_idIndexMarker636"/>that are designated within the file, but if you open the file with Google Sheets or Excel, the program will be able to parse the file to resemble a nice table.</p>
			<div><div><img src="img/B18868_10_19.jpg" alt="Figure 10.19: The table of score values in Microsoft Excel"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.19: The table of score values in Microsoft Excel</p>
			<p>This gives us a way to see all the various different score values that our players have achieved as they played the game. This can help us see whether people are doing well or really poorly, and allow us to cater the game however we’d like.</p>
			<p>Use a snippet like the following:</p>
			<pre class="source-code">
SELECT EVENT_JSON
FROM EVENTS
WHERE EVENT_NAME = 'gameOver'</pre>
			<p>The preceding <a id="_idIndexMarker637"/>code would make it so that instead of the first event just showing 6.5199995, we would have each of the slots consist of the entirety of the JSON data that we discussed earlier – in this case, the following:</p>
			<pre class="source-code">
"{
  ""clientVersion"": ""0.1"",
  ""collectInsertedTimestamp"": ""2022-12-23
    05:36:22.379"",
  ""eventDate"": ""2022-12-23 00:00:00.000"",
  ""eventID"": 3072590187314819072,
  ""eventLevel"": 0,
  ""eventName"": ""gameOver"",
  ""eventTimestamp"": ""2022-12-23 14:36:19.072"",
  ""eventUUID"": ""0d924683-5667-4455-b899-722bfeae93cd"",
  ""gaUserAcquisitionChannel"": ""None"",
  ""gaUserAgeGroup"": ""UNKNOWN"",
  ""gaUserCountry"": ""KR"",
  ""gaUserGender"": ""UNKNOWN"",
  ""gaUserStartDate"": ""2022-07-28 00:00:00.000"",
  ""mainEventID"": 3072590187314819072,
  ""msSinceLastEvent"": 12124,
  ""platform"": ""PC_CLIENT"",
  ""score"": 6.51999473571777,
  ""sessionID"": ""0ce65df8-9696-40e8-ae44-924417e0d406"",
  ""timezoneOffset"": ""+0900"",
  ""userCountry"": ""KR"",
  ""userID"": ""21328f4689677b24baf59487ae951228""
}"</pre>
			<p>By adding <code>:score::FLOAT</code>, we get the <code>score</code> variable from the JSON data and tell the computer to interpret it as a floating-point value.</p>
			<p>For those <a id="_idIndexMarker638"/>that are interested in exploring SQL more, I suggest checking out the Unity Gaming Service’s example cookbook at <a href="https://github.com/Unity-Technologies/UGS-SQL-Cookbook">https://github.com/Unity-Technologies/UGS-SQL-Cookbook</a>, which contains a collection of common SQL queries and best practices for use with Unity Analytics.</p>
			<p>This, of course, is just a simple example, so I would suggest that you create custom events for whenever a user reaches an important milestone – for example, when they level up or <a id="_idIndexMarker639"/>when they make an <strong class="bold">In-App </strong><strong class="bold">Purchase</strong> (<strong class="bold">IAP</strong>).</p>
			<p>Now that we know how to<a id="_idIndexMarker640"/> create different types of events, let’s see how we can actually track events and learn more about what our players are doing, utiliz<a id="_idTextAnchor332"/>ing the Funnel A<a id="_idTextAnchor333"/>nalyzer tool.</p>
			<h1 id="_idParaDest-122"><a id="_idTextAnchor334"/>Working with funnels</h1>
			<p>One of the many things we’d like to know about our players is how they are actually playing a game – for instance, are users skipping our tutorial? To keep track of how players proceed <a id="_idIndexMarker641"/>through a series of events, we have funnels. Funnels help us to identify where player drop-off happens in our game.</p>
			<p>If you happen to see a large number of people not getting to a certain step, you can assume that something that happened in the preceding step causes people to stop playing our game.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">For more information on how funnels work as well as why you’d want to use them, check out <a href="https://data36.com/funnel-analysis/">https://data36.com/funnel-analysis/</a>.</p>
			<p>Funnels are based on the concept of custom events, which we used in the <em class="italic">Sending custom events with properties</em> section of this chapter. We can use the Funnels tool (previously known as the Funnel Analyzer) to look at the data sent via these funnels, which we can <a id="_idIndexMarker642"/>then use to make educated decisions on what changes should be made to the game. Follow the steps given here to add the tool:</p>
			<ol>
				<li>From the dashboard, go to <strong class="bold">Analytics</strong> and select <strong class="bold">Funnels</strong>:</li>
			</ol>
			<div><div><img src="img/B18868_10_20.jpg" alt="Figure 10.20: The Funnels page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.20: The Funnels page</p>
			<p>Right now, there are no funnels set up, so we shoul<a id="_idTextAnchor335"/>d create one.</p>
			<ol>
				<li value="2">Click on the <strong class="bold">+ New Funnel</strong> button and fill in the details, as shown in the following <a id="_idIndexMarker643"/>screenshot. Then, scroll all the way down and click on the <strong class="bold">Apply</strong> button:</li>
			</ol>
			<div><div><img src="img/B18868_10_21.jpg" alt="Figure 10.21: Funnels setup"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.21: Funnels setup</p>
			<p>If you’ve played the game already, you can see the results from the events that have already triggered:</p>
			<div><div><img src="img/B18868_10_22.jpg" alt="Figure 10.22: The event trigger results"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.22: The event trigger results</p>
			<p>In our case, we <a id="_idIndexMarker644"/>have played the game and lost, so we currently have a 100% completion rate.</p>
			<ol>
				<li value="3">Scroll up to the top page and click on the <strong class="bold">Save Funnel</strong> button. Give the funnel a name, describe what it is you’re creating, and then hit the <strong class="bold">Save</strong> button.</li>
			</ol>
			<div><div><img src="img/B18868_10_23.jpg" alt="Figure 10.23: The﻿ funnel setup"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.23: The<a id="_idTextAnchor336"/> funnel setup</p>
			<p>You should be able to select that funnel, and it will provide information on all the times it has been called.</p>
			<p>The concepts <a id="_idIndexMarker645"/>used here can easily be expanded upon in other ways as well, such as keeping track of how often users watch ads or make purchases in the game and what causes them to do so.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Funnels are great when a game is working correctly, but if the game crashes, it’s also possible to get analytics from that as well from Unity Cloud Diagnostics. For information on that as <a id="_idIndexMarker646"/>well as how to set it up, check out <a href="https://docs.unity.com/cloud-diagnostics/en/manual/CrashandExceptionReporting/SettingupCrashandExceptionReporting">https://docs.unity.com/cloud-diagnostics/en/manual/CrashandExceptionReporting/SettingupCrashandExceptionReporting</a>.</p>
			<h1 id="_idParaDest-123"><a id="_idTextAnchor337"/>Summary</h1>
			<p>In this chapter, we explored a number of ways that we can make use of Unity’s Analytics tool to make our games better, from how to understand what our players are doing to learning how to adjust our game based on that feedback, without users having to download an entirely new copy of our game.</p>
			<p>Specifically, we learned how to set up the Unity Analytics section of the Unity Editor, and then we saw how we can make use of code to create events to be sent to the cloud for us to look at. With the given data, we learned how we could make use of funnels and the Funnel Analyzer to learn more about our players.</p>
			<p>Now that we have seen how to create events, let’s see one of the other <a id="_idTextAnchor338"/>main benefits of utilizing Unity Gaming Services – being able to change projects using the Remote Config feature, which we will learn more about in the next chapter.</p>
		</div>
	</body></html>