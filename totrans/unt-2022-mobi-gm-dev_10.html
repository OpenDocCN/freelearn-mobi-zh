<html><head></head><body>
		<div id="_idContainer297">
			<h1 id="_idParaDest-115" class="chapter-number"><a id="_idTextAnchor313"/>10</h1>
			<h1 id="_idParaDest-116"><a id="_idTextAnchor314"/>Using Unity Analytics</h1>
			<p>Making a game is a wonderful experience and a lot of hard work, but when designing projects, you have to rely on your experience and gut feelings in order to make it as awesome as possible. Often, in the game industry, we will use playtesting – a process where select people play a game and give feedback, and then we use the feedback we receive to improve <span class="No-Break">the project.</span></p>
			<p>This playtesting is most often done in person; however, by creating games for mobile, a lot of people will be playing your game after release, and most of them will have an internet connection. With this combination of people playing the game and also being online, we can send data about how the game is being played to ourselves. This will still allow us to do playtesting with a large variety of people. Being able to look at our data will allow us to check whether the choices that are made to change the game are the right ones, and we will be able to make adjustments to our games on <span class="No-Break">the fly.</span></p>
			<p>This data could be about something as simple as where players tend to die in the game or things such as how often they come back to play, the daily average time they spend playing, the number of users we have at a time, how long people play the game before stopping, and what choices they made. Over the course of this chapter, we will learn how to become able to learn what our users are doing through the use of Unity’s Gaming Services platform and built-in <span class="No-Break">Analytics system.</span></p>
			<p><a id="_idTextAnchor315"/>This chapter will cover a number of topics. The chapter itself is a simple step-by-step process from beginning to end. Here is an outline of <span class="No-Break">our tasks:</span></p>
			<ul>
				<li>Setting up <span class="No-Break">Unity Analytics</span></li>
				<li>Tracking <span class="No-Break">custom events</span></li>
				<li>Working with the <span class="No-Break">Funnel Analyzer</span></li>
				<li>Tweaking properties with <span class="No-Break">Remote Config</span></li>
			</ul>
			<h1 id="_idParaDest-117"><a id="_idTextAnchor316"/>Technical requirements</h1>
			<p>This book utilizes Unity 2022.1.0b16 and Unity Hub 3.3.1, but the steps should work with minimal changes in future versions of the editor. If you would like to download the exact version used in this book, and there is a new version out, you can visit Unity’s download archive at <a href="https://unity3d.com/get-unity/download/archive">https://unity3d.com/get-unity/download/archive</a>. You can also find the system requirements for Unity at <a href="https://docs.unity3d.com/2022.1/Documentation/Manual/system-requirements.html">https://docs.unity3d.com/2022.1/Documentation/Manual/system-requirements.html</a> in the <em class="italic">Unity Editor system requirements</em> section. To deploy your project, you will need an Android or <span class="No-Break">iOS device.</span></p>
			<p>You can find the code files present in this chapter on GitHub <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Unity-2022-Mobile-Game-Development-3rd-Edition/tree/main/Chapter10"><span class="No-Break">https://github.com/PacktPublishing/Unity-2022-Mobile-Game-Development-3rd-Edition/tree/main/Chapter10</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-118"><a id="_idTextAnchor317"/>Setting up Analytics</h1>
			<p>Although we <a id="_idIndexMarker604"/>activated the Analytics option from Unity Gaming Services in order to use Unity’s Ads system in <a href="B18868_07.xhtml#_idTextAnchor232"><span class="No-Break"><em class="italic">Chapter 7</em></span></a> <em class="italic">Advertising Using Unity Ads</em>, we didn’t really dig deep into the system itself. Let’s finish the setup for that now using the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>To start, we need to install the Unity Analytics package in our project. We can do so by returning to the Unity Editor and opening the package manager, by going to <strong class="bold">Window</strong> | <span class="No-Break"><strong class="bold">Package Manager</strong></span><span class="No-Break">.</span></li>
				<li>There is a bug with the version of Unity this book was written for, with the Analytics package not showing up by default; instead, Unity shows the legacy Analytics Library package. However, it is possible to add the new package by clicking on the <strong class="bold">+</strong> button at the top left and then selecting the <strong class="bold">Add Package by Name</strong> option. From there, type in <strong class="source-inline">com.unity.services.analytics</strong>. If all goes well, you should be able to see that the Analytics package has been installed <a id="_idIndexMarker605"/>correctly by checking the <strong class="bold">Package </strong><span class="No-Break"><strong class="bold">Manager</strong></span><span class="No-Break"> window:</span></li>
			</ol>
			<div>
				<div id="_idContainer274" class="IMG---Figure">
					<img src="image/B18868_10_01.jpg" alt="Figure 10.1: Analytics attached"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.1: Analytics attached</p>
			<p>The next step is to initialize the SDK and ensure that consent is given by our users to log events that they cause to happen. To do this, we will need to write <span class="No-Break">some code.</span></p>
			<ol>
				<li value="3">From the <strong class="bold">Project</strong> window, go to the <strong class="source-inline">Assets/Scripts</strong> folder and create a new C# script, naming <span class="No-Break">it </span><span class="No-Break"><strong class="source-inline">AnalyticsManager</strong></span><span class="No-Break">.</span></li>
				<li>Double-click on the newly added script to open it with the code editor of your choice, and use the <span class="No-Break">following code:</span><pre class="source-code">
using System.Collections.Generic; /* List */
using Unity.Services.Analytics; /* AnalyticsService, ConsentCheckException */
using Unity.Services.Core; /* UnityServices */
using UnityEngine;
public class AnalyticsManager : MonoBehaviour
{
    // Start is called before the first frame update
    async void Start()
    {
        try
        {
            await UnityServices.InitializeAsync();
            List&lt;string&gt; consentIdentifiers = await
                AnalyticsService.Instance
                    .CheckForRequiredConsents();
        }
        catch (ConsentCheckException)
        {
            /* Something went wrong */
        }
    }
}</pre></li>
				<li>Save the script and return to the <span class="No-Break">Unity Editor.</span></li>
			</ol>
			<p>This is the minimum amount of code that is required for us to be able to initialize the SDK, as well as for us to be able to send events to Unity <span class="No-Break">Gaming Services.</span></p>
			<p>Note that <a id="_idIndexMarker606"/>several keywords here haven’t been utilized previously. For instance, our <strong class="source-inline">Start</strong> function has <strong class="source-inline">async</strong> before the return type. Likewise, there’s also <strong class="source-inline">await</strong> before two function calls. Here, we’re utilizing something called asynchronous programming. The <strong class="source-inline">await</strong> keyword allows us to wait for the <strong class="source-inline">async</strong> method until it returns a value. So, the main application thread stops there until it receives a return value. If we did not use the <strong class="source-inline">await</strong> keyword, the next function would be called immediately afterward, and since we need the result to be figured out before we can continue, that’s why we’re utilizing it. The <strong class="source-inline">async</strong> keyword enables the <strong class="source-inline">await</strong> keyword. So, any method using <strong class="source-inline">await</strong> must be <span class="No-Break">marked </span><span class="No-Break"><strong class="source-inline">async</strong></span><span class="No-Break">.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">For more info on <strong class="source-inline">async</strong> and <strong class="source-inline">await</strong>, check out the official MSDN docs <span class="No-Break">at </span><a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/"><span class="No-Break">https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/</span></a><span class="No-Break">.</span></p>
			<p>In addition, note that we have a <strong class="source-inline">try</strong> and <strong class="source-inline">catch</strong> block. When we use <strong class="source-inline">try</strong> and then a block of code, we are noting that there is a possibility that the code that we are putting inside of there has a chance of failure. For example, it’s possible that there could be an exception that is thrown. If an exception of type <strong class="source-inline">ConsentCheckException</strong> is caught during the execution of the <strong class="source-inline">try</strong> block, it means something went wrong with the <span class="No-Break">consent check.</span></p>
			<p>If that were to happen normally, Unity would throw an error to the console. The code within the <strong class="source-inline">catch</strong> block handles this exceptional situation. The <strong class="source-inline">catch</strong> block is where, instead of throwing  an error to the console and causing issues in the game, this is a way for us to attempt to remedy the situation instead. In our case, we would want to handle how we would run our game without using Unity Services, which would likely mean that we just wouldn’t <span class="No-Break">log events.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">For more info on <strong class="source-inline">try</strong> and <strong class="source-inline">catch</strong>, check out the official MSDN docs <span class="No-Break">at </span><a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/try-catch"><span class="No-Break">https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/try-catch</span></a><span class="No-Break">.</span></p>
			<p>Of course, just having this code doesn’t do anything. We have to actually run it. So to do that, we’re going to need to add the script to an object. And for ease of use, we’re going <a id="_idIndexMarker607"/>to create a new object to attach <span class="No-Break">this to.</span></p>
			<ol>
				<li value="6">Back in the Unity Editor, create an empty game object by going to <strong class="bold">Game Object </strong>| <strong class="bold">Create Empty</strong>. Rename the object <strong class="source-inline">Analytics Manager</strong>, reset its position, and then add the Analytics Manager script to <span class="No-Break">that object.</span></li>
			</ol>
			<div>
				<div id="_idContainer275" class="IMG---Figure">
					<img src="image/B18868_10_02.jpg" alt="Figure 10.2: The Analytics Manager setup"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.2: The Analytics Manager setup</p>
			<p>As long as <strong class="bold">Analytics</strong> is enabled, the Editor sends an App Start event to the Analytics service when we press the <strong class="bold">Play</strong> button to start <span class="No-Break">the game:</span></p>
			<p>The nice thing about this is that we can ensure that this feature works correctly without having to export our game. However, this message is not shown to us by default. We can enable logging to the Editor console to allow us some extra visibility while we are experimenting by enabling a scripting <span class="No-Break">define symbol.</span></p>
			<ol>
				<li value="7">Go to <strong class="bold">Edit</strong> | <strong class="bold">Project Settings</strong>, and from there, go to the <strong class="bold">Player</strong> option. From <strong class="bold">Other Settings</strong>, go to the <strong class="bold">Script Compilation</strong> section, and from there, go to <strong class="bold">Scripting Define Symbols</strong>. From there, we’re going to click on the <strong class="bold">+</strong> button to add an <a id="_idIndexMarker608"/>entry and then add the following keyword – <strong class="source-inline">UNITY_ANALYTICS_EVENT_LOGS</strong>. Once completed, hit the <strong class="bold">Apply</strong> button and wait for it to finish <span class="No-Break">compiling scripts.</span></li>
			</ol>
			<p class="callout-heading">Tip</p>
			<p class="callout">If, for some reason, your scripting define symbols disappear on the Android platform, switching to the PC settings and putting the value in first seems to correct <span class="No-Break">the issue.</span></p>
			<ol>
				<li value="8">Save the project and run the game. If all goes well, you should see the events appear in the <span class="No-Break"><strong class="bold">Console</strong></span><span class="No-Break"> window:</span></li>
			</ol>
			<div>
				<div id="_idContainer276" class="IMG---Figure">
					<img src="image/B18868_10_03.jpg" alt="Figure 10.3: The console receiving our default events"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.3: The console receiving our default events</p>
			<p>Now that <a id="_idIndexMarker609"/>we have this working, we can go check to see if the events are happening via the <span class="No-Break">game side.</span></p>
			<ol>
				<li value="9">From the top bar of Unity go to <strong class="bold">Services</strong> | <strong class="bold">General Settings</strong>. From there go to<strong class="bold"> Analytics – Gaming Services </strong>and then click on <strong class="bold">Go to Dashboard</strong>. Once there click on the <strong class="bold">Event Browser</strong> button, you should see the most recent 100 events that Unity <span class="No-Break">has received:</span></li>
			</ol>
			<div>
				<div id="_idContainer277" class="IMG---Figure">
					<img src="image/B18868_10_04.jpg" alt="Figure 10.4: The Event Browser page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.4: The Event Browser page</p>
			<p>Now that <a id="_idIndexMarker610"/>we have Unity Analytics set up, let’s start creating our own custom events <span class="No-Break">to tra<a id="_idTextAnchor318"/>c<a id="_idTextAnchor319"/><a id="_idTextAnchor320"/>k!</span></p>
			<h1 id="_idParaDest-119"><a id="_idTextAnchor321"/>Tracking custom events</h1>
			<p>Unity Analytics does a number of different things automatically to make it easy to work with. However, as a game designer, you may often want to check whether certain aspects of a <a id="_idIndexMarker611"/>game are being used or whether players are reaching certain <a id="_idIndexMarker612"/>pieces of content. To keep track of this, we can make use of the <strong class="bold">custom </strong><span class="No-Break"><strong class="bold">events</strong></span><span class="No-Break"> system.</span></p>
			<p>Custom events are pieces of data that users send to the cloud as they play a game. Each custom event can have its own parameters, which will allow us to filter the data that we send when it is generated. We will discuss how you can send information over the <a id="_idTextAnchor322"/>cloud through the use <span class="No-Break">of co<a id="_idTextAnchor323"/>de.</span></p>
			<h2 id="_idParaDest-120"><a id="_idTextAnchor324"/>Sending basic CustomEvents</h2>
			<p>The first kind of event we are going to send is just an event name. This can be used for something <a id="_idIndexMarker613"/>such as tracking the number of times people access a certain place or checking whether something invalid appears to be happening. To make it easy to trigger and track for testing purposes, we will cause an event to happen each time a game is paused. Let’s look at <span class="No-Break">the steps:</span></p>
			<ol>
				<li>Open the <strong class="source-inline">PauseScreenBehaviour</strong> script and add the following <strong class="source-inline">using</strong> statement to the top of <span class="No-Break">the script:</span><pre class="source-code">
using Unity.Services.Analytics; /* AnalyticsService */</pre></li>
			</ol>
			<p>This namespace contains all of the functions used by Unity’s <span class="No-Break">Analytics system.</span></p>
			<ol>
				<li value="2">Update the <strong class="source-inline">SetPauseMenu</strong> function to include the following <span class="No-Break">highlighted code:</span><pre class="source-code">
/// &lt;summary&gt;
/// Will turn our pause menu on or off
/// &lt;/summary&gt;
/// &lt;param name="isPaused"&gt;is the game currently paused&lt;/param&gt;
public void SetPauseMenu(bool isPaused)
{
    paused = isPaused;
    /* If the game is paused, timeScale is 0,
       otherwise 1 */
    Time.timeScale = (paused) ? 0 : 1;
    pauseMenu.SetActive(paused);
    onScreenControls.SetActive(!paused);
<strong class="bold">    /* Send custom gamePaused event */</strong>
<strong class="bold">    if (paused &amp;&amp; (AnalyticsService.Instance != null))</strong>
<strong class="bold">    {</strong>
<strong class="bold">        AnalyticsService.Instance.CustomData(</strong>
<strong class="bold">            "gamePaused");</strong>
<strong class="bold">        AnalyticsService.Instance.Flush();</strong>
<strong class="bold">    }</strong>
}</pre></li>
			</ol>
			<p>This code will call the <strong class="source-inline">AnalyticsService.Instance.CustomData</strong> function when <strong class="source-inline">pauseMenu</strong> has been turned on. The first parameter of <strong class="source-inline">AnalyticsService.Instance.CustomData</strong> is a string, which is the name that <a id="_idIndexMarker614"/>you wish the event to have. This name will be used within Unity Analytics. Events are automatically sent every 60 seconds if there’s an internet connection available. However, if you want to immediately upload all recorded events to the server, there’s also the <strong class="source-inline">AnalyticsService.Instance.Flush</strong> function, which will immediately upload the events <span class="No-Break">when called.</span></p>
			<ol>
				<li value="3">Save the script and then return to the Unity Editor. Once there, play the game and then pause it. As you can see, the event was sent over the <span class="No-Break">cloud successfully!</span></li>
			</ol>
			<div>
				<div id="_idContainer278" class="IMG---Figure">
					<img src="image/B18868_10_05.jpg" alt="Figure 10.5: Paused events uploaded succes﻿sfully"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.5: Paused events uploaded succes<a id="_idTextAnchor325"/>sfully</p>
			<p>Previously, Unity Analytics used to accept any event that you were to send it. However, with this new system, you have to actually define the event in the dashboard ahead of time, or it will ignore the information. So, we are going to need to <a id="_idIndexMarker615"/>go to the dashboard and define this event as well before we start seeing it trigger in the <span class="No-Break">Event Manager.</span></p>
			<p>As mentioned before, it can take quite some time before information shows up on the Unity dashboard, but it’s a good idea at this point to see where this information can be received <span class="No-Break">later on.</span></p>
			<ol>
				<li value="4">From the <strong class="bold">Dashboard</strong>, go to <strong class="bold">Analytics</strong>, and then select <span class="No-Break"><strong class="bold">Event Manager</strong></span><span class="No-Break">.</span></li>
			</ol>
			<p>This is the place where you can see the custom events and parameters that have been received from <span class="No-Break">the game.</span></p>
			<ol>
				<li value="5">From there, select <strong class="bold">Add New</strong>, and then select <span class="No-Break"><strong class="bold">Custom Event</strong></span><span class="No-Break">.</span></li>
			</ol>
			<div>
				<div id="_idContainer279" class="IMG---Figure">
					<img src="image/B18868_10_06.jpg" alt="Figure 10.6: Adding a new custom event"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.6: Adding a new custom event</p>
			<ol>
				<li value="6">Name the <a id="_idIndexMarker616"/>custom event <strong class="source-inline">gamePaused</strong>, spelled exactly the same as we’ve done here, for the string that we’ve been passing into the <strong class="source-inline">CustomData</strong> function in the <strong class="source-inline">SetPauseMenu</strong> function. We’ll also add an event description of the event for our future reference. Afterward, click on the <strong class="bold">Create</strong> button, and the event should be ready for us to <span class="No-Break">work with.</span></li>
			</ol>
			<div>
				<div id="_idContainer280" class="IMG---Figure">
					<img src="image/B18868_10_07.jpg" alt="Figure 10.7: ﻿Setting Custom Event Details"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.7: Setting Custom Event Details</p>
			<ol>
				<li value="7">Lastly, scroll <a id="_idIndexMarker617"/>down to the event and double check that the <strong class="bold">Enabled</strong> option is turned on; otherwise, the events will only show up in the <strong class="bold">Invalid Events</strong> area of the <span class="No-Break">event browser.</span></li>
			</ol>
			<div>
				<div id="_idContainer281" class="IMG---Figure">
					<img src="image/B18868_10_08.jpg" alt="Figure 10.8: Enabling the event"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.8: Enabling the event</p>
			<ol>
				<li value="8">Go back to the Unity Editor and play your game again, triggering the <strong class="source-inline">gamePaused</strong> event so that it will show <span class="No-Break">up correctly.</span></li>
				<li>Wait 15 minutes or so, go back to the event browser, and hit the <strong class="bold">Refresh</strong> button. If all goes well, you should see the <strong class="source-inline">gamePaused</strong> event there! To make it easier to see, you can also click on the <strong class="bold">Event Name</strong> dropdown, select <strong class="source-inline">gamePaused</strong>, and then hit the <strong class="bold">Apply</strong> button to isolate the event browser to only show <span class="No-Break">those events.</span></li>
			</ol>
			<p>If not, it may <a id="_idIndexMarker618"/>take some time before the events are updated in the event browser, but they should show <span class="No-Break">up eventually.</span></p>
			<div>
				<div id="_idContainer282" class="IMG---Figure">
					<img src="image/B18868_10_09.jpg" alt="Figure 10.9: Our simple custom events in the event browser"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.9: Our simple custom events in the event browser</p>
			<ol>
				<li value="10">Next, click on the <strong class="bold">Data </strong><span class="No-Break"><strong class="bold">Explorer</strong></span><span class="No-Break"> option.</span></li>
			</ol>
			<p>In the <strong class="bold">Data Explorer</strong> tab, you’ll see two buttons for <strong class="bold">Metric</strong> and <strong class="bold">Event</strong>. We can also use this menu to observe whenever the <strong class="source-inline">gamePaused</strong> event <span class="No-Break">is called.</span></p>
			<p class="callout-heading">Tip</p>
			<p class="callout">If you have just created the event, it may take up to 12 hours for the information to be received. Go ahead and check back later if that’s the case. In the past, I’ve had to wait up to even 48 hours for the data, so do not be alarmed if it takes a while for it to show up, although I have not had this issue with the newest iteration of Unity <span class="No-Break">Gaming Serv<a id="_idTextAnchor326"/>ices.</span></p>
			<ol>
				<li value="11">Click on the <strong class="bold">+</strong> button to the left of <strong class="bold">Add Event</strong> to add a custom event to this graph. Then, select the <strong class="bold">Add Event</strong> dropdown and then <strong class="bold">gamePaused</strong>. Since we have just made the event, we won’t see it on previous dates in Analytics, but we can <a id="_idIndexMarker619"/>see it a little easier if we click on the <strong class="bold">Column Chart</strong> button to change how the data <span class="No-Break">is displayed:</span></li>
			</ol>
			<div>
				<div id="_idContainer283" class="IMG---Figure">
					<img src="image/B18868_10_10.jpg" alt="Figure 10.10: Add Event"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.10: Add Event</p>
			<p>Now, when we scroll down, we <a id="_idIndexMarker620"/>can see that <strong class="bold">Data Explorer</strong> now shows how often the <strong class="source-inline">gamePaused</strong> event has <span class="No-Break">been cal<a id="_idTextAnchor327"/>led!</span></p>
			<h2 id="_idParaDest-121"><a id="_idTextAnchor328"/>Sending custom events with properties</h2>
			<p>One additional <a id="_idIndexMarker621"/>thing that we may want to track is how far players get before they lose. Let’s take a look at how to do <span class="No-Break">that now:</span></p>
			<ol>
				<li>In the Dashboard, first, go to the Event Manager. Click on <strong class="bold">Add New</strong> and select <strong class="bold">Custom Event</strong>. For <strong class="bold">Event name</strong>, type in <strong class="source-inline">gameOver</strong>, and then fill in the <strong class="bold">Event description</strong> field with something like Records when the players causes a game over event to occur. Afterward, click on the <span class="No-Break"><strong class="bold">Create</strong></span><span class="No-Break"> button.</span></li>
				<li>From there, you’ll be brought to a page for the event. Click on the <strong class="bold">Assign Parameter</strong> button, and from there, under the <strong class="bold">Parameter</strong> dropdown, select <strong class="bold">Add </strong><span class="No-Break"><strong class="bold">New Parameter</strong></span><span class="No-Break">.</span></li>
			</ol>
			<div>
				<div id="_idContainer284" class="IMG---Figure">
					<img src="image/B18868_10_11.jpg" alt="Figure 10.11: Add New Parameter"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.11: Add New Parameter</p>
			<ol>
				<li value="3">For the <a id="_idIndexMarker622"/>parameter name, type in <strong class="source-inline">score</strong>, and then fill in a description for the parameter. For the parameter type, select <strong class="bold">Float</strong>, and then click the <span class="No-Break"><strong class="bold">Create</strong></span><span class="No-Break"> button.</span></li>
			</ol>
			<div>
				<div id="_idContainer285" class="IMG---Figure">
					<img src="image/B18868_10_12.jpg" alt="Figure 10.12: Adding a custom parameter"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.12: Adding a custom parameter</p>
			<ol>
				<li value="4">Create a <a id="_idIndexMarker623"/>new event called <strong class="source-inline">gameOver</strong> and a custom parameter, which we will call <strong class="source-inline">score</strong> and will be a float. Then, click on the <strong class="bold">Create</strong> button, select <strong class="source-inline">score</strong>, and then <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Assign</strong></span><span class="No-Break">.</span></li>
			</ol>
			<div>
				<div id="_idContainer286" class="IMG---Figure">
					<img src="image/B18868_10_13.jpg" alt="Figure 10.13: Assigning the score parameter"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.13: Assigning the score parameter</p>
			<ol>
				<li value="5">Finally, click <a id="_idIndexMarker624"/>on the <strong class="bold">Enabled</strong> toggle so that the <strong class="source-inline">gameOver</strong> event will be saved when it occurs. Unity will ask whether you’re sure you want to enable the event; click on the <strong class="bold">Enable</strong> button to ensure that it <span class="No-Break">will happen.</span></li>
			</ol>
			<div>
				<div id="_idContainer287" class="IMG---Figure">
					<img src="image/B18868_10_14.jpg" alt="Figure 10.14: Enabling the event"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.14: Enabling the event</p>
			<ol>
				<li value="6">Now, return to <a id="_idIndexMarker625"/>the Unity Editor. First, we will need to open up the <strong class="source-inline">ObstacleBehaviour</strong> script to modify what happens when the <span class="No-Break">game ends.</span></li>
				<li>To utilize Unity Analytics with parameters, at the top of the file, we will add the following <span class="No-Break"><strong class="source-inline">using</strong></span><span class="No-Break"> declarations:</span><pre class="source-code">
using Unity.Services.Analytics; /* AnalyticsService */
using System.Collections.Generic; /* Dictionary */</pre></li>
			</ol>
			<p>The top option is obvious, but we are also adding <strong class="source-inline">System.Collections.Generic</strong> in order to get access to the <strong class="source-inline">Dictionary</strong> class, which we will use in the next piece <span class="No-Break">of code.</span></p>
			<ol>
				<li value="8">Next, we will update the <strong class="source-inline">OnCollisionEnter</strong> function to <span class="No-Break">the following:</span><pre class="source-code">
private void OnCollisionEnter(Collision collision)
{
    var go = collision.gameObject;
    var playerBehaviour =
        go.GetComponent&lt;PlayerBehaviour&gt;();
    // First check if we collided with the player
    if (playerBehaviour)
    {
        // Destroy the player
        //Destroy(collision.gameObject);
        // Destroy (Hide) the player
        player = go;
        player.SetActive(false);
        /* If Unity Analytics doesn't exist will throw
           an exception */
        try
        {
            /* Define Custom Parameters */
            var eventData = new Dictionary&lt;string,
                object&gt;
            {
                { "score", playerBehaviour.Score }
            };
    <a id="_idTextAnchor329"/>        AnalyticsService.Instance.CustomData("game
                Over", eventData);
            AnalyticsService.Instance.Flush();
        }
        catch(ServicesInitializationException e)
        {
            /* Displays the exception but doesn't
               break * the game */
            Debug.LogWarning(e.Message);
        }
        /* Call the function ResetGame after waitTime
           has passed */
        Invoke("ResetGame", waitTime);
    }
}</pre></li>
			</ol>
			<p>We’ve done a number of things within this script. To start off with, we have rewritten <a id="_idIndexMarker626"/>our check that the player uses the component as a variable now, so we don’t have to call <strong class="source-inline">GetComponent</strong> again for the same thing. Aside from that, the main addition is the calling of the <strong class="source-inline">AnalyticsService.Instance.CustomData</strong> function with a second parameter. The second parameter (which is optional) is a dictionary, which we haven’t <span class="No-Break">discussed yet.</span></p>
			<p>A <strong class="bold">dictionary</strong> is a class <a id="_idIndexMarker627"/>that represents a pair of keys and values. The key is an identifier of some sort, which allows us to have a reference to obtain the value. This is most often used with the <strong class="source-inline">string</strong> class as the key type so that you can refer to some other <span class="No-Break">data type.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">For more information on dictionaries, check <span class="No-Break">out </span><a href="http://csharp.net-informations.com/collection/dictionary.htm"><span class="No-Break">http://csharp.net-informations.com/collection/dictionary.htm</span></a><span class="No-Break">.</span></p>
			<p>We’ve wrapped this code in a <strong class="source-inline">try</strong> and <strong class="source-inline">catch</strong> block because if <strong class="source-inline">AnalyticsService.Instance</strong> is called and it is <strong class="source-inline">null</strong>, the code written by Unity will throw an exception. This will cause the game to break and no longer work. The game currently works fine if we start the game from the title screen, but if we start the game from the gameplay scene, it will no longer work correctly due to Analytics not being initialized. This time, instead of doing nothing like the previous example, I added a line to actually print out the message that the error gives us as a warning. It’s always a good idea to have our code be as robust as possible, so that’s why we added <span class="No-Break">this check.</span></p>
			<ol>
				<li value="9">Save the script and return to the <span class="No-Break">Unity Editor.</span></li>
				<li>Play the game and lose it. Note in the <strong class="bold">Console</strong> window that you are now sending a <span class="No-Break"><strong class="source-inline">gameOver</strong></span><span class="No-Break"><strong class="bold"> </strong></span><span class="No-Break">event:</span></li>
			</ol>
			<div>
				<div id="_idContainer288" class="IMG---Figure">
					<img src="image/B18868_10_15.jpg" alt="Figure 10.15: A Game Over event being disp﻿atched"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.15: A Game Over event being disp<a id="_idTextAnchor330"/>atched</p>
			<p>You can <a id="_idIndexMarker628"/>also dive into the dashboard to see the information as well, but Unity says it may take up to 6 hours before it becomes visible, although I usually see it within 15 minutes or so. You will see the messages instantly in the <strong class="bold">Console</strong> window, but they don’t populate in Analytics until the backend calculations have been processed at Unity’s end, due to all of the events <span class="No-Break">it receives.</span></p>
			<ol>
				<li value="11">After you’ve waited, go to the <strong class="bold">Analytics</strong> tab and click on the <strong class="bold">Dashboard </strong>button once again. Then, go to the event browser and access the <span class="No-Break"><strong class="source-inline">gameOver</strong></span><span class="No-Break"> events.</span></li>
				<li>To be able to see the value of the <strong class="source-inline">score</strong> parameter we created on the far right, click on the button that looks like <strong class="bold">&lt;&gt;</strong> to access the JSON event content for the particular event. Note that we can see the value of our <span class="No-Break">score here:</span></li>
			</ol>
			<div>
				<div id="_idContainer289" class="IMG---Figure">
					<img src="image/B18868_10_16.jpg" alt="Figure 10.16: The score value in the event content"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.16: The score value in the event content</p>
			<p>And with that, we now know how to <span class="No-Break">access events!</span></p>
			<p>This information <a id="_idIndexMarker629"/>is formatted in the manner of a JSON file. <strong class="bold">JSON</strong> stands for <strong class="bold">JavaScript Object Notation</strong> and is a format that<a id="_idIndexMarker630"/> is used to read/write text. The JSON file type is commonly used to transmit data and even save files. It’s nice for programmers because it works with a key-pair system, such as the <strong class="source-inline">Dictionary</strong> class that we <span class="No-Break">used previously.</span></p>
			<p>One of the <a id="_idIndexMarker631"/>limitations of the event browser is the fact that we are only able to see the most recent 100 events. As our project becomes more and more popular, it is likely that we’re going to have more and more events. With that in mind, we will likely want to have some way to be able to interpret that information. One of the ways that we can use do this is th<a id="_idTextAnchor331"/>rough the SQL Data Explorer. This allows us to access all the events <a id="_idIndexMarker632"/>that are created, but we have to utilize <strong class="bold">Structured Query Language</strong> (<strong class="bold">SQL</strong>), which is a domain-specific language that was created to manage data held within <span class="No-Break">a database.</span></p>
			<ol>
				<li value="13">Click on the <strong class="bold">SQL Data Explorer</strong> button to open the menu. Note that the <strong class="bold">Query</strong> field contains some <span class="No-Break">default text.</span></li>
			</ol>
			<div>
				<div id="_idContainer290" class="IMG---Figure">
					<img src="image/B18868_10_17.jpg" alt="Figure 10.17: SQL Data Explorer"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.17: SQL Data Explorer</p>
			<ol>
				<li value="14">Hit the <strong class="bold">Run</strong> button <a id="_idIndexMarker633"/>to see the default result and how it works. Once the query finishes, you’ll be able to create a chart using the data it interpreted from <span class="No-Break">this query.</span></li>
				<li>To get a feel for how this can work with chart data, under <strong class="bold">Chart Setup</strong>, set <strong class="bold">X-axis column</strong> to <strong class="bold">EVENT_DATE</strong> and <strong class="bold">Y-axis 1 column</strong> to <strong class="bold">COUNT(DISTINCT USER_ID)</strong>, and then click the <span class="No-Break"><strong class="bold">Apply</strong></span><span class="No-Break"> button.</span></li>
			</ol>
			<div>
				<div id="_idContainer291" class="IMG---Figure">
					<img src="image/B18868_10_18.jpg" alt="Figure 10.18: Chart Setup"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.18: Chart Setup</p>
			<p>This will <a id="_idIndexMarker634"/>allow you to create a chart in a similar manner to what we saw earlier with the Data Explorer, but this gives us more fine-tuned control if we want to use the power <span class="No-Break">of SQL.</span></p>
			<p>There are entire books out there about SQL for those that are interested in exploring it further, but in our case, we want to extract the score values from our custom events. Therefore, instead of a chart, we want to create a table so that, in addition to writing some custom queries, we can also see how to export the data <span class="No-Break">as well.</span></p>
			<ol>
				<li value="16">In the <strong class="bold">Query</strong> field, replace the code with <span class="No-Break">the following:</span><pre class="source-code">
SELECT EVENT_JSON:score::FLOAT
FROM EVENTS
WHERE EVENT_NAME = 'gameOver'</pre></li>
			</ol>
			<p>This code is going to go through every single event and check whether the name of the event is <strong class="source-inline">gameOver</strong>. If so, it will isolate the <strong class="source-inline">score</strong> property from it. This will allow us to create a list of all of the <strong class="source-inline">score</strong> properties from the <span class="No-Break">entire project.</span></p>
			<ol>
				<li value="17">Hit the <strong class="bold">Run</strong> button and wait for it to execute. Once done, you’ll see the <strong class="bold">Share</strong> button on the top has turned blue and you can press it. Once selected, click on the <strong class="bold">Export as CSV </strong><span class="No-Break"><strong class="bold">file</strong></span><span class="No-Break"> option.</span></li>
			</ol>
			<p><strong class="bold">CSV</strong> stands for <strong class="bold">comma-separated values</strong>. This is a file type that uses commas <a id="_idIndexMarker635"/>to separate each of the different values <a id="_idIndexMarker636"/>that are designated within the file, but if you open the file with Google Sheets or Excel, the program will be able to parse the file to resemble a <span class="No-Break">nice table.</span></p>
			<div>
				<div id="_idContainer292" class="IMG---Figure">
					<img src="image/B18868_10_19.jpg" alt="Figure 10.19: The table of score values in Microsoft Excel"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.19: The table of score values in Microsoft Excel</p>
			<p>This gives us a way to see all the various different score values that our players have achieved as they played the game. This can help us see whether people are doing well or really poorly, and allow us to cater the game however <span class="No-Break">we’d like.</span></p>
			<p>Use a snippet like <span class="No-Break">the following:</span></p>
			<pre class="source-code">
SELECT EVENT_JSON
FROM EVENTS
WHERE EVENT_NAME = 'gameOver'</pre>
			<p>The preceding <a id="_idIndexMarker637"/>code would make it so that instead of the first event just showing 6.5199995, we would have each of the slots consist of the entirety of the JSON data that we discussed earlier – in this case, <span class="No-Break">the following:</span></p>
			<pre class="source-code">
"{
  ""clientVersion"": ""0.1"",
  ""collectInsertedTimestamp"": ""2022-12-23
    05:36:22.379"",
  ""eventDate"": ""2022-12-23 00:00:00.000"",
  ""eventID"": 3072590187314819072,
  ""eventLevel"": 0,
  ""eventName"": ""gameOver"",
  ""eventTimestamp"": ""2022-12-23 14:36:19.072"",
  ""eventUUID"": ""0d924683-5667-4455-b899-722bfeae93cd"",
  ""gaUserAcquisitionChannel"": ""None"",
  ""gaUserAgeGroup"": ""UNKNOWN"",
  ""gaUserCountry"": ""KR"",
  ""gaUserGender"": ""UNKNOWN"",
  ""gaUserStartDate"": ""2022-07-28 00:00:00.000"",
  ""mainEventID"": 3072590187314819072,
  ""msSinceLastEvent"": 12124,
  ""platform"": ""PC_CLIENT"",
  ""score"": 6.51999473571777,
  ""sessionID"": ""0ce65df8-9696-40e8-ae44-924417e0d406"",
  ""timezoneOffset"": ""+0900"",
  ""userCountry"": ""KR"",
  ""userID"": ""21328f4689677b24baf59487ae951228""
}"</pre>
			<p>By adding <strong class="source-inline">:score::FLOAT</strong>, we get the <strong class="source-inline">score</strong> variable from the JSON data and tell the computer to interpret it as a <span class="No-Break">floating-point value.</span></p>
			<p>For those <a id="_idIndexMarker638"/>that are interested in exploring SQL more, I suggest checking out the Unity Gaming Service’s example cookbook at <a href="https://github.com/Unity-Technologies/UGS-SQL-Cookbook">https://github.com/Unity-Technologies/UGS-SQL-Cookbook</a>, which contains a collection of common SQL queries and best practices for use with <span class="No-Break">Unity Analytics.</span></p>
			<p>This, of course, is just a simple example, so I would suggest that you create custom events for whenever a user reaches an important milestone – for example, when they level up or <a id="_idIndexMarker639"/>when they make an <strong class="bold">In-App </strong><span class="No-Break"><strong class="bold">Purchase</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">IAP</strong></span><span class="No-Break">).</span></p>
			<p>Now that we know how to<a id="_idIndexMarker640"/> create different types of events, let’s see how we can actually track events and learn more about what our players are doing, utiliz<a id="_idTextAnchor332"/>ing the Funnel <span class="No-Break">A<a id="_idTextAnchor333"/>nalyzer tool.</span></p>
			<h1 id="_idParaDest-122"><a id="_idTextAnchor334"/>Working with funnels</h1>
			<p>One of the many things we’d like to know about our players is how they are actually playing a game – for instance, are users skipping our tutorial? To keep track of how players proceed <a id="_idIndexMarker641"/>through a series of events, we have funnels. Funnels help us to identify where player drop-off happens in <span class="No-Break">our game.</span></p>
			<p>If you happen to see a large number of people not getting to a certain step, you can assume that something that happened in the preceding step causes people to stop playing <span class="No-Break">our game.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">For more information on how funnels work as well as why you’d want to use them, check <span class="No-Break">out </span><a href="https://data36.com/funnel-analysis/"><span class="No-Break">https://data36.com/funnel-analysis/</span></a><span class="No-Break">.</span></p>
			<p>Funnels are based on the concept of custom events, which we used in the <em class="italic">Sending custom events with properties</em> section of this chapter. We can use the Funnels tool (previously known as the Funnel Analyzer) to look at the data sent via these funnels, which we can <a id="_idIndexMarker642"/>then use to make educated decisions on what changes should be made to the game. Follow the steps given here to add <span class="No-Break">the tool:</span></p>
			<ol>
				<li>From the dashboard, go to <strong class="bold">Analytics</strong> and <span class="No-Break">select </span><span class="No-Break"><strong class="bold">Funnels</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer293" class="IMG---Figure">
					<img src="image/B18868_10_20.jpg" alt="Figure 10.20: The Funnels page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.20: The Funnels page</p>
			<p>Right now, there are no funnels set up, so we shoul<a id="_idTextAnchor335"/>d <span class="No-Break">create one.</span></p>
			<ol>
				<li value="2">Click on the <strong class="bold">+ New Funnel</strong> button and fill in the details, as shown in the following <a id="_idIndexMarker643"/>screenshot. Then, scroll all the way down and click on the <span class="No-Break"><strong class="bold">Apply</strong></span><span class="No-Break"> button:</span></li>
			</ol>
			<div>
				<div id="_idContainer294" class="IMG---Figure">
					<img src="image/B18868_10_21.jpg" alt="Figure 10.21: Funnels setup"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.21: Funnels setup</p>
			<p>If you’ve played the game already, you can see the results from the events that have <span class="No-Break">already triggered:</span></p>
			<div>
				<div id="_idContainer295" class="IMG---Figure">
					<img src="image/B18868_10_22.jpg" alt="Figure 10.22: The event trigger results"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.22: The event trigger results</p>
			<p>In our case, we <a id="_idIndexMarker644"/>have played the game and lost, so we currently have a 100% <span class="No-Break">completion rate.</span></p>
			<ol>
				<li value="3">Scroll up to the top page and click on the <strong class="bold">Save Funnel</strong> button. Give the funnel a name, describe what it is you’re creating, and then hit the <span class="No-Break"><strong class="bold">Save</strong></span><span class="No-Break"> button.</span></li>
			</ol>
			<div>
				<div id="_idContainer296" class="IMG---Figure">
					<img src="image/B18868_10_23.jpg" alt="Figure 10.23: The﻿ funnel setup"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 10.23: The<a id="_idTextAnchor336"/> funnel setup</p>
			<p>You should be able to select that funnel, and it will provide information on all the times it has <span class="No-Break">been called.</span></p>
			<p>The concepts <a id="_idIndexMarker645"/>used here can easily be expanded upon in other ways as well, such as keeping track of how often users watch ads or make purchases in the game and what causes them to <span class="No-Break">do so.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">Funnels are great when a game is working correctly, but if the game crashes, it’s also possible to get analytics from that as well from Unity Cloud Diagnostics. For information on that as <a id="_idIndexMarker646"/>well as how to set it up, check <span class="No-Break">out </span><a href="https://docs.unity.com/cloud-diagnostics/en/manual/CrashandExceptionReporting/SettingupCrashandExceptionReporting"><span class="No-Break">https://docs.unity.com/cloud-diagnostics/en/manual/CrashandExceptionReporting/SettingupCrashandExceptionReporting</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-123"><a id="_idTextAnchor337"/>Summary</h1>
			<p>In this chapter, we explored a number of ways that we can make use of Unity’s Analytics tool to make our games better, from how to understand what our players are doing to learning how to adjust our game based on that feedback, without users having to download an entirely new copy of <span class="No-Break">our game.</span></p>
			<p>Specifically, we learned how to set up the Unity Analytics section of the Unity Editor, and then we saw how we can make use of code to create events to be sent to the cloud for us to look at. With the given data, we learned how we could make use of funnels and the Funnel Analyzer to learn more about <span class="No-Break">our players.</span></p>
			<p>Now that we have seen how to create events, let’s see one of the other <a id="_idTextAnchor338"/>main benefits of utilizing Unity Gaming Services – being able to change projects using the Remote Config feature, which we will learn more about in the <span class="No-Break">next chapter.</span></p>
		</div>
	</body></html>