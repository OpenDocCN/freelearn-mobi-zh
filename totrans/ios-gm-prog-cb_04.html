<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;4.&#xA0;Particle System and Game Performance"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04" class="calibre1"/>Chapter 4. Particle System and Game Performance</h1></div></div></div><p class="calibre8">In this chapter, we will be focusing on the following recipes:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Installation of the particle system</li><li class="listitem">Using the particle system in games</li><li class="listitem">Particle emitter integration</li><li class="listitem">Game performance analysis</li></ul></div></div>

<div class="book" title="Chapter&#xA0;4.&#xA0;Particle System and Game Performance">
<div class="book" title="Introduction"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch04lvl1sec25" class="calibre1"/>Introduction</h1></div></div></div><p class="calibre8">In <a class="calibre1" title="Chapter 3. Animations and Texture" href="part0025_split_000.html#page">Chapter 3</a>, <span class="strong"><em class="calibre9">Animations and Texture</em></span>, we built a full game of collecting coins by a spaceship in a parallax infinite scrolling background. Now we are going to add some flyers to the game by introducing some particle systems, making the effects in the game look more alive and beautiful. Also, we will go through some performance analysis terminologies and tools. In this chapter, a performance-level analysis will be done using some performance and monitoring tools to increase the stability and performance of the game FlyingSpaceship.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Installation of the particle system"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec26" class="calibre1"/>Installation of the particle system</h1></div></div></div><p class="calibre8">A<a id="id130" class="calibre1"/> particle system is a collection of separate tiny objects called particles. They are added to scenes and nodes as emitter nodes, which control its position and motion in the scene. These particle systems are used to add some cool effects to the scene, which are highly intense effects such as fire, smoke, explosions, rain, water, and many more.</p><p class="calibre8">In this section, we will discuss how the particle system tools are installed and created for specific effect to be added in the game in the upcoming sections.</p></div>

<div class="book" title="Installation of the particle system">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec56" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre8">Before iOS 7, there <a id="id131" class="calibre1"/>were open source particle editors used for the creation of particle systems. However, from iOS 7, there is an in-built support to create particle systems using a tool called Particle Editor, which comes integrated with Xcode 5.0. So the prerequisite for this section is having iOS 7 and Xcode 5 to create some cool particle effects.</p></div></div>

<div class="book" title="Installation of the particle system">
<div class="book" title="How to do it"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec57" class="calibre1"/>How to do it</h2></div></div></div><p class="calibre8">For creation and implementation of particle systems, we will use Particle Editor. This editor doesn't need any installation as it is in-built in the Xcode, which will be used to create particle system files and then can be added as nodes as a part of the implementation.</p><p class="calibre8">So we can start with the solution kit of <a class="calibre1" title="Chapter 3. Animations and Texture" href="part0025_split_000.html#page">Chapter 3</a>, <span class="strong"><em class="calibre9">Animations and Texture</em></span>, and continue from there. The following are the steps involved to create a Sprite Kit Particle File:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open Xcode and go to <span class="strong"><strong class="calibre2">File</strong></span> | <span class="strong"><strong class="calibre2">New</strong></span> | <span class="strong"><strong class="calibre2">File</strong></span>.<div class="mediaobject"><img src="../images/00046.jpeg" alt="How to do it" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="2">Then choose the <span class="strong"><strong class="calibre2">Resource</strong></span> section in <span class="strong"><strong class="calibre2">iOS Section</strong></span>, select <span class="strong"><strong class="calibre2">SpriteKit Particle File</strong></span>, and press <span class="strong"><strong class="calibre2">Next</strong></span>.<div class="mediaobject"><img src="../images/00047.jpeg" alt="How to do it" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="3">From a list of <a id="id132" class="calibre1"/>particle system templates provided, select the <span class="strong"><strong class="calibre2">Fire</strong></span> particle system template and click on <span class="strong"><strong class="calibre2">Next</strong></span> to create a fire effect, which will be used to depict the thrust of spaceship in the game built so far.<div class="mediaobject"><img src="../images/00048.jpeg" alt="How to do it" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="4">Name<a id="id133" class="calibre1"/> the file <code class="email">FireParticle</code> and click on <span class="strong"><strong class="calibre2">Create</strong></span>.<div class="mediaobject"><img src="../images/00049.jpeg" alt="How to do it" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="5">As a result, a <a id="id134" class="calibre1"/>file named <code class="email">FireParticle.sks</code>, which is the particle file, is created and a sample particle image named <code class="email">spark.png</code>. <code class="email">Spark.png</code> file is autogenerated, which is used as the sks file for the particle system.<div class="mediaobject"><img src="../images/00050.jpeg" alt="How to do it" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="6">As shown in the preceding screenshot, when we select the <code class="email">FireParticle.sks</code> file, the <a id="id135" class="calibre1"/>particle system created in the detail panel with a fire effect looks like this:<div class="mediaobject"><img src="../images/00051.jpeg" alt="How to do it" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="7">Using the right-side inspector panel, we can customize the default particle system as per our need. You can scroll down to explore all the properties in the inspector and hence you can update the settings accordingly.<div class="mediaobject"><img src="../images/00052.jpeg" alt="How to do it" class="calibre10"/></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div><p class="calibre8">Now as we have the<a id="id136" class="calibre1"/> particle system, we can now directly see the results when some values are changed from this inspector. The implementation also works with a few lines of code without changing any particle system values in the code, just picking the file and adding it to any node or scene.</p><p class="calibre8">Let's try out and understand the parameters or the properties of the particle system file.</p><p class="calibre8">As we can see from the list in the preceding screenshot, there is a background section that changes the color of the editor background. It is just saved while the game is built, but is not used at runtime.</p><p class="calibre8">Below this is a particle texture in which we can choose any image or asset to be used in rendering of the particle system. It should be of lesser dimension and memory as the count of particles will be equal to the count of images used there decreasing the frame rate or performance. Decreasing the frame rate in turn will slow down the game and hence it needs to be used wisely.</p><p class="calibre8">Some properties are there to determine the life cycle of the particles such as birthrate, lifetime, and maximum count to be emitted. The particle generation section has <span class="strong"><strong class="calibre2">Position Range</strong></span>, <span class="strong"><strong class="calibre2">Angle</strong></span>, <span class="strong"><strong class="calibre2">Speed</strong></span>, and <span class="strong"><strong class="calibre2">Acceleration</strong></span>.</p><p class="calibre8">Apart from all these, it has scale, rotation, and alpha to change the transforms of the particles. Last but not least, the color modifier part in which the blending and color of our particles can be done.</p><p class="calibre8">Hence, the project having a <code class="email">FireParticle</code> file and explicitly imported image <code class="email">spark.png</code> combined called as the particle system is the Starter Kit for this chapter.</p></div></div>

<div class="book" title="Installation of the particle system">
<div class="book" title="How it works"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec58" class="calibre1"/>How it works</h2></div></div></div><p class="calibre8">The whole creation <a id="id137" class="calibre1"/>of a particle system or a particle file is very easy as discussed earlier. But the effort lies in fine-tuning the properties of the particle emitters, something similar to an anatomy of the particle system we can say. Every particle system has many different properties influencing the look, feel, and behavior of the individual particles and the particle system as one.</p><p class="calibre8">So to play with an particle system file the following values are changed accordingly thereby resulting in an effect of particles of the feel we want. The following is a list of properties described with what happens to the particle system if these are changed.</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre2">Background</strong></span>: This is the background of the particle editor. It is just saved at the built time but not reflected during runtime.</li><li class="listitem"><span class="strong"><strong class="calibre2">Particle Texture</strong></span>: This is an image or asset texture used as a particle image to render the overall particle system.</li><li class="listitem"><span class="strong"><strong class="calibre2">ParticleBirthRate</strong></span>: This is the number of particles generated every second of the system.</li><li class="listitem"><span class="strong"><strong class="calibre2">Maximum Particles</strong></span>: This is the number of particles that an emitter has to generate totally; for value zero, infinite stream of particles are generated.</li><li class="listitem"><span class="strong"><strong class="calibre2">LifeTime</strong></span>: This is the average lifetime of a particle before it vanishes from the screen; the value is inserted in seconds.</li><li class="listitem"><span class="strong"><strong class="calibre2">Position Range</strong></span>: This is the average starting position of a particle.</li><li class="listitem"><span class="strong"><strong class="calibre2">Emitter Angle</strong></span>: This is the average initial direction of a particle. It means the angle at which the particle has to be emitted.</li><li class="listitem"><span class="strong"><strong class="calibre2">Particle Speed and Range</strong></span>: This is the speed at which the particles should move and there is also a <code class="email">SpeedRange</code> parameter; for example, if it is equal to 50 and speed is 100, then the values of speed will vary from 50 (100 - 50) to 150 (100 + 50).</li><li class="listitem"><span class="strong"><strong class="calibre2">Acceleration</strong></span>: These are for both <span class="strong"><em class="calibre9">x</em></span> (horizontal) and <span class="strong"><em class="calibre9">y</em></span> (vertical) accelerations.</li><li class="listitem"><span class="strong"><strong class="calibre2">Alpha</strong></span>: This is the initial alpha set for the particles and it also has a range parameter to specify.</li><li class="listitem"><span class="strong"><strong class="calibre2">Scale</strong></span>: This is the initial scale factor provided for the particle that is, the size of the particle.</li><li class="listitem"><span class="strong"><strong class="calibre2">Rotation</strong></span>: This is the initial rotation of a particle.</li><li class="listitem"><span class="strong"><strong class="calibre2">Color Blend</strong></span>: In this whole section, some blend modes are provided by specifying the average initial color of the particle.</li></ul></div></div></div>

<div class="book" title="Installation of the particle system">
<div class="book" title="There's more"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec59" class="calibre1"/>There's more</h2></div></div></div><p class="calibre8">After the<a id="id138" class="calibre1"/> tour of the installation and understanding of the particle editor, there are many tweaks to be done with the editor in different particle systems to produce something alive and the cool effect of particles.</p><p class="calibre8">In the upcoming section, we will play with the values of the <code class="email">FireParticle</code> file to build a thrust of spaceship, which in future will be added at the back of it in the space environment of the game.</p></div></div>

<div class="book" title="Installation of the particle system">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch04lvl2sec60" class="calibre1"/>See also</h2></div></div></div><p class="calibre8">For better understanding and to learn more about the particle editor of Xcode and tweaking the values of the particle file, you can visit the following link:</p><p class="calibre8">
<a class="calibre1" href="https://developer.apple.com/library/ios/documentation/IDEs/Conceptual/xcode_guide-particle_emitter/Introduction/Introduction.html">https://developer.apple.com/library/ios/documentation/IDEs/Conceptual/xcode_guide-particle_emitter/Introduction/Introduction.html</a>
</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Using the particle system in games"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec27" class="calibre1"/>Using the particle system in games</h1></div></div></div><p class="calibre8">Now as a <a id="id139" class="calibre1"/>complete tour of particle editor is over, we can have a usage of the particle emitters. We will build some stuff for our game that is, the thrust of spaceship using the same <code class="email">FireParticle</code> file and a collision effect when the coin is picked by the spaceship with a default template of smoke.</p><p class="calibre8">In this section, editing<a id="id140" class="calibre1"/> of the particle file using the particle editor of Xcode will be done to produce a game particle effect such as the thrust of spaceship and a new particle file will be formed named <code class="email">SmokeParticle</code> for the collision effect between the coin and spaceship. Also, we will discuss and understand some initial code-level classes.</p></div>

<div class="book" title="Using the particle system in games">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec61" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre8">We should have hands on the particle editor of Xcode with changing values of any particle file and creating some good particle systems that could be used at some places in the game. As the basic elements of particle editor are covered in the previous section, now we will be changing some values of the <code class="email">FireParticle</code> file and build some more particle systems.</p></div></div>

<div class="book" title="Using the particle system in games">
<div class="book" title="How to do it"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec62" class="calibre1"/>How to do it</h2></div></div></div><p class="calibre8">Let's start with the files related to the particle system created and change its property values. There are two files created when building a particle system:</p><div class="book"><ul class="itemizedlist"><li class="listitem">An sks file, which is the particle file, is used to create an <code class="email">SKEmitterNode</code> object to be added on any node or scene.</li><li class="listitem">A default file called <code class="email">spark.png</code> is imported, which is used to specify a particle image in the particle editor for a particular sks file. It can be any image imported externally.</li></ul></div><p class="calibre8">Since the <a id="id141" class="calibre1"/>whole process of creating a particle file is clear, we will <a id="id142" class="calibre1"/>go further with tweaking some of the properties of the <code class="email">FireParticle</code> file to make a thrust of the spaceship.</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First of all, as the spaceship is headed towards the right side of the screen, we have to make a thrust coming from right to left. In the <code class="email">FireParticle</code> file, the default value of the angle is around 89 degrees; change this to 180 to make it look right to left.<div class="mediaobject"><img src="../images/00053.jpeg" alt="How to do it" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="2">As you can see in the preceding snapshot, the particles are more and the birth rate is very high compared to the spaceship. So we need to reduce the particles to 50 and the birth rate to 0.5 giving a smaller particle system with less lifetime, as shown in the following snapshot:<div class="mediaobject"><img src="../images/00054.jpeg" alt="How to do it" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="3">Do<a id="id143" class="calibre1"/> some more tweaks to make it look like a thrust, set its speed to <code class="email">50</code>, make the initial alpha to <code class="email">180</code>, and last and most<a id="id144" class="calibre1"/> importantly, set the scale to <code class="email">0.2</code> so that it matches the spaceship scale.</li><li class="listitem" value="4">Now we have our spaceship thrust built, which will look like this:<div class="mediaobject"><img src="../images/00055.jpeg" alt="How to do it" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="5">The following are the values set in the particle editor of Xcode to create the thrust of the spaceship using the default <code class="email">FireParticle</code> file.<div class="mediaobject"><img src="../images/00056.jpeg" alt="How to do it" class="calibre10"/></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div><p class="calibre8">After this, one more<a id="id145" class="calibre1"/> particle effect called collision effect is <a id="id146" class="calibre1"/>left to be created when a coin is picked by the spaceship. The following are the steps involved to make a <code class="email">SmokeParticle</code> file (particle system) for the collision effect of the coin and the spaceship:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open Xcode and go to <span class="strong"><strong class="calibre2">File</strong></span> | <span class="strong"><strong class="calibre2">New</strong></span> | <span class="strong"><strong class="calibre2">File</strong></span>.</li><li class="listitem" value="2">In the <span class="strong"><strong class="calibre2">Resource</strong></span> section of <span class="strong"><strong class="calibre2">iOS</strong></span>, select <span class="strong"><strong class="calibre2">SpriteKit Particle File</strong></span> and click on <span class="strong"><strong class="calibre2">Next</strong></span>.</li><li class="listitem" value="3">Select the <span class="strong"><strong class="calibre2">Smoke</strong></span> template for the particle system so that an inherited smoke effect is created and click on <span class="strong"><strong class="calibre2">Next</strong></span>.<div class="mediaobject"><img src="../images/00057.jpeg" alt="How to do it" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="4">Name<a id="id147" class="calibre1"/> the<a id="id148" class="calibre1"/> file <code class="email">SmokeParticle</code> and click on <span class="strong"><strong class="calibre2">Create</strong></span>.<div class="mediaobject"><img src="../images/00058.jpeg" alt="How to do it" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="5">As a<a id="id149" class="calibre1"/> result, a<a id="id150" class="calibre1"/> <code class="email">SmokeParticle.sks</code> file is created and the <code class="email">spark.png</code> file imported explicitly will be used by this particle file also.<div class="mediaobject"><img src="../images/00059.jpeg" alt="How to do it" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="6">In the<a id="id151" class="calibre1"/> particle <a id="id152" class="calibre1"/>editor of the <code class="email">SmokeParticle</code> file, the default effect that is created will look like this:<div class="mediaobject"><img src="../images/00060.jpeg" alt="How to do it" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="7">Now to produce a white smoke effect change, we will be changing the properties <a id="id153" class="calibre1"/>of the <a id="id154" class="calibre1"/>particle file. Set the following values to create the required effect:<div class="book"><ul class="itemizedlist1"><li class="listitem"><span class="strong"><strong class="calibre2">Color Blend Factor</strong></span> to <code class="email">0</code></li><li class="listitem"><span class="strong"><strong class="calibre2">LifeTime</strong></span> to <code class="email">2</code></li><li class="listitem"><span class="strong"><strong class="calibre2">Particles</strong></span> to <code class="email">20</code></li><li class="listitem"><span class="strong"><strong class="calibre2">Angle</strong></span> to <code class="email">0</code></li><li class="listitem"><span class="strong"><strong class="calibre2">Speed</strong></span> to <code class="email">20</code></li><li class="listitem"><span class="strong"><strong class="calibre2">Maximum Particles</strong></span> to <code class="email">1</code></li><li class="listitem"><span class="strong"><strong class="calibre2">Scale</strong></span> to <code class="email">0.2</code></li></ul></div></li></ol><div class="calibre14"/></div><p class="calibre8">As a result, a small white smoke effect that will be displayed on the collision of coin and spaceship looks like this in the particle editor:</p><div class="mediaobject"><img src="../images/00061.jpeg" alt="How to do it" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">And the editor inspector of the particle editor will look like this after all the changes have been made:</p><div class="mediaobject"><img src="../images/00062.jpeg" alt="How to do it" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">As of now, both<a id="id155" class="calibre1"/> the <code class="email">FireParticle</code> and <code class="email">SmokeParticle</code> files are ready to be added to the game, but we should know about some classes used to add these files as a node to some node or scene. The node class to be used is <code class="email">SKEmitterNode</code>.</p><p class="calibre8">A <code class="email">SKEmitterNode</code> is a<a id="id156" class="calibre1"/> subclass of <code class="email">SKNode</code> that automatically creates small particles as sprites and renders them on the screen. These emitter nodes can be used to create smoke, fire sparks, rain, and many other particle effects.</p><p class="calibre8">For instance, an object of <code class="email">SKEmitterNode</code>, either we can use an sks particle file with properties set from the particle editor or directly create an object of the <code class="email">SKEmitterNode</code> class and change the properties programmatically in the code. This means there are two ways to do so:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Create an object of <code class="email">SKEmitterNode</code> by getting the path of the particle file from the bundle with predefined property values and then adding to any other node or scene</li><li class="listitem">Create an object of <code class="email">SKEmitterNode</code> just like any other node is created, setting all the properties such as particle image, lifetime, speed, and so on and then adding it to any other node or scene</li></ul></div></div></div>

<div class="book" title="Using the particle system in games">
<div class="book" title="How it works"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec63" class="calibre1"/>How it works</h2></div></div></div><p class="calibre8">Whenever a<a id="id157" class="calibre1"/> SpriteKit particle file is created, a default image that<a id="id158" class="calibre1"/> is imported, such as spark.png, is used as a particle in that particle system. We can also import any image of ours externally to make a personalized particle system.</p><p class="calibre8">As depicted earlier in the making of the thrust of the spaceship, we changed some values of the <code class="email">FireParticle</code> file to have a fire thrust:</p><div class="book"><ul class="itemizedlist"><li class="listitem">We changed the angle value to 180 so that the direction of the thrust can be correct as per the spaceship that is, it moves right to left</li><li class="listitem">We reduced the lifetime and birthrate to match the capacity of  the spaceship so that it can emit as per its size</li><li class="listitem">We also changed the initial size of the particles to match the machinery by which the thrust is released</li><li class="listitem">We tweaked the speed, alpha, and so on</li></ul></div><p class="calibre8">As depicted earlier in the making of the collision effect, we changed some values of the <code class="email">SmokeParticle</code> file to have a smoke effect:</p><div class="book"><ul class="itemizedlist"><li class="listitem">To make it white, we changed <span class="strong"><strong class="calibre2">Color Blend</strong></span> to 0</li><li class="listitem">To make it disappear fast, change <span class="strong"><strong class="calibre2">LifeTime</strong></span> to 2 and <span class="strong"><strong class="calibre2">Speed</strong></span> to 20</li><li class="listitem">To reduce the intensity of particles, assign the number of <span class="strong"><strong class="calibre2">Particles</strong></span> to 20, and to play it once, assign maximum particles to 1</li><li class="listitem">Set the angle to 0 and scale to 0.2 to make the smoke move subtile from left to right </li></ul></div><p class="calibre8">So it's all on us how we want the emitter particle system to behave, to be put, and build according to that.</p><p class="calibre8">Talking about the class that helps to add this particle system that is, <code class="email">SKEmitterNode</code>, which is used to add the particle system in the game by a file or in the code itself. Both options we would be doing at the code level in the upcoming section.</p></div></div>

<div class="book" title="Using the particle system in games">
<div class="book" title="There's more"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec64" class="calibre1"/>There's more</h2></div></div></div><p class="calibre8">After using the particle editor thoroughly, we can really build some particle systems, which can be added as a change to the environment, such as making a snow effect and then adding them randomly onto the scene giving a feel of snowfall. Many more cool changes like this can be built using the particle system editor.</p><p class="calibre8">In the upcoming section, we will add the thrust of the spaceship we built earlier in our game giving a better feel and liveliness of the spaceship.</p></div></div>

<div class="book" title="Using the particle system in games">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch04lvl2sec65" class="calibre1"/>See also</h2></div></div></div><p class="calibre8">For better documentation about the SKEmitterNode and its related properties, you can visit the following link <a class="calibre1" href="https://developer.apple.com/library/ios/documentation/SpriteKit/Reference/SKEmitterNode_Ref/index.html">https://developer.apple.com/library/ios/documentation/SpriteKit/Reference/SKEmitterNode_Ref/index.html</a>.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Particle emitter integration"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec28" class="calibre1"/>Particle emitter integration</h1></div></div></div><p class="calibre8">Now <a id="id159" class="calibre1"/>we are ready and equipped for the particle system to be added to our game FlyingSpaceship. In this section, we will take the <code class="email">FireParticle</code> and <code class="email">SmokeParticle</code> files, create a <code class="email">SKEmitterNode</code> object for the respective file and add it to the respective entity on some event.</p><p class="calibre8">After all this, a<a id="id160" class="calibre1"/> thrust for the spaceship will be visible in the game making our character more empowered. Also, a collision smoke effect will be seen when a coin is picked by the spaceship.</p></div>

<div class="book" title="Particle emitter integration">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec66" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre8">We will start by adding emitters in the games. We should also go through the documentation of the <code class="email">SKEmitterNode</code> class provided in the preceding sections. And then we can continue adding the code for the addition of the spaceship's thrust in the starter kit of this chapter.</p></div></div>

<div class="book" title="Particle emitter integration">
<div class="book" title="How to do it"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec67" class="calibre1"/>How to do it</h2></div></div></div><p class="calibre8">Continuing with the same Xcode project, now we will create our solution kit for this chapter that is, Chapter 4.</p><p class="calibre8">The following are the steps to add the spaceship's thrust in our game:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open the <code class="email">FSMyScene</code> class and add a method called <code class="email">addSpaceShipThrust</code>.<p class="calibre15">To get a particle file, first we need the file's path to pick it from the bundle. The method to find the path will require the name of the particle file and its type.</p><div class="informalexample"><pre class="programlisting">    NSString *emitterPath = [[NSBundle mainBundle] pathForResource:@"FireParticle" ofType:@"sks"];</pre></div></li><li class="listitem" value="2">After this, we can instantiate a new object of <code class="email">SKEmitterNode</code> with the file path that is, <code class="email">emitterPath</code> used in preceding code. This is accomplished by using <code class="email">NSKeyedUnarchiver</code>, which will return an object of <code class="email">SKEMitterNode</code> for a path that is provided.<div class="informalexample"><pre class="programlisting">    SKEmitterNode *emitterNode = [NSKeyedUnarchiver unarchiveObjectWithFile:emitterPath];</pre></div></li><li class="listitem" value="3">Once <a id="id161" class="calibre1"/>the object of emitter is created, specify its position which has to be given according to the center of the spaceship as it's its thrust.<div class="informalexample"><pre class="programlisting">    emitterNode.particlePosition = CGPointMake(-self.spaceShipSprite.frame.size.width/2,0);</pre></div></li><li class="listitem" value="4">Lastly, after all the configuration is done, just add the <code class="email">emitterNode</code> object to <code class="email">SpaceShipSprite</code>.<div class="informalexample"><pre class="programlisting">    [self.spaceShipSprite addChild:emitterNode];</pre></div></li><li class="listitem" value="5">Call the <code class="email">addSpaceShipThrust</code> method in the <code class="email">init</code> method just after the <code class="email">addSpaceShip</code> method.</li><li class="listitem" value="6">The preceding <code class="email">SKEmitterNode</code> was fully created using the <span class="strong"><strong class="calibre2">SpriteKit Particle</strong></span> file. But we can tweak the properties of <code class="email">SKEmitterNode</code> in the code itself.</li><li class="listitem" value="7">As we want to increase the speed of the thrust after adding the emitter node, similarly, for this, we can edit the speed property of the emitter node object.<div class="informalexample"><pre class="programlisting">    emitterNode.speed = 500.0f;</pre></div></li><li class="listitem" value="8">As output of all above creation of <code class="email">FireParticle</code> file using particle editor and adding it in the code using <code class="email">SKEmitterNode</code> class on the spaceship, the thrust appears at the back side of our character of game that is, spaceship.</li></ol><div class="calibre14"/></div><p class="calibre8">The following are the steps to add the smoke effect on collision of the coin and the spaceship in our game:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open the <code class="email">FSMyScene</code> class and add a method called <code class="email">addCoinCollisionEffectWithSpaceShip</code>.</li><li class="listitem" value="2">Repeat the steps we performed while creating the thrust of the spaceship. Specify the filename and its type to get the path.<div class="informalexample"><pre class="programlisting">    NSString *emitterPath = [[NSBundle mainBundle] pathForResource:@"SmokeParticle" ofType:@"sks"];</pre></div></li><li class="listitem" value="3">After this, we can instantiate a new object of <code class="email">SKEmitterNode</code> using <code class="email">NSKeyedUnarchiver</code>, which will return an object of <code class="email">SKEMitterNode</code> for a path that is provided.<div class="informalexample"><pre class="programlisting">    SKEmitterNode *emitterNode = [NSKeyedUnarchiver unarchiveObjectWithFile:emitterPath];</pre></div></li><li class="listitem" value="4">Once<a id="id162" class="calibre1"/> the object of the emitter is created, specify its position, which will be the center of spaceship.<div class="informalexample"><pre class="programlisting">    emitterNode.particlePosition =  CGPointMake(0,0);</pre></div></li><li class="listitem" value="5">Lastly, after all the configuration is done, just add the <code class="email">emitterNode</code> object (that is, <code class="email">SmokeEffect</code> object) to <code class="email">SpaceShipSprite</code>.<div class="informalexample"><pre class="programlisting">    [self.spaceShipSprite addChild:emitterNode];</pre></div></li><li class="listitem" value="6">Add all these lines to the <code class="email">addCoinCollisionEffectWithSpaceShip</code> method and it looks like this.</li><li class="listitem" value="7">Now call this method when the coin collides with the spaceship that is, in method named <code class="email">spaceShipCollidedWithCoin</code>.<div class="informalexample"><pre class="programlisting">    [self addCoinCollisionEffectWithSpaceShip];</pre></div></li><li class="listitem" value="8"><code class="email">spaceShipCollidedWithCoin</code> looks like this after a call is made to add <code class="email">Coin CollisionEffect</code>.</li></ol><div class="calibre14"/></div><p class="calibre8">As output of all above creating of <code class="email">SmokeParticle</code> file using particle editor and adding it in the code using <code class="email">SKEmitterNode</code> class on the spaceship, the smoke collision effect appears at the collision point of coin and the spaceship.</p></div></div>

<div class="book" title="Particle emitter integration">
<div class="book" title="How it works"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec68" class="calibre1"/>How it works</h2></div></div></div><p class="calibre8">This is how it works when we add <code class="email">SKEmitterNode</code> to <code class="email">SKSprite</code> and the result of the preceding steps is depicted in the following screenshot, a thrust added to the spaceship:</p><div class="mediaobject"><img src="../images/00063.jpeg" alt="How it works" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">Similarly, to add a collision smoke effect, we need the <code class="email">ParticleSystem</code> file, which has been created in <a id="id163" class="calibre1"/>previous sections. For this effect also, the process works similar as depicted earlier for thrust of the spaceship. The following are the two snapshots after implementing the collision smoke effect.</p><div class="book"><ul class="itemizedlist"><li class="listitem">Coin collides with the spaceship:<div class="mediaobject"><img src="../images/00064.jpeg" alt="How it works" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem">Collision smoke effect produced:<div class="mediaobject"><img src="../images/00065.jpeg" alt="How it works" class="calibre10"/></div><p class="calibre13"> </p></li></ul></div></div></div>

<div class="book" title="Particle emitter integration">
<div class="book" title="There's more"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec69" class="calibre1"/>There's more</h2></div></div></div><p class="calibre8">As the thrust<a id="id164" class="calibre1"/> of the spaceship is made, we can make a variety of such small particle effects to be added on such entities or when any sort of event occurs. Similarly, we can also add a particle effect when a coin is picked by the spaceship. And if needed, we can build a particle effect that can change the whole feel of an environment such as creating a rain or snowfall as discussed in previous sections.</p></div></div>

<div class="book" title="Particle emitter integration">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch04lvl2sec70" class="calibre1"/>See also</h2></div></div></div><p class="calibre8">There are a variety of things to do using the Particle Editor of Xcode. To explore more about the <a id="id165" class="calibre1"/>particle system visit <a class="calibre1" href="https://developer.apple.com/library/ios/documentation/SceneKit/Reference/SCNParticleSystem_Class/index.html">https://developer.apple.com/library/ios/documentation/SceneKit/Reference/SCNParticleSystem_Class/index.html</a>.</p></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Game performance analysis"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec29" class="calibre1"/>Game performance analysis</h1></div></div></div><p class="calibre8">While <a id="id166" class="calibre1"/>building games, a lot of intense processing and analysis is done to create a real-time environment of the game, so there is a huge requirement of game performance analysis to be done for the smooth functioning of a game or it can be a software product also.</p><p class="calibre8">From a user's perspective, if the game becomes slow or stops responding, technically decreasing the frame rate, users are likely to get frustrated by the game they are playing and will look for an alternative. So there has to be a good level of performance of games, which can be achieved by a game developer by doing performance analysis, which also helps in identifying problems easily and then fixing them.</p><p class="calibre8">So in the field <a id="id167" class="calibre1"/>of software performance analysis, developers need to use specific tools and the performance documentation so that they can identify and fix common performance issues thereby building a game with a stable and better performance.</p><p class="calibre8">In this recipe, we look at some performance tools for an application, how to use them, determine the lose pools, and fix them, thereby maintaining a better performance level for the application.</p></div>

<div class="book" title="Game performance analysis">
<div class="book" title="Getting ready"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec71" class="calibre1"/>Getting ready</h2></div></div></div><p class="calibre8">For doing performance analysis, we should go through and have a knowledge of some terminologies such as drawing code, launch time initialization code, file access code, application footprint, memory allocation code, basic optimizing tips, event-based handlers, improving concurrency of program's tasks, using accelerate framework, modernizing the application, and many more.</p></div></div>

<div class="book" title="Game performance analysis">
<div class="book" title="How to do it"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec72" class="calibre1"/>How to do it</h2></div></div></div><p class="calibre8">Xcode includes tools with several graphical applications and command-line tools to collect performance metrics. There are many available tools such as instruments, analysis tools, monitoring tools, hardware analysis tools, additional command-line tools, and many more.</p><p class="calibre8">All are used to gather performance data, but there are a few of the them used more frequently such as the in-built debug navigator inspector, instruments, and many more. So in this section, you will learn about the debug navigator and the instrument's tools.</p><div class="book" title="Debug navigator"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec01" class="calibre1"/>Debug navigator</h3></div></div></div><p class="calibre8">In the project navigator<a id="id168" class="calibre1"/> of the Xcode project, there is a debug navigator<a id="id169" class="calibre1"/> at the sixth position of the panel, which shows the <span class="strong"><strong class="calibre2">CPU</strong></span> utilization and the <span class="strong"><strong class="calibre2">Memory</strong></span> utilization of the running application.</p><p class="calibre8">The following are the steps<a id="id170" class="calibre1"/> involved in analyzing the utilization types of the app:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First of all, open any project or we can open our own project the Solution kit of this chapter and press <span class="strong"><em class="calibre9">command</em></span> + <span class="strong"><em class="calibre9">R</em></span> to run the application FlyingSpaceship.</li><li class="listitem" value="2">Click on the debug navigator; a panel like this appears:<div class="mediaobject"><img src="../images/00066.jpeg" alt="Debug navigator" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="3">Here, the<a id="id171" class="calibre1"/> total <span class="strong"><strong class="calibre2">CPU</strong></span> utilization in percentage that is, <span class="strong"><strong class="calibre2">72%</strong></span> and <span class="strong"><strong class="calibre2">Memory</strong></span> used that is, <span class="strong"><strong class="calibre2">54 MB</strong></span> is shown in the panel. For further analysis of these metrics, we can click on the respective rows to view the proper graphs.</li></ol><div class="calibre14"/></div><p class="calibre8">In <span class="strong"><strong class="calibre2">CPU</strong></span> there are<a id="id172" class="calibre1"/> three different graphs of sections shown:</p><div class="book"><ul class="itemizedlist"><li class="listitem">The CPU Utilization section:<div class="mediaobject"><img src="../images/00067.jpeg" alt="Debug navigator" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem">The Utilization Over Time section:<div class="mediaobject"><img src="../images/00068.jpeg" alt="Debug navigator" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem">The<a id="id173" class="calibre1"/> Threads section:<div class="mediaobject"><img src="../images/00069.jpeg" alt="Debug navigator" class="calibre10"/></div><p class="calibre13"> </p></li></ul></div><p class="calibre8">In <span class="strong"><strong class="calibre2">Memory</strong></span>, two different graphs of sections are shown:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Memory utilization:<div class="mediaobject"><img src="../images/00070.jpeg" alt="Debug navigator" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem">Memory time-based graph:<div class="mediaobject"><img src="../images/00071.jpeg" alt="Debug navigator" class="calibre10"/></div><p class="calibre13"> </p></li></ul></div></div><div class="book" title="Instruments"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec02" class="calibre1"/>Instruments</h3></div></div></div><p class="calibre8">Instruments <a id="id174" class="calibre1"/>is a collection of powerful analysis tools with<a id="id175" class="calibre1"/> an graphical user interface. Instruments help in knowing the runtime behavior of our application. It shows only one aspect of our program at a time, thereby we can configure each performance analysis session with multiple instruments each collecting a specific performance metric.</p><p class="calibre8">Talking about user interface, all data is shown side by side so that the data can be correlated from one instrument to another, identifying the trends followed in our application behavior. These<a id="id176" class="calibre1"/> metrics can be gathered using instruments:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Core data based applications</li><li class="listitem">Read/write operation about filesystems</li><li class="listitem">Stats corresponding to memory-related allocations and objects</li><li class="listitem">Memory leaks information</li><li class="listitem">Information about events dispatched by Cocoa</li><li class="listitem">Samples of our app during runtime</li><li class="listitem">Stats related to garbage collected code</li></ul></div><p class="calibre8">The following are the steps to use instruments:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">First of all, open any project or we can open our own project from the solution kit of this chapter and press <span class="strong"><em class="calibre9">command</em></span> + <span class="strong"><em class="calibre9">R</em></span> to run the application FlyingSpaceship.</li><li class="listitem" value="2">Click <a id="id177" class="calibre1"/>on the <span class="strong"><strong class="calibre2">CPU</strong></span> utilization section of debug navigator.</li><li class="listitem" value="3">Then click on the <span class="strong"><strong class="calibre2">Profile in Instruments</strong></span> button, which is at the topmost right position in this section. Xcode will show a pop up asking us to transfer the same session to instruments or to restart. We can select the one we wish to analyze.<div class="mediaobject"><img src="../images/00072.jpeg" alt="Instruments" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="4">Suppose we say transfer, then Xcode will open the instruments with a time profiler inserted in its user interface by default showing running time of different threads.<div class="mediaobject"><img src="../images/00073.jpeg" alt="Instruments" class="calibre10"/></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div><p class="calibre8">We can also run the<a id="id178" class="calibre1"/> instruments by pressing <span class="strong"><em class="calibre9">command</em></span> + <span class="strong"><em class="calibre9">i</em></span> and it will open instruments to select the metrics to be analyzed similar to this:</p><div class="mediaobject"><img src="../images/00074.jpeg" alt="Instruments" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">Now perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Now suppose we select the <span class="strong"><strong class="calibre2">Allocations</strong></span> category to view these allocations of the app.</li><li class="listitem" value="2">But the allocations are not in readable format; hence, click on the <span class="strong"><strong class="calibre2">Statistics</strong></span> button and select <span class="strong"><strong class="calibre2">Call Trees</strong></span> so that the calls are arranged in the sequence of calls.<div class="mediaobject"><img src="../images/00075.jpeg" alt="Instruments" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="3">After that, for<a id="id179" class="calibre1"/> better readability, check the <span class="strong"><strong class="calibre2">Show Obj-C Only</strong></span> checkbox.<div class="mediaobject"><img src="../images/00076.jpeg" alt="Instruments" class="calibre10"/></div><p class="calibre13"> </p></li><li class="listitem" value="4">After clicking on these two buttons, we can really look at how the allocations are happening in the application. You can see and analyze your allocations using these methods.</li><li class="listitem" value="5">For further analysis, there many more metrics that can be included with the help of a library by clicking on the top bar button <span class="strong"><strong class="calibre2">Library</strong></span>.<div class="mediaobject"><img src="../images/00077.jpeg" alt="Instruments" class="calibre10"/></div><p class="calibre13"> </p></li></ol><div class="calibre14"/></div><p class="calibre8">This is what the <a id="id180" class="calibre1"/>library looks like with many options of selecting other metrics:</p><div class="mediaobject"><img src="../images/00078.jpeg" alt="Instruments" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">By using this library, we can include multiple metrics such as leaks, time profiler, and view them collectively at the side panel of instruments.</p></div></div></div>

<div class="book" title="Game performance analysis">
<div class="book" title="There's more"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec73" class="calibre1"/>There's more</h2></div></div></div><p class="calibre8">For better understanding of how the performance varies with your change in code, use tools listed in this section, such as instruments. And also, for better understanding of the preceding terminologies discussed, read the documentation provided at:</p><p class="calibre8">
<a class="calibre1" href="https://developer.apple.com/library/mac/documentation/Performance/Conceptual/PerformanceOverview/BasicTips/BasicTips.html#//apple_ref/doc/uid/TP40001410-CH204-BBCGCFGF">https://developer.apple.com/library/mac/documentation/Performance/Conceptual/PerformanceOverview/BasicTips/BasicTips.html#//apple_ref/doc/uid/TP40001410-CH204-BBCGCFGF</a>.</p></div></div>

<div class="book" title="Game performance analysis">
<div class="book" title="See also"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec74" class="calibre1"/>See also</h2></div></div></div><p class="calibre8">To check the level of performance for any application thereby improving that, use the tools and initial performance evaluation process documented at the following links:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><a class="calibre1" href="https://developer.apple.com/library/mac/documentation/Performance/Conceptual/PerformanceOverview/PerformanceTools/PerformanceTools.html#//apple_ref/doc/uid/TP40001410-CH205-BCIIHAAJ">https://developer.apple.com/library/mac/documentation/Performance/Conceptual/PerformanceOverview/PerformanceTools/PerformanceTools.html#//apple_ref/doc/uid/TP40001410-CH205-BCIIHAAJ</a>.</li><li class="listitem"><a class="calibre1" href="https://developer.apple.com/library/mac/documentation/Performance/Conceptual/PerformanceOverview/InitialEvaluation/InitialEvaluation.html#//apple_ref/doc/uid/TP40001410-CH206-CJBFHBDB">https://developer.apple.com/library/mac/documentation/Performance/Conceptual/PerformanceOverview/InitialEvaluation/InitialEvaluation.html#//apple_ref/doc/uid/TP40001410-CH206-CJBFHBDB</a>.</li></ul></div></div></div></body></html>