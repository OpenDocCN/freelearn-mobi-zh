<html><head></head><body>
      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Where Are We?</h1>
            
         </header>
         
         
         <article>
            
            
            <p>We have all used a map at some point in our lives, either an actual map or a map on
               our phone or another device. Apple Maps has come a long way from when it was first
               announced in 2012. Apple has made steady improvements to Apple Maps every year.
            </p>
            
            <p>During this chapter, we will display our restaurant list using a map and custom pins.
               When users tap a pin on the map, they will be taken directly to the restaurant detail
               page that we created in the last chapter.
            </p>
            
            <p>In this chapter, we will cover:</p>
            
            <ul>
               
               <li>What annotations are and how to add them to a map</li>
               
               <li>How to create custom annotations</li>
               
               <li>How to create a storyboard reference</li>
               
            </ul>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Setting up map annotations</h1>
            
         </header>
         
         
         <article>
            
            
            <p class="mce-root">In our map, we are going to drop pins down at each restaurant location. These pins
               are called annotations, more specifically, <kbd>MKAnnotation</kbd>. Since we are going to create multiple <kbd>MKAnnotation</kbd> protocols, we are going to create a class that subclasses <kbd>MKAnnotation</kbd>.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">What is an MKAnnotation?</h1>
            
         </header>
         
         
         <article>
            
            
            <p><kbd>MKAnnotation</kbd> is a protocol that provides us with information related to a map view. Protocols
               provide a blueprint for methods, properties, and other required functionalities .
               The <kbd>MKAnnotation</kbd> will contain information, such as the coordinates (latitude and longitude), title,
               and subtitle of the annotation.
            </p>
            
            <p>To drop a pin onto a map, we must subclass the <kbd>MKAnnotation</kbd>. When we first looked at classes versus structs, we saw that classes could subclass
               or inherit from other classes, which means that we can get properties, methods, and
               additional requirements from the class that we are subclassing. Let's create an annotation
               that subclasses <kbd>MKAnnotation</kbd> and see how this works.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Creating a restaurant annotation</h1>
            
         </header>
         
         
         <article>
            
            
            <p>Before we jump into creating our file, we should first look at the data that we will
               be using. The data for the map view will be the same data that we use for our restaurant-listing
               page. Let's take a look at what the restaurant data will look like in plist format:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/33734dc7-def5-4ba6-97e2-f764e71fbbc6.png"/></div>
            
            <p>We need to create a file to represent this data for the map view, which will differ
               from the restaurant-listing page because we need to subclass <kbd>MKAnnotation</kbd>. Let's get started by creating this file now:
            </p>
            
            <ol>
               
               <li>Right-click on the <kbd>Map</kbd> folder and select <span class="packt_screen">New File</span>.
               </li>
               
               <li>In the <span class="packt_screen">Choose a template for your new file</span> screen, select <span class="packt_screen">iOS</span> at the top and then <span class="packt_screen">Cocoa Touch Class</span>. Then hit <span class="packt_screen">Next</span>.
               </li>
               
               <li>In the <span class="packt_screen">Options</span> screen that appears, add the following:
               </li>
               
            </ol>
            
            <p style="padding-left: 90px">New file<em>:</em></p>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">Class</span><em>:</em> <kbd>RestaurantItem</kbd></li>
                     
                     <li><span class="packt_screen">Subclass</span><em>:</em> <kbd>NSObject</kbd></li>
                     
                     <li><span class="packt_screen">Also create XIB</span><em>:</em> Unchecked
                     </li>
                     
                     <li><span class="packt_screen">Language</span><em>:</em> <kbd>Swift</kbd></li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="4">
               
               <li>Click <span class="packt_screen">Next</span> and then <span class="packt_screen">Create</span>.
               </li>
               
               <li>In this new <kbd>RestaurantItem.swift</kbd> file, under <kbd>import UIKit</kbd>, add <kbd>import MapKit</kbd>. We need this <kbd>import</kbd> statement so that Xcode knows where the files are that we are going to use. 
               </li>
               
               <li>Next, we need to update our class declaration to make our annotation. Since this is
                  subclassing <kbd>MKAnnotation</kbd>, we need to change what we currently have (<kbd>class RestaurantItem: NSObject</kbd>) to the following:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">class RestaurantItem: NSObject, MKAnnotation</pre>
            <p>You will see an error when you add the <kbd>MKAnnotation</kbd>. Just ignore it for now, as we will fix this error shortly.
            </p>
            
            <p>Inside of the class declaration, add the following:</p>
            <pre>var name: String?<br/>var cuisines:[String] = []<br/>var latitude: Double?<br/>var longitude:Double?<br/>var address:String?<br/>var postalCode:String?<br/>var state:String?<br/>var imageURL:String?</pre>
            <p>When the user taps on the annotation, the name of the restaurant and types of cuisine
               will appear along with a detail icon. This detail icon will take the user to the restaurant
               detail page. Then, we will pass along all of this data and use it to populate the
               restaurant detail page we created in the last chapter.
            </p>
            
            <p>We need to initialize all of the data passed into the object. Therefore, let's create
               a custom <kbd>init()</kbd> method to which we can pass a dictionary object through its parameters:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/224baa32-e55f-4e29-b9c4-9cd1c884257d.png"/></div>
            
            <p>This method is large, but it is nothing you have not seen before. We are using the
               <kbd>if...let</kbd> statement to check for data in each element. If something is missing, it will not
               be sent.
            </p>
            
            <p>Let's address the error now. The reason we are getting an error is because we are
               subclassing <kbd>MKAnnotation</kbd> and have not yet declared the coordinates, which is a required property. We also
               have two other optional properties—<kbd>title</kbd> and <kbd>subtitle</kbd>—that we are using for our map and that we need to declare. What we want to be able
               to do is pass the data that we have over to these three properties so that we can
               use them on our map.
            </p>
            
            <p>To get rid of the error, we need to add the coordinates first. We need to set up the
               latitude and longitude, so add the following after the <kbd>init()</kbd> method:
            </p>
            
            <p> </p>
            <pre>var coordinate: CLLocationCoordinate2D {<br/>  guard let lat = latitude, let long = longitude else { return CLLocationCoordinate2D() }<br/>  return CLLocationCoordinate2D(latitude: lat, longitude: long )<br/>}</pre>
            <p> </p>
            
            <p><kbd>CLLocationCoordinate2D</kbd> is a class that is used by <kbd>MapKit</kbd> to set the exact location of a pin.
            </p>
            
            <p>Note that we are using curly braces for this property. It is defined in <kbd>MKAnnotation</kbd>, and we are using the computed property to set the value. For the <kbd>coordinate</kbd> property, we will pass a latitude and longitude to it using a <kbd>CLLocationCoordinate2D</kbd>. In our <kbd>init()</kbd> method, we created the data that sets the latitude and longitude, and now, we are
               passing those coordinates over to the <kbd>coordinate</kbd> property.
            </p>
            
            <p>Let's do the same with <kbd>subtitle</kbd> by adding the following above the variable coordinate:
            </p>
            <pre>var subtitle: String? {<br/>   if cuisines.isEmpty { return "" }<br/>   else if cuisines.count == 1 { return cuisines.first }<br/>   else { return cuisines.joined(separator: ", ") }<br/>}</pre>
            <p>The variable <kbd>subtitle</kbd> is a computed property, but this time we are using an <kbd>else...if</kbd> statement. We first check to see whether the array is empty; if so, nothing displays.
               If we only have one item in the array, we just return that item. Finally, if we have
               multiple items in our array, we take each item and put them in one string, separating
               each item with a comma. For example, if your array had the items <kbd>["American," "Bistro," "Burgers"]</kbd>, then we would create a string that looks like <em>American</em>, <em>Bistro</em>, <em>Burgers</em>.
            </p>
            
            <p>Finally, we need to add the title. Enter the following above the <kbd>subtitle</kbd> variable:
            </p>
            <pre>var title: String? {<br/>   return name<br/>}</pre>
            <p>Your file should no longer have an error, and should now look as follows:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/120174db-8c5d-44a5-81e0-9314e707da3d.png"/></div>
            
            <p>Next, we want to create a manager that will take our data and create annotations for
               our map.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Creating our Map Data Manager  </h1>
            
         </header>
         
         
         <article>
            
            
            <p>In the next chapter, we will deal with data, but for now, we can mock up some data
               to set up our structure. We will use a plist to load our data, just like we did in
               the last chapter.
            </p>
            
            <p>Let's create the <kbd>MapDataManager</kbd> file now:
            </p>
            
            <ol>
               
               <li>Right-click on the <kbd>Map</kbd> folder and select <span class="packt_screen">New File</span>.
               </li>
               
               <li>In the <span class="packt_screen">Choose a template for your new file</span> screen, select <span class="packt_screen">iOS</span> at the top and then <span class="packt_screen">Swift File</span>. Then hit <span class="packt_screen">Next</span>.
               </li>
               
               <li>Name this file <kbd>MapDataManager</kbd> and then hit <span class="packt_screen">Create</span>.
               </li>
               
               <li>Next, we need to define our class definition, so add the following under the <kbd>import</kbd> statement:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">class MapDataManager {} </pre>
            <ol start="5">
               
               <li>Inside of the class declaration, add the following variables:</li>
               
            </ol>
            <pre style="padding-left: 60px">fileprivate var items:[RestaurantItem] = []<br/><br/>var annotations:[RestaurantItem] {<br/>    return items<br/>}</pre>
            <p style="padding-left: 60px">Note that we are keeping our array private since there is no reason to have to access
               this outside of the class.
            </p>
            
            <ol start="6">
               
               <li>Now, let's add the following methods inside of our class declaration, after our variables:</li>
               
            </ol>
            <pre style="padding-left: 60px">func fetch(completion:(_ annotations:[RestaurantItem]) -&gt; ()) {<br/><br/>  if items.count &gt; 0 { items.removeAll() }<br/>        for data in loadData() {<br/>                        items.append(RestaurantItem(dict: data))<br/>        }<br/><br/>        completion(items)<br/>}<br/><br/>fileprivate func loadData() -&gt; [[String:AnyObject]] {<br/>         guard let path = Bundle.main.path(forResource: "MapLocations", ofType: "plist"),<br/>           let items = NSArray(contentsOfFile: path) else { return [[:]] }<br/>        return items as! [[String : AnyObject]]<br/>}</pre>
            <p style="padding-left: 60px">Your file should now look as follows:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/2bcd192a-e1e5-4172-8004-d017480bbd7b.png"/></div>
            
            <ol start="7">
               
               <li>The <kbd>fetch()</kbd> and <kbd>loadData()</kbd> methods are the same as those that we had in the <kbd>ExploreDataManager</kbd> file. However, the <kbd>fetch()</kbd> method here has something new inside of its parameters, specifically:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">  completion:(_ annotations:[RestaurantItem]) -&gt; ())</pre>
            <p style="padding-left: 60px">This is called a <strong>closure block</strong>, which allows us to signify when we have completed the method, and it then dictates
               an action to occur (here, returning an array of annotations). We will use these annotations
               to load pins on our map. We are looping through the <kbd>for...in</kbd> loop; when we are done, we call <kbd>completion()</kbd>. When we get to our <kbd>MapViewController </kbd>, you will see how we write this.
            </p>
            
            <p>Now, let's take a look at our <kbd>MapLocations.plist</kbd> file:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="103" src="assets/ed176a87-db00-4a86-82c5-c551ee97cf59.png" width="395"/></div>
            
            <p>This file is the same structure as our <kbd>ExploreData.plist</kbd> file. Our <kbd>Root</kbd> is an array, and each item inside of our <kbd>Root</kbd> is a dictionary item. There is an acronym that many programmers call  <strong>DRY</strong> (<strong>don't repeat yourself</strong>). Since both plist files have an array of dictionary objects, we can update our code
               so that we can use the same method in multiple places.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Creating a base class </h1>
            
         </header>
         
         
         <article>
            
            
            <p>To keep from repeating ourselves, we are going to create a base class. This base class
               will have a new method called <kbd>load(file name:)</kbd>, but we will add a parameter to pass the file name. Let's create a <kbd>DataManager</kbd> file now under our <kbd>Common</kbd> folder:
            </p>
            
            <ol>
               
               <li>Right-click on the <kbd>Misc</kbd> folder and select <span class="packt_screen">New File</span>.
               </li>
               
               <li>In the <span class="packt_screen">Choose a template for your new file</span> screen, select <span class="packt_screen">iOS</span> at the top and then <span class="packt_screen">Swift File</span>. Then hit <span class="packt_screen">Next</span>:
               </li>
               
               <li>Name this file <kbd>DataManager</kbd>, and then hit <span class="packt_screen">Create</span>.
               </li>
               
            </ol>
            
            <p> </p>
            
            <ol start="4">
               
               <li>In this new file, we need to define our class definition; therefore, add the following
                  under the <kbd>import</kbd> statement:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">protocol DataManager {}</pre>
            <ol start="5">
               
               <li>Inside of the protocol declaration, add the following method:</li>
               
            </ol>
            <pre style="padding-left: 60px">func load(file name:String) -&gt; [[String:AnyObject]]</pre>
            <ol start="6">
               
               <li>Now, create an extension under the protocol:</li>
               
            </ol>
            <pre style="padding-left: 60px">extension DataManager {}</pre>
            <ol start="7">
               
               <li>Inside of the <kbd>extension</kbd> declaration, add the following:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">func load(file name:String) -&gt; [[String:AnyObject]] {<br/>    guard let path = Bundle.main.path(forResource: name, ofType: "plist"),  let items = NSArray(contentsOfFile: path) else { return [[:]] }<br/>   return items as! [[String : AnyObject]]<br/>}</pre>
            <ol start="8">
               
               <li>When you are done, your file should look like mine:</li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/7fca202f-6951-4241-8e93-3ff9ee20a22a.png"/></div>
            
            <p>Other than changing the function name to include parameters, we created the same function
               as we have in our <kbd>Explore</kbd> and <kbd>Map Data Manager</kbd> files. However, this function here is no longer a <kbd>private</kbd> method, because we want it to be accessible to any class that wants to use it.
            </p>
            
            <p>By creating a protocol, we are using what is known as protocol-oriented programming.
               We will not get too heavily into the detail of this since there are plenty of books
               and videos on this topic. The central concept that you will want to understand is
               that we can use this in any class we want and have access to the <kbd>load(name:)</kbd> method.
            </p>
            
            <p>This is all we need to do in this file.</p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Refactoring code </h1>
            
         </header>
         
         
         <article>
            
            
            <p>Now that we have created this new protocol, we can access it anywhere we need it.
               Let's first update our <kbd>MapDataManger</kbd> class to use our newly created protocol:
            </p>
            
            <ol>
               
               <li>Delete the <kbd>loadData()</kbd> function, because we will not need it anymore. You will see an error after you delete
                  the <kbd>loadData()</kbd> method. This error is happening because we need to give the <kbd>fetch()</kbd> method a filename to load whenever we call the <kbd>loadData()</kbd> method. We will fix this shortly.
               </li>
               
               <li>Next, we need to update our class declaration to say:</li>
               
            </ol>
            <pre style="padding-left: 60px">class MapDataManager: DataManager </pre>
            <ol start="3">
               
               <li>We now have our <kbd>MapDataManager</kbd> class using our <kbd>DataManager</kbd> protocol, which means that we will use the <kbd>load(name:)</kbd> method from our <kbd>DataManager</kbd> inside of our <kbd>MapDataManager</kbd>.
               </li>
               
               <li>Now, let's fix the error by updating our <kbd>fetch()</kbd> method from our data in <kbd>loadData()</kbd> to the following:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">for data in load(file: "MapLocations")</pre>
            <p>Your updated file should now look like the following:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="364" src="assets/fc3744ca-5cf2-403e-8f97-e3fb23d172d4.png" width="643"/></div>
            
            <p>We removed the error in our <kbd>MapDataManager</kbd>, but we need to do some refactoring of our <kbd>ExploreDataManager</kbd> file to do the same.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Refactoring ExploreDataManager</h1>
            
         </header>
         
         
         <article>
            
            
            <p>Because our <kbd>loadData()</kbd> was written the same in both the <kbd>ExploreDataManager</kbd> and <kbd>MapDataManager</kbd> files, we need to update our <kbd>ExploreDataManager</kbd> in the same way we just did for the <kbd>MapDataManager</kbd>. Open <kbd>ExploreDataManager</kbd> and do the following:
            </p>
            
            <ol>
               
               <li>Delete the private <kbd>loadData()</kbd> function, because we will not need it anymore. Again, ignore the error as we are
                  going to fix this shortly.
               </li>
               
               <li>Next, update our class declaration to now say:</li>
               
            </ol>
            <pre style="padding-left: 60px">class ExploreDataManager: DataManager</pre>
            <ol start="3">
               
               <li>Now, let's fix the error by updating our <kbd>fetch()</kbd> method from for data in <kbd>loadData()</kbd> to the following:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">for data in load(file: "ExploreData")</pre>
            <ol start="4">
               
               <li>Your updated function should now look like the following:</li>
               
            </ol>
            <pre style="padding-left: 60px">func fetch() {<br/>    for data in load(file: "ExploreData") {<br/>        items.append(ExploreItem(dict: data))<br/>    }<br/>}</pre>
            <p>We have completed refactoring our files, and we can now use the same method any time
               we need to load a plist that has an array of dictionary items.
            </p>
            
            <div>
               
               <p>Refactoring is something with which you will become more comfortable the more you
                  write code. Understanding when to refactor is a bit harder when you first start out
                  because you are still learning. The most prominent indicator that you need to refactor
                  is when you have written something more than once. However, refactoring does not always
                  work for everything; at times, writing the same code more than once can be unavoidable.
                  Just being aware of when refactoring may be useful is a good sign, and half the battle
                  to a greater understanding of this method. I have been coding for years; there will
                  be times when I copy and paste something I wrote to see if it works and then never
                  refactor. Then, months later, I will wonder why I did not write a method to handle
                  it in both places.
               </p>
               
            </div>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Creating and adding annotations</h1>
            
         </header>
         
         
         <article>
            
            
            <p>Now, we need to get our map hooked up and start getting the annotations displaying
               on the map. Then, we will customize our annotations to look like those in our design.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Creating our Map View Controller </h1>
            
         </header>
         
         
         <article>
            
            
            <p>We need to create our <kbd>MapViewController</kbd> file and then connect it with our <kbd>UIViewController</kbd> and map view in storyboard. First, let's create this file:
            </p>
            
            <ol>
               
               <li>In the Navigator panel, right-click on the <kbd>Controller</kbd> folder in the <kbd>Map</kbd> folder and select <span class="packt_screen">New File</span>.
               </li>
               
               <li>In the <span class="packt_screen">Choose a template for your new file</span> screen, select <span class="packt_screen">iOS</span> at the top and then <span class="packt_screen">Cocoa Touch Class</span>. Then hit <span class="packt_screen">Next</span>.
               </li>
               
            </ol>
            
            <p> </p>
            
            <ol start="3">
               
               <li>Add the following to the <span class="packt_screen">Options</span> screen that appears:
               </li>
               
            </ol>
            
            <p style="padding-left: 60px">New file<em>:</em></p>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">Class</span>: <kbd>MapViewController</kbd></li>
                     
                     <li><span class="packt_screen">Subclass</span>: <kbd>UIViewController</kbd></li>
                     
                     <li><span class="packt_screen">Also create XIB</span>: Unchecked
                     </li>
                     
                     <li><span class="packt_screen">Language</span>: <kbd>Swift</kbd></li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="4">
               
               <li>Click <span class="packt_screen">Next</span> and then <span class="packt_screen">Create</span>.
               </li>
               
               <li>Under the <kbd>import UIKit</kbd> statement, add <kbd>import MapKit</kbd>.
               </li>
               
               <li>Update your class declaration to include the following subclass:</li>
               
            </ol>
            <pre style="padding-left: 60px">class MapViewController: UIViewController, MKMapViewDelegate</pre>
            <p>Let's now connect this file with our <kbd>UIViewController</kbd> and our map view in storyboard:
            </p>
            
            <ol>
               
               <li>Add the following after the class declaration:</li>
               
            </ol>
            <pre style="padding-left: 60px">@IBOutlet var mapView: MKMapView!</pre>
            <ol start="2">
               
               <li>Open your <kbd>Map.storyboard</kbd> file.
               </li>
               
               <li>In the Outline view, select the View Controller that contains the map view.</li>
               
               <li>Now, in the Utilities panel, select the Identity inspector.</li>
               
               <li>Under <span class="packt_screen">Custom Class</span>, in the <span class="packt_screen">Class</span> drop-down menu, select <kbd>MapViewController</kbd> and hit <em>Enter</em> in order to connect the View Controller to the class.
               </li>
               
               <li>Now, select the Connections inspector.</li>
               
               <li>Under the Outlets section, you will see an empty circle next to <kbd>mapView</kbd>. Click and drag the outlet to the map view in the View Controller in the Outline
                  view.
               </li>
               
            </ol>
            
            <p>We are going to start working with our map, but first we need to add some things to
               our <kbd>MapDataManager</kbd>:
            </p>
            
            <ol>
               
               <li>Open the <kbd>MapDataManager.swift</kbd> file in the Navigator panel; underneath the <kbd>import Foundation</kbd> statement, add <kbd>import MapKit</kbd>.
               </li>
               
               <li>Next, add the following method to our <kbd>MapDataManager</kbd>:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">func currentRegion(latDelta:CLLocationDegrees, longDelta:CLLocationDegrees) -&gt; MKCoordinateRegion {<br/>    guard let item = items.first else { return MKCoordinateRegion() }<br/>    let span = MKCoordinateSpanMake(latDelta, longDelta)<br/>    return MKCoordinateRegion(center: item.coordinate, span: span)<br/>}</pre>
            <p>Before we delve into the particular sections of this function, we need to understand
               what this function does. When you use a map and drop pins down onto it, you want the
               map to zoom into a particular area. To zoom in on a map, you need a latitude and longitude.
               What this method is doing is grabbing the first pin (or annotation) in the array and
               zooming in on the area:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/4cc38cce-0099-4be6-a9f9-57a8ce09f582.png"/></div>
            
            <p>Let's break down the code:</p>
            
            <ul>
               
               <li><strong>Part A</strong>: Our method has two parameters, both of which are <kbd>CLLocationDegrees</kbd>. It is just a class that represents a latitude or longitude coordinate in degrees:
               </li>
               
            </ul>
            <pre style="padding-left: 60px">func currentRegion(latDelta:CLLocationDegrees, longDelta:CLLocationDegrees) -&gt; MKCoordinateRegion {</pre>
            <ul>
               
               <li><strong>Part B</strong>: <span>This <kbd>guard</kbd> statement obtains the first item in the array. If there are no items in the array,
                     it will just return an empty coordinate region. If there are items in the array, it
                     will return the coordinate region:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">guard let item = items.first else { return MKCoordinateRegion() }</pre>
            <ul>
               
               <li><strong>Part C</strong>: <span>Here, we are creating an <kbd>MKCoordinate</kbd> with the latitude and longitude that we passed into the function. <kbd>MKCoordinateSpan</kbd> defines a span, in the latitude and longitude directions, to show on the map:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">let span = MKCoordinateSpanMake(latDelta, longDelta)</pre>
            <ul>
               
               <li><strong>Part D</strong>: <span>Lastly, we are setting the center and the span of our region and returning them so
                     that when the pins drop, the map can zoom in on the area:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">return MKCoordinateRegion(center: item.coordinate, span: span)</pre>
            <p>Now, let's set up our <kbd>MapViewController</kbd> to display annotations:
            </p>
            
            <ol>
               
               <li>Open the <kbd>MapViewController.swift</kbd> file in the Navigator panel and delete both <kbd>didReceiveMemoryWarning()</kbd> and <kbd>prepare()</kbd> (which has been commented out), as we do not need them for our purposes.
               </li>
               
               <li>Directly under our <kbd>IBOutlet</kbd> statement, add the following:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">let manager = MapDataManager()</pre>
            <ol start="3">
               
               <li>Then, inside of the class definition, add the following method after <kbd>viewDidLoad()</kbd>:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">func addMap(_ annotations:[RestaurantItem]) {<br/>        mapView.setRegion(manager.currentRegion(latDelta: 0.5, longDelta: 0.5), animated: true)<br/>        mapView.addAnnotations(manager.annotations)<br/>}</pre>
            <p>In this method, we are doing a couple of things. We first pass annotations through
               the parameter. When we call <kbd>fetch()</kbd> and it is completed, it will return the array of annotations. We will pass that array
               over to our <kbd>addMap(_ annotations:)</kbd> to use. Next, we set the region by obtaining it from our <kbd>MapDataManager</kbd>, thus setting the latitude and longitude delta. This will set our zoom and region
               for our map. Once we have that, we then pass all of our annotations for the map to
               display.
            </p>
            
            <p>Therefore, we need to have our manager fetch the annotations:</p>
            
            <p>Add the following method above <kbd>addMap(_ annotations:)</kbd>:
            </p>
            <pre>func initialize() {<br/>    mapView.delegate = self       <br/>    manager.fetch { (annotations) in<br/>        addMap(annotations)<br/>    }<br/>}</pre>
            <p>Inside of the <kbd>initialize()</kbd> method, we are setting the map delegate to the class. In previous chapters, we did
               this using storyboard; however, you can also do this with code. This line allows us
               to be notified when the user taps on an annotation or taps the disclosure indicator
               in the annotation.
            </p>
            
            <p>Earlier in this chapter, we created a <kbd>fetch()</kbd> method in the <kbd>MapDataManager</kbd>, wherein we used a closure block. This closure block requires that we wrap it in
               curly braces. Once the <kbd>completion()</kbd> block is called in the manager, everything inside of the curly braces will run. For
               our purposes in building this app, we are going to have a small number of pins or
               annotations ; therefore, we do not need a completion block. However, if you have 100
               or 500 annotations, for instance, a closure block would be more efficient. We will
               do more with this later so that you can get more practice with closure blocks.
            </p>
            
            <p>Add <kbd>initialize()</kbd> inside of <kbd>viewDidLoad()</kbd> so that everything will run when the view loads.
            </p>
            
            <p>Before you build, make sure that you add the <kbd>MapLocations.plist</kbd> file into the <kbd>maps</kbd> folder. This file is in the book <kbd>assets</kbd> folder for this chapter.
            </p>
            
            <p>Let's build and run the project by hitting the Play button (or use <em>cmd</em> + <em>R</em>):
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="417" src="assets/9a2ef4a7-a905-41ee-b32a-9774d5b2e5cf.jpg" width="238"/></div>
            
            <p>We now have pins on our map, but we need to update them so that they look more like
               the ones in our design. Let's learn how to customize the annotations in our map.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Creating custom annotations</h1>
            
         </header>
         
         
         <article>
            
            
            <p>If you have ever owned an iPhone and used Apple Maps, you will be familiar with pins.
               When you have a map inside of your app, having custom pins (annotations) gives your
               app a bit more polish. Let's create our custom annotations.
            </p>
            
            <p>Open up <kbd>MapViewController</kbd> in the Navigator panel and add the following directly under the <kbd>addMap(_ annotations:)</kbd> method:
            </p>
            <pre>func mapView(_ mapView: MKMapView, viewFor annotation: MKAnnotation) -&gt; MKAnnotationView? {<br/>    let identifier = "custompin"<br/>    guard !annotation.is Kind(of: MKUserLocation.self) else { return nil }<br/>    var annotationView: MKAnnotationView?<br/>    if let customAnnotationView = mapView.dequeueReusableAnnotationView(withIdentifier: identifier) {<br/>        annotationView = customAnnotationView<br/>        annotationView?.annotation = annotation<br/>    }<br/>    else {<br/>        let av = MKAnnotationView(annotation: annotation, reuseIdentifier: identifier)<br/>        av.rightCalloutAccessoryView = UIButton(type: .detailDisclosure)<br/>        annotationView = av<br/>    }<br/>    if let annotationView = annotationView {<br/>        annotationView.canShowCallout = true<br/>        annotationView.image = UIImage(named: "custom-annotation")<br/>    }<br/>    return annotationView<br/>}</pre>
            <p>Let's break down this code so we can better understand what we are doing. We will
               break the function down into the following sections:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="248" src="assets/010d2d74-222c-4158-b899-ebdc03e5460e.png" width="407"/></div>
            
            <p>Let's start with A: </p>
            
            <ul>
               
               <li><strong>Part A</strong>: <span>This method will call the <kbd>mapView.delegate</kbd> we set up earlier, when annotations need to be placed. We will use this method to
                     grab the annotations before they are placed and replace the default pins with custom
                     pins:</span><strong><br/></strong></li>
               
            </ul>
            <pre style="padding-left: 60px">mapView(_:viewFor:)</pre>
            <ul>
               
               <li><strong>Part B</strong>: <span>Here, we set an identifier, similar to those that we set when using Collection Views
                     and Table Views:</span><strong><br/></strong></li>
               
            </ul>
            <pre style="padding-left: 60px">let identifier = "custompin"</pre>
            <ul>
               
               <li><strong>Part C</strong>: <span>This guard will ensure that our annotation is not the user location. If the annotation
                     is the user location, the <kbd>guard</kbd> will return <kbd>nil</kbd>. Otherwise, it will move on through the method:</span><strong><br/></strong></li>
               
            </ul>
            <pre style="padding-left: 60px">guard !annotation.isKind(of: MKUserLocation.self) else {<br/>   return nil<br/>}</pre>
            <ul>
               
               <li><strong>Part D</strong>: <span><kbd>MKAnnotationView</kbd> is the class name for the pin; here, we create a variable that we can use to set
                     our custom image:</span><strong><br/></strong></li>
               
            </ul>
            <pre style="padding-left: 60px">var annotationView:MKAnnotationView?<br/><br/></pre>
            <ul>
               
               <li><strong>Part E</strong>: <span>In this statement, we are checking to see whether there are any annotations already
                     created that we can reuse. If so, we point them to the variable we just added previously.
                     Otherwise, we create the annotation in the next <kbd>else</kbd> statement:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">if let customAnnotationView = mapView.dequeueReusableAnnotationView(withIdentifier: identifier) {<br/>   annotationView = customAnnotationView<br/>   annotationView?.annotation = annotation<br/>}</pre>
            <ul>
               
               <li><strong>Part F</strong>: <span>If there are no annotations to reuse, we create a new <kbd>MKAnnotationView</kbd> and give it a callout with a button. A callout is a bubble that appears above the
                     annotation when you tap it to display the title (restaurant name) and subtitle (cuisines)
                     associated with that annotation. If the user selects this callout button, the user
                     is taken to the restaurant detail view:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">else {<br/>   let av = MKAnnotationView(annotation: annotation, reuseIdentifier: identifier)<br/>   av.rightCalloutAccessoryView = UIButton(type: .detailDisclosure)<br/>                 annotationView = av<br/>}</pre>
            <ul>
               
               <li><strong>Part G</strong>: <span>Here is where we make sure that our custom annotation will show a callout. We also
                     set our custom image for our annotation:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">if let annotationView = annotationView {<br/>   annotationView.canShowCallout = true<br/>   annotationView.image = UIImage(named: "custom-annotation")<br/>}</pre>
            <ul>
               
               <li><strong>Part H</strong>: <span>Once we are finished going through the method, we return our custom annotation to
                     the map. This method is called for every annotation that appears on the map:</span></li>
               
            </ul>
            <pre style="padding-left: 60px">return annotationView</pre>
            <p>Let's build and run the project by hitting the Play button (or use <em>cmd</em> + <em>R</em>):
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="427" src="assets/7a48e52d-37f6-44a6-bea4-6698780d423b.jpg" width="243"/></div>
            
            <p>We now have custom annotations displaying on our map. Each pin's callout shows the
               restaurant name as well as the cuisines for the restaurant associated with that particular
               pin. If you tap on the callout, the restaurant detail disclosure does not yet work.
               Let's now set that up. 
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Map to restaurant detail</h1>
            
         </header>
         
         
         <article>
            
            
            <p>For us to go to the restaurant detail from the callout, we need to update our app
               so that our map can also open the restaurant detail. To do this, we must first create
               a storyboard reference.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Creating a storyboard reference</h1>
            
         </header>
         
         
         <article>
            
            
            <p>In order to link to the restaurant detail from the map, we need to create a storyboard
               reference:
            </p>
            
            <ol>
               
               <li>Open the <kbd>Map.storyboard</kbd>, and in the object library of the Utilities panel, drag a <span class="packt_screen">Storyboard Reference</span> into the <kbd>Map.storyboard</kbd> scene:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/ff07caac-9b83-4a85-a15d-093338c29c3b.png"/></div>
            
            <ol start="2">
               
               <li>Next, select the Attributes inspector in the Utilities panel, and update the storyboard
                  under <span class="packt_screen">Storyboard Reference</span> to say <kbd>RestaurantDetail</kbd>. Then, hit <em>Enter</em>: 
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="111" src="assets/6c84f149-da85-4ab4-8249-19366a0e05c6.png" width="222"/></div>
            
            <ol start="3">
               
               <li><em>Ctrl</em> + drag from the Map View controller to the storyboard reference we just created and
                  select <span class="packt_screen">Show</span> on the screen that appears. Note that you can <em>Ctrl</em> + drag from either the Map View controller in the Outline view or the Map View controller
                  icon in the scene, as shown in the following screenshot: 
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="481" src="assets/6fcc930a-141f-4d53-acde-fe720a4a720a.png" width="454"/></div>
            
            <ol start="4">
               
               <li>Select the segue connecting the Map View controller to the storyboard reference:</li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="462" src="assets/3ed59446-782d-4014-9e5e-51c6c51cff02.png" width="449"/></div>
            
            <ol start="5">
               
               <li>In the Attributes inspector, update the <span class="packt_screen">Identifier</span> under <span class="packt_screen">Storyboard Segue</span> to say <kbd>showDetail</kbd>. Then, hit <em>Enter</em>: 
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="132" src="assets/5be16611-379f-45e9-9132-d78fae981c35.png" width="198"/></div>
            
            <p>This identifier is what we are going to call whenever the restaurant detail disclosure
               is tapped. Let's connect our segue next.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Map to restaurant detail</h1>
            
         </header>
         
         
         <article>
            
            
            <p>Before we connect our segue, we should create an enumeration (an <kbd>enum</kbd> for short) to keep track of our segues. An <kbd>enum</kbd> is a user-defined data type that consists of a set of related values:
            </p>
            
            <ol>
               
               <li>Right-click on the <kbd>Misc</kbd> folder inside the <kbd>Common</kbd> folder and select <span class="packt_screen">New File</span>.
               </li>
               
               <li>In the <span class="packt_screen">Choose a template for your new file</span> screen, select <span class="packt_screen">iOS</span> at the top and then <span class="packt_screen">Swift File</span>. Then hit <span class="packt_screen">Next</span>.
               </li>
               
               <li>Name this file <kbd>Segue</kbd> and hit <span class="packt_screen">Create</span>.
               </li>
               
               <li>Under <kbd>import Foundation</kbd> in the new file, add the following:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">enum Segue:String {<br/>  case showDetail<br/>  case showRating<br/>  case showReview<br/>  case ShowAllReviews<br/>  case restaurantList<br/>  case locationList<br/>  case showPhotoReview<br/>}</pre>
            <p>We will eventually need all of these segues, so we can add them once. Whenever we
               use a new one, I will refer back to this file. The next thing we need is to know when
               the user taps the detail disclosure of the callout.
            </p>
            
            <p>In the <kbd>MapViewController.swift</kbd> file, add the following under the <kbd>addMap(_ annotations:)</kbd> method:
            </p>
            <pre>func mapView(_ mapView: MKMapView, annotationView view: MKAnnotationView, calloutAccessoryControlTapped control: UIControl) {<br/>   self.performSegue(withIdentifier: Segue.showDetail.rawValue, sender: self)<br/>}</pre>
            <p>We are using <kbd>performSegue()</kbd> to call our custom segue. Now, when you tap the annotation and then the callout,
               you will go to the restaurant-detail view:
            </p>
            
            <div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/6359124d-3a55-493a-9f41-6b5889b3960a.png"/></div>
            
            <p>Let's build and run the project by hitting the Play button (or use <em>cmd</em> + <em>R</em>). We can now get to the restaurant detail view from the map.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Passing data to restaurant  detail</h1>
            
         </header>
         
         
         <article>
            
            
            <p>In the next chapter, we are going to display the data in our restaurant detail. For
               now, we want to pass the data over to the detail view.
            </p>
            
            <p>To make this work, we need to update both our <kbd>RestaurantDetailViewController</kbd> (which we have not created yet) and the <kbd>MapViewController</kbd>. Let's create the <kbd>RestaurantDetailViewController</kbd>:
            </p>
            
            <ol>
               
               <li>Right-click on the <kbd>Restaurant</kbd> folder and create a new group named <kbd>Restaurant Detail</kbd>.
               </li>
               
               <li>Then, right-click on the new <kbd>Restaurant Detail</kbd> folder and create a new group named <kbd>Controller</kbd>.
               </li>
               
               <li>Next, right-click on the new <kbd>Controller</kbd> folder and select <span class="packt_screen">New File</span>.
               </li>
               
               <li>In the <span class="packt_screen">Choose a template for your new file</span> screen, select <span class="packt_screen">iOS</span> at the top and then <span class="packt_screen">Cocoa Touch Class</span>. Then hit <span class="packt_screen">Next</span>.
               </li>
               
               <li>In the <span class="packt_screen">Options</span> screen, add the following:
               </li>
               
            </ol>
            
            <p style="padding-left: 60px">New file:</p>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">Class</span>: <kbd>RestaurantDetailViewController</kbd></li>
                     
                     <li><span class="packt_screen">Subclass</span>: <kbd>UITableViewController</kbd></li>
                     
                     <li><span class="packt_screen">Also create XIB</span>: Unchecked
                     </li>
                     
                     <li><span class="packt_screen">Language</span>: <kbd>Swift</kbd></li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="6">
               
               <li>Click <span class="packt_screen">Next</span> and then <span class="packt_screen">Create</span>.
               </li>
               
               <li>Delete everything after the <kbd>viewDidLoad()</kbd> method, as we do not need all of the other code.
               </li>
               
            </ol>
            
            <p style="padding-left: 60px">Your file should now look as follows:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="193" src="assets/bf9fc78d-ca66-4b06-bdb9-92b927128b4b.png" width="384"/></div>
            
            <ol start="8">
               
               <li>Next, inside of the class declaration, add the following:</li>
               
            </ol>
            <pre style="padding-left: 60px">var selectedRestaurant:RestaurantItem?</pre>
            <ol start="9">
               
               <li>Then, add the following code inside of <kbd>viewDidLoad()</kbd>:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">dump(selectedRestaurant as Any)</pre>
            <ol start="10">
               
               <li>Your file should now look like the following:</li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="230" src="assets/fe186c1e-0e40-4d7f-84b2-286a39dc9f00.png" width="341"/></div>
            
            <ol start="11">
               
               <li>Open your <kbd>RestaurantDetail.storyboard</kbd> file.
               </li>
               
               <li>In the Outline view, select the Table View Controller.</li>
               
               <li>In the Utilities panel, select the Identity inspector.</li>
               
               <li>Under <span class="packt_screen">Custom Class</span>, in the <span class="packt_screen">Class</span> drop-down menu, select <span class="packt_screen">RestaurantDetailViewController</span> and hit <em>Enter</em> in order to connect the View Controller to the class.
               </li>
               
            </ol>
            
            <p style="padding-left: 60px">This is all we need to do in <kbd>RestaurantDetailViewController</kbd>. Next, we need to update our <kbd>MapViewController</kbd><strong>:</strong></p>
            
            <ol start="15">
               
               <li>Open the <kbd>MapViewController.swift</kbd> file.
               </li>
               
               <li>Directly under where we declare our manager, add the following code:</li>
               
            </ol>
            <pre style="padding-left: 60px"> var selectedRestaurant:RestaurantItem?</pre>
            <ol start="17">
               
               <li>Then, add the following code into the <kbd>calloutAccessoryControlTapped()</kbd> method above <kbd>performSegue</kbd>:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">guard let annotation = mapView.selectedAnnotations.first else { return }<br/>selectedRestaurant = annotation as? RestaurantItem</pre>
            <p style="padding-left: 60px">Your file should now look as follows:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/dbbe86b3-c822-4e56-892c-9e04dd0cdddc.png"/></div>
            
            <ol start="18">
               
               <li>Next, add the following code after <kbd>viewDidLoad()</kbd>:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {<br/>  switch segue.identifier! {<br/>      case Segue.showDetail.rawValue:<br/>               showRestaurantDetail(segue: segue)<br/>          default:<br/>               print("Segue not added")<br/>   }<br/>}</pre>
            <div>
               
               <p>You will see an error, but ignore it as we are going to fix this in the next step. </p>
               
            </div>
            
            <p>Whenever we transition with a segue, this method gets called. First, we check for
               the <kbd>showDetail</kbd> identifier; if this identifier is called, we want to do something (in this case,
               get the selected restaurant and pass it to the detail view) before we transition.
            </p>
            
            <p>Add the following code after the <kbd>addMap(_ annotations:)</kbd> method:
            </p>
            <pre>func showRestaurantDetail(segue:UIStoryboardSegue) {<br/>   if let viewController = segue.destination as? RestaurantDetailViewController, let restaurant = selectedRestaurant  {<br/>          viewController.selectedRestaurant = restaurant<br/>   }<br/>}</pre>
            <p>Here, we are checking to make sure that the segue destination is  the <kbd>RestaurantDetailViewController</kbd>; if so, we make sure that we have a selected restaurant. When it is confirmed that
               the segue destination is  the <kbd>RestaurantDetailViewController</kbd> and we have a selected restaurant, we use the <kbd>selectedRestaurant</kbd> variable that we created in <kbd>RestaurantDetailViewController</kbd> and set it to the selected restaurant in <kbd>MapViewController</kbd>.
            </p>
            
            <p>Your file should now look like the following with the two new methods we just added:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/c97dcc80-0118-4dab-844b-7619b176b625.png"/></div>
            
            <p>Let's build and run the project by hitting the Play button (or using <em>cmd </em>+ <em>R</em>) and test whether we can pass data to our <kbd>RestaurantDetailViewController</kbd>. You should see the following in your Debug panel, if everything worked:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img src="assets/ec849fcd-7def-4ce6-bd0e-4f2b10deaf8f.png"/></div>
            
            <p>We now have our <kbd>RestaurantDetailViewController</kbd> capable of receiving data; in the next chapter, we will display that data. However,
               before we write any more code, we should organize our code a bit better.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Organizing your code</h1>
            
         </header>
         
         
         <article>
            
            
            <p>Earlier, we wrote an extension for our <kbd>DataManager</kbd>; extensions are useful for adding your functionality onto standard libraries, structs,
               or classes—such as arrays, ints, and strings—or onto your data types.
            </p>
            
            <p>Here is an example. Let's say that you wanted to know the length of a string:</p>
            <pre>let name = "Craig"<br/>name.characters .count</pre>
            <p>For us to access the count of the string, we would need to access the characters and
               then get a count.
            </p>
            
            <p>Let's simplify this by creating an extension:</p>
            <pre>extension String {<br/>   var length: Int {<br/>          return self.characters.count<br/>   }<br/>}</pre>
            <p>With this  newly created <kbd>String</kbd> extension, we can now access the count by writing the following:
            </p>
            <pre>let name = "Craig"<br/>name.length</pre>
            <p>As you can see, extensions are very powerful by enabling us to add extra functionality
               without having to change the main class or struct.
            </p>
            
            <p>Up until now, we have paid very little attention to file structure and more attention
               to understanding what we are writing. Organizing your code is also very important,
               which is why we are going to refactor our code. The refactoring will mostly consist
               of copying and pasting code that you have already written. Extensions can help us
               organize our code better and stay away from cluttering our View Controllers. Also,
               we can extend the functionality of View Controllers through extensions. We are going
               to update four classes: <kbd>ExploreViewController</kbd>, <kbd>RestaurantListViewController</kbd>, <kbd>LocationViewController</kbd>, and <kbd>MapViewController</kbd>.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Refactoring ExploreViewController</h1>
            
         </header>
         
         
         <article>
            
            
            <p>We are going to divide our View Controller into distinct sections using what is known
               as a <kbd>MARK</kbd> comment. Let's start with our <kbd>ExploreViewController</kbd>:
            </p>
            
            <ol>
               
               <li>In the <kbd>ExploreViewController</kbd> file, after the last curly brace, hit <em>Enter</em> a couple of times and add the following code (remember this should be outside of
                  the class, not inside):
               </li>
               
            </ol>
            <pre style="padding-left: 60px"> // MARK: Private Extension<br/>private extension ExploreViewController {<br/>  // code goes here<br/>}<br/> // MARK: UICollectionViewDataSource<br/>extension ExploreViewController: UICollectionViewDataSource {<br/>  // code goes here<br/>}</pre>
            <p style="padding-left: 60px">Here, we are creating two extensions. Our first one will be private and will be where
               we add any methods that we create that we need for this controller. Our second one
               is an extension that just deals with our <kbd>collectionview</kbd> data source. Let's keep going for now.
            </p>
            
            <ol start="2">
               
               <li>We currently have an error because we are using <kbd>UICollectionViewDataSource</kbd> in two places. Delete <kbd>UICollectionViewDataSource</kbd> (including the comma) from the class definition at the top of the file:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="101" src="assets/7f207b0f-2d93-4012-8fd1-1ff0fb157160.png" width="465"/></div>
            
            <ol start="3">
               
               <li>Now, let's move all of our <kbd>CollectionViewDataSource</kbd> methods into our extension. You should be moving the following:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="391" src="assets/9381b58f-41ce-4045-9780-932af2529374.png" width="607"/></div>
            
            <p>Your file, including the extension, should now look as follows:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="396" src="assets/28d74e84-b424-4a99-b828-acb98af1020a.png" width="624"/></div>
            
            <p>Now, you are probably wondering why we created the <kbd>private</kbd> extension. Well, one thing that I try to do is keep <kbd>viewDidLoad()</kbd> as clean as possible. Instead of writing a ton of code inside of <kbd>viewDidLoad()</kbd>, I like to create an <kbd>initialize()</kbd> method and call that instead. This way, it's clear to anyone going into my code what
               I am doing. Let's add the following to our <kbd>private</kbd> extension:
            </p>
            <pre>func initialize() {<br/>  manager.fetch()<br/>}<br/><br/>@IBAction func unwindLocationCancel(segue:UIStoryboardSegue){}</pre>
            <p>Now we can call <kbd>initialize()</kbd> inside of <kbd>viewDidLoad()</kbd>. When you are done, you should see the following:
            </p>
            <pre>class ExploreViewController: UIViewController {<br/>    @IBOutlet weak var collectionView:UICollectionView!<br/>    let manager = ExploreDataManager()<br/>    override func viewDidLoad() {<br/>        super.viewDidLoad()<br/>        initialize()<br/>    }<br/>}<br/><br/>// MARK: Private Extension<br/>private extension ExploreViewController {<br/>    func initialize() {<br/>        manager.fetch()<br/>    }<br/><br/>   @IBAction func unwindLocationCancel(segue:UIStoryboardSegue){}<br/>}</pre>
            <p>Now, this might seem like we wrote extra code for nothing, but as your classes grow,
               you will see the benefit of doing this. Before we clean up the other files, let's
               look at what the <kbd>MARK</kbd> comment does. 
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Using the MARK  comment</h1>
            
         </header>
         
         
         <article>
            
            
            <p>Currently, our <kbd>MARK</kbd> comment may seem like a useless comment in our code, but it is more powerful than
               you think. Look at the bottom bar that is located to the right of  the Play and Stop
               buttons in Xcode and look for the last arrow. Mine says <kbd>No Selection</kbd>, but if you have your cursor on a method you might see that instead:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="131" src="assets/9c289725-4e3c-48d4-a73f-83d8a7e8a3bf.png" width="503"/></div>
            
            <p>Click on this last item and you will see the following:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="220" src="assets/ed4691f6-7997-4c4d-9a9e-e0e76fdfb5ee.jpg" width="311"/></div>
            
            <p>This shows all of your code divided just like our file. You can click on any method
               and the file will jump right to that method. Even if your file is long and you are
               looking for a method, you can use this technique to get where you need to be. We are
               done cleaning up our <kbd>ExploreViewController</kbd>.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Refactoring RestaurantViewController</h1>
            
         </header>
         
         
         <article>
            
            
            <p>We now know our structure, so let's update our <kbd>RestaurantViewController</kbd>. Even though we do not currently have anything to put in our <kbd>private</kbd> extension, we will add it anyway as good practice:
            </p>
            
            <ol>
               
               <li>Inside our <kbd>RestaurantViewController</kbd>, after the last curly brace, hit <em>Enter</em> a couple of times and add the following code (remember, this should be outside of
                  the class, not inside):
               </li>
               
            </ol>
            <pre style="padding-left: 60px"> // MARK: Private Extension<br/><br/>private extension RestaurantViewController {}<br/> // MARK: UICollectionViewDataSource<br/><br/>extension RestaurantViewController: UICollectionViewDataSource {}</pre>
            <ol start="2">
               
               <li>Next, delete the <kbd>UICollectionViewDataSource</kbd> subclass from the main class.
               </li>
               
            </ol>
            
            <p> </p>
            
            <ol start="3">
               
               <li>Now, let's move all of our <kbd>CollectionViewDataSource</kbd> methods into our extension. You should be moving the following:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="296" src="assets/0378461f-8d08-462d-a21b-5a8ef03bb0e4.png" width="521"/></div>
            
            <ol start="4">
               
               <li>Your file, including the extension, should now look as follows:</li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="279" src="assets/e1ddb33b-bbc2-4cdf-bd6e-d9fca256f1cc.png" width="531"/></div>
            
            <p style="padding-left: 60px">We successfully updated our <kbd>RestaurantListViewController</kbd>.
            </p>
            
            <p>Next, let's take a look at our <kbd>LocationViewController</kbd>:
            </p>
            
            <ol start="1">
               
               <li>Inside of our <kbd>LocationViewController</kbd>, after the last curly brace, hit <em>Enter</em> a couple of times and add the following code (remember, this should be outside of
                  the class, not inside):
               </li>
               
            </ol>
            <pre class="mce-root" style="padding-left: 60px">// MARK: Private Extension<br/> private extension LocationViewController {}<br/> <br/> // MARK: UITableViewDataSource<br/>extension LocationViewController: UITableViewDataSource {}</pre>
            <ol start="2">
               
               <li>Next, remove the <kbd>UITableViewDataSource</kbd> subclass from the main class.
               </li>
               
               <li>Now, let's move all of our <kbd>TableViewDataSource</kbd> methods into our extension. You should be moving the following:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="427" src="assets/d4a987b9-112e-4474-9ee3-003203584906.png" width="637"/></div>
            
            <p style="padding-left: 60px">Your file, including the extension, should now look as follows:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="450" src="assets/090ab242-4ff1-44c2-a080-345999907d8a.png" width="646"/></div>
            
            <ol start="4">
               
               <li>Now, just like we did in our <kbd>ExploreViewController</kbd>, we want to create an <kbd>initialize()</kbd> method in our <kbd>private</kbd> extension and update <kbd>viewDidLoad()</kbd> to call <kbd>initialize()</kbd>. When you are done, your file should look like mine:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="206" src="assets/b53e7ff9-2fec-4367-ab09-c020fd188551.png" width="283"/></div>
            
            <p>We finish by  cleaning up our <kbd>LocationViewController</kbd>. Finally, let's take a look at our <kbd>MapViewController</kbd>.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Refactoring MapViewController</h1>
            
         </header>
         
         
         <article>
            
            
            <p>We are just about done refactoring our files. The last file we need to refactor is
               our <kbd>MapViewController</kbd>. Let's get started:
            </p>
            
            <ol>
               
               <li>Inside of our <kbd>MapViewController</kbd>, after the last curly brace, hit <em>Enter</em> a couple of times and add the following code (remember, this should be outside of
                  the class, not inside):
               </li>
               
            </ol>
            <pre style="padding-left: 60px">// MARK: Private Extension<br/>private extension MapViewController {}<br/><br/> // MARK: MKMapDelegate<br/> extension MapViewController: MKMapDelegate {}</pre>
            <ol start="2">
               
               <li>Next, remove the <kbd>MKMapViewDelegate</kbd> subclass from the main class and move it into our extension.
               </li>
               
               <li>Now, let's move all of our <kbd>MKMapViewDelegate</kbd> methods into the extension. You should be moving the following:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="604" src="assets/99c87378-7d80-4e2e-bfbc-f59e255d939d.png" width="437"/></div>
            
            <p style="padding-left: 60px">Your extension should now look as follows:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="324" src="assets/3ebe92ac-81d6-448d-b8d4-4377fd45fcbc.png" width="596"/></div>
            
            <ol start="4">
               
               <li>Next, let's update our <kbd>private</kbd> extension by moving the following:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="438" src="assets/7234edf3-1f0e-4410-94a0-89c0669da022.png" width="593"/></div>
            
            <p style="padding-left: 60px">When you are done, you should have the following:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="423" src="assets/443893a8-9365-4919-b90f-e7aeae067fc7.png" width="568"/></div>
            
            <div>
               
               <p>I did not include the <kbd>MKMapViewDelegate</kbd> extension because the file is too long. The extension is under our <kbd>private</kbd> extension. Why did I not move the <kbd>prepare()</kbd> method? The <kbd>prepare()</kbd> and <kbd>viewDidLoad()</kbd> methods are methods that are overrides for <kbd>UIViewController</kbd> in this case. We want to keep these methods inside of our main class declaration.
                  The more we do this, the clearer it will become.
               </p>
               
            </div>
            
            <p>We finished cleaning up the four View Controllers. You might be wondering what the
               benefits of this are. In this project, it may not seem like these updates are very
               important, because we are not doing a lot in our View Controllers. However, as a project
               grows, there will be some cases where multiple protocols and delegates are adopted;
               thus, these updates will be beneficial.
            </p>
            
            <p>Here is an example:</p>
            <pre>class NewsListingView: UIViewController, NewsListingViewProtocol, UICollectionViewDelegate, UICollectionViewDataSource, LiveGameNewsViewDelegate, UIGestureRecognizerDelegate</pre>
            <p>This class is subclassing a View Controller and adopting one protocol, three delegates,
               and one data source. If you have two methods for each one that you need, you would
               have 12 functions in your class that would need certain methods. Separating out our
               code makes it really easy to find where things are located.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Summary</h1>
            
         </header>
         
         
         <article>
            
            
            <p>In this chapter, we discussed what <kbd>MKAnnotations</kbd> are and how to add and subclass them in order to use them on our map. We also learned
               how to customize our annotations. Our app now takes us from tapping on an annotation
               to a restaurant detail page. We also learned that extensions help to organize code
               as well as add functionality without having to change the main class or struct with
               which we are working.
            </p>
            
            <p>In the next chapter, we are going to display data on our restaurant list. We will
               also set up our restaurant detail page to display data.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   </body></html>