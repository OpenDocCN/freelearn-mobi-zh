<html><head></head><body>
<div id="sbo-rt-content"><div class="Basic-Text-Frame" id="_idContainer114">
<h1 class="chapterNumber">7</h1>
<h1 class="chapterTitle" id="_idParaDest-190">Using Platform-Specific Features </h1>
<p class="normal">In the last six chapters, we developed a fundamental password manager app. So far, all platform-specific features have been managed by .NET MAUI, making the developed features appear platform-agnostic. However, addressing platform-specific features is not always avoidable. In this chapter, we will delve into the implementation of such features.</p>
<p class="normal">We will explore how to utilize device features on supported platforms. By applying the knowledge gained in this chapter, we will incorporate fingerprint support and a customized Markdown view into our app.</p>
<p class="normal">While this chapter does touch on platform-specific features, its primary focus isn’t platform-specific programming. Delving deeper into platform-specific implementations would require specific programming knowledge for Android, iOS, WinUI, and so on. Given this would require a considerable amount of knowledge, instead of teaching you to write your own plugins or specific UI controls for each platform, we will consider some of the high-level concepts involved in creating these elements. To help you become familiar with these concepts, our focus will be on how to extend these features and incorporate them into our app.</p>
<p class="normal">To use .NET for native application development, you would need to write a specialized book for each platform. You can refer to the <em class="italic">Further reading</em> section for more information about Android and iOS native application development using Xamarin.</p>
<p class="normal">The following topics will be covered in this chapter:</p>
<ul>
<li class="bulletList">Implementing platform-specific code</li>
<li class="bulletList">.NET MAUI plugins</li>
<li class="bulletList">Customizing controls</li>
</ul>
<h1 class="heading-1" id="_idParaDest-191">Technical requirements</h1>
<p class="normal">To test and debug the source code in this chapter, you need to have Visual Studio 2022 installed on your PC or Mac. Please refer to the <em class="italic">Development environment setup</em> section in <em class="chapterRef">Chapter 1</em>, <em class="italic">Getting Started with .NET MAUI</em>, for the details.</p>
<p class="normal">The source code for this chapter is available in the following GitHub repository: <a href="https://github.com/PacktPublishing/.NET-MAUI-Cross-Platform-Application-Development-Second-edition/tree/269e26ce42e9d82430a8c8deeda25ffb80a501d0"><span class="url">https://github.com/PacktPublishing/.NET-MAUI-Cross-Platform-Application-Development-Second-</span><span class="url">edition/tree/main/2nd/chapter07</span></a>.</p>
<p class="normal">To check out the source code of this chapter, we can use the below command:</p>
<pre class="programlisting con"><code class="hljs-con"><span class="hljs-con-meta">$ </span>git <span class="hljs-con-built_in">clone</span> -b 2nd/chapter07 https://github.com/PacktPublishing/.NET-MAUI-Cross-Platform-Application-Development-Second-edition.git PassXYZ.Vault2
</code></pre>
<p class="normal">To find out more about the source code in this book, please refer to the section <em class="italic">Managing the source code in this book</em> in <em class="chapterRef">Chapter 2</em>, <em class="italic">Building Our First .NET MAUI App</em>.</p>
<h1 class="heading-1" id="_idParaDest-192">Implementing platform-specific code</h1>
<p class="normal">In the <a id="_idIndexMarker553"/>realm of .NET MAUI application development, there are numerous instances where we might need to write platform-specific code. In this section, we will examine the guidelines for implementing such code. Following that, we will explore the two most common scenarios that necessitate writing platform-specific code in this chapter. The first scenario involves accessing platform features that are not readily available in .NET MAUI APIs. The second scenario may require creating custom controls or customizing existing controls.</p>
<p class="normal">Before delving into how to access platform APIs, it’s important to distinguish between the terms .NET MAUI API and platform API. In <em class="chapterRef">Chapter 1</em>, <em class="italic">Getting Started with .NET MAUI</em>, we have the following architecture diagram of a .NET MAUI application (<em class="italic">Figure 7.1</em>).</p>
<figure class="mediaobject"><img alt="A group of colorful rectangular boxes with text  Description automatically generated" height="305" src="../Images/B21554_07_01.png" width="498"/></figure>
<p class="packt_figref">Figure 7.1: .NET MAUI architecture</p>
<p class="normal">Since most of the <a id="_idIndexMarker554"/>components in the architectural diagram are open-source, I’ve numbered the components for the discussion. You can reference these numbers in the <em class="italic">Further reading</em> section to locate the corresponding source code on GitHub:</p>
<ul>
<li class="bulletList"><strong class="keyWord">.NET MAUI APIs</strong> <strong class="keyWord">(6)</strong> are the cross-platform APIs offered by the .NET MAUI framework. These APIs maintain consistency and unification across various platforms.</li>
<li class="bulletList"><strong class="keyWord">Platform APIs</strong> <strong class="keyWord">(7)(8)(9)(10)</strong>, on the other hand, pertain to the platform-specific APIs provided by the underlying target platforms (Android, iOS/macOS, and Windows). These APIs enable you to access native features, devices, and functionalities unique to each platform.</li>
</ul>
<p class="normal">Generally, to incorporate platform code in .NET MAUI, we can utilize techniques such as conditional compilation and interfaces, as well as partial classes and methods.</p>
<h2 class="heading-2" id="_idParaDest-193">Conditional compilation</h2>
<p class="normal">In .NET MAUI, it is <a id="_idIndexMarker555"/>possible to employ conditional compilation to invoke platform-specific code by defining compiler directives tailored to each platform. These directives enable you to incorporate or omit particular code segments, depending on the target platform throughout the compilation process.</p>
<p class="normal">In the subsequent code snippet, the Markdown encoding varies on Android. By utilizing conditional compilation, we can manage the Android code independently:</p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">DisplayMarkdown</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params"> markdown</span><span class="hljs-function">)</span> 
{
<span class="hljs-meta">#</span><span class="hljs-keyword">if</span><span class="hljs-meta"> !ANDROID</span>
  <span class="hljs-built_in">string</span> markDownTxt = HttpUtility.JavaScriptStringEncode(markdown);
<span class="hljs-meta">#</span><span class="hljs-keyword">else</span>
  <span class="hljs-built_in">string</span> markDownTxt = markdown;
<span class="hljs-meta">#</span><span class="hljs-keyword">endif</span>
  MainThread.BeginInvokeOnMainThread(<span class="hljs-keyword">async</span> () =&gt;
  {
    <span class="hljs-keyword">await</span> InvokeJsMethodAsync(<span class="hljs-string">"</span><span class="hljs-string">MarkdownToHtml"</span>, markDownTxt);
  });
}
</code></pre>
<p class="normal">This modular approach enables the effective use of platform-specific APIs while preserving a shared codebase, facilitating a more seamless cross-platform development process. The conditional compilation method described is typically used for simple implementations. However, if platform-specific implementations involve more complex logic, it’s best to utilize interfaces and partial classes. These provide a more structured approach, allowing for better organization and maintainability of the code, especially when dealing with complex, platform-specific logic.</p>
<h2 class="heading-2" id="_idParaDest-194">Interfaces, partial class, and methods</h2>
<p class="normal">Using <a id="_idIndexMarker556"/>interfaces, partial classes, and methods to implement platform-specific features provides several benefits to developers when <a id="_idIndexMarker557"/>building cross-platform applications, ensuring clean code organization, maintainability, and flexibility. Here are the advantages of using these techniques:</p>
<ul>
<li class="bulletList">Abstraction and modularity:<ul>
<li class="bulletList"><strong class="keyWord">Interfaces</strong>: Interfaces provide a way to define contracts that must be implemented by the platform-specific classes, encapsulating platform-specific code while ensuring consistency across different platform implementations. This promotes a clear separation of concerns and allows for modular code that is easier to manage and maintain.</li>
<li class="bulletList"><strong class="keyWord">Partial classes</strong>: Partial classes <a id="_idIndexMarker558"/>enable you to split the implementation of a single class across multiple files, which is particularly useful when working with platform-specific features. Each platform’s implementation can be separated into different files, resulting in cleaner and more organized code.</li>
</ul>
</li>
<li class="bulletList">Code reusability and maintainability:
    <p class="normal">Using interfaces allows you to create reusable components that can be easily plugged into different platform-specific implementations without modifying the shared code. This improves maintainability, as changes in platform-specific code do not affect the rest of the application, reducing the potential for errors and simplifying updates.</p>
<p class="normal">Partial methods <a id="_idIndexMarker559"/>serve as optional method implementations within partial classes. They enable you to define a method signature in the shared code without providing an implementation. The platform-specific code can then provide the implementation if needed, which can be left empty otherwise. This approach keeps the codebase cleaner by avoiding unnecessary empty method implementations and helps to maintain a more consistent structure across platforms.</p></li>
</ul>
<ul>
<li class="bulletList">Flexibility and testability:
    <p class="normal">Interfaces offer flexibility when implementing platform-specific features, as different implementations can be easily swapped for testing purposes or to support future platforms. It allows for dependency injection, making it easier to write unit tests and mock platform-specific components during development and testing.</p>
<p class="normal">In order to utilize platform features that are not directly supported by .NET MAUI, we typically create components known as plugins. In the upcoming section, we will use the fingerprint plugin as a case study to gain insight into the implementation of .NET MAUI plugins through interfaces, partial classes, or abstract classes.</p></li>
</ul>
<h1 class="heading-1" id="_idParaDest-195">.NET MAUI/Xamarin plugins</h1>
<p class="normal">To utilize <a id="_idIndexMarker560"/>platform features in a cross-platform manner, we typically create components known as plugins. In .NET MAUI plugins (or Xamarin plugins), we establish cross-platform APIs to access native platform features or services. These plugins empower you to write platform-independent code in your shared project while concurrently harnessing native functionality on each platform (Android, iOS, macOS, and Windows).</p>
<p class="normal">Plugins abstract platform-specific code, enabling you to use a standardized API in your shared project for accessing native features. This streamlines development and helps you maintain a neater and more readable codebase that adheres to the <strong class="keyWord">Model-View-ViewModel</strong> (<strong class="keyWord">MVVM</strong>) pattern.</p>
<p class="normal">Although I have used the term “.NET MAUI plugins,” it’s important to note that it’s not limited purely to .NET MAUI. In fact, it’s possible to develop a plugin that can be used by both .NET MAUI and Xamarin.Forms simultaneously. Typically, a plugin is a multi-target .NET project where the developer can decide the number of platforms to support. The content in this chapter regarding plugins is also applicable to .NET MAUI Blazor Hybrid apps. We will delve into .NET MAUI Blazor Hybrid app development in the next chapter.</p>
<p class="normal">As plugin development can be fairly flexible and potent, the compatibility of plugin libraries is determined by individual developers. To standardize a variety of plugins from the community, let’s evaluate the evolutionary path of .NET MAUI or Xamarin plugins in the upcoming section.</p>
<h2 class="heading-2" id="_idParaDest-196">The evolution of .NET MAUI/Xamarin plugins</h2>
<p class="normal">Previously, in <a id="_idIndexMarker561"/>order to utilize a device feature without a built-in cross-platform interface, we could often find Xamarin plugins developed by the community. Xamarin plugins, created by Xamarin developers, are packaged in a cross-platform format. However, these plugins lack standardization, which may result in the existence of multiple plugins catering to the same device features.</p>
<p class="normal">As the Xamarin ecosystem evolved and matured, Xamarin.Essentials was introduced as an all-embracing, harmonized alternative. By consolidating popular plugins into a single cross-platform library, it simplified the utilization of native APIs across Android, iOS, and Windows devices.</p>
<p class="normal">Xamarin.Essentials serves as both a library and a namespace. Within this namespace, we can access hardware interfaces, such as a battery, flashlight, vibration, geolocation sensor, etc. </p>
<p class="normal">With the <a id="_idIndexMarker562"/>advent of .NET MAUI, Xamarin.Essentials has undergone further development, resulting in a collection of individual namespaces housed under the <code class="inlineCode">Microsoft.Maui</code> namespace, as depicted in <em class="italic">Figure 7.2</em>.</p>
<figure class="mediaobject"><img alt="A diagram of a computer program  Description automatically generated" height="477" src="../Images/B21554_07_02.png" width="442"/></figure>
<p class="packt_figref">Figure 7.2: Evolution of Xamarin.Essentials</p>
<p class="normal">In Xamarin.Essentials, all features are consolidated under a single namespace, resulting in a sizable and flat library. In contrast, .NET MAUI adopts a more refined design by dividing the <a id="_idIndexMarker563"/>features into multiple namespaces, as illustrated in <em class="italic">Table 7.1</em>.</p>
<table class="table-container" id="table001-6">
<tbody>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord">Namespace</strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord">Description</strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode">Microsoft.Maui.ApplicationModel</code></p>
</td>
<td class="table-cell">
<p class="normal">Within this namespace, it encompasses APIs that enable access to platform-specific application-level information and activities. Examples of these include app actions, app information, the browser, the launcher, the main thread, maps, permissions, and version tracking.</p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode">Microsoft.Maui.ApplicationModel.Communication</code></p>
</td>
<td class="table-cell">
<p class="normal">Within this namespace, we have access to various communication services, including contacts, email, networking, the phone dialer, sms, and web authenticator functionality.</p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode">Microsoft.Maui.ApplicationModel.DataTransfer</code></p>
</td>
<td class="table-cell">
<p class="normal">Clipboard and sharing APIs can be found in this namespace.</p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode">Microsoft.Maui.Devices</code></p>
</td>
<td class="table-cell">
<p class="normal">In this namespace, we have the capability to access various hardware sensors and accelerators, including the battery, the device display, device information, device sensors, the flashlight, geocoding, geolocation, haptic feedback, and vibration.</p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode">Microsoft.Maui.Media</code></p>
</td>
<td class="table-cell">
<p class="normal">We can access video and photos in this namespace, such as the media picker, screenshot, text-to-speech, or unit converters.</p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode">Microsoft.Maui.Storage</code></p>
</td>
<td class="table-cell">
<p class="normal">To access various local storage in preferences or secure storage, we can use this namespace. We can find a cross-platform file picker and filesystem helpers here.</p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref">Table 7.1: Device features in Microsoft.Maui</p>
<p class="normal">While the<a id="_idIndexMarker564"/> cross-platform APIs listed in <em class="italic">Table 7.1</em> allow us to access various device features, there are still some platform features unavailable. In such instances, we must either implement our own solutions or utilize plugins developed by the community. For instance, there are no cross-platform APIs available for fingerprint functionality. To incorporate fingerprint features in our app, we need to rely on community-developed plugins.</p>
<p class="normal">As .NET MAUI APIs currently do not support fingerprint functionality, we will employ an open-source plugin called <code class="inlineCode">Plugin.Fingerprint</code>, which was previously used in the Xamarin version of <code class="inlineCode">PassXYZ.Vault</code>. In this chapter, we will utilize the same plugin to facilitate fingerprint support in the .NET MAUI version of PassXYZ.Vault. <code class="inlineCode">Plugin.Fingerprint</code> is an example of a library that can support both .NET MAUI and Xamarin.Forms.</p>
<h2 class="heading-2" id="_idParaDest-197">The introduction of Plugin.Fingerprint</h2>
<p class="normal">In this session, we <a id="_idIndexMarker565"/>will utilize <code class="inlineCode">Plugin.Fingerprint</code> as a case study to demonstrate the implementation of .NET MAUI plugins. You can find the fingerprint plugin we will be using at the following GitHub URL: <a href="https://github.com/smstuebe/xamarin-fingerprint"><span class="url">https://github.com/smstuebe/xamarin-fingerprint</span></a>.</p>
<p class="normal">To <a id="_idIndexMarker566"/>use <code class="inlineCode">Plugin.Fingerprint</code> in our project, we can add the package to our project by using the below command:</p>
<pre class="programlisting con"><code class="hljs-con">dotnet add package Plugin.Fingerprint
</code></pre>
<p class="normal">In order to implement a plugin, it is common practice to begin by defining an interface. This interface serves as a means to access the features provided by the plugin. </p>
<p class="normal">The concrete implementation is divided into two components, the cross-platform aspect and the platform-specific aspect, which are achieved using either a partial class or an abstract class.</p>
<figure class="mediaobject"><img alt="A diagram of a fingerprint  Description automatically generated" height="432" src="../Images/B21554_07_03.png" width="825"/></figure>
<p class="packt_figref">Figure 7.3: Plugin.Fingerprint</p>
<p class="normal"><em class="italic">Figure 7.3 </em>presents <a id="_idIndexMarker567"/>the class diagram of <code class="inlineCode">Plugin.Fingerprint</code>. It is evident that <code class="inlineCode">Plugin.Fingerprint</code> establishes an interface called <code class="inlineCode">IFingerprint</code>. An abstract class, <code class="inlineCode">FingerprintImplementationBase</code>, carries out the implementation of this interface. This abstract class is responsible for cross-platform functionality<a id="_idIndexMarker568"/> and outlines abstract methods designated for platform-specific implementation. <code class="inlineCode">FingerprintImplementation</code>, a separate class on each platform, defines the platform-specific implementation. In the following block, we will examine the code of <code class="inlineCode">IFingerprint</code>:</p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">using</span> System.Threading;
<span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">namespace</span> <span class="hljs-title">Plugin.Fingerprint.Abstractions</span>
{
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IFingerprint</span>
  {
<span class="hljs-function">Task&lt;FingerprintAvailability&gt; </span><span class="hljs-title">GetAvailabilityAsync</span><span class="hljs-function">(</span>
<span class="hljs-params">  </span><span class="hljs-built_in">bool</span><span class="hljs-params"> allowAlternativeAuthentication = </span><span class="hljs-literal">false</span><span class="hljs-function">)</span>;
    <span class="hljs-function">Task&lt;</span><span class="hljs-built_in">bool</span><span class="hljs-function">&gt; </span><span class="hljs-title">IsAvailableAsync</span><span class="hljs-function">(</span><span class="hljs-built_in">bool</span><span class="hljs-params"> allowAlternativeAuthentication = </span><span class="hljs-literal">false</span><span class="hljs-function">)</span>;
    <span class="hljs-function">Task&lt;FingerprintAuthenticationResult&gt; </span><span class="hljs-title">AuthenticateAsync</span><span class="hljs-function">(</span><span class="hljs-params">         AuthenticationRequestConfiguration authRequestConfig,         CancellationToken cancellationToken = </span><span class="hljs-literal">default</span><span class="hljs-function">)</span>;
    <span class="hljs-function">Task&lt;AuthenticationType&gt; </span><span class="hljs-title">GetAuthenticationTypeAsync</span><span class="hljs-function">()</span>;
  }
}
</code></pre>
<p class="normal">The <code class="inlineCode">IFingerprint</code> interface <a id="_idIndexMarker569"/>defines four methods:</p>
<ul>
<li class="bulletList"><code class="inlineCode">GetAvailabilityAsync</code> checks the availability of fingerprint authentication.</li>
<li class="bulletList"><code class="inlineCode">IsAvailableAsync</code> serves as a wrapper for <code class="inlineCode">GetAvailabilityAsync</code>, offering easier access.</li>
<li class="bulletList"><code class="inlineCode">AuthenticateAsync</code> handles the actual authentication, using fingerprint data.</li>
<li class="bulletList"><code class="inlineCode">GetAuthenticationTypeAsync</code> allows users to retrieve the currently available authentication type.</li>
</ul>
<p class="normal">Now, let’s <a id="_idIndexMarker570"/>examine <code class="inlineCode">FingerprintImplementationBase</code>, which implements the <code class="inlineCode">IFingerprint</code> interface:</p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FingerprintImplementationBase</span> : <span class="hljs-title">IFingerprint</span>
{
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">async</span><span class="hljs-function"> Task&lt;FingerprintAuthenticationResult&gt; </span>
<span class="hljs-function">    </span><span class="code-highlight"><strong class="hljs-title-slc">AuthenticateAsync</strong></span><span class="hljs-function">(</span>
<span class="hljs-params">    AuthenticationRequestConfiguration authRequestConfig, </span>
<span class="hljs-params">    CancellationToken cancellationToken = </span><span class="hljs-literal">default</span><span class="hljs-function">)</span> {
    <span class="hljs-keyword">if</span> (authRequestConfig <span class="hljs-keyword">is</span> <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(authRequestConfig));
    <span class="hljs-keyword">var</span> availability = <span class="hljs-keyword">await</span> GetAvailabilityAsync(
        authRequestConfig.AllowAlternativeAuthentication);
    <span class="hljs-keyword">if</span> (availability != FingerprintAvailability.Available) {
      <span class="hljs-keyword">var</span> status = availability == FingerprintAvailability.Denied ?
        FingerprintAuthenticationResultStatus.Denied :
        FingerprintAuthenticationResultStatus.NotAvailable;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FingerprintAuthenticationResult { 
          Status = status, 
          ErrorMessage = availability.ToString() };
    }
<span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> NativeAuthenticateAsync(
  authRequestConfig, cancellationToken);
  }
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">async</span><span class="hljs-function"> Task&lt;</span><span class="hljs-built_in">bool</span><span class="hljs-function">&gt; </span><span class="code-highlight"><strong class="hljs-title-slc">IsAvailableAsync</strong></span><span class="hljs-function">(</span>
<span class="hljs-params">    </span><span class="hljs-built_in">bool</span><span class="hljs-params"> allowAlternativeAuthentication = </span><span class="hljs-literal">false</span><span class="hljs-function">)</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> GetAvailabilityAsync
        (allowAlternativeAuthentication) 
        == FingerprintAvailability.Available;
  }
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">abstract</span><span class="hljs-function"> Task&lt;FingerprintAvailability&gt; </span>
<span class="hljs-function">    </span><span class="code-highlight"><strong class="hljs-title-slc">GetAvailabilityAsync</strong></span><span class="hljs-function">(</span>
<span class="hljs-params">      </span><span class="hljs-built_in">bool</span><span class="hljs-params"> allowAlternativeAuthentication = </span><span class="hljs-literal">false</span><span class="hljs-function">)</span>;
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">abstract</span><span class="hljs-function"> Task&lt;AuthenticationType&gt; </span>
<span class="hljs-function">    </span><span class="code-highlight"><strong class="hljs-title-slc">GetAuthenticationTypeAsync</strong></span><span class="hljs-function">()</span>;
  <span class="hljs-keyword">protected</span><span class="hljs-function"> </span><span class="hljs-keyword">abstract</span><span class="hljs-function"> Task&lt;FingerprintAuthenticationResult&gt; </span>
<span class="code-highlight"><strong class="hljs-title-slc">NativeAuthenticateAsync</strong></span><span class="hljs-function">(</span>
<span class="hljs-params">  AuthenticationRequestConfiguration authRequestConfig, </span>
<span class="hljs-params">  CancellationToken cancellationToken</span><span class="hljs-function">)</span>;
}
</code></pre>
<p class="normal">In the <code class="inlineCode">FingerprintImplementationBase</code> class, the <code class="inlineCode">AuthenticateAsync</code> method is implemented by invoking the <code class="inlineCode">NativeAuthenticateAsync</code> method. The latter is defined as an abstract <a id="_idIndexMarker571"/>method that is implemented in the platform layer.</p>
<p class="normal">It also <a id="_idIndexMarker572"/>defines <code class="inlineCode">GetAvailabilityAsync</code> and <code class="inlineCode">GetAuthenticationTypeAsync</code> as abstract methods, which are subsequently implemented in the platform layer.</p>
<p class="normal">The <code class="inlineCode">IsAvailableAsync</code> method simply invokes <code class="inlineCode">GetAvailabilityAsync</code> and then compares the return value.</p>
<p class="normal">In order to instantiate the <code class="inlineCode">IFingerprint</code> interface, <code class="inlineCode">Plugin.Fingerprint</code> employs a class named <code class="inlineCode">CrossFingerprint</code>. This class utilizes a creational design pattern, along with lazy initialization, to generate <code class="inlineCode">IFingerprint</code> interface instances during runtime, as we can see in the following code:</p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CrossFingerprint</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Lazy&lt;IFingerprint&gt; _implementation =             <span class="hljs-comment">//(1)</span>
<span class="hljs-keyword">new</span> Lazy&lt;IFingerprint&gt;(CreateFingerprint, 
  LazyThreadSafetyMode.PublicationOnly);
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IFingerprint Current {                            <span class="hljs-comment">//(2)</span>
    <span class="hljs-keyword">get</span> =&gt; _implementation.Value;
    <span class="hljs-keyword">set</span> {
      _implementation = <span class="hljs-keyword">new</span> Lazy&lt;IFingerprint&gt;(() =&gt; <span class="hljs-keyword">value</span>);
    }
  }
  <span class="hljs-keyword">static</span><span class="hljs-function"> IFingerprint </span><span class="hljs-title">CreateFingerprint</span><span class="hljs-function">()</span> {                       <span class="hljs-comment">//(3)</span>
<span class="hljs-meta">#</span><span class="hljs-keyword">if</span><span class="hljs-meta"> NETSTANDARD2_0</span>
    <span class="hljs-keyword">throw</span> NotImplementedInReferenceAssembly();
<span class="hljs-meta">#</span><span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FingerprintImplementation();
<span class="hljs-meta">#</span><span class="hljs-keyword">endif</span>
  }
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">Dispose</span><span class="hljs-function">()</span> {
    <span class="hljs-keyword">if</span> (_implementation != <span class="hljs-literal">null</span> &amp;&amp; _implementation.IsValueCreated)
    {
      _implementation = <span class="hljs-keyword">new</span> Lazy&lt;IFingerprint&gt;(CreateFingerprint, 
        LazyThreadSafetyMode.PublicationOnly);
    }
  }
  <span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">static</span><span class="hljs-function"> Exception </span><span class="hljs-title">NotImplementedInReferenceAssembly</span><span class="hljs-function">()</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> NotImplementedException(<span class="hljs-string">"This functionality is not implemented in the portable version of this assembly. You should reference the NuGet package from your main application project in order to reference the platform-specific implementation."</span>);
  }
}
</code></pre>
<p class="normal">In <code class="inlineCode">CrossFingerprint</code>, a static <a id="_idIndexMarker573"/>property called <code class="inlineCode">Current</code> <strong class="keyWord">(2)</strong> is defined, which <a id="_idIndexMarker574"/>can be utilized to obtain the instance of <code class="inlineCode">IFingerprint</code>. The property <code class="inlineCode">Current</code> returns the value of a <code class="inlineCode">Lazy&lt;IFingerprint&gt;</code> object, specified in the variable <code class="inlineCode">_implementation</code> <strong class="keyWord">(1)</strong>, which implements lazy initialization. Within <code class="inlineCode">Lazy&lt;IFingerprint&gt;</code>, the <code class="inlineCode">IFingerprint</code> instance is created using the factory method <code class="inlineCode">CreateFingerprint</code> <strong class="keyWord">(3)</strong>.</p>
<p class="normal">Now that we have introduced <code class="inlineCode">Plugin.Fingerprint</code>, let’s explore how to incorporate fingerprint support in our app using this plugin.</p>
<h2 class="heading-2" id="_idParaDest-198">Supporting fingerprint functionality using Plugin.Fingerprint</h2>
<p class="normal">To<a id="_idIndexMarker575"/> incorporate fingerprint functionality using <code class="inlineCode">Plugin.Fingerprint</code>, we must first <a id="_idIndexMarker576"/>configure it <a id="_idIndexMarker577"/>within our project before making any code modifications. This step involves adding the NuGet package <code class="inlineCode">Plugin.Fingerprint</code> to our project file, as detailed below:</p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">ItemGroup</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">PackageReference</span><span class="hljs-tag"> </span><span class="hljs-attr">Include</span><span class="hljs-tag">=</span><span class="hljs-string">"CommunityToolkit.Mvvm"</span><span class="hljs-tag"> </span><span class="hljs-attr">Version</span><span class="hljs-tag">=</span><span class="hljs-string">"8.2.1"</span><span class="hljs-tag"> /&gt;</span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">PackageReference</span><span class="hljs-tag"> </span><span class="hljs-attr">Include</span><span class="hljs-tag">=</span><span class="hljs-string">"EJL.MauiHybridWebView"</span><span class="hljs-tag"> </span><span class="hljs-attr">Version</span><span class="hljs-tag">=</span><span class="hljs-string">"1.0.0-preview3"</span><span class="hljs-tag"> /&gt;</span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">PackageReference</span><span class="hljs-tag"> </span><span class="hljs-attr">Include</span><span class="hljs-tag">=</span><span class="hljs-string">"Microsoft.Extensions.Logging.Debug"</span><span class="hljs-tag"> </span><span class="hljs-attr">Version</span><span class="hljs-tag">=</span><span class="hljs-string">"</span><span class="hljs-string">7.0.0"</span><span class="hljs-tag"> /&gt;</span>
<span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">PackageReference</strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc">Include</strong><strong class="hljs-tag-slc">=</strong><strong class="hljs-string-slc">"Plugin.Fingerprint"</strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc">Version</strong><strong class="hljs-tag-slc">=</strong><strong class="hljs-string-slc">"3.0.0-beta.1"</strong><strong class="hljs-tag-slc"> /&gt;</strong></span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">PackageReference</span><span class="hljs-tag"> </span><span class="hljs-attr">Include</span><span class="hljs-tag">=</span><span class="hljs-string">"</span><span class="hljs-string">PassXYZLib"</span><span class="hljs-tag"> </span><span class="hljs-attr">Version</span><span class="hljs-tag">=</span><span class="hljs-string">"2.1.2"</span><span class="hljs-tag"> /&gt;</span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">ItemGroup</span><span class="hljs-tag">&gt;</span>
</code></pre>
<p class="normal">For now, please disregard the NuGet package <code class="inlineCode">EJL.MauiHybridWebView</code>. We will delve into a discussion about it later in this chapter.</p>
<p class="normal">As users must access device-specific features within each platform, it is essential to configure the required permissions for our application in their respective configuration files.</p>
<p class="normal">For the Android platform, it is necessary to request specific permissions within the <code class="inlineCode">AndroidManifest.xml</code> file:</p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">uses-permission</span><span class="hljs-tag"> </span><span class="hljs-attr">android:name</span><span class="hljs-tag">=</span><span class="hljs-string">"android.permission.USE_BIOMETRIC"</span><span class="hljs-tag"> /&gt;</span>
<span class="hljs-comment">&lt;!-- only if you target android below level 28 --&gt;</span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">uses-permission</span><span class="hljs-tag"> </span><span class="hljs-attr">android:name</span><span class="hljs-tag">=</span><span class="hljs-string">"android.permission.USE_FINGERPRINT"</span><span class="hljs-tag"> /&gt;</span>
</code></pre>
<p class="normal">For the iOS platform, we need to do the same in <code class="inlineCode">Info.plist</code>, as below:</p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">key</span><span class="hljs-tag">&gt;</span>NSFaceIDUsageDescription<span class="hljs-tag">&lt;/</span><span class="hljs-name">key</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">string</span><span class="hljs-tag">&gt;</span>Need your face to unlock secrets!<span class="hljs-tag">&lt;/</span><span class="hljs-name">string</span><span class="hljs-tag">&gt;</span>
</code></pre>
<p class="normal">Incorporating fingerprint functionality is an objective we aim to achieve in our application. By employing the MVVM pattern, we can initially integrate this fingerprint feature within our view model. Subsequently, we can utilize this functionality in our XAML pages.</p>
<p class="normal">Our users will utilize fingerprint authentication to log in, so we can incorporate the fingerprint plugin into the <code class="inlineCode">LoginViewModel</code>. The users will engage with <code class="inlineCode">LoginPage</code> to carry out the <a id="_idIndexMarker578"/>login process. However, before they can employ fingerprint authentication within <code class="inlineCode">LoginPage</code>, they must first enable the fingerprint feature in our app’s settings. The<a id="_idIndexMarker579"/> implementation<a id="_idIndexMarker580"/> of these settings is found in the <code class="inlineCode">SettingsPage</code>. The relationship between <code class="inlineCode">IFingerprint</code>, <code class="inlineCode">LoginViewModel</code>, <code class="inlineCode">LoginPage</code>, and <code class="inlineCode">SettingsPage</code> is illustrated in <em class="italic">Figure 7.4</em>:</p>
<figure class="mediaobject"><img alt="A diagram of a computer program  Description automatically generated" height="409" src="../Images/B21554_07_04.png" width="825"/></figure>
<p class="packt_figref">Figure 7.4: Plugin.Fingerprint integration</p>
<p class="normal">As we are utilizing dependency injection to manage dependencies, it is necessary to initially include the <code class="inlineCode">IFingerprint</code> interface in the configuration found in <code class="inlineCode">MauiProgram.cs</code>, as demonstrated below:</p>
<pre class="programlisting code"><code class="hljs-code">builder.Services.AddSingleton(<span class="hljs-keyword">typeof</span>(IFingerprint), CrossFingerprint.Current);
</code></pre>
<p class="normal">Having completed the aforementioned setup and configuration, let us now examine the code of the <code class="inlineCode">LoginViewModel</code> provided below:</p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LoginViewModel</span> : <span class="hljs-title">ObservableObject</span> {
  <span class="hljs-keyword">private</span> LoginService _currentUser;
  ILogger&lt;LoginViewModel&gt; _logger;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IFingerprint _fingerprint;
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-title">LoginViewModel</span><span class="hljs-function">(</span><span class="hljs-params">LoginService user, </span>
<span class="hljs-params">    ILogger&lt;LoginViewModel&gt; logger, IFingerprint fingerprint</span><span class="hljs-function">)</span> {   <span class="hljs-comment">//(1)</span>
    _currentUser = user;
    _logger = logger;
    _fingerprint = fingerprint;
  }
  ...
  [<span class="hljs-meta">RelayCommand(CanExecute = nameof(ValidateFingerprintLogin))</span>]
  <span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">async</span><span class="hljs-function"> Task </span><span class="hljs-title">FingerprintLogin</span><span class="hljs-function">()</span> {                         <span class="hljs-comment">//(2)</span>
    <span class="hljs-keyword">var</span> cancel = <span class="hljs-keyword">new</span> CancellationTokenSource();
<span class="hljs-keyword">var</span> dialogConfig = <span class="hljs-keyword">new</span> AuthenticationRequestConfiguration(
  Username,
      Properties.Resources.fingerprint_login_message) {
      CancelTitle = <span class="hljs-string">"Cancel fingerprint login"</span>,
      FallbackTitle = <span class="hljs-string">"Use Password"</span>,
      AllowAlternativeAuthentication = <span class="hljs-literal">true</span>,
    };
<span class="hljs-keyword">var</span> result = <span class="hljs-keyword">await</span> _fingerprint.AuthenticateAsync(
  dialogConfig, cancel.Token);
    <span class="hljs-keyword">if</span> (result.Authenticated) {
      Password = <span class="hljs-keyword">await</span> _currentUser.GetSecurityAsync();
      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(Password)) {
          <span class="hljs-keyword">await</span> Login();
      }
      <span class="hljs-keyword">else</span> {
          _logger.LogWarning(<span class="hljs-string">"GetSecurityAsync() error."</span>);
      }
    }
    <span class="hljs-keyword">else</span> {
        _logger.LogWarning(<span class="hljs-string">"Failed to login with fingerprint."</span>);
    }
  }
  ...
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">async</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">CheckFingerprintStatus</span><span class="hljs-function">()</span> {                  <span class="hljs-comment">//(3)</span>
    _currentUser.Username = Username;
    <span class="hljs-keyword">var</span> password = <span class="hljs-keyword">await</span> _currentUser.GetSecurityAsync();
IsFingerprintIsAvailable = 
  <span class="hljs-keyword">await</span> _fingerprint.IsAvailableAsync();
IsFingerprintEnabled = IsFingerprintIsAvailable &amp;&amp;
  !<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(password);
  }
  [<span class="hljs-meta">ObservableProperty</span>]
  <span class="hljs-keyword">private</span> <span class="hljs-built_in">bool</span> isFingerprintEnabled = <span class="hljs-literal">false</span>;                      <span class="hljs-comment">//(4)</span>
  [<span class="hljs-meta">ObservableProperty</span>]
  <span class="hljs-keyword">private</span> <span class="hljs-built_in">bool</span> isFingerprintAvailable = <span class="hljs-literal">false</span>;                    <span class="hljs-comment">//(5)</span>
  ...
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">async</span><span class="hljs-function"> Task&lt;</span><span class="hljs-built_in">bool</span><span class="hljs-function">&gt; </span><span class="hljs-title">AuthenticateAsync</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params"> reason,        </span><span class="hljs-comment">//(6)</span>
<span class="hljs-built_in">string</span><span class="hljs-function">? cancel</span> = <span class="hljs-literal">null</span>, <span class="hljs-built_in">string</span>? fallback = <span class="hljs-literal">null</span>, 
<span class="hljs-built_in">string</span>? tooFast = <span class="hljs-literal">null</span>) {
    CancellationTokenSource cancelToken;
    cancelToken = <span class="hljs-keyword">new</span> CancellationTokenSource();
<span class="hljs-keyword">var</span> dialogConfig = <span class="hljs-keyword">new</span> AuthenticationRequestConfiguration(
  <span class="hljs-string">"Verify your fingerprint"</span>, reason) { 
      CancelTitle = cancel,
      FallbackTitle = fallback,
      AllowAlternativeAuthentication = <span class="hljs-literal">false</span>
    };
    dialogConfig.HelpTexts.MovedTooFast = tooFast;
<span class="hljs-keyword">var</span> result = <span class="hljs-keyword">await</span> _fingerprint.AuthenticateAsync(
  dialogConfig, cancelToken.Token);
    <span class="hljs-keyword">return</span> result.Authenticated;
  }
}
</code></pre>
<p class="packt_figref">Listing 7.1: <code class="inlineCode">LoginViewModel.cs</code> (<a href="https://epa.ms/LoginViewModel7-1"><span class="url">https://epa.ms/LoginViewModel7-1</span></a>)</p>
<p class="normal">In <a id="_idIndexMarker581"/>the <code class="inlineCode">LoginViewModel</code>, we obtain an instance of the <code class="inlineCode">IFingerprint</code> interface <strong class="keyWord">(1)</strong> via constructor dependency<a id="_idIndexMarker582"/> injection and save it in the member variable <code class="inlineCode">_fingerprint</code>. This <code class="inlineCode">IFingerprint</code> instance is then utilized to implement fingerprint status validation and authentication functions.</p>
<p class="normal">The <a id="_idIndexMarker583"/>function <code class="inlineCode">CheckFingerprintStatus</code> <strong class="keyWord">(3)</strong> has been implemented to evaluate the device’s capability and status, specifically determining if the device supports fingerprint recognition and if it is enabled for the current user. The properties <code class="inlineCode">IsFingerprintEnabled</code> <strong class="keyWord">(4)</strong> and <code class="inlineCode">IsFingerprintAvailable</code> <strong class="keyWord">(5)</strong> will be updated by this function.</p>
<p class="normal">To enable fingerprint authentication, <code class="inlineCode">FingerprintLogin</code> <strong class="keyWord">(2)</strong> is incorporated to execute login via fingerprint recognition. The function <code class="inlineCode">AuthenticateAsync</code> <strong class="keyWord">(6)</strong> is utilized for fingerprint verification; however, it does not carry out the login process.</p>
<p class="normal">After implementing the view model, we can focus on developing the user interface. To incorporate fingerprint functionality, it is necessary for the user to activate it initially. We employ a settings page for this purpose. When the fingerprint feature is enabled, the user can access the system using their fingerprint. This login function is incorporated into the <code class="inlineCode">LoginPage</code>.</p>
<h3 class="heading-3" id="_idParaDest-199">Fingerprint settings</h3>
<p class="normal">Please <a id="_idIndexMarker584"/>refer to <em class="italic">Figure 7.5</em> for the fingerprint configuration. The user interface design is notably minimalistic, utilizing only a switch control to activate or deactivate the fingerprint function.</p>
<figure class="mediaobject"><img alt="A white background with black dots  Description automatically generated" height="840" src="../Images/B21554_07_05.png" width="389"/></figure>
<p class="packt_figref">Figure 7.5: SettingsPage</p>
<p class="normal">The <a id="_idIndexMarker585"/>user interface for the <code class="inlineCode">SettingsPage</code> is relatively straightforward, which allows us to bypass discussing its XAML. Instead, we will focus on examining the code-behind file of the <code class="inlineCode">SettingsPage</code> in <em class="italic">Listing 7.2</em>:</p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SettingsPage</span> : <span class="hljs-title">ContentPage</span> {
  <span class="hljs-keyword">private</span> LoginService _currentUser;
  ILogger&lt;LoginViewModel&gt; _logger;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> LoginViewModel _viewModel;
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-title">SettingsPage</span><span class="hljs-function">(</span><span class="hljs-params">LoginViewModel viewModel,                    </span><span class="hljs-comment">//(1)</span>
<span class="hljs-function">    LoginService user, ILogger&lt;LoginViewModel&gt; logger)</span> {
    InitializeComponent();
    BindingContext = _viewModel = viewModel;
    _currentUser = user;
    _logger = logger;
    Title = Properties.Resources.menu_id_settings;
  }
  <span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">SetFingerprintSwitcher</span><span class="hljs-function">()</span> {
    FingerprintSwitcher.IsEnabled = 
      _viewModel.IsFingerprintAvailable;
    FingerprintSwitcher.On = _viewModel.IsFingerprintEnabled;
    <span class="hljs-keyword">if</span> (_viewModel.IsFingerprintAvailable) {
      FingerprintSwitcher.Text = 
        Properties.Resources.settings_fingerprint_remark;
    }
    <span class="hljs-keyword">else</span> {
      FingerprintSwitcher.Text = 
        Properties.Resources.settings_fingerprint_disabled;
    }
  }
  <span class="hljs-keyword">protected</span><span class="hljs-function"> </span><span class="hljs-keyword">override</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">OnAppearing</span><span class="hljs-function">()</span> {                  <span class="hljs-params">      </span> <span class="hljs-comment">//(2)</span>
    <span class="hljs-keyword">base</span>.OnAppearing();
    …
    <span class="hljs-keyword">try</span> {
      _viewModel.CheckFingerprintStatus();                 <span class="hljs-params">      </span> <span class="hljs-comment">//(3)</span>
    }
    <span class="hljs-keyword">catch</span> (Exception ex) {_logger.LogError(<span class="hljs-string">$"</span><span class="hljs-subst">{ex}</span><span class="hljs-string">"</span>);}
    SetFingerprintSwitcher();                              <span class="hljs-params">       </span> <span class="hljs-comment">//(4)</span>
  } 
  <span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">async</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">OnTimerTappedAsync</span><span class="hljs-function">(</span><span class="hljs-built_in">object</span><span class="hljs-params"> sender, </span>
<span class="hljs-params">    System.EventArgs e</span><span class="hljs-function">) ...</span>
<span class="hljs-function">  </span><span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">async</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">SetResultAsync</span><span class="hljs-function">(</span><span class="hljs-built_in">bool</span><span class="hljs-params"> result</span><span class="hljs-function">)</span> {
    <span class="hljs-keyword">if</span> (result) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> _currentUser.SetSecurityAsync(_currentUser.Password);
        _viewModel.IsFingerprintEnabled = <span class="hljs-literal">true</span>;
      }
      <span class="hljs-keyword">catch</span> (Exception ex) {
        _logger.LogError(
          <span class="hljs-string">"SettingsPage: in SetResultAsync, {ex}"</span>, ex);
      }
    }
    <span class="hljs-keyword">else</span> {
      FingerprintSwitcher.Text = <span class="hljs-string">"Turn on fingerprint error."</span>;
    }
    SetFingerprintSwitcher();
  }
  <span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">async</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">OnSwitcherToggledAsync</span><span class="hljs-function">(</span><span class="hljs-built_in">object</span><span class="hljs-params"> sender,         </span><span class="hljs-comment">//(5)</span>
<span class="hljs-function">    ToggledEventArgs e)</span> {
    <span class="hljs-keyword">if</span> (!_viewModel.IsFingerprintAvailable) { <span class="hljs-keyword">return</span>; }
    <span class="hljs-keyword">if</span> (e.Value) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-built_in">string</span> data = <span class="hljs-keyword">await</span> _currentUser.GetSecurityAsync();
        <span class="hljs-keyword">if</span> (data == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">var</span> status = <span class="hljs-keyword">await</span> _viewModel.AuthenticateAsync(  <span class="hljs-params">     </span><span class="hljs-comment">//(6)</span>
              Properties.Resources.fingerprint_login_message);
            SetResultAsync(status);
        }
      }
      <span class="hljs-keyword">catch</span> (Exception ex) {_logger.LogError(<span class="hljs-string">"{ex}"</span>, ex); }
    }
    <span class="hljs-keyword">else</span> {
      _ = <span class="hljs-keyword">await</span> _currentUser.DisableSecurityAsync();
    }
  }
}
</code></pre>
<p class="packt_figref">Listing 7.2: <code class="inlineCode">SettingsPage.xaml.cs</code> (<a href="https://epa.ms/SettingsPage7-2"><span class="url">https://epa.ms/SettingsPage7-2</span></a>)</p>
<p class="normal">In the <code class="inlineCode">SettingsPage</code>, we incorporate <code class="inlineCode">LoginViewModel</code> <strong class="keyWord">(1)</strong> and <code class="inlineCode">LoginService</code> through dependency injection. We override the lifecycle method <code class="inlineCode">OnAppearing</code> <strong class="keyWord">(2)</strong> to evaluate fingerprint support by invoking <code class="inlineCode">CheckFingerprintStatus</code> <strong class="keyWord">(3)</strong>.</p>
<p class="normal">Following <a id="_idIndexMarker586"/>this, we execute the function <code class="inlineCode">SetFingerprintSwitcher</code> <strong class="keyWord">(4)</strong> to update the UI. When users toggle the switch on or off, the event handler <code class="inlineCode">OnSwitcherToggleAsync</code> <strong class="keyWord">(5)</strong> is activated. Within this event handler, we authenticate the fingerprint by calling <code class="inlineCode">AuthenticateAsync</code> <strong class="keyWord">(6)</strong> and subsequently save the master password in secure storage. If fingerprint authentication is not used, we remove the master password from secure storage to disable this feature.</p>
<h3 class="heading-3" id="_idParaDest-200">Login using a fingerprint</h3>
<p class="normal">Upon<a id="_idIndexMarker587"/> activating the fingerprint feature in the <code class="inlineCode">SettingsPage</code>, users can utilize fingerprint login, as illustrated in <em class="italic">Figure 7.6</em>. With the fingerprint function enabled, a fingerprint icon appears next to the password field. By clicking on this icon, users can access the fingerprint login user interface.</p>
<figure class="mediaobject"><img alt="A screenshot of a login screen  Description automatically generated" height="922" src="../Images/B21554_07_06.png" width="425"/></figure>
<p class="packt_figref">Figure 7.6: LoginPage</p>
<p class="normal">We can examine the implementation of this fingerprint icon by reviewing the XAML code provided below:</p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">ImageButton</span><span class="hljs-tag"> </span><span class="hljs-attr">x:Name</span><span class="hljs-tag">=</span><span class="hljs-string">"fpButton"</span><span class="hljs-tag"> </span><span class="hljs-attr">Grid.Row</span><span class="hljs-tag">=</span><span class="hljs-string">"1"</span><span class="hljs-tag"> </span><span class="hljs-attr">Grid.Column</span><span class="hljs-tag">=</span><span class="hljs-string">"2"</span><span class="hljs-tag"> </span>
<span class="hljs-tag">    </span><span class="hljs-attr">VerticalOptions</span><span class="hljs-tag">=</span><span class="hljs-string">"End"</span><span class="hljs-tag"> </span><span class="hljs-attr">IsVisible</span><span class="hljs-tag">=</span><span class="hljs-string">"</span><span class="hljs-string">{Binding IsFingerprintEnabled}"</span>
<span class="hljs-tag">    </span><span class="hljs-attr">Command</span><span class="hljs-tag">=</span><span class="hljs-string">"{Binding </span><span class="code-highlight"><strong class="hljs-string-slc">FingerprintLoginCommand</strong></span><span class="hljs-string">}"</span><span class="hljs-tag"> </span>
<span class="hljs-tag">    </span><span class="hljs-attr">BackgroundColor</span><span class="hljs-tag">=</span><span class="hljs-string">"White"</span><span class="hljs-tag"> </span><span class="hljs-attr">BorderColor</span><span class="hljs-tag">=</span><span class="hljs-string">"White"</span>
<span class="hljs-tag">    </span><span class="hljs-attr">HeightRequest</span><span class="hljs-tag">=</span><span class="hljs-string">"32"</span><span class="hljs-tag">  </span><span class="hljs-attr">WidthRequest</span><span class="hljs-tag">=</span><span class="hljs-string">"32"</span><span class="hljs-tag"> </span><span class="hljs-attr">BorderWidth</span><span class="hljs-tag">=</span><span class="hljs-string">"0"</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">ImageButton.Source</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">FontImageSource</span><span class="hljs-tag"> </span><span class="hljs-attr">FontFamily</span><span class="hljs-tag">=</span><span class="hljs-string">"FontAwesomeSolid"</span>
<span class="hljs-tag">          </span><span class="hljs-attr">Glyph</span><span class="hljs-tag">=</span><span class="hljs-string">"{x:Static styles:FontAwesomeSolid.Fingerprint}"</span>
<span class="hljs-tag">          </span><span class="hljs-attr">Color</span><span class="hljs-tag">=</span><span class="hljs-string">"{DynamicResource Primary}"</span><span class="hljs-tag"> /&gt;</span>
  <span class="hljs-tag">&lt;/</span><span class="hljs-name">ImageButton.Source</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">ImageButton</span><span class="hljs-tag">&gt;</span>
</code></pre>
<p class="normal">The <a id="_idIndexMarker588"/>fingerprint icon is designed as an <code class="inlineCode">ImageButton</code>, which will only be visible when <code class="inlineCode">IsFingerprintEnabled</code> is set to true through data binding. Upon clicking the icon, the <code class="inlineCode">FingerprintLoginCommand</code> will be triggered. By leveraging the MVVM pattern, we simply need to add this <code class="inlineCode">ImageButton</code> to the XAML page, while the remaining logic is implemented within the view model.</p>
<p class="normal">We have now completed the introduction of .NET MAUI/Xamarin plugins. Our app’s fingerprint support was made possible through the use of <code class="inlineCode">Plugin.Fingerprint</code>. In the upcoming section, we will explore another case – creating custom controls or customizing existing ones.</p>
<h1 class="heading-1" id="_idParaDest-201">Customizing controls</h1>
<p class="normal">.NET MAUI controls <a id="_idIndexMarker589"/>are built on the foundation of native controls. There may be instances where we would like these native controls to exhibit customized behavior to cater to our specific needs. Additionally, there might be situations when we need to create our own controls, particularly when the desired native controls are not readily available in .NET MAUI.</p>
<p class="normal">In this section, we will discuss the .NET MAUI implementations of cross-platform controls and use an example to illustrate how to enhance a cross-platform control with new capabilities.</p>
<p class="normal">In our application, we might want to present a password entry as a secure note, rather than as a standard password entry on the details page. To improve the user experience, we aim to support Markdown text instead of plain text. As .NET MAUI currently does not provide a Markdown view control, we must create our own. We will use this scenario as an example<a id="_idIndexMarker590"/> to demonstrate how to expand the functionality of existing controls to develop a new one.</p>
<h2 class="heading-2" id="_idParaDest-202">Overview of handlers</h2>
<p class="normal">In .NET MAUI, handlers<a id="_idIndexMarker591"/> play a crucial role in the rendering process by transforming cross-platform view elements (controls) into their corresponding platform-specific native UI components. The implementation of handlers bears a resemblance to the approach taken in the <code class="inlineCode">Plugin.Fingerprint</code> implementation, where a control-specific interface is employed to distinguish between the cross-platform view and the native view. As we plan to implement our <code class="inlineCode">MarkdownView</code> using the <code class="inlineCode">WebView</code> control, we will use the <code class="inlineCode">WebView</code> control as an example to explain handlers.</p>
<p class="normal">A <code class="inlineCode">WebView</code> displays web content and HTML within a .NET MAUI application. In .NET MAUI, each supported platform (iOS, Android, macOS, and Windows) has corresponding handlers for the <code class="inlineCode">WebView</code> control, mapping it to native controls. Such examples include <code class="inlineCode">WKWebView</code> for iOS and macOS, <code class="inlineCode">WebView</code> for Android, and <code class="inlineCode">WebView2</code> for Windows.</p>
<figure class="mediaobject"><img alt="A diagram of a company  Description automatically generated" height="359" src="../Images/B21554_07_07.png" width="825"/></figure>
<p class="packt_figref">Figure 7.7: .NET MAUI handlers</p>
<p class="normal">As depicted in <em class="italic">Figure 7.7</em>, the architecture consists of three layers: a virtual view, handlers, and native views. Cross-platform controls interact with native views via a control-specific <a id="_idIndexMarker592"/>interface implemented by the handlers. In the case of <code class="inlineCode">WebView</code>, it communicates with <code class="inlineCode">WebViewHandler</code> through the <code class="inlineCode">IWebView</code> interface.</p>
<p class="normal">The <code class="inlineCode">IWebView</code> interface is implemented by <code class="inlineCode">WebViewHandler</code>, which utilizes partial classes to segregate the platform-specific implementation, such as:</p>
<ul>
<li class="bulletList"><code class="inlineCode">WebViewHandler.iOS.cs</code></li>
<li class="bulletList"><code class="inlineCode">WebViewHandler.Android.cs</code></li>
<li class="bulletList"><code class="inlineCode">WebViewHandler.WinUI.cs</code></li>
<li class="bulletList"><code class="inlineCode">WebViewHandler.MacCatalyst.cs</code></li>
</ul>
<p class="normal">Within the handler, the <code class="inlineCode">VirtualView</code> property is defined as a reference to the cross-platform control, while the <code class="inlineCode">PlatformView</code> property refers to the native view. A property mapper is utilized to establish a connection between the cross-platform control’s API and the native view’s API.</p>
<p class="normal">The implementation of .NET MAUI handlers illustrates the architectural differences between .NET MAUI and Xamarin.Forms. For more information on .NET MAUI handlers, you can refer to the Microsoft article titled “<em class="italic">Create a custom control using handlers</em>” in the <em class="italic">Further reading</em> section. This article provides extensive insights into the creation and application of custom controls using handlers.</p>
<h2 class="heading-2" id="_idParaDest-203">Using HybridWebView</h2>
<p class="normal">As we<a id="_idIndexMarker593"/> introduce handlers, we will investigate the implementation of a Markdown view using <code class="inlineCode">WebView</code>. A common approach to displaying Markdown text involves converting it into HTML and then presenting the HTML content within a <code class="inlineCode">WebView</code>. Our challenge lies in transforming the Markdown text into HTML. There are .NET libraries <a id="_idIndexMarker594"/>available to accomplish this, such as Markdig, which can be found at <a href="https://github.com/xoofx/markdig"><span class="url">https://github.com/xoofx/markdig</span></a>.</p>
<p class="normal">Opting for this approach requires us to convert Markdown text into HTML at runtime and subsequently assemble an HTML page. Since <code class="inlineCode">WebView</code> will be employed, a more straightforward method involves directly passing the Markdown text to <code class="inlineCode">WebView</code> and allowing <code class="inlineCode">WebView</code> to interpret the text, using a JavaScript library. However, the default <code class="inlineCode">WebView</code> lacks sufficient JavaScript interoperability to facilitate this process. As a solution, we will implement our Markdown view using the open-source project <code class="inlineCode">HybridWebView</code>, developed by Eilon Lipton, which can be found at <a href="https://github.com/Eilon/MauiHybridWebView"><span class="url">https://github.com/Eilon/MauiHybridWebView</span></a>.</p>
<p class="normal"><code class="inlineCode">HybridWebView</code> improves <code class="inlineCode">WebView</code> by supporting more sophisticated JavaScript interoperability. This <a id="_idIndexMarker595"/>enhancement allows for the following functionalities:</p>
<ul>
<li class="bulletList">We can configure a JavaScript library and resources by utilizing .NET MAUI raw resources, packaging them similarly to a static website. At runtime, we can load it in <code class="inlineCode">WebView</code>, which resembles a <strong class="keyWord">Single Page Application</strong> (<strong class="keyWord">SPA</strong>). There is a sample app that demonstrates how to convert an existing React application into a .NET MAUI application running in <code class="inlineCode">WebView</code>.</li>
<li class="bulletList"><code class="inlineCode">HybridWebView</code> also augments event handling and enables JavaScript functions to invoke .NET functions, and vice versa.</li>
</ul>
<p class="normal">With the assistance of <code class="inlineCode">HybridWebView</code>, let’s explore how to incorporate <code class="inlineCode">MarkdownView</code> into our app.</p>
<h2 class="heading-2" id="_idParaDest-204">Implementing MarkdownView</h2>
<p class="normal">The <a id="_idIndexMarker596"/>concept behind <code class="inlineCode">MarkdownView</code> is to directly pass the Markdown text that we wish to display to <code class="inlineCode">HybridWebView</code>. This employs a JavaScript library to render the text. To achieve this, we require a JavaScript-based Markdown interpreter. Given that Markdown is widely utilized in numerous web applications, several JavaScript libraries are available for this purpose. We will use a compact, yet efficient library called Marked, which can be found at <a href="https://github.com/markedjs/marked"><span class="url">https://github.com/markedjs/marked</span></a>.</p>
<p class="normal">Utilizing the Marked library is quite simple. You can simply invoke it as follows:</p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-meta">&lt;!doctype </span><span class="hljs-keyword">html</span><span class="hljs-meta">&gt;</span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">html</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">head</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">meta</span><span class="hljs-tag"> </span><span class="hljs-attr">charset</span><span class="hljs-tag">=</span><span class="hljs-string">"utf-8"</span><span class="hljs-tag">/&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">title</span><span class="hljs-tag">&gt;</span>Marked in the browser<span class="hljs-tag">&lt;/</span><span class="hljs-name">title</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">head</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">body</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">div</span><span class="hljs-tag"> </span><span class="hljs-attr">id</span><span class="hljs-tag">=</span><span class="hljs-string">"content"</span><span class="hljs-tag">&gt;&lt;/</span><span class="hljs-name">div</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">script</span><span class="hljs-tag"> </span><span class="hljs-attr">src</span><span class="hljs-tag">=</span><span class="hljs-string">"https://cdn.jsdelivr.net/npm/marked/marked.min.js"</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;/</span><span class="hljs-name">script</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">script</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-variable">document</span>.<span class="hljs-title">getElementById</span>(<span class="hljs-string">'content'</span>).<span class="h js-property">innerHTML</span> =
      marked.<span class="hljs-title">parse</span>(<span class="hljs-string">'This is rendered by **marked**.'</span>);
  <span class="hljs-tag">&lt;/</span><span class="hljs-name">script</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">body</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">html</span><span class="hljs-tag">&gt;</span>
</code></pre>
<p class="normal">We can observe that displaying a Markdown string is achieved by passing it to the <code class="inlineCode">marked.parse</code> function. </p>
<p class="normal">However, before<a id="_idIndexMarker597"/> we proceed, we must determine the appropriate moment to pass this Markdown string to <code class="inlineCode">WebView</code>. If we simply call a JavaScript function from the .NET side, the JavaScript function in the HTML file may not be fully prepared. Hence, it is essential to wait for the HTML file to load completely in <code class="inlineCode">WebView</code>. </p>
<p class="normal">By employing the jQuery library, we can obtain an event that notifies .NET when the HTML page is ready, as illustrated in <em class="italic">Figure 7.8</em>.</p>
<figure class="mediaobject"><img alt="A screenshot of a computer program  Description automatically generated" height="482" src="../Images/B21554_07_08.png" width="825"/></figure>
<p class="packt_figref">Figure 7.8: HTML and JavaScript resources</p>
<p class="normal">As depicted in <em class="italic">Figure 7.8</em>, we create a folder named <code class="inlineCode">hybrid_root</code> within the <code class="inlineCode">Raw</code> directory under the <code class="inlineCode">Resources</code> folder. Within the <code class="inlineCode">hybrid_root</code> folder, we store JavaScript files in the <code class="inlineCode">js</code> folder and CSS files in the <code class="inlineCode">styles</code> folder.</p>
<p class="normal">The <code class="inlineCode">js</code> folder<a id="_idIndexMarker598"/> houses local copies of both Marked and jQuery, eliminating the need for network requests when displaying a Markdown string. The left side of <em class="italic">Figure 7.8</em> displays the contents of <code class="inlineCode">hybrid_app.xhtml</code>. Inside this file, we utilize the jQuery function <code class="inlineCode">$(document).ready()</code> to send an event to the .NET side when the page has loaded. Once the .NET side receives this event, it can invoke the <code class="inlineCode">MarkdownToHtml</code> function by passing a Markdown string to it. In this manner, we can display any Markdown string using <code class="inlineCode">MarkdownView</code>.</p>
<p class="normal">Having explained the necessary preparations for HTML and JavaScript, let’s examine what we need to implement on the .NET side. We can begin by looking at the implementation of <code class="inlineCode">MarkdownView</code> in <em class="italic">Listing 7.3</em>:</p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MarkdownView</span> : <span class="hljs-title">HybridWebView.HybridWebView</span>
{
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-title">MarkdownView</span><span class="hljs-function">()</span> {
    HybridAssetRoot = <span class="hljs-string">"hybrid_root"</span>;                               <span class="hljs-comment">//(1)</span>
    MainFile = <span class="hljs-string">"hybrid_app.xhtml"</span>;                                  <span class="hljs-comment">//(2)</span>
  }
    <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">DisplayMarkdown</span><span class="hljs-function">(</span><span class="hljs-built_in">string</span><span class="hljs-params"> markdown</span><span class="hljs-function">)</span> {
<span class="hljs-meta">#</span><span class="hljs-keyword">if</span><span class="hljs-meta"> !ANDROID</span>
      <span class="hljs-built_in">string</span> markDownTxt =
        HttpUtility.JavaScriptStringEncode(markdown);              <span class="hljs-comment">//(3)</span>
<span class="hljs-meta">#</span><span class="hljs-keyword">else</span>
      <span class="hljs-built_in">string</span> markDownTxt = markdown;
<span class="hljs-meta">#</span><span class="hljs-keyword">endif</span>
      MainThread.BeginInvokeOnMainThread(<span class="hljs-keyword">async</span> () =&gt; {             <span class="hljs-comment">//(4)</span>
        <span class="hljs-keyword">await</span> InvokeJsMethodAsync(<span class="hljs-string">"MarkdownToHtml"</span>, markDownTxt);
      });
    }
}
</code></pre>
<p class="packt_figref">Listing 7.3: <code class="inlineCode">MarkdownView.cs</code> (<a href="https://epa.ms/MarkdownView7-3"><span class="url">https://epa.ms/MarkdownView7-3</span></a>)</p>
<p class="normal">In the <code class="inlineCode">MarkdownView</code>, we must establish the web asset’s root as <code class="inlineCode">hybrid_root</code> <strong class="keyWord">(1)</strong>, and <code class="inlineCode">hybrid_app.xhtml</code> <strong class="keyWord">(2)</strong> is the HTML file that needs to be loaded. </p>
<p class="normal">A function called <code class="inlineCode">DisplayMarkdown</code> is created to showcase Markdown text, and it will invoke the JavaScript function <code class="inlineCode">MarkdownToHtml</code> <strong class="keyWord">(4)</strong> to display the text. Since the encoding of Markdown text varies between Android, Windows, and iOS/macOS, the string encoding function <code class="inlineCode">JavaScriptStringEncode</code> <strong class="keyWord">(3)</strong> has to be called for Windows and iOS/macOS platforms. After implementing <code class="inlineCode">MarkdownView</code>, we can develop the user interface to render Markdown text, as demonstrated in <em class="italic">Listing 7.4</em>:</p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-meta">&lt;?xml version=</span><span class="hljs-string">"1.0"</span><span class="hljs-meta"> encoding=</span><span class="hljs-string">"utf-8"</span><span class="hljs-meta"> ?&gt;</span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">ContentPage</span><span class="hljs-tag"> </span>
<span class="hljs-tag">  </span><span class="hljs-attr">xmlns</span><span class="hljs-tag">=</span><span class="hljs-string">"http://schemas.microsoft.com/dotnet/2021/maui"</span>
<span class="hljs-tag">  </span><span class="hljs-attr">xmlns:x</span><span class="hljs-tag">=</span><span class="hljs-string">"http://schemas.microsoft.com/winfx/2009/xaml"</span>
<span class="hljs-tag">  </span><span class="hljs-attr">xmlns:vw</span><span class="hljs-tag">=</span><span class="hljs-string">"clr-namespace:PassXYZ.Vault.Views"</span>
<span class="hljs-tag">  </span><span class="hljs-attr">x:Class</span><span class="hljs-tag">=</span><span class="hljs-string">"PassXYZ.Vault.Views.NotesPage"</span>
<span class="hljs-tag">  </span><span class="hljs-attr">Title</span><span class="hljs-tag">=</span><span class="hljs-string">"{Binding Title}"</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">vw:MarkdownView</span><span class="hljs-tag"> </span><span class="hljs-attr">x:Name</span><span class="hljs-tag">=</span><span class="hljs-string">"markdownview"</span><span class="hljs-tag"> </span>
<span class="hljs-tag">    </span><span class="hljs-attr">RawMessageReceived</span><span class="hljs-tag">=</span><span class="hljs-string">"OnHybridWebViewRawMessageReceived"</span>
<span class="hljs-tag">    </span><span class="hljs-attr">VerticalOptions</span><span class="hljs-tag">=</span><span class="hljs-string">"FillAndExpand"</span><span class="hljs-tag">/&gt;</span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">ContentPage</span><span class="hljs-tag">&gt;</span>
</code></pre>
<p class="packt_figref">Listing 7.4: <code class="inlineCode">NotesPage.xaml</code> (<a href="https://epa.ms/NotesPage7-4"><span class="url">https://epa.ms/NotesPage7-4</span></a>)</p>
<p class="normal">In <em class="italic">Listing 7.4</em>, a <code class="inlineCode">MarkdownView</code> called <code class="inlineCode">markdownview</code> is defined. An event handler, <code class="inlineCode">OnHybridWebViewRawMessageReceived</code>, is registered, and its implementation can be found in<a id="_idIndexMarker599"/> the code-behind file in <em class="italic">Listing 7.5</em>:</p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">using</span> PassXYZ.Vault.ViewModels;
<span class="hljs-keyword">namespace</span> <span class="hljs-title">PassXYZ.Vault.Views</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">NotesPage</span> : <span class="hljs-title">ContentPage</span> {
  ItemDetailViewModel _viewModel;
  <span class="hljs-keyword">public</span><span class="hljs-function"> </span><span class="hljs-title">NotesPage</span><span class="hljs-function">(</span><span class="hljs-params">ItemDetailViewModel viewModel</span><span class="hljs-function">)</span> {
    InitializeComponent();
    BindingContext = _viewModel = viewModel;
<span class="hljs-meta">#</span><span class="hljs-keyword">if</span><span class="hljs-meta"> DEBUG</span>
    markdownview.EnableWebDevTools = <span class="hljs-literal">true</span>;
<span class="hljs-meta">#</span><span class="hljs-keyword">endif</span>
  }
  <span class="hljs-keyword">protected</span><span class="hljs-function"> </span><span class="hljs-keyword">override</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">OnAppearing</span><span class="hljs-function">()</span> {                         <span class="hljs-comment">//(1)</span>
    <span class="hljs-keyword">base</span>.OnAppearing();
    markdownview.Reload(); 
  }
  <span class="hljs-keyword">private</span><span class="hljs-function"> </span><span class="hljs-keyword">void</span><span class="hljs-function"> </span><span class="hljs-title">OnHybridWebViewRawMessageReceived</span><span class="hljs-function">(</span><span class="hljs-built_in">object</span><span class="hljs-params"> sender, </span>
<span class="hljs-params">    HybridWebView.HybridWebViewRawMessageReceivedEventArgs e</span><span class="hljs-function">)</span> {
    markdownview.DisplayMarkdown(_viewModel.MarkdownText);        <span class="hljs-comment">//(2)</span>
  }
}
</code></pre>
<p class="packt_figref">Listing 7.5: <code class="inlineCode">NotesPage.xaml.cs</code> (<a href="https://epa.ms/NotesPage7-5"><span class="url">https://epa.ms/NotesPage7-5</span></a>)</p>
<p class="normal">In the <code class="inlineCode">NotesPage.xaml.cs</code> file, we override the <code class="inlineCode">OnAppearing</code> function <strong class="keyWord">(1)</strong>. This function ensures that <code class="inlineCode">MarkdownView</code> is reloaded every time the page is loaded. </p>
<p class="normal">The <code class="inlineCode">OnHybridWebViewRawMessageReceived</code> event handler is where we invoke <code class="inlineCode">DisplayMarkdown</code> <strong class="keyWord">(2)</strong> to <a id="_idIndexMarker600"/>showcase the Markdown text. <em class="italic">Figure 7.9</em> displays the completed user interface.</p>
<figure class="mediaobject"><img alt="A screenshot of a phone  Description automatically generated" height="849" src="../Images/B21554_07_09.png" width="392"/></figure>
<p class="packt_figref">Figure 7.9: MarkdownView</p>
<p class="normal">With the <a id="_idIndexMarker601"/>introduction of <code class="inlineCode">MarkdownView</code>, we have gained knowledge on expanding an existing control to accommodate the necessary new features.</p>
<h1 class="heading-1" id="_idParaDest-205">Summary</h1>
<p class="normal">In this chapter, we presented guidelines on implementing platform-specific code within a .NET MAUI project. There are numerous instances where platform-specific code implementation may be required. Regardless of whether we aim to create a plugin or a custom control, it is crucial to begin with an interface definition. A pre-defined interface facilitates the seamless separation of cross-platform and native implementations. To implement the interface, we have the option to employ either an abstract class or a partial class, allowing us to distribute the implementation for each platform across individual files.</p>
<p class="normal">The introduction of <code class="inlineCode">HybridWebView</code> opens the door to integrating or reusing JavaScript libraries. By crafting hybrid solutions, we can harness the advantages of both .NET and the JavaScript ecosystem. <code class="inlineCode">HybridWebView</code> enables the development of .NET solutions that incorporate various JavaScript frameworks.</p>
<p class="normal">Having completed the current version of the password manager app, we have now reached the end of <em class="italic">Part 1</em> of this book.</p>
<p class="normal">In <em class="italic">Part 2</em>, we will delve into the Blazor Hybrid app within .NET MAUI, which is a novel feature that is not present in Xamarin.Forms. By employing Blazor, we can introduce some cutting-edge frontend development methods to .NET MAUI development.</p>
<h1 class="heading-1" id="_idParaDest-206">Further reading</h1>
<ul>
<li class="bulletList">Biometric / fingerprint plugin for Xamarin: <a href="https://github.com/smstuebe/xamarin-fingerprint"><span class="url">https://github.com/smstuebe/xamarin-fingerprint</span></a></li>
<li class="bulletList">.NET MAUI HybridWebView: <a href="https://github.com/Eilon/MauiHybridWebView"><span class="url">https://github.com/Eilon/MauiHybridWebView</span></a></li>
<li class="bulletList">Marked – Markdown parser: <a href="https://marked.js.org"><span class="url">https://marked.js.org</span></a></li>
<li class="bulletList">Xamarin Mobile Application Development for Android: <a href="https://www.oreilly.com/library/view/xamarin-mobile-application/9781785280375/"><span class="url">https://www.oreilly.com/library/view/xamarin-mobile-application/9781785280375/</span></a></li>
<li class="bulletList">Beginning Xamarin Development for the Mac: Create iOS, watchOS, and Apple tvOS apps with Xamarin.iOS and Visual Studio for Mac: <a href="https://www.oreilly.com/library/view/beginning-xamarin-development/9781484231326/"><span class="url">https://www.oreilly.com/library/view/beginning-xamarin-development/9781484231326/</span></a></li>
<li class="bulletList">.NET MAUI source code: <a href="https://github.com/dotnet/maui"><span class="url">https://github.com/dotnet/maui</span></a></li>
<li class="bulletList">.NET for Android source code – both .NET for Android and Xamarin.Android are built from this repository with different build configurations: <a href="https://github.com/xamarin/xamarin-android"><span class="url">https://github.com/xamarin/xamarin-android</span></a></li>
<li class="bulletList">.NET for iOS source code – both .NET for iOS and Xamarin.iOS are built from this repository with different build configurations: <a href="https://github.com/xamarin/xamarin-macios"><span class="url">https://github.com/xamarin/xamarin-macios</span></a></li>
<li class="bulletList">.NET for Mac source code – .NET for iOS and .NET for Mac share the same codebase with different build configurations: <a href="https://github.com/xamarin/xamarin-macios"><span class="url">https://github.com/xamarin/xamarin-macios</span></a></li>
<li class="bulletList">WinUI: <a href="https://github.com/microsoft/microsoft-ui-xaml"><span class="url">https://github.com/microsoft/microsoft-ui-xaml</span></a></li>
<li class="bulletList">Create a custom control using handlers: <a href="https://learn.microsoft.com/en-us/dotnet/maui/user-interface/handlers/create?view=net-maui-8.0"><span class="url">https://learn.microsoft.com/en-us/dotnet/maui/user-interface/handlers/create?view=net-maui-8.0</span></a></li>
<li class="bulletList">Introducing Shared Class Library – multi-target Xamarin.Forms and .NET MAUI from a single project: <a href="https://egvijayanand.in/2022/05/25/introducing-shared-class-library-multi-target-xamarin-forms-and-dotnet-maui-from-a-single-project/"><span class="url">https://egvijayanand.in/2022/05/25/introducing-shared-class-library-multi-target-xamarin-forms-and-dotnet-maui-from-a-single-project/</span></a></li>
</ul>
<h1 class="heading-1">Leave a review!</h1>
<p class="normal"><em class="italic">Enjoying this book? Help readers like you by leaving an Amazon review. Scan the QR code below for a 40% discount code.</em></p>
<p class="normal"><img alt="" height="182" src="../Images/Leave_a_review_QR.png" width="182"/></p>
<p class="normal"><em class="italic">*Limited Offer</em></p>
</div>
</div></body></html>