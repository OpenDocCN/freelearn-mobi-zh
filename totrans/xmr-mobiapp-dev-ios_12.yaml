- en: Chapter 12. Peripherals
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第12章. 外设
- en: The whole point of having a smartphone is that it is not just a phone, it's
    a GPS, a media center, a messenger system, and a video system. In short, that
    little device in your pocket is the proverbial "Jack of all trades, but master
    of *all*."
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有智能手机的全部意义在于它不仅仅是一部电话，它还是 GPS、媒体中心、消息系统以及视频系统。简而言之，你口袋里的那个小设备是传说中的“万能的，但精通所有*技艺*。”
- en: 'In this chapter, we will be covering the following topics:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: Using the camera
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用相机
- en: Maps and GPS
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 地图和 GPS
- en: Storage on the phone
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 手机存储
- en: Making a phone call
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 打电话
- en: Sending and receiving a text message
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 发送和接收短信
- en: Accessing the internet
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 访问互联网
- en: Multimedia
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 多媒体
- en: Using the camera
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用相机
- en: The camera on the iPhone is capable of recording stills and video. We will be
    dealing with video shortly.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: iPhone 上的相机能够录制静态图像和视频。我们将很快处理视频。
- en: The camera can be accessed in one of the two ways. Xamarin has released `Xamarin.Mobile`
    in its component store, which gives a cross platform method to access the GPS,
    camera, and address book. For completeness, we will cover both the native and
    component versions.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 相机可以通过两种方式之一访问。Xamarin 已经在其组件商店中发布了 `Xamarin.Mobile`，它提供了一个跨平台的方法来访问 GPS、相机和通讯录。为了完整性，我们将涵盖原生和组件版本。
- en: Accessing the camera (Xamarin.Mobile)
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 访问相机（Xamarin.Mobile）
- en: 'The `Xamarin.Mobile` component provides an easy way to access a camera. A simple
    method would look as follows:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '`Xamarin.Mobile` 组件提供了一个简单的方法来访问相机。一个简单的示例方法如下：'
- en: '[PRE0]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The issue with the Xamarin component is that it currently doesn't provide a
    method for accessing the front camera; however, the preceding code will save the
    clicked image.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: Xamarin 组件的问题在于它目前没有提供访问前置相机的功能；然而，前面的代码将保存点击的图片。
- en: Accessing the camera (Native)
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 访问相机（原生）
- en: The camera is accessed using `UIImagePickerController`. To use it, it's always
    wise to first check whether the device actually has a camera (the iPod Touch doesn't
    have one nor does the simulator). To do this, check the `IsSourceTypeAvailable`
    Boolean.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 相机是通过 `UIImagePickerController` 访问的。要使用它，首先检查设备是否实际上有相机（iPod Touch 没有相机，模拟器也没有）。为此，检查
    `IsSourceTypeAvailable` 布尔值。
- en: '[PRE1]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The delegate deals with dismissing the modal window and any other process you
    want (such as displaying the picture or saving the image). A simple delegate would
    look something like the following (it can be extended if required):'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 代理处理关闭模态窗口以及您想要的其他任何过程（例如显示图片或保存图片）。一个简单的代理示例如下（如果需要可以扩展）：
- en: '[PRE2]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Saving to the Photo album (Native)
  id: totrans-22
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 保存到相册（原生）
- en: 'The following code would be placed in the `myCameraPicker.Delegate` code within
    the `FinishedPickingMedia()` method, which would save images to the camera roll
    natively:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码将放置在 `myCameraPicker.Delegate` 代码中的 `FinishedPickingMedia()` 方法内，这将以原生方式保存图片到相机胶卷：
- en: '[PRE3]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: GPS and Mapping
  id: totrans-25
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: GPS 和地图
- en: This is also covered by the `Xamarin.Mobile` component in part (the full functionality
    of **Core Location** is not replicated in the `Xamarin.Mobile` component, due
    to there not being an equivalent method on the other platforms that the component
    supports). Thankfully, the component and Core Location work together seamlessly.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 这也由 `Xamarin.Mobile` 组件部分覆盖（由于该组件支持的其他平台没有等效方法，`Xamarin.Mobile` 组件中没有复制 `Core
    Location` 的全部功能）。幸运的是，该组件和 Core Location 可以无缝协作。
- en: GPS with Xamarin.Mobile
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 Xamarin.Mobile 的 GPS
- en: 'The `Xamarin.Mobile` component allows you to listen to the position of the
    device and act when the position has been changed, using the `PositionChanged`
    event. The following code demonstrates how to use it:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: '`Xamarin.Mobile` 组件允许您通过 `PositionChanged` 事件监听设备的位置变化，并在位置发生变化时采取行动。以下代码演示了如何使用它：'
- en: '[PRE4]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'While analyzing the preceding lines of code, we come across the following terms:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 在分析前面的代码行时，我们遇到了以下术语：
- en: '`DesiredAccuracy`: It is the distance in meters that is needed before the event
    is triggered. This in itself can cause an issue. Anything under that value will
    mean that the event is not triggered. Too big a value, the accuracy is hit.'
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`DesiredAccuracy`：这是在触发事件之前所需的距离（以米为单位）。这本身可能会引起问题。任何低于该值的值都意味着事件不会被触发。值太大，精度就会受到影响。'
- en: '`StartListening`: It takes two parameters: `minimumTime` and `minDistance`.
    In this case, it should either return within the first minute, or if the phone
    is moved more than 10 m.'
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`StartListening`：它接受两个参数：`minimumTime` 和 `minDistance`。在这种情况下，它应该在第一分钟内返回，或者如果手机移动超过
    10 米。'
- en: '`StopListening`: It stops the listening service.'
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`StopListening`：它停止监听服务。'
- en: The `Xamarin.Mobile` module also provides you with an asynchronous method—`GetPositionAsync`,
    which retrieves your position asynchronously.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '`Xamarin.Mobile` 模块还提供了一个异步方法——`GetPositionAsync`，用于异步获取您的位置。'
- en: '[PRE5]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The returned value stored in `Result` also provides the speed. This is not to
    be relied upon. It's far more accurate to use your own method, but to do that
    you need to know how far you have traveled.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 存储在 `Result` 中的返回值也提供了速度。这并不可靠。使用您自己的方法会更准确，但要做到这一点，您需要知道您已经行驶了多远。
- en: Calculating your speed
  id: totrans-37
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 计算您的速度
- en: 'The `CoreLocation` namespace has in it a method named `DistanceFrom` for calculating
    the distance. The method works as follows:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '`CoreLocation` 命名空间中有一个名为 `DistanceFrom` 的方法，用于计算距离。该方法的工作方式如下：'
- en: Gets the new location.
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取新位置。
- en: Gets the old location.
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取旧位置。
- en: Creates two instances of `CLManager`.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建两个 `CLManager` 实例。
- en: Puts the coordinates of both the locations into the two instances respectively.
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将两个位置的坐标分别放入两个实例中。
- en: Uses `DistanceFrom`.
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `DistanceFrom`。
- en: The resulting `double` value gives you the distance in meters and the time in
    seconds, so the speed you have traveled is in meters/seconds (that is, distance/time).
    The issue here though is the calculation; it might consider how a bird flies rather
    than how you are travelling. For example, if the desired accuracy you have is
    too low and the timeout too high, the method with `DistanceFrom` will still work;
    however, if the distance is not 100 m, but apparently 35 m (consider that a bird
    flies straight across a field, and does not walk down a road, turn left, turn
    right, or go roundabout and then turn left again), the distance is much shorter
    and therefore will also change the speed considerably.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 结果的 `double` 值为您提供以米为单位的距离和以秒为单位的时间，因此您所行驶的速度是以米/秒（即距离/时间）计算的。然而，这里的计算问题可能是考虑了鸟的飞行方式，而不是您的移动方式。例如，如果期望的精度太低，超时时间太高，使用
    `DistanceFrom` 的方法仍然可以工作；然而，如果距离不是 100 米，而是显然是 35 米（考虑鸟儿直接飞越田野，而不是沿着道路行走，左转，右转或绕行然后再次左转），距离会更短，因此速度也会相应地改变。
- en: Using Core Location
  id: totrans-45
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 Core Location
- en: Core Location is the default framework for the GPS. It is a powerful system
    for determining the positioning of the device and is far reaching in what it does
    and how it does it. As with a number of other facilities within iOS, a delegate
    is required when setting up the Core Location framework. A delegate typically
    handles events.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: Core Location 是 GPS 的默认框架。它是一个强大的系统，用于确定设备的定位，其作用范围广泛，包括如何执行。与 iOS 中的许多其他功能一样，在设置
    Core Location 框架时需要代理。代理通常处理事件。
- en: Setting up Core Location and delegate
  id: totrans-47
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置 Core Location 和代理
- en: 'Core Location and delegate can be set up and used as demonstrated with the
    following code:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 如以下代码所示，可以设置并使用 Core Location 和代理：
- en: '[PRE6]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '`CLLocationManager` is set up with the desired accuracy being set to the best
    it can. Next, to make it useful, we need to first catch any errors with the following
    code:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '`CLLocationManager` 被设置为期望的精度尽可能高。接下来，为了使其有用，我们首先需要用以下代码捕获任何错误：'
- en: '[PRE7]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Once the error system has been set, monitoring the changes to the positioning
    needs to be handled.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦错误系统被设置，就需要处理定位变化的监控。
- en: '[PRE8]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'If the app is paused, this event will need to be handled:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 如果应用被暂停，则需要处理以下事件：
- en: '[PRE9]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'To start the checks for update monitoring, use the following line of code:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始更新监控的检查，请使用以下行代码：
- en: '[PRE10]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'To stop the checks for update monitoring, use the following line of code:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 要停止更新监控的检查，请使用以下行代码：
- en: '[PRE11]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: The `CLLocationManager` class also allows you to monitor the direction you are
    moving in.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '`CLLocationManager` 类还允许您监控您移动的方向。'
- en: '[PRE12]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Finding where the user is
  id: totrans-62
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 查找用户的位置
- en: Having coordinates is all well and good, but who can actually say what they
    mean? For example, if I were to give you the longitude/latitude coordinates of
    53.431/-2.956, would you know where that was? Chances are that you wouldn't!
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 拥有坐标是件好事，但谁又能真正说出它们代表什么？例如，如果我要给你 53.431/-2.956 的经纬度坐标，你会知道那是什么地方吗？可能性很大，你不会知道！
- en: This is where reverse geocoding comes into the picture. The `MKReverseGeocoder`
    class is in the `MonoTouch.MapKit` namespace.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是反向地理编码发挥作用的地方。`MKReverseGeocoder` 类位于 `MonoTouch.MapKit` 命名空间中。
- en: '[PRE13]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Unlike `locManager`, the `ReverseGeocoder` class has to be placed into a delegate.
    `MKReverseGeocoder` doesn't contain any events to latch on to.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 与`locManager`不同，`ReverseGeocoder`类必须放置在委托中。`MKReverseGeocoder`不包含任何可以附加的事件。
- en: '[PRE14]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: The `Xamarin.Mobile` component does not contain the ability to perform a `ReverseGeocoder`
    operation. But it's not difficult to write one.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '`Xamarin.Mobile`组件不包含执行`ReverseGeocoder`操作的能力。但编写一个并不困难。'
- en: 'In the original example, the `LocationsUpdated` method was given as an inline
    example. If this is changed to point to a method, the `ReverseGeolocation` method
    can be performed:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 在原始示例中，`LocationsUpdated`方法被作为一个内联示例给出。如果将其更改为指向一个方法，则可以执行`ReverseGeolocation`方法：
- en: '[PRE15]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Adding a map
  id: totrans-71
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 添加地图
- en: The final part to the GPS is to add a map. For this, a `Map` view needs to be
    used by adding it in either Xcode or code. For my purpose, I will assume it was
    added via Xcode and is called `mapViewer`. There are three types of maps available,
    so a `UISegment` control is also added.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: GPS的最后一部分是添加地图。为此，需要通过在Xcode中添加或在代码中添加来使用`Map`视图。就我的目的而言，我将假设它是通过Xcode添加的，并命名为`mapViewer`。有三种类型的地图可供选择，因此还添加了一个`UISegment`控件。
- en: '![Adding a map](img/00042.jpeg)'
  id: totrans-73
  prefs: []
  type: TYPE_IMG
  zh: '![添加地图](img/00042.jpeg)'
- en: 'The `mapViewer` object needs to be set up:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 需要设置`mapViewer`对象：
- en: '[PRE16]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'The resultant location corresponding to the coordinates passed in the preceding
    code is shown in the following screenshot:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 前面代码中传入的坐标对应的结果位置在以下屏幕截图中显示：
- en: '![Adding a map](img/00043.jpeg)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![添加地图](img/00043.jpeg)'
- en: 'The next stage is to make the `UISegment` control go live:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个阶段是使`UISegment`控件生效：
- en: '[PRE17]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '![Adding a map](img/00044.jpeg)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![添加地图](img/00044.jpeg)'
- en: In case you didn't know, the geolocation is for **Anfield**, home of Liverpool
    FC.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您不知道，地理位置是利物浦足球俱乐部的主场**安菲尔德**。
- en: 'Some of the properties need to be explained in short:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 一些属性需要简要解释：
- en: '`ShowUserLocation`: It shows a blue dot to show where the user is'
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ShowUserLocation`: 显示一个蓝色点来显示用户的位置'
- en: '`ZoomEnabled`: It allows the user to zoom in'
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ZoomEnabled`: 允许用户进行缩放'
- en: '`ScrollEnabled`: It allows the user to scroll the view around'
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`ScrollEnabled`: 允许用户滚动查看视图'
- en: '`UserInteractionEnabled`: It enables a pin placed on the map to respond (or
    not) when clicked'
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`UserInteractionEnabled`: 启用放置在地图上的图钉在被点击时（或不）做出响应'
- en: '`MKCoordinateSpan(0.5,0.5)`: This is the zoom setting— the smaller the number,
    the larger the zoom on the initial view'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`MKCoordinateSpan(0.5,0.5)`: 这是缩放设置——数字越小，初始视图的缩放越大'
- en: Adding a pin
  id: totrans-88
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 添加图钉
- en: When it comes to maps, *pins* are very useful. While a little blue dot is neat,
    a pin really shows you where you are, and information can be added to it.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 当谈到地图时，*图钉*非常有用。虽然一个小蓝点很整洁，但图钉实际上显示了您所在的位置，并且可以添加信息到它。
- en: '[PRE18]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Finally, it is always good to center the map and pin on the screen
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，始终将地图居中并固定在屏幕上
- en: '[PRE19]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '![Note](img/00001.gif)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
  zh: '![备注](img/00001.gif)'
- en: Note
  id: totrans-94
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 备注
- en: The pin does not always work on the simulator.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 图钉在模拟器上不一定总是有效。
- en: '![Note](img/00001.gif)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![备注](img/00001.gif)'
- en: Storage on the phone
  id: totrans-97
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 手机存储
- en: .NET specifies a number of places in the `SpecialFolders` enumeration (such
    as `Program Files`, `My Music`, and `My Pictures`; a full list can be found on
    the Microsoft website). Due to security restrictions on the iOS devices, only
    a few of them are available. It is safest to restrict saving any user data to
    `My Documents`. Within `My Documents`, you can create directories of your own
    and use them the way you like.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: .NET在`SpecialFolders`枚举中指定了多个位置（例如`Program Files`、`My Music`和`My Pictures`；完整列表可以在Microsoft网站上找到）。由于iOS设备的安全限制，其中只有少数可用。最安全的方法是将任何用户数据保存到`My
    Documents`。在`My Documents`中，您可以创建自己的目录并按自己的喜好使用它们。
- en: Making a phone call
  id: totrans-99
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 打电话
- en: This may sound daft. Why would you want to write code to make a phone call?
    In true developer tradition, the answer is *why not?* It is important to note
    that a string number is just that. It cannot contain spaces, hyphens, brackets,
    or the plus sign (+); it can only contain numbers.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 这听起来可能有些荒谬。为什么你想编写代码来打电话？按照真正的开发者传统，答案是*为什么不呢？*重要的是要注意，字符串号码只是那样。它不能包含空格、连字符、括号或加号（+）；它只能包含数字。
- en: '[PRE20]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Moving on...
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 继续前进...
- en: Sending and receiving a text message
  id: totrans-103
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 发送和接收短信
- en: The iPhone comes with its own built-in messaging software. However, there are
    some rare times when you need to code a message before sending it. Apple, in its
    wisdom, though, does not allow you to send a message without it going through
    its own message software. This is not to say you can't send a message in another
    way (such as through a dedicated web or message service), but for standard users,
    you can't.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: iPhone自带内置的消息软件。然而，有些时候您需要在发送消息之前对其进行编码。然而，苹果公司出于其智慧，不允许您在不通过其自己的消息软件的情况下发送消息。这并不是说您不能以其他方式发送消息（例如通过专门的网站或消息服务），但对于标准用户来说，您不能。
- en: You cannot code in a way that would intercept or block text messages. iOS provides
    no publicly available method to intercept and read a text message. With that in
    mind, sending a text message is a relatively straightforward affair. `MFMessageComposeViewController`
    is in the `MonoTouch.MessageUI` namespace.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 您不能以截获或阻止短信的方式编写代码。iOS没有提供公开可用的方法来截获和读取短信。考虑到这一点，发送短信是一个相对简单的事情。"MFMessageComposeViewController"位于"MonoTouch.MessageUI"命名空间中。
- en: '[PRE21]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Accessing the Internet
  id: totrans-107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 访问互联网
- en: Access to the internet is via the `UIWebView` controller. Prior to trying to
    access an internet site, it's a good idea to ensure there is a live network connection.
    This is preformed via the `NetworkReachability` class.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 通过`UIWebView`控制器访问互联网。在尝试访问网站之前，确保有活跃的网络连接是个好主意。这是通过`NetworkReachability`类完成的。
- en: '[PRE22]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'The `WriteLine` command will result in one of the following flags:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '`WriteLine`命令将导致以下标志之一：'
- en: '| Flag | Value |'
  id: totrans-111
  prefs: []
  type: TYPE_TB
  zh: '| 标志 | 值 |'
- en: '| --- | --- |'
  id: totrans-112
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `Reachable` | The host is reachable |'
  id: totrans-113
  prefs: []
  type: TYPE_TB
  zh: '| `Reachable` | 主机可达 |'
- en: '| `IsWWAN` | Connection is made through EDGE, 3G, or 4G |'
  id: totrans-114
  prefs: []
  type: TYPE_TB
  zh: '| `IsWWAN` | 通过EDGE、3G或4G建立连接 |'
- en: '| `IsLocalDevice` | Connection is made to the local device |'
  id: totrans-115
  prefs: []
  type: TYPE_TB
  zh: '| `IsLocalDevice` | 连接到本地设备 |'
- en: '| `ConnectionAutomatic` | Connection is made automatically. This is an alias
    for `ConnectionOnTraffic`. |'
  id: totrans-116
  prefs: []
  type: TYPE_TB
  zh: '| `ConnectionAutomatic` | 自动建立连接。这是`ConnectionOnTraffic`的别名。 |'
- en: '| `ConnectionOnTraffic` | A combination of `Reachable` and when data is requested,
    a connection is made |'
  id: totrans-117
  prefs: []
  type: TYPE_TB
  zh: '| `ConnectionOnTraffic` | 结合`Reachable`和请求数据时建立连接 |'
- en: '| `ConnectionOnDemand` | Occurs when the connection starts. The connection
    occurs once the socket is connected. |'
  id: totrans-118
  prefs: []
  type: TYPE_TB
  zh: '| `ConnectionOnDemand` | 在连接开始时发生。连接在套接字连接后发生。 |'
- en: '| `ConnectionRequired` | The host can be reached, but the connection must be
    made |'
  id: totrans-119
  prefs: []
  type: TYPE_TB
  zh: '| `ConnectionRequired` | 主机可达，但必须建立连接 |'
- en: '| `IsDirect` | The connection is made directly |'
  id: totrans-120
  prefs: []
  type: TYPE_TB
  zh: '| `IsDirect` | 直接建立连接 |'
- en: '| `InterventionRequired` | When connected to a host, the user must do something
    |'
  id: totrans-121
  prefs: []
  type: TYPE_TB
  zh: '| `InterventionRequired` | 连接到主机时，用户必须执行某些操作 |'
- en: '| `TransientConnection` | The host can be reached, but through a system which
    starts and stops (such as PPP or any other nonpersistent network connection) |'
  id: totrans-122
  prefs: []
  type: TYPE_TB
  zh: '| `TransientConnection` | 主机可达，但通过一个启动和停止的系统（如PPP或任何其他非持久性网络连接） |'
- en: Assuming there is a network connection, the next stage is to load the web page.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 假设存在网络连接，下一步是加载网页。
- en: 'I covered loading a web page and some of the settings back in [Chapter 3](../Text/part0022.html#page
    "Chapter 3. Views and Layouts"), *Views and Layouts*. It is also possible to load
    a web page from the data you have dynamically generated. This can be simply demonstrated
    using the following UI with the code. Firstly, set up an application structure
    as shown with `UIWebview` in the `.xib` file:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 我在[第3章](../Text/part0022.html#page "第3章. 视图和布局")中介绍了加载网页和一些设置，*视图和布局*。也可以从您动态生成的数据中加载网页。以下代码示例可以简单地演示这一点。首先，按照以下方式设置应用程序结构，在`.xib`文件中使用`UIWebview`：
- en: '![Accessing the Internet](img/00045.jpeg)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
  zh: '![访问互联网](img/00045.jpeg)'
- en: 'The HTML directory can be named as per your wish. I''ve kept it simple and
    just called it HTML. When generating your own HTML from within your app, you can
    either:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: HTML目录可以按照您的意愿命名。我保持简单，只叫它HTML。当在您的应用程序中生成自己的HTML时，您可以选择：
- en: Generate your own file from scratch, save, and get the output
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 从头开始生成自己的文件，保存并获取输出
- en: Generate your HTML file using `StringBuilder` and output that string
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用`StringBuilder`生成HTML文件并输出该字符串
- en: Mix the preceding two options
  id: totrans-129
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 混合前两个选项
- en: 'In essence, the two generation methods are the same with the difference of
    generating the string either using `StringBuilder` or concatenate strings. Consider
    the following lines of code:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 从本质上讲，两种生成方法相同，区别在于使用`StringBuilder`生成字符串或连接字符串。考虑以下代码行：
- en: '[PRE23]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'The preceding lines of code should do what you would expect them to, once passed
    to `UIWebview` using the following code:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码行应该执行你预期的操作，一旦通过以下代码传递给`UIWebview`：
- en: '[PRE24]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: While these lines of code do their work, creating your web page based on data
    from within an app using these lines of code can be time consuming. A simpler
    method is to pull the header and footer in from some HTML fragments within the
    app.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 当这些代码行执行其工作，基于应用程序内部的数据使用这些代码行创建你的网页可能会很耗时。一个更简单的方法是从应用程序中的某些HTML片段中拉取页眉和页脚。
- en: 'To read the files from within the app, though, a couple of steps have to be
    taken. The first is to set the HTML fragments to be built as `BundleResource`.
    You will be loading a file that is part of the bundle rather than a file in the
    app''s writable folder. The second part is to load the HTML bundles into the source:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，要从应用程序内部读取文件，需要采取一些步骤。第一步是将要构建的HTML片段设置为`BundleResource`。你将加载的是属于捆绑包的文件，而不是应用程序可写文件夹中的文件。第二步是将HTML捆绑包加载到源中：
- en: '[PRE25]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '`NSBundle.MainBundle.BundlePath` is the path to the installed application.
    The next step is to add the data; in my example, I am adding a league table:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '`NSBundle.MainBundle.BundlePath`是已安装应用程序的路径。下一步是添加数据；在我的例子中，我添加了一个联赛表格：'
- en: '[PRE26]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: The top table section could as easily be its own HTML fragment. Once the final
    append has been made, the HTML is good to go.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 顶部的表格部分可以很容易地成为它自己的HTML片段。一旦完成最终的追加，HTML就准备好了。
- en: '[PRE27]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Remember, what you're doing is creating your own web page within the application.
    If you want to include stylesheets, you can. If you want to include JavaScript,
    you can; the only caveat is that you can use mobile Safari, which has JavaScript
    enabled.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，你正在在应用程序内部创建自己的网页。如果你想包含样式表，你可以；如果你想包含JavaScript，你也可以；唯一的限制是你可以使用启用JavaScript的移动Safari。
- en: Multimedia
  id: totrans-142
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 多媒体
- en: This is a very vast topic. Thankfully, using a camera has been covered at the
    start of this chapter. Just about everything you need is inside the `MonoTouch.MediaPlayer`
    namespace. As with using a camera, it is important that you first check that the
    device has video capabilities in exactly the same way as you do for a camera (in
    fact, it uses the same `IsSourceTypeAvailable(myCamera)` command as used for a
    camera).
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个非常广泛的话题。幸运的是，使用相机的部分已经在本章的开头进行了介绍。几乎你需要的一切都在`MonoTouch.MediaPlayer`命名空间内。就像使用相机一样，首先检查设备是否具有视频功能是非常重要的，方式与检查相机完全相同（实际上，它使用与相机相同的`IsSourceTypeAvailable(myCamera)`命令）。
- en: Playing a video
  id: totrans-144
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 播放视频
- en: As with `webView`, a video can be external to the device or internal; if it
    is internal, it could be part of the bundle (not a good idea as video takes up
    a lot of space on a device, which will result in long download times), or within
    the `My Document` area (downloaded), or in the photo reel.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 与`webView`一样，视频可以是设备外部的或内部的；如果是内部的，它可能是捆绑包的一部分（这不是一个好主意，因为视频会占用设备大量空间，从而导致下载时间过长），或者位于`My
    Document`区域（已下载）中，或者在照片胶卷中。
- en: External URL
  id: totrans-146
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 外部URL
- en: The video that I'll use here is on YouTube (you can choose any video of your
    choice).
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 我在这里要使用的是YouTube上的视频（你可以选择任何你喜欢的视频）。
- en: '[PRE28]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Internal source
  id: totrans-149
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 内部源
- en: 'Playing from an internal source can be performed in a way similar to that of
    an external video file:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 从内部源播放视频可以以类似于外部视频文件的方式执行：
- en: '[PRE29]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: From the photo library
  id: totrans-152
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 从照片库
- en: Choosing a video from the camera roll is performed in much the same way as picking
    an image from the photo library.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 从相册中选择视频的方式与从照片库中选择图片的方式几乎相同。
- en: '[PRE30]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: The preceding code goes through the photo library looking for any file that
    returns the `public.movie` type. If found, the file is added to the array and
    can be seen via the delegate.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码遍历照片库，寻找任何返回`public.movie`类型的文件。如果找到，该文件将被添加到数组中，并且可以通过代理看到。
- en: Recording a video
  id: totrans-156
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 录制视频
- en: This is not substantially different from taking a picture, except that you have
    a few additional parameters that can be altered, such as `VideoQuality` and `AllowEditing`.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 这与拍照并没有实质性的区别，只是你有一些可以调整的额外参数，例如`VideoQuality`和`AllowEditing`。
- en: To record a video
  id: totrans-158
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 要录制视频
- en: 'Recording a video is a simple task as the following code demonstrates:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 录制视频是一个简单的任务，如下面的代码所示：
- en: '[PRE31]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'In the preceding example, `AllowEditing` has been set to `true`, which means
    that the user may edit this video. If that is the intention, editing should be
    performed using `UIVideoEditorController`. This controller allows for three events:
    `Failed` (the edit failed for some reason), `UserCancelled` (speaks for itself),
    and `Saved` (the user has selected to save the edit; the path is returned in the
    `e.Path` event).'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
- en: Saving the video
  id: totrans-162
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Once the video has been processed, the next step is to save the video:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE32]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: The audio system
  id: totrans-165
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The iPhone and iPad range of devices is blessed (as are most Apple devices)
    with a fantastic audio system that allows for great playback quality and the ability
    to record as well. These facilities are available through the `AVAudioPlayer`
    class or `SystemSound`. If the file is held within the application bundle, it
    must be set to `Content` when building the app.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
- en: Playback
  id: totrans-167
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Audio playback can be considered short or long if it is under or over the 30
    seconds mark. In general, `SystemSound` is best used for audio files with a duration
    of less than 30 seconds and also for uncompressed audio formats, such as `.wav`
    and `.caf` (**Core Audio File**). MP3 files are not supported in `SystemSound`.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
- en: Short files
  id: totrans-169
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: The `SystemSound` method is a quick and easy way to play an audio file with
    very little overhead.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE33]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: If you need an audio file to play but you are at some place requiring silence
    (say, a library), the device can be made to vibrate through the length of the
    file.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE34]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Long (and compressed) files
  id: totrans-174
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Here the `AVAudioPlayer` class comes into its own, allowing you to alter power
    levels (the volume on a channel) effectively, pause, play, and stop an audio file.
    It also handles compressed audio formats, such as MP3.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
- en: Setting the power levels
  id: totrans-176
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Prior to setting a power level, either or both the `AveragePower` and `PeakPower.MeteringEnabled`
    Booleans have to be set to `true` and a method named `UpdateMeters()` must be
    called. It is then just a case of setting `AveragePower(uint)` or `PeakPower(uint)`
    to the value you want (in dBs).
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
- en: Playing the audio file
  id: totrans-178
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'It is not difficult to play an audio file; select the file and tell the device
    to play. The following code demonstrates how:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE35]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: Altering the volume
  id: totrans-181
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'If you don''t want Beethoven''s ninth blasting out of your iOS device, it''s
    a good idea to turn down the volume as follows:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE36]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'A word of caution, though, for setting a volume level: *don''t set it to zero*.
    This annoys the iOS device and will then annoy the user as the device will take
    great pleasure in reminding you that the volume is set to `0`. As the figure is
    a float value, `0.01` will do just as well as `0` to mute the device.'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
- en: Recording Audio
  id: totrans-185
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Recording is not as simple as playing. While a lot of the work is done by the
    `AVAudioRecorder` class, quite a bit of work also has to be done by the programmer
    to record the audio. The key point to remember is that `NSDictionary` needs to
    be set up before anything can happen. This dictionary contains important information,
    such as the type of audio, sample rate, quality, and so on.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 录音并不像播放那样简单。虽然 `AVAudioRecorder` 类做了很多工作，但程序员也需要做大量工作来录制音频。关键点是要记住，在发生任何操作之前，必须设置
    `NSDictionary`。这个字典包含重要信息，例如音频类型、采样率、质量等。
- en: Setting up the audio NSDictionary
  id: totrans-187
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置音频 `NSDictionary`
- en: The `NSDictionary` (along with anything else that starts with `NS`) is an interface
    to the `Objective-C` bindings that `Xamarin.iOS` utilizes to allow development
    with the .NET framework on iOS and, as such, can't be set up like a normal dictionary.
    To get around that obstacle, a generic `NSObject` object can be used, one for
    the settings, the other for the description (which works out to be the same as
    the values and keys in .NET).
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: '`NSDictionary`（以及以 `NS` 开头的任何其他内容）是 `Xamarin.iOS` 利用 `Objective-C` 绑定来允许在 iOS
    上使用 .NET 框架进行开发的接口。因此，它不能像普通字典那样设置。为了克服这个障碍，可以使用一个通用的 `NSObject` 对象，一个用于设置，另一个用于描述（这相当于
    .NET 中的值和键）。'
- en: '[PRE37]'
  id: totrans-189
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: Setting up to record
  id: totrans-190
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 准备录音
- en: The next step is to set up the recorder itself and, importantly, the location
    to save the audio file to.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是设置录音器本身以及保存音频文件的位置。
- en: '[PRE38]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: Recording the audio file
  id: totrans-193
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 录制音频文件
- en: Finally, it's time to record. As the file records, it's also saved to the device.
    Once finished with recording, the recorder object needs to be disposed. Thankfully,
    we can control how long a recording goes on by using the `RecordFor("float time")`
    method.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，是时候开始录音了。当文件正在记录时，它也会保存在设备上。录音完成后，需要销毁录音器对象。幸运的是，我们可以通过使用 `RecordFor("float
    time")` 方法来控制录音的时长。
- en: '[PRE39]'
  id: totrans-195
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: Summary
  id: totrans-196
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: It is simple enough to use the subsystems that the iOS devices make use of,
    as long as you remember the limitations, such as only being able to send texts
    and not receive. The devices offer far more than what the average user sees and
    it only requires a small amount of imagination to see how to create a really good
    application using the facilities offered to you; from maps to web views to making
    calls, it's all there for you. Now play!
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 iOS 设备提供的子系统非常简单，只要记住限制条件，例如只能发送文本而不能接收。设备提供的功能远超普通用户所见，只需稍加想象就能看到如何利用这些功能创建真正优秀的应用程序；从地图到网页视图再到拨打电话，一切都在你的掌控之中。现在，开始吧！
