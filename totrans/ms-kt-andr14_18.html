<html><head></head><body>
<div id="_idContainer243" class="calibre2">
<h1 class="chapter-number" id="_idParaDest-168"><a id="_idTextAnchor198" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.1.1">14</span></h1>
<h1 id="_idParaDest-169" class="calibre6"><a id="_idTextAnchor199" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.2.1">Continuous Integration and Continuous Deployment</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.3.1">After we complete the development and first deployment of our app, we must think of how to </span><a id="_idIndexMarker722" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.4.1">make the process smoother for consecutive deployments, and that’s where </span><strong class="bold"><span class="kobospan" id="kobo.5.1">Continuous integration/Continuous delivery</span></strong><span class="kobospan" id="kobo.6.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.7.1">CI/CD</span></strong><span class="kobospan" id="kobo.8.1">) </span><span><span class="kobospan" id="kobo.9.1">comes in.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.10.1">In this chapter, we will learn how to use GitHub Actions to automate some of the manual tasks, such as deploying new builds to the Google Play Store. </span><span class="kobospan" id="kobo.10.2">We will learn how to run tests on CI/CD pipelines and push builds to the Play Store using </span><span><span class="kobospan" id="kobo.11.1">GitHub Actions.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.12.1">In this chapter, we’re going to cover the following </span><span><span class="kobospan" id="kobo.13.1">main topics:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.14.1">Setting up </span><span><span class="kobospan" id="kobo.15.1">GitHub Actions</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.16.1">Running lint checks and tests on </span><span><span class="kobospan" id="kobo.17.1">GitHub Actions</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.18.1">Deploying to Play Store using </span><span><span class="kobospan" id="kobo.19.1">GitHub Actions</span></span></li>
</ul>
<h1 id="_idParaDest-170" class="calibre6"><a id="_idTextAnchor200" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.20.1">Technical requirements</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.21.1">To follow the instructions in this chapter, you will need to have Android Studio Hedgehog or later (</span><a href="https://developer.android.com/studio" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.22.1">https://developer.android.com/studio</span></span></a><span><span class="kobospan" id="kobo.23.1">) </span></span><span><span class="kobospan" id="kobo.24.1">downloaded</span></span><span><span class="kobospan" id="kobo.25.1">.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.26.1">You can use the previous chapter’s code to follow the instructions in this chapter. </span><span class="kobospan" id="kobo.26.2">You can find the code for this chapter </span><span><span class="kobospan" id="kobo.27.1">at </span></span><a href="https://github.com/PacktPublishing/Mastering-Kotlin-for-Android/tree/main/chapterfourteen" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.28.1">https://github.com/PacktPublishing/Mastering-Kotlin-for-Android/tree/main/chapterfourteen</span></span></a><span><span class="kobospan" id="kobo.29.1">.</span></span></p>
<h1 id="_idParaDest-171" class="calibre6"><a id="_idTextAnchor201" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.30.1">Setting up GitHub Actions</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.31.1">Before we </span><a id="_idIndexMarker723" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.32.1">can understand GitHub Actions, we need to understand what CI/CD is. </span><span class="kobospan" id="kobo.32.2">This is a process that allows us to automate the building, testing, and deployment of our code to production. </span><span class="kobospan" id="kobo.32.3">CI/CD not only automates these processes but also integrates them into a single coherent pipeline. </span><span class="kobospan" id="kobo.32.4">This ensures that code changes are more reliable and stable when deployed. </span><span class="kobospan" id="kobo.32.5">The definition should emphasize the role of CI/CD in facilitating frequent and reliable updates. </span><span class="kobospan" id="kobo.32.6">This is an especially </span><a id="_idIndexMarker724" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.33.1">important process as it aims to improve the speed, efficiency, and reliability of how we deliver </span><span><span class="kobospan" id="kobo.34.1">our software.</span></span></p>
<h2 id="_idParaDest-172" class="calibre7"><a id="_idTextAnchor202" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.35.1">Benefits of CI/CD</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.36.1">Let’s go </span><a id="_idIndexMarker725" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.37.1">through some of the benefits </span><span><span class="kobospan" id="kobo.38.1">of CI/CD:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.39.1">Fast release cycles</span></strong><span class="kobospan" id="kobo.40.1">: CI/CD allows us to release our software faster and more frequently. </span><span class="kobospan" id="kobo.40.2">This is because we are automating the process of building, testing, and deploying </span><span><span class="kobospan" id="kobo.41.1">our code.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.42.1">Increased collaboration</span></strong><span class="kobospan" id="kobo.43.1">: Since a lot of the processes are automated, we can focus on the code and the features we are building. </span><span class="kobospan" id="kobo.43.2">This allows us to collaborate more effectively with </span><span><span class="kobospan" id="kobo.44.1">our team.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.45.1">Less manual work</span></strong><span class="kobospan" id="kobo.46.1">: We are reducing the amount of manual work we do due to automation. </span><span class="kobospan" id="kobo.46.2">This means we can focus on the code and the features we </span><span><span class="kobospan" id="kobo.47.1">are building.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.48.1">Improved quality</span></strong><span class="kobospan" id="kobo.49.1">: Automating the process allows us to test our code more frequently and more effectively. </span><span class="kobospan" id="kobo.49.2">This means we can catch bugs and errors earlier in </span><span><span class="kobospan" id="kobo.50.1">the process.</span></span></li>
</ul>
<p class="calibre4"><span class="kobospan" id="kobo.51.1">Now we have learned about the benefits of CI/CD, let us look at how CI/CD works </span><span><span class="kobospan" id="kobo.52.1">in detail.</span></span></p>
<h2 id="_idParaDest-173" class="calibre7"><a id="_idTextAnchor203" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.53.1">How CI/CD works</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.54.1">Let us </span><a id="_idIndexMarker726" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.55.1">go through how </span><span><span class="kobospan" id="kobo.56.1">CI/CD works:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.57.1">CI</span></strong><span class="kobospan" id="kobo.58.1">: This is the </span><a id="_idIndexMarker727" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.59.1">process of automating the building and testing of our code. </span><span class="kobospan" id="kobo.59.2">This is done every time we push our code to our repository. </span><span class="kobospan" id="kobo.59.3">This allows us to catch bugs and errors earlier in the process. </span><span class="kobospan" id="kobo.59.4">In this step, once we push or commit code to our remote repository, which can be hosted in GitHub, Gitlab, Bitbucket, and so on, we run checks and tests against these changes to ensure they are functional and meet the code quality standards. </span><span class="kobospan" id="kobo.59.5">If the </span><a id="_idIndexMarker728" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.60.1">tests pass, we can merge the code into the main branch. </span><span class="kobospan" id="kobo.60.2">If the tests fail, we can fix the code and run the </span><span><span class="kobospan" id="kobo.61.1">tests again.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.62.1">CD</span></strong><span class="kobospan" id="kobo.63.1">: This is the process of automating the deployment of our code to production. </span><span class="kobospan" id="kobo.63.2">This is done every time we push our code to our repository. </span><span class="kobospan" id="kobo.63.3">This allows us </span><a id="_idIndexMarker729" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.64.1">to release our software faster and more frequently. </span><span class="kobospan" id="kobo.64.2">This happens after the CI step. </span><span class="kobospan" id="kobo.64.3">Once the changes are merged to the main or development branch, we can deploy the code to production or whichever environment it needs to be deployed to. </span><span class="kobospan" id="kobo.64.4">This step aims at pushing minor changes to production more frequently. </span><span class="kobospan" id="kobo.64.5">This allows us to release our software faster and </span><span><span class="kobospan" id="kobo.65.1">more frequently.</span></span></li>
</ul>
<p class="calibre4"><span class="kobospan" id="kobo.66.1">With this </span><a id="_idIndexMarker730" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.67.1">background, we can now look at GitHub Actions (</span><a href="https://docs.github.com/en/actions" class="calibre3 pcalibre pcalibre1"><span class="kobospan" id="kobo.68.1">https://docs.github.com/en/actions</span></a><span class="kobospan" id="kobo.69.1">). </span><span class="kobospan" id="kobo.69.2">GitHub Actions is a CI/CD tool that allows us to automate the building, testing, and deployment of our code. </span><span class="kobospan" id="kobo.69.3">It is built into GitHub and is free to use up to certain limits. </span><span class="kobospan" id="kobo.69.4">It is also extremely easy to use and </span><span><span class="kobospan" id="kobo.70.1">set up.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.71.1">In the next section, we are going to set up GitHub Actions for our project that is in this </span><span><span class="kobospan" id="kobo.72.1">repository: </span></span><a href="https://github.com/PacktPublishing/Mastering-Kotlin-for-Android" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.73.1">https://github.com/PacktPublishing/Mastering-Kotlin-for-Android</span></span></a></p>
<h2 id="_idParaDest-174" class="calibre7"><a id="_idTextAnchor204" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.74.1">Setting up GitHub Actions</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.75.1">To enable </span><a id="_idIndexMarker731" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.76.1">GitHub Actions in our project, follow </span><span><span class="kobospan" id="kobo.77.1">these steps:</span></span></p>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.78.1">Go to the </span><strong class="bold"><span class="kobospan" id="kobo.79.1">Actions</span></strong><span class="kobospan" id="kobo.80.1"> tab of our repository, as shown in the </span><span><span class="kobospan" id="kobo.81.1">following screenshot:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer231">
<span class="kobospan" id="kobo.82.1"><img alt="Figure 14.1 – GitHub Actions tab" src="image/B19779_14_01.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.83.1">Figure 14.1 – GitHub Actions tab</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.84.1">This step will bring us to the GitHub Actions </span><span><span class="kobospan" id="kobo.85.1">landing page:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer232">
<span class="kobospan" id="kobo.86.1"><img alt="Figure 14.2 – GitHub Actions landing page" src="image/B19779_14_02.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.87.1">Figure 14.2 – GitHub Actions landing page</span></p>
<ol class="calibre14">
<li value="2" class="calibre15"><span class="kobospan" id="kobo.88.1">As seen </span><a id="_idIndexMarker732" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.89.1">in the preceding image, we have some suggested actions that we can use in our repository. </span><span class="kobospan" id="kobo.89.2">For now, we will set the actions by ourselves, so let us click on the </span><strong class="bold"><span class="kobospan" id="kobo.90.1">set up a workflow yourself</span></strong><span class="kobospan" id="kobo.91.1"> option. </span><span class="kobospan" id="kobo.91.2">This brings us to the </span><span><span class="kobospan" id="kobo.92.1">following page:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer233">
<span class="kobospan" id="kobo.93.1"><img alt="Figure 14.3 – New GitHub Action" src="image/B19779_14_03.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.94.1">Figure 14.3 – New GitHub Action</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.95.1">As you can </span><a id="_idIndexMarker733" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.96.1">see in the preceding image, we have an editor for writing our workflow. </span><span class="kobospan" id="kobo.96.2">Notice at the top we now have a new folder called </span><strong class="source-inline"><span class="kobospan" id="kobo.97.1">.github</span></strong><span class="kobospan" id="kobo.98.1">. </span><span class="kobospan" id="kobo.98.2">This is where we will store our workflow files. </span><span class="kobospan" id="kobo.98.3">The editor saves the workflow file in the </span><strong class="source-inline"><span class="kobospan" id="kobo.99.1">.github/workflows</span></strong><span class="kobospan" id="kobo.100.1"> folder. </span><span class="kobospan" id="kobo.100.2">By default, our workflow is named </span><strong class="source-inline"><span class="kobospan" id="kobo.101.1">main.yml</span></strong><span class="kobospan" id="kobo.102.1">. </span><span class="kobospan" id="kobo.102.2">On the right, we have templates that we can use to easily create </span><span><span class="kobospan" id="kobo.103.1">our workflow.</span></span></p>
<ol class="calibre14">
<li value="3" class="calibre15"><span class="kobospan" id="kobo.104.1">For now, we are going to create our own workflow, so let us add the following code to </span><span><span class="kobospan" id="kobo.105.1">our workflow:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.106.1">
name: Push
on:
  push:
    branches: ["main" ]
  workflow_dispatch:
jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
        - run: echo "The job was automatically triggered by a ${{ github.event_name }} event."</span></pre><p class="calibre4"><span class="kobospan" id="kobo.107.1">Let’s understand </span><a id="_idIndexMarker734" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.108.1">the different fields in the preceding </span><span><span class="kobospan" id="kobo.109.1">workflow file:</span></span></p><ul class="calibre17"><li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.110.1">name</span></strong><span class="kobospan" id="kobo.111.1">: This is the name of our workflow. </span><span class="kobospan" id="kobo.111.2">This will be displayed on the GitHub </span><span><span class="kobospan" id="kobo.112.1">Actions page.</span></span></li><li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.113.1">on</span></strong><span class="kobospan" id="kobo.114.1">: This is the event that will trigger our workflow. </span><span class="kobospan" id="kobo.114.2">In our case, we are triggering our workflow when we push code to the </span><span><span class="kobospan" id="kobo.115.1">main branch.</span></span></li><li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.116.1">workflow_dispatch</span></strong><span class="kobospan" id="kobo.117.1">: This is a manual trigger that we can use to trigger our workflow from the GitHub Actions page. </span><span class="kobospan" id="kobo.117.2">This is useful when we want to trigger our </span><span><span class="kobospan" id="kobo.118.1">workflow manually.</span></span></li><li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.119.1">jobs</span></strong><span class="kobospan" id="kobo.120.1">: This is the job that will be run when our workflow is triggered. </span><span class="kobospan" id="kobo.120.2">In our case, we have a job called </span><strong class="source-inline1"><span class="kobospan" id="kobo.121.1">build</span></strong><span class="kobospan" id="kobo.122.1">. </span><span class="kobospan" id="kobo.122.2">This job will run on the latest version of Ubuntu as specified by the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.123.1">runs-on</span></strong></span><span><span class="kobospan" id="kobo.124.1"> field.</span></span></li><li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.125.1">steps</span></strong><span class="kobospan" id="kobo.126.1">: This field contains the steps that will be run in our job. </span><span class="kobospan" id="kobo.126.2">In our case, we have a single step that will run a command. </span><span class="kobospan" id="kobo.126.3">This command will print out the event that triggered our workflow. </span><span class="kobospan" id="kobo.126.4">A step can contain a shell command or an action from </span><span><span class="kobospan" id="kobo.127.1">GitHub Marketplace.</span></span></li></ul></li> <li class="calibre15"><span class="kobospan" id="kobo.128.1">Click on the </span><strong class="bold"><span class="kobospan" id="kobo.129.1">Commit changes...</span></strong><span class="kobospan" id="kobo.130.1"> button. </span><span class="kobospan" id="kobo.130.2">This will commit our workflow file to our repository and trigger our workflow. </span><span class="kobospan" id="kobo.130.3">We can see the workflow running in the </span><strong class="bold"><span class="kobospan" id="kobo.131.1">Actions</span></strong><span class="kobospan" id="kobo.132.1"> tab, as shown in the </span><span><span class="kobospan" id="kobo.133.1">following screenshot:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer234">
<span class="kobospan" id="kobo.134.1"><img alt="Figure 14.4 – First GitHub Action" src="image/B19779_14_04.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.135.1">Figure 14.4 – First GitHub Action</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.136.1">In the preceding image, we can see the commit that triggered the workflow and the workflow itself. </span><span class="kobospan" id="kobo.136.2">We can also see the job that was run and the step that was run. </span><span class="kobospan" id="kobo.136.3">We can </span><a id="_idIndexMarker735" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.137.1">also see the output of the step. </span><span class="kobospan" id="kobo.137.2">Additionally, we can see the time it took to run the workflow. </span><span class="kobospan" id="kobo.137.3">If we tap the action, we can see </span><span><span class="kobospan" id="kobo.138.1">more details:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer235">
<span class="kobospan" id="kobo.139.1"><img alt="Figure 14.5 – Github Action details" src="image/B19779_14_05.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.140.1">Figure 14.5 – Github Action details</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.141.1">This shows the steps that were run and the time the job took to run. </span><span class="kobospan" id="kobo.141.2">It also shows the total duration of </span><span><span class="kobospan" id="kobo.142.1">the workflow.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.143.1">This was a simple workflow that just printed out the event that triggered the workflow. </span><span class="kobospan" id="kobo.143.2">We can also do more complex things in </span><span><span class="kobospan" id="kobo.144.1">our workflow.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.145.1">Let us see how we can set up Android-related actions in </span><span><span class="kobospan" id="kobo.146.1">our workflow:</span></span></p>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.147.1">Head to the newly created </span><strong class="source-inline1"><span class="kobospan" id="kobo.148.1">.github/workflows</span></strong><span class="kobospan" id="kobo.149.1"> folder and edit the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.150.1">main.yml</span></strong></span><span><span class="kobospan" id="kobo.151.1"> file.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.152.1">Let us add the following code to our workflow below the previous command we ran in </span><em class="italic"><span class="kobospan" id="kobo.153.1">step 3 </span></em><span class="kobospan" id="kobo.154.1">of the </span><span><span class="kobospan" id="kobo.155.1">previous section:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.156.1">
- name: Checkout
  uses: actions/checkout@v3
- name: Set up JDK 17
  uses: actions/setup-java@v3
  with:
    java-version: '17'
    distribution: 'zulu'
    cache: gradle
- name: Grant execute permission for gradlew
  run: chmod +x gradlew
  working-directory: ./chapterfourteen
- name: Build with Gradle
  run: ./gradlew assembleDebug
  working-directory: ./chapterfourteen</span></pre><p class="calibre4"><span class="kobospan" id="kobo.157.1">Let us </span><a id="_idIndexMarker736" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.158.1">understand the </span><span><span class="kobospan" id="kobo.159.1">preceding code:</span></span></p><ul class="calibre17"><li class="calibre15"><span class="kobospan" id="kobo.160.1">We have created another step called </span><strong class="source-inline1"><span class="kobospan" id="kobo.161.1">Checkout</span></strong><span class="kobospan" id="kobo.162.1">. </span><span class="kobospan" id="kobo.162.2">This step will </span><strong class="source-inline1"><span class="kobospan" id="kobo.163.1">checkout</span></strong><span class="kobospan" id="kobo.164.1"> our code from our repository. </span><span class="kobospan" id="kobo.164.2">This is done using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.165.1">checkout</span></strong><span class="kobospan" id="kobo.166.1"> action, which we specify using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.167.1">uses</span></strong><span class="kobospan" id="kobo.168.1"> field. </span><span class="kobospan" id="kobo.168.2">This action is fetched from </span><span><span class="kobospan" id="kobo.169.1">GitHub Marketplace.</span></span></li><li class="calibre15"><span class="kobospan" id="kobo.170.1">We have </span><a id="_idIndexMarker737" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.171.1">created another step called </span><strong class="source-inline1"><span class="kobospan" id="kobo.172.1">Set up JDK 17</span></strong><span class="kobospan" id="kobo.173.1">. </span><span class="kobospan" id="kobo.173.2">This step will set up JDK 17. </span><strong class="bold"><span class="kobospan" id="kobo.174.1">Java Development Kit</span></strong><span class="kobospan" id="kobo.175.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.176.1">JDK</span></strong><span class="kobospan" id="kobo.177.1">) is a development environment for building applications and components using the Java programming language. </span><span class="kobospan" id="kobo.177.2">17 is the version of JDK that we use. </span><span class="kobospan" id="kobo.177.3">We </span><a id="_idIndexMarker738" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.178.1">use this version since the </span><strong class="bold"><span class="kobospan" id="kobo.179.1">Android Gradle Plugin</span></strong><span class="kobospan" id="kobo.180.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.181.1">AGP</span></strong><span class="kobospan" id="kobo.182.1">) from version 8.0.0 requires JDK 17 to work. </span><span class="kobospan" id="kobo.182.2">Our project runs on </span><span><span class="kobospan" id="kobo.183.1">AGP 8.2.1.</span></span></li><li class="calibre15"><span class="kobospan" id="kobo.184.1">This is done using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.185.1">setup-java</span></strong><span class="kobospan" id="kobo.186.1"> action, which we specify using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.187.1">uses</span></strong><span class="kobospan" id="kobo.188.1"> field. </span><span class="kobospan" id="kobo.188.2">We specify the version of Java we want to use using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.189.1">java-version</span></strong><span class="kobospan" id="kobo.190.1"> field. </span><span class="kobospan" id="kobo.190.2">We specify the distribution of Java we want to use using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.191.1">distribution</span></strong><span class="kobospan" id="kobo.192.1"> field. </span><span class="kobospan" id="kobo.192.2">We also specify that we want to cache Gradle using the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.193.1">cache</span></strong></span><span><span class="kobospan" id="kobo.194.1"> field.</span></span></li><li class="calibre15"><span class="kobospan" id="kobo.195.1">We have </span><a id="_idIndexMarker739" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.196.1">created another step called </span><strong class="source-inline1"><span class="kobospan" id="kobo.197.1">Grant execute permission for gradlew</span></strong><span class="kobospan" id="kobo.198.1">. </span><span class="kobospan" id="kobo.198.2">This step will grant execute permission for gradlew. </span><span class="kobospan" id="kobo.198.3">This is done using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.199.1">run</span></strong><span class="kobospan" id="kobo.200.1"> command. </span><span class="kobospan" id="kobo.200.2">We specify the command we want to run using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.201.1">run</span></strong><span class="kobospan" id="kobo.202.1"> field. </span><span class="kobospan" id="kobo.202.2">We also specify the working directory we want to run the command in using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.203.1">working-directory</span></strong><span class="kobospan" id="kobo.204.1"> field. </span><span class="kobospan" id="kobo.204.2">In this case, we want to run the command in the </span><strong class="source-inline1"><span class="kobospan" id="kobo.205.1">chapterfourteen</span></strong><span class="kobospan" id="kobo.206.1"> folder since we have a number of folders in our repository. </span><span class="kobospan" id="kobo.206.2">Note that this step is platform-dependent since it is only necessary for Unix-based systems but might be redundant for Windows-based systems. </span><span class="kobospan" id="kobo.206.3">Therefore, it may not be required in all </span><span><span class="kobospan" id="kobo.207.1">CI/CD setups.</span></span></li><li class="calibre15"><span class="kobospan" id="kobo.208.1">Lastly, we have created another step called </span><strong class="source-inline1"><span class="kobospan" id="kobo.209.1">Build with Gradle</span></strong><span class="kobospan" id="kobo.210.1">. </span><span class="kobospan" id="kobo.210.2">This step will build our project using Gradle. </span><a id="_idTextAnchor205" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.211.1">Here, we run the </span><strong class="source-inline1"><span class="kobospan" id="kobo.212.1">./gradlew assembleDebug</span></strong><span class="kobospan" id="kobo.213.1"> command. </span><span class="kobospan" id="kobo.213.2">This command generates a debug Android APK for our project. </span><span class="kobospan" id="kobo.213.3">We also specify the working directory in which we want to run </span><span><span class="kobospan" id="kobo.214.1">the command.</span></span></li></ul><p class="calibre4"><span class="kobospan" id="kobo.215.1">One thing to note is that </span><strong class="source-inline"><span class="kobospan" id="kobo.216.1">.yml</span></strong><span class="kobospan" id="kobo.217.1"> files are overly sensitive to indentation. </span><span class="kobospan" id="kobo.217.2">So, we need to ensure that we indent our </span><span><span class="kobospan" id="kobo.218.1">code correctly.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.219.1">Commit to the changes and the action will automatically run. </span><span class="kobospan" id="kobo.219.2">We can see the workflow results and, looking at the job build, we can see all the steps that were run, as shown in the </span><span><span class="kobospan" id="kobo.220.1">following screenshot:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer236">
<span class="kobospan" id="kobo.221.1"><img alt="Figure 14.6 – GitHub Action steps" src="image/B19779_14_06.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.222.1">Figure 14.6 – GitHub Action steps</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.223.1">We now know </span><a id="_idIndexMarker740" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.224.1">what GitHub Actions are, have created our first action, and have seen how we can run Android-specific workflows on GitHub Actions. </span><span class="kobospan" id="kobo.224.2">In the next section, we will run lint checks and tests in </span><span><span class="kobospan" id="kobo.225.1">our workflow.</span></span></p>
<h1 id="_idParaDest-175" class="calibre6"><a id="_idTextAnchor206" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.226.1">Running lint checks and tests on GitHub Actions</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.227.1">In </span><a href="B19779_11.xhtml#_idTextAnchor135" class="calibre3 pcalibre pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.228.1">Chapter 11</span></em></span></a><span class="kobospan" id="kobo.229.1">, we learned how to run lint checks on our project using shell commands on the terminal. </span><span class="kobospan" id="kobo.229.2">We have </span><a id="_idIndexMarker741" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.230.1">also learned how to write tests for our code </span><a id="_idIndexMarker742" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.231.1">base. </span><span class="kobospan" id="kobo.231.2">In this section, we are going to run the format, lint checks, and tests on our newly created actions and we will do all of this step </span><span><span class="kobospan" id="kobo.232.1">by step:</span></span></p>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.233.1">First, we will add the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.234.1">ktlintCheck</span></strong></span><span><span class="kobospan" id="kobo.235.1"> step:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.236.1">
- name: Run ktlintCheck
  run: ./gradlew</span><a id="_idTextAnchor207" class="calibre19 pcalibre pcalibre1"/><span class="kobospan1" id="kobo.237.1"> ktlintCheck
  working-directory: ./chapterfourteen</span></pre><p class="calibre4"><span class="kobospan" id="kobo.238.1">In this code, we have added a step called </span><strong class="source-inline"><span class="kobospan" id="kobo.239.1">Run ktlintCheck</span></strong><span class="kobospan" id="kobo.240.1">. </span><span class="kobospan" id="kobo.240.2">This step will run the </span><strong class="source-inline"><span class="kobospan" id="kobo.241.1">ktlintCheck</span></strong><span class="kobospan" id="kobo.242.1"> command, which will check whether our code is formatted correctly. </span><span class="kobospan" id="kobo.242.2">This step fails if our code is not </span><span><span class="kobospan" id="kobo.243.1">formatted correctly.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.244.1">Next, we add the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.245.1">detekt</span></strong></span><span><span class="kobospan" id="kobo.246.1"> step:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.247.1">
- name: Run detekt
  run: ./gradlew detekt
  working-directory: ./chapterfourteen</span></pre><p class="calibre4"><span class="kobospan" id="kobo.248.1">In this step, we run the </span><strong class="source-inline"><span class="kobospan" id="kobo.249.1">detekt</span></strong><span class="kobospan" id="kobo.250.1"> command, which will run the detekt checks on the code that we set up earlier in </span><a href="B19779_11.xhtml#_idTextAnchor135" class="calibre3 pcalibre pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.251.1">Chapter 11</span></em></span></a><span class="kobospan" id="kobo.252.1">. </span><span class="kobospan" id="kobo.252.2">This step fails if our code does not pass the </span><span><span class="kobospan" id="kobo.253.1">detekt checks.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.254.1">Next, we add the </span><span><span class="kobospan" id="kobo.255.1">test step:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.256.1">
- name: Run unit tests
  run: ./gradlew testDebugUnitTest
  working-directory: ./chapterfourteen</span></pre><p class="calibre4"><span class="kobospan" id="kobo.257.1">This step </span><a id="_idIndexMarker743" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.258.1">will run all the unit tests in our project. </span><span class="kobospan" id="kobo.258.2">This step </span><a id="_idIndexMarker744" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.259.1">fails if any of the </span><span><span class="kobospan" id="kobo.260.1">tests fail.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.261.1">Lastly, we add the step to run our </span><span><span class="kobospan" id="kobo.262.1">instrumented tests:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.263.1">
- name: Run connected tests
  uses: ReactiveCircus/android-emulator-runner@v2
  with:
    working-directory: ./chapterfourteen
    api-level: 33
    target: google_apis
    arch: x86_64
    disable-animations: true
    script: ./gradlew connectedCheck</span></pre><p class="calibre4"><span class="kobospan" id="kobo.264.1">This step uses the </span><strong class="source-inline"><span class="kobospan" id="kobo.265.1">android-emulator-runner</span></strong><span class="kobospan" id="kobo.266.1"> action to run our instrumented tests on an emulator. </span><span class="kobospan" id="kobo.266.2">This action sets up an emulator to run our instrumented tests in the CI environment. </span><span class="kobospan" id="kobo.266.3">In the action configuration, we set up </span><span><span class="kobospan" id="kobo.267.1">the following:</span></span></p><ul class="calibre17"><li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.268.1">working-directory</span></strong><span class="kobospan" id="kobo.269.1">: This is where our project </span><span><span class="kobospan" id="kobo.270.1">is located.</span></span></li><li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.271.1">api-level</span></strong><span class="kobospan" id="kobo.272.1">: This is the API level of the platform system image for </span><span><span class="kobospan" id="kobo.273.1">our emulator.</span></span></li><li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.274.1">target</span></strong><span class="kobospan" id="kobo.275.1">: This is the target for the system image of </span><span><span class="kobospan" id="kobo.276.1">the emulator.</span></span></li><li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.277.1">architecture</span></strong><span class="kobospan" id="kobo.278.1">: We specify the architecture of the emulator we want to run our </span><span><span class="kobospan" id="kobo.279.1">tests on.</span></span></li><li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.280.1">disable-animations</span></strong><span class="kobospan" id="kobo.281.1">: We disable animations in </span><span><span class="kobospan" id="kobo.282.1">the emulator.</span></span></li><li class="calibre15"><span class="kobospan" id="kobo.283.1">Lastly, we specify the command we want to run using the script field. </span><span class="kobospan" id="kobo.283.2">In this case, we run the </span><strong class="source-inline1"><span class="kobospan" id="kobo.284.1">connectedCheck</span></strong><span class="kobospan" id="kobo.285.1"> task, which will run our </span><span><span class="kobospan" id="kobo.286.1">instrumented tests.</span></span></li></ul></li> <li class="calibre15"><span class="kobospan" id="kobo.287.1">After making </span><a id="_idIndexMarker745" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.288.1">the p</span><a id="_idTextAnchor208" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.289.1">receding changes, commit the changes </span><a id="_idIndexMarker746" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.290.1">and the action will run. </span><span class="kobospan" id="kobo.290.2">We can see the results of the action in the </span><strong class="bold"><span class="kobospan" id="kobo.291.1">Actions</span></strong><span class="kobospan" id="kobo.292.1"> tab, as shown in the </span><span><span class="kobospan" id="kobo.293.1">following screenshot:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer237">
<span class="kobospan" id="kobo.294.1"><img alt="Figure 14.7 – More Github Actions steps" src="image/B19779_14_07.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.295.1">Figure 14.7 – More Github Actions steps</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.296.1">We’ve expanded our workflow by incorporating additional steps to perform lint checks and tests. </span><span class="kobospan" id="kobo.296.2">We can see the results of each step. </span><span class="kobospan" id="kobo.296.3">We can also see the time it took to run each step. </span><span class="kobospan" id="kobo.296.4">The </span><strong class="source-inline"><span class="kobospan" id="kobo.297.1">Run connected test</span></strong><span class="kobospan" id="kobo.298.1"> step takes the longest time to run. </span><span class="kobospan" id="kobo.298.2">This is because it must set up the emulator and run </span><span><span class="kobospan" id="kobo.299.1">the tests.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.300.1">We need to modify when the </span><strong class="bold"><span class="kobospan" id="kobo.301.1">Push</span></strong><span class="kobospan" id="kobo.302.1"> workflow on the </span><strong class="source-inline"><span class="kobospan" id="kobo.303.1">main.yml</span></strong><span class="kobospan" id="kobo.304.1"> file runs. </span><span class="kobospan" id="kobo.304.2">Currently, our workflow runs when we push code to the main branch. </span><span class="kobospan" id="kobo.304.3">We are going to change this to also run </span><a id="_idIndexMarker747" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.305.1">when we create a pull request to the main branch. </span><span class="kobospan" id="kobo.305.2">This is because </span><a id="_idIndexMarker748" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.306.1">we want to run our checks before we move our code to the main branch. </span><span class="kobospan" id="kobo.306.2">To do this, we are going to add the </span><strong class="source-inline"><span class="kobospan" id="kobo.307.1">pull_request</span></strong><span class="kobospan" id="kobo.308.1"> event just above the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.309.1">workflow_dispatch</span></strong></span><span><span class="kobospan" id="kobo.310.1"> event:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.311.1">
on:
  push:
    branches: ["main" ]
  pull_request:
  workflow_dispatch:</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.312.1">After making </span><a id="_idTextAnchor209" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.313.1">this change, we can commit the changes and the action will run. </span><span class="kobospan" id="kobo.313.2">Let us now create a pull request to test the changes. </span><span class="kobospan" id="kobo.313.3">Ensure that you pull all the changes that we made in our browser locally before proceeding with the </span><span><span class="kobospan" id="kobo.314.1">following steps:</span></span></p>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.315.1">First, let us create a new branch </span><span><span class="kobospan" id="kobo.316.1">called </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.317.1">test</span></strong></span><span><span class="kobospan" id="kobo.318.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.319.1">Open the terminal in Android Studio and run the </span><span><span class="kobospan" id="kobo.320.1">following command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.321.1">git checkout -b test</span></strong></pre><p class="calibre4"><span class="kobospan" id="kobo.322.1">This command creates a new branch called </span><strong class="source-inline"><span class="kobospan" id="kobo.323.1">test</span></strong><span class="kobospan" id="kobo.324.1"> and switches to the newly </span><span><span class="kobospan" id="kobo.325.1">created branch.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.326.1">Next, let us modify the app’s </span><strong class="source-inline1"><span class="kobospan" id="kobo.327.1">versionName</span></strong><span class="kobospan" id="kobo.328.1"> and </span><strong class="source-inline1"><span class="kobospan" id="kobo.329.1">versionCode</span></strong><span class="kobospan" id="kobo.330.1"> in our app-level </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.331.1">build.gradle.kts</span></strong></span><span><span class="kobospan" id="kobo.332.1"> file:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.333.1">
versionCode = 2
versionName = "1.0</span><a id="_idTextAnchor210" class="calibre19 pcalibre pcalibre1"/><span class="kobospan1" id="kobo.334.1">.1"</span></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.335.1">Tap </span><strong class="bold"><span class="kobospan" id="kobo.336.1">Sync Now</span></strong><span class="kobospan" id="kobo.337.1"> to sync these changes to </span><span><span class="kobospan" id="kobo.338.1">our project.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.339.1">After making the </span><strong class="source-inline1"><span class="kobospan" id="kobo.340.1">versionName</span></strong><span class="kobospan" id="kobo.341.1"> and </span><strong class="source-inline1"><span class="kobospan" id="kobo.342.1">versionCode</span></strong><span class="kobospan" id="kobo.343.1"> changes, we can commit the changes and push them to our remote repository. </span><span class="kobospan" id="kobo.343.2">We can do this by running the following command </span><a id="_idTextAnchor211" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.344.1">in </span><span><span class="kobospan" id="kobo.345.1">the terminal:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.346.1">it add .</span></strong></pre><p class="calibre4"><span class="kobospan" id="kobo.347.1">This command stages all the changes we </span><span><span class="kobospan" id="kobo.348.1">have made.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.349.1">Next, we run </span><a id="_idIndexMarker749" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.350.1">the </span><span><span class="kobospan" id="kobo.351.1">following command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.352.1">git commit -m "Update app version name and code"</span></strong></pre><p class="calibre4"><span class="kobospan" id="kobo.353.1">This </span><a id="_idIndexMarker750" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.354.1">command commits the changes we </span><span><span class="kobospan" id="kobo.355.1">have made.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.356.1">Next, we run the </span><span><span class="kobospan" id="kobo.357.1">following command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.358.1">git push origin test</span></strong></pre><p class="calibre4"><span class="kobospan" id="kobo.359.1">This command pushes the changes to our </span><span><span class="kobospan" id="kobo.360.1">remote repository.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.361.1">Next, head to our repository in a browser, open the </span><strong class="bold"><span class="kobospan" id="kobo.362.1">Pull requests</span></strong><span class="kobospan" id="kobo.363.1"> tab, and click on the </span><strong class="bold"><span class="kobospan" id="kobo.364.1">New pull request</span></strong><span class="kobospan" id="kobo.365.1"> button. </span><span class="kobospan" id="kobo.365.2">This will open the </span><span><span class="kobospan" id="kobo.366.1">following page:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer238">
<span class="kobospan" id="kobo.367.1"><img alt="Figure 14.8 – Create a new pull request" src="image/B19779_14_08.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.368.1">Figure 14.8 – Create a new pull request</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.369.1">On this page, we set the </span><strong class="source-inline"><span class="kobospan" id="kobo.370.1">base</span></strong><span class="kobospan" id="kobo.371.1"> branch and the </span><strong class="source-inline"><span class="kobospan" id="kobo.372.1">compare</span></strong><span class="kobospan" id="kobo.373.1"> branch. </span><span class="kobospan" id="kobo.373.2">The </span><strong class="source-inline"><span class="kobospan" id="kobo.374.1">base</span></strong><span class="kobospan" id="kobo.375.1"> branch is the branch we want </span><a id="_idTextAnchor212" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.376.1">to merge our changes to. </span><span class="kobospan" id="kobo.376.2">In our case, we want to merge our changes to the </span><strong class="source-inline"><span class="kobospan" id="kobo.377.1">main</span></strong><span class="kobospan" id="kobo.378.1"> branch. </span><span class="kobospan" id="kobo.378.2">The </span><strong class="source-inline"><span class="kobospan" id="kobo.379.1">compare</span></strong><span class="kobospan" id="kobo.380.1"> branch is the branch that has recent changes. </span><span class="kobospan" id="kobo.380.2">In our case, we want to merge changes from the </span><strong class="source-inline"><span class="kobospan" id="kobo.381.1">test</span></strong><span class="kobospan" id="kobo.382.1"> branch to the </span><strong class="source-inline"><span class="kobospan" id="kobo.383.1">main</span></strong><span class="kobospan" id="kobo.384.1"> branch. </span><span class="kobospan" id="kobo.384.2">We can see the changes we have made as soon as we set the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.385.1">compare</span></strong></span><span><span class="kobospan" id="kobo.386.1"> branch.</span></span></p>
<ol class="calibre14">
<li value="9" class="calibre15"><span class="kobospan" id="kobo.387.1">Finalize the </span><a id="_idIndexMarker751" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.388.1">pull request by clicking on the </span><strong class="bold"><span class="kobospan" id="kobo.389.1">Create pull request</span></strong><span class="kobospan" id="kobo.390.1"> button. </span><span class="kobospan" id="kobo.390.2">After </span><a id="_idIndexMarker752" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.391.1">creating the pull request, we can review the pull </span><span><span class="kobospan" id="kobo.392.1">request details:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer239">
<span class="kobospan" id="kobo.393.1"><img alt="Figure 14.9 – Pull request checks" src="image/B19779_14_09.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.394.1">Figure 14.9 – Pull request checks</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.395.1">As seen in the preceding image, the workflow checks have started running since we created a pull request and we specified that our workflow should run when we create a pull request. </span><span class="kobospan" id="kobo.395.2">The </span><strong class="bold"><span class="kobospan" id="kobo.396.1">Merge pull request</span></strong><span class="kobospan" id="kobo.397.1"> button is disabled since the workflow is </span><span><span class="kobospan" id="kobo.398.1">still running.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.399.1">Once the workflow is done running, we can merge the pull request. </span><span class="kobospan" id="kobo.399.2">We can enforce even further rules per the checks but for now, we are good to go with the default </span><a id="_idIndexMarker753" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.400.1">behavior. </span><span class="kobospan" id="kobo.400.2">Once the workflow completes and all </span><a id="_idIndexMarker754" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.401.1">checks pass, we should see </span><span><span class="kobospan" id="kobo.402.1">the following:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer240">
<span class="kobospan" id="kobo.403.1"><img alt="Figure 14.10 – Pull request checks complete" src="image/B19779_14_10.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.404.1">Figure 14.10 – Pull request checks complete</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.405.1">We have now learned how to run lint checks and tests on GitHub Actions. </span><span class="kobospan" id="kobo.405.2">In the next section, we are going to learn how to deploy our app to Google Play Store using </span><span><span class="kobospan" id="kobo.406.1">GitHub Actions.</span></span></p>
<h1 id="_idParaDest-176" class="calibre6"><a id="_idTextAnchor213" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.407.1">Deploying to Play Store using GitHub Actions</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.408.1">In </span><a href="B19779_13.xhtml#_idTextAnchor175" class="calibre3 pcalibre pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.409.1">Chapter 13</span></em></span></a><span class="kobospan" id="kobo.410.1">, we learned how to deploy our app to Google Play Store using Google Play Console. </span><span class="kobospan" id="kobo.410.2">However, in that chapter, we did it manually. </span><span class="kobospan" id="kobo.410.3">In this chapter, we are going to learn </span><a id="_idIndexMarker755" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.411.1">how to deploy our app to Google Play Store using GitHub Actions. </span><span class="kobospan" id="kobo.411.2">We are going to use the Google Play Publisher action to </span><a id="_idIndexMarker756" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.412.1">deploy our app to Google Play Store. </span><span class="kobospan" id="kobo.412.2">This action is available in </span><span><span class="kobospan" id="kobo.413.1">GitHub Marketplace.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.414.1">Before we can write our workflow, we need to do some setup. </span><span class="kobospan" id="kobo.414.2">We need to create a service account on our Google Play Store account. </span><span class="kobospan" id="kobo.414.3">We can do this by following </span><span><span class="kobospan" id="kobo.415.1">these steps:</span></span></p>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.416.1">Configure the service account in Google Cloud Platform by following </span><span><span class="kobospan" id="kobo.417.1">these steps:</span></span><ol class="calibre18"><li class="upper-roman"><span class="kobospan" id="kobo.418.1">Navigate </span><span><span class="kobospan" id="kobo.419.1">to </span></span><a href="https://cloud.google.com/gcp" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.420.1">https://cloud.google.com/gcp</span></span></a><span><span class="kobospan" id="kobo.421.1">.</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.422.1">Navigate to </span><strong class="bold"><span class="kobospan" id="kobo.423.1">IAM and admin</span></strong><span class="kobospan" id="kobo.424.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.425.1">Service accounts</span></strong><span class="kobospan" id="kobo.426.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.427.1">Create </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.428.1">service account</span></strong></span><span><span class="kobospan" id="kobo.429.1">.</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.430.1">Pick a name and add appropriate permissions, for example, </span><span><span class="kobospan" id="kobo.431.1">owner permissions.</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.432.1">Open the newly created service account, click on the </span><strong class="bold"><span class="kobospan" id="kobo.433.1">Keys</span></strong><span class="kobospan" id="kobo.434.1"> tab, and add a new JSON </span><span><span class="kobospan" id="kobo.435.1">type key.</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.436.1">When the key is successfully created, a JSON file will be automatically downloaded to </span><span><span class="kobospan" id="kobo.437.1">your machine.</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.438.1">Store the content of this file in your GitHub repository secrets. </span><span class="kobospan" id="kobo.438.2">You can do this by going to the </span><strong class="bold"><span class="kobospan" id="kobo.439.1">Settings</span></strong><span class="kobospan" id="kobo.440.1"> tab in your repository, clicking on the </span><strong class="bold"><span class="kobospan" id="kobo.441.1">Secrets and variables</span></strong><span class="kobospan" id="kobo.442.1"> section, and selecting the </span><span><strong class="bold"><span class="kobospan" id="kobo.443.1">Actions</span></strong></span><span><span class="kobospan" id="kobo.444.1"> option.</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.445.1">Create a </span><strong class="bold"><span class="kobospan" id="kobo.446.1">New Repository Secret</span></strong><span class="kobospan" id="kobo.447.1"> and upload the JSON file. </span><span class="kobospan" id="kobo.447.2">You can name the secret </span><strong class="source-inline1"><span class="kobospan" id="kobo.448.1">GOOGLE_SERVICES_JSON</span></strong><span class="kobospan" id="kobo.449.1">. </span><span class="kobospan" id="kobo.449.2">This is the name we will use in our workflow to access the </span><span><span class="kobospan" id="kobo.450.1">JSON file.</span></span></li></ol></li>
<li class="calibre15"><span class="kobospan" id="kobo.451.1">Add a user to Google Play Console by following </span><span><span class="kobospan" id="kobo.452.1">these steps:</span></span><ol class="calibre18"><li class="upper-roman" value="8"><span class="kobospan" id="kobo.453.1">Open </span><a href="https://play.google.com/console" class="calibre3 pcalibre pcalibre1"><span class="kobospan" id="kobo.454.1">https://play.google.com/console</span></a><span class="kobospan" id="kobo.455.1"> and pick your </span><span><span class="kobospan" id="kobo.456.1">developer account.</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.457.1">Open </span><strong class="bold"><span class="kobospan" id="kobo.458.1">Users </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.459.1">and permissions</span></strong></span><span><span class="kobospan" id="kobo.460.1">.</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.461.1">Click on </span><strong class="bold"><span class="kobospan" id="kobo.462.1">Invite new user</span></strong><span class="kobospan" id="kobo.463.1"> and add the email of the service account created in </span><span><span class="kobospan" id="kobo.464.1">step 1.</span></span></li><li class="upper-roman"><span class="kobospan" id="kobo.465.1">Grant permissions to the app to which you want the service account to deploy </span><span><span class="kobospan" id="kobo.466.1">in-app permissions.</span></span></li></ol><p class="calibre4"><span class="kobospan" id="kobo.467.1">If you need more details on how to do this, you can check out the following </span><span><span class="kobospan" id="kobo.468.1">link: </span></span><a href="https://developers.google.com/android/management/service-account" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.469.1">https://developers.google.com/android/management/service-account</span></span></a></p></li>
</ol>
<p class="calibre4"><span class="kobospan" id="kobo.470.1">Like how we created the </span><strong class="source-inline"><span class="kobospan" id="kobo.471.1">GOOGLE_SERVICES_JSON</span></strong><span class="kobospan" id="kobo.472.1"> variable in our repository secrets, we need to add the details of our signing certificate to our variables so that we can use </span><a id="_idIndexMarker757" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.473.1">them on our CI/CD pipeline. </span><span class="kobospan" id="kobo.473.2">The first step is to generate a </span><strong class="source-inline"><span class="kobospan" id="kobo.474.1">base64</span></strong><span class="kobospan" id="kobo.475.1">-encoded version of our signing certificate. </span><span class="kobospan" id="kobo.475.2">We can do </span><a id="_idIndexMarker758" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.476.1">this by running the following command in </span><span><span class="kobospan" id="kobo.477.1">the terminal:</span></span></p>
<pre class="console"><span class="kobospan1" id="kobo.478.1">
openssl base64 &lt; packt.jks | tr -d '\n' | tee packt.jks.base64.txt</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.479.1">You should run this command in the directory where you saved your keystore file. </span><span class="kobospan" id="kobo.479.2">You could change the name to match the filename of the keystore file if you named yours differently. </span><span class="kobospan" id="kobo.479.3">This command will generate a </span><strong class="source-inline"><span class="kobospan" id="kobo.480.1">base64</span></strong><span class="kobospan" id="kobo.481.1">-encoded version of our keystore file. </span><span class="kobospan" id="kobo.481.2">We can then copy the contents of the file and add it to our repository secrets. </span><span class="kobospan" id="kobo.481.3">We need to also add the following secrets to </span><span><span class="kobospan" id="kobo.482.1">our repository:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer241">
<span class="kobospan" id="kobo.483.1"><img alt="Figure 14.11 – Repository secrets" src="image/B19779_14_11.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.484.1">Figure 14.11 – Repository secrets</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.485.1">The newly </span><a id="_idIndexMarker759" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.486.1">created secrets are explained </span><span><span class="kobospan" id="kobo.487.1">as follows:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.488.1">KEYSTORE_PASSWORD</span></strong><span class="kobospan" id="kobo.489.1">: This is the password of our </span><span><span class="kobospan" id="kobo.490.1">keystore file</span></span></li>
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.491.1">KEY_ALIAS</span></strong><span class="kobospan" id="kobo.492.1">: This is the alias of our </span><span><span class="kobospan" id="kobo.493.1">keystore file</span></span></li>
<li class="calibre15"><strong class="source-inline1"><span class="kobospan" id="kobo.494.1">KEY_PASSWORD</span></strong><span class="kobospan" id="kobo.495.1">: This is the password of our keystore </span><span><span class="kobospan" id="kobo.496.1">file alias</span></span></li>
</ul>
<p class="calibre4"><span class="kobospan" id="kobo.497.1">All these </span><a id="_idIndexMarker760" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.498.1">details should be like the ones we used when we created our keystore file. </span><span class="kobospan" id="kobo.498.2">Now, let us write our workflow. </span><span class="kobospan" id="kobo.498.3">Before writing the workflow, ensure that you have completed the publishing of our app steps in </span><a href="B19779_13.xhtml#_idTextAnchor175" class="calibre3 pcalibre pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.499.1">Chapter 13</span></em></span></a><span class="kobospan" id="kobo.500.1">, since this is needed for this action to work. </span><span class="kobospan" id="kobo.500.2">Let us head to the </span><strong class="source-inline"><span class="kobospan" id="kobo.501.1">.github/workflows</span></strong><span class="kobospan" id="kobo.502.1"> folder, create a new file called </span><strong class="source-inline"><span class="kobospan" id="kobo.503.1">deploy-to-playstore.yml</span></strong><span class="kobospan" id="kobo.504.1">, and add the </span><span><span class="kobospan" id="kobo.505.1">following code:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.506.1">
name: Deploy to Playstore
on:
  push:
    branches: [ "main"]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: set up JDK 17
        uses: actions/setup-java@v3
        with:
          distribution: 'zulu'
          java-version: '17'
  </span><a href="mailto:chkfung/android-version-actions@v1.1" class="calibre19 pcalibre pcalibre1"><span class="kobospan1" id="kobo.507.1">    - name: Bump version</span></a>
<a href="mailto:chkfung/android-version-actions@v1.1" class="calibre19 pcalibre pcalibre1"><span class="kobospan1" id="kobo.508.1">        use</span></a><span class="kobospan1" id="kobo.509.1">s: chkfung/android-version-actions@v1.1
        with:
          gradlePath: chapterfourteen/build.gradle.kts
          versionCode: ${{github.run_number}}
          versionName: ${{ format('1.0.{0}', github.run_number ) }}
      - name: Assemble Release Bundle
        working-directory: chapterfourteen
        run: ./gradlew bundleRelease
      - name: De</span><a href="mailto:r0adkll/upload-google-play@v1.1.1" class="calibre19 pcalibre pcalibre1"><span class="kobospan1" id="kobo.510.1">ploy to Internal Testing</span></a>
<a href="mailto:r0adkll/upload-google-play@v1.1.1" class="calibre19 pcalibre pcalibre1"><span class="kobospan1" id="kobo.511.1">        </span></a><span class="kobospan1" id="kobo.512.1">uses: r0adkll/upload-google-play@v1.1.1
        with:
          serviceAccountJsonPlainText: ${{ secrets.GOOGLE_SERVICES_JSON }}
          packageName: com.packt.chapterthirteen
          releaseFiles: chapterfourteen/build/outputs/bundle/release/app-release.aab
          track: internal
          whatsNewDirectory: whatsnew/
          status: completed</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.513.1">The workflow </span><a id="_idIndexMarker761" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.514.1">is remarkably similar to the one we created earlier on in the </span><em class="italic"><span class="kobospan" id="kobo.515.1">Setting up GitHub Actions</span></em><span class="kobospan" id="kobo.516.1"> and </span><em class="italic"><span class="kobospan" id="kobo.517.1">Running lint checks and tests in GitHub Actions</span></em><span class="kobospan" id="kobo.518.1"> sections with only slight differences. </span><span class="kobospan" id="kobo.518.2">We have a step that bumps the </span><strong class="source-inline"><span class="kobospan" id="kobo.519.1">versionName</span></strong><span class="kobospan" id="kobo.520.1"> and </span><strong class="source-inline"><span class="kobospan" id="kobo.521.1">versionCode</span></strong><span class="kobospan" id="kobo.522.1"> for us instead of us having to do this </span><a id="_idIndexMarker762" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.523.1">manually every time. </span><span class="kobospan" id="kobo.523.2">Versioning serves as a structured identifier for different software iterations. </span><span class="kobospan" id="kobo.523.3">Employing semantic versioning aids in communicating the impact of changes, distinguishing major backward-incompatible updates, minor backward-compatible feature additions, and patch-level bug fixes. </span><span class="kobospan" id="kobo.523.4">It plays a crucial role in dependency management, facilitating compatibility between different components. </span><span class="kobospan" id="kobo.523.5">Additionally, versioning supports rollbacks, hotfixes, and efficient testing, ensuring the stability of the application. </span><span class="kobospan" id="kobo.523.6">Release notes and communication are streamlined, providing users and stakeholders with clear insights into each release. </span><span class="kobospan" id="kobo.523.7">Ultimately, versioning contributes to a reliable and predictable user experience, fostering trust and transparency throughout the software development </span><span><span class="kobospan" id="kobo.524.1">life cycle.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.525.1">We have </span><a id="_idIndexMarker763" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.526.1">another step that builds a signed </span><strong class="bold"><span class="kobospan" id="kobo.527.1">Android App Bundle</span></strong><span class="kobospan" id="kobo.528.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.529.1">AAB</span></strong><span class="kobospan" id="kobo.530.1">). </span><span class="kobospan" id="kobo.530.2">We also have another step that deploys the signed AAB to the Google Play Store </span><strong class="bold"><span class="kobospan" id="kobo.531.1">Internal testing</span></strong><span class="kobospan" id="kobo.532.1"> track. </span><span class="kobospan" id="kobo.532.2">We use the </span><strong class="source-inline"><span class="kobospan" id="kobo.533.1">upload-google-play</span></strong><span class="kobospan" id="kobo.534.1"> action, which automates and makes the process easier. </span><span class="kobospan" id="kobo.534.2">We do the configurations on this action, such as specifying our service account, the package name of our app on Play Store, the directory where our signed AAB will be found, and lastly, the track that we want to deploy to. </span><span class="kobospan" id="kobo.534.3">Pushing the changes to the main branch will trigger the actions again and once the </span><strong class="source-inline"><span class="kobospan" id="kobo.535.1">deploy-to-playstore</span></strong><span class="kobospan" id="kobo.536.1"> workflow is complete, we should see a new internal testing release on our Play Store page, as shown in </span><span><span class="kobospan" id="kobo.537.1">the following:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer242">
<span class="kobospan" id="kobo.538.1"><img alt="Figure 14.12 – New internal testing release" src="image/B19779_14_12.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.539.1">Figure 14.12 – New internal testing release</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.540.1">We have </span><a id="_idIndexMarker764" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.541.1">completed putting in place our CI/CD process. </span><span class="kobospan" id="kobo.541.2">We </span><a id="_idIndexMarker765" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.542.1">only do this setup once and we can always use it to make deployments and automated testing easier, faster, and more reliable </span><span><span class="kobospan" id="kobo.543.1">for us.</span></span></p>
<h1 id="_idParaDest-177" class="calibre6"><a id="_idTextAnchor214" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.544.1">Summary</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.545.1">In this chapter, we learned how to use GitHub Actions to automate some manual tasks, such as deploying new builds to the Play Store. </span><span class="kobospan" id="kobo.545.2">Additionally, we learned how to run lint checks and tests on CI/CD pipelines and push builds to Google Play Store using </span><span><span class="kobospan" id="kobo.546.1">GitHub Actions.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.547.1">In the next chapter, we will learn about techniques to improve our apps by adding analytics, using Firebase Crashlytics, and using cloud messaging to increase user engagement in our apps. </span><span class="kobospan" id="kobo.547.2">Additionally, we will learn some tips and tricks for securing </span><span><span class="kobospan" id="kobo.548.1">our apps.</span></span></p>
</div>
</body></html>