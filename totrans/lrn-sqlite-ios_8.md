# 第 8 章。SQLite 的更多特性和进展

本章将探讨 SQLite 的一些新特性，并介绍该数据库的最新进展。本章将展示 SQLite 如何暴露给其他语言和框架，并讨论 C API 的扩展、**PhoneGap** 的使用以及其他跨平台开发环境。本章还将概述 SQLite 的其他特性以及 SQLite 如何发展以确保所有使用它的人都能快速掌握它。

您还将了解 SQLite 在近年来的变化，它如何与各种现有技术集成，以及其简单、易用的公式如何保证其在其他领域的流行。使用数据库技术的应用程序数量令人难以置信，而这些应用程序没有公开后端或本地数据库。如后文所示，SQLite 已经发展到新的水平，保持了其简单性，但同时也被开发者推向了新的高度和流行度。

**Firefox** 和 SQLite 扩展可用于浏览器管理目的。SQLite 已经经历了几次代码变更，未来它将继续如此发展，或者被更新的技术所取代。

Adobe 的企业管理系统与使用 SQLite 的 PhoneGap 兼容。由于其简单的设置，有多个案例展示了 SQLite 与不同技术的结合，并且整合良好。

到目前为止，关系型数据库管理系统的发展非常强劲，如果数据需要工业级的存储、应用，SQLite 是正确的格式。然而，在最近几年，如 NOSQL 这样的解决方案，它们完全依赖于从 REST API 或网络服务等技术中选择的数据，并没有使用 **RDBMS**（关系数据库管理系统）来存储它们的数据。数据将被检索并保存在文件类型结构中，实际上是其自己的 RDMS 版本。SQLite 没有像 **数据库备份** 或 **数据库恢复** 这样的工业级工具支持。在一个移动设备增长迅速、超越所有类型预期的世界里，SQLite 是迄今为止使用最简单、最快的一个，学习时间最少。

**Firefox SQLite 管理器**功能是浏览器的良好软件扩展。一旦安装，它可以作为数据库管理员各种过程的辅助工具。

它的简单性和灵活性使其非常适合开发和测试。没有机制来确保性能，但可以调整库。SQLite 对于某些固定、单用户、移动用户和游戏信息存储的嵌入式应用来说非常出色。

SQLite 的下载和安装非常简单。一旦完成，它就会启动并开始工作。

# PhoneGap 插件

在开始使用SQLite为PhoneGap开发软件之前，必须正确设置环境，以便PhoneGap框架能够正确地与SQLite一起工作。PhoneGap环境将使SQLite数据库能够设置并连接到Xcode，最终生成iOS应用程序。

此外，还有一个名为**Brodysoft**（参考[https://build.phonegap.com/plugins/2368](https://build.phonegap.com/plugins/2368)）的本地SQLite插件，它提供了一个用于存储和使用的标准Web SQL数据库标准的接口。

随着对移动技术、移动应用程序和移动开发的不断增长，对进一步发展的需求，例如使用PhoneGap等产品，将要求以下内容：

+   PhoneGap将提高应用程序的大小限制

+   它将支持不同的插件，包括Cordova插件仓库`plugins.cordova.io`

+   一些额外的PhoneGap插件可能不需要经过审批流程，并且可以轻松获得批准

+   将提供一个上传您自己的插件到您自己的开发区域的功能，以便您可以私下测试它们

为了支持超过600个在PhoneGap环境中的额外插件，可以使用`source`属性。

PhoneGap插件，与之前不同，可以包含编译后的组件，例如框架、`.jar`文件和其他相关二进制文件。关于这个过程的文档在PhoneGap网站上有很多。PhoneGap现在正在推进一个`Amazon Mobile Ad Network`插件，这将允许开发者将应用程序货币化。这是因为`Amazon Ads` API已被创建用于在应用程序内进行广告，并且是一个仅为此目的的平台。它将跨不同的平板电脑、移动设备、不同的实用程序和游戏应用程序使用。

**Cordova**或PhoneGap使用的`cordova.xml`文件是主要参数文件，其中配置更改应用于环境。

例如，使用本地的Cordova/PhoneGap插件为Android和iOS，可以直接使用HTML5 Web SQL API进行编码，如下所示。在这里，代码正在等待API加载完成后再尝试打开数据库：

[PRE0]

### 注意

有一个为PhoneGap系统开发并提供的插件[https://github.com/litehelpers/Cordova-sqlite-storage](https://github.com/litehelpers/Cordova-sqlite-storage)。为了使用此插件，请将以下代码添加到您的`config.xml`文件中：

[PRE1]

此插件与iOS和Android操作系统兼容，并且也支持Cordova。

以下代码片段对于确保进行设备是否就绪以及Cordova是否就绪加载的检查至关重要：

[PRE2]

使用前面的插件，它使得将SQL直接包含到HTML5中变得更容易、更快，如下所示：

[PRE3]

添加必要的HTML内容变得容易，并且这适用于iOS和Android。HTML5、SQLite和PhoneGap之间的编译关系是技术进步的体现。

并非`ALTER TABLE`语句的所有方面都在SQLite中实现，并且没有对`GRANT`或`REVOKE`语句的支持。

# C API的扩展

SQLite绑定功能扩展了SQLite语言的流行度和多样性，但并不受数据库核心开发者的支持。相反，SQLite社区负责这些集成，并且在线上有很好的文档记录。脚本语言，如Perl、PHP、Python或Java，与SQLite配合得很好。

SQLite的C API接口规范有几个接口元素，可以归纳为以下几类：

+   第一类包含SQLite库使用的对象和数据类型列表。其中包含十多个对象和数据类型。最有意义且最常见的是名为`sqlite3`的数据库对象和名为`sqlite3_stmt`的预处理语句。

+   第二类将包含SQLite使用的常量列表，这些常量通过`sqlite3.h`头文件中`#defines`语法的使用来引用。这些是标准常量，例如`SQLITE_OPEN_READONLY`。

+   第三类是所有可用函数及其在对象中使用的方法列表，用于返回值和使用标准常量。

例如，`int sqlite3_sleep(int);`函数基于它将暂停指令执行的毫秒数。

随着移动设备的日益强大，SQLite可以处理或使用的内存资源量总会发生变化。SQLite内部使用的技术称为页面缓存。现在，页面缓存变得很重要，因为这是SQLite性能使用和设置内存的方式。它有一个I/O算法和两个搜索算法。有一个二分搜索使用表的索引，以及全表遍历的暴力攻击来读取整个表。由于对如何编写和实现它们的限制性决策，以及它更通用且未针对任何特定应用设计，性能通常可能不会达到预期。

尽管SQLite确实有一个优化器，但它不是最先进的，但它是实用的。在以下示例中，我们将看到两个表的创建和一个连接。我们将使用`EXPLAIN`语句，然后让SQLite显示它将如何获取结果。随着结果的开始显示，它将使用本节前面讨论的类别格式之一，即主要扫描。它只有在存在带有`JOIN`的`SELECT`语句且有索引或键的简单查询时才能正常工作。在复杂查询中，需要使用`EXPLAIN`语句。我们只从第一个表中选择一列，整个表进行扫描：

[PRE4]

在页面缓存方面，如前所述，SQLite 使用基于页面的磁盘格式。缓存与 SQLite 一起从磁盘中拉取。没有自动回收页面；一旦页面为空，就可以重用。此外，如果一个页面被反复重用，它将变得碎片化，其数据将在数据库文件中分散，这将在性能方面降低。

如本书之前所述，有来自苹果的 **Core Data**，这是 iOS 的标准，但免费的 SQLite 是移动设备上占主导地位且跨平台的数据库解决方案。

随着新框架的发展，出现了一种新技术，旨在取代 SQLite 和 Core Data：它被称为 **Realm**。它对 iOS 和 Android 都是免费的，并且是一个值得调查的好产品。虽然其他产品可能有限制，但这款产品必须确保它易于设置、使用和管理。到目前为止，它已被各种大型电子商务和数据网站使用，例如 Pinterest 或 BBC。[Realm.io](http://Realm.io) 是这款数据库软件的位置，是适应今天多变市场的现代 API。

在 Realm 中，有一个针对 **Xcode** 的插件，看起来在演示中钩入并运行良好。有一个完整的 API 参考文档，它与 Objective-C、Swift 和 Java 一起工作。Realm 还有一个来自苹果应用商店的自己的 Realm 浏览器，它被用作管理数据库的应用程序，例如 SQLite 的 Firefox 插件。

# SQLite 的预写日志

**Write Ahead Logging**（预写日志）与 SQLite，也称为 **WAL**，是 SQLite 实现该移动数据库系统中 `rollback` 和 `commit` 流程的标准方法。磁盘访问以及输入输出操作更加顺序化，使用的是 `WAL` 方法。使用 `WAL` 将会减少 `fsync()` 函数和操作的使用。这意味着它在不同的操作系统和智能手机上更有可能正常工作。`WAL` 在大多数操作上更快，并且提供了更好的并发性，因为没有冲突会发生在同时进行读写操作的过程中，任何数据块都将大幅减少。

尽管这种方法有很多优点，但也有局限性。`WAL` 在处理非常大的事务时效率不高，但处理较小的事务时则要好得多。对于大约 100 兆字节的事务，它将运行良好，但超过 1 吉字节，它将开始降低其效率。还有一个问题：如果 `WAL` 遇到 **磁盘满** 错误，它可能会失败操作，尽管，一个额外的操作是 **检查点**，它是作为系统的一部分嵌入的。开发者需要意识到这一点。

`WAL` 和 `rollback` 可能比当前/传统的方法操作要慢。这是因为数据库的读取量和低写入尝试量。这仅限于 1-2% 的范围内。另一个缺点是，在使用 WAL 模式时，即使数据库为空，也无法更改数据库页面大小。为了解决这个问题，你必须使用提供的 **BACKUP API** 从备份中恢复，并且你必须处于回滚日志模式才能成功。还有读取 **只读 WAL** 数据库的问题。

`WAL` 的工作原理是通过创建并写入一个不包含任何更改的原始数据库副本到一个新的/独立的回滚日志文件中。然后直接对数据库文件进行更改。如果发生崩溃并且系统必须执行 `rollback` 操作，那么未更改的原始版本将被回放到数据库文件中，使其恢复到原始状态。当删除回滚日志文件时，执行 `commit` 操作。这是一个非常有效的程序。向磁盘写入事务总是很快，因为内容只写入一次。

# SQLite 中 B 树的使用

叶节点的任意存储及其在物理磁盘上的位置不会与索引顺序或任何逻辑位置链接或响应。因此，使用正确的结构，数据库搜索算法被用来改变位置并快速输出一个平衡搜索树，简而言之，就是一个 B 树。每个数据分支都将有其叶节点，这些叶节点将链接或引用用于存储数据库中每个表的内存位置。

B 树允许基于节点中的一般二叉搜索树进行顺序访问、删除和插入，节点可以有两个或更多子节点。当数据被移除或添加时，子节点数量会发生变化，为了保持特定的范围，一些内部节点可能会合并或分裂。B 树结构中的每个内部节点都将有一个键的数量。每个键都将有一个值，并将被分成子树。B 树是查找与键关联的数据的好方法，但它在搜索带有查询字符串的数据时效率不高；它使用索引来加速这种搜索。B 树是搜索带有键的数据的有效方法，并且当正确执行时，它们变得非常快。这是关于 B 树及其在 SQLite 中应用的解释。

# 创建一个简单的 Swift

随着 Swift 和 Swift2 的出现，现在有一个称为 **playground** 的环境被使用。这是一个你可以设置一个带有一些代码的快速环境并查看结果的地方。这是一种快速、新的使用新设置的方法。当你开始时，它将有一个主窗口和第二个，分割的结果窗口。

在 Xcode 中，导航到 **新建** | **Playground**，以下截图将显示。给你的 playground 起一个名字。你可以在不同的平台上运行多个 playground，因此一个有意义的名字会有所帮助：

![创建简单的Swift](img/4725_08_01.jpg)

一旦创建完成并点击**下一步**按钮，就会出现以下屏幕。在这里，您可以创建代码，测试想法和代码片段，并尝试运行。这是一个既简单又伟大的想法，将有助于激励现有开发者，并为未来的开发者创造机会：

![创建简单的Swift](img/4725_08_02.jpg)

如前一个截图所示，右侧有一个分页，可以根据要求进行调整。代码出现在左侧，结果出现在右侧。在前面的代码中，调用了 `UIKIT`；下一行创建了一个名为 `str` 的变量，其默认字符串值为 `Hello playground`。

**UIKit** 是用于应用程序开发的iOS框架的核心基础。将 `var` 定义为 `str` 等于 `Hello Playground` 以便更改后，应将其定义为 `str = New Playground`，这将重新分配变量为新值。使用 `var` 语句创建默认系统，然后分配它，表明默认变量值可以被更改。然而，如果您使用 `let` 语句说 `let str =new play` 并紧接着添加 `str =newnewplay line`，系统会抛出错误，因为您不能使用 `let` 命令更改常量的值。

演示场可以接受不同类型的数据类型，正如您所想象的，这使得它成为进入开发或测试新想法的有趣而富有成效的方式。在下一个简单的例子中，设置了一个名为 `age` 的变量，其数据类型为 `int`。

给这个值赋予一个默认值 `25`。然后，将年龄值乘以 `10`，您将得到一个新的值 `250`，如以下截图所示。这是演示场的美丽之处：

![创建简单的Swift](img/4725_08_03.jpg)

Swift拥有丰富的比较运算符，就像大多数语言一样，但您可以使用 `=` 和 `>` 方式，也可以使用 `<` 方式，如以下截图所示：

![创建简单的Swift](img/4725_08_04.jpg)

Swift的字符串插值也更容易，通过创建一个变量然后使用命令打印名称，例如，使用 `\(name)`（其中 `name` 是变量名），如以下截图所示。这很简单，但反复练习是很好的，这样信息就能在您的脑海中固定下来：

![创建简单的Swift](img/4725_08_05.jpg)

如以下截图所示，在Swift中，`+` 连接运算符的使用不起作用，尤其是字符串、双精度浮点数或整数的合并。但下一张图清楚地显示了在 `name`、`age` 或 `latitude` 之间的 `\` 可以成为正确语法的部分，正确地表达输出：

![创建简单的Swift](img/4725_08_06.jpg)

在 Swift 中使用数组更为简便，这些数组将存储数据集合，例如网格，作为大量信息集合的一部分。一个名为 `oddNumbers` 的数组将包含四个数字，例如 `(3, 5, 7, 9)`。还有一个名为 `songs` 的数组，如下所示：

![创建简单的 Swift](img/4725_08_07.jpg)

Swift 语言非常广泛，有许多示例，但我们无法在本章中涵盖所有内容。本章将向您展示 SQLite、PhoneGap 的更新以及 Swift 的一些更新。

例如，`for` 循环更容易使用，这在以下屏幕截图中有明确的展示。在这个语句中，打印语句将运行 10 次，如以下屏幕截图所示：

![创建简单的 Swift](img/4725_08_08.jpg)

这里是尝试使用 `for` 命令的另一个例子，其中循环中的数字不是必需的，而是使用 `_` 代替。但是，`str` 打印命令已经执行了五次，因为寻找并打印了单词 `gone`，如以下截图所示：

![创建简单的 Swift](img/4725_08_09.jpg)

如前所述，使用游乐场将——正如其名所示——*Swift 且有趣*。

只需将其粘贴到代码中，然后运行即可。从 Xcode 7 及以后版本开始，你可以放入游乐场的实际代码将是丰富的、有注释的，并且远不止伪代码，因为它可以添加到你的应用程序中。

你将能够添加丰富的文本功能、注释以及其他有助于编程过程开发和创造性的文本。

想象一下，当 API 更新发布时，这将是一种查看 API 并编写或修改一些代码以使其在游乐场中工作的极好且快速的方式。除了提供信息和快速之外，它还将作为你和你同事的培训工具。它将提高培训课程，并使开发者能够在不影响他人及其共同项目的情况下尝试新想法和编程代码。

这是一种多么美丽、互动且现代的学习和使用现有编程技能以获取新知识的方式。Swift 中交互式调试控制台的使用和可用性允许对产品进行改变/增强，从而现代化其努力。

由于它是从头开始设计的，Swift 致力于快速、行动迅速且编码迅速，并且与 Objective-C 兼容性以及 Swift 一起包括和共享库、代码和值，因为现代 21 世纪的编译器将有助于其在未来几年的主导地位。Objective-C 和 Swift 代码可以共存并协同工作或单独工作。

内置的高性能编译器是为了最大化苹果硬件、协议和网络可用性而创建的。它已优化以非常快速地运行并提高开发和编译速度。

作为其产品组合的一部分，Swift语言是最现代的语言之一，它采用了其他脚本语言的“最佳”部分，并消除了诸如性能不佳或与语法相关的问题，从而超越了C和Objective-C代码范式。世界上有许多语言。但Swift是唯一一种你可以用现代方式编码和学习的语言。通过现在学习，你正在为不久的将来做准备，那时这种语言将变得流行。它是Objective-C和C相关语言的完全继任者。

Swift被设计成现代的，并摒弃了那些实际上会阻止程序员发展的功能。因此，所有阻碍缓慢发展的因素都已消失。例如，所有值默认情况下都不是null。语言的安全性得到了鼓励，并作为软件的一部分构建，例如，变量使用`var`语句，而`let`语句将用于常量。例如，在定义任何“Swift”对象时，值不会是nil，因为编译器会处理它并将其作为安全制度的一部分。强制这些类型的细微之处鼓励编写更好、更专业、更干净、更有趣和更具创新性的代码。

Swift拥有一个卓越的现代且改进的错误处理模型，它将提供一种清晰简洁的方式来使用最先进、面向对象的技术开发和获得现代技能。它还捕获任何必要的错误，以便程序不会崩溃，并处理它。它与**NSError**和其他相关iOS框架配合得很好。例如，请参见以下内容：

[PRE5]

Swift2现在已被开源，这将鼓励更多不同平台上的用户进行软件的架构、设计和开发。这将使苹果能够进入市场上竞争对手经常使用的开发领域。它将拥有庞大的追随者，尤其是当那些忠诚的Objective-C程序员转向Swift时。

使用一些出色的强大语言/语法，如`repeat`、`defer`和`guard`，可以在Swift中编写新颖、有趣和功能强大的代码。苹果还提供了一种迁移工具，可以将代码转换为新的游乐场和应用程序开发代码，以便轻松执行。这些是使用Swift2进行开发所期待的一些好处。

Swift的设计目标是现代的，Swift2采用了来自现代研究、编程语言以及不同苹果开发、产品和编码技能的先验经验的信息、功能以及编译器开发。一种现代的方法，以及结构扩展和协议的能力，将确保其存在一段时间。

# 摘要

在本章中，你学习了SQLite的一些高级方面和未来的进步，以及它是如何与当前跨平台开发相匹配的。本章概述了SQLite的变化及其增长与PhoneGap的联系。PhoneGap还与内容管理系统集成，例如Adobe Enterprise Manager，该系统在技术方面取得了几个进步，并且客户端许可证的购买激增了其知名度。在本章中，你还触及了新Swift语言中可能实现的内容以及它将如何影响游戏、应用程序和实用程序的未来。
