<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Using Xcode Instruments</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Introducing Xcode Instruments</li><li class="listitem" style="list-style-type: disc">Tracing iOS applications</li><li class="listitem" style="list-style-type: disc">Running and profiling an iOS project</li><li class="listitem" style="list-style-type: disc">Detecting virtual memory faults</li><li class="listitem" style="list-style-type: disc">Detecting memory leaks</li><li class="listitem" style="list-style-type: disc">Handling runtime errors</li><li class="listitem" style="list-style-type: disc">Handling compile-time errors</li><li class="listitem" style="list-style-type: disc">Adding and configuring Instruments</li></ul></div><div><div><div><div><h1 class="title"><a id="ch04lvl1sec43"/>Introduction</h1></div></div></div><p>In this chapter, we will focus on how to effectively use the Xcode Instruments within our applications to track down areas within our iOS applications that could be affecting the overall performance.</p><p>These types of issues could potentially cause an application to run slowly, or even crash on the user's iOS device. We will take a look at each of the different types of built-in Instruments, which come as part of the Instruments applications. We will also see how we can use the System Trace Instrument to help track down system calls, memory use, and threads within your code that may be affecting the application's overall performance.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec44"/>Introducing Xcode Instruments</h1></div></div></div><p>In this recipe, we will learn <a id="id302" class="indexterm"/>how we can use Instruments to help gather important information about the performance of your application.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec149"/>Getting ready</h2></div></div></div><p>In this section, we will learn how to launch the Instruments application.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec150"/>How to do it...</h2></div></div></div><p>To begin, follow these simple <a id="id303" class="indexterm"/>steps as outlined below:</p><div><ol class="orderedlist arabic"><li class="listitem">Launch Xcode from the <code class="literal">/Developer/Applications</code> folder.</li><li class="listitem">Choose <strong>Instruments</strong> from the <strong>Xcode</strong> menu, <a id="id304" class="indexterm"/>located under the <strong>Open Developer Tool</strong> submenu as shown in the following screenshot:<div><img src="img/3349_04_01.jpg" alt="How to do it..."/></div></li><li class="listitem">Select the <strong>Activity Monitor</strong> <a id="id305" class="indexterm"/>option from the list of available templates.<div><img src="img/3349_04_02.jpg" alt="How to do it..."/></div></li><li class="listitem">Click on the <strong>Choose</strong> <a id="id306" class="indexterm"/>button to <a id="id307" class="indexterm"/>proceed to the next step in the wizard.</li><li class="listitem">Next, choose <strong>All Processes</strong> from the drop-down menu as highlighted by the rectangle in the following screenshot:<div><img src="img/3349_04_03.jpg" alt="How to do it..."/></div></li><li class="listitem">Click on the <strong>Record</strong> button to <a id="id308" class="indexterm"/>begin profiling and monitoring system processes.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec151"/>How it works...</h2></div></div></div><p>In this recipe, we learned how easy it is to launch the Instruments application to profile an application. We learned how to use the <a id="id309" class="indexterm"/>
<strong>Activity Monitor</strong> option to show how we can use this Instrument to monitor the overall CPU, memory, disk, and network activity of the current computer system.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec152"/>There's more…</h2></div></div></div><p>Through the use of the Instruments application, you can gather information based on a variety of different types of data and view these side by side at the same time. This enables you to spot trends, which would be hard to spot otherwise, and this can be used to see code running by your program along with the corresponding memory usage.</p><p>The following table provides a brief description of each feature within the Instruments application:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Instruments feature</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Instruments <a id="id310" class="indexterm"/>
<a id="id311" class="indexterm"/>pane</p>
</td><td style="text-align: left" valign="top">
<p>This pane lists all of the Instruments, which have been added for those that you want to profile against.</p>
<p>New Instruments can be added by selecting and then dragging each one from the Instruments library into this pane. Items within this pane can also be deleted.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Track <a id="id312" class="indexterm"/>
<a id="id313" class="indexterm"/>pane</p>
</td><td style="text-align: left" valign="top">
<p>This pane displays a graphical summary of the data returned by the current Instruments. Each Instrument has its own track that provides a chart of the data that is collected by that Instrument. The information within this pane is read-only.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Detail <a id="id314" class="indexterm"/>
<a id="id315" class="indexterm"/>pane</p>
</td><td style="text-align: left" valign="top">
<p>This pane shows the details of the data that has been collected by each of the Instruments. It displays the set of events gathered and used to create the graphical view within the track pane. Depending on the type of Instrument, information that is represented by this pane can be customized to represent the data differently.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Extended <a id="id316" class="indexterm"/>
<a id="id317" class="indexterm"/>detail pane</p>
</td><td style="text-align: left" valign="top">
<p>This pane displays detailed information about the item that is currently selected in the detail pane. This pane displays the complete stack trace, timestamp, and other Instrument-specific data gathered for the given event.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Navigation <a id="id318" class="indexterm"/>
<a id="id319" class="indexterm"/>bar</p>
</td><td style="text-align: left" valign="top">
<p>This pane shows you where you currently are and the steps you took to get there. It includes two menus: the active Instrument menu and the detail view menu. You can click on the entries within the navigation bar to select the active Instrument, and the level and type of information in the detail view.</p>
</td></tr></tbody></table></div><p>The Instruments trace document toolbar allows you to add and control Instruments, open view, and configure the track pane as shown in the following screenshot:</p><div><img src="img/3349_04_04.jpg" alt="There's more…"/></div><p>The following table provides an explanation for each of the different controls on the toolbar:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Toolbar item</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Pause / Resume button</p>
</td><td style="text-align: left" valign="top">
<p>This button pauses the <a id="id320" class="indexterm"/>
<a id="id321" class="indexterm"/>gathering of trace data while a recording is in progress. When the pause button has been pressed within the track pane, it will show a gap in the trace data to highlight this.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>The <strong>Record</strong> / Stop button</p>
</td><td style="text-align: left" valign="top">
<p>This button starts <a id="id322" class="indexterm"/>
<a id="id323" class="indexterm"/>or stops the recording process. You use this button to begin gathering trace data for your application.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Loop button</p>
</td><td style="text-align: left" valign="top">
<p>This button enables <a id="id324" class="indexterm"/>
<a id="id325" class="indexterm"/>you to set whether the recorder should loop during playback to repeat the recorded steps continuously. This can be useful if you want to gather multiple runs for a given set of steps.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<strong>Target</strong>
</p>
</td><td style="text-align: left" valign="top">
<p>This button selects the <a id="id326" class="indexterm"/>
<a id="id327" class="indexterm"/>trace target for the document. This is the process for which data is gathered.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<strong>Inspection Range</strong>
</p>
</td><td style="text-align: left" valign="top">
<p>This enables you <a id="id328" class="indexterm"/>
<a id="id329" class="indexterm"/>to select the time range in the track pane. When this has been set, the Instrument displays only the data collected within the specified time period. Using the buttons with this control enables you to set the start and end points of the inspection range, and to clear the current range.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Time / Run control</p>
</td><td style="text-align: left" valign="top">
<p>Shows the time elapsed <a id="id330" class="indexterm"/>
<a id="id331" class="indexterm"/>by the current document trace. If the trace document contains multiple data runs associated with it, you can use the arrow controls to choose which run data you want to display in the track pane.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>The <strong>View</strong> control</p>
</td><td style="text-align: left" valign="top">
<p>Hides or shows the <a id="id332" class="indexterm"/>
<a id="id333" class="indexterm"/>
<strong>Instruments</strong> pane, <strong>Detail</strong> pane, and <strong>Extended</strong> <strong>View</strong> pane. These controls make it easier to only focus on the area in which you are interested in.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<strong>Library</strong>
</p>
</td><td style="text-align: left" valign="top">
<p>Hides or shows the <a id="id334" class="indexterm"/>
<a id="id335" class="indexterm"/>Instruments library window.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<strong>Search</strong>
</p>
</td><td style="text-align: left" valign="top">
<p>This option filters <a id="id336" class="indexterm"/>
<a id="id337" class="indexterm"/>information within the <strong>Detail</strong> pane, based on a search term that you enter.</p>
</td></tr></tbody></table></div><p>The Instruments application is now located inside the Xcode bundle located within the <code class="literal">/Developer/Applications</code> folder and can be launched through the Xcode development IDE.</p><div><div><h3 class="title"><a id="note26"/>Note</h3><p>For more information about using Instruments application to debug your applications, you can refer to the <a id="id338" class="indexterm"/>Apple developer documentation located at:</p><p>
<a class="ulink" href="https://developer.apple.com/library/ios/#documentation/DeveloperTools/Conceptual/InstrumentsUserGuide/Introduction/Introduction.html">https://developer.apple.com/library/ios/#documentation/DeveloperTools/Conceptual/InstrumentsUserGuide/Introduction/Introduction.html</a>
</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec153"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Tracing iOS applications</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Running and profiling a project</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Adding and customizing views</em> recipe in <a class="link" href="ch02.html" title="Chapter 2. User Interfaces – Creating the UI">Chapter 2</a>, <em>User Interfaces – Creating the App UI</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec45"/>Tracing iOS applications</h1></div></div></div><p>In this recipe, we will learn <a id="id339" class="indexterm"/>how to open a project that will be used for profiling its performance.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec154"/>Getting ready</h2></div></div></div><p>In this section, we will start by opening our <strong>TwitterExample</strong> application that we created in our previous chapter.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec155"/>How to do it...</h2></div></div></div><p>To begin tracing an application, follow the following outlined simple steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Launch Xcode from the <code class="literal">/Developer/Applications</code> folder.</li><li class="listitem">Navigate to <strong>File</strong> | <strong>Open</strong>, or alternatively press <em>Command</em> + <em>O</em>.</li><li class="listitem">Next, select the <code class="literal">TwitterExample.xcodeproj</code> file from within the dialog.<div><img src="img/3349_04_05.jpg" alt="How to do it..."/></div></li><li class="listitem">Click on the <strong>Open</strong> button to <a id="id340" class="indexterm"/>continue and load your project into the Xcode workspace environment.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec156"/>How it works...</h2></div></div></div><p>In this recipe, we selected our <code class="literal">TwitterExample</code> application that we created in our previous chapter, which will be used to profile its performance using the Instruments application.</p><p>In our next recipe, we will look at how we can use the System Trace Instrument to profile our application, to track down system calls, memory, and thread calls that may be affecting the overall performance of your iOS application.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec157"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>How to run and profile an iOS project</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>How to detect VM faults</em> recipe</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec46"/>Running and profiling an iOS project</h1></div></div></div><p>In this recipe, we <a id="id341" class="indexterm"/>
<a id="id342" class="indexterm"/>will learn how to use the System Trace Instrument to monitor performance of your applications.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec158"/>Getting ready</h2></div></div></div><p>In this section, we will learn how to run the Instruments application from within the Xcode environment in order to profile our <code class="literal">TwitterExample</code> application.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec159"/>How to do it...</h2></div></div></div><p>To begin profiling our <strong>TwitterExample</strong>, follow the following outlined steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Select the <strong>TwitterExample</strong> option from the <strong>Project Navigator</strong> window.</li><li class="listitem">Navigate to <strong>Product</strong> | <strong>Build For</strong> | <strong>Profiling</strong>, from the <strong>Product</strong> menu, or alternatively use the <a id="id343" class="indexterm"/><a id="id344" class="indexterm"/>keyboard shortcut <em>Shift</em> + <em>Command</em> + <em>I</em>.</li><li class="listitem">Next, choose <strong>Profile</strong> from the <strong>Product</strong> menu to launch the Instruments application. Similarly, you can use the keyboard shortcut <em>Command</em> + <em>I</em>.<div><img src="img/3349_04_06.jpg" alt="How to do it..."/></div></li><li class="listitem">Once this option has been selected, you will eventually see the <strong>Instruments</strong> application window display on your screen. This is shown in the following screenshot:<div><img src="img/3349_04_07.jpg" alt="How to do it..."/></div></li><li class="listitem">Next, choose the <strong>System Trace</strong> <a id="id345" class="indexterm"/>option from the list of available templates.</li><li class="listitem">Click on the <strong>Profile</strong> <a id="id346" class="indexterm"/><a id="id347" class="indexterm"/>button to start profiling our <code class="literal">TwitterExample</code> application.<p>Your application will then be analyzed, and each system call and thread that has been <a id="id348" class="indexterm"/>made to memory will be profiled. These also include <strong>Virtual Memory </strong>(<strong>VM</strong>) operations.</p><p> </p><div><img src="img/3349_04_08.jpg" alt="How to do it..."/></div><p>
</p></li><li class="listitem">After a number of seconds have passed, your trace information will be displayed, and this will <a id="id349" class="indexterm"/><a id="id350" class="indexterm"/>contain information relating to the thread and system calls, and their duration that your application is currently making. Other information, such as VM faults, is also recorded as shown in the following screenshot:<div><img src="img/3349_04_09.jpg" alt="How to do it..."/></div></li></ol></div><p>You can choose to stop the application from profiling by clicking on the <strong>Record</strong> button, since the Instruments application <a id="id351" class="indexterm"/>
<a id="id352" class="indexterm"/>has already done its full analysis.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec160"/>How it works...</h2></div></div></div><p>In this recipe, we learned how to run the Instruments application directly from within the Xcode development environment. We then saw how we can use the System Trace Instrument to profile our application that enables us to monitor system calls, threads, as well as virtual memory faults encountered by the Instruments application.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec161"/>There's more…</h2></div></div></div><p>Along with the System Trace Instrument, the Instruments application contains additional templates that you can use to profile your application against. The following table gives an overview of each of the templates that are available for iOS development:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Template</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Blank</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Creates an empty <a id="id353" class="indexterm"/>
<a id="id354" class="indexterm"/>trace document to which you can add your own combinations of Instruments.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Time Profiler</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Performs <a id="id355" class="indexterm"/>
<a id="id356" class="indexterm"/>low-overhead and time-based sampling of one or all processes.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">System Trace</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Provides you with the <a id="id357" class="indexterm"/>
<a id="id358" class="indexterm"/>ability to profile against different aspects of the operating system that could be affecting application's performance.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Activity Monitor</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This monitors overall <a id="id359" class="indexterm"/>
<a id="id360" class="indexterm"/>CPU, memory, disk, and network activity.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Automation</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Automates user <a id="id361" class="indexterm"/>
<a id="id362" class="indexterm"/>interface tests within your application.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Energy Diagnostics</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Displays diagnostics <a id="id363" class="indexterm"/>
<a id="id364" class="indexterm"/>information regarding the amount of energy being used on the device for GPU activity, display brightness, sleep/wake, Bluetooth, Wi-Fi, and GPS. </p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Network Connections</code>
</p>
</td><td style="text-align: left" valign="top">
<p>With this <a id="id365" class="indexterm"/>
<a id="id366" class="indexterm"/>Instrument, it's possible to see how much data is flowing over each connection, for each application, as well as interesting statistics, such as round trip times and retransmission requests. You can use this information to help reduce network traffic and energy consumption.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Allocations</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Monitors memory and <a id="id367" class="indexterm"/>
<a id="id368" class="indexterm"/>object-allocation patterns within your program.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Leaks</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Detects memory <a id="id369" class="indexterm"/>
<a id="id370" class="indexterm"/>leaks within your application.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Threads</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Analyzes thread <a id="id371" class="indexterm"/>
<a id="id372" class="indexterm"/>state transitions within a process, including running and terminated threads, thread state, and associated back traces.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">File Activity</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Monitors an application's <a id="id373" class="indexterm"/>
<a id="id374" class="indexterm"/>
<a id="id375" class="indexterm"/>interaction with the filesystem.</p>
</td></tr></tbody></table></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec162"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Running and profiling an iOS project</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Detecting Virtual Memory faults</em> recipe</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec47"/>Detecting virtual memory faults</h1></div></div></div><p>In this recipe, we will <a id="id376" class="indexterm"/>learn how to use the Activity Monitor Instrument to monitor performance of your operating system and computer's hard drive.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec163"/>Getting ready</h2></div></div></div><p>In this section, we will learn how to use the Instruments to check the virtual memory to see if thrashing (excessive paging) is occurring or if the VM size is growing excessively, indicating over-retained auto released objects.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec164"/>How to do it...</h2></div></div></div><p>To begin, follow the following outlined simple steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Select the <strong>TwitterExample</strong> option from the <strong>Project Navigator</strong> window.</li><li class="listitem">Navigate to <strong>Product</strong> | <strong>Build For</strong> | <strong>Profiling</strong>, from the <strong>Product</strong> menu, or alternatively using the keyboard shortcut <em>Shift</em> + <em>Command</em> + <em>I</em>.</li><li class="listitem">Next, choose <strong>Profile</strong> from the <strong>Product</strong> menu to launch the Instruments application. Similarly, you can use the keyboard shortcut <em>Command</em> + <em>I</em>.</li><li class="listitem">Next, choose the <strong>Activity Monitor</strong> option<strong> </strong>from the list of available templates. </li><li class="listitem">Click on the <strong>Profile</strong> button to start profiling our <strong>TwitterExample</strong> application.<p>After a number of <a id="id377" class="indexterm"/>seconds have passed, your trace information will be displayed, and this will contain information relating to the overall CPU, memory, disk, and network activity used by your application as shown in the following screenshot:</p><div><img src="img/3349_04_10.jpg" alt="How to do it..."/></div></li></ol></div><p>You can choose to stop the application from profiling by clicking on the <strong>Stop</strong> button, since the Instruments application has already done its full analysis.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec165"/>How it works...</h2></div></div></div><p>In this recipe, we learned how to use the Activity Monitor Instruments component which enables us to check the virtual memory of the OS that can potentially cause the computer system to perform sluggishly. The <a id="id378" class="indexterm"/>previous screenshot displays information relating to the overall load which the system is currently undergoing, as well as the user applications performance and the total virtual memory that is currently being allocated to cache these operations.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec166"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Running and profiling an iOS project</em> recipe</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec48"/>Detecting memory leaks</h1></div></div></div><p>In this recipe, we will learn <a id="id379" class="indexterm"/>
<a id="id380" class="indexterm"/>how to use the Leaks Instrument to check for memory leaks within an iOS application.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec167"/>Getting ready</h2></div></div></div><p>In this section, we will learn how we can quickly determine when a memory leak occurs within our application.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec168"/>How to do it...</h2></div></div></div><p>To begin with creating a new Xcode project, follow these simple steps as outlined below:</p><div><ol class="orderedlist arabic"><li class="listitem">Launch Xcode from the <code class="literal">/Developer/Applications</code> folder.</li><li class="listitem">Choose <strong>Create a new Xcode project</strong>, or navigate to <strong>File</strong> | <strong>New Project</strong>.</li><li class="listitem">Select the <strong>Single View Application</strong> option from the list of available templates.</li><li class="listitem">Click on the <strong>Next</strong> button to proceed to the next step in the wizard.</li><li class="listitem">Next, enter in <code class="literal">MemoryLeaks</code> as the name for your project.</li><li class="listitem">Select <strong>iPhone</strong> from under the <strong>Devices</strong> dropdown.</li><li class="listitem">Ensure the <strong>Use Storyboards</strong> checkbox has not been ticked.</li><li class="listitem">Ensure the <strong>Use Automatic Reference Counting</strong> checkbox has not been ticked.</li><li class="listitem">Ensure the <strong>Include Unit Tests</strong> checkbox has not been ticked.</li><li class="listitem">Click on the <strong>Next</strong> <a id="id381" class="indexterm"/><a id="id382" class="indexterm"/>button to proceed to the next step in the wizard.</li><li class="listitem">Specify where you would like to save your project, and click on the <strong>Create</strong> button to save your project at the location specified.<p>Our next step is to create the code functionality that will be responsible for allocating our string objects.</p></li><li class="listitem">Open the <code class="literal">ViewController.m</code> file implementation file from the <strong>Project Navigator</strong> window.</li><li class="listitem">Modify the <code class="literal">viewDidLoad</code> method as shown by the highlighted code sections in the following code snippet:<div><pre class="programlisting">- (void)viewDidLoad
{
   [super viewDidLoad];
  // Do any additional setup after loading the view, 
   //typically from a nib.
<strong>  NSLog(@"Starting....");</strong>
<strong>  // Loop for 5000 times</strong>
<strong>  for (int i = 1; i &lt;= 5000; i++){</strong>
<strong>    NSString *status = [[NSString </strong>
<strong>         alloc]initWithString:@"Memory Leaking...."];</strong>
<strong>     NSLog(@"Value of i:%i and status:%@", i, status);</strong>
<strong>  }</strong>
<strong>  NSLog(@"Completed...");</strong>
}</pre></div><p>Our next step is to start profiling our project that will help us check for memory leaks.</p></li><li class="listitem">Navigate to <strong>Product</strong> | <strong>Build For</strong> | <strong>Profiling</strong>, from the <strong>Product</strong> menu, or alternatively using the <a id="id383" class="indexterm"/><a id="id384" class="indexterm"/>keyboard shortcut <em>Shift</em> + <em>Command</em> + <em>I</em>.</li><li class="listitem">Then, choose <strong>Profile</strong> from the <strong>Product</strong> menu to launch the Instruments application. Similarly, you can use the keyboard shortcut <em>Command</em> + <em>I</em>.</li><li class="listitem">Next, choose the <strong>Leaks</strong> <a id="id385" class="indexterm"/>option from the list of available templates under the <strong>Memory</strong> section header.<div><img src="img/3349_04_11.jpg" alt="How to do it..."/></div></li><li class="listitem">Click on the <strong>Profile</strong> <a id="id386" class="indexterm"/><a id="id387" class="indexterm"/>button to start profiling our <code class="literal">MemoryLeaks</code> application.<div><img src="img/3349_04_12.jpg" alt="How to do it..."/></div></li></ol></div><p>You can choose to stop the application <a id="id388" class="indexterm"/>
<a id="id389" class="indexterm"/>from profiling by clicking on the <strong>Stop</strong> button, since the Instruments application has already done its full analysis.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec169"/>How it works...</h2></div></div></div><p>In this recipe, we created an application that included a piece of code that allocated 5000 strings inside a loop to demonstrate ways in which memory leaks can happen. The code allocates memory for each new string called <code class="literal">Status</code> each time it goes through the loop, and lets the pointer of each string that gets allocated go out of scope and never be released.</p><p>You will notice that the memory that gets allocated never gets released, which is caused by the tight <code class="literal">for</code> loop starving the execution of <code class="literal">run</code> loop, causing your application to run slowly, potentially causing it to crash or simply hang.</p><p>The screenshot displays information relating to the memory currently allocated, as well as the user applications performance and the total virtual memory that is currently being allocated.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec170"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Running and profiling an IOS project</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Building the user interface for our application</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Getting and Installing the iOS SDK Development Tools">Chapter 1</a>, <em>Getting and Installing the iOS SDK Development Tools</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec49"/>Handling runtime errors</h1></div></div></div><p>In this recipe, we will <a id="id390" class="indexterm"/>learn <a id="id391" class="indexterm"/>how to handle runtime errors within an iOS application.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec171"/>Getting ready</h2></div></div></div><p>In this section, we will learn how we can handle runtime errors and learn how we can improve error handling using the <code class="literal">@try…@catch…@finally</code> clauses to prevent our application from crashing.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec172"/>How to do it...</h2></div></div></div><p>To begin, follow the following simple steps as outlined:</p><div><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">MemoryLeaks.xcodeproj</code> project file.</li><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file from the <strong>Project Navigator</strong> window.</li><li class="listitem">Modify the <code class="literal">viewDidLoad</code> method as shown by the highlighted code sections in the following code snippet:<div><pre class="programlisting">- (void)viewDidLoad
{
   [super viewDidLoad];
<strong>  [self causeRuntimeError];</strong>
}</pre></div></li><li class="listitem">Next, create the <code class="literal">causeRuntimeError</code> method as shown in the following code snippet:<div><pre class="programlisting">-(void)causeRuntimeError
{
   NSLog(@"Runtime Error section started");
  NSMutableArray *myArray = [NSMutableArray   
   array];
  for (int x = 0; x &lt; 30; x++) {
    // Add the value to our Array
    [myArray addObject:[NSNumber numberWithInt:x]];
  }
  // This will cause a Runtime error, as we don't have any
  // item at this index within the array.
  [myArray removeObjectAtIndex:30];
  NSLog(@"Runtime Error section completed.");
}</pre></div></li><li class="listitem">Then, build and run the application by navigating to <strong>Product</strong> | <strong>Run</strong> from the <strong>Product</strong> menu, or alternatively pressing <em>Command</em> + <em>R</em>.<p>You will notice that <a id="id392" class="indexterm"/>once the program executes, an exception <a id="id393" class="indexterm"/>is raised and the code execution stops. The following screenshot shows the exception error details within the Xcode IDE:</p><div><img src="img/3349_04_13.jpg" alt="How to do it..."/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec173"/>How it works...</h2></div></div></div><p>In this recipe, we created a new method <code class="literal">causeRuntimeError</code> that allocated an array to hold the maximum capacity of 30 items. We then cycled through the loop and added the integer values from 0 to 29 into this array. Once, all items have been added, the loop exits and we then attempt to remove an item at the 31st position within the array.</p><p>Since we don't have an object stored at the 31st position within our array, this results in the code execution halting, causing the exception error information display as shown in the previous screenshot.</p><div><div><h3 class="title"><a id="note27"/>Note</h3><p>If you would like to find out more information on the <code class="literal">NSMutableArray</code> class, you can refer to the Apple developer documentation located at the following link:</p><p>
<a class="ulink" href="https://developer.apple.com/library/ios/#documentation/Cocoa/Reference/Foundation/Classes/NSmutableArray_Class/Reference/Reference.html">https://developer.apple.com/library/ios/#documentation/Cocoa/Reference/Foundation/Classes/NSmutableArray_Class/Reference/Reference.html</a>
</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec174"/>There's more...</h2></div></div></div><p>Objective-C provides you with a fail-safe method that can help you handle exception errors that can prevent your application from falling over. Keep in mind, this will still cause an error, but the exception error would have been handled by your application, preventing your app from crashing, and allowing your code to continue executing.</p><p>An exception is a special condition that interrupts the normal flow of program execution. There are a variety of reasons <a id="id394" class="indexterm"/>why an exception may be generated (exceptions are typically said to be raised or thrown), <a id="id395" class="indexterm"/>by hardware as well as software.</p><p>Examples include arithmetical errors such as division by zero, calling undefined instructions (such as attempting to invoke an unimplemented method), and attempting to access a collection element out of bounds.</p><p>Objective-C exception support involves four compiler directives: <code class="literal">@try</code>, <code class="literal">@catch</code>, <code class="literal">@throw</code>, and <code class="literal">@finally</code>, which are explained in the following table:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Objective-C exception handler</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">@catch</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This code block <a id="id396" class="indexterm"/>
<a id="id397" class="indexterm"/>contains exception-handling logic for exceptions thrown in a <code class="literal">@try {}</code> block. You can have multiple <code class="literal">@catch {}</code> blocks to catch different types of exception.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">@throw</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This compiler <a id="id398" class="indexterm"/>
<a id="id399" class="indexterm"/>directive allows you to throw an exception, which is essentially an Objective-C object. You typically use an <code class="literal">NSException</code> object, but you are not required to use it.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">@finally</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This code block <a id="id400" class="indexterm"/>
<a id="id401" class="indexterm"/>must be executed whether or not an exception is thrown and is done after the catch statement finishes.</p>
</td></tr></tbody></table></div><p>Let's take a look at how we can modify our <a id="id402" class="indexterm"/>
<code class="literal">causeRuntimeError</code> method to take advantage of these compiler directives, and prevent our code from crashing:</p><div><ol class="orderedlist arabic"><li class="listitem">Modify the <code class="literal">causeRuntimeError</code> <a id="id403" class="indexterm"/>method as shown by the highlighted code sections in the following code snippet:<div><pre class="programlisting">-(void)causeRuntimeError
{
   NSLog(@"Runtime Error section started");
  NSMutableArray *myArray = [NSMutableArray 
                  array];
  for (int x = 0; x &lt; 30; x++) {
    // Add the value to our Array
    [myArray addObject:[NSNumber numberWithInt:x]];
  }
  // This will cause a Runtime error, as we don't have any
  // item at this index within the array.
<strong>  @try {</strong>
<strong>    [myArray removeObjectAtIndex:30];</strong>
<strong>  }   @catch (NSException *exception) {</strong>
<strong>    NSLog(@"Error: %@", exception);</strong>
<strong>  }</strong>
<strong>  @finally {</strong>
<strong>    NSLog(@"Runtime Error section completed.");</strong>
<strong>  }</strong>
}</pre></div></li><li class="listitem">Next, build and run the application by navigating to <strong>Product</strong> | <strong>Run</strong> from the <strong>Product</strong> menu, or alternatively pressing <em>Command</em> + <em>R</em>.</li></ol></div><p>You will notice that once the program executes, the exception is raised and caught by the <code class="literal">@catch</code> code block, and the <a id="id404" class="indexterm"/>exception error message is logged to the console window, and the code execution continues normally.</p><div><div><h3 class="title"><a id="note28"/>Note</h3><p>If you would like to find out more information on Objective-C exception handling, you can refer to the Apple developer documentation located at the following link:</p><p>
<a class="ulink" href="https://developer.apple.com/library/ios/#documentation/cocoa/conceptual/objectivec/Chapters/ocExceptionHandling.html">https://developer.apple.com/library/ios/#documentation/cocoa/conceptual/objectivec/Chapters/ocExceptionHandling.html</a>
</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec175"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Running and profiling an iOS project</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Building the user interface for our application</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Getting and Installing the iOS SDK Development Tools">Chapter 1</a>, <em>Getting and Installing the iOS SDK Development Tools</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec50"/>Handling compile-time errors</h1></div></div></div><p>In this recipe, we will learn <a id="id405" class="indexterm"/>how to handle compile-time errors within an iOS application.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec176"/>Getting ready</h2></div></div></div><p>In this section, we will learn about compile-time errors and how these can be corrected.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec177"/>How to do it...</h2></div></div></div><p>To begin, follow these simple steps as outlined:</p><div><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">MemoryLeaks.xcodeproj</code> project file.</li><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file from the <strong>Project Navigator</strong> window.<p>Modify the <code class="literal">viewDidLoad</code> <a id="id406" class="indexterm"/>method as shown by the highlighted code sections in the following code snippet:</p><div><pre class="programlisting">- (void)viewDidLoad
{
   [super viewDidLoad];
<strong>  [self causeCompileTimeError];</strong>
}</pre></div></li><li class="listitem">Next, create <a id="id407" class="indexterm"/>the <code class="literal">causeCompileTimeError</code> method as shown in the following code snippet below:<div><pre class="programlisting">-(void)causeCompileTimeError
{
   NSLog(@"Compile-time Error section started");
   // This will cause a Compile-time error, as we don't have
   // a color called BlueColor
   self.view.backgroundColor = [UIColor BlueColor]; 
	NSLog(@"Compile-time Error section completed.");
}</pre></div><p>You will notice that the compiler notifies you that the nonexistent method could not be found. The screenshot below shows the compiler error details within the Xcode IDE.</p><div><img src="img/3349_04_14.jpg" alt="How to do it..."/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec178"/>How it works...</h2></div></div></div><p>In this recipe, we created a new method <code class="literal">causeCompiletimeError</code> that sets the background color of the view to blue. We use the <a id="id408" class="indexterm"/>
<code class="literal">UIColor</code> class to set and specify the color that we would like the background color of our view to take on.</p><p>We received a compiler warning letting us know of the non-existent method that we used. These types of errors are most obvious and generally these come from typographical errors, but can be fixed easily using code auto-completion within Xcode.</p><p>The Objective-C compiler is <a id="id409" class="indexterm"/>case sensitive, which means that <code class="literal">UIcolor</code> and <code class="literal">UIColor</code> are treated differently. For example, in Objective-C, the compiler can understand the following line of code:</p><div><pre class="programlisting">self.view.backgroundColor = [UIColor blueColor];</pre></div><p>But, if you type in the following as we did in our method definition, the compiler warns you about a potential (but not definite) problem, because you've specified a language-specific syntax that it can't recognize and therefore is not associated with the <code class="literal">UIColor</code> class:</p><div><pre class="programlisting">self.view.backgroundColor = [UIColor BlueColor];</pre></div><div><div><h3 class="title"><a id="note29"/>Note</h3><p>If you would like to find out more information on the <code class="literal">UIColor</code> class, you can refer to the Apple developer documentation located at the following link:</p><p>
<a class="ulink" href="https://developer.apple.com/library/ios/#documentation/uikit/reference/UIColor_Class/Reference/Reference.html">https://developer.apple.com/library/ios/#documentation/uikit/reference/UIColor_Class/Reference/Reference.html</a>
</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec179"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Running and profiling an iOS project</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Building the user interface for our application</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Getting and Installing the iOS SDK Development Tools">Chapter 1</a>, <em>Getting and Installing the iOS SDK Development Tools</em></li><li class="listitem" style="list-style-type: disc">The <em>Adding and customizing views</em> recipe in <a class="link" href="ch02.html" title="Chapter 2. User Interfaces – Creating the UI">Chapter 2</a>, <em>User Interfaces – Creating the UI</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec51"/>Adding and configuring Instruments</h1></div></div></div><p>The Instruments <a id="id410" class="indexterm"/>
<a id="id411" class="indexterm"/>application comes with a wide range of built-in Instruments to make your job easier, by using them to gather data from one or more processes. Most of these Instruments require little configuration to use, and are simply added to your trace document to start gathering trace data. In this recipe, we will look at how we can add and configure Instruments into an existing trace document.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec180"/>Getting ready</h2></div></div></div><p>In this section, we will learn how to add and configure Instruments.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec181"/>How to do it...</h2></div></div></div><p>To learn how to add and <a id="id412" class="indexterm"/>
<a id="id413" class="indexterm"/>configure Instruments, follow the following steps outlined:</p><div><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">MemoryLeaks.xcodeproj</code> project file.</li><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file from the <strong>Project Navigator</strong> window.</li><li class="listitem">Modify the <code class="literal">viewDidLoad</code> method as shown in the following code snippet:<div><pre class="programlisting">- (void)viewDidLoad
{
    [super viewDidLoad];
  // Do any additional setup after loading the view, 
   // typically from a nib.
  NSLog(@"Starting....");
  // Loop for 5000 times
  for (int i = 1; i &lt;= 5000; i++){
    NSString *status = [[NSString 
              alloc]initWithString:@"Memory Leaking...."];
    NSLog(@"Value of i: - %i and status - %@", i, status);
  }
  NSLog(@"Completed..."); 
}</pre></div></li><li class="listitem">Navigate to <strong>Product</strong> | <strong>Build For</strong> | <strong>Profiling</strong>, from the <strong>Product</strong> menu, or alternatively use the keyboard shortcut <em>Shift</em> + <em>Command</em> + <em>I</em>.</li><li class="listitem">Then, choose <strong>Profile</strong> from the <strong>Product</strong> menu to launch the Instruments application. Similarly, you can use the keyboard shortcut <em>Command</em> + <em>I</em>.</li><li class="listitem">Next, choose the <strong>Blank</strong> <a id="id414" class="indexterm"/>option<strong> </strong>from the list of available templates under the <strong>Memory</strong> section header.</li><li class="listitem">Finally, click on the <strong>Profile</strong> button to begin profiling.</li></ol></div><p>The Instruments <strong>Library</strong> list displays all of the Instruments that you can use and add to your trace document. The library contains all of the built-in Instruments that come with the installation of Xcode 4, as well as any custom Instruments that you have already created.</p><p>To open the <strong>Instruments</strong> window, follow the following simple steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Click on the <strong>Library</strong> button from within your trace document window, or navigate to <strong>Window</strong> | <strong>Library</strong> from the menu bar. Alternatively, you can use the <em>Command</em> + <em>L</em> keyboard shortcut.</li><li class="listitem">Next, choose the <strong>Memory</strong> <a id="id415" class="indexterm"/><a id="id416" class="indexterm"/>option from within the drop-down list as shown in the following screenshot:<div><img src="img/3349_04_15.jpg" alt="How to do it..."/></div></li><li class="listitem">To add an Instrument, select the Instrument from the Instruments Library list, and then drag it either to the <strong>Instruments</strong> pane, or directly onto the <strong>Track</strong> pane of your trace document, as shown in the following screenshot:<div><img src="img/3349_04_16.jpg" alt="How to do it..."/></div></li><li class="listitem">Then, click on the <strong>Record</strong> button to start profiling the <strong>MemoryLeaks</strong> application.</li><li class="listitem">To configure an Instrument, select the Instrument from the <strong>Instruments</strong> pane and click on the Instruments <a id="id417" class="indexterm"/><a id="id418" class="indexterm"/>inspector icon, which is located to the right of the Instrument as shown in the following screenshot:<div><img src="img/3349_04_17.jpg" alt="How to do it..."/></div></li><li class="listitem">To dismiss the Inspector, click on the close button highlighted by an <strong>X</strong>. You can similarly use the <em>Command</em> + <em>I</em> keys or navigate to <strong>File</strong> | <strong>Get Info</strong> to open and close this window.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec182"/>How it works...</h2></div></div></div><p>In this recipe, we learned how easy it is to add and configure Instruments within a trace document using the Instruments inspector. The options listed vary based on the type of Instrument that is being configured. Most Instruments contain options for configuring the contents of the track pane, while only a small handful contain additional functionality for determining what type of information is gathered by the Instrument.</p><p>Depending on the type of Instrument that is being configured, they can be configured before, during, or after the data within your trace document has been recorded. The <strong>Zoom</strong> control can be found in most of the Inspector controls for those Instruments, which you configure. This feature controls the <a id="id419" class="indexterm"/>
<a id="id420" class="indexterm"/>magnification of the trace data that is displayed within the <strong>Track</strong> pane, and adjusts the height of the Instrument within the <strong>Track</strong> pane.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec183"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Running and profiling an iOS project</em> recipe</li></ul></div></div></div></body></html>