<html><head></head><body><div class="chapter" title="Chapter&#xA0;13.&#xA0;Localization"><div class="titlepage"><div><div><h1 class="title"><a id="ch13"/>Chapter 13. Localization</h1></div></div></div><p>In this chapter, we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating an application for different languages</li><li class="listitem" style="list-style-type: disc">Localizable resources</li><li class="listitem" style="list-style-type: disc">Regional formatting</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec01"/>Introduction</h1></div></div></div><p>With the release of the iOS platform and the global software marketplace in the form of the application store, Apple has made it easier for developers to distribute applications worldwide.</p><p>But, users worldwide will not even bother to download and use an application that is released in a language they do not understand. To broaden the user base for their applications, developers have to localize it. Localization is the process of translating text into multiple languages, providing resources specific to multiple regions, thus creating an application that will target audiences of different cultures.<a id="id976" class="indexterm"/>
</p><p>In this chapter, we will discuss the best practices to provide translated text that will be displayed according to each user's locale preferences. We will also see how to provide resources (images, videos) based on these preferences. Finally, we will use common .NET practices for formatting dates, currencies, and numbers.</p></div></div>
<div class="section" title="Creating an application for different languages"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec02"/>Creating an application for different languages</h1></div></div></div><p>In this recipe, we will create an application that will support two different languages.<a id="id977" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec01"/>Getting ready</h2></div></div></div><p>Create a new project in MonoDevelop, and name it<code class="literal"> MultipleLanguageApp</code>.<a id="id979" class="indexterm"/>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec02"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Add two labels on the view of<code class="literal"> MainController</code>.</li><li class="listitem"> Add two folders to the project. Name them<code class="literal"> en.lproj</code> and<code class="literal"> es.lproj</code> respectively.</li><li class="listitem"> Create two text files with a text editor application. Enter the following text in the first file:<div class="informalexample"><pre class="programlisting">// Localized output on MainController
"Have a nice day!" = "Have a nice day!";
</pre></div></li><li class="listitem">Save it as Localizable.strings inside the en.lproj folder.</li><li class="listitem"> Enter the following text in the second file:<div class="informalexample"><pre class="programlisting">// Localized output on MainController
"Have a nice day!" = "Tenga un buen día!";
</pre></div></li><li class="listitem">Save it with the same name, Localizable.strings, inside the es.lproj folder this time. Set both files' <span class="strong"><strong>Build Action</strong></span> to <span class="strong"><strong>Content.
</strong></span><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note47"/>Note</h3><p>The<code class="literal"> Localizable.strings</code> files must be saved in either<code class="literal"> UTF8</code> or<code class="literal"> UTF16</code> encodings.</p></div></li><li class="listitem"> Enter the following code in the<code class="literal"> MainController</code> class:<div class="informalexample"><pre class="programlisting">public override void ViewWillAppear (bool animated){
base.ViewWillAppear (animated);
this.lblLocale.Text = string.Format("Locale: {0} - Language: {1}", NSLocale.CurrentLocale.LocaleIdentifier, NSLocale.PreferredLanguages[0]);
string resourcePath = NSBundle.MainBundle.PathForResource( NSLocale.PreferredLanguages[0], "lproj");
NSBundle localeBundle = NSBundle.FromPath(resourcePath);
this.lblLocalizedOutput.Text = localeBundle.LocalizedString("Have a nice day!", "Localized output on MainController");
}
</pre></div></li><li class="listitem"> Through the<span class="strong"><strong> settings</strong></span> application on the simulator, set the language to<span class="strong"><strong> English</strong></span> (if it is not set already), and run the application. The message will be displayed in English. Try setting the language of the simulator to<span class="strong"><strong> Spanish</strong></span>, and run the application again. The message will be displayed in Spanish.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec03"/>How it works...</h2></div></div></div><p>To make it easy for developers to provide support for multiple languages in applications, iOS reads text in different languages from the corresponding language folder. In this application, we support both English and Spanish. Their corresponding folders are<code class="literal"> en.lproj</code> and<code class="literal"> es.lproj</code>, respectively. When we call the<code class="literal"> LocalizedString</code> method, it looks for and parses the file<code class="literal"> Localizable.strings</code> to return the appropriate text.<a id="id980" class="indexterm"/>
</p><p>The contents of the strings files are defined by a set of quoted key/value pairs, in a C style syntax, ending each set with a semicolon:</p><div class="informalexample"><pre class="programlisting">// Localized output on MainController
"Have a nice day!" = "Have a nice day!";
</pre></div><p>As you can see, we can also provide comments to assist the job of the person that will translate the text, even if we do it ourselves.</p><p>The<code class="literal"> NSLocale.PreferredLanguages</code> static property returns a string array of the user's preferred language identifiers. The first item in this array is the currently selected language. If the selected language is<span class="strong"><strong> English</strong></span>, it will return<code class="literal"> en</code>; if it is<span class="strong"><strong> Spanish</strong></span>, it will return<code class="literal"> es</code>, and so on.<a id="id981" class="indexterm"/>
</p><p>The<code class="literal"> NSBundle.PathForResource</code> method returns the path of the application bundle for the parameters we pass to it. We use this path to get the appropriate<code class="literal"> NSBundle</code> instance, according to the selected language:<a id="id982" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">string resourcePath = NSBundle.MainBundle.PathForResource( NSLocale.PreferredLanguages[0], "lproj");
NSBundle localeBundle = NSBundle.FromPath(resourcePath);
</pre></div><p>We then call the<code class="literal"> LocalizedString</code> method to display the appropriate text:</p><div class="informalexample"><pre class="programlisting">this.lblLocalizedOutput.Text = localeBundle.LocalizedString("Have a nice day!", "Localized output on MainController");
</pre></div><p>The first parameter's purpose is dual. It is not only the key to look for to return the translated text, but also the text that will be displayed in case the specified localization path is not found. The second parameter is the comment, or any instruction we want to give to the translator. It is not displayed and basically not used. We can pass<code class="literal"> null</code> to this parameter and no error will occur. It is wise, however, to always include a comment or instruction, since it will help avoid confusion when translating multiple strings.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec04"/>There's more...</h2></div></div></div><p>It is advisable to always provide keys that can act as the fallback text to be displayed in<span class="strong"><strong> English</strong></span>, in case the language the user has selected is not included in our application.</p><p>However, the<code class="literal"> LocalizedString</code> method is overloaded. The second overload accepts three parameters. Consider the following example:</p><div class="informalexample"><pre class="programlisting">this.lblLocalizedOutput.Text = localeBundle.LocalizedString("Have a nice day!", "Have a nice day!", "Localizable");
</pre></div><p>The first parameter is the key to look for. The second parameter is the fallback value, in case the specified localization path is not found. The third parameter is the name of the file containing the strings, without the<code class="literal"> .strings</code> extension. This overload is more helpful, and we can use different keys for our strings that will help us identify where that particular string is used in the code. For example, in this case, we could set the key in the strings file to<code class="literal"> MainController.lblLocalizedOutput:</code>
</p><div class="informalexample"><pre class="programlisting">// Localized output on MainController
"MainController.lblLocalizedOutput" = "Have a nice day!";
</pre></div><p>And use it in our code as follows:</p><div class="informalexample"><pre class="programlisting">this.lblLocalizedOutput.Text = localeBundle.LocalizedString( "MainController.lblLocalizedOutput", "Have a nice day!", "Localizable");
</pre></div><p>This overload also helps us separate our strings into multiple<code class="literal"> .strings</code> files, passing the corresponding file name as parameter #3.<a id="id983" class="indexterm"/>
</p><p>The last overload contains four parameters. The first three are the same as the second overload. The fourth parameter is simply the comment we want the particular string to have.</p><div class="section" title="Localization in real-world application scenarios"><div class="titlepage"><div><div><h3 class="title"><a id="ch13lvl3sec01"/>Localization in real-world application scenarios</h3></div></div></div><p>In this example, we use the<code class="literal"> PathForResource</code> method to get an instance of the current locale bundle. This is because the values returned from the<code class="literal"> LocalizedString</code> method are cached. In real-world application scenarios, where the application would be downloaded in a specific language and the user would most likely never change the language of the device to use it, just calling<code class="literal"> NSBundle.MainBundle.LocalizedString</code> would be enough.<a id="id984" class="indexterm"/>
</p></div></div></div>
<div class="section" title="Localizable resources"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec04"/>Localizable resources</h1></div></div></div><p>A localizable resource is content, such as images, sound files, and so on, which is specific to a locale. In this recipe, we will learn how to load and display resources, based on the user's localization preferences.<a id="id985" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec05"/>Getting ready</h2></div></div></div><p>Create a new project in MonoDevelop, and name it<code class="literal"> LocalizableResourcesApp</code>. Add a label and a<code class="literal"> UIImageView</code> on the view of<code class="literal"> MainController.</code>
<a id="id986" class="indexterm"/>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec06"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Add two folders for<span class="strong"><strong> English</strong></span> and<span class="strong"><strong> Spanish</strong></span> locales to the project. Add one image in each folder, with the same filename. Set their<span class="strong"><strong> Build Action</strong></span> to<span class="strong"><strong> Content</strong></span>.</li><li class="listitem"> Enter the following code in the<code class="literal"> MainController</code> class:<div class="informalexample"><pre class="programlisting">public override void ViewWillAppear (bool animated){
base.ViewWillAppear (animated);
this.lblLanguage.Text = NSLocale.PreferredLanguages[0];
this.imageView.Image = UIImage.FromFile(NSBundle. MainBundle.PathForResource("flag", "jpg"));
}
</pre></div></li><li class="listitem"> Compile and run the application on the simulator with<span class="strong"><strong> English</strong></span> language selected in the<span class="strong"><strong> settings</strong></span> application. The result should be similar to the following screenshot:<div class="mediaobject"><img src="graphics/1468EXP_13_01.jpg" alt="How to do it..."/></div></li><li class="listitem"> Now, set the simulator's language to<span class="strong"><strong> Spanish</strong></span>, and run the application again. The Spanish flag should be displayed instead:<a id="id987" class="indexterm"/></li></ol></div><div class="mediaobject"><img src="graphics/1468EXP_13_02.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec07"/>How it works...</h2></div></div></div><p>The<code class="literal"> PathForResource</code> method automatically searches for the appropriate language folder and loads the resource specified through its arguments. In this example, we pass the method's result to the<code class="literal"> UIImage.FromFile</code> method to load the image and assign it to the image view's<code class="literal"> Image</code> property.<a id="id988" class="indexterm"/>
</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec08"/>There's more...</h2></div></div></div><p>Apart from images, we can use the<code class="literal"> PathForResource</code> method to load videos, PDF files, and any other localizable resource we need.<a id="id989" class="indexterm"/>
</p><div class="section" title="More info on localizable resources"><div class="titlepage"><div><div><h3 class="title"><a id="ch13lvl3sec02"/>More info on localizable resources</h3></div></div></div><p>We need to make sure that the resource for the specific language folder exists. If it does not, an exception will occur. A way to avoid this is to add one universal image file in the project and use a<code class="literal"> Localizable.strings</code> file inside each language folder containing the paths to the resources:<a id="id990" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">// US flag image
"flag_path"="en.lproj/flag.jpg";
</pre></div><p>To load the appropriate flag, we load the image with the<code class="literal"> LocalizedString</code> method:</p><div class="informalexample"><pre class="programlisting">this.Image = UIImage.FromFile(NSBundle.MainBundle.LocalizedString( "flag_path", "path/to/universal/image.jpg", "Localizable");
</pre></div><p>This way, the image<code class="literal"> image.jpg</code> is loaded if the corresponding language folder is not found.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec09"/>See also</h2></div></div></div><p>In this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Creating an application for different languages</em></span></li></ul></div></div></div>
<div class="section" title="Regional formatting"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec05"/>Regional formatting</h1></div></div></div><p>Regional formatting is how various information, such as currency, date and time, and so on, is displayed according to different regions of the world. In this recipe, we will discuss how to display formatted numbers and dates according to the user's regional formatting settings.<a id="id991" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec10"/>Getting ready</h2></div></div></div><p>Create a new project in MonoDevelop and name it<code class="literal"> RegionalFormattingApp</code>.<a id="id992" class="indexterm"/>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec11"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Add five labels on the view of<code class="literal"> MainController</code>. Enter the following code in the<code class="literal"> MainController</code> class:<a id="id993" class="indexterm"/><div class="informalexample"><pre class="programlisting">public override void ViewDidAppear (bool animated){
base.ViewDidAppear (animated);
this.lblLocale.Text = string.Format("Locale: {0}", NSLocale.CurrentLocale.LocaleIdentifier);
this.lblDate.Text = string.Format("Date: {0}", DateTime.Now.ToLongDateString());
this.lblTime.Text = string.Format("Time: {0}", DateTime.Now.ToLongTimeString());
this.lblCurrency.Text = string.Format("Currency: {0:c}", 250);
this.lblNumber.Text = string.Format("Number: {0:n}", 1350);
}
</pre></div></li><li class="listitem"> Compile and run the application on the simulator with regional formatting set to<span class="strong"><strong> United States and Spanish | Spain</strong></span> under<span class="strong"><strong> Settings | General | International | Region Format</strong></span>. The output with the two different regional formats will be something like in the following screenshots:</li></ol></div><div class="mediaobject"><img src="graphics/1468EXP_13_03.jpg" alt="How to do it..."/></div><div class="mediaobject"><img src="graphics/1468EXP_13_04.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec12"/>How it works...</h2></div></div></div><p>To format dates, currencies, and numbers, we use standard .NET code. For date and time, the<code class="literal"> DateTime.ToLongDateString</code> and<code class="literal"> DateTime.ToLongTimeString</code> methods return the values according to the locale, respectively.<a id="id994" class="indexterm"/>
</p><p>For currency and numbers, we use C# numerical strings:<a id="id995" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">this.lblCurrency.Text = string.Format("Currency: {0:c}", 250);
this.lblNumber.Text = string.Format("Number: {0:n}", 1350);
</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec13"/>There's more...</h2></div></div></div><p>The<code class="literal"> System.Globalization</code> namespace is supported in MonoTouch. To display the current locale, consider the following line of code:<a id="id996" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">Console.WriteLine(CultureInfo.CurrentCulture.Name);
</pre></div><p>Note that there is one difference between this code and the<code class="literal"> NSLocale.CurrentLocale.LocaleIdentifier</code>. The former uses a dash (-), while the latter uses an underscore (_) in the locale name.</p></div></div></body></html>