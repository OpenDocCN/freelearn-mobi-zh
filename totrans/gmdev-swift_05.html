<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Spawning Enemies, Coins, and Power-ups"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Spawning Enemies, Coins, and Power-ups</h1></div></div></div><p>One of the most enjoyable and creative aspects of game development is building the game world for your players to explore. Our young project is starting to resemble a playable game after adding the controls; the next step is to build more content. We will create additional classes for new enemies, collectible coins, and special power-ups that give Pierre Penguin a boost as he navigates the perils of our world. We can then develop a system to spawn increasingly difficult patterns of these game objects as the player advances.</p><p>The topics in this chapter include:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Adding the power-up star</li><li class="listitem" style="list-style-type: disc">A new enemy – the mad fly</li><li class="listitem" style="list-style-type: disc">Another terror – bats!</li><li class="listitem" style="list-style-type: disc">The spooky ghost</li><li class="listitem" style="list-style-type: disc">Guarding the ground with the blade</li><li class="listitem" style="list-style-type: disc">Adding coins</li><li class="listitem" style="list-style-type: disc">Testing the new game objects</li></ul></div><div class="section" title="Introducing the cast"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec42"/>Introducing the cast</h1></div></div></div><p>Strap on your hard hat, we <a id="id173" class="indexterm"/>are going to be writing a lot of code in this chapter. Stick with it! The results are well worth the effort. Meet the new cast of characters we will be introducing in this chapter:</p><div class="mediaobject"><img src="graphics/4532_05_01.jpg" alt="Introducing the cast"/></div><div class="section" title="Adding the power-up star"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec59"/>Adding the power-up star</h2></div></div></div><p>Many <a id="id174" class="indexterm"/>of my favorite games grant temporary invulnerability when <a id="id175" class="indexterm"/>the player picks up a star. We will add a hyperactive star power-up to our game. Meet our star:</p><div class="mediaobject"><img src="graphics/4532_05_03.jpg" alt="Adding the power-up star"/></div><div class="section" title="Locating the art assets"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec13"/>Locating the art assets</h3></div></div></div><p>You can<a id="id176" class="indexterm"/> find the art assets for power-up stars and coins inside the <code class="literal">goods.atlas</code> texture atlas in the <code class="literal">Coins</code> and <code class="literal">Powerups</code> folder of the assets bundle. Add the <code class="literal">goods.atlas</code> texture atlas to your project now.</p></div><div class="section" title="Adding the Star class"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec14"/>Adding the Star class</h3></div></div></div><p>Once the art <a id="id177" class="indexterm"/>is in place, you can create a new Swift file named <code class="literal">Star.swift</code> in your project; we will continue to organize classes into distinct files. The <code class="literal">Star</code> class will be similar to the <code class="literal">Bee</code> class we created earlier; it will inherit from <code class="literal">SKSpriteNode</code> and adhere to our <code class="literal">GameSprite</code> protocol. The star will add a lot of power to the player, so we will also give it a special <code class="literal">SKAction</code>-based zany animation to make it stand out.</p><p>To create the <code class="literal">Star</code> class, add the following code in your <code class="literal">Star.swift</code> file:</p><div class="informalexample"><pre class="programlisting">import SpriteKit

class Star: SKSpriteNode, GameSprite {
    var textureAtlas:SKTextureAtlas = 
        SKTextureAtlas(named:"goods.atlas")
    var pulseAnimation = SKAction()
    
    func spawn(parentNode:SKNode, position: CGPoint,
        size: CGSize = CGSize(width: 40, height: 38)) {
        parentNode.addChild(self)
        createAnimations()
        self.size = size
        self.position = position
        self.physicsBody = SKPhysicsBody(circleOfRadius: 
            size.width / 2)
        self.physicsBody?.affectedByGravity = false
        // Since the star texture is only one frame, set it here:
        self.texture = 
            textureAtlas.textureNamed("power-up-star.png")
        self.runAction(pulseAnimation)
    }
    
    func createAnimations() {
        // Scale the star smaller and fade it slightly:
        let pulseOutGroup = SKAction.group([
            SKAction.fadeAlphaTo(0.85, duration: 0.8),
            SKAction.scaleTo(0.6, duration: 0.8),
            SKAction.rotateByAngle(-0.3, duration: 0.8)
            ]);
        // Push the star big again, and fade it back in:
        let pulseInGroup = SKAction.group([
            SKAction.fadeAlphaTo(1, duration: 1.5),
            SKAction.scaleTo(1, duration: 1.5),
            SKAction.rotateByAngle(3.5, duration: 1.5)
            ]);
        // Combine the two into a sequence:
        let pulseSequence = SKAction.sequence([pulseOutGroup, 
            pulseInGroup])
        pulseAnimation = 
            SKAction.repeatActionForever(pulseSequence)
    }
    
    func onTap() {}
}</pre></div><p>Great! You <a id="id178" class="indexterm"/>should be familiar with most of this code at this point, since it is so similar to some of the other classes we have made. Let's continue by adding another new character: a grumpy fly.</p></div></div><div class="section" title="Adding a new enemy – the mad fly"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec60"/>Adding a new enemy – the mad fly</h2></div></div></div><p>Pierre Penguin <a id="id179" class="indexterm"/>will need to dodge more than just bees to accomplish his goal. We<a id="id180" class="indexterm"/> will add a few new enemies in this chapter, starting with the <code class="literal">MadFly</code> class. The mad fly is quite grumpy, as you can see:</p><div class="mediaobject"><img src="graphics/4532_05_04.jpg" alt="Adding a new enemy – the mad fly"/></div><div class="section" title="Locating the enemy assets"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec15"/>Locating the enemy assets</h3></div></div></div><p>You can <a id="id181" class="indexterm"/>find all of the art for our new enemies in the <code class="literal">Enemies</code> folder of the asset bundle, in the <code class="literal">enemies.atlas</code> texture atlas. Add this texture atlas to your project now.</p></div><div class="section" title="Adding the MadFly class"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec16"/>Adding the MadFly class</h3></div></div></div><p>
<code class="literal">MadFly</code> is another <a id="id182" class="indexterm"/>straightforward class; it looks a lot like the <code class="literal">Bee</code> code. Create a new Swift file named <code class="literal">MadFly.swift</code> and enter this code:</p><div class="informalexample"><pre class="programlisting">import SpriteKit

class MadFly: SKSpriteNode, GameSprite {
    var textureAtlas:SKTextureAtlas = 
        SKTextureAtlas(named:"enemies.atlas")
    var flyAnimation = SKAction()
    
    func spawn(parentNode:SKNode, position: CGPoint,
        size: CGSize = CGSize(width: 61, height: 29)) {
        parentNode.addChild(self)
        createAnimations()
        self.size = size
        self.position = position
        self.runAction(flyAnimation)
        self.physicsBody = SKPhysicsBody(circleOfRadius: 
            size.width / 2)
        self.physicsBody?.affectedByGravity = false
    }
    
    func createAnimations() {
        let flyFrames:[SKTexture] = [
            textureAtlas.textureNamed("mad-fly-1.png"),
            textureAtlas.textureNamed("mad-fly-2.png")
        ]
        let flyAction = SKAction.animateWithTextures(flyFrames, 
            timePerFrame: 0.14)
        flyAnimation = SKAction.repeatActionForever(flyAction)
    }
    
    func onTap() {}
}</pre></div><p>Congratulations, you<a id="id183" class="indexterm"/> have successfully implemented the mad fly. No time to celebrate – onward to the bats!</p></div></div><div class="section" title="Another terror – bats!"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec61"/>Another terror – bats!</h2></div></div></div><p>We are <a id="id184" class="indexterm"/>getting into quite a rhythm with creating new classes. Now, we will add a bat to<a id="id185" class="indexterm"/> swarm with the bees. The bat is small, but has a very sharp fang:</p><div class="mediaobject"><img src="graphics/4532_05_05.jpg" alt="Another terror – bats!"/></div><div class="section" title="Adding the Bat class"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec17"/>Adding the Bat class</h3></div></div></div><p>To add the <code class="literal">Bat</code> class, create<a id="id186" class="indexterm"/> a file named <code class="literal">Bat.swift</code> and add this code:</p><div class="informalexample"><pre class="programlisting">import SpriteKit

class Bat: SKSpriteNode, GameSprite {
    var textureAtlas:SKTextureAtlas = 
        SKTextureAtlas(named:"enemies.atlas")
    var flyAnimation = SKAction()
    
    func spawn(parentNode:SKNode, position: CGPoint,
        size: CGSize = CGSize(width: 44, height: 24)) {
        parentNode.addChild(self)
        createAnimations()
        self.size = size
        self.position = position
        self.runAction(flyAnimation)
        self.physicsBody = SKPhysicsBody(circleOfRadius: 
            size.width / 2)
        self.physicsBody?.affectedByGravity = false
    }
    
    func createAnimations() {
        // The Bat has 4 animation textures:
        let flyFrames:[SKTexture] = [
            textureAtlas.textureNamed("bat-fly-1.png"),
            textureAtlas.textureNamed("bat-fly-2.png"),
            textureAtlas.textureNamed("bat-fly-3.png"),
            textureAtlas.textureNamed("bat-fly-4.png"),
            textureAtlas.textureNamed("bat-fly-3.png"),
            textureAtlas.textureNamed("bat-fly-2.png")
        ]
        let flyAction = SKAction.animateWithTextures(flyFrames, 
            timePerFrame: 0.06)
        flyAnimation = SKAction.repeatActionForever(flyAction)
    }
    
    func onTap() {}
}</pre></div><p>Now that you have <a id="id187" class="indexterm"/>created the <code class="literal">Bat</code> class, there are two more enemies to add. We will add the <code class="literal">Ghost</code> class next.</p></div></div><div class="section" title="The spooky ghost"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec62"/>The spooky ghost</h2></div></div></div><p>We <a id="id188" class="indexterm"/>will <a id="id189" class="indexterm"/>complement the bat with another spooky enemy: the Ghost as seen here:</p><div class="mediaobject"><img src="graphics/4532_05_06.jpg" alt="The spooky ghost"/></div><p>Instead of animating through multiple frames, we will use actions to animate the ghost's single frame.</p><div class="section" title="Adding the Ghost class"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec18"/>Adding the Ghost class</h3></div></div></div><p>As with the <a id="id190" class="indexterm"/>other classes, create a new file in your project, <code class="literal">Ghost.swift</code>, and then add the following code:</p><div class="informalexample"><pre class="programlisting">import SpriteKit

class Ghost: SKSpriteNode, GameSprite {
    var textureAtlas:SKTextureAtlas = 
        SKTextureAtlas(named:"enemies.atlas")
    var fadeAnimation = SKAction()
    
    func spawn(parentNode:SKNode, position: CGPoint,
        size: CGSize = CGSize(width: 30, height: 44)) {
        parentNode.addChild(self)
        createAnimations()
        self.size = size
        self.position = position
        self.physicsBody = SKPhysicsBody(circleOfRadius: 
            size.width / 2)
        self.physicsBody?.affectedByGravity = false
        self.texture = 
            textureAtlas.textureNamed("ghost-frown.png")
        self.runAction(fadeAnimation)
        // Start the ghost semi-transparent:
        self.alpha = 0.8;
    }
    
    func createAnimations() {
        // Create a fade out action group:
        // The ghost becomes smaller and more transparent.
        let fadeOutGroup = SKAction.group([
            SKAction.fadeAlphaTo(0.3, duration: 2),
            SKAction.scaleTo(0.8, duration: 2)
            ]);
        // Create a fade in action group:
        // The ghost returns to full size and transparency.
        let fadeInGroup = SKAction.group([
            SKAction.fadeAlphaTo(0.8, duration: 2),
            SKAction.scaleTo(1, duration: 2)
            ]);
        // Package the groups into a sequence, then a 
        // repeatActionForever action:
        let fadeSequence = SKAction.sequence([fadeOutGroup, 
            fadeInGroup])
        fadeAnimation = SKAction.repeatActionForever(fadeSequence)
    }
    
    func onTap() {}
}</pre></div><p>Perfect. Our<a id="id191" class="indexterm"/> ghost is ready for action. We have added a lot of flying enemies to chase Pierre Penguin through the sky. We need a ground-based enemy that will prevent the player from taking an easy path just above the ground. Next, we will add the <code class="literal">Blade</code> class.</p></div></div><div class="section" title="Guarding the ground – adding the blade"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec63"/>Guarding the ground – adding the blade</h2></div></div></div><p>The<a id="id192" class="indexterm"/> <code class="literal">Blade</code> class <a id="id193" class="indexterm"/>will keep Pierre from flying too low. This enemy class will be similar to the others we have created, with one exception: we will generate a physics body based on the texture. The physics body circles that we have been using are much faster computationally and are usually sufficient to describe the shapes of our enemies; the <code class="literal">Blade</code> class <a id="id194" class="indexterm"/>requires a more complicated physics body, given its half-circle shape and bumpy edges:</p><div class="mediaobject"><img src="graphics/4532_05_07.jpg" alt="Guarding the ground – adding the blade"/></div><div class="section" title="Adding the Blade class"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec19"/>Adding the Blade class</h3></div></div></div><p>To add the <a id="id195" class="indexterm"/>
<code class="literal">Blade</code> class, create a new file named <code class="literal">Blade.swift</code> and add the following code:</p><div class="informalexample"><pre class="programlisting">import SpriteKit

class Blade: SKSpriteNode, GameSprite {
    var textureAtlas:SKTextureAtlas = 
        SKTextureAtlas(named:"enemies.atlas")
    var spinAnimation = SKAction()
    
    func spawn(parentNode:SKNode, position: CGPoint,
        size: CGSize = CGSize(width: 185, height: 92)) {
        parentNode.addChild(self)
        self.size = size
        self.position = position
        // Create a physics body shaped by the blade texture:
        self.physicsBody = SKPhysicsBody(
            texture: textureAtlas.textureNamed("blade-1.png"),
            size: size)
        self.physicsBody?.affectedByGravity = false
        // No dynamic body for the blade, which never moves:
        self.physicsBody?.dynamic = false
        createAnimations()
        self.runAction(spinAnimation)
    }
    
    func createAnimations() {
        let spinFrames:[SKTexture] = [
            textureAtlas.textureNamed("blade-1.png"),
            textureAtlas.textureNamed("blade-2.png")
        ]
        let spinAction = SKAction.animateWithTextures(spinFrames, 
            timePerFrame: 0.07)
        spinAnimation = SKAction.repeatActionForever(spinAction)
    }
    
    func onTap() {}
}</pre></div><p>Congratulations, the<a id="id196" class="indexterm"/> <code class="literal">Blade</code> class was the last enemy we needed to add to our game. This process may seem repetitive – you have written a lot of boilerplate code – but separating our enemies into their own classes allows each enemy to implement unique logic and behavior. The benefits of this structure will become apparent as your games increase in complexity.</p><p>Next, we add the class for our coins.</p></div></div><div class="section" title="Adding the coins"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec64"/>Adding the coins</h2></div></div></div><p>Coins are <a id="id197" class="indexterm"/>more <a id="id198" class="indexterm"/>fun if there are two value variations. We will create:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A bronze coin, worth one coin.</li><li class="listitem" style="list-style-type: disc">A gold coin, worth five coins.</li></ul></div><p>The two coins <a id="id199" class="indexterm"/>will be distinguishable by their color on the screen and the denomination text on the coin, as seen here:</p><div class="mediaobject"><img src="graphics/4532_05_08.jpg" alt="Adding the coins"/></div><div class="section" title="Creating the coin classes"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec20"/>Creating the coin classes</h3></div></div></div><p>We only need a single <a id="id200" class="indexterm"/>
<code class="literal">Coin</code> class to create both denominations. Everything in the <code class="literal">Coin</code> class should look very familiar at this point. To create the <code class="literal">Coin</code> class, add a new file named <code class="literal">Coin.swift</code> and then enter the following code:</p><div class="informalexample"><pre class="programlisting">import SpriteKit

class Coin: SKSpriteNode, GameSprite {
    var textureAtlas:SKTextureAtlas = 
        SKTextureAtlas(named:"goods.atlas")
    // Store a default value for the bronze coin:
    var value = 1
    
    func spawn(parentNode:SKNode, position: CGPoint,
        size: CGSize = CGSize(width: 26, height: 26)) {
        parentNode.addChild(self)
        self.size = size
        self.position = position
        self.physicsBody = SKPhysicsBody(circleOfRadius: 
            size.width / 2)
        self.physicsBody?.affectedByGravity = false
        self.texture =
            textureAtlas.textureNamed("coin-bronze.png")
    }
    
    // A function to transform this coin into gold!
    func turnToGold() {
        self.texture = 
            textureAtlas.textureNamed("coin-gold.png")
        self.value = 5
    }
    
    func onTap() {}
}</pre></div><p>Great work – we have <a id="id201" class="indexterm"/>successfully added all of the new game objects we need for our final game!</p></div></div></div></div>
<div class="section" title="Organizing the project navigator"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec43"/>Organizing the project navigator</h1></div></div></div><p>You may notice that these<a id="id202" class="indexterm"/> new classes cluttered the project navigator. This is a good time to clean up the navigator. Right-click the project in the project navigator and select <span class="strong"><strong>Sort By Type</strong></span>, as shown in this screenshot:</p><div class="mediaobject"><img src="graphics/4532_05_09.jpg" alt="Organizing the project navigator"/></div><p>Your project navigator will segment itself by file type and sort into alphabetical order. This makes it much easier to find files as you need them.</p></div>
<div class="section" title="Testing the new game objects"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec44"/>Testing the new game objects</h1></div></div></div><p>It is time to see our <a id="id203" class="indexterm"/>hard work in action. We will now add one instance of each of our new classes to the game. Note that we will remove this testing code after we are done; you may want to leave yourself a comment or extra space for easy removal. Open <code class="literal">GameScene.swift</code> and locate the six lines that spawn the existing bees. Add this code after the bee lines:</p><div class="informalexample"><pre class="programlisting">// Spawn a bat:
let bat = Bat()
bat.spawn(world, position: CGPoint(x: 400, y: 200))

// A blade:
let blade = Blade()
blade.spawn(world, position: CGPoint(x: 300, y: 76))

// A mad fly:
let madFly = MadFly()
madFly.spawn(world, position: CGPoint(x: 50, y: 50))

// A bronze coin:
let bronzeCoin = Coin()
bronzeCoin.spawn(world, position: CGPoint(x: 490, y: 250))

// A gold coin:
let goldCoin = Coin()
goldCoin.spawn(world, position: CGPoint(x: 460, y: 250))
goldCoin.turnToGold()

// A ghost!
let ghost = Ghost()
ghost.spawn(world, position: CGPoint(x: 50, y: 300))

// The powerup star:
let star = Star()
star.spawn(world, position: CGPoint(x: 250, y: 250))</pre></div><p>You may<a id="id204" class="indexterm"/> also wish to comment out the <code class="literal">Player</code> class line that moves Pierre forward, so the camera does not quickly move past your new game objects. Just make sure to uncomment it when you are done.</p><p>Once you are ready, run the project. You should see the entire family, as shown in this screenshot:</p><div class="mediaobject"><img src="graphics/4532_05_10.jpg" alt="Testing the new game objects"/></div><p>Terrific<a id="id205" class="indexterm"/> work! All of our code has paid off and we have a large cast of characters ready for action.</p></div>
<div class="section" title="Checkpoint 5-A"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec45"/>Checkpoint 5-A</h1></div></div></div><p>To download my project to this point, browse to this URL:</p><p>
<a class="ulink" href="http://www.thinkingswiftly.com/game-development-with-swift/chapter-5">http://www.thinkingswiftly.com/game-development-with-swift/chapter-5</a>
</p><div class="section" title="Preparing for endless flight"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec65"/>Preparing for endless flight</h2></div></div></div><p>In <a class="link" href="ch06.html" title="Chapter 6. Generating a Never-Ending World">Chapter 6</a>, <span class="emphasis"><em>Generating a Never-Ending World</em></span>, we will build a never-ending level by spawning<a id="id206" class="indexterm"/> tactical obstacle courses full of these new game objects. We need to clear out all of our test objects to get ready for this new level spawning system. Once you are ready, remove the spawning test code we just added to the <code class="literal">GameScene</code> class. Also, remove the six lines that we have been using to spawn the three bees from previous chapters.</p><p>When you are finished, your <code class="literal">GameScene</code> class's <code class="literal">didMoveToView</code> function should look like this:</p><div class="informalexample"><pre class="programlisting">override func didMoveToView(view: SKView) {
    // Set a sky-blue background color:
    self.backgroundColor = UIColor(red: 0.4, green: 0.6, blue: 
        0.95, alpha: 1.0)
    
    // Add the world node as a child of the scene:
    self.addChild(world)
    
    // Store the vertical center of the screen:
    screenCenterY = self.size.height / 2
    
    // Spawn the ground:
    let groundPosition = CGPoint(x: -self.size.width, y: 30)
    let groundSize = CGSize(width: self.size.width * 3, height: 0)
    ground.spawn(world, position: groundPosition, size: 
        groundSize)
    
    // Spawn the player:
    player.spawn(world, position: initialPlayerPosition)
    
    // Set gravity
    self.physicsWorld.gravity = CGVector(dx: 0, dy: -5)
}</pre></div><p>When you <a id="id207" class="indexterm"/>run the project, you should only see Pierre and the ground, as shown here:</p><div class="mediaobject"><img src="graphics/4532_05_02.jpg" alt="Preparing for endless flight"/></div><p>We are now ready to build our level.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec46"/>Summary</h1></div></div></div><p>You added the complete cast of characters to our game in this chapter. Look back at all that you accomplished; you added the power-up star, the bronze and gold coins, a spooky ghost, the mad fly, bats, and a blade. You tested all of the new classes and then removed the test code so that the project is ready for the level generation system we will put in place in the next chapter.</p><p>We spent a lot of effort building each new class. The world will come alive and reward our hard work in <a class="link" href="ch06.html" title="Chapter 6. Generating a Never-Ending World">Chapter 6</a>, <span class="emphasis"><em>Generating a Never-Ending World</em></span>.</p></div></body></html>