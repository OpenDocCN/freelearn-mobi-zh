<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Writing your First App</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating a basic document class</li><li class="listitem" style="list-style-type: disc">Preventing screen idle</li><li class="listitem" style="list-style-type: disc">Handling multitasking</li><li class="listitem" style="list-style-type: disc">Exiting gracefully from an app</li><li class="listitem" style="list-style-type: disc">Linking classes to movie-clip symbols</li><li class="listitem" style="list-style-type: disc">Using an update loop</li><li class="listitem" style="list-style-type: disc">Including an application launch image</li><li class="listitem" style="list-style-type: disc">Including icons</li><li class="listitem" style="list-style-type: disc">Editing the application descriptor file</li><li class="listitem" style="list-style-type: disc">Remote debugging</li></ul></div><div><div><div><div><h1 class="title"><a id="ch03lvl1sec01"/>Introduction</h1></div></div></div><p>You should now be comfortable compiling and deploying native iOS apps from Flash Professional. In this chapter, we will continue where we left off, building on top of our FLA to create our first iOS app.</p><p>Although there are differences compared to targeting desktop computers, the process for writing iOS applications in Flash will feel familiar to any Flash developer. Along the way, a few best practices will be covered and you will have a first-hand experience of just how easy it is to write a simple application using some basic ActionScript. We will also apply the finishing touches to the app by adding a default launch image and icon artwork.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec02"/>Creating a basic document class</h1></div></div></div><p>Although you can write ActionScript 3.0 code directly onto the timeline, it isn't a recommended practice. Instead you really should apply a more object-oriented approach and develop your own custom classes. This is of particular importance on large-scale projects.<a id="id175" class="indexterm"/>
</p><p>Most ActionScript developers should already be comfortable creating classes but we will cover the steps here for the avoidance of doubt. Specifically, this recipe will have you create a basic document class that can be applied to the example app you started in the previous chapter.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec01"/>Getting ready</h2></div></div></div><p>We will be working from the latest version of<code class="literal"> bubbles.fla</code> from<a class="link" href="ch02.html" title="Chapter 2. Building iOS Apps Using Flash"> Chapter 2</a>. Alternatively, you can open<code class="literal"> chapter3\recipe1\bubbles.fla</code> from the book's accompanying code bundle.<a id="id176" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec02"/>How to do it...</h2></div></div></div><p>Follow the steps to create a document class:</p><div><ol class="orderedlist"><li class="listitem">First ensure that no instances on your stage are currently selected. Then, from the<strong> PUBLISH</strong> section within the<strong> Properties</strong> panel, click on the pencil icon next to the<strong> Class</strong> field.<p>The <strong>Create ActionScript 3.0 Class</strong> dialog box will appear.
</p></li><li class="listitem">Within the dialog box you may be asked which application should be used to create the ActionScript 3.0 class. If prompted, select the<strong> Flash Professional</strong> radio button.</li><li class="listitem">Enter<strong> Main</strong> into the<strong> Class name</strong> field and click on<strong> OK</strong>.<p>A skeleton class named Main will be created and shown within a new tab in the Flash IDE.
</p></li><li class="listitem">Save the class by selecting<strong> File</strong> |<strong> Save As</strong> <em> (Ctrl + Shift</em> +<em> S</em> |<em> Shift</em> +<em> Cmd</em> +<em> S)</em> from Flash's drop-down menu. When prompted, name the file<code class="literal"> Main.as</code> and save it within the same folder as<code class="literal"> bubbles.fla</code>.</li><li class="listitem">Move back to<code class="literal"> bubbles.fla</code> by clicking on its tab.<div><h3 class="title"><a id="note27"/>Note</h3><p>Every class you create or open will be shown as a tab along with any currently open FLA files. You can find these tabs directly below Flash Professional's drop-down menus.</p></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">You now have a document class associated with your FLA.</li></ul></div></li><li class="listitem">Ensure that there are no compiler errors by testing your FLA using ADL. You can do this by selecting<strong> Control</strong> |<strong> Test Movie</strong> |<strong> in AIR Debug Launcher  (Mobile) </strong>from Flash's drop-down menu. Alternatively, if you have previously tested from ADL (Mobile), then simply press<em> Ctrl</em> +<em> Enter</em><em> (Cmd + Enter</em> on Mac).<a id="id177" class="indexterm"/></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec03"/>How it works...</h2></div></div></div><p>The document class provides your application with a main entry point. Any code you add to the class' constructor will be executed when your app is launched, giving you an ideal location to perform initialization.<a id="id178" class="indexterm"/>
</p><p>Here is how the constructor currently looks:</p><div><pre class="programlisting">public function Main() {
//constructor code
}
</pre></div><p>As you can see, the constructor is empty but that will change during the remainder of this chapter.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec04"/>There's more...</h2></div></div></div><p>The following are a few more points regarding class creation.</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec01"/>Naming the document class</h3></div></div></div><p>The name of the document class is not significant. You can choose any valid name for the class; however, in this book, we will stick with the convention of naming the document class<code class="literal"> Main</code> for each new app.<a id="id179" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec02"/>Using packages</h3></div></div></div><p>Given the simplicity of this chapter's example, it will suffice to add all the code to the same folder as<code class="literal"> bubbles.fla</code>. Of course, for more complex projects you are likely to package your classes into individual sub-folders preventing namespace collisions with classes written by third parties.<a id="id180" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec03"/>Editing with Flash Builder</h3></div></div></div><p>Some developers find Flash Professional's code management and editing features too limited. Adobe has addressed this by integrating Flash Professional with Flash Builder.<a id="id181" class="indexterm"/>
</p><p>
<strong>Flash Builder</strong> is a powerful coding environment that offers features over and above those provided by Flash Professional. It is now possible to edit and compile your AIR for iOS projects from Flash Builder.</p><p>When you create classes within Flash Professional, you will be given the option to select whether to edit that class directly from within Flash Professional, or to open and use Flash Builder for your code editing.</p><p>This book won't cover Flash Builder but you can purchase it or download a trial version from the Adobe site at<a class="ulink" href="http://www.adobe.com/downloads"> www.adobe.com/downloads</a>.</p><p>While you can use other third-party IDEs, such as Flash Develop and FDT, to edit your ActionScript, they can't be launched directly from Flash Professional.</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec04"/>Creating other ActionScript 3.0 classes</h3></div></div></div><p>Other custom ActionScript 3.0 classes can be created from Flash Professional. However, these class files are created from Flash Professional's drop-down menu.<a id="id182" class="indexterm"/>
</p><p>Simply select<strong> File</strong> |<strong> New</strong> <em> (Ctrl + N</em> |<em> Cmd</em> +<em> N)</em> to open the<strong> New Document</strong> panel. From here, you can select the<strong> ActionScript 3.0 Class</strong> type and provide a name for the class.</p></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec05"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Linking classes to movie-clip symbols</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec03"/>Preventing screen idle</h1></div></div></div><p>To conserve battery life, mobile devices lock the screen a short period after they are last touched. However, this can be inconvenient for applications where the user might not be expected to interact with the screen that often.<a id="id183" class="indexterm"/>
</p><p>For applications where this is the case, screen locking can be disabled.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec06"/>Getting ready</h2></div></div></div><p>We will be adding code to the skeleton document class created in the previous recipe. If you haven't already done this, then complete the<em> Creating a basic document class</em> recipe before proceeding. Alternatively, using the book's accompanying code bundle, open<code class="literal"> chapter3\recipe2\bubbles.fla</code> in Flash Professional and work from there.<a id="id184" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec07"/>How to do it...</h2></div></div></div><p>Let us write some ActionScript to disable screen locking:<a id="id185" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Open the FLA's document class by selecting<strong> File</strong> |<strong> Open</strong><em>  (Ctrl + O</em> |<em> Cmd</em> +<em> O)</em> from Flash Professional's drop-down menu. From the file browser select<strong> Main.as</strong>.</li><li class="listitem">Add the following two import statements to your class:<div><pre class="programlisting">import flash.display.MovieClip;
<strong>
import flash.desktop.NativeApplication;
import flash.desktop.SystemIdleMode;
</strong>
</pre></div></li><li class="listitem">Both these classes are required in order to prevent your device from locking while the screen is idle.</li><li class="listitem">Create a member variable that will be used to store a<code class="literal"> NativeApplication</code> object:<div><pre class="programlisting">public class Main extends MovieClip {
<strong>private var application:NativeApplication;
</strong>
</pre></div></li><li class="listitem">Within the constructor, obtain a<code class="literal"> NativeApplication</code> reference and store it within your<code class="literal"> application</code> member variable:<div><pre class="programlisting">public function Main() {
<strong>application = NativeApplication.nativeApplication;
</strong>
}
</pre></div></li><li class="listitem">Using the<code class="literal"> application</code> variable, force the device's screen to stay awake:<div><pre class="programlisting">public function Main() {
application = NativeApplication.nativeApplication;
<strong>application.systemIdleMode = SystemIdleMode.KEEP_AWAKE;
</strong>
}
</pre></div></li><li class="listitem">Save your class file.</li><li class="listitem">Move to your FLA by clicking on its tab and open the AIR for iOS Settings panel by selecting<strong> File</strong> |<strong> AIR for iOS Settings</strong> from the drop-down menu.</li><li class="listitem">From the settings panel, ensure the<strong> General</strong> tab is selected and update the<strong> Version</strong> field to<strong> 0.2</strong>.</li><li class="listitem">Click on<strong> OK</strong> and save your FLA.</li><li class="listitem">Now, check your FLA for any compile-time errors by testing your movie using ADL.<p>Once you are satisfied that there are no errors, publish your app for iOS by selecting <strong>File | Publish</strong><em> (Alt + Shift + F12 | Shift + Cmd + F12)</em> and deploy the resultant .ipa file to your device using iTunes.
</p></li><li class="listitem">Launch the app. You should notice that the screen doesn't dim or lock during the application's lifetime.<a id="id186" class="indexterm"/></li></ol></div><div><h3 class="title"><a id="note28"/>Note</h3><p>You will need to increment the app's version number every time you wish to deploy a new build to your device. If you don't see any changes after launching your app, then it is likely to be a version issue.</p></div><p>For testing purposes, set the auto-lock time on your iOS device to the minimum duration. You can do this by selecting<strong> Settings</strong> |<strong> General</strong> |<strong> Auto-Lock</strong> on your iOS device. This will reduce the time you need to wait before confirming that the auto-lock has been disabled within your app.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec08"/>How it works...</h2></div></div></div><p>The<code class="literal"> NativeApplication</code> class provides the<code class="literal"> systemIdleMode</code> property that can be set to allow or prevent your device's screen from locking. From<code class="literal"> NativeApplication</code>, you can also obtain application information, access application-wide functions, and capture application-level events.<a id="id187" class="indexterm"/>
</p><p>In the code example, we set<code class="literal"> systemIdleMode</code> to<code class="literal"> SystemIdleMode.KEEP_AWAKE</code>, ensuring that the screen doesn't lock during the application's lifetime. Auto-locking can just as easily be re-enabled with<code class="literal"> SystemIdleMode.NORMAL</code>.</p><p>To prevent excessive battery usage, it is advisable to use<code class="literal"> SystemIdleMode.KEEP_AWAKE</code> sparingly. You may want to consider only disabling auto-lock within your application at points where it is absolutely necessary.</p><p>Also, you may have noticed that an instance of<code class="literal"> NativeApplication</code> wasn't explicitly created within your code.<code class="literal"> NativeApplication</code> is a singleton object that is automatically created when your application is launched. Only one instance of it can exist, and is accessed using the class' static<code class="literal"> nativeApplication</code> property.<a id="id188" class="indexterm"/>
</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec04"/>Handling multitasking</h1></div></div></div><p>Multitasking is supported in iOS 4 or above. When the user exits from an app by pressing the device's home button, the app is moved into the background rather than being fully closed. This can also occur for a variety of other reasons, such as the user accepting an incoming call or the app itself launching another application.<a id="id189" class="indexterm"/>
</p><p>When the user, or some other application, launches the app again, it can simply continue where it left off rather than being completely re-loaded. This also significantly reduces the start-up time when you return to the app.</p><p>Events are dispatched when your application is moved to the background, or resumed by the operating system. This recipe will explain how to listen for and capture these events.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec09"/>Getting ready</h2></div></div></div><p>We will expand the Bubbles app, providing our document class with methods that can handle the app being moved to the background and resumed.<a id="id190" class="indexterm"/>
</p><p>This recipe follows on from the work done in the<em> Preventing screen idle</em> recipe.</p><div><h3 class="title">Note</h3><p>The AIR 2.0 SDK does not provide support for iOS multitasking. If you
are using Flash Professional CS5, then skip this recipe and move to the
<em>Exiting gracefully from an app</em> recipe.
  
</p></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec10"/>How to do it...</h2></div></div></div><p>Make the following changes to your document class:</p><div><ol class="orderedlist"><li class="listitem">Open<code class="literal"> Main.as</code> within Flash Professional CS5.5.</li><li class="listitem">You will require the use of the<code class="literal"> Event</code> class. Add it to your list of import statements:<div><pre class="programlisting">import flash.display.MovieClip;
import flash.desktop.NativeApplication;
import flash.desktop.SystemIdleMode;
<strong>import flash.events.Event;
</strong>
</pre></div></li><li class="listitem">Within the constructor, listen for<code class="literal"> NativeApplication</code> dispatching<code class="literal"> Event.ACTIVATE</code> and<code class="literal"> Event.DEACTIVATE:</code><div><pre class="programlisting">public function Main() {
application = NativeApplication.nativeApplication;
application.systemIdleMode = SystemIdleMode.KEEP_AWAKE;
<strong>application.addEventListener(Event.ACTIVATE, activate);
application.addEventListener(Event.DEACTIVATE, deactivate);
</strong>
}
</pre></div></li><li class="listitem">Add a handler for each event:<div><pre class="programlisting">private function deactivate(e:Event):void {
application.systemIdleMode = SystemIdleMode.NORMAL;
}
private function activate(e:Event):void {
application.systemIdleMode = SystemIdleMode.KEEP_AWAKE;
}
</pre></div></li><li class="listitem">Move back to your constructor and remove the following highlighted line:<div><pre class="programlisting">public function Main() {
application = NativeApplication.nativeApplication;
<strong>application.systemIdleMode = SystemIdleMode.KEEP_AWAKE;
</strong>
application.addEventListener(Event.ACTIVATE, activate);
application.addEventListener(Event.DEACTIVATE, deactivate);
}
</pre></div></li><li class="listitem">This line is no longer required as it is now performed by the <code class="literal">activate() </code> method.</li><li class="listitem">Save your class file and check for any compile-time errors by testing<code class="literal"> bubbles.fla</code> using ADL <em> (Ctrl + Enter</em> |<em> Cmd</em> +<em> Enter)</em>.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec11"/>How it works...</h2></div></div></div><p>Whenever your app is about to be moved to the background, the<code class="literal"> NativeApplication</code> class dispatches<code class="literal"> Event.DEACTIVATE</code>. Alternatively,<code class="literal"> Event.ACTIVATE</code> is fired when iOS resumes your app or when it is launched. You can listen for and respond to these events in order to initialize your app, prepare it for being moved to the background, or re-activated again.<a id="id191" class="indexterm"/>
</p><p>In this recipe's example, we have simply taken the opportunity to disable auto-lock when your app is launched or resumed, and enable auto-lock when your app is suspended.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec12"/>There's more...</h2></div></div></div><p>You may find the following additional information regarding iOS multitasking of interest.</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec05"/>Background processing</h3></div></div></div><p>The majority of background apps on iOS actually get suspended. They are still in system memory but are effectively paused. This saves CPU resources and increases the device's battery life.<a id="id192" class="indexterm"/>
</p><p>Certain types of apps, however, can continue to run in the background rather than being suspended. These apps are given limited CPU resources to perform a few specific tasks, such as playing audio or accessing location-based information.</p><p>In either case, AIR's<code class="literal"> NativeApplication</code> class will dispatch<code class="literal"> Event.DEACTIVATE</code>.</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec06"/>App closing</h3></div></div></div><p>Do not assume your background app will remain in memory.<a id="id193" class="indexterm"/>
</p><p>A user or the operating system itself may decide to close your application. If your app is closed by a user, then you may be given an opportunity to save its state and perform any final clean-up code.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec05"/>Exiting gracefully from an app</h1></div></div></div><p>Pressing the home button on iOS 3 devices closes the current app and removes it from memory. Performing the same action on a device running iOS 4 or above places the app in a suspended or background state rather than closing it. However, a user can close and remove these apps from memory using the fast app switcher. Additionally, when system memory is low, iOS itself may decide to close suspended or background apps.<a id="id194" class="indexterm"/>
</p><p>If the user decides to close your app then, just before it exits, you will be given an opportunity to perform any house keeping, such as saving state or freeing memory.<a id="id195" class="indexterm"/>
</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec13"/>Getting ready</h2></div></div></div><p>We will add some more code to the current version of your Bubbles app, allowing it to gracefully exit. Alternatively, from the book's accompanying code bundle, open<code class="literal"> chapter3\recipe4\bubbles.fla</code> and work from there.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec14"/>How to do it...</h2></div></div></div><p>Let us listen for and handle the Bubbles app being closed:<a id="id196" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Open<code class="literal"> Main.as</code> within Flash Professional.</li><li class="listitem">We will make use of the<code class="literal"> Event</code> class. Ensure that it is added to your class' list of import statements:<div><pre class="programlisting">import flash.display.MovieClip;
import flash.desktop.NativeApplication;
import flash.desktop.SystemIdleMode;
<strong>import flash.events.Event;
</strong>
</pre></div></li><li class="listitem">Within the constructor, listen for<code class="literal"> Event.EXITING</code> being dispatched by the<code class="literal"> NativeApplication</code> object:<div><pre class="programlisting">application.addEventListener(Event.EXITING, exiting);
</pre></div></li><li class="listitem">Add an event handler that will perform any required clean-up before your app exits:<div><pre class="programlisting">private function exiting(e:Event):void {
<strong>application.removeEventListener(Event.EXITING, exiting);
application.systemIdleMode = SystemIdleMode.NORMAL;
</strong>
}
<a id="id197" class="indexterm"/>
</pre></div></li><li class="listitem">If you are using Flash Professional CS5.5 and have completed the previous recipe—<em>Handling multitasking</em> —then add the following lines to your<code class="literal"> exiting()</code> event handler:<div><pre class="programlisting">private function exiting(e:Event):void {
application.removeEventListener(Event.ACTIVATE, activate);
application.removeEventListener(Event.DEACTIVATE, deactivate);
application.removeEventListener(Event.EXITING, exiting);
application.systemIdleMode = SystemIdleMode.NORMAL;
}
</pre></div></li><li class="listitem">Save your class file and check for any compile-time errors.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec15"/>How it works...</h2></div></div></div><p>Whenever your app is about to exit, the<code class="literal"> NativeApplication</code> class dispatches the<code class="literal"> EXITING</code> event. By responding to this event you can perform any necessary clean-up, such as saving state or freeing memory.<a id="id198" class="indexterm"/>
</p><p>You may also notice within the<code class="literal"> exiting()</code> method that we have taken the opportunity to re-enable auto-lock. Although iOS should actually enable auto-lock for you when your app exits, it is good practice to explicitly do this within your code.<a id="id199" class="indexterm"/>
</p><p>It is also good practice to perform other forms of clean-up such as removing event listeners, which we have also done. It is important that event listeners are removed from objects as failing to do so is a common source of memory leaks. This applies throughout the lifetime of your application and not just when exiting.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec16"/>There's more...</h2></div></div></div><p>Finally a little more detail regarding the exit sequence.<a id="id200" class="indexterm"/>
</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec07"/>The app switcher</h3></div></div></div><p>On iOS 4 or above, you must explicitly kill an app using the fast app switcher. To access the app switcher, double-press on the home button. To kill an app, tap and hold its icon until the minus symbol appears at the icon's corner. Tap the minus symbol and the app will be removed from the background. This will force<code class="literal"> Event.EXITING</code> to be dispatched from the app as it is being closed.<a id="id201" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec08"/>Cleaning up</h3></div></div></div><p>Along with saving the application's state, you should also perform any necessary clean-up in response to<code class="literal"> Event.EXITING</code>. It is important that your app cleans up itself by completely freeing memory. You should dispose of any objects, remove any remaining event listeners you added, stop any timers and timeline animations that are still running, stop all sound from playing, cancel any network requests, and finally close any sockets, file streams, or database connections.<a id="id202" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec09"/>Script execution time</h3></div></div></div><p>Ensure that the code within your event handler executes as quickly as possible. If it takes more than a handful of seconds, then iOS may terminate your application prematurely. This could be particularly harmful, if it happens while you are still saving state information to the device.<a id="id203" class="indexterm"/>
</p><p>To limit the chances of a timeout happening, minimize the amount of data you save during the exit process. You should also ensure you save data before performing any other clean-up tasks. This will increase the chances of your app's state being preserved when performing lengthy exit and clean-up operations.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec06"/>Linking classes to movie-clip symbols</h1></div></div></div><p>It is possible to add additional behavior to a movie-clip symbol by creating and linking a custom class to it. Typically the class will listen for, and respond to events dispatched by the movie clip. Of those available,<code class="literal"> Event.ENTER_FRAME</code> is the most widely used, providing a means to programmatically update the movie-clip's appearance on every frame redrawn.<a id="id204" class="indexterm"/>
</p><p>We will write a custom class that makes each of the bubbles from the latest version of our example app float upwards.<a id="id205" class="indexterm"/>
</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec17"/>How to do it...</h2></div></div></div><p>Let us write the custom class and link it to each of the bubbles:<a id="id206" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Within Flash Professional select<strong> File</strong> |<strong> New</strong> <em> (Ctrl + N</em> |<em> Cmd</em> +<em> N)</em>. From the<strong> New Document</strong> panel, create an<strong> ActionScript 3.0 Class</strong> and name it<strong> Bubble</strong>. A skeleton class will be created.</li><li class="listitem">Add the following code to the class:<div><pre class="programlisting">package {
import flash.display.Sprite;
import flash.events.Event;
public class Bubble extends Sprite {
private var _speed:Number = 1;
public function Bubble() {
addEventListener(Event.ENTER_FRAME, enterFrame);
}
public function set speed(s:Number):void {
_speed = s;
}
private function enterFrame(e:Event):void {
y -= _speed;
if(y &lt; -(height / 2))
{
y = stage.stageHeight + (height / 2) + (height * Math.random());
x = -(width / 2) + ((stage.stageWidth + width) * Math.random());
}
}
}
}
</pre></div></li><li class="listitem">Save the class as<code class="literal"> Bubble.as</code> in the same folder as<code class="literal"> Main.as</code>. Move back to your FLA by clicking on its tab.</li><li class="listitem">Now you can link your<code class="literal"> Bubble</code> class to each of the bubble movie-clip symbols within your library. Let us start with<strong> Bubble Huge</strong>.<p>Move to the LIBRARY, right-click on Bubble Huge, and select Properties.
</p></li><li class="listitem">Check the<strong> Export for ActionScript</strong> checkbox from the<strong> Advanced</strong> section within the<strong> Symbol Properties</strong> dialog box. The<strong> Class</strong> field will contain the name of your symbol but with the spaces removed. Within the<strong> Base Class</strong> field, replace the existing text with<strong> Bubble</strong> as shown in the following screenshot:<a id="id207" class="indexterm"/><div><img src="img/1383_03_01.jpg" alt="How to do it..."/></div></li><li class="listitem">Click on the<strong> OK</strong> button near the top-right of the panel.</li><li class="listitem">Depending on your preference settings within Flash Professional, a warning panel may appear containing the following text:<a id="id208" class="indexterm"/><p><strong>A definition for this class could not be found in the classpath, so one will be automatically generated in the SWF file upon export.
</strong>
</p><p>This is expected. Although you have written code that represents the symbol's base class, you will rely on Flash to generate the code for the symbol's actual class. Click on the <strong>OK</strong> button.
</p></li><li class="listitem">Repeat this process linking the<code class="literal"> Bubble</code> class to the following movie-clip symbols:<strong> Bubble Large, Bubble Medium</strong>, and<strong> Bubble Small</strong>.</li><li class="listitem">Save your FLA and test using ADL. The bubbles that were previously stationary within your app will now drift up the screen.<a id="id209" class="indexterm"/></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec18"/>How it works...</h2></div></div></div><p>The class' structure is fairly conventional. At its heart is an event handler that gets called every time<code class="literal"> Event.ENTER_FRAME</code> is dispatched by the movie clip. Inside the handler is the logic that controls and updates the clip.<a id="id210" class="indexterm"/>
</p><p>In our case, the class'<code class="literal"> enterFrame()</code> handler is used to update the bubble's position on every frame redraw. If the bubble moves off the top of the screen, then it is randomly repositioned at the bottom, where it can start floating upwards again.</p><p>A private member variable named<code class="literal"> _speed</code> has been used to define the number of pixels that the bubble is moved each time<code class="literal"> Event.ENTER_FRAME</code> is dispatched. And although it hasn't yet been used, a public setter was also added to the class allowing the bubble's vertical speed to be changed using the<code class="literal"> speed</code> property.<a id="id211" class="indexterm"/>
</p><p>Although it won't be noticeable in your demo, excessive usage of the<code class="literal"> ENTER_FRAME</code> event can actually degrade the performance of your iOS apps. We will address this in the next recipe and also tidy up the movement of the bubbles within the demo. At present, the sense of depth is lost due to the fact that the bubbles all travel at the same speed.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec19"/>There's more...</h2></div></div></div><p>You may have noticed that your<code class="literal"> Bubble</code> class actually extends<code class="literal"> Sprite</code> rather than<code class="literal"> MovieClip</code>. The following is the reason.</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec10"/>Extending sprite</h3></div></div></div><p>Although the bubbles within the library are actually movie clips, the<code class="literal"> Bubble</code> class inherits from<code class="literal"> flash.display.Sprite</code> rather than<code class="literal"> flash.display.MovieClip</code>.<a id="id212" class="indexterm"/>
</p><p>It is perfectly acceptable to extend<code class="literal"> MovieClip</code>, but considering that the bubble library symbols only use a single frame from their timeline, it is actually unnecessary. You are only required to extend<code class="literal"> MovieClip</code> if you intend to navigate the clip's timeline; otherwise the functionality provided by<code class="literal"> Sprite</code> will do and has less overhead.<a id="id213" class="indexterm"/>
</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec07"/>Using an update loop</h1></div></div></div><p>Listening for events can be expensive. For a handler to receive an event, Flash must create an object in memory that represents that event. Repeatedly allocating memory can hurt the performance of your app, and this is especially true if you are listening for<code class="literal"> Event.ENTER_FRAME</code> from a large number of display objects.<a id="id214" class="indexterm"/>
</p><p>Let us see how to minimize the impact of handling multiple<code class="literal"> ENTER_FRAME</code> events by making some adjustments to the architecture of your example app. We will also add some additional code to individually control the speed of each bubble, making the app a little more polished.<a id="id215" class="indexterm"/>
</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec20"/>How to do it...</h2></div></div></div><p>You will be required to make code changes to both<code class="literal"> Main.as</code> and<code class="literal"> Bubble.as:</code>
<a id="id216" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">First start by opening<code class="literal"> Bubble.as</code>.</li><li class="listitem">Within the constructor, remove the highlighted line of code that listens for<code class="literal"> Event.ENTER_FRAME:</code><div><pre class="programlisting">public function Bubble() {
<strong>addEventListener(Event.ENTER_FRAME, enterFrame);
</strong>
}
</pre></div></li><li class="listitem">Change the<code class="literal"> enterFrame()</code> method's signature by renaming it to<code class="literal"> update()</code> and removing its<code class="literal"> Event</code> parameter. Also make it publicly accessible:<a id="id217" class="indexterm"/><div><pre class="programlisting"><strong>public function update():void {
</strong>
y -= _speed;
if(y &lt; -(height / 2))
{
y = stage.stageHeight + (height / 2) +
(height * Math.random());
x = -(width / 2) +
((stage.stageWidth + width) * Math.random());
}
}
</pre></div></li><li class="listitem">Remove the<code class="literal"> Event</code> class import statement as it is no longer required:<div><pre class="programlisting"><strong>import flash.events.Event;
</strong>
</pre></div></li><li class="listitem">Save the class and move to<code class="literal"> Main.as</code>.</li><li class="listitem">Add the following two member variables to<code class="literal"> Main.as:</code><div><pre class="programlisting">private var bubbles:Array;
private var speeds:Array;
</pre></div></li><li class="listitem">Within the class' constructor, populate both the<code class="literal"> bubbles</code> and<code class="literal"> speeds</code> arrays. The<code class="literal"> bubbles</code> array will contain references to each of the bubble instances sitting on your FLA's stage. The<code class="literal"> speeds</code> array will contain a vertical speed to be used for each bubble instance:<div><pre class="programlisting">bubbles = [bubble1, bubble2, bubble3, bubble4, bubble5, bubble6, bubble7, bubble8, bubble9];
speeds = [1.3, 1.5, 1.8, 2, 2.2, 2.4, 4.5, 5, 8];
</pre></div></li><li class="listitem">Now staying within the constructor, add some code to walk through the<code class="literal"> bubbles</code> array, setting the vertical speed of each bubble using a value from the<code class="literal"> speeds</code> array:<div><pre class="programlisting">for(var i:uint = 0; i &lt; bubbles.length; i++)
{
bubbles[i].speed = speeds[i];
}
</pre></div><div><h3 class="title">Note</h3><p>In the preceding code snippet, note the use of the<code class="literal"> speed</code> property that was added to the<code class="literal"> Bubble</code> class in the preceding recipe,<em> Linking classes to movie-clip symbols</em>.</p></div></li><li class="listitem">Listen for the<code class="literal"> ENTER_FRAME</code> event by placing the following statement at the end of the constructor:<div><pre class="programlisting">addEventListener(Event.ENTER_FRAME, update);
</pre></div></li><li class="listitem">At the end of the<code class="literal"> exiting()</code> handler, add a line of code to remove the<code class="literal"> Event.ENTER_FRAME</code> listener:<div><pre class="programlisting">removeEventListener(Event.ENTER_FRAME, update);
</pre></div></li><li class="listitem">Finally, add to the class an event handler for<code class="literal"> Event.ENTER_FRAME</code>, which calls each bubble instance's<code class="literal"> update()</code> method:<div><pre class="programlisting">private function update(e:Event):void {
for each(var b:Bubble in bubbles)
{
b.update();
}
}
</pre></div></li><li class="listitem">Save the class.</li><li class="listitem">Test<code class="literal"> bubbles.fla</code> using ADL.<div><h3 class="title"><a id="note29"/>Note</h3><p>When publishing, you may receive a list of compiler errors similar to the following:</p><p>
<strong>1120: Access of undefined property bubble1</strong>.</p><p>Typically this occurs when Flash has not been instructed to automatically declare member variables within your class for each display object instance on the stage.</p><p>You can rectify this from the<strong> Advanced ActionScript 3.0 Settings</strong> panel by checking on the<strong> Automatically declare stage instances</strong> checkbox.</p></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">The bubbles will now move in a much more convincing manner, with those closest travelling faster than those at a distance. More importantly, the application's architecture has been changed, removing the need to listen for and handle multiple <code class="literal">ENTER_FRAME </code> events per frame.<a id="id218" class="indexterm"/></li></ul></div><div><img src="img/1383_03_02.jpg" alt="How to do it..."/></div></li><li class="listitem">Update your app's version number to<strong> 0.3</strong> from the<strong> AIR for iOS Settings</strong> panel and publish it.<a id="id219" class="indexterm"/></li><li class="listitem">Deploy the resultant<code class="literal"> .ipa</code> file to your device and test it.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec21"/>How it works...</h2></div></div></div><p>Rather than having every bubble instance listen for and handle its own<code class="literal"> ENTER_FRAME</code> event, we now have only one listener that makes<code class="literal"> update()</code> calls to each of the bubbles.<a id="id220" class="indexterm"/>
</p><p>Essentially the<code class="literal"> update()</code> method within the document class acts as a main loop for the application. Every object that needs to be updated has its own<code class="literal"> update()</code> method that is called from the document class' main loop.<a id="id221" class="indexterm"/>
</p><p>The following is the main update loop again:</p><div><pre class="programlisting">private function update(e:Event):void {
for each(var b:Bubble in bubbles)
{
b.update();
}
}
</pre></div><p>The<code class="literal"> bubbles</code> array was used in this example as a convenient mechanism to reference each bubble instance that required updating. You can see it being used in the main loop.<a id="id222" class="indexterm"/>
</p><p>The advantages of using a centralized update loop within your application cannot be over emphasized. The performance benefits may not be obvious in this chapter's example app, but for more complex projects, this technique will help when trying to achieve consistent and high frame rates, especially on older devices.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec08"/>Including an application launch image</h1></div></div></div><p>Every iOS app can have a static launch image bundled with it. This will be shown to the user while the app loads.<a id="id223" class="indexterm"/>
</p><p>Let us add a launch image to our example app.<a id="id224" class="indexterm"/>
</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec22"/>How to do it...</h2></div></div></div><p>We will continue from the<em> Using an update loop</em> recipe. If you haven't completed it, then you can work from<code class="literal"> chapter3\recipe7\bubbles.fla</code> from the book's accompanying code bundle.<a id="id225" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Using Windows Explorer or Finder, copy<code class="literal"> chapter3\resources\Default.png</code> to the same folder as your FLA.</li><li class="listitem">Revisit the AIR for iOS Settings panel by selecting<strong> File</strong> |<strong> AIR for iOS Settings</strong> from Flash's drop-down menu.</li><li class="listitem">If it isn't already selected, click on the panel's<strong> General</strong> tab.</li><li class="listitem">At the bottom of the panel is the<strong> Included files</strong> list. Click on the<strong> +</strong> symbol above the list and select<strong> Default.png</strong> from your FLA's root folder. Click on<strong> OK</strong> to select the file. You should now see<strong> Default.png</strong> in the<strong> Included files</strong> list.<a id="id226" class="indexterm"/></li><li class="listitem">Change the app's<strong> Version</strong> field to<strong> 0.4</strong>.</li><li class="listitem">Now click on<strong> OK</strong> to close the<strong> AIR for iOS Settings</strong> panel.</li><li class="listitem">Save the FLA.</li></ol></div><div><img src="img/1383_03_03.jpg" alt="How to do it..."/></div><p>Publish and deploy the latest version of the app to your iOS device. As shown in the preceding screenshot, you should see the launch image while the app loads.<a id="id227" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec23"/>How it works...</h2></div></div></div><p>The<code class="literal"> Default.png</code> file is a 24-bit 320x480 PNG image that matches the initial visual state of the Bubbles app. Additionally, text has been superimposed onto the image to inform the user that the app is loading. Once the app's binary has been completely loaded, iOS will remove it from view and run the application. The switch between the launch image and the first frame of your app will be seamless.<a id="id228" class="indexterm"/>
</p><p>It is important that your file is named<code class="literal"> Default.png</code>, with an uppercase<code class="literal"> D</code>, as iOS will look for this exact filename when loading your app. If your image cannot be found or one wasn't included, then a black screen will be shown while the app loads.</p><p>You should also ensure that<code class="literal"> Default.png</code> is copied to the same folder as your FLA.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec24"/>There's more...</h2></div></div></div><p>Adding a launch image to your app isn't difficult but there are additional options to consider when supporting multiple iOS devices, screen resolutions, and orientations.</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec11"/>Landscape orientation</h3></div></div></div><p>For iPhone and iPod touch applications that have been designed for landscape, you still embed a 320x480 PNG, but ensure that the image is provided in that orientation.<a id="id229" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec12"/>Supporting the Retina display</h3></div></div></div><p>For iOS devices with Retina display screens, you can bundle with your IPA an additional launch image that takes advantage of the higher resolution. Simply create a 640x960 PNG file and name it<code class="literal"> Default@2x.png</code>. When loading on a device that supports the Retina display,<code class="literal"> Default@2x.png</code> will be used as the launch image rather than<code class="literal"> Default.png</code>.<a id="id230" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec13"/>iPad launch images</h3></div></div></div><p>Unlike the iPhone and iPod touch, an iOS app running on iPad can select from multiple launch images depending on its orientation. This is done by bundling a series of PNGs with the app, each with an orientation modifier string in the filename.<a id="id231" class="indexterm"/>
</p><p>For example, if the user is holding the device in a portrait orientation when the app is launched, iOS will look for a PNG named<code class="literal"> Default-Portrait.png</code>. When held in landscape, iOS will attempt to display<code class="literal"> Default-Landscape.png</code>. The dimensions for<code class="literal"> Default-Portrait.png</code> should be 768x1024, while<code class="literal"> Default-Landscape.png</code> should be 1024x768.<a id="id232" class="indexterm"/>
</p><p>It is even possible to specify an upside-down portrait version of the launch image by including a PNG named<code class="literal"> Default-PortraitUpsideDown.png</code>. This will take precedence over<code class="literal"> Default-Portrait.png</code> if both exist.</p><p>Similarly, additional control when the device is being held in a landscape orientation can be obtained by bundling images named<code class="literal"> Default-LandscapeLeft.png</code> and<code class="literal"> Default-LandscapeRight.png</code>. Both will take precedence over<code class="literal"> Default-Landscape.png</code> if it too exists.</p><p>If no PNGs with an orientation modifier are found, then<code class="literal"> Default.png</code> will be used.</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec14"/>Universal apps</h3></div></div></div><p>It is possible to embed a range of launch images that cover the various screen resolutions and aspect ratios across all iOS device types. As an example, consider a universal app that can take advantage of the iPhone's standard and Retina screen resolutions, as well as both portrait and landscape orientations on iPad. Embedding images named<code class="literal"> Default.png, Default@2x.png, Default-Portrait.png</code>, and<code class="literal"> Default-Landscape.png</code> would cover this.<a id="id233" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec15"/>Using the status bar</h3></div></div></div><p>If you plan to include the status bar in your app, then there is no need to reduce the size of your launch image. The status bar consumes 20 vertical pixels (40 pixels on Retina display screens) and will simply be placed over the top of your image while your app loads. The status bar also consumes 20 vertical pixels on iPad.<a id="id234" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec16"/>Bundling other files</h3></div></div></div><p>In this recipe, we bundled a launch image with our app by adding it to the AIR for iOS Settings panel's<strong> Included files</strong> list. From this panel, you can also include other files or folders that will be bundled with your app and can even be loaded at runtime using ActionScript. Like the launch image, other files and folders to be added must exist within your FLA's root folder.<a id="id235" class="indexterm"/>
</p></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec25"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Targeting a device, <a class="link" href="ch08.html" title="Chapter 8. Screen Resolution and Orientation Changes">Chapter 8</a></em>,<a id="id236" class="indexterm"/></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec09"/>Including icons</h1></div></div></div><p>Our app looks almost complete. The most obvious omission is the icon artwork, which we will now add.<a id="id237" class="indexterm"/>
</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec26"/>How to do it...</h2></div></div></div><p>Icons are added from the AIR for iOS Settings panel.<a id="id238" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Move to the<strong> AIR for iOS Settings</strong> panel and click on the<strong> Icons</strong> tab.<p>From here you can bundle various icons with your app. The icon types are listed at the top of the panel.
</p></li><li class="listitem">From the list, click on<strong> icon 29x29</strong>. The field directly below the icon list will be relabeled<strong> 29x29</strong>. To the right of this field is a browse icon. Click on it as shown in the following screenshot. Browse to and select<code class="literal"> chapter3\resources\icon29.png</code>.<div><img src="img/1383_03_04.jpg" alt="How to do it..."/></div></li><li class="listitem">A dialog box will appear containing the following message:<a id="id239" class="indexterm"/><p><strong>The icon must be copied to a folder relative to the root content folder so that it can be published. Do you want to proceed?
</strong>
</p><p>Click on <strong>OK</strong> and a sub-folder named <code class="literal">AppIconsForPublish</code> will be created in the same location as your FLA. The icon you selected will be copied to this new location.
<a id="id240" class="indexterm"/>
</p></li><li class="listitem">Now select<strong> icon 57x57</strong> from the list and browse to<code class="literal"> chapter3\resources\icon57.png</code>. Again you will be asked if you would like the icon copied to a folder relative to the root content folder. Click on the<strong> OK</strong> button.</li><li class="listitem">Work your way through the remaining icons on the list, adding the appropriate PNG from the<code class="literal"> resources</code> folder.</li><li class="listitem">Once you have added the icons, click on the panel's<strong> General</strong> tab and update the<strong> Version</strong> field to<strong> 0.5</strong>.</li><li class="listitem">Click on<strong> OK</strong> to exit the<strong> AIR for iOS Settings</strong> panel.</li></ol></div><p>Publish and deploy the latest version of the app to your device. Your app should now be represented by an icon in iTunes and on the device.<a id="id241" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec27"/>How it works...</h2></div></div></div><p>All icon artwork should be created and saved as 24-bit PNGs. Don't add a reflective shine, rounded corners, or drop shadow to your artwork as these will be applied by iOS. Also, considering the largest icon that you add is 512x512 pixels, it makes sense to design your original icon artwork at this size at least; you don't want to have to scale up a smaller version for this.<a id="id242" class="indexterm"/>
</p><p>You can actually include six icons with your app. Here is a description of each:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">29x29—Spotlight search results icon for iPhone 3GS<a id="id243" class="indexterm"/></li><li class="listitem" style="list-style-type: disc">48x48—Spotlight search results icon for iPad<a id="id244" class="indexterm"/></li><li class="listitem" style="list-style-type: disc">57x57—Spotlight search results icon for iPhone 4/4S and home screen icon for iPhone 3GS<a id="id245" class="indexterm"/></li><li class="listitem" style="list-style-type: disc">72x72—Home screen icon for iPad<a id="id246" class="indexterm"/></li><li class="listitem" style="list-style-type: disc">114x114—Home screen icon for iPhone 4/4S<a id="id247" class="indexterm"/></li><li class="listitem" style="list-style-type: disc">512x512—iTunes icon<a id="id248" class="indexterm"/></li></ul></div><div><h3 class="title"><a id="note30"/>Note</h3><p>Flash Professional CS5 does not support the Retina display resolution and, therefore, does not permit the inclusion of a 114x114 icon for the iPhone 4/4S home screen. The 57x57 icon will be used instead.</p></div><p>The iPhone 3GS icons will also work on a third-generation iPod touch, and the iPhone 4/4S icons will work on a fourth-generation iPod touch.</p><p>Although the Bubbles app only utilizes the standard resolution of 320x480, this doesn't prevent you from bundling alternative icons for higher resolution screens such as the iPhone 4/4S and iPad.</p><p>Also, the iTunes icon is for development purposes only. When submitting your final app to the App Store, you submit the 512x512 icon separately as a JPEG file. It isn't included in the final<code class="literal"> .ipa</code> file. While you should ensure that the iTunes icon is recognizable as your application icon, it is perfectly acceptable to make it richer and more detailed in appearance. Additionally, visual effects, such as the reflective shine, are not added to this icon.<a id="id249" class="indexterm"/>
</p><p>As for the design of your icon artwork, Apple's<strong> iOS Human Interface Guidelines</strong> stresses the importance of strong visual design in order to create an instantly recognizable icon. It is important that your icon somehow conveys your application's purpose. Also avoid using text and remember that your icon will be viewed at various sizes. It is advisable that you use a vector format when designing as this will allow the icon to scale without loss of fidelity before outputting each of the required bitmap versions.<a id="id250" class="indexterm"/>
</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec10"/>Editing the application descriptor file</h1></div></div></div><p>Included with your FLA is the application descriptor file. It is an XML file that contains settings used when publishing AIR applications. This file also contains properties that describe your iOS application including those set within the AIR for iOS Settings panel. The application descriptor file can be edited to make changes that can't be directly set from within Flash Professional's various setting panels.<a id="id251" class="indexterm"/>
</p><p>Let us alter the application descriptor file to remove the reflective shine that iOS applies to the Bubbles app's icons.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec28"/>Getting ready</h2></div></div></div><p>For this recipe, work from your current version of the Bubbles app, or alternatively use the FLA provided with the accompanying code bundle at<code class="literal"> chapter3\recipe9\bubbles.fla</code>.<a id="id252" class="indexterm"/>
</p><p>Flash Professional writes to the application descriptor file when you make changes from the AIR for iOS Settings panel. If you have the AIR for iOS Settings panel open, then close it before attempting to edit the application descriptor file from an external text editor.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec29"/>How to do it...</h2></div></div></div><p>You can also open and edit the application descriptor file from within Flash, which is what we will do:</p><div><ol class="orderedlist"><li class="listitem">Select<strong> File</strong> |<strong> Open</strong> <em>(Ctrl + O</em> |<em> Cmd</em> +<em> O)</em> and select<strong> bubbles-app.xml</strong>.</li><li class="listitem">Scroll down the XML file until you find the following XML fragment:<div><pre class="programlisting">&lt;iPhone&gt;
&lt;InfoAdditions&gt;
&lt;![CDATA[&lt;key&gt;UIDeviceFamily&lt;/key&gt; &lt;array&gt;&lt;string&gt;1&lt;/string&gt;&lt;/array&gt;]]&gt;
&lt;/InfoAdditions&gt;
</pre></div></li><li class="listitem">The<code class="literal"> CDATA</code> node is where you can add additional iOS settings information. Go ahead and add the following key-value pair to the XML:<div><pre class="programlisting">&lt;iPhone&gt;
&lt;InfoAdditions&gt;
&lt;![CDATA[&lt;key&gt;UIDeviceFamily&lt;/key&gt; &lt;array&gt;&lt;string&gt;1&lt;/string&gt;&lt;/array&gt;
<strong> &lt;key&gt;UIPrerenderedIcon&lt;/key&gt;&lt;true/&gt;]]&gt;
</strong>
&lt;/InfoAdditions&gt;
</pre></div></li><li class="listitem">Save the file.</li><li class="listitem">Move to your FLA and from the<strong> AIR for iOS Settings</strong> panel, update its<strong> Version</strong> field to<strong> 0.6</strong>.</li></ol></div><p>Publish the FLA and deploy the new<code class="literal"> .ipa</code> file to your device. Your app's home screen icon should no longer have a reflective shine applied to it.<a id="id253" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec30"/>How it works...</h2></div></div></div><p>The application descriptor file is named using the name of your output SWF and takes the following format:<code class="literal">&lt;swf_name&gt;-app.xml</code>. By default, the output SWF name is identical to your FLA's name.<a id="id254" class="indexterm"/>
</p><p>All iOS specific settings can be found within the XML file's<code class="literal">&lt;iPhone&gt;</code> node. Within the<code class="literal">&lt;iPhone&gt;</code> node is the<code class="literal">&lt;infoAdditions&gt;</code> node where you can set any custom iOS settings by adding key-value pairs. These key-value pairs should be placed within a<code class="literal"> CDATA</code> tag.<a id="id255" class="indexterm"/>
</p><p>During the recipe, you added the following key-value pair in order to disable the icon's reflective shine:</p><div><pre class="programlisting">&lt;key&gt;UIPrerenderedIcon&lt;/key&gt;&lt;true/&gt;
</pre></div><p>You can just as easily re-enable the shine by changing the value to<code class="literal">&lt;false/&gt;</code> or simply removing the key-value pair completely. Before proceeding, change the value back and re-compile your app. Unless you have a very good reason, you really should keep the default reflective shine enabled.</p><p>Although you apply these iOS specific settings to the application descriptor file, it is specific to AIR applications and isn't understood by iOS. Instead, when you publish your FLA, Flash generates and includes with your IPA a configuration file that can be understood by iOS. This is known as the<strong> Information Property List</strong> file, which by convention is named<code class="literal"> Info.plist</code>, and contains many properties used to describe your app, including any custom properties you set.</p><p>You can find more information regarding the Information Property List and the properties that can be set by visiting Apple's iOS Developer Library at<a class="ulink" href="http://developer.apple.com/library/ios/#documentation/general/Reference/InfoPlistKeyReference/Articles/AboutInformationPropertyListFiles.html"> http://developer.apple.com/library/ios/#documentation/general/Reference/InfoPlistKeyReference/Articles/AboutInformationPropertyListFiles.html</a>.<a id="id256" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec31"/>There's more...</h2></div></div></div><p>Although we have only used the application descriptor file to remove the icon's reflective shine, there are many more configuration options. Another option that is commonly used, and has been touched upon already within this and the previous chapter, is the status bar and its appearance.</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec17"/>Status bar style</h3></div></div></div><p>On iPhone and iPod touch, the appearance of the status bar can be changed; the status bar cannot be changed on iPad and is always black. Although you can specify whether or not the status bar should be shown within your app, Flash does not provide any options for controlling the appearance. If you decide to use the status bar, you can add the<code class="literal"> UIStatusBarStyle</code> key to the application descriptor file in order to set one of the following three styles supported by iOS:<a id="id257" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">UIStatusBarStyleDefault</code> —The default gray status bar</li><li class="listitem" style="list-style-type: disc"><code class="literal">UIStatusBarStyleBlackOpaque</code> —Opaque black status bar</li><li class="listitem" style="list-style-type: disc"><code class="literal">UIStatusBarStyleTranslucent</code> —Black status bar with 50% transparency</li></ul></div><p>To opt for the opaque black status bar, add the following key-value pair to the application descriptor file:</p><div><pre class="programlisting">&lt;key&gt;UIStatusBarStyle&lt;/key&gt;
&lt;string&gt;UIStatusBarStyleBlackOpaque&lt;/string&gt;
</pre></div><p>Try both<code class="literal"> UIStatusBarStyleBlackOpaque</code> and<code class="literal"> UIStatusBarStyleTranslucent</code>. Your options are a little limited but they can come in handy for certain apps where the default status bar doesn't visually sit with the design. If you want to use the default status bar, then there is no need to explicitly add a key-value pair to the application descriptor file.</p></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec32"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Specifying a persistent Wi-Fi connection, <a class="link" href="ch13.html" title="Chapter 13. Connectivity, Persistence, and URI Schemes">Chapter 13</a></em></li><li class="listitem" style="list-style-type: disc"><em>Declaring device capabilities, <a class="link" href="ch13.html" title="Chapter 13. Connectivity, Persistence, and URI Schemes">Chapter 13</a></em><a id="id258" class="indexterm"/></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec11"/>Remote debugging</h1></div></div></div><p>Debugging is a critical aspect of the development process. Flash Professional allows you to send debug information from the device directly to the Flash IDE for inspection.<a id="id259" class="indexterm"/>
</p><p>With the example Bubbles app now complete, we will finish off this chapter by learning how to deploy a debug build and receive trace data from it using Flash Professional's remote debugger.<a id="id260" class="indexterm"/>
</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec33"/>Getting ready</h2></div></div></div><p>We will be adding a line of ActionScript to the document class of the Bubbles app that you created throughout the course of this and the previous chapter. Alternatively, from the book's accompanying code bundle, open<code class="literal"> chapter3\recipe10\bubbles.fla</code> within Flash Professional and work from there.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec34"/>How to do it...</h2></div></div></div><p>The debug process is split into two main steps:<a id="id261" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating a debug build</li><li class="listitem" style="list-style-type: disc">Connecting to the Remote Debugger</li></ul></div><p>Let us begin by creating a debug build that contains a single trace statement.</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec18"/>Creating a debug build</h3></div></div></div><p>Follow these steps:</p><div><ol class="orderedlist"><li class="listitem">If you haven't already done so, open the document class by selecting<strong> File</strong> |<strong> Open</strong> <em>(Ctrl + O</em> |<em> Cmd</em> +<em> O)</em> from Flash Professional's drop-down menu. From the file browser, select<code class="literal"> Main.as</code>.<a id="id262" class="indexterm"/></li><li class="listitem">Add a simple<code class="literal"> trace()</code> statement at the beginning of the class' constructor:<div><pre class="programlisting">public function Main() {
<strong>trace("Inside the constructor.");
</strong>
</pre></div></li><li class="listitem">Save your changes and move back to your FLA by clicking on its tab.</li><li class="listitem">Open the AIR for iOS Settings panel by selecting<strong> File</strong> |<strong> AIR for iOS Settings</strong> from the drop-down menu.</li><li class="listitem">From the settings panel, ensure the<strong> General</strong> tab is selected and update the<strong> Version</strong> field to<strong> 0.7</strong>. Now move to the<strong> Deployment</strong> tab and select<strong> Quick publishing for device debugging</strong> from the<strong> iOS deployment type</strong> section.<a id="id263" class="indexterm"/></li><li class="listitem">Click on<strong> OK</strong> and save your FLA.</li><li class="listitem">Now publish your FLA for iOS by selecting<strong> File</strong> |<strong> Publish</strong> (Alt +<em> Shift</em> +<em> F12</em> |<em> Shift</em> +<em> Cmd</em> +<em> F12)</em> and install the IPA on your device.<a id="id264" class="indexterm"/></li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch03lvl3sec19"/>Connecting to the Remote Debugger</h3></div></div></div><p>Before launching the app, you will need to carry out the following actions in order to receive debug information from it:<a id="id265" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Connect your device to your Wi-Fi network.</li><li class="listitem">Obtain your development computer's IP address.</li><li class="listitem">Begin a Remote Debug session from the Flash IDE.</li></ol></div><p>Let us walk through these steps in detail:</p><div><ol class="orderedlist"><li class="listitem">Remote debugging takes place over Wi-Fi. Verify that your device is connected to the same network as your development computer by selecting<strong> Settings</strong> |<strong> Wi-Fi</strong> from the device's home screen. If it is not, then select the correct network from the<strong> Choose a Network</strong> section. This is shown in the screenshot on the following page.</li><li class="listitem">You will also need to know the IP address of the computer you are running Flash Professional from. If you are using Microsoft Windows, then open a command prompt window and enter the following:<div><pre class="programlisting">ipconfig
</pre></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">Network configuration details will be output to the command window. Your computer's IP address consists of four numbers separated by periods and can be found by looking for <strong>IPv4 Address</strong> among the output. The following is an example:<a id="id266" class="indexterm"/></li></ul></div><div><pre class="programlisting"><strong>IPv4 Address. . . . . . . . . . . : 192.168.0.4
</strong>
</pre></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">For those using Mac OS X, choose System Preferences from the Apple menu. In the System Preferences window, click on the Network icon from the Internet &amp; Wireless section. Your IP address will be shown within the Network window, underneath the Status heading.<p>We are now ready to perform remote debugging.
</p></li></ul></div></li><li class="listitem">First activate Flash's remote debugger by selecting<strong> Debug</strong> |<strong> Begin Remote Debug Session</strong> |<strong> ActionScript 3.0</strong> from the drop-down menu. This will switch the IDE to its<strong> DEBUG</strong> workspace with the following message being sent to the<strong> OUTPUT</strong> window:<div><pre class="programlisting"><strong>Waiting for Player to connect...
</strong>
<a id="id267" class="indexterm"/>
</pre></div></li><li class="listitem">Essentially the Flash IDE is now ready to receive debug information from your debug app and will wait for up to two minutes for the app to connect to it.<div><h3 class="title"><a id="note31"/>Note</h3><p>If it is not already available from the debug workspace, then open the<strong> OUTPUT</strong> window by selecting<strong> Window</strong> |<strong> Output (F2)</strong>  from Flash's drop-down menu.</p></div></li><li class="listitem">Now, move back to your device's home screen and launch the app.<div><img src="img/1383_03_05.jpg" alt="Connecting to the Remote Debugger"/></div></li><li class="listitem">The app will attempt to automatically connect to the Flash IDE. However, if it fails, a<strong> Flash Debugger</strong> dialog box will appear, similar to the preceding screenshot, asking you to enter the IP address of the computer it should connect to. If prompted, enter your development computer's IP address and tap on<strong> OK</strong> to connect.<a id="id268" class="indexterm"/></li><li class="listitem">Upon a successful connection, the name of the app's<code class="literal"> .swf</code> file will be sent to the Flash IDE's<strong> OUTPUT</strong> window followed by any trace statements that are executed. For this recipe, the following will be output:<a id="id269" class="indexterm"/><div><pre class="programlisting"><strong>[SWF] bubbles.swf - 327469 bytes after decompression
Inside the constructor.
</strong>
</pre></div></li><li class="listitem">As you can see, the message from your constructor's <code class="literal">trace() </code>statement has been sent to the output window.</li><li class="listitem">Now, terminate the debug session by selecting<strong> Debug</strong> |<strong> End Debug Session</strong> <em>(Alt + F12)</em> from Flash Professional's drop-down menu. The Flash IDE will move back to the workspace you were using previously.<a id="id270" class="indexterm"/></li></ol></div></div></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec35"/>How it works...</h2></div></div></div><p>Remote debugging is invaluable for identifying and fixing bugs and should be familiar to experienced Flash developers. Using the<code class="literal"> trace()</code> statement, you can send information from your app to the Flash IDE's<strong> OUTPUT</strong> window.<a id="id271" class="indexterm"/>
</p><p>When debugging, remember to select the<strong> Quick publishing for device debugging</strong> deployment type from the<strong> AIR for iOS Settings</strong> panel. It is also important that both your test device and development computer are connected to the same network. Although your device may be connected to your computer through its USB cable, remote debugging only works over Wi-Fi for AIR for iOS applications.</p><p>This recipe focused on the<code class="literal"> trace()</code> statement, but remote debugging for iOS supports additional features including breakpoint control, stepping through code, and the monitoring of variables. These advanced debugging features are unfortunately out of the scope of this book. However, a comprehensive introduction to the ActionScript 3.0 debugger is available from the Adobe Flash Developer Center at<a class="ulink" href="http://www.adobe.com/devnet/flash/articles/as3_debugger.html"> www.adobe.com/devnet/flash/articles/as3_debugger.html</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec36"/>There's more...</h2></div></div></div><p>With any luck, your app will successfully connect to the remote debug session. However, if you are experiencing problems connecting then read on.</p><div><div><div><div><h3 class="title"><a id="ch03lvl3sec20"/>Remote connection attempts</h3></div></div></div><p>A debug build of your app will attempt to connect, by default, to your development computer's IP address. If the connection attempt fails, then you will be asked to manually enter the correct IP address. Unfortunately, apps published using older versions of AIR can wait for up to one minute before giving up and prompting for an IP address, which is hardly ideal when rapidly deploying and testing new debug builds.<a id="id272" class="indexterm"/>
</p><p>During this time, the screen will remain blank and your iOS device may eventually auto-lock if left untouched. If locked, you may miss the app's prompt for the correct IP address, which will lead to your debug session timing out.</p><p>To prevent this from happening, consider increasing the auto-lock time on your iOS device by selecting<strong> Settings</strong> |<strong> General</strong> |<strong> Auto-Lock</strong> from the home screen.<a id="id273" class="indexterm"/>
</p><p>Those using Flash Professional CS5.5 and the latest version of AIR are unlikely to experience such lengthy timeout periods.<a id="id274" class="indexterm"/>
</p></div></div></div></body></html>