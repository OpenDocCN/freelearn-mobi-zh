<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Xcode Tools - Improvements</h1></div></div></div><p>Since the release of the iPhone 4 back in 2010, developers were impressed by the remarkable<code class="literal"> 960x640-resolution</code> retina screen display, and provided a way to stay in touch with friends and family, using the FaceTime video-calling feature.</p><p>The iPhone 4 camera has been updated and features front and back cameras, as well as a standard 5-megapixel camera with a built-in LED flash and HD video editing that allows you to record and edit stunning HD video. With the release of the iPhone 4S, this has been updated to include the ability to record HD videos at 1080 pixels, with the added ability to directly edit your videos from within the iOS device.</p><p>Starting with Xcode 4, the<strong> Gyroscope</strong> feature was integrated into the Accelerometer, which provided developers the flexibility to program this and create some stunning games. With the release of iOS 5 SDK, the LLVM compiler has been updated to include the new<strong> Automatic Reference Counting</strong> (<strong>ARC</strong>) feature.<a id="id267" class="indexterm"/>
</p><p>With the release of Xcode 4.2 and the iOS 5 SDK, Interface Builder has been updated to provide a better way of transitioning between your views and view controller, by introducing story boarding for your iOS applications, featured directly within the Xcode IDE.<a id="id268" class="indexterm"/>
</p><p>You will also notice that the iOS simulator has also been revamped, and now allows you to simulate different locations using the Core Location framework, all directly from within the Xcode Development Environment.</p><p>In this chapter, we will:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Learn about the latest improvements to the LLVM Compiler</li><li class="listitem" style="list-style-type: disc">Learn how to create storyboard files using Interface Builder</li><li class="listitem" style="list-style-type: disc">Learn about the changes made to the iOS simulator</li><li class="listitem" style="list-style-type: disc">Learn about the improvements made to OpenGL ES</li><li class="listitem" style="list-style-type: disc">Understand the application data management and UI automation enhancements</li></ul></div><p>Let's get started.</p><div><div><div><div><h1 class="title"><a id="ch06lvl1sec01"/>LLVM compiler</h1></div></div></div><p>This technology is an open source compiler technology, which is currently being led by Apple's compiler team to be used in several high-end performance projects around the globe. The LLVM 2.0 compiler has also been substantially updated, and now compiles twice as fast as the GCC compiler, producing applications that load faster on the iOS device.<a id="id269" class="indexterm"/>
</p><p>It has been rewritten as a set of optimized code libraries, which have been designed around today's modern chip architectures. It has been fully integrated into the Xcode 4 development IDE, and provides complete support for the following languages: C, Objective-C, and C++.</p><p>In the next section, we will talk about the Automatic Reference Counting feature that has been added as part of the LLVM compiler.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec01"/>Automatic Reference Counting (ARC)</h2></div></div></div><p>
<strong>Automatic Reference Counting</strong> (<strong>ARC</strong>) for Objective-C makes memory management the job of the compiler. When you enable ARC using the new Apple LLVM 3.0 compiler, this will largely remove the burden of manually releasing memory, and avoid the endless chore of tracking down program bugs caused by memory leaks or objects that have been released too early.<a id="id270" class="indexterm"/>
</p><p>The ARC compiler has a complete understanding of your objects, and releases each object the instant it is no longer used, so applications run as fast as ever, with predictable, smooth performances. In a majority of situations, you will never need to type retain or release again, and this will dramatically simplify the development process, while reducing crashes and memory leaks.</p><p>Xcode comes with a new<strong> Convert to Objective-C ARC..</strong>. tool, that is located within the<strong> Edit | Refactor</strong> menu within the IDE, as shown in the following screenshot:<a id="id271" class="indexterm"/>
</p><div><img src="img/2267_06_00.jpg" alt="Automatic Reference Counting (ARC)"/></div><p>This tool automates the mechanical parts of the ARC conversion, by removing method calls such as<code class="literal"> retain</code> and<code class="literal"> release</code>, and helps you to fix issues the migrator can't handle automatically. The ARC migration tool converts all files within a project to use ARC; you also have the added option of choosing to use ARC on a per-file basis to overcome some of ARC's current restrictions, and use manual reference counting for some files.<a id="id272" class="indexterm"/>
</p><p>The following screenshot implies that writing operative code takes almost as long to write as retain/release logic. This will not be true for experienced Objective-C developers, but if you are a new and just starting out with Objective-C, this is probably a conservative estimate.</p><div><h3 class="title"><a id="note31"/>Note</h3><p>For more information on Objective-C, please refer to the<em> Apple Developer Documentation</em> at the following location:<a class="ulink" href="http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/ObjectiveC/Introduction/introObjectiveC.html#//apple_ref/doc/uid/TP30001163"> http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/ObjectiveC/Introduction/introObjectiveC.html#//apple_ref/doc/uid/TP30001163</a>.</p></div><p>You will still need to take some responsibility for how your classes manage reference to other objects, rather than relying totally on ARC.<a id="id273" class="indexterm"/>
</p><div><img src="img/2267_06_01.jpg" alt="Automatic Reference Counting (ARC)"/></div><p>ARC provides automatic memory management for your objects, without you having to remember when to use retain, release, and auto-release. ARC starts by evaluating your objects, and automatically inserts the appropriate method calls for you at compile time, as well as generating the appropriate<code class="literal"> dealloc</code> method calls for you.<a id="id274" class="indexterm"/>
</p><p>For example, let's take a look at an example that shows the older way of doing things prior to the use of ARC, as shown in the following code snippet:</p><div><pre class="programlisting">NSObject *obj = [[NSObject alloc] init];
…
…
// do some program logic here.
[obj release];
</pre></div><p>In between allocating and initializing an object, and then finally releasing the object, you can do with it as you wish, and the object will only be released and de-allocated when it is not in use.</p><p>Similarly, by adding the object to an auto-release pool, it will stick around until it is needed, and will be de-allocated sometime when it is no longer needed. This is shown in the following code snippet of how this would have been doing prior to ARC.</p><div><pre class="programlisting">- (NSObject *) someMethod {
NSObject *obj = [[[NSObject alloc] init] autorelease];
return obj; // This will be released by the autorelease pool.
}
</pre></div><p>If you are new to iOS programming, you may have trouble getting your head around the use of reference counted memory at first, but once you get the hang of it, you'll soon see its potential. This is particularly useful when developing applications for iOS devices, as it can remove the burden of tracking bugs caused by leaking or over-released objects.<a id="id275" class="indexterm"/>
</p><p>Many developers forget to release the allocation of memory to previously declared objects, resulting in sluggish performance issues, or more severe, causing their application to hang or crash.</p><p>Under ARC, this gets handled differently, and a pre-compilation step takes place, which adds retain, release, and auto-release statements into the code for you. This is by no means a form of garbage collection, and the referenced counted memory has not disappeared, it has simply been automated.</p><p>Take a look at the following ARC-enabled code snippet:</p><div><pre class="programlisting">NSObject *obj = [NSObject alloc] init];
…
…
// do some program logic here.
</pre></div><p>The ARC pre-compilation step will automatically turn this into:</p><div><pre class="programlisting">NSObject *obj = [NSObject alloc] init];
// do some program logic here.
[obj release]; // Added by ARC
</pre></div><p>In order for the compiler to generate the correct code, ARC imposes some strict restrictions on the methods that you can use, as well as introducing new lifetime qualifiers for object references and declared properties.</p><p>These new rules are not present when using the other compiler modes, and are intended to provide a fully reliable memory management model. They have been set up, in some cases, to enforce best practice. In other cases, they simplify your code so that you don't have to deal with memory management issues.</p><p>Violation of these rules will result in an immediate compile-time error, not some program bug that can become apparent at runtime. The following table explains the rules you need to abide by, in order to compile with ARC:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p><strong>ARC rule</strong></p>
</th><th style="text-align: left" valign="bottom">
<p><strong>Description</strong></p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Alloc/Init objects</p>
</td><td style="text-align: left" valign="top">
<p>When creating objects, you must not make any calls to retain, release, auto-release, and retain<code class="literal"> Count</code> methods, or indirectly call their selectors, that is,<code class="literal"> @selector(retain)</code> and<code class="literal"> @selector(release).</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Dealloc methods</p>
</td><td style="text-align: left" valign="top">
<p>Generally these will be created for you, but you must not make a<code class="literal"> dealloc</code> call directly. However, you can still create a custom<code class="literal"> dealloc</code> method, if you need to release resources other than the instance variables. When creating a custom<code class="literal"> dealloc</code> method, do not call the<code class="literal"> [super dealloc]</code> method, as this will be done for you, and is enforced by the compiler.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Declared properties</p>
</td><td style="text-align: left" valign="top">
<p>Before ARC, we told the compiler how to memory-manage declared<code class="literal"> public</code> properties using the<code class="literal"> assign, retain</code>, and<code class="literal"> copy</code> parameters using the<code class="literal"> @property</code> directive.</p>
<p>These parameters are no longer used in ARC. Instead, we have two new parameters,<code class="literal"> weak</code>, and<code class="literal"> strong</code>, that tell the compiler how we want our properties treated.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Object pointers in C structures</p>
</td><td style="text-align: left" valign="top">
<p>The Apple documentation suggests storing them in a class instead of a struct. This makes sense, since they would otherwise be unknown to ARC. It might cause some extra migration headaches.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Casual casting between<code class="literal"> id</code> and<code class="literal"> void*</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Casting between<code class="literal"> id</code> and<code class="literal"> void*</code> data types is frequently done when handing objects between Core Foundation's C library functions and Foundation Kit's Objective-C library methods. This is known as<strong> Toll Free Bridging</strong>. With ARC, you must provide hints/qualifiers to tell the compiler when CF objects are moving in and out of its control for memory management.</p>
<p>These qualifiers include<code class="literal"> __bridge, __bridge_retain</code>, and<code class="literal"> __bridge_transfer</code>. You still need to call<code class="literal"> CFRetain</code> and<code class="literal"> CFRelease</code> to memory manage Core Foundation objects.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">@autoreleasepool</code> instead of<code class="literal"> NSAutoReleasePool</code>
</p>
</td><td style="text-align: left" valign="top">
<p>If you use ARC compliant code within your applications, it must not use<code class="literal"> NSAutoReleasePool</code> objects, instead it must use the<code class="literal"> @autoreleasepool{}</code> blocks.</p>
<p>A good example of this can be found within the<code class="literal"> main.m</code> file of any ARC project.</p>
<p>int main(int argc, char *argv[]){</p>
<p>@autoreleasepool {</p>
<p>return UIApplicationMain(argc, argv, nil, NSStringFromClass([MyAppDelegate class]));</p>
<p>}</p>
<p>}</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Memory zones</p>
</td><td style="text-align: left" valign="top">
<p>You cannot use<code class="literal"> NSZone</code> zone-based memory (This is not part of the runtime anymore); you cannot use<code class="literal"> NSAllocateObject</code> or<code class="literal"> NSDeallocateObject</code>.</p>
</td></tr></tbody></table></div><p>As programmers, we find ourselves making decisions like whether to make something a variable or a constant, or whether or not it needs to be defined locally or globally. This same concept applies when we decide how our properties relate to other objects. To do this, we use the strong and/or weak qualifiers to notify the compiler of these relationships.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec01"/>Strong references</h3></div></div></div><p>These provide a reference to an object that stops it from being de-allocated. In other words, it creates an owner relationship. Prior to ARC, you would have declared your properties as follows:<a id="id276" class="indexterm"/>
</p><div><pre class="programlisting">// Non-ARC Compliant Declaration
@property(retain) NSObject *obj;
</pre></div><p>If we take a look at how this same property would be declared under ARC, this would be done as follows, to ensure that a class instance takes ownership of a referenced object:</p><div><pre class="programlisting">// ARC Compliant Declaration
@property(strong) NSObject *obj;
</pre></div><p>Consider the following code snippet:</p><div><pre class="programlisting">MyClass *obj1 = [[MyClass alloc] init];
MyClass *obj2 = obj1;
</pre></div><p>As you can see, we have declared two objects and have allocated the memory to our<code class="literal"> obj1</code> object variable. We then declare a new object variable<code class="literal"> obj2</code>, which has a strong reference to<code class="literal"> obj1</code>. If we remove<code class="literal"> obj2</code> from memory, then<code class="literal"> obj1</code> also gets removed.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec02"/>Weak references</h3></div></div></div><p>These provide a reference to an object that does not stop it from being de-allocated. In other words, it does not create an owner relationship. Previously you would have done this:<a id="id277" class="indexterm"/>
</p><div><pre class="programlisting">// Non-ARC Compliant Declaration
@property(assign) NSObject *parentObj;
</pre></div><p>If we take a look at how this same property would be declared under ARC. This would be done as follows to ensure that you do not have ownership of the object that is being referenced.</p><div><pre class="programlisting">// ARC Compliant Declaration
@property(weak) NSObject *parentObj;
</pre></div><p>Consider the following code snippet:</p><div><pre class="programlisting">__weak NSString *weakName = self.textField.text;
</pre></div><p>We start by declaring a variable called<code class="literal"> weakName</code>, which points at the same string object that the<code class="literal"> textField.text</code> property points to - this contains the name<code class="literal"> Albert Einstein</code>. If the string contents change, then the string object no longer has any owners and is de-allocated. This is shown below in the following piece of code:<a id="id278" class="indexterm"/>
</p><div><pre class="programlisting">__weak NSString *weakName = @"Captain Jack Sparrow";
</pre></div><p>When this happens, the value of<code class="literal"> weakName</code> automatically becomes<code class="literal"> nil</code>, and is what is called a zeroing weak pointer. This is extremely convenient, because it prevents weak pointers from pointing to de-allocated memory. Previously, this sort of thing used to cause a lot of programming bugs; for example, the term dangling pointers or zombies.<a id="id279" class="indexterm"/>
</p><p>
<strong>Weak pointers</strong> are mostly useful when two objects have a parent-child relationship. The parent will have a strong pointer to the child and therefore owns the child, but in order to prevent ownership cycles, the child only has a weak pointer back to the parent. Consider the following code snippet:<a id="id280" class="indexterm"/>
</p><div><pre class="programlisting">__weak NSString *str = [[NSString alloc] initWithFormat:@"Weakname: %@", weakName];
NSLog(@"%@", str); // This will output "(null)"
</pre></div><p>Since there is no owner for the string object (because<code class="literal"> str</code> is weak), the object will be de-allocated immediately after it is created. Xcode will give a warning when you try to do this, because it's probably not what you intended to do (Warning:<em> assigning retained object to weak variable; object will be released after assignment)</em>.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec03"/>ARC qualifiers regular variables</h3></div></div></div><p>ARC introduces several new lifetime qualifiers for objects, and zeroing weak references. A weak reference does not extend the lifetime of the object that it points to. A zeroing weak reference, also known as a weak qualifier, instructs the compiler that you do not need to retain the object. If all the references to this object go down to zero, then the object is released and set to<code class="literal"> nil</code>.</p><p>This is important, because a message sent to a<code class="literal"> nil</code> object does not cause a crash; it simply doesn't do anything. However, you can still use<code class="literal"> assign</code>, but it is recommended that you use<code class="literal"> weak</code> instead, because it will set a de-allocated object to<code class="literal"> nil</code>. A weak qualifier is especially used in a parent-child object relationship, where the parent has a strong reference to a child object, and the child object has a weak reference back to the parent, otherwise you will end up creating a circular reference.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec04"/>Variable qualifiers<a id="id281" class="indexterm"/>
</h3></div></div></div><p>In the previous code snippets, we illustrated how our declared properties should be managed. For regular variables we have:<a id="id282" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">__strong</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">__weak</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">__unsafe_unretained</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">__autoreleasing</code></li></ul></div><p>Generally speaking, these extra qualifiers need not be used very often. You might first encounter these qualifiers, and others, when using the migration tool. For new projects, however, you won't need them and will mostly use<code class="literal"> strong/weak</code> with your declared properties.</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p><strong>ARC types</strong></p>
</th><th style="text-align: left" valign="bottom">
<p><strong>Description</strong></p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">__strong</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the default, so you don't need to type it. This means any object created using<code class="literal"> alloc/init</code> is retained for the lifetime of its current scope. The<strong> current scope</strong> usually means the braces in which the variable is declared (that is, a method,<code class="literal"> for</code> loop,<code class="literal"> if</code> block, and so on).</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">__weak</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This means the object can be destroyed at any time. This is only useful if the object is somehow strongly referenced somewhere else. When destroyed, a variable with<code class="literal"> __weak</code> is set to<code class="literal"> nil.</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">__unsafe_unretained</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is similar to the<code class="literal"> __weak</code> type, but the pointer is not set to<code class="literal"> nil</code> when the object is de-allocated. Instead the pointer is left pointing to an unsafe area of memory.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">__autoreleasing</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is not to be confused with calling<code class="literal"> autorelease</code> on an object, before returning it from a method. This is used for passing objects by reference, for example, when passing<code class="literal"> NSError</code> objects by reference such as<code class="literal"> [myObject performOperationWithError:&amp;tmp]</code>;</p>
</td></tr></tbody></table></div><div><h3 class="title"><a id="note32"/>Note</h3><p>For more information on the<em> LLVM Clang Objective-C Automatic Reference Counting</em> documentation, you can refer to the following link provided:<a class="ulink" href="http://clang.llvm.org/docs/AutomaticReferenceCounting.html#ownership"> http://clang.llvm.org/docs/AutomaticReferenceCounting.html#ownership</a>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec02"/>Interface builder</h2></div></div></div><p>In Xcode 4, the Interface Builder is a user interface design tool where you can build your user interface, by dragging and dropping objects from the Object Library onto a blank canvas. The resulting user interface would then be saved as an XIB file, which is an XML representation of your objects and their instance variables.<a id="id283" class="indexterm"/>
</p><p>In the past, when creating a new view, you would have to create an XIB file for each view that your application required, to transition from each view to the next. In order to make designing your iOS applications much easier, Apple improved the user interface design process and introduced the<strong> Storyboarding</strong> feature.<a id="id284" class="indexterm"/>
</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec05"/>Support for creating storyboard files for iOS applications</h3></div></div></div><p>With the release of Xcode 4.2, Interface builder has been updated to provide a better way to design your user interfaces, by graphically arranging all of your views within a single canvas so that you can define your applications, logical flow as well as assign transitions between them.<a id="id285" class="indexterm"/>
</p><p>Using storyboards within your applications, eases the development process by managing the view controllers for you. You can specify the transitions and segues that are used when switching between views, without having to code them by hand.</p><p>To refresh your memory, you can refer to<a class="link" href="ch04.html" title="Chapter 4. Using Storyboards"> Chapter 4</a>,<em> Using Storyboards</em>, under the section<em> How to go about creating Storyboard files</em>, for more information on how to go about creating storyboard files using the Interface Builder.</p></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec03"/>Location simulator</h2></div></div></div><p>Starting with the release of Xcode 4.2 and iOS 5, you now have the ability to test your location-based features in your application without leaving your desk. You can now select from preset locations and routes within the iOS simulator, and pick a custom latitude and longitude with accuracy, while you're running your simulated application.<a id="id286" class="indexterm"/>
</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec06"/>Creating a simple geographical application</h3></div></div></div><p>Before we can proceed, we first need to create our<code class="literal"> MapKitExample</code> project. To refresh your memory, you can refer to the section named<em> Creating the MyEmailApp application</em>, in<a class="link" href="ch01.html" title="Chapter 1. What's New in iOS5"> Chapter 1</a>,<em>What's new in iOS5.</em><a id="id287" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem"> Launch Xcode from the<code class="literal"> /Xcode4/Applications</code> folder.</li><li class="listitem"> Choose<strong> Create a new Xcode project</strong>, or<strong> File | New Project</strong>.</li><li class="listitem"> Select the<strong> Single View Application</strong> template from the list of available templates.</li><li class="listitem"> Select<strong> iPhone</strong> from under the<strong> Device Family</strong> drop-down.</li><li class="listitem"> Ensure that you have checked the box for<strong> Use Automatic Reference Counting</strong> from under the<strong> iPhone Device Family</strong> drop-down.<a id="id288" class="indexterm"/><div><img src="img/2267_06_02.jpg" alt="Creating a simple geographical application"/></div></li><li class="listitem"> Click on the<strong> Next</strong> button to proceed to the next step in the wizard.</li><li class="listitem"> Enter in<code class="literal"> MapKitExample</code>, and then click on the<strong> Next</strong> button to proceed to the next step of the wizard.</li><li class="listitem"> Specify the location where you would like to save your project.</li><li class="listitem"> Click on the<strong> Save</strong> button to continue and display the Xcode workspace environment.<a id="id289" class="indexterm"/></li></ol></div><p>Now that we have created our<code class="literal"> MapKitExample</code> project, we need to add the<code class="literal"> MapKit</code> framework to our project, in order for our application to view map information. Select the<strong> Project Navigator Group</strong>, and then follow these simple steps:</p><div><ol class="orderedlist"><li class="listitem"> Select your project.</li><li class="listitem"> Then select your project target from under the<code class="literal"> TARGETS</code> group.</li><li class="listitem"> Select the<strong> Build Phases</strong> tab.</li><li class="listitem"> Expand the<strong> Link Library with Libraries</strong> disclosure triangle.</li><li class="listitem"> Use the<strong> +</strong> to add the library that you want. You can also search, if you can't find the framework you are after, from within the list.</li></ol></div><p>If you are still confused as to how to go about adding the frameworks, follow this screenshot, which highlights the areas that you need to select (surrounded by a red rectangle):<a id="id290" class="indexterm"/>
</p><div><img src="img/2267_06_03.jpg" alt="Creating a simple geographical application"/></div><p>Now that you have added the<code class="literal"> MapKit.framework</code> into your project, we need to import the code into the<code class="literal"> ViewController</code> that will be responsible for displaying our map location information.<a id="id291" class="indexterm"/>
</p><p>In order to make our application display the map to our view, we will need to import the<code class="literal">&lt;MapKit/MapKit.h&gt;</code> interface header file, so that we can utilize its methods:</p><div><ol class="orderedlist"><li class="listitem"> Open the<code class="literal"> ViewController.h</code> interface file located within the<strong> Classes</strong> folder, and add the following code:<div><pre class="programlisting">#import &lt;UIKit/UIKit.h&gt;<strong>
#import &lt;MapKit/MapKit.h&gt;
@interface ViewController : UIViewController {
MKMapView *mapView;
}</strong>
</pre></div></li><li class="listitem">In this code snippet, we have included a reference to the Cocoa <code class="literal">MapKit.h</code> header file, which will expose its methods, so that we can use these within our <code class="literal">ViewController</code> implementation file, and then we have created an instance variable (<code class="literal">mapView</code>), which is a string pointer to our <code class="literal">MKMapView</code> object, which is responsible for holding our map location information.</li><li class="listitem"> We haven't quite finished yet. We now need to modify our<code class="literal"> ViewDidLoad</code> method, located within our<code class="literal"> ViewController.m</code> implementation file. So, open the<code class="literal"> ViewController.m</code> implementation file.<a id="id292" class="indexterm"/></li><li class="listitem"> Locate and uncomment the<code class="literal"> ViewDidLoad</code> method, and add the following code snippet to it:<a id="id293" class="indexterm"/><div><pre class="programlisting"><strong>- (void)viewDidLoad {</strong>
[super viewDidLoad];<strong>
mapView = [[MKMapView alloc] initWithFrame:[self.view bounds]];</strong>
[self.view addSubview:mapView];
}
</pre></div></li><li class="listitem">In this code snippet, what we have actually done is allocated and initialized memory for our <code class="literal">mapView</code> object that we declared within our <code class="literal">ViewController.h</code> file, and then we added our <code class="literal">mapView</code> object to our current view, so that we can display this to the screen.</li><li class="listitem"> The<code class="literal"> mapKit</code> framework has the ability to show you your current location within the map. It also allows you to set a variety of<code class="literal"> mapTypes</code>. Next, we will be adding some additional code to our<code class="literal"> ViewDidLoad</code> method as highlighted in the following code snippet. This is located within our<code class="literal"> ViewController.m</code> implementation file.<div><pre class="programlisting">- (void)viewDidLoad {
[super viewDidLoad];
mapView = [[MKMapView alloc] initWithFrame:[self.view bounds]];
mapView.mapType=MKMapTypeHybrid;
mapView.showsUserLocation=YES;
[self.view addSubview:mapView];
}
</pre></div></li><li class="listitem">In this code snippet, what we have done is added the ability to display our map in <strong>Hybrid</strong> view (combination of satellite view and road information) as well as directed our map to display our current location that will be indicated by an animated blue marker.<a id="id294" class="indexterm"/></li></ol></div><p>The iOS native maps application allows you to choose from the following three possible map types:<a id="id295" class="indexterm"/>
</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p><strong>Map type constant</strong></p>
</th><th style="text-align: left" valign="bottom">
<p><strong>Description</strong></p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">MKMapTypeStandard</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the default type of map to display, if none is specified, and this type will show a normal map containing street and road names.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">MKMapTypeSatellite</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Setting this type of map will display satellite view information.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">MKMapTypeHybrid</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This type of map will show a combination of a satellite view with road and street information overlaid.</p>
</td></tr></tbody></table></div><p>If you build and run your application, you should now see a map displayed with the animated blue marker flashing. I have rotated the device and zoomed in at a random location to show the capabilities of the<code class="literal"> MapKit</code> framework, as is shown in the following screenshot:</p><div><img src="img/2267_06_04.jpg" alt="Creating a simple geographical application"/></div><div><h3 class="title"><a id="tip03"/>Tip</h3><p>When running<code class="literal"> MapKit</code> applications using the iOS Simulator, it will always default to Apple's headquarters located at 1, Infinite Loop, based out at California.</p><p>In order to get a better location, it is much better to use your iOS device. This is because the iOS simulator uses your IP address to work out an approximate location of where you are located.</p></div><p>You can also choose to navigate to a different location while the iOS simulator is running. To do this, follow these simple steps:<a id="id296" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem"> Click on<strong> Simulate Location</strong> icon as shown in the following screenshot. This will display a list of available locations:<a id="id297" class="indexterm"/><div><img src="img/2267_06_05.jpg" alt="Creating a simple geographical application"/></div></li><li class="listitem"> Select<strong> Tokyo, Japan</strong>, or a similar option from the list of displayed locations.</li><li class="listitem"> The iOS simulator will be updated to reflect the chosen location, as shown in the following screenshot:</li></ol></div><div><img src="img/2267_06_06.jpg" alt="Creating a simple geographical application"/></div><p>In this section, we learned about the<code class="literal"> MapKit</code> framework, and how we can use this within our application to simulate to a particular location. We learned how to use the<strong> Simulate Location</strong> feature of the Xcode debugger, to navigate to various locations within the iOS simulator.<a id="id298" class="indexterm"/>
</p><div><h3 class="title"><a id="note33"/>Note</h3><p>For more information on the<code class="literal"> MKMapView</code> class reference, please refer to the<em> Apple Developer Documentation</em> at the following link location provided:<a class="ulink" href="http://developer.apple.com/library/ios/#documentation/MapKit/Reference/MKMapView_Class/MKMapView/MKMapView.html#//apple_ref/doc/uid/TP40008205"> http://developer.apple.com/library/ios/#documentation/MapKit/Reference/MKMapView_Class/MKMapView/MKMapView.html#//apple_ref/doc/uid/TP40008205</a>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec04"/>OpenGL ES debugging</h2></div></div></div><p>The OpenGL ES debugger allows you to track down issues specific to OpenGL ES within your application. You can then choose to have this break at a certain point within your program. To refresh your memory, you can refer to the section named<em> Detecting errors by setting up breakpoints</em>, that we covered in<a class="link" href="ch03.html" title="Chapter 3. Debugging with OpenGL ES"> Chapter 3</a>,<em> Debugging with OpenGL ES</em>, for more information on how to go about debugging OpenGL ES projects.<a id="id299" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec05"/>OpenGL ES frame capture</h2></div></div></div><p>The OpenGL ES frame capture is part of the Xcode debugger, and allows you to take a snapshot of all of the frames that are being drawn within your application at the point it was captured. You can then choose to navigate through each of the frames and see the associated code, as well as changing between solid or wireframe view. To refresh your memory, you can refer to the section named<em> Breaking on frame boundaries</em>, in<a class="link" href="ch03.html" title="Chapter 3. Debugging with OpenGL ES"> Chapter 3</a>,<em> Debugging with OpenGL ES</em>, for more information on how to go about capturing OpenGL ES frames.<a id="id300" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec06"/>Application data management</h2></div></div></div><p>iOS provides powerful connectivity options for sharing your information amongst the applications that are installed on an iOS device. Using a URL-based syntax, you can have your applications access data from the Web, as well as passing this information onto other applications that are installed, such as mail, iTunes, and YouTube.<a id="id301" class="indexterm"/>
</p><p>Your own applications can declare a unique URL scheme, allowing any application to collaborate and share data with your application.</p><p>You can also choose to make use of XML files; these provide a lightweight structured format that your application can easily read and write. XML files readily fit into the iOS file system, and can be used to store your application settings and user preferences in the built-in<strong> User Defaults</strong> database. This XML-based data store includes a simple API with powerful features, including the ability to serialize and restore complex objects on demand.<a id="id302" class="indexterm"/>
</p><div><h3 class="title"><a id="note34"/>Note</h3><p>For more information on the application data management feature, please refer to the following<em> Apple Developer Documentation</em> at the following location:<a class="ulink" href="http://DOCUMENTATION/DataManagement/Conceptual/iPhoneCoreData01/Articles/01_StartingOut.html#//apple_ref/doc/uid/TP40008305-CH105-SW2"> DOCUMENTATION/DataManagement/Conceptual/iPhoneCoreData01/Articles/01_StartingOut.html#//apple_ref/doc/uid/TP40008305-CH105-SW2</a>.</p></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec07"/>UI automation enhancements</h2></div></div></div><p>The<strong> Automation</strong> instrument was added to the release of the iOS SDK 4.0. This tool allows you to automate user interface tests of your iOS applications, by scripting touch events, allowing you to log these results to be used for your analysis, later on. The Automation instrument comes complete with a script editor, so that you can choose to either write your test scripts to the UI Automation API using JavaScript, or load this into the editor from a file.<a id="id303" class="indexterm"/>
</p><p>This is a huge leap forward for testing your applications on the iOS platform using test automation, which can reduce your time spent manually testing your applications. The Automation feature can be used to simulate many user actions on devices that support multitasking and, which are running iOS 4.0 or later.</p><p>You also have the ability to capture and record actions directly into your script as you perform them on an iOS device.<a id="id304" class="indexterm"/>
</p><p>Automating UI tests allows you to:<a id="id305" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Free critical staff and resources for other work</li><li class="listitem" style="list-style-type: disc">Perform more comprehensive testing</li><li class="listitem" style="list-style-type: disc">Develop repeatable regression tests</li><li class="listitem" style="list-style-type: disc">Minimize procedural errors</li><li class="listitem" style="list-style-type: disc">Improve development cycle times for product updates</li></ul></div><p>An important benefit of the Automation instrument is that you can use it with other instruments to perform sophisticated tests, such as tracking down memory leaks and isolating causes of performance problems.</p><div><h3 class="title"><a id="note35"/>Note</h3><p>The Automation instrument does not allow you to process any application that is not code-signed with your provisioning profile, and this will not run within the iOS simulator. It needs to be run on an iOS-compatible device running iOS 4 or later.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec07"/>Preparing your application</h3></div></div></div><p>Before we can start to use the Automation tool, we need to do a little groundwork to prepare our application, so that it can work with the automation tool. The UI automation library relies on the accessibility information within your UI, so we will be adding this piece of information later, which will make testing of your application a lot easier.<a id="id306" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec08"/>Creating a simple UIAutomation application</h3></div></div></div><p>Before we can proceed, we first need to create our<code class="literal"> UIAutomation</code> project. To refresh your memory, you can refer to the section named<em> Creating the MyEmailApp application</em> in<a class="link" href="ch01.html" title="Chapter 1. What's New in iOS5"> Chapter 1</a>,<em>What's New in iOS5.</em><a id="id307" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem"> Launch Xcode from the<code class="literal"> /Xcode4/Applications</code> folder.</li><li class="listitem"> Choose<strong> Create a new Xcode project</strong>, or<strong> File | New Project</strong>.</li><li class="listitem"> Select the<strong> Single View Application</strong> template from the list of available templates.</li><li class="listitem"> Select<strong> iPhone</strong> from under the<strong> Device Family</strong> drop-down.</li><li class="listitem"> Ensure that you have checked the box for<strong> Use Automatic Reference Counting</strong>, from under the<strong> Device Family</strong> drop-down.<a id="id308" class="indexterm"/><div><img src="img/2267_06_07.jpg" alt="Creating a simple UIAutomation application"/></div></li><li class="listitem"> Click on the<strong> Next</strong> button to proceed to the next step in the wizard.<a id="id309" class="indexterm"/></li><li class="listitem"> Enter in<code class="literal"> UIAutomation</code>, and then click on the<strong> Next</strong> button to proceed to the next step of the wizard.</li><li class="listitem"> Specify the location where you would like to save your project.</li><li class="listitem"> Click on the<strong> Save</strong> button to continue and display the Xcode workspace environment.</li></ol></div><p>Now that we have created our<code class="literal"> UIAutomation</code> project, we can start to build our user interface, and add the required code.</p><div><ol class="orderedlist"><li class="listitem"> From the<strong> Project Navigator</strong>, select and open the<code class="literal"> ViewController.xib</code> file.</li><li class="listitem"> From the<strong> Object Library</strong>, select and drag a (<code class="literal">UIButton</code>) round rect button control, and add this to our view.</li><li class="listitem"> Resize accordingly, then modify the<strong> Object Attributes</strong> section of the round rect button, and set its title to<code class="literal"> Tap Me</code>.</li><li class="listitem"> Next, from the<strong> Object Library</strong>, select and drag a (<code class="literal">UIButton</code>) round rect button control, and add this to our view underneath the<strong> Tap Me</strong> button.</li><li class="listitem"> Resize accordingly, then modify the<strong> Object Attributes</strong> section of the round rect button, and set its title to<code class="literal"> Press Me</code>.</li></ol></div><p>If you have followed these steps correctly, your view should look like something shown in the following screenshot. If it doesn't look quite the same as mine, feel free to adjust yours.<a id="id310" class="indexterm"/>
</p><div><img src="img/2267_06_08.jpg" alt="Creating a simple UIAutomation application"/></div><p>As you can see, our form doesn't do much at this stage, and if you were to run this application on the simulator, you would see the controls as placed out on your screen.<a id="id311" class="indexterm"/>
</p><p>The following steps will show you how to connect your buttons up to their action events, so that can each perform their task. So let's get started.<a id="id312" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem"> Open the<code class="literal"> ViewController.h</code> interface file, and create the following highlighted entries as shown in this code snippet:<div><pre class="programlisting">#import &lt;UIKit/UIKit.h&gt;
@interface ViewController : UIViewController<strong>
@property (strong, nonatomic) IBOutlet UIButton *btnTapMe;
@property (strong, nonatomic) IBOutlet UIButton *btnPressMe;</strong>
@end
</pre></div></li><li class="listitem"> Open the<strong> Assistant Editor</strong> window, by selecting the<strong> Open in Assistant Editor</strong> option from the<strong> Navigate</strong> menu, or alternatively, by holding down<strong> Option</strong> +<strong> Command</strong> +<strong/>, (Option key + Command key + Comma key).</li><li class="listitem"> We need to create an action event. Select the<strong> Tap Me</strong> button, and hold down the control key while you drag this into the<code class="literal"> ViewController.m</code> implementation file class, as shown in the following screenshot:<div><img src="img/2267_06_09.jpg" alt="Creating a simple UIAutomation application"/></div></li><li class="listitem"> Specify a name for the action that you want to create. Enter in<code class="literal"> btnTapMe</code> as the name of the action.</li><li class="listitem"> Set the type of event to be<strong> Touch Up Inside:</strong><div><img src="img/2267_06_10.jpg" alt="Creating a simple UIAutomation application"/></div></li><li class="listitem"> Click on the<strong> Connect</strong> button to have Xcode create the event.<a id="id313" class="indexterm"/></li><li class="listitem"> We need to create an action event. Select the<strong> Press Me</strong> button, and hold down the Control key while you drag this into the<code class="literal"> ViewController.m</code> implementation file class, as shown in the following screenshot:<div><img src="img/2267_06_11.jpg" alt="Creating a simple UIAutomation application"/></div></li><li class="listitem"> Specify a name for the action that you want to create. Enter in<code class="literal"> btnPressMe</code> as the name of the action.</li><li class="listitem"> Set the type of event to be<strong> Touch Up Inside:</strong><div><img src="img/2267_06_12.jpg" alt="Creating a simple UIAutomation application"/></div></li><li class="listitem"> Click on the<strong> Connect</strong> button to have Xcode create the event.</li></ol></div><p>Now that we have connected up our action events, we now need to synthesize our user-interface controls, so that we can access these within our view controller.</p><div><ol class="orderedlist"><li class="listitem"> Open the<code class="literal"> ViewController.m</code> implementation file that is located within the<code class="literal"> CIFilterEffects</code> folder, and add the following highlighted statement underneath the<code class="literal"> @implementation</code> statement.<a id="id314" class="indexterm"/><div><pre class="programlisting">//
// ViewController.m
// UIAutomation
//
// Created by Steven F Daniel on 19/09/11.
// Copyright (c) 2011 GenieSoft Studios. All rights reserved.
//
#import "ViewController.h"
@implementation ViewController<strong>
@synthesize btnTapMe, btnPressMe;</strong>
</pre></div></li><li class="listitem">In this code snippet, we are making our implementation file aware of the controls that are located on our user interface form. If these are not declared, we will receive warning messages, which could potentially cause your program to produce some weird results, or may even crash your application on the iOS device.</li><li class="listitem"> Next, we need to add the code into our<code class="literal"> btnTapMe</code> function that will be used to display an alert message pop-up when the button has been pressed. Enter in the following code snippet for this function:<div><pre class="programlisting">// Event to handle when the Tap Me button has been pressed.
- (IBAction)btnTapMe:(id)sender {
// Define our alert dialog popup
UIAlertView *alert = [[UIAlertView alloc]initWithTitle:@"UIAutomation Example" message:@"Tap Me button pressed" delegate:self cancelButtonTitle:@"OK" otherButtonTitles:nil];
// Display our alert
[alert show];
}
</pre></div></li><li class="listitem">This code snippet creates an instance of the <code class="literal">UIAlertView</code> class that will enable us to display an alert pop-up dialog box when the button has been pressed. You will notice that we have not released our alert object variable. This is mainly because ARC will be automatically managing the releasing of this object for us.</li><li class="listitem"> Next, we need to add the code into our<code class="literal"> btnPressMe</code> function that will be used to help determine when the automation instrument has pressed it. Enter in the following commented-out code snippet for this function:<div><pre class="programlisting">// Event to handle when the Press Me button has been pressed.
- (IBAction)btnPressMe:(id)sender {
// Define our alert dialog popup
// UIAlertView *alert = [[UIAlertView alloc]initWithTitle:@"UIAutomation Example" message:@"Press Me button pressed" delegate:self cancelButtonTitle:@"OK" otherButtonTitles:nil];
// Display our alert
//[alert show];
}
</pre></div></li><li class="listitem">This code snippet creates an instance of the <code class="literal">UIAlertView</code> class that will help us determine when this has been pressed by the UI automation instrument, when we come to perform our unit testing. This code has been purposely commented out, so that we fail an automation test case that we will be setting up later on.</li></ol></div><p>In the next section, we will look at how to set up our controls, so that they can be accessed and communicated by the Automation instrument. The UI Automation instrument library relies on accessibility information within your UI and looks for the<code class="literal"> AccessibilityLabel</code> property of your controls.<a id="id315" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem"> From the<code class="literal"> UIAutomation</code> example project navigator window, select the<code class="literal"> ViewController.xib</code> file from the<code class="literal"> UIAutomation</code> folder.</li><li class="listitem"> Click on the<strong> Tap Me</strong> button, and select the<strong> Identity Inspector</strong> button.<div><img src="img/2267_06_13.jpg" alt="Creating a simple UIAutomation application"/></div></li><li class="listitem"> Ensure that the<strong> Accessibility</strong> option has been checked and that the<strong> User Interaction Enabled</strong> option has also been checked. This makes it easy to access only those objects that have these properties set, to be accessed directly from within the view. This is mainly due to their properties being exposed, making accessing these from within the<code class="literal"> UIAutomation</code> test script easier.<a id="id316" class="indexterm"/></li><li class="listitem"> Repeat<em> steps 2</em> to<em> 3</em>, and apply the same to the<strong> Press Me</strong> button.</li></ol></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec08"/>Writing the UIAutomation test script</h2></div></div></div><p>The next step is to write the test script in JavaScript, using any editor of your choice. A<strong> Test Script</strong> is basically a set of ordered commands, each of which accesses a user interface element within your application to be used to perform some sort of user action on it, or to use the information associated within it.<a id="id317" class="indexterm"/>
</p><p>All of the user interface elements within your application are represented to the script through an ordered hierarchical view of objects that are defined by the<code class="literal"> UIAElements</code> class and its subclasses.</p><p>In order to reach a specified UI element, the script simply calls down the element hierarchy, starting from the top-level target object. The following code statement shows how to declare this in JavaScript:<a id="id318" class="indexterm"/>
</p><div><pre class="programlisting">var target = UIATarget.localTarget();
</pre></div><p>The<code class="literal"> UIATarget</code> object is your primary starting point for your application running on an iOS device or iOS simulator. This object provides a means for when you want to interact with and when you need to perform operations on the iOS device, such as user gestures which include as tapping, swiping, and shaking.<a id="id319" class="indexterm"/>
</p><p>The<code class="literal"> app</code> object is an instance of the<code class="literal"> UIAApplication</code> class that gives you access to the top-level structure of your application. This provides you with access to things such as tab bars, navigation bars, and the main window. The following code statement shows how to declare this in JavaScript:</p><div><pre class="programlisting">var app = target.frontMostApp();
</pre></div><p>Now that you have an understanding of the UI elements structures, we can start to construct our<code class="literal"> UIAutomation</code> test script. So, fire up your favorite editor, and let's begin.</p><div><ol class="orderedlist"><li class="listitem"> Create a new blank document and save this as<code class="literal"> UIAutomation.js</code>.</li><li class="listitem"> Next, we need to declare the objects to be used by our application. This is shown in the following code snippet:<div><pre class="programlisting">// Initialise our application objects.
var target = UIATarget.localTarget();
var app = target.frontMostApp();
var window = app.mainWindow();
var view = window.elements()[0];
var buttons = window.buttons();
</pre></div></li><li class="listitem">What we are doing in this code snippet is declaring a set of objects that we can use and make reference to within our code.</li><li class="listitem"> We have declared a target level object, which points to the top-level of our hierarchy, an<code class="literal"> app</code> application object, as well as window, view, and buttons objects, which can be accessed from the<code class="literal"> mainWindow</code> method.</li><li class="listitem"> Use of the<code class="literal"> var</code> keyword tells the compiler that you want to declare a new variable instance of the object in memory. This is similar to the<code class="literal"> Dim</code> (Dimension) keyword in Visual Basic.</li><li class="listitem"> Next, we want to add some initial header information to the results pane, to show which test case we are running this for, as shown within the following code snippet:<a id="id320" class="indexterm"/><div><pre class="programlisting">// UI Automation Test Case - Initial Logging
var testName = "UI Automation Test Case 1";
UIALogger.logStart(testName);
</pre></div></li><li class="listitem">In this code snippet, we declare a variable <code class="literal">testName</code> using the <code class="literal">var</code> keyword, and then assign the automation header information. This information will be displayed within the results pane. Next, we use the <code class="literal">UIALogger</code> class method <code class="literal">logStart</code>. This tells the compiler to initiate the specified test.</li><li class="listitem"> In our next step, we need to determine how many buttons we have on our screen. This is shown in the following code snippet:<a id="id321" class="indexterm"/><div><pre class="programlisting">// TC001: Check for the number of buttons on screen.
UIALogger.logMessage("Assert Text - Check number of button(s) on screen");
if (buttons.length != 2) {
UIALogger.logFail("FAIL: Invalid number of button(s)");
}
else {
UIALogger.logPass("PASS: Correct number of button(s)");
}
</pre></div></li><li class="listitem">In this code snippet, we use the <code class="literal">logMessage</code> method to log the message to the results window. We then use the buttons object to determine how many buttons are visible within our view, and then handle this using the <code class="literal">logFail</code> and <code class="literal">logPass</code> methods.<a id="id322" class="indexterm"/><p>The <code class="literal">logFail</code> method logs the message to the results pane, indicating that the test completed unsuccessfully. The <code class="literal">logPass</code> method logs the message to the results pane, indicating that the test completed successfully.
<a id="id323" class="indexterm"/>
</p></li><li class="listitem"> In the next step, there may be times when you want to check if a specific button has been pressed. This is shown in the following code snippet:<div><pre class="programlisting">// TC002: Check for the existence of the Press Me
// button within the view.
UIALogger.logMessage("Assert Text - Check for the existence of the Press Me button.");
// Get a handle to the button that we are after.
var btnPressMe = buttons.firstWithName("Press Me");
if (btnPressMe == null || btnPressMe.toString() == "[object UIAElementNil]") {
UIALogger.logFail("FAIL: Press Me button not found.");
}
else {
UIALogger.logPass("PASS: Press Me button was found.");
}
</pre></div></li><li class="listitem">In this code snippet, we use the <code class="literal">firstWithName</code> method of the <code class="literal">UIAElementArray</code> class to return the first element in the buttons array with the name of <code class="literal">Press Me</code>. We then compare and check if the button exists, by using the <code class="literal">null</code> and <code class="literal">UIAElementNil</code> objects, to prevent it from raising an exception error, before finally using the <code class="literal">logFail</code> and <code class="literal">logPass</code> methods of the <code class="literal">UIALogger</code> class to output the result of the test to the results pane.<a id="id324" class="indexterm"/></li><li class="listitem"> In the next step, there may be times when you want to simulate a tap for a particular button that is displayed on the screen, and have an alert pop-up displayed. This is shown in the following code snippet:<a id="id325" class="indexterm"/><div><pre class="programlisting">// TC003: Tap on the Press Me button and check for the alert.
UIALogger.logMessage("Assert Text - Checking for the Press Me Alert dialog.");
var btnPressMe = buttons.firstWithName("Press Me");
// Simulate a tap on the Press Me button
btnPressMe.tap();
var alert = app.alert();
if (alert == null || alert.toString() == "[object UIAElementNil]") {
UIALogger.logFail("FAIL: The alert dialog was not shown after pressing the button.");
}
else {
UIALogger.logPass("PASS: The alert dialog was shown after pressing the button.");
}
</pre></div></li><li class="listitem">In this code snippet, we use the <code class="literal">firstWithName</code> method of the <code class="literal">UIAElementArray</code> class to return the first element in the buttons array with the name of <code class="literal">Press Me</code>. We then use the <code class="literal">tap</code> method of the button to simulate a tap. When this happens, the associated code that is connected behind the button is executed, and an alert is displayed.<a id="id326" class="indexterm"/><p>We then declare an <code class="literal">alert</code> variable that takes on the alert <code class="literal">UIAAlert</code> object, returned by the <code class="literal">app</code> object representing the alert. Next, we compare and check if the alert exists by using the <code class="literal">null</code> and <code class="literal">UIAElementNil</code> objects to catch the error, preventing it from raising an <code class="literal">exception</code> error. Finally, we output the result returned to the results pane, using the <code class="literal">logFail</code> and <code class="literal">logPass</code> methods of the <code class="literal">UIALogger</code> class.
</p></li><li class="listitem"> In our final part, we want to display to the results pane that our test case has completed. This is shown in the following code snippet:<div><pre class="programlisting">// UI Automation Test Case 1 Completed
UIALogger.logMessage("UI Automation Test Case 1 Completed. Please check results panel for any errors.");
</pre></div></li><li class="listitem">In this code snippet, we use the <code class="literal">logMessage</code> method to log the message to the results window to show that the UI automation test case has completed, or a process can be used to click the button on the alert dialog box, after the delay has completed.</li></ol></div><p>The following table displays all methods pertaining to the<code class="literal"> UIALogger</code> class. It has been broken up into sections to highlight which ones are used for logging status, and which ones can be used to specify the type of severity.<a id="id327" class="indexterm"/>
</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p><strong>Logging with test status</strong></p>
</th><td class="auto-generated"> </td></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">logStart</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Logs a message, and indicates a test has started</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">logPass</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Logs a message, and indicates a test has completed successfully</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">logIssue</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Logs a message, and indicates a test has terminated abnormally</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">logFail</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Logs a message, and indicates a test has failed</p>
</td></tr><tr><td style="text-align: left" valign="bottom">
<p>Logging with severity levels</p>
</td><td class="auto-generated"> </td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">logDebug</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Logs the specified message, and sets the severity level to<code class="literal"> debug</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">logMessage</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Logs the specified message, and sets the severity level to<code class="literal"> message</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">logWarning</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Logs the specified message, and sets the severity level to<code class="literal"> warning</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">logError</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Logs the specified message, and sets the severity level to<code class="literal"> error</code>
</p>
</td></tr></tbody></table></div><div><h3 class="title"><a id="note36"/>Note</h3><p>For more information on the UI automation class reference and the JavaScript API, you can refer to<em> Apple Developer Documentation</em> at the following link:<a class="ulink" href="http://developer.apple.com/library/ios/#documentation/DeveloperTools/Reference/UIAuto/_index.html"> http://developer.apple.com/library/ios/#documentation/DeveloperTools/Reference/UIAuto/_index.html</a>.</p></div><p>Now that we have created our test script, we are ready to tackle the next part, where we start to profile our<code class="literal"> UIAutomation</code> example application. This is covered in the next section<em> Running your tests</em>.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec09"/>Running your tests</h2></div></div></div><p>Now that we have created our tests, our next step is to profile our<code class="literal"> UIAutomation</code> example application, within the Instruments application environment.<a id="id328" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem"> Launch Xcode from the<code class="literal"> /Xcode4/Applications</code> folder.</li><li class="listitem"> Open the<code class="literal"> UIAutomation</code> project, or<strong> File | Open</strong>.</li><li class="listitem"> Choose<strong> Profile</strong> from the<strong> Product | Profile</strong> menu, or<em> Command</em> +<em> I</em>.<div><img src="img/2267_06_14.jpg" alt="Running your tests"/></div></li><li class="listitem"> This will launch the<strong> Xcode Instruments</strong> application. Choose<strong> Automation</strong> from the iOS templates section, as shown in the following screenshot:<div><img src="img/2267_06_15.jpg" alt="Running your tests"/></div></li><li class="listitem"> Next, click on the<strong> Profile</strong> button to proceed to the next step.<a id="id329" class="indexterm"/></li><li class="listitem"> From the<strong> Instruments</strong> window, click on the<strong> Add</strong> button, and choose<strong> Import</strong> from the drop-down list, as shown in the following screenshot:<div><img src="img/2267_06_16.jpg" alt="Running your tests"/></div></li><li class="listitem"> Next, choose the<code class="literal"> UIAutomationTest.js</code> file from the list, and click on the<strong> Open</strong> button to load this file into the Instruments application.<a id="id330" class="indexterm"/><div><img src="img/2267_06_17.jpg" alt="Running your tests"/></div></li><li class="listitem"> Finally, click on the<strong> Record</strong> button, or<em> Command</em> +<em> R</em> to begin profiling the<code class="literal"> UIAutomation</code> example application. After a few moments, your application will launch and then your tests will run. This is shown in the following screenshot:<a id="id331" class="indexterm"/><div><img src="img/2267_06_18.jpg" alt="Running your tests"/></div></li><li class="listitem"> Once your test completes, the instruments application will continue to run your application. To formally end the test being executed, click on the red<strong> Stop</strong> button, or press<em> Command</em> +<em> R</em> again.<a id="id332" class="indexterm"/><p>Test results are listed in the details view section, along with the test name in the <strong>Log Messages</strong> column. If you test passes, the <strong>Log Type</strong> column value will be <strong>Pass</strong>, shown in green. If your test fails, the <strong>Log Type</strong> value will be <strong>Fail</strong>, shown in red.
</p><p>You can choose to expand the test results to see the details of what happened. The screenshot column is used whenever a test fails. In our case, no alert dialog box was displayed, and so, a screenshot was captured to show that it failed. This is shown in the following screenshot:
</p><div><img src="img/2267_06_19.jpg" alt="Running your tests"/></div></li><li class="listitem"> Go back to the<code class="literal"> UIAutomation</code> example project, and uncomment the<code class="literal"> alert</code> pop-up dialog code within the<code class="literal"> btnPressMe</code> event, as shown in the following code snippet:<a id="id333" class="indexterm"/><div><pre class="programlisting">// Event to handle when the Press Me button has been pressed. - (IBAction)btnPressMe:(id)sender {
<strong>// Define our alert dialog popup
UIAlertView *alert = [[UIAlertView alloc]initWithTitle:@"UIAutomation Example" message:@"Press Me button pressed" delegate:self cancelButtonTitle:@"OK" otherButtonTitles:nil];
// Display our alert
[alert show];
}</strong>
</pre></div></li><li class="listitem"> Now, compile and re-run the test again. We should now see that within the details view section and under the<strong> Log Messages</strong> column, all of our tests should now be showing with the value<strong> Pass</strong>, shown in green. This is shown in the following screenshot:</li></ol></div><div><img src="img/2267_06_20.jpg" alt="Running your tests"/></div><p>As you can see, by including the<code class="literal"> UIAutomation</code> instrument as part of your testing, you can halve your testing time and concentrate more on fixing up those annoying program bugs, prior to your application being released.<a id="id334" class="indexterm"/>
</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec02"/>Summary</h1></div></div></div><p>In this chapter, we learned about the improvements that have been made to the Xcode development tools. We gained an understanding of what the<strong> Automatic Reference Counting</strong> (<strong>ARC</strong>) is, and some of the coding differences that need to be applied.</p><p>We also looked at the improvements made to Interface Builder, the iOS location simulator, and the set of debugging tools for OpenGL ES. To end the chapter, we looked at how we can use the automation instrument to help perform unit testing on an application, using a test script written using JavaScript to the UI automation API.</p><p>In our final chapter, we will be taking a look into how to go about making your applications run smoothly, at the new features that come with Instruments, and how to use these to track improve your applications performance.</p></div></body></html>