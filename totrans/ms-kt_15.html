<html><head></head><body><div id="book-content"><div id="sbo-rt-content"><div id="_idContainer264">
			<h1 id="_idParaDest-178" class="chapter-number"><a id="_idTextAnchor215"/>15</h1>
			<h1 id="_idParaDest-179"><a id="_idTextAnchor216"/>Improving Your App</h1>
			<p>After we complete the development and publishing of our app, it is important to always be on the lookout when using things that help improve our apps, such as Firebase Messaging or Crashlytics. We are going to be learning how to use Firebase Messaging and Crashlytics in <span class="No-Break">this chapter.</span></p>
			<p>In this chapter, we will learn step-by-step techniques on how to improve our apps by adding analytics—Firebase Crashlytics—and how to use cloud messaging to increase user engagement. We will learn how to send notifications to our apps from the Firebase console. Additionally, we will learn some tips and tricks for securing our apps to ensure that user data is <span class="No-Break">not compromised.</span></p>
			<p>In this chapter, we’re going to cover the following <span class="No-Break">main topics:</span></p>
			<ul>
				<li>Using Firebase Crashlytics to <span class="No-Break">detect crashes</span></li>
				<li>Improving app engagement with <span class="No-Break">Firebase Messaging</span></li>
				<li>Securing <span class="No-Break">your app</span></li>
			</ul>
			<h1 id="_idParaDest-180"><a id="_idTextAnchor217"/>Technical requirements</h1>
			<p>To follow the instructions in this chapter, you will need to have Android Studio Hedgehog or a later version (<a href="https://developer.android.com/studio"><span class="No-Break">https://developer.android.com/studio</span></a><span class="No-Break">) </span><span class="No-Break">downloaded</span><span class="No-Break">.</span></p>
			<p>You can use the previous chapter’s code to follow the instructions in this chapter. You can find the code for this chapter on GitHub <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Mastering-Kotlin-for-Android/tree/main/chapterfifteen"><span class="No-Break">https://github.com/PacktPublishing/Mastering-Kotlin-for-Android/tree/main/chapterfifteen</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-181"><a id="_idTextAnchor218"/>Using Firebase Crashlytics to detect crashes</h1>
			<p>Crashes can happen in our <a id="_idIndexMarker766"/>apps for a variety of reasons, including common coding issues such as null pointer exceptions, memory leaks, and improper data handling. Device fragmentation caused by different device hardware configurations and different Android operation systems introduces compatibility issues that may at times cause crashes too. Network issues, insufficient resources, or mismanagement of external dependencies, such as third-party libraries, can cause crashes too. Sometimes, we can anticipate and handle them gracefully. Other times, they are unexpected and we need to know about them so we can fix them. Our app is already on Google Play Store, so at times, we might not have the luxury to debug on the devices that are having<a id="_idIndexMarker767"/> issues. Tools such as <strong class="bold">Firebase Crashlytics</strong> can help us detect crashes in our apps and provide us with the information we need to fix them. In this section, we will be setting up Firebase Crashlytics in our app and seeing how we can use it to <span class="No-Break">detect crashes.</span></p>
			<p>Android Studio has a built-in Firebase tool to help us quickly add Firebase to our app. We can access it from <strong class="bold">Tools</strong> | <strong class="bold">Firebase</strong>, which should open a side panel on the right, as shown in the <span class="No-Break">following figure:</span></p>
			<div>
				<div id="_idContainer244" class="IMG---Figure">
					<img src="image/B19779_15_01.jpg" alt="Figure 15.1 – Firebase setup" width="756" height="1072"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.1 – Firebase setup</p>
			<p>As seen in <span class="No-Break"><em class="italic">Figure 15</em></span><em class="italic">.1</em>, we can set up a variety of Firebase SDKs from this tool. We are interested in setting<a id="_idIndexMarker768"/> up <strong class="bold">Crashlytics</strong>. Tap on the <strong class="bold">Crashlytics</strong> option and we will see the <span class="No-Break">following options:</span></p>
			<div>
				<div id="_idContainer245" class="IMG---Figure">
					<img src="image/B19779_15_02.jpg" alt="Figure 15.2 – Firebase Crashlytics setup" width="537" height="113"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.2 – Firebase Crashlytics setup</p>
			<p>Since our project is written in Kotlin, we are going to select <strong class="bold">Get started with Firebase Crashlytics</strong> as an<a id="_idIndexMarker769"/> option. This will open a new window with the <span class="No-Break">following instructions:</span></p>
			<div>
				<div id="_idContainer246" class="IMG---Figure">
					<img src="image/B19779_15_03.jpg" alt="Figure 15.3 – Steps to set up Crashlytics" width="731" height="840"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.3 – Steps to set up Crashlytics</p>
			<p>As seen from <span class="No-Break"><em class="italic">Figure 15</em></span><em class="italic">.3</em>, it provides all the steps necessary for us to set up Firebase Crashlytics in our app. Let us tap the <strong class="bold">Connect to Firebase</strong> option. This opens a new tab in our browser with the Firebase console opened (see <span class="No-Break"><em class="italic">Figure 15</em></span><em class="italic">.4</em>). It shows all the Firebase projects that we have on our console (if we have any). Use the <strong class="bold">Create a project</strong> option and specify your preferred <span class="No-Break">project name:</span></p>
			<div>
				<div id="_idContainer247" class="IMG---Figure">
					<img src="image/B19779_15_04.jpg" alt="Figure 15.4 – New Firebase project" width="614" height="379"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.4 – New Firebase project</p>
			<p>Click <strong class="bold">Continue</strong> to proceed<a id="_idIndexMarker770"/> to the next step. This will take us to the <span class="No-Break">following screen:</span></p>
			<div>
				<div id="_idContainer248" class="IMG---Figure">
					<img src="image/B19779_15_05.jpg" alt="Figure 15.5 –Google Analytics setup" width="715" height="559"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.5 –Google Analytics setup</p>
			<p>In this screen, we configure Google Analytics for our app. It also shows the functionalities that<a id="_idIndexMarker771"/> Google Analytics provides for our app. Google Analytics collects usage and behavior data for our apps. We use it for tracking user events, system events, or errors, analyzing app performance, collecting user properties such as language preference and geographic location, and <span class="No-Break">so on.</span></p>
			<p>Click <strong class="bold">Continue</strong> to proceed to the <span class="No-Break">next step:</span></p>
			<div>
				<div id="_idContainer249" class="IMG---Figure">
					<img src="image/B19779_15_06.jpg" alt="Figure 15.6 – Configuring Google Analytics" width="714" height="693"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.6 – Configuring Google Analytics</p>
			<p>In this step, we configure more options for Google Analytics. We must select a Google Analytics account. Selecting<a id="_idIndexMarker772"/> the default account hides the other questions if you have already configured other projects. When done, click <strong class="bold">Create project</strong> to finalize creating the project and you will see the <span class="No-Break">following dialog:</span></p>
			<div>
				<div id="_idContainer250" class="IMG---Figure">
					<img src="image/B19779_15_07.jpg" alt="Figure 15.7 – Finalizing setup dialog" width="497" height="348"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.7 – Finalizing setup dialog</p>
			<p>Clicking <strong class="bold">Connect</strong> after our<a id="_idIndexMarker773"/> project is created finalizes the setup of Firebase Crashlytics with Android Studio. Let us head back to Android Studio and see what has changed. We can see that the Firebase Crashlytics option is <span class="No-Break">now checked:</span></p>
			<div>
				<div id="_idContainer251" class="IMG---Figure">
					<img src="image/B19779_15_08.jpg" alt="Figure 15.8 – App connected" width="729" height="381"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.8 – App connected</p>
			<p>The next step is to add the Firebase Crashlytics SDK to our app. We can do this by clicking the <strong class="bold">Add Crashlytics SDK and plugin to your app</strong> button. This will add the necessary dependencies to our app. You can check the Gradle files to see <span class="No-Break">these changes.</span></p>
			<p>With all the steps <a id="_idIndexMarker774"/>complete, we can now <strong class="bold">force-crash</strong> our app to see if the Firebase Crashlytics setup is working. We can do this by adding the following code to our <strong class="source-inline">MainActivity.kt</strong> file inside the <span class="No-Break"><strong class="source-inline">onCreate()</strong></span><span class="No-Break"> function:</span></p>
			<pre class="source-code">
throw RuntimeException("Test Crash")</pre>			<p>Now, run the app. The app will crash with the following <span class="No-Break">stack trace:</span></p>
			<div>
				<div id="_idContainer252" class="IMG---Figure">
					<img src="image/B19779_15_09.jpg" alt="Figure 15.9 – Crash stack trace" width="1407" height="465"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.9 – Crash stack trace</p>
			<p>We can head over to our newly created project in the Firebase console and see if the crash has been reported. In the <a id="_idIndexMarker775"/>Firebase console, Crashlytics is normally found under the <strong class="bold">Release and Monitor</strong> section on the navigation drawer, which is on the left side of the screen. It shows the <span class="No-Break">following screen:</span></p>
			<div>
				<div id="_idContainer253" class="IMG---Figure">
					<img src="image/B19779_15_10.jpg" alt="Figure 15.10 – Firebase console crash overview" width="1074" height="507"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.10 – Firebase console crash overview</p>
			<p>We can see that the crash has been reported. We can click on the <strong class="source-inline">MainActivity.onCreate</strong> crash to see more details about it. It shows the <span class="No-Break">following screen:</span></p>
			<div>
				<div id="_idContainer254" class="IMG---Figure">
					<img src="image/B19779_15_11.jpg" alt="Figure 15.11 – Firebase console crash details" width="1085" height="736"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.11 – Firebase console crash details</p>
			<p>As seen in <span class="No-Break"><em class="italic">Figure 15</em></span><em class="italic">.10</em>, we have the <a id="_idIndexMarker776"/>following details from the <span class="No-Break">Firebase console:</span></p>
			<ul>
				<li><strong class="bold">Stack trace</strong>: This shows the stack trace of <span class="No-Break">the crash.</span></li>
				<li><strong class="bold">Device</strong>: This shows the device that the crash happened on. We can see the device model, the OS version, and the <span class="No-Break">device state.</span></li>
				<li><strong class="bold">App version</strong>: This shows the version of the app that crashed. It also shows the total number of crashes that have happened for <span class="No-Break">that version.</span></li>
			</ul>
			<p>This information is very helpful when debugging crashes. Android Studio Hedgehog and more recent versions also have a useful tool, <strong class="bold">App Quality Insights</strong>, that helps us view the Firebase crashes right from Android Studio. We can access it from the bottom tool tabs, <span class="No-Break">as shown:</span></p>
			<div>
				<div id="_idContainer255" class="IMG---Figure">
					<img src="image/B19779_15_12.jpg" alt="Figure 15.12 – App Quality Insights" width="896" height="305"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.12 – App Quality Insights</p>
			<p>As seen in <span class="No-Break"><em class="italic">Figure 15</em></span><em class="italic">.11</em>, we need to log in to our Firebase account that has the project we are working on. We can<a id="_idIndexMarker777"/> do this by clicking on the <strong class="bold">Log in</strong> button and completing the login process on our browser. Once logged in, we can see the crashes that have happened in <span class="No-Break">our app:</span></p>
			<div>
				<div id="_idContainer256" class="IMG---Figure">
					<img src="image/B19779_15_13.jpg" alt="Figure 15.13 – App Quality Insights crash details" width="967" height="229"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.13 – App Quality Insights crash details</p>
			<p>This shows all the details, as we saw earlier in our Firebase console. We can see the stack trace too. The beauty of this is that we can easily navigate to the file and line causing the crash without having to switch context and go to <span class="No-Break">the browser.</span></p>
			<p>With Firebase Crashlytics set up, we can now detect crashes in our app and fix them. This will help us improve the quality of our app and make our <span class="No-Break">users happy.</span></p>
			<p class="callout-heading">Important note</p>
			<p class="callout">Remember to remove the code that we added to force a crash in <span class="No-Break">our app.</span></p>
			<p>Next, let us set up <strong class="bold">Firebase Analytics</strong>, which also<a id="_idIndexMarker778"/> gathers useful information about our app. This will help us understand how our users are using our app and help us make informed decisions on how to <span class="No-Break">improve it.</span></p>
			<h2 id="_idParaDest-182"><a id="_idTextAnchor219"/>Setting up Google Analytics</h2>
			<p>Setting up Google <a id="_idIndexMarker779"/>Analytics is like setting up Firebase Crashlytics. Repeat<a id="_idIndexMarker780"/> the following steps that you took for <span class="No-Break">Firebase Crashlytics:</span></p>
			<ol>
				<li>Open the Firebase tool from <strong class="bold">Tools</strong> | <span class="No-Break"><strong class="bold">Firebase</strong></span><span class="No-Break">.</span></li>
				<li>Select <strong class="bold">Analytics</strong> from the list of options that is similar to the list we saw in <span class="No-Break"><em class="italic">Figure 15</em></span><span class="No-Break"><em class="italic">.1</em></span><span class="No-Break">.</span></li>
				<li>Select the <strong class="bold">Get started with Google </strong><span class="No-Break"><strong class="bold">Analytics</strong></span><span class="No-Break"> option.</span></li>
				<li>Since our app is already connected to Firebase, we can skip the first step and proceed to the <span class="No-Break">next step.</span></li>
				<li>Tap the <strong class="bold">Add Analytics to your app</strong> button to add the necessary dependencies to <span class="No-Break">our app.</span></li>
				<li>Once Gradle sync is complete, we have finalized setting up Firebase Analytics in <span class="No-Break">our app.</span></li>
			</ol>
			<p>With that set, we can always view the analytics from the Firebase console. We can access it from the navigation drawer under the <strong class="bold">Analytics</strong> section. It shows the <span class="No-Break">following screen:</span></p>
			<div>
				<div id="_idContainer257" class="IMG---Figure">
					<img src="image/B19779_15_14.jpg" alt="Figure 15.14 – App analytics" width="1093" height="588"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.14 – App analytics</p>
			<p>We have learned how to set <a id="_idIndexMarker781"/>up Firebase Crashlytics and Firebase Analytics in our app. We can now detect crashes in our app and gather useful information about our app. This will help us<a id="_idIndexMarker782"/> improve the quality of our app and make our <span class="No-Break">users happy.</span></p>
			<p>In the next section, we will learn how to use Firebase Cloud Messaging to send notifications to <span class="No-Break">our app.</span></p>
			<h1 id="_idParaDest-183"><a id="_idTextAnchor220"/>Improving app engagement with Firebase Messaging</h1>
			<p>When users install our app, they <a id="_idIndexMarker783"/>might not use it again after they finish what they want to do. This can lead to a decline in the number of active users, which can have different impacts on <span class="No-Break">different apps.</span></p>
			<p>We can leverage <strong class="bold">Firebase Cloud Messaging</strong> to send notifications to our users to remind them of our app. This will help us improve our app’s engagement and increase the number of active users. In this section, we will be setting up Firebase Cloud Messaging in our app and see how we can use it to send notifications to our <span class="No-Break">app users.</span></p>
			<p>First, we need to set up the Firebase Cloud Messaging SDK on our app. This allows us to use the SDK within our project and enables our app to receive Firebase notifications once the setup is complete. We will do it the same way we did for Firebase Crashlytics and Firebase Analytics. Repeat<a id="_idIndexMarker784"/> the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Open the Firebase tool from <strong class="bold">Tools</strong> | <span class="No-Break"><strong class="bold">Firebase</strong></span><span class="No-Break">.</span></li>
				<li>Select <strong class="bold">Cloud Messaging</strong> from the list of options that is similar to the list we saw in <span class="No-Break"><em class="italic">Figure 15</em></span><span class="No-Break"><em class="italic">.1</em></span><span class="No-Break">.</span></li>
				<li>Select the <strong class="bold">Setup Firebase Cloud </strong><span class="No-Break"><strong class="bold">Messaging</strong></span><span class="No-Break"> option.</span></li>
				<li>Since our app is already connected to Firebase, we can skip the first step and proceed to the <span class="No-Break">next step.</span></li>
				<li>Tap the <strong class="bold">Add FCM to your app</strong> button to add the necessary dependencies to <span class="No-Break">the app.</span></li>
				<li>Once Gradle sync is complete, the FCM SDK is already set up in <span class="No-Break">our app.</span></li>
			</ol>
			<p>We need to create a new service to handle notifications when they are received and to also get the device token. Let us create a new package called <strong class="source-inline">firebase</strong>. Inside this package, let us create a new file called <strong class="source-inline">FirebaseMessagingService.kt</strong>. This will be our service that will handle notifications that <span class="No-Break">are received.</span></p>
			<p>Let us add the following code <span class="No-Break">to it:</span></p>
			<pre class="source-code">
class FirebaseNotificationService: FirebaseMessagingService() {
    override fun onNewToken(token: String) {
        super.onNewToken(token)
        Log.d("Firebase Token", token)
    }
    override fun onMessageReceived(remoteMessage: RemoteMessage) {
        super.onMessageReceived(remoteMessage)
        sendNotification(remoteMessage)
    }
    private fun sendNotification(remoteMessage: RemoteMessage) {
        val notification = NotificationCompat.Builder(applicationContext, "Pets Apps")
            .setContentTitle(remoteMessage.notification?.title)
            .setTicker(remoteMessage.notification?.ticker)
            .setContentText(remoteMessage.notification?.body)
            .setContentInfo(remoteMessage.notification?.body)
             .setStyle(NotificationCompat.BigTextStyle().bigText(remoteMessage.notification?.body))
            .setSmallIcon(R.drawable.ic_launcher_background)
        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {
            createChannel(notification, "Pets Apps")
        }
    }
    @RequiresApi(Build.VERSION_CODES.O)
    private fun createChannel(notificationBuilder: NotificationCompat.Builder, id: String) {
        notificationBuilder.setDefaults(Notification.DEFAULT_VIBRATE)
        val channel = NotificationChannel(
            id,
            "Pets Apps",
            NotificationManager.IMPORTANCE_HIGH
        )
        channel.description = "Pets Apps"
        val notificationManager: NotificationManager =
            getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
        notificationManager.createNotificationChannel(channel)
    }
}</pre>			<p>The following is a breakdown of the <span class="No-Break">preceding code:</span></p>
			<ul>
				<li>We have created a class called <strong class="source-inline">FirebaseNotificationService</strong> that extends <strong class="source-inline">FirebaseMessagingService</strong>. This is the service that will handle notifications that <span class="No-Break">are received.</span></li>
				<li>We have <a id="_idIndexMarker785"/>overridden the <strong class="source-inline">onNewToken()</strong> function. This function is called when a new token is generated. We can use this token to send notifications to our app. We have added a log message to log the token to our Logcat. Alternatively, we can send the token to our backend server to be used to send notifications to our app if we have such <span class="No-Break">a requirement.</span></li>
				<li>We have overridden the <strong class="source-inline">onMessageReceived()</strong> function. This function is called when a notification is received. We have called the <strong class="source-inline">sendNotification()</strong> function and passed the <strong class="source-inline">RemoteMessage</strong> object <span class="No-Break">to it.</span></li>
				<li>The <strong class="source-inline">sendNotification()</strong> function creates a notification and shows it to the user. We have used the <strong class="source-inline">NotificationCompat.Builder</strong> class to create the notification. We have also used the <strong class="source-inline">RemoteMessage</strong> object to get the notification <strong class="source-inline">title</strong>, <strong class="source-inline">body</strong>, and <strong class="source-inline">ticker</strong>. We have also set up a small icon to be used for the notification. We additionally set the notification channel if the device is running on Android Oreo or more <span class="No-Break">recent versions.</span></li>
				<li>Lastly, we have created the <strong class="source-inline">createChannel()</strong> function, which creates the notification <a id="_idIndexMarker786"/>channel using the <strong class="source-inline">NotificationChannel</strong> class. We have also set the channel description and the importance of the channel. Additionally, we have set the default vibration for the channel. Finally, we have created the notification manager and used it to create <span class="No-Break">the channel.</span></li>
			</ul>
			<p>With the service created, we need to register it in our <strong class="source-inline">AndroidManifest.xml</strong> file. Let us add the following code <span class="No-Break">to it:</span></p>
			<pre class="source-code">
&lt;service
    android:name=".firebase.FirebaseNotificationService"
    android:exported="false"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="com.google.firebase.MESSAGING_EVENT" /&gt;
    &lt;/intent-filter&gt;
&lt;/service&gt;</pre>			<p>With the service registered, we can now receive notifications in our app. Run the app with the <span class="No-Break">recent changes.</span></p>
			<p>Next, let us test this by sending a notification from the Firebase console. We can do this by going to our Firebase <a id="_idIndexMarker787"/>console and selecting the <strong class="bold">Cloud Messaging</strong> option from the navigation drawer, which is in the <strong class="bold">Engage</strong> category. It shows the <span class="No-Break">following screen:</span></p>
			<div>
				<div id="_idContainer258" class="IMG---Figure">
					<img src="image/B19779_15_15.jpg" alt="Figure 15.15 – Firebase Cloud Messaging landing page" width="935" height="351"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.15 – Firebase Cloud Messaging landing page</p>
			<p>This is our first time using Cloud Messaging, so we need to create a new campaign. Tap the <strong class="bold">Create your first campaign</strong> button. This opens a new dialog with the <span class="No-Break">following options:</span></p>
			<div>
				<div id="_idContainer259" class="IMG---Figure">
					<img src="image/B19779_15_16.jpg" alt="Figure 15.16 – Firebase Cloud Messaging options" width="562" height="512"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.16 – Firebase Cloud Messaging options</p>
			<p>We can send either <strong class="bold">Firebase Notification messages</strong> or <strong class="bold">Firebase In-App messages</strong>. Firebase notifications are designed to reach users outside of the app, delivering messages through <a id="_idIndexMarker788"/>push notifications even when our app is inactive. In contrast, Firebase in-app messages are tailored to engage users actively using our app by displaying content directly within the app’s interface. Firebase notifications are suitable for sending timely updates or promotions, while in-app messages are effective for delivering contextual content and enhancing the user experience within our app. We are interested in <strong class="bold">Firebase Notification messages</strong>. Select the <strong class="bold">Firebase Notification messages</strong> option and tap <strong class="bold">Create</strong>. This brings us to the <span class="No-Break">following screen:</span></p>
			<div>
				<div id="_idContainer260" class="IMG---Figure">
					<img src="image/B19779_15_17.jpg" alt="Figure 15.17 – Creating a new notification" width="895" height="728"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.17 – Creating a new notification</p>
			<p>In this screen, we add the<a id="_idIndexMarker789"/> title and text for our notification. Once you fill in these details, tap <strong class="bold">Next</strong> to proceed to the <span class="No-Break">next steps:</span></p>
			<div>
				<div id="_idContainer261" class="IMG---Figure">
					<img src="image/B19779_15_18.jpg" alt="Figure 15.18 – Target and Scheduling settings" width="900" height="511"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.18 – Target and Scheduling settings</p>
			<p>As seen in <span class="No-Break"><em class="italic">Figure 15</em></span><em class="italic">.17</em>, we set the target app for our notification. In this case, it is the app that we created earlier<a id="_idIndexMarker790"/> in the <em class="italic">Using Firebase Crashlytics to detect crashes</em> section of this chapter. We then set the schedule for our notification. We have set the scheduling setting to <strong class="bold">Send now</strong>. Tap the <strong class="bold">Review</strong> button, which shows a dialog with the information we <span class="No-Break">have set:</span></p>
			<div>
				<div id="_idContainer262" class="IMG---Figure">
					<img src="image/B19779_15_19.jpg" alt="Figure 15.19 – Review message dialog" width="630" height="305"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.19 – Review message dialog</p>
			<p>Tap the <strong class="bold">Publish</strong> button to publish the notification. This will send a notification to our app. We can now see the <a id="_idIndexMarker791"/>notification from <span class="No-Break">our app:</span></p>
			<div>
				<div id="_idContainer263" class="IMG---Figure">
					<img src="image/B19779_15_20.jpg" alt="Figure 15.20 – First notification" width="198" height="89"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.20 – First notification</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">Ensure that you always test using a real device to see <span class="No-Break">your notifications.</span></p>
			<p>We learned how to set up Firebase Cloud Messaging in our app and how to send notifications to it. In the next section, we will cover yet another critical topic—securing <span class="No-Break">our app.</span></p>
			<h1 id="_idParaDest-184"><a id="_idTextAnchor221"/>Securing your app</h1>
			<p>Ensuring your apps are secure is particularly important. We need to ensure that our users’ data is safe and secure. We also need to ensure that our app is not vulnerable to attacks. Attacks such as malware, man-in-the-middle attacks, and data interception pose risks to sensitive information, while vulnerabilities such as SQL injection and privilege escalation can lead to<a id="_idIndexMarker792"/> unauthorized access and manipulation of databases or app functionalities. Cross-site scripting and code injection present avenues for attackers to execute malicious scripts or commands within the app, potentially compromising user sessions and data. Insecure data storage practices may expose sensitive information, and denial-of-service attacks can disrupt <span class="No-Break">app services.</span></p>
			<p>In this section, we are going to see some tips and tricks for securing our app. The following are some of the things that we can do to secure <span class="No-Break">our app:</span></p>
			<ul>
				<li><strong class="bold">HTTPS</strong>: We should always use <strong class="source-inline">HTTPS</strong> for all our network requests, which adds an extra layer of security to <span class="No-Break">our app.</span></li>
				<li><strong class="bold">Code minification and obfuscation</strong>: We should always minify and obfuscate our code to make it harder for attackers to reverse engineer our app. We already did this in <a href="B19779_13.xhtml#_idTextAnchor175"><span class="No-Break"><em class="italic">Chapter 13</em></span></a> for our <span class="No-Break">release build.</span></li>
				<li><strong class="bold">Encryption</strong>: We should always encrypt sensitive data that we store in <span class="No-Break">our app.</span></li>
				<li><strong class="bold">Passwords and private keys</strong>: Never store passwords and private keys in Shared Preferences. We can always store them in other secure alternatives, such as the Android Keystore system used for storing <span class="No-Break">cryptographic keys.</span></li>
				<li><strong class="bold">Minimizing logged information</strong>: We should always minimize the information that we log. We should never log sensitive information such as passwords and <span class="No-Break">private keys.</span></li>
				<li><strong class="bold">Internal storage</strong>: We should always use internal storage for sensitive data. This is because internal storage is private to our app and other apps cannot <span class="No-Break">access it.</span></li>
				<li><strong class="bold">WebView</strong>: We use WebView to display web content in our app. This can introduce security issues on our app, so we should be careful when <span class="No-Break">using WebView.</span></li>
				<li><strong class="bold">Dependencies</strong>: We should always keep all our dependencies up to date. This is because new versions of dependencies might have security fixes that we need to apply to our app. We use tools such as Dependabot (<a href="https://github.com/dependabot">https://github.com/dependabot</a>) to automate <span class="No-Break">dependency updates.</span></li>
				<li><strong class="bold">Emulators or rooted devices</strong>: For payment or banking apps, ensure that they do not work on emulators or<a id="_idIndexMarker793"/> rooted devices. With emulators and rooted devices, it is easy to change your code or view the data that is being sent to the server or stored in our app. This can lead to <span class="No-Break">security issues.</span></li>
				<li><strong class="bold">Permissions</strong>: We should always use the necessary permissions in our app. We should not use permissions that we do not need. This is because permissions can be used to access sensitive data in <span class="No-Break">our app.</span></li>
			</ul>
			<p>As you develop your apps, always keep security in mind. This will help you ensure that your app is secure and that your users’ data is safe. You can learn more about Android security from the official Android documentation <span class="No-Break">at </span><a href="https://developer.android.com/privacy-and-security/security-tips"><span class="No-Break">https://developer.android.com/privacy-and-security/security-tips</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-185"><a id="_idTextAnchor222"/>Summary</h1>
			<p>In this chapter, we have learned techniques for improving our apps by adding analytics—in this case, Firebase Crashlytics—and how to use cloud messaging to increase user engagement in our apps. Additionally, we learned some tips and tricks for securing <span class="No-Break">our apps.</span></p>
			<p>We have come to the end of this chapter and book. We hope that you’ve enjoyed following along with the chapters and that you’re now in a position to develop Android apps with the knowledge gained from this book. What are the next steps? Here are some of the things that you <span class="No-Break">can do:</span></p>
			<ul>
				<li>Secure your app using the tips and tricks we went over in <span class="No-Break">this chapter.</span></li>
				<li>Inspect, improve, and monitor the performance of your app. You can learn more about this from the official documentation <span class="No-Break">at </span><a href="https://developer.android.com/topic/performance/overview"><span class="No-Break">https://developer.android.com/topic/performance/overview</span></a><span class="No-Break">.</span></li>
				<li>Learn more about <strong class="bold">Modern Android Development</strong> (<strong class="bold">MAD</strong>). MAD is a set of tools and libraries that help us develop Android apps faster and better. You can learn more about M.A.D from the official documentation <span class="No-Break">at </span><a href="https://developer.android.com/modern-android-development"><span class="No-Break">https://developer.android.com/modern-android-development</span></a><span class="No-Break">.</span></li>
				<li>Learn more about Google Play Vitals and how you can use the information at <a href="https://play.google.com/console/about/vitals/">https://play.google.com/console/about/vitals/</a> to improve the quality of <span class="No-Break">your app.</span></li>
				<li>Keep learning about Kotlin and Android. Build more apps and share them with the world. You can also contribute to open <span class="No-Break">source projects.</span></li>
			</ul>
		</div>
	</div></div></body></html>