<html><head></head><body>
<div id="_idContainer165" class="calibre2">
<h1 class="chapter-number" id="_idParaDest-118"><a id="_idTextAnchor135" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.1.1">11</span></h1>
<h1 id="_idParaDest-119" class="calibre6"><a id="_idTextAnchor136" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.2.1">Enhancing Code Quality</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.3.1">As we develop our Android apps, we must ensure that the code we write complies with the set rules and follows the best practices. </span><span class="kobospan" id="kobo.3.2">This not only helps us to write good code but also makes it easier to maintain and easily onboard others to the </span><span><span class="kobospan" id="kobo.4.1">code base.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.5.1">In this chapter, we will learn about the Kotlin style and the best practices for writing Kotlin code. </span><span class="kobospan" id="kobo.5.2">We will also learn how to use plugins such as Ktlint and Detekt to format, lint, and detect the code </span><span><span class="kobospan" id="kobo.6.1">smells early.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.7.1">In this chapter, we’re going to cover the following </span><span><span class="kobospan" id="kobo.8.1">main topics:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.9.1">Mastering Kotlin style and </span><span><span class="kobospan" id="kobo.10.1">best practices</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.11.1">Using Ktlint for </span><span><span class="kobospan" id="kobo.12.1">static analysis</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.13.1">Detecting code smells </span><span><span class="kobospan" id="kobo.14.1">with Detekt</span></span></li>
</ul>
<h1 id="_idParaDest-120" class="calibre6"><a id="_idTextAnchor137" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.15.1">Technical requirements</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.16.1">To follow the instructions in this chapter, you will need to have Android Studio Hedgehog or later (</span><a href="https://developer.android.com/studio" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.17.1">https://developer.android.com/studio</span></span></a><span><span class="kobospan" id="kobo.18.1">) downloaded.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.19.1">You can use the previous chapter’s code to follow the instructions in this chapter. </span><span class="kobospan" id="kobo.19.2">You can find the code for this chapter </span><span><span class="kobospan" id="kobo.20.1">at </span></span><a href="https://github.com/PacktPublishing/Mastering-Kotlin-for-Android/tree/main/chaptereleven" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.21.1">https://github.com/PacktPublishing/Mastering-Kotlin-for-Android/tree/main/chaptereleven</span></span></a></p>
<h1 id="_idParaDest-121" class="calibre6"><a id="_idTextAnchor138" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.22.1">Mastering Kotlin style and best practices</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.23.1">As we learned in </span><a href="B19779_01.xhtml#_idTextAnchor015" class="calibre3 pcalibre pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.24.1">Chapter 1</span></em></span></a><span class="kobospan" id="kobo.25.1">, Kotlin is a very concise and static language. </span><span class="kobospan" id="kobo.25.2">As such, it is easier for us as developers to not follow some of the recommended practices. </span><span class="kobospan" id="kobo.25.3">This leads to a lot of code smells and </span><a id="_idIndexMarker544" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.26.1">technical debt. </span><span class="kobospan" id="kobo.26.2">A </span><strong class="bold"><span class="kobospan" id="kobo.27.1">code smell</span></strong><span class="kobospan" id="kobo.28.1"> is a pattern or practice that might indicate a deeper </span><a id="_idIndexMarker545" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.29.1">problem within the code. </span><span class="kobospan" id="kobo.29.2">It indicates that the code might lead to potential problems or hinder maintainability. </span><span class="kobospan" id="kobo.29.3">On the other hand, </span><strong class="bold"><span class="kobospan" id="kobo.30.1">technical debt</span></strong><span class="kobospan" id="kobo.31.1"> refers to the cost or consequences of choosing quick and suboptimal </span><a id="_idIndexMarker546" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.32.1">solutions in development to meet immediate needs rather than developing robust and maintainable solutions. </span><span class="kobospan" id="kobo.32.2">We always have to come back later to such solutions to refactor them to be more scalable and maintainable. </span><span class="kobospan" id="kobo.32.3">Let us start by learning about some of the best practices and how to </span><span><span class="kobospan" id="kobo.33.1">avoid them.</span></span></p>
<h2 id="_idParaDest-122" class="calibre7"><a id="_idTextAnchor139" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.34.1">Coding conventions</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.35.1">Kotlin has a wide variety</span><a id="_idIndexMarker547" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.36.1"> of coding conventions that cover everything from naming conventions to formatting. </span><span class="kobospan" id="kobo.36.2">Following these conventions makes it easier to read our code and makes it maintainable. </span><span class="kobospan" id="kobo.36.3">Examples of these are </span><span><span class="kobospan" id="kobo.37.1">the following:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.38.1">Variable names should be </span><span><span class="kobospan" id="kobo.39.1">in </span></span><span><strong class="bold"><span class="kobospan" id="kobo.40.1">camelCase</span></strong></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.41.1">Class names should be </span><span><span class="kobospan" id="kobo.42.1">in </span></span><span><strong class="bold"><span class="kobospan" id="kobo.43.1">PascalCase</span></strong></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.44.1">Constants should be </span><span><span class="kobospan" id="kobo.45.1">in </span></span><span><strong class="bold"><span class="kobospan" id="kobo.46.1">UPPERCASE</span></strong></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.47.1">Functions should be </span><span><span class="kobospan" id="kobo.48.1">in </span></span><span><strong class="bold"><span class="kobospan" id="kobo.49.1">camelCase</span></strong></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.50.1">Functions with multiple words should be separated </span><span><span class="kobospan" id="kobo.51.1">by </span></span><span><strong class="bold"><span class="kobospan" id="kobo.52.1">underscores</span></strong></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.53.1">Functions with a single expression should </span><span><span class="kobospan" id="kobo.54.1">be </span></span><span><strong class="bold"><span class="kobospan" id="kobo.55.1">inlined</span></strong></span></li>
</ul>
<p class="calibre4"><span class="kobospan" id="kobo.56.1">Kotlin offers a lot of coding conventions. </span><span class="kobospan" id="kobo.56.2">You can find them </span><span><span class="kobospan" id="kobo.57.1">at </span></span><a href="https://kotlinlang.org/docs/coding-conventions.html" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.58.1">https://kotlinlang.org/docs/coding-conventions.html</span></span></a><span><span class="kobospan" id="kobo.59.1">.</span></span></p>
<h2 id="_idParaDest-123" class="calibre7"><a id="_idTextAnchor140" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.60.1">Null safety</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.61.1">As discussed</span><a id="_idIndexMarker548" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.62.1"> extensively in </span><a href="B19779_01.xhtml#_idTextAnchor015" class="calibre3 pcalibre pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.63.1">Chapter 1</span></em></span></a><span class="kobospan" id="kobo.64.1">, Kotlin has a very strong </span><strong class="bold"><span class="kobospan" id="kobo.65.1">null safety</span></strong><span class="kobospan" id="kobo.66.1"> system. </span><span class="kobospan" id="kobo.66.2">This is one of the most important features of Kotlin. </span><span class="kobospan" id="kobo.66.3">It is important that we use this feature to its fullest extent. </span><span class="kobospan" id="kobo.66.4">This will help us avoid a lot of null pointer exceptions. </span><span class="kobospan" id="kobo.66.5">We have to use nullable types when variables can be </span><strong class="source-inline"><span class="kobospan" id="kobo.67.1">null</span></strong><span class="kobospan" id="kobo.68.1">. </span><span class="kobospan" id="kobo.68.2">When working with nullable types, it is recommended that we use the safe call operator (</span><strong class="source-inline"><span class="kobospan" id="kobo.69.1">?.</span></strong><span class="kobospan" id="kobo.70.1">) and the Elvis operator (</span><strong class="source-inline"><span class="kobospan" id="kobo.71.1">?:</span></strong><span class="kobospan" id="kobo.72.1">) to avoid null pointer exceptions. </span><span class="kobospan" id="kobo.72.2">We should also use the </span><strong class="source-inline"><span class="kobospan" id="kobo.73.1">let</span></strong><span class="kobospan" id="kobo.74.1"> function to perform operations on nullable types. </span><span class="kobospan" id="kobo.74.2">We should also use the safe cast operator (</span><strong class="source-inline"><span class="kobospan" id="kobo.75.1">as?</span></strong><span class="kobospan" id="kobo.76.1">) to avoid class cast exceptions. </span><span class="kobospan" id="kobo.76.2">An example is shown in the </span><span><span class="kobospan" id="kobo.77.1">following snippet:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.78.1">
val name: String? </span><span class="kobospan1" id="kobo.78.2">= null
name?.let {
  println(it)
}</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.79.1">In the preceding </span><a id="_idIndexMarker549" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.80.1">example, we declared a </span><strong class="source-inline"><span class="kobospan" id="kobo.81.1">name</span></strong><span class="kobospan" id="kobo.82.1"> variable of the </span><strong class="source-inline"><span class="kobospan" id="kobo.83.1">String</span></strong><span class="kobospan" id="kobo.84.1"> type and assigned it </span><strong class="source-inline"><span class="kobospan" id="kobo.85.1">null</span></strong><span class="kobospan" id="kobo.86.1">. </span><span class="kobospan" id="kobo.86.2">Then, we used the </span><strong class="source-inline"><span class="kobospan" id="kobo.87.1">let</span></strong><span class="kobospan" id="kobo.88.1"> function to check whether the variable is </span><strong class="source-inline"><span class="kobospan" id="kobo.89.1">null</span></strong><span class="kobospan" id="kobo.90.1"> or not. </span><span class="kobospan" id="kobo.90.2">If the variable is not </span><strong class="source-inline"><span class="kobospan" id="kobo.91.1">null</span></strong><span class="kobospan" id="kobo.92.1">, then the </span><strong class="source-inline"><span class="kobospan" id="kobo.93.1">println(it)</span></strong><span class="kobospan" id="kobo.94.1"> function will print the value of </span><span><span class="kobospan" id="kobo.95.1">the variable.</span></span></p>
<h2 id="_idParaDest-124" class="calibre7"><a id="_idTextAnchor141" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.96.1">Data classes</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.97.1">Kotlin makes it </span><a id="_idIndexMarker550" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.98.1">easy for us to create </span><strong class="bold"><span class="kobospan" id="kobo.99.1">data classes</span></strong><span class="kobospan" id="kobo.100.1">. </span><span class="kobospan" id="kobo.100.2">Data classes are classes that are used to hold data. </span><span class="kobospan" id="kobo.100.3">The classes also automatically generate the </span><strong class="source-inline"><span class="kobospan" id="kobo.101.1">equals</span></strong><span class="kobospan" id="kobo.102.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.103.1">hashCode</span></strong><span class="kobospan" id="kobo.104.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.105.1">toString</span></strong><span class="kobospan" id="kobo.106.1">, and </span><strong class="source-inline"><span class="kobospan" id="kobo.107.1">copy</span></strong><span class="kobospan" id="kobo.108.1"> functions. </span><span class="kobospan" id="kobo.108.2">We should use data classes when we need to </span><span><span class="kobospan" id="kobo.109.1">hold data:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.110.1">
data class Person(val name: String, val age: Int)</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.111.1">In the preceding example, we created a </span><strong class="source-inline"><span class="kobospan" id="kobo.112.1">Person</span></strong><span class="kobospan" id="kobo.113.1"> data class with two properties: </span><strong class="source-inline"><span class="kobospan" id="kobo.114.1">name</span></strong><span class="kobospan" id="kobo.115.1"> (which is a </span><strong class="source-inline"><span class="kobospan" id="kobo.116.1">String</span></strong><span class="kobospan" id="kobo.117.1"> type) and </span><strong class="source-inline"><span class="kobospan" id="kobo.118.1">age</span></strong><span class="kobospan" id="kobo.119.1"> (which is an </span><span><strong class="source-inline"><span class="kobospan" id="kobo.120.1">Int</span></strong></span><span><span class="kobospan" id="kobo.121.1"> type).</span></span></p>
<h2 id="_idParaDest-125" class="calibre7"><a id="_idTextAnchor142" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.122.1">Extensions functions</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.123.1">Kotlin provides </span><strong class="bold"><span class="kobospan" id="kobo.124.1">extension functions</span></strong><span class="kobospan" id="kobo.125.1">, which allow us to add new functions to new classes without having to</span><a id="_idIndexMarker551" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.126.1"> inherit from them. </span><span class="kobospan" id="kobo.126.2">This will help us avoid creating utility classes. </span><span class="kobospan" id="kobo.126.3">While extension functions are powerful, overuse or inappropriate use can lead to code that is hard to read and maintain. </span><span class="kobospan" id="kobo.126.4">An example is shown in the following </span><span><span class="kobospan" id="kobo.127.1">code block:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.128.1">
fun String.removeFirstAndLastChar(): String {
  return when {
  this.length &lt;= 1 -&gt; ""
  else -&gt; this.substring(1, this.length - 1)
  }
}
// Example usage
fun main(args: Array&lt;String&gt;) {
  val myString = "Hello Everyone"
  val result = myString.removeFirstAndLastChar ()
  println(result)
}</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.129.1">In the preceding example, we created an extension function on the </span><strong class="source-inline"><span class="kobospan" id="kobo.130.1">String</span></strong><span class="kobospan" id="kobo.131.1"> class. </span><span class="kobospan" id="kobo.131.2">The function removes the first and last character of the string and returns the remaining string. </span><span class="kobospan" id="kobo.131.3">Additionally, we used the </span><strong class="source-inline"><span class="kobospan" id="kobo.132.1">when</span></strong><span class="kobospan" id="kobo.133.1"> expression to check whether the length of the string is less than or equal to </span><strong class="source-inline"><span class="kobospan" id="kobo.134.1">1</span></strong><span class="kobospan" id="kobo.135.1">. </span><span class="kobospan" id="kobo.135.2">If the length is less than or equal to </span><strong class="source-inline"><span class="kobospan" id="kobo.136.1">1</span></strong><span class="kobospan" id="kobo.137.1">, then the function returns an empty</span><a id="_idIndexMarker552" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.138.1"> string. </span><span class="kobospan" id="kobo.138.2">Otherwise, it returns the substring of the string from index 1 to the length of the string – </span><strong class="source-inline"><span class="kobospan" id="kobo.139.1">1</span></strong><span class="kobospan" id="kobo.140.1">. </span><span class="kobospan" id="kobo.140.2">We used the extension function in the </span><strong class="source-inline"><span class="kobospan" id="kobo.141.1">main</span></strong><span class="kobospan" id="kobo.142.1"> function to remove the first and last character of the </span><strong class="source-inline"><span class="kobospan" id="kobo.143.1">"Hello Everyone"</span></strong><span class="kobospan" id="kobo.144.1"> string. </span><span class="kobospan" id="kobo.144.2">The result is then printed to the console </span><span><span class="kobospan" id="kobo.145.1">as follows:</span></span></p>
<pre class="console"><span class="kobospan1" id="kobo.146.1">
ello Everyon</span></pre> <h2 id="_idParaDest-126" class="calibre7"><a id="_idTextAnchor143" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.147.1">Type inference</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.148.1">Kotlin has a very strong type system. </span><span class="kobospan" id="kobo.148.2">As such, we can omit specifying the type of a variable and let the </span><a id="_idIndexMarker553" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.149.1">compiler infer the type. </span><span class="kobospan" id="kobo.149.2">This will help us avoid a lot of boilerplate code. </span><span class="kobospan" id="kobo.149.3">Here is </span><span><span class="kobospan" id="kobo.150.1">an example:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.151.1">
val name = "John Doe" // Compiler infers that name is of type String
val age = 25 // Compiler infers that age is of type Int</span></pre> <h2 id="_idParaDest-127" class="calibre7"><a id="_idTextAnchor144" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.152.1">Collections</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.153.1">Kotlin has a rich </span><strong class="bold"><span class="kobospan" id="kobo.154.1">collections</span></strong><span class="kobospan" id="kobo.155.1"> library. </span><span class="kobospan" id="kobo.155.2">We use collections to store and manipulate groups of data. </span><span class="kobospan" id="kobo.155.3">We have </span><strong class="source-inline"><span class="kobospan" id="kobo.156.1">List</span></strong><span class="kobospan" id="kobo.157.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.158.1">Set</span></strong><span class="kobospan" id="kobo.159.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.160.1">Map</span></strong><span class="kobospan" id="kobo.161.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.162.1">Array</span></strong><span class="kobospan" id="kobo.163.1">, and </span><strong class="source-inline"><span class="kobospan" id="kobo.164.1">Sequence</span></strong><span class="kobospan" id="kobo.165.1"> as collection types available in Kotlin. </span><span class="kobospan" id="kobo.165.2">Collections </span><a id="_idIndexMarker554" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.166.1">can either be </span><strong class="source-inline"><span class="kobospan" id="kobo.167.1">mutable</span></strong><span class="kobospan" id="kobo.168.1"> or </span><strong class="source-inline"><span class="kobospan" id="kobo.169.1">immutable</span></strong><span class="kobospan" id="kobo.170.1">. </span><span class="kobospan" id="kobo.170.2">A </span><strong class="source-inline"><span class="kobospan" id="kobo.171.1">mutable</span></strong><span class="kobospan" id="kobo.172.1"> collection can be modified after creation, while an </span><strong class="source-inline"><span class="kobospan" id="kobo.173.1">immutable</span></strong><span class="kobospan" id="kobo.174.1"> collection cannot be modified after creation. </span><span class="kobospan" id="kobo.174.2">An example of a </span><strong class="source-inline"><span class="kobospan" id="kobo.175.1">mutable</span></strong><span class="kobospan" id="kobo.176.1"> list is </span><span><span class="kobospan" id="kobo.177.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.178.1">
val mutableList = mutableListOf("Kotlin", "Java", "Python")
mutableList.add("Swift")</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.179.1">In the preceding example, we created a </span><strong class="source-inline"><span class="kobospan" id="kobo.180.1">mutable</span></strong><span class="kobospan" id="kobo.181.1"> list of strings. </span><span class="kobospan" id="kobo.181.2">We used the </span><strong class="source-inline"><span class="kobospan" id="kobo.182.1">mutableListOf</span></strong><span class="kobospan" id="kobo.183.1"> function to create the list. </span><span class="kobospan" id="kobo.183.2">We then added a new string to the list using the </span><strong class="source-inline"><span class="kobospan" id="kobo.184.1">add</span></strong><span class="kobospan" id="kobo.185.1"> function. </span><span class="kobospan" id="kobo.185.2">An example of an </span><strong class="source-inline"><span class="kobospan" id="kobo.186.1">immutable</span></strong><span class="kobospan" id="kobo.187.1"> list is </span><span><span class="kobospan" id="kobo.188.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.189.1">
val immutableList = listOf("Kotlin", "Java", "Python")</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.190.1">In the preceding example, we created an </span><strong class="source-inline"><span class="kobospan" id="kobo.191.1">immutable</span></strong><span class="kobospan" id="kobo.192.1"> list of strings. </span><span class="kobospan" id="kobo.192.2">We used the </span><strong class="source-inline"><span class="kobospan" id="kobo.193.1">listOf</span></strong><span class="kobospan" id="kobo.194.1"> function to create the list. </span><span class="kobospan" id="kobo.194.2">We cannot add or remove items from the list after creation. </span><span class="kobospan" id="kobo.194.3">We can only read items from the list. </span><span class="kobospan" id="kobo.194.4">Kotlin collections also have a wide variety of functions that can be used to perform operations on collections. </span><span class="kobospan" id="kobo.194.5">We should use these functions instead of writing our own functions. </span><span class="kobospan" id="kobo.194.6">This helps us make our code concise and readable. </span><span class="kobospan" id="kobo.194.7">Let us see the following example of creating a list and filtering odd and </span><span><span class="kobospan" id="kobo.195.1">even numbers:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.196.1">
val numbers = listOf(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
val evenNumbers = numbers.filter { it % 2 == 0 }
val oddNumbers = numbers.filter { it % 2 != 0 }</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.197.1">In the preceding example, we created a list of numbers. </span><span class="kobospan" id="kobo.197.2">We then used the </span><strong class="source-inline"><span class="kobospan" id="kobo.198.1">filter</span></strong><span class="kobospan" id="kobo.199.1"> function to filter even and odd numbers. </span><span class="kobospan" id="kobo.199.2">The </span><strong class="source-inline"><span class="kobospan" id="kobo.200.1">filter</span></strong><span class="kobospan" id="kobo.201.1"> function takes a lambda as an argument. </span><span class="kobospan" id="kobo.201.2">The lambda is used to filter the numbers. </span><span class="kobospan" id="kobo.201.3">The </span><strong class="source-inline"><span class="kobospan" id="kobo.202.1">filter</span></strong><span class="kobospan" id="kobo.203.1"> function returns a new list with the filtered numbers. </span><span class="kobospan" id="kobo.203.2">We used the </span><strong class="source-inline"><span class="kobospan" id="kobo.204.1">it</span></strong><span class="kobospan" id="kobo.205.1"> keyword to refer to the current item in the list. </span><span class="kobospan" id="kobo.205.2">We then used the </span><strong class="source-inline"><span class="kobospan" id="kobo.206.1">%</span></strong><span class="kobospan" id="kobo.207.1"> operator to check whether the number is even or odd. </span><span class="kobospan" id="kobo.207.2">If the number is even, then the </span><strong class="source-inline"><span class="kobospan" id="kobo.208.1">filter</span></strong><span class="kobospan" id="kobo.209.1"> function returns </span><strong class="source-inline"><span class="kobospan" id="kobo.210.1">true</span></strong><span class="kobospan" id="kobo.211.1"> and the number is added to the </span><strong class="source-inline"><span class="kobospan" id="kobo.212.1">evenNumbers</span></strong><span class="kobospan" id="kobo.213.1"> variable. </span><span class="kobospan" id="kobo.213.2">For odd numbers, the </span><strong class="source-inline"><span class="kobospan" id="kobo.214.1">filter</span></strong><span class="kobospan" id="kobo.215.1"> function returns </span><strong class="source-inline"><span class="kobospan" id="kobo.216.1">false</span></strong><span class="kobospan" id="kobo.217.1"> and the number is added to the </span><strong class="source-inline"><span class="kobospan" id="kobo.218.1">oddNumbers</span></strong><span class="kobospan" id="kobo.219.1"> variable. </span><span class="kobospan" id="kobo.219.2">Kotlin collections also have functions such as </span><strong class="source-inline"><span class="kobospan" id="kobo.220.1">map</span></strong><span class="kobospan" id="kobo.221.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.222.1">reduce</span></strong><span class="kobospan" id="kobo.223.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.224.1">fold</span></strong><span class="kobospan" id="kobo.225.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.226.1">flatMap</span></strong><span class="kobospan" id="kobo.227.1">, and so on. </span><span class="kobospan" id="kobo.227.2">We should use these functions instead of</span><a id="_idIndexMarker555" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.228.1"> writing our own functions. </span><span class="kobospan" id="kobo.228.2">This helps us make our code concise </span><span><span class="kobospan" id="kobo.229.1">and readable.</span></span></p>
<h2 id="_idParaDest-128" class="calibre7"><a id="_idTextAnchor145" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.230.1">Sealed classes and interfaces</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.231.1">Kotlin provides </span><strong class="bold"><span class="kobospan" id="kobo.232.1">sealed classes</span></strong><span class="kobospan" id="kobo.233.1">, which are used to represent restricted class and interface hierarchies. </span><span class="kobospan" id="kobo.233.2">This improves code </span><a id="_idIndexMarker556" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.234.1">readability and ensures that we know all the possible subclasses of a class. </span><span class="kobospan" id="kobo.234.2">Here’s an example of a </span><span><span class="kobospan" id="kobo.235.1">sealed class:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.236.1">
sealed class Shape {
  class Circle(val radius: Double) : Shape()
  class Square(val length: Double) : Shape()
  class Rectangle(val length: Double, val breadth: Double) : Shape()
}</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.237.1">In the preceding example, we created a sealed class called </span><strong class="source-inline"><span class="kobospan" id="kobo.238.1">Shape</span></strong><span class="kobospan" id="kobo.239.1">. </span><span class="kobospan" id="kobo.239.2">We then created three classes (</span><strong class="source-inline"><span class="kobospan" id="kobo.240.1">Circle</span></strong><span class="kobospan" id="kobo.241.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.242.1">Square</span></strong><span class="kobospan" id="kobo.243.1">, and </span><strong class="source-inline"><span class="kobospan" id="kobo.244.1">Rectangle</span></strong><span class="kobospan" id="kobo.245.1">), which are subclasses of the </span><strong class="source-inline"><span class="kobospan" id="kobo.246.1">Shape</span></strong><span class="kobospan" id="kobo.247.1"> class. </span><span class="kobospan" id="kobo.247.2">The </span><strong class="source-inline"><span class="kobospan" id="kobo.248.1">Shape</span></strong><span class="kobospan" id="kobo.249.1"> class can only be extended in the same file where it is declared. </span><span class="kobospan" id="kobo.249.2">We cannot extend the </span><strong class="source-inline"><span class="kobospan" id="kobo.250.1">Shape</span></strong><span class="kobospan" id="kobo.251.1"> class in </span><span><span class="kobospan" id="kobo.252.1">another file</span><a id="_idTextAnchor146" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.253.1">.</span></span></p>
<h2 id="_idParaDest-129" class="calibre7"><a id="_idTextAnchor147" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.254.1">Formatting</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.255.1">We use four spaces </span><a id="_idIndexMarker557" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.256.1">for indentation in Kotlin. </span><span class="kobospan" id="kobo.256.2">However, note that this is a convention and not a strict rule. </span><span class="kobospan" id="kobo.256.3">We should always ensure that our code is properly formatted as per the conventions agreed upon by the team </span><span><span class="kobospan" id="kobo.257.1">or company</span></span></p>
<h2 id="_idParaDest-130" class="calibre7"><a id="_idTextAnchor148" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.258.1">Functional programming</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.259.1">We should take</span><a id="_idIndexMarker558" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.260.1"> advantage of Kotlin </span><strong class="bold"><span class="kobospan" id="kobo.261.1">functional programming</span></strong><span class="kobospan" id="kobo.262.1"> features</span><a id="_idIndexMarker559" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.263.1"> such as </span><strong class="bold"><span class="kobospan" id="kobo.264.1">lambdas</span></strong><span class="kobospan" id="kobo.265.1">, </span><strong class="bold"><span class="kobospan" id="kobo.266.1">higher-order functions</span></strong><span class="kobospan" id="kobo.267.1">, and </span><strong class="bold"><span class="kobospan" id="kobo.268.1">inline functions</span></strong><span class="kobospan" id="kobo.269.1">. </span><span class="kobospan" id="kobo.269.2">This will help us make our code more</span><a id="_idIndexMarker560" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.270.1"> concise and</span><a id="_idIndexMarker561" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.271.1"> readable. </span><span class="kobospan" id="kobo.271.2">An </span><a id="_idIndexMarker562" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.272.1">example is shown in the following </span><span><span class="kobospan" id="kobo.273.1">code block:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.274.1">
val total = numbers.reduce { sum, element -&gt; sum + element }</span></pre> <h2 id="_idParaDest-131" class="calibre7"><a id="_idTextAnchor149" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.275.1">Coroutines</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.276.1">Kotlin provides </span><strong class="bold"><span class="kobospan" id="kobo.277.1">coroutines</span></strong><span class="kobospan" id="kobo.278.1">, which are used to perform asynchronous operations. </span><span class="kobospan" id="kobo.278.2">They are very lightweight and easy to use and help </span><a id="_idIndexMarker563" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.279.1">us avoid callback hell. </span><span class="kobospan" id="kobo.279.2">We should use coroutines when we need to </span><a id="_idIndexMarker564" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.280.1">perform asynchronous operations. </span><span class="kobospan" id="kobo.280.2">An example of a coroutine in Kotlin is as </span><span><span class="kobospan" id="kobo.281.1">shown here:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.282.1">
fun makeNetworkCall() {
  viewModelScope.launch {
    val result = async {
    // perform network call
    }
    // update UI
  }
}</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.283.1">In the preceding example, we used </span><strong class="source-inline"><span class="kobospan" id="kobo.284.1">viewModelScope</span></strong><span class="kobospan" id="kobo.285.1"> to launch a coroutine. </span><span class="kobospan" id="kobo.285.2">This is to ensure that the coroutine is canceled when the view model is destroyed. </span><span class="kobospan" id="kobo.285.3">We used the </span><strong class="source-inline"><span class="kobospan" id="kobo.286.1">launch</span></strong><span class="kobospan" id="kobo.287.1"> coroutine builder to create a new coroutine. </span><span class="kobospan" id="kobo.287.2">Inside the </span><strong class="source-inline"><span class="kobospan" id="kobo.288.1">launch</span></strong><span class="kobospan" id="kobo.289.1"> lambda, we performed our network call, which is supposed to happen in the background. </span><span class="kobospan" id="kobo.289.2">We used the </span><strong class="source-inline"><span class="kobospan" id="kobo.290.1">async</span></strong><span class="kobospan" id="kobo.291.1"> coroutine builder, which allows us to await the result of the network call. </span><span class="kobospan" id="kobo.291.2">The </span><strong class="source-inline"><span class="kobospan" id="kobo.292.1">async</span></strong><span class="kobospan" id="kobo.293.1"> coroutine builder returns a </span><strong class="source-inline"><span class="kobospan" id="kobo.294.1">Deferred</span></strong><span class="kobospan" id="kobo.295.1"> object. </span><span class="kobospan" id="kobo.295.2">Lastly, we updated the UI with the result of the </span><span><span class="kobospan" id="kobo.296.1">network call.</span></span></p>
<h2 id="_idParaDest-132" class="calibre7"><a id="_idTextAnchor150" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.297.1">The when statements</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.298.1">Kotlin provides </span><strong class="source-inline"><span class="kobospan" id="kobo.299.1">when</span></strong><span class="kobospan" id="kobo.300.1"> statements, which </span><a id="_idIndexMarker565" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.301.1">are used to replace </span><strong class="source-inline"><span class="kobospan" id="kobo.302.1">switch</span></strong><span class="kobospan" id="kobo.303.1"> statements. </span><span class="kobospan" id="kobo.303.2">We</span><a id="_idIndexMarker566" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.304.1"> should use </span><strong class="source-inline"><span class="kobospan" id="kobo.305.1">when</span></strong><span class="kobospan" id="kobo.306.1"> statements when we need to perform conditional operations. </span><span class="kobospan" id="kobo.306.2">If we have blocks with more than one </span><strong class="source-inline"><span class="kobospan" id="kobo.307.1">if</span></strong> <strong class="source-inline"><span class="kobospan" id="kobo.308.1">else</span></strong><span class="kobospan" id="kobo.309.1"> statement, we should consider using </span><strong class="source-inline"><span class="kobospan" id="kobo.310.1">when</span></strong><span class="kobospan" id="kobo.311.1"> statements. </span><span class="kobospan" id="kobo.311.2">An example is shown in the </span><span><span class="kobospan" id="kobo.312.1">following code</span></span><span><span class="kobospan" id="kobo.313.1">:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.314.1">
val number = when {
  x % 2 == 0 -&gt; "Even"
  x % 2 != 0 -&gt; "Odd"
  else -&gt; "Invalid"
}</span></pre> <h2 id="_idParaDest-133" class="calibre7"><a id="_idTextAnchor151" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.315.1">Classes and functions</span></h2>
<ul class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.316.1">Kotlin allows us to declare multiple classes in a single file. </span><span class="kobospan" id="kobo.316.2">We should use this feature to avoid creating a</span><a id="_idIndexMarker567" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.317.1"> lot of files, especially for classes that are closely related. </span><span class="kobospan" id="kobo.317.2">We should, however, be keen not to have bloated files with a lot of classes, so we should use this feature </span><span><span class="kobospan" id="kobo.318.1">with caution.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.319.1">We have to ensure that</span><a id="_idIndexMarker568" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.320.1"> we define only one </span><strong class="bold"><span class="kobospan" id="kobo.321.1">primary constructor</span></strong><span class="kobospan" id="kobo.322.1"> per class. </span><span class="kobospan" id="kobo.322.2">Instead of overloading the constructor with a second one, we can always consider using default values for the </span><span><span class="kobospan" id="kobo.323.1">constructor parameters.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.324.1">We can use </span><strong class="bold"><span class="kobospan" id="kobo.325.1">companion objects</span></strong><span class="kobospan" id="kobo.326.1"> to create static</span><a id="_idIndexMarker569" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.327.1"> members. </span><span class="kobospan" id="kobo.327.2">Both Kotlin’s companion </span><a id="_idIndexMarker570" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.328.1">objects and Java’s </span><strong class="bold"><span class="kobospan" id="kobo.329.1">static members</span></strong><span class="kobospan" id="kobo.330.1"> facilitate the creation of class-level members that can be accessed without creating an instance of the class. </span><span class="kobospan" id="kobo.330.2">However, Kotlin’s companion objects provide additional flexibility by allowing access to non-static members and offer a more </span><span><span class="kobospan" id="kobo.331.1">expressive syntax.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.332.1">We should always avoid returning </span><strong class="source-inline1"><span class="kobospan" id="kobo.333.1">null</span></strong><span class="kobospan" id="kobo.334.1"> from functions. </span><span class="kobospan" id="kobo.334.2">Instead, we should use </span><span><span class="kobospan" id="kobo.335.1">nullable types.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.336.1">We can always use </span><strong class="bold"><span class="kobospan" id="kobo.337.1">scope functions</span></strong><span class="kobospan" id="kobo.338.1"> to perform operations on objects. </span><span class="kobospan" id="kobo.338.2">This will help us avoid creating a lot</span><a id="_idIndexMarker571" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.339.1"> of </span><span><span class="kobospan" id="kobo.340.1">temporary variables.</span></span></li>
</ul>
<p class="calibre4"><span class="kobospan" id="kobo.341.1">This is just a small list of best practices. </span><span class="kobospan" id="kobo.341.2">As the code base grows, it’s hard at times to keep track of all the best practices. </span><span class="kobospan" id="kobo.341.3">This is where static code analysis tools come in handy. </span><span class="kobospan" id="kobo.341.4">They help us identify code smells and technical debt. </span><span class="kobospan" id="kobo.341.5">They also help us identify bugs and security vulnerabilities. </span><span class="kobospan" id="kobo.341.6">In the next section, we will learn about some of the static code analysis tools that we can use to improve the quality of </span><span><span class="kobospan" id="kobo.342.1">our code.</span></span></p>
<h1 id="_idParaDest-134" class="calibre6"><a id="_idTextAnchor152" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.343.1">Using Ktlint for static analysis</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.344.1">According to the official documentation, ktlint is “</span><em class="italic"><span class="kobospan" id="kobo.345.1">an anti-bikeshedding Kotlin linter with a built-in formatter</span></em><span class="kobospan" id="kobo.346.1">.” </span><span class="kobospan" id="kobo.346.2">It helps us do </span><strong class="bold"><span class="kobospan" id="kobo.347.1">static analysis</span></strong><span class="kobospan" id="kobo.348.1"> of our Kotlin code and has a built-in rule set and formatter. </span><span class="kobospan" id="kobo.348.2">It has</span><a id="_idIndexMarker572" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.349.1"> several integrations. </span><span class="kobospan" id="kobo.349.2">For Android projects, we normally use the Gradle integration. </span><span class="kobospan" id="kobo.349.3">We have Ktlint Gradle (</span><a href="https://github.com/jlleitschuh/ktlint-gradle" class="calibre3 pcalibre pcalibre1"><span class="kobospan" id="kobo.350.1">https://github.com/jlleitschuh/ktlint-gradle</span></a><span class="kobospan" id="kobo.351.1">), which provides a wrapper plugin over the ktlint project. </span><span class="kobospan" id="kobo.351.2">After </span><a id="_idIndexMarker573" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.352.1">adding the project to our project, it creates </span><strong class="source-inline"><span class="kobospan" id="kobo.353.1">gradle</span></strong><span class="kobospan" id="kobo.354.1"> tasks that allow us to run </span><strong class="source-inline"><span class="kobospan" id="kobo.355.1">ktlint</span></strong><span class="kobospan" id="kobo.356.1"> on our project. </span><span class="kobospan" id="kobo.356.2">We are also able to </span><span><span class="kobospan" id="kobo.357.1">do auto-formatting.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.358.1">To set up Ktlint in our project, we need to add the Ktlint plugin to our project’s </span><strong class="source-inline"><span class="kobospan" id="kobo.359.1">build.gradle.kts</span></strong><span class="kobospan" id="kobo.360.1"> file in the plugins block, </span><span><span class="kobospan" id="kobo.361.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.362.1">
id("org.jlleitschuh.gradle.ktlint") version "11.6.1"</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.363.1">Tap the </span><strong class="bold"><span class="kobospan" id="kobo.364.1">Sync Now</span></strong><span class="kobospan" id="kobo.365.1"> button at the top to add the changes to the project. </span><span class="kobospan" id="kobo.365.2">This adds the Ktlint plugin to our project. </span><span class="kobospan" id="kobo.365.3">We also need to set the plugin to be applied to all project modules. </span><span class="kobospan" id="kobo.365.4">To do this, we add the following code to the project-level </span><strong class="source-inline"><span class="kobospan" id="kobo.366.1">build.gradle.kts</span></strong><span class="kobospan" id="kobo.367.1"> file below the </span><span><span class="kobospan" id="kobo.368.1">plugins block:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.369.1">
subprojects {
    apply(plugin = "org.jlleitschuh.gradle.ktlint")
    ktlint {
        verbose.set(true)
        android.set(true)
        filter {
            exclude("**/generated/**")
        }
    }
}</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.370.1">This will apply the plugin to all the project modules. </span><span class="kobospan" id="kobo.370.2">Tap the </span><strong class="bold"><span class="kobospan" id="kobo.371.1">Sync Now</span></strong><span class="kobospan" id="kobo.372.1"> button at the top to add the changes to the project. </span><span class="kobospan" id="kobo.372.2">In the preceding code, we apply the plugin and do some additional configuration </span><a id="_idIndexMarker574" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.373.1">in the </span><strong class="source-inline"><span class="kobospan" id="kobo.374.1">ktlint</span></strong><span class="kobospan" id="kobo.375.1"> block. </span><span class="kobospan" id="kobo.375.2">In our case, we are setting the </span><strong class="source-inline"><span class="kobospan" id="kobo.376.1">verbose</span></strong><span class="kobospan" id="kobo.377.1"> and </span><strong class="source-inline"><span class="kobospan" id="kobo.378.1">android</span></strong><span class="kobospan" id="kobo.379.1"> properties to </span><strong class="source-inline"><span class="kobospan" id="kobo.380.1">true</span></strong><span class="kobospan" id="kobo.381.1">. </span><span class="kobospan" id="kobo.381.2">We are also excluding the </span><strong class="source-inline"><span class="kobospan" id="kobo.382.1">generated</span></strong><span class="kobospan" id="kobo.383.1"> folder from </span><span><span class="kobospan" id="kobo.384.1">the analysis.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.385.1">With that, we are ready to use Ktlint. </span><span class="kobospan" id="kobo.385.2">First, though, let’s disable some formatting options. </span><span class="kobospan" id="kobo.385.3">To do this, we need to</span><a id="_idIndexMarker575" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.386.1"> create an </span><strong class="source-inline"><span class="kobospan" id="kobo.387.1">.editorconfig</span></strong><span class="kobospan" id="kobo.388.1"> file in the root of our project. </span><span class="kobospan" id="kobo.388.2">In the file, we add the </span><span><span class="kobospan" id="kobo.389.1">following code:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.390.1">
root = true
[*]
charset = utf-8
insert_final_newline = false
trim_trailing_whitespace = true
[*.{kt,kts}]
indent_size = 4
ij_kotlin_packages_to_use_import_on_demand = unset
ij_kotlin_name_count_to_use_star_import = 999
ij_kotlin_name_count_to_use_star_import_for_members = 999</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.391.1">This disables some formatting options, the key one being </span><strong class="source-inline"><span class="kobospan" id="kobo.392.1">insert_final_newline</span></strong><span class="kobospan" id="kobo.393.1"> at the end of each file. </span><span class="kobospan" id="kobo.393.2">This is especially useful for existing projects as it prevents us from having to reformat the whole project. </span><span class="kobospan" id="kobo.393.3">If you need to customize Ktlint behavior, this is the file you use to enable or disable </span><span><span class="kobospan" id="kobo.394.1">some options.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.395.1">Let us now run the </span><strong class="source-inline"><span class="kobospan" id="kobo.396.1">ktlintCheck</span></strong><span class="kobospan" id="kobo.397.1"> task. </span><span class="kobospan" id="kobo.397.2">To do this, let us open the </span><strong class="bold"><span class="kobospan" id="kobo.398.1">Terminal</span></strong><span class="kobospan" id="kobo.399.1"> tab in our IDE and run the </span><span><span class="kobospan" id="kobo.400.1">following command:</span></span></p>
<pre class="console"><span class="kobospan1" id="kobo.401.1">
./gradlew ktlintCheck</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.402.1">After the task completes, we </span><a id="_idIndexMarker576" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.403.1">will see the </span><span><span class="kobospan" id="kobo.404.1">following output:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer153">
<span class="kobospan" id="kobo.405.1"><img alt="Figure 11.1 – Ktlint check failure" src="image/B19779_11_01.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.406.1">Figure 11.1 – Ktlint check failure</span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer154">
<span class="kobospan" id="kobo.407.1"><img alt="Figure 11.2 – Ktlint check failure continued" src="image/B19779_11_02.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.408.1">Figure 11.2 – Ktlint check failure continued</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.409.1">From the preceding figures, we can </span><a id="_idIndexMarker577" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.410.1">see that the task was completed with failures, which means our project is not correctly formatted. </span><span class="kobospan" id="kobo.410.2">The output also shows the specific formatting error and the file. </span><span class="kobospan" id="kobo.410.3">We can see indentation, formatting, and new lines issues. </span><span class="kobospan" id="kobo.410.4">We can opt to fix the issues by ourselves but, first, we should always check whether the Ktlint formatter can fix the </span><a id="_idIndexMarker578" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.411.1">issues for us. </span><span class="kobospan" id="kobo.411.2">To do this, we can run the </span><span><span class="kobospan" id="kobo.412.1">following command:</span></span></p>
<pre class="console"><span class="kobospan1" id="kobo.413.1">
./gradlew ktlintFormat</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.414.1">This will run the </span><strong class="source-inline"><span class="kobospan" id="kobo.415.1">ktlintFormat</span></strong><span class="kobospan" id="kobo.416.1"> task. </span><span class="kobospan" id="kobo.416.2">After the task is completed, we will see the </span><span><span class="kobospan" id="kobo.417.1">following output:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer155">
<span class="kobospan" id="kobo.418.1"><img alt="Figure 11.3 – ktlintFormat successful" src="image/B19779_11_03.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.419.1">Figure 11.3 – ktlintFormat successful</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.420.1">As seen in the preceding</span><a id="_idIndexMarker579" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.421.1"> figure, the task was completed successfully. </span><span class="kobospan" id="kobo.421.2">This means the Ktlint formatter was able to fix the issues for us. </span><span class="kobospan" id="kobo.421.3">If the Ktlint formatter is not able to fix the issues, it normally highlights the issues that the plugin is not able to fix and shows the file and line number. </span><span class="kobospan" id="kobo.421.4">We can then fix the issues manually. </span><span class="kobospan" id="kobo.421.5">For now, we don’t have such issues. </span><span class="kobospan" id="kobo.421.6">We can now run the </span><strong class="source-inline"><span class="kobospan" id="kobo.422.1">ktlintCheck</span></strong><span class="kobospan" id="kobo.423.1"> task again to confirm that the issues have been fixed. </span><span class="kobospan" id="kobo.423.2">After the task completes, we will see the </span><span><span class="kobospan" id="kobo.424.1">following output:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer156">
<span class="kobospan" id="kobo.425.1"><img alt="Figure 11.4 – ktlintFormat successful" src="image/B19779_11_04.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.426.1">Figure 11.4 – ktlintFormat successful</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.427.1">As seen in the preceding figure, the build was successful. </span><span class="kobospan" id="kobo.427.2">This means our project is correctly formatted. </span><span class="kobospan" id="kobo.427.3">By using the Git tool in our IDE by pressing </span><em class="italic"><span class="kobospan" id="kobo.428.1">Command</span></em><span class="kobospan" id="kobo.429.1"> + </span><em class="italic"><span class="kobospan" id="kobo.430.1">K</span></em><span class="kobospan" id="kobo.431.1"> on macOS and </span><em class="italic"><span class="kobospan" id="kobo.432.1">Ctrl</span></em><span class="kobospan" id="kobo.433.1"> + </span><em class="italic"><span class="kobospan" id="kobo.434.1">K</span></em><span class="kobospan" id="kobo.435.1"> on Windows, we can see the files that have changes and see the changes made by the Ktlint </span><a id="_idIndexMarker580" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.436.1">formatter. </span><span class="kobospan" id="kobo.436.2">From our project, this is what the commit modal </span><span><span class="kobospan" id="kobo.437.1">looks like:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer157">
<span class="kobospan" id="kobo.438.1"><img alt="Figure 11.5 – Git commit modal" src="image/B19779_11_05.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.439.1">Figure 11.5 – Git commit modal</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.440.1">As shown in </span><span><em class="italic"><span class="kobospan" id="kobo.441.1">Figure 11</span></em></span><em class="italic"><span class="kobospan" id="kobo.442.1">.5</span></em><span class="kobospan" id="kobo.443.1">, the </span><strong class="source-inline"><span class="kobospan" id="kobo.444.1">ktlintFormat</span></strong><span class="kobospan" id="kobo.445.1"> command has made a bunch of changes to our files. </span><span class="kobospan" id="kobo.445.2">We can check each file for </span><a id="_idIndexMarker581" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.446.1">changes too. </span><span class="kobospan" id="kobo.446.2">The formatter is a good tool to help us quickly format our code according to the Kotlin style and conventions. </span><span class="kobospan" id="kobo.446.3">The </span><strong class="source-inline"><span class="kobospan" id="kobo.447.1">ktlintFormat</span></strong><span class="kobospan" id="kobo.448.1"> and </span><strong class="source-inline"><span class="kobospan" id="kobo.449.1">ktlintCheck</span></strong><span class="kobospan" id="kobo.450.1"> commands are the ones to run after you complete your changes before you commit your code. </span><span class="kobospan" id="kobo.450.2">This will help you avoid committing code that is not </span><span><span class="kobospan" id="kobo.451.1">formatted correctly.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.452.1">We have done a basic setup, which is sufficient for most projects. </span><span class="kobospan" id="kobo.452.2">For more information, you can learn more about the plugin, the rules available, and how to customize it </span><span><span class="kobospan" id="kobo.453.1">here: </span></span><a href="https://github.com/jlleitschuh/ktlint-gradle" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.454.1">https://github.com/jlleitschuh/ktlint-gradle</span></span></a><span><span class="kobospan" id="kobo.455.1">.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.456.1">We have seen how to</span><a id="_idIndexMarker582" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.457.1"> use the Ktlint plugin to format and perform static</span><a id="_idIndexMarker583" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.458.1"> analysis of our code. </span><span class="kobospan" id="kobo.458.2">In the next section, we will learn how to use the detekt plugin to check for code smells and technical debt in </span><span><span class="kobospan" id="kobo.459.1">our code.</span></span></p>
<h1 id="_idParaDest-135" class="calibre6"><a id="_idTextAnchor153" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.460.1">Detecting code smells with detekt</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.461.1">detekt is another static</span><a id="_idIndexMarker584" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.462.1"> code analysis tool for Kotlin. </span><span class="kobospan" id="kobo.462.2">It helps us identify problems early and keep the technical debt low throughout the development process. </span><span class="kobospan" id="kobo.462.3">It enforces a set of rules that help us avoid code smells and technical debt. </span><span class="kobospan" id="kobo.462.4">It also gives us the flexibility to create our own custom rule sets. </span><span class="kobospan" id="kobo.462.5">Detekt offers the </span><span><span class="kobospan" id="kobo.463.1">following features:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.464.1">It identifies code smell for </span><span><span class="kobospan" id="kobo.465.1">Kotlin projects</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.466.1">It’s easily configurable and customizable to suit </span><span><span class="kobospan" id="kobo.467.1">our needs</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.468.1">We can always suppress the warnings if we feel they are </span><span><span class="kobospan" id="kobo.469.1">not applicable</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.470.1">We can specify the code smell thresholds that we want </span><span><span class="kobospan" id="kobo.471.1">to enforce</span></span></li>
</ul>
<p class="calibre4"><span class="kobospan" id="kobo.472.1">We will be using these features in our project. </span><span class="kobospan" id="kobo.472.2">But before that, let us understand the rule sets. </span><span class="kobospan" id="kobo.472.3">detekt has several rule sets that check the compliance of your code with the Kotlin style guide. </span><span class="kobospan" id="kobo.472.4">The available rule sets are </span><span><span class="kobospan" id="kobo.473.1">as follows:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.474.1">Comments</span></strong><span class="kobospan" id="kobo.475.1">: This rule set provides rules that address issues in comments and the documentation of the code. </span><span class="kobospan" id="kobo.475.2">It checks header files, comments on private methods, and undocumented classes, properties, </span><span><span class="kobospan" id="kobo.476.1">or methods.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.477.1">Complexity</span></strong><span class="kobospan" id="kobo.478.1">: This rule set contains rules that report complex code. </span><span class="kobospan" id="kobo.478.2">It checks for complex conditions, methods, expressions, and classes, as well as long methods and long </span><span><span class="kobospan" id="kobo.479.1">parameter lists.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.480.1">Coroutines</span></strong><span class="kobospan" id="kobo.481.1">: This rule set analyzes code for potential </span><span><span class="kobospan" id="kobo.482.1">coroutine problems.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.483.1">Empty-Blocks</span></strong><span class="kobospan" id="kobo.484.1">: This rule set contains rules that report empty blocks of code. </span><span class="kobospan" id="kobo.484.2">Examples include empty </span><strong class="source-inline1"><span class="kobospan" id="kobo.485.1">catch</span></strong><span class="kobospan" id="kobo.486.1"> blocks, empty class blocks, and empty function and conditional </span><span><span class="kobospan" id="kobo.487.1">function blocks.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.488.1">Exceptions</span></strong><span class="kobospan" id="kobo.489.1">: This rule set reports issues related to how code throws and handles exceptions. </span><span class="kobospan" id="kobo.489.2">For example, it has rules for if you’re catching generic exceptions, among other issues related to </span><span><span class="kobospan" id="kobo.490.1">handling exceptions.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.491.1">Formatting</span></strong><span class="kobospan" id="kobo.492.1">: This rule set checks whether your code base follows a specific formatting rule set. </span><span class="kobospan" id="kobo.492.2">It allows for </span><a id="_idIndexMarker585" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.493.1">checking indentation, spacing, semicolons, or even import ordering, among </span><span><span class="kobospan" id="kobo.494.1">other things.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.495.1">Naming</span></strong><span class="kobospan" id="kobo.496.1">: This rule set contains rules that assert the naming of different parts of the code base. </span><span class="kobospan" id="kobo.496.2">It checks how we name our classes, packages, functions, and variables. </span><span class="kobospan" id="kobo.496.3">It reports the errors in case we’re not following the </span><span><span class="kobospan" id="kobo.497.1">set conventions.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.498.1">Performance</span></strong><span class="kobospan" id="kobo.499.1">: This rule set analyzes code for potential performance problems. </span><span class="kobospan" id="kobo.499.2">Some of the issues it reports include the use of </span><strong class="source-inline1"><span class="kobospan" id="kobo.500.1">ArrayPrimitives</span></strong><span class="kobospan" id="kobo.501.1"> or the misuse of </span><strong class="source-inline1"><span class="kobospan" id="kobo.502.1">forEach</span></strong><span class="kobospan" id="kobo.503.1"> loops, </span><span><span class="kobospan" id="kobo.504.1">for instance.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.505.1">Potential-Bugs</span></strong><span class="kobospan" id="kobo.506.1">: This rule set provides rules that detect </span><span><span class="kobospan" id="kobo.507.1">potential bugs.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.508.1">Ruleauthors</span></strong><span class="kobospan" id="kobo.509.1">: This rule set provides rules that ensure good practices are followed when writing </span><span><span class="kobospan" id="kobo.510.1">custom rules.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.511.1">Style</span></strong><span class="kobospan" id="kobo.512.1">: This rule set provides rules that assert the style of the code. </span><span class="kobospan" id="kobo.512.2">This will help keep the code in line with the given code </span><span><span class="kobospan" id="kobo.513.1">style guidelines.</span></span></li>
</ul>
<p class="calibre4"><span class="kobospan" id="kobo.514.1">With this understanding of detekt rule sets and features, let us now set up detekt in </span><span><span class="kobospan" id="kobo.515.1">our project.</span></span></p>
<h2 id="_idParaDest-136" class="calibre7"><a id="_idTextAnchor154" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.516.1">Setting up detekt</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.517.1">Similar to Ktlint, detekt is available as a Gradle plugin. </span><span class="kobospan" id="kobo.517.2">To add the plugin to our project, we need to add the</span><a id="_idIndexMarker586" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.518.1"> following code to our project’s </span><strong class="source-inline"><span class="kobospan" id="kobo.519.1">build.gradle.kts</span></strong><span class="kobospan" id="kobo.520.1"> file in the </span><span><span class="kobospan" id="kobo.521.1">plugins block:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.522.1">
id("io.gitlab.arturbosch.detekt") version "1.23.1"</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.523.1">Click on the </span><strong class="bold"><span class="kobospan" id="kobo.524.1">Sync Now</span></strong><span class="kobospan" id="kobo.525.1"> button at the top to add the changes to the project. </span><span class="kobospan" id="kobo.525.2">This adds the detekt plugin to our project. </span><span class="kobospan" id="kobo.525.3">We also need to set the plugin to be applied to all project modules. </span><span class="kobospan" id="kobo.525.4">To do this, we add the following code to the project-level </span><strong class="source-inline"><span class="kobospan" id="kobo.526.1">build.gradle.kts</span></strong><span class="kobospan" id="kobo.527.1"> file below the </span><span><span class="kobospan" id="kobo.528.1">plugins block:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.529.1">
apply(plugin = "io.gitlab.arturbosch.detekt")
detekt {
    parallel = true
}</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.530.1">This applies the detekt plugin to all the modules that will be in our project so we do not need to add the plugin to each module. </span><span class="kobospan" id="kobo.530.2">We also set the </span><strong class="source-inline"><span class="kobospan" id="kobo.531.1">parallel</span></strong><span class="kobospan" id="kobo.532.1"> property to </span><strong class="source-inline"><span class="kobospan" id="kobo.533.1">true</span></strong><span class="kobospan" id="kobo.534.1">. </span><span class="kobospan" id="kobo.534.2">This will help us run the detekt tasks in parallel and save time when running the tasks. </span><span class="kobospan" id="kobo.534.3">Click on the </span><strong class="bold"><span class="kobospan" id="kobo.535.1">Sync Now</span></strong><span class="kobospan" id="kobo.536.1"> button at the top to add the changes to the project. </span><span class="kobospan" id="kobo.536.2">We are now set to use detekt. </span><span class="kobospan" id="kobo.536.3">Open your terminal and run the </span><span><span class="kobospan" id="kobo.537.1">following command:</span></span></p>
<pre class="console"><span class="kobospan1" id="kobo.538.1">
./gradlew detekt</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.539.1">This will run the </span><strong class="source-inline"><span class="kobospan" id="kobo.540.1">detekt</span></strong><span class="kobospan" id="kobo.541.1"> task. </span><span class="kobospan" id="kobo.541.2">After the task completes, we will see the </span><span><span class="kobospan" id="kobo.542.1">following output:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer158">
<span class="kobospan" id="kobo.543.1"><img alt="Figure 11.6 – detekt errors" src="image/B19779_11_06.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.544.1">Figure 11.6 – detekt errors</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.545.1">The first time we run the task, we will get a number of errors. </span><span class="kobospan" id="kobo.545.2">As we can see from the preceding figure, detekt shows the file and line number with the error and the type of rule set that has not been complied with. </span><span class="kobospan" id="kobo.545.3">In </span><span><em class="italic"><span class="kobospan" id="kobo.546.1">Figure 11</span></em></span><em class="italic"><span class="kobospan" id="kobo.547.1">.6</span></em><span class="kobospan" id="kobo.548.1">, we can see the common ones being the function is too long, and magic numbers are included, among others. </span><span class="kobospan" id="kobo.548.2">At the end of the list of errors, detekt </span><a id="_idIndexMarker587" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.549.1">normally shows the total number of weighted issues, as shown in the </span><span><span class="kobospan" id="kobo.550.1">following figure:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer159">
<span class="kobospan" id="kobo.551.1"><img alt="Figure 11.7 – detekt errors summary" src="image/B19779_11_07.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.552.1">Figure 11.7 – detekt errors summary</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.553.1">We have a total of 121 weighted issues. </span><span class="kobospan" id="kobo.553.2">We are going to see how to suppress some as well as increase thresholds for others and fix the ones that we can shortly. </span><span class="kobospan" id="kobo.553.3">First, we need to change the default behavior of detekt. </span><span class="kobospan" id="kobo.553.4">To do this, we need to create a </span><strong class="source-inline"><span class="kobospan" id="kobo.554.1">detekt-config.yml</span></strong><span class="kobospan" id="kobo.555.1"> file in the root of our project. </span><span class="kobospan" id="kobo.555.2">detekt has a task that does this. </span><span class="kobospan" id="kobo.555.3">Let us open the </span><strong class="bold"><span class="kobospan" id="kobo.556.1">Terminal</span></strong><span class="kobospan" id="kobo.557.1"> tab in our IDE and run the </span><span><span class="kobospan" id="kobo.558.1">following command:</span></span></p>
<pre class="console"><span class="kobospan1" id="kobo.559.1">
./gradlew detektGenerateConfig</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.560.1">This will generate a </span><strong class="source-inline"><span class="kobospan" id="kobo.561.1">config</span></strong><span class="kobospan" id="kobo.562.1"> file if we don’t have it already. </span><span class="kobospan" id="kobo.562.2">After the task completes, we will see the </span><span><span class="kobospan" id="kobo.563.1">following output:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer160">
<span class="kobospan" id="kobo.564.1"><img alt="Figure 11.8 – detekt config file" src="image/B19779_11_08.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.565.1">Figure 11.8 – detekt config file</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.566.1">We need to reference this file to our detekt setup. </span><span class="kobospan" id="kobo.566.2">Let us head over to the project-level </span><strong class="source-inline"><span class="kobospan" id="kobo.567.1">build.gradle.kts</span></strong><span class="kobospan" id="kobo.568.1"> file and </span><a id="_idIndexMarker588" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.569.1">modify our </span><strong class="source-inline"><span class="kobospan" id="kobo.570.1">detekt</span></strong><span class="kobospan" id="kobo.571.1"> block to look </span><span><span class="kobospan" id="kobo.572.1">like this:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.573.1">
detekt {
    parallel = true
    config.setFrom(files("${project.rootDir}/config/detekt/detekt.yml"))
}</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.574.1">Here, we are using our newly created file as the </span><strong class="source-inline"><span class="kobospan" id="kobo.575.1">config</span></strong><span class="kobospan" id="kobo.576.1"> file. </span><span class="kobospan" id="kobo.576.2">Click on the </span><strong class="bold"><span class="kobospan" id="kobo.577.1">Sync Now</span></strong><span class="kobospan" id="kobo.578.1"> button at the top to add the changes to the project. </span><span class="kobospan" id="kobo.578.2">Next, let us now do some configuration to our detekt </span><span><strong class="source-inline"><span class="kobospan" id="kobo.579.1">config</span></strong></span><span><span class="kobospan" id="kobo.580.1"> file.</span></span></p>
<h2 id="_idParaDest-137" class="calibre7"><a id="_idTextAnchor155" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.581.1">Customizing detekt</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.582.1">At times, </span><strong class="source-inline"><span class="kobospan" id="kobo.583.1">detekt</span></strong><span class="kobospan" id="kobo.584.1"> might be reporting issues that we do not want to fix or we might want to change the severity or thresholds of the issue. </span><span class="kobospan" id="kobo.584.2">Here is where customizing detekt comes in handy. </span><span class="kobospan" id="kobo.584.3">We can </span><a id="_idIndexMarker589" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.585.1">customize </span><strong class="source-inline"><span class="kobospan" id="kobo.586.1">detekt</span></strong><span class="kobospan" id="kobo.587.1"> in the </span><strong class="source-inline"><span class="kobospan" id="kobo.588.1">detekt.yml</span></strong><span class="kobospan" id="kobo.589.1"> file and customize the rules that we are interested in. </span><span class="kobospan" id="kobo.589.2">The first issue we are going to disable is the </span><strong class="bold"><span class="kobospan" id="kobo.590.1">magic number</span></strong><span class="kobospan" id="kobo.591.1"> issue. </span><span class="kobospan" id="kobo.591.2">This is the issue that is raised when we use numbers directly in our code. </span><span class="kobospan" id="kobo.591.3">Let us</span><a id="_idIndexMarker590" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.592.1"> open the </span><strong class="source-inline"><span class="kobospan" id="kobo.593.1">detekt.yml</span></strong><span class="kobospan" id="kobo.594.1"> file and press </span><em class="italic"><span class="kobospan" id="kobo.595.1">Command</span></em><span class="kobospan" id="kobo.596.1"> + </span><em class="italic"><span class="kobospan" id="kobo.597.1">F</span></em><span class="kobospan" id="kobo.598.1"> on macOS or </span><em class="italic"><span class="kobospan" id="kobo.599.1">Ctrl</span></em><span class="kobospan" id="kobo.600.1"> + </span><em class="italic"><span class="kobospan" id="kobo.601.1">F</span></em><span class="kobospan" id="kobo.602.1"> on Windows to search for the </span><strong class="source-inline"><span class="kobospan" id="kobo.603.1">MagicNumber</span></strong><span class="kobospan" id="kobo.604.1"> issue and modify it </span><span><span class="kobospan" id="kobo.605.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.606.1">
MagicNumber:
  active: false</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.607.1">We are setting the </span><strong class="source-inline"><span class="kobospan" id="kobo.608.1">active</span></strong><span class="kobospan" id="kobo.609.1"> property to </span><strong class="source-inline"><span class="kobospan" id="kobo.610.1">false</span></strong><span class="kobospan" id="kobo.611.1">. </span><span class="kobospan" id="kobo.611.2">This will disable the issue. </span><span class="kobospan" id="kobo.611.3">By running the </span><strong class="source-inline"><span class="kobospan" id="kobo.612.1">./gradlew detekt</span></strong><span class="kobospan" id="kobo.613.1"> command again, we can see that we have reduced the error from 121 to 60 now! </span><span class="kobospan" id="kobo.613.2">That’s a significant drop. </span><span class="kobospan" id="kobo.613.3">We can also see that the </span><strong class="source-inline"><span class="kobospan" id="kobo.614.1">MagicNumber</span></strong><span class="kobospan" id="kobo.615.1"> issue is no </span><span><span class="kobospan" id="kobo.616.1">longer present.</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer161">
<span class="kobospan" id="kobo.617.1"><img alt="Figure 11.9 – detekt with no magic numbers" src="image/B19779_11_09.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.618.1">Figure 11.9 – detekt with no magic numbers</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.619.1">Next, let us ensure that detekt doesn’t complain about Jetpack Compose function naming. </span><span class="kobospan" id="kobo.619.2">Search for the </span><strong class="source-inline"><span class="kobospan" id="kobo.620.1">FunctionNaming</span></strong><span class="kobospan" id="kobo.621.1"> issue and </span><a id="_idIndexMarker591" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.622.1">modify it to be </span><span><span class="kobospan" id="kobo.623.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.624.1">
FunctionNaming:
  active: true
  excludes: ['**/test/**', '**/androidTest/**', '**/commonTest/**', '**/jvmTest/**', '**/androidUnitTest/**', '**/androidInstrumentedTest/**', '**/jsTest/**', '**/iosTest/**']
  functionPattern: '[a-z][a-zA-Z0-9]*'
  excludeClassPattern: '$^'
  ignoreAnnotated: ['Composable']</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.625.1">We have added </span><strong class="source-inline"><span class="kobospan" id="kobo.626.1">ignoreAnnotated: ['Composable']</span></strong><span class="kobospan" id="kobo.627.1">. </span><span class="kobospan" id="kobo.627.2">This will not report issues for all functions annotated with the </span><strong class="source-inline"><span class="kobospan" id="kobo.628.1">@Composable</span></strong><span class="kobospan" id="kobo.629.1"> annotation. </span><span class="kobospan" id="kobo.629.2">Composable functions use the Pascal case naming convention. </span><span class="kobospan" id="kobo.629.3">Next, we want to disable the new line at the end of the file rule on detekt since we disabled it on Ktlint. </span><span class="kobospan" id="kobo.629.4">Search for the </span><strong class="source-inline"><span class="kobospan" id="kobo.630.1">FinalNewline</span></strong><span class="kobospan" id="kobo.631.1"> issue and modify it to be </span><span><span class="kobospan" id="kobo.632.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.633.1">
NewLineAtEndOfFile:
  active: false</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.634.1">This will disable the issue. </span><span class="kobospan" id="kobo.634.2">By running the </span><strong class="source-inline"><span class="kobospan" id="kobo.635.1">./gradlew detekt</span></strong><span class="kobospan" id="kobo.636.1"> command again, we can see that we have reduced the errors to only </span><span><span class="kobospan" id="kobo.637.1">eight now:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer162">
<span class="kobospan" id="kobo.638.1"><img alt="Figure 11.10 – detekt errors reduced" src="image/B19779_11_10.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.639.1">Figure 11.10 – detekt errors reduced</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.640.1">Now, let us see how to increase the thresholds to resolve the </span><em class="italic"><span class="kobospan" id="kobo.641.1">function too long</span></em><span class="kobospan" id="kobo.642.1"> issue. </span><span class="kobospan" id="kobo.642.2">Search for the </span><strong class="source-inline"><span class="kobospan" id="kobo.643.1">FunctionTooLong</span></strong><span class="kobospan" id="kobo.644.1"> issue and modify it to be </span><span><span class="kobospan" id="kobo.645.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.646.1">
LongMethod:
  active: true
  threshold: 140</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.647.1">This will solve all the issues related to the function being too long. </span><span class="kobospan" id="kobo.647.2">Search for the </span><strong class="source-inline"><span class="kobospan" id="kobo.648.1">LongParameterList</span></strong><span class="kobospan" id="kobo.649.1"> issue and </span><a id="_idIndexMarker592" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.650.1">modify it to be </span><span><span class="kobospan" id="kobo.651.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.652.1">
LongParameterList:
  active: true
  functionThreshold: 8</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.653.1">We have increased the threshold from </span><strong class="source-inline"><span class="kobospan" id="kobo.654.1">6</span></strong><span class="kobospan" id="kobo.655.1"> to </span><strong class="source-inline"><span class="kobospan" id="kobo.656.1">8</span></strong><span class="kobospan" id="kobo.657.1">. </span><span class="kobospan" id="kobo.657.2">Lastly, search for the </span><strong class="source-inline"><span class="kobospan" id="kobo.658.1">ComplexCondition</span></strong><span class="kobospan" id="kobo.659.1"> issue and modify it to be </span><span><span class="kobospan" id="kobo.660.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.661.1">
ComplexCondition:
  active: true
  threshold: 6</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.662.1">We have also increased the threshold from </span><strong class="source-inline"><span class="kobospan" id="kobo.663.1">4</span></strong><span class="kobospan" id="kobo.664.1"> to </span><strong class="source-inline"><span class="kobospan" id="kobo.665.1">6</span></strong><span class="kobospan" id="kobo.666.1">. </span><span class="kobospan" id="kobo.666.2">By running the </span><strong class="source-inline"><span class="kobospan" id="kobo.667.1">./gradlew detekt</span></strong><span class="kobospan" id="kobo.668.1"> command again, we can see that we have reduced the errors to only </span><span><span class="kobospan" id="kobo.669.1">three now:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer163">
<span class="kobospan" id="kobo.670.1"><img alt="Figure 11.11 – More errors removed" src="image/B19779_11_11.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.671.1">Figure 11.11 – More errors removed</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.672.1">Increasing thresholds is a good way of reducing errors. </span><span class="kobospan" id="kobo.672.2">It’s also great since it reduces the amount of refactoring that we have to do. </span><span class="kobospan" id="kobo.672.3">However, we should be careful not to increase the thresholds too much. </span><span class="kobospan" id="kobo.672.4">Let us now try to fix the remaining issues. </span><span class="kobospan" id="kobo.672.5">Let us start with the </span><strong class="source-inline"><span class="kobospan" id="kobo.673.1">TooGenericExceptionCaught</span></strong><span class="kobospan" id="kobo.674.1"> and </span><strong class="source-inline"><span class="kobospan" id="kobo.675.1">SwallowedException</span></strong><span class="kobospan" id="kobo.676.1"> issues. </span><span class="kobospan" id="kobo.676.2">This is in our </span><strong class="source-inline"><span class="kobospan" id="kobo.677.1">PetsSyncWorker</span></strong> <span><strong class="source-inline"><span class="kobospan" id="kobo.678.1">doWork</span></strong></span><span><span class="kobospan" id="kobo.679.1"> function:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.680.1">
override suspend fun doWork(): Result {
    return try {
        petsRepository.fetchRemotePets()
        Result.success()
    } catch (e: Exception) {
        Result.failure()
    }
}</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.681.1">To resolve the issues, we need to add a </span><strong class="source-inline"><span class="kobospan" id="kobo.682.1">log</span></strong><span class="kobospan" id="kobo.683.1"> statement to the </span><strong class="source-inline"><span class="kobospan" id="kobo.684.1">catch</span></strong><span class="kobospan" id="kobo.685.1"> block and catch only the exceptions that we </span><a id="_idIndexMarker593" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.686.1">expect. </span><span class="kobospan" id="kobo.686.2">Let us modify the code to be </span><span><span class="kobospan" id="kobo.687.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.688.1">
override suspend fun doWork(): Result {
    return try {
        petsRepository.fetchRemotePets()
        Result.success()
    } catch (e: IOException) {
        Log.d("PetsSyncWorker", "Error fetching pets", e)
        Result.failure()
    }
}</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.689.1">We have added a </span><strong class="source-inline"><span class="kobospan" id="kobo.690.1">log</span></strong><span class="kobospan" id="kobo.691.1"> statement and we are only catching </span><strong class="source-inline"><span class="kobospan" id="kobo.692.1">IOException</span></strong><span class="kobospan" id="kobo.693.1">. </span><span class="kobospan" id="kobo.693.2">Lastly, let us fix the </span><strong class="source-inline"><span class="kobospan" id="kobo.694.1">UtilityClassWithPublicConstructor</span></strong><span class="kobospan" id="kobo.695.1"> issue. </span><span class="kobospan" id="kobo.695.2">This is in our </span><span><strong class="source-inline"><span class="kobospan" id="kobo.696.1">LeakTestUtils</span></strong></span><span><span class="kobospan" id="kobo.697.1"> class:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.698.1">
class LeakTestUtils {
    companion object {
        val leakCanaryTest = LeakCanaryTest()
    }
}</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.699.1">This class only has a companion object, which returns an instance of the </span><strong class="source-inline"><span class="kobospan" id="kobo.700.1">LeakCanaryTest</span></strong><span class="kobospan" id="kobo.701.1"> class. </span><span class="kobospan" id="kobo.701.2">We can </span><a id="_idIndexMarker594" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.702.1">use an object instead of a class. </span><span class="kobospan" id="kobo.702.2">Let us modify the class to be </span><span><span class="kobospan" id="kobo.703.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.704.1">
object LeakTestUtils {
    val leakCanaryTest = LeakCanaryTest()
}</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.705.1">All the issues should be fixed now. </span><span class="kobospan" id="kobo.705.2">By running the </span><strong class="source-inline"><span class="kobospan" id="kobo.706.1">./gradlew detekt</span></strong><span class="kobospan" id="kobo.707.1"> command again, we can see that we have no </span><span><span class="kobospan" id="kobo.708.1">errors now:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer164">
<span class="kobospan" id="kobo.709.1"><img alt="Figure 11.12 – detekt successful run" src="image/B19779_11_12.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.710.1">Figure 11.12 – detekt successful run</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.711.1">Our build successfully passes. </span><span class="kobospan" id="kobo.711.2">Our project now has a plugin that helps us do static analysis of our code. </span><span class="kobospan" id="kobo.711.3">We can now identify code smells and technical debt early in the development process. </span><span class="kobospan" id="kobo.711.4">We can also use these plugins on </span><strong class="bold"><span class="kobospan" id="kobo.712.1">Continuous Integration/ Continuous Delivery</span></strong><span class="kobospan" id="kobo.713.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.714.1">CI/CD</span></strong><span class="kobospan" id="kobo.715.1">) pipelines to </span><a id="_idIndexMarker595" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.716.1">ensure that we don’t merge code that has code smells and technical debt. </span><span class="kobospan" id="kobo.716.2">This will help us keep our code base clean and maintainable, especially when we are working in teams. </span><span class="kobospan" id="kobo.716.3">We will learn about this extensively in </span><a href="B19779_14.xhtml#_idTextAnchor198" class="calibre3 pcalibre pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.717.1">Chapter 14</span></em></span></a><span><span class="kobospan" id="kobo.718.1">.</span></span></p>
<h1 id="_idParaDest-138" class="calibre6"><a id="_idTextAnchor156" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.719.1">Summary</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.720.1">In this chapter, we have learned about the Kotlin style and the best practices for writing Kotlin code. </span><span class="kobospan" id="kobo.720.2">We have also learned how to use plugins such as Ktlint and Detekt to format, lint, and detect code </span><span><span class="kobospan" id="kobo.721.1">smells early.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.722.1">In the next chapter, we will learn how to add tests for the different layers in the MVVM architecture. </span><span class="kobospan" id="kobo.722.2">We will learn about the importance of adding tests to our apps and how to add unit tests, integration tests, and </span><span><span class="kobospan" id="kobo.723.1">instrumentation tests.</span></span></p>
</div>
</body></html>