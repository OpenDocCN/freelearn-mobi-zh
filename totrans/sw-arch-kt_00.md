# 前言

欢迎来到*使用 Kotlin 进行软件架构*，这是一本全面指南，旨在为你提供构建健壮软件系统所需的知识和技能。随着对高效和可扩展应用程序的需求不断增长，理解架构原则对于工程师和架构师来说变得不可或缺。

在这本书中，我们将通过第一性原理将一系列软件架构风格分解为基本组件，这样这些组件就可以重新排列和组合，以解决现实世界的问题。每一章都专注于特定领域，介绍关键概念、最佳实践和真实世界的例子，说明如何将这些原则应用于 Kotlin。

不论你是希望深化对软件架构理解的资深工程师，还是渴望学习的初学者，这本书都提供了可以立即应用的实际见解。你将找到动手练习、代码片段和案例研究，这些将帮助你掌握复杂的概念并在你的项目中实施它们。

当你开始这段旅程时，我鼓励你尝试这里提出的概念。软件架构不仅仅是模式和风格——它关乎创造力、问题解决、灵活性和适应解决方案以应对你应用程序的独特挑战。祝您阅读愉快！

# 本书面向对象

这本书是为那些希望增强他们的架构知识和思维方式的软件工程师而写的，以解决日常工程问题。在工程方面的先前经验将很有用，但不是必需的。

如果你刚开始学习如何编写 Kotlin 代码，正在从 Android 开发扩展到后端技术，或者是从编写 Java 代码过渡过来，你会发现这本书很有用。

如果你是一位对讨论和探索独特架构思想感兴趣的软件架构师，这本书适合你。

# 本书涵盖内容

*第一章*，*软件架构的本质*，重新审视了软件架构的重要性以及软件架构师在组织中的作用。它涵盖了组织的结构如何影响架构决策。然后讨论了选择框架以及在此过程中需要考虑的因素。介绍了几个行业标准文档和图表，这些将在后续章节中用于说明。

*第二章*，*软件架构原则*，探讨了多种可视化和量化软件架构的方法，提取质量属性以进行测量和分析。然后深入探讨了三个关键概念：关注点的分离、内聚性和耦合性。还涵盖了流行的架构原则，如 SOLID、迪米特法则、YAGNI 和面向未来。这些原则为后续章节中架构风格的进一步探索奠定了基础。

*第三章*，*多态性和替代方案*，通过一个现实生活中的问题，并使用 Kotlin 代码的多种风格来解决它。它从一个多态解决方案开始，然后探讨了涉及 Kotlin 封闭类的两种解决方案。接下来，展示了使用代理的解决方案，然后是函数式方法。最后，基于系统质量属性比较了所有方法。

*第四章*，*对等网络和客户端-服务器架构*，专注于分布式系统中的网络通信。它包括使用 OpenAPI 规范和 Http4K 框架在 Kotlin 中以 API 首先的方法实现客户端-服务器解决方案的逐步指南。然后，本章实现了相同问题的对等网络解决方案，并比较了两种方法，讨论了在不同情况下哪种更适合。

*第五章*，*探索 MVC、MVP 和 MVVM*，将重点转向前端应用程序。使用一个示例 Android 应用程序，我们将 MVC、MVP 和 MVVM 应用到不同的架构风格中，以观察实现方式的演变。本章比较了这三种模式以及其他常用风格。

*第六章*，*微服务、无服务器和微前端*，将重点转向后端。本章展示了单体应用程序和面向服务的架构如何演变成微服务和纳米服务。它解释了无服务器架构如何通过云服务提供商的服务影响现代软件系统。最后，讨论了微服务的客户端对应物，即微前端。

*第七章*，*模块化和分层架构*，从三个具有相似性和差异性的分层架构——清洁架构、六边形架构和功能核心强制外壳——开始。它们使用 Kotlin 代码针对相同现实生活中的问题进行演示和比较。随后，本章探讨了连接模式，提供了一种模块化方法来与远程系统集成。

*第八章*，*领域驱动设计（DDD）*，深入探讨了 DDD 设计活动。它从基本概念和术语开始，然后通过战略设计来看待领域的整体情况。为战术设计选择了一个边界上下文。本章还通过一个现实生活中的例子，逐步介绍了三个流行的领域建模活动。

*第九章*，*事件溯源和 CQRS*，将上一章中的 DDD 实践扩展到两种强大的架构模式。它首先通过一个现实生活中的例子说明了事件溯源的使用，然后解释了如何应用 CQRS。最后，将事件溯源和 CQRS 结合起来作为解决相同问题的方案，以释放这两种架构风格的可能性。

*第十章*，*幂等性、复制和恢复模型*，讨论了三个相关的架构概念。它从分布式系统中的幂等性开始，提供了如何实现它的实际示例。接下来，使用 CAP 定理探讨了和比较了几种复制模型。本章以使用 RAFT 领导选举作为案例研究的系统恢复结束。

*第十一章*，*审计和监控模型*，展示了在 Kotlin 中可以由多个服务使用但集中记录的示例审计跟踪结构。它还讨论了各种监控数据格式和用于监控目的的数据收集方法。本章涵盖了 Kotlin 代码的结构化和上下文日志，以及自动警报、事件管理和指标。

*第十二章*，*性能和可伸缩性*，专注于使用定义的指标来衡量性能。它通过基本方法和微基准测试展示了性能测试。本章在讨论使用 Kotlin 代码进行性能改进的策略的同时，指导你通过性能测试工作流程。此外，使用投票系统来说明提高性能和扩展系统的过程。

*第十三章*，*测试*，探讨了质量保证的作用。它检查了测试金字塔内的各种测试方法，并强调了每种类型的最佳实践。本章包括使用 Kotest 框架的测试驱动开发（TDD）练习的逐步旅程。

*第十四章*，*安全*，专注于保护软件系统和其数据免受恶意攻击。它从使用传输层安全性（TLS）来保护网络通信开始。然后，本章涵盖了多因素认证（MFA）用于用户身份验证。它还讨论了常见的授权和数据权限方法，隐藏和匿名化敏感数据的技术，以及各种网络安全方法。本章以 DevSecOps 和威胁建模练习的讨论结束。

*第十五章*，*超越架构*，涵盖了软件架构之外的多个工程主题。首先，它探讨了几个 Kotlin 语言特性，这些特性有助于工程师实现更好的代码质量和软件架构。接下来，它讨论了在 IDE 功能的帮助下从 Java 到 Kotlin 的过渡。本章比较了两种 CI 方法：基于功能和基于主干开发。然后，它涵盖了发布策略，简要提及开发者体验，并以软件架构当前趋势的审视作为结尾。

# 为了充分利用本书

*以开放的心态和愿意实验的态度来学习材料至关重要。首先，回顾前两章中介绍的基础概念，因为它们是更高级主题的基石。参与动手示例和编码练习，这些练习旨在将您的理解转化为实际应用。思考每种架构风格如何满足您项目的需求。此外，考虑探索外部资源以进一步丰富您的*学习体验*。*

| **本书涵盖的软件** | **操作系统要求** |
| --- | --- |
| IntelliJ IDEA（社区版或终极版） | Windows, macOS, 或 Linux |
| Android Studio | Windows, macOS, Linux 或 ChromeOS |
| OpenJDK 17+ | Windows, macOS, 或 Linux |
| Git CLI 工具 | Windows, macOS, 或 Linux |

*您需要配置 IntelliJ 和 Android Studio 以使用已安装的 JDK 和 Git** *命令行工具**。*

**如果您使用的是本书的数字版，我们建议您亲自输入代码或从本书的 GitHub 仓库（下一节中提供链接）获取代码。这样做将有助于避免与代码复制和粘贴相关的任何潜在错误。**

*阅读完本书后，我建议您开始一个新的项目，尝试解决乡村家庭交换服务的真实案例问题，或者解决您非常了解的问题，例如您日常生活中的问题或工作中的问题。同时，应用架构风格，用您对问题的了解来分析它们，并探索书中提到的框架。解决一个理解透彻的问题有助于我们专注于解决非功能性问题和*动手编码*。*

# 下载示例代码文件

您可以从 GitHub（[`github.com/PacktPublishing/Software-Architecture-with-Kotlin`](https://github.com/PacktPublishing/Software-Architecture-with-Kotlin)）下载本书的示例代码文件。如果代码有更新，它将在 GitHub 仓库中更新。

我们还提供了其他丰富的书籍和视频中的代码块，可在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。查看它们吧！

# 使用的约定

本书使用了多种文本约定。

`文本中的代码`：表示文本中的代码词汇、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。以下是一个示例：“`Person`类直接访问`Address`类内部的`city`属性。”

代码块设置如下：

```kt
class Person(val name: String, val address: Address) {
    fun getAddressCity(): String {
        return address.city
    }
}
class Address(val city: String)
```

**粗体**：表示新术语、重要词汇或屏幕上看到的词汇。例如，菜单或对话框中的词汇以**粗体**显示。以下是一个示例：“**商业**包使用**持久性**包来执行服务合同和家庭的实际关系型数据库操作。”

提示或重要注意事项

它看起来像这样。

# 联系我们

我们始终欢迎读者的反馈。

**一般反馈**：如果您对本书的任何方面有疑问，请通过电子邮件发送给我们，邮箱地址为[customercare@packtpub.com](https://customercare@packtpub.com)，并在邮件主题中提及书名。

**勘误**：尽管我们已经尽一切努力确保内容的准确性，但错误仍然可能发生。如果您在这本书中发现了错误，我们将不胜感激，如果您能向我们报告，我们将非常感谢。请访问[www.packtpub.com/support/errata](https://www.packtpub.com/support/errata)并填写表格。

**盗版**：如果您在互联网上以任何形式遇到我们作品的非法副本，我们将不胜感激，如果您能提供位置地址或网站名称，我们将非常感谢。请通过[copyright@packt.com](https://copyright@packt.com)与我们联系，并提供材料的链接。

**如果您有兴趣成为作者**：如果您在某个主题上具有专业知识，并且您有兴趣撰写或为书籍做出贡献，请访问[authors.packtpub.com](https://authors.packtpub.com)。

# 分享您的想法

一旦您阅读了《使用 Kotlin 的软件架构》，我们非常乐意听到您的想法！请[点击此处直接访问此书的亚马逊评论页面](https://packt.link/r/1835461867)并分享您的反馈。

您的评论对我们和科技社区都非常重要，它将帮助我们确保我们提供高质量的内容。

# 下载此书的免费 PDF 副本

感谢您购买此书！

您喜欢在路上阅读，但无法携带您的印刷书籍到处走吗？

您的电子书购买是否与您选择的设备不兼容？

不要担心，现在，随着每本 Packt 书籍，您都可以免费获得该书的 DRM 免费 PDF 版本。

在任何地方、任何设备上阅读。直接从您最喜欢的技术书籍中搜索、复制和粘贴代码到您的应用程序中。

优惠不仅限于此，您还可以获得独家折扣、时事通讯和每天收件箱中的优质免费内容。

按照以下简单步骤获取优惠：

1.  扫描下面的二维码或访问以下链接

![](img/B21737_QR_Free_PDF.jpg)

[`packt.link/free-ebook/978-1-83546-186-0`](https://packt.link/free-ebook/978-1-83546-186-0)

1.  提交您的购买证明

1.  就这样！我们将直接将您的免费 PDF 和其他优惠发送到您的电子邮件。
