<html><head></head><body>
<div><div><h1 class="chapterNumber">5</h1>
<h1 class="chapterTitle" id="_idParaDest-142">Navigation Using .NET MAUI Shell and NavigationPage</h1>
<p class="normal">In the preceding chapters, we’ve tackled <strong class="keyWord">user interface</strong> (<strong class="keyWord">UI</strong>) design, the MVVM pattern, and data binding. These elements allow us to devise UIs at the page level. For real-world applications, the ability to navigate between pages is crucial. Consequently, most application frameworks include their own distinct navigation mechanisms, .NET MAUI being no exception. In this chapter, we’ll introduce the navigation mechanisms in .NET MAUI. We’ll start by demonstrating how to accomplish the most basic navigation using NavigationPage, then we’ll delve into a more structured navigation mechanism – <code class="inlineCode">Shell</code>.</p>
<p class="normal">Subsequently, we’ll enhance the navigation capabilities of our application with <code class="inlineCode">Shell</code>. In <em class="chapterRef">Chapter 2</em>, <em class="italic">Building Our First .NET MAUI App</em>, we created our app using a <code class="inlineCode">Shell</code> template. Despite this, our app has not yet reached the complexity required for multi-level navigation. With the integration of <code class="inlineCode">Shell</code>, we’ll execute multi-level navigation. In order to facilitate this, it’s necessary to refine our model to support the navigation implementation. By the end of this chapter, our application will be able to support login, the selection of a page from the flyout menu, and switching to the item details or navigation to a child group. After delving deeper into the navigation design, we’ll gain an understanding of how navigation functions within .NET MAUI.</p>
<p class="normal">The following topics will be covered in this chapter:</p>
<ul>
<li class="bulletList">Implementing navigation</li>
<li class="bulletList">Using <code class="inlineCode">Shell</code></li>
<li class="bulletList">Improving design and navigation</li>
</ul>
<h1 class="heading-1" id="_idParaDest-143">Technical requirements</h1>
<p class="normal">To test and debug the source code in this chapter, you need to have Visual Studio 2022 installed on your PC or Mac. Please refer to the <em class="italic">Development environment setup</em> section in <em class="chapterRef">Chapter 1</em>, <em class="italic">Getting Started with .NET MAUI</em>, for the details.</p>
<p class="normal">The source code for this chapter is available in the following branch on GitHub: <a href="https://github.com/PacktPublishing/.NET-MAUI-Cross-Platform-Application-Development-Second-edition/tree/3e70eadfc910ef454ba068dc2bceb6b8e3437678">https://github.com/PacktPublishing/.NET-MAUI-Cross-Platform-Application-Development-Second-edition/tree/main/2nd/chapter05</a>.</p>
<p class="normal">To check out the source code of this chapter, we can use the following command:</p>
<pre class="programlisting con"><code class="hljs-con">$ git clone -b 2nd/chapter05 https://github.com/PacktPublishing/.NET-MAUI-Cross-Platform-Application-Development-Second-edition.git PassXYZ.Vault2
</code></pre>
<p class="normal">To find out more about the source code in this book, please refer to the <em class="italic">Managing the source code in this book</em> section in <em class="chapterRef">Chapter 2</em>, <em class="italic">Building Our First .NET MAUI App</em>.</p>
<h1 class="heading-1" id="_idParaDest-144">Implementing navigation</h1>
<p class="normal">In this chapter, we <a id="_idIndexMarker370"/>are going to implement the navigation logic of our password manager app. This will include the following functionalities:</p>
<ul>
<li class="bulletList">Logging in and connecting to the database</li>
<li class="bulletList">Exploring data in the password database</li>
</ul>
<p class="normal">Navigation design<a id="_idIndexMarker371"/> has a significant impact on user experience. In .NET MAUI, there is a built-in mechanism to help developers implement navigation efficiently. As we saw in the previous chapters, we can use <code class="inlineCode">Shell</code> in our app. In this chapter, we will learn about <code class="inlineCode">Shell</code> and enhance our app with features provided by <code class="inlineCode">Shell</code>. Before we dive into <code class="inlineCode">Shell</code>, we will explore the basic navigation mechanism in .NET MAUI.</p>
<p class="normal">The most common <a id="_idIndexMarker372"/>ways to implement navigation are hierarchial and modal:</p>
<ul>
<li class="bulletList"><strong class="keyWord">Hierarchical navigation</strong> provides <a id="_idIndexMarker373"/>a navigation<a id="_idIndexMarker374"/> experience where the user can navigate through pages, both forward and backward. This pattern typically uses a toolbar or navigation bar at the top of the screen to display an Up or Back button in the top-left corner. It usually maintains a LIFO stack of pages to handle the <a id="_idIndexMarker375"/>navigation. <strong class="keyWord">LIFO</strong> stands for <strong class="keyWord">last in</strong>, <strong class="keyWord">first out</strong>, which means the last page to enter is the first one to <a id="_idIndexMarker376"/>pop out.</li>
<li class="bulletList"><strong class="keyWord">Modal navigation</strong> is <a id="_idIndexMarker377"/>different from hierarchical navigation in terms of how users can respond to it. If a modal page is displayed on the <a id="_idIndexMarker378"/>screen, the users must complete or cancel the required task on the page before they can take other actions. The <a id="_idIndexMarker379"/>users cannot navigate away from modal pages before the required task is completed or canceled.</li>
</ul>
<h2 class="heading-2" id="_idParaDest-145">INavigation interface and NavigationPage</h2>
<p class="normal">In .NET MAUI, both<a id="_idIndexMarker380"/> hierarchical navigation and model navigation are supported through the <code class="inlineCode">INavigation</code> interface. The <code class="inlineCode">INavigation</code> interface is <a id="_idIndexMarker381"/>supported by a special page called <code class="inlineCode">NavigationPage</code>. <code class="inlineCode">NavigationPage</code> is used to manage the navigation of a stack of other pages. The inheritance hierarchy of <code class="inlineCode">NavigationPage</code> looks like this:</p>
<ul>
<li class="bulletList"><strong class="keyWord">Object</strong> | <strong class="keyWord">BindableObject</strong> | <strong class="keyWord">Element</strong> | <strong class="keyWord">NavigableElement</strong> | <strong class="keyWord">VisualElement</strong> | <strong class="keyWord">Page</strong> | <strong class="keyWord">NavigationPage</strong></li>
</ul>
<p class="normal"><code class="inlineCode">NavigableElement</code> defines<a id="_idIndexMarker382"/> a property called <code class="inlineCode">Navigation</code> that implements the <code class="inlineCode">INavigation</code> interface. This inherited property can be called from any <code class="inlineCode">VisualElement</code> or <code class="inlineCode">Page</code> for navigation purposes, as shown here:</p>
<pre class="programlisting code"><code class="hljs-code">public Microsoft.Maui.Controls.INavigation Navigation { get; }
</code></pre>
<p class="normal">To <a id="_idIndexMarker383"/>use <code class="inlineCode">NavigationPage</code>, we <a id="_idIndexMarker384"/>must add the first page to a navigation stack as the root page of the application. We can see an example of this in the following code snippet:</p>
<pre class="programlisting code"><code class="hljs-code">public partial class App : Application
{
  ...
  public App ()
  {
    InitializeComponent();
    MainPage = new NavigationPage (new TheFirstPage());
  }
  ...
}
</code></pre>
<p class="normal">We build the <a id="_idIndexMarker385"/>navigation stack in the constructor of the <code class="inlineCode">App</code> class, which is a derived class of <code class="inlineCode">Application</code>. <code class="inlineCode">TheFirstPage</code>, which is a derived class of <code class="inlineCode">ContentPage</code>, is pushed onto the navigation stack.</p>
<h2 class="heading-2" id="_idParaDest-146">Using the navigation stack</h2>
<p class="normal">There are<a id="_idIndexMarker386"/> two ways to navigate to or from a page. When we <a id="_idIndexMarker387"/>want to browse a new page, we can add the new page to the navigation stack. This action is called a <strong class="keyWord">push</strong>. If we want to go back to the previous<a id="_idIndexMarker388"/> page, we<a id="_idIndexMarker389"/> can <strong class="keyWord">pop</strong> the previous page from the stack:</p>
<figure class="mediaobject"><img alt="Figure 5.1: Push and pop " height="383" src="img/B21554_05_01.png" width="825"/></figure>
<p class="packt_figref">Figure 5.1: Push and pop</p>
<p class="normal">As shown in <em class="italic">Figure 5.1</em>, we can use the <code class="inlineCode">PushAsync()</code> or <code class="inlineCode">PopAsync()</code> method in the <code class="inlineCode">INavigation</code> interface to change to a new page or go back to the previous page, respectively.</p>
<p class="normal">If we are on <strong class="screenText">Page1</strong>, we can change to <strong class="screenText">Page2</strong> with the <code class="inlineCode">GotoPage2()</code> event handler. In this function, we are pushing the new page, <strong class="screenText">Page2</strong>, to the stack:</p>
<pre class="programlisting code"><code class="hljs-code">async void GotoPage2 (object sender, EventArgs e) {
         await Navigation.PushAsync(new Page2());
}
</code></pre>
<p class="normal">Once we are on <strong class="screenText">Page2</strong>, we can go back with the <code class="inlineCode">BackToPage1()</code> event handler. In this function, we <a id="_idIndexMarker390"/>are popping the previous page from the stack:</p>
<pre class="programlisting code"><code class="hljs-code">async void BackToPage1 (object sender, EventArgs e) {
        await Navigation.PopAsync();
}
</code></pre>
<p class="normal">In the<a id="_idIndexMarker391"/> preceding example, we navigated to a new page using the hierarchical navigation method. To display a modal page, we can use the modal stack. For example, in our app, if we want to create a new item in <code class="inlineCode">ItemsPage</code>, we can call <code class="inlineCode">PushModalAsync()</code> in <code class="inlineCode">ItemsViewModel</code>:</p>
<pre class="programlisting code"><code class="hljs-code">await Shell.Current.Navigation.PushModalAsync(NewItemPage(type));
</code></pre>
<p class="normal">After the new item has been created, we can call <code class="inlineCode">PopModalAsync()</code> in <code class="inlineCode">NewItemViewModel</code> to dismiss the modal page:</p>
<pre class="programlisting code"><code class="hljs-code">_ = await Shell.Current.Navigation.PopModalAsync();
</code></pre>
<p class="normal">On the <code class="inlineCode">NewItemPage</code> model page, we cannot navigate to other pages before we complete or cancel the task. Both <code class="inlineCode">PopAsync()</code> and <code class="inlineCode">PopModalAsync()</code> return an awaitable task of the <code class="inlineCode">Task&lt;Page&gt;</code> type.</p>
<p class="normal">To find more information about NavigationPage, please refer to the following Microsoft document:</p>
<p class="normal"><a href="https://learn.microsoft.com/en-us/dotnet/maui/user-interface/pages/navigationpage">https://learn.microsoft.com/en-us/dotnet/maui/user-interface/pages/navigationpage</a></p>
<h2 class="heading-2" id="_idParaDest-147">Manipulating the navigation stack</h2>
<p class="normal">In <a id="_idIndexMarker392"/>hierarchical navigation, we can not only push <a id="_idIndexMarker393"/>or pop pages from the stack, but we can also manipulate the navigation stack.</p>
<h3 class="heading-3" id="_idParaDest-148">Inserting a page</h3>
<p class="normal">We can insert a page <a id="_idIndexMarker394"/>into the stack using the <code class="inlineCode">InsertPageBefore</code> method:</p>
<pre class="programlisting code"><code class="hljs-code">public void InsertPageBefore (Page page, Page before);
</code></pre>
<p class="normal">The <code class="inlineCode">InsertPageBefore</code> method<a id="_idIndexMarker395"/> requires two parameters:</p>
<ul>
<li class="bulletList"><code class="inlineCode">page</code>: This is the page to be added.</li>
<li class="bulletList"><code class="inlineCode">before</code>: This is the page before which the page is inserted.</li>
</ul>
<p class="normal">In <em class="italic">Figure 5.1</em>, when we are at <strong class="screenText">Page2</strong>, we can insert another page, <strong class="screenText">Page1</strong>, before it:</p>
<pre class="programlisting code"><code class="hljs-code">Navigation.InsertPageBefore(new Page1(), this);
</code></pre>
<h3 class="heading-3" id="_idParaDest-149">Removing a page</h3>
<p class="normal">We can<a id="_idIndexMarker396"/> also remove a specific page from the stack using the <code class="inlineCode">RemovePage()</code> method:</p>
<pre class="programlisting code"><code class="hljs-code">public void RemovePage (Page page);
</code></pre>
<p class="normal">In <em class="italic">Figure 5.1</em>, given we have a reference of <strong class="screenText">Page2</strong> when we are at <strong class="screenText">Page3</strong>, we can remove <strong class="screenText">Page2</strong> from the stack. After <code class="inlineCode">PopAsync()</code> is called, we will be back at <strong class="screenText">Page1</strong>:</p>
<pre class="programlisting code"><code class="hljs-code">// the reference page2 is an instance of Page2
Navigation.RemovePage(page2);
await Navigation.PopAsync();
</code></pre>
<p class="normal">In conclusion, we have learned how to build a navigation stack using <code class="inlineCode">NavigationPage</code>. Upon creating a navigation stack, we can utilize the <code class="inlineCode">INavigation</code> interface to execute navigation actions. For a simple application, this method may suffice. However, for more complex applications, this approach can involve a significant amount of work. Fortunately, .NET MAUI offers a structured alternative called <code class="inlineCode">Shell</code>. <code class="inlineCode">Shell</code> is designed to improve the navigation structure of your applications by providing a unified, declarative syntax for defining the flyout menu, tab bars, and other navigational UIs. Utilizing <code class="inlineCode">Shell</code> allows us to deliver an enhanced navigation experience to users with significantly less effort.</p>
<h1 class="heading-1" id="_idParaDest-150">Using Shell</h1>
<p class="normal">The <code class="inlineCode">INavigation</code> interface <a id="_idIndexMarker397"/>and <code class="inlineCode">NavigationPage</code> offer basic navigation functionality. Relying solely on them would require us to create complex navigation mechanisms by ourselves. Fortunately, .NET MAUI provides built-in page templates to choose from, which can deliver various navigation experiences.</p>
<p class="normal">As shown in the<a id="_idIndexMarker398"/> class diagram in <em class="italic">Figure 5.2</em>, there are built-in pages available for different use cases. All these pages – <code class="inlineCode">TabbedPage</code>, <code class="inlineCode">ContentPage</code>, <code class="inlineCode">FlyoutPage</code>, <code class="inlineCode">NavigationPage</code>, and <code class="inlineCode">Shell</code> – are derived classes of <code class="inlineCode">Page</code>:</p>
<figure class="mediaobject"><img alt="Figure 5.2: Class diagram of the built-in pages in .NET MAUI " height="568" src="img/B21554_05_02.png" width="741"/></figure>
<p class="packt_figref">Figure 5.2: Class diagram of the built-in pages in .NET MAUI</p>
<p class="normal"><code class="inlineCode">ContentPage</code>, <code class="inlineCode">TabbedPage</code>, and <code class="inlineCode">FlyoutPage</code> can be used to create various UIs per your requirements:</p>
<ul>
<li class="bulletList"><code class="inlineCode">ContentPage</code> is the<a id="_idIndexMarker399"/> most commonly used page type and can include any layout and view elements. It is suitable for single-page designs.</li>
<li class="bulletList"><code class="inlineCode">TabbedPage</code> can<a id="_idIndexMarker400"/> be used to host multiple pages. Each child page can be selected by a series of tabs, located at either the top or bottom of the page.</li>
<li class="bulletList"><code class="inlineCode">FlyoutPage</code> can display a list of items, similar to menu items in a desktop application. Users<a id="_idIndexMarker401"/> can navigate to individual pages through the items in the menu.</li>
</ul>
<p class="normal">Although <code class="inlineCode">Shell</code> is also a<a id="_idIndexMarker402"/> derived class of <code class="inlineCode">Page</code>, it includes a common navigation user experience that simplifies developers’ tasks. <code class="inlineCode">Shell</code> assists developers by reducing the complexity of application development and consolidating highly customizable, rich features in one location.</p>
<p class="normal"><code class="inlineCode">Shell</code> provides the following <a id="_idIndexMarker403"/>features:</p>
<ul>
<li class="bulletList">A single place to describe the visual hierarchy of an app</li>
<li class="bulletList">A highly customizable common navigation user experience</li>
<li class="bulletList">A URI-based navigation scheme that is very similar to what we have in a web browser</li>
<li class="bulletList">An integrated search handler</li>
</ul>
<p class="normal">The top-level building blocks of <code class="inlineCode">Shell</code> are flyouts and tabs. We can use flyouts and tabs to create the navigation structure of our app.</p>
<h2 class="heading-2" id="_idParaDest-151">Flyout</h2>
<p class="normal">A flyout can <a id="_idIndexMarker404"/>be used as the top-level menu of a <code class="inlineCode">Shell</code> app. In our app, we must use<a id="_idIndexMarker405"/> both flyouts and tabs to create the top-level navigation design. In this section, we will explore flyouts; in the next section, we will discuss using tabs in our app.</p>
<p class="normal">In <em class="italic">Figure 5.3</em>, we can see what the flyout looks like in our app. From the flyout menu, we can switch to the <code class="inlineCode">AboutPage</code>, <code class="inlineCode">ItemsPage</code>, or <code class="inlineCode">LoginPage</code>. To access the flyout menu, we can either swipe from the left edge of the screen or click the flyout icon, which is the hamburger icon <strong class="keyWord">(1)</strong>. When we click the <strong class="keyWord">Root Group</strong> <strong class="keyWord">(2)</strong> in the flyout menu, we will see a list of password entries or groups.</p>
<figure class="mediaobject"><img alt="" height="597" src="img/B21554_05_03.png" width="825"/></figure>
<p class="packt_figref">Figure 5.3: Flyout</p>
<p class="normal">The flyout menu<a id="_idIndexMarker406"/> consists of flyout items or menu items. In <em class="italic">Figure 5.3</em>, <strong class="screenText">About</strong> and <strong class="screenText">Root</strong><strong class="keyWord"> </strong><strong class="screenText">Group</strong> are flyout items, while <strong class="screenText">Logout</strong> is a menu item.</p>
<h3 class="heading-3" id="_idParaDest-152">Flyout items</h3>
<p class="normal">Each <a id="_idIndexMarker407"/>flyout item is a <code class="inlineCode">FlyoutItem</code> object that contains a <code class="inlineCode">ShellContent</code> object. We can define flyout items like so in the <code class="inlineCode">AppShell.xaml</code> file. We assign a <code class="inlineCode">string</code> resource to the <code class="inlineCode">Title</code> attribute <strong class="keyWord">(1)</strong> and an <code class="inlineCode">ImageSource</code> to the <code class="inlineCode">Icon</code> attribute <strong class="keyWord">(2)</strong>. These correspond to the properties of the <code class="inlineCode">FlyoutItem</code> class:</p>
<pre class="programlisting code"><code class="hljs-code">&lt;FlyoutItem
  Title="{x:Static resources:Resources.About}"                    //(1)
  Icon="tab_info.png" &gt;                                           //(2)
  &lt;Tab&gt;
    &lt;ShellContent Route="AboutPage" ContentTemplate=
        "{DataTemplate local:AboutPage}" /&gt;
  &lt;/Tab&gt;
&lt;/FlyoutItem&gt;
&lt;FlyoutItem x:Name="RootItem" Title="Browse"
    Icon="tab_home.png"&gt;
  &lt;Tab&gt;
    &lt;ShellContent Route="RootPage" ContentTemplate=
        "{DataTemplate local:ItemsPage}" /&gt;
  &lt;/Tab&gt;
&lt;/FlyoutItem&gt;
</code></pre>
<p class="normal"><code class="inlineCode">Shell</code> has implicit<a id="_idIndexMarker408"/> conversion operators that can be used to remove the <code class="inlineCode">FlyoutItem</code> and <code class="inlineCode">Tab</code> objects so that the preceding XAML code can also be simplified, like so:</p>
<pre class="programlisting code"><code class="hljs-code">&lt;ShellContent Title="{x:Static resources:Resources.About}"  
  Icon="tab_info.png" Route="AboutPage" 
  ContentTemplate="{DataTemplate local:AboutPage}" /&gt;
&lt;ShellContent x:Name="RootItem" Title="Browse" 
  Icon="tab_home.png" Route="RootPage"  
  ContentTemplate="{DataTemplate local:ItemsPage}" /&gt;
</code></pre>
<h3 class="heading-3" id="_idParaDest-153">Menu items</h3>
<p class="normal">In some <a id="_idIndexMarker409"/>instances, using flyout items for navigation to a content page might not be necessary; instead, we may desire to perform an action. In such cases, menu items can be utilized. For our scenario, we have designated <code class="inlineCode">Logout</code> as a menu item to execute an action rather than navigating to another content page:</p>
<pre class="programlisting code"><code class="hljs-code">&lt;MenuItem Text="Logout" IconImageSource="tab_login.png"
    Clicked="OnMenuItemClicked"&gt;
&lt;/MenuItem&gt;
</code></pre>
<p class="normal">As we can see from the preceding XAML code, each menu item is a <code class="inlineCode">MenuItem</code> object. The <code class="inlineCode">MenuItem</code> class has a <code class="inlineCode">Clicked</code> event and a <code class="inlineCode">Command</code> property. When <code class="inlineCode">MenuItem</code> is tapped, we can execute an action. In the preceding menu item, we assigned <code class="inlineCode">OnMenuItemClicked</code> as the event handler.</p>
<p class="normal">Let’s take a closer look at <code class="inlineCode">AppShell.xaml</code>, as shown in <em class="italic">Listing 5.1</em>. In this file, we have defined two flyout items and one menu item. The flyout items allow us to select the <code class="inlineCode">AboutPage</code> <strong class="keyWord">(1)</strong> and <code class="inlineCode">ItemsPage</code> <strong class="keyWord">(2)</strong>, while the menu item enables us to log out <strong class="keyWord">(3)</strong>.</p>
<pre class="programlisting code"><code class="hljs-code">&lt;Shell 
  xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
  ...
  Title="PassXYZ.Vault"
  x:Class="PassXYZ.Vault.AppShell" 
  FlyoutIcon="{FontImage FontFamily=FontAwesomeSolid, 
  Color=White, 
  Glyph={x:Static style:FontAwesomeSolid.Bars}}"
  FlyoutBackgroundColor="{StaticResource Secondary}"&gt;
  &lt;TabBar&gt;                                                       //(4)
    &lt;ShellContent Title="Login" Route="LoginPage" 
      Icon="{FontImage FontFamily=FontAwesomeSolid, 
      Color=Black,
      Glyph={x:Static style:FontAwesomeSolid.UserAlt}}"
      ContentTemplate="{DataTemplate local:LoginPage}" /&gt;
    &lt;ShellContent Title="SignUp" Route="SignUpPage" 
      Icon="{FontImage FontFamily=FontAwesomeSolid, 
      Color=Black,
      Glyph={x:Static style:FontAwesomeSolid.Users}}"
      ContentTemplate="{DataTemplate local:SignUpPage}" /&gt;
  &lt;/TabBar&gt;
  &lt;FlyoutItem Title="About"                                      //(1)
    Icon="{FontImage FontFamily=FontAwesomeSolid, Color=Black,
    Glyph={x:Static style:FontAwesomeSolid.Question}}"&gt;
    &lt;ShellContent Route="AboutPage" 
      ContentTemplate="{DataTemplate local:AboutPage}"&gt;
    &lt;/ShellContent&gt;
  &lt;/FlyoutItem&gt;
  
  &lt;FlyoutItem x:Name="RootItem" Title="Browse"                   //(2)
    Icon="{FontImage FontFamily=FontAwesomeSolid, Color=Black, 
    Glyph={x:Static style:FontAwesomeSolid.Home}}"&gt;
    &lt;ShellContent Route="RootPage" 
      ContentTemplate="{DataTemplate local:ItemsPage}"&gt;
    &lt;/ShellContent&gt;
  &lt;/FlyoutItem&gt;
  &lt;MenuItem Text="Logout" Clicked="OnMenuItemClicked"            //(3)
    IconImageSource="{FontImage FontFamily=FontAwesomeSolid, 
    Color=Black, 
    Glyph={x:Static style:FontAwesomeSolid.SignOutAlt}}"&gt;
  &lt;/MenuItem&gt;
&lt;/Shell&gt;
</code></pre>
<p class="packt_figref">Listing 5.1: <code class="inlineCode">AppShell.xaml</code> in PassXYZ.Vault (<a href="https://epa.ms/AppShell5-1">https://epa.ms/AppShell5-1</a>)</p>
<p class="normal">There is <a id="_idIndexMarker410"/>also a <code class="inlineCode">TabBar</code> <strong class="keyWord">(4)</strong> defined for <code class="inlineCode">LoginPage</code> and <code class="inlineCode">SignUpPage</code>. Let’s review tabs now.</p>
<h2 class="heading-2" id="_idParaDest-154">Tabs</h2>
<p class="normal">Utilizing tabs <a id="_idIndexMarker411"/>in <code class="inlineCode">Shell</code> enables the creation of a navigation experience akin to<a id="_idIndexMarker412"/> that of <code class="inlineCode">TabbedPage</code>. As depicted in <em class="italic">Figure 5.4</em>, both Android and iOS platforms feature two tabs on the bottom tab bar. However, the appearance of the tabs differs when implemented on the Windows platform.</p>
<figure class="mediaobject"><img alt="" height="837" src="img/B21554_05_04.png" width="825"/></figure>
<p class="packt_figref">Figure 5.4: Tab bar and tabs on Android</p>
<p class="normal">As we<a id="_idIndexMarker413"/> can <a id="_idIndexMarker414"/>see in <em class="italic">Figure 5.5</em>, on Windows, the tab bar is at the top:</p>
<figure class="mediaobject"><img alt="" height="556" src="img/B21554_05_05.png" width="825"/></figure>
<p class="packt_figref">Figure 5.5: Tab bar and tabs on Windows</p>
<p class="normal">In order to <a id="_idIndexMarker415"/>incorporate tabs into our app, we need to create a <code class="inlineCode">TabBar</code> object. This <code class="inlineCode">TabBar</code> object can comprise one or more <code class="inlineCode">Tab</code> objects, with each <code class="inlineCode">Tab</code> object representing an<a id="_idIndexMarker416"/> individual tab on the tab bar. Additionally, each <code class="inlineCode">Tab</code> object can encompass one or more <code class="inlineCode">ShellContent</code> objects. The subsequent XAML code demonstrates its similarity to the code used when defining a flyout:</p>
<pre class="programlisting code"><code class="hljs-code">&lt;TabBar&gt;
  &lt;Tab Title="{x:Static resources:Resources.action_id_login}" 
    Icon="tab_login.png"&gt;
    &lt;ShellContent Route="LoginPage" 
    ContentTemplate="{DataTemplate local:LoginPage}" /&gt;
  &lt;/Tab&gt;
  &lt;Tab Title="{x:Static resources:Resources.menu_id_users}"
    Icon="tab_users.png"&gt;
    &lt;ShellContent Route="SignUpPage" 
    ContentTemplate="{DataTemplate local:SignUpPage}" /&gt;
  &lt;/Tab&gt;
&lt;/TabBar&gt;
</code></pre>
<p class="normal">Similar to the approach we took in the flyout XAML code, we can simplify the previous code by eliminating the <code class="inlineCode">Tab</code> tags. By utilizing the implicit conversion operators of <code class="inlineCode">Shell</code>, we can remove the <code class="inlineCode">Tab</code> objects. As demonstrated, it is possible to omit the <code class="inlineCode">Tab</code> tags and directly <a id="_idIndexMarker417"/>define the <code class="inlineCode">Title</code> and <code class="inlineCode">Icon</code> attributes within the <code class="inlineCode">ShellContent</code> tags:</p>
<pre class="programlisting code"><code class="hljs-code">&lt;TabBar&gt;
  &lt;ShellContent Title="{x:Static resources:Resources.action_id_login}" 
                Icon="tab_login.png"
                Route="LoginPage" 
                ContentTemplate="{DataTemplate local:LoginPage}" /&gt;
  &lt;ShellContent Title="{x:Static resources:Resources.menu_id_users}" 
                Icon="tab_users.png"
                Route="SignUpPage" 
                ContentTemplate="{DataTemplate local:SignUpPage}" /&gt;
&lt;/TabBar&gt;
</code></pre>
<p class="normal">In a situation where<a id="_idIndexMarker418"/> we define both <code class="inlineCode">TabBar</code> objects and <code class="inlineCode">FlyoutItem</code> objects in <code class="inlineCode">AppShell.xaml</code>, the <code class="inlineCode">TabBar</code> objects will disable the flyout items. This is why, upon launching our app, we are presented with a tabbed screen displaying either the login or signup pages. Once the user successfully logs in, we can navigate them to the <code class="inlineCode">RootPage</code>, which is the registered route illustrated in <em class="italic">Listing 5.1</em>. In the following section, we will delve into the process of registering routes and navigating using these registered routes.</p>
<h2 class="heading-2" id="_idParaDest-155">Shell navigation</h2>
<p class="normal">In <code class="inlineCode">Shell</code>, navigating <a id="_idIndexMarker419"/>to pages is achieved through registered routes. Similar to a web browser, .NET MAUI uses URI-based navigation. The URI might look something like the following:</p>
<pre class="programlisting code"><code class="hljs-code">//RootPage/ItemDetailPage?ID="your entry ID"
</code></pre>
<p class="normal">Or, it might look like the following: </p>
<pre class="programlisting code"><code class="hljs-code">Group1/ItemDetailPage1
</code></pre>
<p class="normal">As you can see, the URI format allows us to specify the path within the application interface and potentially, include additional parameters. Beginning the URI with a double slash “//” signifies the root of navigation. Just like in file system navigation, we can also utilize “..” to execute backward navigation. This way, programmers can navigate the navigation stack in a way that’s both intuitive and efficient.</p>
<p class="normal">There are two methods for registering routes. The first method involves registering routes within Shell’s visual hierarchy. The second method requires explicitly registering them by utilizing the <code class="inlineCode">RegisterRoute</code> static method found in the <code class="inlineCode">Routing</code> class.</p>
<h3 class="heading-3" id="_idParaDest-156">Registering absolute routes</h3>
<p class="normal">We have<a id="_idIndexMarker420"/> the option to register routes in Shell’s visual hierarchy, as demonstrated in <em class="italic">Listing 5.1</em>. Routes can be specified through the <code class="inlineCode">Route</code> property of <code class="inlineCode">FlyoutItem</code>, <code class="inlineCode">TabBar</code>, <code class="inlineCode">Tab</code>, or <code class="inlineCode">ShellContent</code>.</p>
<p class="normal">In the <code class="inlineCode">AppShell.xaml</code> file, we registered the following routes.</p>
<table class="table-container" id="table001-4">
<tbody>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord">Route</strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord">Page</strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord">Description</strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode">LoginPage</code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode">LoginPage</code></p>
</td>
<td class="table-cell">
<p class="normal">This route displays a page for user login</p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode">SignUpPage</code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode">SignUpPage</code></p>
</td>
<td class="table-cell">
<p class="normal">This route displays a page for user signup</p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode">AboutPage</code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode">AboutPage</code></p>
</td>
<td class="table-cell">
<p class="normal">This route displays a page about our app</p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode">RootPage</code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode">ItemsPage</code></p>
</td>
<td class="table-cell">
<p class="normal">This route displays a page for navigating the password database</p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref">Table 5.1: Registered routes in the visual hierarchy</p>
<p class="normal">To navigate to a route in Shell’s visual hierarchy, we can use an absolute route URI. The absolute URI starts with a double slash “//”, such as <code class="inlineCode">//LoginPage</code>.</p>
<h3 class="heading-3" id="_idParaDest-157">Registering relative routes</h3>
<p class="normal">It is also<a id="_idIndexMarker421"/> possible to navigate to a page without predefining it in the visual hierarchy. For instance, the password entry detail page, <code class="inlineCode">ItemDetailPage</code>, can be navigated to at any hierarchy level of the password groups. In our app, we can explicitly register the following routes using <code class="inlineCode">RegisterRoute</code> in the code-behind file, <code class="inlineCode">AppShell.xaml.cs</code>:</p>
<pre class="programlisting code"><code class="hljs-code">public static AppShell? CurrentAppShell 
{ get; private set; } = default!;
public AppShell()
{
  InitializeComponent();
  Routing.RegisterRoute(nameof(ItemDetailPage), 
    typeof(ItemDetailPage));
  Routing.RegisterRoute(nameof(NewItemPage), 
    typeof(NewItemPage));
  Routing.RegisterRoute(nameof(ItemsPage), 
    typeof(ItemsPage));
  CurrentAppShell = this;
}
</code></pre>
<p class="normal">In the <a id="_idIndexMarker422"/>preceding code, we defined the following routes.</p>
<table class="table-container" id="table002-2">
<tbody>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord">Route</strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord">Page</strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord">Description</strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode">ItemDetailPage</code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode">ItemDetailPage</code></p>
</td>
<td class="table-cell">
<p class="normal">This is the route to display details about a password entry</p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode">NewItemPage</code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode">NewItemPage</code></p>
</td>
<td class="table-cell">
<p class="normal">This is the route to add a new item (entry or group)</p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode">ItemsPage</code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode">ItemsPage</code></p>
</td>
<td class="table-cell">
<p class="normal">This is the route to display a page for navigating the password database</p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref">Table 5.2: Registered detail page routes</p>
<p class="normal">In order to illustrate the usage of relative routes, we will proceed by adding a new item. When the need arises to add a new item, we can navigate to the <code class="inlineCode">NewItemPage</code> utilizing a relative route, as shown here:</p>
<pre class="programlisting code"><code class="hljs-code">await Shell.Current.GoToAsync(nameof(NewItemPage));
</code></pre>
<p class="normal">In this scenario, the <code class="inlineCode">NewItemPage</code> route is searched, and if the route is identified, the page will be displayed and added to the navigation stack. This navigation stack is the same as the one we discussed while explaining basic navigation using the <code class="inlineCode">INavigation</code> interface. When defining a relative route and navigating to it, we pass a string as the route’s name. To prevent errors, we can use the class name as the route name by employing the <strong class="keyWord">nameof</strong> expression.</p>
<p class="normal">Once we <a id="_idIndexMarker423"/>have entered the details for the new item in the <code class="inlineCode">NewItemPage</code>, we can click either the <strong class="screenText">Save</strong> or <strong class="screenText">Cancel</strong> button. Within the event handler for the <strong class="screenText">Save</strong> or <strong class="screenText">Cancel</strong> button, we can navigate back to the previous page using the code provided:</p>
<pre class="programlisting code"><code class="hljs-code">await Shell.Current.Navigation.PopModalAsync();
</code></pre>
<p class="normal">Alternatively, we can also navigate back using the following code:</p>
<pre class="programlisting code"><code class="hljs-code">await Shell.Current.GoToAsync("..");
</code></pre>
<p class="normal">Just like in file system navigation, here, the “..” represents the parent page in the navigation stack.</p>
<p class="normal">As evident from the code mentioned earlier, there are two methods to navigate back. The first option involves using the <code class="inlineCode">PopModalAsync</code> method of the <code class="inlineCode">INavigation</code> interface. Due to <code class="inlineCode">Shell</code> being a derived class of <code class="inlineCode">Page</code>, it implements the <code class="inlineCode">INavigation</code> interface through the inherited <code class="inlineCode">Navigation</code> property. We can call the <code class="inlineCode">PopModalAsync</code> modal navigation method to go back, with <code class="inlineCode">NewItemPage</code> functioning as a modal page.</p>
<p class="normal">The second method involves utilizing the <code class="inlineCode">GoToAsync</code> function to navigate back. As the <code class="inlineCode">NewItemPage</code> serves as a modal page, you might be curious about how to distinguish between a modal page and a non-modal page when invoking <code class="inlineCode">GoToAsync</code>. In <code class="inlineCode">Shell</code> navigation, this distinction is determined by the page presentation mode. The content page of <code class="inlineCode">NewItemPage</code> is defined as follows:</p>
<pre class="programlisting code"><code class="hljs-code">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ContentPage 
  xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
  xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
  x:Class="PassXYZ.Vault.Views.NewItemPage"
  <strong class="hljs-attr-slc">Shell.PresentationMode</strong>="ModalAnimated"                   //(1)
  Title="New Item"&gt;
  &lt;ContentPage.Content...&gt;
&lt;/ContentPage &gt;
</code></pre>
<p class="normal">As observed, the <code class="inlineCode">Shell.PresentationMode</code> <strong class="keyWord">(1)</strong> property is defined within the content page. Based on our preference for implementing animation, we can assign different values to this property. For a standard content page, we can set it to either <code class="inlineCode">NotAnimated</code> or <code class="inlineCode">Animated</code>. In the case of a modal page, the options are <code class="inlineCode">Modal</code>, <code class="inlineCode">ModalAnimated</code>, or <code class="inlineCode">ModalNotAnimated</code>. If left unchanged, the default value is set to <code class="inlineCode">Animated</code>.</p>
<p class="normal">To navigate<a id="_idIndexMarker424"/> back, the <code class="inlineCode">GoToAsync</code> method is utilized along with the route assigned to “..”. This approach is reminiscent of file system navigation or browser URL navigation. The relative route, “..”, signifies navigating back to the parent route. It can also be combined with a route to access a page at the parent level, as demonstrated here:</p>
<pre class="programlisting code"><code class="hljs-code">await Shell.Current.GoToAsync("../AboutPage");
</code></pre>
<p class="normal">In <em class="italic">Table 5.1</em> and <em class="italic">Table 5.2</em>, you will notice that <code class="inlineCode">ItemsPage</code> is registered as both the absolute route <code class="inlineCode">RootPage</code> and the relative route <code class="inlineCode">ItemsPage</code>. It is important to note that <code class="inlineCode">ItemsPage</code> may encompass password groups at various levels. When positioned at the top level, it serves as an absolute route, whereas at all subsequent navigation hierarchy levels, it functions as a relative route.</p>
<h3 class="heading-3" id="_idParaDest-158">Passing data to pages</h3>
<p class="normal">In order to <a id="_idIndexMarker425"/>elaborate on the reasoning behind registering <code class="inlineCode">ItemsPage</code> with both absolute and relative routes, let’s examine the navigation hierarchy of our app, as depicted in <em class="italic">Figure 5.6</em>.</p>
<figure class="mediaobject"><img alt="" height="572" src="img/B21554_05_06.png" width="826"/></figure>
<p class="packt_figref">Figure 5.6: Navigation hierarchy</p>
<p class="normal">In our app, once<a id="_idIndexMarker426"/> the user successfully logs in, the main page showcases a list of entries and groups situated at the top tier of the password database, referred to as Root Group. This resembles the navigation structure of a file system that displays the top-level files and folders at its root.</p>
<p class="normal">The first instance of <code class="inlineCode">ItemsPage</code> employs the <code class="inlineCode">RootPage</code> route, which can be accessed via the flyout item. Assume there are sub-groups named <strong class="screenText">Group1</strong> and <strong class="screenText">Group2</strong> within the Root Group, as depicted in <em class="italic">Figure 5.6</em>. We can navigate to these sub-groups, which also represent instances of <code class="inlineCode">ItemsPage</code>. Since these instances utilize relative routes and rely on navigation stacks that are pushed on demand, they cannot be pre-defined. These navigation stacks can extend as deep as the actual data present in the password database.</p>
<p class="normal">The two distinct routes of <code class="inlineCode">ItemsPage</code> are defined in <code class="inlineCode">AppShell.xaml</code> and <code class="inlineCode">AppShell.xaml.cs</code> as follows:</p>
<p class="normal">The <code class="inlineCode">RootPage</code> route (absolute route):</p>
<pre class="programlisting code"><code class="hljs-code">&lt;FlyoutItem x:Name="RootItem" Title="Browse" 
  Icon="{FontImage FontFamily=FontAwesomeSolid, 
  Color=Black, 
  Glyph={x:Static style:FontAwesomeSolid.Home}}"&gt;
  &lt;ShellContent Route="RootPage" 
    ContentTemplate="{DataTemplate local:ItemsPage}"&gt;
  &lt;/ShellContent&gt;
&lt;/FlyoutItem&gt;
</code></pre>
<p class="normal">The <code class="inlineCode">ItemsPage</code> route (relative route):</p>
<pre class="programlisting code"><code class="hljs-code">Routing.RegisterRoute(nameof(ItemsPage),
    typeof(ItemsPage));
</code></pre>
<p class="normal">In this <a id="_idIndexMarker427"/>section, you might be curious about how to navigate from the Root Group to <strong class="screenText">Group1</strong> or <strong class="screenText">Group2</strong>. If the <code class="inlineCode">ItemsPage</code> is capable of displaying the content of either <strong class="screenText">Group1</strong> or <strong class="screenText">Group2</strong>, how can we inform <code class="inlineCode">ItemsPage</code> which group needs to be displayed?</p>
<p class="normal">In <code class="inlineCode">Shell</code> navigation, data can be transmitted to a content page using query parameters. The syntax is akin to the parameters passed in a URL within a web browser. For instance, the following URL can be used to search for <strong class="keyWord">.net</strong> on Google: <a href="https://www.google.com.hk/search?q=.net.">https://www.google.com.hk/search?q=.net.</a></p>
<p class="normal">The desired outcome is achieved by appending a question mark (<code class="inlineCode">?</code>) after a route, along with a pair of query parameter IDs and their respective values. In the preceding example, the key is <code class="inlineCode">q</code> and the value is <code class="inlineCode">.net</code>.</p>
<p class="normal">Upon selecting an item in the list of Root Groups, it can be either an entry or a group. The click event activates the <code class="inlineCode">OnItemSelection</code> method in <code class="inlineCode">ItemsViewModel</code>, demonstrated in <em class="italic">Listing 5.2</em>:</p>
<pre class="programlisting code"><code class="hljs-code">using System.Collections.ObjectModel;
using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Microsoft.Extensions.Logging;
using KPCLib;
using PassXYZ.Vault.Services;
using PassXYZ.Vault.Views;
namespace PassXYZ.Vault.ViewModels {
  [QueryProperty(nameof(ItemId), nameof(ItemId))]                   //(1)
  public partial class ItemsViewModel : BaseViewModel {
    readonly IDataStore&lt;Item&gt; dataStore;
    ILogger&lt;ItemsViewModel&gt; logger;
    public ObservableCollection&lt;Item&gt; Items { get; }
    public ItemsViewModel(IDataStore&lt;Item&gt; dataStore, 
      ILogger&lt;ItemsViewModel&gt; logger) {
      this.dataStore = dataStore;
      this.logger = logger;
      Title = "Browse";
      Items = new ObservableCollection&lt;Item&gt;();
      IsBusy = false;
    }
    [ObservableProperty]
    private Item? selectedItem = default;
    [ObservableProperty]
    private string? title;
    [ObservableProperty]
    private bool isBusy;
    [RelayCommand]
    private async Task AddItem(object obj) {
      await Shell.Current.GoToAsync(nameof(NewItemPage));
    }
    public override async void OnItemSelecteion(object sender) {
      Item? item = sender as Item;
      if (item == null)
      {
        logger.LogWarning("item is null.");
        return;
      }
      logger.LogDebug($"Selected item is {item.Name}");
      if (item.IsGroup)
      {
        await Shell.Current.GoToAsync(                          //(3)
          $"{nameof(ItemsPage)}?
          {nameof(ItemsViewModel.ItemId)}={item.Id}");
      }
      else
      {
        await Shell.Current.GoToAsync(                          //(4)
          $"{nameof(ItemDetailPage)}?
          {nameof(ItemDetailViewModel.ItemId)}={item.Id}");
      }
    }
    [RelayCommand]
    private async Task LoadItems() {
      try {
        Items.Clear();
        var items = await dataStore.GetItemsAsync(true);
        foreach (var item in items) {
            Items.Add(item);
        }
        logger.LogDebug($"IsBusy={IsBusy}, 
          added {Items.Count()} items");
      }
      catch (Exception ex) {
        logger.LogError("{ex}", ex);
      }
      finally {
        IsBusy = false;
        logger.LogDebug("Set IsBusy to false");
      }
    }
    public string ItemId {                                      //(2)
      get {
          return SelectedItem == null ? 
            string.Empty : SelectedItem.Id;
      }
      set {
        if (string.IsNullOrEmpty(value))
        {
          SelectedItem = null;
        }
        else {
          var item = dataStore.GetItem(value);
          if (item != null) {
              SelectedItem = item;
          }
          else {
            throw new ArgumentNullException(nameof(ItemId), 
              "cannot find the selected item");
          }
        }
      }
    }
    public void OnAppearing() {
      if (SelectedItem == null) {
        Title = dataStore.SetCurrentGroup();
      }
      else {
        Title = dataStore.SetCurrentGroup(SelectedItem);
      }
      // load items
      logger.LogDebug($"Loading group {Title}");
      IsBusy = true;
    }
  }
}
</code></pre>
<p class="packt_figref">Listing 5.2: <code class="inlineCode">ItemsViewModel.cs</code> (<a href="https://epa.ms/ItemsViewModel5-2">https://epa.ms/ItemsViewModel5-2</a>)</p>
<p class="normal">Based on<a id="_idIndexMarker428"/> the item type, we might navigate to either the <code class="inlineCode">ItemsPage</code> <strong class="keyWord">(3)</strong> or the <code class="inlineCode">ItemDetailPage</code> <strong class="keyWord">(4)</strong>. In both instances, we transfer the <code class="inlineCode">Id</code> of the item to the <code class="inlineCode">ItemId</code> query parameter, which is defined in both the <code class="inlineCode">ItemsViewModel</code> and the <code class="inlineCode">ItemDetailViewModel</code>.</p>
<p class="normal">In the context of <em class="italic">Listing 5.2</em>, <strong class="keyWord">(1)</strong> <code class="inlineCode">ItemId</code> is established as the <code class="inlineCode">QueryPropertyAttribute</code> within the <code class="inlineCode">ItemsViewModel</code>. The first argument of <code class="inlineCode">QueryPropertyAttribute</code> corresponds to the name of the property designated to receive the data, which in this instance is <code class="inlineCode">ItemId</code> <strong class="keyWord">(2)</strong>.</p>
<p class="normal">The second argument corresponds to the <code class="inlineCode">id</code> parameter. Upon selecting a group from the list, the view model’s <code class="inlineCode">OnItemSelected</code> method <strong class="keyWord">(3)</strong> is triggered and the item <code class="inlineCode">Id</code> of the chosen group is passed as the value for the <code class="inlineCode">ItemId</code> query parameter.</p>
<p class="normal">When the <code class="inlineCode">ItemsPage</code> is loaded along with the <code class="inlineCode">ItemId</code> query parameter, the <code class="inlineCode">ItemId</code> property <strong class="keyWord">(2)</strong> gets set. In the setter of the <code class="inlineCode">ItemId</code> property, we examine whether the query parameter value is empty. If it is empty, it might be our initial navigation to the <code class="inlineCode">RootPage</code> route without any query parameter. In this case, we just set <code class="inlineCode">SelectedItem</code> to <code class="inlineCode">null</code>.</p>
<p class="normal">If it is not empty, we will find the item and set it to <code class="inlineCode">SelectedItem</code>.</p>
<p class="normal"><strong class="keyWord">(4)</strong> If we select an entry from the list, we can navigate to <code class="inlineCode">ItemDetailPage</code> with the item <code class="inlineCode">Id</code> as the value of the query parameter. To accommodate this query parameter, we can modify the<a id="_idIndexMarker429"/> ItemId property of the <code class="inlineCode">ItemDetailViewModel</code> as follows:</p>
<pre class="programlisting code"><code class="hljs-code">[QueryProperty(nameof(ItemId), nameof(ItemId))]
public partial class ItemDetailViewModel : BaseViewModel
{
  readonly IDataStore&lt;Item&gt; dataStore;
  ILogger&lt;ItemDetailViewModel&gt; logger;
  public ObservableCollection&lt;Field&gt; Fields { get; set; }
  public ItemDetailViewModel(IDataStore&lt;Item&gt; dataStore, 
    ILogger&lt;ItemDetailViewModel&gt; logger) {
      this.dataStore = dataStore;
      this.logger = logger;
      Fields = new ObservableCollection&lt;Field&gt;();
  }
  [ObservableProperty]
  private string? title;
  [ObservableProperty]
  private string? id;
  [ObservableProperty]
  private string? description;
  [ObservableProperty]
  private bool isBusy;
  private string? itemId;
  public string ItemId {                                       //(1)
    get {
      if(itemId == null) { 
        throw new NullReferenceException(nameof(itemId)); 
      }
      return itemId;
    }
    set {
      itemId = value;
      LoadItemId(value);                                       //(2)
    }
  }
  public override void OnItemSelecteion(object sender) {
      logger.LogDebug("OnItemSelecteion is invoked.");
  }
  public void LoadItemId(string itemId) {
    if (itemId == null) { 
      throw new ArgumentNullException(nameof(itemId)); }
    var item = dataStore.GetItem(itemId);                      //(3)
if (item == null) { 
  throw new NullReferenceException(itemId); }
    Id = item.Id;
    Title = item.Name;
    Description = item.Description;
    if (!item.IsGroup)
    {
      PwEntry dataEntry = (PwEntry)item;                       //(4)
      Fields.Clear();
      List&lt;Field&gt; fields = dataEntry.GetFields(
        GetImage: FieldIcons.GetImage);                        //(5)
      foreach (Field field in fields) {
          Fields.Add(field);
      }
      logger.LogDebug($"ItemDetailViewModel:
        Name={dataEntry.Name}.");
    }
  }
}
</code></pre>
<p class="normal">In <a id="_idIndexMarker430"/>the <code class="inlineCode">ItemDetailViewModel</code> class, we implement the following logic:</p>
<ul>
<li class="bulletList"><code class="inlineCode">ItemId</code> <strong class="keyWord">(1)</strong> serves as the property that accepts the query parameter.</li>
<li class="bulletList">When setting the <code class="inlineCode">ItemId</code>, the <code class="inlineCode">LoadItemId</code> method <strong class="keyWord">(2)</strong> is called to load the item.</li>
<li class="bulletList">Within <code class="inlineCode">LoadItemId</code>, the data service method <code class="inlineCode">GetItem</code> <strong class="keyWord">(3)</strong> is called to obtain the item using its corresponding <code class="inlineCode">Id</code>.</li>
<li class="bulletList">In this case, the item is an instance of <code class="inlineCode">PwEntry</code> <strong class="keyWord">(4)</strong>, which can be cast accordingly.</li>
<li class="bulletList">The PassXYZLib extension method, <code class="inlineCode">GetFields</code> <strong class="keyWord">(5)</strong>, is utilized to update the list of fields.</li>
</ul>
<p class="normal">In the previous<a id="_idIndexMarker431"/> two sections, we acquired knowledge of basic navigation and <code class="inlineCode">Shell</code> navigation and enhanced our navigation design using <code class="inlineCode">Shell</code>. At this point, it is essential to revisit the MVVM pattern and further refine our data model to improve the quality of our password manager app.</p>
<h1 class="heading-1" id="_idParaDest-159">Improving our app</h1>
<p class="normal">In <em class="chapterRef">Chapter 4</em>, <em class="italic">Exploring MVVM and Data Binding</em>, we analyzed various use cases and developed a few. In this section, utilizing the knowledge we have acquired, we will augment the existing use cases and introduce new ones.</p>
<p class="normal">We will be working on the following use cases:</p>
<ul>
<li class="bulletList"><strong class="keyWord">Use case 1</strong>: As a password manager user, I want to log in to the password manager app so that I can access my password data.</li>
</ul>
<p class="normal">In this use case, we have not yet fully implemented user login; we plan to complete this in the subsequent chapter. For now, we will implement a pseudo-logic that encompasses all aspects except the data layer.</p>
<p class="normal">Previously, in <em class="chapterRef">Chapter 4</em>, <em class="italic">Exploring MVVM and Data Binding</em>, we covered a use case that supports one level of navigation.</p>
<ul>
<li class="bulletList"><strong class="keyWord">Use case 3</strong>: As a password manager user, I want to see a list of groups and entries so that I can explore my password data.</li>
</ul>
<p class="normal">To accommodate multiple levels of navigation, we will implement the following use cases in this section:</p>
<ul>
<li class="bulletList"><strong class="keyWord">Use case 6</strong>: As a password manager user, when I click on a group in the current list, I want to see the groups and entries belonging to that group.</li>
<li class="bulletList"><strong class="keyWord">Use case 7</strong>: As a password manager user, when navigating through my password data, I want to be able to go back to the previous group or parent group.</li>
</ul>
<p class="normal">In the previous implementation (use case 1), after login, we implemented the navigation to the root page using an absolute route. However, the implementation of the <code class="inlineCode">LoginService</code> is not done yet. We need to implement it in this chapter.</p>
<p class="normal">After loading the root page (use case 3), at present, we can only browse the root-level entries and groups. We are not yet able to enter a child group from the root level. To address this limitation, we are introducing use cases 6 and 7 in this chapter. In use cases 6 and 7, we aim to navigate forward and backward using relative routes.</p>
<p class="normal">With the MVVM pattern, we access our model through services, which are typically abstracted as interfaces, separate from the actual implementation. The <code class="inlineCode">IDataStore</code> interface is an example of this. In order to support use case 6 and enhance use case 1, we need to develop a new interface called <code class="inlineCode">IUserService</code> for user login support.</p>
<h2 class="heading-2" id="_idParaDest-160">Understanding the improved design</h2>
<p class="normal">To understand <a id="_idIndexMarker432"/>the services and the enhanced model, let’s review the enhanced design in <em class="italic">Figure 5.7</em>:</p>
<figure class="mediaobject"><img alt="Figure 5.7: Model and service in MVVM " height="635" src="img/B21554_05_07.png" width="825"/></figure>
<p class="packt_figref">Figure 5.7: Model and service in MVVM</p>
<p class="normal"><em class="italic">Figure 5.7</em> presents a class <a id="_idIndexMarker433"/>diagram that illustrates the majority of our design. To comprehend the design of our app, we can examine this class diagram in conjunction with the table provided. For the sake of simplicity, I have excluded some elements. For instance, you can add the <code class="inlineCode">NewItemPage</code> or <code class="inlineCode">SignUpPage</code> to <em class="italic">Figure 5.7</em> and <em class="italic">Table 5.3</em> by yourself.</p>
<table class="table-container" id="table003-2">
<tbody>
<tr>
<td class="table-cell" colspan="2">
<p class="normal"><strong class="keyWord">Model</strong></p>
</td>
<td class="table-cell" rowspan="2">
<p class="normal"><strong class="keyWord">View</strong></p>
</td>
<td class="table-cell" rowspan="2">
<p class="normal"><strong class="keyWord">View Model</strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><strong class="keyWord">Data Model</strong></p>
</td>
<td class="table-cell">
<p class="normal"><strong class="keyWord">Service</strong></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode">User</code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode">IUserService</code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode">LoginPage</code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode">LoginViewModel</code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode">Item</code></p>
</td>
<td class="table-cell" rowspan="2">
<p class="normal"><code class="inlineCode">IDataStore</code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode">ItemsPage</code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode">ItemsViewModel</code></p>
</td>
</tr>
<tr>
<td class="table-cell">
<p class="normal"><code class="inlineCode">Field</code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode">ItemDetailPage</code></p>
</td>
<td class="table-cell">
<p class="normal"><code class="inlineCode">ItemDetailViewModel</code></p>
</td>
</tr>
</tbody>
</table>
<p class="packt_figref">Table 5.3: Classes and interfaces in the MVVM pattern</p>
<h3 class="heading-3" id="_idParaDest-161">Registering absolute routes and relative routes</h3>
<p class="normal">In this <a id="_idIndexMarker434"/>section, when introducing pages and routes, you may notice that the names of pages and routes could be the same. To distinguish between them, I’ll use bold font to identify a page and italic font to identify a route.</p>
<p class="normal">In our<a id="_idIndexMarker435"/> application, both absolute and relative routes are registered within the <code class="inlineCode">AppShell</code> class. The absolute routes, <em class="italic">LoginPage</em>, <em class="italic">SignUpPage</em>, <em class="italic">RootPage</em>, and <em class="italic">AboutPage</em>, are created as parts of the <code class="inlineCode">Shell</code>. Conversely, the relative routes – <em class="italic">ItemsPage</em>, <em class="italic">ItemDetailPage</em>, and <em class="italic">NewItemPage</em> – are defined within the constructor of the <code class="inlineCode">AppShell</code>.</p>
<p class="normal">To facilitate multi-level navigation, the page <strong class="keyWord">ItemsPage</strong> is registered as both the absolute route <em class="italic">RootPage</em> and the relative route <em class="italic">ItemsPage</em>.</p>
<p class="normal">Upon application loading, the route <em class="italic">LoginPage</em> is utilized. Post-login, the app navigates to <em class="italic">RootPage</em>. If a user selects a child group, the relative route <em class="italic">ItemsPage</em> is loaded, thereby permitting navigation deeper into multi-levels. When a user selects an entry, the relative route<em class="italic"> ItemsDetailPage</em> is loaded.</p>
<h3 class="heading-3" id="_idParaDest-162">Model and services</h3>
<p class="normal">To <a id="_idIndexMarker436"/>save application data, we typically store it in a database, which could be either a relational database or a NoSQL database. In our case, our password database is not a relational database. Nevertheless, while working on our design, we can employ the analogous logic of relational databases when formulating our business logic. Our model is represented by three distinct classes – <code class="inlineCode">User</code>, <code class="inlineCode">Item</code>, and <code class="inlineCode">Field</code>.</p>
<p class="normal">In the context of our design, <code class="inlineCode">Item</code> and <code class="inlineCode">Field</code> represent a password entry and the content within that entry, respectively. An entry can be visualized as a row in a table, with a field acting as a cell. To model a password entry, we employ the <code class="inlineCode">PwEntry</code> from KeePassLib. In this instance, a group refers to a collection of entries, and <code class="inlineCode">PwGroup</code> is utilized to model this group. A group can be compared to a table within a database, and fields that share the same key values across a group are akin to a column. In order to develop the interface for our data services, we can adopt a similar approach for processing data within our database.</p>
<p class="normal">How can we<a id="_idIndexMarker437"/> manage data within a database? You might be familiar with the term CRUD operations. In our situation, we can employ the augmented <code class="inlineCode">create</code>, <code class="inlineCode">read</code>, <code class="inlineCode">update</code>, <code class="inlineCode">delete</code>, and <code class="inlineCode">list</code> (<strong class="keyWord">CRUDL</strong>) operations for defining the interface of our service.</p>
<p class="normal">To process password entries and groups, we can use the following <code class="inlineCode">IDataStore</code> interface:</p>
<pre class="programlisting code"><code class="hljs-code">public interface IDataStore&lt;T&gt;
{
    T? GetItem(string id, bool SearchRecursive = false);
    Task&lt;T?&gt; GetItemAsync(string id, bool SearchRecursive =
        false);
    Task AddItemAsync(T item);
    Task UpdateItemAsync(T item);
    Task&lt;bool&gt; DeleteItemAsync(string id);
    Task&lt;IEnumerable&lt;T&gt;&gt; GetItemsAsync(bool forceRefresh =
        false);
}
</code></pre>
<p class="normal">In the <code class="inlineCode">IDataStore</code> interface, we define the following CRUDL operations:</p>
<ul>
<li class="bulletList"><strong class="keyWord">Create</strong>: We use <code class="inlineCode">AddItemAsync</code> to add an entry or a group</li>
<li class="bulletList"><strong class="keyWord">Read</strong>: We use <code class="inlineCode">GetItem</code> or <code class="inlineCode">GetItemAsync</code> to read an entry or a group</li>
<li class="bulletList"><strong class="keyWord">Update</strong>: We use <code class="inlineCode">UpdateItemAsync</code> to update an entry or a group</li>
<li class="bulletList"><strong class="keyWord">Delete</strong>: We use <code class="inlineCode">DeleteItemAsync</code> to delete an entry or a group</li>
<li class="bulletList"><strong class="keyWord">List</strong>: We use <code class="inlineCode">GetItemsAsync</code> to get a list of entries and groups in the current group</li>
</ul>
<p class="normal">To manage users, we can utilize the following <code class="inlineCode">IUserService</code> interface:</p>
<pre class="programlisting code"><code class="hljs-code">public interface IUserService&lt;T&gt;
{
    T GetUser(string username);
    Task AddUserAsync(T user);
    Task DeleteUserAsync(T user);
    List&lt;string&gt; GetUsersList();
    Task&lt;bool&gt; LoginAsync(T user);
    void Logout();
}
</code></pre>
<p class="normal">We can define a set of CRUDL operations to handle users as well:</p>
<ul>
<li class="bulletList"><strong class="keyWord">Create</strong>: We can create a new user using <code class="inlineCode">AddUserAsync</code></li>
<li class="bulletList"><strong class="keyWord">Read</strong>: We can get the user information using <code class="inlineCode">GetUser</code></li>
<li class="bulletList"><strong class="keyWord">Delete</strong>: We can delete a user using <code class="inlineCode">DeleteUserAsync</code></li>
<li class="bulletList"><strong class="keyWord">List</strong>: We can get a list of users using <code class="inlineCode">GetUsersList</code></li>
<li class="bulletList"><strong class="keyWord">LoginAsync</strong> and <strong class="keyWord">Logout</strong>: We can log in or log out using an instance of <code class="inlineCode">User</code></li>
</ul>
<pre>IDataStore</code> into <code class="inlineCode">ItemsViewModel</code> using constructor injection as an example:</pre>
<pre class="programlisting code"><code class="hljs-code">readonly IDataStore&lt;Item&gt; dataStore;
ILogger&lt;ItemsViewModel&gt; logger;
public ObservableCollection&lt;Item&gt; Items { get; }
public ItemsViewModel(IDataStore&lt;Item&gt; dataStore, ILogger&lt;ItemsViewModel&gt; logger)
{
  this.dataStore = dataStore;
  this.logger = logger;
  Title = "Browse";
  Items = new ObservableCollection&lt;Item&gt;();
  IsBusy = false;
}
</code></pre>
<p class="normal">In the constructor of <code class="inlineCode">ItemsViewModel</code> class, we initialize the <code class="inlineCode">IDataStore</code> and <code class="inlineCode">ILogger</code> services through a dependency injection. </p>
<h2 class="heading-2" id="_idParaDest-163">Implementation of IUserService</h2>
<p class="normal">In our <a id="_idIndexMarker439"/>application, the <code class="inlineCode">UserService</code> class<a id="_idIndexMarker440"/> serves as the implementation of the <code class="inlineCode">IUserService</code> interface. The code for this can be found in <em class="italic">Listing 5.3</em>. For the sake of simplifying the testing process, we have not implemented all features in this chapter, as we continue to utilize a mock data store:</p>
<pre class="programlisting code"><code class="hljs-code">using KPCLib;
using Microsoft.Extensions.Logging;
using System.Collections.ObjectModel;
using User = PassXYZLib.User;
namespace PassXYZ.Vault.Services;
public class UserService : IUserService&lt;User&gt;
{
  readonly IDataStore&lt;Item&gt; dataStore;
  ILogger&lt;UserService&gt; logger;
  private User? _user = default;
  public UserService(IDataStore&lt;Item&gt; dataStore,                //(1)
    ILogger&lt;UserService&gt; logger) {
    this.dataStore = dataStore;
    this.logger = logger;
  }
  public User GetUser(string username) {
    User user = new User();
    user.Username = username;
    logger.LogDebug($"Path={user.Path}");
    return user;
  }
  public async Task DeleteUserAsync(User user) {
    await Task.Run(() =&gt; {
      logger.LogDebug($"Remove Path={user.Path}");
    });
  }
  public List&lt;string&gt; GetUsersList() {
    return User.GetUsersList();
  }
  public async Task AddUserAsync(User user) {
    if (user == null) { 
        throw new ArgumentNullException(nameof(user), "User cannot be 
          null"); }
    _user = user;
    await dataStore.SignUpAsync(user);
  }
  public async Task&lt;bool&gt; LoginAsync(User user) {
    if (user == null) { 
        throw new ArgumentNullException(nameof(user), "User cannot be 
          null"); }
    _user = user;
    return await dataStore.ConnectAsync(user);
  }
  public void Logout() {
    dataStore.Close();
    logger.LogDebug("Logout");
  }
}
</code></pre>
<p class="packt_figref">Listing 5.3: <code class="inlineCode">UserService.cs</code> (<a href="https://epa.ms/UserService5-3">https://epa.ms/UserService5-3</a>)</p>
<p class="normal">In the <code class="inlineCode">UserService</code> constructor <strong class="keyWord">(1)</strong>, an <code class="inlineCode">IDataStore</code> instance is initialized via dependency injection. The available <a id="_idIndexMarker441"/>functions can be classified <a id="_idIndexMarker442"/>into two types. Functions such as <code class="inlineCode">GetUser</code>, <code class="inlineCode">DeleteUserAsync</code>, and <code class="inlineCode">GetUserList</code> can be implemented using methods from the <code class="inlineCode">User</code> class. Meanwhile, methods like <code class="inlineCode">AddUserAsync</code>, <code class="inlineCode">LoginAsync</code>, and <code class="inlineCode">Logout</code> are implemented using the <code class="inlineCode">IDataStore</code> instance.</p>
<h1 class="heading-1" id="_idParaDest-164">Improving the login process</h1>
<p class="normal">In the<a id="_idIndexMarker443"/> process of user management, we may need to add new users or remove outdated users from the system. For our app, it only allows one user to log in at a time. To support this feature, we can implement a class using the singleton pattern. Alternatively, we can implement a class and utilize dependency injection to have a similar effect on the singleton pattern. For instance, we can create a <code class="inlineCode">LoginService</code> class that inherits from the <code class="inlineCode">User</code> class, as demonstrated in <em class="italic">Listing 5.4</em>:</p>
<pre class="programlisting code"><code class="hljs-code">using System.Diagnostics;
using PassXYZLib;
namespace PassXYZ.Vault.Services;
public class LoginService : PxUser {                             //(1)
  private IUserService&lt;User&gt; _userService;
  private const string PrivacyNotice = "Privacy Notice";
  public static bool IsPrivacyNoticeAccepted {
    get =&gt; Preferences.Get(PrivacyNotice, false);
    set =&gt; Preferences.Set(PrivacyNotice, value);
  }
  public LoginService(IUserService&lt;User&gt; userService) {
    _userService = userService;                                  //(2)
  }
  public async Task&lt;bool&gt; LoginAsync() {
    return await _userService.LoginAsync(this);                  //(3)
  }
  public async Task SignUpAsync() {
    await _userService.AddUserAsync(this);                       //(4)
  }
  public override void Logout() {
    _userService.Logout();
  }
  public async Task&lt;string&gt; GetSecurityAsync() {
    if (string.IsNullOrWhiteSpace(Username)) { 
      return string.Empty; }
    string data = await SecureStorage.GetAsync(Username);
    return data;
  }
  public async Task SetSecurityAsync(string password) {
    if (string.IsNullOrWhiteSpace(Username) || 
      string.IsNullOrWhiteSpace(password)) { return; }
    await SecureStorage.SetAsync(Username, password);
  }
  public async Task&lt;bool&gt; DisableSecurityAsync() {
    ...
  }
}
</code></pre>
<p class="packt_figref">Listing 5.4: <code class="inlineCode">LoginService.cs</code> (<a href="https://epa.ms/LoginService5-4">https://epa.ms/LoginService5-4</a>)</p>
<p class="normal"><strong class="keyWord">(1)</strong> The LoginService class is derived from the PxUser subclass, which in turn inherits from the User class.</p>
<p class="normal"><strong class="keyWord">(2)</strong> Within LoginService, we initialize the IUserService interface through dependency injection.</p>
<p class="normal"><strong class="keyWord">(3)</strong> To execute <a id="_idIndexMarker444"/>user login, we can invoke the IUserService method by passing a LoginService instance as the argument. <strong class="keyWord">(4)</strong> The same process is applicable in the case of user signup.</p>
<h2 class="heading-2" id="_idParaDest-165">Login view model</h2>
<p class="normal">After<a id="_idIndexMarker445"/> introducing the model and service layer, we can now focus on the view model and view for the login and signup functionality. Let’s start by examining the implementation of the view model, as presented in <em class="italic">Listing 5.5</em>:</p>
<pre class="programlisting code"><code class="hljs-code">using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using Microsoft.Extensions.Logging;
using PassXYZLib;
using PassXYZ.Vault.Views;
using PassXYZ.Vault.Services;
using System.Diagnostics;
namespace PassXYZ.Vault.ViewModels
{
  public partial class LoginViewModel : ObservableObject
  {
    private LoginService _currentUser;
    ILogger&lt;LoginViewModel&gt; _logger;
    public LoginViewModel(LoginService user,                    //(1)
      ILogger&lt;LoginViewModel&gt; logger)
    { 
      _currentUser = user;
      _logger = logger;
    }
    [RelayCommand(CanExecute = nameof(ValidateLogin))]
    private async Task Login(object obj)
    {
      ...
      bool status = await _currentUser.LoginAsync();            //(2)
      ...
    }
    private bool ValidateLogin()
    {
      var canExecute = !String.IsNullOrWhiteSpace(Username)
          &amp;&amp; !String.IsNullOrWhiteSpace(Password);
      return canExecute;
    }
    [RelayCommand(CanExecute = nameof(ValidateSignUp))]
    private async Task SignUp()
    {
      ...
      await _currentUser.SignUpAsync();                         //(3)
      ...
    }
    private bool ValidateSignUp()
    {
      var canExecute = !String.IsNullOrWhiteSpace(Username)
          &amp;&amp; !String.IsNullOrWhiteSpace(Password)
          &amp;&amp; !String.IsNullOrWhiteSpace(Password2);
      
      if (canExecute) {
          return Password!.Equals(Password2);
      }
      return canExecute;
    }
    [ObservableProperty]
    private bool isBusy = false;
    [ObservableProperty]
    [NotifyCanExecuteChangedFor(nameof(LoginCommand))]         //(4)
    [NotifyCanExecuteChangedFor(nameof(SignUpCommand))]
    private string? username = default;
    [ObservableProperty]
    [NotifyCanExecuteChangedFor(nameof(LoginCommand))]
    [NotifyCanExecuteChangedFor(nameof(SignUpCommand))]
    private string? password = default;
    [ObservableProperty]
    [NotifyCanExecuteChangedFor(nameof(SignUpCommand))]
    private string? password2 = default;
    public bool IsDeviceLockEnabled
    {
      ...
    }
    public List&lt;string&gt; GetUsersList() {
        return User.GetUsersList();
    }
    public void Logout() {
      _currentUser.Logout();
    }
  }
}
</code></pre>
<p class="packt_figref">Listing 5.5: <code class="inlineCode">LoginViewModel.cs</code> (<a href="https://epa.ms/LoginViewModel5-5">https://epa.ms/LoginViewModel5-5</a>)</p>
<p class="normal"><strong class="keyWord">(1)</strong> In the <code class="inlineCode">LoginViewModel</code>, we inject an instance of <code class="inlineCode">LoginService</code> through dependency injection and save it in the private member variable <code class="inlineCode">_currentUser</code>. This variable is utilized to track all login and signup activities.</p>
<p class="normal">Subsequently, we<a id="_idIndexMarker446"/> created the <code class="inlineCode">LoginCommand</code> <strong class="keyWord">(2)</strong> and <code class="inlineCode">SignUpCommand</code> <strong class="keyWord">(3)</strong> using the <code class="inlineCode">RelayCommand</code> attribute from the .NET Community Toolkit. Within these functions, we call the <code class="inlineCode">LoginAsync</code> and <code class="inlineCode">SignUpAsync</code> methods from the <code class="inlineCode">LoginService</code>.</p>
<p class="normal">To validate both commands, we created the <code class="inlineCode">ValidateLogin</code> and <code class="inlineCode">ValidateSignUp</code> methods to perform the necessary checks. In <code class="inlineCode">ValidateLogin</code>, we ensure that both the username and password are not empty before allowing the login process to proceed. In <code class="inlineCode">ValidateSignUp</code>, we not only verify the username and password but also confirm that the password and confirmation password fields match. <strong class="keyWord">(4)</strong> To trigger the validation methods, the <code class="inlineCode">NotifyCanExecuteChangedFor</code> attribute is added to decorate the properties. This is part of the MVVM toolkit implementation, which we discussed in <em class="chapterRef">Chapter 4</em><em class="italic">, Exploring MVVM and Data Binding</em>.</p>
<p class="normal">Now, we have upgraded our model and services to optimize the login process. Reviewing the class diagram in <em class="italic">Figure 5.7</em>, we have modified the source code at the view, view model, and service layers to improve our application. The actual model is contained within two libraries, <code class="inlineCode">KPCLib</code> and <code class="inlineCode">PassXYZLib</code>. We have exposed the capabilities of these libraries through the <code class="inlineCode">IDataStore</code> and <code class="inlineCode">IUserService</code> interfaces. By creating the <a id="_idIndexMarker447"/>implementing classes for these two interfaces, we have further enhanced our model. In the following section, we will focus on the view layer and examine the upgraded UI.</p>
<h2 class="heading-2" id="_idParaDest-166">Login UI</h2>
<p class="normal">We can now <a id="_idIndexMarker448"/>enhance the login and signup UI. Currently, the login page only contains a single button. Let’s add a username field and a password field to <code class="inlineCode">LoginPage.xaml</code>, as illustrated in <em class="italic">Figure 5.8</em>.</p>
<figure class="mediaobject"><img alt="" height="499" src="img/B21554_05_08.png" width="826"/></figure>
<p class="packt_figref">Figure 5.8: LoginPage</p>
<p class="normal">In this new UI design, we made the following changes:</p>
<ul>
<li class="bulletList">We created a 4x3 grid layout within a frame. <strong class="keyWord">(1)</strong></li>
<li class="bulletList">In the first two rows, we added two <code class="inlineCode">Entry</code> controls to hold the username <strong class="keyWord">(2)</strong> and password <strong class="keyWord">(3)</strong>. We established a data binding between the <code class="inlineCode">Text</code> fields of the <code class="inlineCode">Entry</code> controls and the properties of the <code class="inlineCode">LoginViewModel</code>. </li>
<li class="bulletList">In the third row, we incorporated an <code class="inlineCode">ActivityIndicator</code> control <strong class="keyWord">(4)</strong> to display the login status, which is bound to the <code class="inlineCode">IsBusy</code> property of the view model.</li>
<li class="bulletList">In the final row, we defined a <code class="inlineCode">Button</code> control <strong class="keyWord">(5)</strong> for the login action. The <code class="inlineCode">Button</code> control has a <code class="inlineCode">Command</code> property that implements the <code class="inlineCode">ICommand</code> interface. We <a id="_idIndexMarker449"/>used data binding to link this <code class="inlineCode">Command</code> property to the method in the view model responsible for performing the login action.</li>
</ul>
<h1 class="heading-1" id="_idParaDest-167">Summary</h1>
<p class="normal">In this chapter, we focused on fundamental navigation principles and the <code class="inlineCode">Shell</code> framework. We chose <code class="inlineCode">Shell</code> as the navigation foundation for our app design, examined its capabilities, and discussed how to integrate it into our app’s UI.</p>
<p class="normal">After we completed most of the UI design, we enhanced our model by making changes to two service interfaces: <code class="inlineCode">IDataStore</code> and <code class="inlineCode">IUserService</code>. We improved the login process after making changes in the view, view model, and service layers. In the service layer, we are still using the <code class="inlineCode">MockDataStore</code> class. However, we haven’t finalized the implementation in the <code class="inlineCode">IDataStore</code> service to perform the actual login activities yet. We will leave this to the next chapter.</p>
<p class="normal">Upon completing the majority of the UI design, we proceeded to refine our model by modifying two service interfaces: <code class="inlineCode">IDataStore</code> and <code class="inlineCode">IUserService</code>. By making alterations in the view, view model, and service layers, we enhanced the login process. In the service layer, we continued to utilize the <code class="inlineCode">MockDataStore</code> class. However, the implementation of the <code class="inlineCode">IDataStore</code> service for performing actual login activities has yet to be finalized, and we will address this in the subsequent chapter.</p>
<p class="normal">In the next chapter, we will delve into dependency injection in .NET MAUI, which is done quite differently compared to Xamarin.Forms. We will instruct you on how to register our services using dependency injection and how to initialize our service via constructor injection or property injection. Furthermore, we will develop the actual service to supersede the <code class="inlineCode">MockDataStore</code>.</p>
<h1 class="heading-1">Learn more on Discord</h1>
<p class="normal">Join our community’s Discord space for discussions with the author and other readers:</p>
<p class="normal"><a href="https://packt.link/cross-platform-app">https://packt.link/cross-platform-app</a></p>
<p class="normal"><img alt="" height="354" src="img/QR_Code166522361691420406.png" style="width:10em;" width="354"/></p>
</div>
</div></body></html>