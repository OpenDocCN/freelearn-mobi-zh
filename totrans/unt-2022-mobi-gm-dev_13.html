<html><head></head><body>
		<div><h1 id="_idParaDest-142" class="chapter-number"><a id="_idTextAnchor369"/>13</h1>
			<h1 id="_idParaDest-143"><a id="_idTextAnchor370"/>Building a Release Copy of Our Game</h1>
			<p>Building a release copy of our game is a crucial step in the process of submitting our game to the app stores. This step involves creating a version of our game that is stable and ready for us to release to the public.</p>
			<p>In this chapter, we will walk you through the steps required to build a release copy of your game for both iOS and Android devices. We will cover some extra steps that need to be taken in order in order for our project to work. We will also provide tips and best practices to ensure that your release copy is of the highest quality and free from bugs and other issues. So, let’s dive in and get started on creating a release copy of your game. This chapter will be split into a number of topics. It will contain a simple step-by-step process from beginning to end. Here is the outline of our tasks:</p>
			<ul>
				<li>Generating release builds for app stores</li>
			</ul>
			<h1 id="_idParaDest-144"><a id="_idTextAnchor371"/>Technical requirements</h1>
			<p>This book utilizes Unity 2022.1.0b16 and Unity Hub 3.3.1, but the steps should work with minimal changes in future versions of the editor. If you would like to download the exact version used in this book, and there is a new version out, you can visit Unity’s download archive at <a href="https://unity3d.com/get-unity/download/archive">https://unity3d.com/get-unity/download/archive</a>. You can also find the system requirements for Unity at <a href="https://docs.unity3d.com/2022.1/Documentation/Manual/system-requirements.html">https://docs.unity3d.com/2022.1/Documentation/Manual/system-requirements.html</a> in the <strong class="bold">Unity Editor system requirements</strong> section. To deploy your project, you will need an Android or iOS device.</p>
			<p>You can find the code files present in this chapter on GitHub at <a href="https://github.com/PacktPublishing/Unity-2022-Mobile-Game-Development-3rd-Edition/tree/main/Chapter13%20and%2014">https://github.com/PacktPublishing/Unity-2022-Mobile-Game-Development-3rd-Edition/tree/main/Chapter13%20and%2014</a>.</p>
			<h1 id="_idParaDest-145"><a id="_idTextAnchor372"/>Generating release builds for app stores</h1>
			<p>We exported <a id="_idIndexMarker727"/>copies of<a id="_idIndexMarker728"/> our game previously in <a href="B18868_02.xhtml#_idTextAnchor087"><em class="italic">Chapter 2</em></a>, <em class="italic">Project Setup for Android and iOS Development</em>, but there are some additional steps that we should do before actually releasing the game on an app store:</p>
			<ol>
				<li>The first step will be to confirm you are currently ready to deploy your project to the mobile platform of choice. You can check this by going into the <strong class="bold">Build Settings</strong> menu by navigating to <strong class="bold">File</strong> | <strong class="bold">Build Settings</strong>.</li>
				<li>From there, you should see the Unity logo to the right of the <strong class="bold">Android</strong> or <strong class="bold">iOS </strong>selection depending on the platform you wish to build for. If it is not at the correct platform, select that platform you wish to build to and then click the <strong class="bold">Switch Platform</strong> button and wait for it to finish reimporting the assets for the project:</li>
			</ol>
			<div><div><img src="img/B18868_13_01.jpg" alt="Figure 13.1 – The Build Settings menu﻿"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.1 – The Build Settings menu<a id="_idTextAnchor373"/></p>
			<ol>
				<li value="3">After confirming whether we are building for <strong class="bold">Android</strong> or <strong class="bold">iOS</strong>, open up the <strong class="bold">Player</strong> settings menu by clicking on the <strong class="bold">Player Settings...</strong> button from the menu or by going to <strong class="bold">Edit </strong>| <strong class="bold">Project Settings </strong>| <strong class="bold">Player</strong>.</li>
				<li>If you haven’t done so already, set the <code>JohnPDoran</code> and <code>Endless </code><code>Roller</code>, respectively.</li>
				<li>You’ll then see a <code>Hi-ResIcon</code> image from the <code>Assets</code> folder and then drag and drop it into the <strong class="bold">Default Icon</strong> slot. This will cause the <strong class="bold">Icon</strong> section <a id="_idIndexMarker729"/>of the Android settings<a id="_idIndexMarker730"/> to automatically scale the image to fit whatever device you are targeting:</li>
			</ol>
			<div><div><img src="img/B18868_13_02.jpg" alt="Figure 13.2 – Setting the Default Icon image"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.2 – Setting the Default Icon image</p>
			<p>Of course, you can also use your own image, and you can use transparency if you would like to.</p>
			<ol>
				<li value="6">Under the <strong class="bold">Resolution and Presentation</strong> section, you can enable or disable different rotations and aspect ratios as desired. We adjusted the game to fit these, but this may be useful to know about as you work on your own projects or if you wish to restrict users to one experience or another.</li>
				<li>The <strong class="bold">Splash Image</strong> option can be used to display your own logo in addition to Unity’s if you have Unity Personal. If you have a Unity Pro license, you may disable it entirely if you wish here by unchecking the <strong class="bold">Show Splash </strong><strong class="bold">Screen</strong> option.</li>
				<li>Confirm under <code>com.CompanyName.GameName</code>.</li>
				<li>Next, open up <strong class="bold">Publishing Settings</strong>. This is where we will enter information about who<a id="_idIndexMarker731"/> our <a id="_idIndexMarker732"/>game’s publisher is (in this case, I’m assuming it’s you). Whenever you build a game for Android, you need a <strong class="bold">Keystore</strong>, which allows you to sign off the game, approving it for the build process. Click on the <strong class="bold">Keystore Manager</strong> button. From there, you’ll be brought to a menu.</li>
				<li>From the menu, click on the <strong class="bold">Keystore… </strong>drop-down menu and then select <strong class="bold">Create New</strong> <strong class="bold">|</strong> <strong class="bold">Anywhere...</strong>, and choose a location for this file.</li>
				<li>Keep in mind where this is going to be located, as you will be using it in the future to create new versions of your game</li>
				<li>Then, you’ll need to set a value in the <strong class="bold">Password</strong> field that you will need to know as you’ll be using it repeatedly. Afterward, in the <strong class="bold">Confirm password</strong> textbox, you should enter the same thing as you did before.</li>
				<li>From there, under the <strong class="bold">New Key Values</strong> section, you’ll need to add the same information as before—the password with confirmation and then your name and other information. You can see what I put down in the following screenshot. Once<a id="_idIndexMarker733"/> finished, click<a id="_idIndexMarker734"/> on the <strong class="bold">Add </strong><strong class="bold">Key</strong> button:</li>
			</ol>
			<div><div><img src="img/B18868_13_03.jpg" alt="Figure 13.3 – Creating a keys﻿tore"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.3 – Creating a keys<a id="_idTextAnchor374"/>tore</p>
			<ol>
				<li value="14">You’ll have a popup asking whether you’d like to set the new keystore as your <strong class="bold">Project Keystore</strong> and <strong class="bold">Project Key</strong> values. Click on <strong class="bold">Yes</strong>.</li>
			</ol>
			<div><div><img src="img/B18868_13_04.jpg" alt="Figure 13.4 – Confirmation window"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.4 – Confirmation window</p>
			<p>You should<a id="_idIndexMarker735"/> then <a id="_idIndexMarker736"/>see this screen:</p>
			<div><div><img src="img/B18868_13_05.jpg" alt="Figure 13.5 – Keystore assigned"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.5 – Keystore assigned</p>
			<p>At this point, you should be finished for those working on iOS, but for those wishing to <a id="_idIndexMarker737"/>target Google Play, there are some<a id="_idIndexMarker738"/> additional tasks we will need to complete.</p>
			<p>Google Play requires a newer version of their Billing Library to be used so we will need to update <a id="_idIndexMarker739"/>the Unity <strong class="bold">In App Purchase</strong> (<strong class="bold">IAP</strong>) package.</p>
			<ol>
				<li value="15">From the Unity Editor, go to the <code>Assets</code> folder, right-click, and select <code>Packages</code> folder and open the <code>manifest.json</code> file in a text editor of your choice. Next, find the following line:<pre class="source-code">
"com.unity.purchasing": "4.1.5",</pre></li>
				<li>Update it to <code>"</code><code>com.unity.purchasing": "4.4.1",</code>.</li>
				<li>Save the file and return to the Unity Editor, and it should update the package. However, this will also introduce a bug to our previous code that will cause the ads to not display correctly on our devices. So, with that in mind, open up the <code>UnityAdController</code> script <a id="_idIndexMarker740"/>and add the following <a id="_idIndexMarker741"/>code to the class:<pre class="source-code">
 public bool rewardCalled = false;
// To account for a bug in Unity Advertisements 4.0.1
// with Google
// Play we have to add a way for UnityAdsShowComplete
// to be
// called by ourselves as well if it isn't called by
// Unity
IEnumerator RewardRoutine(string placementId)
{
    rewardCalled = false;
    yield return new WaitForSecondsRealtime(0.25f);
    while (Advertisement.isShowing)
    {
        yield return null;
    }
    Debug.Log("Done");
    // If reward wasn't called yet, call it
    if(!rewardCalled)
    {
        OnUnityAdsShowComplete(placementId,
            UnityAdsShowCompletionState.COMPLETED);
    }
}</pre></li>
				<li>Then, update<a id="_idIndexMarker742"/> the <code>ShowAd</code> function to the<a id="_idIndexMarker743"/> following:<pre class="source-code">
/// &lt;summary&gt;
/// Will load and display an ad on the screen
/// &lt;/summary&gt;
public void ShowAd()
{
<strong class="bold">    // Add fix for Unity Ads bug</strong>
<strong class="bold">    StartCoroutine(RewardRoutine(GetAdID()));</strong>
    // Display it after it is loaded
    Advertisement.Show(GetAdID(), instance);
}</pre></li>
				<li>We are also required to load our ads now ahead of time, so update the <code>Start</code> function to the following:<pre class="source-code">
/// &lt;summary&gt;
/// Unity Ads must be initialized, or else ads will
/// not work properly
/// &lt;/summary&gt;
private void Start()
{
    /* No need to initialize if it already is done */
    if (!Advertisement.isInitialized || instance ==
        null)
    {
        instance = this;
        // Use the functions provided by this to allow
        // custom
        Advertisement.Initialize(gameId, testMode);
        // Load an Ad to play
        Advertisement.Load(GetAdID());
    }
}</pre></li>
				<li>On that same<a id="_idIndexMarker744"/> line <a id="_idIndexMarker745"/>of thinking, <code>OnUnityAdsShowComplete</code> now needs to be updated to only happen once, so we add a check to see whether the reward was given yet. Also, after the ad has been completed, we load a new ad:<pre class="source-code">
/// &lt;summary&gt;
/// This callback method handles logic for the ad
/// finishing.
/// &lt;/summary&gt;
/// &lt;param name="placementId"&gt;The identifier for
/// the Ad Unit showing the content&lt;/param&gt;
/// &lt;param name="showCompletionState"&gt;Indicates
/// the final state of the ad (whether the ad was
    /// skipped or completed).&lt;/param&gt;
    public void OnUnityAdsShowComplete(string
        placementId, UnityAdsShowCompletionState
            showCompletionState)
    {
<strong class="bold">        if(!rewardCalled)</strong>
<strong class="bold">        {</strong>
            if (obstacle != null &amp;&amp;
                showCompletionState ==
                UnityAdsShowCompletionState.COMPLETED)
            {
                obstacle.Continue();
            }
            /* Unpause game when ad is over */
            PauseScreenBehaviour.paused = false;
            Time.timeScale = 1f;
            rewardCalled = true;
<strong class="bold">            // Load an Ad to play</strong>
<strong class="bold">            </strong><strong class="bold">Advertisement.Load(GetAdID());</strong>
<strong class="bold">        }</strong>
    }</pre></li>
			</ol>
			<p>Google Play also stipulates that ads cannot be played at the beginning of a level, so we will need to adjust our scripts for that. Open up the <code>PauseScreenBehaviour.cs</code> file<a id="_idIndexMarker746"/> and <a id="_idIndexMarker747"/>adjust the <code>Start</code> function:</p>
			<pre class="source-code">
protected override void Start()
{
    /* Initialize Ads if needed */
    base.Start();
    //if (!UnityAdController.showAds)
    //{
    //    /* If not showing ads, just start the game
    //    */
    //    SetPauseMenu(false);
    //}
    // Can no longer show ads at the Start of the game
    SetPauseMenu(false);
}</pre>
			<ol>
				<li value="21">Then go<a id="_idIndexMarker748"/> to <code>MainMenuBehaviour</code> and update the <code>LoadLevel</code> script:<pre class="source-code">
/// &lt;summary&gt;
/// Will load a new scene upon being called
/// &lt;/summary&gt;
/// &lt;param name="levelName"&gt;The name of the level we
/// want to go to&lt;/param&gt;
public void LoadLevel(string levelName)
{
    /* Can no longer show an ad upon starting gameplay
    */
    try
    {
        if (UnityAdController.showAds &amp;&amp; levelName !=
            "Gameplay")
        {
            /* Show an ad */
            UnityAdController.instance.ShowAd();
        }
        else
        {
            Time.timeScale = 1f;
        }
    }
    catch { }
    SceneManager.LoadScene(levelName);
}</pre></li>
				<li>Save all of the scripts we’ve worked on and return to the Unity Editor.</li>
			</ol>
			<p>In the editor, return to the <strong class="bold">Gameplay</strong> level and select the <strong class="bold">Resume</strong> button. From there, go to the <strong class="bold">On Click</strong> event and ensure that the <strong class="bold">Show Pause</strong> button has a <strong class="bold">Set Active</strong> to true event. This way, when we click the <strong class="bold">Resume</strong> button, we will be <a id="_idIndexMarker749"/>able to<a id="_idIndexMarker750"/> pause the game again:</p>
			<div><div><img src="img/B18868_13_06.jpg" alt="Figure 13.6 – Turning on the pause menu"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.6 – Turning on the pause menu</p>
			<ol>
				<li value="23">We will also want to make sure that Unity Gaming Services is always initialized. One way to do this<a id="_idIndexMarker751"/> is by going to <strong class="bold">Services</strong> | <strong class="bold">In-App Purchasing</strong> | <strong class="bold">IAP Catalog</strong> and checking the <strong class="bold">Automatically initialize Unity Gaming Services</strong> property. Otherwise, we may get a bug with the Codeless IAP that we added earlier:</li>
			</ol>
			<div><div><img src="img/B18868_13_07.jpg" alt="Figure 13.7 – Automatically initializing Unity Gaming Services"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.7 – Automatically initializing Unity Gaming Services</p>
			<p>The Google <a id="_idIndexMarker752"/>Play<a id="_idIndexMarker753"/> Store also now requires new apps to<a id="_idIndexMarker754"/> be an <strong class="bold">Android App Bundle</strong> (<strong class="bold">AAB</strong>) instead<a id="_idIndexMarker755"/> of an <strong class="bold">Android Application Package</strong> (<strong class="bold">APK</strong>), so we will need to configure the application to be an AAB instead.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">For more information on why this change, check out <a href="https://android-developers.googleblog.com/2021/06/the-future-of-android-app-bundles-is.html&#13;">https://android-developers.googleblog.com/2021/06/the-future-of-android-app-bundles-is.html.</a></p>
			<ol>
				<li value="24">Under <strong class="bold">Publishing Settings</strong>, enable <strong class="bold">Split </strong><strong class="bold">Application Binary</strong>.</li>
				<li>I also set <code>API level 31</code> as that is what Google Play is asking applications<a id="_idIndexMarker756"/> to currently target though it may <a id="_idIndexMarker757"/>be a larger number in the future. This may cause Unity to ask you to download an update to your Android <strong class="bold">software development kit</strong> (<strong class="bold">SDK</strong>) when<a id="_idIndexMarker758"/> you make a build.</li>
				<li>In addition, Google Play requires us to support ARM64, so to do that, under <strong class="bold">Configuration</strong>, change <strong class="bold">Scripting Backend</strong> to <strong class="bold">IL2CPP</strong> to enable the option and afterward check the <strong class="bold">ARM64</strong> option.</li>
				<li>Next, go to <strong class="bold">File</strong> | <strong class="bold">Build Settings</strong> and enable <strong class="bold">Build App Bundle (Google Play)</strong>. Also, make sure to uncheck <strong class="bold">Development Build</strong> if it is checked; Google Play currently does not support development builds:</li>
			</ol>
			<div><div><img src="img/B18868_13_08.jpg" alt="Figure 13.8 – Build App Bundle"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 13.8 – Build App Bundle</p>
			<ol>
				<li value="28">Lastly, we also <a id="_idIndexMarker759"/>will <a id="_idIndexMarker760"/>need to disable debugging from the <code>AndroidManifest</code> file. From the Unity Editor, go to the <code>Plugins\Android</code> folder, and open the <code>AndroidManifest.xml</code> file. From there, search for the <code>android:debuggable="true"</code> line and change <code>"true"</code> to <code>"false"</code> and save the file.</li>
			</ol>
			<p>The app manifest is something that every Android project must have, which tells Android all of the different components that the app has as well as all the permissions that the applications need to have in order for the project to have to work. For security reasons, you need to disable debugging before an application can be published in Google Play.</p>
			<ol>
				<li value="29">Go back to the <strong class="bold">Build Settings</strong> menu and then hit the <strong class="bold">Build</strong> button and give your project a name.</li>
				<li>If all goes <a id="_idIndexMarker761"/>well, you should see the file get created <a id="_idIndexMarker762"/>as a <code>.aab</code> file, which can then be uploaded to the Google Play Store!</li>
			</ol>
			<h2 id="_idParaDest-146"><a id="_idTextAnchor375"/>Summary</h2>
			<p>It is exciting to see all the hard work come together in a finished product that is ready to be shared with the world. The process of building a release copy of your game and updating the build settings is an important step toward making your game ready for distribution.</p>
			<p>However, the ultimate goal of any game development project is to release the game to the public and have it played by as many people as possible. This is where the process of submitting your game to the app stores comes into play. In the next chapter, we will delve into the details of how to successfully submit your game to both the Google Play St<a id="_idTextAnchor376"/><a id="_idTextAnchor377"/><a id="_idTextAnchor378"/><a id="_idTextAnchor379"/><a id="_idTextAnchor380"/><a id="_idTextAnchor381"/><a id="_idTextAnchor382"/><a id="_idTextAnchor383"/><a id="_idTextAnchor384"/><a id="_idTextAnchor385"/><a id="_idTextAnchor386"/><a id="_idTextAnchor387"/><a id="_idTextAnchor388"/><a id="_idTextAnchor389"/><a id="_idTextAnchor390"/><a id="_idTextAnchor391"/><a id="_idTextAnchor392"/><a id="_idTextAnchor393"/><a id="_idTextAnchor394"/><a id="_idTextAnchor395"/><a id="_idTextAnchor396"/><a id="_idTextAnchor397"/><a id="_idTextAnchor398"/><a id="_idTextAnchor399"/><a id="_idTextAnchor400"/><a id="_idTextAnchor401"/><a id="_idTextAnchor402"/><a id="_idTextAnchor403"/><a id="_idTextAnchor404"/><a id="_idTextAnchor405"/><a id="_idTextAnchor406"/><a id="_idTextAnchor407"/><a id="_idTextAnchor408"/><a id="_idTextAnchor409"/>ore and the iOS App Store.</p>
		</div>
	</body></html>