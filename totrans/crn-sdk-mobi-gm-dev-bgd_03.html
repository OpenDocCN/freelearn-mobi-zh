<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Building our First Game: Breakout"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Building our First Game: Breakout</h1></div></div></div><div class="blockquote"><blockquote class="blockquote"><p>Up until now, we have gone through some important basics of programming in Lua and applying some code to run in the Corona simulator. Knowing the terminology is a small part of learning how to make an application. We'll need to take a step further and get some hands on experience on what it's like to structure a project from beginning to finish. We're going to accomplish this by creating our first game from scratch. This will push you further into understanding larger chunks of code and applying some game logic to make a functional game.</p></blockquote></div><p>By the end of this chapter, you will understand the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Structuring game files in a Corona project</li><li class="listitem" style="list-style-type: disc">Creating variables for the game</li><li class="listitem" style="list-style-type: disc">Adding game objects to the screen</li><li class="listitem" style="list-style-type: disc">Making an alert message</li><li class="listitem" style="list-style-type: disc">Displaying score and level number</li></ul></div><p>Let the fun begin!</p><div class="section" title="Breakout—bringing back old-school gaming"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec01"/>Breakout—bringing back old-school gaming</h1></div></div></div><p>You have probably seen many forms of the game Breakout in the past couple of decades, especially during the Atari days. To give you a good idea of what the game is about, here is a brief editorial by Big Fish Games about the history of Breakout:<a class="ulink" href="http://www.bigfishgames.com/blog/the-history-of-breakout/"> http://www.bigfishgames.com/blog/the-history-of-breakout/</a>.<a id="id193" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/1888_03_01.jpg" alt="Breakout—bringing back old-school gaming"/></div><p>On the game screen, there are several columns and rows of bricks placed near the top of the screen. A ball travels across the screen, bouncing off the top and side walls of the screen. When a brick is hit, the ball bounces away and the brick is destroyed. The player loses the round when the ball touches the bottom of the screen. To prevent this from happening, the player has a movable paddle to bounce the ball upward, keeping it in play.<a id="id194" class="indexterm"/>
</p><p>We're going to be creating a clone using touch events and the accelerometer for paddle movement that will be controlled by the player. We'll be adding some physics to the ball so it can bounce throughout the screen.</p><p>In the next chapter, we'll be adding the movement of the game objects, collision detection, score keeping, and win/lose conditions. Right now, we're going to focus on how to set up the game template of Breakout.</p></div></div>
<div class="section" title="Understanding Corona physics API"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec02"/>Understanding Corona physics API</h1></div></div></div><p>Corona has made it convenient to add physics to your games, especially if you've never worked on one before. The engine uses<span class="strong"><strong> Box2D</strong></span> and takes only a few lines to incorporate it into your application than what it normally takes to have it set up.<a id="id195" class="indexterm"/>
</p><p>Working with the physics engine in Corona is fairly easy. You use display objects and set them as a physical body in your code. Images, sprites, and vector shapes can be turned into a physical object. This is substantial in visualizing how you want your objects to react in an environment you have created. You can see results right away rather than guessing how they might act in a physical world.</p><div class="section" title="Setting up the physics world"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec01"/>Setting up the physics world</h2></div></div></div><p>Making the physics engine available in your app requires the following line:<a id="id196" class="indexterm"/>
</p><p>
<code class="literal">local physics = require "physics"</code>
</p><div class="section" title="Starting, pausing, and stopping physics"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec01"/>Starting, pausing, and stopping physics</h3></div></div></div><p>There are three main functions that affect the physics simulation:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">physics.start():</code> This will start or resume the physical environment. It is usually activated at the beginning of the application for physics bodies to take effect.</li><li class="listitem" style="list-style-type: disc"><code class="literal">physics.pause():</code> This stops the physics engine temporarily.<a id="id197" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">physics.stop():</code>This basically destroys the physical world altogether.<a id="id198" class="indexterm"/></li></ul></div></div><div class="section" title="physics.setGravity"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec02"/>physics.setGravity</h3></div></div></div><p>This function returns the x and y parameters of the global gravity vector, in units of meter per second square (acceleration units). The default is (0, 9.8) to simulate standard Earth gravity, pointing downwards on the y-axis. For example,<a id="id199" class="indexterm"/>
</p><p>Syntax: <code class="literal">physics.setGravity(gx, gy)</code>
<a id="id200" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">physics.setGravity( 0, 9.8 ): Standard Earth gravity
</pre></div></div><div class="section" title="physics.getGravity"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec03"/>physics.getGravity</h3></div></div></div><p>This function returns the x and y parameters of the global gravity vector, in units of meter per second square (acceleration units).<a id="id201" class="indexterm"/>
</p><p>Syntax: <code class="literal">gx, gy = physics.getGravity()</code>
<a id="id202" class="indexterm"/>
</p></div><div class="section" title="Tilt-based gravity"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec04"/>Tilt-based gravity</h3></div></div></div><p>When you have physics.setGravity(gx, gy) and accelerometer API applied, implementing tilt-based dynamic gravity is simple. The following is an example of creating the tilt-based function:</p><div class="informalexample"><pre class="programlisting">function movePaddle(event)
paddle.x = display.contentCenterX - (display.contentCenterX * (event.yGravity*3))
end
Runtime:addEventListener( "accelerometer", movePaddle )
</pre></div><p>The accelerometer is not present in the Corona Simulator; a device build must be created to see the effect.</p></div><div class="section" title="physics.setScale"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec05"/>physics.setScale</h3></div></div></div><p>This function sets the internal pixels-per-meter ratio used in converting between the onscreen Corona coordinates and simulated physics coordinates. This should be done before any physical objects are instantiated.</p><p>The default scaling value is 30. For devices of higher resolution like iPad, Android, or iPhone 4, you may wish to increase this value to 60 or more.</p><p>Syntax: <code class="literal">physics.setScale( value )</code>
</p><div class="informalexample"><pre class="programlisting">physics.setScale( 60 )
</pre></div></div><div class="section" title="physics.setDrawMode"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec06"/>physics.setDrawMode</h3></div></div></div><p>There are three rendering modes for the physics engine. This can be altered at any time.</p><p>Syntax: <code class="literal">physics.setDrawMode( mode )</code>
<a id="id203" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">physics.setDrawMode( "debug" ):</code> This mode shows collision engine outlines only<a id="id204" class="indexterm"/><div class="mediaobject"><img src="graphics/1888_03_02.jpg" alt="physics.setDrawMode"/></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">physics.setDrawMode( "hybrid" ):</code> This mode overlays collision outlines on normal Corona objects<a id="id205" class="indexterm"/><div class="mediaobject"><img src="graphics/1888_03_03.jpg" alt="physics.setDrawMode"/></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">physics.setDrawMode( "normal" ):</code> This mode is the default Corona renderer, with no collision outlines<a id="id206" class="indexterm"/><div class="mediaobject"><img src="graphics/1888_03_04.jpg" alt="physics.setDrawMode"/></div></li></ul></div><p>The physics data is displayed using color-coded vector graphics, which reflect different object types and attributes:<a id="id207" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Orange</strong></span>—dynamic physics bodies (the default body type)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Dark blue</strong></span>—kinematic physics bodies</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Green</strong></span>—static physics bodies such as the ground or walls</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Gray</strong></span>—a body that is<span class="emphasis"><em> sleeping</em></span> due to lack of activity</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Light blue</strong></span>—joints</li></ul></div></div><div class="section" title="physics.setPositionIterations"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec07"/>physics.setPositionIterations</h3></div></div></div><p>This function sets the accuracy of the engine's position calculations. The default value is <code class="literal">8</code>, meaning that the engine will iterate through eight position approximations per frame for every object but will increase processor engagement, so it should be handled carefully because it might slow down the application.<a id="id208" class="indexterm"/>
</p><p>Syntax: <code class="literal">physics.setPositionIterations( value )</code>
</p><div class="informalexample"><pre class="programlisting">physics.setPositionIterations( 16 )
<a id="id209" class="indexterm"/>
</pre></div></div><div class="section" title="physics.setVelocityIterations"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec08"/>physics.setVelocityIterations</h3></div></div></div><p>This function sets the accuracy of the engine's velocity calculations. The default value is <code class="literal">3</code>, meaning that the engine will iterate through three velocity approximations per frame for every object but will increase processor engagement, so it should be handled carefully because it might slow down the application.<a id="id210" class="indexterm"/>
</p><p>Syntax: <code class="literal">physics.setVelocityIterations( value )</code>
<a id="id211" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">physics.setVelocityIterations( 6 )
</pre></div></div></div></div>
<div class="section" title="Configuring the application"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec03"/>Configuring the application</h1></div></div></div><p>This tutorial is compatible for both iOS and Android devices. The graphics have been designed to accommodate the varying screen dimensions of both platforms.</p><div class="section" title="Build configuration"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec02"/>Build configuration</h2></div></div></div><p>By default, all items displayed on all device screens are shown in portrait mode. We'll be creating this game specifically in landscape mode, so we'll have to alter some build settings and configure how all the items on screen will be displayed. Playing the game in landscape mode will actually add more player interactivity since the paddle will have more screen space to move about and less airtime for the ball.<a id="id212" class="indexterm"/>
</p></div></div>
<div class="section" title="Time for action&#x2014;adding build.settings file"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec04"/>Time for action—adding build.settings file</h1></div></div></div><p>Build-time properties can be provided in an optional <code class="literal">build.settings</code> file, which uses Lua syntax. The <code class="literal">build.settings</code> file is used to set application orientation and auto-rotation behavior, along with a variety of platform-specific build parameters.<a id="id213" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create a new project folder on your desktop called <code class="literal">Breakout</code>.</li><li class="listitem">In your preferred text editor, make a new file called <code class="literal">build.settings</code> and save it to your project folder.</li><li class="listitem">Type in the following lines:<div class="informalexample"><pre class="programlisting">settings =
{
orientation =
{
default = "landscapeRight",
}
}
</pre></div></li><li class="listitem">Save and close. The <code class="literal">build.settings</code> file is completed.</li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec03"/>What just happened?</h2></div></div></div><p>The default orientation setting determines the initial launch orientation on the device, and also the initial orientation of the Corona simulator.<a id="id214" class="indexterm"/>
</p><p>The default orientation doesn't affect Android devices. The orientation is initialized to the actual orientation of the device (unless only one orientation is specified). Also, the only supported orientations are <code class="literal">landscapeRight</code> and portrait. On a device, you can flip to either <code class="literal">landscapeRight</code> or <code class="literal">landscapeLeft</code>, but the operating system only reports one flavor of landscape, and Corona's orientation event chooses <code class="literal">landscapeRight</code>.</p><p>We have created this application to work with landscape orientations, supporting <code class="literal">landscapeRight</code>. We have set this orientation as its default so it won't switch to <code class="literal">landscapeLeft</code> or even any portrait mode. While working on an iOS device, if the <code class="literal">build.settings</code> aren't set before launching the application, it will go to the default portrait mode.</p></div><div class="section" title="Runtime configuration"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec04"/>Runtime configuration</h2></div></div></div><p>Currently our project is not scaled to display evenly for cross-platform development. The contents will still display on the device, but most likely not in the correct aspect ratio.<a id="id215" class="indexterm"/>
</p><p>For example, iPhone projects are designed for a 320 pixel wide screen and can be up scaled to the 480 pixel wide screen for Android devices. This makes porting easier, since the code and art assets do not need to be revised.<a id="id216" class="indexterm"/>
</p><p>Corona can target builds made for iPhone 4 and other current iOS devices that display double resolution art assets while remaining iOS 3.0-compatible. This means that pre-iPhone 4 content will no longer upscale automatically to the larger iPhone 4 screen resolution. As iOS development progresses, content scaling will generally be required in new iPhone apps to be compatible with devices such as the iPhone 3GS and lower.</p></div></div>
<div class="section" title="Time for action&#x2014;adding config.lua file"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec05"/>Time for action—adding config.lua file</h1></div></div></div><p>If no content size is specified, the content width and height returned will be the same as the physical screen width and height of the device. If you specify a different content width and height in <code class="literal">config.lua</code>, the content width and height will take on those values.<a id="id217" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">In your text editor, create a new file called <code class="literal">config.lua</code> and save it to your project folder.</li><li class="listitem">Type in the following lines:<div class="informalexample"><pre class="programlisting">application =
{
content =
{
width = 320,
height = 480,
scale = "letterbox",
fps = 60,
},
}
</pre></div></li><li class="listitem">Save and close your file.</li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec05"/>What just happened?</h2></div></div></div><p>The content width and height allow you to choose a virtual screen size that is independent of the physical device screen size. We have set the size to target the original iPhone since it displays the smallest dimensions across all the devices on both iOS and Android platforms. The original iPhone has dimensions of 320 x 480. With this configuration, it'll still scale evenly for the iPad, which has dimensions of 768 x 1024.</p><p>The scale used for this application is set to <code class="literal">letterbox</code>. It will uniformly scale up content as much as possible, while still showing all content on the screen. This will create a widescreen look, which will be compatible with the Droid, which has a longer screen than the iPhone 3GS.</p><p>We set <code class="literal">fps = 60</code>. By default, the frame rate is 30 fps. In this application, this will make the movement of the ball appear faster and allow us to increase the speed conveniently. We can stretch the frame rate to a maximum of 60 fps that Corona can allow.</p></div></div>
<div class="section" title="Building the application"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec06"/>Building the application</h1></div></div></div><p>Now that we have configured our application to landscape mode and set the display contents to scale on multiple devices, we're ready to start designing the game. Before we start writing some code for the game, we need to add in some art assets that will be displayed on the screen. You can find them in the <code class="literal">Chapter 3 Resources</code> folder. You can download the project files accompanying this book from the Packt website. The following files that you'll need to add to your <code class="literal">Breakout</code> project folder are as follows:<a id="id218" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">alertBox.png</li><li class="listitem" style="list-style-type: disc">bg.png</li><li class="listitem" style="list-style-type: disc">mmScreen.png</li><li class="listitem" style="list-style-type: disc">ball.png</li><li class="listitem" style="list-style-type: disc">paddle.png</li><li class="listitem" style="list-style-type: disc">brick.png</li><li class="listitem" style="list-style-type: disc">playbtn.png</li></ul></div><div class="section" title="Displaying groups"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec06"/>Displaying groups</h2></div></div></div><p>An important function we'll be introducing in this game is <code class="literal">display.newGroup().</code> Groups allow you to add and remove child display objects. Initially, there are no children in a group. The local origin is at the parent object's origin; the reference point is initialised to this local origin. You can easily organize your display objects in separate groups and refer to them by their group name. For example, in Breakout, we'll combine menu items such as the<span class="strong"><strong> Title</strong></span> screen and<span class="strong"><strong> Play</strong></span> button in a group called <code class="literal">menuScreenGroup</code>. Every time we access <code class="literal">menuScreenGroup,</code> any display object defined by the group name will be called.<a id="id219" class="indexterm"/>
</p><div class="section" title="display.newGroup()"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec09"/>display.newGroup()</h3></div></div></div><p>This function creates a group in which you can add and remove child display objects.</p><p>Syntax: <code class="literal">display.newGroup()</code>
</p><p>Example:</p><div class="informalexample"><pre class="programlisting">local rect = display.newRect(0, 0, 150, 150)
rect:setFillColor(255, 255, 255)
local myGroup = display.newGroup()
myGroup:insert( rect )
</pre></div></div></div><div class="section" title="Working with system functions"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec07"/>Working with system functions</h2></div></div></div><p>The system functions we're going to introduce in this chapter will return information about the system (get device information, current orientation) and control system functions (enabling Multi-touch, controlling the idle time, Accelerometer, GPS). We'll be using the following system functions to return environment information on which our application will be running and the response frequency for accelerometer events.<a id="id220" class="indexterm"/>
</p><div class="section" title="system.getInfo()"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec10"/>system.getInfo()</h3></div></div></div><p>This function returns information about the system on which the application is running.<a id="id221" class="indexterm"/>
</p><p>Syntax: <code class="literal">system.getInfo( param )</code>
<a id="id222" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">print( system.getInfo( "name" ) ) -- display the deviceID
</pre></div><p>Valid values for parameters are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">"name"</code>—returns the name. For example, on the iTouch, this would be the name of the phone as it appears in iTunes,<span class="emphasis"><em> Pat's iTouch</em></span>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">"model"</code>—returns the device type. These include:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">"iPhone"</li><li class="listitem" style="list-style-type: disc">"iPad"</li><li class="listitem" style="list-style-type: disc">"iPhone Simulator"</li><li class="listitem" style="list-style-type: disc">"Nexus One"</li><li class="listitem" style="list-style-type: disc">"Droid"</li><li class="listitem" style="list-style-type: disc">"myTouch"</li><li class="listitem" style="list-style-type: disc">"Galaxy Tab"</li></ul></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">"deviceID"</code>—returns the unique id of the device.</li><li class="listitem" style="list-style-type: disc"><code class="literal">"environment"</code>—returns the environment that the app is running in. These include:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">"simulator":</code> The Corona Simulator</li><li class="listitem" style="list-style-type: disc"><code class="literal">"device":</code> iOS, Android device, and the Xcode Simulator</li></ul></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">"platformName"</code>—returns the platform name (the OS name), that is, one of the following:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Mac OS X (Corona Simulator on Mac)</li><li class="listitem" style="list-style-type: disc">Win (Corona Simulator on Windows))</li><li class="listitem" style="list-style-type: disc">iPhone OS (all iOS devices))</li><li class="listitem" style="list-style-type: disc">Android (all Android devices))</li></ul></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">"platformVersion"</code>—returns a string representation of the platform version.</li><li class="listitem" style="list-style-type: disc"><code class="literal">"version"</code>—returns the version of Corona used.</li><li class="listitem" style="list-style-type: disc"><code class="literal">"build"</code>—returns the Corona build string.</li><li class="listitem" style="list-style-type: disc"><code class="literal">"textureMemoryUsed"</code>—returns the texture memory usage in bytes.</li><li class="listitem" style="list-style-type: disc"><code class="literal">"maxTextureSize"</code>—returns the maximum texture width or height supported by the device.</li><li class="listitem" style="list-style-type: disc"><code class="literal">"architectureInfo"</code>—returns a string describing the underlying CPU architecture of the device you are running on.</li></ul></div></div><div class="section" title="system.setAccelerometerInterval()"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec11"/>system.setAccelerometerInterval()</h3></div></div></div><p>This function sets the frequency of accelerometer events. The minimum frequency is 10 Hz and the maximum is 100 Hz on the iPhone. Accelerometer events are a significant drain on battery; so only increase the frequency when you need faster responses in games. Always try to lower the frequency whenever possible to conserve battery life.<a id="id223" class="indexterm"/>
</p><p>Syntax: <code class="literal">system.setAccelerometerInterval( frequency )</code>
<a id="id224" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">system.setAccelerometerInterval( 75 )
</pre></div><p>The function sets the sample interval in Hertz. Hertz is cycles per second, the number of measurements to take per second. If you set the frequency to 75, then the system will take 75 measurements per second.</p><p>After you have added the assets from the Chapter 3 Resources folder into your project folder, let's begin writing some code!</p></div></div></div>
<div class="section" title="Time for action&#x2014;creating variables for the game"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec07"/>Time for action—creating variables for the game</h1></div></div></div><p>For any application to start we'll need to make a <code class="literal">main.lua</code> file. This has been discussed in the previous chapter when we worked with some sample code and ran it with the simulator.<a id="id225" class="indexterm"/>
</p><p>The code will be structured accordingly in your <code class="literal">main.lua</code> by the time the game is completed:</p><p>
<code class="literal">Necessary Classes</code> (For example: physics or ui)</p><p>
<code class="literal">Variables and Constants</code>
</p><p>
<code class="literal">Main Function</code>
</p><p>
<code class="literal">Object Methods</code>
</p><p>
<code class="literal">Call Main Function</code> (This always has to be called or your application will not run)</p><p>Formatting your code to make it look like the preceding structure is good practice on keeping things organized and running your application efficiently.<a id="id226" class="indexterm"/>
</p><p>In this section, we'll be introducing the display group that will show the<span class="strong"><strong> Main Menu</strong></span> screen and a<span class="strong"><strong> Play</strong></span> button that the user will be able to interact with to move on to the<span class="strong"><strong> Main Game</strong></span> screen. All in-game elements such as the paddle, ball, brick objects, and heads-up display elements follow after the player interacts with the<span class="strong"><strong> Play</strong></span> button. We'll also be introducing win and lose conditions that will be referred to as the <code class="literal">alertDisplayGroup</code>. All these game elements will be initialized in the beginning of our code.</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create a new <code class="literal">main.lua</code> file in your text editor and save it to your project folder.</li><li class="listitem">We're going to hide the status bar (specifically for iOS devices) and load the physics engine. Corona uses the Box2D engine that is already built into the SDK.<div class="informalexample"><pre class="programlisting">display.setStatusBar(display.HiddenStatusBar)
local physics = require "physics"
physics.start()
physics.setGravity(0, 0)
system.setAccelerometerInterval( 100 )
</pre></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note16"/>Note</h3><p>More information on the Corona Physics API can be found on the Corona website at:<a class="ulink" href="http://developer.anscamobile.com/content/game-edition-box2d-physics-engine"> http://developer.anscamobile.com/content/game-edition-box2d-physics-engine</a>.</p><p>The Box2D physics engine used in Corona SDK was written by Erin Catto of Blizzard Entertainment. More information on Box2D can be found at:<a class="ulink" href="http://box2d.org/manual.pdf"> http://box2d.org/manual.pdf</a>.</p></div></li><li class="listitem">Add in the menu screen objects.<a id="id227" class="indexterm"/><div class="informalexample"><pre class="programlisting">local menuScreenGroup -- display.newGroup()
local mmScreen
local playBtn
</pre></div></li><li class="listitem">Add in the in-game screen objects.<div class="informalexample"><pre class="programlisting">local background
local paddle
local brick
local ball
</pre></div></li><li class="listitem">Add in HUD elements for the score and level.<div class="informalexample"><pre class="programlisting">local scoreText
local scoreNum
local levelText
local levelNum
</pre></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note20"/>Note</h3><p>The HUD is also known as the heads-up display. It is a method of visually representing character information on the game screen.</p></div></li><li class="listitem">Next, we'll add in the alert display group for the win/lose conditions.<div class="informalexample"><pre class="programlisting">local alertDisplayGroup -- display.newGroup()
local alertBox
local conditionDisplay
local messageText
</pre></div></li><li class="listitem">The following variables hold the values for the bricks display group, score, ball velocity, and in game events.<div class="informalexample"><pre class="programlisting">local _W = display.contentWidth / 2
local _H = display.contentHeight / 2
local bricks = display.newGroup()
local brickWidth = 35
local brickHeight = 15
local row
local column
local score = 0
local scoreIncrease = 100
local currentLevel
local vx = 3
local vy = -3
local gameEvent = ""
</pre></div></li><li class="listitem">Accelerometer events can only be tested on a device, so we're going to add a variable for touch events on the paddle by calling the<code class="literal">"simulator"</code> environment. This is so we can test the paddle movement in the Corona simulator. If you were to test the application on a device, the event listeners for touch and accelerometer on the paddle won't conflict.<a id="id228" class="indexterm"/><div class="informalexample"><pre class="programlisting">local isSimulator = "simulator" == system.getInfo("environment")
</pre></div></li><li class="listitem">Lastly, add in the <code class="literal">main()</code> function. This will start our application.<div class="informalexample"><pre class="programlisting">function main()
end
--[[
This empty space will hold other functions and methods to run the application
]]--
main()
</pre></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec08"/>What just happened?</h2></div></div></div><p>The <code class="literal">display.setStatusBar(display.HiddenStatusBar)</code> is only applicable to iOS devices. It hides the appearance of the status bar.</p><p>A new Corona API we added to this game is the physics engine. We'll be adding physics parameters to the main game objects (paddle, ball, and bricks) for collision detection. Having <code class="literal">setGravity(0,0)</code> will allow the ball to bounce throughout the playing field freely.<a id="id229" class="indexterm"/>
</p><p>
<code class="literal">local menuScreenGroup, local alertDisplayGroup</code>, and <code class="literal">local bricks</code> are all forms of display groups we can separate and organize our display objects to. For example, <code class="literal">local menuScreenGroup</code> is designated for the objects that show up on the<span class="strong"><strong> Main Menu</strong></span> screen; that way they can be removed as a group and not as individual objects.</p><p>Some of the variables added already have values that are applied to certain game objects. There is already a set velocity for the ball using <code class="literal">local vx = 3</code> and <code class="literal">local vy = -3</code>. The x and y velocity determines how the ball moves on the game screen. Depending on the position the ball collides with an object, the ball will follow a continuous path. The <code class="literal">brickWidth</code> and <code class="literal">brickHeight</code> have a value that will stay constant throughout the application so we can line the brick objects evenly onscreen.</p><p>
<code class="literal">local gameEvent = " "</code> will store the game events such as<code class="literal">"win", "lose"</code>, and<code class="literal">"finished"</code>. When a function checks the game status for any of these events, it will display the proper condition onscreen.</p><p>We have added some system functions as well. We created <code class="literal">local isSimulator = "simulator" == system.getInfo("environment")</code> so that it returns information about the system on which the application is running. This will be directed to the paddle touch events so that we can test the application in the simulator. If the build was to be ported on a device, you would only be able to use the accelerometer to move the paddle. The simulator can't test accelerometer events. The other system function is <code class="literal">system.setAccelerometerInterval( 100 )</code>. It sets the frequency of accelerometer events. The minimum frequency is 10 Hz and the maximum is 100 Hz on the iPhone.<a id="id230" class="indexterm"/>
</p><p>The empty function <code class="literal">main()</code> set will start out the display hierarchy. Think of it as a storyboard. The first thing you see is an introduction and then some action happens in the middle that tells you about the main content. In this case, the main content is the gameplay. The last thing you see is some kind of ending or closure to tie the story altogether. The ending is the display of the win/lose conditions at the end of a level.</p></div></div>
<div class="section" title="Understanding events and listeners"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec08"/>Understanding events and listeners</h1></div></div></div><p>Events are sent to listeners. Functions or objects can be event listeners. When an event occurs, the listener is called by a table representing the event. All events will have a property name that identifies the kind of event.<a id="id231" class="indexterm"/>
</p><div class="section" title="Register events"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec09"/>Register events</h2></div></div></div><p>Display objects and global Runtime objects can be event listeners. You can add and remove listeners for events using the following object methods:<a id="id232" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">object:addEventListener( ):</code> It adds a listener to the object's list of listeners. When the named event occurs, the listener will be invoked and be supplied with a table representing the event.<a id="id233" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">object:removeEventListener( ):</code> It removes the specified listener from the object's list of listeners so that it no longer is notified of events corresponding to the specified event.</li></ul></div><p>In the following example, an image display object registers to receive a touch event. Touch events are not broadcast globally. Display objects that register for the event and lie underneath it will be candidates for receiving the touch.<a id="id234" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">local playBtn = display.newImage("playbtn.png")
playBtn.name = "playbutton"
local function listener(event)
if event.target.name == "playbutton" then
print("The button was touched.")
end
end
playBtn:addEventListener("touch", listener )
</pre></div><p>Runtime events are sent by the system. They broadcast to all listeners. The following is an example of registering for an <code class="literal">enterFrame</code> event:</p><div class="informalexample"><pre class="programlisting">local playBtn = display.newImage("playbtn.png")
local function listener(event)
print("The button appeared.")
end
Runtime:addEventListener("enterFrame", listener )
</pre></div></div><div class="section" title="Runtime events"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec10"/>Runtime events</h2></div></div></div><p>The application we're creating uses runtime events. Runtime events have no specific target and are only sent to the global Runtime. They broadcast to all registered listeners. The following events all have string names and will be applied to the Breakout game:<a id="id235" class="indexterm"/>
</p><div class="section" title="enterFrame"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec12"/>enterFrame</h3></div></div></div><p>
<code class="literal">enterFrame</code> events occur at the frame interval of the application. They are only sent to the global Runtime object. For example, if the frame rate is 30fps, then it will occur approximately 30 times per second.<a id="id236" class="indexterm"/>
</p><p>Properties are available in this event:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">event.name</code> is the string<code class="literal">"enterFrame".</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">event.time</code> is the time in milliseconds since the start of the application.<a id="id237" class="indexterm"/></li></ul></div></div><div class="section" title="accelerometer"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec13"/>accelerometer</h3></div></div></div><p>Accelerometer events let you detect movements and determine the device's orientation in relation to gravity. These events are only sent to devices that support accelerometer. They are only sent to the global Runtime object.<a id="id238" class="indexterm"/>
</p><p>The following properties are available for this event:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">event.name</code> is the string<code class="literal">"accelerometer".</code><a id="id239" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">event.xGravity</code> is the acceleration due to gravity in the x-direction.<a id="id240" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">event.yGravity</code> is the acceleration due to gravity in the y-direction.<a id="id241" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">event.zGravity</code> is the acceleration due to gravity in the z-direction.<a id="id242" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">event.xInstant</code> is the instantaneous acceleration in the x-direction.<a id="id243" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">event.yInstant</code> is the instantaneous acceleration in the y-direction.<a id="id244" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">event.zInstant</code> is the instantaneous acceleration in the z-direction.<a id="id245" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">event.isShake</code> is true when the user shakes the device.<a id="id246" class="indexterm"/></li></ul></div></div></div><div class="section" title="Touch events"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec11"/>Touch events</h2></div></div></div><p>When the user's finger touches the screen, a hit event is generated and dispatched to display objects in the display hierarchy. Only those objects that intersect with the location of the finger on the screen will receive the event.<a id="id247" class="indexterm"/>
</p><div class="section" title="touch (single touch)"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec14"/>touch (single touch)</h3></div></div></div><p>Touch events are a special kind of hit event. When a user's finger touches the screen, they are starting a sequence of touch events, each with different phases.<a id="id248" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">event.name</code> is the string<code class="literal">"touch".</code><a id="id249" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">event.x</code> is the x-position in screen coordinates of the touch.</li><li class="listitem" style="list-style-type: disc"><code class="literal">event.y</code> is the y-position in screen coordinates of the touch.</li><li class="listitem" style="list-style-type: disc"><code class="literal">event.xStart</code> is the x-position of the touch from the<code class="literal">"began"</code> phase of the touch sequence.</li><li class="listitem" style="list-style-type: disc"><code class="literal">event.yStart</code> is the y-position of the touch from the<code class="literal">"began"</code> phase of the touch sequence.</li><li class="listitem" style="list-style-type: disc"><code class="literal">event.phase</code> is a string identifying where in the touch sequence the event occurred:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">"began"</code> a finger touched the screen.</li><li class="listitem" style="list-style-type: disc"><code class="literal">"moved"</code> a finger moved on the screen.</li><li class="listitem" style="list-style-type: disc"><code class="literal">"ended"</code> a finger was lifted from the screen.</li><li class="listitem" style="list-style-type: disc"><code class="literal">"cancelled"</code> the system cancelled tracking of the touch.</li></ul></div></li></ul></div></div><div class="section" title="tap"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec15"/>tap</h3></div></div></div><p>tap generates a hit event when the user touches the screen. The event is dispatched to display objects in the display hierarchy. This is similar to the <code class="literal">touch</code> event except a hit count (number of taps) is available in the event callback.<a id="id250" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">event.name</code> is the string<code class="literal">"tap"</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">event.numTaps</code> returns the number of taps on the screen.</li><li class="listitem" style="list-style-type: disc"><code class="literal">event.x</code> is the x-position in screen coordinates of the tap.</li><li class="listitem" style="list-style-type: disc"><code class="literal">event.y</code> is the y-position in screen coordinates of the tap.</li></ul></div></div></div></div>
<div class="section" title="Transitions"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec09"/>Transitions</h1></div></div></div><p>In this chapter, we'll be touching base with <code class="literal">transition.to()</code> and <code class="literal">transition.from()</code>.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">transition.to():</code> It animates a display object's properties over time using the <code class="literal">easing</code> transitions.<p>Syntax: <code class="literal">handle = transition.to( target, params )</code>
</p></li><li class="listitem" style="list-style-type: disc"><code class="literal">transition.from():</code> It is similar to <code class="literal">transition.to()</code> except the starting property values are specified in the function's parameter table and the final values are the corresponding property values in the target prior to the call.<a id="id251" class="indexterm"/><p>Syntax: <code class="literal">handle = transition.from( target, params )
</code>
</p><p>The parameters used are:
</p><p><code class="literal">target</code> - A display object that will be the target of the transition.
</p><p><code class="literal">params</code> - A table that specifies the properties of the display object, which will be animated, and one or more of the following optional non-animated properties:
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">params.time:</code> It specifies the duration of the transition in milliseconds. By default, the duration is 500 ms (0.5 seconds).</li><li class="listitem" style="list-style-type: disc"><code class="literal">params.transition:</code> It is by default <code class="literal">easing.linear</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">params.delay:</code> It specifies the delay, in milliseconds, (none by default) before the tween begins.</li><li class="listitem" style="list-style-type: disc"><code class="literal">params.delta:</code> It is a boolean specifying whether non-control parameters are interpreted as final ending values or as changes in value. The default is <code class="literal">nil</code> meaning false.</li><li class="listitem" style="list-style-type: disc"><code class="literal">params.onStart:</code> It is a function or table listener called before the tween begins.</li><li class="listitem" style="list-style-type: disc"><code class="literal">params.onComplete:</code> It is a function or table listener called after the tween completes.</li></ul></div></li></ul></div><p>For example:<a id="id252" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">_W = display.contentWidth
_H = display.contentHeight
local square = display.newRect( 0, 0, 100, 100 )
square:setFillColor( 255,255,255 )
square.x = _W/2; square.y = _H/2
local square2 = display.newRect( 0, 0, 50, 50 )
square2:setFillColor( 255,255,255 )
square2.x = _W/2; square2.y = _H/2
transition.to( square, { time=1500, x=250, y=400 } )
transition.from( square2, { time=1500, x=275, y=0 } )
</pre></div><p>The preceding example shows how two display objects transition throughout the space on a device screen. The <code class="literal">square</code> display object from it's current position will move to a new location of x = 250 and y = 400 in 1500 milliseconds. The <code class="literal">square2</code> display object will transition from x = 275 and y = 0 to it's initial location in 1500 milliseconds.</p></div>
<div class="section" title="Creating menu screens"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec10"/>Creating menu screens</h1></div></div></div><p>Having menu screens allows the player to transition through different parts of your application. Typically a game will start out with some kind of screen displaying the game title with an interactive user interface button labeled<span class="strong"><strong> Play</strong></span> or<span class="strong"><strong> Start</strong></span> to give the player the option to play the game. It is standard in any mobile application to have a menu screen before transitioning to the main content.<a id="id253" class="indexterm"/>
</p></div>
<div class="section" title="Time for action&#x2014;adding the main menu screen"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec11"/>Time for action—adding the main menu screen</h1></div></div></div><p>The<span class="strong"><strong> Main Menu</strong></span> screen will be the first thing in our menu system that the player interacts with after the application is launched. It's a great way to introduce the title of the game and also it gives the player an idea of what type of gaming environment they should expect. We wouldn't want the player to jump abruptly into the app without any proper notification. It's important to allow the player to prepare for what is to come when they launch the app.<a id="id254" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">We're going to create a function called <code class="literal">mainMenu()</code> to introduce the title screen. So after <code class="literal">function main()</code> ends, add in the following lines:<div class="informalexample"><pre class="programlisting">function mainMenu()
end
</pre></div></li><li class="listitem">We'll be adding in a display group and two display objects to this function. One display object is the image that will represent the<span class="strong"><strong> Main Menu</strong></span> screen and the other will be a UI button called<span class="strong"><strong> Play</strong></span>. Add them inside of <code class="literal">function mainMenu()</code>.<div class="informalexample"><pre class="programlisting">menuScreenGroup = display.newGroup()
mmScreen = display.newImage("mmScreen.png", 0, 0, true)
mmScreen.x = _W
mmScreen.y = _H
playBtn = display.newImage("playbtn.png")
playBtn:setReferencePoint(display.CenterReferencePoint)
playBtn.x = _W; playBtn.y = _H + 50
playBtn.name = "playbutton"
menuScreenGroup:insert(mmScreen)
menuScreenGroup:insert(playBtn)
</pre></div></li><li class="listitem">Remember the empty <code class="literal">main()</code> function set? We need to call <code class="literal">mainMenu()inside</code> of it. The entire function should look like this:<a id="id255" class="indexterm"/><div class="informalexample"><pre class="programlisting">function main()
mainMenu()
end
</pre></div></li><li class="listitem">After the <code class="literal">mainMenu()</code> function, we're going to create another function called <code class="literal">loadGame()</code>. It will initiate the event from <code class="literal">playbtn</code> to transition to the main game screen. The event will change the alpha of <code class="literal">menuScreenGroup</code> to <code class="literal">0</code>, which makes it appear invisible on the screen. Complete the transition by calling the <code class="literal">addGameScreen()</code> function (<code class="literal">addGameScreen()</code> will be discussed later in the chapter in<span class="emphasis"><em> Adding Game Objects</em></span> section).<div class="informalexample"><pre class="programlisting">function loadGame(event)
if event.target.name == "playbutton" then
transition.to(menuScreenGroup,{time = 0, alpha=0, onComplete = addGameScreen})
playBtn:removeEventListener("tap", loadGame)
end
end
</pre></div></li><li class="listitem">Next, we need to add in an event listener to <code class="literal">playBtn</code> so when it is tapped, it will call the <code class="literal">loadGame()</code> function. Add the following line in the <code class="literal">mainMenu()</code> function after the last method:<div class="informalexample"><pre class="programlisting">playBtn:addEventListener("tap", loadGame)
</pre></div></li><li class="listitem">Run the project in the simulator. You should see the<span class="strong"><strong> Main Menu</strong></span> screen display<span class="strong"><strong> Breakout</strong></span> and the<span class="strong"><strong> Play</strong></span> button.</li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec12"/>What just happened?</h2></div></div></div><p>Creating a<span class="strong"><strong> Main Menu</strong></span> screen only requires a couple of blocks of code. For <code class="literal">loadGame(event)</code>, we set a parameter called <code class="literal">event</code>. When the <code class="literal">if</code> statement is called, it takes <code class="literal">playbutton</code>, which references the display object <code class="literal">playBtn</code> and checks to see if it is true. Since it is, the <code class="literal">menuScreenGroup</code> will be removed from the stage and wil call on the <code class="literal">addGameScreen()</code> function. At the same time the event listener for <code class="literal">playBtn</code> is removed from the scene.<a id="id256" class="indexterm"/>
</p></div><div class="section" title="Have a go hero—creating a help screen"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec13"/>Have a go hero—creating a help screen</h2></div></div></div><p>Right now the design of the menu system is set up so that it goes from the<span class="strong"><strong> Main Menu</strong></span> screen and then transitions to the<span class="strong"><strong> Gameplay</strong></span> screen. You have the option to extend the menu screens without jumping into the game right away. After the<span class="strong"><strong> Main Menu</strong></span> screen, we can add an additional<span class="strong"><strong> Help Menu</strong></span> screen that will explain the player how to play the game.<a id="id257" class="indexterm"/>
</p><p>Create a new image in your preferred image editing program and write out steps on how to play the game. You can then create a new button called<span class="strong"><strong> Next</strong></span> and add both art assets to your project folder. In your code, you'll have to create a new function and event listener for your<span class="strong"><strong> Next</strong></span> button that will transition to the gameplay screen.</p></div></div>
<div class="section" title="Creating the gameplay scene"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec12"/>Creating the gameplay scene</h1></div></div></div><p>Now that we have a menu system in place, we can start on the gameplay elements of the application. We'll start adding all of the main game objects that the player will interact with. One thing to think about when adding in game objects is their placement on the screen. Given that this game will be played in landscape mode, we have to remember that there is plenty of space available in the x-direction and a smaller amount in the y-direction. Based on the original design of the game, the bottom wall of the screen causes the player to lose the level or turn if the ball lands in that area. So if you were to pinpoint an area to place the paddle object, we wouldn't set it near the top of the screen. It makes more sense for the paddle to be as close to the bottom of the screen to protect the ball better.<a id="id258" class="indexterm"/>
</p></div>
<div class="section" title="Time for action&#x2014;adding game objects"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec13"/>Time for action—adding game objects</h1></div></div></div><p>Let's add in the display objects the player will see while in gameplay.<a id="id259" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">After the <code class="literal">loadGame()</code> function, we're going to create another function that will display all our game objects on screen. The following lines will display the art assets that were created for this tutorial:<div class="informalexample"><pre class="programlisting">function addGameScreen()
background = display.newImage("bg.png", 0, 0, true )
background.x = _W
background.y = _H
paddle = display.newImage("paddle.png")
paddle.x = 240; paddle.y = 300
paddle.name = "paddle"
ball = display.newImage("ball.png")
ball.x = 240; ball.y = 290
ball.name = "ball"
</pre></div></li><li class="listitem">Next, we'll add in the text that will display the score and level number during the game.<a id="id260" class="indexterm"/><div class="informalexample"><pre class="programlisting">scoreText = display.newText("Score:", 5, 2, "Arial", 14)
scoreText:setTextColor(255, 255, 255, 255)
scoreNum = display.newText("0", 54, 2, "Arial", 14)
scoreNum:setTextColor(255, 255, 255, 255)
levelText = display.newText("Level:", 420, 2, "Arial", 14)
levelText:setTextColor(255, 255, 255, 255)
levelNum = display.newText("1", 460, 2, "Arial", 14)
levelNum:setTextColor(255, 255, 255, 255)
</pre></div></li><li class="listitem">To build the first game level we're going to call the <code class="literal">gameLevel1()</code> function, which will be explained later in this chapter. Don't forget to close the <code class="literal">addGameScreen()</code> function with <code class="literal">end</code>.<div class="informalexample"><pre class="programlisting">gameLevel1()
end
</pre></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec14"/>What just happened?</h2></div></div></div><p>The <code class="literal">addGameScreen()</code> function displays all the game objects shown during gameplay. We have added the <code class="literal">background, paddle</code>, and <code class="literal">ball</code> from the art assets provided for this chapter.<a id="id261" class="indexterm"/>
</p><p>We have added text for the score and level at the top of the game screen. <code class="literal">scoreNum</code> is initially set to <code class="literal">0</code>. We'll discuss in the next chapter how we will update the score number when a brick collision is made. <code class="literal">levelNum</code> starts at <code class="literal">1</code> and updates when the level is completed and moves on to the next one.</p><p>We ended the function by calling <code class="literal">gameLevel1()</code> which will be implemented in the next section to start the first level.</p></div></div>
<div class="section" title="Time for action&#x2014;building bricks"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec14"/>Time for action—building bricks</h1></div></div></div><p>The bricks are the last of the game objects we need to add in for this application. We'll be creating two different levels for this game. Each one will have a different brick layout from the other.<a id="id262" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">We're going to create the function for the first level. Let's create a new function, <code class="literal">gameLevel1()</code>. We will also set the <code class="literal">currentLevel = 1</code> since the application begins at<span class="strong"><strong> Level 1</strong></span>. Then we'll add in the <code class="literal">bricks</code> display group and set it <code class="literal">toFront()</code> so that it appears in front of the game background.<div class="informalexample"><pre class="programlisting">function gameLevel1()
currentLevel = 1
bricks:toFront()
</pre></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note200"/>Note</h3><p>The method, <code class="literal">object:toFront( )</code> moves the target object to the visual front of its parent group (object.parent). In this case, we are setting the <code class="literal">bricks</code> group to appear as the front most display group during gameplay so it appears in front of the background image.</p></div></li><li class="listitem">Next, add some local variables that will show how many rows and columns of bricks will be displayed on screen and where in the playing field each brick will be placed.<div class="informalexample"><pre class="programlisting">local numOfRows = 4
local numOfColumns = 4
local brickPlacement = {x = (_W) - (brickWidth * numOfColumns ) / 2 + 20, y = 50}
</pre></div></li><li class="listitem">Create double <code class="literal">for</code> loops, one for <code class="literal">numOfRows</code> and the other for <code class="literal">numOfColumns</code>. Create a brick instance placed according to its width, height, and the number corresponding to <code class="literal">numOfRows</code> and <code class="literal">numOfColumns</code>. The art asset for the brick display object is provided with this chapter. Afterwards, close the function with <code class="literal">end</code>.<div class="informalexample"><pre class="programlisting">for row = 0, numOfRows - 1 do
for column = 0, numOfColumns - 1 do
local brick = display.newImage("brick.png")
brick.name = "brick"
brick.x = brickPlacement.x + (column * brickWidth)
brick.y = brickPlacement.y + (row * brickHeight)
physics.addBody(brick, "static", {density = 1, friction = 0, bounce = 0})
bricks.insert(bricks, brick)
end
end
end
</pre></div></li><li class="listitem">The set up for<span class="strong"><strong> Level 2</strong></span> is similar to how<span class="strong"><strong> Level 1</strong></span> is arranged. The code is almost the same except our new function is called <code class="literal">gameLevel2(), currentLevel = 2</code>, and the values for <code class="literal">numOfRows</code> and <code class="literal">numOfColumns</code> have different values. Add this block after the <code class="literal">gameLevel1()</code> function.<a id="id263" class="indexterm"/><div class="informalexample"><pre class="programlisting">function gameLevel2()
currentLevel = 2
bricks:toFront()
local numOfRows = 5
local numOfColumns = 8
local brickPlacement = {x = (_W) - (brickWidth * numOfColumns ) / 2 + 20, y = 50}
for row = 0, numOfRows - 1 do
for column = 0, numOfColumns - 1 do
-- Create a brick
local brick = display.newImage("brick.png")
brick.name = "brick"
brick.x = brickPlacement.x + (column * brickWidth)
brick.y = brickPlacement.y + (row * brickHeight)
physics.addBody(brick, "static", {density = 1, friction = 0, bounce = 0})
bricks.insert(bricks, brick)
end
end
end
</pre></div></li><li class="listitem">Save your file and relaunch the simulator. You'll be able to interact with the<span class="strong"><strong> Play</strong></span> button and see the transition from the<span class="strong"><strong> Main Menu</strong></span> screen to the game screen. You will see the game layout for<span class="strong"><strong> Level 1</strong></span> displayed on screen.</li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec15"/>What just happened?</h2></div></div></div><p>The <code class="literal">bricks</code> display group is set <code class="literal">bricks:toFront()</code>. This means that the group will always be put in front of the display hierarchy apart from the <code class="literal">background, paddle</code>, and <code class="literal">ball</code> display objects.<a id="id264" class="indexterm"/>
</p><p>
<code class="literal">gameLevel1()</code> has set values for the amount of brick objects displayed in the playing field. They will be centered based on the <code class="literal">contentWidth</code> of the device shell and set at 50 in the y-direction. The brick group is placed near the top left-hand corner by <code class="literal">brickPlacement</code> and takes the middle of the screen and subtracts it by half the width of all the brick objects put together. Then we add 20 more pixels in the x-direction to center it with the paddle.</p><p>We created double <code class="literal">for</code> loops for <code class="literal">numOfRows</code> and <code class="literal">numOfColumns</code>, which start the creation of the brick objects from the left-hand corner of the screen.</p><p>Notice that the <code class="literal">brick</code> display object is given the name<code class="literal">"brick"</code>. Just remember that<code class="literal">"brick"</code> cannot be used the same way as <code class="literal">brick</code> when calling the object.<code class="literal">"brick"</code> is an instance of <code class="literal">brick</code>. It is merely used as a string when event parameters are called on. For example:</p><div class="informalexample"><pre class="programlisting">if event.other.name == "brick" and ball.x + ball.width * 0.5 event.other.x + event.other.width * 0.5 then
vx = -vx
elseif event.other.name == "brick" and ball.x + ball.width * 0.5 &gt;= event.other.x + event.other.width * 0.5 then
vx = vx
end
</pre></div><p>The physics body of <code class="literal">brick</code> is set to<code class="literal">"static"</code> so it is not affected by gravity pulling down. And then it is added to <code class="literal">bricks</code> group under <code class="literal">bricks.insert(bricks, brick)</code>.</p></div><div class="section" title="Have a go hero—focused platform gaming"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec16"/>Have a go hero—focused platform gaming</h2></div></div></div><p>Upon completing this chapter and the following, feel free to redesign the display images to focus on a specific platform. For example, you can easily convert the code to be compatible with all iOS devices. This can be done by converting display objects to <code class="literal">display.newImageRect( [parentGroup,] filename [, baseDirectory] w, h )</code> so you can substitute higher resolution images on devices with retina display, (that is iPhone 4/iPod Touch 4G). Remember that you'll have to adjust your configuration settings to have the changes applied. This pertains to adding the <code class="literal">@2x</code> image suffix (or your preferred suffix naming convention) to your <code class="literal">config.lua</code> file.</p></div></div>
<div class="section" title="Red alert!"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec15"/>Red alert!</h1></div></div></div><p>In every game there is some kind of message that tells you the status of your progress when the main action has ended. For this application, we need a way to let the player know if they have won or lost a round, how they can play again or when the game is officially completed.</p></div>
<div class="section" title="Time for action&#x2014;displaying game messages"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec16"/>Time for action—displaying game messages</h1></div></div></div><p>Let's set up some win/lose notifications so we can display these events occur in game:<a id="id265" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create a new function called <code class="literal">alertScreen()</code> and pass two parameters called <code class="literal">title</code> and <code class="literal">message</code>. Add in a new display object called <code class="literal">alertbox</code> and have it transition from an <code class="literal">xScale</code> and <code class="literal">yScale</code> of 0.5 using <code class="literal">easing.outExpo</code>.<div class="informalexample"><pre class="programlisting">function alertScreen(title, message)
alertBox = display.newImage("alertBox.png")
alertBox.x = 240; alertBox.y = 160
transition.from(alertBox, {time = 500, xScale = 0.5, yScale = 0.5, transition = easing.outExpo})
</pre></div></li><li class="listitem">Store the <code class="literal">title</code> parameter in the text object called <code class="literal">conditionDisplay</code>.<div class="informalexample"><pre class="programlisting">conditionDisplay = display.newText(title, 0, 0, "Arial", 38)
conditionDisplay:setTextColor(255,255,255,255)
conditionDisplay.xScale = 0.5
conditionDisplay.yScale = 0.5
conditionDisplay:setReferencePoint(display.CenterReferencePoint)
conditionDisplay.x = display.contentCenterX
conditionDisplay.y = display.contentCenterY - 15
</pre></div></li><li class="listitem">Store the <code class="literal">message</code> parameter in the text object called <code class="literal">messageText</code>.<div class="informalexample"><pre class="programlisting">messageText = display.newText(message, 0, 0, "Arial", 24)
messageText:setTextColor(255,255,255,255)
messageText.xScale = 0.5
messageText.yScale = 0.5
messageText:setReferencePoint(display.CenterReferencePoint)
messageText.x = display.contentCenterX
messageText.y = display.contentCenterY + 15
</pre></div></li><li class="listitem">Create a new display group called <code class="literal">alertDisplayGroup</code> and insert all the objects into the group. Close the function.<a id="id266" class="indexterm"/><div class="informalexample"><pre class="programlisting">alertDisplayGroup = display.newGroup()
alertDisplayGroup:insert(alertBox)
alertDisplayGroup:insert(conditionDisplay)
alertDisplayGroup:insert(messageText)
end
</pre></div></li><li class="listitem">Save your file and run the project in the simulator. The functionality of the<span class="strong"><strong> Play</strong></span> button still goes to the gameplay screen for<span class="strong"><strong> Level 1</strong></span>. None of the objects have movement at the moment. We'll be adding touch events, ball movement, and collisions in the next chapter. All the game objects should be laid out like in the following screenshot:<div class="mediaobject"><img src="graphics/1888_03_05.jpg" alt="Time for action—displaying game messages"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec17"/>What just happened?</h2></div></div></div><p>We have set up the alert system for the game, but it is not operable at the moment until we add in more game functions to set the game objects in motion. The next chapter will demonstrate how the <code class="literal">alertScreen()</code> function passes two parameters, <code class="literal">title</code> and <code class="literal">message</code>. An <code class="literal">alertBox</code> display object is added as a background to the alert texts when they pop up after a condition occurs. When the <code class="literal">alertBox</code> pops up, it transitions from 0.5 of the <code class="literal">xScale</code> and <code class="literal">yScale</code> to full image scale in 500 milliseconds. That is basically the equivalent of half a second.<a id="id267" class="indexterm"/>
</p><p>The <code class="literal">conditionDisplay</code> object passes the <code class="literal">title</code> parameter. This will be the text that displays,<span class="strong"><strong> You Win</strong></span> or<span class="strong"><strong> You Lose</strong></span>.</p><p>The <code class="literal">messageText</code> object passes the <code class="literal">message</code> parameter. The text with this parameter displays a message such as<span class="strong"><strong> Play Again</strong></span> or<span class="strong"><strong> Continue</strong></span> after a condition is reached.</p><p>All the objects in this function are then inserted into <code class="literal">alertDisplayGroup = display.newGroup()</code>. It will act as one group instead of individual objects when it will appear on and off the stage.</p><p>When running the code in the simulator; if errors pop up in your terminal window, be sure to check the line(s) causing the errors. Sometimes a simple capitalization error or even a comma or quotation mark that is missing can keep your app from running in the simulator. Make sure you're aware of those common mistakes. They can be easily overlooked.</p><p>You can refer to the <code class="literal">Breakout - Part 1</code> folder in the <code class="literal">Chapter 3</code> folder to see how the first half of the code for this tutorial is set up.</p></div><div class="section" title="Pop quiz—building a game"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec18"/>Pop quiz—building a game</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem">When adding the physics engine in your code, which functions are valid to add to your application?<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">a. <code class="literal">physics.start()</code></li><li class="listitem" style="list-style-type: none">b. <code class="literal">physics.pause()</code></li><li class="listitem" style="list-style-type: none">c. <code class="literal">physics.stop()</code></li><li class="listitem" style="list-style-type: none">d. None of the above</li></ul></div></li><li class="listitem">Which is correct when adding an event listener?<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">a. <code class="literal">button:addeventlistener("touch", listener )</code></li><li class="listitem" style="list-style-type: none">b. <code class="literal">button:AddEventListener("touch", listener )</code></li><li class="listitem" style="list-style-type: none">c. <code class="literal">button:addEventListener(touch, listener )</code></li><li class="listitem" style="list-style-type: none">d. <code class="literal">button:addEventListener("touch", listener )</code></li></ul></div></li><li class="listitem">What is the correct way to have the following display object transition to x = 300, y = 150, have the alpha changed to 0.5, in 2 seconds?<div class="informalexample"><pre class="programlisting">local square = display.newRect( 0, 0, 50, 50 )
square:setFillColor( 255,255,255 )
square.x = 100 square2.y = 300
</pre></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">a. <code class="literal">transition.to( square, { time=2000, x=300, y=150, alpha=0.5 } )</code></li><li class="listitem" style="list-style-type: none">b. <code class="literal">transition.from( square, { time=2000, x=300, y=150, alpha=0.5 } )</code></li><li class="listitem" style="list-style-type: none">c. <code class="literal">transition.to( square, { time=2, x=300, y=150, alpha=0.5 } )</code></li><li class="listitem" style="list-style-type: none">d. None of the above</li></ul></div></li></ol></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec17"/>Summary</h1></div></div></div><p>We have completed the first half of this game tutorial. Understanding how to structure a Corona project properly makes it easier to keep your code organized and tracks your assets better. We have gotten a taste of working with blocks of code that pertain to a small dose of the game logic needed to allow the application to run.</p><p>So far we have:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Specified the build configuration on displaying the content for Android and iOS devices</li><li class="listitem" style="list-style-type: disc">Introduced the main variables and constants that will run in the application</li><li class="listitem" style="list-style-type: disc">Instantiated the physics engine and began to apply them to the game objects that require physical bodies</li><li class="listitem" style="list-style-type: disc">Created transitions between menus to gameplay screens</li><li class="listitem" style="list-style-type: disc">Added display objects and game messages to the screen</li></ul></div><p>It's quite an accomplishment of how much we've done so far, including learning some new API in the process of coding the application. We still have a lot more to add before the game can be fully functional. We still have a lot more to add before the game can be fully functional.</p><p>In the next chapter, we'll be finishing the last half of this game tutorial. We'll be working with collision detection of the paddle, ball, brick, and wall objects. Also, we'll learn how to update the score when a brick is removed from the scene and get our win/lose conditions active as well. We're in the home stretch. Let's keep going!</p></div></body></html>