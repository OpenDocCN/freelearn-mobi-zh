<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Enhancing your Apps with Audio, Video, and the Camera"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Enhancing your Apps with Audio, Video, and the Camera</h1></div></div></div><p>In this chapter, we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Choosing your capture device using an OptionDialog</li><li class="listitem" style="list-style-type: disc">Capturing photos from the camera</li><li class="listitem" style="list-style-type: disc">Choosing existing photos from the photo library</li><li class="listitem" style="list-style-type: disc">Displaying photos using ScrollableView</li><li class="listitem" style="list-style-type: disc">Saving your captured photo to the device filesystem</li><li class="listitem" style="list-style-type: disc">Capturing and playing audio via the audio recorder</li><li class="listitem" style="list-style-type: disc">Capturing video via the video recorder</li><li class="listitem" style="list-style-type: disc">Playing video files from the filesystem</li><li class="listitem" style="list-style-type: disc">Safely deleting saved files from the filesystem</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec01"/>Introduction</h1></div></div></div><p>While it may be hard to believe, snapping photographs and sharing them wirelessly using a phone first happened only in 1997, and wasn't popularized until around 2004. By 2010, almost all phones contained a digital camera and many mid-range to high-end devices also sported audio and video camcorder capabilities. Most iPhone and Android models now have these capabilities, and they have opened new pathways for entrepreneurial developers.<a id="id143" class="indexterm"/>
</p><p>Titanium contains APIs that let you access all of the phone interfaces required to take photos or video with the built-in camera, record audio, and scroll through the device's saved image and video galleries.<a id="id144" class="indexterm"/>
</p><p>Throughout this chapter we will introduce all of these concepts and use them to put together a basic ''Holiday Memories'' app which will allow our users to capture photographs, videos, and audio from their device, save those files to the local file storage, and read them back again.</p><div class="section" title="Pre-requisites"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec01"/>Pre-requisites</h2></div></div></div><p>You should already be familiar with Titanium basics, including creating UI objects and using Titanium Studio. Additionally, to test camera functionality you are going to need either an iPhone or Android device capable of both recording photographs and video. An iPhone 3GS model or up will suffice, and all Android phones apart from the very bottom-end of the market should be OK.</p></div></div></div>
<div class="section" title="Choosing your capture device using an OptionDialog"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec02"/>Choosing your capture device using an OptionDialog</h1></div></div></div><p>The OptionDialog is a modal-only component that allows you to show one or more options to a user, usually along with a<span class="emphasis"><em> cancel</em></span> option, which closes the dialog. We are going to create this component and use it to present the user with an option to choose an image from the camera or the device's photo library.<a id="id145" class="indexterm"/>
</p><p>If you are intending to follow the entire chapter and build the Holiday Memories app, then pay careful attention to the first<span class="emphasis"><em> Getting ready</em></span> section for this recipe, as it will guide you through setting up the project.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec02"/>Getting ready</h2></div></div></div><p>To prepare for this recipe, open up Titanium Studio and log in if you have not already done so. If you need to register a new account, you can do so for free directly from within the application. Once you are logged in, click on<span class="strong"><strong> New Project</strong></span>, and the details window for creating a new project will appear. Enter in<span class="strong"><strong> Holiday Memories</strong></span> as the name of the app, and fill in the rest of the details with your own information.<a id="id146" class="indexterm"/>
</p><p>Pay attention to the app identifier, which is written normally in reverse domain notation (that is<span class="emphasis"><em> com.packtpub.holidaymemories)</em></span>. This identifier cannot be easily changed after the project is created and you will need to match it<span class="emphasis"><em> exactly</em></span> when creating provisioning profiles for distributing your apps later on. You can obtain all of the images used in this recipe, and indeed the entire chapter, by downloading the following source files:</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note25"/>Note</h3><p>Complete source code for this recipe can be found in the<code class="literal"> /Chapter 4/Recipe 1</code> folder.</p><p>Complete source code for this entire chapter can be found in the<code class="literal"> /Chapter 4/Holiday Memories</code> folder.</p></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec03"/>How to do it...</h2></div></div></div><p>Now our project has been created using Titanium Studio. Let's get down to business! Open up the<code class="literal"> app.js</code> file in your editor and remove all existing code. After you have done that, type in the following and then hit save:<a id="id147" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">//this sets the background color of the master UIView (when there are no windows/tab groups on it)
Titanium.UI.setBackgroundColor('#000');
//create tab group
var tabGroup = Titanium.UI.createTabGroup();
//
//create base UI tab and root window
//
var win1 = Titanium.UI.createWindow({
title:'Photos',
backgroundImage: 'images/background.png',
barColor: '#000',
url: 'photos.js'
});
var tab1 = Titanium.UI.createTab({
icon:'images/photos.png',
title:'Photos',
window:win1
});
//
//create tab and root window
//
var win2 = Titanium.UI.createWindow({
title:'Video',
backgroundImage: 'images/background.png',
barColor: '#000'
});
var tab2 = Titanium.UI.createTab({
icon:'images/movies.png',
title:'Video',
window:win2
});
//
//create tab and root window
//
var win3 = Titanium.UI.createWindow({
title:'Audio',
backgroundImage: 'images/background.png',
barColor: '#000'
});
var tab3 = Titanium.UI.createTab({
icon:'images/audio.png',
title:'Audio',
window:win3
});
//
//add tabs
//
tabGroup.addTab(tab1);
tabGroup.addTab(tab2);
tabGroup.addTab(tab3);
//open tab group
tabGroup.open();
</pre></div><p>Now we need to create our first Window's JavaScript file that we will call<code class="literal"> photo.js</code>. Create this blank file in your<code class="literal"> Resources</code> folder and open it in your IDE. Enter in the following code to create the "Choose Photo" button which will instantiate your OptionDialog:<a id="id148" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">var win = Titanium.UI.currentWindow;
//our dialog with the options of where to get an
//image from
var dialog = Titanium.UI.createOptionDialog({
title: 'Choose an image source...',
options: ['Camera','Photo Gallery', 'Cancel'],
cancel:2
});
//add event listener
dialog.addEventListener('click',function(e) {
Ti.API.info('You selected ' + e.index);
});
//choose a photo button
var btnGetPhoto = Titanium.UI.createButton({
title: 'Choose'
});
btnGetPhoto.addEventListener('click', function(e){
dialog.show();
});
//set the right nav button to our btnGetPhoto object
//note that we're checking the osname and changing the
//button location depending on if it's iphone/android
//this is explained further on in the "Platform Differences" chapter
if(Ti.Platform.osname == 'iphone') {
win.rightNavButton = btnGetPhoto;
}
else {
//add it to the main window because android does
//not have 'right nav button'
btnGetPhoto.right = 20;
btnGetPhoto.top = 20;
win.add(btnGetPhoto);
}
</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec04"/>How it works…</h2></div></div></div><p>The code in the first block of code is creating our Navigation view with tabs and windows, all of which has been covered in<a class="link" href="ch01.html" title="Chapter 1. Building Apps using Native UI Components"> Chapter 1</a>,<span class="emphasis"><em> Building Apps using Native UI Components</em></span> and<a class="link" href="ch02.html" title="Chapter 2. Working with Local and Remote Data Sources"> Chapter 2</a>,<span class="emphasis"><em> Working with Local and Remote Data Sources</em></span>. Our first tab and window use the<span class="emphasis"><em> photo.js</em></span> file, the contents of which are visible here in our second block of code on the previous page.<a id="id149" class="indexterm"/>
</p><p>The OptionDialog itself is created using the<code class="literal"> Titanium.UI.createOptionDialog()</code> method and only requires a few simple parameters. The<code class="literal"> title</code> parameter, in this case, appears at the top of your button options and is there to just give your user a brief message about what their chosen option will be used for. In our case, we're simply notifying them that we'll be using their chosen option to launch the appropriate image capture application. The options array is the important property here and contains all of the button selections you wish to present to the user. Note that we have also included a<code class="literal"> cancel</code> item in our array, and there is a corresponding<code class="literal"> cancel</code> property with the same index as part of our<code class="literal"> createOptionDialog()</code>. This will draw the button style for cancel a little differently when our OptionDialog is presented on screen.<a id="id150" class="indexterm"/>
</p><p>Finally, we added an event listener to our OptionDialog and we are outputting the chosen button index to the Titanium Studio console, using the<code class="literal"> e.index</code> property. We will use this flag in our next recipe to launch either the camera or photo gallery depending on the user's selection. The OptionDialog shown next provides the user with two image source options:<a id="id151" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/3968EXP_04_01.jpg" alt="How it works…"/></div></div></div>
<div class="section" title="Capturing photos from the camera"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec03"/>Capturing photos from the camera</h1></div></div></div><p>To use the device camera we need to access the<code class="literal"> Titanium.Media</code> namespace, and specifically the<code class="literal"> showCamera</code> method. This will display the native operating system interface for taking photographs, and expose the three events which will help us decide what needs to be done with the captured image. We will also check whether the user's device is capable of taking camera shots before attempting to do so, as some devices (including iPod Touch and the emulator) don't have this capability.<a id="id152" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note26"/>Note</h3><p>Note that this recipe will only work if you are using a physical device! The emulators for both Android and the iPhone don't have camera functionality built in. If you attempt to run this on the emulator you will just be presented with an error dialog.</p></div><p>Complete source code for this recipe can be found in the<code class="literal"> /Chapter 4/Recipe 2</code> folder.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec05"/>How to do it...</h2></div></div></div><p>We are going to extend the event listener of our OptionDialog using the following code:</p><div class="informalexample"><pre class="programlisting">//add event listener
dialog.addEventListener('click',function(e)
{
Ti.API.info('You selected ' + e.index);
if(e.index == 0)
{
//from the camera
Titanium.Media.showCamera({
success:function(event)
{
var image = event.media;
if(event.mediaType == Ti.Media.MEDIA_TYPE_PHOTO)
{
//set image view
var imgView =
Titanium.UI.createImageView({
top: 20,
left: 20,
width: 280,
height: 320
});
imgView.image = image;
win.add(imgView);
}
},
cancel:function()
{
//getting image from camera was cancelled
},
error:function(error)
{
//create alert
var a = Titanium.UI.createAlertDialog({title:'Camera'});
// set message
if (error.code == Titanium.Media.NO_CAMERA)
{
a.setMessage('Device does not have image recording capabilities');
}
else
{
a.setMessage('Unexpected error: ' + error.code);
}
// show alert
a.show();
},
allowImageEditing:true,
saveToPhotoGallery:false
});
}
else
{
//cancel was tapped
//user opted not to choose a photo
}
});
</pre></div><p>Run your app on a physical device now and you should be able to select the camera button from our OptionDialog and take a photograph with your device. This image should then appear in our temporary ImageView like it does in the following screenshot:<a id="id153" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/3968EXP_04_02.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec06"/>How it works…</h2></div></div></div><p>Getting an image from the camera is actually pretty straightforward. First, you'll notice that we've extended the OptionDialog with an if statement. If the index property of our dialog is 0 (the first button) then we are launching the camera. We do this via the<code class="literal"> Titanium.Media.showCamera()</code> method. This fires three events, which we are capturing here, called<span class="strong"><strong> success, error</strong></span>, and<span class="strong"><strong> cancel</strong></span>. We are ignoring the cancel event, as there is no processing required if the user opts to cancel out of the image capture. In the error event, we are going to display an AlertDialog that explains that the camera cannot be initiated. This is the dialog you will see if you happen to run this code using an emulator.<a id="id154" class="indexterm"/>
</p><p>The majority of our processing takes place in the success event. First, we save the captured photograph into a new variable called<code class="literal"> image</code>. We then check that the chosen media was actually a photograph by comparing its<code class="literal"> mediaType</code> property. It is at this point that the chosen media could actually be a video, so we must double check what it is before we use it, as we don't know whether the user has taken a photo or video shot until after it has happened. Finally, to show that we have actually captured an image with our camera to the user, we create an ImageView and set its<code class="literal"> image</code> property to the captured image file, before adding the entire thing to our window.<a id="id155" class="indexterm"/>
</p></div></div>
<div class="section" title="Choosing existing photos from the photo library"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec04"/>Choosing existing photos from the photo library</h1></div></div></div><p>The process of choosing an image from the photo library on the device is very similar to that of the camera. We are still using the<code class="literal"> Titanium.Media</code> namespace, however, this time we are going to execute the method called<code class="literal"> openPhotoLibrary()</code>, which does exactly as the name suggests. As with the previous recipe, once we have retrieved an image from the Photo Gallery, we will display it on screen to the user using a simple ImageView control.<a id="id156" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note27"/>Note</h3><p>Complete source code for this recipe can be found in the<code class="literal"> /Chapter 4/Recipe 3</code> folder.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec07"/>How to do it...</h2></div></div></div><p>We are going to further extend our OptionDialog to now choose an image from the photo library, if the<code class="literal"> index</code> property of 1 (the second button) is selected. Add the following code into your dialog's event listener:<a id="id157" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">//add event listener
dialog.addEventListener('click',function(e)
{
Ti.API.info('You selected ' + e.index);
if(e.index == 1)
{
//obtain an image from the gallery
Titanium.Media.openPhotoGallery({
success:function(event)
{
var image = event.media;
// set image view
Ti.API.debug('Our type was: '+event.mediaType);
if(event.mediaType == Ti.Media.MEDIA_TYPE_PHOTO)
{
var imgView = Titanium.UI.createImageView({
top: 20,
left: 20,
width: 280,
height: 320
});
imgView.image = image;
win.add(imgView);
}
},
cancel:function()
{
//user cancelled the action from within
//the photo gallery
}
});
}
else
{
//cancel was tapped
//user opted not to choose a photo
}
});
</pre></div><p>Run your app in the emulator or device and choose the second option from our dialog. The photo library should appear and allow you to select an image. This selection screen will look something like the following screenshot:<a id="id158" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/3968EXP_04_03.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec08"/>How it works…</h2></div></div></div><p>This recipe follows more or less the same pattern as when we used the camera to obtain our image. First, we extended the<code class="literal"> OptionDialog</code> event listener to perform an action when the button index selected equals 1, which in this case is our Photo Gallery button. Our<code class="literal"> openPhotoGallery()</code> method also fires three events:<span class="strong"><strong> success, error</strong></span>, and<span class="strong"><strong> cancel</strong></span>.<a id="id159" class="indexterm"/>
</p><p>Just like the previous recipe, the majority of our processing takes place in the success event. We check that the chosen media was actually a photograph by comparing its<code class="literal"> mediaType</code> property, and finally we create an ImageView and set its<code class="literal"> image</code> property to the captured image file, before adding the entire thing to our window.<a id="id160" class="indexterm"/>
</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec09"/>There's more...</h2></div></div></div><p>Now, let's explore media types.</p><div class="section" title="Understanding Media Types"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec01"/>Understanding Media Types</h3></div></div></div><p>There are two main media types available to you via the<code class="literal"> mediaType</code> enumeration when capturing photographs or videos via the in-built camera. These are:<a id="id161" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">MEDIA_TYPE_PHOTO</code><a id="id162" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">MEDIA_TYPE_VIDEO</code><a id="id163" class="indexterm"/></li></ul></div><p>In addition, there are also numerous other sets of more specific<code class="literal"> mediaType's</code> in the enumeration, which include the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">MUSIC_MEDIA_TYPE_ALL</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">MUSIC_MEDIA_TYPE_ANY_AUDIO</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">MUSIC_MEDIA_TYPE_AUDIOBOOK</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">MUSIC_MEDIA_TYPE_MUSIC</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">MUSIC_MEDIA_TYPE_PODCAST</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">VIDEO_MEDIA_TYPE_AUDIO</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">VIDEO_MEDIA_TYPE_NONE</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">VIDEO_MEDIA_TYPE_VIDEO</code></li></ul></div><p>These types are generally only applicable when utilizing the<code class="literal"> mediaType</code> property from within the<code class="literal"> VideoPlayer</code> or<code class="literal"> AudioPlayer</code> components.</p></div><div class="section" title="Saving to photos"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec02"/>Saving to photos</h3></div></div></div><p>You can run this code in the emulator, but you'll probably notice that there are no images in the library and no obvious way to get them there! Thankfully, this is actually fairly easy to overcome. Simply open the web browser and find an image you want to test with using Google Images or a similar service. Click and hold on an image in the browser and you should see an option<span class="strong"><strong> save to photos</strong></span>. You can then use these images to test out your code in the emulator.<a id="id164" class="indexterm"/>
</p></div></div></div>
<div class="section" title="Displaying photos using ScrollableView"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec05"/>Displaying photos using ScrollableView</h1></div></div></div><p>One of the most common methods of displaying multiple photographs and images on mobile devices is the<code class="literal"> ScrollableView</code>. This view type allows for pictures to be swiped left and right, and is common among many applications including Facebook mobile. The method of showing images in this way is reminiscent of "flipping" through a book or album, and is very popular due to the natural feel and simple implementation.<a id="id165" class="indexterm"/>
</p><p>In this recipe we will implement a<code class="literal"> ScrollableView</code> which will contain any number of images that can be chosen from the camera or photo gallery. Complete source code for this recipe can be found in the<code class="literal"> /Chapter 4/Recipe 4</code> folder.<a id="id166" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note28"/>Note</h3><p>Note that this recipe should work for both Android and iPhone devices. However, a recent bug in the latest version of Titanium SDK (1.7.2) may cause it to fail on Android. You should check whether you are using the latest version of Titanium SDK if you wish to test this on the Android emulator.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec10"/>How to do it...</h2></div></div></div><p>First, let's create our ScrollableView object, which we will call<code class="literal"> scrollingView</code>, and add it to our<code class="literal"> photo.js</code> window:</p><div class="informalexample"><pre class="programlisting">//this is the scroll view the user will use to swipe
//through the selected photos
scrollingView = Titanium.UI.createScrollableView({
left: 17,
top: 15,
width: win.width - 14,
height: win.height - 25,
views: [],
currentPage: 0,
zIndex: 1
});
scrollingView.addEventListener('scroll',function(e){
Ti.API.info('Current scrollableView page = ' + e.source.currentPage);
});
win.add(scrollingView);
</pre></div><p>Now we are going to alter the dialog event listener in order to assign our selected photos to the ScrollableView, instead of the temporary ImageView we created earlier. Replace all of the code within and including your<code class="literal"> if(event.mediaType == Ti.Media.MEDIA_TYPE_PHOTO)</code> with the following code. Note you need to do this for both the images gathered from the photo library and from the device camera.</p><div class="informalexample"><pre class="programlisting">...
//output the mediaType to the console log for debugging
Ti.API.debug('Our type was: '+event.mediaType);
if(event.mediaType == Ti.Media.MEDIA_TYPE_PHOTO)
{
// set image view
var imgView = Titanium.UI.createImageView({
top: 0,
left: 0,
width: 286,
height: 337,
image: image
});
//add the imageView to our scrollableView object
scrollingView.addView(imgView);
}
</pre></div><p>Now run your app in either the emulator or your device, and select a couple of images one after the other. You can use a combination of images from the camera or the photo gallery. Once you have selected at least two images, you should be able to swipe between them using a left-to-right or right-to-left gesture.<a id="id167" class="indexterm"/>
</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec11"/>How it works…</h2></div></div></div><p>The ScrollableView is really just a collection of views that has a number of special events and properties built into it, as you can probably tell by the empty array value we have given to the property called<code class="literal"> views</code> in the<code class="literal"> createScrollableView()</code> method. It is necessary to set this property on instantiating the ScrollableView object, and a good idea to set the<code class="literal"> currentPage</code> index property to 0; our first view. We are still creating an ImageView as per the previous recipes. However, this time we are not adding that View to our window, but to our<code class="literal"> ScrollableView</code> component. We do this by adding a view using the<code class="literal"> addView()</code> method. Finally, we have also created an event that attaches to our ScrollableView called<code class="literal"> scroll</code>, and we are outputting the<code class="literal"> currentPage</code> property to the Titanium console for debugging and testing.<a id="id168" class="indexterm"/>
</p><p>As you can see, the ScrollableView is an easy and simple component and is very useful for photo gallery applications or any other apps where you want to display a series of similar views. You could extend this by adding a blank View object and putting any number of text fields, labels, or image views you want in each of those blank views"the only limit here is your imagination!<a id="id169" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/3968EXP_04_04.jpg" alt="How it works…"/></div></div></div>
<div class="section" title="Saving your captured photo to the device filesystem"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec06"/>Saving your captured photo to the device filesystem</h1></div></div></div><p>Taking pictures is all well and good, but what about when we wish to save an image to the filesystemso we can retrieve it again later? In this recipe we will do exactly that and also introduce you to the<code class="literal"> toImage()</code> method which is inbuilt in many of the Titanium controls. This method takes a flattened image of the entire view it is called upon and is extremely useful for taking screenshots or grabbing an image of many controls lumped together in a single view.<a id="id170" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note29"/>Note</h3><p>Complete source code for this recipe can be found in the<code class="literal"> /Chapter 4/Recipe 5</code> folder.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec12"/>How to do it...</h2></div></div></div><p>Type in the following code after your<code class="literal"> btnGetPhoto</code> object is created. You can replace the existing code that we've written to add the<code class="literal"> btnGetPhoto</code> object to the navigation bar, as this code repeats that code and also extends it.<a id="id171" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">//save a photo to file system button
var btnSaveCurrentPhoto = Titanium.UI.createButton({
title: 'Save Photo',
zIndex: 2 //this appears over top of other components
});
btnSaveCurrentPhoto.addEventListener('click', function(e){
var media = scrollingView.toImage();
//if it doesn't exist, create it create a directory called
//"photos"
//and it will hold our saved images
var newDir = Titanium.Filesystem.getFile (Titanium.Filesystem.applicationDataDirectory,'photos');
if(!newDir.exists()){
newDir.createDirectory();
}
var fileName = 'photo-' + scrollingView.currentPage.toString() + '.png';
writeFile = Titanium.Filesystem.getFile(newDir.nativePath, fileName);
writeFile.write(media);
alert('You saved a file called ' + fileName + ' to the directory ' + newDir.nativePath);
var _imageFile = Titanium.Filesystem.getFile(newDir.nativePath, fileName);
if (!_imageFile.exists()) {
Ti.API.info('ERROR: The file ' + fileName + ' in the directory ' + newDir.nativePath + ' does not exist!');
}
else {
Ti.API.info('OKAY!: The file ' + fileName + ' in the directory ' + newDir.nativePath + ' does exist!');
}
});
//set the right nav button to our photo get button
if(Ti.Platform.osname == 'iphone') {
win.leftNavButton = btnSaveCurrentPhoto;
win.rightNavButton = btnGetPhoto;
}
else
{
//add it to the main window because android does
//not have 'right nav button'
btnGetPhoto.right = 20;
btnGetPhoto.top = 20;
win.add(btnGetPhoto);
//add it to the main window because android does
//not have 'left nav button'
btnSaveCurrentPhoto.left = 20;
btnSaveCurrentPhoto.top = 20;
win.add(btnSaveCurrentPhoto);
}
</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec13"/>How it works…</h2></div></div></div><p>The<code class="literal"> Titanium.FileSystem</code> namespace opens up a range of file manipulation capabilities, but most importantly, gives us the basic tools in order to read and write a file to the application's storage space on the device. In this recipe we are using the<code class="literal"> toImage()</code> method of the<code class="literal"> scrollingView</code> to return a blob of the view's image representation.<a id="id172" class="indexterm"/>
</p><p>We can then get a reference to the folder we wish to store the image file data in. As you can see in the code, we are getting a reference to that folder by creating a new variable such as<code class="literal"> var newDir = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory,'photos')</code>; and then ensuring that the folder exists. If it doesn't exist, we can create the folder by calling the<code class="literal"> createDirectory()</code> method on our<code class="literal"> newDir</code> object.<a id="id173" class="indexterm"/>
</p><p>Finally, our image data is saved in much the same way. First, we create a variable called<code class="literal"> writeFile</code>, which is referencing our file name within the<code class="literal"> newDir</code> object folder we have already created. We can then output the file to the filesystem using<code class="literal"> writeFile's "write()"</code> method, passing in the image media variable as the file data to save.<a id="id174" class="indexterm"/>
</p></div></div>
<div class="section" title="Capturing and playing audio via the audio recorder"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec07"/>Capturing and playing audio via the audio recorder</h1></div></div></div><p>Another handy feature of the iPhone and most Android handsets is the ability to record audio data—perfect for taking audible notes during meetings or those long, boring lectures! In this recipe we are going to capture some audio using the<code class="literal"> Titanium.Media.AudioRecorder</code> class, and then allow the user to play back the recorded sound file.<a id="id175" class="indexterm"/>
</p><p>Complete source code for this recipe can be found in the<code class="literal"> /Chapter 4/Recipe 6</code> folder.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note30"/>Note</h3><p>Note that this recipe will only work for the iPhone. You will also require a physical device for this recipe. Later versions of the Titanium framework should support audio recording for Android via the use of intents. In addition, the iPhone 3G models may not be capable of recording in some of the following compression formats, particularly high fidelity formats such as AAC. When in doubt, you should try using MP4A or WAV formats.</p></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec14"/>Getting ready</h2></div></div></div><p>Create a new JavaScript file called<code class="literal"> audio.js</code> and save it into your resources directory. Then back in your<code class="literal"> app.js</code> file, add the URL property of window3, and give it a value of<code class="literal"> audio.js</code>. This will load up our video JavaScript file for the third tab window of our application.<a id="id176" class="indexterm"/>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec15"/>How to do it...</h2></div></div></div><p>Type in the following code into your<code class="literal"> audio.js</code> file and save. This will set up the interface with a set of buttons and labels so we can start, stop, and playback our recorded audio.<a id="id177" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">var win = Titanium.UI.currentWindow;
var file;
var timer;
var sound;
var duration = 0;
var label = Titanium.UI.createLabel({
text:'',
top:150,
color:'#999',
textAlign:'center',
width: 250,
height:'auto'
});
win.add(label);
var linetype = Titanium.UI.createLabel({
text: "audio line type: "+lineTypeToStr(),
bottom: 15,
color:'#999',
textAlign:'center',
width: 250,
height:'auto'
});
win.add(linetype);
var volume = Titanium.UI.createLabel({
text: "volume: "+Ti.Media.volume,
bottom:50,
color:'#999',
textAlign:'center',
width: 250,
height:'auto'
});
win.add(volume);
var switchLabel = Titanium.UI.createLabel({
text:'Hi-fidelity:',
width: 250,
height:'auto',
textAlign:'center',
color:'#999',
bottom:115
});
var switcher = Titanium.UI.createSwitch({
value:false,
bottom:80
});
win.add(switchLabel);
win.add(switcher);
var b2 = Titanium.UI.createButton({
title:'Playback Recording',
width:200,
height:40,
top:80
});
win.add(b2);
var b1 = Titanium.UI.createButton({
title:'Start Recording',
width:200,
height:40,
top:20
});
win.add(b1);
</pre></div><p>Now run your application in the emulator and switch to the<span class="strong"><strong> Audio</strong></span> tab. You should see a screen that looks just like the following screenshot:<a id="id178" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/3968EXP_04_05.jpg" alt="How to do it..."/></div><p>Now we're going to create an object instance of the<code class="literal"> AudioRecorder</code> method called<code class="literal"> recording</code>, and give it a compression value and format value. We will also add event listeners to watch out for when the volume, audio line, and recording properties change, along with event handlers to capture and process these changes. Type in the following directly after the code you created from the previous page:<a id="id179" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">var recording = Ti.Media.createAudioRecorder();
// default compression is Ti.Media.AUDIO_FORMAT_LINEAR_PCM
// default format is Ti.Media.AUDIO_FILEFORMAT_CAF
// this will give us a wave file with µLaw compression which
// is a generally small size and suitable for telephony //recording for high end quality, you'll want LINEAR PCM
//however, that will result in uncompressed audio and will be //very large in size
recording.compression = Ti.Media.AUDIO_FORMAT_LINEAR_PCM;
recording.format = Ti.Media.AUDIO_FILEFORMAT_CAF;
Ti.Media.addEventListener('recordinginput', function(e) {
Ti.API.info('Input availability changed: '+e.available);
if (!e.available &amp;&amp; recording.recording) {
b1.fireEvent('click', {});
}
});
Ti.Media.addEventListener('linechange',function(e)
{
linetype.text = "audio line type: "+lineTypeToStr();
});
Ti.Media.addEventListener('volume',function(e)
{
volume.text = "volume: "+e.volume;
});
</pre></div><p>Finally, add the section of code after your<code class="literal"> Ti.Media</code> event listeners that you created previously. This code will handle all of the events for the audio input controls (the stop/start buttons and our high-fidelity switch).<a id="id180" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">function lineTypeToStr()
{
var type = Ti.Media.audioLineType;
switch(type)
{
case Ti.Media.AUDIO_HEADSET_INOUT:
return "headset";
case Ti.Media.AUDIO_RECEIVER_AND_MIC:
return "receiver/mic";
case Ti.Media.AUDIO_HEADPHONES_AND_MIC:
return "headphones/mic";
case Ti.Media.AUDIO_HEADPHONES:
return "headphones";
case Ti.Media.AUDIO_LINEOUT:
return "lineout";
case Ti.Media.AUDIO_SPEAKER:
return "speaker";
case Ti.Media.AUDIO_MICROPHONE:
return "microphone";
case Ti.Media.AUDIO_MUTED:
return "silence switch on";
case Ti.Media.AUDIO_UNAVAILABLE:
return "unavailable";
case Ti.Media.AUDIO_UNKNOWN:
return "unknown";
}
}
function showLevels()
{
var peak = Ti.Media.peakMicrophonePower;
var avg = Ti.Media.averageMicrophonePower;
duration++;
label.text = 'duration: '+duration+' seconds\npeak power:
' + peak +'\navg power: ' +avg;
}
b1.addEventListener('click', function()
{
if (b1.title == "Stop Recording")
{
file = recording.stop();
b1.title = "Start Recording";
b2.show();
clearInterval(timer);
Ti.Media.stopMicrophoneMonitor();
}
else
{
if (!Ti.Media.canRecord) {
Ti.UI.createAlertDialog({
title:'Error!',
message:'No audio recording hardware is currently
connected.'
}).show();
return;
}
b1.title = "Stop Recording";
recording.start();
b2.hide();
Ti.Media.startMicrophoneMonitor();
duration = 0;
timer = setInterval(showLevels,1000);
}
});
b2.addEventListener('click', function()
{
if (sound &amp;&amp; sound.playing)
{
sound.stop();
sound.release();
sound = null;
b2.title = 'Playback Recording';
}
else
{
Ti.API.info("recording file size: "+file.size);
sound = Titanium.Media.createSound({sound:file});
sound.addEventListener('complete', function()
{
b2.title = 'Playback Recording';
});
sound.play();
b2.title = 'Stop Playback';
}
});
switcher.addEventListener('change',function(e)
{
if (!switcher.value)
{
recording.compression = Ti.Media.AUDIO_FORMAT_ULAW;
}
else
{
recording.compression = Ti.Media.AUDIO_FORMAT_LINEAR_PCM;
}
});
</pre></div><p>Now run your application on a device (the simulator may not be capable of recording audio) and you should be able to start, stop, and then playback your audio recording, while the high fidelity switch will change the audio compression to a higher fidelity format.<a id="id181" class="indexterm"/>
</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec16"/>How it works…</h2></div></div></div><p>In this recipe we are creating an instance of the<code class="literal"> AudioRecorder</code> object, and we have called this new object<code class="literal"> recording</code>. We're giving this object a compression and audio format. For now, we have set these to the default (PCM compression and standard CAF format). Listeners from the<code class="literal"> Titanium.Media</code> namespace are then added, which when fired will change the line type or volume labels respectively.<a id="id182" class="indexterm"/>
</p><p>The main processing for this recipe happens within the event handlers for the "Start/Stop" and "Playback" buttons called<code class="literal"> b1</code> and<code class="literal"> b2</code> respectively. Our first button,<code class="literal"> b1</code>, is first checking its title to determine whether to stop or start recording via a simple if statement. If recording has not started, then we kick off the process by calling the<code class="literal"> start</code> method of our<code class="literal"> recording</code> object. To do so, we also need to start the microphone monitor, which is done by executing the line<code class="literal"> Ti.Media.startMicrophoneMonitor()</code>. Our device will then begin recording. Tapping the<code class="literal"> b1</code> button again will execute the stop code and simultaneously set our file object (the resulting sound-audio file) to the output from our<code class="literal"> recording</code> object.</p><p>The<code class="literal"> b2</code> button event handler checks whether we have a valid sound file, and whether it is already playing. If we have a valid file and it's playing, then the playback will stop. Otherwise, if there is a valid sound file and it hasn't already been played back through the speaker, we are creating a new object called<code class="literal"> sound</code>, using the<code class="literal"> Titanium.Media.createSound</code> method. This method requires a<code class="literal"> sound</code> parameter. We passed the<code class="literal"> file</code> object to it that was created during our recording session. Executing the<code class="literal"> sound</code> object's<code class="literal"> play</code> method then kicks off the playback, while the event listener/handler for the playback completion resets our<code class="literal"> b2</code> button title when the playback has completed.</p><p>Finally, the switch (called<code class="literal"> switcher</code> in this example) simply changes the recording format from high fidelity compression to a low one. The lower the quality and compression, the smaller the resulting audio file will end up being.</p></div></div>
<div class="section" title="Capturing video via the video recorder"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec08"/>Capturing video via the video recorder</h1></div></div></div><p>You can also use the inbuilt camera of your iPhone (3GS and above) or Android device to record video. The quality and length of the video that you can record is dependant on both your device's memory capabilities and the type of camera that's included in the hardware. However, you should at least be able to capture short video clips in VGA resolution as a minimum.<a id="id183" class="indexterm"/>
</p><p>In this recipe we will create a basic interface for our<span class="strong"><strong> Video</strong></span> tab consisting of a record button, which will launch the camera and record video on your device. We'll also perform this in two separate ways: using standard Titanium code for the iPhone and using intents for Android.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note31"/>Note</h3><p>Note that this recipe will require a physical device for testing. In addition, the iPhone 3G models are not be capable of recording video, but all models from the 3GS and upwards should be fine.</p></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec17"/>Getting ready</h2></div></div></div><p>Create a new JavaScript file called<code class="literal"> video.js</code> and save it into your resources folder. Then, back in your<code class="literal"> app.js</code> file, add the URL property of window2 and give it a value of<code class="literal"> video.js</code>. This will load up our video JavaScript file for the second tab window of our application.<a id="id184" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note32"/>Note</h3><p>Complete source code for this recipe can be found in the<code class="literal"> /Chapter 4/Recipe 7</code> folder.</p></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec18"/>How to do it...</h2></div></div></div><p>First of all, let's set up the basic interface to have a record button (in the navigation bar section for the iPhone and as a normal button for Android), along with the<code class="literal"> videoFile</code> variable. This will hold the path to our recorded video as a string.</p><div class="informalexample"><pre class="programlisting">var win = Titanium.UI.currentWindow;
var videoFile = 'video/video-test.mp4';
var btnGetVideo = Titanium.UI.createButton({
title: 'Record Video'
});
//set the right nav butto to our get button
if(Ti.Platform.osname == 'iphone') {
win.rightNavButton = btnGetVideo;
}
else {
//add it to the main window because android does
//not have 'right nav button'
btnGetVideo.right = 20;
btnGetVideo.top = 20;
win.add(btnGetVideo);
}
</pre></div><p>Now let's create the event listener and handler code for the record button. This will check our current platform (either iPhone or Android) and execute the record video code for the correct platform:<a id="id185" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">//get video from the device
btnGetVideo.addEventListener('click', function()
{
if(Titanium.Platform.osname == 'iphone') {
//record for iphone
Titanium.Media.showCamera({
success:function(event)
{
var video = event.media;
movieFile = Titanium.Filesystem.getFile(
Titanium.Filesystem.applicationDataDirectory,
mymovie.mov');
movieFile.write(video);
videoFile = movieFile.nativePath;
btnGetVideo.title = 'Play Video';
},
cancel:function()
{
},
error:function(error)
{
// create alert
var a =
Titanium.UI.createAlertDialog({title:'Video'});
// set message
if (error.code == Titanium.Media.NO_VIDEO)
{
a.setMessage('Device does not have video recording
capabilities');
}
else
{
a.setMessage('Unexpected error: ' + error.code);
}
// show alert
a.show();
},
mediaTypes: Titanium.Media.MEDIA_TYPE_VIDEO,
videoMaximumDuration:10000,
videoQuality:Titanium.Media.QUALITY_HIGH
});
}
else
{
//record for android using intents
var intent = Titanium.Android.createIntent({
action: 'android.media.action.VIDEO_CAPTURE'
});
Titanium.Android.currentActivity.startActivityForResult(
intent, function(e) {
if (e.error) {
Ti.UI.createNotification({
duration: Ti.UI.NOTIFICATION_DURATION_LONG,
message: 'Error: ' + e.error
}).show();
}
else {
if (e.resultCode === Titanium.Android.RESULT_OK) {
videoFile = e.intent.data;
var source = Ti.Filesystem.getFile(videoFile);
movieFile =
Titanium.Filesystem.getFile(
Titanium.Filesystem.applicationDataDirectory,
'mymovie.3gp');
source.copy(movieFile.nativePath);
videoFile = movieFile.nativePath;
btnGetVideo.title = 'Play Video';
}
else {
Ti.UI.createNotification({
duration: Ti.UI.NOTIFICATION_DURATION_LONG,
message: 'Canceled/Error? Result code: ' +
e.resultCode
}).show();
}
}
});
}
});
</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec19"/>How it works…</h2></div></div></div><p>Let's work through the code for recording on iPhone devices first, which is encapsulated within the<code class="literal"> if(Titanium.Plaform.osname == 'iphone')</code> statement as mentioned in the previous code. Here, we are executing the camera in the same way you would for capturing plain photos, however, we're passing additional parameters. The first of these is called<code class="literal"> mediaType</code>, and it tells the device we want to capture a<code class="literal"> mediaType</code> of<code class="literal"> MEDIA_TYPE_VIDEO</code>.<a id="id186" class="indexterm"/>
</p><p>The other two parameters define how long and what quality to capture the video in. The parameter<code class="literal"> videoMaximumDuration</code> float defines the duration (how long in milliseconds to allow capture before completing,) while the<code class="literal"> videoQuality</code> constant indicates the video quality during capture. We have set these to 10 seconds (10,000 milliseconds) and a video quality of "high" respectively.</p><p>On successful video capture, we save the<code class="literal"> event.media</code> (our video in its raw format) to the filesystem, using pretty much the same method as we did when saving a photograph. The final step is to set the<code class="literal"> videoFile</code> path to the location of our newly saved video file on the filesystem.</p><p>For Android, we are capturing the video in a different way, using an<span class="emphasis"><em> intent</em></span>. In this case, we're using the video capture intent called<code class="literal"> android.media.action.VIDEO_CAPTURE</code>. Objects of type<code class="literal"> android.content.Intent</code> are used to send asynchronous messages within your application or between applications. Intents allow the application to send or receive data to and from other activities or services. They also allow it to broadcast that a certain event has occurred. In our recipe's code, we are executing our Intent and then capturing the result—if the<code class="literal"> resultCode</code> equals<code class="literal"> Titanium.Android.RESULT_OK</code> then we know that we've managed to record a video clip. We can then move this file from its temporary storage location to a new destination of our choosing.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note33"/>Note</h3><p>Note that we are capturing video in 3GP format for Android while it was in MP4/MOV format on the iPhone.</p></div></div></div>
<div class="section" title="Playing video files from the filesystem"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec09"/>Playing video files from the filesystem</h1></div></div></div><p>Now that we have recorded video, what about playing it back? Titanium has an inbuilt video player component that can play both local files and remote video URLs. In this recipe we'll show you how to create the video player control and pass the local file URL of the video we captured in the previous recipe to it.<a id="id187" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note34"/>Note</h3><p>Complete source code for this recipe can be found in the<code class="literal"> /Chapter 4/Recipe 8</code> folder.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec20"/>How to do it...</h2></div></div></div><p>In our<code class="literal"> videos.js</code> file, underneath the declaration for the<code class="literal"> videoFile</code> object, create the following function:<a id="id188" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">function playMovie(){
//create the video player and add it to our window
//note the url property can be a remote url or a local file
var my_movie = Titanium.Media.createVideoPlayer({
url: videoFile,
width: 280,
height: 200,
top:20,
left:20,
backgroundColor:'#000'
});
win.add(my_movie);
my_movie.play();
}
</pre></div><p>Then, in your event listener for<code class="literal"> btnGetVideo</code>, extend the code so that it checks the button title and plays the recorded video when it has been saved:</p><div class="informalexample"><pre class="programlisting">//get video from the device
btnGetVideo.addEventListener('click', function()
{
if(btnGetVideo.title == 'Record Video') {
//our record video code from the previous recipe
//...
}
else
{
playMovie();
}
});
</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec21"/>How it works…</h2></div></div></div><p>Creating a video player object is no different than creating Labels or Buttons as many of the same properties are utilized for positioning and layout. The player can be embedded into any other view as you would do with a normal control, meaning you could have video thumbnails playing directly from within the rows of a TableView if you wanted. Additionally, the Video Player can play both local and remote videos (using the Video<code class="literal"> url</code> property). In this recipe, we are uploading a saved video from the filesystem that was captured by the camcorder on our device.</p><p>You could just as easily load a video from a URL or directly from within your<code class="literal"> Resources</code> folder. There is a 10 second video attached to the source code for this chapter in both<code class="literal"> mp4</code> and<code class="literal"> 3gp</code> formats for you to test with, called<code class="literal"> video-test.mp4</code>. You can also attempt to load it remotely using the web address<a class="ulink" href="http://boydlee.com/video-test.mp4"> http://boydlee.com/video-test.mp4</a>.<a id="id189" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note35"/>Note</h3><p>Note that some web video formats such as FLV are not supported.</p></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec22"/>There's more…</h2></div></div></div><p>If you want your video to play using the full screen dimensions and not just within a view, then you can set its<code class="literal"> fullscreen</code> property to<code class="literal"> true</code>. This will automatically load the video into fullscreen mode when it starts playing.<a id="id190" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/3968EXP_04_06.jpg" alt="There's more…"/></div></div></div>
<div class="section" title="Safely deleting saved files from the filesystem"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec10"/>Safely deleting saved files from the filesystem</h1></div></div></div><p>We can create these files and write them to our local phone storage, but what about deleting them? In this recipe we'll explain how to safely check for and delete files using the<code class="literal"> Titanium.Filesystem.File</code> namespace.<a id="id191" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note36"/>Note</h3><p>Complete source code for this recipe can be found in the<code class="literal"> /Chapter 4/Recipe 9</code> folder.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec23"/>How to do it...</h2></div></div></div><p>Back in your<code class="literal"> photos.js</code> file, add the following button code with an event listener at the end of the file. This will be our "trash" button and will call the delete function on the current selected image.<a id="id192" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">//create trash button
var buttonTrash = Titanium.UI.createButton({
width: 25,
height: 25,
right: 25,
bottom: 25,
image: 'images/trash.jpg',
zIndex: 2,
visible: false
});
//create event listener for trash button
buttonTrash.addEventListener('click', function(e){
});
</pre></div><p>Add an extra line to our existing<code class="literal"> btnSaveCurrentPhoto</code> click event to make our trash button visible only after a photo has actually been saved to the disk:<a id="id193" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">btnSaveCurrentPhoto.addEventListener('click', function(e){
buttonTrash.visible = true;
});
</pre></div><p>Finally, extend your button's event listener to delete the file, only after making sure that it already exists, before adding our button to the window:</p><div class="informalexample"><pre class="programlisting">buttonTrash.addEventListener('click', function(e){
var photosDir = Titanium.Filesystem.getFile (Titanium.Filesystem.applicationDataDirectory,'photos');
var fileName = 'photo-' + scrollingView.currentPage.toString() + '.png';
var imageFile = Titanium.Filesystem.getFile (photosDir.nativePath, fileName);
if (imageFile.exists()) {
//then we can delete it because it exists
imageFile.deleteFile();
alert('Your file ' + fileName + ' was deleted!');
}
});
win.add(buttonTrash);
</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec24"/>How it works…</h2></div></div></div><p>File manipulation is all done using methods on the file object, unlike many other languages where a "delete" function normally means passing the file object into said function to be deleted. In our recipe, you can see we're simply creating the file object as we did previously in the recipe on saving photos to the filesystem. But instead of writing the object to disk, we're checking its existence and then calling<code class="literal"> [file-object].deleteFile()</code>. All file manipulations in Titanium is done in this manner. For example, if you wanted to rename the file, you would simply create the object and call the<code class="literal"> rename()</code> method, passing in the new value as a string parameter.<a id="id194" class="indexterm"/>
</p><p>You may have also noticed that we gave the trash button a parameter called<code class="literal"> zIndex</code>, which we have set to<code class="literal"> 2</code>. The<code class="literal"> zIndex</code> defines the stack order of a component. Components with a higher<code class="literal"> zIndex</code> will always appear above those with a lower<code class="literal"> zIndex</code>. In this case, we've given the trash button an index of<code class="literal"> 2</code>, so that it appears above the other elements whose default<code class="literal"> zIndex</code> value is<code class="literal"> 0</code>.<a id="id195" class="indexterm"/>
</p><p>The following screenshot shows the trash icon visible on our newly saved file, and the message alert that appears confirming it's deletion from the filesystem:</p><div class="mediaobject"><img src="graphics/3968EXP_04_07.jpg" alt="How it works…"/></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec25"/>There's more...</h2></div></div></div><p>A full list of the<code class="literal"> Titanium.Filesystem.File</code> methods is available at the Appcelerator's website under the current API documentation, at:<a class="ulink" href="http://developer.appcelerator.com/apidoc/mobile/latest/Titanium.Filesystem.File-object"> http://developer.appcelerator.com/apidoc/mobile/latest/Titanium.Filesystem.File-object</a>
<a id="id196" class="indexterm"/>
</p></div></div></body></html>