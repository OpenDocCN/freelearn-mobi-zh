<html><head></head><body><div class="chapter" title="Chapter&#xA0;10.&#xA0;Publishing and Marketing"><div class="titlepage"><div><div><h1 class="title"><a id="ch10"/>Chapter 10. Publishing and Marketing</h1></div></div></div><p>Having covered all the topics in this book, and if you have not already done so, you are now in a position to create, develop, and market an app of your own design. There is of course much more to learn about Android 5, and Android in general, but exploring the SDK further is quite simple, now we understand how some of the most frequently used structures and objects are applied. Once we understand how a listener interface is implemented, then it is simply a matter of looking up in the documentation when we want to imply a new one.</p><p>The entire purpose of developing an app for Android is to distribute it. Although there are many ways to make our work available to others, the obvious choice is via the Android Play Store. This final chapter is a step by step guide on how to do that. On the way, we will see how to make our apps compatible with earlier versions, keeping much of the Android 5 API's functionality as well as many of the Material Design features programmed into our Lollipop UIs.</p><p>In this chapter, you will:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Making apps backward-compatible</li><li class="listitem" style="list-style-type: disc">See how to create alternative layouts for older systems</li><li class="listitem" style="list-style-type: disc">Apply a Material Theme to older versions</li><li class="listitem" style="list-style-type: disc">Replace the Action Bar with a Material Design Toolbar</li><li class="listitem" style="list-style-type: disc">Prepare an app for publication</li><li class="listitem" style="list-style-type: disc">Create a digital certificate and a private key</li><li class="listitem" style="list-style-type: disc">Generate a signed APK file</li><li class="listitem" style="list-style-type: disc">Prepare promotional media</li><li class="listitem" style="list-style-type: disc">Complete a Store Listing</li><li class="listitem" style="list-style-type: disc">Publish an app</li><li class="listitem" style="list-style-type: disc">Learn how to distribute apps via e-mail and websites</li><li class="listitem" style="list-style-type: disc">License an app</li><li class="listitem" style="list-style-type: disc">Provide links to a product or a publisher</li><li class="listitem" style="list-style-type: disc">Add official branding</li><li class="listitem" style="list-style-type: disc">Build a template project for in-app billing</li><li class="listitem" style="list-style-type: disc">Include an AdMob banner advertisement</li></ul></div><div class="section" title="Making apps backward-compatible"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec44"/>Making apps backward-compatible</h1></div></div></div><p>Throughout this book, we have focused entirely on developing for Android 5, and although the <a id="id399" class="indexterm"/>number of devices running this platform is bound to increase dramatically, they still only make up a small proportion of all active Android devices. In fact, <span class="strong"><strong>Jelly</strong></span> <span class="strong"><strong>Bean</strong></span> and <span class="strong"><strong>KitKat</strong></span> (APIs 16 through 19) still make up the vast majority of <a id="id400" class="indexterm"/>platform <a id="id401" class="indexterm"/>versions accessing the Google Play Store.</p><div class="mediaobject"><img src="graphics/B04321_10_01.jpg" alt="Making apps backward-compatible"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip26"/>Tip</h3><p>An up-to-date report of the relative distribution of platforms over all active devices can be found at <a class="ulink" href="http://developer.android.com/about/dashboards/index.html">http://developer.android.com/about/dashboards/index.html</a>. This page also contains similar information about currently used screen sizes and densities, and can greatly facilitate how we target users.</p></div></div><p>Obviously, we want our apps to reach as many people as possible and many of the apps we develop take very little adjustment to make them available to users running <a id="id402" class="indexterm"/>earlier versions. Fortunately, Android provides support libraries, such as <span class="strong"><strong>v7 AppCompat r21</strong></span> (or higher) to facilitate this.</p><div class="section" title="Adding the v7 support libraries"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec48"/>Adding the v7 support libraries</h2></div></div></div><p>Realistically, we should consider carefully which platforms we want our app to be available for, long <a id="id403" class="indexterm"/>before we <a id="id404" class="indexterm"/>start developing; for demonstration purposes, however, in this next short exercise we will make an app that we developed earlier in the book available to devices running API 16 and greater.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <span class="strong"><strong>Ancient Britain</strong></span> app that we developed earlier.</li><li class="listitem">Open the <code class="literal">manifest</code> file.</li><li class="listitem">Inside the root node, include this tag:<div class="informalexample"><pre class="programlisting">&lt;uses-sdk android:minSdkVersion="16"
    android:targetSdkVersion="22" /&gt;</pre></div></li><li class="listitem">Open the <code class="literal">build.gradle</code> file and add these dependencies:<div class="informalexample"><pre class="programlisting">compile 'com.android.support:cardview-v7:22.0.+'
compile 'com.android.support:recyclerview-v7:22.0.+'
compile "com.android.support:appcompat-v7:22.0.+"</pre></div></li><li class="listitem">Edit the default configuration, like so:<div class="informalexample"><pre class="programlisting">defaultConfig {
    applicationId "com.example.kyle.ancientbritain"
    minSdkVersion 16
    targetSdkVersion 22
    versionCode 1
    versionName "1.0"
}</pre></div></li><li class="listitem">Prepare an AVD or handset targeting API level 16:<div class="mediaobject"><img src="graphics/B04321_10_02.jpg" alt="Adding the v7 support libraries"/></div></li><li class="listitem">Run the app on the device. It will appear to work normally until you try to swipe the images on the DetailActivity screen, when it will crash.</li><li class="listitem">Open the <code class="literal">DetailActivity.java</code> file.</li><li class="listitem">In the <code class="literal">onShowPress()</code> and the <code class="literal">onFling()</code> methods, there is a call to <code class="literal">detailImage.setElevation()</code>. Apply conditional clauses to each, like so:<div class="informalexample"><pre class="programlisting">if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {
    detailImage.setElevation(4);
}

if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {
    detailImage.setElevation(0);
}</pre></div></li><li class="listitem">Run the app again to check that this fix has worked.</li></ol></div><p>Declaring <code class="literal">uses-sdk</code> in the manifest is essential as this is how the Play Store decides which devices it is <a id="id405" class="indexterm"/>visible<a id="id406" class="indexterm"/> to. The <span class="strong"><strong>v7 AppCompat r21+</strong></span> library is what makes backward-compatibility possible. Among <a id="id407" class="indexterm"/>other things, it provides very passable, Material Design widgets and other UI components. There are also libraries for the <span class="strong"><strong>RecyclerView</strong></span> and <a id="id408" class="indexterm"/>
<span class="strong"><strong>CardView</strong></span> and, although the shadows are not dynamic, this is a small <a id="id409" class="indexterm"/>price to pay, considering the vast number of users our app can now reach. </p><p>Changing the minimum SDK level is only the first thing we need to do to make our apps available to older versions As we saw, APIs with a level of 21 or higher will cause the app to crash when called, as with the<code class="literal"> setElevation()</code> call in this task. By being able to query a device's API at runtime, we have a way to work around this limitation and often with very little loss to the quality of user experience.</p><p>Another convenient way to counter this problem, is to create separate layouts for different platforms. You can create a <code class="literal">res/layout/v-21/</code> directory for your Material Design layouts and older alternatives in <code class="literal">res/layout/</code>.</p><p>To really bring<a id="id410" class="indexterm"/> the <span class="strong"><strong>Material</strong></span> <span class="strong"><strong>Design</strong></span> feel to older platforms, there is a lot more we can do to with these libraries, such as making our customized themes available, and this is what we will do next.</p></div></div></div>
<div class="section" title="Applying Material Design to older platforms"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec45"/>Applying Material Design to older platforms</h1></div></div></div><p>Usually when developing an app for pre-API 21 platforms, we set the minimum SDK at the<a id="id411" class="indexterm"/> lowest target level when we create the app rather than reverse-engineering the process as we just did. Here, we will see how we can add many <span class="strong"><strong>Material Design</strong></span> features. Developing this way round is also a good way to judge just how far backwards we want our app to be, and how much functionality we are prepared to lose.</p><p>This next exercise demonstrates how to build an app for API 16 and apply Material Design to the UI. To do this, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Start a new project in the <a id="id412" class="indexterm"/>Android Studio called <span class="strong"><strong>Material Jelly Bean</strong></span>.</li><li class="listitem">Do not use <code class="literal">com.example</code> in the package name.</li><li class="listitem">Select <span class="strong"><strong>Phone and Tablet</strong></span> as the form factor <a id="id413" class="indexterm"/>and <span class="strong"><strong>API 16</strong></span> as the minimum SDK. Note the number of devices that support your app.<div class="mediaobject"><img src="graphics/B04321_10_03.jpg" alt="Applying Material Design to older platforms"/></div></li><li class="listitem">Select <span class="strong"><strong>Blank Activity</strong></span> and leave everything else as is, or choose your own values.</li><li class="listitem">Add the following to the root node of the manifest file:<div class="informalexample"><pre class="programlisting">&lt;uses-sdk android:minSdkVersion="16"
        android:targetSdkVersion="22" /&gt;</pre></div></li><li class="listitem">Open the <code class="literal">res/values/styles.xml</code> file and fill it out like this:<div class="informalexample"><pre class="programlisting">&lt;resources&gt;
    &lt;style name="AppTheme" parent="Theme.AppCompat.Light"&gt;
        &lt;item name="colorPrimary"&gt;#ff7d00&lt;/item&gt;
        &lt;item name="colorPrimaryDark"&gt;#d96a00&lt;/item&gt;
        &lt;item name="colorAccent"&gt;#b25900&lt;/item&gt;
    &lt;/style&gt;
&lt;/resources&gt;</pre></div></li><li class="listitem">Open the <code class="literal">activity_main.xml</code> file.</li><li class="listitem">Change the root layout from a relative layout to a linear one and set its orientation by adding this:<div class="informalexample"><pre class="programlisting">android:orientation="vertical"</pre></div></li><li class="listitem">Convert <code class="literal">TextView</code> to this <code class="literal">EditText</code>:<div class="informalexample"><pre class="programlisting">&lt;EditText
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:hint="Hello ?"
    android:inputType="text" /&gt;</pre></div></li><li class="listitem">Run the app <a id="id414" class="indexterm"/>at this point and our Material Theme palette will have been applied:<div class="mediaobject"><img src="graphics/B04321_10_04.jpg" alt="Applying Material Design to older platforms"/></div></li><li class="listitem">Disable the Action Bar by setting the theme in the <code class="literal">styles.xml</code> file to:<div class="informalexample"><pre class="programlisting">Theme.AppCompat.Light.NoActionBar</pre></div></li><li class="listitem">Above <code class="literal">EditText</code>, place this toolbar: <div class="informalexample"><pre class="programlisting">&lt;android.support.v7.widget.Toolbar
    android:id="@+id/toolbar"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:background="?attr/colorPrimary"/&gt;</pre></div></li><li class="listitem">You may wish to adjust the padding of the layout in the <code class="literal">dimens.xml</code> file.</li><li class="listitem">Open your main activity file and add the following code to the <code class="literal">onCreate()</code> method:<div class="informalexample"><pre class="programlisting">Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);
if (toolbar != null) {
    setSupportActionBar(toolbar);
}</pre></div></li><li class="listitem">This will <a id="id415" class="indexterm"/>generate an import error. Use the quick fix to select the v7 Toolbar.</li><li class="listitem">Run the app on a API 16 device or emulator to see the Material Design style Toolbar.<div class="mediaobject"><img src="graphics/B04321_10_05.jpg" alt="Applying Material Design to older platforms"/></div></li></ol></div><p>The <span class="strong"><strong>AppCompat</strong></span> family of themes provides nearly all of the Material Design features we have <a id="id416" class="indexterm"/>become used to. The colors we have chosen to represent our app still appear throughout the app in familiar places and tinting various widgets, giving our app a consistent and recognizable feel. However, certain elements are still lost, and if you run the app on an Android 5 device, you will get the following output.</p><div class="mediaobject"><img src="graphics/B04321_10_06.jpg" alt="Applying Material Design to older platforms"/></div><p>There are two important things to notice about the way we implemented a <span class="strong"><strong>Material Toolbar</strong></span>. First, notice <a id="id417" class="indexterm"/>that our <code class="literal">MainActivity</code> class extends <span class="strong"><strong>ActionBarActivity</strong></span> and this has to be the case for any app <a id="id418" class="indexterm"/>we build using AppCompat, if it is to have a Toolbar. Second, note that the way we inflated it, unlike most views, with <code class="literal">setSupportActionBar()</code>. These are the only two real differences between the ways we are accustomed to managing Toolbars; other than this, everything can be done with classes and <a id="id419" class="indexterm"/>methods that we are familiar with.</p><p>There are one or two other things that can be done to bring Material Design to earlier versions but, for now, this is enough to set us on our way to bringing our apps to as many people as possible. Next, we move on to the serious subject of publishing our apps to the world.</p></div>
<div class="section" title="Publishing apps"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec46"/>Publishing apps</h1></div></div></div><p>It goes without saying that you will have exhaustively tested your app on a wide variety of handsets <a id="id420" class="indexterm"/>and emulators, probably prepared your promotional material, and checked <a id="id421" class="indexterm"/>out <span class="strong"><strong>Google Play Policies and Agreements</strong></span>. There are many things to consider before publication, such <a id="id422" class="indexterm"/>as <span class="strong"><strong>content rating</strong></span> and <span class="strong"><strong>country distribution</strong></span>. From a programming point of view there are just three things <a id="id423" class="indexterm"/>that we need to check before we proceed.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Remove all logging from the project, such as:<div class="informalexample"><pre class="programlisting">private static final String DEBUG_TAG = "tag";
Log.d(DEBUG_TAG, "some info");</pre></div></li><li class="listitem" style="list-style-type: disc">Make sure you have an application <code class="literal">label</code> and <code class="literal">icon</code> declared in your manifest, for example:<div class="informalexample"><pre class="programlisting">android:icon="@mipmap/<span class="strong"><strong>my_app_icon</strong></span>"
android:label="@string/<span class="strong"><strong>my_app_name</strong></span>"</pre></div></li><li class="listitem" style="list-style-type: disc">Ensure you have declared all the necessary permissions in the manifest, for example:<div class="informalexample"><pre class="programlisting">&lt;uses-permission android:name="android.permission.INTERNET" /&gt;
&lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" /&gt;</pre></div></li></ul></div><p>We are now just three steps from seeing our app on the Google Play Store. All we need to do is generate <a id="id424" class="indexterm"/>a <span class="strong"><strong>Signed Release APK</strong></span>, register<a id="id425" class="indexterm"/> as a <span class="strong"><strong>Google Play Developer</strong></span>, and finally upload our app to the Store or publish it on our own site. There are also one or two other ways of publishing an app and we will see how they are done at the end of the section. First, though, we will begin by generating an APK that is ready for uploading onto the Google Play Store.</p></div>
<div class="section" title="Generating a signed APK"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec47"/>Generating a signed APK</h1></div></div></div><p>All published Android apps require a digitally signed certificate. This is used to prove the authenticity of an app. Unlike many other digital certificates, there is no authority and you hold the signed key, which clearly has to be securely protected. To do this, we need to generate a private key and then use it to generate a signed APK. This can all be done in the <a id="id426" class="indexterm"/>Android Studio with the Generate Signed APK Wizard. These steps will take you through it.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the app you want to publish.</li><li class="listitem">Start the Generate Signed APK Wizard from the <span class="strong"><strong>Build | Generate Signed APK...</strong></span> menu.</li><li class="listitem">Select <span class="strong"><strong>Create new...</strong></span> on the first screen.</li><li class="listitem">On the next screen, provide a path and name for your key store along with a strong password.</li><li class="listitem">Do the same for the Alias.</li><li class="listitem">Select a Validity of greater than 27 years, like so:<div class="mediaobject"><img src="graphics/B04321_10_07.jpg" alt="Generating a signed APK"/></div></li><li class="listitem">Fill in at least one of the Certificate fields. Click on <span class="strong"><strong>OK</strong></span> and you will be taken back to the wizard.</li><li class="listitem">Select <span class="strong"><strong>release</strong></span> as the Build Variant and click on <span class="strong"><strong>Finish</strong></span>.</li><li class="listitem">You now have a signed APK ready for publication.</li></ol></div><p>The key store (<code class="literal">.jks</code> file) can be used to store any number of keys (aliases). Normally you would have a different key for each app you publish, and you must use the same key when producing updates of an app. Google require certificates to be valid until at least 22nd October, 2033 and any number that surpasses this date will suffice.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip27"/>Tip</h3><p>IMPORTANT: Keep at least one secure backup of your keys. If you lose them, you will not be able to develop future versions of those apps.</p></div></div><p>Most Android apps <a id="id427" class="indexterm"/>are packaged this way with one exception: Google Wear. If you are publishing <a id="id428" class="indexterm"/>a Wear app, you<a id="id429" class="indexterm"/> will first need to visit <a class="ulink" href="http://developer.android.com/training/wearables/apps/packaging.html">http://developer.android.com/training/wearables/apps/packaging.html</a>. With our digital certificate signed and in place, we are now only two steps from being published. If you have not already done so, it is time to register as a Google Play Developer.</p><div class="section" title="Registering as a developer"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec49"/>Registering as a developer</h2></div></div></div><p>As with Signing an APK, registering as a developer is similarly straightforward. Note that Google charges a<a id="id430" class="indexterm"/> one-off fee of USD 25 and 30% of any revenue your app may generate. The following directions assume that you already have a Google account.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Review <span class="strong"><strong>Supported Locations</strong></span> at:<p>
<a class="ulink" href="https://support.google.com/googleplay/android-developer/table/3541286?hl=en&amp;rd=1">https://support.google.com/googleplay/android-developer/table/3541286?hl=en&amp;rd=1</a>
</p></li><li class="listitem">Go to the Developer Play Console at:<p>
<a class="ulink" href="https://play.google.com/apps/publish/">https://play.google.com/apps/publish/</a>
</p></li><li class="listitem">Sign in with your Google account and enter the following information:<div class="mediaobject"><img src="graphics/B04321_10_08.jpg" alt="Registering as a developer"/></div></li><li class="listitem">Read and accept the <span class="strong"><strong>Google Play Developer Distribution Agreement</strong></span>.</li><li class="listitem">Pay the USD 25 with <a id="id431" class="indexterm"/>Google Checkout, creating an account if necessary, and that's it; you are now a registered Google Developer.</li></ol></div><p>If you intend to<a id="id432" class="indexterm"/> make your apps available worldwide, then it is always worth checking the Supported Locations page, as it changes regularly. The only thing left to do is upload our app, which we will do now.</p></div><div class="section" title="Publishing an app on the Google Play Store"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec50"/>Publishing an app on the Google Play Store</h2></div></div></div><p>Uploading and <a id="id433" class="indexterm"/>publishing our apps to the Play Store is done through the <span class="strong"><strong>Developer Console</strong></span>. As <a id="id434" class="indexterm"/>you will <a id="id435" class="indexterm"/>see, there is a lot of information and promotional material that we could provide about our app during this process. Provided, you have followed the previous steps in this chapter and have a release-ready signed <code class="literal">.apk</code> file, complete the following instructions to publish it. Alternatively, you may just want to have a look at what is involved at this point and what form the promotional material will take. In this case, ensure you have the following four images and a signed APK, and select <span class="strong"><strong>Save Draft</strong></span> at the end rather than <span class="strong"><strong>Publish app</strong></span>.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">At least two screenshots of your app. These must not have any side that is shorter than 320 px or longer than 3840 px.</li><li class="listitem" style="list-style-type: disc">If you want your app to be visible on the Play Store to users searching for apps designed for tablets, then you should prepare at least one 7-inch and one 10 inch screenshot.</li><li class="listitem" style="list-style-type: disc">A <span class="strong"><strong>Hi-res icon</strong></span> image of 512 x 512 px.</li><li class="listitem" style="list-style-type: disc">A <span class="strong"><strong>Feature Graphic</strong></span> of 1024 x 500 px, for example; with these images prepared and a signed <code class="literal">.apk</code> file, we have all we need to start. Decide how much, if anything, you wish to charge for the app and then follow these instructions:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open your <span class="strong"><strong>Developer Console</strong></span>.</li><li class="listitem">Supply a <span class="strong"><strong>Title</strong></span> and click on the <span class="strong"><strong>Upload APK</strong></span> button.</li><li class="listitem">Click on <span class="strong"><strong>Upload your first APK to Production</strong></span>.</li><li class="listitem">Locate your signed <code class="literal">app-release.apk</code> file. It will be in <code class="literal">AndroidStudioProjects\YourApp\app</code>.</li><li class="listitem">Drag-and-drop this into the space suggested.</li><li class="listitem">When this is completed, you will be taken to the application page.</li><li class="listitem">Work your way through the top four sections:<div class="mediaobject"><img src="graphics/B04321_10_09.jpg" alt="Publishing an app on the Google Play Store"/></div></li><li class="listitem">Complete all required fields until the <span class="strong"><strong>Publish app</strong></span> button becomes clickable.</li><li class="listitem">If you need help, the <span class="strong"><strong>Why can't I publish?</strong></span> link above the button will list uncompleted compulsory fields.</li><li class="listitem">When all the required fields are completed, click on the <span class="strong"><strong>Publish app</strong></span> (or <span class="strong"><strong>Save draft</strong></span>) button at the top of the page.</li><li class="listitem">Congratulations! You are now a published Android Developer.</li></ol></div></li></ul></div><p>We now know <a id="id436" class="indexterm"/>how to <a id="id437" class="indexterm"/>publish <a id="id438" class="indexterm"/>our apps on the Play Store. There are, of course, many other app markets, and they all have their own uploading procedures. Google Play however provides the widest possible audience and is the obvious choice for publication.</p><p>Before we move on, there are two other methods of distribution that we will look at: publishing on a website and distributing via e-mail.</p></div></div>
<div class="section" title="Distributing by e-mail and websites"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec48"/>Distributing by e-mail and websites</h1></div></div></div><p>The first of these<a id="id439" class="indexterm"/> two methods is as simple to do as it sounds. If you attach the APK to an e-mail and it's opened <a id="id440" class="indexterm"/>on an <a id="id441" class="indexterm"/>Android device, the user will be offered the opportunity to install the app when the attachment is opened. On more recent devices, they will be able to tap an install button directly from the e-mail.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip28"/>Tip</h3><p>For both these methods, your users will have to allow the installation of <span class="strong"><strong>unknown sources</strong></span> in the security settings of their devices.</p></div></div><p>Distributing your app from your website is almost as simple as e-mailing it. All you need to do is host the APK file on your site somewhere and provide a download link along the lines of <code class="literal">&lt;a href="download_button.jpg" download="your_apk"&gt;</code>. When browsing <a id="id442" class="indexterm"/>your site <a id="id443" class="indexterm"/>from an <a id="id444" class="indexterm"/>Android device, a tap on your link will install your app on their device.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip29"/>Tip</h3><p>Distribution by e-mail provides no protection against piracy and should only be used with this in mind. The other methods are as secure as we could hope, but if you would like to take extra measures then Google offers a <span class="strong"><strong>Licensing Service</strong></span> that can be<a id="id445" class="indexterm"/> found at <a class="ulink" href="http://developer.android.com/google/play/licensing">developer.android.com/google/play/licensing</a>.</p></div></div><p>Whether we have released a paid app or a free one, we want to be able to reach as many users as possible. Google provides several tools to help us with this, as well as ways to monetize our apps, as we shall see next.</p><div class="section" title="Promoting and monetizing apps"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec51"/>Promoting and monetizing apps</h2></div></div></div><p>Very few apps become successful without first being well promoted. There are countless ways to <a id="id446" class="indexterm"/>do this <a id="id447" class="indexterm"/>and you will, no doubt, be well ahead of the curve on how to promote your products. To help you reach a wider audience, Google provides some handy tools to assist with promotion.</p><p>After looking at promotion tools, we will explore two ways to make money from our app: in-app payments and advertising.</p></div><div class="section" title="Promoting an app"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec52"/>Promoting an app</h2></div></div></div><p>There are two very simple methods, provided by Google, to help steer people towards <a id="id448" class="indexterm"/>our products on the Play Store; links from both websites and our apps and the <span class="strong"><strong>Google Play Badge,</strong></span> which provides official branding to our links.</p><p>We can add links to both individual apps and our publisher page, where all our apps can be browsed. We can include these links in our apps as well as our websites.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">To include a link to a specific app's page in the Play Store, use the full package name, as found in the Manifest, in the following format:<div class="informalexample"><pre class="programlisting">http://play.google.com/store/apps/details?id=<span class="strong"><strong>com.full.package.name</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">To Include this within an Android app, use:<div class="informalexample"><pre class="programlisting">market://details?id= <span class="strong"><strong>com.my.full.package.name</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">If you want a link to your publisher page and a list of all your products, use:<div class="informalexample"><pre class="programlisting">http://play.google.com/store/search?q=pub:<span class="strong"><strong>my publisher name</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">Make the same changes as before when linking from an app:<div class="informalexample"><pre class="programlisting">Market://search?q=pub:<span class="strong"><strong>my publisher name</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">To link to a specific search result, use:<div class="informalexample"><pre class="programlisting">search?q=<span class="strong"><strong>my search query</strong></span>&amp;c=apps.</pre></div></li><li class="listitem" style="list-style-type: disc">To use an official Google Badge as your link, replace one of the above elements with the highlighted HTML here:<div class="informalexample"><pre class="programlisting">&lt;a href="https://<span class="strong"><strong>play.google.com/store/search?q=pub:my publisher name</strong></span>"&gt;
  &lt;img alt="Get it on Google Play"
       src="https://developer.android.com/images/brand/en_generic_rgb_wo_60.png" /&gt;
&lt;/a&gt;</pre></div></li></ul></div><p>The <span class="strong"><strong>Badge</strong></span> comes in <a id="id449" class="indexterm"/>two sizes, <code class="literal">60.png</code> and <code class="literal">45.png</code>, and two styles, <code class="literal">"Android app on Google Play"</code> and <code class="literal">"Get it on Google Play"</code>. Simply change the relevant code to select the Badge that best suits your purpose.</p><div class="mediaobject"><img src="graphics/B04321_10_10.jpg" alt="Promoting an app"/></div><p>With our app published and with well-placed links to our Play Store page, it is now time to consider how we can profit from the inevitable downloads, and so we come to how to monetize our Android app.</p></div><div class="section" title="Monetizing an app"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec53"/>Monetizing an app</h2></div></div></div><p>There are many ways to <a id="id450" class="indexterm"/>make money from an app, but two of the most popular and effective are: <span class="strong"><strong>in-app billing</strong></span> (<span class="strong"><strong>IAB</strong></span>) and <span class="strong"><strong>advertising</strong></span>. In-app billing can become quite involved and <a id="id451" class="indexterm"/>perhaps deserves an entire chapter to itself. Here, we will see how to build an effective template that you can use as a foundation for an in-app product you might develop. It will include all the libraries and packages needed, along with some very useful helper classes.</p><p>Including <a id="id452" class="indexterm"/>
<span class="strong"><strong>Google AdMob</strong></span> advertisements in our apps is, in contrast, a very familiar process to us by now. An ad is in effect just another View, and can be identified and referenced just like any other Android widget. The final exercise of this chapter, and indeed this book, will be constructing a simple working AdMob demo. First, though, let us take a look at in-app billing.</p></div></div>
<div class="section" title="In-app billing"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec49"/>In-app billing</h1></div></div></div><p>There are a large <a id="id453" class="indexterm"/>number of products that users can purchase from within an app, from upgrades and unlockables to in-game objects and currencies. Whatever the user is buying, the Google checkout process ensures they will pay in the same way as they pay for other Play Store products. From the developer's point of view, each purchase will boil <a id="id454" class="indexterm"/>down to responding to the click of a button. We will need to install the <span class="strong"><strong>Google Play Billing Library</strong></span>, and add an <a id="id455" class="indexterm"/>
<span class="strong"><strong>AIDL</strong></span> file and some helper classes to our project. Here is how:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Start a new Android project or open one you want to add in-app billing to.</li><li class="listitem">Open the SDK Manager.</li><li class="listitem">Under <span class="strong"><strong>Extras</strong></span>, make sure you have the <span class="strong"><strong>Google Play Billing Library</strong></span> installed.</li><li class="listitem">Open the manifest and apply the following permission:<div class="informalexample"><pre class="programlisting">&lt;uses-permission android:name="com.android.vending.BILLING" /&gt;</pre></div></li><li class="listitem">In the Project pane of the Studio, right click on <span class="strong"><strong>app</strong></span> and select <span class="strong"><strong>New</strong></span> | <span class="strong"><strong>Folder</strong></span> | <span class="strong"><strong>AIDL Folder</strong></span>.</li><li class="listitem">From this folder as <span class="strong"><strong>aidl</strong></span>, create a <span class="strong"><strong>New</strong></span> | <span class="strong"><strong>Package</strong></span>, and fill out the resultant dialog like so:<div class="mediaobject"><img src="graphics/B04321_10_11.jpg" alt="In-app billing"/></div></li><li class="listitem">Locate and copy the <code class="literal">IinAppBillingService.aidl</code> file in the <code class="literal">sdk\extras\google\play_billing</code> directory.</li><li class="listitem">Paste the file into the <code class="literal">com.android.vending.billing</code> package.</li><li class="listitem">Create a <span class="strong"><strong>New | Package</strong></span> in the Java folder, selecting <code class="literal">...\app\src\main\java</code> from the dialog box.</li><li class="listitem">Name the package <code class="literal">com.</code><span class="strong"><strong>your.package.name</strong></span><code class="literal">.util</code> and click on <span class="strong"><strong>Finish</strong></span>.</li><li class="listitem">From the <code class="literal">play_billing</code> directory, locate and open the <code class="literal">TrivialDrive\src\com\example\android\trivialdrivesample\util</code> folder.</li><li class="listitem">Copy the nine Java files into the <code class="literal">util</code> package you just created.</li></ol></div><p>You now have a <a id="id456" class="indexterm"/>working template for any app you wish to include on in-app purchasing. Alternatively, you can complete the above steps on a project where you have already developed your in-app products. Either way, you will no doubt be taking advantage of the <code class="literal">IabHelper</code> class, which vastly simplifies the coding, providing listeners for every step of the purchasing process. Documentation on IAB can be <a id="id457" class="indexterm"/>found at <a class="ulink" href="http://developer.android.com/google/play/billing/billing_reference.html">http://developer.android.com/google/play/billing/billing_reference.html</a>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip30"/>Tip</h3><p>Before you can start to implement in-app purchases, you will need to secure a <a id="id458" class="indexterm"/>
<span class="strong"><strong>License Key</strong></span> for your app. This can be found in the app's details in your developer console.</p></div></div><p>Paid apps and in-app products are just two ways to make money from an app, and many people choose another, and often lucrative, route for monetizing their work through advertising. <span class="strong"><strong>Google AdMob</strong></span> allows <a id="id459" class="indexterm"/>for a great deal of flexibility and a familiar programming interface, as we shall see next.</p><div class="section" title="Including an advertisement"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec54"/>Including an advertisement</h2></div></div></div><p>There are many ways that we can earn money from advertising, but <span class="strong"><strong>AdMob</strong></span> provides <a id="id460" class="indexterm"/>one of the<a id="id461" class="indexterm"/> easiest. Not only does the service allow you to select what types of product you wish to advertise but it also provides great analytical tools and seamless payment into your Checkout account.</p><p>On top of this, an <span class="strong"><strong>AdView</strong></span> can be treated programmatically in a way that is almost identical to the methods we are used to and familiar with, as we shall see in this final exercise where we will develop a Hello World app with a demo banner AdMob ad.</p><p>Before you start this <a id="id462" class="indexterm"/>exercise, you will need to have signed up for an AdMob account at <a class="ulink" href="http://www.google.com/admob/">http://www.google.com/admob/</a>.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a project you want to test ads on or start a new Android project.</li><li class="listitem">Make sure you have the Google Repository installed with the SDK Manager.</li><li class="listitem">In the <code class="literal">build.gradle</code> file, add this dependency:<div class="informalexample"><pre class="programlisting">compile 'com.google.android.gms:play-services:7.0.+'</pre></div></li><li class="listitem">Rebuild the project.</li><li class="listitem">In the manifest, set these two permissions:<div class="informalexample"><pre class="programlisting">&lt;uses-permission android:name="android.permission.INTERNET" /&gt;
&lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" /&gt;</pre></div></li><li class="listitem">Within the <code class="literal">application</code> node, add this <code class="literal">meta-data</code> tag:<div class="informalexample"><pre class="programlisting">&lt;meta-data
    android:name="com.google.android.gms.version"
    android:value="@integer/google_play_services_version" /&gt;</pre></div></li><li class="listitem">Include this second Activity to the manifest:<div class="informalexample"><pre class="programlisting">&lt;activity
    android:name="com.google.android.gms.ads.AdActivity"
    android:configChanges="keyboard|keyboardHidden|orientation|screenLayout|uiMode|screenSize|smallestScreenSize"
    android:theme="@android:style/Theme.Translucent" /&gt;</pre></div></li><li class="listitem">Add the following string to the <code class="literal">res/values/strings.xml</code> file:<div class="informalexample"><pre class="programlisting">&lt;string name="ad_id"&gt;ca-app-pub-3940256099942544/6300978111&lt;/string&gt;</pre></div></li><li class="listitem">Open the <code class="literal">main_activity.xml</code> layout file.</li><li class="listitem">Add this second namespace to the root layout:<div class="informalexample"><pre class="programlisting"/></div></li><li class="listitem">Add this <code class="literal">AdView</code> under the <code class="literal">TextView</code>:<div class="informalexample"><pre class="programlisting">&lt;com.google.android.gms.ads.AdView
    android:id="@+id/ad_view"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_alignParentBottom="true"
    android:layout_centerHorizontal="true"
    ads:adSize="BANNER"
    ads:adUnitId="@string/ad_id"&gt;&lt;/com.google.android.gms.ads.AdView&gt;</pre></div></li><li class="listitem">In <a id="id463" class="indexterm"/>the <code class="literal">onCreate()</code> method of the MainActivity, insert these lines:<div class="informalexample"><pre class="programlisting">AdView adView = (AdView) findViewById(R.id.ad_view);
AdRequest adRequest = new AdRequest.Builder()
        .addTestDevice(AdRequest.DEVICE_ID_EMULATOR)
        .build();

adView.loadAd(adRequest);</pre></div></li><li class="listitem">Now test the app on a device.<div class="mediaobject"><img src="graphics/B04321_10_12.jpg" alt="Including an advertisement"/></div></li></ol></div><p>More or less everything we did here resembles the way that we would program any other element, with one or two exceptions. The use of the <code class="literal">ACCESS_NETWORK_STATE</code> permission is not strictly necessary; it is used here to check for a connection prior to requesting an ad.</p><p>Any Activity that <a id="id464" class="indexterm"/>displays an ad will require a separate ID and be declared in the manifest. The ID supplied here is for testing purposes only and it is forbidden to use live IDs for testing purposes. There are only six classes in the <code class="literal">android.gms.ads</code> package and <a id="id465" class="indexterm"/>documentation for all of them can be found at <a class="ulink" href="https://developers.google.com/android/reference/com/google/android/gms/ads/package-summary">https://developers.google.com/android/reference/com/google/android/gms/ads/package-summary</a>.</p><p>AdMob ads come in two flavors, the banner that we saw here and the interstitial, or full screen. We only dealt with banner ads here but interstitial ads are handled in a very similar manner. With a knowledge of how to implement paid apps, in-app billing and AdMob, we are now armed to reap the rewards of our hard work and make the very most of our apps.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec50"/>Summary</h1></div></div></div><p>In this chapter, we have covered the final aspect of the app development process: packaging and deployment. We began by making our apps backward-compatible, including many of the features we had originally designed for Android 5; by doing, so we were able to reach a far wider audience. We continued by preparing and then publishing our app in the Google Play Store. Once published, we saw how easy it is to promote and then monetize an Android app.</p><p>This concludes our journey into the world of Android development. We have gone from installation to publication and hopefully covered most of the components required for the apps that you are planning. If you are new to developing or IDEs such as the Android Studio and have worked your way through this book, then what was previously a daunting set of tools will now seem like a familiar and productive place to work.</p><p>The Android platform will, no doubt, continue to flourish and develop in new and unexpected ways. Android 5 is the perfect entry point; with Material Design at its core and the most powerful set of mobile APIs available, things can only get better and brighter for Android developers.</p></div></body></html>