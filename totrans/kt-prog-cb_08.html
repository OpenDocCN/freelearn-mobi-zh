<html><head></head><body><div><h1 class="header-title">Anko Commons and Extension Function</h1>
                
            
            
                
<p class="mce-root">The following recipes will be covered in this chapter:</p>
<ul>
<li style="font-weight: 400">Setting up Anko with Gradle</li>
</ul>
<ul>
<li style="font-weight: 400">Extending Android framework using extension function</li>
</ul>
<ul>
<li style="font-weight: 400">Using extensions as properties</li>
</ul>
<ul>
<li style="font-weight: 400">Using intents with Anko</li>
</ul>
<ul>
<li style="font-weight: 400">Making a call intent using Anko</li>
</ul>
<ul>
<li style="font-weight: 400">Sending a text intent using Anko</li>
</ul>
<ul>
<li style="font-weight: 400">Browsing the web browser using Anko</li>
</ul>
<ul>
<li style="font-weight: 400">Sharing some text using intents in Anko</li>
</ul>
<ul>
<li style="font-weight: 400">Sending an email using Anko</li>
</ul>
<ul>
<li style="font-weight: 400">Creating Android dialogs with Anko</li>
</ul>
<ul>
<li style="font-weight: 400">Showing an alert dialog with a list of text items</li>
</ul>
<ul>
<li style="font-weight: 400">Using Anko in Views</li>
</ul>
<ul>
<li style="font-weight: 400">Logging using Anko</li>
</ul>
<ul>
<li style="font-weight: 400">Handling dimensions with Anko</li>
</ul>
<ul>
<li style="font-weight: 400">Version checking in Android</li>
</ul>


            

            
        
    </div>



  
<div><h1 class="header-title">Introduction</h1>
                
            
            
                
<p><strong>Anko</strong> is a Kotlin library that was developed to make the Android development experience better. Kotlin itself makes Android development easier, and Anko is a cherry on top of it. With helpers for almost all common Android functionalities, Anko drastically reduces the amount of code you write and makes Android development fun.</p>
<p>Anko consists of several parts:</p>
<ul>
<li><strong>Anko Commons</strong>: It consists of helper methods for intents, dialogs, logging, and so on, which reduces the amount of code significantly.</li>
<li><strong>Anko Layouts</strong>: With this library, you don't have to stick to conventional XML to create visual interfaces. Anko layout is a fast and type-safe way to write dynamic Android layouts.</li>
<li><strong>Anko SQLite</strong>: This is a query DSL and parser collection for Android SQLite, which makes working with underlying SQLite database substantially easy.</li>
<li><strong>Anko Coroutines</strong>: Coroutines are a great way to do asynchronous programming. Anko coroutines provide utilities based on the <kbd>kotlinx.coroutines</kbd> ( <a href="https://github.com/Kotlin/kotlinx.coroutines">https://github.com/Kotlin/kotlinx.coroutines</a>) library.</li>
</ul>
<p>In this chapter, we will learn how to use Anko for Android development. So let's get started!</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Setting up Anko with Gradle</h1>
                
            
            
                
<p>We will begin by setting up the Anko library in our project. We will be using Gradle to handle the dependencies of the project.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>I'll be using Android Studio to write code. You can also find the source code in the 1-setting-up-anko-with-gradle branch of repository at <a href="https://gitlab.com/aanandshekharroy/Anko-examples">https://gitlab.com/aanandshekharroy/Anko-examples</a>.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it…</h1>
                
            
            
                
<p>Follow these steps to add Anko to your project using the Gradle build system:</p>
<ol>
<li>The easiest way to set up Anko with Gradle is do it by adding the following lines in your <kbd>build.gradle</kbd> file:</li>
</ol>
<pre>    compile "org.jetbrains.anko:anko:$anko_version"</pre>
<ol start="2">
<li>You can replace <kbd>$anko_version</kbd> with the latest version of Anko, which is 0.10.1 when this book was written.</li>
<li>The preceding compile statement will add all available features (including Commons, Layouts, SQLite) into your project at once. If you don't want that, and would prefer adding them separately as needed, here are the compile statements:</li>
</ol>
<ul>
<li><kbd>anko-commons</kbd>: This library contains a lot of helpers for Android SDK for Intents, Dialogs and Toasts, Logging, and Resource and Dimension:</li>
</ul>
<pre>    compile "org.jetbrains.anko:anko-commons:$anko_version"</pre>
<ul>
<li><strong>Anko Layouts</strong>:<em> </em>Anko Layouts is a DSL for writing dynamic Android layouts:</li>
</ul>
<pre style="padding-left: 60px">compile "org.jetbrains.anko:anko-sdk25:$anko_version" // sdk15,19,21,23 are also available
compile "org.jetbrains.anko:anko-appcompat-v7:$anko_version"</pre>
<ul>
<li><kbd>anko-sqlite</kbd>: This provides helpers for working with SQLite database:</li>
</ul>
<pre style="padding-left: 60px">compile "org.jetbrains.anko:anko-sqlite:$anko_version"<br/></pre>
<ul>
<li><kbd>anko-coroutines</kbd>: This library makes it easier to work with Kotlin coroutines:<br/></li>
</ul>
<pre style="padding-left: 60px">compile "org.jetbrains.anko:anko-coroutines:$anko_version"<br/></pre>


            

            
        
    </div>



  
<div><h1 class="header-title">Extending Android framework using extension function</h1>
                
            
            
                
<p> The heading of this recipe might seem very confusing to you as you might be thinking "How can I extend the super complex Android framework? And moreover, why should I?" We will be dealing with all the "what, why, and hows" of extension functions in this recipe. Extension functions are one of the greatest features of Kotlin. So let's dive into it.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>I'll be using Android Studio for coding. We will be creating extension functions for Android SDK classes.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it…</h1>
                
            
            
                
<p>To begin with, let's see a very simple example:</p>
<ol>
<li>We will create a very simple class <kbd>Student</kbd>, and we will create an extension function for it:</li>
</ol>
<pre style="padding-left: 60px">class Student(val age:Int)</pre>
<ol start="2">
<li>Now, we would want to create an <kbd>isAgeGreaterThan20</kbd> function, which will return <kbd>true</kbd> if the age is greater than 20, or else, will return <kbd>false</kbd>. Now suppose there's a restriction that we can't touch the Student class, what will you do?</li>
<li>In those scenarios, extension functions come in handy when you want to extend the functionality of a class. If you try to call the method, you will be shown an error, as follows:</li>
</ol>
<div><img height="156" width="829" src="img/f2ec5eac-255f-455e-9895-c1f060e66664.png"/></div>
<ol start="4">
<li>You then need to select the <kbd>Create extension function ....</kbd> option to create an extension function for it. When you select that option, you'll again be given two options, asking which object you want to create the extension function.</li>
</ol>
<div><img height="165" width="649" src="img/5ae7f8e6-9f9c-44ff-b110-5084ebe6e17a.png"/></div>
<ol start="5">
<li>Since we want to create the function for the <kbd>Student</kbd> class, we will select the Student option from the dropdown. On selecting that, the IDE will autogenerate the method body. I've modified the return type to return a boolean:</li>
</ol>
<pre style="padding-left: 60px">private fun Student.isAgeGreaterThan20(): Boolean {<br/>    <br/>}</pre>
<ol start="6">
<li>Then, we can do the operation inside the method block. Here's how our method looks:</li>
</ol>
<pre style="padding-left: 60px">private fun Student.isAgeGreaterThan20(): Boolean {<br/>    return this.age&gt;20<br/>}</pre>
<ol start="7">
<li>Note that since we are calling the method on a student object, we can access it using the <kbd>this</kbd> keyword, though you can skip the <kbd>this</kbd> keyword in this case, as we aren't dealing with other objects of the same type in this method.</li>
<li>Now, we can call it just like you would call a normal method:</li>
</ol>
<pre style="padding-left: 60px">fun main(args: Array&lt;String&gt;) {<br/>    val studentA=Student(25)<br/>    println(studentA.isAgeGreaterThan20())<br/>}<br/>&gt;<br/>//Output:<strong> true</strong></pre>
<ol start="9">
<li>Now, let's see an example related to Android. If you've used any third-party library like <kbd>Picasso</kbd> or <kbd>Glide</kbd>, you might remember setting images in <kbd>ImageView</kbd> like this:</li>
</ol>
<pre style="padding-left: 60px">Picasso.with(context).from(url).into(imageView);</pre>
<ol start="10">
<li>You can create an extension function for <kbd>ImageView</kbd> named <kbd>loadImage</kbd> and then call that function in your application. Of course, <kbd>loadImage</kbd> is not a function provided by the <kbd>ImageView</kbd> class, so you need to create an extension function for this purpose. We will call the method on the <kbd>imageView</kbd> object and pass a <kbd>url</kbd>:</li>
</ol>
<pre style="padding-left: 60px">imageView.loadImage(url)<br/>private fun ImageView.loadImage(url: String) {<br/>    Picasso.with(this.context).load(url).into(this)<br/>}</pre>
<ol start="11">
<li>Note that in the <kbd>loadImage</kbd> function, we are referring <kbd>this</kbd> to the <kbd>ImageView</kbd> object on which the function was called.</li>
</ol>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works…</h1>
                
            
            
                
<p><strong>Extension functions</strong> are resolved statically, which means they are normal static methods and have no connection to the class they are extending (that's why we are able to extend classes to which we don't have access to modify), other than taking an instance of this class as a parameter.</p>
<p>If you decompile the Kotlin bytecode, you will see the code converted to Java:</p>
<pre>private static final boolean isAgeGreaterThan20(@NotNull Student $receiver) {<br/>   return $receiver.getAge() &gt; 20;<br/>}</pre>
<p>As you can see, it is just a static method and takes the class as a parameter.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">There's more…</h1>
                
            
            
                
<p>Since extension functions come in handy, you might be tempted to use them a lot. However, with great power comes great responsibility. Since they are resolved statically, you shouldn't be using them everywhere, because static functions are difficult to test. Using it irresponsibly means your code will be less testable and hence less maintainable.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Using extensions as properties</h1>
                
            
            
                
<p>In the last recipe, we learned about extension functions. In this recipe, we will learn about extension properties. If you feel the need for one or more properties from the class, you can add them using the extension properties. In this recipe, we will learn how to use extension properties.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>I'll be using Android Studio for coding purposes. Ensure that you have the latest version of Android Studio with Kotlin configured.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it…</h1>
                
            
            
                
<p>Let's see an example of an extension property now:</p>
<ol>
<li>We will be using the example of shared preferences. You might be used to doing something like this to get hold of shared preferences:</li>
</ol>
<pre style="padding-left: 60px" class="java hljs">PreferenceManager.getDefaultSharedPreferences(this)</pre>
<ol start="2">
<li>You can create an extension property on the <kbd>Context</kbd> class with name preferences and access it as follows:</li>
</ol>
<pre style="padding-left: 60px" class="kotlin hljs css">val Context.preferences: SharedPreferences
       get() = PreferenceManager
       .getDefaultSharedPreferences(this)<br/>context.preferences.getInt("...")</pre>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works…</h1>
                
            
            
                
<p>The extension functions didn't modify the class, and the same goes with extension properties; they don't add properties to the class itself and hence we don't have any backing field in their case. Also, since we don't have any backing field, we can't initialize it. The only way too deal with them is using custom getter and setter.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">There's more…</h1>
                
            
            
                
<p>Similar to extension properties, we can have companion object extensions, which means we can add methods to the companion object of a class that helps us access it in a static way. Let's look at an example. Suppose we have a <kbd>Student</kbd> class:</p>
<pre>class Student(val age:Int){<br/>    companion object{<br/>        <br/>    }<br/>}</pre>
<p>Let's now add an extension method to the companion object:</p>
<pre>fun Student.Companion.sayHi(){<br/>    println("Hi")<br/>}</pre>
<p>Now you can access it on the class without creating an instance of the class:</p>
<pre>Student.sayHi()</pre>


            

            
        
    </div>



  
<div><h1 class="header-title">Using intents with Anko</h1>
                
            
            
                
<p><strong>Intents</strong> are one of the most common components used in Android apps. They can be thought of as a messenger used to transfer messages between different Android components. For example, you send an intent when you need to start an activity, you send an intent when you need to start a service. To launch an activity in Android, you are first needed to create an intent and then pass it to the <kbd>startActivity</kbd> method. In the following example, we will try to launch an activity with some data and flags:</p>
<pre>val intent = Intent(this, SomeActivity::class.java)
intent.putExtra("data", 5)
intent.setFlag(Intent.FLAG_ACTIVITY_SINGLE_TOP)
startActivity(intent)</pre>
<p>Also, you can assume an extra line for all data that you pass with the intent.</p>
<p>Anko has a better way to achieve similar results. In this recipe, we will learn how to achieve this (launching intents) using Anko library.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>I'll be using Android Studio for coding purpose. You need to include Anko library in your <kbd>build.gradle</kbd> file at app level. Just add these lines and you are good to go:</p>
<pre>compile "org.jetbrains.anko:anko-commons:$anko_version"</pre>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it…</h1>
                
            
            
                
<p>Creating an intent in Anko is very simple. Let's check the following steps:</p>
<ol>
<li>The functionality for which we wrote the preceding code can be achieved in just a few lines with Anko:</li>
</ol>
<div><pre style="padding-left: 60px">startActivity(intentFor&lt;SomeActivity&gt;("data" to 5).singleTop())</pre></div>
<ol start="2">
<li>If you don't want to add the flag, it is much simpler:</li>
</ol>
<div><pre style="padding-left: 60px">startActivity&lt;SomeActivity&gt;("data" to 5)</pre></div>
<ol start="3">
<li>Adding extra data doesn't require extra lines:</li>
</ol>
<pre style="padding-left: 60px">startActivity&lt;SomeActivity&gt;("data" to 5, "another_data" to 10)</pre>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works…</h1>
                
            
            
                
<p>Let's see the implementation of the preceding methods in the source code:</p>
<pre>inline fun &lt;reified T: Any&gt; Context.intentFor(vararg params: Pair&lt;String, Any?&gt;)</pre>
<p>The <kbd>intentFor</kbd> method takes <kbd>vararg</kbd> as a parameter, hence we are able to supply multiple data to it. This method calls <kbd>createIntent</kbd>, which actually creates an intent with supplied data, and it looks like this:</p>
<pre>fun &lt;T&gt; createIntent(ctx: Context, clazz: Class&lt;out T&gt;, params: Array&lt;out Pair&lt;String, Any?&gt;&gt;): Intent {<br/>    val intent = Intent(ctx, clazz)<br/>    if (params.isNotEmpty()) fillIntentArguments(intent, params)<br/>    return intent<br/>}<br/>private fun fillIntentArguments(intent: Intent, params: Array&lt;out Pair&lt;String, Any?&gt;&gt;) {<br/>    params.forEach {<br/>        val value = it.second<br/>        when (value) {<br/>            null -&gt; intent.putExtra(it.first, null as Serializable?)<br/>            is Int -&gt; intent.putExtra(it.first, value)<br/>            is Long -&gt; intent.putExtra(it.first, value)<br/>            is CharSequence -&gt; intent.putExtra(it.first, value)<br/>            is String -&gt; intent.putExtra(it.first, value)<br/>            is Float -&gt; intent.putExtra(it.first, value)<br/>            is Double -&gt; intent.putExtra(it.first, value)<br/>            is Char -&gt; intent.putExtra(it.first, value)<br/>            is Short -&gt; intent.putExtra(it.first, value)<br/>            is Boolean -&gt; intent.putExtra(it.first, value)<br/>            is Serializable -&gt; intent.putExtra(it.first, value)<br/>            is Bundle -&gt; intent.putExtra(it.first, value)<br/>            is Parcelable -&gt; intent.putExtra(it.first, value)<br/>            is Array&lt;*&gt; -&gt; when {<br/>                value.isArrayOf&lt;CharSequence&gt;() -&gt; intent.putExtra(it.first, value)<br/>                value.isArrayOf&lt;String&gt;() -&gt; intent.putExtra(it.first, value)<br/>                value.isArrayOf&lt;Parcelable&gt;() -&gt; intent.putExtra(it.first, value)<br/>                else -&gt; throw AnkoException("Intent extra ${it.first} has wrong type ${value.javaClass.name}")<br/>            }<br/>            is IntArray -&gt; intent.putExtra(it.first, value)<br/>            is LongArray -&gt; intent.putExtra(it.first, value)<br/>            is FloatArray -&gt; intent.putExtra(it.first, value)<br/>            is DoubleArray -&gt; intent.putExtra(it.first, value)<br/>            is CharArray -&gt; intent.putExtra(it.first, value)<br/>            is ShortArray -&gt; intent.putExtra(it.first, value)<br/>            is BooleanArray -&gt; intent.putExtra(it.first, value)<br/>            else -&gt; throw AnkoException("Intent extra ${it.first} has wrong type ${value.javaClass.name}")<br/>        }<br/>        return@forEach<br/>    }<br/>}</pre>
<p>As you can see, internally it creates the intent in the old fashion and calls <kbd>fillIntentArguments</kbd>, which fills the intent with the data.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Making a call intent using Anko</h1>
                
            
            
                
<p>In the last recipe, we learned how to create an intent using Anko library. In subsequent recipes, we will see how to do common things like sending messages, calls, mails, and so on using intents in Anko.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>I'll be using Android Studio for coding purposes. You need to include Anko library in your <kbd>build.gradle</kbd> file. Just add the following lines to your <kbd>build.gradle</kbd> file and you are good to go:</p>
<pre>compile "org.jetbrains.anko:anko-commons:$anko_version"</pre>
<p>You can also clone the <a href="https://gitlab.com/aanandshekharroy/Anko-examples">gitlab.com/aanandshekharroy/Anko-examples</a> repository and switch to the 3-intent-actions branch to get the source code.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it…</h1>
                
            
            
                
<p>Let's follow the given steps to make a call using intents:</p>
<ol>
<li>Anko provides wrappers around the most common actions that can be done using intents; one of them is making calls. For this purpose, Anko provides the <kbd>makeCall</kbd> function, which takes in the phone number you want to call:</li>
</ol>
<pre style="padding-left: 60px">makeCall("+9195XXXXXXXX")</pre>
<ol start="2">
<li>The <kbd>makeCall</kbd> function returns true if the action was successful, or returns false if it wasn't. One thing to note is that you need to add the <kbd>CALL_PHONE</kbd> permission in your manifest file:</li>
</ol>
<pre style="padding-left: 60px">&lt;uses-permission android:name="android.permission.CALL_PHONE"/&gt;</pre>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works…</h1>
                
            
            
                
<p>Let's see the source code of <kbd>makeCall function</kbd>:</p>
<pre>fun Context.makeCall(number: String): Boolean {<br/>    try {<br/>        val intent = Intent(Intent.ACTION_CALL, Uri.parse("tel:$number"))<br/>        startActivity(intent)<br/>        return true<br/>    } catch (e: Exception) {<br/>        e.printStackTrace()<br/>        return false<br/>    }<br/>}</pre>
<p>Beneath the wrapper, it's doing the same old way Android SDK used to do, that is, using an implicit intent of action <kbd>Intent.ACTION_CALL</kbd>.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Sending a text intent using Anko</h1>
                
            
            
                
<p>Anko provides a wrapper around the intent actions, which makes calling actions super easy. One of those actions is sending an SMS. In this recipe, we will see how to launch an intent that sends messages to a telephone number.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>I'll be using Android Studio for coding purposes. You need to include Anko library in your <kbd>build.gradle</kbd> file. Just add the given lines and you are good to go:</p>
<pre>compile "org.jetbrains.anko:anko-commons:$anko_version"</pre>
<p>You can also clone the <a href="https://gitlab.com/aanandshekharroy/Anko-examples">gitlab.com/aanandshekharroy/Anko-examples</a> repository and switch to the 3-intent-actions branch to get the source code.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it…</h1>
                
            
            
                
<p>Let's follow these steps to send an SMS using intents:</p>
<ol>
<li>Anko provides the <kbd>sendSMS</kbd> method, which takes in two parameters—one of them is the phone number, and the other is the message:</li>
</ol>
<pre style="padding-left: 60px">sendSMS("+9195XXXXXX","Hi")</pre>
<ol start="2">
<li>Calling this method will launch the messaging app, or will ask you which messaging app to launch if you have more than one type of that app and will prefill the message body. Calling this function requires you to add the following permission, without which it will throw a Security Exception:</li>
</ol>
<pre style="padding-left: 60px">&lt;uses-permission android:name="android.permission.SEND_SMS"/&gt;</pre>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works…</h1>
                
            
            
                
<p>To understand how its working, let's dive into its implementation:</p>
<pre>fun Context.sendSMS(number: String, text: String = ""): Boolean {<br/>    try {<br/>        val intent = Intent(Intent.ACTION_VIEW, Uri.parse("sms:$number"))<br/>        intent.putExtra("sms_body", text)<br/>        startActivity(intent)<br/>        return true<br/>    } catch (e: Exception) {<br/>        e.printStackTrace()<br/>        return false<br/>    }<br/>}</pre>
<p>As you can see, it uses an implicit intent to launch the messaging app on your device. Since this function requires a context, if you are calling it from a fragment, you need to call it as <kbd>activity.sendSMS(..)</kbd>.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Browsing the web browser using Anko</h1>
                
            
            
                
<p>In this recipe, we will talk about the Anko wrapper that will help us browse the website using a web browser. So let's get started.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>I'll be using Android Studio for coding purpose. You need to include Anko library in your <kbd>build.gradle</kbd> file. Just add this line of code and you are good to go:</p>
<pre>compile "org.jetbrains.anko:anko-commons:$anko_version"</pre>
<p>You can also clone the <a href="https://gitlab.com/aanandshekharroy/Anko-examples">gitlab.com/aanandshekharroy/Anko-examples</a> repository and switch to the <kbd>3-intent-actions</kbd> branch to get the source code.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it…</h1>
                
            
            
                
<p>Now, let's see how to launch a browser using an intent.</p>
<p>Anko provides a <kbd>browse</kbd> function, which takes in the web address and launches the browser on your device. If you have multiple browsers, it will show you some options to select it. Here's an example:</p>
<pre>browse("http://www.google.com")</pre>
<p>The web address you put in the parameter needs to have <kbd>http://</kbd> or <kbd>https://</kbd> as the prefix, otherwise it will throw an <kbd>ActivityNotFound</kbd> exception.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works…</h1>
                
            
            
                
<p>The <kbd>browse</kbd> function provided by Anko is just a syntactic sugar, beneath which we have the same old code that we used previously:</p>
<pre>fun Context.browse(url: String, newTask: Boolean = false): Boolean {<br/>    try {<br/>        val intent = Intent(Intent.ACTION_VIEW)<br/>        intent.data = Uri.parse(url)<br/>        if (newTask) {<br/>            intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)<br/>        }<br/>        startActivity(intent)<br/>        return true<br/>    } catch (e: ActivityNotFoundException) {<br/>        e.printStackTrace()<br/>        return false<br/>    }<br/>}</pre>
<p>Calling this method returns true or false, based on whether the action was successful or not.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Sharing some text using intents in Anko</h1>
                
            
            
                
<p>In this recipe, we will look at how to share text using Anko wrapper. Sharing text is a very common thing and Anko provides a wrapper for this action that is very easy to use. So let's get started!</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>I'll be using Android Studio for coding purposes. You need to include Anko library in your <kbd>build.gradle</kbd> file. Just add the given lines and you are good to go:</p>
<pre>compile "org.jetbrains.anko:anko-commons:$anko_version"</pre>
<p>You can also clone the repository at <a href="https://gitlab.com/aanandshekharroy/Anko-examples">gitlab.com/aanandshekharroy/Anko-examples</a> and switch to the <kbd>3-intent-actions</kbd> branch to get the source code.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it…</h1>
                
            
            
                
<p>In the following steps, we will see how to share text using an intent:</p>
<ol>
<li>Anko provides a <kbd>share</kbd> method, which takes in a string parameter, that is, the text to share and an optional parameter subject. The subject parameter can be particularly useful to share text via an email app. After all, who sends a subject for a whatsapp message, right? Let's see its implementation:</li>
</ol>
<pre style="padding-left: 60px">share("Hey","Some subject")</pre>
<ol start="2">
<li>Without the subject—this won't fill in the subject line in the mail:</li>
</ol>
<pre style="padding-left: 60px">share("Hey")</pre>
<p>It's that simple!</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works…</h1>
                
            
            
                
<p>If you look at the implementation, you will find that Anko has provided just a syntactic sugar that greatly reduces your lines of code to achieve a similar thing:</p>
<pre>fun Context.share(text: String, subject: String = ""): Boolean {<br/>    try {<br/>        val intent = Intent(android.content.Intent.ACTION_SEND)<br/>        intent.type = "text/plain"<br/>        intent.putExtra(android.content.Intent.EXTRA_SUBJECT, subject)<br/>        intent.putExtra(android.content.Intent.EXTRA_TEXT, text)<br/>        startActivity(Intent.createChooser(intent, null))<br/>        return true<br/>    } catch (e: ActivityNotFoundException) {<br/>        e.printStackTrace()<br/>        return false<br/>    }<br/>}</pre>
<p>As you can see, the library has taken care of all the issues that might crop up and just provided a helper function to make things faster and more fun.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Sending an email using Anko</h1>
                
            
            
                
<p>In this recipe, we will see how to send an email using Anko's wrapper. Sending an email is very useful as almost all apps provide a method of contact. So let's get started!</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>I'll be using Android Studio for coding purposes. You need to include Anko library in your <kbd>build.gradle</kbd> file. Just add these lines and you are good to go:</p>
<pre>compile "org.jetbrains.anko:anko-commons:$anko_version"</pre>
<p>You can also clone the repository at <a href="https://gitlab.com/aanandshekharroy/Anko-examples">gitlab.com/aanandshekharroy/Anko-examples</a> and switch to the <kbd>3-intent-actions</kbd> branch to get the source code.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it…</h1>
                
            
            
                
<p>We will use the <kbd>email</kbd> function provided by Anko library that takes three parameters, out of which only one is mandatory:</p>
<pre>email("support@XXXXXX.com","Subject","Text")</pre>
<p>You can remove the subject and text if you don't want prefilled text in the email.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works…</h1>
                
            
            
                
<p>Let's take a look at its implementation:</p>
<pre>fun Context.email(email: String, subject: String = "", text: String = ""): Boolean {<br/>    val intent = Intent(Intent.ACTION_SENDTO)<br/>    intent.data = Uri.parse("mailto:")<br/>    intent.putExtra(Intent.EXTRA_EMAIL, arrayOf(email))<br/>    if (subject.isNotEmpty())<br/>        intent.putExtra(Intent.EXTRA_SUBJECT, subject)<br/>    if (text.isNotEmpty())<br/>        intent.putExtra(Intent.EXTRA_TEXT, text)<br/>    if (intent.resolveActivity(packageManager) != null) {<br/>        startActivity(intent)<br/>        return true<br/>    }<br/>    return false<br/><br/>}</pre>
<p>As you can see, it checks for the extra data, such as the subject and message body, and then launches the email application. The email function provided by Anko is just a convenient method that reduces your line of code and makes your code look good.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Creating Android dialogs with Anko</h1>
                
            
            
                
<p>One of the really great features of Anko library is that it can help you create alert dialog quite easily and with much less code.</p>
<p>In this recipe, we will see how to create alert dialogs in Anko.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>I'll be using Android Studio to write code. You also need to include the Anko library by adding the following lines to your <kbd>build.gradle</kbd> file:</p>
<pre> compile "org.jetbrains.anko:anko:$anko_version"<br/></pre>
<p>You can find the source code in the 2-creating-dialogs-using-anko branch of the <a href="https://gitlab.com/aanandshekharroy/Anko-examples/">https://gitlab.com/aanandshekharroy/Anko-examples/</a> repository.<a href="https://gitlab.com/aanandshekharroy/Anko-examples/"/></p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it…</h1>
                
            
            
                
<p>Let's follow the mentioned steps to create a dialog in Kotlin:</p>
<ol>
<li>In the first example, we will try to create a simple alert box. To create it, you just need to follow this syntax:</li>
</ol>
<pre style="padding-left: 60px">alert("A simple alert","Alert") {<br/><br/>        }.show()</pre>
<ol start="2">
<li>If you try to run it, you will see something like this:</li>
</ol>
<div><img height="1280" width="720" src="img/566c798e-ee90-4723-888b-5b0d941edf00.jpeg"/></div>
<ol start="3">
<li>There are certain situations where you want the user to perform some actions, and so Anko provides you the methods for it. Check out the following example:</li>
</ol>
<pre style="padding-left: 60px">alert("Would you like some action?","Alert") {<br/>    yesButton {<br/>         toast("Clicked on Yes")<br/>    }<br/>    noButton {<br/>         toast("Clicked on No")<br/>    }<br/>    neutralPressed("Meh"){<br/>         toast("Not interest")<br/>    }<br/>}.show()</pre>
<ol start="4">
<li>This inflates the alert dialog, as illustrated:</li>
</ol>
<div><img height="1280" width="720" src="img/54361399-b69a-4644-badb-2045d793508a.jpeg"/></div>
<ol start="5">
<li>You can also customize the text of <kbd>yesButton</kbd> and <kbd>noButton</kbd> by replacing them with <kbd>positiveButton</kbd> and <kbd>negativeButton</kbd>. Here's an example:</li>
</ol>
<pre style="padding-left: 60px">alert("Would you like some action?","Alert") {<br/>    positiveButton("Hell Yeah!") {<br/>        toast("Clicked on Yes")<br/>    }<br/>    negativeButton("No way!") {<br/>        toast("Clicked on No")<br/>    }<br/>    neutralPressed("Meh?"){<br/>        toast("Not interest")<br/>    }<br/>}.show()</pre>
<p style="padding-left: 60px">If you run the preceding code, you will see a dialog appearing on your device, as follows:</p>
<div><img height="1280" width="720" src="img/f3464484-7132-4981-913e-81b073cbd23c.jpeg"/></div>
<ol start="6">
<li>Another common type of dialog used in Android development is a progress dialog. You can use Anko to create a progress dialog like this:</li>
</ol>
<div><img height="1280" width="720" src="img/480762d5-81a6-4cb1-bd6e-66db83fd8304.jpeg"/></div>
<ol start="7">
<li>This kind of progress dialogs is good for showing the user how much progress is made. It also provides functions such as <kbd>incrementProgressBy</kbd>, by which you can increase the progress bar. To create such a progress dialog, you need to use it like this example:</li>
</ol>
<pre style="padding-left: 60px">val dialog = progressDialog(message = "Please wait a bit…", title = "Fetching data")<br/>dialog.show()</pre>
<ol start="8">
<li>Perhaps you would like to have an indefinite progress bar, which looks like this:</li>
</ol>
<div><img height="1280" width="720" src="img/ea0ce6a8-8a54-4079-9223-361c32a6a2f1.jpeg"/></div>
<p>To create an indeterminate progress dialog as in the preceding screenshot, simply add the following lines to your previous code:</p>
<pre>indeterminateProgressDialog("This is an indeterminate progress dialog").show()</pre>


            

            
        
    </div>



  
<div><h1 class="header-title">Showing an alert dialog with a list of text items</h1>
                
            
            
                
<p>In the previous recipe, we saw how to create different types of dialogs. In this recipe, we will see how to create an alert dialog with a list of text items, which looks as illustrated in the following screenshot:</p>
<div><img height="1280" width="720" src="img/390e623f-5f95-421b-9087-e9ba66b8efc1.jpeg"/></div>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>I'll be using Android Studio to write code. You also need to include the Anko library by adding these lines to your <kbd>build.gradle</kbd> file:</p>
<pre> compile "org.jetbrains.anko:anko:$anko_version"</pre>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it…</h1>
                
            
            
                
<p>Let's go through the given steps to create an alert dialog with a list of items.</p>
<p>Anko provides selectors for creating a dialog with a list of items. Selectors are very easy to use. You just need to provide the title of alert dialog, the list, and the lambda that will be executed when an option is selected. Here's an implementation of it:</p>
<pre>val companies = listOf("Google", "Microsoft", "HP", "Apple")<br/>selector("Where do you work?", companies, { dialogInterface, i -&gt;<br/>    toast("So you work at ${companies[i]}, right?")<br/>})</pre>
<p>That's all folks! It's really simple and concise. So, in the preceding example, if you click on the list item, you will see a toast with a message that says "So you work at Google, right?"</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works…</h1>
                
            
            
                
<p>Anko hides all the complexity and gives you an easy-to-use function to achieve complex things. Let's check out the implementation of the selector function:</p>
<pre>fun Context.selector(<br/>        title: CharSequence? = null,<br/>        items: List&lt;CharSequence&gt;,<br/>        onClick: (DialogInterface, Int) -&gt; Unit<br/>) {<br/>    with(AndroidAlertBuilder(this)) {<br/>        if (title != null) {<br/>            this.title = title<br/>        }<br/>        items(items, onClick)<br/>        show()<br/>    }<br/>}</pre>
<p>As you can see, beneath the surface, it's just like the old way, but Anko provides syntactic sugar, which helps us achieve the same thing with less code.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Using Anko in Views</h1>
                
            
            
                
<p>Anko makes handling views and creating layouts extremely fast and easy. Using Anko, we can write clean code that is easy to read and write. In this recipe, we will learn how Anko can be used when dealing with views in Android.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>I'll be using Android Studio 3 to write code. You can get started by creating a new project in Kotlin with a blank activity in Android Studio 3+ as we won't be using any code from other recipes. You also need an intermediate understanding of Android development. Ensure that you have added Anko dependencies to your project by adding the following lines to your app level <kbd>build.gradle</kbd> file and syncing the project:</p>
<pre> compile "org.jetbrains.anko:anko:$anko_version"</pre>
<p>Here, <kbd>$anko_version</kbd> is the latest version of Anko out there.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it…</h1>
                
            
            
                
<p>Anko makes some common Android development stuff extremely easy, such as toasts, snackbars, and dialogs. Usually, showing these views takes a lot of code. Let's see how it is just a matter of a few lines of easy code with Anko:</p>
<p><strong>Alert dialog</strong>: A popup that appears on top of your view, commonly used for alerts:</p>
<ul>
<li>To show an alert, we use the following syntax (DSL syntax):</li>
</ul>
<pre style="padding-left: 60px">alert("Hi, I'm Moss", "This, Jen, is the internet") {<br/>    yesButton { toast("Oh…") }<br/>    noButton {toast("Well...") }<br/>}.show()</pre>
<ul>
<li>Consider that we use a dialog from the <kbd>Appcompat</kbd> dialog factory:</li>
</ul>
<pre style="padding-left: 60px">alert(Appcompat, "Hello, Jen.").show()</pre>
<ul>
<li>We can also show progress dialogs and indeterminate progress dialogs:</li>
</ul>
<pre style="padding-left: 60px">val dialog = progressDialog(message = "Please stand by", title = "Fetching data")<br/><br/>indeterminateProgressDialog("You just have to wait indefinitely Jen.").show()</pre>
<p><strong>Toasts</strong>: They can be used to display information for a short period of time:</p>
<ul>
<li>To show a toast, we can make use of one of the following syntaxes based on the need of the situation:</li>
</ul>
<pre style="padding-left: 60px">toast("Hi! I'm Roy")<br/>toast(R.string.meet_roy)<br/>longToast("We have been together for a long time.")</pre>
<p><strong>Snackbar</strong>: Snackbars are just like Toast messages, except that they provide action to interact with:</p>
<ul>
<li>There are different ways to show snackbars, based on whether you use string or string resource and what is the duration of timeout of the snackbar and whether you need an action button or not. For showing snackbars, you need a reference to the parent view in which you wish to show a snackbar. In the case of XML, you can find a method by Anko to get the view from its ID or in the case of DSL, you can directly use the variable in which you have stored the parent view. Here are some syntaxes that we can use:</li>
</ul>
<pre style="padding-left: 60px">snackbar(rootView, "Hi! I'm Jen")
snackbar(rootView, R.string.go_away_jen)
longSnackbar(rootView, "I'm going to be here for a long time")
snackbar(rootView, "What do you want?", "Click me") { doSomething() }</pre>
<p>Anko makes it easier to define layouts and handle already created layouts (in XML).</p>
<p><strong>Creating a layout in DSL</strong>:</p>
<ul>
<li>Creating a layout in DSL is very simple, and we can put it directly in the <kbd>onCreate()</kbd> method of activity, as in the following code:</li>
</ul>
<pre style="padding-left: 60px">lateinit var rootView: View<br/>lateinit var btn: Button<br/>lateinit var editText1: EditText<br/>lateinit var editText2: EditText<br/><br/>override fun onCreate(savedInstanceState: Bundle?) {<br/>    super.onCreate(savedInstanceState)<br/>    rootView = verticalLayout {<br/>        padding = dip(20)<br/>          <br/>        editText1 = editText { <br/>            hint = "What's your name?"<br/>        }<br/><br/>        editText2 = editText {<br/>            hint = "What's your message?"<br/>        }<br/>            <br/>        btn = button("Click me") {<br/>            onClick {<br/>                toast( "Hey! Here is a toast for you.")<br/>            }<br/>        }<br/>            <br/>    }<br/>}</pre>
<ul>
<li>Alternatively, we can put it in an external class that implements the <kbd>AnkoComponent</kbd> interface:</li>
</ul>
<pre style="padding-left: 60px">class MainActivity : AppCompatActivity() {<br/><br/>    override fun onCreate(savedInstanceState: Bundle?) {<br/>        super.onCreate(savedInstanceState)<br/>        MainActivityUI().setContentView(this)<br/>    }<br/><br/>    class MainActivityUI : AnkoComponent&lt;MainActivity&gt; {<br/>        override fun createView(ui: AnkoContext&lt;MainActivity&gt;) = with(ui) {<br/>            verticalLayout {<br/>                padding = dip(20)<br/><br/>                editText {<br/>                    hint = "What's your name?"<br/>                }<br/><br/>                editText {<br/>                    hint = "What's your message?"<br/>                }<br/><br/>                button("Click me") {<br/>                    onClick {<br/>                        toast( "Hey! Here is a toast for you.")<br/>                    }<br/>                }<br/><br/>            }<br/>        }<br/>    }<br/>}</pre>
<ul>
<li>Also, this is how our layout looks:</li>
</ul>
<div><img height="1282" width="722" src="img/0787be2d-8bd0-4073-9d6a-eaa3aceb09ea.jpeg"/></div>
<p><strong>Handling views of an already existing XML layout</strong>:</p>
<ul>
<li>Suppose we have the following XML layout from one of our old projects:</li>
</ul>
<pre style="padding-left: 60px">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;android.support.design.widget.CoordinatorLayout<br/>    xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    xmlns:tools="http://schemas.android.com/tools"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="match_parent"<br/>    tools:context="android.my_company.com.helloworldapp.HelloWorldActivity"&gt;<br/><br/>    &lt;android.support.design.widget.AppBarLayout<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:theme="@style/AppTheme.AppBarOverlay"&gt;<br/><br/>        &lt;android.support.v7.widget.Toolbar<br/>            android:id="@+id/toolbar"<br/>            android:layout_width="match_parent"<br/>            android:layout_height="?attr/actionBarSize"<br/>            android:background="?attr/colorPrimary"<br/>            app:popupTheme="@style/AppTheme.PopupOverlay" /&gt;<br/><br/>    &lt;/android.support.design.widget.AppBarLayout&gt;<br/><br/>    &lt;LinearLayout<br/>        xmlns:android="http://schemas.android.com/apk/res/android"<br/>        xmlns:app="http://schemas.android.com/apk/res-auto"<br/>        xmlns:tools="http://schemas.android.com/tools"<br/>        android:layout_width="match_parent"<br/>        android:layout_height="match_parent"<br/>        android:orientation="vertical"<br/>        android:background="@color/white"<br/>        app:layout_behavior="@string/appbar_scrolling_view_behavior"&gt;<br/><br/><br/>        &lt;EditText<br/>            android:id="@+id/name"<br/>            android:layout_width="match_parent"<br/>            android:layout_height="wrap_content"<br/>            android:hint="What is your name?"/&gt;<br/><br/>        &lt;EditText<br/>            android:id="@+id/message"<br/>            android:layout_width="match_parent"<br/>            android:layout_height="wrap_content"<br/>            android:hint="Your message"/&gt;<br/><br/>        &lt;Button<br/>            android:id="@+id/btn_send"<br/>            android:layout_width="match_parent"<br/>            android:layout_height="wrap_content"<br/>            android:text="Send"/&gt;<br/><br/>    &lt;/LinearLayout&gt;<br/><br/>&lt;/android.support.design.widget.CoordinatorLayout&gt;</pre>
<ul>
<li>We can use Anko to access the views from this XML layout and also get/set properties of these views. Check out this code:</li>
</ul>
<pre style="padding-left: 60px">override fun onCreate(savedInstanceState: Bundle?) {<br/>    super.onCreate(savedInstanceState)<br/>    setContentView(R.layout.activity_hello_world)<br/><br/>    var toolbar = find&lt;Toolbar&gt;(R.id.toolbar)<br/>    setSupportActionBar(toolbar)<br/><br/>    var name = find&lt;EditText&gt;(R.id.name)<br/>    var msg = find&lt;EditText&gt;(R.id.message)<br/>    var buttonSend = find&lt;Button&gt;(R.id.btn_send)<br/><br/>    buttonSend.onClick {<br/>        toast("Hello, ${name.text} we have recorded your message!")<br/>    }<br/>}</pre>
<p>This is how our layout looks:</p>
<div><img height="1282" width="722" src="img/e61718f6-10e1-46df-8c7a-0a85481acb8a.jpeg"/></div>


            

            
        
    </div>



  
<div><h1 class="header-title">Logging using Anko</h1>
                
            
            
                
<p>Logging is a great way to debug your application. You might have used <kbd>android.util.Log</kbd>, which wasn’t a very convenient way to log messages as it required you to provide the <kbd>Log</kbd> tag with every message and also required you to define the tag, which was usually the class name every time. Anko provides the anko-logger, which comes with anko-commons. It is a very convenient way of logging messages as it doesn’t require you to necessarily override the log tag. In this recipe, we will learn how to do it.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>I'll be using Android Studio to write the code. You need to add <kbd>anko-commons</kbd> to your <kbd>build.gradle</kbd> file. Anko logger comes within the <kbd>anko-commons</kbd> library:</p>
<pre>dependencies {
    compile "org.jetbrains.anko:anko-commons:$anko_version"
}</pre>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it…</h1>
                
            
            
                
<p>Follow the given steps to learn how to use logging with the help of Anko library:</p>
<ol>
<li>Logging in to Anko is very simple. You just need to implement <kbd>AnkoLogger</kbd>, as follows:</li>
</ol>
<pre style="padding-left: 60px">class MainActivity : AppCompatActivity(),AnkoLogger {</pre>
<ol start="2">
<li>Then, you can log messages, as follows:</li>
</ol>
<pre style="padding-left: 60px">info(“info message”)</pre>
<ol start="3">
<li>The following are the various levels of logging and their comparison with <kbd>android.Log.util</kbd>:</li>
</ol>
<div><table style="width: 418px;height: 554px">
<tbody>
<tr>
<td>
<p><strong>android.util.Log</strong></p>
</td>
<td>
<p><strong>AnkoLogger</strong></p>
</td>
</tr>
<tr>
<td>
<p><kbd>v()</kbd></p>
</td>
<td>
<p><kbd>verbose()</kbd></p>
</td>
</tr>
<tr>
<td>
<p><kbd>d()</kbd></p>
</td>
<td>
<p><kbd>debug()</kbd></p>
</td>
</tr>
<tr>
<td>
<p><kbd>i()</kbd></p>
</td>
<td>
<p><kbd>info()</kbd></p>
</td>
</tr>
<tr>
<td>
<p><kbd>w()</kbd></p>
</td>
<td>
<p><kbd>warn()</kbd></p>
</td>
</tr>
<tr>
<td>
<p><kbd>e()</kbd></p>
</td>
<td>
<p><kbd>error()</kbd></p>
</td>
</tr>
<tr>
<td>
<p><kbd>wtf()</kbd></p>
</td>
<td>
<p><kbd>wtf()</kbd></p>
</td>
</tr>
</tbody>
</table>
</div>
<ol start="4">
<li>The default tag name is a class name. If you want to override the <kbd>log</kbd> tag, you need to override the <kbd>loggertag</kbd> property:</li>
</ol>
<pre style="padding-left: 60px">class MainActivity : AppCompatActivity(),AnkoLogger {<br/>  override val loggerTag="CustomTag"</pre>
<ol start="5">
<li>You can also use logger as a plain object. The following is an example from the documentation that uses logger as a plain object:</li>
</ol>
<pre style="padding-left: 60px">class SomeActivity : Activity() {<br/>   private val log = AnkoLogger&lt;SomeActivity&gt;(this)<br/>   private val logWithASpecificTag = AnkoLogger("my_tag")<br/><br/>   private fun someMethod() {<br/>       log.warning("Big brother is watching you!")<br/>   }<br/>}</pre>
<ol start="6">
<li>Each method has two versions: plain and lazy (inlined):</li>
</ol>
<pre style="padding-left: 60px">info(“info message”)<br/>info{“info message”}</pre>
<ol start="7">
<li>The lazy version is executed if <kbd>Log.isLoggable(tag, Log.INFO)</kbd> is true.</li>
</ol>


            

            
        
    </div>



  
<div><h1 class="header-title">Handling dimensions with Anko</h1>
                
            
            
                
<p>In XML, we use <kbd>dp</kbd> or <kbd>dip</kbd> as <strong>density independent pixels</strong> for layouts and views and <kbd>sp</kbd> as scale independent pixels for text. <kbd>dp</kbd> is a virtual pixel used to define layout sizes in a density-independent way; <kbd>sp</kbd> is like <kbd>dp</kbd>, but it's also scaled according to the user's font preference. In this recipe, we will understand how we can define dimensions of views and text in <kbd>dp</kbd> and <kbd>sp</kbd> in DSL layouts.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>I'll be using Android Studio 3 to write code. You can get started by creating a new project in Kotlin with a blank activity in Android Studio 3+ as we won't be using any code from other recipes. You also need an intermediate understanding of Android development. Ensure that you have added Anko dependencies to your project by adding the following lines to your app-level <kbd>build.gradle</kbd> file and syncing the project:</p>
<pre> compile "org.jetbrains.anko:anko:$anko_version"</pre>
<p>Here, <kbd>$anko_version</kbd> is the latest version of Anko out there.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it…</h1>
                
            
            
                
<p>In the given steps, we will learn how to work with dimensions using Anko library:</p>
<ol>
<li>Let's make a layout with a button of 120 <kbd>dip</kbd> width and <kbd>wrapContent</kbd> height and a text view with 24 <kbd>sp</kbd> text size. I suggest you to do this on your own, using this syntax:</li>
</ol>
<pre style="padding-left: 60px">dip(dipValue)<br/>sp(spValue)</pre>
<ol start="2">
<li>The following is one way you can create the layout using the <kbd>dip()</kbd> and <kbd>sp()</kbd> methods. <kbd>sp</kbd> is usually used for text, but to demonstrate, I have used it for a view height in the next example. Anko takes the value of the <kbd>textSize</kbd> property in <kbd>sp</kbd> by default, while you have to provide float:</li>
</ol>
<pre style="padding-left: 60px">verticalLayout {<br/>    padding = dip(20)<br/><br/>    textView {<br/>        text = "A big text view"<br/>        textSize = 24f<br/>    }<br/><br/>    button("Click me") {<br/>        onClick {<br/>            toast( "Hey! Here is a toast for you.")<br/>        }<br/>    }.lparams(dip(280), sp(80))<br/><br/>}</pre>
<ol start="3">
<li>The following is how our layout looks:</li>
</ol>
<div><img height="1282" width="722" src="img/12671ffd-fe19-4557-8d32-97d95cc2bcf6.jpeg"/></div>
<ol start="4">
<li class="mce-root">Anko also provides additional methods for our convenience, which are <kbd>px2dip(pixels)</kbd> and <kbd>px2sp(pixels)</kbd>, to convert pixels to <kbd>dip</kbd> and <kbd>sp</kbd> respectively. I remember coding them by hand before Anko existed, so they are handy a lot of times.</li>
</ol>


            

            
        
    </div>



  
<div><h1 class="header-title">Version checking on Android</h1>
                
            
            
                
<p>Android versions are shipped out very frequently. With every latest version of Android, you get new features and new improvements. Though Google tries very hard to provide backward compatibility, they aren't able to do so always. For example, there is no backward compatibility for Material design components; you need to be targeting API levels greater than 21 in order to use them. This requires the developer to check beforehand whether the component is supported on that API level or not to ensure that your app runs smoothly on all levels. We usually do that as follows:</p>
<pre>if(Build.VERSION.SDK_INT&gt;Build.VERSION_CODES.JELLY_BEAN){<br/><br/>}</pre>
<p>Anko provides helper functions that help us achieve similar things but with easier syntax. In this recipe, we will see how to use it.</p>


            

            
        
    </div>



  
<div><h1 class="header-title">Getting ready</h1>
                
            
            
                
<p>I'll be using Android Studio to write code. You also need to include the Anko library by adding these lines to your <kbd>build.gradle</kbd> file:</p>
<pre> compile "org.jetbrains.anko:anko:$anko_version"</pre>


            

            
        
    </div>



  
<div><h1 class="header-title">How to do it…</h1>
                
            
            
                
<p>It's very easy to add version checks in Anko, and Anko provides two main functions for it:</p>
<ul>
<li><kbd>doIfSdk </kbd>: This takes in the version code as a parameter, and also a function. If the API level of device is equal to the version code supplied, the function is executed. Here's an example of this function:</li>
</ul>
<pre style="padding-left: 60px">doIfSdk(Build.VERSION_CODES.LOLLIPOP){<br/>    // Do something specific to version 21<br/>}</pre>
<ul>
<li><kbd>doFromSdk </kbd>: This also takes in the version code as a parameter, along with the function, and executes that function if the device SDK level is greater than or equal to the supplied version code. The following is an example of the same:</li>
</ul>
<pre style="padding-left: 60px">doFromSdk(Build.VERSION_CODES.LOLLIPOP){<br/>    // Execute this method on API &gt;=21<br/>}</pre>


            

            
        
    </div>



  
<div><h1 class="header-title">How it works…</h1>
                
            
            
                
<p>Let's see the implementation of the preceding two helper methods:</p>
<ul>
<li>For <kbd>doIfSdk</kbd>:</li>
</ul>
<pre style="padding-left: 60px">inline fun doIfSdk(version: Int, f: () -&gt; Unit) {<br/>    if (Build.VERSION.SDK_INT == version) f()<br/>}</pre>
<ul>
<li>For <kbd>doFromSdk</kbd>:</li>
</ul>
<pre style="padding-left: 60px">inline fun doFromSdk(version: Int, f: () -&gt; Unit) {<br/>    if (Build.VERSION.SDK_INT &gt;= version) f()<br/>}</pre>
<p>As you can see, it's just old Android SDK code behind the hood. The <kbd>doFromSdk</kbd> and <kbd>doIfSdk</kbd> are just the syntactic sugars on top of it.</p>


            

            
        
    </div>



  </body></html>