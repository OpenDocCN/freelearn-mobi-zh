<html><head></head><body><div id="book-content"><div id="sbo-rt-content"><div id="_idContainer557" class="Basic-Text-Frame">
    <h1 class="chapterNumber">22</h1>
    <h1 id="_idParaDest-275" class="chapterTitle">Getting Started with Collection Views</h1>
    <p class="normal">In the previous chapter, you implemented a search bar for the Journal List screen, and your app is now complete. However, your app is designed to suit the iPhone’s screen, and if you were to run it on an iPad or Mac, you’d see that it does not make the best use of the larger screen size.</p>
    <p class="normal">In this chapter, you will replace the table view on the Journal List screen with a <strong class="keyWord">collection view</strong>, which will make better use of the extra screen space available when you run your app on an iPad or Mac. You’ll also dynamically modify the number of columns and the collection view cell sizes when your device is rotated using size classes.</p>
    <p class="normal">First, in the <code class="inlineCode">Main</code> storyboard file, you’ll replace the table view on the Journal List screen with a collection view and configure the collection view cell to display the same information the table view cell used to display. Next, you’ll refactor the <code class="inlineCode">JournalListViewController</code> and <code class="inlineCode">JournalListTableViewCell</code> classes to work with the collection view and collection view cells you added. After that, you’ll add code to dynamically change the collection view cell size to suit the display your app is running on. Finally, you’ll test your app on different devices.</p>
    <p class="normal">By the end of this chapter, you’ll have learned about collection views, how to use collection view delegate and data source protocols, and how to dynamically modify your app’s interface based on size classes.</p>
    <p class="normal">The following topics will be covered in this chapter:</p>
    <ul>
      <li class="bulletList">Understanding collection views</li>
      <li class="bulletList">Modifying the Journal List screen to use a collection view</li>
      <li class="bulletList">Dynamically modifying collection view cell size using size classes</li>
      <li class="bulletList">Testing your app on different devices</li>
    </ul>
    <h1 id="_idParaDest-276" class="heading-1">Technical requirements</h1>
    <p class="normal">You will continue working on the <code class="inlineCode">JRNL</code> project that you modified in the previous chapter.</p>
    <p class="normal">The resource files and completed Xcode project for this chapter are in the <code class="inlineCode">Chapter22</code> folder of the code bundle for this book, which can be downloaded here:</p>
    <p class="normal"><a href="https://github.com/PacktPublishing/iOS-18-Programming-for-Beginners-Ninth-Edition%0D"><span class="url">https://github.com/PacktPublishing/iOS-18-Programming-for-Beginners-Ninth-Edition</span></a></p>
    <p class="normal">Check out the following video to see the code in action:</p>
    <p class="normal"><a href="https://youtu.be/yIJpBHzAHCU%0D"><span class="url">https://youtu.be/yIJpBHzAHCU</span></a></p>
    <p class="normal">Let’s start by learning about collection views in the next section.</p>
    <h1 id="_idParaDest-277" class="heading-1">Understanding collection views</h1>
    <p class="normal">A collection <a id="_idIndexMarker920"/>view is an instance of the <code class="inlineCode">UICollectionView</code> class. It manages an ordered collection of elements and presents them using customizable layouts.</p>
    <div class="note">
      <p class="normal">To learn <a id="_idIndexMarker921"/>more about collection views, visit <a href="https://developer.apple.com/documentation/uikit/uicollectionview"><span class="url">https://developer.apple.com/documentation/uikit/uicollectionview</span></a>.</p>
    </div>
    <p class="normal">The data displayed by a collection view is usually provided by a view controller. A view controller providing data for a collection view must adopt the <code class="inlineCode">UICollectionViewDataSource</code> protocol. This protocol declares a list of methods that tells the collection view how many cells to display and what to display in each cell.</p>
    <div class="note">
      <p class="normal">To learn <a id="_idIndexMarker922"/>more about the <code class="inlineCode">UICollectionViewDataSource</code> protocol, visit <a href="https://developer.apple.com/documentation/uikit/uicollectionviewdatasource"><span class="url">https://developer.apple.com/documentation/uikit/uicollectionviewdatasource</span></a>.</p>
    </div>
    <p class="normal">To provide user interaction, a view controller for a collection view must also adopt the <code class="inlineCode">UICollectionViewDelegate</code> protocol, which declares a list of methods triggered when a user interacts with the collection view.</p>
    <div class="note">
      <p class="normal">To learn <a id="_idIndexMarker923"/>more about the <code class="inlineCode">UICollectionViewDelegate</code> protocol, visit <a href="https://developer.apple.com/documentation/uikit/uicollectionviewdelegate"><span class="url">https://developer.apple.com/documentation/uikit/uicollectionviewdelegate</span></a>.</p>
    </div>
    <p class="normal">The way the collection view is laid out is specified by a <code class="inlineCode">UICollectionViewLayout</code> object. This determines the cell placement, supplementary views, and decoration views inside the collection view’s bounds. </p>
    <p class="normal">You’ll use the <code class="inlineCode">UICollectionViewFlowLayout</code> class, a subclass of the <code class="inlineCode">UICollectionViewLayout</code> class, for your app. Collection view cells in the collection view <a id="_idIndexMarker924"/>flow from one row or column to the next, with each row containing as many cells as will fit.</p>
    <div class="note">
      <p class="normal">To learn <a id="_idIndexMarker925"/>more about the <code class="inlineCode">UICollectionViewFlowLayout</code> class, visit <a href="https://developer.apple.com/documentation/uikit/uicollectionviewflowlayout"><span class="url">https://developer.apple.com/documentation/uikit/uicollectionviewflowlayout</span></a>.</p>
    </div>
    <p class="normal">A flow layout works with the collection view’s delegate object to determine the size of items, headers, and footers in each section and grid. That delegate object must conform to the <code class="inlineCode">UICollectionViewDelegateFlowLayout</code> protocol. This allows you to adjust layout information dynamically.</p>
    <div class="note">
      <p class="normal">To <a id="_idIndexMarker926"/>learn more about the <code class="inlineCode">UICollectionViewFlowLayoutDelegate</code> protocol, visit <a href="https://developer.apple.com/documentation/uikit/uicollectionviewdelegateflowlayout"><span class="url">https://developer.apple.com/documentation/uikit/uicollectionviewdelegateflowlayout</span></a>.</p>
    </div>
    <p class="normal">Now that you have a basic understanding of collection views, you’ll modify the Journal List screen by replacing the table view with a collection view in the next section.</p>
    <h1 id="_idParaDest-278" class="heading-1">Modifying the Journal List screen to use a collection view</h1>
    <p class="normal">At present, the Journal List screen in the <em class="italic">JRNL</em> app uses a table view. A table view presents <a id="_idIndexMarker927"/>table view cells using <a id="_idIndexMarker928"/>rows arranged in a single column. This works great on an iPhone, but if you were to run the app on an iPad, you’d see there is a lot of wasted screen space on the Journal List screen, as shown in the following figure:</p>
    <figure class="mediaobject"><img src="image/B31371_22_01.png" alt="" width="825" height="371"/></figure>
    <p class="packt_figref">Figure 22.1: Simulator showing Journal List screen containing a table view on an iPad</p>
    <p class="normal">To address this, you’ll replace the table view with a collection view, which will allow you to more effectively use the available screen space, as shown in the following figure:</p>
    <figure class="mediaobject"><img src="image/B31371_22_02.png" alt="" width="825" height="287"/></figure>
    <p class="packt_figref">Figure 22.2: Simulator showing Journal List screen containing a collection view on an iPad</p>
    <p class="normal">To implement <a id="_idIndexMarker929"/>a collection view on <a id="_idIndexMarker930"/>the Journal List screen, you’ll need to do the following:</p>
    <ol>
      <li class="numberedList" value="1">In the <code class="inlineCode">Main</code> storyboard file, replace the table view in the <strong class="screenText">Journal Scene</strong> with a collection view.</li>
      <li class="numberedList">Add UI elements to the collection view cell.</li>
      <li class="numberedList">Modify the <code class="inlineCode">JournalListTableViewCell</code> class to manage the collection view cell’s contents.</li>
      <li class="numberedList">Modify the <code class="inlineCode">JournalListViewController</code> class to manage what the collection view displays.</li>
      <li class="numberedList">Add methods to dynamically change the collection view cell’s size based on device screen size and orientation.</li>
    </ol>
    <p class="normal">You’ll start by modifying the <strong class="screenText">Journal Scene</strong> in the <code class="inlineCode">Main</code> storyboard file to use a collection view instead of a table view in the next section.</p>
    <h2 id="_idParaDest-279" class="heading-2">Replacing the table view with a collection view</h2>
    <p class="normal">At <a id="_idIndexMarker931"/>present, the <strong class="screenText">Journal Scene </strong>in the <code class="inlineCode">Main</code> storyboard file contains a table view. You’ll replace this with a collection view. Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">Open the <code class="inlineCode">JRNL</code> project <a id="_idIndexMarker932"/>you modified in the previous chapter and choose <strong class="screenText">iPad (10th generation)</strong> as the destination from the Destination menu:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_03.png" alt="" width="456" height="569"/></figure>
    <p class="packt_figref">Figure 22.3: Destination menu showing iPad (10th generation) selected</p>
    <ol>
      <li class="numberedList" value="2">Build and run your app, and note how it appears on the iPad’s screen:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_04.png" alt="" width="825" height="367"/></figure>
    <p class="packt_figref">Figure 22.4: Simulator showing iPad screen</p>
    <p class="normal-one">Although the app works as it should, note that a lot of space is wasted on the right side of the Journal List screen.</p>
    <ol>
      <li class="numberedList" value="3">Click the <a id="_idIndexMarker933"/>Stop button. Click the <strong class="screenText">Main</strong> storyboard file in the Project navigator. In the document outline, click the table view under <strong class="screenText">Journal Scene</strong>. Press the <em class="keystroke">Delete</em> key to remove it:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_05.png" alt="" width="812" height="330"/></figure>
    <p class="packt_figref">Figure 22.5: Editor area showing table view selected in the document outline</p>
    <ol>
      <li class="numberedList" value="4">Click the <a id="_idIndexMarker934"/>Library button to display the library. Type <code class="inlineCode">collec</code> in the filter field. A <strong class="screenText">Collection View</strong> object will appear as one of the results. Drag it to the middle of the view of the <strong class="screenText">Journal Scene</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_06.png" alt="" width="710" height="397"/></figure>
    <p class="packt_figref">Figure 22.6: Library with Collection View object selected</p>
    <ol>
      <li class="numberedList" value="5">Make sure the collection view is selected and click the Auto Layout Add New Constraints button:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_07.png" alt="" width="475" height="614"/></figure>
    <p class="packt_figref">Figure 22.7: Journal scene with collection view selected</p>
    <ol>
      <li class="numberedList" value="6">Type <code class="inlineCode">0</code> in <a id="_idIndexMarker935"/>the top, left, right, and bottom edge constraint fields and click all the pale red struts. Make sure all the struts have turned bright red and <strong class="screenText">Constrain to margins</strong> is not checked. Then, click the <strong class="screenText">Add 4 Constraints</strong> button:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_08.png" alt="" width="518" height="718"/></figure>
    <p class="packt_figref">Figure 22.8: Auto Layout – Add New Constraints pop-up dialog box</p>
    <p class="normal-one">This sets <a id="_idIndexMarker936"/>the space between the edges of the collection view and the edges of the enclosing view to 0, binding the collection view’s edges to those of the enclosing view.</p>
    <ol>
      <li class="numberedList" value="7">Verify that all four sides of the collection view are now bound to the edges of the screen as shown:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_09.png" alt="" width="451" height="742"/></figure>
    <p class="packt_figref">Figure 22.9: Journal Scene with collection view filling the screen</p>
    <ol>
      <li class="numberedList" value="8">With the <a id="_idIndexMarker937"/>collection view still selected, click the Size inspector button. Under <strong class="screenText">Collection View</strong>, set <strong class="screenText">Estimate Size</strong> to <strong class="screenText">None</strong>.</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_10.png" alt="" width="502" height="440"/></figure>
    <p class="packt_figref">Figure 22.10: Size inspector with Estimate Size highlighted</p>
    <p class="normal-one">You’ll be <a id="_idIndexMarker938"/>adding code to determine the collection view size dynamically later.</p>
    <ol>
      <li class="numberedList" value="9">You’ll need to re-establish the segue between the Journal List screen and the Journal Entry Detail screen. <em class="keystroke">Ctrl</em> + <em class="keystroke">Drag</em> from <strong class="screenText">Collection View Cell</strong> in the document outline to the <strong class="screenText">Entry Detail Scene</strong> and choose <strong class="screenText">Show</strong> from the pop-up menu.</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_11.png" alt="" width="812" height="327"/></figure>
    <p class="packt_figref">Figure 22.11: Editor area showing drag destination</p>
    <ol>
      <li class="numberedList" value="10">Click the <a id="_idIndexMarker939"/>newly added storyboard segue and click the Attributes inspector button. Under <strong class="screenText">Storyboard Segue</strong>, set <strong class="screenText">Identifier</strong> to <code class="inlineCode">entryDetail</code>.</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_12.png" alt="" width="812" height="358"/></figure>
    <p class="packt_figref">Figure 22.12: Attributes inspector with Identifier set to entryDetail</p>
    <p class="normal">You have added a collection view to the Journal Scene and used Auto Layout constraints to make it fill the screen, but the prototype collection view cell is currently empty. You’ll add UI elements to the collection view cell in the next section.</p>
    <h2 id="_idParaDest-280" class="heading-2">Adding UI elements to the collection view cell</h2>
    <p class="normal">You have replaced the table view inside the <strong class="screenText">Journal Scene</strong> with a collection view, but the prototype <a id="_idIndexMarker940"/>collection view cell inside the collection view is empty. You’ll need to add an image view and two labels to the prototype collection view cell and set up the constraints for them. This will make it match the table view cell used previously. Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">Select <strong class="screenText">Collection View Cell</strong> for the <strong class="screenText">Journal Scene</strong> in the document outline. Drag the right edge of the collection view cell to the right until it reaches the right side of the screen:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_13.png" alt="" width="775" height="295"/></figure>
    <p class="packt_figref">Figure 22.13: Editor area showing Collection View Cell</p>
    <ol>
      <li class="numberedList" value="2">Click the Size inspector button, and under <strong class="screenText">Collection View Cell</strong>, set <strong class="screenText">Height</strong> to <code class="inlineCode">90</code>.</li>
      <li class="numberedList">To add an image view to the table view cell, click the Library button. Type <code class="inlineCode">imag</code> into the filter field. An <strong class="screenText">Image View</strong> object will appear in the results. Drag it into the prototype cell:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_14.png" alt="" width="339" height="227"/></figure>
    <p class="packt_figref">Figure 22.14: Prototype cell with image view added</p>
    <ol>
      <li class="numberedList" value="4">With the <a id="_idIndexMarker941"/>image view selected, click the Add New Constraints button and enter the following values to set the constraints for the newly added image view:<ul>
          <li class="bulletList level-2">Top: <code class="inlineCode">0</code></li>
          <li class="bulletList level-2">Left: <code class="inlineCode">0</code></li>
          <li class="bulletList level-2">Bottom: <code class="inlineCode">0</code></li>
          <li class="bulletList level-2">Width: <code class="inlineCode">90</code></li>
        </ul>
      </li>
    </ol>
    <p class="normal-one"><strong class="screenText">Constrain to margins</strong> should not be checked. When done, click the <strong class="screenText">Add 4 Constraints</strong> button:</p>
    <figure class="mediaobject"><img src="image/B31371_22_15.png" alt="" width="375" height="545"/></figure>
    <p class="packt_figref">Figure 22.15: Constraints for image view</p>
    <ol>
      <li class="numberedList" value="5">Click the <a id="_idIndexMarker942"/>Attributes inspector button. Under <strong class="screenText">Image View</strong>, set <strong class="screenText">Image</strong> to <code class="inlineCode">face.smiling</code>:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_16.png" alt="" width="812" height="386"/></figure>
    <p class="packt_figref">Figure 22.16: Image View with Image set to face.smiling</p>
    <ol>
      <li class="numberedList" value="6">Next, you’ll <a id="_idIndexMarker943"/>add a label to display the journal entry date. Click the Library button. Type <code class="inlineCode">label</code> into the filter field. A <strong class="screenText">Label</strong> object will appear in the results. Drag it to the space between the image view you just added and the right side of the cell:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_17.png" alt="" width="336" height="203"/></figure>
    <p class="packt_figref">Figure 22.17: Prototype cell with label added</p>
    <ol>
      <li class="numberedList" value="7">In the <a id="_idIndexMarker944"/>Attributes inspector, under <strong class="screenText">Label</strong>, set<strong class="screenText"> Font </strong>to <strong class="screenText">Title 1</strong> using the <strong class="screenText">Font</strong> menu:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_18.png" alt="" width="469" height="398"/></figure>
    <p class="packt_figref">Figure 22.18: Attributes inspector for Label</p>
    <ol>
      <li class="numberedList" value="8">Click the <a id="_idIndexMarker945"/>Add New Constraints button and enter the following values to set the constraints for the label:<ul>
          <li class="bulletList level-2">Top: <code class="inlineCode">0</code></li>
          <li class="bulletList level-2">Left: <code class="inlineCode">8</code></li>
          <li class="bulletList level-2">Right: <code class="inlineCode">0</code></li>
        </ul>
      </li>
    </ol>
    <p class="normal-one"><strong class="screenText">Constrain to margins</strong> should be checked, which sets a standard margin of 8 points. When done, click the <strong class="screenText">Add 3 Constraints</strong> button.</p>
    <figure class="mediaobject"><img src="image/B31371_22_19.png" alt="" width="431" height="617"/></figure>
    <p class="packt_figref">Figure 22.19: Constraints for label</p>
    <ol>
      <li class="numberedList" value="9">Finally, you’ll <a id="_idIndexMarker946"/>add a label to display the journal entry title. Click the Library button. Type <code class="inlineCode">label</code> into the filter field. A <strong class="screenText">Label</strong> object will appear in the results. Drag it to the space between the label you just added and the bottom of the cell:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_20.png" alt="" width="418" height="262"/></figure>
    <p class="packt_figref">Figure 22.20: Prototype cell with second label added</p>
    <ol>
      <li class="numberedList" value="10">In the <a id="_idIndexMarker947"/>Attributes inspector, under <strong class="screenText">Label</strong>, set <strong class="screenText">Font</strong> to <strong class="screenText">Body</strong> using the <strong class="screenText">Font</strong> menu, and set <strong class="screenText">Lines</strong> to <code class="inlineCode">2</code>:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_21.png" alt="" width="507" height="536"/></figure>
    <p class="packt_figref">Figure 22.21: Attributes inspector for Label</p>
    <ol>
      <li class="numberedList" value="11">Click the <a id="_idIndexMarker948"/>Add New Constraints button and enter the following values to set the constraints for the label:<ul>
          <li class="bulletList level-2">Top: <code class="inlineCode">0</code></li>
          <li class="bulletList level-2">Left: <code class="inlineCode">8</code></li>
          <li class="bulletList level-2">Right: <code class="inlineCode">0</code></li>
        </ul>
      </li>
    </ol>
    <p class="normal-one"><strong class="screenText">Constrain to margins</strong> should be checked, which sets a standard margin of 8 points. When done, click the <strong class="screenText">Add 3 Constraints</strong> button.</p>
    <figure class="mediaobject"><img src="image/B31371_22_22.png" alt="" width="502" height="734"/></figure>
    <p class="packt_figref">Figure 22.22: Constraints for second label</p>
    <p class="normal">The prototype <a id="_idIndexMarker949"/>collection view cell now has an image view and two labels, and all the necessary constraints have been added. Fantastic! In the next section, you’ll modify the <code class="inlineCode">JournalListTableViewCell</code> class to manage the collection view cell’s contents.</p>
    <h2 id="_idParaDest-281" class="heading-2">Modifying the JournalListTableViewCell class</h2>
    <p class="normal">Originally, the <code class="inlineCode">JournalListTableViewCell</code> class was used to manage the table view instance’s <a id="_idIndexMarker950"/>table view cells in the Journal List screen. Since you have replaced the table view with a collection view, all the connections between the <code class="inlineCode">JournalListTableViewCell</code> class will need to be re-established to work with the UI elements that you just added to the collection view cell. Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">First, you’ll change the <code class="inlineCode">JournalListTableViewCell</code> class name to more accurately describe its new role. Click the <code class="inlineCode">JournalListTableViewCell</code><strong class="screenText"> </strong>file in the Project navigator. Right-click on the class name in the file and choose <strong class="screenText">Refactor</strong> | <strong class="screenText">Rename…</strong> from the pop-up menu:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_23.png" alt="" width="812" height="352"/></figure>
    <p class="packt_figref">Figure 22.23: Pop-up menu with Refactor | Rename… selected</p>
    <ol>
      <li class="numberedList" value="2">Change the name to <code class="inlineCode">JournalListCollectionViewCell</code> and click <strong class="screenText">Rename</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_24.png" alt="" width="812" height="231"/></figure>
    <p class="packt_figref">Figure 22.24: Editor area showing the new name</p>
    <ol>
      <li class="numberedList" value="3">You’ll <a id="_idIndexMarker951"/>modify the class declaration as this class is now used to manage a collection view cell. Change the superclass to <code class="inlineCode">UICollectionViewCell</code>:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">class</span> <span class="hljs-title">JournalListCollectionViewCell</span>: <span class="code-highlight"><strong class="hljs-type-slc">UICollectionViewCell</strong></span> {
</code></pre>
      </li>
      <li class="numberedList">You’ll now assign this class as the identity of the collection view cell. Click the <strong class="screenText">Main</strong> storyboard file in the Project navigator and click <strong class="screenText">Collection View Cell</strong> under <strong class="screenText">Journal Scene</strong> in the document outline:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_25.png" alt="" width="812" height="263"/></figure>
    <p class="packt_figref">Figure 22.25: Editor area showing Collection View Cell inside Journal Scene</p>
    <ol>
      <li class="numberedList" value="5">Click the Identity inspector button. Under the <strong class="screenText">Custom Class</strong> section, set <strong class="screenText">Class</strong> to <code class="inlineCode">JournalListCollectionViewCell</code>. This sets a <code class="inlineCode">JournalListCollectionViewCell</code> instance as the custom collection view subclass <a id="_idIndexMarker952"/>for the collection view cell. Press <em class="keystroke">Return</em> when done:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_26.png" alt="" width="496" height="291"/></figure>
    <p class="packt_figref">Figure 22.26: Identity inspector showing Class set to JournalListCollectionViewCell</p>
    <ol>
      <li class="numberedList" value="6">Click the Attributes inspector button. Under <strong class="screenText">Collection Reusable View</strong>, set <strong class="screenText">Identifier</strong> to <code class="inlineCode">journalCell</code>:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_27.png" alt="" width="502" height="274"/></figure>
    <p class="packt_figref">Figure 22.27: Attributes inspector showing Identifier set to journalCell</p>
    <p class="normal-one">Note <a id="_idIndexMarker953"/>that the name of the collection view cell in the document outline has changed to <strong class="screenText">journalCell</strong>.</p>
    <ol>
      <li class="numberedList" value="7">With<strong class="screenText"> journalCell</strong> selected in the document outline, click the Connections inspector button to display the outlets for <strong class="screenText">journalCell</strong>.</li>
      <li class="numberedList">Drag from the <strong class="screenText">photoImageView</strong> outlet to the image view in the table view cell.</li>
      <li class="numberedList">Drag from the <strong class="screenText">dateLabel</strong> outlet to the top label in the table view cell.</li>
      <li class="numberedList">Drag from the <strong class="screenText">titleLabel</strong> outlet to the bottom label in the table view cell.</li>
      <li class="numberedList">Verify that the connections look like the following screenshot when done:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_28.png" alt="" width="812" height="361"/></figure>
    <p class="packt_figref">Figure 22.28: Connections inspector showing the connections for journalCell</p>
    <div class="packt_tip">
      <p class="normal">Remember that if you make a mistake, you can click the <strong class="screenText">x</strong> to break the connection and drag from the outlet to the UI element once more.</p>
    </div>
    <p class="normal">The <code class="inlineCode">journalCell</code> collection view cell in the <code class="inlineCode">Main</code> storyboard file has now been set up with <a id="_idIndexMarker954"/>the <code class="inlineCode">JournalCollectionTableViewCell</code> class. The outlets for the collection view cell’s image view and labels have also been assigned. In the next section, you’ll update the <code class="inlineCode">JournalListViewController</code> class to work with a collection view instead of a table view.</p>
    <h2 id="_idParaDest-282" class="heading-2">Modifying the JournalListViewController class</h2>
    <p class="normal">At present, the <code class="inlineCode">JournalListViewController</code> class has an outlet for a <code class="inlineCode">UITableView</code> object <a id="_idIndexMarker955"/>and implemented data source and delegate methods to manage a table view. You’ll modify this class to work with a collection view instead. Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">First, you’ll modify the class declaration to work with a <code class="inlineCode">UICollectionView</code> instance. Click the <strong class="screenText">JournalListViewController </strong>file in the Project navigator. Modify the class declaration as shown:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">class</span> <span class="hljs-title">JournalListViewController</span>: <span class="hljs-type">UIViewController</span>, 
<span class="code-highlight"><strong class="hljs-type-slc">UICollectionViewDataSource</strong><strong class="hljs-slc">, </strong><strong class="hljs-type-slc">UICollectionViewDelegate</strong><strong class="hljs-slc">, </strong><strong class="hljs-type-slc">UICollectionViewDelegateFlowLayout </strong></span>{
</code></pre>
      </li>
    </ol>
    <p class="normal-one">Here, you’ve changed the data source and delegate protocols to the collection view equivalents and added conformance to a new protocol, <code class="inlineCode">UICollectionViewDelegateFlowLayout</code>. This protocol is used to determine how the collection view cells in a collection view are laid out. You will see an error because the collection view data source methods have not been implemented. Don’t worry about the error as you’ll fix it in a later step in this section.</p>
    <ol>
      <li class="numberedList" value="2">To change <a id="_idIndexMarker956"/>the name for the <code class="inlineCode">tableview</code> outlet, right-click it and choose <strong class="screenText">Refactor</strong> | <strong class="screenText">Rename…</strong> from the pop-up menu:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_29.png" alt="" width="812" height="246"/></figure>
    <p class="packt_figref">Figure 22.29: Pop-up menu with Refactor | Rename… selected</p>
    <ol>
      <li class="numberedList" value="3">Change the name to <code class="inlineCode">collectionView</code> and click <strong class="screenText">Rename</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_30.png" alt="" width="709" height="380"/></figure>
    <p class="packt_figref">Figure 22.30: Editor area showing the new name</p>
    <ol>
      <li class="numberedList" value="4">Since <a id="_idIndexMarker957"/>the view controller will be managing a collection view, change the outlet type from <code class="inlineCode">UITableView</code> to <code class="inlineCode">UICollectionView</code>:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">var</span> <span class="hljs-template-variable">collectionView</span>: <span class="code-highlight"><strong class="hljs-type-slc">UICollectionView</strong></span>!
</code></pre>
      </li>
      <li class="numberedList">To establish the connections between the UI element and your code, click the <strong class="screenText">Main</strong> storyboard file in the Project navigator and click the first <strong class="screenText">Journal Scene</strong> in the document outline.</li>
      <li class="numberedList">Click the Connections inspector button and drag from the <strong class="screenText">collectionView</strong> outlet to the <strong class="screenText">Collection View</strong> in the document outline:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_31.png" alt="" width="812" height="277"/></figure>
    <p class="packt_figref">Figure 22.31: Connections inspector showing the connections for JournalListViewController</p>
    <ol>
      <li class="numberedList" value="7">Click <strong class="screenText">Collection View</strong> in the document outline. Drag from the <strong class="screenText">dataSource</strong> and <strong class="screenText">delegate</strong> outlets <a id="_idIndexMarker958"/>to the view controller (shown as <strong class="screenText">Journal</strong>) in the document outline.</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_32.png" alt="" width="812" height="243"/></figure>
    <p class="packt_figref">Figure 22.32: Connections inspector showing the connections for collectionView</p>
    <ol>
      <li class="numberedList" value="8">Now you’ll fix the errors in the <code class="inlineCode">JournalListViewController</code> class. Click the <strong class="screenText">JournalListViewController</strong> file in the Project navigator and replace the table view data source methods in your code with these collection view data source methods:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// MARK: - UICollectionViewDataSource</span>
<span class="hljs-keyword">func</span> <span class="hljs-template-variable">collectionView</span>(<span class="hljs-template-variable">_</span> <span class="hljs-params">collectionView</span>: <span class="hljs-type">UICollectionView</span>, <span class="hljs-template-variable">numberOfItemsInSection</span> <span class="hljs-params">section</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span> {
  <span class="hljs-keyword">if</span> <span class="hljs-variable">search</span>.<span class="hljs-con-attribute">isActive</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable">filteredTableData</span>.<span class="hljs-con-attribute">count</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-con-class">SharedData</span>.<span class="hljs-variable">shared</span>.<span class="hljs-variable">numberOfJournalEntries</span>()
  }
}
<span class="hljs-keyword">func</span> <span class="hljs-template-variable">collectionView</span>(<span class="hljs-template-variable">_</span> <span class="hljs-params">collectionView</span>: <span class="hljs-type">UICollectionView</span>, <span class="hljs-template-variable">cellForItemAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) -&gt; <span class="hljs-type">UICollectionViewCell</span> {
  <span class="hljs-keyword">let</span> journalCell <span class="hljs-operator">=</span> collectionView.<span class="hljs-con-attribute">dequeueReusableCell</span>(  <span class="hljs-con-attribute">withReuseIdentifier</span>: <span class="hljs-string">"journalCell"</span>, <span class="hljs-con-attribute">for</span>: indexPath) <span class="hljs-keyword">as</span>! <span class="hljs-type">  </span><span class="hljs-con-class">JournalListCollectionViewCell</span>
  <span class="hljs-keyword">let</span> journalEntry: <span class="hljs-con-class">JournalEntry</span>
  <span class="hljs-keyword">if</span> search.<span class="hljs-con-attribute">isActive</span> {
    journalEntry <span class="hljs-operator">=</span> <span class="hljs-variable">filteredTableData</span>[indexPath.<span class="hljs-con-attribute">row</span>]
  } <span class="hljs-keyword">else</span> {
    journalEntry <span class="hljs-operator">=</span> <span class="hljs-con-class">SharedData</span>.<span class="hljs-variable">shared</span>.<span class="hljs-variable">journalEntry</span>(<span class="hljs-variable">at</span>:     indexPath.<span class="hljs-con-attribute">row</span>)
  }
  <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> photoData <span class="hljs-operator">=</span> journalEntry.<span class="hljs-variable">photoData</span> {
    journalCell.<span class="hljs-variable">photoImageView</span>.<span class="hljs-con-attribute">image</span> <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(<span class="hljs-con-attribute">data</span>:    photoData)
  }
  journalCell.<span class="hljs-variable">dateLabel</span>.<span class="hljs-con-attribute">text</span> <span class="hljs-operator">=</span> journalEntry.<span class="hljs-variable">date</span>.<span class="hljs-con-attribute">formatted</span>(
   .<span class="hljs-con-attribute">dateTime</span>.<span class="hljs-con-attribute">month</span>().<span class="hljs-con-attribute">day</span>().<span class="hljs-con-attribute">year</span>()
  )
  journalCell.<span class="hljs-variable">titleLabel</span>.<span class="hljs-con-attribute">text</span> <span class="hljs-operator">=</span> journalEntry.<span class="hljs-variable">entryTitle</span>
  <span class="hljs-keyword">return</span> journalCell
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">As you can see, they are very similar to the table view data source methods that you used previously.</p>
    <ol>
      <li class="numberedList" value="9">As you <a id="_idIndexMarker959"/>are now using a collection view, <code class="inlineCode">tableView(_:commit:forRowAt:)</code> can no longer be used to remove cells. Replace the <code class="inlineCode">tableView(_:commit:forRowAt:)</code> method with the following method:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// MARK: - UICollectionView delete method</span>
<span class="hljs-keyword">func</span> <span class="hljs-template-variable">collectionView</span>(<span class="hljs-template-variable">_</span> <span class="hljs-params">collectionView</span>: <span class="hljs-type">UICollectionView</span>, <span class="hljs-template-variable">contextMenuConfigurationForItemsAt</span> <span class="hljs-params">indexPaths</span>: [<span class="hljs-type">IndexPath</span>], <span class="hljs-template-variable">point</span>: <span class="hljs-type">CGPoint</span>) -&gt; <span class="hljs-type">UIContextMenuConfiguration</span>? {
  <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> indexPath <span class="hljs-operator">=</span> indexPaths.<span class="hljs-con-attribute">first</span> <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
  }
  <span class="hljs-keyword">let</span> config <span class="hljs-operator">=</span> <span class="hljs-type">UIContextMenuConfiguration</span>(
  <span class="hljs-con-attribute">previewProvider</span>: <span class="hljs-literal">nil</span>)
  { (elements) -&gt; <span class="hljs-type">UIMenu</span>? <span class="hljs-keyword">in</span>
    <span class="hljs-keyword">let</span> delete <span class="hljs-operator">=</span> <span class="hljs-type">UIAction</span>(<span class="hljs-con-attribute">title</span>: <span class="hljs-string">"Delete"</span>) { (action) <span class="hljs-keyword">in</span>
      <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.<span class="hljs-variable">search</span>.<span class="hljs-con-attribute">isActive</span> {
        <span class="hljs-keyword">let</span> selectedJournalEntry <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.<span class="hljs-variable">filteredTableData</span>[        indexPath.<span class="hljs-con-attribute">item</span>]
        <span class="hljs-keyword">self</span>.<span class="hljs-variable">filteredTableData</span>.remove(at: indexPath.<span class="hljs-con-attribute">item</span>)
        <span class="hljs-con-class">SharedData</span>.<span class="hljs-variable">shared</span>.<span class="hljs-variable">removeSelectedJournalEntry</span>(        selectedJournalEntry)
      } <span class="hljs-keyword">else</span> {
       <span class="hljs-con-class"> SharedData</span>.<span class="hljs-variable">shared</span>.<span class="hljs-variable">removeJournalEntry</span>(<span class="hljs-variable">at</span>:        indexPath.<span class="hljs-con-attribute">item</span>)
      }
      <span class="hljs-con-class">SharedData</span>.<span class="hljs-variable">shared</span>.<span class="hljs-variable">saveJournalEntriesData</span>()
      collectionView.<span class="hljs-con-attribute">reloadData</span>()
    }
    <span class="hljs-keyword">return</span> <span class="hljs-type">UIMenu</span>(<span class="hljs-con-attribute">children</span>: [delete])
  }
  <span class="hljs-keyword">return</span> config
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">Instead <a id="_idIndexMarker960"/>of swiping left to delete, this method implements a contextual menu with a single option, <strong class="screenText">Delete</strong>, that appears when you tap and hold on a collection view cell.</p>
    <ol>
      <li class="numberedList" value="10">You’ll also see an error in the <code class="inlineCode">prepare(for:sender:)</code> method. Modify the <code class="inlineCode">guard</code> statement in the <code class="inlineCode">prepare(for:sender:)</code> method as shown:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> journalEntryDetailViewController <span class="hljs-operator">=</span> segue.<span class="hljs-con-attribute">destination</span> <span class="hljs-keyword">as</span>? <span class="hljs-con-class">JournalEntryDetailViewController</span>, <span class="hljs-keyword">let</span> <span class="hljs-con-class">selectedJournalEntryCell</span> <span class="hljs-operator">=</span> sender <span class="hljs-keyword">as?</span> <span class="hljs-con-class">JournalListCollectionViewCell</span>, <span class="hljs-keyword">let</span> indexPath <span class="hljs-operator">=</span> <span class="code-highlight"><strong class="hljs-variable-slc">collectionView</strong></span>.<span class="hljs-con-attribute">indexPath</span>(<span class="hljs-con-attribute">for</span>: selectedJournalEntryCell) <span class="hljs-keyword">else</span> {
  <span class="hljs-con-attribute">fatalError</span>(<span class="hljs-string">"Could not get indexpath"</span>)
}
</code></pre>
      </li>
    </ol>
    <p class="normal">All the errors in <code class="inlineCode">JournalListViewController</code> have been resolved. Cool! In the next section, you’ll add code to change the size of the collection view cells based on device screen size and orientation.</p>
    <h1 id="_idParaDest-283" class="heading-1">Dynamically modifying collection view cell size using size classes</h1>
    <p class="normal">As you saw earlier, the table view on the Journal List screen presents table view cells using <a id="_idIndexMarker961"/>rows arranged in a single column. This works great on an iPhone, but as you have seen, this results <a id="_idIndexMarker962"/>in a lot of wasted space if you run the app on an iPad. Even though you can use the same UI for both iPhone and iPad, it would be better if you could customize it to suit each device.</p>
    <p class="normal">To do this, you’ll add some code so your app can identify the size of the screen it’s running on, and you’ll dynamically modify the size of the collection view cells in the collection view to suit. You can identify the current screen size using size classes; you’ll learn about them in the next section.</p>
    <h2 id="_idParaDest-284" class="heading-2">Understanding size classes</h2>
    <p class="normal">To determine the size of the screen your app is running on, you must consider the effects <a id="_idIndexMarker963"/>of device orientation on your UI. It can be challenging to do this as there is a wide variety of screen sizes, in both portrait and landscape orientations. To make this easier, instead of using the physical resolution of the device, you will use size classes.</p>
    <div class="note">
      <p class="normal">For more <a id="_idIndexMarker964"/>information on size classes, see this link: <a href="https://developer.apple.com/design/human-interface-guidelines/layout"><span class="url">https://developer.apple.com/design/human-interface-guidelines/layout</span></a>.</p>
    </div>
    <p class="normal">Size classes are traits that are automatically assigned to a view by the operating system. Two classes are defined, which describe the height and width of a view: regular (expansive space) and compact (constrained space). Let’s look at size classes for a full-screen view on different devices:</p>
    <figure class="mediaobject"><img src="image/B31371_22_33.png" alt="" width="526" height="299"/></figure>
    <p class="packt_figref">Figure 22.33: Size classes for different iOS devices</p>
    <p class="normal">For the <em class="italic">JRNL</em> app, you will configure the collection view in the Journal List screen to use a single column of collection view cells if the size class is compact, and two columns if the size class is regular.</p>
    <p class="normal">You’ll add <a id="_idIndexMarker965"/>code to your app to determine the current size class. Once you know the size class, you’ll be able to set the number of columns to use and the size of the collection view cells in the collection view. You’ll learn how to do this in the next section.</p>
    <h2 id="_idParaDest-285" class="heading-2">Modifying the JournalListViewController class</h2>
    <p class="normal">You have <a id="_idIndexMarker966"/>already made the <code class="inlineCode">JournalListViewController</code> class adopt the <code class="inlineCode">UICollectionViewDelegateFlowLayout</code> protocol. Now you will create and set the collection view’s layout using a <code class="inlineCode">UICollectionViewFlowLayout</code> instance and implement methods to dynamically set the collection view cell size. </p>
    <p class="normal">Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">Click the <strong class="screenText">JournalListViewController</strong> file in the Project navigator. In the <code class="inlineCode">JournalListViewController</code> class, add the following method to the class definition before the closing curly brace:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">func</span> <span class="hljs-template-variable">setupCollectionView</span>() {
  <span class="hljs-keyword">let</span> flowLayout <span class="hljs-operator">=</span> <span class="hljs-type">UICollectionViewFlowLayout</span>()
  flowLayout.sectionInset <span class="hljs-operator">=</span> <span class="hljs-con-attribute">UIEdgeInsets</span>(<span class="hljs-con-attribute">top</span>: <span class="hljs-number">10</span>, <span class="hljs-con-attribute">left</span>: <span class="hljs-number">10</span>,
  <span class="hljs-con-attribute">bottom</span>: <span class="hljs-number">10</span>, <span class="hljs-con-attribute">right</span>: <span class="hljs-number">10</span>)
  flowLayout.<span class="hljs-con-attribute">minimumInteritemSpacing</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
  flowLayout.<span class="hljs-con-attribute">minimumLineSpacing</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>
  <span class="hljs-title">collectionView</span>.<span class="hljs-con-attribute">collectionViewLayout</span> <span class="hljs-operator">=</span> flowLayout
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">This method creates an instance of the <code class="inlineCode">UICollectionViewFlowLayout</code> class, sets all the edge insets for the collection view to 10 points, sets the minimum inter-item spacing to 0 points, sets the minimum line spacing to 10 points, and assigns it to the collection view. Section insets reflect the spacing <a id="_idIndexMarker967"/>at the outer edges of the section. Minimum inter-item spacing is the minimum spacing to use between items in the same row. Minimum line spacing is the minimum spacing to use between lines of items in the grid.</p>
    <ol>
      <li class="numberedList" value="2">Add the following <code class="inlineCode">UICollectionViewDelegateFlowLayout</code> method after the <code class="inlineCode">setupCollectionView()</code> method:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// MARK: - UICollectionViewDelegateFlowLayout</span>
<span class="hljs-keyword">func</span> <span class="hljs-template-variable">collectionView</span>(<span class="hljs-template-variable">_</span> <span class="hljs-params">collectionView</span>: <span class="hljs-type">UICollectionView</span>, <span class="hljs-template-variable">layout</span> <span class="hljs-params">collectionViewLayout</span>: <span class="hljs-type">UICollectionViewLayout</span>, <span class="hljs-template-variable">sizeForItemAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) -&gt; <span class="hljs-type">CGSize</span> {
  <span class="hljs-keyword">let </span><span class="hljs-params">numberOfColumns:</span><span class="hljs-keyword"> </span><span class="hljs-type">CGFloat</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-con-attribute">traitCollection</span>.<span class="hljs-con-attribute">horizontalSizeClass</span> <span class="hljs-operator">==</span> .<span class="hljs-con-attribute">compact</span>) {
    numberOfColumns <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
  } <span class="hljs-keyword">else</span> {
    numberOfColumns <span class="hljs-operator">=</span> <span class="hljs-number">2</span>
  }
  <span class="hljs-keyword">let</span> viewWidth <span class="hljs-operator">=</span> collectionView.<span class="hljs-con-attribute">frame</span>.<span class="hljs-con-attribute">width</span>
  <span class="hljs-keyword">let</span> inset <span class="hljs-operator">=</span> <span class="hljs-number">10.0</span>
  <span class="hljs-keyword">let</span> contentWidth <span class="hljs-operator">=</span> viewWidth <span class="hljs-operator">-</span> inset <span class="hljs-operator">*</span> (
  numberOfColumns <span class="hljs-operator">+</span> <span class="hljs-number">1</span>)
  <span class="hljs-keyword">let</span> cellWidth <span class="hljs-operator">=</span> contentWidth <span class="hljs-operator">/</span> numberOfColumns
  <span class="hljs-keyword">let</span> cellHeight <span class="hljs-operator">=</span> <span class="hljs-number">90.0</span>
  <span class="hljs-keyword">return</span> <span class="hljs-type">CGSize</span>(<span class="hljs-con-attribute">width</span>: cellWidth, <span class="hljs-con-attribute">height</span>: cellHeight)
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">This method determines the number of columns to be displayed and sets the height and width of the collection view cells.</p>
    <p class="normal-one">Let’s break it down:</p>
    <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">func</span> <span class="hljs-template-variable">collectionView</span>(<span class="hljs-template-variable">_</span> <span class="hljs-params">collectionView</span>: <span class="hljs-type">UICollectionView</span>, <span class="hljs-template-variable">layout</span> <span class="hljs-params">collectionViewLayout</span>: <span class="hljs-type">UICollectionViewLayout</span>, <span class="hljs-template-variable">sizeForItemAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) -&gt; <span class="hljs-type">CGSize</span> {
</code></pre>
    <p class="normal-one">This method returns a <code class="inlineCode">CGSize</code> instance that the collection view cell size should be set to.</p>
    <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">let</span> numberOfColumns: <span class="hljs-type">CGFloat</span>
<span class="hljs-keyword">if</span> (<span class="hljs-con-attribute">traitCollection</span>.<span class="hljs-con-attribute">horizontalSizeClass</span> <span class="hljs-operator">==</span> .<span class="hljs-con-attribute">compact</span>) {
  numberOfColumns <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
} <span class="hljs-keyword">else</span> {
  numberOfColumns <span class="hljs-operator">=</span> <span class="hljs-number">2</span>
}
</code></pre>
    <p class="normal-one">This <a id="_idIndexMarker968"/>code sets the number of columns to display.</p>
    <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">let</span> viewWidth <span class="hljs-operator">=</span> collectionView.<span class="hljs-con-attribute">frame</span>.<span class="hljs-con-attribute">width</span>
</code></pre>
    <p class="normal-one">This statement gets the width of the screen and assigns it to <code class="inlineCode">viewWidth</code>.</p>
    <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">let</span> inset <span class="hljs-operator">=</span> <span class="hljs-number">10.0</span>
<span class="hljs-keyword">let</span> contentWidth <span class="hljs-operator">=</span> viewWidth <span class="hljs-operator">-</span> inset <span class="hljs-operator">*</span> (
numberOfColumns <span class="hljs-operator">+</span> <span class="hljs-number">1</span>)
</code></pre>
    <p class="normal-one">This code subtracts the space used for the edge insets so the cell size can be determined.</p>
    <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">let</span> cellWidth <span class="hljs-operator">=</span> contentWidth <span class="hljs-operator">/</span> numberOfColumns
</code></pre>
    <p class="normal-one">This statement calculates the width of the cell by dividing <code class="inlineCode">contentWidth</code> by the number of columns and assigns it to <code class="inlineCode">cellWidth</code>.</p>
    <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">let</span> cellHeight <span class="hljs-operator">=</span> <span class="hljs-number">90.0</span>
</code></pre>
    <p class="normal-one">This statement assigns <code class="inlineCode">90</code> to <code class="inlineCode">cellHeight</code>, which will be used to set the cell height.</p>
    <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">return</span> <span class="hljs-type">CGSize</span>(<span class="hljs-con-attribute">width</span>: cellWidth, <span class="hljs-con-attribute">height</span>: cellHeight)
}
</code></pre>
    <p class="normal-one">This returns the <code class="inlineCode">CGSize</code> instance containing the cell size.</p>
    <p class="normal-one">Assume you’re running on iPhone 16 Pro Max in portrait mode. The horizontal size class would be <code class="inlineCode">.compact</code>, so <code class="inlineCode">numberOfColumns</code> is set to <code class="inlineCode">1</code>. <code class="inlineCode">viewWidth</code> would be assigned the width of the iPhone screen, which is <code class="inlineCode">414</code> points. <code class="inlineCode">contentWidth</code> is set to <code class="inlineCode">414 - (10 x 2) = 394</code>. <code class="inlineCode">cellWidth</code> is set to <code class="inlineCode">contentWidth / numberOfColumns = 394</code>, and <code class="inlineCode">cellHeight</code> is set to <code class="inlineCode">90</code>, so the<code class="inlineCode"> CGSize</code> instance returned would be <code class="inlineCode">(394, 90),</code> enabling one cell to fit in a row.</p>
    <p class="normal-one">When <a id="_idIndexMarker969"/>you rotate the same iPhone to landscape mode, the horizontal size class would be <code class="inlineCode">.regular</code>, so <code class="inlineCode">numberOfColumns</code> is set to <code class="inlineCode">2</code>. <code class="inlineCode">viewWidth</code> would be assigned the height of the iPhone screen, which is <code class="inlineCode">896</code> points. <code class="inlineCode">contentWidth</code> is set to <code class="inlineCode">896 - (10 x 3) = 866</code>. <code class="inlineCode">cellWidth</code> is set to <code class="inlineCode">contentWidth / numberOfColumns = 433</code>, and <code class="inlineCode">cellHeight</code> is set to <code class="inlineCode">90</code>, so the <code class="inlineCode">CGSize</code> instance returned would be <code class="inlineCode">(433, 90)</code>, enabling two cells to fit in a row.</p>
    <ol>
      <li class="numberedList" value="3">Modify the <code class="inlineCode">viewDidLoad()</code> method to call the <code class="inlineCode">setupCollectionView()</code> method:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-template-variable">viewDidLoad</span>() {
  <span class="hljs-keyword">super</span>.<span class="hljs-con-attribute">viewDidLoad</span>()
  <span class="hljs-con-class">SharedData</span>.<span class="hljs-variable">shared</span>.<span class="hljs-variable">loadJournalEntriesData</span>()
  <span class="code-highlight"><strong class="hljs-variable-slc">setupCollectionView</strong><strong class="hljs-slc">()</strong></span>
  <span class="hljs-variable">search</span>.<span class="hljs-con-attribute">searchResultsUpdater</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>
  <span class="hljs-variable">search</span>.<span class="hljs-con-attribute">obscuresBackgroundDuringPresentation</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
  <span class="hljs-variable">search</span>.<span class="hljs-con-attribute">searchBar</span>.<span class="hljs-con-attribute">placeholde</span>r <span class="hljs-operator">=</span> <span class="hljs-string">"Search titles"</span>
  <span class="hljs-con-attribute">navigationItem</span>.<span class="hljs-con-attribute">searchController</span> <span class="hljs-operator">=</span> <span class="hljs-variable">search</span>
}
</code></pre>
      </li>
      <li class="numberedList">Add the following method after the <code class="inlineCode">viewDidLoad()</code> method to recalculate the number of columns and size of the collection view cells when the device is rotated:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-template-variable">viewWillLayoutSubviews</span>() {
  <span class="hljs-keyword">super</span>.<span class="hljs-con-attribute">viewWillLayoutSubviews</span>()
  <span class="hljs-variable">collectionView</span>.<span class="hljs-con-attribute">collectionViewLayout</span>.<span class="hljs-con-attribute">invalidateLayout</span>()
}
</code></pre>
      </li>
    </ol>
    <p class="normal">You have implemented all the code required to change the collection view cell size based on size classes. Excellent! In the next section, you’ll test your app on different simulated devices and on your Mac.</p>
    <h1 id="_idParaDest-286" class="heading-1">Testing your app on different devices</h1>
    <p class="normal">Now that you have implemented all the code required to dynamically set collection view cell size, you’ll test <a id="_idIndexMarker970"/>your app on different simulated devices and on your Mac. Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">Simulator should still be set to iPad. Build and run your app. It will display two columns, as shown:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_34.png" alt="" width="812" height="281"/></figure>
    <p class="packt_figref">Figure 22.34: Simulator showing iPad screen with two columns</p>
    <ol>
      <li class="numberedList" value="2">Choose <strong class="screenText">Rotate Left</strong> from the <strong class="screenText">Device</strong> menu, and you’ll still see two columns, but the cells have expanded in size to fill the screen:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_35.png" alt="" width="812" height="226"/></figure>
    <p class="packt_figref">Figure 22.35: Simulator showing iPad screen rotated to the left with two columns</p>
    <ol>
      <li class="numberedList" value="3">Stop your <a id="_idIndexMarker971"/>app and choose <strong class="screenText">iPhone SE (3rd Generation)</strong> from the Destination menu. Run your app on Simulator again, and it will display a single column, as shown:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_36.png" alt="" width="463" height="815"/></figure>
    <p class="packt_figref">Figure 22.36: Simulator showing iPhone screen with a single column</p>
    <div class="packt_tip-one">
      <p class="normal">Simulator <a id="_idIndexMarker972"/>will not automatically close the iPad instance when it launches the iPhone instance. Close the iPad instance manually for better performance.</p>
    </div>
    <ol>
      <li class="numberedList" value="4">Choose <strong class="screenText">Rotate Left</strong> from the <strong class="screenText">Device</strong> menu, and you’ll still see a single column, but <a id="_idIndexMarker973"/>the cell size has expanded to fill the screen:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_37.png" alt="" width="630" height="355"/></figure>
    <p class="packt_figref">Figure 22.37: Simulator showing iPhone screen rotated with a single column</p>
    <ol>
      <li class="numberedList" value="5">Stop your app and choose <strong class="screenText">iPhone 16 Pro Max</strong> from the Destination menu. Run your app on Simulator again, and it will display a single column, as shown:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_38.png" alt="" width="312" height="659"/></figure>
    <p class="packt_figref">Figure 22.38: Simulator showing iPhone screen with a single column</p>
    <ol>
      <li class="numberedList" value="6">Choose <strong class="screenText">Rotate Left</strong> from <a id="_idIndexMarker974"/>the <strong class="screenText">Device</strong> menu, and you’ll see two columns:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_39.png" alt="" width="812" height="382"/></figure>
    <p class="packt_figref">Figure 22.39: Simulator showing iPhone screen rotated with two columns</p>
    <ol>
      <li class="numberedList" value="7">Stop your <a id="_idIndexMarker975"/>app and choose <strong class="screenText">MyMac (Designed for iPad)</strong> in the Destination menu. Run your app and it should display two columns:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_22_40.png" alt="" width="620" height="320"/></figure>
    <p class="packt_figref">Figure 22.40: Mac app with two columns</p>
    <div class="note">
      <p class="normal">You’ll need a free or paid Apple Developer account to run your app on your Mac.</p>
      <p class="normal">At the time of writing, clicking the camera button while the app is running on the Mac will cause the app to crash. To work around this, choose <strong class="screenText">Product | Scheme | Edit Scheme...</strong> from the menu bar, select <strong class="screenText">Run</strong> from the sidebar, click the <strong class="screenText">Diagnostics</strong> tab, and uncheck the <strong class="screenText">Metal API Validation</strong> check box.</p>
    </div>
    <p class="normal">You have <a id="_idIndexMarker976"/>modified your app to use a collection view in place of a table view, and you have enabled it to dynamically modify the collection view cell size when it runs on different devices. Great job!</p>
    <h1 id="_idParaDest-287" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, you replaced the table view on the Journal List screen with a collection view, which makes better use of the extra screen space available when you run your app on an iPad or Mac. You also made your app dynamically modify the number of columns and the collection view cell sizes when your device is rotated using size classes.</p>
    <p class="normal">First, in the <code class="inlineCode">Main</code> storyboard file, you replaced the table view on the Journal List screen with a collection view and configured the collection view cell to display the same information the table view cell used to display. Next, you modified the <code class="inlineCode">JournalListTableViewController</code> and <code class="inlineCode">JournalListTableViewCell</code> classes to work with the collection view and collection view cells. After that, you added code to dynamically change the collection view cell size to suit the display your app is running on. Finally, you created and tested your app on Simulator and your Mac.</p>
    <p class="normal">You should now be able to use collection views in your app and know how to dynamically modify your app’s interface based on size classes.</p>
    <p class="normal">This is the end of <em class="italic">Part 3</em> of this book. You’ll learn more about the cool new features Apple introduced during WWDC 2024 in the next part, starting with SwiftUI.</p>
    <h1 id="_idParaDest-288" class="heading-1">Leave a review!</h1>
    <p class="normal">Thank you for purchasing this book from Packt Publishing—we hope you enjoy it! Your feedback is invaluable and helps us improve and grow. Once you’ve completed reading it, please take a moment to leave an Amazon review; it will only take a minute, but it makes a big difference for readers like you. Scan the QR code below or visit the link to receive a free ebook of your choice.</p>
    <p class="normal"><a href="https://packt.link/NzOWQ%0D"><span class="url">https://packt.link/NzOWQ</span></a></p>
    <p class="normal"><a href="https://packt.link/NzOWQ%0D"><img src="image/QR_Code2370024260177460609.png" alt="" width="177" height="177"/></a></p>
  </div>
</div></div></body></html>