- en: Chapter 4. Our First Game with Moai
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第四章.我们的第一个Moai游戏
- en: Adventure time! We're going to start working on our first game made with Moai
    SDK, a simple *Concentration*-like game. For this you'll need some understanding
    of Lua syntax, nothing too fancy, just the basics. If you've never used Lua before,
    it'd be a good idea to read some quick introduction material and have a syntax
    cheat sheet around when reading this book.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 冒险时间！我们将开始使用Moai SDK制作我们的第一个游戏，一个简单的类似*注意力集中*的游戏。为此，你需要对Lua语法有一定的了解，不需要太花哨，只是基础知识。如果你以前从未使用过Lua，阅读一些快速介绍材料并在阅读这本书时准备一个语法速查表是个好主意。
- en: Concentration
  id: totrans-2
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 注意力集中
- en: For those readers who are not familiar with this game, let's describe it.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 对于那些不熟悉这个游戏的读者，让我们来描述一下它。
- en: The game requires a set of tiles. There must be an even number of them. The
    tiles have figures (in pairs, since we're going to match them) on one side and
    a flat color or identical image on the other side (the back of the tile).
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 游戏需要一套拼图。拼图的数量必须是偶数。拼图的一面有图案（成对出现，因为我们将会匹配它们），另一面则是平坦的颜色或相同的图像（拼图的背面）。
- en: 'The gameplay is as follows:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 游戏玩法如下：
- en: Place all the tiles facing down and shuffle them. This way you hide the pairs
    and have no idea where they are.![Concentration](img/5064_04_01.jpg)
  id: totrans-6
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将所有拼图面朝下并洗牌。这样你就可以隐藏成对的图案，不知道它们在哪里。![注意力集中](img/5064_04_01.jpg)
- en: Then, you have to choose two tiles and flip them, to reveal the images.![Concentration](img/5064_04_02.jpg)
  id: totrans-7
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，你需要选择两张拼图并翻转它们，以显示图案。![注意力集中](img/5064_04_02.jpg)
- en: If they're different, you have to flip them back again and pick a different
    pair.![Concentration](img/5064_04_03.jpg)
  id: totrans-8
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果它们不同，你必须再次翻转它们并选择另一对。![注意力集中](img/5064_04_03.jpg)
- en: If they are the same, you remove them from the board and the game continues
    with two tiles less.![Concentration](img/5064_04_04.jpg)
  id: totrans-9
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果它们相同，你将它们从板上移除，游戏继续进行，但拼图数量减少两张。![注意力集中](img/5064_04_04.jpg)
- en: The game ends when there are no tiles left.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 当没有拼图剩下时，游戏结束。
- en: We will implement this game, with the addition of a ticking clock, so things
    get a little bit more challenging.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将实现这个游戏，并增加一个滴答作响的时钟，使事情变得有点更具挑战性。
- en: In order to do this we'll examine all of Moai SDK's basic features and how to
    use them.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 为了做到这一点，我们将检查Moai SDK的所有基本功能以及如何使用它们。
- en: Project setup
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 项目设置
- en: 'To set up the project we need to perform a couple of steps:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 为了设置项目，我们需要执行几个步骤：
- en: Create a folder for our project somewhere on your hard drive.
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在你的硬盘上某个位置创建一个用于我们项目的文件夹。
- en: After that open ZeroBrane Studio and navigate to that folder.
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 之后打开ZeroBrane Studio并导航到那个文件夹。
- en: You'll now see an empty folder and a blank file named `untitled.lua`.
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你现在会看到一个空文件夹和一个名为`untitled.lua`的空白文件。
- en: Save that file as `main.lua`, which is the usual name for a game entry point
    file. You can name it whatever you want, but we'll use this as a standard.
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将该文件保存为`main.lua`，这是游戏入口点文件的常用名称。你可以取任何你想要的名称，但我们将使用这个作为标准。
- en: Now we are ready to start.
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们准备开始。
- en: Opening a window
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 打开窗口
- en: The first thing we'll learn is how to open the main game window using Moai SDK.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先学习的是如何使用Moai SDK打开主游戏窗口。
- en: 'This is a relatively easy task. The code is as follows:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个相对简单的任务。代码如下：
- en: '[PRE0]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: What we are doing here is calling the `MOAISim.openWindow` class method with
    the necessary parameters, namely, `title` for window (a string), `width`, and
    `height`. As you may have noticed, we used 320 x 480, which is the display resolution
    of an iPhone 3GS (without Retina Display).
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在这里所做的是调用`MOAISim.openWindow`类方法，并使用必要的参数，即窗口的`title`（一个字符串）、`width`和`height`。正如你可能已经注意到的，我们使用了320
    x 480，这是iPhone 3GS（没有Retina Display）的显示分辨率。
- en: If you run the script now, you'll see that a window opens. So that's it, our
    main window is ready. But before going further, let's take a look at an important
    aspect of Moai SDK.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你现在运行脚本，你会看到一个窗口打开。所以，这就是我们的主窗口准备好了。但在继续之前，让我们看看Moai SDK的一个重要方面。
- en: Note
  id: totrans-26
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '**Downloading the example code**'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '**下载示例代码**'
- en: You can download the example code files for all Packt books you have purchased
    from your account at [http://www.packtpub.com](http://www.packtpub.com) . If you
    purchased this book elsewhere, you can visit [http://www.packtpub.com/support](http://www.packtpub.com/support)
    and register to have the files e-mailed directly to you.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以从你购买的所有Packt书籍的账户中下载示例代码文件。[http://www.packtpub.com](http://www.packtpub.com)。如果你在其他地方购买了这本书，你可以访问[http://www.packtpub.com/support](http://www.packtpub.com/support)并注册，以便将文件直接通过电子邮件发送给你。
- en: Resolution independence
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 分辨率无关性
- en: The window we just opened has a specific width and height. But, as we know,
    different devices have different resolutions and we can't just open up a screen
    with a fixed width and height because it won't behave correctly on say, an iPhone
    and an iPad.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 我们刚刚打开的窗口具有特定的宽度和高度。但是，正如我们所知，不同的设备有不同的分辨率，我们不能仅仅打开一个具有固定宽度和高度的屏幕，因为它在iPhone和iPad等设备上不会正确运行。
- en: So we'll introduce a concept here **world resolution** versus **screen/window
    resolution**.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们将在这里介绍一个概念：**世界分辨率**与**屏幕/窗口分辨率**的比较。
- en: 'The idea is that your game will use world resolution for all the calculations
    and object placement, and then you''ll use a viewport that understands that world
    resolution and translates it into window resolution. So, let''s set that up our
    script as follows:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 这个想法是，你的游戏将使用世界分辨率进行所有计算和对象放置，然后你将使用一个理解世界分辨率的视口，并将其转换为窗口分辨率。所以，让我们按照以下方式设置我们的脚本：
- en: '[PRE1]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Let''s take a look at the preceding code line by line:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们逐行查看前面的代码：
- en: '[PRE2]'
  id: totrans-35
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: These lines are defining two constants, namely, our world resolution along the
    X and Y axes. Remember that these are not the dimensions of the screen, just our
    world.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 这些行定义了两个常量，即我们的世界分辨率沿X轴和Y轴。记住，这些不是屏幕的尺寸，只是我们的世界。
- en: '[PRE3]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Now we define `X` and `Y` dimensions for our screen''s resolution. As you can
    see, we made our screen double the size of our world. We do this is in order to
    better illustrate the independence of screen resolution with respect to world
    resolution. In the following chapters, we''ll see that anything you place in the
    world will look twice as big on the screen as follows:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们为屏幕的分辨率定义了`X`和`Y`维度。正如你所见，我们将屏幕的大小设置为世界大小的两倍。我们这样做是为了更好地说明屏幕分辨率与世界分辨率的独立性。在接下来的章节中，我们将看到你在世界中放置的任何东西在屏幕上看起来将是以下的两倍大小：
- en: '![Resolution independence](img/5064_04_05.jpg)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![分辨率独立性](img/5064_04_05.jpg)'
- en: We now need to tell Moai to open a window, this is needed during development
    to create a window for our game, on the devices it will just do nothing.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在需要告诉Moai打开一个窗口，这在开发过程中是必需的，为了在我们的游戏设备上创建一个窗口，在设备上它将不会做任何特别的事情。
- en: '[PRE4]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: This is the same line we saw before, but now, we are using our `SCREEN_RESOLUTION_X`
    and `SCREEN_RESOLUTION_Y` constants. Note that in devices that have fixed size
    screens, this method won't do anything special, but we need it to run our samples
    in the computer.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 这是之前我们看到的那行代码，但现在，我们正在使用我们的`SCREEN_RESOLUTION_X`和`SCREEN_RESOLUTION_Y`常量。请注意，在具有固定尺寸屏幕的设备上，这个方法不会做任何特别的事情，但我们需要它在计算机上运行我们的示例。
- en: '[PRE5]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Now, here is something new (literally). In order to handle the conversion between
    world and screen coordinates, we will use the `MOAIViewport` instances. Note that
    you may have an arbitrary number of viewports, each using different coordinate
    scales. For example, we could use another viewport with the same scale as the
    window for some specific effect or for a user interface (GUI) that doesn't need
    scaling.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，这里有一些新东西（字面上的）。为了处理世界坐标和屏幕坐标之间的转换，我们将使用`MOAIViewport`实例。请注意，你可能有一个任意数量的视口，每个视口使用不同的坐标比例。例如，我们可以使用与窗口相同比例的另一个视口来实现某些特定效果或用户界面（GUI），而该界面不需要缩放。
- en: '[PRE6]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Now we set the size for the viewport. This is usually the same size as the screen
    resolution (additionally, on devices this must match the screen resolution if
    you want it to take up the entire screen), but you could make a smaller viewport
    in order to display a small map or something like that, but keep in mind that
    the whole idea of the size is that it will be the target resolution.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们为视口设置大小。这通常与屏幕分辨率相同（在设备上，如果你希望它占据整个屏幕，这必须与屏幕分辨率匹配），但你也可以创建一个更小的视口来显示小地图或其他类似的东西，但请记住，整个大小的概念是它将成为目标分辨率。
- en: '[PRE7]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: And this is what completes the magic. We set a scale, using a different resolution.
    If you think about this, what we're doing is simply telling the viewport that
    whatever we put on our layers in the future, needs to be stretched/shrunk from
    the world coordinates (`WORLD_RESOLUTION_X` and `WORLD_RESOLUTION_Y`) to another
    set of coordinates (`SCREEN_RESOLUTION_X` and `SCREEN_RESOLUTION_Y`).
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是完成魔法的地方。我们设置了一个比例，使用不同的分辨率。如果你这么想，我们正在做的事情就是告诉视口，无论我们在未来的层上放置什么，都需要从世界坐标（`WORLD_RESOLUTION_X`和`WORLD_RESOLUTION_Y`）拉伸/缩小到另一组坐标（`SCREEN_RESOLUTION_X`和`SCREEN_RESOLUTION_Y`）。
- en: That's it, we now have a resolution-independent screen. It's just a matter of
    changing `SCREEN_RESOLUTION_X` and/or `SCREEN_RESOLUTION_Y` and the game will
    adjust accordingly.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 就这样，我们现在拥有了一个分辨率无关的屏幕。只需更改 `SCREEN_RESOLUTION_X` 和/或 `SCREEN_RESOLUTION_Y`，游戏就会相应调整。
- en: Summary
  id: totrans-50
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: So, we are now committed to making a *Concentration* game using Moai SDK. We
    reviewed the rules and goals of the *Concentration* game. We also wrote our first
    lines with Moai SDK to open a window and discussed how to implement resolution-independent
    games using world versus screen coordinate systems.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，我们现在致力于使用 Moai SDK 制作一个 *专注力* 游戏。我们审查了 *专注力* 游戏的规则和目标。我们还用 Moai SDK 编写了我们的第一行代码来打开窗口，并讨论了如何使用世界坐标系统与屏幕坐标系统实现分辨率无关的游戏。
- en: The next chapter will teach you how to display images on screen, the most basic
    skill for today's game developers.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 下一章将教你如何在屏幕上显示图像，这是今天游戏开发者最基本的技术。
