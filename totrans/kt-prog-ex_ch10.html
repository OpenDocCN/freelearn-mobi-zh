<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:pls="http://www.w3.org/2005/01/pronunciation-lexicon" xmlns:ssml="http://www.w3.org/2001/10/synthesis">
<head>
  <meta charset="UTF-8"/>
  <title>Implementing the Place Reviewer Frontend</title>
  <link type="text/css" rel="stylesheet" media="all" href="style.css"/>
  <link type="text/css" rel="stylesheet" media="all" href="core.css"/>
</head>
<body>
  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Implementing the Place Reviewer Frontend</h1>
                </header>
            
            <article>
                
<p>In the previous chapter, we continued our exploration of Kotlin as a viable language for the creation of web applications by commencing the building of the Place Reviewer website. We began the chapter by discussing the Model-View-Controller design pattern and taking a high-level look at the primary components at play in MVC applications: the model, the view, and the controller. Once we had a clear understanding of the MVC design pattern and how it works, we commenced with the design and implementations of the backend for the <em>Place Reviewer</em> application.</p>
<p>First and foremost, we identified and clearly stated the anticipated use cases for our application. Next, we identified the data required to build an application that facilitates the use cases identified. After identification of the data to be catered for, we went full steam ahead with the development of the backend. We set up a Postgres database with which our application will communicate, then implemented the necessary entities and models for our application.</p>
<p>Further into the chapter, we discovered how to secure our application—authentication-wise—with Spring Security, this time without the use of JWTs. Finally, we learned how to create controllers for Spring MVC-based applications, as well as how to manage server logs with the ELK stack.</p>
<p>In this chapter, we shall finish up the creation of the <em>Place Reviewer</em> application by implementing its frontend. In the process of doing this, we shall learn about the following:</p>
<ul>
<li style="font-weight: 400">Working with the Google Places API</li>
<li style="font-weight: 400">Application testing</li>
<li style="font-weight: 400">Deploying web applications to AWS</li>
</ul>
<p>Let's get straight into this chapter by implementing the views for our application.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating views with Thymeleaf</h1>
                </header>
            
            <article>
                
<p>As previously defined, a view is a representation of data that exists in and is generated by an application. Views are the primary points of interaction that a user has with an application built with the MVC pattern. The view layer may utilize different technologies to render information to a user. Spring supports a number of view options. These view options are also referred to as templates. Template support in a Spring application is provided by a template engine. Simply put, a template engine enables the utilization of static template files with the view layer of an application. A template engine may also be referred to as a template library. The following template libraries are available for use with Spring:</p>
<ul>
<li style="font-weight: 400">Thymeleaf</li>
<li style="font-weight: 400">JSP/JSTL</li>
<li style="font-weight: 400">Freemaker</li>
<li style="font-weight: 400">Tiles</li>
<li style="font-weight: 400">Velocity</li>
</ul>
<p>This list is by no means intended to be exhaustive. There are a number of other template libraries available for use with Spring. We shall be relying on Thymeleaf to provide template processing support for our application. If you recall, we included templating support with Thymeleaf upon initial creation of our project. Inspecting the dependencies section of our project's <kbd>pom.xml</kbd> file will reveal the addition of Thymeleaf to our project:</p>
<pre>&lt;dependencies&gt;<br/>...<br/>&lt;dependency&gt;<br/> &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/> &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;<br/>&lt;/dependency&gt;<br/>...<br/>&lt;/dependencies&gt;</pre>
<p>At this juncture, you may desire a more formal definition of what exactly Thymeleaf is. As stated on Thymeleaf's official website, <em>Thymeleaf is a modern server-side Java template engine for both web and standalone environments. Thymeleaf's main goal is to bring elegant natural templates to your development workflow - HTML that can be correctly displayed in browsers and also work as static prototypes, allowing for stronger collaboration in development teams.</em>&#160;If you require a deeper understanding of Thymeleaf and its goals, you can find more information about it at&#160;<a href="http://thymeleaf.org">http://thymeleaf.org</a>.</p>
<p>In the previous chapter, we took a simple example of view creation in Spring by implementing a <kbd>hello.html</kbd> view for the <kbd>HelloController</kbd>. However, the view we created only displayed a <kbd>Hello world!</kbd>&#160;message to its viewers. We will be creating slightly more complex views in this chapter. We shall start by creating a view facilitating user registration on the platform.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Implementing the user registration view</h1>
                </header>
            
            <article>
                
<p>In this section, we are going to accomplish two tasks. Firstly, we are going to create a view layer that facilitates the registration of new users on the <span class="packt_screen">Place Reviewer</span> platform. Secondly, we are going to create suitable controllers and actions to present the user with the registration view and handle registration form submissions. Simple enough right? Glad you think so! Go ahead and create a <kbd>register.html</kbd> template in the <kbd>Place Reviewer</kbd> project. Recall that all template files belong in the templates directory under resources. Now, add the following template HTML to the file:</p>
<pre><br/><span>&lt;!DOCTYPE </span><span>html</span><span>&gt;<br/></span><span>&lt;html </span><span>lang=</span><span>"en" </span><span>xmlns:</span><span>th</span><span>=</span><span>"http://www.thymeleaf.org"</span><span>&gt;<br/></span><span>&lt;head&gt;<br/></span><span>  &lt;title&gt;</span>Register<span>&lt;/title&gt;<br/></span><span>  &lt;link </span><span>rel=</span><span>"stylesheet" </span><span>th</span><span>:href=</span><span>"@{/css/app.css}"</span><span>/&gt;<br/></span><span>  &lt;link </span><span>rel=</span><span>"stylesheet" <br/></span><span>   href=</span><span>"/webjars/bootstrap/4.0.0-beta.3/css/bootstrap.min.css"</span><span>/&gt;<br/></span><span><br/></span><span>  &lt;script </span><span>src=</span><span>"/webjars/jquery/3.2.1/jquery.min.js"</span><span>&gt;&lt;/script&gt;<br/></span><span>  &lt;script </span><span>src=</span><span>"/webjars/bootstrap/4.0.0-beta.3/<br/>   js/bootstrap.min.js"</span><span>&gt;&lt;/script&gt;<br/></span><span>&lt;/head&gt;<br/></span><span>&lt;body&gt;<br/></span><span>  &lt;nav </span><span>class=</span><span>"navbar navbar-default nav-enhanced"</span><span>&gt;<br/></span><span>    &lt;div </span><span>class=</span><span>"container-fluid container-nav"</span><span>&gt;<br/></span><span>      &lt;div </span><span>class=</span><span>"navbar-header"</span><span>&gt;<br/></span><span>        &lt;div </span><span>class=</span><span>"navbar-brand"</span><span>&gt;<br/></span><span>          </span>Place Reviewer<br/>        <span>&lt;/div&gt;<br/></span><span>      &lt;/div&gt;<br/></span><span>      &lt;ul </span><span>class=</span><span>"navbar-nav" </span><span>th</span><span>:if=</span><span>"${principal != null}"</span><span>&gt;<br/></span><span>        &lt;li&gt;<br/></span><span>          &lt;form </span><span>th</span><span>:action=</span><span>"@{/logout}" </span><span>method=</span><span>"post"</span><span>&gt;<br/></span><span>            &lt;button </span><span>class=</span><span>"btn btn-danger" </span><span>type=</span><span>"submit"</span><span>&gt;<br/></span><span>              &lt;i </span><span>class=</span><span>"fa fa-power-off" </span><span>aria-hidden=</span><span>"true"</span><span>&gt;&lt;/i&gt;<br/>              </span>Sign Out<br/>            <span>&lt;/button&gt;<br/></span><span>          &lt;/form&gt;<br/></span><span>        &lt;/li&gt;<br/></span><span>      &lt;/ul&gt;<br/></span><span>    &lt;/div&gt;<br/></span><span>  &lt;/nav&gt;<br/></span><span>  &lt;div </span><span>class=</span><span>"container-fluid" </span><span>style=</span><span>"</span><span>z-index</span>: <span>2</span><span>; </span><span>position</span>: <span>absolute"</span><span>&gt;<br/></span><span>    &lt;div </span><span>class=</span><span>"row mt-5"</span><span>&gt;<br/></span><span>      &lt;div </span><span>class=</span><span>"col-sm-4 col-xs-2"</span><span>&gt;  </span><span>&lt;/div&gt;<br/></span><span>      &lt;div </span><span>class=</span><span>"col-sm-4 col-xs-8"</span><span>&gt;<br/></span><span>        &lt;form </span><span>class=</span><span>"form-group col-sm-12 form-vertical form-app" <br/></span><span>         id=</span><span>"form-register" </span><span>method=</span><span>"post" <br/></span><span>         th</span><span>:action=</span><span>"@{/users/registrations}"</span><span>&gt;<br/></span><span>          &lt;div </span><span>class=</span><span>"col-sm-12 mt-2 lead text-center text-primary"</span><span>&gt;<br/></span>            Create an account<br/><span>          &lt;/div&gt;<br/></span><span>          &lt;hr&gt;<br/></span><span>          &lt;input </span><span>class=</span><span>"form-control" </span><span>type=</span><span>"text" </span><span>name=</span><span>"username" <br/></span><span>           placeholder=</span><span>"Username"</span><span> </span><span>required</span><span>/&gt;<br/></span><span>          &lt;input </span><span>class=</span><span>"form-control mt-2" </span><span>type=</span><span>"email" </span><span>name=</span><span>"email" <br/></span><span>           placeholder=</span><span>"Email"</span><span> </span><span>required</span><span>/&gt;<br/></span><span>          &lt;input </span><span>class=</span><span>"form-control mt-2" </span><span>type=</span><span>"password" </span><span>name=</span><span>"password"<br/>           </span><span>placeholder=</span><span>"Password"</span><span> </span><span>required</span><span>/&gt;<br/></span><span>          &lt;span </span><span>th</span><span>:if=</span><span>"${error != null}" </span><span>class=</span><span>"mt-2 text-danger" <br/></span><span>           style=</span><span>"</span><span>font-size</span>: <span>10</span><span>px" </span><span>th</span><span>:text=</span><span>"${error}"</span><span>&gt;&lt;/span&gt;<br/></span><span>          &lt;button </span><span>class=</span><span>"btn btn-primary form-control mt-2 mb-3" <br/></span><span>           type=</span><span>"submit"</span><span>&gt;<br/></span>            Sign Up!<br/><span>          &lt;/button&gt;<br/></span><span>        &lt;/form&gt;<br/></span><span>      &lt;/div&gt;<br/></span><span>      &lt;div </span><span>class=</span><span>"col-sm-4 col-xs-2"</span><span>&gt;&lt;/div&gt;<br/></span><span>    &lt;/div&gt;<br/></span><span>  &lt;/div&gt;<br/></span><span>  &lt;/body&gt;<br/></span><span>&lt;/html&gt;</span></pre>
<p>In this code snippet, we utilized HTML to create a template for the user registration page. The web page in itself is simple. It contains a navigation bar and a form in which a user will input the required registration details for submission. As this is a Thymeleaf template, it should come as no surprise that we utilized some Thymeleaf-specific attributes. Let's take a look at some of these attributes:</p>
<ul>
<li><kbd>th:href</kbd>: This is an attribute modifier attribute. When it is processed by the templating engine, it computes the link URL to be utilized and sets it in the appropriate tag in which it is used. Examples of tags that this attribute can be used in are <kbd>&lt;a&gt;</kbd> and <kbd>&lt;link&gt;</kbd>. We used the <kbd>th:href</kbd> attribute in the code snippet, as shown here:</li>
</ul>
<pre>        &lt;link rel="stylesheet" th:href="@{/css/app.css}"/&gt;</pre>
<ul>
<li><kbd>th:action</kbd>: This attribute works just like the HTML action attribute. It specifies where to send the form data when a form is submitted. The following code snippet specifies that the form data should be sent to an endpoint with the path <kbd>/users/registrations</kbd>:</li>
</ul>
<pre>        &lt;form class="form-group col-sm-12 form-vertical form-app" <br/>         id="form-register" method="post" <br/>         th:action="@{/users/registrations}"&gt;<br/>          ...<br/>        &lt;/form&gt;</pre>
<ul>
<li><kbd>th:text</kbd>: This attribute is used to specify the text held by a container:</li>
</ul>
<pre>        &lt;span th:text="Hello world"&gt;&lt;/span&gt;</pre>
<ul>
<li><kbd>th:if</kbd>: This attribute can be used to specify whether an HTML tag should be rendered based on the result of a conditional test:</li>
</ul>
<pre>        &lt;span th:if="${error != null}" class="mt-2 text-danger" <br/>         style="font-size: 10px" th:text="${error}"&gt;&lt;/span&gt;</pre>
<p>In this code snippet, if a model attribute error exists and its value is not equal to null, then the <kbd>span</kbd> tag is rendered on the HTML page; otherwise, it is not rendered.</p>
<p>We also made use of <kbd>th:if</kbd> in our navigation bar to specify when it should display a button permitting a user to log out of their account:</p>
<pre>&lt;ul class="navbar-nav" th:if="${principal != null}"&gt;<br/>  &lt;li&gt;<br/>    &lt;form th:action="@{/logout}" method="post"&gt;<br/>      &lt;button class="btn btn-danger" type="submit"&gt;<br/>        &lt;i class="fa fa-power-off" aria-hidden="true"&gt;&lt;/i&gt; Sign Out<br/>      &lt;/button&gt;<br/>    &lt;/form&gt;<br/>  &lt;/li&gt;<br/>&lt;/ul&gt;</pre>
<p>If the <kbd>principal</kbd>&#160;model attribute is set in the template and it is not <kbd>null</kbd>, then the sign out button is displayed. The <kbd>principal</kbd> will always be null unless the user is logged in to their account.</p>
<p>How we added the navigation bar to our template directly may appear&#160;to be all right at first glance but it is important we put more thought into what we did. It is not uncommon to make use of a navigation bar DOM element more than once within an application. In fact, this is done very often! We do not want to have to keep rewriting this same code for a navigation bar over and over again in our templates. To avoid this unnecessary repetition, we need to implement the navigation bar as a fragment that can be included at any time within a template.</p>
<p>Create a <kbd>fragments</kbd>&#160;directory within <kbd>templates</kbd>&#160;and add a <kbd>navbar.html</kbd> file with the following code to it:</p>
<pre>&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en" xmlns:th="http://www.thymeleaf.org"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="UTF-8"&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;nav class="navbar navbar-default nav-enhanced" th:fragment="navbar"&gt;<br/>      &lt;div class="container-fluid container-nav"&gt;<br/>        &lt;div class="navbar-header"&gt;<br/>          &lt;div class="navbar-brand"&gt;<br/>            Place Reviewer<br/>          &lt;/div&gt;<br/>        &lt;/div&gt;<br/>        &lt;ul class="navbar-nav" th:if="${principal != null}"&gt;<br/>          &lt;li&gt;<br/>            &lt;form th:action="@{/logout}" method="post"&gt;<br/>              &lt;button class="btn btn-danger" type="submit"&gt;<br/>                &lt;i class="fa fa-power-off" aria-hidden="true"&gt;&lt;/i&gt; Sign Out<br/>              &lt;/button&gt;<br/>            &lt;/form&gt;<br/>          &lt;/li&gt;<br/>        &lt;/ul&gt;<br/>      &lt;/div&gt;<br/>    &lt;/nav&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</pre>
<p>In this code snippet, we defined a navigation bar fragment available for inclusion in templates with the <kbd>th:fragment</kbd> attribute. A defined fragment can be inserted at any time within a template with the use of <kbd>th:insert</kbd>. Modify the inner HTML of the <kbd>&lt;body&gt;</kbd> tag in <kbd>register.html</kbd> to make use of the newly defined fragment as follows:</p>
<pre>&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en" xmlns:th="http://www.thymeleaf.org"&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;Register&lt;/title&gt;<br/>    &lt;link rel="stylesheet" th:href="@{/css/app.css}"/&gt;<br/>    &lt;link rel="stylesheet" <br/>     href="/webjars/bootstrap/4.0.0-beta.3/css/bootstrap.min.css"/&gt;<br/>    &lt;script src="/webjars/jquery/3.2.1/jquery.min.js"&gt;&lt;/script&gt;<br/>    &lt;script src="/webjars/bootstrap/4.0.0-beta.3/<br/>     js/bootstrap.min.js"&gt;&lt;/script&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div th:insert="fragments/navbar :: navbar"&gt;&lt;/div&gt; <br/>    &lt;!-- inserting navbar fragment --&gt;<br/>    &lt;div class="container-fluid" style="z-index: 2; position: absolute"&gt;<br/>      &lt;div class="row mt-5"&gt;<br/>        &lt;div class="col-sm-4 col-xs-2"&gt;<br/>        &lt;/div&gt;<br/>        &lt;div class="col-sm-4 col-xs-8"&gt;<br/>          &lt;form class="form-group col-sm-12 form-vertical form-app" <br/>           id="form-register" method="post" <br/>           th:action="@{/users/registrations}"&gt;<br/>            &lt;div class="col-sm-12 mt-2 lead text-center text-primary"&gt;<br/>              Create an account<br/>            &lt;/div&gt;<br/>            &lt;hr&gt;<br/>            &lt;input class="form-control" type="text" name="username" <br/>             placeholder="Username" required/&gt;<br/>            &lt;input class="form-control mt-2" type="email" name="email" <br/>             placeholder="Email" required/&gt;<br/>            &lt;input class="form-control mt-2" type="password" <br/>             name="password" placeholder="Password" required/&gt;<br/>            &lt;span th:if="${error != null}" class="mt-2 text-danger" <br/>             style="font-size: 10px" th:text="${error}"&gt;&lt;/span&gt;<br/>            &lt;button class="btn btn-primary form-control mt-2 mb-3" <br/>             type="submit"&gt;<br/>              Sign Up!<br/>            &lt;/button&gt;<br/>          &lt;/form&gt;<br/>        &lt;/div&gt;<br/>        &lt;div class="col-sm-4 col-xs-2"&gt;&lt;/div&gt;<br/>        &lt;/div&gt;<br/>      &lt;/div&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</pre>
<p>As can already be seen, the separation of our navigation bar HTML into a fragment has made our code more succinct and will contribute positively to the quality of our developed templates.</p>
<p>Having created the necessary template for the user registration page, we need to create a controller that will render this template to a visitor of the site. Let's create an application controller. Its job will be to render the web pages of the <em>Place Reviewer</em> application to a user upon request.</p>
<p>Add the <kbd>ApplicationController</kbd> class, shown here, to the controller package:</p>
<pre>package com.example.placereviewer.controller<br/><br/>import org.springframework.stereotype.Controller<br/>import org.springframework.web.bind.annotation.GetMapping<br/><br/>@Controller<br/>class ApplicationController {<br/><br/>  @GetMapping("/register")<br/>  fun register(): String {<br/>    return "register"<br/>  }<br/>}</pre>
<p>Nothing special is being done in the code snippet here. We created an MVC controller with a single action that handles a HTTP <kbd>GET</kbd> request to the <kbd>/register</kbd> path by rendering the <kbd>register.html</kbd> view to the user.</p>
<p>We are almost ready to view our newly created registration page. Before we check it out, we must add the <kbd>app.css</kbd> file required by <kbd>register.html</kbd>. Static resources such as CSS files should be added to the <kbd>static</kbd> directory within the application <kbd>resource</kbd> directory. Add a <kbd>css</kbd> directory within the <kbd>static</kbd> directory and add an <kbd>app.css</kbd> file containing the code shown here to it:</p>
<pre>//app.css<br/>.nav-enhanced {<br/>  background-color: #00BFFF;<br/>  border-color: blueviolet;<br/>  box-shadow: 0 0 3px black;<br/>}<br/><br/>.container-nav {<br/>  height: 10%;<br/>  width: 100%;<br/>  margin-bottom: 0;<br/>}<br/><br/>.form-app {<br/>  background-color: white;<br/>  box-shadow: 0 0 1px black;<br/>  margin-top: 50px !important;<br/>  padding: 10px 0;<br/>}</pre>
<p class="mce-root">Great work! Now, go ahead and run the <em>Place Reviewer</em> application. Upon starting the app, open your favorite browser and access the web page residing at&#160;<kbd>http://localhost:5000/register</kbd>.</p>
<div>
<p>Now, we must implement the logic involved in registering the user. To do this, we must declare an action that accepts the form data sent by the registration form and appropriately processes the data, with the goal of registering the user successfully on the platform. If you recall, we specified that the form data should be sent via <kbd>POST</kbd> to <kbd>/users/registrations</kbd>. Consequently, we need an action that handles such a HTTP request. Add a <kbd>UserController</kbd> class to the <kbd>com.example.placereviewer.controller</kbd> package with the code shown here:</p>
<pre><span>package </span>com.example.placereviewer.controller<br/><br/><span>import </span>com.example.placereviewer.component.UserValidator<br/><span>import </span>com.example.placereviewer.data.model.User<br/><span>import </span>com.example.placereviewer.service.SecurityService<br/><span>import </span>com.example.placereviewer.service.UserService<br/><span>import </span>org.springframework.stereotype.<span>Controller<br/></span><span>import </span>org.springframework.ui.Model<br/><span>import </span>org.springframework.validation.BindingResult<br/><span>import </span>org.springframework.web.bind.annotation.<span>GetMapping<br/></span><span>import </span>org.springframework.web.bind.annotation.<span>ModelAttribute<br/></span><span>import </span>org.springframework.web.bind.annotation.<span>PostMapping<br/></span><span>import </span>org.springframework.web.bind.annotation.<span>RequestMapping<br/></span><span><br/></span><span>@Controller<br/></span><span>@RequestMapping</span>(<span>"/users"</span>)<br/><span>class </span>UserController(<span>val </span><span>userValidator</span>: UserValidator<span>, <br/>      val </span><span>userService</span>: UserService<span>, </span><span>val </span><span>securityService</span>: SecurityService) {<br/><br/>  <span>@PostMapping</span>(<span>"/registrations"</span>)<br/>  <span>fun </span><span>create</span>(<span>@ModelAttribute </span>form: User<span>, </span>bindingResult: BindingResult<span>, <br/></span>             model: Model): String {<br/>    <span>userValidator</span>.validate(form<span>, </span>bindingResult)<br/><br/>    <span>if </span>(bindingResult.hasErrors()) {<br/>      model.addAttribute(<span>"error"</span><span>, </span>bindingResult.<span>allErrors</span>.<span>first</span>()<br/>                                               .<span>defaultMessage</span>)<br/>      model.addAttribute(<span>"username"</span><span>, </span>form.<span>username</span>)<br/>      model.addAttribute(<span>"email"</span><span>, </span>form.<span>email</span>)<br/>      model.addAttribute(<span>"password"</span><span>, </span>form.<span>password</span>)<br/><br/>      <span>return </span><span>"register"<br/></span><span>    </span>}<br/><br/>    <span>userService</span>.register(form.<span>username</span><span>, </span>form.<span>email</span><span>, </span>form.<span>password</span>)<br/>    <span>securityService</span>.autoLogin(form.<span>username</span><span>, </span>form.<span>password</span>)<br/><br/>    <span>return </span><span>"redirect:/home"<br/></span><span>  </span>}<br/>}</pre>
<p><kbd>create()</kbd> handles HTTP <kbd>POST</kbd> requests sent to <kbd>/users/registrations</kbd>. It takes three arguments. The first is form, which is an object of the <kbd>User</kbd> class. <kbd>@ModelAttribute</kbd> is used to annotate <kbd>form</kbd>. <kbd>@ModelAttribute</kbd> indicates that the argument should be retrieved by the model. The form model attribute is populated by data submitted by the form to the endpoint. The&#160;<kbd>username</kbd>, <kbd>email</kbd>, and <kbd>password</kbd> parameters are all submitted by the registration form. All objects of type <kbd>User</kbd> have <kbd>username</kbd>, <kbd>email</kbd>, and <kbd>password</kbd> properties, hence the data submitted by the form is assigned to the corresponding model properties.</p>
<p>The second argument of the function is an instance of <kbd>BindingResult</kbd>. <kbd>BindingResult</kbd> serves as a result holder for&#160;<kbd>DataBinder</kbd>. In this case, we used it to bind results of the validation process done by a <kbd>UserValidator</kbd>, which we are going to create in a bit. The third argument is a <kbd>Model</kbd>. We use this to add attributes to our model for subsequent access by the view layer.</p>
<p>Before proceeding further with explanations pertaining to the logic implemented in the <kbd>create()</kbd> action, we must implement both <kbd>UserValidator</kbd> and <kbd>SecurityService</kbd>. <kbd>UserValidator</kbd> has the sole task of validating user information submitted to the backend. Create a <kbd>com.example.placereviewer.component</kbd> package and include the <kbd>UserValidator</kbd> class here to it:</p>
<pre><span>package </span>com.example.placereviewer.component<br/><br/><span>import </span>com.example.placereviewer.data.model.User<br/><span>import </span>com.example.placereviewer.data.repository.UserRepository<br/><span>import </span>org.springframework.stereotype.<span>Component<br/></span><span>import </span>org.springframework.validation.Errors<br/><span>import </span>org.springframework.validation.ValidationUtils<br/><span>import </span>org.springframework.validation.Validator<br/><span><br/></span><span>@Component<br/></span><span>class </span>UserValidator(<span>private val </span><span>userRepository</span>: UserRepository) : Validator {<br/><br/>  <span>override fun </span><span>supports</span>(aClass: Class&lt;*&gt;?): Boolean {<br/>    <span>return </span>User::<span>class </span>== aClass<br/>  }<br/><br/>  <span>override fun </span><span>validate</span>(obj: Any?<span>, </span>errors: Errors) {<br/>    <span>val </span>user: User = obj <span>as </span>User<br/><br/>    </pre>
<p><span>Validating that submitted user parameters are not empty.</span> <span>An empty parameter is rejected with an error code and error message:<br/></span></p>
<pre><span><br/></span><span>    </span>ValidationUtils.rejectIfEmptyOrWhitespace(errors<span>, </span><span>"username"</span><span>,<br/>              </span><span>"Empty.userForm.username"</span><span>, </span><span>"Username cannot be empty"</span>)<br/>    ValidationUtils.rejectIfEmptyOrWhitespace(errors<span>, </span><span>"password"</span><span>, <br/></span><span>              "Empty.userForm.password"</span><span>, </span><span>"Password cannot be empty"</span>)<br/>    ValidationUtils.rejectIfEmptyOrWhitespace(errors<span>, </span><span>"email"</span><span>, <br/></span><span>              "Empty.userForm.email"</span><span>, </span><span>"Email cannot be empty"</span>)<br/><br/><br/></pre>
<p><span>Validating the length of a submitted username.</span> <span>A username whose length is less than 6 is rejected:</span></p>
<pre><span><br/></span><span>    </span><span>if </span>(user.<span>username</span>.<span>length </span>&lt; <span>6</span>) {<br/>      errors.rejectValue(<span>"username"</span><span>, </span><span>"Length.userForm.username"</span><span>,<br/></span><span>                   </span><span>"Username must be at least 6 characters in length"</span>)<br/>    }<br/><br/></pre>
<p><span>Validating the submitted username does not already exist.&#160;</span><span>A username already taken by a user is rejected:</span></p>
<pre><span><br/></span><span>if </span>(<span>userRepository</span>.findByUsername(user.<span>username</span>) != <span>null</span>) {<br/>  errors.rejectValue(<span>"username"</span><span>, </span><span>"Duplicate.userForm.username"</span><span>,<br/>                     </span><span>"Username unavailable"</span>)<br/>}<br/><br/>    </pre>
<p><span>Validating the length of a submitted password.</span> <span>Passwords less than 8 characters in length are rejected:</span></p>
<pre><span><br/></span><span>    </span><span>if </span>(user.<span>password</span>.<span>length </span>&lt; <span>8</span>) {<br/>      errors.rejectValue(<span>"password"</span><span>, </span><span>"Length.userForm.password"</span><span>,<br/></span><span>                   </span><span>"Password must be at least 8 characters in length"</span>)<br/>    }<br/>  }<br/>}</pre>
<p><kbd>UserValidator</kbd> implements the <kbd>Validator</kbd> interface, which is used to validate objects. As such, it overrides two methods: <kbd>supports(Class&lt;*&gt;?)</kbd> and <kbd>validate(Any?, Errors)</kbd>. <kbd>supports()</kbd> is used to assert that the validator can validate the object supplied to it. In the case of <kbd>UserValidator</kbd>, <kbd>supports()</kbd> asserts that the supplied object is an instance of the <kbd>User</kbd> class. Hence, all objects of type <kbd>User</kbd> are supported for validation by <kbd>UserValidator</kbd>.</p>
<p><kbd>validate()</kbd> validates the provided objects. In cases where validation rejections occur, it registers the error with the provided <kbd>Error</kbd> object. Ensure you read through the comments placed within the body of the <kbd>validate()</kbd> method to get a better grasp of what is going on within the method.</p>
<p>Now, we shall work on <kbd>SecurityService</kbd>. We will implement a <kbd>SecurityService</kbd> to facilitate the identification of the currently logged in user and the automatic login of a user after their registration.</p>
<p>Add the <kbd>SecurityService</kbd> interface here to <kbd>com.example.placereviewer.service</kbd>:</p>
<pre>package com.example.placereviewer.service<br/><br/>interface SecurityService {<br/>  fun findLoggedInUser(): String?<br/>  fun autoLogin(username: String, password: String)<br/>}</pre>
<p>Now, add a <kbd>SecurityServiceImpl</kbd> class to <kbd>com.example.placereviewer.service</kbd>. As the name suggests, <kbd>SecurityServiceImpl</kbd> implements <kbd>SecurityService</kbd>:</p>
<pre><span>package </span>com.example.placereviewer.service<br/><br/><span>import </span>org.springframework.beans.factory.annotation.<span>Autowired<br/></span><span>import </span>org.springframework.security.authentication.AuthenticationManager<br/><span>import </span>org.springframework.security.authentication.UsernamePasswordAuthenticationToken<br/><span>import </span>org.springframework.security.core.context.SecurityContextHolder<br/><span>import </span>org.springframework.security.core.userdetails.UserDetails<br/><span>import </span>org.springframework.stereotype.<span>Service<br/></span><span><br/></span><span><br/></span><span>@Service<br/></span><span>class </span>SecurityServiceImpl(<span>private val </span><span>userDetailsService</span>: AppUserDetailsService)<br/>      : SecurityService {<br/><br/>  <span>@Autowired<br/></span><span>  lateinit var </span><span>authManager</span>: AuthenticationManager<br/><br/>  <span>override fun </span><span>findLoggedInUser</span>(): String? {<br/>    <span>val </span>userDetails = SecurityContextHolder.getContext()<br/>                                           .<span>authentication</span>.<span>details<br/></span><span><br/></span><span>    </span><span>if </span>(userDetails <span>is </span>UserDetails) {<br/>      <span>return </span><span>userDetails</span>.<span>username<br/></span><span>    </span>}<br/><br/>    <span>return null<br/></span><span>  </span>}<br/><br/>  <span>override fun </span><span>autoLogin</span>(username: String<span>, </span>password: String) {<br/>    <span>val </span>userDetails: UserDetails = <span>userDetailsService<br/></span>                                       .loadUserByUsername(username)<br/><br/>    <span>val </span>usernamePasswordAuthenticationToken = <br/>                UsernamePasswordAuthenticationToken(userDetails<span>, </span>password<span>,<br/>                                </span>userDetails.<span>authorities</span>)<br/><br/>    <span>authManager</span>.authenticate(usernamePasswordAuthenticationToken)<br/><br/>    <span>if </span>(usernamePasswordAuthenticationToken.<span>isAuthenticated</span>) {<br/>      SecurityContextHolder.getContext().<span>authentication </span>= <br/>              usernamePasswordAuthenticationToken<br/>    }<br/>  }<br/>}</pre>
</div>
<p><kbd>findLoggedInUser()</kbd> returns the username of the currently logged in user. <kbd>Username</kbd> retrieval is done with the help of Spring Framework's <kbd>SecurityContextHolder</kbd> class. An instance of <kbd>UserDetails</kbd> is retrieved by accessing the logged in user's authentication details with a call to <kbd>SecurityContextHolder.getContext().authentication.details</kbd>. It is important to note that <kbd>SecurityContextHolder.getContext().authentication.details</kbd> returns an <kbd>Object</kbd>&#160;and not an instance of <kbd>UserDetails</kbd>. As such, we must do a type check to assert that the object retrieved conforms to the type <kbd>UserDetails</kbd> as well. If it does, we return the username of the currently logged in user. Otherwise, we return null.</p>
<p>The <kbd>autoLogin()</kbd> method will be used for the simple task of authenticating a user after registering on the platform. The submitted username and password of the user are passed as arguments to <kbd>autoLogin()</kbd>, after which an instance of <kbd>UsernamePasswordAuthenticationToken</kbd> is created for the registered user. Once an instance of <kbd>UsernamePasswordAuthenticationToken</kbd> is created, we utilize <kbd>AuthenticationManager</kbd> to authenticate the user's token. If <kbd>UsernamePasswordAuthenticationToken</kbd> is successfully authenticated, we set the authentication property of the current user to <kbd>UsernamePasswordAuthenticationToken</kbd>.</p>
<p>Having made our necessary class additions, let's return to our <kbd>UserController</kbd> to finish up our explanation of the create action. Within <kbd>create()</kbd>, first and foremost the submitted form input is validated with an instance of <kbd>UserValidator</kbd>. Errors arising during the course of form data validation are all bound to the instance of <kbd>BindingResult</kbd> injected into our controller by Spring. Consider these lines of code:</p>
<pre><span>if </span>(bindingResult.hasErrors()) {<br/>  model.addAttribute(<span>"error"</span><span>, </span>bindingResult.<span>allErrors<br/></span>                                           .<span>first</span>().<span>defaultMessage</span>)<br/>  model.addAttribute(<span>"username"</span><span>, </span>form.<span>username</span>)<br/>  model.addAttribute(<span>"email"</span><span>, </span>form.<span>email</span>)<br/>  model.addAttribute(<span>"password"</span><span>, </span>form.<span>password</span>)<br/><br/>  <span>return </span><span>"register"<br/></span>}</pre>
<p><kbd>bindingResult</kbd> is first checked to assert whether any errors occurred during form data validation. If errors occurred, we retrieve the message of the first error detected and set a <kbd>model</kbd> attribute error to hold the error message for later access by the view. In addition, we create <kbd>model</kbd> attributes to hold each input submitted by the user. Lastly, we re-render the registration view to the user.</p>
<p>Notice how we made multiple method invocations for the same <kbd>Model</kbd> instance in the previous code snippet. There is a much cleaner way we can do this. This involves the use of Kotlin's <kbd>with</kbd> function:</p>
<pre><span>if </span>(bindingResult.hasErrors()) {<br/>  with (model) {<br/>    addAttribute("error", bindingResult.allErrors.first().defaultMessage)<br/>    addAttribute("error", form.username)<br/>    addAttribute("email", form.email)<br/>    addAttribute("password", form.password)<br/>  }<br/>  return "register"<span><br/></span>}</pre>
<p>See how easy and convenient the function is to use? Go ahead and modify <kbd>UserController</kbd> to make use of <kbd>with</kbd>, as shown in the preceding code.</p>
<p>You may be wondering why we decided to store a user's submitted data in model attributes. We did this to have a way to reset the data contained in the registration form to what was originally submitted after the re-rendering of the registration view. It will certainly be frustrating for a user to have to input all form data over and over, even if only one form input entered is invalid.</p>
<p>When no input submitted by the user is invalid, the following code runs:</p>
<pre>userService.register(form.username, form.email, form.password)<br/>securityService.autoLogin(form.username, form.password)<br/>return "redirect:/home"</pre>
<p>As expected, when the data submitted by a user is valid, he is registered on the platform and logged in to his account automatically. Lastly, he is redirected to his home page. Before we try out our registration form, we must do two things:</p>
<ul>
<li style="font-weight: 400">Utilize the model attributes specified&#160;in <kbd>register.html</kbd></li>
<li style="font-weight: 400">Create a <kbd>home.html</kbd> template and a controller to render the template</li>
</ul>
<p>Luckily for us, both are rather simple to do. First, to utilize the <kbd>model</kbd> attributes. Modify the form contained in <kbd>register.html</kbd> as follows:</p>
<pre><span>&lt;form </span><span>class=</span><span>"form-group col-sm-12 form-vertical form-app" <br/></span><span> id=</span><span>"form-register" </span><span>method=</span><span>"post" </span><span>th</span><span>:action=</span><span>"@{/users/registrations}"</span><span>&gt;<br/></span><span>  &lt;div </span><span>class=</span><span>"col-sm-12 mt-2 lead text-center text-primary"</span><span>&gt;<br/></span>    Create an account<br/><span>  &lt;/div&gt;<br/></span><span>  &lt;hr&gt;<br/></span><span>  </span><span>&lt;!-- utilized model attributes with th:value --&gt;<br/></span><span>  </span><span>&lt;input </span><span>class=</span><span>"form-control" </span><span>type=</span><span>"text" </span><span>name=</span><span>"username" <br/></span><span>   placeholder=</span><span>"Username" </span><span>th</span><span>:value=</span><span>"${username}" </span><span>required</span><span>/&gt;<br/></span><span>  &lt;input </span><span>class=</span><span>"form-control mt-2" </span><span>type=</span><span>"email" </span><span>name=</span><span>"email" <br/></span><span>   placeholder=</span><span>"Email" </span><span>th</span><span>:value=</span><span>"${email}" </span><span>required</span><span>/&gt;<br/></span><span>  &lt;input </span><span>class=</span><span>"form-control mt-2" </span><span>type=</span><span>"password" </span><span>name=</span><span>"password" <br/></span><span>   placeholder=</span><span>"Password" </span><span>th</span><span>:value=</span><span>"${password}" </span><span>required</span><span>/&gt;<br/></span><span>  &lt;span </span><span>th</span><span>:if=</span><span>"${error != null}" </span><span>class=</span><span>"mt-2 text-danger" <br/></span><span>   style=</span><span>"</span><span>font-size</span>: <span>10</span><span>px" </span><span>th</span><span>:text=</span><span>"${error}"</span><span>&gt;&lt;/span&gt;<br/></span><span>  &lt;button </span><span>class=</span><span>"btn btn-primary form-control mt-2 mb-3" </span><span>type=</span><span>"submit"</span><span>&gt;<br/></span>    Sign Up!<br/><span>  &lt;/button&gt;<br/></span><span>&lt;/form&gt;</span></pre>
<p>Can you spot the changes we made? If you said we used Thymeleaf's <kbd>th:value</kbd> template attribute to preset the value held by form inputs to their respective <kbd>model</kbd> attribute values, you are right. Now, let's make a simple <kbd>home.html</kbd> template. Add the <kbd>home.html</kbd> template here to the <kbd>templates</kbd> directory:</p>
<pre><span>&lt;html&gt;<br/></span><span>  &lt;head&gt;<br/></span><span>    &lt;title&gt; </span>Home<span>&lt;/title&gt;<br/></span><span>  &lt;/head&gt;<br/></span><span>  &lt;body&gt;<br/></span>    You have been successfully registered and are now in your home page.<br/><span>  &lt;/body&gt;<br/></span><span>&lt;/html&gt;</span></pre>
<p>Now, update <kbd>ApplicationController</kbd> to include an action handling GET requests to <kbd>/home</kbd>, as shown here:</p>
<pre><span>package </span>com.example.placereviewer.controller<br/><br/><span>import </span>com.example.placereviewer.service.ReviewService<br/><span>import </span>org.springframework.stereotype.<span>Controller<br/></span><span>import </span>org.springframework.ui.Model<br/><span>import </span>org.springframework.web.bind.annotation.<span>GetMapping<br/></span><span>import </span>java.security.Principal<br/><span>import </span>javax.servlet.http.HttpServletRequest<br/><span><br/></span><span>@Controller<br/></span><span>class </span>ApplicationController(<span>val </span><span>reviewService</span>: ReviewService) {<br/><br/>  <span>@GetMapping</span>(<span>"/register"</span>)<br/>  <span>fun </span><span>register</span>(): String {<br/>    <span>return </span><span>"register"<br/></span><span>  </span>}<br/><br/>  <span>@GetMapping</span>(<span>"/home"</span>)<br/>  <span>fun </span><span>home</span>(request: HttpServletRequest<span>, </span>model: Model<span>, <br/></span>           principal: Principal): String {<br/>    <span>val </span>reviews = <span>reviewService</span>.listReviews()<br/><br/>    model.addAttribute(<span>"reviews"</span><span>, </span>reviews)<br/>    model.addAttribute(<span>"principal"</span><span>, </span>principal)<br/><br/>    <span>return </span><span>"home"<br/></span><span>  </span>}<br/>}</pre>
<p>The <kbd>home</kbd> action retrieves a list of all reviews stored within the database. In addition, the home action sets a model attribute that holds a principal containing information on the currently logged in user. Lastly, the home action renders the home page to the user.</p>
<p>Having done what's necessary, let's register a user on the <span class="packt_screen">Place Reviewer</span> platform. Build and run the application, and access the registration page from your browser (<kbd>http://localhost:5000/register</kbd>). Firstly, we want to check whether our form validations work by inputting and submitting invalid form data.</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/f81ca59e-618a-4099-a07a-0489a4c34d36.jpg" style="width:41.17em;height:30.42em;"/></div>
<p>As can be seen, the error was detected by <kbd>UserValidator</kbd> and was successfully bound to <kbd>BindingResult</kbd>, then rendered appropriately as an error in the view. Feel free to enter invalid data for other form inputs and ensure the other validations we implemented work as expected. Now to verify that our registration logic works. Input <kbd>king.kevin</kbd>, <kbd>king.k@gmail.com</kbd>, and <kbd>Kingsman406</kbd> in the username, email, and password fields, then click <span class="packt_screen">Sign Up!</span>&#160;A new account will be created and you will be presented with the home page:</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/8c56c444-e7e3-4a30-a9de-9b7a7ff1242e.jpg" style="width:52.17em;height:4.92em;"/></div>
<p>It will come as no surprise to you that we are going to make serious modifications to the home page over the course of this chapter. However, for now let's turn our attention towards creating a suitable user login page.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Implementing the login view</h1>
                </header>
            
            <article>
                
<p>Similar to how we went about implementing the user registration view, first and foremost we must work on the view template. The template required for the login view must possess a form that takes the username and password of the user to be logged in as input. We must also provide a button that facilitates the submission of the login form—after all, there is no point having a form if it cannot be submitted. In addition, we must have a means of alerting the user if something goes wrong with the login process, such as in a scenario where the user enters an invalid username and password combination. Lastly, we should provide a link to the account registration page for situations where the viewer of the login page does not already possess an account.</p>
<p>Having identified what is needed from the template to be implemented, let's go ahead with creating it. Add a <kbd>login.html</kbd> file to the template directory. Now, it is time to work on the template. As always, we must first include the necessary stylesheets and scripts to the template. This is done in the following code snippet:</p>
<pre><span>&lt;!DOCTYPE </span><span>html</span><span>&gt;<br/></span><span>&lt;html </span><span>lang=</span><span>"en" </span><span>xmlns:</span><span>th</span><span>=</span><span>"http://www.thymeleaf.org"</span><span>&gt;<br/></span><span>  &lt;head&gt;<br/></span><span>    &lt;title&gt;</span>Login<span>&lt;/title&gt;<br/></span><span>    &lt;link </span><span>rel=</span><span>"stylesheet" </span><span>th</span><span>:href=</span><span>"@{/css/app.css}"</span><span>/&gt;<br/></span><span>    &lt;link </span><span>rel=</span><span>"stylesheet" <br/></span><span>     href=</span><span>"/webjars/bootstrap/4.0.0-beta.3/css/bootstrap.min.css"</span><span>/&gt;<br/></span><span><br/></span><span>    &lt;script </span><span>src=</span><span>"/webjars/jquery/3.2.1/jquery.min.js"</span><span>&gt;&lt;/script&gt;<br/></span><span>    &lt;script </span><span>src=</span><span>"/webjars/bootstrap/4.0.0-beta.3/<br/>     js/bootstrap.min.js"</span><span>&gt;&lt;/script&gt;<br/></span><span>  &lt;/head&gt;<br/></span><span>  &lt;body&gt;</span><span><br/></span><span>  &lt;/body&gt;<br/></span><span>&lt;/html&gt;</span></pre>
<p>Having added the style and JavaScript includes necessary for the template, we can now work on the <kbd>&lt;body&gt;</kbd> of the template. As we have said before, the body of an HTML template contains the DOM elements that will be rendered to the user upon page load. Add the following code within the <kbd>&lt;body&gt;</kbd> tag of <kbd>login.html</kbd>:</p>
<pre><span>    &lt;div </span><span>th</span><span>:insert=</span><span>"fragments/navbar :: navbar"</span><span>&gt;&lt;/div&gt;<br/></span><span><br/></span><span>    &lt;div </span><span>class=</span><span>"container-fluid" </span><span>style=</span><span>"</span><span>z-index</span>: <span>2</span><span>; </span><span>position</span>: <span>absolute"</span><span>&gt;<br/></span><span>      &lt;div </span><span>class=</span><span>"row mt-5"</span><span>&gt;<br/></span><span>        &lt;div </span><span>class=</span><span>"col-sm-4 col-xs-2"</span><span>&gt;&lt;/div&gt;<br/></span><span>        &lt;div </span><span>class=</span><span>"col-sm-4 col-xs-8"</span><span>&gt;<br/></span><span>          &lt;form </span><span>class=</span><span>"form-group col-sm-12 form-vertical form-app" <br/></span><span>           id=</span><span>"form-login" </span><span>method=</span><span>"post" </span><span>th</span><span>:action=</span><span>"@{/login}"</span><span>&gt;<br/></span><span>            &lt;div </span><span>class=</span><span>"col-sm-12 mt-2 lead text-center text-primary"</span><span>&gt;<br/></span>              Login to your account<br/><span>            &lt;/div&gt;<br/></span><span>            &lt;hr&gt;<br/></span><span>            &lt;input </span><span>class=</span><span>"form-control" </span><span>type=</span><span>"text" </span><span>name=</span><span>"username" <br/></span><span>             placeholder=</span><span>"Username" </span><span>required</span><span>/&gt;<br/></span><span>            &lt;input </span><span>class=</span><span>"form-control mt-2" </span><span>type=</span><span>"password" <br/></span><span>             name=</span><span>"password" </span><span>placeholder=</span><span>"Password" </span><span>required</span><span>/&gt;<br/></span><span>            &lt;span </span><span>th</span><span>:if=</span><span>"${param.error}" </span><span>class=</span><span>"mt-2 text-danger" <br/></span><span>             style=</span><span>"</span><span>font-size</span>: <span>10</span><span>px"</span><span>&gt;<br/></span>              Invalid username and password combination<br/><span>            &lt;/span&gt;<br/></span><span>            &lt;button </span><span>class=</span><span>"btn btn-primary form-control mt-2 mb-3" <br/></span><span>             type=</span><span>"submit"</span><span>&gt;<br/></span>              Go!<br/><span>            &lt;/button&gt;<br/></span><span>          &lt;/form&gt;<br/></span><span>          &lt;div </span><span>class=</span><span>"col-sm-12 text-center" </span><span>style=</span><span>"</span><span>font-size</span>: <span>12</span><span>px"</span><span>&gt;<br/></span><span>            </span>Don't an account? Register <span>&lt;a </span><span>href=</span><span>"/register"</span><span>&gt;</span>here<span>&lt;/a&gt;<br/></span><span>          &lt;/div&gt;<br/></span><span>        &lt;/div&gt;<br/></span><span>        &lt;div </span><span>class=</span><span>"col-sm-4 col-xs-2"</span><span>&gt;<br/></span><span>          &lt;div </span><span>th</span><span>:if=</span><span>"${param.logout}" <br/></span><span>           class=</span><span>"col-sm-12 text-success text-right"</span><span>&gt;<br/></span><span>            </span>You have been logged out.<br/>          <span>&lt;/div&gt;<br/></span><span>        &lt;/div&gt;<br/></span><span>      &lt;/div&gt;<br/></span><span>    &lt;/div&gt;</span></pre>
<p>With the body added, the HTML we have created sufficiently describes the&#160;<span>required</span><span>&#160;</span><span>structure of our login page. Along with adding the required form, we added the navigation bar fragment created earlier to the page—no need to write boilerplate code. We also added a means by which a user can be provided feedback pertaining to errors that may arise in the login process. This was done with the following lines:</span></p>
<pre>&lt;span th:if="${param.error}" class="mt-2 text-danger" <br/> style="font-size: 10px"&gt;<br/>  Invalid username and password combination<br/>&lt;/span&gt;</pre>
<p>When <kbd>param.error</kbd> is set, it signifies that an error has occurred during user&#160;<span>login</span><span>, so an <span class="packt_screen">Invalid username and password combination</span> message is shown to the user. Something to keep in mind is that besides the login page often being the first point of contact a user has with a web application, it can also be a user's last point of contact with the app during an interaction session. This is particularly true in the case of user logouts. After a user is done interacting with an application and logs out, they should be redirected to a login screen. As a result of such a possibility, we added some text to notify a user that they've been logged out:</span></p>
<pre>&lt;div th:if="${param.logout}" class="col-sm-12 text-success text-right"&gt;<br/>  You have been logged out.<br/>&lt;/div&gt;</pre>
<p>The <kbd>&lt;div&gt;</kbd> tag is displayed to a user after a successful logout from their account. At this point, ideally we should implement a controller to render <kbd>login.html</kbd> but if you recall, we have already done so with the use of a custom Spring MVC configuration via our implemented <kbd>MvcConfig</kbd> class, specifically in the section of code shown here:</p>
<pre>...<br/><br/>override fun addViewControllers(registry: ViewControllerRegistry?) {<br/>  registry?.addViewController("/login")?.setViewName("login")<br/>}<br/><br/>...</pre>
<p>We made use of a <kbd>ViewControllerRegistry</kbd> instance to add a view controller that handles requests to <kbd>/login</kbd> and set the view to be used to the just-implemented login template. Build and run the application to view the newly implemented view. The web page can be accessed via <kbd>http:localhost:5000/login</kbd>:</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/1abef211-e0f7-47fc-bcbd-6111ec85f1ae.jpg" style="width:42.75em;height:28.92em;"/></div>
<p>Trying to log in with invalid user credentials will present us with a nice error message:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="images/1e84dfa3-3a45-450a-9faa-239f89217747.jpg" style="width:42.75em;height:29.42em;"/></div>
<p>On the other hand, attempting to log in with valid credentials takes us to the application's home page. Speaking of the home page, we need to work on completing its view layer. We are going to need to work directly with the Google Places API from this point onward. As such, we must set up our application to do so before proceeding.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Setting up the Place Reviewer app with the Google Places API web service</h1>
                </header>
            
            <article>
                
<p>The process of setting up a web application with the Google Places API is quick and painless and can be completed in well under five minutes. All in all, the setup can be done in two easy steps:</p>
<ol>
<li style="font-weight: 400">Get an API key</li>
<li style="font-weight: 400">Include the Google Places API in your web application</li>
</ol>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Getting an API key</h1>
                </header>
            
            <article>
                
<p>An API key can be gotten by visiting <a href="https://developers.google.com/places/web-service/get-api-key">https://developers.google.com/places/web-service/get-api-key</a>, scrolling to the <span class="packt_screen">Get an API key</span>&#160;section, and clicking the <span class="packt_screen">GET A KEY</span>&#160;button:</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/f55d2dd7-061f-4079-8ecc-d0be79e2cd85.jpg" style="width:59.92em;height:31.83em;"/></div>
<p>Upon clicking the button, you will be presented with a modal from which you can select or create a project to be integrated with the Google Places API Web Service. Click on the dropdown and select <span class="packt_screen">Create a new project</span>. You will be requested to provide a project name. Input <kbd>Place Reviewer</kbd> as the project name:</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/91ef273c-e70e-4de6-a602-22e43f3a2e84.jpg"/></div>
<p>After providing a project name, click <span class="packt_screen">NEXT</span>&#160;to proceed. Your project will be set up for use with the API and you will be presented with an API key to use!</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/af8f5a3a-672d-4f18-92d7-f7c5d31b017a.jpg"/></div>
<p>Now that we have an API key, let's have a look at how to use it.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Including Google Places API in your web application</h1>
                </header>
            
            <article>
                
<p>Utilizing an API key for the Google Places API Web Service is just as easy—if not easier—as generating the API key.&#160;To make use of a generated API key in your web application, all that is necessary is the inclusion of the following line of HTML in the markup of the page you want to make use of the web service:</p>
<pre>&lt;script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key={{API_KEY}}&amp;libraries=places"&gt;&lt;/script&gt;</pre>
<p>Ensure you replace &#160;<kbd>{{API_KEY}}</kbd> with your generated API key.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Implementing the home view</h1>
                </header>
            
            <article>
                
<p>As expected, at this point it will be required of us to do a bit of coding. In keeping with practices we have adhered to in previous chapters, it will be wise of us to firstly make a barebones graphical mockup of the view we want to create before commencing with coding. This will save a significant amount of time in the long run by providing a clear direction regarding what we want to build.</p>
<p>We want the home page we are creating to do the following:</p>
<ol>
<li style="font-weight: 400">Show the latest place reviews posted on the platform</li>
<li style="font-weight: 400">Provide direct access to a web page for review creation</li>
<li style="font-weight: 400">Provide a means by which a user can sign out of their account</li>
<li style="font-weight: 400">Enable a user to view the exact location of a reviewed place with the help of a map</li>
</ol>
<p>Keeping all these requirements in mind, we can draw a rough sketch of our final template that looks something like this:</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/1c83f661-e849-49e5-a7a7-91635775d9fd.jpg" style="width:42.33em;height:24.08em;"/></div>
<p>We are aiming for functionality over flash in our layout design. You can see that layout requirements one through four are immediately satisfied by this sketch. Clicking on <span class="packt_screen">View location</span>&#160;will present the user of the application with a modal within which a map showing the exact place reviewed will be displayed.</p>
<p>Having clearly stated the template we will be creating, let us code. As always, first and foremost we need to include external stylesheets and scripts to our template. Open up <kbd>home.html</kbd> and add the following code to it:</p>
<pre><span>&lt;!DOCTYPE </span><span>html</span><span>&gt;<br/></span><span>&lt;html </span><span>lang=</span><span>"en" </span><span>xmlns:</span><span>th</span><span>=</span><span>"http://www.thymeleaf.org"</span><span>&gt;<br/></span><span>  &lt;head&gt;<br/></span><span>    &lt;title&gt;</span>Home<span>&lt;/title&gt;<br/></span><span>    </span><span>&lt;!-- Addition of external stylesheets --&gt;<br/></span><span>    </span><span>&lt;link </span><span>rel=</span><span>"stylesheet" </span><span>th</span><span>:href=</span><span>"@{/css/app.css}"</span><span>/&gt;<br/></span><span>    &lt;link </span><span>rel=</span><span>"stylesheet" <br/></span><span>      href=</span><span>"https://cdnjs.cloudflare.com/ajax/libs/toastr.js<br/>            /latest/toastr.min.css"</span><span>&gt;<br/></span><span>    &lt;link </span><span>rel=</span><span>"stylesheet" <br/></span><span>     href=</span><span>"/webjars/bootstrap/4.0.0-beta.3/css/bootstrap.min.css"</span><span>/&gt;<br/></span><span>    &lt;link </span><span>rel=</span><span>"stylesheet" <br/></span><span>     href=</span><span>"https://maxcdn.bootstrapcdn.com/font-awesome<br/>           /4.7.0/css/font-awesome.min.css"</span><span>/&gt;<br/></span><span>    &lt;link </span><span>href=</span><span>"https://fastcdn.org/Buttons/2.0.0/css/buttons.css" <br/></span><span>     rel=</span><span>"stylesheet"</span><span>&gt;<br/></span><span><br/></span><span>    </span><span>&lt;!-- Inclusion of external Javascript --&gt;<br/></span><span>    </span><span>&lt;script </span><span>src=</span><span>"/webjars/jquery/3.2.1/jquery.min.js"</span><span>&gt;&lt;/script&gt;<br/></span><span>    &lt;script </span><span>src=</span><span>"https://cdnjs.cloudflare.com/ajax/libs<br/>                 /toastr.js/latest/toastr.min.js"</span><span>&gt;<br/>    &lt;/script&gt;<br/></span><span>    &lt;script </span><span>src=</span><span>"https://cdnjs.cloudflare.com/ajax/libs<br/>                 /popper.js/1.12.6/umd/popper.min.js"</span><span>&gt;<br/>    &lt;/script&gt;<br/></span><span>    &lt;script </span><span>src=</span><span>"/webjars/bootstrap/4.0.0-beta.3/<br/>                 js/bootstrap.min.js"</span><span>&gt;&lt;/script&gt;<br/></span><span>    &lt;script </span><span>src=</span><span>"https://fastcdn.org/Buttons/2.0.0/js/buttons.js"</span><span>&gt;&lt;/script&gt;<br/></span><span>    &lt;script </span><span>type=</span><span>"text/javascript" <br/></span><span>     src=</span><span>"https://maps.googleapis.com/maps/api/js?key={{API_KEY}}<br/>          &amp;libraries=places"</span><span>&gt;</span><span><br/></span><span>  &lt;/head&gt;</span><span><br/></span><span>&lt;/html&gt;</span></pre>
<p>Nice work! In addition to external stylesheets, we are going to make use of internal styles in this template. To define internal stylesheets in HTML files, simply add a <kbd>&lt;style&gt;</kbd> tag within the head of the HTML and input your desired CSS rules. Add the following style to <kbd>home.html</kbd>:</p>
<pre><span>&lt;/script&gt;<br/></span><span><br/></span><span>    </span><span>&lt;!-- Definition of internal styles --&gt;<br/></span><span>    </span><span>&lt;style&gt;<br/></span><span>      #map </span>{<br/>        <span>height</span>: <span>400</span><span>px</span><span>;<br/></span><span>      </span>}<br/><br/>      .<span>container-review </span>{<br/>        <span>background-color</span>: <span>white</span><span>;<br/></span><span>        </span><span>border-radius</span>: <span>2</span><span>px</span><span>;<br/></span><span>        </span><span>font-family</span>:<span>sans-serif</span><span>;<br/></span><span>        </span><span>box-shadow</span>: <span>0 0 1</span><span>px black</span><span>;<br/></span><span>        </span><span>border-color</span>: <span>black</span><span>;<br/></span><span>        </span><span>padding</span>: <span>0</span><span>;<br/></span><span>        </span><span>min-width</span>: <span>250</span><span>px</span><span>;<br/></span><span>        </span><span>height</span>: <span>230</span><span>px</span><span>;<br/></span><span>      </span>}<br/><br/>      .<span>review-author </span>{<br/>        <span>font-size</span>: <span>15</span><span>px<br/></span><span>      </span>}<br/><br/>      .<span>review-location </span>{<br/>        <span>font-size</span>: <span>12</span><span>px<br/></span><span>      </span>}<br/><br/>      .<span>review-title </span>{<br/>        <span>font-size</span>: <span>13</span><span>px</span><span>;<br/></span><span>        </span><span>text-decoration-style</span>: <span>dotted</span><span>;<br/></span><span>        </span><span>height</span>: <span>calc</span>(<span>20 </span>/ <span>100 </span>* <span>230</span><span>px</span>)<span>;<br/></span><span>      </span>}<br/><br/>      .<span>review-content </span>{<br/>        <span>font-size</span>: <span>12</span><span>px</span><span>;<br/></span><span>        </span><span>height</span>: <span>calc</span>(<span>40 </span>/ <span>100 </span>* <span>230</span><span>px</span>)<span>;<br/></span><span>      </span>}<br/><br/>      .<span>review-header </span>{<br/>        <span>height</span>: <span>calc</span>(<span>20 </span>/ <span>100 </span>* <span>230</span><span>px</span>)<br/>      }<br/><br/>      <span>hr </span>{<br/>        <span>margin</span>: <span>0</span><span>;<br/></span><span>      </span>}<br/><br/>      .<span>review-footer </span>{<br/>        <span>height</span>: <span>calc</span>(<span>20 </span>/ <span>100 </span>* <span>230</span><span>px</span>)<span>;<br/></span><span>      </span>}<br/>    <span>&lt;/style&gt;</span></pre>
<p>Now, lets work on the body of the page. As you already know, all elements that make up the body of an HTML template must exist in a <kbd>&lt;body&gt;</kbd>&#160; tag. With that in mind, we can work on&#160;<kbd>home.html</kbd>. Start by adding the following HTML to the template file:</p>
<pre><span>  &lt;!-- Invokes the showNoReviewNotification() function defined in --&gt;<br/></span><span>  &lt;!-- internal Javascript of this file upon document load. --&gt;<br/></span><span>  &lt;body <br/></span><span>    th</span><span>:onload=</span><span>"'javascript:showNoReviewNotification(<br/>      ' + ${reviews.size() == 0} + '<br/>    )'"</span><span>&gt;<br/></span><span>  &lt;div </span><span>th</span><span>:insert=</span><span>"fragments/navbar :: navbar"</span><span>&gt;</span><span>&lt;/div&gt;<br/></span><span>  &lt;div </span><span>class=</span><span>"container"</span><span>&gt;<br/></span><span>    &lt;div </span><span>class=</span><span>"row mt-5"</span><span>&gt;<br/></span><span>      </span><span>&lt;!-- Creates view containers for each review retrieved --&gt;<br/></span><span>      &lt;!-- Distinct &lt;div&gt; containers are created for the --&gt;<br/></span><span>      &lt;!-- review author, location, title and body. --&gt;<br/></span><span>      </span><span>&lt;div </span><span>th</span><span>:each=</span><span>"review: ${reviews}" <br/></span><span>       class=</span><span>"col-sm-2 container-review mt-4 mr-2"</span><span>&gt;<br/></span><span>        &lt;div </span><span>class=</span><span>"review-header pt-1"</span><span>&gt;<br/></span><span>          &lt;div </span><span>class=</span><span>"col-sm-12 review-author text-success"</span><span>&gt;<br/></span><span>            &lt;b </span><span>th</span><span>:text=</span><span>"${review.reviewer.username}"</span><span>&gt;&lt;/b&gt;<br/></span><span>          &lt;/div&gt;<br/></span><span>          &lt;div </span><span>th</span><span>:text=</span><span>"${review.placeName}" <br/></span><span>           class=</span><span>"col-sm-12 review-location"</span><span>&gt;<br/>          &lt;/div&gt;<br/></span><span>          &lt;/div&gt;<br/></span><span>          &lt;hr&gt;<br/></span><span>          &lt;b&gt;<br/>            &lt;div </span><span>th</span><span>:text=</span><span>"${review.title}" <br/></span><span>             class=</span><span>"col-sm-12 review-title pt-1"</span><span>&gt;<br/>            &lt;/div&gt;<br/>          &lt;/b&gt;<br/></span><span>          &lt;hr&gt;<br/></span><span>          &lt;div </span><span>th</span><span>:text=</span><span>"${review.body}" <br/></span><span>           class=</span><span>"col-sm-12 review-content pt-2"</span><span>&gt;<br/>          &lt;/div&gt;<br/></span><span>          &lt;div </span><span>class=</span><span>"review-footer"</span><span>&gt;<br/></span><span>            </span><span>&lt;!-- Creation of distinct DOM <br/>            &lt;button&gt; elements for the display of reviewed locations. --&gt;<br/></span><span>              &lt;!-- Upon button click, the application renders a modal <br/>               showing the reviewed location on a map --&gt;<br/></span><span>              </span><span>&lt;button </span><span>class=</span><span>"col-sm-12 button button-small button-primary"<br/>               </span><span>type=</span><span>"button" </span><span>data-toggle=</span><span>"modal" </span><span>data-target=</span><span>"#mapModal" <br/></span><span>               style=</span><span>"</span><span>height</span>: <span>inherit</span><span>; </span><span>border-radius</span>: <span>2</span><span>px</span><span>;</span><span>" <br/></span><span>               </span><span>th</span><span>:onclick=</span><span>"'javascript:showLocation(<br/>                 ' + ${review.latitude} + ',' <br/>                   + ${review.longitude} + ',\'' <br/>                   + ${review.placeId} + '\'<br/>               )'"</span><span>&gt;<br/></span><span>               &lt;i </span><span>class=</span><span>"fa fa-map-o" </span><span>aria-hidden=</span><span>"true"</span><span>&gt;&lt;/i&gt;<br/></span><span>               </span>View location<br/>             <span>&lt;/button&gt;<br/></span><span>           &lt;/div&gt;<br/></span><span>         &lt;/div&gt;<br/></span><span>       &lt;/div&gt;<br/></span><span>     &lt;/div&gt;</span></pre>
<p>Great job! Do not worry too much about what the preceding code block does as of now. We shall explain everything in due time. Moving on continue the body of <kbd>home.html</kbd> by adding the following lines of code to it:</p>
<pre><span>&lt;!-- Modal creation --&gt;<br/></span><span>&lt;div </span><span>class=</span><span>"modal fade" </span><span>id=</span><span>"mapModal"</span><span>&gt;<br/></span><span>  &lt;div </span><span>class=</span><span>"modal-dialog modal-lg" </span><span>role=</span><span>"document"</span><span>&gt;<br/></span><span>    &lt;div </span><span>class=</span><span>"modal-content"</span><span>&gt;<br/></span><span>      &lt;div </span><span>class=</span><span>"modal-header"</span><span>&gt;<br/></span><span>        &lt;h5 </span><span>class=</span><span>"modal-title"</span><span>&gt;</span>Reviewed location<span>&lt;/h5&gt;<br/></span><span>        &lt;button </span><span>type=</span><span>"button" </span><span>class=</span><span>"close" <br/></span><span>         data-dismiss=</span><span>"modal" </span><span>aria-label=</span><span>"Close"</span><span>&gt;<br/></span><span>          &lt;span </span><span>aria-hidden=</span><span>"true"</span><span>&gt;</span><span>&amp;times;</span><span>&lt;/span&gt;<br/></span><span>        &lt;/button&gt;<br/></span><span>      &lt;/div&gt;<br/></span><span>      &lt;div </span><span>class=</span><span>"modal-body"</span><span>&gt;<br/></span><span>        &lt;div </span><span>class=</span><span>"container-fluid"</span><span>&gt;<br/></span><span>          &lt;div </span><span>id=</span><span>"map"</span><span>&gt;</span><span> &lt;/div&gt;<br/></span><span>        &lt;/div&gt;<br/></span><span>      &lt;/div&gt;<br/></span><span>      &lt;div </span><span>class=</span><span>"modal-footer"</span><span>&gt;<br/></span><span>        &lt;button </span><span>type=</span><span>"button" </span><span>class=</span><span>"btn btn-primary" <br/></span><span>         data-dismiss=</span><span>"modal"</span><span>&gt;<br/></span>          Done<br/><span>        &lt;/button&gt;<br/></span><span>      &lt;/div&gt;<br/></span><span>    &lt;/div&gt;<br/></span><span>  &lt;/div&gt;<br/></span><span>&lt;/div&gt;</span></pre>
<p class="mce-root"><span>The preceding code declares a modal that will hold a map displaying the exact location a review was created—upon the request of the user. We are not done with the home template yet. Continue work on the <kbd>&lt;body&gt;</kbd>&#160; further by adding the following lines of code to it:</span></p>
<pre><span><br/></span><span>&lt;span </span><span>style=</span><span>"</span><span>bottom</span>: <span>20</span><span>px</span><span>; </span><span>right</span>: <span>20</span><span>px</span><span>; </span><span>position</span>: <span>fixed"</span><span>&gt;<br/></span><span>  &lt;form </span><span>method=</span><span>"get" </span><span>th</span><span>:action=</span><span>"@{/create-review}"</span><span>&gt;<br/></span><span>    &lt;button </span><span>class=</span><span>"button button-primary button-circle <br/>     button-giant navbar-bottom" </span><span>type=</span><span>"submit"</span><span>&gt;<br/>      &lt;i </span><span>class=</span><span>"fa fa-plus"</span><span>&gt;&lt;/i&gt;<br/>    &lt;/button&gt;<br/></span><span>  &lt;/form&gt;<br/></span><span>&lt;/span&gt;</span></pre>
<p class="mce-root">Finally, add internal JavaScript for the HTML page:</p>
<pre><span>     &lt;script&gt;<br/></span><span>       //</span><span>Shows a toast notification to the user when no review is present</span><span><br/></span><span>       </span><span>function </span><span>showNoReviewNotification</span>(show) {<br/>         <span>if </span>(show) {<br/>           <span>toastr</span>.<span>info</span>(<span>'No reviews to see'</span>)<span>;<br/></span><span>         </span>}<br/>       }<br/><br/>       </pre>
<p><span>The following function initializes&#160;and displays a map showing the location where</span> <span>a review was written:</span></p>
<pre><span><br/></span><span>function </span><span>showLocation</span>(latitude<span>, </span>longitude<span>, </span>placeId) {<br/>  <span>var </span>center = <span>new </span>google.maps.LatLng(latitude<span>, </span>longitude)<span>;<br/></span><span><br/></span><span>  </span><span>var </span>map = <span>new </span>google.maps.Map(document.<span>getElementById</span>(<span>'map'</span>)<span>, </span>{<br/>    <span>center</span>: center<span>,<br/></span><span>    </span><span>zoom</span>: <span>15</span><span>,<br/></span><span>    </span><span>scrollwheel</span>: <span>false<br/></span><span>  </span>})<span>;<br/></span><span>  </span><span>var </span>service = <span>new </span>google.maps.places.PlacesService(map)<span>;<br/></span><span><br/></span><span>  </span><span>loadPlaceMarker</span>(service<span>, </span>map<span>, </span>placeId)<span>;<br/></span>}<br/><br/>       </pre>
<p><span>Load place marker creates a map marker on the reviewed location:</span></p>
<pre><span><br/></span><span>     </span><span>function </span><span>loadPlaceMarker</span>(service<span>, </span>map<span>, </span>placeId) {<br/>       <span>var </span>request = {<br/>         <span>placeId</span>: placeId<br/>       }<span>;<br/></span><span><br/></span><span>       </span>service.getDetails(request<span>, </span><span>function </span>(place<span>, </span>status) {<br/>         <span>if </span>(status === google.maps.places.PlacesServiceStatus.OK) {<br/>           <span>new </span>google.maps.Marker({<br/>              <span>map</span>: map<span>,<br/></span><span>              t</span><span>itle</span>: place.<span>name</span><span>,<br/></span><span>            </span><span>place</span>: {<br/>              <span>placeId</span>: place.place_id<span>,<br/></span><span>              </span><span>location</span>: place.geometry.location<br/>            }<br/><br/>          })<br/>        }<br/>      })<span>;<br/></span><span>    </span>}<br/><span>  &lt;/script&gt;<br/></span><span>&lt;/body&gt;</span></pre>
<p>Quite a lot has been done on <kbd>home.html</kbd>, so let's talk a bit about what exactly is going on in the view, starting with the <kbd>&lt;head&gt;</kbd> tag. We included stylesheets and scripts required by the home page from lines 4 through 16 of the <kbd>&lt;head&gt;</kbd> tag. The CSS included is as follows:</p>
<pre><span>&lt;link </span><span>rel=</span><span>"stylesheet" </span><span>th</span><span>:href=</span><span>"@{/css/app.css}"</span><span>/&gt;<br/></span><span>&lt;link </span><span>rel=</span><span>"stylesheet" </span><span>href=</span><span>"https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"</span><span>&gt;<br/></span><span>&lt;link </span><span>rel=</span><span>"stylesheet" </span><span>href=</span><span>"/webjars/bootstrap/4.0.0-beta.3/css/bootstrap.min.css"</span><span>/&gt;<br/></span><span>&lt;link </span><span>rel=</span><span>"stylesheet" </span><span>href=</span><span>"https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"</span><span>/&gt;<br/></span><span>&lt;link </span><span>href=</span><span>"https://fastcdn.org/Buttons/2.0.0/css/buttons.css" </span><span>rel=</span><span>"stylesheet"</span><span>&gt;</span></pre>
<p>These are external stylesheet inclusions for our application's CSS; Toastr, a library for the creation of JavaScript toast notifications; Bootstrap, a powerful library for designing websites and web applications; <strong>Font Awesome</strong>, an icon toolkit for websites and web applications; and buttons, a powerful and highly customizable web and CSS buttons library.</p>
<p>Right after the CSS inclusions, we have a number of external JavaScript inclusions as well:</p>
<pre><span>&lt;script </span><span>src=</span><span>"/webjars/jquery/3.2.1/jquery.min.js"</span><span>&gt;&lt;/script&gt;<br/></span><span>&lt;script </span><span>src=</span><span>"https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"</span><span>&gt;&lt;/script&gt;<br/></span><span>&lt;script </span><span>src=</span><span>"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.6/umd/popper.min.js"</span><span>&gt;&lt;/script&gt;<br/></span><span>&lt;script </span><span>src=</span><span>"/webjars/bootstrap/4.0.0-beta.3/js/bootstrap.min.js"</span><span>&gt;&lt;/script&gt;<br/></span><span>&lt;script </span><span>src=</span><span>"https://fastcdn.org/Buttons/2.0.0/js/buttons.js"</span><span>&gt;&lt;/script&gt;<br/></span><span>&lt;script </span><span>type=</span><span>"text/javascript" </span><span>src=</span><span>"https://maps.googleapis.com/maps/api/js?key={{API_KEY}}&amp;libraries=places"</span><span>&gt;&lt;/script&gt;</span></pre>
<p>The script inclusions in their respective order are for: JQuery, a JavaScript library designed specifically to simplify the client-side HTML scripting process; Toastr; Popper, a library used to manage poppers in web applications; Bootstrap; buttons; and the Google Places API web service. Once again, ensure you replace the <kbd>{{API_KEY}}</kbd> with your API key for the Google Places API web service—this is important.</p>
<p>Immediately after the JavaScript inclusions, we defined an internal stylesheet for the web page. Unfortunately, an explanation of stylesheets and their creation is beyond the scope of this book. However, it will be a good idea to brush up on CSS in your spare time. Further down <kbd>home.html</kbd>, we added a <kbd>&lt;body&gt;</kbd> tag as follows:</p>
<pre>&lt;body th:onload="'javascript:showNoReviewNotification(' + ${reviews.size() == 0} + ')'"&gt;</pre>
<p><kbd>th:onload</kbd> in this is used to specify JavaScript that must be run after the page has been completely loaded. In short, it specifies code to be executed after an <kbd>onload</kbd> event occurs. In this case, the script to be run is a JavaScript function we defined further down the template,&#160;<kbd>showNoReviewNotification(boolean)</kbd>. &#160;The function shows a toast message indicating that no reviews are available to be viewed when the reviews list provided by the model is empty. <kbd>showNoReviewNotification(boolean)</kbd> is declared in our template as follows:</p>
<pre><span>function </span><span>showNoReviewNotification</span>(show) {<br/>  <span>if </span>(show) {<br/>    <span>toastr</span>.<span>info</span>(<span>'No reviews to see'</span>)<span>;<br/></span><span>  </span>}<br/>}</pre>
<p><kbd>showNoReviewNotification(boolean)</kbd> takes a single <kbd>Boolean</kbd> argument, <kbd>show</kbd>. When <kbd>show</kbd> is true, a toast notification with the message <kbd>No reviews to see</kbd>&#160;is rendered to the user. The display of toast notifications to a user is made possible by the Toastr library we are utilizing.</p>
<p>When there are reviews available to be shown to the user, then a container is created for each review item as follows:</p>
<pre><span>&lt;!-- Creates view containers for each review retrieved --&gt;<br/></span><span>&lt;!-- Distinct &lt;div&gt; containers are created for the --&gt;<br/></span><span>&lt;!-- review author, location, title and body. --&gt;<br/></span><span>&lt;div </span><span>th</span><span>:each=</span><span>"review: ${reviews}" </span><span>class=</span><span>"col-sm-2 container-review mt-4 mr-2"</span><span>&gt;<br/></span><span>  &lt;div </span><span>class=</span><span>"review-header pt-1"</span><span>&gt;<br/></span><span>    &lt;div </span><span>class=</span><span>"col-sm-12 review-author text-success"</span><span>&gt;<br/></span><span>      &lt;b </span><span>th</span><span>:text=</span><span>"${review.reviewer.username}"</span><span>&gt;&lt;/b&gt;<br/></span><span>    &lt;/div&gt;<br/></span><span>    &lt;div </span><span>th</span><span>:text=</span><span>"${review.placeName}" </span><span>class=</span><span>"col-sm-12 review-location"</span><span>&gt;<br/>    &lt;/div&gt;<br/></span><span>  &lt;/div&gt;<br/></span><span>  &lt;hr&gt;<br/></span><span>  &lt;b&gt;<br/>    &lt;div </span><span>th</span><span>:text=</span><span>"${review.title}" </span><span>class=</span><span>"col-sm-12 review-title pt-1"</span><span>&gt;<br/>    &lt;/div&gt;<br/>  &lt;/b&gt;<br/></span><span>  &lt;hr&gt;<br/></span><span>  &lt;div </span><span>th</span><span>:text=</span><span>"${review.body}" </span><span>class=</span><span>"col-sm-12 review-content pt-2"</span><span>&gt;<br/>  &lt;/div&gt;<br/></span><span>  &lt;div </span><span>class=</span><span>"review-footer"</span><span>&gt;<br/></span><span>    </span><span>&lt;!-- Creation of distinct DOM &lt;button&gt; elements for the <br/>     display of reviewed locations. --&gt;<br/></span><span>    &lt;!-- Upon button click, the application renders a modal <br/>     showing the reviewed location on a map --&gt;<br/></span><span>    </span><span>&lt;button </span><span>class=</span><span>"col-sm-12 button button-small button-primary" <br/></span><span>     type=</span><span>"button" </span><span>data-toggle=</span><span>"modal" </span><span>data-target=</span><span>"#mapModal" <br/></span><span>     style=</span><span>"</span><span>height</span>: <span>inherit</span><span>; </span><span>border-radius</span>: <span>2</span><span>px</span><span>;</span><span>"<br/></span><span>     </span><span>th</span><span>:onclick=</span><span>"'javascript:showLocation(' <br/>       + ${review.latitude} + ',' <br/>       + ${review.longitude} + ',\'' <br/>       + ${review.placeId} + '\<br/>     ')'"</span><span>&gt;<br/></span><span>      &lt;i </span><span>class=</span><span>"fa fa-map-o" </span><span>aria-hidden=</span><span>"true"</span><span>&gt;&lt;/i&gt;<br/></span><span>      </span>View location<br/>    <span>&lt;/button&gt;<br/></span><span>  &lt;/div&gt;<br/></span><span>&lt;/div&gt;</span></pre>
<p>Each review container displays the username of the reviewer, the name of the place reviewed, the review title, the review body and a button enabling the user to view the reviewed location. Thymeleaf's <kbd>th:each</kbd> attribute was used to iterate over each review in the <kbd>reviews</kbd>&#160;list, as shown here:</p>
<pre><span>&lt;div </span><span>th</span><span>:each=</span><span>"review: ${reviews}" </span><span>class=</span><span>"col-sm-2 container-review mt-4 mr-2"</span><span>&gt;</span></pre>
<p>A good way to understand the iteration process is by reading <kbd>th:each="review: ${reviews}"</kbd> as <kbd>For each review in reviews</kbd>. The review currently being iterated upon is held by the <kbd>review</kbd>&#160;<span>variable</span><span>. Hence, the data held by the review being iterated upon can be accessed like any other object. This is the case here:</span></p>
<pre><span>&lt;div </span><span>th</span><span>:text=</span><span>"${review.placeName}" </span><span>class=</span><span>"col-sm-12 review-location"</span><span>&gt;&lt;/div&gt;</span></pre>
<p><kbd>th:text</kbd> sets the text held by the <kbd>&lt;div&gt;</kbd> to the value assigned to <kbd>review.placeName</kbd>. It is also necessary to explain the process by which location maps are shown to the user. Take a close look at the following lines of code:</p>
<pre><span>&lt;button </span><span>class=</span><span>"col-sm-12 button button-small button-primary" </span><span>type=</span><span>"button"<br/></span><span> </span><span>data-toggle=</span><span>"modal" </span><span>data-target=</span><span>"#mapModal" </span><span>style=</span><span>"</span><span>height</span>: <span>inherit</span><span>; <br/></span><span> border-radius</span>: <span>2</span><span>px</span><span>;</span><span>"<br/></span><span> </span><span>th</span><span>:onclick=</span><span>"'javascript:showLocation(' <br/>   + ${review.latitude} + ',' <br/>   + ${review.longitude} + ',\'' <br/>   + ${review.placeId} + '\<br/> ')'"</span><span>&gt;<br/></span><span>  &lt;i </span><span>class=</span><span>"fa fa-map-o" </span><span>aria-hidden=</span><span>"true"</span><span>&gt;&lt;/i&gt;<br/></span><span>  </span>View location<br/><span>&lt;/button&gt;</span></pre>
<p>This code block defines a button that does two things when a click event occurs on it. Firstly, it displays a modal identified by the ID&#160;<kbd>mapModal</kbd> to the user. Secondly, it initializes and renders a map displaying the exact location that was reviewed. The rendering of the map is made possible by the <kbd>showLocation()</kbd> JavaScript function we defined in our template file.</p>
<p><kbd>showLocation()</kbd> takes three parameters as its arguments. The first is the longitudinal coordinate, the second a latitudinal coordinate, and the third the unique identifier of the location reviewed—a place ID. The place ID for the location is provided by the Google Places API. Firstly, <kbd>showLocation()</kbd> retrieves a central point for the locational coordinates provided. This is done by utilizing the Google Places API's <kbd>google.maps.LatLng</kbd> class. Simply defined, a <kbd>LatLng</kbd> is a point in geographical coordinates (longitude and latitude). Upon retrieving the central point, a new map is created with the use of the <kbd>Map</kbd> class (again, provided by the Google Places API) as shown in this code snippet:</p>
<pre><span>var </span>map = <span>new </span>google.maps.Map(document.<span>getElementById</span>(<span>'map'</span>)<span>, </span>{<br/>  <span>center</span>: center<span>,<br/></span><span>  </span><span>zoom</span>: <span>15</span><span>,<br/></span><span>  </span><span>scrollwheel</span>: <span>false<br/></span>})<span>;</span></pre>
<p>The created map is placed within a DOM container element with an ID <kbd>map</kbd>. After creating the necessary map, we create a location marker at the exact location with the help of the&#160;<kbd>loadPlaceMarker()</kbd> function. <kbd>loadPlaceMarker()</kbd> takes instances of <kbd>google.maps.places.PlacesService</kbd>, <kbd>Map</kbd>, and a place id as its three arguments. <kbd>PlacesService</kbd> is a class that possesses methods for the retrieval of place information and searching places.</p>
<p>The instance of <kbd>google.maps.places.PlacesService</kbd> is firstly used to retrieve the details of the place with the specified place ID (the reviewed location). If the details of the place are successfully retrieved, <kbd>status === google.maps.places.PlacesServiceStatus.OK</kbd> evaluates to true and a marker for the location is placed on the map. The marker is created with the <kbd>google.maps.Marker</kbd> class. <kbd>Marker()</kbd> takes an optional options object as a its sole argument. When the options object is present, the place marker is created with the options specified. In this case, we specified a map in the options object. As such, the marker is added to the map upon its creation.</p>
<p>Lastly, we added a form to our template that sends a <kbd>GET</kbd> request to the <kbd>/reviews/new</kbd> path upon its submission, and added a button that submits the form upon clicking. This was done in the lines shown here:</p>
<pre><span>&lt;form </span><span>method=</span><span>"get" </span><span>th</span><span>:action=</span><span>"@{/reviews/new}"</span><span>&gt;<br/></span><span>  &lt;button </span><span>class=</span><span>"button button-primary button-circle button-giant <br/>   navbar-bottom" </span><span>type=</span><span>"submit"</span><span>&gt;&lt;i </span><span>class=</span><span>"fa fa-plus"</span><span>&gt;&lt;/i&gt;&lt;/button&gt;<br/></span><span>&lt;/form&gt;</span></pre>
<p>That is all we need to do regarding the home page, so go ahead and check it out! Rebuild and run the application, register an account, and view the home page you just created!</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/7ff0f079-ffd8-4674-9023-6ee04e65ddb2.jpg"/></div>
<p>As you can see, no reviews have been created on the platform for viewing. We must now work on a web page that allows the creation of reviews.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Implementing the review creation web page</h1>
                </header>
            
            <article>
                
<p>Thus far, we have created views for user registration and login, as well as a homepage for logged in users to peruse reviews posted on the platform. We must now work on the view that facilitates the creation of these reviews. As always, first, before creating the view, let us work on an action that will be in charge of rendering our to-be-developed view to users. Open up the <kbd>ApplicationController</kbd> class and add the following method to it:</p>
<pre>@GetMapping("/create-review")<br/>fun createReview(model: Model, principal: Principal): String {<br/> model.addAttribute("principal", principal) <br/> return "create-review"<br/>}</pre>
<p>The <kbd>createReview()</kbd> action handles HTTP <kbd>GET</kbd> requests to the <kbd>/create-review</kbd> request path by returning a <kbd>create-review.html</kbd> template to the client for rendering. Go ahead and add a <kbd>create-review.html</kbd> file to the project <kbd>template</kbd> directory.&#160;</p>
<p>Similar to what we did before, let's begin by adding external styles and scripts to <kbd>create-review.html</kbd>:</p>
<pre><span>&lt;!DOCTYPE </span><span>html</span><span>&gt;<br/></span><span>&lt;html </span><span>lang=</span><span>"en" </span><span>xmlns:</span><span>th</span><span>=</span><span>"http://www.thymeleaf.org"</span><span>&gt;<br/></span><span>  &lt;head&gt;<br/></span><span>    &lt;title&gt;</span>New review<span>&lt;/title&gt;<br/></span><span>    </span><span>&lt;!-- Addition of external stylesheets --&gt;<br/></span><span>    </span><span>&lt;link </span><span>rel=</span><span>"stylesheet" </span><span>th</span><span>:href=</span><span>"@{/css/app.css}"</span><span>/&gt;<br/></span><span>    &lt;link </span><span>rel=</span><span>"stylesheet" </span><span>href=</span><span>"/webjars/bootstrap/4.0.0-beta.3<br/>                                 /css/bootstrap.min.css"</span><span>/&gt;<br/></span><span>    &lt;link </span><span>rel=</span><span>"stylesheet" </span><span>href=</span><span>"https://maxcdn.bootstrapcdn.com<br/>                            /font-awesome/4.7.0/css/font-awesome.min.css"</span><span>/&gt;<br/></span><span>    &lt;link </span><span>href=</span><span>"https://fastcdn.org/Buttons/2.0.0/css/buttons.css"<br/>     </span><span>rel=</span><span>"stylesheet"</span><span>&gt;<br/></span><span><br/></span><span>    </span><span>&lt;!-- Inclusion of external Javascript --&gt;<br/></span><span>    </span><span>&lt;script </span><span>src=</span><span>"/webjars/jquery/3.2.1/jquery.min.js"</span><span>&gt;&lt;/script&gt;<br/></span><span>    &lt;script </span><span>src=</span><span>"https://cdnjs.cloudflare.com/ajax/libs/popper.js<br/>                 /1.12.6/umd/popper.min.js"</span><span>&gt;&lt;/script&gt;<br/></span><span>    &lt;script </span><span>src=</span><span>"/webjars/bootstrap/4.0.0-beta.3/<br/>                js/bootstrap.min.js"</span><span>&gt;&lt;/script&gt;<br/></span><span>    &lt;script </span><span>src=</span><span>"https://fastcdn.org/Buttons/2.0.0/js/buttons.js"</span><span>&gt;&lt;/script&gt;<br/></span><span>    &lt;script </span><span>type=</span><span>"text/javascript" </span><span>src=</span><span>"https://maps.googleapis.com/<br/>                  maps/api/js?key={{API_KEY}}&amp;libraries=places"</span><span>&gt;<br/>    &lt;/script&gt;<br/></span></pre>
<p>Now, add our required internal stylesheet for the webpage:</p>
<pre><span>    </span><span>&lt;!-- Definition of internal styles --&gt;<br/></span><span>    </span><span>&lt;style&gt;<br/></span><span>      #map </span>{<br/>        <span>height</span>: <span>400</span><span>px</span><span>;<br/></span><span>      </span>}<br/><br/>      <span>#container-place-data </span>{<br/>        <span>height</span>: <span>0</span><span>;<br/></span><span>        </span><span>visibility</span>: <span>hidden</span><span>;<br/></span><span>      </span>}<br/><br/>      <span>#container-place-info </span>{<br/>        <span>font-size</span>: <span>14</span><span>px</span><span>;<br/></span><span>      </span>}<br/><br/>      <span>#container-selection-status </span>{<br/>        <span>visibility</span>: <span>hidden</span><span>;<br/></span><span>      </span>}<br/>    <span>&lt;/style&gt;<br/></span><span>  &lt;/head&gt;</span></pre>
<p>The next thing on our agenda is the creation of the necessary form for the input of review data. Continue the <kbd>create-review.html</kbd> template with the following code:&#160;</p>
<pre><span>&lt;body&gt;<br/></span><span>  &lt;div </span><span>th</span><span>:insert=</span><span>"fragments/navbar :: navbar"</span><span>&gt; </span><span>&lt;/div&gt;<br/></span><span>  &lt;div </span><span>class=</span><span>"container-fluid"</span><span>&gt;<br/></span><span>    &lt;div </span><span>class=</span><span>"row"</span><span>&gt;<br/></span><span>      &lt;div </span><span>class=</span><span>"col-sm-12 col-xs-12"</span><span>&gt;<br/></span><span>        </span><span>&lt;!-- Review form creation --&gt;<br/></span><span>        </span><span>&lt;form </span><span>class=</span><span>"form-group col-sm-12 form-vertical form-app" <br/></span><span>         id=</span><span>"form-login" </span><span>method=</span><span>"post" </span><span>th</span><span>:action=</span><span>"@{/reviews}"</span><span>&gt;<br/></span><span>          &lt;div </span><span>class=</span><span>"col-sm-12 mt-2 lead"</span><span>&gt;</span>Write your review<span>&lt;/div&gt;<br/></span><span>          &lt;div </span><span>th</span><span>:if=</span><span>"${error != null}" </span><span>class=</span><span>"text-danger" <br/></span><span>           th</span><span>:text=</span><span>"${error}"</span><span>&gt; &lt;/div&gt;<br/></span><span>          &lt;hr&gt;<br/></span><span>          &lt;input </span><span>class=</span><span>"form-control" </span><span>type=</span><span>"text" </span><span>name=</span><span>"title" <br/></span><span>           placeholder=</span><span>"Title" </span><span>th</span><span>:value=</span><span>"${title}" </span><span>required</span><span>/&gt;<br/></span><span>          &lt;textarea </span><span>class=</span><span>"form-control mt-4" </span><span>rows=</span><span>"13" </span><span>name=</span><span>"body" <br/></span><span>           placeholder=</span><span>"Review" </span><span>th</span><span>:value=</span><span>"${body}" </span><span>required</span><span>&gt;&lt;/textarea&gt;<br/></span><span>          &lt;div </span><span>class=</span><span>"form-group" </span><span>id=</span><span>"container-place-data"</span><span>&gt;<br/></span><span>            </span><span>&lt;!-- Input fields for location specific form data --&gt;<br/></span><span>            &lt;!-- Form input data for the fields below are <br/>             provided by the Google Places API --&gt;<br/></span><span>            </span><span>&lt;input </span><span>class=</span><span>"form-control" </span><span>id=</span><span>"place_address" <br/></span><span>             th</span><span>:value=</span><span>"${placeAddress}" </span><span>type=</span><span>"text" </span><span>name=</span><span>"placeAddress"<br/>             </span><span>required</span><span>/&gt;<br/></span><span>            &lt;input </span><span>class=</span><span>"form-control" </span><span>id=</span><span>"place_name" </span><span>type=</span><span>"text" <br/></span><span>             name=</span><span>"placeName" </span><span>th</span><span>:value=</span><span>"${placeName}" </span><span>required</span><span>/&gt;<br/></span><span>            &lt;input </span><span>class=</span><span>"form-control" </span><span>id=</span><span>"place_id" </span><span>type=</span><span>"text" <br/></span><span>             name=</span><span>"placeId" </span><span>th</span><span>:value=</span><span>"${placeId}" </span><span>required</span><span>/&gt;<br/></span><span>            &lt;input </span><span>id=</span><span>"location-lat" </span><span>type=</span><span>"number" </span><span>name=</span><span>"latitude" <br/></span><span>             step=</span><span>"any" </span><span>th</span><span>:value=</span><span>"${latitude}" </span><span>required</span><span>/&gt;<br/></span><span>            &lt;input </span><span>id=</span><span>"location-lng" </span><span>type=</span><span>"number" </span><span>name=</span><span>"longitude" <br/></span><span>             step=</span><span>"any" </span><span>th</span><span>:value=</span><span>"${longitude}" </span><span>required</span><span>/&gt;<br/></span><span>          &lt;/div&gt;<br/></span><span>          &lt;div </span><span>class=</span><span>"form-group mb-3"</span><span>&gt;<br/></span><span>            &lt;button </span><span>class=</span><span>"button button-pill" </span><span>type=</span><span>"button" <br/></span><span>             data-toggle=</span><span>"modal" </span><span>data-target=</span><span>"#mapModal"</span><span>&gt;<br/></span><span>              &lt;i </span><span>class=</span><span>"fa fa-map-marker" </span><span>aria-hidden=</span><span>"true"</span><span>&gt;&lt;/i&gt; <br/></span>              Select Location<br/>            <span>&lt;/button&gt;<br/></span><span>            &lt;button </span><span>class=</span><span>"button button-pill button-primary"</span><span>&gt;<br/></span>            Submit Review<span>&lt;/button&gt;<br/></span><span>            &lt;/div&gt;<br/></span><span>            &lt;div </span><span>class=</span><span>"text-success ml-2" </span><span>id=</span><span>"container-selection-status"</span><span>&gt;<br/></span>            Location selected<span>&lt;/div&gt;<br/></span><span>          &lt;/form&gt;<br/></span><span>        &lt;/div&gt;<br/></span><span>      &lt;/div&gt;</span></pre>
<p>Now, let us add a modal that will enable the user to select the review location from a map. Do not worry too much about the details of the selection process as of now. We shall talk more on it shortly:</p>
<pre><span>      </span><span>&lt;!-- Map Modal --&gt;<br/></span><span>      </span><span>&lt;div </span><span>class=</span><span>"modal fade" </span><span>id=</span><span>"mapModal"</span><span>&gt;<br/></span><span>        &lt;div </span><span>class=</span><span>"modal-dialog modal-lg" </span><span>role=</span><span>"document"</span><span>&gt;<br/></span><span>          &lt;div </span><span>class=</span><span>"modal-content"</span><span>&gt;<br/></span><span>            &lt;div </span><span>class=</span><span>"modal-header"</span><span>&gt;<br/></span><span>              &lt;h5 </span><span>class=</span><span>"modal-title"</span><span>&gt;</span>Select place to review<span>&lt;/h5&gt;<br/></span><span>              &lt;button </span><span>type=</span><span>"button" </span><span>class=</span><span>"close" </span><span>data-dismiss=</span><span>"modal"<br/>               </span><span>aria-label=</span><span>"Close"</span><span>&gt;<br/></span><span>                &lt;span </span><span>aria-hidden=</span><span>"true"</span><span>&gt;</span><span>&amp;times;</span><span>&lt;/span&gt;<br/></span><span>              &lt;/button&gt;<br/></span><span>            &lt;/div&gt;<br/></span><span>            &lt;div </span><span>class=</span><span>"modal-body"</span><span>&gt;<br/></span><span>              &lt;div </span><span>class=</span><span>"container-fluid"</span><span>&gt;<br/></span><span>                &lt;div </span><span>id=</span><span>"map"</span><span>&gt;</span><span> &lt;/div&gt;<br/></span><span>                  &lt;div </span><span>class=</span><span>"row mt-2" </span><span>id=</span><span>"container-place-info"</span><span>&gt;<br/></span><span>                    &lt;div </span><span>class=</span><span>"col-sm-12" </span><span>id=</span><span>"container-place-name"</span><span>&gt;<br/>                      &lt;b&gt;</span>Place Name:<span>&lt;/b&gt;<br/>                    &lt;/div&gt;<br/></span><span>                    &lt;div </span><span>class=</span><span>"col-sm-12" </span><span>id=</span><span>"container-place-address"</span><span>&gt;<br/>                      &lt;b&gt;</span>Place Address:<span>&lt;/b&gt;<br/>                    &lt;/div&gt;<br/></span><span>                  &lt;/div&gt;<br/></span><span>                &lt;/div&gt;<br/></span><span>              &lt;/div&gt;<br/></span><span>              &lt;div </span><span>class=</span><span>"modal-footer"</span><span>&gt;<br/></span><span>                &lt;button </span><span>type=</span><span>"button" </span><span>class=</span><span>"btn btn-primary" <br/></span><span>                 data-dismiss=</span><span>"modal"</span><span>&gt;</span>Done<span>&lt;/button&gt;<br/></span><span>              &lt;/div&gt;<br/></span><span>            &lt;/div&gt;<br/></span><span>          &lt;/div&gt;<br/></span><span>        &lt;/div&gt;<br/></span><span>      &lt;/div&gt;</span></pre>
<p>And lastly, we finish up the template by including its internal JavaScript, as shown in the code snippets that follow:&#160;</p>
<pre><span>      &lt;script&gt;<br/></span><span>        </span><span>// form field reference creation<br/></span><span>        </span><span>var </span>formattedAddressField = document<br/>                            .<span>getElementById</span>(<span>'place_address'</span>)<span>;<br/></span><span>        </span><span>var </span>placeNameField = document.<span>getElementById</span>(<span>'place_name'</span>)<span>;<br/></span><span>        </span><span>var </span>placeIdField = document.<span>getElementById</span>(<span>'place_id'</span>)<span>;<br/></span><span>        </span><span>var </span>latitudeField = document.<span>getElementById</span>(<span>'location-lat'</span>)<span>;<br/></span><span>        </span><span>var </span>longitudeField = document.<span>getElementById</span>(<span>'location-lng'</span>)<span>;<br/></span><span><br/></span><span>        </span><span>// container reference creation<br/></span><span>        </span><span>var </span>containerPlaceName = document.<span>getElementById<br/></span>                                 (<span>'container-place-name'</span>)<span>;<br/></span><span>        </span><span>var </span>containerPlaceAddress = document.<span>getElementById<br/></span>                                 (<span>'container-place-address'</span>)<span>;<br/></span><span>        </span><span>var </span>containerSelectionStatus = document.<span>getElementById<br/></span>                                 (<span>'container-selection-status'</span>)<span>;</span></pre>
<p class="mce-root">In the preceding code snippet, we created references to important DOM elements that exist on the page. These references include references to place specific input fields (the fields for the address, name, ID, and latitudinal and longitudinal coordinates of a place). In addition, we added references for the containers displaying the details of a selected place, such as the place name and place address. At this juncture, we will declare a few functions. These functions are <kbd>initialize()</kbd>, <kbd>getPlaceDetailsById()</kbd>, <kbd>updateViewData()</kbd>, <kbd>setFormValues()</kbd>, <kbd>showSelectionsStatusContainer()</kbd>, and <kbd>setContainerText()</kbd>.</p>
<p class="mce-root">Start by adding the <kbd>initialize()</kbd> and <kbd>getPlaceDetailsById()</kbd> functions shown here to the template:</p>
<pre><span>        //</span><span>invoked to initialize Google map</span><span><br/></span><span>        </span><span>function </span><span>initialize</span>() {<br/><br/>          navigator.geolocation.<span>getCurrentPosition</span>(<span>function</span>(location) {<br/>            <span>var </span>latitude = location.coords.latitude<span>;<br/></span><span>            </span><span>var </span>longitude = location.coords.longitude<span>;<br/></span><span><br/></span><span>            </span><span>var </span>center = <span>new </span>google.maps.LatLng(latitude<span>, </span>longitude)<span>;<br/></span><span><br/></span><span>            </span><span>var </span>map = <span>new </span>google.maps.Map(document.<span>getElementById</span>(<span>'map'</span>)<span>, </span>{<br/>              <span>center</span>: center<span>,<br/></span><span>              </span><span>zoom</span>: <span>15</span><span>,<br/></span><span>              </span><span>scrollwheel</span>: <span>false<br/></span><span>            </span>})<span>;<br/></span><span><br/></span><span>            </span><span>var </span>service = <span>new </span>google.maps.places.PlacesService(map)<span>;<br/></span><span><br/></span><span>            </span>map.<span>addListener</span>(<span>'click'</span><span>, </span><span>function</span>(data) {<br/>              <span>getPlaceDetailsById</span>(service<span>, </span>data.<span>placeId</span>)<span>;<br/></span><span>            </span>})<span>;<br/></span><span>          </span>})<span>;<br/></span><span><br/></span><span>        </span>}<br/><br/>       </pre>
<p><span>We have added the function below to enable us to get the details of a particular place from the Google Places API Invoked to retrieve the details of a place:</span></p>
<pre><span><br/></span><span>        </span><span>function </span><span>getPlaceDetailsById</span>(service<span>, </span>placeId) {<br/>          <span>var </span>request = {<br/>            <span>placeId</span>: placeId<br/>          }<span>;<br/></span><span><br/></span><span>          </span>service.getDetails(request<span>, </span><span>function </span>(place<span>, </span>status) {<br/>            <span>if </span>(status === google.maps.places.PlacesServiceStatus.OK) {<br/>              <span>updateViewData</span>(place)<br/>            }<br/>          })<span>;<br/></span><span>        </span>}</pre>
<p class="mce-root">Now, add <kbd>updateView()</kbd> and <kbd>setFormValues()</kbd> as shown here:</p>
<pre>        <span>//</span><span>Invoked to update view information</span><span><br/></span><span>        </span><span>function </span><span>updateViewData</span>(place) {<br/>          <span>setFormValues</span>(<br/>            place.formatted_address<span>,<br/></span><span>            </span>place.<span>name</span><span>,<br/></span><span>            </span>place.place_id<span>,<br/></span><span>            </span>place.geometry.location.lat()<span>,<br/></span><span>            </span>place.geometry.location.lng()<br/>          )<span>;<br/></span><span><br/></span><span>          </span><span>setContainerText</span>(<span>'&lt;b&gt;Place Name: &lt;/b&gt;' </span>+ place.<span>name</span><span>,<br/></span><span>            </span><span>'&lt;b&gt;Place Address: &lt;/b&gt;' </span>+ place.formatted_address)<span>;<br/></span><span><br/></span><span>          </span><span>showSelectionStatusContainer</span>()<span>;<br/></span><span>        </span>}    </pre>
<p><span>The function below is called to update view form data:</span></p>
<pre><span><br/></span><span>        </span><span>function </span><span>setFormValues</span>(formattedAddress<span>, </span>placeName<span>, </span>placeId<span>,<br/>                               </span>latitude<span>, </span>longitude) {<br/>          formattedAddressField.<span>value </span>= formattedAddress<span>;<br/></span><span>          </span>placeNameField.<span>value </span>= placeName<span>;<br/></span><span>          </span>placeIdField.<span>value </span>= placeId<span>;<br/></span><span>          </span>latitudeField.<span>value </span>= latitude<span>;<br/></span><span>          </span>longitudeField.<span>value </span>= longitude<span>;<br/></span><span>        </span>}</pre>
<p class="mce-root">Finally, finish up the template by adding the code shown here:</p>
<pre>        <span>function </span><span>showSelectionStatusContainer</span>() {<br/>          containerSelectionStatus.style.visibility = <span>'visible'<br/></span><span>        </span>}<br/><br/>        <span>function </span><span>setContainerText</span>(placeNameText<span>, </span>placeAddressText) {<br/>          containerPlaceName.innerHTML = placeNameText<span>;<br/></span><span>          </span>containerPlaceAddress.innerHTML = placeAddressText<span>;<br/></span><span>        </span>} <br/><br/>        <span>// Initializes map upon window load completion<br/></span><span>        </span>google.maps.event.addDomListener(window<span>, </span><span>'load'</span><span>, </span><span>initialize</span>)<span>;<br/></span><span>    &lt;/script&gt;<br/></span><span>  &lt;/body&gt;<br/></span><span>&lt;/html&gt;</span></pre>
<p>Similar to the previous template, we begin <kbd>create-review.html</kbd>&#160; with the addition of both external and internal CSS and JavaScript required by the template in the HTML <kbd>&lt;head&gt;</kbd> tag. Further into the template, we create a form that takes the following form data as its input:</p>
<ul>
<li style="font-weight: 400"><kbd>title</kbd>: A user defined title for the review being created.</li>
<li style="font-weight: 400"><kbd>body</kbd>: The body of the review. This is the main review text.</li>
<li style="font-weight: 400"><kbd>placeAddress</kbd>: The address of the place being reviewed.</li>
<li style="font-weight: 400"><kbd>placeName</kbd>: The name of the place being reviewed.</li>
<li style="font-weight: 400"><kbd>placeId</kbd>: The unique ID of the location being reviewed.</li>
<li style="font-weight: 400"><kbd>latitude</kbd>: The latitudinal coordinate of the reviewed location.</li>
<li style="font-weight: 400"><kbd>longitude</kbd>: The longitudinal coordinate of the reviewed location.</li>
</ul>
<p>There will be no need for the user to provide form input for <kbd>placeAddress</kbd>, <kbd>placeName</kbd>, <kbd>placeId</kbd>, <kbd>latitude</kbd>, and <kbd>longitude</kbd>. As such, we have hidden the parent <kbd>&lt;div&gt;</kbd> of the aforementioned input elements. We shall utilize the Google Places API to retrieve place-specific information. Make sure to note that in the template we are using a modal to display a map for location selection. The modal is toggled by a <kbd>button</kbd> we added in our template as follows:</p>
<pre>&lt;button class="button button-pill" type="button" data-toggle="modal" data-target="#mapModal"&gt;<br/>  &lt;i class="fa fa-map-marker" aria-hidden="true"&gt;&lt;/i&gt; Select Location<br/>&lt;/button&gt;</pre>
<p>Clicking on the button will display the map modal to the user. Upon rendering the map, a user can click on their desired review location from the map. Performing such a click action will trigger the map's click event, which in turn will be handled by the listener we defined in the template as follows:</p>
<pre>map.addListener('click', function(data) {<br/>  getPlaceDetailsById(service, data.placeId);<br/>});</pre>
<p><kbd>getPlacesDetailsById()</kbd> takes two arguments: an instance of <kbd>google.maps.places.PlacesService</kbd> and the ID of the place whose information is to be retrieved. The <kbd>PlacesService</kbd> instance is then used to retrieve the information of the place. After this information retrieval, the view is duly updated with the information retrieved: place-specific form data is set, the place name and address container within the map modal is updated, and a message indicating that a location has successfully been selected is shown to the user. Upon selection of a location and the input of all required form data, the user can then submit their review.</p>
<p class="mce-root">We are almost ready to try out the review creation page. Before we do, we must create a review validator, as well as a controller action that handles <kbd>POST</kbd> requests sent to the <kbd>/reviews</kbd> path. Let's start with <kbd>ReviewValidator</kbd>. Add the <kbd>ReviewValidator</kbd> class shown here to <kbd>com.example.placereviewer.component</kbd>:</p>
<pre><span>package </span>com.example.placereviewer.component<br/><br/><span>import </span>com.example.placereviewer.data.model.Review<br/><span>import </span>org.springframework.stereotype.<span>Component<br/></span><span>import </span>org.springframework.validation.Errors<br/><span>import </span>org.springframework.validation.ValidationUtils<br/><span>import </span>org.springframework.validation.Validator<br/><span><br/></span><span>@Component<br/></span><span>class </span>ReviewValidator: Validator {<br/><br/>  <span>override fun </span><span>supports</span>(aClass: Class&lt;*&gt;?): Boolean {<br/>    <span>return </span>Review::<span>class </span>== aClass<br/>  }<br/><br/>  <span>override fun </span><span>validate</span>(obj: Any?<span>, </span>errors: Errors) {<br/>    <span>val </span>review = obj <span>as </span>Review<br/><br/>    ValidationUtils.rejectIfEmptyOrWhitespace(errors<span>, </span><span>"title"</span><span>,<br/>                         </span><span>"Empty.reviewForm.title"</span><span>, </span><span>"Title cannot be empty"</span>)<br/>    ValidationUtils.rejectIfEmptyOrWhitespace(errors<span>, </span><span>"body"</span><span>, <br/></span><span>                         "Empty.reviewForm.body"</span><span>,</span><span> </span><span>"Body cannot be empty"</span>)<br/>    ValidationUtils.rejectIfEmptyOrWhitespace(errors<span>, </span><span>"placeName"</span><span>,<br/>                         </span><span>"Empty.reviewForm.placeName"</span>)<br/>    ValidationUtils.rejectIfEmptyOrWhitespace(errors<span>, </span><span>"placeAddress"</span><span>, <br/></span><span>                         "Empty.reviewForm.placeAddress"</span>)<br/>    ValidationUtils.rejectIfEmptyOrWhitespace(errors<span>, </span><span>"placeId"</span><span>,<br/>                         </span><span>"Empty.reviewForm.placeId"</span>)<br/>    ValidationUtils.rejectIfEmptyOrWhitespace(errors<span>, </span><span>"latitude"</span><span>, <br/></span><span>                         "Empty.reviewForm.latitude"</span>)<br/>    ValidationUtils.rejectIfEmptyOrWhitespace(errors<span>, </span><span>"longitude"</span><span>,<br/>                         </span><span>"Empty.reviewForm.longitude"</span>)<br/><br/>    <span>if </span>(review.<span>title</span>.<span>length </span>&lt; <span>5</span>) {<br/>      errors.rejectValue(<span>"title"</span><span>, </span><span>"Length.reviewForm.title"</span><span>,<br/></span><span>                         </span><span>"Title must be at least 5 characters long"</span>)<br/>    }<br/><br/>    <span>if </span>(review.<span>body</span>.<span>length </span>&lt; <span>5</span>) {<br/>      errors.rejectValue(<span>"body"</span><span>, </span><span>"Length.reviewForm.body"</span><span>,<br/></span><span>                         </span><span>"Body must be at least 5 characters long"</span>)<br/>    }<br/>  }<br/>}</pre>
<p>As we have previously explained the workings of custom validators, there is little need to explain how this validator works. Without taking time, let us implement a controller class for HTTP requests pertaining to reviews. Create a <kbd>ReviewController</kbd> class in <kbd>com.example.placereviewer.controller</kbd> and add the following code to it:</p>
<pre><span>package </span>com.example.placereviewer.controller<br/><br/><span>import </span>com.example.placereviewer.component.ReviewValidator<br/><span>import </span>com.example.placereviewer.data.model.Review<br/><span>import </span>com.example.placereviewer.service.ReviewService<br/><span>import </span>org.springframework.stereotype.<span>Controller<br/></span><span>import </span>org.springframework.ui.Model<br/><span>import </span>org.springframework.validation.BindingResult<br/><span>import </span>org.springframework.web.bind.annotation.<span>ModelAttribute<br/></span><span>import </span>org.springframework.web.bind.annotation.<span>PostMapping<br/></span><span>import </span>org.springframework.web.bind.annotation.<span>RequestMapping<br/></span><span>import </span>javax.servlet.http.HttpServletRequest<br/><br/><span>@Controller<br/></span><span>@RequestMapping</span>(<span>"/reviews"</span>)<br/><span>class </span>ReviewController(<span>val </span><span>reviewValidator</span>: ReviewValidator<span>, <br/>                       val </span><span>reviewService</span>: ReviewService) {<br/><br/>  <span>@PostMapping<br/></span><span>  fun </span><span>create</span>(<span>@ModelAttribute </span>reviewForm: Review<span>, </span>bindingResult: BindingResult<span>,<br/>             </span>model: Model<span>, </span>request: HttpServletRequest): String {<br/>    <span>reviewValidator</span>.validate(reviewForm<span>, </span>bindingResult)<br/><br/>    <span>if </span>(!bindingResult.hasErrors()) {<br/>      <span>val </span>res = <span>reviewService</span>.createReview(request.<span>userPrincipal</span>.<span>name</span><span>,<br/>                                            </span>reviewForm)<br/><br/>      <span>if </span>(res) {<br/>        <span>return </span><span>"redirect:/home"<br/></span><span>      </span>}<br/>    }<br/><br/>    <span>with </span>(model) <span>{<br/></span><span>      </span>addAttribute(<span>"error"</span><span>, </span>bindingResult.<span>allErrors</span>.<span>first</span>().<span>defaultMessage</span>)<br/>      addAttribute(<span>"title"</span><span>, </span>reviewForm.<span>title</span>)<br/>      addAttribute(<span>"body"</span><span>, </span>reviewForm.<span>body</span>)<br/>      addAttribute(<span>"placeName"</span><span>, </span>reviewForm.<span>placeName</span>)<br/>      addAttribute(<span>"placeAddress"</span><span>, </span>reviewForm.<span>placeAddress</span>)<br/>      addAttribute(<span>"placeId"</span><span>, </span>reviewForm.<span>placeId</span>)<br/>      addAttribute(<span>"longitude"</span><span>, </span>reviewForm.<span>longitude</span>)<br/>      addAttribute(<span>"latitude"</span><span>, </span>reviewForm.<span>latitude</span>)<br/>    <span>}<br/></span><span><br/></span><span>    </span><span>return </span><span>"create-review"<br/></span><span>  </span>}<br/>}</pre>
<p>Having added the&#160;<kbd>ReviewValidator</kbd> and <kbd>ReviewController</kbd> classes, build and run the project, log in as a user, and navigate to <kbd>http://localhost:5000/create-review</kbd> from your favorite browser.</p>
<p>Upon page load, you will be presented with a form you can use to add a new review:</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/328b5242-6ab0-492f-8e79-0c31b07afb00.jpg" style="width:34.83em;height:23.50em;"/></div>
<p>Users are required to select a review location before a review can be submitted. To select a review location, click the <span class="packt_screen">Select Location</span>&#160;button:</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/e4f022ca-b8fd-47f7-898a-08634042614d.jpg"/></div>
<p>Clicking the <span class="packt_screen">Select Location</span>&#160;button will present the user with a modal containing a map from which they can select a location of choice to review. Clicking on a location from the map will bring up an information window on the map containing data pertaining to the clicked location. In addition, the modal container for holding the selected place name and address will be updated:</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/48c3b312-dc65-4fac-9835-9e30d0568600.jpg"/></div>
<p>After a user selects their review location of choice, they can close the modal by clicking <span class="packt_screen">Done</span>&#160;and proceed to filling in the title and body of their review:</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/dcfa41a3-f9e3-46e4-a4a9-694dce9e6357.jpg" style="width:42.83em;height:24.25em;"/></div>
<p>Notice that the review form now indicates that a review location has been selected successfully. Once the user fills in all the necessary review information, they can proceed to submit the review by clicking <span class="packt_screen">Submit Review</span>:</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/d48c136d-3edb-43f0-b341-e547064d7ac9.jpg"/></div>
<p>After review submission, the user is redirected to their home page, from which they can now see the review submitted. Clicking on the <span class="packt_screen">View location</span>&#160;button of any review displayed on the home page will render a modal containing a map displaying the exact location reviewed:</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/fb72bff1-204f-4192-86ef-4479b26c4fa5.jpg"/></div>
<p>The map displayed to the user possesses a marker indicating the exact location reviewed by the reviewer.</p>
<p>At this stage, we have concluded all the core functionality of the <em>Place Reviewer</em> application. Before we wrap up this chapter, let us explore how to test Spring applications.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Spring application testing</h1>
                </header>
            
            <article>
                
<p>Earlier on in this book, we discussed application testing and why it is necessary in creating reliable software. We must now explore the process of testing Spring applications. A Spring application can be tested in four easy steps:</p>
<ol>
<li style="font-weight: 400">Add necessary testing dependencies to the project</li>
<li style="font-weight: 400">Create a configuration class</li>
<li style="font-weight: 400">Configure test class to use custom configuration</li>
<li style="font-weight: 400">Write required tests</li>
</ol>
<p class="mce-root">We shall look at each of these steps one by one.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Adding necessary testing dependencies to the project</h1>
                </header>
            
            <article>
                
<p>This involves the inclusion of suitable testing dependencies in your project. Open the <kbd>Place Reviewer</kbd> project's <kbd>pom.xml</kbd> file and add the following dependencies:</p>
<pre><span>&lt;dependency&gt;<br/></span><span>  &lt;groupId&gt;</span>junit<span>&lt;/groupId&gt;<br/></span><span>  &lt;artifactId&gt;</span>junit<span>&lt;/artifactId&gt;<br/></span><span>  &lt;version&gt;</span>4.12<span>&lt;/version&gt;<br/></span><span>  &lt;scope&gt;</span>test<span>&lt;/scope&gt;<br/></span><span>  &lt;exclusions&gt;<br/></span><span>    &lt;exclusion&gt;<br/></span><span>      &lt;groupId&gt;</span>org.hamcrest<span>&lt;/groupId&gt;<br/></span><span>      &lt;artifactId&gt;</span>hamcrest-core<span>&lt;/artifactId&gt;<br/></span><span>    &lt;/exclusion&gt;<br/></span><span>  &lt;/exclusions&gt;<br/></span><span>&lt;/dependency&gt;<br/></span><span>&lt;dependency&gt;<br/></span><span>  &lt;groupId&gt;</span>org.hamcrest<span>&lt;/groupId&gt;<br/></span><span>  &lt;artifactId&gt;</span>hamcrest-library<span>&lt;/artifactId&gt;<br/></span><span>  &lt;version&gt;</span>1.3<span>&lt;/version&gt;<br/></span><span>  &lt;scope&gt;</span>test<span>&lt;/scope&gt;<br/></span><span>&lt;/dependency&gt;</span></pre>
<p>In the coming sections, we are going to learn how to write tests with jUnit and Hamcrest. JUnit is a testing framework for the Java programming language and Hamcrest is a library that provides matchers, which can be combined to create meaningful expressions of intent.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Creating a configuration class</h1>
                </header>
            
            <article>
                
<p>The creation of a test configuration class aids the proper running of written tests.&#160;Within the <kbd>src/test/kotlin</kbd> directory of the <kbd>Place Reviewer</kbd> project, add a <kbd>config</kbd> package to <kbd>com.example.placereviewer</kbd>. Add the <kbd>TestConfig</kbd> class shown here to the package created:</p>
<pre><span>package </span>com.example.placereviewer.config<br/><br/><span>import </span>org.springframework.context.annotation.<span>ComponentScan<br/></span><span>import </span>org.springframework.context.annotation.<span>Configuration<br/></span><span><br/></span><span>@Configuration<br/></span><span>@ComponentScan</span>(<span>basePackages = </span>[<span>"com.example.placereviewer"</span>])<br/><span>class </span>TestConfig</pre>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Configuring a test class to use custom configuration</h1>
                </header>
            
            <article>
                
<p>To do this, open the Spring application's test class and use an <kbd>@ContextConfiguration</kbd> annotation to specify the configuration classes to be used by the test class. Open <kbd>PlaceReviewerApplicationTests.kt</kbd> (located in the <kbd>com.example.placereviewer</kbd> package of your project's <kbd>src/test/kotlin</kbd> directory). Now, set its configuration class as follows:</p>
<pre>package com.example.placereviewer<br/><br/>import com.example.placereviewer.config.TestConfig<br/>import org.junit.runner.RunWith<br/>import org.springframework.boot.test.context.SpringBootTest<br/>import org.springframework.test.context.ContextConfiguration<br/>import org.springframework.test.context.junit4.SpringRunner<br/><br/>@RunWith(SpringRunner::class)<br/>@SpringBootTest<br/>@ContextConfiguration(classes = [TestConfig::class])<br/>class PlaceReviewerApplicationTests</pre>
<p>Great work! You are now ready to write some application tests.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Writing your first test</h1>
                </header>
            
            <article>
                
<p>Writing code for application tests is like writing code for any other part of a Spring application. You can make use of components and services as you would in any other part of your application. Let us demonstrate this, shall we?</p>
<p>Add the following <kbd>TestUserService</kbd> interface to <kbd>com.example.placereviewer.service</kbd>:</p>
<pre><span>package </span>com.example.placereviewer.service<br/><br/><span>import </span>com.example.placereviewer.data.model.User<br/><span><br/></span><span>interface </span>TestUserService {<br/>  <span>fun </span><span>getUser</span>(): User<br/>}</pre>
<p>Now, add the following&#160;<kbd>TestUserServiceImpl</kbd> class to the package:</p>
<pre><span>package </span>com.example.placereviewer.service<br/><br/><span>import </span>com.example.placereviewer.data.model.User<br/><span>import </span>org.springframework.stereotype.<span>Service<br/></span><span><br/></span><span>@Service<br/></span><span>internal class </span>TestUserServiceImpl : TestUserService {<br/><br/>  <span>//</span><span>Test stub mimicking user retrieval</span><span><br/></span><span>  </span><span>override fun </span><span>getUser</span>(): User {<br/>    <span>return </span>User(<br/>      <span>"user@gmaiil.com"</span><span>,<br/></span><span>      </span><span>"test.user"</span><span>,<br/></span><span>      </span><span>"password"<br/></span>    )<br/>  }<br/>}</pre>
<p>Return to the <kbd>PlaceReviewerApplicationTests.kt</kbd> file and modify it to reflect these changes:</p>
<pre><span>package </span>com.example.placereviewer<br/><br/><span>import </span>com.example.placereviewer.config.TestConfig<br/><span>import </span>com.example.placereviewer.data.model.User<br/><span>import </span>com.example.placereviewer.service.TestUserService<br/><span>import </span>org.hamcrest.Matchers.instanceOf<br/><span>import </span>org.hamcrest.MatcherAssert.assertThat<br/><span>import </span>org.junit.<span>Test<br/></span><span>import </span>org.junit.runner.<span>RunWith<br/></span><span>import </span>org.springframework.beans.factory.annotation.<span>Autowired<br/></span><span>import </span>org.springframework.boot.test.context.<span>SpringBootTest<br/></span><span>import </span>org.springframework.test.context.<span>ContextConfiguration<br/></span><span>import </span>org.springframework.test.context.junit4.SpringRunner<br/><br/><span>@RunWith</span>(SpringRunner::<span>class</span>)<br/><span>@SpringBootTest<br/></span><span>@ContextConfiguration</span>(<span>classes = </span>[TestConfig::<span>class</span>])<br/><span>class </span>PlaceReviewerApplicationTests {<br/><br/>  <span>@Autowired<br/></span><span>  lateinit var </span><span>userService</span>: TestUserService<br/><br/>  <span>@Test<br/></span><span>  fun </span><span>testUserRetrieval</span>() {<br/>    <span>val </span>user = <span>userService</span>.getUser()<br/><br/>    assertThat(user<span>, </span>instanceOf(User::<span>class</span>.<span>java</span>))<br/>  }<br/>}</pre>
<p>The <kbd>testUserRetrieval()</kbd>&#160;<span>method</span><span>&#160;</span><span>is a test that, when run, makes use of the stub method we defined in</span> <kbd>TestUserServiceImpl</kbd> <span>to retrieve a user and asserts that the object returned by the function is an instance of the <kbd>User</kbd> class.</span></p>
<p>To run a written test, click the <span class="packt_screen">Run Test</span> button to the right of the created test in the IDE window:</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/b744466f-c30b-404f-a000-949e4d533bf3.jpg" style="width:40.83em;height:35.08em;"/></div>
<p><kbd>testUserRetrieval</kbd> will be run and the result of the test run will be displayed at the bottom of the IDE window:</p>
<div class="CDPAlignCenter CDPAlign"><img src="images/cbd3c160-eb73-4507-bc4a-78e68630162a.jpg"/></div>
<p>In this case, the test we wrote passed. That's a great thing. However, as you develop larger and more complex applications and write tests for application modules, you will discover that more often than not, written tests fail. When this happens, do not fret; simply stay calm and debug your application. As time passes, you will learn to create more reliable software.</p>


            </article>

            
        </section>
    </div>


  <div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we wrapped up our journey through Kotlin by finishing up the <em>Place Reviewer</em> application. In the process, we explored—in depth—the creation of view layers for Spring MVC-based applications. Furthermore, we learned how to integrate an application with Google Places API Web Services with the goal of making an application location-aware.</p>
<p>In addition, we learned about form input validation with the help of <kbd>Validator</kbd> classes and <kbd>BindingResult</kbd>. Finally, we covered how to configure for testing and write tests for Spring-based applications.</p>


            </article>

            
        </section>
    </div>
</body>
</html>