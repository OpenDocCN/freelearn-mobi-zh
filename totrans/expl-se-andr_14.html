<html><head></head><body><div class="appendix" title="Appendix&#xA0;A.&#xA0;The Development Environment"><div class="titlepage"><div><div><h1 class="title"><a id="appA"/>Appendix A. The Development Environment</h1></div></div></div><p>In order to build the Android 4.3 sources provided by UDOO, you need an Ubuntu Linux system with Oracle Java 6. While it may be possible to use a variant of this setup, Google's standard target development platform for Android 4.3 is Ubuntu 12.04. Therefore, we will use this setup to ensure the highest probability of success in our exploration of Linux, SE Linux, Android, the UDOO, and SE for Android.</p><p>In this appendix, we will do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Download <a id="id444" class="indexterm"/>and install Ubuntu 12.04 using a <span class="strong"><strong>virtual machine</strong></span> (<span class="strong"><strong>VM</strong></span>)</li><li class="listitem" style="list-style-type: disc">Enhance our VM's performance by installing the VirtualBox Extension Pack and VirtualBox Guest Additions</li><li class="listitem" style="list-style-type: disc">Set up a development environment appropriate for building the Linux kernel and UDOO sources</li><li class="listitem" style="list-style-type: disc">Install Oracle Java 6</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip12"/>Tip</h3><p>If you already use Ubuntu Linux 12.04, you can skip to the <span class="emphasis"><em>The Build Environment</em></span> section. If you intend to install Ubuntu natively (not in a VM), you should skip to the <span class="emphasis"><em>Ubuntu Linux 12.04</em></span> section and follow those directions, ignoring the VirtualBox steps.</p></div></div><div class="section" title="VirtualBox"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec78"/>VirtualBox</h1></div></div></div><p>There are <a id="id445" class="indexterm"/>a number of virtualization products available for running guest operating systems, such as Ubuntu Linux, but for this setup we will use <span class="strong"><strong>VirtualBox</strong></span>. VirtualBox is a widely used open source virtualization system available for Mac, Linux, Solaris, and Windows hosts (among others). It supports a variety of guest operating systems. VirtualBox also allows the use of hardware virtualization of many modern/common processor families to increase performance by providing each virtual machine its own private address space.</p><p>The VirtualBox documentation has excellent installation instructions for various platforms, and <a id="id446" class="indexterm"/>we recommend referring to these for your host platform. You can find information about installing and running VirtualBox for your host operating system at <a class="ulink" href="http://www.virtualbox.org/manual/ch02.html">http://www.virtualbox.org/manual/ch02.html</a>.</p></div></div>
<div class="section" title="Ubuntu Linux 12.04 (precise pangolin)"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec79"/>Ubuntu Linux 12.04 (precise pangolin)</h1></div></div></div><p>To install <a id="id447" class="indexterm"/>Ubuntu Linux 12.04, you will first need to download <a id="id448" class="indexterm"/>an appropriate distribution image. These can be found at <a class="ulink" href="http://releases.ubuntu.com/12.04/">http://releases.ubuntu.com/12.04/</a>. While there are a number of acceptable images there, we will install the 64-bit desktop version of the distribution—<a class="ulink" href="http://releases.ubuntu.com/12.04/ubuntu-12.04.5-desktop-amd64.iso">http://releases.ubuntu.com/12.04/ubuntu-12.04.5-desktop-amd64.iso</a>. The host machine we're using in this example is a 64-bit Macbook Pro running OS X 10.9.2, so we're targeting a 64-bit guest as well. If you have a 32-bit machine, the basic mechanics of what we cover will be the same; only a few details will be different, so we will leave those for you to discover and resolve.</p><p>Launch VirtualBox on your host, wait for the <span class="strong"><strong>VM Manager</strong></span> window to appear, and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on <span class="strong"><strong>New</strong></span>.</li><li class="listitem">For the <span class="strong"><strong>Name</strong></span> and <span class="strong"><strong>Operating System</strong></span> settings, make the following selections:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Name</strong></span>: <span class="strong"><strong>SE for Android Book</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Type</strong></span>: <span class="strong"><strong>Linux</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Version</strong></span>: <span class="strong"><strong>Ubuntu (64 bit)</strong></span></li></ul></div></li><li class="listitem">Set <span class="strong"><strong>Memory Size</strong></span> to a value to at least <code class="literal">16</code> GB. Anything lower than this will lead to unsuccessful builds.</li><li class="listitem">To set up the hard drive, select <span class="strong"><strong>Create a virtual hard drive now</strong></span>. Set this value to at least <code class="literal">80</code> GB.</li><li class="listitem">Choose the <span class="strong"><strong>Hard Drive File Type</strong></span>, <span class="strong"><strong>VDI (VirtualBox Disk Image)</strong></span>.</li><li class="listitem">Ensure storage on the physical hard drive is set to <span class="strong"><strong>dynamically allocated</strong></span>.</li><li class="listitem">When prompted for <span class="strong"><strong>file location and size</strong></span>, name the new virtual hard drive <span class="strong"><strong>SE for Android Book</strong></span>, and set its size to 80 GB.</li></ol></div><p>Ensure the <span class="strong"><strong>SE for Android Book</strong></span> VM is selected in the left pane. Click on the green Start arrow to perform an initial launch of the VM. A dialog will appear, asking you to select a virtual optical disk file. Click on the small folder icon and locate the <code class="literal">ubuntu-12.04.5-desktop-amd64.iso</code> CD image you downloaded earlier. Then click on <span class="strong"><strong>Start</strong></span>.</p><p>When the <a id="id449" class="indexterm"/>screen turns black and shows a keyboard image at the bottom center of the VM window, press any key to begin the Ubuntu installation. As soon as you do this, the language selection screen will appear. Choose whichever language is most appropriate for you, but for this example, we'll select <span class="strong"><strong>English</strong></span>. Then select <span class="strong"><strong>Install Ubuntu</strong></span>.</p><p>Sometimes, you may see an unusual-looking error printed across your VM window—something like <span class="strong"><strong>SMBus base address uninitialized</strong></span>. This message is shown because VirtualBox doesn't support a particular kernel module that is loaded by default with Ubuntu 12.04. However, this will not cause any difficulty and is only a cosmetic annoyance. After a few moments, a nice GUI installation screen will appear, waiting for you to choose a language again. We'll choose <span class="strong"><strong>English</strong></span> again.</p><p>On the following <span class="strong"><strong>Preparing to install Ubuntu</strong></span> screen, three checklist items are shown. You should have already satisfied the first item, since your virtual drive is much larger than the minimum requirement for Ubuntu. To satisfy the others, ensure your host system is plugged in with a power supply and has an established network connection. Although this is entirely unnecessary for our purposes here, we almost always mark the <span class="strong"><strong>Download updates while installing</strong></span> and <span class="strong"><strong>Install this third-party software</strong></span> boxes before continuing.</p><p>On the <span class="strong"><strong>Installation type</strong></span> screen, we'll take the easy path and select <span class="strong"><strong>Erase disk and install Ubuntu</strong></span>. Keep in mind that this will only erase the disk of your VM's virtual hard drive and leaves your host system intact. On the <span class="strong"><strong>Erase disk and install Ubuntu</strong></span> screen, your virtual hard drive should already be selected, so you only need to click <span class="strong"><strong>Install Now</strong></span>.</p><p>From this point forward in the Ubuntu installation, two separate tasks will happen simultaneously: in a background thread, the installer will prepare the virtual drive for the installation of the base system; secondly, you will configure some basic aspects of your new system. But first, you will have to identify your time zone by clicking on the appropriate point on the world map before continuing. Then identify your keyboard layout and continue.</p><p>Set up your first user account. In this case, it will be the account we used to do the work in this book, so we will enter the following information:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Your Name</strong></span>: <span class="strong"><strong>Book User</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Your computer's name</strong></span>: <span class="strong"><strong>SE-for-Android</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Pick a username</strong></span>: <span class="strong"><strong>bookuser</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Password fields</strong></span>: (whatever you prefer)</li></ul></div><p>We will <a id="id450" class="indexterm"/>also select <span class="strong"><strong>Log in automatically</strong></span>. While we would not normally do this for security reasons, we will do it in our local VM for convenience; but you may protect this account in whichever way you prefer.</p><p>Once the Ubuntu installation is complete, a dialog asking you to restart the computer will appear. Click the <span class="strong"><strong>Restart now</strong></span> button, and after a few moments, a terminal prompt will inform you to remove all installation media and press <span class="emphasis"><em>Enter</em></span>. To remove the virtual installation CD, go to <span class="strong"><strong>Devices</strong></span> | <span class="strong"><strong>CD/DVD Devices</strong></span> | <span class="strong"><strong>Remove disk from virtual drive</strong></span> using the VirtualBox menu bar. Then press <span class="emphasis"><em>Enter</em></span> to restart the VM, but interrupt the boot process by closing the VM window. It will ask you if you want to power off the machine. Just click <span class="strong"><strong>OK</strong></span>.</p></div>
<div class="section" title="VirtualBox extension pack and guest additions"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec80"/>VirtualBox extension pack and guest additions</h1></div></div></div><p>To get the best performance from your guest Ubuntu VM and access to the virtual USB devices necessary for working with the UDOO, you will need to install the VirtualBox extension pack and guest additions.</p><div class="section" title="VirtualBox extension pack"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec79"/>VirtualBox extension pack</h2></div></div></div><p>Download <a id="id451" class="indexterm"/>the extension pack from the VirtualBox website, at <a class="ulink" href="http://www.virtualbox.org/wiki/Downloads">http://www.virtualbox.org/wiki/Downloads</a>. There will be a download link there intended for <span class="strong"><strong>All supported platforms</strong></span>. Once this file is downloaded, you'll need to install it. This process is different for each type of host system, but it is very straightforward. For Linux and Mac OS X hosts, simply double-clicking on the downloaded extension pack file will do the trick. For Windows systems, you will need to run the installer you've downloaded.</p></div><div class="section" title="VirtualBox guest additions"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lvl2sec80"/>VirtualBox guest additions</h2></div></div></div><p>Once you've <a id="id452" class="indexterm"/>completed the installation of the extension pack, boot your Ubuntu Linux 12.04 VM from VirtualBox by selecting the VM from the left pane and clicking on <span class="strong"><strong>Start</strong></span> in the toolbar. Once your Ubuntu desktop is active, you'll notice it does not fit into your VM window. Resize the VM window to make it larger, and the VM screen will remain the same size. This, among other performance issues, will be resolved by installing the VirtualBox guest additions. You may also see a window open on your virtual desktop indicating a new version of Ubuntu is available. Do not upgrade; just close that window.</p><p>Using the VirtualBox menu bar, go to <span class="strong"><strong>Devices</strong></span> | <span class="strong"><strong>Insert Guest Additions CD Image…</strong></span>. Shortly afterward, a dialog will appear, asking whether you want to run the software on the new media you just inserted. Click the <span class="strong"><strong>Run</strong></span> button. You will then need to authenticate <a id="id453" class="indexterm"/>your user by entering your user's password (which you entered during setup). Once the user is authenticated, a script will automatically build and update several kernel modules. Once the script completes, reboot the VM by clicking on the gear in the top-right corner of the screen, selecting <span class="strong"><strong>Shutdown…</strong></span>, and clicking on <span class="strong"><strong>Restart</strong></span> in the dialog that follows.</p><p>When the VM reboots, the first thing you should notice is that the VM screen now fits into the VM window. Moreover, if you resize the VM window, the VM screen resizes with it. This is the simplest way to determine you've successfully installed the VirtualBox guest additions.</p></div></div>
<div class="section" title="Save time with shared folders"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec81"/>Save time with shared folders</h1></div></div></div><p>Another<a id="id454" class="indexterm"/> thing you can do to boost your aggregate performance while developing images for the UDOO is to set up shared folders between your host system and your Ubuntu Linux guest system. In this way, once you've built a new SD card image for the UDOO, you can make the image directly available to the host through the shared folder. The host can then execute the long-running commands to flash the SD card without adding time to the process by slowing down access to your host's card reader through the virtualization layer. In the case of the system we're using to write this book, there is a savings of around 10 minutes per image flashed.</p><p>To set up a shared folder, you must begin with the VirtualBox Manager open and your Ubuntu VM powered off. Click the <span class="strong"><strong>Settings</strong></span> toolbar icon. Then select the <span class="strong"><strong>Shared Folders</strong></span> tab of the <span class="strong"><strong>Settings</strong></span> dialog that opens. Click the <span class="strong"><strong>Add Shared Folder</strong></span> icon to the right. Enter <span class="strong"><strong>Folder Path</strong></span> to a folder on your host that you want to share. In our case, we created a new folder called <code class="literal">vbox_share </code>to share with our VM guest. VirtualBox will generate <span class="strong"><strong>Folder Name</strong></span>, but make sure you select <span class="strong"><strong>Auto-mount</strong></span> before clicking <span class="strong"><strong>OK</strong></span>. When you boot your Ubuntu VM from now on, the shared folder will be accessible in your guest VM as <code class="literal">/media/sf_&lt;folder_name&gt;</code>. However, if you attempt to list the files in that directory from your guest, you will likely be denied. To gain full access to this folder (as in read-and-write access) for our <code class="literal">bookuser</code>, we'll need to add that UID to the <code class="literal">vboxsf</code> group:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo usermod -a -G vboxsf bookuser</strong></span>
</pre></div><p>Log out and log in to your guest again or restart the guest VM to complete the process.</p></div>
<div class="section" title="The build environment"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec82"/>The build environment</h1></div></div></div><p>To prepare<a id="id455" class="indexterm"/> our system to build the Linux kernel, Android, and Android applications, we need to install and set up some key pieces of software. Click the Ubuntu dashboard icon at the top of the launch bar on the left of your screen. In the search bar that appears, type <code class="literal">term</code> and press <span class="emphasis"><em>Enter</em></span>. A terminal window will open. Then execute the following commands:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo apt-get update</strong></span>
<span class="strong"><strong>$ sudo apt-get install apt-file git-core gnupg flex bison gperf build-essential zip curl zlib1g-dev libc6-dev lib32ncurses5-dev ia32-libs x11proto-core-dev libx11-dev ia32-libs dialog liblzo2-dev libxml2-utils minicom</strong></span>
</pre></div><p>Type <code class="literal">y</code> and press <span class="emphasis"><em>Enter</em></span> when asked whether you want to continue.</p></div>
<div class="section" title="Oracle Java 6"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec83"/>Oracle Java 6</h1></div></div></div><p>Download the<a id="id456" class="indexterm"/> most recent Java 6 SE Development Kit (version 6u45) from<a id="id457" class="indexterm"/> the Oracle Java archive website, at <a class="ulink" href="http://www.oracle.com/technetwork/java/javase/archive-139210.html">http://www.oracle.com/technetwork/java/javase/archive-139210.html</a>. You'll need the <code class="literal">jdk-6u45-linux-x64.bin</code> version to satisfy Google's target development environment. Once it is downloaded, execute the following commands to install the Java 6 JDK:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ chmod a+x jdk-6u45-linux-x64.bin</strong></span>
<span class="strong"><strong>$ sudo mkdir -p /usr/lib/jvm</strong></span>
<span class="strong"><strong>$ sudo mv jdk-6u45-linux-x64.bin /usr/lib/jvm/</strong></span>
<span class="strong"><strong>$ cd /usr/lib/jvm/</strong></span>
<span class="strong"><strong>$ sudo ./jdk-6u45-linux-x64.bin</strong></span>
<span class="strong"><strong>$ sudo update-alternatives --install "/usr/bin/java" "java" "/usr/lib/jvm/jdk1.6.0_45/bin/java" 1</strong></span>
<span class="strong"><strong>$ sudo update-alternatives --install "/usr/bin/jar" "jar" "/usr/lib/jvm/jdk1.6.0_45/bin/jar" 1</strong></span>
<span class="strong"><strong>$ sudo update-alternatives --install "/usr/bin/javac" "javac" "/usr/lib/jvm/jdk1.6.0_45/bin/javac" 1</strong></span>
<span class="strong"><strong>$ sudo update-alternatives --install "/usr/bin/javaws" "javaws" "/usr/lib/jvm/jdk1.6.0_45/bin/javaws" 1</strong></span>
<span class="strong"><strong>$ sudo update-alternatives --install "/usr/bin/jar" "jar" "/usr/lib/jvm/jdk1.6.0_35/bin/jar" 1</strong></span>
<span class="strong"><strong>$ sudo update-alternatives --install "/usr/bin/javadoc" "javadoc" "/usr/lib/jvm/jdk1.6.0_45/bin/javadoc" 1</strong></span>
<span class="strong"><strong>$ sudo update-alternatives --install "/usr/bin/jarsigner" "jarsigner" "/usr/lib/jvm/jdk1.6.0_45/bin/jarsigner" 1</strong></span>
<span class="strong"><strong>$ sudo update-alternatives --install "/usr/bin/javah" "javah" "/usr/lib/jvm/jdk1.6.0_45/bin/javah" 1</strong></span>
<span class="strong"><strong>$ sudo rm jdk-6u45-linux-x64.bin</strong></span>
</pre></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lvl1sec84"/>Summary</h1></div></div></div><p>In this appendix, we discussed Google's target development environment for Android and showed how to create a compatible environment, potentially in a virtual machine. You should feel free to modify other elements of your system, but having the elements of this appendix installed will provide you with the minimally viable environment necessary to perform all the steps outlined in <a class="link" href="ch04.html" title="Chapter 4. Installation on the UDOO">Chapter 4</a>, <span class="emphasis"><em>Installation on the UDOO</em></span>, and beyond.</p></div></body></html>