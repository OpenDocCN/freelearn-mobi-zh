<html><head></head><body>
<div id="_idContainer053">
<h1 class="chapter-number" id="_idParaDest-80"><a id="_idTextAnchor137"/><span class="koboSpan" id="kobo.1.1">3</span></h1>
<h1 id="_idParaDest-81"><a id="_idTextAnchor138"/><span class="koboSpan" id="kobo.2.1">Handling the UI State in Jetpack Compose and Using Hilt</span></h1>
<p><span class="koboSpan" id="kobo.3.1">All Android applications display the state to users, which helps inform users on what the outcome is and when. </span><span class="koboSpan" id="kobo.3.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">state</span></strong><span class="koboSpan" id="kobo.5.1"> in an Android application is any value that changes over time, and a good example </span><a id="_idIndexMarker179"/><span class="koboSpan" id="kobo.6.1">is a toast that shows a message when there is an error. </span><span class="koboSpan" id="kobo.6.2">In this chapter, readers will learn how to handle the UI state better with the new </span><span class="No-Break"><span class="koboSpan" id="kobo.7.1">Jetpack library.</span></span></p>
<p><span class="koboSpan" id="kobo.8.1">It is fair to say with great power comes great responsibility, and managing the state of any Composable component requires a distinct approach compared to using the older way of building Android views, or as many might call it, the imperative way. </span><span class="koboSpan" id="kobo.8.2">This means Jetpack’s library, Compose, is entirely different from </span><span class="No-Break"><span class="koboSpan" id="kobo.9.1">XML layouts.</span></span></p>
<p><span class="koboSpan" id="kobo.10.1">Handling the UI state in the XML </span><strong class="bold"><span class="koboSpan" id="kobo.11.1">View System</span></strong><span class="koboSpan" id="kobo.12.1"> is very straightforward. </span><span class="koboSpan" id="kobo.12.2">The process entails setting the properties of the views to reflect the current state – that is, showing or hiding the views accordingly. </span><span class="koboSpan" id="kobo.12.3">For instance, when loading data from an API, you can hide the loading view, show the content view, and populate it with the </span><span class="No-Break"><span class="koboSpan" id="kobo.13.1">desired views.</span></span></p>
<p><span class="koboSpan" id="kobo.14.1">In Compose, however, it is impossible to change a Composable component once the application has drawn it. </span><span class="koboSpan" id="kobo.14.2">You can, however, change the values passed to each Composable by changing the state each Composable receives. </span><span class="koboSpan" id="kobo.14.3">Hence, learning about managing the state better when building robust Android applications will </span><span class="No-Break"><span class="koboSpan" id="kobo.15.1">be handy.</span></span></p>
<p><span class="koboSpan" id="kobo.16.1">In this chapter, we’ll be covering the </span><span class="No-Break"><span class="koboSpan" id="kobo.17.1">following recipes:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.18.1">Implementing </span><strong class="bold"><span class="koboSpan" id="kobo.19.1">Dependency Injection</span></strong><span class="koboSpan" id="kobo.20.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.21.1">DI</span></strong><span class="koboSpan" id="kobo.22.1">) with </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">Jetpack Hilt</span></span></li>
<li><span class="koboSpan" id="kobo.24.1">Implementing </span><strong class="source-inline"><span class="koboSpan" id="kobo.25.1">ViewModel</span></strong><span class="koboSpan" id="kobo.26.1"> classes and understanding the state </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">in Compose</span></span></li>
<li><span class="koboSpan" id="kobo.28.1">Implementing Compose in existing an XML </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">layout-based project</span></span></li>
<li><span class="koboSpan" id="kobo.30.1">Understanding and handling recomposition in </span><span class="No-Break"><span class="koboSpan" id="kobo.31.1">Jetpack Compose</span></span></li>
<li><span class="koboSpan" id="kobo.32.1">Writing UI tests for your </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1">Compose views</span></span><a id="_idTextAnchor139"/></li>
<li><span class="koboSpan" id="kobo.34.1">Writing tests for your </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.35.1">ViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.36.1"> classes</span></span><a id="_idTextAnchor140"/></li>
</ul>
<h1 id="_idParaDest-82"><a id="_idTextAnchor141"/><span class="koboSpan" id="kobo.37.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.38.1">The complete source code for this chapter can be found </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">at </span></span><a href="https://github.com/PacktPublishing/Modern-Android-13-Development-Cookbook/tree/main/chapter_three"><span class="No-Break"><span class="koboSpan" id="kobo.40.1">https://github.com/PacktPublishing/Modern-Android-13-Development-Cookbook/tree/main/chapter_three</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.41.1">.</span></span></p>
<h1 id="_idParaDest-83"><a id="_idTextAnchor142"/><span class="koboSpan" id="kobo.42.1">Implementing DI with Jetpack Hilt</span></h1>
<p><span class="koboSpan" id="kobo.43.1">In object-oriented programming, DI is vital. </span><span class="koboSpan" id="kobo.43.2">Some people use it, and some prefer not to use it for their </span><a id="_idIndexMarker180"/><span class="koboSpan" id="kobo.44.1">own reasons. </span><span class="koboSpan" id="kobo.44.2">However, DI is </span><a id="_idIndexMarker181"/><span class="koboSpan" id="kobo.45.1">the practice of designing objects in a manner where they receive instances of the object from other pieces of code instead of constructing </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">them internally.</span></span></p>
<p><span class="koboSpan" id="kobo.47.1">If you know of the SOLID principles, you know their primary goal is to make software design easier to maintain, read, test, and build upon. </span><span class="koboSpan" id="kobo.47.2">In addition, DI helps us follow some of the SOLID principles. </span><span class="koboSpan" id="kobo.47.3">The dependency inversion principle allows the code base to be easily expanded and extended with new functionalities and improves reusability. </span><span class="koboSpan" id="kobo.47.4">In Modern Android Development, DI is essential, and we will implement it in our application in </span><span class="No-Break"><span class="koboSpan" id="kobo.48.1">this recipe.</span></span></p>
<p><span class="koboSpan" id="kobo.49.1">There are different types of libraries that you can use in Android for DI, such as Koin, Dagger, and Hilt; Hilt harnesses the power of Dagger and benefits from compile-time correctness, good runtime performance, Android studio support, and scalability. </span><span class="koboSpan" id="kobo.49.2">For this recipe, we will use Hilt, which provides containers for every Android class in our project and automatic</span><a id="_idTextAnchor143"/><span class="koboSpan" id="kobo.50.1">ally manages their </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">life cycle.</span></span></p>
<h2 id="_idParaDest-84"><a id="_idTextAnchor144"/><span class="koboSpan" id="kobo.52.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.53.1">Just like in previous recipes, we will use the project we have used in previous recipes to </span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">add DI.</span></span></p>
<h2 id="_idParaDest-85"><a id="_idTextAnchor145"/><span class="koboSpan" id="kobo.55.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.56.1">Hilt uses Java features; make sure your project is in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.57.1">app/build.gradle</span></strong><span class="koboSpan" id="kobo.58.1">, and you have the following </span><span class="No-Break"><span class="koboSpan" id="kobo.59.1">compile options:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.60.1">
android {
    ...
</span><span class="koboSpan" id="kobo.60.2">    compileOptions {
        sourceCompatibility JavaVersion.VERSION_11
        targetCompatibility JavaVersion.VERSION_11
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.61.1">This is already added automatically, but make sure you check that you have it just in case. </span><span class="koboSpan" id="kobo.61.2">Let's </span><span class="No-Break"><span class="koboSpan" id="kobo.62.1">get started:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.63.1">First, we must add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.64.1">Hilt-android-gradle-plugin</span></strong><span class="koboSpan" id="kobo.65.1"> plugin into our project’s root </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1">file, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.67.1">build.gradle(Project:SampleLogin)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.68.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.69.1">
plugins {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.70.1">
    id 'com.google.dagger.Hilt.android' version '2.44'</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.71.1">
apply false</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.72.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.73.1">Then, in our </span><strong class="source-inline"><span class="koboSpan" id="kobo.74.1">app/build.gradle</span></strong><span class="koboSpan" id="kobo.75.1"> file, add these dependencies, and sync the project. </span><span class="koboSpan" id="kobo.75.2">It should run without </span><span class="No-Break"><span class="koboSpan" id="kobo.76.1">any issues:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.77.1">
plugins {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.78.1">
    id 'kotlin-kapt'</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.79.1">
    id 'dagger.Hilt.android.plugin'</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.80.1">
}</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.81.1">
dependencies {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.82.1">
    implementation "com.google.dagger:Hilt-</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.83.1">
        android:2.44"</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.84.1">
    kapt "com.google.dagger:Hilt-compiler:2.44"</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.85.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.86.1">Now, let’s go </span><a id="_idIndexMarker182"/><span class="koboSpan" id="kobo.87.1">ahead and </span><a id="_idIndexMarker183"/><span class="koboSpan" id="kobo.88.1">add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.89.1">Application</span></strong><span class="koboSpan" id="kobo.90.1"> class. </span><span class="koboSpan" id="kobo.90.2">All apps that use Hilt must have an </span><strong class="source-inline"><span class="koboSpan" id="kobo.91.1">Application</span></strong><span class="koboSpan" id="kobo.92.1"> class annotated with </span><strong class="source-inline"><span class="koboSpan" id="kobo.93.1">@HiltAndroidApp</span></strong><span class="koboSpan" id="kobo.94.1">, and we need to call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.95.1">Application</span></strong><span class="koboSpan" id="kobo.96.1"> class that we create </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.98.1">Manifest</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.99.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.100.1">
@HiltAndroidApp</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.101.1">
class LoginApp : Application()</span></pre></li>
<li><span class="koboSpan" id="kobo.102.1">In our </span><strong class="source-inline"><span class="koboSpan" id="kobo.103.1">Manifest</span></strong><span class="koboSpan" id="kobo.104.1"> folder, let’s </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">add </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.106.1">LoginApp</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.107.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.108.1">
&lt;application</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.109.1">
    android:name=".LoginApp"</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.110.1">
  ...</span></pre></li>
<li><span class="koboSpan" id="kobo.111.1">Now that we </span><a id="_idIndexMarker184"/><span class="koboSpan" id="kobo.112.1">have the setup </span><a id="_idIndexMarker185"/><span class="koboSpan" id="kobo.113.1">done, we need to start working with Hilt by adding the required annotations to our class. </span><span class="koboSpan" id="kobo.113.2">In </span><strong class="source-inline"><span class="koboSpan" id="kobo.114.1">MainActivity.kt</span></strong><span class="koboSpan" id="kobo.115.1">, we need to add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.116.1">@</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.117.1">AndroidEntryPoint</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.118.1"> annotation:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.119.1">
@AndroidEntryPoint</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.120.1">
class MainActivity : ComponentActivity() {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.121.1">
  ...</span></pre></li>
<li><span class="koboSpan" id="kobo.122.1">Let’s go ahead and display what we did by running the </span><strong class="source-inline"><span class="koboSpan" id="kobo.123.1">./gradlew :app:dependencies</span></strong><span class="koboSpan" id="kobo.124.1"> command, and we will see something similar to </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.125.1">Figure 3</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.126.1">.1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer038">
<span class="koboSpan" id="kobo.128.1"><img alt="Figure 3.1 – Dagger Hilt dependency tree" src="image/Figure_3.4_B18827.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.129.1">Figure 3.1 – Dagger Hilt dependency tree</span></p>
<p><span class="koboSpan" id="kobo.130.1">You can also view the dependency in Android Studio. </span><span class="koboSpan" id="kobo.130.2">That is by clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.131.1">Gradle</span></strong><span class="koboSpan" id="kobo.132.1"> tab on the right-hand side and selecting </span><strong class="bold"><span class="koboSpan" id="kobo.133.1">expand:yourmodule</span></strong><span class="koboSpan" id="kobo.134.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.135.1">Tasks</span></strong><span class="koboSpan" id="kobo.136.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.137.1">android</span></strong><span class="koboSpan" id="kobo.138.1">. </span><span class="koboSpan" id="kobo.138.2">Then, finally, double-click on </span><strong class="bold"><span class="koboSpan" id="kobo.139.1">androidDependencies</span></strong><span class="koboSpan" id="kobo.140.1"> to </span><span class="No-Break"><span class="koboSpan" id="kobo.141.1">run it.</span></span></p>
<p><span class="koboSpan" id="kobo.142.1">Finally, compile and run the pr</span><a id="_idTextAnchor146"/><span class="koboSpan" id="kobo.143.1">oject; it should </span><span class="No-Break"><span class="koboSpan" id="kobo.144.1">run successfully.</span></span></p>
<h2 id="_idParaDest-86"><a id="_idTextAnchor147"/><span class="koboSpan" id="kobo.145.1">How it works…</span></h2>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.146.1">@HiltAndroidApp</span></strong><span class="koboSpan" id="kobo.147.1"> triggers Hilt’s code generation, including a base class for our application, which acts as the application-level dependency container. </span><span class="koboSpan" id="kobo.147.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.148.1">@AndroidEntryPoint</span></strong><span class="koboSpan" id="kobo.149.1"> annotation adds a DI container to the Android class annotated with it. </span><span class="koboSpan" id="kobo.149.2">When </span><a id="_idIndexMarker186"/><span class="koboSpan" id="kobo.150.1">using Hilt, the </span><a id="_idIndexMarker187"/><span class="koboSpan" id="kobo.151.1">generated Hilt component is attached to the Application object’s life cycle and provides its dependencies. </span><span class="koboSpan" id="kobo.151.2">Hilt currently supports the following </span><span class="No-Break"><span class="koboSpan" id="kobo.152.1">Android classes:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.153.1">ViewModel</span></strong><span class="koboSpan" id="kobo.154.1"> annotated </span><span class="No-Break"><span class="koboSpan" id="kobo.155.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">@HiltViewModel</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.157.1">Application</span></strong><span class="koboSpan" id="kobo.158.1"> annotated </span><span class="No-Break"><span class="koboSpan" id="kobo.159.1">as </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.160.1">@HiltAndroidApp</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.161.1">Activity</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">Fragment</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.163.1">View</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.164.1">Service</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.165.1">BroadcastReceiver</span></strong></span></li>
</ul>
<p><span class="koboSpan" id="kobo.166.1">We will use other necessary annotations in Hilt later, for instance, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.167.1">@Module</span></strong><span class="koboSpan" id="kobo.168.1"> annotation, </span><strong class="source-inline"><span class="koboSpan" id="kobo.169.1">@InstallIn</span></strong><span class="koboSpan" id="kobo.170.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.171.1">@Provides</span></strong><span class="koboSpan" id="kobo.172.1">. </span><span class="koboSpan" id="kobo.172.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.173.1">@Module</span></strong><span class="koboSpan" id="kobo.174.1"> annotation means the class in which you </span><a id="_idIndexMarker188"/><span class="koboSpan" id="kobo.175.1">can add binding for </span><a id="_idIndexMarker189"/><span class="koboSpan" id="kobo.176.1">types that cannot be injected in the constructor. </span><strong class="source-inline"><span class="koboSpan" id="kobo.177.1">@InstallIn</span></strong><span class="koboSpan" id="kobo.178.1"> indicates which Hilt-generated DI container (or singleton component) has to be available in the code </span><span class="No-Break"><span class="koboSpan" id="kobo.179.1">module binding.</span></span></p>
<p><span class="koboSpan" id="kobo.180.1">Finally, </span><strong class="source-inline"><span class="koboSpan" id="kobo.181.1">@Provides</span></strong><span class="koboSpan" id="kobo.182.1"> binds a type that cannot be constructor injected. </span><span class="koboSpan" id="kobo.182.2">Its return type is the binding type, it can take dependency parameters, and every time you need an instance, the function body is executed if the type is </span><span class="No-Break"><span class="koboSpan" id="kobo.183.1">not scoped.</span></span></p>
<h1 id="_idParaDest-87"><a id="_idTextAnchor148"/><span class="koboSpan" id="kobo.184.1">Implementing ViewModel classes and understanding the state in Compose</span></h1>
<p><span class="koboSpan" id="kobo.185.1">In Android, a </span><strong class="source-inline"><span class="koboSpan" id="kobo.186.1">ViewModel</span></strong><span class="koboSpan" id="kobo.187.1"> is a class responsible for consciously managing the UI-related data life cycle. </span><span class="koboSpan" id="kobo.187.2">There is also </span><a id="_idIndexMarker190"/><span class="koboSpan" id="kobo.188.1">a lot of debate in the community about </span><a id="_idIndexMarker191"/><span class="koboSpan" id="kobo.189.1">whether developers should use </span><strong class="source-inline"><span class="koboSpan" id="kobo.190.1">ViewModel</span></strong><span class="koboSpan" id="kobo.191.1"> in Compose or not. </span><span class="koboSpan" id="kobo.191.2">However, Manuel Vivo, a senior Android developer relations engineer at </span><span class="No-Break"><span class="koboSpan" id="kobo.192.1">Google, says:</span></span></p>
<p><em class="italic"><span class="koboSpan" id="kobo.193.1">“I’d include them if their benefits apply to your app. </span><span class="koboSpan" id="kobo.193.2">No need to use them if you handle all configuration changes yourself and don’t use Navigation Compose. </span><span class="koboSpan" id="kobo.193.3">Otherwise, use ViewModels not to reinvent </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.194.1">the wheel.”</span></em></span></p>
<p><em class="italic"><span class="koboSpan" id="kobo.195.1">“On the other hand, the debate as to why one should not use ViewModels is based on the argument that in pure Compose, since Compose handles configuration changes, having your Composable functions reference the ViewModel </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.196.1">is unnecessary.”</span></em></span></p>
<p><span class="koboSpan" id="kobo.197.1">You can also refer to this tweet by Jim </span><span class="No-Break"><span class="koboSpan" id="kobo.198.1">Sproch: </span></span><a href="https://twitter.com/JimSproch/status/1397169679647444993"><span class="No-Break"><span class="koboSpan" id="kobo.199.1">https://twitter.com/JimSproch/status/1397169679647444993</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.200.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.201.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.202.1">You can find more </span><a id="_idIndexMarker192"/><span class="koboSpan" id="kobo.203.1">info about the benefits of using the ViewModel </span><span class="No-Break"><span class="koboSpan" id="kobo.204.1">here: </span></span><a href="https://developer.android.com/jetpack/compose/state#viewmodels-source-of-truth"><span class="No-Break"><span class="koboSpan" id="kobo.205.1">https://developer.android.com/jetpack/compose/state#viewmodels-source-of-truth</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.206.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.207.1">This means using </span><strong class="source-inline"><span class="koboSpan" id="kobo.208.1">ViewModel</span></strong><span class="koboSpan" id="kobo.209.1"> to handle the state in your application will be a question of personal </span><a id="_idIndexMarker193"/><span class="koboSpan" id="kobo.210.1">choice with Jetpack Compose. </span><span class="koboSpan" id="kobo.210.2">The currently recommended architecture pattern in Android is </span><strong class="bold"><span class="koboSpan" id="kobo.211.1">Model-View-View-Model</span></strong><span class="koboSpan" id="kobo.212.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.213.1">MVVM</span></strong><span class="koboSpan" id="kobo.214.1">), and many applications </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">use it.</span></span></p>
<p><span class="koboSpan" id="kobo.216.1">Jetpack Compose uses a unidirectional data flow design pattern; this means the data or state only streams down while the events stream up. </span><span class="koboSpan" id="kobo.216.2">Hence, a clear understanding of how we can utilize the </span><a id="_idIndexMarker194"/><span class="koboSpan" id="kobo.217.1">unidirectional pattern to make our code more </span><a id="_idIndexMarker195"/><span class="koboSpan" id="kobo.218.1">readable, maintainable, and testable as much as possible using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.219.1">ViewModel</span></strong><span class="koboSpan" id="kobo.220.1"> class will </span><span class="No-Break"><span class="koboSpan" id="kobo.221.1">be helpful.</span></span></p>
<p><span class="koboSpan" id="kobo.222.1">In addition, </span><strong class="source-inline"><span class="koboSpan" id="kobo.223.1">ViewModel</span></strong><span class="koboSpan" id="kobo.224.1"> is suitable for providing your application with access to business logic, preparing the data for presentation on the screen, and making your </span><span class="No-Break"><span class="koboSpan" id="kobo.225.1">code test</span><a id="_idTextAnchor149"/><span class="koboSpan" id="kobo.226.1">able.</span></span></p>
<h2 id="_idParaDest-88"><a id="_idTextAnchor150"/><span class="koboSpan" id="kobo.227.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.228.1">In this recipe, we will work with a pre-built skeleton </span><strong class="source-inline"><span class="koboSpan" id="kobo.229.1">SampleLogin</span></strong><span class="koboSpan" id="kobo.230.1"> project, which you can download from the </span><em class="italic"><span class="koboSpan" id="kobo.231.1">Technical requirements</span></em><span class="koboSpan" id="kobo.232.1"> se</span><a id="_idTextAnchor151"/><span class="koboSpan" id="kobo.233.1">ction. </span><span class="koboSpan" id="kobo.233.2">We will use Hilt in this recipe since the project uses Hilt, but we will explain Hilt in a </span><span class="No-Break"><span class="koboSpan" id="kobo.234.1">next recipe.</span></span></p>
<h2 id="_idParaDest-89"><a id="_idTextAnchor152"/><span class="koboSpan" id="kobo.235.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.236.1">You will now create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.237.1">ViewModel</span></strong><span class="koboSpan" id="kobo.238.1"> class and modify most of the code in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.239.1">LoginContent</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.240.1">Kotlin file:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.241.1">To keep our classes and files well organized, let’s go ahead and first create a package to hold our UI and view models. </span><span class="koboSpan" id="kobo.241.2">Navigate to the main </span><strong class="source-inline"><span class="koboSpan" id="kobo.242.1">Package</span></strong><span class="koboSpan" id="kobo.243.1"> folder, right-click to open a prompt, then go down to </span><strong class="bold"><span class="koboSpan" id="kobo.244.1">Package</span></strong><span class="koboSpan" id="kobo.245.1">, and a dialog with a package name </span><span class="No-Break"><span class="koboSpan" id="kobo.246.1">will appear.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer039">
<span class="koboSpan" id="kobo.247.1"><img alt="Figure 3.2 – How to create a package" src="image/Figure_3.1_B18827.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.248.1">Figure 3.2 – How to create a package</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.249.1">Name the package </span><strong class="source-inline"><span class="koboSpan" id="kobo.250.1">Login</span></strong><span class="koboSpan" id="kobo.251.1">; inside </span><strong class="bold"><span class="koboSpan" id="kobo.252.1">Login</span></strong><span class="koboSpan" id="kobo.253.1">, we will move our </span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">LoginContent</span></strong><span class="koboSpan" id="kobo.255.1"> file and add the new class, </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">LoginViewModel</span></strong><span class="koboSpan" id="kobo.257.1">, there. </span><span class="koboSpan" id="kobo.257.2">Go ahead and create a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">ViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.259.1"> class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.260.1">
class LoginViewModel {...}</span></pre></li>
<li><span class="koboSpan" id="kobo.261.1">Now that we have created a </span><strong class="source-inline"><span class="koboSpan" id="kobo.262.1">LoginViewModel</span></strong><span class="koboSpan" id="kobo.263.1"> class, we need to add a DI annotation of </span><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">HiltViewModel</span></strong><span class="koboSpan" id="kobo.265.1"> and ensure we extend the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.266.1">ViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.267.1"> class:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.268.1">
@HiltViewModel</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.269.1">
class LoginViewModel @Inject constructor(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.270.1">
): ViewModel(){. </span><span class="koboSpan" id="kobo.270.2">. </span><span class="koboSpan" id="kobo.270.3">.}</span></pre></li>
<li><span class="koboSpan" id="kobo.271.1">In our </span><strong class="source-inline"><span class="koboSpan" id="kobo.272.1">ViewModel</span></strong><span class="koboSpan" id="kobo.273.1"> constructor, we will need to add </span><strong class="source-inline"><span class="koboSpan" id="kobo.274.1">stateHandle: SavedStateHandle</span></strong><span class="koboSpan" id="kobo.275.1">, which </span><a id="_idIndexMarker196"/><span class="koboSpan" id="kobo.276.1">will help us maintain and retrieve </span><a id="_idIndexMarker197"/><span class="koboSpan" id="kobo.277.1">objects to and from the saved state. </span><span class="koboSpan" id="kobo.277.2">These values persist even after the system kills the process and remain available through the </span><span class="No-Break"><span class="koboSpan" id="kobo.278.1">same object:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.279.1">
@HiltViewModel</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.280.1">
class LoginViewModel @Inject constructor(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.281.1">
    stateHandle: SavedStateHandle</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.282.1">
) : ViewModel() {...}</span></pre></li>
<li><span class="koboSpan" id="kobo.283.1">Before we build our </span><strong class="source-inline"><span class="koboSpan" id="kobo.284.1">ViewModel</span></strong><span class="koboSpan" id="kobo.285.1">, let’s go ahead and create a data class, </span><strong class="source-inline"><span class="koboSpan" id="kobo.286.1">AuthenticationState()</span></strong><span class="koboSpan" id="kobo.287.1">. </span><span class="koboSpan" id="kobo.287.2">This class will come in handy during our testing since we need to be able to test most of our validation cases. </span><span class="koboSpan" id="kobo.287.3">A </span><strong class="source-inline"><span class="koboSpan" id="kobo.288.1">View</span></strong><span class="koboSpan" id="kobo.289.1"> state class, plus </span><a id="_idIndexMarker198"/><span class="koboSpan" id="kobo.290.1">having a single source of truth, has many advantages and is one of the principles of </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.291.1">Model-View-Intent</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.292.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.293.1">MVI</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.294.1">):</span></span><pre class="source-code"><span class="koboSpan" id="kobo.295.1">
data class AuthenticationState(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.296.1">
    val userName: String = "",</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.297.1">
    val password: String = "",</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.298.1">
    val loading: Boolean = false,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.299.1">
    var togglePasswordVisibility: Boolean = true</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.300.1">
) {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.301.1">
    companion object {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.302.1">
        val EMPTY_STATE = AuthenticationState()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.303.1">
    }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.304.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.305.1">Now, let’s go </span><a id="_idIndexMarker199"/><span class="koboSpan" id="kobo.306.1">ahead and create a helper class, </span><strong class="source-inline"><span class="koboSpan" id="kobo.307.1">MutableSavedState&lt;T&gt;()</span></strong><span class="koboSpan" id="kobo.308.1">, which will take in </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1">savedStateHandle</span></strong><span class="koboSpan" id="kobo.310.1">, a key, and a</span><a id="_idIndexMarker200"/><span class="koboSpan" id="kobo.311.1"> default value. </span><span class="koboSpan" id="kobo.311.2">This class acts as a </span><strong class="source-inline"><span class="koboSpan" id="kobo.312.1">MutableStateFlow()</span></strong><span class="koboSpan" id="kobo.313.1"> but saves the data and value and retrieves it upon the application’s death with the help </span><span class="No-Break"><span class="koboSpan" id="kobo.314.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.315.1">SavedStateHandle</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.316.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.317.1">
class MutableSavedState&lt;T&gt;(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.318.1">
    private val savedStateHandle: SavedStateHandle,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.319.1">
    private val key: String,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.320.1">
    defValue: T,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.321.1">
) {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.322.1">
 . </span><span class="koboSpan" id="kobo.322.2">. </span><span class="koboSpan" id="kobo.322.3">.</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.323.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.324.1">Now, let’s go ahead and create callbacks that will be invoked when a user enters their username and password in </span><span class="No-Break"><span class="koboSpan" id="kobo.325.1">our </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.326.1">LoginViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.327.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.328.1">
private val username = MutableSavedState(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.329.1">
    stateHandle,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.330.1">
    "UserName",</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.331.1">
    defValue = ""</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.332.1">
)</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.333.1">
fun userNameChanged(userName: String){</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.334.1">
    username.value = userName</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.335.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.336.1">Go ahead and do the same for password and password </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">toggle visibility.</span></span></li>
<li><span class="koboSpan" id="kobo.338.1">Now, we need to create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.339.1">combineFlows</span></strong><span class="koboSpan" id="kobo.340.1"> helper class. </span><span class="koboSpan" id="kobo.340.2">You can combine more than two flows </span><a id="_idIndexMarker201"/><span class="koboSpan" id="kobo.341.1">in Kotlin; a coroutine </span><strong class="source-inline"><span class="koboSpan" id="kobo.342.1">flow</span></strong><span class="koboSpan" id="kobo.343.1"> is a type that </span><a id="_idIndexMarker202"/><span class="koboSpan" id="kobo.344.1">emits multiple values sequentially, as opposed to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">suspend</span></strong><span class="koboSpan" id="kobo.346.1"> function, which returns a single value. </span><span class="koboSpan" id="kobo.346.2">More details on how to combine flows can be found at </span><strong class="source-inline"><span class="koboSpan" id="kobo.347.1">combine(flow1</span></strong><span class="koboSpan" id="kobo.348.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.349.1">flow2</span></strong><span class="koboSpan" id="kobo.350.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.351.1">flow3</span></strong><span class="koboSpan" id="kobo.352.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.353.1">flow4) {t1, t2, t3, t4 -&gt; </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.354.1">resultMapper}.stateIn(scope)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.356.1">
fun &lt;T1, T2, T3, T4, T5, T6, R&gt; combine(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.357.1">
    flow: Flow&lt;T1&gt;,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.358.1">
    flow2: Flow&lt;T2&gt;,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.359.1">
    flow3: Flow&lt;T3&gt;,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.360.1">
    flow4: Flow&lt;T4&gt;,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.361.1">
    flow5: Flow&lt;T5&gt;,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.362.1">
    flow6: Flow&lt;T6&gt;,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.363.1">
    transform: suspend (T1, T2, T3, T4, T5, T6) -&gt; R</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.364.1">
): Flow&lt;R&gt; = combine(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.365.1">
        combine(flow, flow2, flow3, ::Triple),</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.366.1">
        combine(flow4, flow5, flow6, ::Triple)</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.367.1">
) { t1, t2 -&gt;</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.368.1">
    transform(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.369.1">
        t1.first,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.370.1">
        t1.second,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.371.1">
        t1.third,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.372.1">
        t2.first,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.373.1">
        t2.second,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.374.1">
        t2.third</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.375.1">
    )</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.376.1">
}</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.377.1">Read </span><a id="_idIndexMarker203"/><span class="koboSpan" id="kobo.378.1">more here – </span><a href="https://stackoverflow.com/questions/67939183/kotlin-combine-more-than-2-flows"><span class="No-Break"><span class="koboSpan" id="kobo.379.1">https://stackoverflow.com/questions/67939183/kotlin-combine-more-than-2-flows</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.380.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.381.1">
val state = combineFlows(
    username.flow,
    password.flow,
    passwordVisibilityToggle.flow,
    loadingProgress.flow
) { username, password, passwordToggle, isLoading -&gt;
    AuthenticationState(
        userName = username,
        password = password,
        togglePasswordVisibility = passwordToggle,
        loading = isLoading
    )
}.stateIn(. </span><span class="koboSpan" id="kobo.381.2">. </span><span class="koboSpan" id="kobo.381.3">.)</span></pre>
<ol>
<li value="10"><span class="koboSpan" id="kobo.382.1">Now, let’s go ahead and create our helper class for using coroutines and call it </span><strong class="source-inline"><span class="koboSpan" id="kobo.383.1">SampleLoginDispatchers()</span></strong><span class="koboSpan" id="kobo.384.1">; it will help us in testing our code and ensuring our code is easily readable. </span><span class="koboSpan" id="kobo.384.2">In addition, we use coroutine dispatchers that help determine what thread the corresponding coroutine should use </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">for execution:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.386.1">
.stateIn(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.387.1">
   coroutineScope = viewModelScope + dispatchers.main,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.388.1">
   initialValue = AuthenticationState.EMPTY_STATE</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.389.1">
)</span></pre></li>
</ol>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.390.1">SharedFlow</span></strong><span class="koboSpan" id="kobo.391.1"> represents a read-only state with a single updatable data value, which emits any updates to its collectors. </span><span class="koboSpan" id="kobo.391.2">On the other hand, a state flow is a hot flow because its active instance exists independently of the presence </span><span class="No-Break"><span class="koboSpan" id="kobo.392.1">of collectors.</span></span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.393.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.394.1">SharingStarted </span></strong><span class="koboSpan" id="kobo.395.1">coroutine flow operator in Android is used to share the execution of a flow </span><a id="_idIndexMarker204"/><span class="koboSpan" id="kobo.396.1">among multiple collectors. </span><span class="koboSpan" id="kobo.396.2">It is </span><a id="_idIndexMarker205"/><span class="koboSpan" id="kobo.397.1">commonly used to create a “hot” flow, which means that the flow starts emitting data as soon as it is created, and the data is shared among all the active collectors of the flow. </span><span class="koboSpan" id="kobo.397.2">These can be back-to-back emissions of the same command and have </span><span class="No-Break"><span class="koboSpan" id="kobo.398.1">no effect:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.399.1">
fun &lt;T&gt; Flow&lt;T&gt;.stateIn(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.400.1">
    coroutineScope: CoroutineScope,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.401.1">
    initialValue: T</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.402.1">
): StateFlow&lt;T&gt; = stateIn(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.403.1">
    scope = coroutineScope,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.404.1">
    started = SharingStarted.WhileSubscribed(5000),</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.405.1">
    initialValue = initialValue</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.406.1">
)</span></pre></li>
<li><span class="koboSpan" id="kobo.407.1">There are four types of dispatchers. </span><span class="koboSpan" id="kobo.407.2">In our example, we will only use three. </span><span class="koboSpan" id="kobo.407.3">In addition, you </span><a id="_idIndexMarker206"/><span class="koboSpan" id="kobo.408.1">can inject a single dispatcher and </span><a id="_idIndexMarker207"/><span class="koboSpan" id="kobo.409.1">achieve the same result without the class; hence, this can be preference-based. </span><span class="koboSpan" id="kobo.409.2">See how it works for the four types </span><span class="No-Break"><span class="koboSpan" id="kobo.410.1">of dispatchers:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.411.1">
class SampleLoginDispatchers(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.412.1">
    val default: CoroutineDispatcher,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.413.1">
    val main: CoroutineDispatcher,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.414.1">
    val io: CoroutineDispatcher</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.415.1">
) {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.416.1">
    companion object {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.417.1">
        fun createTestDispatchers(coroutineDispatcher:</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.418.1">
        CoroutineDispatcher): SampleLoginDispatchers {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.419.1">
            return SampleLoginDispatchers(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.420.1">
                default = coroutineDispatcher,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.421.1">
                main = coroutineDispatcher,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.422.1">
                io = coroutineDispatcher</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.423.1">
            )</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.424.1">
        }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.425.1">
    }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.426.1">
}</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.427.1">Now that we have created our helper class, we must provide the dispatcher via DI. </span><span class="koboSpan" id="kobo.427.2">We have an entire recipe dedicated to Hilt, so we will look at the concepts and what the annotations mean in the </span><span class="No-Break"><span class="koboSpan" id="kobo.428.1">Hilt recipe.</span></span></p>
<ol>
<li value="13"><span class="koboSpan" id="kobo.429.1">Create a new package and call the package </span><strong class="source-inline"><span class="koboSpan" id="kobo.430.1">di</span></strong><span class="koboSpan" id="kobo.431.1">. </span><span class="koboSpan" id="kobo.431.2">In this package, create a new object and call it </span><strong class="source-inline"><span class="koboSpan" id="kobo.432.1">AppModule</span></strong><span class="koboSpan" id="kobo.433.1">; we will provide our dispatcher to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.434.1">ViewModel</span></strong><span class="koboSpan" id="kobo.435.1"> constructor via the </span><span class="No-Break"><span class="koboSpan" id="kobo.436.1">dependency graph:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.437.1">
@Module</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.438.1">
@InstallIn(SingletonComponent::class)</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.439.1">
object AppModule {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.440.1">
    @Provides</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.441.1">
    fun provideSlimeDispatchers():</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.442.1">
    SampleLoginDispatchers {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.443.1">
        return SampleLoginDispatchers(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.444.1">
        default = Dispatchers.Default,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.445.1">
        main = Dispatchers.Main,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.446.1">
        io = Dispatchers.IO</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.447.1">
        )</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.448.1">
    }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.449.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.450.1">We will now need to go to </span><strong class="source-inline"><span class="koboSpan" id="kobo.451.1">LoginContent</span></strong><span class="koboSpan" id="kobo.452.1"> and modify the code – that is, by adding callbacks </span><a id="_idIndexMarker208"/><span class="koboSpan" id="kobo.453.1">that will correspond to our </span><strong class="source-inline"><span class="koboSpan" id="kobo.454.1">ViewModel</span></strong><span class="koboSpan" id="kobo.455.1">, and </span><a id="_idIndexMarker209"/><span class="koboSpan" id="kobo.456.1">whenever we have a view – for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.457.1">UserNameField()</span></strong><span class="koboSpan" id="kobo.458.1"> – we will use the callback. </span><span class="koboSpan" id="kobo.458.2">See the </span><span class="No-Break"><span class="koboSpan" id="kobo.459.1">sample code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.460.1">
@Composable</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.461.1">
fun LoginContent(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.462.1">
    modifier: Modifier = Modifier,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.463.1">
    uiState: AuthenticationState,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.464.1">
    onUsernameUpdated: (String) -&gt; Unit,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.465.1">
    onPasswordUpdated: (String) -&gt; Unit,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.466.1">
    onLogin: () -&gt; Unit,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.467.1">
    passwordToggleVisibility: (Boolean) -&gt; Unit</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.468.1">
){</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.469.1">
. </span><span class="koboSpan" id="kobo.469.2">. </span><span class="koboSpan" id="kobo.469.3">.</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.470.1">
UserNameField(authState = uiState, onValueChanged =</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.471.1">
onUsernameUpdated)</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.472.1">
PasswordInputField(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.473.1">
    text = stringResource(id = R.string.password),</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.474.1">
    authState = uiState,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.475.1">
    onValueChanged = onPasswordUpdated,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.476.1">
    passwordToggleVisibility =</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.477.1">
        passwordToggleVisibility</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.478.1">
)</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.479.1">
LoginButton(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.480.1">
    text = stringResource(id = R.string.sign_in),</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.481.1">
    enabled = if (uiState.isValidForm()) {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.482.1">
        !uiState.loading</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.483.1">
    } else {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.484.1">
        false</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.485.1">
    },</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.486.1">
    onLoginClicked = {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.487.1">
        onLogin.invoke()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.488.1">
    },</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.489.1">
    isLoading = uiState.loading</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.490.1">
). </span><span class="koboSpan" id="kobo.490.2">. </span><span class="koboSpan" id="kobo.490.3">.}</span></pre></li>
<li><span class="koboSpan" id="kobo.491.1">Now, in </span><a id="_idIndexMarker210"/><span class="koboSpan" id="kobo.492.1">our </span><strong class="source-inline"><span class="koboSpan" id="kobo.493.1">LoginContentScreen</span></strong><span class="koboSpan" id="kobo.494.1"> Composable </span><a id="_idIndexMarker211"/><span class="koboSpan" id="kobo.495.1">function, we will pass </span><span class="No-Break"><span class="koboSpan" id="kobo.496.1">our </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.497.1">LoginViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.498.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.499.1">
@Composable</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.500.1">
fun LoginContentScreen(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.501.1">
    loginViewModel: LoginViewModel,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.502.1">
    onRegisterNavigateTo: () -&gt; Unit</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.503.1">
) {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.504.1">
    val viewState by</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.505.1">
        loginViewModel.state.collectAsState()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.506.1">
    LoginContent(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.507.1">
        uiState = viewState,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.508.1">
        onUsernameUpdated =</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.509.1">
            loginViewModel::userNameChanged,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.510.1">
         onPasswordUpdated =</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.511.1">
            loginViewModel::passwordChanged,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.512.1">
         onLogin = loginViewModel::login,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.513.1">
         passwordToggleVisibility =</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.514.1">
             loginViewModel::passwordVisibility,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.515.1">
         onRegister = onRegisterNavigateTo</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.516.1">
    )</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.517.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.518.1">Finally, in </span><strong class="source-inline"><span class="koboSpan" id="kobo.519.1">MainActivity</span></strong><span class="koboSpan" id="kobo.520.1">, we can now go ahead and call </span><strong class="source-inline"><span class="koboSpan" id="kobo.521.1">LoginContentScreen</span></strong><span class="koboSpan" id="kobo.522.1">, pass in our </span><strong class="source-inline"><span class="koboSpan" id="kobo.523.1">ViewModel</span></strong><span class="koboSpan" id="kobo.524.1">, and also specify what action we want when the user </span><span class="No-Break"><span class="koboSpan" id="kobo.525.1">clicks </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.526.1">onRegister</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.527.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.528.1">
LoginContentScreen(loginViewModel = HiltViewModel(), onRegisterNavigateTo = {. </span><span class="koboSpan" id="kobo.528.2">. </span><span class="koboSpan" id="kobo.528.3">.}</span></pre></li>
<li><span class="koboSpan" id="kobo.529.1">For the entire </span><a id="_idIndexMarker212"/><span class="koboSpan" id="kobo.530.1">code, please ensure you check out the </span><a id="_idIndexMarker213"/><span class="koboSpan" id="kobo.531.1">link in the </span><em class="italic"><span class="koboSpan" id="kobo.532.1">Technical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.533.1">requirements</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.534.1"> section.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer040">
<span class="koboSpan" id="kobo.535.1"><img alt="Figure 3.3 – Error state display when we enter﻿ a special character !" src="image/Figure_3.2_B18827.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.536.1">Figure 3.3 – Error state display when we enter</span><a id="_idTextAnchor153"/><span class="koboSpan" id="kobo.537.1"> a special character !</span></p>
<h2 id="_idParaDest-90"><a id="_idTextAnchor154"/><span class="koboSpan" id="kobo.538.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.539.1">Jetpack Compose uses a unidirectional data flow design pattern. </span><span class="koboSpan" id="kobo.539.2">This means the data or state only streams down while the events stream up, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.540.1">Figure 3</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.541.1">.4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.542.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer041">
<span class="koboSpan" id="kobo.543.1"><img alt="Figure 3.4 – A unidirectional data flow" src="image/Figure_3.3_B18827.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.544.1">Figure 3.4 – A unidirectional data flow</span></p>
<p><span class="koboSpan" id="kobo.545.1">That is to say, Composable functions receive the state and then display it on the screen. </span><span class="koboSpan" id="kobo.545.2">On the other hand, an event can cause the state to need to be updated and come from either a Composable or any other part of your application. </span><span class="koboSpan" id="kobo.545.3">Furthermore, whatever handles the state, in our case, </span><strong class="source-inline"><span class="koboSpan" id="kobo.546.1">ViewModel</span></strong><span class="koboSpan" id="kobo.547.1">, receives the event and adjusts the state </span><span class="No-Break"><span class="koboSpan" id="kobo.548.1">for us.</span></span></p>
<p><span class="koboSpan" id="kobo.549.1">We also use </span><a id="_idIndexMarker214"/><span class="koboSpan" id="kobo.550.1">coroutines, which are nothing but lightweight threads, and </span><a id="_idIndexMarker215"/><span class="koboSpan" id="kobo.551.1">they help us handle synchronous and asynchronous programming easily. </span><span class="koboSpan" id="kobo.551.2">Furthermore, coroutines allow execution to be suspended and resumed later. </span><span class="koboSpan" id="kobo.551.3">The main advantages are that they are lightweight, have built-in cancellation support, have lower chances of memory leaks, and the Jetpack libraries provide </span><span class="No-Break"><span class="koboSpan" id="kobo.552.1">coroutine support.</span></span></p>
<p><span class="koboSpan" id="kobo.553.1">There are four types </span><span class="No-Break"><span class="koboSpan" id="kobo.554.1">of dispatchers:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.555.1">The Main dispatcher</span></strong><span class="koboSpan" id="kobo.556.1">: The </span><strong class="source-inline"><span class="koboSpan" id="kobo.557.1">Main</span></strong><span class="koboSpan" id="kobo.558.1"> dispatcher executes in the main thread, which is usually </span><a id="_idIndexMarker216"/><span class="koboSpan" id="kobo.559.1">used when your application needs to perform some UI operations within a coroutine. </span><span class="koboSpan" id="kobo.559.2">This is because the UI can only be changed from the main thread. </span><span class="koboSpan" id="kobo.559.3">Another name for the main thread is the </span><span class="No-Break"><span class="koboSpan" id="kobo.560.1">UI thread.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.561.1">The IO dispatcher</span></strong><span class="koboSpan" id="kobo.562.1">: The </span><strong class="source-inline"><span class="koboSpan" id="kobo.563.1">IO</span></strong><span class="koboSpan" id="kobo.564.1"> dispatcher starts the coroutine in the I/O thread; I/O simply means input </span><a id="_idIndexMarker217"/><span class="koboSpan" id="kobo.565.1">and output in programming. </span><span class="koboSpan" id="kobo.565.2">This is also used to perform all data work, such as networking, reading, or writing from the database. </span><span class="koboSpan" id="kobo.565.3">You can simply say fetching data from the I/O operation is done in the </span><span class="No-Break"><span class="koboSpan" id="kobo.566.1">I/O thread.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.567.1">The Default dispatcher</span></strong><span class="koboSpan" id="kobo.568.1">: The </span><strong class="source-inline"><span class="koboSpan" id="kobo.569.1">Default</span></strong><span class="koboSpan" id="kobo.570.1"> dispatcher starts in the default state. </span><span class="koboSpan" id="kobo.570.2">Your application </span><a id="_idIndexMarker218"/><span class="koboSpan" id="kobo.571.1">can utilize this if you plan on doing complex long-running calculations, which can block the UI/main thread and make your UI freeze or cause an </span><strong class="bold"><span class="koboSpan" id="kobo.572.1">Application Not Responding</span></strong><span class="koboSpan" id="kobo.573.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.574.1">ANR</span></strong><span class="koboSpan" id="kobo.575.1">) error. </span><span class="koboSpan" id="kobo.575.2">In addition, the </span><a id="_idIndexMarker219"/><span class="koboSpan" id="kobo.576.1">default dispatchers are launched in </span><strong class="source-inline"><span class="koboSpan" id="kobo.577.1">GlobalScope</span></strong><span class="koboSpan" id="kobo.578.1">, and you can use it by simply </span><span class="No-Break"><span class="koboSpan" id="kobo.579.1">calling </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.580.1">GlobalScope.launch{...}</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.581.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.582.1">The Unconfined dispatcher</span></strong><span class="koboSpan" id="kobo.583.1">: Finally, </span><strong class="source-inline"><span class="koboSpan" id="kobo.584.1">Unconfined</span></strong><span class="koboSpan" id="kobo.585.1">, as the name suggests, is a dispatcher not </span><a id="_idIndexMarker220"/><span class="koboSpan" id="kobo.586.1">confined to any specific thread. </span><span class="koboSpan" id="kobo.586.2">This executes the dispatcher to perform its work in a current call frame and lets the coroutine resume whatever threads that are used by the </span><span class="No-Break"><span class="koboSpan" id="kobo.587.1">corresponding function.</span></span></li>
</ul>
<h2 id="_idParaDest-91"><a id="_idTextAnchor155"/><span class="koboSpan" id="kobo.588.1">See also…</span></h2>
<p><span class="koboSpan" id="kobo.589.1">A lot was covered </span><a id="_idIndexMarker221"/><span class="koboSpan" id="kobo.590.1">in this chapter, and it is fair to acknowledge that just this simple recipe cannot explain </span><strong class="source-inline"><span class="koboSpan" id="kobo.591.1">ViewModel</span></strong><span class="koboSpan" id="kobo.592.1"> in its entirety. </span><span class="koboSpan" id="kobo.592.2">To find out more, see the following </span><span class="No-Break"><span class="koboSpan" id="kobo.593.1">link: </span></span><a href="https://developer.android.com/topic/libraries/architecture/viewmodel"><span class="No-Break"><span class="koboSpan" id="kobo.594.1">https://developer.android.com/topic/libr</span><span id="_idTextAnchor156"/><span class="koboSpan" id="kobo.595.1">aries/architecture/viewmodel</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.596.1">.</span></span></p>
<h1 id="_idParaDest-92"><a id="_idTextAnchor157"/><span class="koboSpan" id="kobo.597.1">Implementing Compose in an existing XML layout-based project</span></h1>
<p><span class="koboSpan" id="kobo.598.1">Since Compose is a new UI framework, many code bases still rely heavily on XML layouts. </span><span class="koboSpan" id="kobo.598.2">However, many </span><a id="_idIndexMarker222"/><span class="koboSpan" id="kobo.599.1">companies are </span><a id="_idIndexMarker223"/><span class="koboSpan" id="kobo.600.1">opting to build new screens using Compose, and this is achievable by utilizing existing XML layouts and adding unique views using </span><strong class="source-inline"><span class="koboSpan" id="kobo.601.1">ComposeView</span></strong><span class="koboSpan" id="kobo.602.1"> XML tags. </span><span class="koboSpan" id="kobo.602.2">This recipe will look into</span><a id="_idTextAnchor158"/><span class="koboSpan" id="kobo.603.1"> adding a Compose view to an </span><span class="No-Break"><span class="koboSpan" id="kobo.604.1">XML layout.</span></span></p>
<h2 id="_idParaDest-93"><a id="_idTextAnchor159"/><span class="koboSpan" id="kobo.605.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.606.1">In this recipe, we can create a new project or opt to use an existing project that does not heavily rely on Compose. </span><span class="koboSpan" id="kobo.606.2">We will try to display </span><strong class="source-inline"><span class="koboSpan" id="kobo.607.1">GreetingDialog</span></strong><span class="koboSpan" id="kobo.608.1"> and use an XML layout to show how we can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.609.1">ComposeView</span></strong><span class="koboSpan" id="kobo.610.1"> tag in XML layouts. </span><span class="koboSpan" id="kobo.610.2">If you already have a project, you do not need to set this up; you can skip to </span><em class="italic"><span class="koboSpan" id="kobo.611.1">step 4</span><a id="_idTextAnchor160"/></em><span class="koboSpan" id="kobo.612.1"> in the preceding </span><em class="italic"><span class="koboSpan" id="kobo.613.1">How to do </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.614.1">it…</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.615.1"> section.</span></span></p>
<h2 id="_idParaDest-94"><a id="_idTextAnchor161"/><span class="koboSpan" id="kobo.616.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.617.1">Now let us go ahead and explore how we can utilize existing XML layouts </span><span class="No-Break"><span class="koboSpan" id="kobo.618.1">with Compose:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.619.1">Let’s start by creating a new project or using a preexisting one; if you create a new activity that is not Compose, you can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.620.1">EmptyActivity</span></strong><span class="koboSpan" id="kobo.621.1">, and give it </span><span class="No-Break"><span class="koboSpan" id="kobo.622.1">any name.</span></span></li>
<li><span class="koboSpan" id="kobo.623.1">If you already have a project set up, you can skip this step. </span><span class="koboSpan" id="kobo.623.2">If you opt to create a new project, you will have </span><strong class="source-inline"><span class="koboSpan" id="kobo.624.1">MainActivity</span></strong><span class="koboSpan" id="kobo.625.1">, and since this is the old way of creating views, you will notice an XML layout in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.626.1">resource</span></strong><span class="koboSpan" id="kobo.627.1"> folder with a TextView that has </span><strong class="source-inline"><span class="koboSpan" id="kobo.628.1">Hello world</span></strong><span class="koboSpan" id="kobo.629.1">. </span><span class="koboSpan" id="kobo.629.2">We can go ahead and remove that since we will not </span><span class="No-Break"><span class="koboSpan" id="kobo.630.1">use it.</span></span></li>
<li><span class="koboSpan" id="kobo.631.1">If you already have a project ready, you can launch </span><strong class="source-inline"><span class="koboSpan" id="kobo.632.1">GreetingDialog</span></strong><span class="koboSpan" id="kobo.633.1"> on any screen you want. </span><span class="koboSpan" id="kobo.633.2">Also, if you opt to create a button instead of a dialog, that is fine, too since the idea is to showcase how we can use XML tags in </span><span class="No-Break"><span class="koboSpan" id="kobo.634.1">Jetpack Compose.</span></span></li>
<li><span class="koboSpan" id="kobo.635.1">Now, let us go ahead and add an XML tag inside </span><strong class="source-inline"><span class="koboSpan" id="kobo.636.1">activity_main.xml</span></strong><span class="koboSpan" id="kobo.637.1"> and give </span><a id="_idIndexMarker224"/><span class="koboSpan" id="kobo.638.1">our Compose view an </span><strong class="source-inline"><span class="koboSpan" id="kobo.639.1">id</span></strong><span class="koboSpan" id="kobo.640.1"> value. </span><span class="koboSpan" id="kobo.640.2">The </span><a id="_idIndexMarker225"/><span class="koboSpan" id="kobo.641.1">first time you add </span><strong class="source-inline"><span class="koboSpan" id="kobo.642.1">ComposeView</span></strong><span class="koboSpan" id="kobo.643.1">, you will see an error message if you still need to add the dependency. </span><span class="koboSpan" id="kobo.643.2">Go ahead and click </span><strong class="bold"><span class="koboSpan" id="kobo.644.1">Add dependency on android.compose.ui:ui</span></strong><span class="koboSpan" id="kobo.645.1"> and the project will sync as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.646.1">Figure 3</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.647.1">.5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.648.1">.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer042">
<span class="koboSpan" id="kobo.649.1"><img alt="Figure 3.5 – A Compose view in XML" src="image/Figure_3.5_B18827.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.650.1">Figure 3.5 – A Compose view in XML</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.651.1">Once you have synced your project, the error will disappear, and you should be able to use this view in </span><strong class="source-inline"><span class="koboSpan" id="kobo.652.1">MainActivity</span></strong><span class="koboSpan" id="kobo.653.1">, or where you want to </span><span class="No-Break"><span class="koboSpan" id="kobo.654.1">use </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.655.1">ComposeView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.656.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.657.1">
&lt;androidx.Compose.ui.platform.ComposeView</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.658.1">
    android:id="@+id/alert_dialog"</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.659.1">
    android:layout_width="match_parent"</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.660.1">
    android:layout_height="match_parent"/&gt;</span></pre></li>
<li><span class="koboSpan" id="kobo.661.1">Let’s also add </span><strong class="source-inline"><span class="koboSpan" id="kobo.662.1">viewBinding</span></strong><span class="koboSpan" id="kobo.663.1"> to our </span><strong class="source-inline"><span class="koboSpan" id="kobo.664.1">build.gradle(Module:app)</span></strong><span class="koboSpan" id="kobo.665.1"> so that we can easily access our view in </span><strong class="source-inline"><span class="koboSpan" id="kobo.666.1">MainActivity</span></strong><span class="koboSpan" id="kobo.667.1">. </span><span class="koboSpan" id="kobo.667.2">Also, if you already have </span><strong class="source-inline"><span class="koboSpan" id="kobo.668.1">viewBinding</span></strong><span class="koboSpan" id="kobo.669.1"> set up, you can skip </span><span class="No-Break"><span class="koboSpan" id="kobo.670.1">this part:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.671.1">
buildFeatures{</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.672.1">
    viewBinding true</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.673.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.674.1">Once we </span><a id="_idIndexMarker226"/><span class="koboSpan" id="kobo.675.1">have synced the project, we </span><a id="_idIndexMarker227"/><span class="koboSpan" id="kobo.676.1">can go ahead and, in </span><strong class="source-inline"><span class="koboSpan" id="kobo.677.1">MainActivity</span></strong><span class="koboSpan" id="kobo.678.1">, access </span><strong class="source-inline"><span class="koboSpan" id="kobo.679.1">ComposeView</span></strong><span class="koboSpan" id="kobo.680.1"> through binding. </span><span class="koboSpan" id="kobo.680.2">Furthermore, it will have a </span><strong class="source-inline"><span class="koboSpan" id="kobo.681.1">setContent{}</span></strong><span class="koboSpan" id="kobo.682.1"> method where you can set all your Composables and wrap it into </span><span class="No-Break"><span class="koboSpan" id="kobo.683.1">your Theme:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.684.1">
class MainActivity : AppCompatActivity() {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.685.1">
    private lateinit var activityBinding:</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.686.1">
    ActivityMainBinding</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.687.1">
    override fun onCreate(savedInstanceState: Bundle?)</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.688.1">
    {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.689.1">
        super.onCreate(savedInstanceState)</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.690.1">
        activityBinding =</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.691.1">
           ActivityMainBinding.inflate(layoutInflater)</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.692.1">
        setContentView(activityBinding.root)</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.693.1">
        activityBinding.alertDialog.setContent {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.694.1">
            GreetingAlertDialog()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.695.1">
        }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.696.1">
    }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.697.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.698.1">Our </span><strong class="source-inline"><span class="koboSpan" id="kobo.699.1">GreetingAlertDialog()</span></strong><span class="koboSpan" id="kobo.700.1"> will have an </span><strong class="source-inline"><span class="koboSpan" id="kobo.701.1">AlertDialog()</span></strong><span class="koboSpan" id="kobo.702.1"> Composable, a </span><a id="_idIndexMarker228"/><span class="koboSpan" id="kobo.703.1">title, and text, which will </span><a id="_idIndexMarker229"/><span class="koboSpan" id="kobo.704.1">provide our message as a simple text element. </span><span class="koboSpan" id="kobo.704.2">The title will say </span><strong class="source-inline"><span class="koboSpan" id="kobo.705.1">Hello</span></strong><span class="koboSpan" id="kobo.706.1"> since this is a greeting, and the message will be </span><strong class="source-inline"><span class="koboSpan" id="kobo.707.1">Hello, and thank you for being part of the Android community</span></strong><span class="koboSpan" id="kobo.708.1">. </span><span class="koboSpan" id="kobo.708.2">You can customize this to fit </span><span class="No-Break"><span class="koboSpan" id="kobo.709.1">your needs:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.710.1">
@Composable</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.711.1">
fun SimpleAlertDialog() {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.712.1">
    AlertDialog(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.713.1">
        onDismissRequest = { },</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.714.1">
        confirmButton = {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.715.1">
            TextButton(onClick = {})</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.716.1">
            { Text(text = "OK") }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.717.1">
        },</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.718.1">
        dismissButton = {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.719.1">
            TextButton(onClick = {})</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.720.1">
            { Text(text = "OK") }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.721.1">
        },</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.722.1">
        title = { Text(text = "Hello") },</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.723.1">
        text = { Text(text = "Hello, and thank you for</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.724.1">
        being part of the Android community") }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.725.1">
    )</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.726.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.727.1">To create Compose components, you will need to add the Compose Material Design dependency to your gradle app. </span><span class="koboSpan" id="kobo.727.2">Depending on what your application supports, you can utilize Compose Material 3 components, which is the next evolution of Material Design and comes with </span><span class="No-Break"><span class="koboSpan" id="kobo.728.1">updated theming.</span></span></li>
<li><span class="koboSpan" id="kobo.729.1">You can </span><a id="_idIndexMarker230"/><span class="koboSpan" id="kobo.730.1">easily customize features such </span><a id="_idIndexMarker231"/><span class="koboSpan" id="kobo.731.1">as dynamic color and more. </span><span class="koboSpan" id="kobo.731.2">We look into Material 3 in </span><a href="B18827_11.xhtml#_idTextAnchor619"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.732.1">Chapter 11</span></em></span></a><span class="koboSpan" id="kobo.733.1">, </span><em class="italic"><span class="koboSpan" id="kobo.734.1">GUI Alerts – What’s New in Menus, Dialog, Toast, Snackbars, and More in Modern Android Development</span></em><span class="koboSpan" id="kobo.735.1">. </span><span class="koboSpan" id="kobo.735.2">Hence, for now, since the application that I am using has not migrated to Material 3, I will use this import – </span><strong class="source-inline"><span class="koboSpan" id="kobo.736.1">implementation "androidx.Compose.material:material:1.x.x"</span></strong><span class="koboSpan" id="kobo.737.1">. </span><span class="koboSpan" id="kobo.737.2">Here, you can use any import that fits </span><span class="No-Break"><span class="koboSpan" id="kobo.738.1">your need.</span></span></li>
<li><span class="koboSpan" id="kobo.739.1">You can also create a custom view that extends </span><span class="No-Break"><span class="koboSpan" id="kobo.740.1">from </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.741.1">AbstractComposeView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.742.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.743.1">
class ComposeAlertDialogComponent @JvmOverloads constructor(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.744.1">
    context: Context,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.745.1">
    attrs: AttributeSet? </span><span class="koboSpan" id="kobo.745.2">= null,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.746.1">
    defStyle: Int = 0</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.747.1">
) : AbstractComposeView(context, attrs, defStyle) {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.748.1">
        @Composable</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.749.1">
    override fun Content() {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.750.1">
        GreetingAlertDialog()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.751.1">
    }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.752.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.753.1">Finally, when </span><a id="_idIndexMarker232"/><span class="koboSpan" id="kobo.754.1">you run your application, you </span><a id="_idIndexMarker233"/><span class="koboSpan" id="kobo.755.1">should have a dialog that has a title and text; </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.756.1">Figure 3</span></em></span><em class="italic"><span class="koboSpan" id="kobo.757.1">.6</span></em><span class="koboSpan" id="kobo.758.1"> shows a dialog from an already pre-existing project, so this will definitely vary based on what steps </span><span class="No-Break"><span class="koboSpan" id="kobo.759.1">you</span><a id="_idTextAnchor162"/><span class="koboSpan" id="kobo.760.1"> took:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer043">
<span class="koboSpan" id="kobo.761.1"><img alt="Figure 3.6 – Dialog Compose view in XML" src="image/Figure_3.6_B18827.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.762.1">Figure 3.6 – Dialog Compose view in XML</span></p>
<h2 id="_idParaDest-95"><a id="_idTextAnchor163"/><span class="koboSpan" id="kobo.763.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.764.1">First, we inflate the XML layout, which we define in our layout </span><strong class="source-inline"><span class="koboSpan" id="kobo.765.1">resource</span></strong><span class="koboSpan" id="kobo.766.1"> folder. </span><span class="koboSpan" id="kobo.766.2">Then, using binding, we got </span><strong class="source-inline"><span class="koboSpan" id="kobo.767.1">ComposeView</span></strong><span class="koboSpan" id="kobo.768.1"> using the created XML ID, set a Compose strategy that works best for our host view, and called </span><strong class="source-inline"><span class="koboSpan" id="kobo.769.1">setContent</span></strong><span class="koboSpan" id="kobo.770.1"> to use Compose. </span><span class="koboSpan" id="kobo.770.2">In your activity, to be able to create any Compose-based screen, you have to ensure that you call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.771.1">setContent{}</span></strong><span class="koboSpan" id="kobo.772.1"> method and pass whatever Composable function you </span><span class="No-Break"><span class="koboSpan" id="kobo.773.1">have created.</span></span></p>
<p><span class="koboSpan" id="kobo.774.1">To further explore the </span><strong class="source-inline"><span class="koboSpan" id="kobo.775.1">setContent</span></strong><span class="koboSpan" id="kobo.776.1"> method, it is written as an extension function of </span><strong class="source-inline"><span class="koboSpan" id="kobo.777.1">ComponentActivity</span></strong><span class="koboSpan" id="kobo.778.1">, and it expects a Composable function as the last parameter. </span><span class="koboSpan" id="kobo.778.2">There is also </span><a id="_idIndexMarker234"/><span class="koboSpan" id="kobo.779.1">a better way to demonstrate </span><a id="_idIndexMarker235"/><span class="koboSpan" id="kobo.780.1">how </span><strong class="source-inline"><span class="koboSpan" id="kobo.781.1">setContent{}</span></strong><span class="koboSpan" id="kobo.782.1"> works to integrate a Composable tree into your </span><span class="No-Break"><span class="koboSpan" id="kobo.783.1">Android application.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer044">
<span class="koboSpan" id="kobo.784.1"><img alt="Figure 3.7 – This happens when you call setContent{}" src="image/Figure_3.7_B18827.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.785.1">Figure 3.7 – This happens when you call setContent{}</span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.786.1">ViewCompositionStrategy</span></strong><span class="koboSpan" id="kobo.787.1"> helps determines when to dispose of the composition; hence, Compose UI views such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.788.1">ComposeView</span></strong><span class="koboSpan" id="kobo.789.1"> and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.790.1">AbstractComposeView</span></strong><span class="koboSpan" id="kobo.791.1"> use </span><strong class="source-inline"><span class="koboSpan" id="kobo.792.1">ViewCompositonStrategy</span></strong><span class="koboSpan" id="kobo.793.1">, which helps define </span><span class="No-Break"><span class="koboSpan" id="kobo.794.1">this behavior.</span></span></p>
<p><span class="koboSpan" id="kobo.795.1">You can learn </span><a id="_idIndexMarker236"/><span class="koboSpan" id="kobo.796.1">more by following this link to learn more about the interoperability </span><span class="No-Break"><span class="koboSpan" id="kobo.797.1">APIs: </span></span><a href="https://developer.android.com/jetpack/compose/interop/interop-apis#composition-strategy"><span class="No-Break"><span class="koboSpan" id="kobo.798.1">https://developer.android.com/jetpack/compose/interop/interop-apis#composition-strategy</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.799.1">.</span></span></p>
<h1 id="_idParaDest-96"><a id="_idTextAnchor164"/><span class="koboSpan" id="kobo.800.1">Understanding and handling recomposition in Jetpack Compose</span></h1>
<p><span class="koboSpan" id="kobo.801.1">Jetpack Compose is still very new, and many companies are starting to use it. </span><span class="koboSpan" id="kobo.801.2">Furthermore, Google </span><a id="_idIndexMarker237"/><span class="koboSpan" id="kobo.802.1">has done a great job by giving </span><a id="_idIndexMarker238"/><span class="koboSpan" id="kobo.803.1">developers significant documentation to help them embrace this new UI toolkit. </span><span class="koboSpan" id="kobo.803.2">However, despite all the documentation, one concept needs to be clarified. </span><span class="koboSpan" id="kobo.803.3">And that </span><span class="No-Break"><span class="koboSpan" id="kobo.804.1">is recomposition.</span></span></p>
<p><span class="koboSpan" id="kobo.805.1">Fair enough, all new software has its ups and downs, and as many people start using it, more people start giving feedback – hence, the need for more improvement. </span><span class="koboSpan" id="kobo.805.2">Recomposition, in Compose, involves calling your Composable again when the input changes. </span><span class="koboSpan" id="kobo.805.3">Or you can think of it when the composition structure and </span><span class="No-Break"><span class="koboSpan" id="kobo.806.1">relation change.</span></span></p>
<p><span class="koboSpan" id="kobo.807.1">Unless its parameters change, we want to avoid a Composable function being re-invoked in most use cases. </span><span class="koboSpan" id="kobo.807.2">So, in this recipe, we look into how recomposition happens and how you can de</span><a id="_idTextAnchor165"/><span class="koboSpan" id="kobo.808.1">bug and solve </span><a id="_idTextAnchor166"/><span class="koboSpan" id="kobo.809.1">any recomposition in </span><span class="No-Break"><span class="koboSpan" id="kobo.810.1">your application.</span></span></p>
<h2 id="_idParaDest-97"><a id="_idTextAnchor167"/><span class="koboSpan" id="kobo.811.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.812.1">Since our view system is simple, we will be checking whether we have any recomposition in our </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.813.1">Login</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.814.1"> project:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.815.1">We can look at a simple example and how recomposition </span><span class="No-Break"><span class="koboSpan" id="kobo.816.1">will occur:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.817.1">
@Composable</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.818.1">
fun UserDetails(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.819.1">
    name: String,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.820.1">
    gender: String,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.821.1">
) {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.822.1">
    Box() {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.823.1">
        Text(name)</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.824.1">
        Spacer()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.825.1">
        Text(gender)</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.826.1">
    }}</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.827.1">In our given example, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.828.1">Text</span></strong><span class="koboSpan" id="kobo.829.1"> function will recompose when </span><strong class="source-inline"><span class="koboSpan" id="kobo.830.1">name</span></strong><span class="koboSpan" id="kobo.831.1"> changes and not when </span><strong class="source-inline"><span class="koboSpan" id="kobo.832.1">gender</span></strong><span class="koboSpan" id="kobo.833.1"> changes. </span><span class="koboSpan" id="kobo.833.2">In addition, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.834.1">gender:String</span></strong><span class="koboSpan" id="kobo.835.1"> input value will recompose only when </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.836.1">gender</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.837.1"> changes.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.838.1">You can also launch and utilize </span><strong class="bold"><span class="koboSpan" id="kobo.839.1">Layout Inspector</span></strong><span class="koboSpan" id="kobo.840.1"> to debug recomposition. </span><span class="koboSpan" id="kobo.840.2">If it is not on </span><a id="_idIndexMarker239"/><span class="koboSpan" id="kobo.841.1">your Android Studio dock, you </span><a id="_idIndexMarker240"/><span class="koboSpan" id="kobo.842.1">can start it by going to </span><strong class="bold"><span class="koboSpan" id="kobo.843.1">View</span></strong><span class="koboSpan" id="kobo.844.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.845.1">Tool Windows</span></strong><span class="koboSpan" id="kobo.846.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.847.1">Layout Inspector</span></strong><span class="koboSpan" id="kobo.848.1">. </span><span class="koboSpan" id="kobo.848.2">We will look into </span><strong class="source-inline"><span class="koboSpan" id="kobo.849.1">LoginContent</span></strong><span class="koboSpan" id="kobo.850.1"> and see whether we have </span><span class="No-Break"><span class="koboSpan" id="kobo.851.1">any recomposition.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer045">
<span class="koboSpan" id="kobo.852.1"><img alt="Figure 3.8 – Layout Inspector" src="image/Figure_3.8_B18827.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.853.1">Figure 3.8 – Layout Inspector</span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.854.1">Once you launch </span><strong class="bold"><span class="koboSpan" id="kobo.855.1">Layout Inspector</span></strong><span class="koboSpan" id="kobo.856.1">, you need to ensure you have your emulator hooked </span><span class="No-Break"><span class="koboSpan" id="kobo.857.1">to it.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer046">
<span class="koboSpan" id="kobo.858.1"><img alt="Figure 3.9 – Linking the inspector" src="image/Figure_3.9_B18827.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.859.1">Figure 3.9 – Linking the inspector</span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.860.1">Go ahead and expand the </span><strong class="source-inline"><span class="koboSpan" id="kobo.861.1">SampleLoginTheme</span></strong><span class="koboSpan" id="kobo.862.1"> entry point, and you will notice our current view system is not complex. </span><span class="koboSpan" id="kobo.862.2">As you can see, </span><strong class="bold"><span class="koboSpan" id="kobo.863.1">Layout Inspector</span></strong><span class="koboSpan" id="kobo.864.1"> does not show any </span><span class="No-Break"><span class="koboSpan" id="kobo.865.1">recomposition counts.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.866.1">That is to say, if our application had any recomposition counts, they would show up in </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.867.1">Layout Inspector</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.868.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer047">
<span class="koboSpan" id="kobo.869.1"><img alt="Figure 3.10 – The component tree" src="image/Figure_3.10_B18827.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.870.1">Figure 3.10 – The component tree</span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.871.1">Finally, as </span><a id="_idIndexMarker241"/><span class="koboSpan" id="kobo.872.1">you have seen, our application </span><a id="_idIndexMarker242"/><span class="koboSpan" id="kobo.873.1">does not have any recomposition happening, but it is always beneficial to check your application to know what might be causing the recomposition and </span><span class="No-Break"><span class="koboSpan" id="kobo.874.1">fix it.</span></span></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.875.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.876.1">Using side-effects might lead to users of your application experiencing strange and unpredictable behavior in your app. </span><span class="koboSpan" id="kobo.876.2">In addition, a side-effect is any change that is visible to the rest of your application. </span><span class="koboSpan" id="kobo.876.3">For instance, writing to a property of a shared object, updating an observable in </span><strong class="source-inline"><span class="koboSpan" id="kobo.877.1">ViewModel</span></strong><span class="koboSpan" id="kobo.878.1">, and updati</span><a id="_idTextAnchor168"/><span class="koboSpan" id="kobo.879.1">ng shared preferences are all dangerous </span><span class="No-Break"><span class="koboSpan" id="kobo.880.1">side effects.</span></span></p>
<h2 id="_idParaDest-98"><a id="_idTextAnchor169"/><span class="koboSpan" id="kobo.881.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.882.1">For adaptability, Compose skips </span><strong class="source-inline"><span class="koboSpan" id="kobo.883.1">lambda</span></strong><span class="koboSpan" id="kobo.884.1"> calls or any child function that does not have any changes to its input. </span><span class="koboSpan" id="kobo.884.2">This better handling of resources makes sense since, in Compose, animations and other UI elements can trigger recomposition in </span><span class="No-Break"><span class="koboSpan" id="kobo.885.1">every frame.</span></span></p>
<p><span class="koboSpan" id="kobo.886.1">We can go in depth </span><a id="_idIndexMarker243"/><span class="koboSpan" id="kobo.887.1">and use a diagram to </span><a id="_idIndexMarker244"/><span class="koboSpan" id="kobo.888.1">showcase how the Jetpack composition life cycle works. </span><span class="koboSpan" id="kobo.888.2">In short, the life cycle of a Composable function is defined by three </span><span class="No-Break"><span class="koboSpan" id="kobo.889.1">significant events:</span></span></p>
<ul>
<li><span class="No-Break"><span class="koboSpan" id="kobo.890.1">Being composed</span></span></li>
<li><span class="koboSpan" id="kobo.891.1">Getting recomposed or not </span><span class="No-Break"><span class="koboSpan" id="kobo.892.1">getting recomposed</span></span></li>
<li><span class="koboSpan" id="kobo.893.1">No longer </span><span class="No-Break"><span class="koboSpan" id="kobo.894.1">being composed</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer048">
<span class="koboSpan" id="kobo.895.1"><img alt="Figure 3.11 – The composition life cycle of a Composable" src="image/Figure_3.11_B18827.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.896.1">Figure 3.11 – The composition life cycle of a Composable</span></p>
<p><span class="koboSpan" id="kobo.897.1">To fathom how Compose works, it’s good to know what constitutes the Compose architectural layer. </span><span class="koboSpan" id="kobo.897.2">A high-level overview of the Jetpack Compose architectural layer includes </span><strong class="bold"><span class="koboSpan" id="kobo.898.1">Material</span></strong><span class="koboSpan" id="kobo.899.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.900.1">Foundation</span></strong><span class="koboSpan" id="kobo.901.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.902.1">UI</span></strong><span class="koboSpan" id="kobo.903.1">, and </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.904.1">Runtime</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.905.1"> aspects.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer049">
<span class="koboSpan" id="kobo.906.1"><img alt="Figure 3.12 – A diagram showing Jetpack Compose Architectural Layers" src="image/Figure_3.12_B18827.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.907.1">Figure 3.12 – A diagram showing Jetpack Compose Architectural Layers</span></p>
<p><span class="koboSpan" id="kobo.908.1">In </span><strong class="bold"><span class="koboSpan" id="kobo.909.1">Material</span></strong><span class="koboSpan" id="kobo.910.1">, this module implements the Material Design system for the </span><span class="No-Break"><span class="koboSpan" id="kobo.911.1">Compose UI.</span></span></p>
<p><span class="koboSpan" id="kobo.912.1">Furthermore, it </span><a id="_idIndexMarker245"/><span class="koboSpan" id="kobo.913.1">provides a theming system, styled </span><a id="_idIndexMarker246"/><span class="koboSpan" id="kobo.914.1">components, and more. </span><strong class="bold"><span class="koboSpan" id="kobo.915.1">Foundation</span></strong><span class="koboSpan" id="kobo.916.1"> is where we have the design system building blocks such as the UI, </span><strong class="source-inline"><span class="koboSpan" id="kobo.917.1">Row</span></strong><span class="koboSpan" id="kobo.918.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.919.1">Column</span></strong><span class="koboSpan" id="kobo.920.1">, and more. </span><span class="koboSpan" id="kobo.920.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.921.1">UI</span></strong><span class="koboSpan" id="kobo.922.1"> layer is made of multiple mod</span><a id="_idTextAnchor170"/><span class="koboSpan" id="kobo.923.1">ules that</span><a id="_idTextAnchor171"/><span class="koboSpan" id="kobo.924.1"> implement the fundamentals of the </span><span class="No-Break"><span class="koboSpan" id="kobo.925.1">UI toolkit.</span></span></p>
<h2 id="_idParaDest-99"><a id="_idTextAnchor172"/><span class="koboSpan" id="kobo.926.1">See also</span></h2>
<p><span class="koboSpan" id="kobo.927.1">The Compose team is launching Jetpack Compose Composition Tracing, the first alpha that will help developers</span><a id="_idTextAnchor173"/><span class="koboSpan" id="kobo.928.1"> trace their composition easily; you can read </span><span class="No-Break"><span class="koboSpan" id="kobo.929.1">more here:</span></span></p>
<ul>
<li><a href="https://medium.com/androiddevelopers/jetpack-Compose-composition-tracing-9ec2b3aea535"><span class="No-Break"><span class="koboSpan" id="kobo.930.1">https://medium.com/androiddevelopers/jetpack-Compose-composition-tracing-9ec2b3aea535</span></span></a></li>
<li><a href="https://developer.android.com/jetpack/compose/lifecycle"><span id="_idTextAnchor174"/><span class="No-Break"><span class="koboSpan" id="kobo.931.1">https://developer.android.com/jetpack/compose/lifecycle</span></span></a></li>
</ul>
<h1 id="_idParaDest-100"><a id="_idTextAnchor175"/><span class="koboSpan" id="kobo.932.1">Writing UI tests for your Compose views</span></h1>
<p><span class="koboSpan" id="kobo.933.1">It is essential to test your code when developing Android applications, especially if your applications </span><a id="_idIndexMarker247"/><span class="koboSpan" id="kobo.934.1">have many users. </span><span class="koboSpan" id="kobo.934.2">Furthermore, when you </span><a id="_idIndexMarker248"/><span class="koboSpan" id="kobo.935.1">write tests for your code, you basically verify the functions, behavior, correctness, and versatility of the Android application. </span><span class="koboSpan" id="kobo.935.2">The most popular UI testing tools in Android are Espresso, UI Automator, Calabash, </span><span class="No-Break"><span class="koboSpan" id="kobo.936.1">and Detox.</span></span></p>
<p><span class="koboSpan" id="kobo.937.1">In this book, however, we will use Espresso. </span><span class="koboSpan" id="kobo.937.2">The most notable advantages of Espresso are </span><span class="No-Break"><span class="koboSpan" id="kobo.938.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.939.1">It is easy to </span><span class="No-Break"><span class="koboSpan" id="kobo.940.1">set up</span></span></li>
<li><span class="koboSpan" id="kobo.941.1">It has </span><a id="_idIndexMarker249"/><span class="koboSpan" id="kobo.942.1">highly stable </span><span class="No-Break"><span class="koboSpan" id="kobo.943.1">test cycles</span></span></li>
<li><span class="koboSpan" id="kobo.944.1">It supports </span><span class="No-Break"><span class="koboSpan" id="kobo.945.1">JUnit 4</span></span></li>
<li><span class="koboSpan" id="kobo.946.1">It is made purely for Android </span><span class="No-Break"><span class="koboSpan" id="kobo.947.1">UI testing</span></span></li>
<li><span class="koboSpan" id="kobo.948.1">It is suitable for writing </span><span class="No-Break"><span class="koboSpan" id="kobo.949.1">black-box tests</span></span></li>
<li><span class="koboSpan" id="kobo.950.1">It s</span><a id="_idTextAnchor176"/><span class="koboSpan" id="kobo.951.1">upports testing activities outside the application </span><span class="No-Break"><span class="koboSpan" id="kobo.952.1">as well</span></span></li>
</ul>
<h2 id="_idParaDest-101"><a id="_idTextAnchor177"/><span class="koboSpan" id="kobo.953.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.954.1">You will need to have</span><a id="_idTextAnchor178"/><span class="koboSpan" id="kobo.955.1"> completed previous recipes to follow along with </span><span class="No-Break"><span class="koboSpan" id="kobo.956.1">this one.</span></span></p>
<h2 id="_idParaDest-102"><a id="_idTextAnchor179"/><span class="koboSpan" id="kobo.957.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.958.1">As with the other recipes in this chapter, we will use the new project we created in </span><a href="B18827_01.xhtml#_idTextAnchor014"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.959.1">Chapter 1</span></em></span></a><span class="koboSpan" id="kobo.960.1">, </span><em class="italic"><span class="koboSpan" id="kobo.961.1">Getting Started with Modern Android </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.962.1">Development Skills</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.963.1">:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.964.1">Let’s go ahead and navigate into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.965.1">androidTest</span></strong><span class="koboSpan" id="kobo.966.1"> package in our </span><span class="No-Break"><span class="koboSpan" id="kobo.967.1">project folder.</span></span></li>
<li><span class="koboSpan" id="kobo.968.1">Start by creating a new class in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.969.1">androidTest</span></strong><span class="koboSpan" id="kobo.970.1"> package and call it </span><strong class="source-inline"><span class="koboSpan" id="kobo.971.1">LoginContentTest.kt</span></strong><span class="koboSpan" id="kobo.972.1">. </span><span class="koboSpan" id="kobo.972.2">In Jetpack Compose, testing is made more accessible, and we need to have unique tags for </span><span class="No-Break"><span class="koboSpan" id="kobo.973.1">our views.</span></span></li>
<li><span class="koboSpan" id="kobo.974.1">So, for this step, let’s go back to our main package (</span><strong class="source-inline"><span class="koboSpan" id="kobo.975.1">com.name.SampleLogin</span></strong><span class="koboSpan" id="kobo.976.1">) and create a new package and call it </span><strong class="source-inline"><span class="koboSpan" id="kobo.977.1">util</span></strong><span class="koboSpan" id="kobo.978.1">. </span><span class="koboSpan" id="kobo.978.2">Inside </span><strong class="source-inline"><span class="koboSpan" id="kobo.979.1">util</span></strong><span class="koboSpan" id="kobo.980.1">, let’s create a new class and call it </span><strong class="source-inline"><span class="koboSpan" id="kobo.981.1">TestTags</span></strong><span class="koboSpan" id="kobo.982.1">, which will be an object. </span><span class="koboSpan" id="kobo.982.2">Here, we will have another object, name it </span><strong class="source-inline"><span class="koboSpan" id="kobo.983.1">LoginContent</span></strong><span class="koboSpan" id="kobo.984.1">, and create constant values that we can call in </span><span class="No-Break"><span class="koboSpan" id="kobo.985.1">our view:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.986.1">
object TestTags {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.987.1">
    object LoginContent {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.988.1">
        const val SIGN_IN_BUTTON = "sign_in_button"</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.989.1">
        const val LOGO_IMAGE = "logo_image_button"</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.990.1">
        const val ANDROID_TEXT = "community_text"</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.991.1">
        const val USERNAME_FIELD = "username_fields"</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.992.1">
        const val PASSWORD_FIELD = "password_fields"</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.993.1">
    }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.994.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.995.1">Now that we have created the test tags, let’s go back to our </span><strong class="source-inline"><span class="koboSpan" id="kobo.996.1">LoginContent</span></strong><span class="koboSpan" id="kobo.997.1"> and </span><a id="_idIndexMarker250"/><span class="koboSpan" id="kobo.998.1">add them to all views in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.999.1">Modifier()</span></strong><span class="koboSpan" id="kobo.1000.1"> so that </span><a id="_idIndexMarker251"/><span class="koboSpan" id="kobo.1001.1">when we test, it is easier to identify the view using the test tag we have added. </span><span class="koboSpan" id="kobo.1001.2">See the following </span><span class="No-Break"><span class="koboSpan" id="kobo.1002.1">code snippet:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1003.1">
Image(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1004.1">
    modifier = modifier.testTag(LOGO_IMAGE),</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1005.1">
    painter = painterResource(id =</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1006.1">
        R.drawable.ic_launcher_foreground),</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1007.1">
    contentDescription = "Logo"</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1008.1">
)</span></pre></li>
<li><span class="koboSpan" id="kobo.1009.1">Inside our </span><strong class="source-inline"><span class="koboSpan" id="kobo.1010.1">LoginCotentTest</span></strong><span class="koboSpan" id="kobo.1011.1"> class, let’s now go ahead and set up our testing environment. </span><span class="koboSpan" id="kobo.1011.2">We will need to create </span><strong class="source-inline"><span class="koboSpan" id="kobo.1012.1">@get:Rule</span></strong><span class="koboSpan" id="kobo.1013.1">, which annotates fields that reference rules or methods that return a rule. </span><span class="koboSpan" id="kobo.1013.2">Under the rule, let’s create </span><strong class="source-inline"><span class="koboSpan" id="kobo.1014.1">ComposeRuleTest</span></strong><span class="koboSpan" id="kobo.1015.1"> and </span><span class="No-Break"><span class="koboSpan" id="kobo.1016.1">initialize it:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1017.1">
@get:Rule</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1018.1">
val ComposeRuleTest = createAndroidComposeRule&lt;MainActivity&gt;()</span></pre></li>
<li><span class="koboSpan" id="kobo.1019.1">Add the following function to help us set up the content. </span><span class="koboSpan" id="kobo.1019.2">We should call this function in our </span><strong class="source-inline"><span class="koboSpan" id="kobo.1020.1">Test</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1021.1">annotated function:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1022.1">
private fun initCompose() {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1023.1">
    ComposeRuleTest.activity.setContent {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1024.1">
        SampleLoginTheme {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1025.1">
            LoginContent()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1026.1">
        }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1027.1">
    }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1028.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.1029.1">Finally, let’s </span><a id="_idIndexMarker252"/><span class="koboSpan" id="kobo.1030.1">go ahead and add our first test. </span><span class="koboSpan" id="kobo.1030.2">For </span><a id="_idIndexMarker253"/><span class="koboSpan" id="kobo.1031.1">the tests we will write, we will verify that the views are displayed on the screen as we expect them </span><span class="No-Break"><span class="koboSpan" id="kobo.1032.1">to be:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1033.1">
@Test</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1034.1">
fun assertSignInButtonIsDisplayed(){</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1035.1">
    initCompose()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1036.1">
    ComposeRuleTest.onNodeWithTag(SIGN_IN_BUTTON,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1037.1">
    true).assertIsDisplayed()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1038.1">
}</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1039.1">
@Test</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1040.1">
fun assertUserInputFieldIsDisplayed(){</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1041.1">
    initCompose()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1042.1">
    ComposeRuleTest.onNodeWithTag(USERNAME_FIELD,</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1043.1">
    true).assertIsDisplayed()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1044.1">
}</span></pre></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1045.1">SIGN_IN_BUTTON</span></strong><span class="koboSpan" id="kobo.1046.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1047.1">USERNAME_FIELD</span></strong><span class="koboSpan" id="kobo.1048.1"> are imported from the test tags that we have created and are already used by only one view, the </span><span class="No-Break"><span class="koboSpan" id="kobo.1049.1">sign-in button.</span></span></li>
<li><span class="koboSpan" id="kobo.1050.1">Go ahead </span><a id="_idIndexMarker254"/><span class="koboSpan" id="kobo.1051.1">and run the tests, and a dialog will pop </span><a id="_idIndexMarker255"/><span class="koboSpan" id="kobo.1052.1">up showing the running process; if successful, the tests will pass. </span><span class="koboSpan" id="kobo.1052.2">In our case, the tests </span><span class="No-Break"><span class="koboSpan" id="kobo.1053.1">should pass.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer050">
<span class="koboSpan" id="kobo.1054.1"><img alt="" src="image/Figure_3.13_B18827.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1055.1">Figure 3.13 – A screenshot showing passing tests</span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.1056.1">Important note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.1057.1">For these tests, you will not need to add any dep</span><a id="_idTextAnchor180"/><span class="koboSpan" id="kobo.1058.1">endencies; everything we need is already available for </span><span class="No-Break"><span class="koboSpan" id="kobo.1059.1">our use.</span></span></p>
<h2 id="_idParaDest-103"><a id="_idTextAnchor181"/><span class="koboSpan" id="kobo.1060.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.1061.1">We use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1062.1">createAndroidComposeRule&lt;&gt;()</span></strong><span class="koboSpan" id="kobo.1063.1"> when accessing an activity. </span><span class="koboSpan" id="kobo.1063.2">Testing and ensuring your applications display the expected outcome is essential. </span><span class="koboSpan" id="kobo.1063.3">This is why Android Studio uses the emulator to help developers test their code to ensure their application functions as it would on </span><span class="No-Break"><span class="koboSpan" id="kobo.1064.1">standard devices.</span></span></p>
<p><span class="koboSpan" id="kobo.1065.1">Furthermore, Android phones come with a developers’ option ready for developers to use, making it even easier for the different number of devices that Android supports and helping reproduce bugs that are hard to find </span><span class="No-Break"><span class="koboSpan" id="kobo.1066.1">in emulators.</span></span></p>
<p><span class="koboSpan" id="kobo.1067.1">When we test our Compose code, we improve our app’s quality by catching errors early on in the development process. </span><span class="koboSpan" id="kobo.1067.2">In this chapter, we touched on creating more views to demonstrate how Jetpack Compose works; furthermore, our test cases need to address user action since we did not </span><span class="No-Break"><span class="koboSpan" id="kobo.1068.1">implement any.</span></span></p>
<p><span class="koboSpan" id="kobo.1069.1">In a different setting, we can write more crucial tests to confirm the intended action, and we will do this in later chapters. </span><span class="koboSpan" id="kobo.1069.2">Furthermore, Compose provides testing APIs to find elements, verify their attributes, and perform user actions. </span><span class="koboSpan" id="kobo.1069.3">Moreover, they also include advanced features such as time manipulation, </span><span class="No-Break"><span class="koboSpan" id="kobo.1070.1">among others.</span></span></p>
<p><span class="koboSpan" id="kobo.1071.1">Explicitly </span><a id="_idIndexMarker256"/><span class="koboSpan" id="kobo.1072.1">calling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1073.1">@Test</span></strong><span class="koboSpan" id="kobo.1074.1"> annotation is very important </span><a id="_idIndexMarker257"/><span class="koboSpan" id="kobo.1075.1">when writing tests since this annotation tells JUnit that the function to which it is attached is to run as a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1076.1">Test</span></strong><span class="koboSpan" id="kobo.1077.1"> function. </span><span class="koboSpan" id="kobo.1077.2">In addition, UI tests in Compose use </span><strong class="bold"><span class="koboSpan" id="kobo.1078.1">Semantics</span></strong><span class="koboSpan" id="kobo.1079.1"> to interact with the UI hierarchy. </span><span class="koboSpan" id="kobo.1079.2">And semantics, as the name implies, give meaning to a piece of UI, for </span><span class="No-Break"><span class="koboSpan" id="kobo.1080.1">example, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1081.1">.onNodeWithTag</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1082.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1083.1">A UI portion or element can mean anything from a single Composable to a full screen. </span><span class="koboSpan" id="kobo.1083.2">If you try to access the wrong node, the semantics tree, which is generated alongside the UI hierarchy, </span><span class="No-Break"><span class="koboSpan" id="kobo.1084.1">will complain.</span></span></p>
<h2 id="_idParaDest-104"><a id="_idTextAnchor182"/><span class="koboSpan" id="kobo.1085.1">There’s more…</span></h2>
<p><span class="koboSpan" id="kobo.1086.1">There are other testing tools </span><span class="No-Break"><span class="koboSpan" id="kobo.1087.1">as follows:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.1088.1">Espresso Test Recorder</span></strong><span class="koboSpan" id="kobo.1089.1"> provides developers with a faster, interactive way to test </span><a id="_idIndexMarker258"/><span class="koboSpan" id="kobo.1090.1">their app’s everyday user input behavior and </span><span class="No-Break"><span class="koboSpan" id="kobo.1091.1">visual elements.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1092.1">App Crawler</span></strong><span class="koboSpan" id="kobo.1093.1"> undoubtedly uses a more hands-off approach to help you test user actions </span><a id="_idIndexMarker259"/><span class="koboSpan" id="kobo.1094.1">without needing to maintain or write any code. </span><span class="koboSpan" id="kobo.1094.2">With this tool, you can easily configure your inputs, such as entering your username and </span><span class="No-Break"><span class="koboSpan" id="kobo.1095.1">password credentials.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1096.1">Monkey</span></strong><span class="koboSpan" id="kobo.1097.1"> is a command-line </span><a id="_idIndexMarker260"/><span class="koboSpan" id="kobo.1098.1">device that also stress-tests your app by sending a random flow of user validation/input or tap actions into the device or </span><span class="No-Break"><span class="koboSpan" id="kobo.1099.1">emulator instance.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1100.1">To learn more </span><a id="_idIndexMarker261"/><span class="koboSpan" id="kobo.1101.1">about testing and semantics in Compose, read the </span><span class="No-Break"><span class="koboSpan" id="kobo.1102.1">following: </span></span><a href="https://developer.android.com/jetpack/compose/semantics"><span class="No-Break"><span class="koboSpan" id="kobo.1103.1">https://developer.android.com/jetpack/compose/semantics</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1104.1">.</span></span></p>
<h1 id="_idParaDest-105"><a id="_idTextAnchor183"/><span class="koboSpan" id="kobo.1105.1">Writing tests for your ViewModels</span></h1>
<p><span class="koboSpan" id="kobo.1106.1">Unlike </span><strong class="bold"><span class="koboSpan" id="kobo.1107.1">Model-View-Controller</span></strong><span class="koboSpan" id="kobo.1108.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1109.1">MVC</span></strong><span class="koboSpan" id="kobo.1110.1">) and </span><strong class="bold"><span class="koboSpan" id="kobo.1111.1">Model-View-Presenter</span></strong><span class="koboSpan" id="kobo.1112.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1113.1">MVP</span></strong><span class="koboSpan" id="kobo.1114.1">), MVVM is the favored </span><a id="_idIndexMarker262"/><span class="koboSpan" id="kobo.1115.1">design pattern in Modern Android Development </span><a id="_idIndexMarker263"/><span class="koboSpan" id="kobo.1116.1">because of its unidirectional data and </span><a id="_idIndexMarker264"/><span class="koboSpan" id="kobo.1117.1">dependency flow. </span><span class="koboSpan" id="kobo.1117.2">Furthermore, </span><a id="_idTextAnchor184"/><span class="koboSpan" id="kobo.1118.1">it becomes more accessible </span><a id="_idIndexMarker265"/><span class="koboSpan" id="kobo.1119.1">to unit test, as you will see in </span><span class="No-Break"><span class="koboSpan" id="kobo.1120.1">this recipe.</span></span></p>
<h2 id="_idParaDest-106"><a id="_idTextAnchor185"/><span class="koboSpan" id="kobo.1121.1">Getting ready</span></h2>
<p><span class="koboSpan" id="kobo.1122.1">We will use our previous recipe, </span><em class="italic"><span class="koboSpan" id="kobo.1123.1">Implementing ViewModel and</span><a id="_idTextAnchor186"/><span class="koboSpan" id="kobo.1124.1"> understanding the state in Compose</span></em><span class="koboSpan" id="kobo.1125.1">, to test our logic and </span><span class="No-Break"><span class="koboSpan" id="kobo.1126.1">state changes.</span></span></p>
<h2 id="_idParaDest-107"><a id="_idTextAnchor187"/><span class="koboSpan" id="kobo.1127.1">How to do it…</span></h2>
<p><span class="koboSpan" id="kobo.1128.1">In this recipe, we will write unit tests to verify our authentication state changes since that is what we have implemented </span><span class="No-Break"><span class="koboSpan" id="kobo.1129.1">so far:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.1130.1">Start by creating a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1131.1">LoginViewModelTest</span></strong><span class="koboSpan" id="kobo.1132.1"> class in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1133.1">test</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1134.1"> package:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer051">
<span class="koboSpan" id="kobo.1135.1"><img alt="Figure 3.14 – Created unit test" src="image/Figure_3.14_B18827.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1136.1">Figure 3.14 – Created unit test</span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.1137.1">We will use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1138.1">cashapp/turbine</span></strong><span class="koboSpan" id="kobo.1139.1"> testing library for coroutine flows to test the flow we </span><a id="_idIndexMarker266"/><span class="koboSpan" id="kobo.1140.1">have created. </span><span class="koboSpan" id="kobo.1140.2">Hence, you will need to </span><a id="_idIndexMarker267"/><span class="koboSpan" id="kobo.1141.1">include the processing code snippet </span><span class="No-Break"><span class="koboSpan" id="kobo.1142.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1143.1">build.gradle</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1144.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1145.1">
repositories {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1146.1">
  mavenCentral()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1147.1">
}</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1148.1">
dependencies {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1149.1">
  testImplementation 'app.cash.turbine:turbine:0.x.x'</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1150.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.1151.1">Once you have created the class, go ahead and set up </span><strong class="source-inline"><span class="koboSpan" id="kobo.1152.1">@Before</span></strong><span class="koboSpan" id="kobo.1153.1">, which will run before </span><span class="No-Break"><span class="koboSpan" id="kobo.1154.1">each test:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1155.1">
class LoginViewModelTest {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1156.1">
   private lateinit var loginViewModel: LoginViewModel</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1157.1">
   @Before</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1158.1">
   fun setUp(){</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1159.1">
      loginViewModel = LoginViewModel(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1160.1">
         dispatchers =</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1161.1">
         SampleLoginDispatchers.createTestDispatchers(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1162.1">
         UnconfinedTestDispatcher()),</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1163.1">
         stateHandle = SavedStateHandle()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1164.1">
      )</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1165.1">
   }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1166.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.1167.1"> As you can see, we utilized </span><strong class="source-inline"><span class="koboSpan" id="kobo.1168.1">SampleLoginDispatchers.createTestDispatchers</span></strong><span class="koboSpan" id="kobo.1169.1">. </span><span class="koboSpan" id="kobo.1169.2">For </span><strong class="source-inline"><span class="koboSpan" id="kobo.1170.1">UnconfinedTestDispatcher</span></strong><span class="koboSpan" id="kobo.1171.1">, you must include the testing dependencies and import, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1172.1">import kotlinx.coroutines.test.UnconfinedTestDispatcher</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1173.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.1174.1">Now that </span><a id="_idIndexMarker268"/><span class="koboSpan" id="kobo.1175.1">we have our setup ready let us go ahead </span><a id="_idIndexMarker269"/><span class="koboSpan" id="kobo.1176.1">and create our test, verifying the authentication </span><span class="No-Break"><span class="koboSpan" id="kobo.1177.1">state changes:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1178.1">
@Test</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1179.1">
fun `test authentication state changes`() = runTest {...}</span></pre></li>
<li><span class="koboSpan" id="kobo.1180.1">Inside our </span><strong class="source-inline"><span class="koboSpan" id="kobo.1181.1">Test</span></strong><span class="koboSpan" id="kobo.1182.1"> function, we will now need to access the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1183.1">loginViewModel</span></strong><span class="koboSpan" id="kobo.1184.1"> functions and pass fake values to </span><span class="No-Break"><span class="koboSpan" id="kobo.1185.1">the parameters:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.1186.1">
@Test</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1187.1">
fun `test authentication state changes`() = runTest {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1188.1">
    loginViewModel.userNameChanged("Madona")</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1189.1">
    loginViewModel.passwordChanged("home")</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1190.1">
    loginViewModel.passwordVisibility(true)</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1191.1">
    loginViewModel.state.test {</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1192.1">
        val stateChange = awaitItem()</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1193.1">
        Truth.assertThat(stateChange).isEqualTo(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1194.1">
            AuthenticationState(</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1195.1">
                userName = "Madona",</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1196.1">
                password = "home",</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1197.1">
                togglePasswordVisibility = true</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1198.1">
            )</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1199.1">
        )</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1200.1">
    }</span></pre><pre class="source-code"><span class="koboSpan" id="kobo.1201.1">
}</span></pre></li>
<li><span class="koboSpan" id="kobo.1202.1">Finally, go ah</span><a id="_idTextAnchor188"/><span class="koboSpan" id="kobo.1203.1">ead and run the test, and it </span><span class="No-Break"><span class="koboSpan" id="kobo.1204.1">should pass.</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer052">
<span class="koboSpan" id="kobo.1205.1"><img alt="Figure 3.15 – Unit test passing" src="image/Figure_3.15_B18827.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1206.1">Figure 3.15 – Unit test passing</span></p>
<h2 id="_idParaDest-108"><a id="_idTextAnchor189"/><span class="koboSpan" id="kobo.1207.1">How it works…</span></h2>
<p><span class="koboSpan" id="kobo.1208.1">As mentioned before, the most notable advantage of MVVM is being able to write code you can quickly </span><a id="_idIndexMarker270"/><span class="koboSpan" id="kobo.1209.1">test. </span><span class="koboSpan" id="kobo.1209.2">In addition, architecture in Android is all about </span><a id="_idIndexMarker271"/><span class="koboSpan" id="kobo.1210.1">selecting the trade-offs. </span><span class="koboSpan" id="kobo.1210.2">Each architecture has its pros and cons; based on your company’s needs, you might work with a </span><span class="No-Break"><span class="koboSpan" id="kobo.1211.1">different one.</span></span></p>
<p><span class="koboSpan" id="kobo.1212.1">We create </span><strong class="source-inline"><span class="koboSpan" id="kobo.1213.1">lateint var loginViewModel</span></strong><span class="koboSpan" id="kobo.1214.1"> to set up a class for testing, and this is because the logic to be tested is </span><span class="No-Break"><span class="koboSpan" id="kobo.1215.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1216.1">ViewModel</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1217.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1218.1">We use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1219.1">UnconfinedDispatcher</span></strong><span class="koboSpan" id="kobo.1220.1">, which creates an instance of an </span><strong class="source-inline"><span class="koboSpan" id="kobo.1221.1">Unconfined</span></strong><span class="koboSpan" id="kobo.1222.1"> dispatcher. </span><span class="koboSpan" id="kobo.1222.2">That means the tasks it executes are not confined to any particular thread and form an event loop. </span><span class="koboSpan" id="kobo.1222.3">It is different in that it skips delays, as all </span><strong class="source-inline"><span class="koboSpan" id="kobo.1223.1">TestDispatcher</span></strong><span class="koboSpan" id="kobo.1224.1"> instances do. </span><span class="koboSpan" id="kobo.1224.2">And by default, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1225.1">runTest()</span></strong><span class="koboSpan" id="kobo.1226.1"> provides </span><strong class="source-inline"><span class="koboSpan" id="kobo.1227.1">StandardTestDispatcher</span></strong><span class="koboSpan" id="kobo.1228.1">, which does not execute child </span><span class="No-Break"><span class="koboSpan" id="kobo.1229.1">coroutines immediately.</span></span></p>
<p><span class="koboSpan" id="kobo.1230.1">We use </span><strong class="source-inline"><span class="koboSpan" id="kobo.1231.1">Truth</span></strong><span class="koboSpan" id="kobo.1232.1"> for our assertation to help us make more readable code, and the significant advantages of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1233.1">Truth</span></strong><span class="koboSpan" id="kobo.1234.1"> are </span><span class="No-Break"><span class="koboSpan" id="kobo.1235.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1236.1">It aligns the actual values to </span><span class="No-Break"><span class="koboSpan" id="kobo.1237.1">the left</span></span></li>
<li><span class="koboSpan" id="kobo.1238.1">It gives us more detailed </span><span class="No-Break"><span class="koboSpan" id="kobo.1239.1">failure messages</span></span></li>
<li><span class="koboSpan" id="kobo.1240.1">It offers richer operations to help </span><span class="No-Break"><span class="koboSpan" id="kobo.1241.1">with testing</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1242.1">There are </span><a id="_idIndexMarker272"/><span class="koboSpan" id="kobo.1243.1">also other alternatives, such as Mockito, Mockk, and </span><a id="_idIndexMarker273"/><span class="koboSpan" id="kobo.1244.1">more, but in this section, we have used </span><strong class="source-inline"><span class="koboSpan" id="kobo.1245.1">Truth</span></strong><span class="koboSpan" id="kobo.1246.1">. </span><span class="koboSpan" id="kobo.1246.2">We have also used a library by Cashapp that helps us test coroutine flows. </span><span class="koboSpan" id="kobo.1246.3">You can learn more </span><a id="_idIndexMarker274"/><span class="koboSpan" id="kobo.1247.1">about the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1248.1">turbine</span></strong><span class="koboSpan" id="kobo.1249.1"> library </span><span class="No-Break"><span class="koboSpan" id="kobo.1250.1">here: </span></span><a href="https://github.com/cashapp/turbine"><span class="No-Break"><span class="koboSpan" id="kobo.1251.1">https://github.com/cashapp/turbine</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1252.1">.</span></span></p>
</div>
</body></html>