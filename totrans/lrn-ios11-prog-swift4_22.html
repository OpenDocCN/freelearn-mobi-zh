<html><head></head><body>
      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Saving Reviews</h1>
            
         </header>
         
         
         <article>
            
            
            <p>We are just about done with our app. In this chapter, we will finally start saving
               reviews and photos into Core Data. We will then learn how to pull data from Core Data
               and display them in our app. A lot of the setup is already done for us and most of
               what we are doing is calling methods we created earlier in the book.
            </p>
            
            <p>In this chapter, you will learn how to:</p>
            
            <ul>
               
               <li>Save items to Core Data</li>
               
               <li>Fetch items from Core Data</li>
               
               <li>Display items from Core Data into a Table View</li>
               
            </ul>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Saving reviews </h1>
            
         </header>
         
         
         <article>
            
            
            <p>First, we will start with saving reviews into Core Data. Open up <kbd>ReviewFormViewController.swift</kbd> and above the <kbd>@IBOutlets</kbd> add the following variable:
            </p>
            <pre>var selectedRestaurantID:Int?</pre>
            <p>Next, delete everything inside your <kbd>onSavedTapped(:)</kbd> method and then add the following:
            </p>
            <pre>@IBAction func onSaveTapped(_ sender: Any) {<br/><br/>  var item = ReviewItem()<br/>  item.name = tfName.text<br/>  item.customerReview = tvReview.text<br/>  item.restaurantID = selectedRestaurantID<br/>  item.rating = Float(ratingView.rating)<br/>  let manager = CoreDataManager()<br/>  manager.addReview(item)<br/>  dismiss(animated: true, completion: nil)<br/>}</pre>
            <p>This code is all we need to do to save an item into Core Data using our <kbd>CoreDataManager</kbd>. To display reviews for a particular restaurant, we need to save all reviews with
               a restaurant identifier. Then, when we go to a certain restaurant, we will use the
               restaurant identifier to search Core Data to see if there are any saved reviews. We
               pass this identifier using a segue.
            </p>
            
            <ol>
               
               <li>Open <kbd>RestaurantDetail.storyboard</kbd> and select the segue we are using to go to the <kbd>ReviewForm</kbd>.
               </li>
               
               <li>In the Attributes inspector of the Utilities panel, update <span class="packt_screen">Identifier</span> under <span class="packt_screen">Storyboard Segue</span> to say <kbd>showReview</kbd>. Then, hit <em>Enter</em>.
               </li>
               
               <li>Next, we need to make sure that, when a user creates a review, we pass <kbd>restaurantID</kbd> to the <span class="packt_screen">Review Form View Controller</span>. We need to update our <kbd>RestaurantItem</kbd> so it has an ID. Open <kbd>RestaurantItem</kbd> after var <kbd>imageURL:String?</kbd> and add the following:
               </li>
               
            </ol>
            
            <p> </p>
            <pre style="padding-left: 60px">var restaurantID:String?</pre>
            <ol start="4">
               
               <li>Next, inside the enum <kbd>CodingKeys:String</kbd> add the new case:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">case restaurantID = "id"</pre>
            <ol start="5">
               
               <li>Open <kbd>RestaurantDetailViewController.swift</kbd> and add this method after the <kbd>viewDidLoad()</kbd> method (ignore the errors for now):
               </li>
               
            </ol>
            <pre style="padding-left: 60px">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {<br/>   if let identifier = segue.identifier {<br/>         switch identifier {<br/>         case Segue.showReview.rawValue:<br/>               showReview(segue: segue)<br/>         default:<br/>               print("Segue not added")<br/>         }<br/>   }<br/>}</pre>
            <p style="padding-left: 60px">The <kbd>prepare()</kbd> method inside the <kbd>RestaurantDetailViewController</kbd> will check for the <kbd>showReview</kbd> segue identifier. If successful, it will call the <kbd>showReview()</kbd> method, which will take you to the Reviews list. 
            </p>
            
            <ol start="6">
               
               <li>Next, add the following method above the <kbd>createRating()</kbd> method inside the private extension:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">func showReview(segue:UIStoryboardSegue) {<br/>    guard let navController = segue.destination as? UINavigationController,<br/>        let viewController = navController.topViewController as? ReviewFormViewController else {<br/>            return<br/>    }<br/>    viewController.selectedRestaurantID = selectedRestaurant?.restaurantID<br/>}</pre>
            <ol start="7">
               
               <li>While we are cleaning up, move the <kbd>initialize()</kbd> method into the <kbd>private</kbd> extension.
               </li>
               
               <li>Next, open <kbd>ReviewFormViewController</kbd>; let's create a <kbd>private</kbd> extension and move<kbd>onSaveTapped(_:)</kbd> into it. Then, delete everything inside the method and update the method with the
                  following:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">private extension ReviewFormViewController {<br/>    @IBAction func onSaveTapped(_ sender: Any) {<br/>        var item = ReviewItem()<br/>        item.name = tfName.text<br/>        item.customerReview = tvReview.text<br/>        item.restaurantID = selectedRestaurantID<br/>        item.rating = Float(ratingView.rating)<br/>        let manager = CoreDataManager()<br/>        manager.addReview(item)<br/>        dismiss(animated: true, completion: nil)<br/>    }<br/>}</pre>
            <p style="padding-left: 60px">Let's make sure we are passing the <kbd>restaurantID</kbd> by adding a <kbd>print</kbd> statement inside <kbd>ReviewFormViewController</kbd>.
            </p>
            
            <ol start="9">
               
               <li>Inside the <kbd>-viewDidLoad()</kbd> method, add the following <kbd>print</kbd> statement:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">print(selectedRestaurantID as Any)</pre>
            <p>Let's build and run the project by hitting the Play button (or use ⌘ + <em>R</em>). You should now be able to see <kbd>restaurantID</kbd> in the console. You can create a review and, after you save the review, you are brought
               back to the restaurant detail view, but we are still missing displaying our reviews
               in restaurant details. We will work on this later in this chapter. Before we do that,
               let's look at how we can save photos into Core Data.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Saving photos </h1>
            
         </header>
         
         
         <article>
            
            
            <p>Saving reviews was pretty simple and there is essentially no difference in saving
               photos. Our code will be pretty similar to what we did with reviews. Open the <kbd>PhotoFilterViewController</kbd>, delete everything inside the <kbd>checkSavedPhoto()</kbd> method, and update it with the following:
            </p>
            <pre>func checkSavedPhoto() {<br/>    if let img = self.imgExample.image {<br/>      var item = RestaurantPhotoItem()<br/>      item.photo = generate(image: img, ratio: CGFloat(102))<br/>      item.date = NSDate() as Date<br/>      item.restaurantID = selectedRestaurantID<br/>      let manager = CoreDataManager()<br/>      manager.addPhoto(item)<br/>    }<br/>}</pre>
            <p>This method will make sure that we have an image and then save it to Core Data with
               its restaurant ID. We need to add a method for when <span class="packt_screen">Save</span> is tapped. Add the following method inside the private extension:
            </p>
            <pre> @IBAction func onSaveTapped(_ sender: AnyObject) {<br/>    DispatchQueue.main.async {<br/>        self.checkSavedPhoto()<br/>    }<br/>}</pre>
            <p>Now, when a user taps the Save button, this will make sure that an image is saved;
               if so, it will save the data to Core Data. Before we can save, we need to pass the
               restaurant identifier to the PhotoFilterViewController.swift.
            </p>
            
            <ol>
               
               <li>Open RestaurantDetail.storyboard and select the segue we are using to go to the Photo
                  Filter View.
               </li>
               
               <li>In the Attributes inspector of the Utilities panel, update <span class="packt_screen">Identifier</span> under <span class="packt_screen">Storyboard Segue</span> to say <kbd>showPhotoFilter</kbd>. Then, hit <em>Enter</em>.
               </li>
               
               <li>Finally, open the <kbd>Segue.swift</kbd> file in the <kbd>Misc</kbd> folder under the <kbd>Common</kbd> folder and verify that the following <kbd>case</kbd> statement is included; if not, add it:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">case showPhotoFilter</pre>
            <ol start="4">
               
               <li>Inside the <kbd>RestaurantDetailViewController.swift</kbd>, update your <kbd>prepare</kbd> method with the following:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {<br/>   if let identifier = segue.identifier {<br/>         switch identifier {<br/>         case Segue.showReview.rawValue:<br/>               showReview(segue: segue)<br/>         case Segue.showPhotoFilter.rawValue:<br/>               showPhotoFilter(segue: segue)<br/>         default:<br/>               print("Segue not added")<br/>         }<br/>   }<br/>}</pre>
            <ol start="5">
               
               <li>Next, add the following method after the <kbd>showReview()</kbd> method inside your <kbd>private</kbd> method:
               </li>
               
            </ol>
            <pre>func showPhotoFilter(segue:UIStoryboardSegue) {<br/>    guard let navController = segue.destination as? UINavigationController,<br/>        let viewController = navController.topViewController as? PhotoFilterViewController else {<br/>            return<br/>    }<br/>    viewController.selectedRestaurantID = selectedRestaurant?.restaurantID<br/>}</pre>
            <p>We are passing the restaurant identifier to our photos and we now have our photos
               saved in Core Data. After you save a photo, you are brought back to the restaurant
               detail view but next we need to display the photos in our <span class="packt_screen">Detail</span> section.
            </p>
            
            <p>We are missing one last thing. The photo review and review sections need to pull data
               from the database for it to be displayed. We need to create a class for each one,
               so let's start by adding this class now:
            </p>
            
            <ol>
               
               <li>Create a new folder called <kbd>Reviews</kbd>.
               </li>
               
               <li>Now, right-click the folder and select <span class="packt_screen">New File</span>.
               </li>
               
               <li>Inside the <span class="packt_screen">Choose a template for your new file screen</span>, select <span class="packt_screen">iOS</span> at the top and then <span class="packt_screen">Cocoa Touch Class</span>. Then, hit <span class="packt_screen">Next</span>.
               </li>
               
            </ol>
            
            <p> </p>
            
            <ol start="4">
               
               <li>In the options screen that appears, add the following:<br/>
                  New file:
               </li>
               
            </ol>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">Class</span>: <kbd>ReviewsViewController</kbd></li>
                     
                     <li><span class="packt_screen">Subclass</span>: <kbd>UIViewController</kbd></li>
                     
                     <li><span class="packt_screen">Also create XIB</span>: Unchecked
                     </li>
                     
                     <li><span class="packt_screen">Language</span>: <kbd>Swift</kbd></li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="5">
               
               <li>Hit <span class="packt_screen">Next</span> and then <span class="packt_screen">Create</span>. When the file opens, replace everything with the following code:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">import UIKit<br/>class ReviewsViewController: UIViewController {<br/>    @IBOutlet weak var collectionView: UICollectionView!<br/>    var selectedRestaurantID:Int?<br/>    let manager = CoreDataManager()<br/>    var data: [ReviewItem] = []<br/>    override func viewDidLoad() {<br/>        super.viewDidLoad()<br/>        initialize()<br/>    }<br/><br/>    override func viewDidAppear(_ animated: Bool) {<br/>        super.viewDidAppear(animated)<br/>        setupDefaults()<br/>    }<br/>}</pre>
            <ol start="6">
               
               <li>Next, let's add our <kbd>private</kbd> extension by adding the following:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">private extension ReviewsViewController {<br/>    func initialize() {<br/>        setupCollectionView()<br/>    }<br/><br/>    func setupDefaults() {<br/>        checkReviews()<br/>    }<br/><br/>    func setupCollectionView() {<br/>        let flow = UICollectionViewFlowLayout()<br/>        flow.sectionInset = UIEdgeInsets(top: 7, left: 7, bottom: 7, right: 7)<br/>        flow.minimumInteritemSpacing = 0<br/>        flow.minimumLineSpacing = 7<br/>        flow.scrollDirection = .horizontal<br/>        collectionView?.collectionViewLayout = flow<br/>    }<br/><br/>    func checkReviews() {<br/>        let viewController = self.parent as? RestaurantDetailViewController<br/>        if let id = viewController?.selectedRestaurant?.restaurantID {<br/>            if data.count &gt; 0 { data.removeAll() }<br/>            data = manager.fetchReviews(by: id)<br/>            if data.count &gt; 0 {<br/>                collectionView.backgroundView = nil<br/>            }<br/>            else {<br/>                let view = NoDataView(frame: CGRect(x: 0, y: 0, width: collectionView.frame.width, height: collectionView.frame.height))<br/>                view.set(title: "Reviews")<br/>                view.set(desc: "There are currently no reviews")<br/>                collectionView.backgroundView = view<br/>            }<br/>            collectionView.reloadData()<br/>        }<br/>    }<br/>}</pre>
            <p style="padding-left: 60px">We are doing the basic setup that we did before. Our <kbd>checkReviews()</kbd> method is a bit different, because we are first checking to see if there are any
               reviews at all.  If there are not, we display a message that says <kbd>There are currently no reviews. If there are, we do not display anything.</kbd> 
            </p>
            
            <ol start="7">
               
               <li>Next, let's add our Collection View extensions by adding the following to our data
                  source:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">extension ReviewsViewController: UICollectionViewDataSource {<br/>    func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -&gt; Int {<br/>        return data.count<br/>    }<br/><br/>    func numberOfSections(in collectionView: UICollectionView) -&gt; Int {<br/>        return 1<br/>    }<br/><br/>    func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell {<br/>        return collectionView.dequeueReusableCell(withReuseIdentifier: "reviewCell", for: indexPath)<br/>    }<br/>}</pre>
            <ol start="8">
               
               <li>Next, let's add our Collection View extensions by adding the following to our layout:</li>
               
            </ol>
            <pre style="padding-left: 60px">extension ReviewsViewController: UICollectionViewDelegateFlowLayout {<br/><br/>    func collectionView(_ collectionView: UICollectionView, layout collectionViewLayout: UICollectionViewLayout, sizeForItemAt indexPath:IndexPath) -&gt; CGSize {<br/>        if data.count == 1 {<br/>           let width = collectionView.frame.size.width - 14<br/>            return CGSize(width: width, height: 200)<br/>        }<br/>        else {<br/>           let width = collectionView.frame.size.width - 21<br/>            return CGSize(width: width, height: 200)<br/>        }<br/>    }<br/>}</pre>
            <p>Next, for our Collection View to work, we need to create our cell and an extension
               of this class: 
            </p>
            
            <div class="CDPAlignCenter CDPAlign"> <img height="169" src="assets/71ab0552-80b5-4466-a98f-479fd5617c2b.png" width="282"/></div>
            
            <ol>
               
               <li>Right-click the <kbd>Review</kbd> folder and select <span class="packt_screen">New File</span>.
               </li>
               
            </ol>
            
            <p> </p>
            
            <ol start="2">
               
               <li>Inside the <span class="packt_screen">Choose a template for your new file screen</span>, select <span class="packt_screen">iOS</span> at the top and then <span class="packt_screen">Cocoa Touch Class</span>. Then, hit <span class="packt_screen">Next</span>.
               </li>
               
               <li>In the options screen that appears, add the following:</li>
               
            </ol>
            
            <p style="padding-left: 60px">New file:</p>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">Class</span>: <kbd>ReviewCell</kbd></li>
                     
                     <li><span class="packt_screen">Subclass</span>: <kbd>UICollectionViewCell</kbd></li>
                     
                     <li><span class="packt_screen">Also create XIB</span>: Unchecked
                     </li>
                     
                     <li><span class="packt_screen">Language</span>: <kbd>Swift</kbd></li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="4">
               
               <li>Click <span class="packt_screen">Next</span> and then <span class="packt_screen">Create</span>.
               </li>
               
               <li>In this new file, add the following code:</li>
               
            </ol>
            <pre style="padding-left: 60px">@IBOutlet weak var lblTitle: UILabel!<br/>@IBOutlet weak var lblDate: UILabel!<br/>@IBOutlet weak var lblName: UILabel!<br/>@IBOutlet weak var lblReview: UILabel!<br/>@IBOutlet weak var ratingView: RatingView!</pre>
            <ol start="6">
               
               <li>Save the file and open up <kbd>RestaurantDetail.storyboard</kbd>.
               </li>
               
               <li>Locate the <kbd>Container</kbd> that we created for <kbd>Reviews</kbd> and select the cell inside the Collection View. Select the View Controller and in
                  the Identity inspector and under <span class="packt_screen">Custom Class</span> set <span class="packt_screen">Class</span> to <span class="packt_screen">ReviewsViewController</span>.
               </li>
               
               <li>Then hit <em>Enter</em>.
               </li>
               
               <li>Now, in the Utilities panel, under the Size inspector, update the <span class="packt_screen">Size</span> to <span class="packt_screen">Custom</span>.
               </li>
               
               <li>Next, set <span class="packt_screen">Width</span> to <kbd>350</kbd> and <span class="packt_screen">Height</span> to <kbd>200</kbd>.
               </li>
               
               <li>Under the Attributes inspector, set the <span class="packt_screen">Identifier</span> to <kbd>reviewCell</kbd> and the background color to <kbd>#F2F2F2</kbd>. You can add this color to your <span class="packt_screen">Color</span> set.
               </li>
               
               <li>Then under Identity inspector, update the class to <kbd>ReviewCell</kbd>.
               </li>
               
               <li>Select the Collection View, and in the Identity inspector click and drag from dataSource
                  and delegate to the View Controller.
               </li>
               
            </ol>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Setting up the cell UI </h1>
            
         </header>
         
         
         <article>
            
            
            <p>Now, let's get all of our UI elements into the <kbd>reviewCell</kbd> (the example shown earlier):
            </p>
            
            <ol>
               
               <li>In the object library of the Utilities panel, type label in the <span class="packt_screen">filter</span> field.
               </li>
               
               <li>Then, drag out four <span class="packt_screen">Labels</span> into the <span class="packt_screen">Cell</span>.
               </li>
               
               <li>Select one of the <span class="packt_screen">Labels</span> and, in the Size inspector, update the following values:
               </li>
               
            </ol>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">X</span>: <kbd>8</kbd></li>
                     
                     <li><span class="packt_screen">Y</span>: <kbd>5</kbd></li>
                     
                     <li><span class="packt_screen">Width</span>: <kbd>116</kbd></li>
                     
                     <li><span class="packt_screen">Height</span>: <kbd>5</kbd></li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="4">
               
               <li>Then, select the Attributes inspector in the Utilities panel; update the <span class="packt_screen">Font</span> to <span class="packt_screen">Avenir Next Condensed Demi Bold</span> and set the <span class="packt_screen">Size</span> to <kbd>16</kbd><strong>.</strong></li>
               
               <li>Select another label and update the following values in the Size inspector:</li>
               
            </ol>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">X</span>: <kbd>245</kbd></li>
                     
                     <li><span class="packt_screen">Y</span>: <kbd>5</kbd></li>
                     
                     <li><span class="packt_screen">Width</span>: <kbd>97</kbd></li>
                     
                     <li><span class="packt_screen">Height</span>: <kbd>21</kbd></li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="6">
               
               <li>Then, select the Attributes inspector in the Utilities panel; update the <span class="packt_screen">Font</span> to <span class="packt_screen">Avenir Next Condensed Medium</span>, set the <span class="packt_screen">Size</span> to <kbd>16</kbd>, and set <span class="packt_screen">Color</span> to <span class="packt_screen">LetsEat Light Grey</span><strong>.</strong></li>
               
               <li>Select another label and update the following values in the Size inspector:</li>
               
            </ol>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">X</span>: <kbd>245.5</kbd></li>
                     
                     <li><span class="packt_screen">Y</span>: <kbd>21</kbd></li>
                     
                     <li><span class="packt_screen">Width</span>: <kbd>97</kbd></li>
                     
                     <li><span class="packt_screen">Height</span>: <kbd>21</kbd></li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="8">
               
               <li>Then, select the Attributes inspector in the Utilities panel; update the <span class="packt_screen">Font</span> to <span class="packt_screen">Avenir Next Condensed Medium</span>, set the <span class="packt_screen">Size</span> to <kbd>16</kbd>, and set color to <span class="packt_screen">LetsEat Light Grey</span>.
               </li>
               
            </ol>
            
            <p> </p>
            
            <ol start="9">
               
               <li>Select the last label and update the following values in the Size inspector:</li>
               
            </ol>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">X</span>: <kbd>8</kbd></li>
                     
                     <li><span class="packt_screen">Y</span>: <kbd>54</kbd></li>
                     
                     <li><span class="packt_screen">Width</span>: <kbd>334</kbd></li>
                     
                     <li><span class="packt_screen">Height</span>: <kbd>137</kbd></li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="10">
               
               <li>Then, select the Attributes inspector in the Utilities panel; update the <span class="packt_screen">Font</span> to <span class="packt_screen">Avenir Next Condensed Regular</span> and set the <span class="packt_screen">Size</span> to <kbd>16</kbd><strong>.</strong> Now, set <span class="packt_screen">Lines</span> to <kbd>6</kbd>.
               </li>
               
            </ol>
            
            <p>We are done with setting up our cell, but we just need to add Auto Layout to our cells.</p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Adding Auto Layout</h1>
            
         </header>
         
         
         <article>
            
            
            <p>If we do not add Auto Layout to our cells, they will not look correct; so, let's do
               that now:
            </p>
            
            <ol>
               
               <li>Open <kbd>RestaurantDetail.storyboard</kbd>.
               </li>
               
               <li>Next, select the Container View, the one used for reviews, and then the Pin icon.
                  Enter the following values:
               </li>
               
            </ol>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">Top</span>: <kbd>0</kbd></li>
                     
                     <li><span class="packt_screen">Right</span>: <kbd>0</kbd></li>
                     
                     <li><span class="packt_screen">Bottom</span>: <kbd>0</kbd></li>
                     
                     <li><span class="packt_screen">Left</span>: <kbd>0</kbd></li>
                     
                     <li><span class="packt_screen">Constrain to margins</span>: Unchecked
                     </li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="3">
               
               <li>Click <span class="packt_screen">Add 4 Constraints</span>.
               </li>
               
               <li>Now, select the Collection View, the one used for reviews, and then the Pin icon.
                  Enter the following values:
               </li>
               
            </ol>
            
            <ul>
               
               <li style="list-style-type: none">
                  
                  <ul>
                     
                     <li><span class="packt_screen">Top</span>: <kbd>0</kbd></li>
                     
                     <li><span class="packt_screen">Right</span>: <kbd>0</kbd></li>
                     
                     <li>Bottom: <kbd><kbd>0</kbd></kbd></li>
                     
                     <li><span class="packt_screen">Left</span>: <kbd>0</kbd></li>
                     
                     <li><span class="packt_screen">Constrain to margins</span>: Unchecked
                     </li>
                     
                  </ul>
                  
               </li>
               
            </ul>
            
            <ol start="5">
               
               <li>Click <span class="packt_screen">Add 4 Constraints</span>.
               </li>
               
            </ol>
            
            <p>Build and run your project and add a couple of reviews; you should now see reviews
               appearing in your restaurant details:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="508" src="assets/ce8f522a-02b5-4e7b-ac02-0d46badfc75b.png" width="289"/></div>
            
            <p>We have two more things I would like to update before the end of this chapter.  Now
               that we are saving reviews, we have an overall rating for restaurants. Let's add this
               next.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Adding an overall rating </h1>
            
         </header>
         
         
         <article>
            
            
            <p>To add an overall rating, we need to pull all of the reviews from Core Data, add them
               all together, and get an average. Let's add a new method to our Core Data manager
               to handle this. Please add the following inside <kbd>CoreDataManager.swift</kbd>:
            </p>
            <pre>func fetchRestaurantRating(by identifier:Int) -&gt; Float {<br/>    let reviews = fetchReviews(by: identifier).map({ $0 })<br/>    let sum = reviews.reduce(0, {$0 + ($1.rating ?? 0)})<br/>    return sum / Float(reviews.count)<br/>}</pre>
            <p>In this method, we fetch all of the reviews for a restaurant by their ID.  Then, we
               use the <kbd>reduce</kbd> method to add them all together, and then finally we calculate the average. Now let's
               use this newly created method.  Open up <kbd>RestaurantDetailViewController.swift</kbd>. Under our <kbd>selectedRestaurant</kbd> variable add the following:
            </p>
            <pre>let manager = CoreDataManager()</pre>
            <p>Next, under the <kbd>createRating()</kbd> method, we just set our rating to <kbd>3.5</kbd> stars.  Update this method to the following:
            </p>
            <pre>func createRating() {<br/>    if let id = selectedRestaurant?.restaurantID {<br/>        let value = manager.fetchRestaurantRating(by: id)<br/>        ratingView.rating = CGFloat(value)<br/>        if value.isNaN { lblOverallRating.text = "0" }<br/>        else { lblOverallRating.text = "\(value)" }<br/>    }<br/>}</pre>
            <p>Now our method is checking to make sure we have a restaurant ID.  If we do, then we
               set the rating for <kbd>ratingView</kbd>. We also update the overall label to display the average. Build and run your project
               and you should now see a rating for restaurants that have them:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="569" src="assets/89a808cd-0ccd-4b77-8969-9980b561c0e6.png" width="324"/></div>
            
            <p>We are finished with this chapter, but there is one section left that we did not do
               and that's Photo Reviews. Your challenge is to add photo reviews and get them displayed
               in the Collection View.  We covered everything in the chapter, and all of the code
               is the same.  If you get stuck, feel free to use the project files in the next chapter.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Summary </h1>
            
         </header>
         
         
         <article>
            
            
            <p>We covered a lot in this chapter and we've now finished building our main app's primary
               functionality. Our app is starting to take shape. We were able to create a Core Data
               model and can now save reviews to the Core Data. We also can display all the reviews
               for a restaurant or pull out the last review and display it.
            </p>
            
            <p>In the next chapter, we will work on putting the final touches to our app to make
               it more of a universal app. Once we do that, our main app is finished and we can focus
               on adding some cool features, such as an iMessage app, notifications, and 3D Touch.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   </body></html>