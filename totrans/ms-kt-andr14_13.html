<html><head></head><body>
<div id="_idContainer152" class="calibre2">
<h1 class="chapter-number" id="_idParaDest-107"><a id="_idTextAnchor121" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.1.1">10</span></h1>
<h1 id="_idParaDest-108" class="calibre6"><a id="_idTextAnchor122" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.2.1">Debugging Your App</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.3.1">Debugging is a very important aspect of developing apps. </span><span class="kobospan" id="kobo.3.2">It helps us identify and fix bugs in our code. </span><span class="kobospan" id="kobo.3.3">It is a very important skill to have as a developer. </span><span class="kobospan" id="kobo.3.4">It also helps us avoid bugs in the future. </span><span class="kobospan" id="kobo.3.5">Many tools can help us debug our code. </span><span class="kobospan" id="kobo.3.6">In this chapter, we will be looking at some of the tools that can help us debug </span><span><span class="kobospan" id="kobo.4.1">our code.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.5.1">In this chapter, we will learn debugging tips and tricks, how to detect leaks using LeakCanary, how to inspect network requests/responses fired by our app using Chucker, and how to inspect our Room database, network requests, and background tasks using </span><span><span class="kobospan" id="kobo.6.1">App Inspection.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.7.1">In this chapter, we’re going to cover the following </span><span><span class="kobospan" id="kobo.8.1">main topics:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.9.1">General debugging tips </span><span><span class="kobospan" id="kobo.10.1">and tricks</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.11.1">Detecting leaks </span><span><span class="kobospan" id="kobo.12.1">with LeakCanary</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.13.1">Inspecting network requests </span><span><span class="kobospan" id="kobo.14.1">with Chucker</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.15.1">Using </span><span><span class="kobospan" id="kobo.16.1">App Inspection</span></span></li>
</ul>
<h1 id="_idParaDest-109" class="calibre6"><a id="_idTextAnchor123" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.17.1">Technical requirements</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.18.1">To follow the instructions in this chapter, you will need to have Android Studio Hedgehog or later (</span><a href="https://developer.android.com/studio" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.19.1">https://developer.android.com/studio</span></span></a><span><span class="kobospan" id="kobo.20.1">) </span></span><span><span class="kobospan" id="kobo.21.1">downloaded.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.22.1">You can use the previous chapter’s code to follow the instructions in this chapter. </span><span class="kobospan" id="kobo.22.2">You can find the code for this chapter </span><span><span class="kobospan" id="kobo.23.1">at </span></span><a href="https://github.com/PacktPublishing/Mastering-Kotlin-for-Android/tree/main/chapterten" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.24.1">https://github.com/PacktPublishing/Mastering-Kotlin-for-Android/tree/main/chapterten</span></span></a><span><span class="kobospan" id="kobo.25.1">.</span></span></p>
<h1 id="_idParaDest-110" class="calibre6"><a id="_idTextAnchor124" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.26.1">General debugging tips and tricks</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.27.1">Android Studio provides us with a variety of features that help us debug our code. </span><span class="kobospan" id="kobo.27.2">Some of the features are listed in the </span><span><span class="kobospan" id="kobo.28.1">following points:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><span><strong class="bold"><span class="kobospan" id="kobo.29.1">Logcat</span></strong></span></li>
<li class="calibre15"><span><strong class="bold"><span class="kobospan" id="kobo.30.1">Stack Traces</span></strong></span></li>
<li class="calibre15"><span><strong class="bold"><span class="kobospan" id="kobo.31.1">Breakpoints</span></strong></span></li>
</ul>
<p class="calibre4"><span class="kobospan" id="kobo.32.1">Let us look at each of </span><span><span class="kobospan" id="kobo.33.1">these closely.</span></span></p>
<h2 id="_idParaDest-111" class="calibre7"><a id="_idTextAnchor125" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.34.1">Logcat</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.35.1">Logcat in Android Studio displays log </span><a id="_idIndexMarker476" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.36.1">messages in real-time from our apps. </span><span class="kobospan" id="kobo.36.2">Each log message has a</span><a id="_idIndexMarker477" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.37.1"> priority level attached to it. </span><span class="kobospan" id="kobo.37.2">We add log messages in our app using the </span><strong class="source-inline"><span class="kobospan" id="kobo.38.1">Log</span></strong><span class="kobospan" id="kobo.39.1"> class. </span><span class="kobospan" id="kobo.39.2">This class offers different priority levels that we can use to log messages. </span><span class="kobospan" id="kobo.39.3">The different priority levels are </span><span><span class="kobospan" id="kobo.40.1">as follows:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.41.1">V</span></strong><span class="kobospan" id="kobo.42.1">: Verbose (</span><span><span class="kobospan" id="kobo.43.1">lowest priority)</span></span></li>
<li class="calibre15"><span><strong class="bold"><span class="kobospan" id="kobo.44.1">D</span></strong></span><span><span class="kobospan" id="kobo.45.1">: Debug</span></span></li>
<li class="calibre15"><span><strong class="bold"><span class="kobospan" id="kobo.46.1">I</span></strong></span><span><span class="kobospan" id="kobo.47.1">: Info</span></span></li>
<li class="calibre15"><span><strong class="bold"><span class="kobospan" id="kobo.48.1">W</span></strong></span><span><span class="kobospan" id="kobo.49.1">: Warning</span></span></li>
<li class="calibre15"><span><strong class="bold"><span class="kobospan" id="kobo.50.1">E</span></strong></span><span><span class="kobospan" id="kobo.51.1">: Error</span></span></li>
<li class="calibre15"><span><strong class="bold"><span class="kobospan" id="kobo.52.1">F</span></strong></span><span><span class="kobospan" id="kobo.53.1">: Fatal</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.54.1">S</span></strong><span class="kobospan" id="kobo.55.1">: Silent (</span><span><span class="kobospan" id="kobo.56.1">highest priority)</span></span></li>
</ul>
<p class="calibre4"><span class="kobospan" id="kobo.57.1">We use the preceding letters to specify the log level. </span><span class="kobospan" id="kobo.57.2">For example, if we want to log a message with the debug level, we will use the </span><span><span class="kobospan" id="kobo.58.1">following code:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.59.1">
Log.d("TAG", "Message")</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.60.1">The first parameter is the tag. </span><span class="kobospan" id="kobo.60.2">The tag is used to identify the source of a log message. </span><span class="kobospan" id="kobo.60.3">The second parameter is the</span><a id="_idIndexMarker478" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.61.1"> message that we want to log. </span><span class="kobospan" id="kobo.61.2">Each time </span><a id="_idIndexMarker479" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.62.1">we run our app, Logcat shows up at the bottom of the Android Studio window, as shown in the </span><span><span class="kobospan" id="kobo.63.1">following figure:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer127">
<span class="kobospan" id="kobo.64.1"><img alt="Figure 10.1 – Logcat" src="image/B19779_10_01.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.65.1">Figure 10.1 – Logcat</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.66.1">From the preceding figure, we can see at the top that the Logcat window shows the device we are running our app on. </span><span class="kobospan" id="kobo.66.2">In this case, we are running our app on a </span><strong class="bold"><span class="kobospan" id="kobo.67.1">Pixel 6 Pro API 33</span></strong><span class="kobospan" id="kobo.68.1"> emulator; yours can be different depending on the emulator you have installed. </span><span class="kobospan" id="kobo.68.2">Next to the device, we can see the </span><strong class="bold"><span class="kobospan" id="kobo.69.1">package</span></strong><span class="kobospan" id="kobo.70.1"> of the app we are running. </span><span class="kobospan" id="kobo.70.2">This has a search bar that allows us to search for specific logs with their tags. </span><span class="kobospan" id="kobo.70.3">Below the search are the actual logs. </span><span class="kobospan" id="kobo.70.4">We can see that each log has a tag, the priority level, the package name of the app, the time the log was created, and the message. </span><span class="kobospan" id="kobo.70.5">We can also see that the logs are color-coded. </span><span class="kobospan" id="kobo.70.6">To see all the color settings for our Logcat, we go to </span><strong class="bold"><span class="kobospan" id="kobo.71.1">Settings</span></strong><span class="kobospan" id="kobo.72.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.73.1">Editor </span></strong><span class="kobospan" id="kobo.74.1">| </span><strong class="bold"><span class="kobospan" id="kobo.75.1">Color Scheme</span></strong><span class="kobospan" id="kobo.76.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.77.1">Android Logcat</span></strong><span class="kobospan" id="kobo.78.1">, which shows the color settings as shown in the </span><span><span class="kobospan" id="kobo.79.1">following figure:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer128">
<span class="kobospan" id="kobo.80.1"><img alt="Figure 10.2 – Logcat color settings" src="image/B19779_10_02.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.81.1">Figure 10.2 – Logcat color settings</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.82.1">This way, we can set a color </span><a id="_idIndexMarker480" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.83.1">scheme for our Logcat. </span><span class="kobospan" id="kobo.83.2">In the preceding figure, the color scheme has been set to </span><strong class="bold"><span class="kobospan" id="kobo.84.1">Classic Light</span></strong><span class="kobospan" id="kobo.85.1">. </span><span class="kobospan" id="kobo.85.2">There is a list that shows</span><a id="_idIndexMarker481" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.86.1"> the colors for each log level, and you can change the color for each log level. </span><span class="kobospan" id="kobo.86.2">We can also change the font style and size for </span><span><span class="kobospan" id="kobo.87.1">our Logcat.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.88.1">With this, let us see how to create our first Logcat message. </span><span class="kobospan" id="kobo.88.2">Let us head over to the </span><strong class="source-inline"><span class="kobospan" id="kobo.89.1">MainActivity.kt</span></strong><span class="kobospan" id="kobo.90.1"> file and add a log message in the </span><strong class="source-inline"><span class="kobospan" id="kobo.91.1">onCreate()</span></strong><span class="kobospan" id="kobo.92.1"> method </span><span><span class="kobospan" id="kobo.93.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.94.1">
Log.d("First Log", "This is our first log message")</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.95.1">Run the app and add </span><strong class="source-inline"><span class="kobospan" id="kobo.96.1">First Log</span></strong><span class="kobospan" id="kobo.97.1"> as a search query in the </span><span><span class="kobospan" id="kobo.98.1">search bar:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer129">
<span class="kobospan" id="kobo.99.1"><img alt="Figure 10.3 – Logcat search" src="image/B19779_10_03.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.100.1">Figure 10.3 – Logcat search</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.101.1">This only shows the log</span><a id="_idIndexMarker482" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.102.1"> message that has the tag </span><strong class="bold"><span class="kobospan" id="kobo.103.1">First Log</span></strong><span class="kobospan" id="kobo.104.1">. </span><span class="kobospan" id="kobo.104.2">This is particularly</span><a id="_idIndexMarker483" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.105.1"> useful when we have a lot of logs, and we want to search for a </span><span><span class="kobospan" id="kobo.106.1">specific log.</span></span></p>
<h2 id="_idParaDest-112" class="calibre7"><a id="_idTextAnchor126" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.107.1">Stack traces</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.108.1">A </span><strong class="bold"><span class="kobospan" id="kobo.109.1">stack trace</span></strong><span class="kobospan" id="kobo.110.1"> is a list of method calls from the</span><a id="_idIndexMarker484" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.111.1"> point where the app was</span><a id="_idIndexMarker485" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.112.1"> started to the point where the exception was thrown. </span><span class="kobospan" id="kobo.112.2">It is extremely useful in helping us identify the cause of an exception. </span><span class="kobospan" id="kobo.112.3">Stack traces are normally displayed </span><span><span class="kobospan" id="kobo.113.1">in Logcat.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.114.1">To be able to see our first stack trace, let us head over to the </span><strong class="source-inline"><span class="kobospan" id="kobo.115.1">MainActivity.kt</span></strong><span class="kobospan" id="kobo.116.1"> file and add the following code in the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.117.1">onCreate()</span></strong></span><span><span class="kobospan" id="kobo.118.1"> method:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.119.1">
throw RuntimeException("This is a crash")</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.120.1">The preceding code will cause the app to crash when you run it. </span><span class="kobospan" id="kobo.120.2">The app crashes immediately after executing the preceding code, and by checking our Logcat, we should be able to see the </span><span><span class="kobospan" id="kobo.121.1">stack trace:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer130">
<span class="kobospan" id="kobo.122.1"><img alt="Figure 10.4 – Crash stack trace" src="image/B19779_10_04.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.123.1">Figure 10.4 – Crash stack trace</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.124.1">As shown in the preceding figure, the stack trace shows the exception or reason for the crash. </span><span class="kobospan" id="kobo.124.2">Additionally, it shows the class and method where the exception was thrown. </span><span class="kobospan" id="kobo.124.3">It also shows the line number where the exception was thrown. </span><span class="kobospan" id="kobo.124.4">This is particularly useful in helping us identify the cause of the exception. </span><span class="kobospan" id="kobo.124.5">We can click on the line number directly and it will take us</span><a id="_idIndexMarker486" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.125.1"> to the line of code where the exception </span><span><span class="kobospan" id="kobo.126.1">was thrown.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.127.1">The stack trace is a crucial tool in </span><a id="_idIndexMarker487" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.128.1">helping us debug our code and quickly detect crashes and the cause of crashes. </span><span class="kobospan" id="kobo.128.2">Before moving on, remember to remove the code that throws the exception so that we can continue with the rest of </span><span><span class="kobospan" id="kobo.129.1">the chapter.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.130.1">Android Studio allows us to copy and paste stack traces from a different source and see them in our Logcat. </span><span class="kobospan" id="kobo.130.2">Copy the following </span><span><span class="kobospan" id="kobo.131.1">stack trace:</span></span></p>
<pre class="console"><span class="kobospan1" id="kobo.132.1">
FATAL EXCEPTION: main
Process: com.packt.chapterten, PID: 7168
java.lang.RuntimeException: Unable to start activity ComponentInfo{com.packt.chapterten/com.packt.chapterten.MainActivity}: java.lang.RuntimeException: This is a crash
at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:3645)
at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3782)
at android.app.servertransaction.LaunchActivityItem.execute(LaunchActivityItem.java:101)
at android.app.servertransaction.TransactionExecutor.executeCallbacks(TransactionExecutor.java:135)
at android.app.servertransaction.TransactionExecutor.execute(TransactionExecutor.java:95)
at android.app.ActivityThread$H.handleMessage(ActivityThread.java:2307)
at android.os.Handler.dispatchMessage(Handler.java:106)
at android.os.Looper.loopOnce(Looper.java:201)
at android.os.Looper.loop(Looper.java:288)
at android.app.ActivityThread.main(ActivityThread.java:7872)
at java.lang.reflect.Method.invoke(Native Method)
at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)
at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:936)
Caused by: java.lang.RuntimeException: This is a crash
at com.packt.chapterten.MainActivity.onCreate(MainActivity.kt:48)
at android.app.Activity.performCreate(Activity.java:8305)
at android.app.Activity.performCreate(Activity.java:8284)
at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1417)
at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:3626)
at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3782)
at android.app.servertransaction.LaunchActivityItem.execute(LaunchActivityItem.java:101)
at android.app.servertransaction.TransactionExecutor.executeCallbacks(TransactionExecutor.java:135)
at android.app.servertransaction.TransactionExecutor.execute(TransactionExecutor.java:95)
at android.app.ActivityThread$H.handleMessage(ActivityThread.java:2307)
at android.os.Handler.dispatchMessage(Handler.java:106)
at android.os.Looper.loopOnce(Looper.java:201)
at android.os.Looper.loop(Looper.java:288)
at android.app.ActivityThread.main(ActivityThread.java:7872)
at java.lang.reflect.Method.invoke(Native Method)
at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)
at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:936)</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.133.1">Once you are done</span><a id="_idIndexMarker488" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.134.1"> copying the stack trace, head over to the </span><strong class="bold"><span class="kobospan" id="kobo.135.1">Code</span></strong><span class="kobospan" id="kobo.136.1"> tab at the top of </span><a id="_idIndexMarker489" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.137.1">Android Studio and select </span><strong class="bold"><span class="kobospan" id="kobo.138.1">Analyze Stack Trace or Thread Dump</span></strong><span class="kobospan" id="kobo.139.1">, paste the stack trace, and you will see the following dialog with the </span><span><span class="kobospan" id="kobo.140.1">stack trace:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer131">
<span class="kobospan" id="kobo.141.1"><img alt="Figure 10.5 – Analyze stack trace" src="image/B19779_10_05.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.142.1">Figure 10.5 – Analyze stack trace</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.143.1">This shows the preview of</span><a id="_idIndexMarker490" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.144.1"> the stack trace we just pasted. </span><span class="kobospan" id="kobo.144.2">Clicking on </span><strong class="bold"><span class="kobospan" id="kobo.145.1">OK</span></strong><span class="kobospan" id="kobo.146.1"> takes us </span><a id="_idIndexMarker491" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.147.1">to Logcat and shows us the stack trace as in </span><span><em class="italic"><span class="kobospan" id="kobo.148.1">Figure 10</span></em></span><span><em class="italic"><span class="kobospan" id="kobo.149.1">.4</span></em></span></p>
<h2 id="_idParaDest-113" class="calibre7"><a id="_idTextAnchor127" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.150.1">Breakpoints</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.151.1">We use </span><strong class="bold"><span class="kobospan" id="kobo.152.1">breakpoints</span></strong><span class="kobospan" id="kobo.153.1"> to debug code</span><a id="_idIndexMarker492" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.154.1"> for our apps. </span><span class="kobospan" id="kobo.154.2">A breakpoint is a point in our code where we want the debugger to pause the </span><a id="_idIndexMarker493" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.155.1">execution of our code. </span><span class="kobospan" id="kobo.155.2">This is useful when we are trying to find bugs that only appear under certain conditions. </span><span class="kobospan" id="kobo.155.3">Android Studio allows us to add breakpoints to our code. </span><span class="kobospan" id="kobo.155.4">We can add breakpoints to our code by clicking on the left side of the line number as shown in the </span><span><span class="kobospan" id="kobo.156.1">following figure:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer132">
<span class="kobospan" id="kobo.157.1"><img alt="Figure 10.6 – Breakpoint" src="image/B19779_10_06.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.158.1">Figure 10.6 – Breakpoint</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.159.1">As shown in </span><span><em class="italic"><span class="kobospan" id="kobo.160.1">Figure 10</span></em></span><em class="italic"><span class="kobospan" id="kobo.161.1">.6</span></em><span class="kobospan" id="kobo.162.1">, a red circle is displayed when we add a breakpoint. </span><span class="kobospan" id="kobo.162.2">To be able to see how the breakpoint works, we </span><a id="_idIndexMarker494" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.163.1">need to run the </span><a id="_idIndexMarker495" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.164.1">app in </span><strong class="bold"><span class="kobospan" id="kobo.165.1">debug mode</span></strong><span class="kobospan" id="kobo.166.1">. </span><span class="kobospan" id="kobo.166.2">We can </span><a id="_idIndexMarker496" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.167.1">do this by clicking on the </span><span><strong class="bold"><span class="kobospan" id="kobo.168.1">Debug</span></strong></span><span><span class="kobospan" id="kobo.169.1"> button:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer133">
<span class="kobospan" id="kobo.170.1"><img alt="Figure 10.7 – Debug app" src="image/B19779_10_07.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.171.1">Figure 10.7 – Debug app</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.172.1">Since the breakpoint is on the </span><strong class="source-inline"><span class="kobospan" id="kobo.173.1">onCreate()</span></strong><span class="kobospan" id="kobo.174.1"> method, the debugger will pause the execution of our code at the breakpoint. </span><span class="kobospan" id="kobo.174.2">Android Studio will highlight the line where the </span><span><span class="kobospan" id="kobo.175.1">breakpoint is:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer134">
<span class="kobospan" id="kobo.176.1"><img alt="Figure 10.8 – Line breakpoint" src="image/B19779_10_08.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.177.1">Figure 10.8 – Line breakpoint</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.178.1">It also shows a </span><strong class="bold"><span class="kobospan" id="kobo.179.1">Debug</span></strong><span class="kobospan" id="kobo.180.1"> window at </span><span><span class="kobospan" id="kobo.181.1">the bottom:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer135">
<span class="kobospan" id="kobo.182.1"><img alt="Figure 10.9 – Debug window" src="image/B19779_10_09.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.183.1">Figure 10.9 – Debug window</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.184.1">The </span><strong class="bold"><span class="kobospan" id="kobo.185.1">Debug</span></strong><span class="kobospan" id="kobo.186.1"> window shows us the variables that are in the scope of the breakpoint. </span><span class="kobospan" id="kobo.186.2">We can also see the call stack, which</span><a id="_idIndexMarker497" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.187.1"> shows us the methods that have been </span><a id="_idIndexMarker498" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.188.1">called before the breakpoint. </span><span class="kobospan" id="kobo.188.2">We can also see the threads that are running in our app. </span><span class="kobospan" id="kobo.188.3">We can also see the breakpoints that we have added to </span><span><span class="kobospan" id="kobo.189.1">our code.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.190.1">The </span><strong class="bold"><span class="kobospan" id="kobo.191.1">Debug</span></strong><span class="kobospan" id="kobo.192.1"> window has some buttons at the top that are immensely helpful in debugging </span><span><span class="kobospan" id="kobo.193.1">our code:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer136">
<span class="kobospan" id="kobo.194.1"><img alt="Figure 10.10 – Debug window buttons" src="image/B19779_10_10.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.195.1">Figure 10.10 – Debug window buttons</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.196.1">The buttons are as highlighted in </span><span><em class="italic"><span class="kobospan" id="kobo.197.1">Figure 10</span></em></span><em class="italic"><span class="kobospan" id="kobo.198.1">.10</span></em><span class="kobospan" id="kobo.199.1">. </span><span class="kobospan" id="kobo.199.2">Starting from the left to right, the </span><span><span class="kobospan" id="kobo.200.1">buttons are:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.201.1">Show execution point</span></strong><span class="kobospan" id="kobo.202.1">: This button shows the line of code where the debugger </span><span><span class="kobospan" id="kobo.203.1">is paused</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.204.1">Step Over</span></strong><span class="kobospan" id="kobo.205.1">: This button allows us to execute the current line of code and move to the next line </span><span><span class="kobospan" id="kobo.206.1">of code</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.207.1">Step Into</span></strong><span class="kobospan" id="kobo.208.1">: This button allows us to step into a </span><span><span class="kobospan" id="kobo.209.1">method call</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.210.1">Step Out</span></strong><span class="kobospan" id="kobo.211.1">: This button allows us to step out of a </span><span><span class="kobospan" id="kobo.212.1">method call</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.213.1">Run to Cursor</span></strong><span class="kobospan" id="kobo.214.1">: This button allows us to run the code until the cursor reaches the line of code where the </span><span><span class="kobospan" id="kobo.215.1">cursor is</span></span></li>
</ul>
<p class="calibre4"><span class="kobospan" id="kobo.216.1">On the left of the </span><strong class="bold"><span class="kobospan" id="kobo.217.1">Debug</span></strong><span class="kobospan" id="kobo.218.1"> window, we can also see the </span><strong class="bold"><span class="kobospan" id="kobo.219.1">Play</span></strong><span class="kobospan" id="kobo.220.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.221.1">Stop</span></strong><span class="kobospan" id="kobo.222.1"> buttons. </span><span class="kobospan" id="kobo.222.2">The </span><strong class="bold"><span class="kobospan" id="kobo.223.1">Play</span></strong><span class="kobospan" id="kobo.224.1"> button allows us to resume the </span><a id="_idIndexMarker499" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.225.1">execution of our code and continue the debugging session until the next breakpoint or until the program completes</span><a id="_idIndexMarker500" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.226.1"> execution. </span><span class="kobospan" id="kobo.226.2">To learn more about breakpoints, visit the official documentation </span><span><span class="kobospan" id="kobo.227.1">at </span></span><a href="https://developer.android.com/studio/debug" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.228.1">https://developer.android.com/studio/debug</span></span></a><span><span class="kobospan" id="kobo.229.1">.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.230.1">In this section, we have learned about the different debugging options available in Android Studio. </span><span class="kobospan" id="kobo.230.2">We learned about Logcat, stack traces, and breakpoints. </span><span class="kobospan" id="kobo.230.3">We have also learned how to use these tools to debug our code. </span><span class="kobospan" id="kobo.230.4">In the next section, we will learn about a different debugging tool, LeakCanary, and how to use it to detect memory leaks in </span><span><span class="kobospan" id="kobo.231.1">our apps.</span></span></p>
<h1 id="_idParaDest-114" class="calibre6"><a id="_idTextAnchor128" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.232.1">Detecting memory leaks with LeakCanary</span></h1>
<p class="calibre4"><strong class="bold"><span class="kobospan" id="kobo.233.1">LeakCanary</span></strong><span class="kobospan" id="kobo.234.1"> is an </span><a id="_idIndexMarker501" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.235.1">open-source library developed by Square that helps us detect memory leaks in </span><a id="_idIndexMarker502" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.236.1">our apps. </span><span class="kobospan" id="kobo.236.2">The library has knowledge of </span><a id="_idIndexMarker503" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.237.1">the internals of the Android Framework that allows it to narrow down the cause of the memory leak. </span><span class="kobospan" id="kobo.237.2">It helps</span><a id="_idIndexMarker504" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.238.1"> reduce the </span><strong class="bold"><span class="kobospan" id="kobo.239.1">Application Not Responding </span></strong><span class="kobospan" id="kobo.240.1">(</span><strong class="bold"><span class="kobospan" id="kobo.241.1">ANR</span></strong><span class="kobospan" id="kobo.242.1">) errors and </span><strong class="bold"><span class="kobospan" id="kobo.243.1">out-of-memory crashes</span></strong><span class="kobospan" id="kobo.244.1"> in our apps. </span><span class="kobospan" id="kobo.244.2">Here are some of the most common </span><a id="_idIndexMarker505" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.245.1">causes of </span><span><span class="kobospan" id="kobo.246.1">memory leaks:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.247.1">Storing instances of </span><strong class="source-inline1"><span class="kobospan" id="kobo.248.1">Activity</span></strong><span class="kobospan" id="kobo.249.1"> as </span><strong class="source-inline1"><span class="kobospan" id="kobo.250.1">Context</span></strong><span class="kobospan" id="kobo.251.1"> filed in an object that survives activity recreation due to </span><span><span class="kobospan" id="kobo.252.1">configuration changes</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.253.1">Forgetting to unregister broadcast receivers, listeners, callbacks, or RxJava subscriptions when they are no </span><span><span class="kobospan" id="kobo.254.1">longer needed</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.255.1">Storing references to </span><strong class="source-inline1"><span class="kobospan" id="kobo.256.1">Context</span></strong><span class="kobospan" id="kobo.257.1"> in a </span><span><span class="kobospan" id="kobo.258.1">background thread</span></span></li>
</ul>
<p class="calibre4"><span class="kobospan" id="kobo.259.1">LeakCanary is quite easy to </span><a id="_idIndexMarker506" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.260.1">set up and no code implementation</span><a id="_idIndexMarker507" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.261.1"> is needed to use it. </span><span class="kobospan" id="kobo.261.2">We just need to add the </span><strong class="source-inline"><span class="kobospan" id="kobo.262.1">leakcanary-android</span></strong><span class="kobospan" id="kobo.263.1"> dependency in our </span><span><strong class="source-inline"><span class="kobospan" id="kobo.264.1">libs.version.toml</span></strong></span><span><span class="kobospan" id="kobo.265.1"> file:</span></span></p>
<pre class="source-code">
<a id="_idTextAnchor129" class="calibre19 pcalibre pcalibre1"/><span class="kobospan1" id="kobo.266.1">leakcanary-an</span><a id="_idTextAnchor130" class="calibre19 pcalibre pcalibre1"/><span class="kobospan1" id="kobo.267.1">droid = "com.squareup.leakcanary:leakcanary-android:2.12"</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.268.1">Tap t</span><a id="_idTextAnchor131" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.269.1">he </span><strong class="bold"><span class="kobospan" id="kobo.270.1">Sync Now</span></strong><span class="kobospan" id="kobo.271.1"> button to sync the project. </span><span class="kobospan" id="kobo.271.2">Next, let us now add the dependency in our app’s </span><span><strong class="source-inline"><span class="kobospan" id="kobo.272.1">build.gradle.kts</span></strong></span><span><span class="kobospan" id="kobo.273.1"> file:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.274.1">
debugImplementation(libs.leakcanary.android)</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.275.1">We have added the dependency using the </span><strong class="source-inline"><span class="kobospan" id="kobo.276.1">debugImplementation</span></strong><span class="kobospan" id="kobo.277.1"> configuration so that it is only added to debug builds. </span><span class="kobospan" id="kobo.277.2">This is because LeakCanary is only used for debugging purposes. </span><span class="kobospan" id="kobo.277.3">We can now run our app and see how LeakCanary works. </span><span class="kobospan" id="kobo.277.4">A separate app will be installed on our device or emulator as shown in the </span><span><span class="kobospan" id="kobo.278.1">following figure:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer137">
<span class="kobospan" id="kobo.279.1"><img alt="Figure 10.11 – Leaks app" src="image/B19779_10_11.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.280.1">Figure 10.11 – Leaks app</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.281.1">Opening the app brings up the </span><span><span class="kobospan" id="kobo.282.1">following screen:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer138">
<span class="kobospan" id="kobo.283.1"><img alt="Figure 10.12 – LeakCanary screen" src="image/B19779_10_12.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.284.1">Figure 10.12 – LeakCanary screen</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.285.1">The screen shows the </span><strong class="bold"><span class="kobospan" id="kobo.286.1">Leaks</span></strong><span class="kobospan" id="kobo.287.1">, </span><strong class="bold"><span class="kobospan" id="kobo.288.1">Heap Dumps</span></strong><span class="kobospan" id="kobo.289.1">, and </span><strong class="bold"><span class="kobospan" id="kobo.290.1">About</span></strong><span class="kobospan" id="kobo.291.1"> tabs. </span><span class="kobospan" id="kobo.291.2">The </span><strong class="bold"><span class="kobospan" id="kobo.292.1">Leaks</span></strong><span class="kobospan" id="kobo.293.1"> tab shows us the memory leaks that have been detected in our app. </span><span class="kobospan" id="kobo.293.2">The </span><strong class="bold"><span class="kobospan" id="kobo.294.1">Heap Dumps</span></strong><span class="kobospan" id="kobo.295.1"> tab shows us the heap dumps that </span><a id="_idIndexMarker508" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.296.1">have been taken. </span><span class="kobospan" id="kobo.296.2">The </span><strong class="bold"><span class="kobospan" id="kobo.297.1">About</span></strong><span class="kobospan" id="kobo.298.1"> tab shows us the version of LeakCanary we are using </span><a id="_idIndexMarker509" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.299.1">as well as general information. </span><span class="kobospan" id="kobo.299.2">For now, there is no memory leak detected. </span><span class="kobospan" id="kobo.299.3">When a memory leak is detected, LeakCanary will generate a notification or log output with detailed information about the memory leak. </span><span class="kobospan" id="kobo.299.4">This information helps us identify the cause of the memory leak and </span><span><span class="kobospan" id="kobo.300.1">fix it.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.301.1">Let us now create a memory leak in our app and see how </span><span><span class="kobospan" id="kobo.302.1">LeakCanary works:</span></span></p>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.303.1">Create a new file inside the </span><strong class="source-inline1"><span class="kobospan" id="kobo.304.1">com.packt.chapterten</span></strong><span class="kobospan" id="kobo.305.1"> package and call it </span><strong class="source-inline1"><span class="kobospan" id="kobo.306.1">LeakCanaryTest.kt</span></strong><span class="kobospan" id="kobo.307.1">. </span><span class="kobospan" id="kobo.307.2">Add the following code to </span><span><span class="kobospan" id="kobo.308.1">the file:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.309.1">
class LeakCanaryTest
class LeakTestUtils {
    companion object {
        val leakCanaryTest = LeakCanaryTest()
    }
}</span></pre><p class="calibre4"><span class="kobospan" id="kobo.310.1">In the preceding </span><a id="_idIndexMarker510" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.311.1">code, we have created a class called </span><strong class="source-inline"><span class="kobospan" id="kobo.312.1">LeakCanaryTest</span></strong><span class="kobospan" id="kobo.313.1"> and another class called </span><strong class="source-inline"><span class="kobospan" id="kobo.314.1">LeakTestUtils</span></strong><span class="kobospan" id="kobo.315.1">, with a</span><a id="_idIndexMarker511" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.316.1"> companion object that stores the </span><strong class="source-inline"><span class="kobospan" id="kobo.317.1">LeakCanaryTest</span></strong><span class="kobospan" id="kobo.318.1"> singleton in a </span><span><span class="kobospan" id="kobo.319.1">static field.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.320.1">Let us now head over to the </span><strong class="source-inline1"><span class="kobospan" id="kobo.321.1">MainActivity.kt</span></strong><span class="kobospan" id="kobo.322.1"> file and add the following code in the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.323.1">onCreate()</span></strong></span><span><span class="kobospan" id="kobo.324.1"> code:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.325.1">
AppWatcher.objectWatcher.expectWeaklyReachable(
    LeakTestUtils.leakCanaryTest,
    "Static reference to LeakCanaryTest"
)</span></pre><p class="calibre4"><span class="kobospan" id="kobo.326.1">In the preceding code, we are telling LeakCanary that the singleton instance of </span><strong class="source-inline"><span class="kobospan" id="kobo.327.1">LeakCanaryTest</span></strong><span class="kobospan" id="kobo.328.1"> will be </span><span><span class="kobospan" id="kobo.329.1">garbage collected.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.330.1">Let us run the app. </span><span class="kobospan" id="kobo.330.2">We can see that LeakCanary has detected a memory leak and shows a notification as seen in the </span><span><span class="kobospan" id="kobo.331.1">following figure:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer139">
<span class="kobospan" id="kobo.332.1"><img alt="Figure 10.13 – Memory leak notification" src="image/B19779_10_13.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.333.1">Figure 10.13 – Memory leak notification</span></p>
<ol class="calibre14">
<li value="4" class="calibre15"><span class="kobospan" id="kobo.334.1">Click on the </span><a id="_idIndexMarker512" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.335.1">notification and it will take us to the </span><a id="_idIndexMarker513" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.336.1">LeakCanary app where we can see the details of the </span><span><span class="kobospan" id="kobo.337.1">memory leak:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer140">
<span class="kobospan" id="kobo.338.1"><img alt="Figure 10.14 – Memory leak details" src="image/B19779_10_14.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.339.1">Figure 10.14 – Memory leak details</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.340.1">As shown in the preceding figure, LeakCanary shows the location of the memory leak and underlines the objects causing the leak. </span><span class="kobospan" id="kobo.340.2">In this case, it is the </span><strong class="source-inline"><span class="kobospan" id="kobo.341.1">leakCanaryTest</span></strong><span class="kobospan" id="kobo.342.1"> object that</span><a id="_idIndexMarker514" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.343.1"> is causing the</span><a id="_idIndexMarker515" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.344.1"> memory leak. </span><span class="kobospan" id="kobo.344.2">Every time we get a memory leak, we will receive such </span><span><span class="kobospan" id="kobo.345.1">detailed information.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.346.1">Remember to remove the code that causes the memory leak in the </span><strong class="source-inline"><span class="kobospan" id="kobo.347.1">MainActivity</span></strong> <strong class="source-inline"><span class="kobospan" id="kobo.348.1">onCreate()</span></strong><span class="kobospan" id="kobo.349.1"> method so that we can continue with the rest of </span><span><span class="kobospan" id="kobo.350.1">the chapter.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.351.1">We have learned about LeakCanary and how to use it to detect memory leaks in our apps. </span><span class="kobospan" id="kobo.351.2">You can learn more about LeakCanary </span><span><span class="kobospan" id="kobo.352.1">at </span></span><a href="https://square.github.io/leakcanary/" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.353.1">https://square.github.io/leakcanary/</span></span></a><span><span class="kobospan" id="kobo.354.1">.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.355.1">In the next section, we will learn</span><a id="_idIndexMarker516" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.356.1"> about Chucker, another debugging</span><a id="_idIndexMarker517" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.357.1"> tool that helps us inspect network requests in </span><span><span class="kobospan" id="kobo.358.1">our apps.</span></span></p>
<h1 id="_idParaDest-115" class="calibre6"><a id="_idTextAnchor132" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.359.1">Inspecting network requests with Chucker</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.360.1">This is from the Chucker GitHub (</span><a href="https://github.com/ChuckerTeam/chucker" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.361.1">https://github.com/ChuckerTeam/chucker</span></span></a><span><span class="kobospan" id="kobo.362.1">) page:</span></span></p>
<p class="author-quote"><span class="kobospan" id="kobo.363.1">Chucker simplifies the inspection of HTTP(S) requests/responses fired by our Android apps. </span><span class="kobospan" id="kobo.363.2">Chucker works as an OkHttp Interceptor persisting all those events inside our application, and providing a UI for inspecting and sharing their content. </span><span class="kobospan" id="kobo.363.3">Chucker displays a notification showing a summary of the ongoing network request.</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.364.1">Tapping the Chucker notification</span><a id="_idIndexMarker518" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.365.1"> mentioned previously launches the Chucker UI. </span><span class="kobospan" id="kobo.365.2">Chucker UI shows a list</span><a id="_idIndexMarker519" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.366.1"> of all the network requests that have been made by our app. </span><span class="kobospan" id="kobo.366.2">We can tap on a request to see the details of </span><span><span class="kobospan" id="kobo.367.1">the request.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.368.1">To use Chucker, follow</span><a id="_idIndexMarker520" class="calibre3 pcalibre pcalibre1"/> <span><span class="kobospan" id="kobo.369.1">these steps:</span></span></p>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.370.1">Add the </span><strong class="source-inline1"><span class="kobospan" id="kobo.371.1">chucker</span></strong><span class="kobospan" id="kobo.372.1"> dependency in the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.373.1">libs.versions.toml</span></strong></span><span><span class="kobospan" id="kobo.374.1"> file:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.375.1">
chucker = "com.github.chuckerteam.chucker:library:4.0.0"
chucker-no-op = "com.github.chuckerteam.chucker:library-no-op:4.0.0"</span></pre><p class="calibre4"><span class="kobospan" id="kobo.376.1">In the preceding code, we have added two dependencies: the first one is the Chucker library, and the second one is a no-op library variant to isolate Chucker from release builds since we only want to see the requests on </span><span><span class="kobospan" id="kobo.377.1">debug builds.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.378.1">Tap the </span><strong class="bold"><span class="kobospan" id="kobo.379.1">Sync Now</span></strong><span class="kobospan" id="kobo.380.1"> button at the top to sync </span><span><span class="kobospan" id="kobo.381.1">the project.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.382.1">Next, we need to add the dependency in our app’s </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.383.1">build.gradle.kts</span></strong></span><span><span class="kobospan" id="kobo.384.1"> file:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.385.1">
debugImplementation(libs.chucker)
releaseImplementation(libs.chucker.no.op)</span></pre></li> <li class="calibre15"><span class="kobospan" id="kobo.386.1">Tap </span><strong class="bold"><span class="kobospan" id="kobo.387.1">Sync Now</span></strong><span class="kobospan" id="kobo.388.1"> at the top. </span><span class="kobospan" id="kobo.388.2">This will add the Chucker dependency in debug </span><span><span class="kobospan" id="kobo.389.1">builds only.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.390.1">Next, we need to create a</span><a id="_idIndexMarker521" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.391.1"> new </span><strong class="source-inline1"><span class="kobospan" id="kobo.392.1">OkHttp</span></strong><span class="kobospan" id="kobo.393.1"> client and add the Chucker interceptor to it. </span><span class="kobospan" id="kobo.393.2">Let us head</span><a id="_idIndexMarker522" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.394.1"> over to the </span><strong class="source-inline1"><span class="kobospan" id="kobo.395.1">Modules.kt</span></strong><span class="kobospan" id="kobo.396.1"> file and add the following module to the </span><strong class="source-inline1"><span class="kobospan" id="kobo.397.1">appModules</span></strong> <span><span class="kobospan" id="kobo.398.1">module block:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.399.1">
single {
    val chuckerCollector = ChuckerCollector(
        context = androidContext(),
        showNotification = true,
        retentionPeriod = RetentionManager.Period.ONE_HOUR
    )
    val chuckerInterceptor = ChuckerInterceptor.Builder(androidContext())
        .collector(chuckerCollector)
        .maxContentLength(250000L)
        .redactHeaders(emptySet())
        .alwaysReadResponseBody(false)
        .build()
   OkHttpClient.Builder()
        .addInterceptor(chuckerInterceptor)
        .build()
}</span></pre><p class="calibre4"><span class="kobospan" id="kobo.400.1">The following explains the </span><span><span class="kobospan" id="kobo.401.1">preceding code:</span></span></p><ul class="calibre17"><li class="calibre15"><span class="kobospan" id="kobo.402.1">We have created a </span><strong class="source-inline1"><span class="kobospan" id="kobo.403.1">ChuckerCollector</span></strong><span class="kobospan" id="kobo.404.1"> instance and passed in the </span><strong class="source-inline1"><span class="kobospan" id="kobo.405.1">context</span></strong><span class="kobospan" id="kobo.406.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.407.1">showNotification</span></strong><span class="kobospan" id="kobo.408.1">, and </span><strong class="source-inline1"><span class="kobospan" id="kobo.409.1">retentionPeriod</span></strong><span class="kobospan" id="kobo.410.1"> parameters. </span><span class="kobospan" id="kobo.410.2">The </span><strong class="source-inline1"><span class="kobospan" id="kobo.411.1">context</span></strong><span class="kobospan" id="kobo.412.1"> is the Android context, </span><strong class="source-inline1"><span class="kobospan" id="kobo.413.1">showNotification</span></strong><span class="kobospan" id="kobo.414.1"> is a boolean that determines whether to show a notification when a request is made, and </span><strong class="source-inline1"><span class="kobospan" id="kobo.415.1">retentionPeriod</span></strong><span class="kobospan" id="kobo.416.1"> is the period for which the data is kept. </span><span class="kobospan" id="kobo.416.2">In this case, we keep the data for </span><span><span class="kobospan" id="kobo.417.1">one hour.</span></span></li><li class="calibre15"><span class="kobospan" id="kobo.418.1">We have created a </span><strong class="source-inline1"><span class="kobospan" id="kobo.419.1">ChuckerInterceptor</span></strong><span class="kobospan" id="kobo.420.1"> instance and passed in the </span><strong class="source-inline1"><span class="kobospan" id="kobo.421.1">context</span></strong><span class="kobospan" id="kobo.422.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.423.1">collector</span></strong><span class="kobospan" id="kobo.424.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.425.1">maxContentLength</span></strong><span class="kobospan" id="kobo.426.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.427.1">redactHeaders</span></strong><span class="kobospan" id="kobo.428.1">, and </span><strong class="source-inline1"><span class="kobospan" id="kobo.429.1">alwaysReadResponseBody</span></strong><span class="kobospan" id="kobo.430.1"> parameters. </span><span class="kobospan" id="kobo.430.2">The </span><strong class="source-inline1"><span class="kobospan" id="kobo.431.1">context</span></strong><span class="kobospan" id="kobo.432.1"> is the Android context, </span><strong class="source-inline1"><span class="kobospan" id="kobo.433.1">collector</span></strong><span class="kobospan" id="kobo.434.1"> is the </span><strong class="source-inline1"><span class="kobospan" id="kobo.435.1">ChuckerCollector</span></strong><span class="kobospan" id="kobo.436.1"> instance we created previously, </span><strong class="source-inline1"><span class="kobospan" id="kobo.437.1">maxContentLength</span></strong><span class="kobospan" id="kobo.438.1"> is the</span><a id="_idIndexMarker523" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.439.1"> maximum length of the response body, </span><strong class="source-inline1"><span class="kobospan" id="kobo.440.1">redactHeaders</span></strong><span class="kobospan" id="kobo.441.1"> is a set of headers</span><a id="_idIndexMarker524" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.442.1"> to replace with </span><strong class="source-inline1"><span class="kobospan" id="kobo.443.1">**</span></strong><span class="kobospan" id="kobo.444.1"> and </span><strong class="source-inline1"><span class="kobospan" id="kobo.445.1">alwaysReadResponseBody</span></strong><span class="kobospan" id="kobo.446.1"> is a boolean that determines whether to always read the </span><span><span class="kobospan" id="kobo.447.1">response body.</span></span></li><li class="calibre15"><span class="kobospan" id="kobo.448.1">We have created an </span><strong class="source-inline1"><span class="kobospan" id="kobo.449.1">OkHttpClient</span></strong><span class="kobospan" id="kobo.450.1"> instance and added the </span><strong class="source-inline1"><span class="kobospan" id="kobo.451.1">ChuckerInterceptor</span></strong> <span><span class="kobospan" id="kobo.452.1">to it.</span></span></li></ul><p class="calibre4"><span class="kobospan" id="kobo.453.1">We can now use the </span><strong class="source-inline"><span class="kobospan" id="kobo.454.1">OkHttpClient</span></strong><span class="kobospan" id="kobo.455.1"> instance to make </span><span><span class="kobospan" id="kobo.456.1">network requests.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.457.1">Let us modify our </span><strong class="source-inline1"><span class="kobospan" id="kobo.458.1">Retrofit</span></strong><span class="kobospan" id="kobo.459.1"> instance to use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.460.1">OkHttpClient</span></strong><span class="kobospan" id="kobo.461.1"> instance we just created. </span><span class="kobospan" id="kobo.461.2">Still in the </span><strong class="source-inline1"><span class="kobospan" id="kobo.462.1">Modules.kt</span></strong><span class="kobospan" id="kobo.463.1"> file, modify the Retrofit instance </span><span><span class="kobospan" id="kobo.464.1">as follows:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.465.1">
single {
    Retrofit.Builder()
        .addConverterFactory(
            Json.asConverterFactory(contentType = "application/json".toMediaType())
        )
        .client(get())
        .baseUrl("https://cataas.com/api/")
        .build()
}</span></pre><p class="calibre4"><span class="kobospan" id="kobo.466.1">We have added the </span><strong class="source-inline"><span class="kobospan" id="kobo.467.1">client</span></strong><span class="kobospan" id="kobo.468.1"> parameter </span><a id="_idIndexMarker525" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.469.1">and passed it in the </span><strong class="source-inline"><span class="kobospan" id="kobo.470.1">OkHttpClient</span></strong><span class="kobospan" id="kobo.471.1"> instance we created </span><a id="_idIndexMarker526" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.472.1">previously using Koin’s </span><span><strong class="source-inline"><span class="kobospan" id="kobo.473.1">get()</span></strong></span><span><span class="kobospan" id="kobo.474.1"> call.</span></span></p><p class="calibre4"><span class="kobospan" id="kobo.475.1">With that, our Chucker setup is </span><span><span class="kobospan" id="kobo.476.1">now complete.</span></span></p></li> <li class="calibre15"><span class="kobospan" id="kobo.477.1">Build and run the app. </span><span class="kobospan" id="kobo.477.2">We can see that Chucker has detected the network request and shows a notification, as seen in the </span><span><span class="kobospan" id="kobo.478.1">following figure:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer141">
<span class="kobospan" id="kobo.479.1"><img alt="Figure 10.15 – Chucker notification" src="image/B19779_10_15.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.480.1">Figure 10.15 – Chucker notification</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.481.1">From the preceding figure, we </span><a id="_idIndexMarker527" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.482.1">can see that Chucker has detected the network request and shows the </span><a id="_idIndexMarker528" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.483.1">status code, the method, and the URL of </span><span><span class="kobospan" id="kobo.484.1">the request.</span></span></p>
<ol class="calibre14">
<li value="8" class="calibre15"><span class="kobospan" id="kobo.485.1">We can tap on the notification and it will take us to the </span><span><span class="kobospan" id="kobo.486.1">Chucker UI:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer142">
<span class="kobospan" id="kobo.487.1"><img alt="Figure 10.16 – Chucker list of requests" src="image/B19779_10_16.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.488.1">Figure 10.16 – Chucker list of requests</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.489.1">This shows the list</span><a id="_idIndexMarker529" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.490.1"> of the network requests that have been</span><a id="_idIndexMarker530" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.491.1"> made by </span><span><span class="kobospan" id="kobo.492.1">our app.</span></span></p>
<ol class="calibre14">
<li value="9" class="calibre15"><span class="kobospan" id="kobo.493.1">Tap on a request to see the details of </span><span><span class="kobospan" id="kobo.494.1">the request:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer143">
<span class="kobospan" id="kobo.495.1"><img alt="Figure 10.17 – Chucker overview tab" src="image/B19779_10_17.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.496.1">Figure 10.17 – Chucker overview tab</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.497.1">The details screen has </span><a id="_idIndexMarker531" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.498.1">three tabs as shown in the preceding </span><a id="_idIndexMarker532" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.499.1">figure. </span><span class="kobospan" id="kobo.499.2">The first tab is the </span><strong class="bold"><span class="kobospan" id="kobo.500.1">Overview</span></strong><span class="kobospan" id="kobo.501.1"> tab, which is shown in </span><span><em class="italic"><span class="kobospan" id="kobo.502.1">Figure 10</span></em></span><em class="italic"><span class="kobospan" id="kobo.503.1">.17</span></em><span class="kobospan" id="kobo.504.1">. </span><span class="kobospan" id="kobo.504.2">The </span><strong class="bold"><span class="kobospan" id="kobo.505.1">Overview</span></strong><span class="kobospan" id="kobo.506.1"> tab shows the overview of the request. </span><span class="kobospan" id="kobo.506.2">It shows the request details such as URL, method, response, duration, response size, and so on. </span><span class="kobospan" id="kobo.506.3">The second</span><a id="_idIndexMarker533" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.507.1"> tab is the </span><strong class="bold"><span class="kobospan" id="kobo.508.1">Request</span></strong><span class="kobospan" id="kobo.509.1"> tab, which shows the request</span><a id="_idIndexMarker534" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.510.1"> headers </span><span><span class="kobospan" id="kobo.511.1">and body:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer144">
<span class="kobospan" id="kobo.512.1"><img alt="Figure 10.18 – Chucker request tab" src="image/B19779_10_18.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.513.1">Figure 10.18 – Chucker request tab</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.514.1">For this request, the body is empty since it was a get request. </span><span class="kobospan" id="kobo.514.2">The third tab is the </span><strong class="bold"><span class="kobospan" id="kobo.515.1">Response</span></strong><span class="kobospan" id="kobo.516.1"> tab, which </span><a id="_idIndexMarker535" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.517.1">shows the response headers</span><a id="_idIndexMarker536" class="calibre3 pcalibre pcalibre1"/> <span><span class="kobospan" id="kobo.518.1">and body:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer145">
<span class="kobospan" id="kobo.519.1"><img alt="Figure 10.19 – Chucker response tab" src="image/B19779_10_19.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.520.1">Figure 10.19 – Chucker response tab</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.521.1">From the preceding figure, we can see the response headers and body in </span><span><span class="kobospan" id="kobo.522.1">JSON format.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.523.1">The toolbar of the details screen has </span><strong class="bold"><span class="kobospan" id="kobo.524.1">Search</span></strong><span class="kobospan" id="kobo.525.1">, </span><strong class="bold"><span class="kobospan" id="kobo.526.1">Share</span></strong><span class="kobospan" id="kobo.527.1">, and </span><strong class="bold"><span class="kobospan" id="kobo.528.1">Save</span></strong><span class="kobospan" id="kobo.529.1"> buttons. </span><span class="kobospan" id="kobo.529.2">The </span><strong class="bold"><span class="kobospan" id="kobo.530.1">Search</span></strong><span class="kobospan" id="kobo.531.1"> button allows us to search in either the request or the response. </span><span class="kobospan" id="kobo.531.2">The </span><strong class="bold"><span class="kobospan" id="kobo.532.1">Share</span></strong><span class="kobospan" id="kobo.533.1"> button allows us to share the request or response details in JSON format. </span><span class="kobospan" id="kobo.533.2">The </span><strong class="bold"><span class="kobospan" id="kobo.534.1">Save</span></strong><span class="kobospan" id="kobo.535.1"> button allows </span><a id="_idIndexMarker537" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.536.1">us to save the request or response details to </span><span><span class="kobospan" id="kobo.537.1">a file.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.538.1">Chucker is very helpful in</span><a id="_idIndexMarker538" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.539.1"> debugging network requests in our apps. </span><span class="kobospan" id="kobo.539.2">When non-technical teams test the debuggable version of our app, we can always tell them to share these requests, especially when they’re facing issues with their </span><span><span class="kobospan" id="kobo.540.1">network requests.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.541.1">That’s it for Chucker. </span><span class="kobospan" id="kobo.541.2">Every time our app makes a network request, Chucker will show a notification and we can tap on the notification to see the details of </span><span><span class="kobospan" id="kobo.542.1">the request.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.543.1">We have learned about Chucker and how to use it to inspect network requests in our apps. </span><span class="kobospan" id="kobo.543.2">In the next section, we will learn how to use App Inspection to inspect our app’s room database and explore the features App </span><span><span class="kobospan" id="kobo.544.1">Inspection offers.</span></span></p>
<h1 id="_idParaDest-116" class="calibre6"><a id="_idTextAnchor133" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.545.1">Using App Inspection</span></h1>
<p class="calibre4"><strong class="bold"><span class="kobospan" id="kobo.546.1">App Inspection</span></strong><span class="kobospan" id="kobo.547.1"> allows us to debug our </span><a id="_idIndexMarker539" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.548.1">database, inspect network traffic, and debug our background tasks. </span><span class="kobospan" id="kobo.548.2">It is a very important tool in helping us debug our apps. </span><span class="kobospan" id="kobo.548.3">To use App Inspection, let us run our app and then navigate to </span><strong class="bold"><span class="kobospan" id="kobo.549.1">View</span></strong><span class="kobospan" id="kobo.550.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.551.1">Tool Windows</span></strong><span class="kobospan" id="kobo.552.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.553.1">App Inspection</span></strong><span class="kobospan" id="kobo.554.1"> in </span><span><span class="kobospan" id="kobo.555.1">Android Studio:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer146">
<span class="kobospan" id="kobo.556.1"><img alt="Figure 10.20 – App Inspection" src="image/B19779_10_20.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.557.1">Figure 10.20 – App Inspection</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.558.1">App Inspection automatically connects to our app. </span><span class="kobospan" id="kobo.558.2">The first tab is </span><strong class="bold"><span class="kobospan" id="kobo.559.1">Database Inspector</span></strong><span class="kobospan" id="kobo.560.1">. </span><span class="kobospan" id="kobo.560.2">On the left, we can see the different databases created by our app. </span><span class="kobospan" id="kobo.560.3">We have the WorkManager, Chucker, LeakCanary, and Cat databases that we created earlier on. </span><span class="kobospan" id="kobo.560.4">Let us click on the </span><strong class="bold"><span class="kobospan" id="kobo.561.1">Cat</span></strong><span class="kobospan" id="kobo.562.1"> database, and </span><a id="_idIndexMarker540" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.563.1">we can see the columns of the table that we created in </span><span><span class="kobospan" id="kobo.564.1">the database:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer147">
<span class="kobospan" id="kobo.565.1"><img alt="Figure 10.21 – Cat database" src="image/B19779_10_21.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.566.1">Figure 10.21 – Cat database</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.567.1">This shows the columns and the values that have been saved in the database. </span><span class="kobospan" id="kobo.567.2">We can also run queries in the database. </span><span class="kobospan" id="kobo.567.3">The query option is highlighted in the </span><span><span class="kobospan" id="kobo.568.1">following figure:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer148">
<span class="kobospan" id="kobo.569.1"><img alt="Figure 10.22 – Execute query button" src="image/B19779_10_22.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.570.1">Figure 10.22 – Execute query button</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.571.1">We want to run a query that shows the cats with a specific </span><strong class="source-inline"><span class="kobospan" id="kobo.572.1">id</span></strong><span class="kobospan" id="kobo.573.1">. </span><span class="kobospan" id="kobo.573.2">We can do this by running the </span><span><span class="kobospan" id="kobo.574.1">following </span></span><span><a id="_idIndexMarker541" class="calibre3 pcalibre pcalibre1"/></span><span><span class="kobospan" id="kobo.575.1">query:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.576.1">
SELECT * FROM CAT WHERE id == "rrsvsbRgL7zaJuR3"</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.577.1">You can use a different </span><strong class="source-inline"><span class="kobospan" id="kobo.578.1">id</span></strong><span class="kobospan" id="kobo.579.1"> per the data you have. </span><span class="kobospan" id="kobo.579.2">The query results will be </span><span><span class="kobospan" id="kobo.580.1">as follows:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer149">
<span class="kobospan" id="kobo.581.1"><img alt="Figure 10.23 – Query results" src="image/B19779_10_23.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.582.1">Figure 10.23 – Query results</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.583.1">The data has all the cats that have the ID we specified. </span><span class="kobospan" id="kobo.583.2">One thing to note is to ensure that you execute the queries on the correct database, as shown in </span><span><em class="italic"><span class="kobospan" id="kobo.584.1">Figure 10</span></em></span><em class="italic"><span class="kobospan" id="kobo.585.1">.23</span></em><span class="kobospan" id="kobo.586.1">. </span><span class="kobospan" id="kobo.586.2">The database inspector helps us debug and write queries to our database and is very useful when working on apps that use </span><span><span class="kobospan" id="kobo.587.1">a database.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.588.1">Let us now head over to the </span><strong class="bold"><span class="kobospan" id="kobo.589.1">Network Inspector</span></strong><span class="kobospan" id="kobo.590.1"> tab. </span><span class="kobospan" id="kobo.590.2">This tab shows us the network requests that have been </span><a id="_idIndexMarker542" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.591.1">made by our app. </span><span class="kobospan" id="kobo.591.2">We can see the request method, the URL, the status code, and the duration of </span><span><span class="kobospan" id="kobo.592.1">the request:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer150">
<span class="kobospan" id="kobo.593.1"><img alt="Figure 10.24 – Network Inspector" src="image/B19779_10_24.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.594.1">Figure 10.24 – Network Inspector</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.595.1">From the preceding figure, we can see that the requests are for loading the cute cat images and all the details of the request. </span><span class="kobospan" id="kobo.595.2">Similar to Chucker, it also has the request and response tabs that provide more information on the request. </span><span class="kobospan" id="kobo.595.3">However, unlike Chucker, </span><strong class="bold"><span class="kobospan" id="kobo.596.1">Network Inspector</span></strong><span class="kobospan" id="kobo.597.1"> captures the network requests made by the app without any additional setup in the code. </span><span class="kobospan" id="kobo.597.2">The </span><strong class="bold"><span class="kobospan" id="kobo.598.1">Network Inspector</span></strong><span class="kobospan" id="kobo.599.1"> tab is very useful in helping us debug network requests in our apps, especially when working on apps that make a lot of </span><span><span class="kobospan" id="kobo.600.1">network requests.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.601.1">Lastly, let us head over to the </span><strong class="bold"><span class="kobospan" id="kobo.602.1">Background Task Inspector</span></strong><span class="kobospan" id="kobo.603.1"> tab. </span><span class="kobospan" id="kobo.603.2">This tab shows us the background task requests that have been made by our app. </span><span class="kobospan" id="kobo.603.3">Our app should show </span><span><span class="kobospan" id="kobo.604.1">the following:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer151">
<span class="kobospan" id="kobo.605.1"><img alt="Figure 10.25 – Background Task Inspector" src="image/B19779_10_25.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.606.1">Figure 10.25 – Background Task Inspector</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.607.1">The Background Task Inspector shows us the details of our background tasks. </span><span class="kobospan" id="kobo.607.2">It has information for WorkManager </span><strong class="bold"><span class="kobospan" id="kobo.608.1">Workers</span></strong><span class="kobospan" id="kobo.609.1">, </span><strong class="bold"><span class="kobospan" id="kobo.610.1">Jobs</span></strong><span class="kobospan" id="kobo.611.1">, </span><strong class="bold"><span class="kobospan" id="kobo.612.1">Alarms</span></strong><span class="kobospan" id="kobo.613.1">, and </span><strong class="bold"><span class="kobospan" id="kobo.614.1">WakeLocks</span></strong><span class="kobospan" id="kobo.615.1">. </span><span class="kobospan" id="kobo.615.2">Since our app only has the workers, we can see that the </span><strong class="source-inline"><span class="kobospan" id="kobo.616.1">PetsSyncWorker</span></strong><span class="kobospan" id="kobo.617.1"> worker has succeeded. </span><span class="kobospan" id="kobo.617.2">On the right are</span><a id="_idIndexMarker543" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.618.1"> more details of the worker, as shown in </span><span><em class="italic"><span class="kobospan" id="kobo.619.1">Figure 10</span></em></span><em class="italic"><span class="kobospan" id="kobo.620.1">.25</span></em><span class="kobospan" id="kobo.621.1">. </span><span class="kobospan" id="kobo.621.2">The details show the UUID, constraints, state, and results of the worker, such as the output data, number of retries, and the time it started. </span><span class="kobospan" id="kobo.621.3">This information is very helpful to check whether our background tasks are running </span><span><span class="kobospan" id="kobo.622.1">as expected.</span></span></p>
<h1 id="_idParaDest-117" class="calibre6"><a id="_idTextAnchor134" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.623.1">Summary</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.624.1">In this chapter, we learned some debugging tips and tricks, how to detect leaks using LeakCanary, how to inspect network requests/responses fired by our app using Chucker, and how to use App Inspection to debug our database, inspect our network requests, and inspect background </span><span><span class="kobospan" id="kobo.625.1">tasks, too.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.626.1">In the next chapter, we will learn Kotlin style and the best practices for writing Kotlin code. </span><span class="kobospan" id="kobo.626.2">We will also learn how to use plugins such as Ktlint and Detekt to format, lint, and detect the code </span><span><span class="kobospan" id="kobo.627.1">smells early.</span></span></p>
</div>
</body></html>