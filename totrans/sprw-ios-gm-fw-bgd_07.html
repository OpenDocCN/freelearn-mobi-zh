<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;User Interface"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. User Interface</h1></div></div></div><p>
<span class="emphasis"><em>In the previous chapter, we learned about adding the first gameplay elements into our game. Our pirate ship can now shoot cannonballs, and if the cannonballs hit the enemy enough number of times, the enemy ship will be destroyed.</em></span>
</p><p>In this chapter, we are going to add user interface elements. Specifically, we will improve our game in the following aspects:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Display and update the health of each ship</li><li class="listitem" style="list-style-type: disc">Add buttons on the screen</li><li class="listitem" style="list-style-type: disc">Display text on the screen</li></ul></div><p>So, let's start by adding a visual representation for hit points on the screen.</p><div class="section" title="Displaying the hit points of each ship"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec84"/>Displaying the hit points of each ship</h1></div></div></div><p>By default, each ship has 100 hit points, and each cannonball does 25 points of damage to those hit points. We do have some visual feedback when a cannonball hits a ship, but we don't know how many hit points a ship has once hit a few times.</p></div></div>
<div class="section" title="Time for action &#x2013; placing a health bar on top of each ship"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec85"/>Time for action – placing a health bar on top of each ship</h1></div></div></div><p>To display the hit points <a id="id292" class="indexterm"/>for each ship, we just need to follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open our game's project file if it's not already open.</li><li class="listitem">Switch to the <code class="literal">Ship.h</code> file.</li><li class="listitem">Add an instance variable called <code class="literal">_quadHitpoints</code>, which is a pointer to <code class="literal">SPQuad</code>, as shown in the following line of code:<div class="informalexample"><pre class="programlisting">SPQuad *_quadHitpoints;</pre></div></li><li class="listitem">Switch to the <code class="literal">Ship.m</code> file. Just after where we create the cannonball images in the initializer, we add a<a id="id293" class="indexterm"/> quad which should be the border for our hit point representation, as shown in the following code:<div class="informalexample"><pre class="programlisting">float hitpointsHeight = 5.0f;
SPQuad *hitpointsBorder = [SPQuad quadWithWidth:clipNorth.width height:hitpointsHeight color:SP_BLACK];</pre></div></li><li class="listitem">We add the background for the hit points box, as shown in the following code:<div class="informalexample"><pre class="programlisting">uint redColor = SP_COLOR(200, 0, 0);
SPQuad *quadMaxHitpoints = [SPQuad quadWithWidth:hitpointsBorder.width - 2.0f height:hitpointsHeight - 2.0f color:redColor];</pre></div></li><li class="listitem">We set the background for the hit points box to have a one point margin, which means its position needs to be one point to the left and one point up from the local coordinate system:<div class="informalexample"><pre class="programlisting">quadMaxHitpoints.x = 1.0f;
quadMaxHitpoints.y = 1.0f;</pre></div></li><li class="listitem">We then create <code class="literal">SPQuad</code> from the <code class="literal">_quadHitpoints</code> instance variable, as shown in the following code:<div class="informalexample"><pre class="programlisting">uint greenColor = SP_COLOR(0, 180, 0);
_quadHitpoints = [SPQuad quadWithWidth:hitpointsBorder.width - 2.0f height:hitpointsHeight - 2.0f color:greenColor];</pre></div></li><li class="listitem">As shown in the following code, we set the hit points to the same coordinates as the background:<div class="informalexample"><pre class="programlisting">_quadHitpoints.x = quadMaxHitpoints.x;
_quadHitpoints.y = quadMaxHitpoints.y;</pre></div></li><li class="listitem">We then add all of the hit point quads to the display tree, as shown in the following code:<div class="informalexample"><pre class="programlisting">[self addChild:hitpointsBorder];
[self addChild:quadMaxHitpoints];
[self addChild:_quadHitpoints];</pre></div></li><li class="listitem">Inside the <code class="literal">setHitpoints</code> method, add the following line of code just after the statement where we set the instance variable to the value of the parameter:<div class="informalexample"><pre class="programlisting">_quadHitpoints.scaleX = (float) _hitpoints / self.maxHitpoints;</pre></div></li><li class="listitem">Run the example.</li></ol></div><p>As seen in the following screenshot, both ships now have the amount of their hit points represented as red and green bars:</p><div class="mediaobject"><img src="graphics/1509OS_07_01.jpg" alt="Time for action – placing a health bar on top of each ship"/></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec82"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>In step 1, we opened our Xcode template from where we had left off in the previous chapter. First of all, we need an instance variable that should represent our hit points. If we think about how other games display the <a id="id294" class="indexterm"/>current hit points, in strategy games mostly, the hit points are represented as little green and red bars above each unit. In fighting games, the hit points are displayed at the top left- and right-hand sides for each player. As we might have more than one enemy on the screen, the best representation will be to have red and green bars above each of the ship. The green portion of the bar would be the amount of hit points the ship currently has and the red portion is the amount that is currently missing.</p><p>In step 2, we switched to the <code class="literal">Ship.h</code> file as we wanted to define an instance variable. To represent the hit points, we chose <code class="literal">SPQuad</code> and called our variable <code class="literal">_quadHitpoints</code>. To actually implement the hit point mechanics, we switched to the <code class="literal">Ship.m</code> file. Our hit points bar actually consists of three different boxes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A border around the hit points</li><li class="listitem" style="list-style-type: disc">The background for the hit points (a red bar)</li><li class="listitem" style="list-style-type: disc">The actual hit point bar (a green bar which is represented by our <code class="literal">_quadHitpoints</code> instance variable)</li></ul></div><p>In step 5, we defined a black rectangle that will act as the border for our hit point bar. The width of the rectangle should be the width of the ship. We got the width from the <code class="literal">clipNorth</code> movie clip. Actually, we can also get the ship's width from any other movie clips. We set the height of the black rectangle to five points. We don't want the hit points bar to be too thick, but it has to be easily visible and recognizable.</p><p>In the next step, we set the background of the hit points. We defined a <code class="literal">SPQuad</code> instance, which we call <code class="literal">quadMaxHitpoints</code>. It should be one point smaller than the black rectangle on each side. We used the width from the <code class="literal">hitpointsBorder</code> instance and had set the height to three points.</p><p>We set the left and the<a id="id295" class="indexterm"/> top of the <code class="literal">quadMaxHitpoints</code> instance to one point each so that it will actually look as if the hit point bar has a border.</p><p>We then initialized the <code class="literal">quadHitpoints</code> instance variable in step 8. It's a <code class="literal">SPQuad</code> class as well and has the same dimensions as our background hit point bar.</p><p>With the <code class="literal">quadMaxHitpoints</code> instance, we want <code class="literal">_quadHitpoints</code> to be displayed inside the border. So, we set the position of<code class="literal">_quadHitpoints</code> one point to the left and top relative to the ship itself. In this case, we can adjust the position from the <code class="literal">quadMaxHitpoints</code> quad.</p><p>For the red and green rectangles, we refrained from using bright colors, as this might strain the eyes and distract us from the action. Also, as we are going for a darker tone in general, having bright colors would not fit in this context. Keep in mind when coloring and designing the user interface that the elements should be tested on the actual device. The brightness is usually not at its maximum, especially if the device is running on battery. In some cases, graphics are even given additional contrast or are brightened so that they don't look too dark on mobile devices.</p><p>In step 10, we added all of the quads to the display tree; all of the quads are children of the <code class="literal">Ship</code> class.</p><p>After this point, our code snippet will look like the following:</p><div class="informalexample"><pre class="programlisting">SPMovieClip *clipSouthWest = [SPMovieClip movieWithFrames:texturesSouthWest fps:animationFPS];
SPMovieClip *clipSouthEast = [SPMovieClip movieWithFrames:texturesSouthEast fps:animationFPS];

_shootingClip = [NSArray arrayWithObjects:clipNorth, clipSouth, clipWest, clipEast, clipNorthWest, clipNorthEast, clipSouthWest, clipSouthEast, nil];

self.cannonBallLeft = [SPImage imageWithTexture:[Assets texture:@"cannonball.png"]];
self.cannonBallRight = [SPImage imageWithTexture:[Assets texture:@"cannonball.png"]];

<span class="strong"><strong>float hitpointsHeight = 5.0f;</strong></span>
<span class="strong"><strong>        SPQuad *hitpointsBorder = [SPQuad quadWithWidth:clipNorth.width height:hitpointsHeight color:SP_BLACK];</strong></span>
<span class="strong"><strong>  </strong></span>
<span class="strong"><strong>  uint redColor = SP_COLOR(200, 0, 0);</strong></span>
<span class="strong"><strong>        SPQuad *quadMaxHitpoints = [SPQuadquadWithWidth:hitpointsBorder.width - 2.0fheight:hitpointsHeight - 2.0f color:redColor];</strong></span>
<span class="strong"><strong>        quadMaxHitpoints.x = 1.0f;</strong></span>
<span class="strong"><strong>        quadMaxHitpoints.y = 1.0f;</strong></span>
<span class="strong"><strong>        </strong></span>
<span class="strong"><strong>  uint greenColor = SP_COLOR(0, 180, 0);</strong></span>
<span class="strong"><strong>        _quadHitpoints = [SPQuad quadWithWidth:hitpointsBorder.width - 2.0f height:hitpointsHeight - 2.0f color:greenColor];</strong></span>
<span class="strong"><strong>        _quadHitpoints.x = quadMaxHitpoints.x;</strong></span>
<span class="strong"><strong>        _quadHitpoints.y = quadMaxHitpoints.y;</strong></span>

for (SPMovieClip* clip in _shootingClip) {
  clip.loop = NO;
  [self addChild:clip];
}

self.cannonBallLeft.visible = NO;
self.cannonBallRight.visible = NO;

[self addChild:self.cannonBallLeft];
[self addChild:self.cannonBallRight];

<span class="strong"><strong>[self addChild:hitpointsBorder];</strong></span>
<span class="strong"><strong>[self addChild:quadMaxHitpoints];</strong></span>
<span class="strong"><strong>[self addChild:_quadHitpoints];</strong></span>

self.direction = DirectionSouthWest;</pre></div><p>If we were to use the hit points' creation code more than once, it is considered a best practice to put this piece of code into a separate method.</p><p>In the next step, we updated the hit points setter. The <code class="literal">_quadHitpoints</code> instance will be scaled horizontally. As <a id="id296" class="indexterm"/>both <code class="literal">_hitpoints</code> and <code class="literal">self.maxHitpoints</code> are integer values, we needed to cast it to a float value. If we don't do this, the hit points bar would either be red or green with nothing in between.</p><p>The <code class="literal">setHitpoints</code> method will look like the following piece of code after step 10:</p><div class="informalexample"><pre class="programlisting">-(void) setHitpoints:(int)hitpoints
{
    _hitpoints = hitpoints;
    
<span class="strong"><strong>    _quadHitpoints.scaleX = (float) _hitpoints / self.maxHitpoints;</strong></span>
    
    if (_hitpoints &lt;= 0) {
        self.visible = FALSE;
    }
}</pre></div><p>We ran the example in the last step and saw that the enemy ship as well as our ship have hit point bars on top<a id="id297" class="indexterm"/> of them. When the ships moved, the hit point bars also moved with them, and when we hit the enemy ship, the hit points bar updated itself accordingly.</p></div></div>
<div class="section" title="Adding buttons to the screen"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec86"/>Adding buttons to the screen</h1></div></div></div><p>Now that we have hit point bars on the screen, let's add some things that the user can actually interact with.</p><div class="section" title="Pausing and resuming the game"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec83"/>Pausing and resuming the game</h2></div></div></div><p>The first thing we are going to add is the ability to pause and resume the game at will. This is actually quite important, especially<a id="id298" class="indexterm"/> for mobile action games. If a call comes on the mobile device (iPhone) and we don't have a pause functionality, the player might get frustrated by not being able to pause the game and lose their progress or winning streak.</p><p>Before we get into implementing these buttons, let's download the necessary graphics for this chapter which are available at <a class="ulink" href="https://github.com/freezedev/pirategame-assets/releases/download/0.7/Graphics_07.zip">https://github.com/freezedev/pirategame-assets/releases/download/0.7/Graphics_07.zip</a>. Copy the contents of the extracted file into the project.</p><p>Let's think of what we need to do when pausing the game:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Display a button to<a id="id299" class="indexterm"/> pause the game</li><li class="listitem" style="list-style-type: disc">Display a button to resume the game</li><li class="listitem" style="list-style-type: disc">Stop all current tweens when the player clicks on the pause button</li><li class="listitem" style="list-style-type: disc">Resume all current tweens when the player clicks on the resume button</li></ul></div><p>As this is a bigger task, we are splitting it into two parts; first, we are going to display the buttons, and then we will implement the functionality.</p><div class="section" title="Displaying the pause and resume buttons on the screen"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec08"/>Displaying the pause and resume buttons on the screen</h3></div></div></div><p>In this example, we are going to add all of the buttons we need and will display them at the correct position on the screen.</p></div></div></div>
<div class="section" title="Time for action &#x2013; putting buttons on the screen"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec87"/>Time for action – putting buttons on the screen</h1></div></div></div><p>To add our first <a id="id300" class="indexterm"/>buttons, follow<a id="id301" class="indexterm"/> these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">Battlefield.h</code> file.</li><li class="listitem">Add one instance variable for each button. We will use the <code class="literal">SPButton</code> type, as shown in the following code:<div class="informalexample"><pre class="programlisting">SPButton *_buttonPause;
SPButton *_buttonResume;</pre></div></li><li class="listitem">Switch to the <code class="literal">Battlefield.m</code> file.</li><li class="listitem">Construct the instances<a id="id302" class="indexterm"/> for our two instance variables, as <a id="id303" class="indexterm"/>shown in the following code:<div class="informalexample"><pre class="programlisting">_buttonPause = [SPButton buttonWithUpState:[[Assets textureAtlas:@"ui.xml"] textureByName:@"button_pause"]];
_buttonResume = [SPButton buttonWithUpState:[[Assets textureAtlas:@"ui.xml"] textureByName:@"button_play"]];</pre></div></li><li class="listitem">Set the position of both the pause and resume buttons to the top-right corner of the screen using the following code:<div class="informalexample"><pre class="programlisting">_buttonPause.x = Sparrow.stage.width - _buttonPause.width - 4.0f;
_buttonPause.y = 4.0f;

_buttonResume.x = _buttonPause.x;
_buttonResume.y = _buttonPause.y;</pre></div></li><li class="listitem">Hide the resume button <a id="id304" class="indexterm"/>using the following line of code:<div class="informalexample"><pre class="programlisting">_buttonResume.visible = NO;</pre></div></li><li class="listitem">For later usage, create methods to tap the pause and resume buttons, as shown in the following code:<div class="informalexample"><pre class="programlisting">-(void) onButtonPause:(SPTouchEvent *)event
{

}

-(void) onButtonResume:(SPTouchEvent *)event
{

}</pre></div></li><li class="listitem">Bind the newly created methods to the pause and resume buttons, as shown in the following code:<div class="informalexample"><pre class="programlisting">[_buttonPause addEventListener:@selector(onButtonPause:) atObject:self forType:SP_EVENT_TYPE_TRIGGERED ];
[_buttonResume addEventListener:@selector(onButtonResume:) atObject:self forType:SP_EVENT_TYPE_TRIGGERED ];</pre></div></li><li class="listitem">Add both buttons to the display tree as follows:<div class="informalexample"><pre class="programlisting">[self addChild:_buttonPause];
[self addChild:_buttonResume];</pre></div></li><li class="listitem">Run the example to see the result. We now have a pause button on the screen, as<a id="id305" class="indexterm"/> shown in the <a id="id306" class="indexterm"/>following screenshot:<div class="mediaobject"><img src="graphics/1509OS_07_02.jpg" alt="Time for action – putting buttons on the screen"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec84"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>In step 1, we opened the <code class="literal">Battlefield.h</code> file. We added two instance variables to this class, one for the pause button and one for the resume button. We used the <code class="literal">SPButton</code> class, which is pretty much an<a id="id307" class="indexterm"/> image, and optionally displayed some text on top of it.</p><p>Next, we switched to the <code class="literal">Battlefield.m</code> file. In step 4, we initialized both buttons. We need to take a closer look at the following two points:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We already know that we can get an array of textures if we use the <code class="literal">texturesStartingWith</code> method. If we want only a single texture, we need to use <code class="literal">textureByName</code>, and we also have to specify the correct name.</li><li class="listitem" style="list-style-type: disc"><code class="literal">SPButton</code> provides several factory methods. The one we are using is the <code class="literal">buttonWithUpState</code> method in<a id="id308" class="indexterm"/> which we have to pass an <code class="literal">SPTexture</code> instance. The up state is the texture that is visible all the time. If we were to specify a down state, the down state would be visible once the button is tapped. Another factory method lets us specify either the down state or even some text.</li></ul></div><p>In the next step, we positioned the buttons at the top-right of the screen. We left a bit of space (four points) so that the button is not too close to the edge of the screen.</p><p>In step 6, we hid the resume button so that we only see the pause button the first time the scene is being shown.</p><p>In the next step, we added some dummy methods to pause and resume the game. We left these empty for now, but we'll fill them in a little bit.</p><p>Next, we linked these <a id="id309" class="indexterm"/>methods to the buttons so that they will be called when we touch these buttons.</p><p>To actually show the buttons on the<a id="id310" class="indexterm"/> screen, we need to add them to the display tree, which we did in step 9.</p><p>Let's take a look at what exactly changed in the initializer:</p><div class="informalexample"><pre class="programlisting">SPTween *shipTween = [SPTween tweenWithTarget:_enemyShip time:4.0f transition:SP_TRANSITION_EASE_IN_OUT];
[shipTween animateProperty:@"y" targetValue:250];
shipTween.repeatCount = 5;
shipTween.reverse = YES;
shipTween.delay = 2.0f;

<span class="strong"><strong>_buttonPause = [SPButton buttonWithUpState:[[Assets textureAtlas:@"ui.xml"] textureByName:@"button_pause"]];</strong></span>
<span class="strong"><strong>_buttonResume = [SPButton buttonWithUpState:[[Assets textureAtlas:@"ui.xml"] textureByName:@"button_play"]];</strong></span>

<span class="strong"><strong>_buttonPause.x = Sparrow.stage.width - _buttonPause.width - 4.0f;</strong></span>
<span class="strong"><strong>_buttonPause.y = 4.0f;</strong></span>

<span class="strong"><strong>_buttonResume.x = _buttonPause.x;</strong></span>
<span class="strong"><strong>_buttonResume.y = _buttonPause.y;</strong></span>

<span class="strong"><strong>_buttonResume.visible = NO;</strong></span>

<span class="strong"><strong>[_buttonPause addEventListener:@selector(onButtonPause:) atObject:self forType:SP_EVENT_TYPE_TOUCH];</strong></span>
<span class="strong"><strong>[_buttonResume addEventListener:@selector(onButtonResume:) atObject:self forType:SP_EVENT_TYPE_TOUCH];</strong></span>

[Sparrow.juggler addObject:shipTween];

[_background addEventListener:@selector(onBackgroundTouch:) atObject:self forType:SP_EVENT_TYPE_TOUCH];
[_pirateShip addEventListener:@selector(onShipTap:) atObject:self forType:SP_EVENT_TYPE_TOUCH];

[self addEventListener:@selector(onEnterFrame:) atObject:self forType:SP_EVENT_TYPE_ENTER_FRAME];

[self addChild:_background];
[self addChild:_enemyShip];
[self addChild:_pirateShip];

[self addChild:_buttonPause];
<span class="strong"><strong>[self addChild:_buttonResume];</strong></span>
</pre></div><p>Now, when we ran the example, we saw the pause button in the top-right corner of the screen. When we tap the button, nothing<a id="id311" class="indexterm"/> happens except for the button scaling down a bit.</p><div class="section" title="Implementing the logic to pause and resume the game"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec09"/>Implementing the logic to pause and resume the game</h3></div></div></div><p>Now that we have displayed the buttons on the screen, let's allow the player to pause and resume the game. We are going to utilize our own juggler and, save if the game is paused into a variable and if the game is not paused, we advance our juggler as well as the child elements.</p></div></div></div>
<div class="section" title="Time for action &#x2013; allowing the player to pause and resume"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec88"/>Time for action – allowing the player to pause and resume</h1></div></div></div><p>To allow the <a id="id312" class="indexterm"/>player to pause and<a id="id313" class="indexterm"/> resume the game, we need to follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">Ship.h</code> file.</li><li class="listitem">Add an instance variable called <code class="literal">_juggler</code> that is a pointer to <code class="literal">SPJuggler</code>, as shown in the following line of code:<div class="informalexample"><pre class="programlisting">SPJuggler *_juggler;</pre></div></li><li class="listitem">Declare a property called <code class="literal">paused</code>, which is of the type <code class="literal">BOOL</code>, as shown in the following line of code:<div class="informalexample"><pre class="programlisting">@property (nonatomic) BOOL paused;</pre></div></li><li class="listitem">Declare a method called <code class="literal">advanceTime</code>, as shown in the following line of code:<div class="informalexample"><pre class="programlisting">-(void) advanceTime:(double)seconds;</pre></div></li><li class="listitem">Switch to the <code class="literal">Ship.m</code> file.</li><li class="listitem">Inside the initializer, set the <code class="literal">paused</code> property to <code class="literal">NO</code> using its instance variable, as shown in the following code:<div class="informalexample"><pre class="programlisting">_isShooting = NO;
<span class="strong"><strong>_paused = NO;</strong></span>

SPTextureAtlas *atlas = (type == ShipPirate) ? [Assets textureAtlas:@"ship_pirate_small_cannon.xml"] : [Assets textureAtlas:@"ship_small_cannon.xml"];</pre></div></li><li class="listitem">Initialize the <code class="literal">_juggler</code> instance variable inside the initializer with the following line of code:<div class="informalexample"><pre class="programlisting">_juggler = [SPJuggler juggler];</pre></div></li><li class="listitem">Update all references from <code class="literal">Sparrow.juggler</code> to <code class="literal">_juggler</code>.</li><li class="listitem">Implement the <code class="literal">advanceTime</code> method with the following lines of code:<div class="informalexample"><pre class="programlisting">-(void) advanceTime:(double)seconds
{
    if (!self.paused) {
        [_juggler advanceTime:seconds];
    }
}</pre></div></li><li class="listitem">Switch to the <code class="literal">Battlefield.h</code> file.</li><li class="listitem">Add an instance variable for <code class="literal">juggler</code> here as well:<div class="informalexample"><pre class="programlisting">SPJuggler *_juggler;</pre></div></li><li class="listitem">Add an instance variable for the <a id="id314" class="indexterm"/>background using the following line of code:<div class="informalexample"><pre class="programlisting">SPImage *_background;</pre></div></li><li class="listitem">Add a property<a id="id315" class="indexterm"/> called <code class="literal">paused</code> which is a <code class="literal">BOOL</code> type. As we are going to add custom getters and setters for this property, we also need an instance variable called <code class="literal">_paused</code> as shown in the following code:<div class="informalexample"><pre class="programlisting">@interface Battlefield : Scene {
    Ship *_pirateShip;
    Ship *_enemyShip;
    
    SPImage *_background;
    
    SPButton *_buttonPause;
    SPButton *_buttonResume;
    
    SPJuggler *_juggler;
    
    <span class="strong"><strong>BOOL _paused;</strong></span>
}

<span class="strong"><strong>@property (nonatomic) BOOL paused;</strong></span>
</pre></div></li><li class="listitem">Switch to the <code class="literal">Battlefield.m</code> file.</li><li class="listitem">Inside the initializer, update the reference from the local background variable to the <code class="literal">_background</code> instance variable.</li><li class="listitem">Inside the <code class="literal">Battlefield</code> initializer, initialize the <code class="literal">_juggler</code> instance. This has to be done before we add <code class="literal">shipTween</code> to <code class="literal">juggler</code>:<div class="informalexample"><pre class="programlisting">[_buttonPause addEventListener:@selector(onButtonPause:) atObject:self forType:SP_EVENT_TYPE_TOUCH];
[_buttonResume addEventListener:@selector(onButtonResume:) atObject:self forType:SP_EVENT_TYPE_TOUCH];

<span class="strong"><strong>_juggler = [SPJuggler juggler];</strong></span>

[Sparrow.juggler addObject:shipTween];</pre></div></li><li class="listitem">Update all references from <code class="literal">Sparrow.juggler</code> to <code class="literal">_juggler</code>.</li><li class="listitem">Add a custom <a id="id316" class="indexterm"/>setter for the <code class="literal">paused</code> property with the following content:<div class="informalexample"><pre class="programlisting">-(void) setPaused:(BOOL)paused
{
    _paused = paused;
    
    _buttonResume.visible = _paused;
    _buttonPause.visible = !_paused;
    
    _background.touchable = !_paused;
    
    _pirateShip.paused = _paused;
    _enemyShip.paused = _paused;
}</pre></div></li><li class="listitem">Add a custom getter for the <code class="literal">paused</code> property that returns the <code class="literal">_paused</code> instance variable:<div class="informalexample"><pre class="programlisting">-(BOOL) paused
{
    return _paused;
}</pre></div></li><li class="listitem">Implement the <code class="literal">onButtonPause</code> and <code class="literal">onButtonResume</code> methods by setting the <code class="literal">paused</code> property to its correct <a id="id317" class="indexterm"/>values (<code class="literal">YES</code> in the <code class="literal">onButtonPause</code> method, <code class="literal">NO</code> in the <code class="literal">onButtonResume</code> method).</li><li class="listitem">Update the parameter type in <code class="literal">onEnterFrame</code> from being a pointer to <code class="literal">SPEvent</code> to being a pointer to <code class="literal">SPEnterFrameEvent</code>.</li><li class="listitem">Add the following lines of code to the <code class="literal">onEnterFrame</code> method:<div class="informalexample"><pre class="programlisting">double passedTime = event.passedTime;

[_enemyShip advanceTime:passedTime];
[_pirateShip advanceTime:passedTime];
if (!self.paused) {
  [_juggler advanceTime:passedTime];
}</pre></div></li><li class="listitem">Run the example.<p>We can now tap the pause and resume buttons. In the following screenshot, you can see that <a id="id318" class="indexterm"/>when the game is paused, all animations stop until we press the resume button:</p><div class="mediaobject"><img src="graphics/1509OS_07_03.jpg" alt="Time for action – allowing the player to pause and resume"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec85"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>In the <code class="literal">Ship.h</code> file, we updated<a id="id319" class="indexterm"/> the interface by performing the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Added a new <code class="literal">juggler</code> instance variable, which is a pointer to <code class="literal">SPJuggler</code> (step 2)</li><li class="listitem" style="list-style-type: disc">Added a <code class="literal">paused</code> property with the type <code class="literal">BOOL</code> (step 3)</li><li class="listitem" style="list-style-type: disc">Declared a method called <code class="literal">advanceTime</code> (step 4)</li></ul></div><p>Sparrow does not provide the pause and resume methods for its jugglers. We dealt with this by introducing our own jugglers and setting a flag if the game is paused, and we advanced all of our jugglers only if the game was not paused.</p><p>In step 5, we switched to the <code class="literal">Ship.m</code> file and we defined the <code class="literal">paused</code> property inside the initializer to <code class="literal">NO</code>, because by default, the ships should not be paused. This step is not necessary as Objective-C initializes this instance as <code class="literal">NO</code>; it's just a reminder to see which instance variables we have if we were to decide to change a value later on, and we know where to look.</p><p>In the next step, we initialized the <code class="literal">_juggler</code> instance variable. It does not matter where exactly we defined the juggler instance variable inside the initializer as we don't add any tweens to jugglers in the initializer method. Next, we searched and replaced all references from <code class="literal">Sparrow.juggler</code> to <code class="literal">_juggler</code>. The easiest way is to use <span class="emphasis"><em>command</em></span> + <span class="emphasis"><em>F</em></span>, select <span class="strong"><strong>Replace</strong></span> from the drop-down list, put <code class="literal">Sparrow.juggler</code> in the first input box, <code class="literal">_juggler</code> in the second input, and select <span class="strong"><strong>All</strong></span> to replace all the references.</p><p>In step 9, we implemented the <code class="literal">advanceTime</code> method, where we call the <code class="literal">advanceTime</code> method from <code class="literal">_juggler</code> and pass in <code class="literal">double</code> as the <code class="literal">seconds</code> parameter. This is only called if the <code class="literal">paused</code> property is set to <code class="literal">NO</code>.</p><p>Next, we<a id="id320" class="indexterm"/> switched to the <code class="literal">Battlefield.h</code> file. Here, we needed to perform the following steps:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Add an instance <a id="id321" class="indexterm"/>variable for a juggler, similar to how we did for the <code class="literal">Ship</code> class (step 11).</li><li class="listitem" style="list-style-type: disc">We now need an instance variable that references the background image instance (step 12).</li><li class="listitem" style="list-style-type: disc">We need a <code class="literal">paused</code> property. As we are going to implement custom getters and setters, we also need an instance variable corresponding to that property (step 13).</li></ul></div><p>Then, we switched to the <code class="literal">Battlefield.m </code>file. In the next step, we updated all references from the local background variable to the instance variable <code class="literal">_background</code>.</p><p>In step 16, we initialized our <code class="literal">_juggler</code> instance variable. Here, it does matter where we initialize this instance; it should be right before the line <code class="literal">[Sparrow.juggler addObject:shipTween];</code>.</p><p>Next, we updated the references to use <code class="literal">_juggler</code> instead of <code class="literal">Sparrow.juggler</code> inside the battlefield scene.</p><p>Then, we defined the setter for the <code class="literal">paused</code> property. Let's take a closer look at what exactly happened:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We set the <code class="literal">_paused</code> instance variable to the value of the parameter.</li><li class="listitem" style="list-style-type: disc">If <code class="literal">_paused</code> is set to <code class="literal">YES</code>, <code class="literal">_buttonPause</code> is not visible and <code class="literal">_buttonResume</code> is visible. If <code class="literal">_paused</code> is set to <code class="literal">NO</code>, it's the other way round.</li><li class="listitem" style="list-style-type: disc">Each sprite has a <code class="literal">touchable</code> property. If this is set to <code class="literal">NO</code>, touch handlers won't fire. We set this to <code class="literal">NO</code> so the game can be paused.</li><li class="listitem" style="list-style-type: disc">We paused all ships on the screen.</li></ul></div><p>In step 19, we defined the getter for the <code class="literal">paused</code> property. It just returned the <code class="literal">_paused</code> instance variable.</p><p>We then implemented the <code class="literal">onButtonPause</code> and <code class="literal">onButtonResume</code> methods, where we set the <code class="literal">paused</code> property to <code class="literal">YES</code> and <code class="literal">NO</code>, respectively.</p><p>In step 21, we needed to update the parameter type in our <code class="literal">onEnterFrame</code> method. It needs to be a pointer to <code class="literal">SPEnterFrame</code>.</p><p>Then, we added some lines of code to the <code class="literal">onEnterFrame</code> method. Now that the event is a pointer to <code class="literal">SPEnterFrame</code>, we can <a id="id322" class="indexterm"/>actually get the time that has been passed by getting the <code class="literal">passedTime</code> property from the event parameter. We then called the <code class="literal">advanceTime</code> method from all the ships on the screen, and if the scene is paused, we call the <code class="literal">advanceTime</code> method from <code class="literal">_juggler</code>.</p><p>When we ran the example, we<a id="id323" class="indexterm"/> can now pause and resume the game at will.</p></div><div class="section" title="Have a go hero"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec86"/>Have a go hero</h2></div></div></div><p>Here are some suggestions of what we could improve:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">As there isn't much happening in the <code class="literal">onButtonPause</code> and <code class="literal">onButtonResume</code> methods, we could either try to use blocks or merge both methods into one.</li><li class="listitem" style="list-style-type: disc">We could extend the <code class="literal">Scene</code> class to use a <code class="literal">juggler</code> instance variable, so we don't need to redefine a custom juggler wherever we need it.</li><li class="listitem" style="list-style-type: disc">Right now, we have <a id="id324" class="indexterm"/>custom user interface elements for each scene. However, if this were to change, we should think about abstracting the user interface logic into a separate class and maybe bind it to the <code class="literal">Scene</code> class.</li></ul></div></div><div class="section" title="Aborting the current game"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec87"/>Aborting the current game</h2></div></div></div><p>So far, we don't have the ability to switch to the pirate cove scene. However, we should introduce the option to abort the current fight.</p></div></div>
<div class="section" title="Time for action &#x2013; conceding the game"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec89"/>Time for action – conceding the game</h1></div></div></div><p>To abort the <a id="id325" class="indexterm"/>current game, we need <a id="id326" class="indexterm"/>to follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">Battlefield.m</code> file.</li><li class="listitem">Inside the initializer, we should <a id="id327" class="indexterm"/>add the abort button right after the resume button:<div class="informalexample"><pre class="programlisting">SPButton *buttonAbort = [SPButton buttonWithUpState:[[Assets textureAtlas:@"ui.xml"] textureByName:@"button_abort"]];</pre></div></li><li class="listitem">Position the abort button in the bottom-right corner:<div class="informalexample"><pre class="programlisting">buttonAbort.x = Sparrow.stage.width - buttonAbort.width - 4.0f;
buttonAbort.y = Sparrow.stage.height - buttonAbort.height - 4.0f;</pre></div></li><li class="listitem">Import the <code class="literal">SceneDirector</code> class, as shown in the following line of code:<div class="informalexample"><pre class="programlisting">#import "SceneDirector.h"</pre></div></li><li class="listitem">Add a listener to the abort button using a block, as shown in the following code:<div class="informalexample"><pre class="programlisting">[buttonAbort addEventListenerForType:SP_EVENT_TYPE_TRIGGERED block:^(SPEvent *event)
{
  [((SceneDirector *) self.director) showScene:@"piratecove"];
}];</pre></div></li><li class="listitem">Add the button to the display tree, as shown in the following code:<div class="informalexample"><pre class="programlisting">[self addChild:buttonAbort];</pre></div></li><li class="listitem">Run the example to<a id="id328" class="indexterm"/> see the result.<p>We now see the <a id="id329" class="indexterm"/>abort button as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/1509OS_07_04.jpg" alt="Time for action – conceding the game"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec88"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>In step 1, we opened the <code class="literal">Battlefield.m</code> file. For this example, we only need to take a look at the initializer method. We initialized <a id="id330" class="indexterm"/>the abort button similar to how we did for the pause and resume buttons before, the only difference is that we are using a different texture.</p><p>In the next step, we positioned the abort button at the bottom-right corner. Just like how we left a bit of space with the pause and resume buttons, we did the same here.</p><p>We then imported the <code class="literal">SceneDirector.h</code> file in the next step.</p><p>In step 5, we added an event listener to the abort button. Inside the event listener, we switched to the pirate cove scene. Although we do have a reference to the scene director using the <code class="literal">director</code> property, it is of the type <code class="literal">id</code>. So, we needed to recast it to a pointer to the <code class="literal">SceneDirector</code> class.</p><p>Then, we added the abort button to the display tree.</p><p>When we ran the example, we saw<a id="id331" class="indexterm"/> the abort button, and when we tapped it, we<a id="id332" class="indexterm"/> jumped to the pirate cove scene.</p></div></div>
<div class="section" title="Adding dialogs to the screen"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec90"/>Adding dialogs to the screen</h1></div></div></div><p>Now that we have added the abort button on the screen, we might run into a few problems, which are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We might tap on the abort button by accident</li><li class="listitem" style="list-style-type: disc">We don't have any way to get from the pirate cove scene back to the battlefield scene</li></ul></div><p>So, to counteract this, at least on the surface, let's add a dialog which should be shown when we tap the abort button.</p></div>
<div class="section" title="Time for action &#x2013; creating a dialog class"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec91"/>Time for action – creating a dialog class</h1></div></div></div><p>To add dialogs, we need to<a id="id333" class="indexterm"/> follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add a new group<a id="id334" class="indexterm"/> inside the <span class="strong"><strong>Classes</strong></span> folder called <span class="strong"><strong>UI</strong></span>.</li><li class="listitem">Inside the <span class="strong"><strong>UI</strong></span> group, add a new Objective-C class called <code class="literal">Dialog</code>, which derives from <code class="literal">SPSprite</code>.</li><li class="listitem">Implement the dialog initializer with the following lines of code:<div class="informalexample"><pre class="programlisting">-(id) init
{
    if ((self = [super init])) {
        SPImage *background = [SPImage imageWithTexture:[[Assets textureAtlas:@"ui.xml"] textureByName:@"dialog"]];
        
        SPButton *buttonYes = [SPButton buttonWithUpState:[[Assets textureAtlas:@"ui.xml"] textureByName:@"dialog_yes"] text:@"Yes"];
        
        SPButton *buttonNo = [SPButton buttonWithUpState:[[Assets textureAtlas:@"ui.xml"] textureByName:@"dialog_no"] text:@"No"];
        
        buttonYes.x = 24.0f;
        buttonYes.y = background.height - buttonYes.height -40.0f;
        
        buttonNo.x = buttonYes.x + buttonYes.width - 20.0f;
        buttonNo.y = buttonYes.y;
        
        [self addChild:background];
        [self addChild:buttonYes];
        [self addChild:buttonNo];
    }
    
    return self;
}</pre></div></li><li class="listitem">Switch to the <code class="literal">Battlefield.m</code> file.</li><li class="listitem">Import the <code class="literal">Dialog.h</code> file.</li><li class="listitem">Right before the abort button event, initialize <a id="id335" class="indexterm"/>the dialog, as shown in the following code:<div class="informalexample"><pre class="programlisting">Dialog *dialog = [[Dialog alloc] init];

dialog.x = (Sparrow.stage.width - dialog.width) / 2;
dialog.y = (Sparrow.stage.height - dialog.height) / 2;</pre></div></li><li class="listitem">The dialog should be hidden by default, as shown in the following line of code:<div class="informalexample"><pre class="programlisting">dialog.visible = NO;</pre></div></li><li class="listitem">Update the abort button event to show the dialog:<div class="informalexample"><pre class="programlisting">[buttonAbort addEventListenerForType: SP_EVENT_TYPE_TRIGGERED  block:^(SPEvent *event)
{
  dialog.visible = YES;
}];</pre></div></li><li class="listitem">Run the example to<a id="id336" class="indexterm"/> see the result.<p>When we tap the abort button, we now see a dialog popping up:</p><div class="mediaobject"><img src="graphics/1509OS_07_05.jpg" alt="Time for action – creating a dialog class"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec89"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>First, we structured the <code class="literal">Dialog</code> class. To keep it separate from the game logic code, we created it within a new group. The <code class="literal">Dialog</code> class itself <a id="id337" class="indexterm"/>should inherit from <code class="literal">SPSprite</code>.</p><p>In step 3, we defined<a id="id338" class="indexterm"/> the initializer for the <code class="literal">Dialog</code> class, where we performed the following actions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We added a background image for the dialog.</li><li class="listitem" style="list-style-type: disc">We added the <span class="strong"><strong>Yes</strong></span> and <span class="strong"><strong>No</strong></span> buttons. We called the factory methods for <code class="literal">SPButton</code>, where we put some text on the buttons, which in our case is <span class="strong"><strong>Yes</strong></span> and <span class="strong"><strong>No</strong></span>, respectively.</li><li class="listitem" style="list-style-type: disc">We positioned these elements at the bottom of the dialog.</li></ul></div><p>Inside the <code class="literal">Battlefield.m</code> file, we imported the <code class="literal">Dialog.h</code> file to be able to use the <code class="literal">Dialog</code> class.</p><p>Inside the initializer of the battlefield scene, we needed to initialize the dialog, which we did right before the abort button event.</p><p>We set the dialog to be invisible by default and updated the abort button event to show the dialog.</p><p>When we ran the example, we saw the dialog when we tapped the abort button.</p></div><div class="section" title="Have a go hero"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec90"/>Have a go hero</h2></div></div></div><p>Having the abort button on the bottom-right of the screen is not ideal from a usability point of view. If we accidently tapped the button, a dialog is now being shown instead of just aborting the current battle. Still, it doesn't seem to be ideal. The following are some suggestions on how to improve the situation:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Placing the abort button (<code class="literal">buttonAbort</code>) next to the pause button. All user interface elements would be in the same area.</li><li class="listitem" style="list-style-type: disc">Combine the pause<a id="id339" class="indexterm"/> button and the abort button into a game <a id="id340" class="indexterm"/>menu button. Clicking on the button will pause the game and will open a menu. An abort button can be found there.</li></ul></div></div></div>
<div class="section" title="Adding custom events to the dialogs"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec92"/>Adding custom events to the dialogs</h1></div></div></div><p>Now that a dialog is on the screen, we would like to attach listeners to the dialog buttons themselves. While we can go for simply attaching touch events, Sparrow provides a way to define custom events.</p></div>
<div class="section" title="Time for action &#x2013; adding our own buttons to our dialog"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec93"/>Time for action – adding our own buttons to our dialog</h1></div></div></div><p>To add custom events for our <a id="id341" class="indexterm"/>dialogs, we just need to follow<a id="id342" class="indexterm"/> these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Inside the <code class="literal">Dialog.h</code> file, we need to define the event names before the interface declaration:<div class="informalexample"><pre class="programlisting">#define EVENT_TYPE_YES_TRIGGERED @"yesTriggered"
#define EVENT_TYPE_NO_TRIGGERED  @"noTriggered"</pre></div></li><li class="listitem">Switch to <code class="literal">Dialog.m</code>.</li><li class="listitem">Register the following listeners to our buttons:<div class="informalexample"><pre class="programlisting">[buttonYes addEventListener:@selector(onButtonYes:) atObject:self forType:SP_EVENT_TYPE_TRIGGERED];

[buttonNo addEventListener:@selector(onButtonNo:) atObject:self forType:SP_EVENT_TYPE_TRIGGERED];</pre></div></li><li class="listitem">Implement the <code class="literal">onButtonYes</code> and <code class="literal">onButtonNo</code> methods, as shown in the following code:<div class="informalexample"><pre class="programlisting">- (void)onButtonYes:(SPEvent *)event
{
    SPEvent *localEvent = [SPEvent eventWithType:EVENT_TYPE_YES_TRIGGERED];
    [self dispatchEvent:localEvent];
}

- (void)onButtonNo:(SPEvent *)event
{
    SPEvent *localEvent = [SPEvent eventWithType:EVENT_TYPE_NO_TRIGGERED];
    [self dispatchEvent:localEvent];
}</pre></div></li><li class="listitem">Switch to <code class="literal">Battlefield.m</code>.</li><li class="listitem">The local dialog <a id="id343" class="indexterm"/>variable inside the initializer needs to be refactored into an instance variable called <code class="literal">_dialogAbort</code>.</li><li class="listitem">Move the <code class="literal">#import "Dialog.h"</code> statement from <code class="literal">Battlefield.m</code> to <code class="literal">Battlefield.h</code>.</li><li class="listitem">Add event listeners for both dialog buttons in <code class="literal">Battlefield.m</code>, as shown in the following code:<div class="informalexample"><pre class="programlisting">[_dialogAbort addEventListener:@selector(onDialogAbortYes:) atObject:self forType:EVENT_TYPE_YES_TRIGGERED];
[_dialogAbort addEventListener:@selector(onDialogAbortNo:) atObject:self forType:EVENT_TYPE_NO_TRIGGERED];</pre></div></li><li class="listitem">Implement the<a id="id344" class="indexterm"/> corresponding methods, as shown in the following code:<div class="informalexample"><pre class="programlisting">-(void) onDialogAbortYes:(SPEvent *)event
{
    [((SceneDirector *) self.director) showScene:@"piratecove"];
}

-(void) onDialogAbortNo:(SPEvent *)event
{
    self.paused = NO;
    _dialogAbort.visible = NO;
}</pre></div></li><li class="listitem">Update the abort button event to also pause the game when the dialog is being shown:<div class="informalexample"><pre class="programlisting">[buttonAbort addEventListenerForType:SP_EVENT_TYPE_TOUCH block:^(SPEvent *event)
{
  self.paused = YES;
  _dialogAbort.visible = YES;
}];</pre></div></li><li class="listitem">Run the example to see the result. When we tap the abort button, we can now tap the buttons of the dialog:<div class="mediaobject"><img src="graphics/1509OS_07_06.jpg" alt="Time for action – adding our own buttons to our dialog"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec91"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>In the first step, we defined the event names for our buttons. In the <code class="literal">Dialog.m</code> file, we needed to add listeners for <a id="id345" class="indexterm"/>our dialog. We used <code class="literal">SP_EVENT_TYPE_TRIGGERED</code>, so if any kind of event is triggered on either of the buttons, the selector will be called.</p><p>In step 4, we implemented <a id="id346" class="indexterm"/>the necessary methods. We created an event with our custom event type and dispatched this event afterwards.</p><p>In the next step, we refactored the local dialog variable in the battlefield initializer. It now needs to be an instance variable called <code class="literal">_dialogAbort</code> and it is still a pointer to <code class="literal">Dialog</code>. We updated all references and the initialization part of the instance variable. Consequently, we imported a statement to the header file.</p><p>We then called the <code class="literal">addEventListener</code> method on our dialog using our custom events.</p><p>In step 9, we implemented the methods that should be fired when the button is tapped. If we select <span class="strong"><strong>Yes</strong></span>, we need to show the pirate cove scene, and if we select <span class="strong"><strong>No</strong></span>, we need the dialog to disappear. We also resume the game in this case.</p><p>As we resume the game if we tap <span class="strong"><strong>Yes</strong></span>, we also need to update the abort button event to actually pause the game once the dialog is being shown.</p><p>When we ran the example and tapped the abort button, our dialog pops up and the game pauses. If we tap <span class="strong"><strong>No</strong></span>, the dialog closes and the game resumes. If we tap <span class="strong"><strong>Yes</strong></span>, we shift to the pirate cove scene.</p></div></div>
<div class="section" title="Drawing text on the screen"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec94"/>Drawing text on the screen</h1></div></div></div><p>There are two ways to display text<a id="id347" class="indexterm"/> on the screen. We can either use one of the iOS fonts (so-called system fonts) or we could try to create a more customized font that fits our needs better.</p><div class="section" title="Displaying our first text field"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec92"/>Displaying our first text field</h2></div></div></div><p>We already drew some text on the screen utilizing the capabilities of <code class="literal">SPButton</code> when we added the dialog buttons. However, we are now going to draw some text on the screen for the dialog message.</p></div></div>
<div class="section" title="Time for action &#x2013; adding a text field to the dialog"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec95"/>Time for action – adding a text field to the dialog</h1></div></div></div><p>To draw text on the screen, we <a id="id348" class="indexterm"/>need to follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">As shown in the following line of code, add a property called <code class="literal">content</code>, which is a pointer to <code class="literal">SPTextField</code>, inside the <code class="literal">Dialog.h</code> file:<div class="informalexample"><pre class="programlisting">@property SPTextField *content;</pre></div></li><li class="listitem">In the <code class="literal">Dialog</code> initializer, create the following content instance and position it between the title box and the buttons:<div class="informalexample"><pre class="programlisting">_content = [SPTextField textFieldWithWidth:background.width - 48.0f height:background.height - 150.0f text:@"Dialog default text"];
_content.x = 24.0f;
_content.y = 50.0f;</pre></div></li><li class="listitem">Add the <code class="literal">content</code> property to the display tree, as shown in the following code:<div class="informalexample"><pre class="programlisting">[self addChild:background];
[self addChild:buttonYes];
[self addChild:buttonNo];
<span class="strong"><strong>[self addChild:_content];</strong></span>
</pre></div></li><li class="listitem">Switch to the <code class="literal">Battlefield.m</code> file.</li><li class="listitem">Add a custom message for the abort dialog, as shown in the following code:<div class="informalexample"><pre class="programlisting">_dialogAbort = [[Dialog alloc] init];

<span class="strong"><strong>_dialogAbort.content.text = @"Would you like to abort the current fight?";</strong></span>

_dialogAbort.x = (Sparrow.stage.width - _dialogAbort.width) / 2;
_dialogAbort.y = (Sparrow.stage.height - _dialogAbort.height) / 2;</pre></div></li><li class="listitem">Run the example.<p>Now, we see the text message inside the dialog.</p><div class="mediaobject"><img src="graphics/1509OS_07_07.jpg" alt="Time for action – adding a text field to the dialog"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec93"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>First of all, we needed a property for the message we are going to display. A <code class="literal">SPTextField</code> class works like this: we define a rectangle and some text, and the text will automatically be aligned inside<a id="id349" class="indexterm"/> the bounds of the rectangle. By default, the text is centered horizontally and vertically. If we want to change this, we need to change the <code class="literal">hAlign</code> and <code class="literal">vAlign</code> properties to our desired values. In addition to all of the properties it inherits from being a display object (such as color or scale), a text field also has the <code class="literal">fontName</code> property to use different fonts and the <code class="literal">fontSize</code> property for the size of the text.</p><p>In step 2, we created the <code class="literal">_content</code> instance, where<a id="id350" class="indexterm"/> the text field should be a bit smaller than the dialog itself. We gave the text field a default text and then updated its position to be more or less in the center of the dialog.</p><p>After we added the text field to the display tree in step 3, we updated the default message, a custom one, inside the <code class="literal">Battlefield</code> initializer.</p><p>When we ran the example, we saw our custom message in the dialog.</p></div><div class="section" title="Explaining system fonts"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec94"/>Explaining system fonts</h2></div></div></div><p>System fonts are <a id="id351" class="indexterm"/>the fonts iOS has <a id="id352" class="indexterm"/>built-in, out of the box. The selection ranges from Arial and Helvetica to Verdana, including the light, bold, and italic variants. For a complete list of all available system fonts, visit <a class="ulink" href="http://iosfonts.com/">http://iosfonts.com/</a>.</p></div><div class="section" title="Explaining bitmap fonts"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec95"/>Explaining bitmap fonts</h2></div></div></div><p>A bitmap font is very similar to a texture atlas; every character is an image. All of these smaller images are put<a id="id353" class="indexterm"/> into a big one. Although system fonts can display Unicode characters with ease, if we need umlauts or similar characters, we would need to add them ourselves. As a result, this would <a id="id354" class="indexterm"/>directly increase the size of the image.</p><p>A sample bitmap font would look like the following screenshot:</p><div class="mediaobject"><img src="graphics/1509OS_07_08.jpg" alt="Explaining bitmap fonts"/></div><p>A portion of the data might look something like the following portion of code:</p><div class="informalexample"><pre class="programlisting">&lt;font&gt;
  &lt;info face="Arial" size="72" bold="0" italic="0" charset="" unicode="" stretchH="100" smooth="1" aa="1" padding="2,2,2,2" spacing="0,0" outline="0"/&gt;
  &lt;common lineHeight="83" base="65" scaleW="1024" scaleH="512" pages="1" packed="0"/&gt;
  &lt;pages&gt;
    &lt;page id="0" file="font.png"/&gt;
  &lt;/pages&gt;
  &lt;chars count="80"&gt;
    &lt;char id="97" x="2" y="2" width="45" height="50" xoffset="-1" yoffset="18" xadvance="40" page="0" chnl="15"/&gt;
    &lt;char id="98" x="2" y="54" width="44" height="64" xoffset="1" yoffset="5" xadvance="40" page="0" chnl="15"/&gt;
    &lt;char id="99" x="2" y="120" width="43" height="50" xoffset="-1" yoffset="18" xadvance="36" page="0" chnl="15"/&gt;
    &lt;char id="100" x="2" y="172" width="44" height="64" xoffset="-2" yoffset="5" xadvance="40" page="0" chnl="15"/&gt;
    &lt;char id="101" x="47" y="120" width="46" height="50" xoffset="-1" yoffset="18" xadvance="40" page="0" chnl="15"/&gt;
    &lt;char id="102" x="48" y="54" width="33" height="64" xoffset="-3" yoffset="4" xadvance="20" page="0" chnl="15"/&gt;
    &lt;char id="103" x="83" y="2" width="44" height="65" xoffset="-2" yoffset="18" xadvance="40" page="0" chnl="15"/&gt;
    &lt;char id="104" x="2" y="238" width="42" height="63" xoffset="1" yoffset="5" xadvance="40" page="0" chnl="15"/&gt;</pre></div><p>Similar to a texture atlas, the actual data is represented in XML.</p><p>There are multiple<a id="id355" class="indexterm"/> tools to create bitmap fonts, with each of them having their own advantages and disadvantages. Littera is a free online tool <a id="id356" class="indexterm"/>available at <a class="ulink" href="http://kvazars.com/littera/">http://kvazars.com/littera/</a> (requires Adobe Flash Player); other popular commercial solutions are <a id="id357" class="indexterm"/>
<span class="strong"><strong>Glyph Designer</strong></span> by 71squared and <a id="id358" class="indexterm"/>
<span class="strong"><strong>bmGlyph</strong></span> by Stéphane Queraud.</p></div><div class="section" title="Creating our very own bitmap font"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec96"/>Creating our very own bitmap font</h2></div></div></div><p>For this example, we will use bmGlyph, as it allows us to create multiple scaled bitmap fonts similar to the mechanic <code class="literal">TexturePacker</code> provides. The bmGlyph solution is available on the Mac<a id="id359" class="indexterm"/> App Store at <a class="ulink" href="https://itunes.apple.com/us/app/bmglyph/id490499048?mt=12">https://itunes.apple.com/us/app/bmglyph/id490499048?mt=12</a> for $9.99 or your regional equivalent.</p><p>If you don't want to use bmGlyph, the complete bitmap font is also included in the graphics package.</p></div></div>
<div class="section" title="Time for action &#x2013; using bmGlyph to create a bitmap font"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec96"/>Time for action – using bmGlyph to create a bitmap font</h1></div></div></div><p>To create our first bitmap font, we just need to follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <span class="strong"><strong>bmGlyph</strong></span>.</li><li class="listitem">Select<a id="id360" class="indexterm"/> <span class="strong"><strong>Arial Rounded MT Bold</strong></span> as the font.</li><li class="listitem">Set <span class="strong"><strong>Font size</strong></span> to <span class="strong"><strong>72</strong></span> points.</li><li class="listitem">Scroll down to the <span class="strong"><strong>Color Tools</strong></span> section and check <span class="strong"><strong>Shadow</strong></span>.</li><li class="listitem">In the <span class="strong"><strong>Shadow</strong></span> pane, set<a id="id361" class="indexterm"/> the <span class="strong"><strong>x</strong></span> property to <span class="strong"><strong>2</strong></span>, the <span class="strong"><strong>y</strong></span> property to <span class="strong"><strong>-2</strong></span>, and the <span class="strong"><strong>radius</strong></span> to <span class="strong"><strong>8</strong></span>.</li><li class="listitem">In the <span class="strong"><strong>Fill Mode</strong></span> section, select a brown-yellowish color and select the <span class="strong"><strong>Glossy</strong></span> checkbox.</li><li class="listitem">Hit the <span class="strong"><strong>Publish</strong></span> button.</li><li class="listitem">In the <span class="strong"><strong>Default</strong></span> target, enter <code class="literal">PirateFont</code> as the <span class="strong"><strong>File Name</strong></span> and font name (<span class="strong"><strong>Force Font Name</strong></span>). In the <span class="strong"><strong>Suffix</strong></span> input box, add <code class="literal">@4x</code>.</li><li class="listitem">Click on the <span class="strong"><strong>50</strong></span> button inside the <span class="strong"><strong>Duplicate with scale</strong></span> box and add the suffix <code class="literal">@2x</code>.</li><li class="listitem">Click on the <span class="strong"><strong>25</strong></span> button.</li><li class="listitem">Select <span class="strong"><strong>Sparrow</strong></span> in the <span class="strong"><strong>Format</strong></span> drop-down list.</li><li class="listitem">Make sure that <span class="strong"><strong>PirateFont</strong></span> is displayed in all of the targets as the <span class="strong"><strong>File Name</strong></span> and in <span class="strong"><strong>Force Font Name</strong></span>.</li><li class="listitem">Hit <span class="strong"><strong>Publish</strong></span> and<a id="id362" class="indexterm"/> then the <span class="strong"><strong>Close</strong></span> button.<p>After these steps, we<a id="id363" class="indexterm"/> should see the following screen:</p><div class="mediaobject"><img src="graphics/1509OS_07_09.jpg" alt="Time for action – using bmGlyph to create a bitmap font"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec97"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>After we opened <span class="strong"><strong>bmGlyph</strong></span>, we set the base font, size, color, and the shadow of the bitmap font. To export the bitmap font, we clicked on the <span class="strong"><strong>Publish</strong></span> button, which we did in step 7. For each separate image, we need to define a new target with a scale. In our case, this is <code class="literal">100%</code>, <code class="literal">50%</code>, and <code class="literal">25%</code> with the suffixes <code class="literal">@4x</code> and <code class="literal">@2x</code>, respectively. For the <code class="literal">25%</code> target, we don't need a suffix.</p><p>To export a Sparrow-compatible bitmap<a id="id364" class="indexterm"/> font, we needed to select the <span class="strong"><strong>Sparrow</strong></span> format. We needed to make sure that <code class="literal">PirateFont</code> is written in both <span class="strong"><strong>File Name</strong></span> and <span class="strong"><strong>Force Font Name</strong></span>. If we don't do the latter, the font won't become available as <code class="literal">PirateFont</code>, but will replace <span class="strong"><strong>Arial Rounded MT Bold</strong></span>.</p><p>When we<a id="id365" class="indexterm"/> hit the <span class="strong"><strong>Publish</strong></span> button, our font files became available in the location where we wanted to<a id="id366" class="indexterm"/> save them.</p></div><div class="section" title="Displaying a text field with bitmap fonts"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec98"/>Displaying a text field with bitmap fonts</h2></div></div></div><p>Now that we have<a id="id367" class="indexterm"/> displayed a system in our dialog, let's display text using our <a id="id368" class="indexterm"/>fresh bitmap font as the dialog's title.</p></div></div>
<div class="section" title="Time for action &#x2013; using our bitmap font for a text field"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec97"/>Time for action – using our bitmap font for a text field</h1></div></div></div><p>Follow these steps to display bitmap fonts in <code class="literal">SPTextField</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We need to add another property called <code class="literal">title</code> inside the <code class="literal">Dialog.h</code> file, which is also a pointer to <code class="literal">SPTextField</code>:<div class="informalexample"><pre class="programlisting">@property SPTextField *title;</pre></div></li><li class="listitem">We register our bitmap font, as shown in the following code:<div class="informalexample"><pre class="programlisting">[SPTextField registerBitmapFontFromFile:@"PirateFont.fnt"];</pre></div></li><li class="listitem">We create and position the <code class="literal">_title</code> instance with the following lines of code:<div class="informalexample"><pre class="programlisting">_title = [SPTextField textFieldWithWidth:background.width * 0.6 height:30.0f text:@"Dialog"];
_title.fontName = @"PirateFont";
_title.color = SP_WHITE;

_title.x = 24.0f;
_title.y = 26.0f;</pre></div></li><li class="listitem">We need to add the <code class="literal">_title</code> instance to the display tree, as shown in the following code:<div class="informalexample"><pre class="programlisting">[self addChild:background];
[self addChild:buttonYes];
[self addChild:buttonNo];
[self addChild:_content];
<span class="strong"><strong>[self addChild:_title];</strong></span>
</pre></div></li><li class="listitem">Inside the <code class="literal">Battlefield.m</code> file, we replace the default title with a custom one:<div class="informalexample"><pre class="programlisting">_dialogAbort = [[Dialog alloc] init];
        
<span class="strong"><strong>_dialogAbort.title.text = @"Abort this fight?";</strong></span>
_dialogAbort.content.text = @"Would you like to abort the current fight?";

_dialogAbort.x = (Sparrow.stage.width - _dialogAbort.width) / 2;
_dialogAbort.y = (Sparrow.stage.height - _dialogAbort.height) / 2;</pre></div></li><li class="listitem">Run the example to see <a id="id369" class="indexterm"/>the result.<p>Our dialog now has a message and a title:</p><div class="mediaobject"><img src="graphics/1509OS_07_10.jpg" alt="Time for action – using our bitmap font for a text field"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec99"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>Displaying bitmap fonts is very similar to displaying system fonts on the screen. Before we can use any bitmap font, we<a id="id370" class="indexterm"/> need to register it first. When we want to display a text field with this font, we need to update the <code class="literal">fontName</code> property to reflect the name of the bitmap font.</p><p>Another thing to consider is that Sparrow displays all text in black by default. We need to change this in order to see the color effect of our bitmap font.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>Remember that the complete source code for this chapter can also be found on GitHub: <a class="ulink" href="https://github.com/freezedev/pirategame/tree/f742f6026e9ad129546d17e5d9e9728c27ff0733">https://github.com/freezedev/pirategame/tree/f742f6026e9ad129546d17e5d9e9728c27ff0733</a>.</p></div></div></div><div class="section" title="Pop quiz"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec100"/>Pop quiz</h2></div></div></div><p>Q1. In order for custom jugglers to show their tweens, which method needs to be called?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><code class="literal">advanceTime</code></li><li class="listitem"><code class="literal">update</code></li><li class="listitem"><code class="literal">addJuggler</code></li></ol></div><p>Q2. Are bitmap fonts similar to texture atlases?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Yes</li><li class="listitem">No</li></ol></div><p>Q3. What kind of fonts can be used with <code class="literal">SPTextField</code>?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">System fonts</li><li class="listitem">Bitmap fonts</li><li class="listitem">Both</li></ol></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec98"/>Summary</h1></div></div></div><p>In this chapter, we learned about adding user interface elements to the screen.</p><p>Specifically, we covered health bars, buttons, and drawing text on the screen, and we got a deeper knowledge of jugglers and how to update elements through custom getters and setters.</p><p>Now that we have a basic user interface, let's add some artificial intelligence—which is the topic of the next chapter.</p></div></body></html>