<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Working with Different Multimedia Resources"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Working with Different Multimedia Resources</h1></div></div></div><p>In this chapter, we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Selecting images and video from the camera roll</li><li class="listitem" style="list-style-type: disc">Capturing media with the camera</li><li class="listitem" style="list-style-type: disc">Playing video with AppleTV integration</li><li class="listitem" style="list-style-type: disc">Playing music using the MediaPlayer framework</li><li class="listitem" style="list-style-type: disc">Using the iOS device microphone to record</li><li class="listitem" style="list-style-type: disc">Animating views</li><li class="listitem" style="list-style-type: disc">Drawing customized text</li><li class="listitem" style="list-style-type: disc">Drawing lines and curves</li><li class="listitem" style="list-style-type: disc">Drawing and filling shapes</li><li class="listitem" style="list-style-type: disc">Applying color effects using Core Image</li><li class="listitem" style="list-style-type: disc">Applying transition effects</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec68"/>Introduction</h1></div></div></div><p>The <span class="strong"><strong>Core Image</strong></span> framework <a id="id653" class="indexterm"/>is a hardware-accelerated framework that provides an easier way for you to enhance your photos and videos using the several built-in filters: color effects, distortions, and transitions, as well as several advanced features: auto-enhance, red-eye reduction, and facial recognition. </p><p>In this chapter, we will take a closer look into these frameworks and how these can be used to apply image filter effects using the <code class="literal">CIFilter</code> <a id="id654" class="indexterm"/>class, as well as implementing Airplay to allow us to output content to another device using Apple TV. We will learn how to use the <span class="strong"><strong>AVFoundation</strong></span> <a id="id655" class="indexterm"/>framework to record and play back audio content using the iOS device's built-in microphone. Finally, we will learn how we can use the <a id="id656" class="indexterm"/>
<span class="strong"><strong>CoreGraphics</strong></span> framework to enable us to draw shapes, and textual information to our view. </p></div></div>
<div class="section" title="Selecting images and video from the camera roll"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec69"/>Selecting images and video from the camera roll</h1></div></div></div><p>In this recipe, we will learn how to <a id="id657" class="indexterm"/>
<a id="id658" class="indexterm"/>give the user the ability to select images <a id="id659" class="indexterm"/>and videos from the iOS device's photo album.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec241"/>Getting ready</h2></div></div></div><p>Create a new <span class="strong"><strong>Single View Application</strong></span>, and name it <span class="strong"><strong>MediaPickerExample</strong></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec242"/>How to do it...</h2></div></div></div><p>To begin, follow these simple steps as outlined in the following order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select the <code class="literal">ViewController.xib</code> files from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">From the <span class="strong"><strong>Object Library</strong></span>, select and drag a <code class="literal">UIToolbar</code> object, and add this to our view and select the <span class="strong"><strong>Item</strong></span> button located within our toolbar. </li><li class="listitem">From the <span class="strong"><strong>Attributes Inspector</strong></span> section, change the <span class="strong"><strong>Identifier</strong></span> property to <span class="strong"><strong>Organize</strong></span>.</li><li class="listitem">Create an outlet for this <code class="literal">UIBarButtonItem</code>, and name it <code class="literal">btnBrowse</code>.</li><li class="listitem">Create the action method for the <span class="strong"><strong>Organize </strong></span>button and name it <code class="literal">btnBrowse</code>.</li><li class="listitem">From the <span class="strong"><strong>Object Library</strong></span>, select and drag a <code class="literal">UIImageView</code> object, and add this to our view and resize it so that it fills the area of the screen.</li><li class="listitem">Create an outlet for this <code class="literal">UIImageView</code>, and name it <code class="literal">imageView.</code></li><li class="listitem">Our next step is to create the code functionality that will be responsible for allowing images and videos to be selected when the <span class="strong"><strong>Organize</strong></span> button is clicked.<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">ViewController.h</code> interface file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span>.</li><li class="listitem">Next, modify the interface file as shown by the highlighted code sections in the following code snippet: <div class="informalexample"><pre class="programlisting">//  ViewController.h
//  MediaPickerExample
//  Created by Steven F Daniel on 20/11/12.
//  Copyright (c) 2012 GenieSoft Studios. All rights reserved.

#import&lt;UIKit/UIKit.h&gt;

<span class="strong"><strong>@interface ViewController : UIViewController&lt;UIImagePickerControllerDelegate, UINavigationControllerDelegate&gt; </strong></span>
<span class="strong"><strong>{</strong></span>

}

// Declare the Getters and Setters for each of our objects.
@property (strong, nonatomic) IBOutlet UIBarButtonItem         *btnBrowse;
@property (strong, nonatomic) IBOutlet UIImageView             *imageView;
<span class="strong"><strong>@property (nonatomic, retain) UIImagePickerController *imagePicker;</strong></span>

// Declare our class Instance methods
- (IBAction)btnBrowse:(id)sender;</pre></div></li><li class="listitem">Open the <code class="literal">ViewController.m</code> <a id="id660" class="indexterm"/>implementation file from the <code class="literal">Project</code> <code class="literal">Navigator</code>, and enter in the following highlighted code sections.<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>@synthesize btnBrowse;</strong></span>
<span class="strong"><strong>@synthesize imagePicker;</strong></span>
<span class="strong"><strong>@synthesize imageView;</strong></span>
</pre></div></li><li class="listitem">Next, modify the <code class="literal">btnBrowse:</code> method as shown in the code snippet: <div class="informalexample"><pre class="programlisting">#pragma mark called when the user presses the Organize button
- (IBAction)btnBrowse:(id)sender {

   // Create image picker controller
   imagePicker = [[UIImagePickerController alloc] init];

   // Checks to make sure that the Photo Library is available.
  if ([UIImagePickerController isSourceTypeAvailable:
       UIImagePickerControllerSourceTypePhotoLibrary]) {
       // Set source to the Photo Library
       self.imagePicker.delegate = self;
       self.imagePicker.sourceType =  
       UIImagePickerControllerSourceTypePhotoLibrary;
       self.imagePicker.mediaTypes =[UIImagePickerController
       availableMediaTypesForSourceType:
       self.imagePicker.sourceType];
       self.imagePicker.allowsEditing = NO;
       [self presentViewController:imagePickeranimated:YES
       completion:nil];
    }
    else {
        NSLog(@"Unable to access the Photo Library.");
    }
}</pre></div></li><li class="listitem">Then, create the following code sections, as specified in the code snippet: <div class="informalexample"><pre class="programlisting">#pragma mark - Image Picker Delegate Methods
- (void)imagePickerControllerDidCancel:(UIImagePickerController *)picker {
   [picker dismissViewControllerAnimated:YES completion:nil];
}

#pragma mark Method is called when the user has chosen an item from the image picker.
- (void)imagePickerController:(UIImagePickerController *)picker   didFinishPickingMediaWithInfo:(NSDictionary *)info {
   // Determine the media type of the chosen item 
   NSString *mediaType = [info 
   objectForKey:UIImagePickerControllerMediaType];

   // Determine if we have chosen a image file from library.
   if ([mediaType isEqualToString:@"public.image"]) {
        UIImage *photoImage = [info 
        objectForKey:UIImagePickerControllerOriginalImage];
        self.imageView.image = photoImage;
        self.imageView.contentMode = 
        UIViewContentModeScaleAspectFit;
    }
   else if ([mediaType isEqualToString:@"public.movie"]) {
            NSURL *movieURL = [info 
            valueForKey:UIImagePickerControllerMediaURL];
            NSLog(@"Movie URL: %@", movieURL);
   }
// Dismiss the imagePicker Dialog
   [picker dismissViewControllerAnimated:NO completion:nil];
}</pre></div></li><li class="listitem">Then, <span class="strong"><strong>Build</strong></span> and <span class="strong"><strong>Run</strong></span> the application by choosing <span class="strong"><strong>Product | Run</strong></span> from the <span class="strong"><strong>Product</strong></span> menu, or alternatively pressing <span class="emphasis"><em>Command + R</em></span>.</li></ol></div></li></ol></div><p>When the compilation completes, click on the <span class="strong"><strong>Organize</strong></span> button to present the image picker, and select an image by clicking on its thumbnail. The image will be displayed in the image view. Alternatively, if you choose a video, the full path will be displayed within the console window.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec243"/>How it works...</h2></div></div></div><p>In this recipe, we start by extending our class, to include each of the following class protocols: <code class="literal">UIImagePickerControllerDelegate</code>, <code class="literal">UINavigationControllerDelegate</code> so that we can access each of their respective properties and methods. We can check to see if we are able to access the iOS device's photo library using the <a id="id661" class="indexterm"/>
<code class="literal">isSourceTypeAvailable</code> property of the <code class="literal">UIImagePickerController</code> class, and initialize the properties of the <code class="literal">ImagePicker</code> class to only display images from our photo library. Next, we make the delegate point to itself and then set the <a id="id662" class="indexterm"/>
<code class="literal">sourceType</code> property to use the camera, and then set the value of the <code class="literal">cameraDevice</code> property to use the rear camera and display the camera interface, and the <code class="literal">UIImagePickerController</code> object is dismissed.</p><p>In our next section, we <a id="id663" class="indexterm"/>
<a id="id664" class="indexterm"/>
<a id="id665" class="indexterm"/>
<a id="id666" class="indexterm"/>
<a id="id667" class="indexterm"/>
<a id="id668" class="indexterm"/>declare a delegate method for our image picker controller <code class="literal">imagePickerControllerDidCancel</code> that will be responsible for handling and taking care of closing the camera session without making an image selection, or taking a picture whenever the <span class="strong"><strong>Cancel </strong></span>button has been clicked. Finally, we perform a check to determine the type of media that has been chosen from the photo library using the <code class="literal">UIImagePickerControllerMediaType</code> <a id="id669" class="indexterm"/>property of <code class="literal">UIImagePickerController</code>, and determine if we have selected either an image or a movie. </p><p>If we selected an image, we create a thumbnail image representation of the video, and set the <code class="literal">image</code> property of the <code class="literal">imageView</code> control. If a video has been chosen, we obtain the file location of the chosen file, using <a id="id670" class="indexterm"/>
<a id="id671" class="indexterm"/>
<a id="id672" class="indexterm"/>
<a id="id673" class="indexterm"/>
<a id="id674" class="indexterm"/>
<a id="id675" class="indexterm"/>the <a id="id676" class="indexterm"/>
<code class="literal">UIImagePickerControllerMediaURL</code> method, and display this within our console window.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec244"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Capturing media with the camera</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Capturing media with the camera"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec70"/>Capturing media with the camera</h1></div></div></div><p>In this recipe, we <a id="id677" class="indexterm"/>
<a id="id678" class="indexterm"/>will learn how to use the iOS device camera for capturing media.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec245"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe, create a new <span class="strong"><strong>Single View Application,</strong></span> and name it <span class="strong"><strong>CameraPickerExample</strong></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec246"/>How to do it...</h2></div></div></div><p>To begin, follow these simple steps as outlined in the following order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select the <code class="literal">ViewController.xib</code> files from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">From the <span class="strong"><strong>Object Library</strong></span>, select and drag a <code class="literal">UIToolbar</code> object, and add this to our view and click on the <span class="strong"><strong>Item</strong></span> button located within our toolbar. </li><li class="listitem">From the <span class="strong"><strong>Attributes Inspector</strong></span> section, change the <span class="strong"><strong>Identifier</strong></span> property to <span class="strong"><strong>Camera</strong></span>.</li><li class="listitem">Create an outlet for this <code class="literal">UIBarButtonItem</code>, and name it <code class="literal">btnCamera</code>.</li><li class="listitem">Create the action method for the <span class="strong"><strong>Camera</strong></span> button and name it <code class="literal">btnCamera</code>.</li><li class="listitem">Our next step is to create the code functionality that will be responsible for displaying the camera view when the <span class="strong"><strong>Camera</strong></span> button is clicked.</li><li class="listitem">Open the <code class="literal">ViewController.h</code> interface file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span>.</li><li class="listitem">Next, modify the interface file as shown by the highlighted code sections in the following code snippet: <div class="informalexample"><pre class="programlisting">//  ViewController.h
//  CameraPickerExample
//  Created by Steven F Daniel on 20/11/12.
//  Copyright (c) 2012 GenieSoft Studios. All rights reserved.

#import&lt;UIKit/UIKit.h&gt;

<span class="strong"><strong>@interface ViewController : UIViewController&lt;UIImagePickerControllerDelegate, UINavigationControllerDelegate&gt;</strong></span>
<span class="strong"><strong>{</strong></span>
<span class="strong"><strong>}</strong></span>

  // Declare the Getters and Setters for each of our objects.
  @property (strong, nonatomic) IBOutlet UIBarButtonItem           
  *btnCamera;
<span class="strong"><strong>  @property (nonatomic, retain)          </strong></span>
<span class="strong"><strong>  UIImagePickerController *imagePicker;</strong></span>

  // Declare each of our Class methods
  - (IBAction)btnCamera:(id)sender;</pre></div></li><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window, and enter in the following highlighted code sections:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>@synthesize btnCamera;</strong></span>
<span class="strong"><strong>@synthesize imagePicker;</strong></span>
</pre></div></li><li class="listitem">Next, modify the <code class="literal">btnCamera:</code> method as shown in the code snippet: <div class="informalexample"><pre class="programlisting">#pragma mark called when the user presses the camera button
- (IBAction)btnCamera:(id)sender {

   // Checks device to make sure that the Camera is available.
   if ([UIImagePickerController isSourceTypeAvailable:
   UIImagePickerControllerSourceTypeCamera]) {
      
      // Create image picker controller
      imagePicker = [[UIImagePickerController alloc] init];

      // Set our source to the Camera
      self.imagePicker.sourceType =  
      UIImagePickerControllerSourceTypeCamera;
      self.imagePicker.delegate = self;
      self.imagePicker.cameraDevice = 
      UIImagePickerControllerCameraDeviceRear;
      self.imagePicker.allowsEditing = NO;
      [self presentViewController:imagePicker animated:YES
                                 completion:nil];
   }
   else{
      NSLog(@"Use of the Camera is not available.");
   }
}</pre></div></li><li class="listitem">Then, create the following code sections, as specified in the code snippet: <div class="informalexample"><pre class="programlisting">#pragma mark - Image Picker Delegate Methods
- (void)imagePickerControllerDidCancel:(UIImagePickerController *)picker {
   [picker dismissViewControllerAnimated:YES completion:nil];
}

#pragma mark method is called when the user has finished taking a photo with the camera.
- (void)imagePickerController:(UIImagePickerController *)picker 
didFinishPickingMediaWithInfo:(NSDictionary *)info {

   // Access the uncropped image and Save the image
   UIImage *image = [info 
   objectForKey:@"UIImagePickerControllerOriginalImage"];
   UIImageWriteToSavedPhotosAlbum(image, self, 
   @selector(image:didFinishSavingWithError:contextInfo:), nil);
   // Then dismiss the imagePicker Dialog
   [picker dismissViewControllerAnimated:NO completion:nil];
}

- (void)image:(UIImage *)image didFinishSavingWithError:(NSError *)error contextInfo:(void *)contextInfo {
   // Handle any errors detected during the save
   if (error) {
      NSLog(@"Unable to save the image to the Photo Album");
   }
   else {
      NSLog(@"Image successfully saved to the Photo Album");
   }
}</pre></div></li><li class="listitem">Then, <span class="strong"><strong>Build</strong></span> and <span class="strong"><strong>Run</strong></span> the application by choosing <span class="strong"><strong>Product | Run</strong></span> from the <span class="strong"><strong>Product</strong></span> menu, or alternatively pressing <span class="emphasis"><em>Command + R</em></span>.</li></ol></div><p>When the compilation completes, click on the <span class="strong"><strong>Camera</strong></span> button to open the camera and take a picture. The picture will be saved to the iOS device's photo album.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec247"/>How it works...</h2></div></div></div><p>In this recipe, we start by extending our class, to include each of the following class protocols: <code class="literal">UIImagePickerControllerDelegate</code>, <code class="literal">UINavigationControllerDelegate</code> so that we can access each of their respective properties and methods. We then check to see if we are able to access the iOS device's camera using the <code class="literal">isSourceTypeAvailable</code> <a id="id679" class="indexterm"/>property of the <code class="literal">UIImagePickerController</code> <a id="id680" class="indexterm"/>class and then create a new instance of our <code class="literal">UIImagePickerController</code> <a id="id681" class="indexterm"/>class. Next, we make the delegate point to itself and then set the <code class="literal">sourceType</code> property to use the camera, and then set the value of the <code class="literal">cameraDevice</code> property to use the rear camera. Finally, we display the camera interface, and the <code class="literal">UIImagePickerController</code> <a id="id682" class="indexterm"/>object is dismissed. Next, we declare a delegate method for our image picker controller <code class="literal">imagePickerControllerDidCancel</code> that will be responsible for handling and <a id="id683" class="indexterm"/>
<a id="id684" class="indexterm"/>taking care of closing the camera session without making an image selection, or taking a picture whenever the <span class="strong"><strong>Cancel</strong></span> button has been clicked on.</p><p>Next, when the user takes a photo using the camera, it is not automatically saved on the device. To save it, we call the <code class="literal">UIImageWriteToSavedPhotosAlbum</code> <a id="id685" class="indexterm"/>method of the <code class="literal">UIImage</code> class. This method accepts a delegate of type <code class="literal">UIImageconextInfo</code>, which will report an error and immediately call the <a id="id686" class="indexterm"/>
<code class="literal">didFinishSavingWithError:</code> method if something goes wrong to handle the type of error.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec248"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Selecting images and video from the camera roll</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Playing video with Apple TV integration"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec71"/>Playing video with Apple TV integration</h1></div></div></div><p>The <span class="strong"><strong>AirPlay</strong></span> framework <a id="id687" class="indexterm"/>is <a id="id688" class="indexterm"/>
<a id="id689" class="indexterm"/>an updated framework that lets you stream audio and video content from any iOS device out to any Airplay-enabled device that is capable of playing audio and video such as television sets and audio systems. </p><p>Starting with iOS 5, developers now have the flexibility to incorporate Airplay content into their applications, and have this information presented out to a nearby Apple TV receiver. In this section, we will take a look at how to create a simple application to playback video content on an iOS device, and then take a look at the steps involved to output this to an Apple TV device.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec249"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe, create a new <span class="strong"><strong>Single View Application</strong></span>, and name it <span class="strong"><strong>PlayVideoExample</strong></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec250"/>How to do it...</h2></div></div></div><p>To begin, follow these simple <a id="id690" class="indexterm"/>
<a id="id691" class="indexterm"/>steps as outlined in the following order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add a reference to the <code class="literal">MediaPlayer.framework</code> to your project.</li><li class="listitem">Select the <code class="literal">ViewController.xib</code> files from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">From the <span class="strong"><strong>Object Library</strong></span>, drag a <code class="literal">UIButton</code> object, and add this to our view.</li><li class="listitem">From the <span class="strong"><strong>Attributes Inspector</strong></span> section, change the <span class="strong"><strong>Title</strong></span> property to <span class="strong"><strong>Play Video</strong></span>.</li><li class="listitem">Create an outlet for this <code class="literal">UIButton</code>, and name it <code class="literal">btnPlayVideo</code>.</li><li class="listitem">Create the action method for the <span class="strong"><strong>Play Video</strong></span> button and name it <code class="literal">btnPlayVideo</code>.</li><li class="listitem">Our next step is to create the code functionality that will be responsible for playing the video when the <span class="strong"><strong>Play Video</strong></span> button is clicked.</li><li class="listitem">Open the <code class="literal">ViewController.h</code> interface file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">Next, create the following code sections as highlighted in the code snippet: <div class="informalexample"><pre class="programlisting">//  ViewController.h
//  PlayVideoExample
//  Created by Steven F Daniel on 20/11/12.
//  Copyright (c) 2012 GenieSoft Studios. All rights reserved.
#import  &lt;UIKit/UIKit.h&gt;
<span class="strong"><strong>#import &lt;MediaPlayer/MediaPlayer.h&gt;</strong></span>

@interface ViewController : UIViewController

// Declare the Getters and Setters for each of our objects.
@property  (strong, nonatomic) IBOutlet UIButton *btnPlayVideo;
<span class="strong"><strong>@property (strong, nonatomic) MPMoviePlayerController *moviePlayerController;</strong></span>
</pre></div></li><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window, and enter in the following highlighted code sections:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>@synthesize btnPlayVideo;</strong></span>
<span class="strong"><strong>@synthesize moviePlayerController;</strong></span>
</pre></div></li><li class="listitem">Next, modify the <code class="literal">btnPlayVideo:</code> method as shown in the code snippet:<div class="informalexample"><pre class="programlisting">#pragma mark Handle Playback of the video when button is pressed.
- (IBAction)btnPlayVideo:(id)sender
{
   // Initialize our moviePlayer Controller with the video path
   NSString *moviePath = [[NSBundle
   mainBundle]pathForResource:@"GenieCompanyVideo" 
   ofType:@"mp4"];
   NSURL  *movieURL = [NSURL fileURLWithPath:moviePath
   isDirectory:NO];
   self.moviePlayerController = [[MPMoviePlayerController alloc] 
   initWithContentURL:movieURL];

   // Set up our notifications to determine when movie completes
   [[NSNotificationCenter defaultCenter] addObserver:self
   selector:@selector(moviePlaybackComplete:)
   name:MPMoviePlayerPlaybackDidFinishNotification
   object:self.moviePlayerController];
   
   // Add the movie player controller to the view and 
   // determine if AirPlay is available
   [self.view addSubview:self.moviePlayerController.view];
   if ([self.moviePlayerController
       respondsToSelector:@selector(setAllowsAirPlay:)]){
       [self.moviePlayerController setAllowsAirPlay:YES];
   }
   // Initialize the movie player properties and play the video.
   self.moviePlayerController.fullscreen = YES;
   self.moviePlayerController.scalingMode = 
   MPMovieScalingModeAspectFit;
  [self.moviePlayerController play];
}</pre></div></li><li class="listitem">Next, create the <a id="id692" class="indexterm"/><code class="literal">moviePlaybackComplete:</code> as method shown in the code snippet: <div class="informalexample"><pre class="programlisting">#pragma mark Handle once the video has finished playback.
- (void)moviePlaybackComplete:(NSNotification *)notification
{
    self.moviePlayerController = [notification object];
    [[NSNotificationCenter defaultCenter] removeObserver:self
    name:MPMoviePlayerPlaybackDidFinishNotification
    object:self.moviePlayerController];
    [self.moviePlayerController.view removeFromSuperview];
}</pre></div></li><li class="listitem">Then, <span class="strong"><strong>Build</strong></span> and <span class="strong"><strong>Run</strong></span> the application by choosing <span class="strong"><strong>Product | Run</strong></span> from the <span class="strong"><strong>Product</strong></span> menu, or alternatively pressing <span class="emphasis"><em>Command + R</em></span>.</li></ol></div><p>When the compilation completes, the <a id="id693" class="indexterm"/>
<a id="id694" class="indexterm"/>following screenshot shows what the icon looks like when <span class="strong"><strong>AirPlay</strong></span> has been enabled:</p><div class="mediaobject"><img src="graphics/3349OT_07_01.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec251"/>How it works...</h2></div></div></div><p>In this recipe, we declared a variable (<code class="literal">NSString</code>) <code class="literal">moviePath</code> that will contain the file path to our movie file and then create a (<code class="literal">NSURL</code>) <code class="literal">movieURL</code> that converts our file path to an object that is needed by the <code class="literal">MPMoviePlayerController</code> method when it is being initialized. </p><p>Next, we set up a notification method to determine when the video playback completes by using a notification method called <code class="literal">MPMoviePlayerPlaybackDidFinishNotification</code> to the <code class="literal">NSNotificationCenter</code> property which the calls the <a id="id695" class="indexterm"/>
<code class="literal">moviePlaybackComplete:</code> method and then add the <code class="literal">MPMoviePlayerController</code> view to our custom view controller, so that it will appear on the screen and then use the <a id="id696" class="indexterm"/>
<code class="literal">respondsToSelector:</code> method of the <code class="literal">MPMoviePlayerController</code> object to cater for older iOS devices that don't support the <code class="literal">allowsAirPlay</code> <a id="id697" class="indexterm"/>property.</p><p>In order to provide AirPlay functionality <a id="id698" class="indexterm"/>
<a id="id699" class="indexterm"/>we enable a special property on our <code class="literal">MPMoviePlayerController</code> <a id="id700" class="indexterm"/>object, by setting the <code class="literal">allowsAirPlay</code> property to <code class="literal">YES</code> and then specify that we want to display our video in full screen.</p><p>We then tell the <code class="literal">moviePlayerController</code> <a id="id701" class="indexterm"/>method to commence playback and then modify the <code class="literal">scalingMode</code> <a id="id702" class="indexterm"/>property of the <code class="literal">MPMoviePlayerController</code> object. By setting this property, it will determine how the movie image adapts to fill the playback size that you have defined. The following scaling modes currently exist, and are displayed here:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">MPMovieScalingModeNone</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">MPMovieScalingModeAspectFit</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">MPMovieScalingModeAspectFill</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">MPMovieScalingModeFill</code></li></ul></div><p>Finally, we create the <code class="literal">moviePlaybackComplete:</code> method and retrieve the object using the <code class="literal">[notificationobject]</code> statement and then reference it with the new <code class="literal">moviePlayerController</code> pointer. We then send a message back to the <code class="literal">NSNotificationCenter</code> method <a id="id703" class="indexterm"/>
<a id="id704" class="indexterm"/>that removes the observer we previously registered within our <code class="literal">playVideo</code> method. We finally proceed with cleaning up our custom view controller from our display.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note52"/>Note</h3><p>For more information on the <code class="literal">MPMoviePlayerController</code> class, you can refer to the Apple Developer Documentation at the following location: <a class="ulink" href="https://developer.apple.com/library/ios/#documentation/mediaplayer/reference/MPMoviePlayerController_Class/Reference/Reference.html">https://developer.apple.com/library/ios/#documentation/mediaplayer/reference/MPMoviePlayerController_Class/Reference/Reference.html</a><code class="literal">#//apple_ref/occ/cl/MPMoviePlayerController</code>
</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec252"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Playing music using the MediaPlayer framework</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Playing music using the MediaPlayer framework"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec72"/>Playing music using the MediaPlayer framework</h1></div></div></div><p>In this recipe we will <a id="id705" class="indexterm"/>
<a id="id706" class="indexterm"/>learn how to play songs that are stored on the iOS device. </p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec253"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe, create a new <span class="strong"><strong>Single View Application</strong></span>, and name it <span class="strong"><strong>MusicPlayerExample</strong></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec254"/>How to do it...</h2></div></div></div><p>To begin, follow these simple steps as outlined in the following order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add a reference to the <code class="literal">MediaPlayer.framework</code> to your project.</li><li class="listitem">Select the <code class="literal">ViewController.xib</code> files from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">From the <span class="strong"><strong>Object Library</strong></span> window, select and drag a <code class="literal">UIToolbar</code> object, and add this to our view and select the <span class="strong"><strong>Item</strong></span> button located within our toolbar. </li><li class="listitem">From the <span class="strong"><strong>Attributes Inspector</strong></span> section, change the <span class="strong"><strong>Title</strong></span> property to read <span class="strong"><strong>Browse</strong></span>.</li><li class="listitem">Create outlets for this <code class="literal">UIBarButtonItem</code>, and name it <code class="literal">btnBrowse</code>.</li><li class="listitem">Create the <code class="literal">action</code> method for the <span class="strong"><strong>Browse</strong></span> button and name it <code class="literal">btnBrowse</code>.</li><li class="listitem">From the <span class="strong"><strong>Object Library</strong></span> window, select and drag a <code class="literal">UIBarButtonItem</code> object, and add this next to the <span class="strong"><strong>Browse</strong></span> button within our toolbar. </li><li class="listitem">From the <span class="strong"><strong>Attributes Inspector</strong></span> section, change <span class="strong"><strong>Title</strong></span> property to read <span class="strong"><strong>Play</strong></span>.</li><li class="listitem">Create the outlets for this <code class="literal">UIBarButtonItem</code>, and name it <code class="literal">btnPlay</code>.</li><li class="listitem">Create the <code class="literal">action</code> method for the <span class="strong"><strong>Play</strong></span> button and name it <code class="literal">btnPlay</code>.</li><li class="listitem">Our next step is to create the code functionality that will be responsible for playing music, when songs are selected and played from the Media Library.</li><li class="listitem">Open the <code class="literal">ViewController.h</code> interface file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">Next, create the following code sections as highlighted in the code snippet: <div class="informalexample"><pre class="programlisting">//  ViewController.h
//  MusicPlayerExample
//  Created by Steven F Daniel on 20/11/12.
//  Copyright (c) 2012 GenieSoft Studios. All rights reserved.

#import  &lt;UIKit/UIKit.h&gt;
<span class="strong"><strong>#import &lt;MediaPlayer/MediaPlayer.h&gt;</strong></span>

<span class="strong"><strong>@interface ViewController : UIViewController&lt;MPMediaPickerControllerDelegate&gt;</strong></span>
<span class="strong"><strong>{</strong></span>
<span class="strong"><strong>}</strong></span>

// Declare the Getters and Setters for each of our objects.
<span class="strong"><strong>@property (nonatomic, retain) MPMusicPlayerController *mPlayer;</strong></span>
<span class="strong"><strong>@property (nonatomic, retain) MPMediaPickerController *mPicker;</strong></span>
</pre></div></li><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window, and enter the following highlighted code sections:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>@synthesize btnBrowse;</strong></span>
<span class="strong"><strong>@synthesize btnPlay;</strong></span>
<span class="strong"><strong>@synthesize mPicker;</strong></span>
<span class="strong"><strong>@synthesize mPlayer;</strong></span>
</pre></div></li><li class="listitem">Next, <a id="id707" class="indexterm"/><a id="id708" class="indexterm"/>modify the <code class="literal">viewDidLoad:</code> method as shown in the code snippet: <div class="informalexample"><pre class="programlisting">- (void)viewDidLoad
{
   [super viewDidLoad];
   
   // Create the Media Picker and Music Player controller's
   self.mPicker = [[MPMediaPickerController alloc] 
   initWithMediaTypes:MPMediaTypeMusic];
   self.mPlayer = [[MPMusicPlayerController alloc] init];
   
   [mPlayer prepareToPlay];   
   self.view.backgroundColor = [UIColor blackColor];
}</pre></div></li><li class="listitem">Then, create the following code sections, as specified in the code snippet:<div class="informalexample"><pre class="programlisting">#pragma mark called when the user presses the Browse button
- (IBAction)btnBrowse:(id)sender {
   self.mPicker.delegate = self;
   self.mPicker.allowsPickingMultipleItems = YES;
   [self presentViewController:mPicker animated:YES
   completion:nil];
}
-(IBAction)btnPlay:(id)sender {
   // Check to see if we are already playing our audio.
   if (!self.mPlayer.playbackState == 
       MPMusicPlaybackStatePlaying) {
       [self.btnPlay setTitle :@"Stop"];
       [self.mPlayer play];
   }
   else {
       [self.btnPlay setTitle:@"Play"];
       [self.mPlayer stop];
   }
}
#pragma mark - Image Picker Delegate Methods
-(void)mediaPicker:(MPMediaPickerController *)mediaPicker
didPickMediaItems:(MPMediaItemCollection *)mediaItemCollection{
    [self.mPlayer
    setQueueWithItemCollection:mediaItemCollection];
    [self.mPicker dismissViewControllerAnimated:YES
    completion:nil];
}
#pragma mark called when the user cancels the media picker
-(void)mediaPickerDidCancel:(MPMediaPickerController *)mediaPicker {
     [self.mPicker dismissViewControllerAnimated:YES
   completion:nil];
}</pre></div></li><li class="listitem">Then, <span class="strong"><strong>Build</strong></span> and <a id="id709" class="indexterm"/><a id="id710" class="indexterm"/><span class="strong"><strong>Run</strong></span> the application by choosing <span class="strong"><strong>Product | Run</strong></span> from the <span class="strong"><strong>Product</strong></span> menu, or alternatively pressing <span class="emphasis"><em>Command + R</em></span>.</li></ol></div><p>When the compilation completes, click on the <span class="strong"><strong>Browse</strong></span> button, and select one or more songs, then press the <span class="strong"><strong>Play</strong></span> to play the chosen songs.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec255"/>How it works...</h2></div></div></div><p>In this recipe, we start by extending our class, to include each of the following class protocols: <code class="literal">MPMediaPickerControllerDelegate</code> so that we can access each of their respective properties and methods. We then initialize the media picker and pass the type of media we want it to look for and then initialize and create an instance of the <code class="literal">MPMusicPlayerController</code> class. <a id="id711" class="indexterm"/>
<a id="id712" class="indexterm"/>Next, we declare our <code class="literal">btnBrowse</code> method that will display the iOS device music library interface, and allows for multiple files to be selected. In our <code class="literal">btnPlay:</code> method, we check to see if any songs are currently being played, which is determined by checking the <code class="literal">playbackState</code> property. Playing and stopping of songs is achieved through the <code class="literal">play</code> and <code class="literal">stop</code> methods of the <code class="literal">MPMusicPlayerController</code> class object. In the <code class="literal">mediaPicker:didPickMediaItems:</code> method, we set the songs that were picked by the user to the music player, through the use of the <code class="literal">setQueueWithItemCollection:</code> method and dismiss the modal media picker controller.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec256"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Playing video with Apple TV integration</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Capturing media with the camera</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Using the iOS device's microphone to record"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec73"/>Using the iOS device's microphone to record</h1></div></div></div><p>In this recipe we will learn how <a id="id713" class="indexterm"/>
<a id="id714" class="indexterm"/>
<a id="id715" class="indexterm"/>we can use the iOS device's microphone to record sounds. </p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec257"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe, create a new <span class="strong"><strong>Single View Application,</strong></span> and name it <span class="strong"><strong>RecorderExample</strong></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec258"/>How to do it...</h2></div></div></div><p>To begin, follow these simple steps as outlined in the following order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add a reference to the <code class="literal">AVFoundation.framework</code> to your project.</li><li class="listitem">Select the <code class="literal">ViewController.xib</code> files from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">From the <span class="strong"><strong>Object Library</strong></span> window, select and drag a <code class="literal">UIToolbar</code> object, and add this to our view and select the <span class="strong"><strong>Item</strong></span> button located within our toolbar. </li><li class="listitem">From the <span class="strong"><strong>Attributes Inspector</strong></span> section, change the <span class="strong"><strong>Title</strong></span> property to read <span class="strong"><strong>Start Recording</strong></span>.</li><li class="listitem">Create the outlet for this <code class="literal">UIBarButtonItem</code>, and name it <code class="literal">btnStart</code>.</li><li class="listitem">Create the <code class="literal">action</code> method for the button, and name it <code class="literal">startRecord</code>.</li><li class="listitem">From the <span class="strong"><strong>Object Library</strong></span> window, select and drag a <code class="literal">UIBarButtonItem</code> object, and add this to <a id="id716" class="indexterm"/><a id="id717" class="indexterm"/><a id="id718" class="indexterm"/>the right of the <span class="strong"><strong>Start Recording</strong></span> button within our toolbar. </li><li class="listitem">From the <span class="strong"><strong>Attributes Inspector</strong></span> section, change the <span class="strong"><strong>Title</strong></span> property to read <span class="strong"><strong>Play</strong></span>.</li><li class="listitem">Create the outlet for this <code class="literal">UIBarButtonItem</code>, and name it <code class="literal">btnPlay</code>.</li><li class="listitem">Create the <code class="literal">action</code> method for the button, and name it <code class="literal">startPlayback</code>.</li><li class="listitem">Our next step is to create the code functionality that will be responsible for recording and playback our audio content.</li><li class="listitem">Open the <code class="literal">ViewController.h</code> interface file from the Project Navigator window.</li><li class="listitem">Next, create the following code sections as highlighted in the code snippet: <div class="informalexample"><pre class="programlisting">//  ViewController.h
//  RecorderExample
//  Created by Steven F Daniel on 20/11/12.
//  Copyright (c) 2012 GenieSoft Studios. All rights reserved.

#import&lt;UIKit/UIKit.h&gt;
<span class="strong"><strong>#import&lt;AVFoundation/AVFoundation.h&gt;</strong></span>

@interface ViewController : UIViewController

// Declare the getters and setters for our Outlets
@property (nonatomic, strong) IBOutlet UIBarButtonItem *btnPlay;
<span class="strong"><strong>@property (nonatomic, strong) AVAudioRecorder *aRecorder;</strong></span>
<span class="strong"><strong>@property (nonatomic, strong) AVAudioPlayer   *aPlayer;</strong></span>

// Declare our class instance methods
- (IBAction)startRecord:(id)sender;
- (IBAction)startPlayback:(id)sender;</pre></div></li><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window, and enter in the following highlighted code sections:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>@synthesize btnStart, btnPlay;</strong></span>
<span class="strong"><strong>@synthesize aPlayer, aRecorder;</strong></span>
</pre></div></li><li class="listitem">Next, modify <a id="id719" class="indexterm"/><a id="id720" class="indexterm"/><a id="id721" class="indexterm"/>the <code class="literal">viewDidLoad:</code> method as shown in the code snippet: <div class="informalexample"><pre class="programlisting">- (void)viewDidLoad
{
  [super viewDidLoad];
   
   // Initialize our recording sample file properties.
   NSString *fileName = @"RecorderExample.caf";
   NSArray  *dirPaths = 
   NSSearchPathForDirectoriesInDomains(NSDocumentDirectory,
                                     NSUserDomainMask, YES);
   NSString *docsDir = [dirPaths objectAtIndex:0];
   NSString *soundFilePath = [docsDir
   stringByAppendingPathComponent:fileName];
   NSURL *soundFileURL = [NSURL fileURLWithPath:soundFilePath];
   
   // Initialize the recorder with default settings.
   NSDictionary *recordSettings = [NSDictionary
   dictionaryWithObjectsAndKeys:
      [NSNumber numberWithInt:AVAudioQualityMin],
                        AVEncoderAudioQualityKey,
                           [NSNumber numberWithInt:16],
                           AVEncoderBitRateKey,
                           [NSNumber numberWithInt:2],
                           AVNumberOfChannelsKey,
                           [NSNumber numberWithFloat:44100.0],
                           AVSampleRateKey, nil];
   
   // Initialize our audio Recorder settings 
   aRecorder = [[AVAudioRecorder alloc] initWithURL:soundFileURL
                                    settings:recordSettings
                                    error:nil];
   
   [aRecorder prepareToRecord];
   aRecorder.meteringEnabled = YES;
   btnPlay.enabled = NO;
   
   // Set the background color of our view to black
   self.view.backgroundColor = [UIColor blackColor];
}</pre></div></li><li class="listitem">Then, create the <a id="id722" class="indexterm"/><a id="id723" class="indexterm"/><a id="id724" class="indexterm"/>following code sections, as specified in the code snippet: <div class="informalexample"><pre class="programlisting">#pragma mark Handles recording of the audio
- (IBAction)startRecord:(id)sender {
// Check to see if we are already recording.
   if (!aRecorder.recording) {
       [btnStart setTitle :@"Stop Recording"  ];
       btnPlay.enabled = NO;
       [aRecorder record];
   }
   else {
      [btnStart setTitle:@"Start Recording"  ];
      btnPlay.enabled = YES;
      [aRecorder stop];
   }
}
#pragma mark  Handles playback of our recording.
-(IBAction)startPlayback:(id)sender
{
   // Check to see if we are already playing.
   if (!aPlayer.playing) {
        [btnPlay setTitle :@"Stop Playing"];

      // Grab the recorded file from the url location.
      aPlayer = [[AVAudioPlayer alloc]
               initWithContentsOfURL:aRecorder.url error:nil];
      
       // Play our audio file
      [aPlayer prepareToPlay];
      [aPlayer play];
   }
   else {
      // Stop the audio playback
      [btnPlay setTitle :@"Play"];
      [aPlayer stop];
   }
}</pre></div></li><li class="listitem">Then, <span class="strong"><strong>Build</strong></span> and <span class="strong"><strong>Run</strong></span> the application by choosing <span class="strong"><strong>Product | Run</strong></span> from the <span class="strong"><strong>Product</strong></span> menu, or alternatively pressing <span class="emphasis"><em>Command + R</em></span>.</li></ol></div><p>When the compilation completes, click on the <span class="strong"><strong>Start Recording</strong></span> button to record your voice sample, and then press the <span class="strong"><strong>Play</strong></span> button to hear the playback of your recording.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec259"/>How it works...</h2></div></div></div><p>In this recipe, we start by creating <a id="id725" class="indexterm"/>
<a id="id726" class="indexterm"/>
<a id="id727" class="indexterm"/>an instance of the <code class="literal">AVAudioRecorder</code> class when the application is first launched. This method is then initialized with a URL pointing the default filename to which the recorded audio is saved, and declare an <code class="literal">NSDictionary</code> object to initialize and set up the recording settings for the audio. Next, we use the <code class="literal">NSSearchPathForDirectoriesInDomains</code> <a id="id728" class="indexterm"/>class to identify the application's document directory, then construct a URL to a file in that location named <code class="literal">RecorderExample.caf</code>, and prepare the <code class="literal">aRecorder</code> instance to begin recording when the user requests it.</p><p>Next, in our <code class="literal">startRecord</code> <a id="id729" class="indexterm"/>method, we use the <code class="literal">aRecorder</code> object to determine if we are currently recording. If we have determined that we are not recording, we change the text of our <code class="literal">startRecord</code> <a id="id730" class="indexterm"/>method to display <span class="strong"><strong>Stop Recording</strong></span>, disable the <code class="literal">btnPlay</code> button, and then set up our <code class="literal">aRecorder</code> object to begin the recording. If we are currently recording, we change the text of our <code class="literal">startRecord</code> method to display <span class="strong"><strong>Start Recording </strong></span>button and disable the <code class="literal">btnPlay</code> button, and stop our <code class="literal">aRecorder</code> object from recording.</p><p>In our next step, we initialize the <code class="literal">aPlayer</code> object to play the file recording using the URL method of the <code class="literal">aRecorder</code> object and set up our <code class="literal">aPlayer</code> object to use the <code class="literal">prepareToPlay</code> method, before calling the <code class="literal">Play</code> method to start the playback. If we have decided that we are currently playing our voice recording, we make a call to the <code class="literal">stop</code> method on our <code class="literal">aPlayer</code> object, which ceases playback.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note53"/>Note</h3><p>For more information on the <code class="literal">AVFoundation</code> class, refer to the Apple Developer Documentation located at the following location: <a class="ulink" href="https://developer.apple.com/library/ios/#documentation/AVFoundation/Reference/AVAudioRecorder_ClassReference/Reference/Reference.html">https://developer.apple.com/library/ios/#documentation/AVFoundation/Reference/AVAudioRecorder_ClassReference/Reference/Reference.html</a><code class="literal">#//apple_ref/occ/cl/AVAudioRecorder</code>
</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec260"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Playing music using the MediaPlayer framework</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Animating views"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec74"/>Animating views</h1></div></div></div><p>In this recipe we will learn how we <a id="id731" class="indexterm"/>can use the <code class="literal">UIKit</code> animations to move a <code class="literal">UILabel</code> control on the screen.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec261"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe, create a new <span class="strong"><strong>Single View Application,</strong></span> and name it <span class="strong"><strong>AnimateViewExample</strong></span>. </p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec262"/>How to do it...</h2></div></div></div><p>To begin, follow these simple steps as outlined in the following order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select the <code class="literal">ViewController.xib</code> files from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">From the <span class="strong"><strong>Object Library</strong></span> window, drag a <code class="literal">UILabel</code> object onto the view.</li><li class="listitem">Resize the <code class="literal">UILabel</code> control so that its contents fill the width of the view.</li><li class="listitem">Next, create the outlet for this <code class="literal">UILabel</code>, and name it <code class="literal">lblAnimateMsg</code>.</li><li class="listitem">Next, from the <span class="strong"><strong>Object</strong></span> <span class="strong"><strong>Library</strong></span> window, drag a <code class="literal">UIButton</code> object onto the view, and place it underneath the <code class="literal">UILabel</code> that we added previously.</li><li class="listitem">From the <span class="strong"><strong>Attributes Inspector</strong></span> section, modify the <span class="strong"><strong>Title</strong></span> property to read <span class="strong"><strong>Start</strong></span>.</li><li class="listitem">Next, create an outlet for this <code class="literal">UIButton</code>, and name it <code class="literal">btnAnimate</code>.</li><li class="listitem">Next, create the action method for the <span class="strong"><strong>Start</strong></span> button and name it <code class="literal">doAnimation</code>.</li><li class="listitem">After adding the button, save the document by choosing <span class="strong"><strong>File | Save</strong></span> from the menu bar.</li><li class="listitem">Our next step is to create the code functionality that will be responsible for animating our <code class="literal">UILabel</code> control when the <span class="strong"><strong>Start</strong></span> button is pressed.</li><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">Create the following variable declaration as highlighted in the code snippet:<div class="informalexample"><pre class="programlisting">//  ViewController.m
//  AnimateViewExample
//  Created by Steven F Daniel on 20/11/12.
//  Copyright (c) 2012 GenieSoft Studios. All rights reserved.

#import "ViewController.h"

@interface ViewController ()
@end

@implementation ViewController

@synthesize lblAnimateMsg;
@synthesize btnAnimate;

<span class="strong"><strong>CGRect origPos;</strong></span>
</pre></div></li><li class="listitem">Next, modify the <a id="id732" class="indexterm"/><code class="literal">viewDidLoad:</code> method as shown in the following code snippet: <div class="informalexample"><pre class="programlisting">- (void)viewDidLoad
{
   [super viewDidLoad];

   // Set the color of our Animation Label and disable button
   lblAnimateMsg.text = @"Animating Views Example";
   lblAnimateMsg.textColor = [UIColor yellowColor];
   [self.view setBackgroundColor:[UIColor blackColor]];
}</pre></div></li><li class="listitem">Next, modify the <code class="literal">doAnimation:</code> method as shown in the following code snippet: <div class="informalexample"><pre class="programlisting">#pragma mark Perform the animation of our Label
- (IBAction)doAnimation:(id)sender {

   // Save the original position of our Label
   origPos = lblAnimateMsg.frame;
   CGRect AnimateFrame = origPos;
   
   // Initialize and specify the height of our frame
   AnimateFrame.size.height = 700;
   
   // Set the color of our Animation Label and disable button
   lblAnimateMsg.text = @"Animating Views Example";
   lblAnimateMsg.textColor = [UIColor yellowColor];
   btnAnimate.enabled = NO;
   
   // Set up our Animations
   [UIView beginAnimations:@"AnimationBegin" context:nil];
   [UIView setAnimationDuration:5];
   [UIView setAnimationDelegate:self];
   [UIView setAnimationCurve:UIViewAnimationCurveEaseInOut];
   [UIView setAnimationDidStopSelector:
   @selector(doAnimationStop)];
   
   // Increase the frame of our Animation message
   self.lblAnimateMsg.frame = AnimateFrame;
   [UIView commitAnimations];
}</pre></div></li><li class="listitem">Next, create the <a id="id733" class="indexterm"/><code class="literal">doAnimationStop:</code> method as shown in the code snippet: <div class="informalexample"><pre class="programlisting">#pragma mark Method is called when animation stops.
-(void)doAnimationStop
{
   lblAnimateMsg.frame = origPos;
   btnAnimate.enabled = YES;
   lblAnimateMsg.text = @"Animation has Completed.";
   lblAnimateMsg.textColor = [UIColor greenColor];
}</pre></div></li><li class="listitem">Then, <span class="strong"><strong>Build</strong></span> and <span class="strong"><strong>Run</strong></span> the application by choosing <span class="strong"><strong>Product | Run</strong></span> from the <span class="strong"><strong>Product</strong></span> menu, or alternatively pressing <span class="emphasis"><em>Command + R</em></span>.</li></ol></div><p>When the compilation completes, the iOS Simulator will appear. Tap the <span class="strong"><strong>Start</strong></span> button to see the label start to animate and display the message when the animation completes.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec263"/>How it works...</h2></div></div></div><p>In this recipe, we looked at how we can <a id="id734" class="indexterm"/>use the <code class="literal">UIKit</code> framework to perform animations on objects within the view. We start by saving the original position of our label and storing this into a variable called <code class="literal">origPos</code> and then create a new variable <code class="literal">AnimateFrame</code> that will be used to specify the height to which our label will animate within. </p><p>In our next step, we begin marking the start of our animation block using the <code class="literal">beginAnimations</code> method and then specify a name for the animation, before setting the graphics context to <code class="literal">nil</code>. Next, we specify the length of the animation in seconds using the <code class="literal">setAnimationDuration</code> property, and then set the animation delegate object. </p><p>Next, we define the default easing functions that will be applied to the animation at its start and ending points by using the <a id="id735" class="indexterm"/>
<code class="literal">setAnimationCurve</code> method. Then, we set up a selector object that gets called when the animation completes. Finally, we stop our animation block using the <code class="literal">commitAnimations</code> method to mark the end of our animations. Finally, in our <code class="literal">doAnimationStop:</code> method, we <a id="id736" class="indexterm"/>restore the label control to the original location for the next time round.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note54"/>Note</h3><p>For more information on the <code class="literal">UIKit</code> framework, you can refer to the Apple Developer Documentation location at the following URL: <a class="ulink" href="https://developer.apple.com/library/ios/#documentation/UIKit/Reference/UIKit_Framework/_index.html">https://developer.apple.com/library/ios/#documentation/UIKit/Reference/UIKit_Framework/_index.html</a>
</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec264"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Using Xcode to create an iOS project</em></span> recipe in <a class="link" href="ch01.html" title="Chapter 1. Getting and Installing the iOS SDK Development Tools">Chapter 1</a>, <span class="emphasis"><em>Getting and Installing the iOS SDK Development Tools</em></span></li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating outlets to Interface Builder objects</em></span> recipe in <a class="link" href="ch01.html" title="Chapter 1. Getting and Installing the iOS SDK Development Tools">Chapter 1</a>, <span class="emphasis"><em>Getting and Installing the iOS SDK Development Tools</em></span></li></ul></div></div></div>
<div class="section" title="Drawing customized text"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec75"/>Drawing customized text</h1></div></div></div><p>In this recipe we will take a look at <a id="id737" class="indexterm"/>how easy it is to draw stylized text with an outline on to the view.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec265"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe, create a new <span class="strong"><strong>Single View Application,</strong></span> and name it <span class="strong"><strong>DrawTextExample</strong></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec266"/>How to do it...</h2></div></div></div><p>To begin, follow these simple steps as outlined in the following order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select the <code class="literal">DrawTextExample</code> folder, choose <span class="strong"><strong>File | New | File…</strong></span></li><li class="listitem">Select the <span class="strong"><strong>Objective-C class</strong></span> template from the list of available templates.</li><li class="listitem">Click on the <span class="strong"><strong>Next</strong></span> button to proceed to the next step in the wizard.</li><li class="listitem">Enter in <code class="literal">DrawTextView</code> as the name of the class name to be created.</li><li class="listitem">Ensure that you have selected <code class="literal">UIView</code> as the type of subclass to create from the <span class="strong"><strong>Subclass of</strong></span> drop-down list.</li><li class="listitem">Click on the <span class="strong"><strong>Next</strong></span> button to proceed to the next step of the wizard.</li><li class="listitem">Then, click on the <span class="strong"><strong>Create</strong></span> button to save the file to the folder location specified.</li><li class="listitem">We have successfully finished creating our <code class="literal">DrawTextView</code> class. Our next step is to implement the functionality and methods used by this class.</li><li class="listitem">Open the <code class="literal">DrawTextView.m</code> implementation file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">Modify the <code class="literal">drawRect:</code> method as shown in the following code snippet.<div class="informalexample"><pre class="programlisting">- (void)drawRect:(CGRect)rect
{
   // Set up and initialize our Graphics Context
   CGContextRef context = UIGraphicsGetCurrentContext();
   CGContextClearRect(context, rect);
   
   // Specify the text color and font fill style
   CGContextSetFillColorWithColor(context, [UIColor
   yellowColor].CGColor);
   CGContextSetTextDrawingMode(context, kCGTextFillStroke);
   
   // Finally, draw the text using the specified font.
   NSString *theString = @"GENIESOFT STUDIOS...";
   [theString drawAtPoint:CGPointMake(20.0f, 100.0f) 
   withFont:[UIFont fontWithName:@"Verdana-Bold" 
   size:25]];
}</pre></div></li></ol></div><p>Our next step is to create the code <a id="id738" class="indexterm"/>functionality that will be responsible for adding our custom view as a sub-view to our existing view controller.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">Include the following class reference as highlighted in the code snippet: <div class="informalexample"><pre class="programlisting">//  ViewController.m
//  TextDrawExample
//  Created by Steven F Daniel on 20/11/12.
//  Copyright (c) 2012 GenieSoft Studios. All rights reserved.

#import  "ViewController.h"
<span class="strong"><strong>#import "DrawTextView.h"</strong></span>
</pre></div></li><li class="listitem">Next, modify the <code class="literal">viewDidLoad:</code> method as shown in the following code snippet: <div class="informalexample"><pre class="programlisting">- (void)viewDidLoad
{
  [super viewDidLoad];

  // Declare and add our custom view as a subView
  // to the current view.
  DrawTextView *drawTextView = [[DrawTextView alloc] 
  initWithFrame:self.view.bounds];
  [self.view addSubview:drawTextView];
}</pre></div></li><li class="listitem">Then, <span class="strong"><strong>Build</strong></span> and <span class="strong"><strong>Run</strong></span> the application by choosing <span class="strong"><strong>Product | Run</strong></span> from the <span class="strong"><strong>Product</strong></span> menu, or alternatively pressing <span class="emphasis"><em>Command + R</em></span>.</li></ol></div><p>When the compilation completes, the iOS Simulator appears and displays the text we created within this recipe. The image has been rotated within the device.</p><div class="mediaobject"><img src="graphics/3349OT_07_02.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec267"/>How it works...</h2></div></div></div><p>In this recipe, we created a new custom <code class="literal">DrawTextView</code> class that inherits from the <code class="literal">UIView</code> class. We then modify the <code class="literal">drawRect:</code> method that will be used to draw our text to the view. We then declare the variable <code class="literal">context</code> that will be used to obtain the current graphics context using the <code class="literal">UIGraphicsGetCurrentContext</code> function. </p><p>Next, we clear the view using the <code class="literal">CGContextClearRect</code> <a id="id739" class="indexterm"/>function and set the color of our text and pass the <code class="literal">FillStroke</code> <a id="id740" class="indexterm"/>value to our <code class="literal">CGContextSetTextDrawingMode</code> method and then call our <code class="literal">drawAtPoint:</code> method to draw the text using the font details specified by the <code class="literal">UIFont</code> class. Finally, we initialize our <code class="literal">DrawTextView</code> custom class and then add this as a subview using the same dimensions of our parent view controller.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note55"/>Note</h3><p>For more information on the <code class="literal">CoreGraphics</code> class, you can refer to the Apple Developer Documentation location at the following URL: <a class="ulink" href="https://developer.apple.com/library/ios/#documentation/coregraphics/reference/coregraphics_framework/_index.html">https://developer.apple.com/library/ios/#documentation/coregraphics/reference/coregraphics_framework/_index.html</a>
</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec268"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Drawing lines and curves</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Drawing lines and curves"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec76"/>Drawing lines and curves</h1></div></div></div><p>In this recipe we will <a id="id741" class="indexterm"/>
<a id="id742" class="indexterm"/>
<a id="id743" class="indexterm"/>
<a id="id744" class="indexterm"/>take a look at how easy it is to draw lines and curves to our view.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec269"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe, create a new <span class="strong"><strong>Single View Application,</strong></span> and name it <span class="strong"><strong>LinesCurvesExample</strong></span>. Create a custom view and name it <code class="literal">LinesCurvesView</code>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec270"/>How to do it...</h2></div></div></div><p>To begin, follow these simple steps as outlined in the following order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">LinesCurvesView.m</code> implementation file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">Modify the <code class="literal">drawRect:</code> method as shown in the following code snippet:.<div class="informalexample"><pre class="programlisting">- (void)drawRect:(CGRect)rect
{
   // Set up and initialize our Graphics Context
   CGContextRef context = UIGraphicsGetCurrentContext();
   CGContextClearRect(context, rect);
      
   // Draw our Line to our View
   CGContextSetLineWidth(context, 5);
   CGContextSetStrokeColorWithColor(context, [UIColor
   greenColor].CGColor);
   CGContextMoveToPoint(context, 0, 0);
   CGContextAddLineToPoint(context, self.bounds.size.width, 
   self.bounds.size.height);
   CGContextStrokePath(context);
   
   // Then, draw and Add the Curve
   CGContextSetStrokeColorWithColor(context, [UIColor
   redColor].CGColor);
   CGContextMoveToPoint(context, 0, self.bounds.size.height);
   CGContextAddCurveToPoint(context, 0, self.bounds.size.height, 
   5, self.bounds.size.height / 2, self.bounds.size.width, 0);
   CGContextStrokePath(context); 
}</pre></div></li><li class="listitem">Our next step is to <a id="id745" class="indexterm"/><a id="id746" class="indexterm"/><a id="id747" class="indexterm"/><a id="id748" class="indexterm"/>create the code functionality that will be responsible for adding our custom view as a subview to our existing view controller.</li><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">Add a reference to our <code class="literal">LinesCurvesView.h</code> interface file like we did previously.</li><li class="listitem">Next, modify the <code class="literal">viewDidLoad:</code> method as shown in the following code snippet: <div class="informalexample"><pre class="programlisting">- (void)viewDidLoad
{
   [super viewDidLoad];

   // Declare and add our custom view as a subView
   // to the current view.
  LinesCurvesView *linesCurvesView = [[LinesCurvesView alloc] 
  initWithFrame:self.view.bounds];
  [self.view addSubview:linesCurvesView];
}</pre></div></li><li class="listitem">Then, <span class="strong"><strong>Build</strong></span> and <span class="strong"><strong>Run</strong></span> the application by choosing <span class="strong"><strong>Product | Run</strong></span> from the <span class="strong"><strong>Product</strong></span> menu, or alternatively pressing <span class="emphasis"><em>Command + R</em></span>.</li></ol></div><p>When the compilation completes, <a id="id749" class="indexterm"/>
<a id="id750" class="indexterm"/>
<a id="id751" class="indexterm"/>
<a id="id752" class="indexterm"/>the iOS Simulator will appear. The following screenshot displays our line and curve that we created within this recipe. I have rotated this image within the device.</p><div class="mediaobject"><img src="graphics/3349OT_07_03.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec271"/>How it works...</h2></div></div></div><p>In this recipe, we created a new custom <a id="id753" class="indexterm"/>
<code class="literal">linesCurvesView</code> class that inherits from the <code class="literal">UIView</code> class. We then modified the <code class="literal">drawRect:</code> method and proceeded to declare a variable <code class="literal">context</code> used to obtain the current graphics context using the <a id="id754" class="indexterm"/>
<code class="literal">UIGraphicsGetCurrentContext</code> function just like we did in our preceding example.</p><p>In our next step, we proceed to set the line width, color, and add the line using the <code class="literal">CGContextAddLineToPoint</code> method which accepts the starting and ending points of each line and call the <a id="id755" class="indexterm"/>
<code class="literal">CGContextStrokePath</code> method to display the line to the view. </p><p>In order to add a curve to our view, we repeat the steps accordingly and then call the <code class="literal">CGContextMoveToPoint</code> method, <a id="id756" class="indexterm"/>which moves the current point, and we call the <a id="id757" class="indexterm"/>
<code class="literal">CGContextAddCurveToPoint</code> method so that a curve will happen at the current point, which has been determined by the <code class="literal">CGContextMoveToPoint</code> method.</p><p>Next, we <a id="id758" class="indexterm"/>
<a id="id759" class="indexterm"/>
<a id="id760" class="indexterm"/>
<a id="id761" class="indexterm"/>call <code class="literal">CGContextStrokePath</code> method to display the curve to the view. Finally, we initialize our <code class="literal">LinesCurvesView</code> custom class and then add this as a subview using the same dimensions of our parent view controller.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec272"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Drawing customize text</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Adding and customizing views</em></span> recipe in <a class="link" href="ch02.html" title="Chapter 2. User Interfaces – Creating the UI">Chapter 2</a>, <span class="emphasis"><em>User Interfaces - Creating the UI</em></span></li></ul></div></div></div>
<div class="section" title="Drawing and filling shapes"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec77"/>Drawing and filling shapes</h1></div></div></div><p>In this recipe we will take a <a id="id762" class="indexterm"/>
<a id="id763" class="indexterm"/>look at how easy it is to draw and fill a series of shapes on to the screen.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec273"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe, create a new <span class="strong"><strong>Single View Application,</strong></span> and name it <span class="strong"><strong>ShapesDrawExample</strong></span>. Create a custom view and name it <span class="strong"><strong>ShapesView</strong></span>. </p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec274"/>How to do it...</h2></div></div></div><p>To begin, follow these simple steps as outlined in the following order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">ShapesView.m</code> implementation file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">Modify the <code class="literal">drawRect:</code> method as shown in the following code snippet.<div class="informalexample"><pre class="programlisting">- (void)drawRect:(CGRect)rect
{
   // Set up and initialize our Graphics Context
   CGContextRef context = UIGraphicsGetCurrentContext();
   CGContextClearRect(context, rect);
   
   // Draw our Circle to our view
   CGContextSetFillColorWithColor(context, [UIColor
   redColor].CGColor);
   CGContextAddEllipseInRect(context, CGRectMake(50,50,150,150));
   CGContextFillPath(context);
   
   // Draw Square to the Screen
   CGContextSetFillColorWithColor(context, [UIColor
   yellowColor].CGColor);
   CGContextAddRect(context, CGRectMake(50,200,200,200));
   CGContextFillPath(context);
   
   // Draw a Triangle to the Screen
   CGContextMoveToPoint   (context, 150, 100);  // Top    left
   CGContextAddLineToPoint(context, 300, 100);  // Middle right
   CGContextAddLineToPoint(context, 150, 300);  // Bottom left
   CGContextSetFillColorWithColor(context, [UIColor
   greenColor].CGColor);
   CGContextFillPath(context);
}</pre></div></li><li class="listitem">Our next step is to <a id="id764" class="indexterm"/><a id="id765" class="indexterm"/>create the code functionality that will be responsible for adding our custom view as a subview to our existing view controller.</li><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">Add a reference to our <code class="literal">ShapesView.h</code> interface file like we did previously. </li><li class="listitem">Next, modify the <code class="literal">viewDidLoad:</code> method as shown in the following code snippet: <div class="informalexample"><pre class="programlisting">- (void)viewDidLoad
{
   [super viewDidLoad];

   // Declare and add our custom view as a subView
   // to the current view.
   ShapesView *shapesView = [[ShapesView alloc] 
   initWithFrame:self.view.bounds];
   [self.view addSubview:shapesView];
}</pre></div></li><li class="listitem">Then, <span class="strong"><strong>Build</strong></span> and <span class="strong"><strong>Run</strong></span> the application by choosing <span class="strong"><strong>Product | Run</strong></span> from the <span class="strong"><strong>Product</strong></span> menu, or alternatively pressing <span class="emphasis"><em>Command + R</em></span>.</li></ol></div><p>When the compilation completes, the iOS Simulator will appear. The following screenshot displays each of our colored <a id="id766" class="indexterm"/>
<a id="id767" class="indexterm"/>shapes filled. I have rotated this image within the device.</p><div class="mediaobject"><img src="graphics/3349OT_07_04.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec275"/>How it works...</h2></div></div></div><p>In this recipe, we created a new custom <a id="id768" class="indexterm"/>
<code class="literal">ShapesView</code> class that inherits from the <code class="literal">UIView</code> class. We then modified the <a id="id769" class="indexterm"/>
<code class="literal">drawRect:</code> method and declared a variable <code class="literal">context</code> used to obtain the current graphics context using the <code class="literal">UIGraphicsGetCurrentContext</code> function just like we did in our previous example. In our next step, we proceed to set the fill color of our circle by using the <a id="id770" class="indexterm"/>
<code class="literal">CGContextSetFillColorWithColor</code> method and proceed to call the <code class="literal">CGContextAddEllipseInRect</code> <a id="id771" class="indexterm"/>method while passing the <code class="literal">CGRectMake</code> object. The <a id="id772" class="indexterm"/>
<code class="literal">CGRectMake</code> method defines the bounding rectangle of the circle. Next, we call the <a id="id773" class="indexterm"/>
<code class="literal">CGContextFillPath</code> method, which fills the object, and displays it to the screen. </p><p>Whenever you proceed to define a rectangle, you need to use the <code class="literal">CGContextAddRect</code> method and specify the dimensions using the <a id="id774" class="indexterm"/>
<code class="literal">CGRectMake</code> method as we did when defining our circle. Next, we define our triangle by specifying the first point of the triangle using the <code class="literal">CGContextMoveToPoint</code> method and then proceed to call the <code class="literal">CGContextAddLineToPoint</code> method for each vertex that makes up the triangle, before specifying the color for our triangle and use the <code class="literal">CGContextFillPath</code> method to display the triangle object to the screen. <a id="id775" class="indexterm"/>
<a id="id776" class="indexterm"/>Finally, we initialize our <code class="literal">LinesCurvesView</code> custom class and then add this as a subview using the same dimensions of our parent view controller.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec276"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Drawing lines and curves</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Adding and customizing views</em></span> recipe in <a class="link" href="ch02.html" title="Chapter 2. User Interfaces – Creating the UI">Chapter 2</a>, <span class="emphasis"><em>User Interfaces — Creating the UI</em></span></li></ul></div></div></div>
<div class="section" title="Applying color effects using Core Image"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec78"/>Applying color effects using Core Image</h1></div></div></div><p>In this recipe we will <a id="id777" class="indexterm"/>
<a id="id778" class="indexterm"/>take a look at how we can use Core Image to apply color effects to an image.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec277"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe, create a new <span class="strong"><strong>Single View Application</strong></span>, and name it <span class="strong"><strong>ColorEffectsExample</strong></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec278"/>How to do it...</h2></div></div></div><p>To begin, follow these simple steps as outlined in the following order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add a reference to the <code class="literal">CoreImage.framework</code> to your project.</li><li class="listitem">Select the <code class="literal">ViewController.xib</code> files from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">From the <span class="strong"><strong>Object</strong></span> <span class="strong"><strong>Library</strong></span> window, drag a <code class="literal">UIImageView</code> object onto the view.</li><li class="listitem">Resize the control accordingly so that it takes up the entire area of the screen, and set the image view <span class="strong"><strong>Mode</strong></span> to <span class="strong"><strong>Scale to Fill</strong></span> from within the <span class="strong"><strong>Attributes Inspector</strong></span> tab.</li><li class="listitem">Next, create the outlet for this <code class="literal">UIImageView</code>, and name it <code class="literal">imageView</code>.</li><li class="listitem">Our next step is to create the code functionality that will be responsible for applying the various color effects to the image.</li><li class="listitem">Open the <code class="literal">ViewController.h</code> interface file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">Next, modify the interface file as shown by the highlighted code sections in the following code snippet: <div class="informalexample"><pre class="programlisting">//  ViewController.h
//  ColorEffectsExample
//  Created by Steven F Daniel on 20/11/12.
//  Copyright (c) 2012 GenieSoft Studios. All rights reserved.

#import &lt;UIKit/UIKit.h&gt;

<span class="strong"><strong>#define IMAGENAME @"Frederick_Prince_of_Wales.jpg"</strong></span>

<span class="strong"><strong>@interface ViewController : UIViewController&lt;UIActionSheetDelegate&gt;</strong></span>

// Declare the Getters and Setters for each of our objects.
@property (strong, nonatomic) IBOutlet UIImageView *imageView;</pre></div></li><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window, and enter in the following highlighted code sections:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>@synthesize imageView;</strong></span>
</pre></div></li><li class="listitem">Next, modify the <code class="literal">viewDidLoad:</code> method as shown in the following code snippet:<div class="informalexample"><pre class="programlisting">- (void)viewDidLoad
{
  [super viewDidLoad];

  // Set up and initialize our ImageView Controller.
  self.imageView.image = [UIImage imageNamed:IMAGENAME];
  self.imageView.contentMode = UIViewContentModeScaleAspectFill;
}</pre></div></li><li class="listitem">Next, create the <code class="literal">touchesBegan:</code> method as shown in the code snippet: <div class="informalexample"><pre class="programlisting">#pragma mark method called when the user taps the screen.
-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event {
   // Initialize our Action Sheet with options
   UIActionSheet *actionSheet = [[UIActionSheet alloc]
   initWithTitle:@"Available Transitions"
   delegate:self
   cancelButtonTitle:@"Cancel"
   destructiveButtonTitle:@"Close"
   otherButtonTitles:@"Vibrance",@"Sepia Tone",@"Reset", nil];
   
   // Display the actionsheet to the view.
   [actionSheet showInView:self.view];
}</pre></div></li><li class="listitem">Next, create the <code class="literal">actionSheet:</code> method as shown in the code snippet: <div class="informalexample"><pre class="programlisting">#pragma mark Delegate which handles the option buttons selected
- (void)actionSheet:(UIActionSheet *)actionSheetclickedButtonAtIndex:(NSInteger)buttonIndex {
   CIImage*inputImage = [CIImage
   imageWithCGImage:[self.imageView.image CGImage]];
   CIContext *context = [CIContextcontextWithOptions:nil];
   CIImage   *outputImage;
   CIFilter  *filter;
   
   // Determine the button selected and handle accordingly.
   switch (buttonIndex) {
      case 1: // Adjusts the saturation of the image 
         filter = [CIFilter filterWithName:@"CIVibrance"];
         [filter setDefaults];
         [filter setValue: inputImage forKey: @"inputImage"];
         [filter setValue: [NSNumber numberWithFloat:1.00] 
         forKey: @"inputAmount"];
         outputImage = [filter valueForKey: @"outputImage"];
         break;
      case 2:   // Set the Septia Tone of the image
         filter = [CIFilter filterWithName:@"CISepiaTone"];
         [filtersetDefaults];
         [filter setValue: inputImage forKey:@"inputImage"];
         [filter setValue: [NSNumber numberWithFloat:0.8] 
         forKey: @"inputIntensity"];
         outputImage = [filter valueForKey:@"outputImage"];
         break;
   case 3: // Reset our image to the original state
         self.imageView.image = [UIImage imageNamed:IMAGENAME];
         break;
      default:
         NSLog(@"Unsupported option detected.");
         break;
   }
   // Don't process if the Close and Cancel buttons are pressed
   if (buttonIndex&gt; 0 &amp;&amp;buttonIndex&lt; 3) {
      self.imageView.image = [UIImage imageWithCGImage:
                        [context createCGImage:outputImage
                                 fromRect:outputImage.extent]];
   }
}</pre></div></li><li class="listitem">Then, <span class="strong"><strong>Build</strong></span> and <span class="strong"><strong>Run</strong></span> the application by choosing <span class="strong"><strong>Product | Run</strong></span> from the <span class="strong"><strong>Product</strong></span> menu, or alternatively pressing <span class="emphasis"><em>Command + R</em></span>.</li></ol></div><p>When the compilation <a id="id779" class="indexterm"/>
<a id="id780" class="indexterm"/>completes, the iOS Simulator will appear. Tap the iOS device screen to see the various image options appear. The following screenshot shows the Sepia Tone effect applied to the image.</p><div class="mediaobject"><img src="graphics/3349OT_07_05.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec279"/>How it works...</h2></div></div></div><p>In this recipe, we started by extending our class to include the class protocol for the <code class="literal">UIActionSheetDelegate</code> class <a id="id781" class="indexterm"/>
<a id="id782" class="indexterm"/>so that we can access the protocol's respective methods. We then initialized our <code class="literal">imageView</code> control by rendering the default image to use as defined by our <code class="literal">#define</code> directive and created the <code class="literal">touchesBegan:</code> method, and initialize an <code class="literal">actionSheet</code> variable that sets up a list of options that can be chosen from, and then applied to the image. Next, we create the <code class="literal">actionSheet:clickedButtonAtIndex:</code> method that will be used to determine what button has been selected from the action sheet options panel, which is derived by the <code class="literal">buttonIndex</code> property. Next, we declare a <code class="literal">CIContext</code> variable context. This variable will be used for rendering the <code class="literal">cImage</code> image object to the view. </p><p>We then declared an <code class="literal">inputImage</code> <a id="id783" class="indexterm"/>
<a id="id784" class="indexterm"/>variable object of type <code class="literal">CIImage</code>, which contains a pointer to the image within our <code class="literal">imageView</code> and declared an <code class="literal">CIImageoutputImage</code> variable that will be used to apply the image filter changes, and then output this modified <code class="literal">imageView</code> control. We then declare a <code class="literal">CIFilter</code> variable called <code class="literal">filter</code>, which will contain the type of filter effect to use. </p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note56"/>Note</h3><p>For more information on the <code class="literal">CoreImage</code> <code class="literal">filters</code>, please refer to the following: <a class="ulink" href="https://developer.apple.com/library/ios/#documentation/GraphicsImaging/Reference/CoreImageFilterReference/Reference/reference.html">https://developer.apple.com/library/ios/#documentation/GraphicsImaging/Reference/CoreImageFilterReference/Reference/reference.html</a>
</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec280"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Applying transition effects</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Applying transition effects"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec79"/>Applying transition effects</h1></div></div></div><p>In this recipe we will <a id="id785" class="indexterm"/>
<a id="id786" class="indexterm"/>take a look at how we can apply transition effects to create a water ripple effect to an image.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec281"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe, create a new <span class="strong"><strong>Single View Application</strong></span>, and name it <span class="strong"><strong>TransitionsExample</strong></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec282"/>How to do it...</h2></div></div></div><p>To begin, follow these simple steps as outlined in the following order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add a reference to the <code class="literal">QuartzCore.framework</code> to your project.</li><li class="listitem">Select the <code class="literal">ViewController.xib</code> files from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">From the <span class="strong"><strong>Object</strong></span> <span class="strong"><strong>Library</strong></span> window, drag a <code class="literal">UIImageView</code> object onto the view.</li><li class="listitem">Resize the control accordingly so that it takes up the entire area of the screen, and set the image view <span class="strong"><strong>Mode</strong></span> to <span class="strong"><strong>Aspect Fill </strong></span>from within the <span class="strong"><strong>Attributes Inspector</strong></span> tab.</li><li class="listitem">Next, create the outlet for this <code class="literal">UIImageView</code>, and name it <code class="literal">imageView</code>.</li><li class="listitem">Our next step is to create the <a id="id787" class="indexterm"/><a id="id788" class="indexterm"/>code functionality that will be responsible for applying the transition effects to the image.</li><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file from the <span class="strong"><strong>Project</strong></span> <span class="strong"><strong>Navigator</strong></span> window.</li><li class="listitem">Include the <code class="literal">QuartzCore</code> class reference as highlighted in the code snippet: <div class="informalexample"><pre class="programlisting">//  ViewController.m
//  TransitionsExample
//  Created by Steven F Daniel on 20/11/12.
//  Copyright (c) 2012 GenieSoft Studios. All rights reserved.

#import  "ViewController.h"
<span class="strong"><strong>#import "QuartzCore/QuartzCore.h"</strong></span>

<span class="strong"><strong>@synthesize imageView;</strong></span>
</pre></div></li><li class="listitem">Next, modify the <code class="literal">viewDidLoad:</code> method as shown in the following code snippet: <div class="informalexample"><pre class="programlisting">- (void)viewDidLoad
{
  [super viewDidLoad];

  // Set up and initialize our ImageView Controller.
  self.imageView.image = [UIImage
  imageNamed:@"Prince_Frederick.jpg"];
  self.imageView.contentMode = UIViewContentModeScaleAspectFill;
}</pre></div></li><li class="listitem">Next, create the <code class="literal">touchesBegan:</code> method as shown in the code snippet: <div class="informalexample"><pre class="programlisting">#pragma mark method called when the user taps the screen.
-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event
{
   // Applies the Ripple Effect transition to the view.
   CATransition *animation = nil;
   animation = [CATransition animation];
   [animation setDelegate:self];
   [animation setDuration:3.0f];
   [animation setType:@"rippleEffect" ];
   [self.view.layer addAnimation:animation forKey:NULL];
}</pre></div></li><li class="listitem">Then, <span class="strong"><strong>Build</strong></span> and <span class="strong"><strong>Run</strong></span> the application by choosing <span class="strong"><strong>Product | Run</strong></span> from the <span class="strong"><strong>Product</strong></span> menu, or alternatively pressing <span class="emphasis"><em>Command + R</em></span>.</li></ol></div><p>When the compilation completes, the iOS Simulator will appear. Tap the iOS device screen to see the water rippling <a id="id789" class="indexterm"/>
<a id="id790" class="indexterm"/>effect applied to the image as can be seen in the following image, which has been rotated within the device.</p><div class="mediaobject"><img src="graphics/3349OT_07_06.jpg" alt="How to do it..."/></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec283"/>How it works...</h2></div></div></div><p>In this recipe, we learned how easy it was to apply transition effects to an image contained within a view. We first start by declaring a variable called animation that will be responsible for handling the transition animations for our <code class="literal">UIView</code> layer. In the next step, we specify the duration of our ripple effect that will be used to define how long, in seconds, a single iteration of an animation will take to display.</p><p>Next, we create the <a id="id791" class="indexterm"/>
<code class="literal">touchesBegan:</code> method, which gets called when the user places their finger on the screen. Next, we specify the type of animation that we want to use is the <code class="literal">rippleEffect</code> transition <a id="id792" class="indexterm"/>
<a id="id793" class="indexterm"/>effect and then apply the animation effect to our view.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note57"/>Note</h3><p>For more information on the <code class="literal">QuartzCore</code> framework, refer to the following URL: <a class="ulink" href="https://developer.apple.com/library/ios/#documentation/GraphicsImaging/Reference/QuartzCoreRefCollection/_index.html">https://developer.apple.com/library/ios/#documentation/GraphicsImaging/Reference/QuartzCoreRefCollection/_index.html</a>
</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec284"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Applying color effects using Core Image</em></span> recipe</li></ul></div></div></div></body></html>