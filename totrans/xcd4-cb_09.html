<html><head></head><body><div class="chapter" title="Chapter&#xA0;9.&#xA0;Creating a Social Networking App with the Facebook iOS SDK"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Creating a Social Networking App with the Facebook iOS SDK</h1></div></div></div><p>In this chapter, we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Downloading the Facebook iOS SDK</li><li class="listitem" style="list-style-type: disc">Registering your iOS applications with Facebook</li><li class="listitem" style="list-style-type: disc">Building a simple social networking application</li><li class="listitem" style="list-style-type: disc">Adding the Facebook iOS SDK to your project</li><li class="listitem" style="list-style-type: disc">Implementing the Single Sign On (SSO) feature</li><li class="listitem" style="list-style-type: disc">Requesting additional Facebook permissions</li><li class="listitem" style="list-style-type: disc">Implementing and using the Graph API to read JSON data</li><li class="listitem" style="list-style-type: disc">Integrating with the Facebook social channels</li><li class="listitem" style="list-style-type: disc">Handling Facebook errors within your application</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec94"/>Introduction</h1></div></div></div><p>On May 24, 2007, Mark Zuckerberg announced the Facebook platform, a development platform for programmers to create social applications within Facebook.</p><p>When Facebook launched the development platform, numerous applications had been built, and already had millions of users playing them. The social networking application utilizes the Facebook collection of APIs that enables you to connect to Facebook and send application request notifications, so that you can add them to your list of friends.</p><p>In this chapter, we will take a look at how to download the Facebook iOS SDK and register your iOS application, so that it can be used with Facebook. We will then start by creating a simple application and look at how we can add the Facebook iOS SDK into our project, so that the user can sign in to their Facebook account in order to send notification requests as well as submit news feeds directly to their home page wall.</p><p>Finally, we will look at how to implement the <a id="id929" class="indexterm"/>
<span class="strong"><strong>Single Sign On</strong></span> (<span class="strong"><strong>SSO</strong></span>) feature of the Facebook iOS SDK that allows the user to sign in to your application using their Facebook identity.</p></div></div>
<div class="section" title="Downloading the Facebook iOS SDK"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec95"/>Downloading the Facebook iOS SDK</h1></div></div></div><p>In this recipe we will learn the steps involved to download the Facebook iOS SDK.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec341"/>Getting ready</h2></div></div></div><p>In order to proceed, we first need to launch our browser and download the Facebook iOS SDK package from the Facebook developer website.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec342"/>How to do it...</h2></div></div></div><p>To begin, follow these simple <a id="id930" class="indexterm"/>steps as outlined in the given steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Launch your browser and enter in <a class="ulink" href="http://developers.facebook.com/ios/">http://developers.facebook.com/ios/</a>.<div class="mediaobject"><img src="graphics/3349_09_01.jpg" alt="How to do it..."/></div></li><li class="listitem">Next, click on the <span class="strong"><strong>Download the SDK</strong></span> button to start downloading the Facebook SDK. Once <a id="id931" class="indexterm"/>downloaded, install the package. The default installation location is <code class="literal">~/Documents/FacebookSDK</code>.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec343"/>How it works...</h2></div></div></div><p>In this recipe, we looked at the necessary steps required to download the Facebook iOS SDK from the Facebook developer portal. Compared to earlier releases of the Facebook SDK, this SDK is now packaged as a framework and provides you with all of the functionality required to make your applications interact with the Facebook platform. Whenever developing applications with the Version 3.1 and above of the Facebook SDK, it requires Xcode 4.5 and above.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec344"/>There's more…</h2></div></div></div><p>The Facebook SDK framework contains all of the method objects and APIs that are required to enable you to interact with Facebook and send notification requests, or simply post messages to the current person's wall page using the Single Sign On feature of the Facebook iOS SDK.</p><p>This lets your users sign in to your app using their Facebook identity. With the initial release of the SDK, the <code class="literal">authorize</code> method always opened an inline dialog box containing <code class="literal">UIWebView</code> in which the authorization UI was shown to the user, and required users to enter their credentials separately for each app they authorized.</p><p>In the updated version of the SDK this has been changed and no longer requires users having to re-enter their credentials for every application on the device they want to authorize. Using the Facebook iOS SDK allows you to do the following:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Facebook iOS SDK types</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Authentication and <a id="id932" class="indexterm"/>authorization</p>
</td><td style="text-align: left" valign="top">
<p>Prompt users to log in to Facebook and grant permissions to your application.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Make API calls</p>
</td><td style="text-align: left" valign="top">
<p>This allows you to fetch user profile data, as well as any information related to the user's friends using JSON API calls.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Display dialog</p>
</td><td style="text-align: left" valign="top">
<p>This allows you to interact with the user via a <code class="literal">UIWebView</code> view. This is extremely useful for enabling interactions with Facebook, without requiring upfront permissions.</p>
</td></tr></tbody></table></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec345"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Registering your iOS applications with Facebook</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Registering your iOS applications with Facebook"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec96"/>Registering your iOS applications with Facebook</h1></div></div></div><p>In this recipe we will learn how <a id="id933" class="indexterm"/>
<a id="id934" class="indexterm"/>to register an iOS application so that it can be used with the Facebook platform.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec346"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe and before we can start integrating our application with the Facebook platform, we will need to register the application with Facebook's mobile website and provide some basic application information.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec347"/>How to do it...</h2></div></div></div><p>To begin, follow the simple steps as outlined in the given order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open your browser and enter in <a class="ulink" href="http://developers.facebook.com/apps">http://developers.facebook.com/apps</a>.<div class="mediaobject"><img src="graphics/3349_09_02.jpg" alt="How to do it..."/></div></li><li class="listitem">Next, either sign up for <a id="id935" class="indexterm"/><a id="id936" class="indexterm"/>Facebook if you are not a registered user, or enter in your Facebook account credentials and click on the <span class="strong"><strong>Log In</strong></span> button.</li><li class="listitem">Next, click on the <span class="strong"><strong>+Create New App</strong></span> button from the <span class="strong"><strong>Apps</strong></span> page.<div class="mediaobject"><img src="graphics/3349_09_03.jpg" alt="How to do it..."/></div></li><li class="listitem">Next, enter <code class="literal">Social Networking App</code> for the <span class="strong"><strong>App Name</strong></span> field.</li><li class="listitem">Click on the <span class="strong"><strong>Continue</strong></span> button to <a id="id937" class="indexterm"/><a id="id938" class="indexterm"/>proceed to the next step in the wizard. This will be used and displayed whenever you post or send a notification message to your friends.<div class="mediaobject"><img src="graphics/3349_09_04.jpg" alt="How to do it..."/></div></li><li class="listitem">Next, you will be prompted to <a id="id939" class="indexterm"/><a id="id940" class="indexterm"/>enter in the <span class="strong"><strong>Security Check</strong></span> words before you can proceed to the next step.<div class="mediaobject"><img src="graphics/3349_09_05.jpg" alt="How to do it..."/></div></li><li class="listitem">Enter in the words displayed on your screen and click on the <span class="strong"><strong>Submit</strong></span> button to continue. The words displayed will be different each time this screen is displayed.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note65"/>Note</h3><p>If you enter in the words incorrectly, you may end up with your account being blocked. If this is the case, you will need to contact Facebook directly to have this unlocked.</p></div></div><div class="mediaobject"><img src="graphics/3349_09_06.jpg" alt="How to do it..."/></div></li></ol></div><p>The above screenshot shows the final screen that allows you to make any final changes before you commit your changes. <a id="id941" class="indexterm"/>
<a id="id942" class="indexterm"/>Once you are satisfied with all changes, click on the <a id="id943" class="indexterm"/>
<span class="strong"><strong>Save Changes</strong></span> button.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note66"/>Note</h3><p>The <span class="strong"><strong>App ID</strong></span> is an important field that we will be using in our iOS application to communicate with Facebook, and is highlighted by an arrow in the previous screenshot.</p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec348"/>How it works...</h2></div></div></div><p>In this recipe, we looked at the steps required to register our application with Facebook's mobile development platform so that our application can communicate with this platform.</p><p>We looked at how to create and define a new application name that will be displayed whenever notification messages are sent or posted to your wall or friends. In the next recipe, we will take a look at how to <a id="id944" class="indexterm"/>
<a id="id945" class="indexterm"/>build the user interface for our social networking application.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec349"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Building a simple social networking application</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Building a simple social networking application"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec97"/>Building a simple social networking application</h1></div></div></div><p>In this recipe we will learn <a id="id946" class="indexterm"/>how to build the user interface for our social networking application project.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec350"/>Getting ready</h2></div></div></div><p>In this section, we will start by building the components that will comprise of the user interface for our application.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec351"/>How to do it…</h2></div></div></div><p>To begin, follow the simple steps as outlined in the given order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Launch <span class="strong"><strong>Xcode</strong></span> from the <code class="literal">/Xcode4/Applications</code> folder.</li><li class="listitem">Choose <span class="strong"><strong>Create a new Xcode project</strong></span>, or <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New Project</strong></span>.</li><li class="listitem">Select the <span class="strong"><strong>Single View Application</strong></span> from the list of available templates.</li><li class="listitem">Click on the <span class="strong"><strong>Next</strong></span> button to proceed to the next step in the wizard.</li><li class="listitem">Next, enter in <code class="literal">SocialNetworkApp</code> as the name for your project.</li><li class="listitem">Choose <span class="strong"><strong>iPhone</strong></span> from under the <span class="strong"><strong>Devices</strong></span> drop-down list.</li><li class="listitem">Ensure that the <span class="strong"><strong>Use Storyboards</strong></span> checkbox has not been selected.</li><li class="listitem">Ensure that the <span class="strong"><strong>Use Automatic Reference Counting</strong></span> and the <span class="strong"><strong>Include Unit Tests</strong></span> checkboxes have not been selected.</li><li class="listitem">Next, click on the <span class="strong"><strong>Next</strong></span> button to proceed to the next step in the wizard and specify the location where you would like to save your project.</li><li class="listitem">Then, click on the <span class="strong"><strong>Create</strong></span> button to continue and display the Xcode workspace.</li></ol></div><p>Now that we have created our <code class="literal">SocialNetworkApp</code> project, we can start building our user interface that will be responsible for allowing us to communicate with Facebook:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select the <code class="literal">ViewController.xib</code> files from the <span class="strong"><strong>Project Navigator</strong></span> Window.</li><li class="listitem">From the <span class="strong"><strong>Object Library</strong></span>, select and drag a <span class="strong"><strong>UIToolbar</strong></span> object, and add this to our view and select the <span class="strong"><strong>Item</strong></span> button located within our toolbar.</li><li class="listitem">From the <span class="strong"><strong>Attributes Inspector</strong></span> section, change the <span class="strong"><strong>Identifier</strong></span> property to <span class="strong"><strong>Custom</strong></span> and change the value of <span class="strong"><strong>Style</strong></span> to <span class="strong"><strong>Bordered</strong></span> and the value of <span class="strong"><strong>Title</strong></span> to <span class="strong"><strong>Sign In</strong></span>.</li><li class="listitem">Create an outlet for this <code class="literal">UIBarButtonItem</code>, and name it <code class="literal">loginButton</code>.</li><li class="listitem">Create the <code class="literal">action</code> method for the <span class="strong"><strong>Sign In</strong></span> button and name it <code class="literal">loginButton</code>.</li><li class="listitem">Add a <span class="strong"><strong>flexible space bar button item</strong></span> next to the <span class="strong"><strong>Sign In</strong></span> button.</li><li class="listitem">Add another <code class="literal">UIBarButtonItem</code> to the right of the flexible space bar button item and from the <span class="strong"><strong>Attributes Inspector</strong></span>, change the <span class="strong"><strong>Identifier</strong></span> property to <span class="strong"><strong>Action</strong></span>.</li><li class="listitem">From the <span class="strong"><strong>Object Library</strong></span>, drag a <span class="strong"><strong>UIImageView</strong></span> object onto the view.</li><li class="listitem">Resize the <code class="literal">UIImageView</code> control <a id="id947" class="indexterm"/>so that it can hold a passport size photo.</li><li class="listitem">Next, create the outlet for this <code class="literal">UIImageView</code>, and name it <code class="literal">imgPhoto</code>.</li><li class="listitem">From the <span class="strong"><strong>Object Library</strong></span>, drag a <span class="strong"><strong>UITextView</strong></span> object onto the view.</li><li class="listitem">Resize the <span class="strong"><strong>UITextView</strong></span> control so that it takes up the width of the View Controller.</li><li class="listitem">Next, create the outlet for this <code class="literal">UITextView</code>, and name it <code class="literal">userInfoDetails</code>.</li><li class="listitem">Save the <span class="strong"><strong>SocialNetworkApp</strong></span> by choosing <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Save</strong></span> from the menu bar.<div class="mediaobject"><img src="graphics/3349_09_07.jpg" alt="How to do it…"/></div></li></ol></div><p>If you have followed the steps correctly, <a id="id948" class="indexterm"/>the completed View Controller screen should look similar to the previous screenshot. Feel free to adjust your screen accordingly.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec352"/>How it works...</h2></div></div></div><p>In this recipe, we started by building our user interface for our <code class="literal">SocialNetworkApp</code> application that will enable us to log in and out of Facebook and post messages to our wall. In our next recipe, we will look <a id="id949" class="indexterm"/>at how to add the Facebook iOS SDK into our project, which allows us to communicate with the Facebook mobile development platform, and includes the necessary properties and methods that allows us to post messages to the current user's wall.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec353"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Adding the Facebook SDK and dependencies to your project</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Using Xcode to create an iOS project</em></span> recipe in <a class="link" href="ch01.html" title="Chapter 1. Getting and Installing the iOS SDK Development Tools">Chapter 1</a>, <span class="emphasis"><em>Getting and Installing the iOS SDK Development Tools</em></span></li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Creating outlets to Interface Builder objects</em></span> recipe in <a class="link" href="ch01.html" title="Chapter 1. Getting and Installing the iOS SDK Development Tools">Chapter 1</a>, <span class="emphasis"><em>Getting and Installing the iOS SDK Development Tools</em></span></li></ul></div></div></div>
<div class="section" title="Adding the Facebook SDK and dependencies to your project"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec98"/>Adding the Facebook SDK and dependencies to your project</h1></div></div></div><p>In this recipe, we will learn how to <a id="id950" class="indexterm"/>
<a id="id951" class="indexterm"/>
<a id="id952" class="indexterm"/>include the Facebook SDK and the framework dependencies as part of our <code class="literal">SocialNetworkingApp</code> project to enable us to communicate with the Facebook mobile platform.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec354"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe, ensure that our <code class="literal">SocialNetworkApp</code> project file is open.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec355"/>How to do it...</h2></div></div></div><p>To add the Facebook SDK and the required frameworks, follow the given simple steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">From the <span class="strong"><strong>Project Navigator</strong></span> window, select the <code class="literal">SocialNetworkApp</code> folder.</li><li class="listitem">Choose <span class="strong"><strong>Add Files to "SocialNetworkApp" …</strong></span> or Mac users can press <span class="emphasis"><em>Option</em></span> + <span class="emphasis"><em>Command</em></span> + <span class="emphasis"><em>A</em></span>.</li><li class="listitem">Next, drag the <code class="literal">FacebookSDK.framework</code> folder from the <code class="literal">Facebook SDK installation</code> folder into the <span class="strong"><strong>Frameworks</strong></span> section of your <span class="strong"><strong>Project Navigator</strong></span>.</li><li class="listitem">Then, choose <span class="strong"><strong>Create groups for any added folders</strong></span> and deselect <span class="strong"><strong>Copy Items into destination group's folder</strong></span> (if needed) to keep the reference to the SDK installation folder, rather than creating a copy.</li><li class="listitem">Next, add the Facebook SDK for iOS resource bundle by dragging the <code class="literal">FacebookSDKResources.bundle</code> file from the <code class="literal">FacebookSDK.framework/Resources</code> folder into the <span class="strong"><strong>Frameworks</strong></span> section of your <span class="strong"><strong>Project Navigator</strong></span>.</li><li class="listitem">Next, the SDK relies on three other frameworks (AdSupport, Accounts, and Social) to use the Facebook features built into iOS6. To add these, go to the <span class="strong"><strong>Linked Frameworks and Libraries</strong></span> section of the target's <span class="strong"><strong>Summary</strong></span> pane, and click on the <span class="strong"><strong>+</strong></span> button to add them.</li><li class="listitem">Next, we need to import the <a id="id953" class="indexterm"/><a id="id954" class="indexterm"/><a id="id955" class="indexterm"/>Facebook Dialog calls headers by dragging the <code class="literal">DeprecatedHeaders</code> folder from the <code class="literal">FacebookSDK.framework/Versions/A/DeprecatedHeaders</code> folder into the <span class="strong"><strong>Frameworks</strong></span> section of your <span class="strong"><strong>Project Navigator</strong></span>:<div class="mediaobject"><img src="graphics/3349_09_08.jpg" alt="How to do it..."/></div></li><li class="listitem">Then, we need to add the <span class="strong"><strong>–lsqlite3.0</strong></span> SQL library to the list of build dependencies in the <span class="strong"><strong>Build Settings</strong></span> pane:<div class="mediaobject"><img src="graphics/3349_09_08a.jpg" alt="How to do it..."/></div></li><li class="listitem">Once the changes have been made, your solution should contain the following files:<div class="mediaobject"><img src="graphics/3349_09_08b.jpg" alt="How to do it..."/></div></li><li class="listitem">Save your project by <a id="id956" class="indexterm"/><a id="id957" class="indexterm"/><a id="id958" class="indexterm"/>selecting <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Save</strong></span>, as we are done adding the Facebook SDK.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec356"/>How it works...</h2></div></div></div><p>In this recipe, we learned how to manually add the Facebook SDK components into our project using Xcode to provide us with the ability to communicate with the Facebook platform to post messages to the current user's wall, or to retrieve information associated with the user using both the SSO feature and the Facebook Graph API methods.</p><p>We learned about the new framework dependencies that are dependent upon the Facebook SDK when building projects under the iOS6 platform, as well as adding the SQLite SQL library to the list of build dependencies within our project build settings.</p><p>Finally, we learned how to import the Facebook Feed and Requests Dialogs methods to ensure backward compatibility of the Facebook SDK headers with the same methods used within Version 2.0 of the Facebook SDK.</p><p>In our next recipe, we will learn how to implement the SSO within our application to enable us to log in and out of <a id="id959" class="indexterm"/>
<a id="id960" class="indexterm"/>
<a id="id961" class="indexterm"/>Facebook, as well as positing message details to the current user's Facebook wall.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note67"/>Note</h3><p>For more information on the Facebook iOS SDK, please refer to the Facebook Developer Documentation, which can be found at <a class="ulink" href="http://developers.facebook.com/docs/guides/mobile">http://developers.facebook.com/docs/guides/mobile</a>
</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec357"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Implementing the Single Sign On (SSO) feature</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Implementing the Single Sign On (SSO) feature"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec99"/>Implementing the Single Sign On (SSO) feature</h1></div></div></div><p>In this recipe, we will learn how to <a id="id962" class="indexterm"/>implement the Single Sign On feature of the Facebook iOS SDK that will enable our application to communicate with Facebook.</p><p>The process of using SSO works by redirecting the user to the Facebook iOS application on their device, and presenting them with an authentication dialog box, showing only those permissions that your application has been configured to use.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec358"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe, ensure that our <code class="literal">SocialNetworkApp</code> project file is open.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec359"/>How to do it...</h2></div></div></div><p>To begin, follow the simple <a id="id963" class="indexterm"/>steps as outlined in the given order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">AppDelegate.hinterface</code> file from the <span class="strong"><strong>Project Navigator</strong></span>.</li><li class="listitem">Next, modify the interface file as shown by the highlighted code sections:<div class="informalexample"><pre class="programlisting">//  AppDelegate.h
//  SocialNetworkApp
//  Created by Steven F. Daniel on 11/12/12.
//  Copyright (c) 2012 GenieSoft Studios. All rights reserved.
#import &lt;UIKit/UIKit.h&gt;
<span class="strong"><strong>#import "FBConnect.h"</strong></span>

@class ViewController;

<span class="strong"><strong>@interface AppDelegate : NSObject &lt;UIApplicationDelegate, FBSessionDelegate, FBDialogDelegate&gt;</strong></span>
<span class="strong"><strong>{</strong></span>
<span class="strong"><strong>    Facebook *facebook;</strong></span>
<span class="strong"><strong>}</strong></span>

// Create the required class Setters and Getters
@property (strong, nonatomic) UIWindow       *window;
@property (strong, nonatomic) ViewController *viewController;
<span class="strong"><strong>@property (nonatomic, retain) Facebook  *facebook;</strong></span>

<span class="strong"><strong>-(void)fbDidLogin;</strong></span>
<span class="strong"><strong>-(void)fbDidLogout;</strong></span>
<span class="strong"><strong>-(void)fbSessionInvalidated;</strong></span>

@end</pre></div></li><li class="listitem">Next, open the <code class="literal">AppDelegate.m</code> <a id="id964" class="indexterm"/>implementation file from the <span class="strong"><strong>Project Navigator</strong></span>.</li><li class="listitem">Modify the implementation file as shown by the highlighted code sections:<div class="informalexample"><pre class="programlisting">//  AppDelegate.m
//  SocialNetworkApp
//  Created by Steven F. Daniel on 11/12/12.
//  Copyright (c) 2012 GenieSoft Studios. All rights reserved.

#import "AppDelegate.h"
#import "ViewController.h"

@implementation AppDelegate

@synthesize window = _window;
@synthesize viewController = _viewController;
<span class="strong"><strong>@synthesize facebook;</strong></span>
</pre></div></li><li class="listitem">Next, modify the <code class="literal">didFinishLaunchingWithOptions:</code> method as shown in the following code snippet:<div class="informalexample"><pre class="programlisting">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
self.window = [[[UIWindow alloc] initWithFrame:
[[UIScreen mainScreen] bounds]] autorelease];

// Override point for customization after application
// launch.
self.viewController = [[[ViewController alloc] initWithNibName:@"ViewController" bundle:nil] autorelease];
self.window.rootViewController = self.viewController;

// Do any additional setup after loading the view, 
// typically from a nib.
<span class="strong"><strong>self.facebook = [[Facebook alloc] </strong></span>
<span class="strong"><strong>initWithAppId:@"YOUR_APPID_HERE" </strong></span>
<span class="strong"><strong>andDelegate:self];</strong></span>
<span class="strong"><strong>// Check and retrieve authorization information</strong></span>
<span class="strong"><strong>    NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];</strong></span>
<span class="strong"><strong>    if ([defaults objectForKey:@"FBAccessTokenKey"] &amp;&amp; [defaults objectForKey:@"FBExpirationDateKey"]) {</strong></span>
<span class="strong"><strong>        self.facebook.accessToken = [defaults objectForKey:@"FBAccessTokenKey"];</strong></span>
<span class="strong"><strong>        self.facebook.expirationDate = [defaults objectForKey:@"FBExpirationDateKey"];</strong></span>
<span class="strong"><strong>    }</strong></span>
<span class="strong"><strong>        </strong></span>
<span class="strong"><strong>    // Check to ensure that we have a valid session object</strong></span>
<span class="strong"><strong>    if (![self.facebook isSessionValid]) {</strong></span>
<span class="strong"><strong>        [self.facebook authorize:nil];</strong></span>
<span class="strong"><strong>    }</strong></span>
<span class="strong"><strong>    </strong></span>
    [self.window makeKeyAndVisible];
    return YES;
}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note68"/>Note</h3><p>To ensure your application <a id="id965" class="indexterm"/>works with your own AppID, you will need to replace the <code class="literal">YOUR_APPID_HERE</code> string after the <code class="literal">initWithAppId:</code> with your own created Facebook AppID.</p></div></div></li><li class="listitem">Next, create the following code sections, as specified in the code snippets:<div class="informalexample"><pre class="programlisting">-(BOOL)application:(UIApplication *)application handleOpenURL:(NSURL *)url
{
    return [self.facebook handleOpenURL:url];
}

-(BOOL)application:(UIApplication *)application openURL:(NSURL *)urlsourceApplication:(NSString *)sourceApplication annotation:(id)annotation{
   return [self.facebook handleOpenURL:url];
}

-(void)fbDidLogin
{
    // Check and retrieve authorization information
    NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
    [defaults setObject:[self.facebook accessToken] forKey:@"FBAccessTokenKey"];
    [defaults setObject:[self.facebook expirationDate] forKey:@"FBExpirationDateKey"];
    [defaults synchronize];
}

- (void)fbDidLogout
{
    // Remove saved authorization information if it exists
    NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
    if ([defaults objectForKey:@"FBAccessTokenKey"]) {
        [defaults removeObjectForKey:@"FBAccessTokenKey"];
        [defaults removeObjectForKey:@"FBExpirationDateKey"];
        [defaults synchronize];
    }
    
    UIAlertView *alertView = [[UIAlertView alloc]
                              initWithTitle:@"FaceBookSampleApp"
                              message:@"Your session has logged out."
                              delegate:nil
                              cancelButtonTitle:@"OK"
                              otherButtonTitles:nil,
                              nil];
    [alertView show];
    [alertView release];
}
<span class="strong"><strong>   [alertView show];</strong></span>
<span class="strong"><strong>   [alertView release];</strong></span>
<span class="strong"><strong>}</strong></span>

#pragma mark Called when the session has expired.
- (void)fbSessionInvalidated {
    UIAlertView *alertView = [[UIAlertView alloc]
                              initWithTitle:@"FaceBookSampleApp"
                              message:@"Your session has expired."
                              delegate:nil
                              cancelButtonTitle:@"OK"
                              otherButtonTitles:nil,
                              nil];
    [alertView show];
    [alertView release];
    [self fbDidLogout];
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec360"/>How it works...</h2></div></div></div><p>In this recipe, we started by extending our class to include the <code class="literal">FBSessionDelegate</code> and <code class="literal">FBDIalogDelegate</code> class <a id="id966" class="indexterm"/>
<a id="id967" class="indexterm"/>protocols, as well as its methods. We then declared an instance variable called <code class="literal">facebook</code> that will enable us to access the <code class="literal">Facebook</code> class methods. Next, we added a property instance of the <code class="literal">Facebook</code> class to create the class getters and setters and then proceeded to synthesize our <code class="literal">facebook</code> variable that we defined within the <a id="id968" class="indexterm"/>
<code class="literal">AppDelegate.h</code> interface file. This is done so that we can make our implementation file aware of the <code class="literal">facebook</code> variable, so that we can access the object properties and methods. In our <a id="id969" class="indexterm"/>
<code class="literal">didFinishLaunchingWithOptions:</code> method, we initialize our <code class="literal">Facebook</code> object to invoke the SSO, by passing in the application AppID that we created when we registered our iOS mobile app, as well as the Graph API and Platform Dialogs from within our app. Once the object has been instantiated, we need to check for any previously saved access token information and <a id="id970" class="indexterm"/>then use this saved information to set up a valid session, by assigning the saved information to the Facebook access token and expiration date properties to ensure that your app does not redirect to the Facebook application. Invoke the authorization dialog box, if the application already has a valid <code class="literal">access_token</code>.</p><p>We proceed to check for a valid session and if it is not valid, we call the <code class="literal">authorize</code> method which will log the user in and prompt the user to authorize the application and then declare two methods that will be called by the iOS when the Facebook application redirects to the app during the SSO process. These methods provide the app with the user's credentials.</p><p>You will notice that we have declared two different methods that will be used to handle different versions of the iOS app. <code class="literal">The handleOpenURL:</code> method is for versions prior to Version 4.2, and the <code class="literal">openURL</code> one is for Versions 4.2 and greater. In our next step, we implement the Facebook <code class="literal">fbDidLogin:</code> method of <code class="literal">FBSessionDelegate</code>. After the SSO process has successfully signed in and the Facebook app redirects back to the calling application, we save the user's credentials using the <code class="literal">FBAccessTokenKey</code> and <code class="literal">FBExpirationDateKey</code> keys, and then save these into the user preferences <code class="literal">NSUserDefaults</code>.</p><p>We then proceed to implement the Facebook <code class="literal">fbDidLogout:</code> method of <code class="literal">FBSessionDelegate</code>. After the SSO process successfully signs out of the iOS app, the <code class="literal">callback</code> method gets <a id="id971" class="indexterm"/>called. We need to check to see if we have a successful access token key prior to removing the stored user's credentials, using the <code class="literal">FBAccessTokenKey</code> and <code class="literal">FBExpirationDateKey</code> keys.</p><p>We then remove those details from the user preferences using the <code class="literal">NSUserDefaults</code> object. Finally, we create an instance of the <code class="literal">UIAlertView</code> dialog box to notify the user that a successful logout has happened. In our previous sections, we implemented the Facebook <code class="literal">fbSessionInvalidated</code> method of <code class="literal">FBSessionDelegate</code>. When a request is made to post a new message to the current user's wall or to send notifications to your friends, the <code class="literal">fbSessionInvalidated</code> <a id="id972" class="indexterm"/>method is called to ensure that a valid session exists. This uses the <code class="literal">session</code> <a id="id973" class="indexterm"/>object, created by the SSO process when your application signed in. If the session state has expired, we declare an instance of the <code class="literal">UIAlertView</code> class to display a message to the user, before finally making a call to the <code class="literal">fbDidLogout</code> method to <a id="id974" class="indexterm"/>ensure that all of the required access tokens are removed cleanly.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec361"/>There's more…</h2></div></div></div><p>If a user is already signed into the Facebook iOS application on their device, he won't need to provide this again. The process of using SSO works by redirecting the users to the Facebook iOS application on their device, and presenting them with an authentication dialog box, showing only those permissions that your application has been configured to use. Once the user has allowed those permissions requested by your iOS app, they will be redirected back to your application with the appropriate access token.</p><p>When using the Facebook SSO process, certain things can behave slightly differently depending on what version of the Facebook iOS app has been installed on the user's iOS device.</p><p>The following table explains what happens when the Facebook SSO process is run under certain conditions:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Facebook SSO condition</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>iOS application is running with a version of iOS that supports multitasking and running Version 3.2.3, or greater of the Facebook iOS app.</p>
</td><td style="text-align: left" valign="top">
<p>The Facebook SDK will attempt to open the authorization dialog box within the Facebook app.</p>
<p>After the user grants or declines authorization, the user is redirected back to the calling application, passing back with it an authorization token, expiration, and any other parameters the Facebook <code class="literal">oAuth</code> authentication server may happen to return.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>iOS device running with a version of iOS that supports multitasking, and isn't running Version 3.2.3, or greater of the Facebook iOS app.</p>
</td><td style="text-align: left" valign="top">
<p>The Facebook SDK will open the authorization dialog box within Safari. After the user grants, or declines authorization, Safari will redirect the user back to the calling application.</p>
<p>This process is similar to the Facebook app authorization, and allows for multiple apps to share the same Facebook user <code class="literal">access_token</code> through the <code class="literal">Safari</code> cookie.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>If the iOS application is running a version of iOS that does not support multitasking.</p>
</td><td style="text-align: left" valign="top">
<p>The SDK will use the old mechanism of popping up an inline <code class="literal">UIWebView</code> web view control, prompting the user to log in and grant access.</p>
</td></tr></tbody></table></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note69"/>Note</h3><p>Facebook recommends that you should always ensure that your devices are running the latest version of the Facebook iOS app.</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec362"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Implementing the View Controller class</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Implementing the View Controller class"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec100"/>Implementing the View Controller class</h1></div></div></div><p>In this recipe, we will start to implement additional functionality to our <code class="literal">ViewController</code> class, as well as importing some very important header files and extend our class.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec363"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe, ensure that our <code class="literal">SocialNetworkApp</code> project file is open.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec364"/>How to do it...</h2></div></div></div><p>To begin, follow these simple <a id="id975" class="indexterm"/>steps as outlined in the given order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">ViewController.h</code> interface file from the <span class="strong"><strong>Project Navigator</strong></span>.</li><li class="listitem">Next, modify the interface file as shown by the highlighted code sections:<div class="informalexample"><pre class="programlisting">//  ViewController.h
//  SocialNetworkApp
//  Created by Steven F. Daniel on 11/12/12.
//  Copyright (c) 2012 GenieSoft Studios. All rights reserved.

#import  &lt;UIKit/UIKit.h&gt;
<span class="strong"><strong>#import "AppDelegate.h"</strong></span>

<span class="strong"><strong>@interface ViewController : UIViewController&lt;UIActionSheetDelegate, FBRequestDelegate&gt;</strong></span>
{
<span class="strong"><strong>AppDelegate *mainDelegate;</strong></span>
IBOutlet UIBarButtonItem  *loginButton;
IBOutlet UIBarButtonItem  *postMessage;
IBOutlet UIImageView      *imgPhoto;
IBOutlet UITextView       *userInfoDetails;
<span class="strong"><strong>        Facebook       *facebook;</strong></span>
}

// Create the required class Setters and Getters
@property (nonatomic, strong) UIBarButtonItem  *loginButton;
@property (nonatomic, strong) UIBarButtonItem  *postMessage;
@property (nonatomic, strong) UIImageView      *imgPhoto;
@property (nonatomic, strong) UITextView       *userInfoDetails;
<span class="strong"><strong>@property(nonatomic, retain) Facebook    *facebook;</strong></span>
<span class="strong"><strong>@property(nonatomic, retain) AppDelegate *mainDelegate;</strong></span>

// Declare our Instance methods
<span class="strong"><strong>-(void)SendNotificationRequest;</strong></span>
<span class="strong"><strong>-(void)PostMessagetoWall;</strong></span>
<span class="strong"><strong>-(void)getGraphAPIData;</strong></span>
<span class="strong"><strong>-(void)dialogDidComplete:(FBDialog *)dialog;</strong></span>
<span class="strong"><strong>-(void)request:(FBRequest *)request didLoad:(id)result;</strong></span>
<span class="strong"><strong>-(void)request:(FBRequest *)request didFailWithError:(NSError *)error;</strong></span>

@end</pre></div></li><li class="listitem">Next, open the <code class="literal">ViewController.m</code> implementation file from the <span class="strong"><strong>Project Navigator</strong></span> and modify the <a id="id976" class="indexterm"/>implementation file as shown by the highlighted code sections:<div class="informalexample"><pre class="programlisting">//  ViewController.m
//  SocialNetworkApp
//  Created by Steven F. Daniel on 11/12/12.
//  Copyright (c) 2012 GenieSoft Studios. All rights 
// reserved.

#import "ViewController.h"
<span class="strong"><strong>#import "FBConnect.h"</strong></span>

@interface ViewController ()
@end

@implementation ViewController

<span class="strong"><strong>@synthesize mainDelegate, loginButton, postMessage;</strong></span>
<span class="strong"><strong>@synthesize imgPhoto,userInfoDetails, facebook;</strong></span>

- (void)viewDidLoad{
  [super viewDidLoad];

<span class="strong"><strong> // Set up our delegate object</strong></span>
<span class="strong"><strong> self.mainDelegate = (AppDelegate *)[[UIApplication</strong></span>
<span class="strong"><strong> sharedApplication]delegate];</strong></span>
<span class="strong"><strong> self.facebook = mainDelegate.facebook;</strong></span>

<span class="strong"><strong> // Initialize our form fields</strong></span>
<span class="strong"><strong> userInfoDetails.text = @"";</strong></span>
}

<span class="strong"><strong>#pragma mark Handle when the login button is pressed.</strong></span>
<span class="strong"><strong>- (IBAction)loginButton:(id)sender{</strong></span>
<span class="strong"><strong>  if ([loginButton.title isEqualToString:@"Sign In"]) {</strong></span>
<span class="strong"><strong>  if (![self.facebook isSessionValid]) {</strong></span>
<span class="strong"><strong>     NSLog(@"facebook session");</strong></span>
<span class="strong"><strong>     NSArray *permissions = [[NSArray alloc] </strong></span>
<span class="strong"><strong>      initWithObjects:@"email",@"publish_actions", nil];</strong></span>
<span class="strong"><strong>     [self.facebook authorize:permissions];</strong></span>
<span class="strong"><strong>     [permissions release];</strong></span>
<span class="strong"><strong>    }</strong></span>
<span class="strong"><strong>  else {NSLog(@"session still valid");}</strong></span>
<span class="strong"><strong>  [loginButton setTitle:@"Sign Out"];</strong></span>
<span class="strong"><strong>  }</strong></span>
<span class="strong"><strong>  else if([loginButton.title isEqualToString:@"Sign </strong></span>
<span class="strong"><strong>Out"]) {</strong></span>
<span class="strong"><strong>    [loginButton setTitle:@"Sign In"];</strong></span>
<span class="strong"><strong>    [self.facebook logout:self.mainDelegate];</strong></span>
<span class="strong"><strong>  }</strong></span>
<span class="strong"><strong>}</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec365"/>How it works...</h2></div></div></div><p>In this recipe, we started by extending our class to include the <code class="literal">UIActionSheetDelegate</code> and <code class="literal">FBRequestDelegate</code> <a id="id977" class="indexterm"/>class protocols, as well as its methods. We then declared an instance variable called <code class="literal">facebook</code> that will enable us to access the <code class="literal">Facebook</code> class methods. Next, we added a property instance of the <code class="literal">Facebook</code> class to create the class getters and setters and then proceed to synthesize our <code class="literal">facebook</code> variable that we defined within the <code class="literal">AppDelegate.h</code> interface file.</p><p>Next, we import the interface file <a id="id978" class="indexterm"/>header information for our <code class="literal">FBConnect.h</code> interface file, so that we can access the request dialog class methods. Next, we declare an application delegate object <code class="literal">mainDelegate</code> that points to the properties and class methods within our <code class="literal">delegate</code> class. Next, we initialize our facebook object within our <code class="literal">ViewController</code> to use the same object instance as the one which we instantiated within our <code class="literal">delegate</code> class. Finally, we initialize our user info details using <code class="literal">UITextView</code> control.</p><p>Next, we create our <code class="literal">loginButton:</code> method, and check the status of the button. If the button reads <span class="strong"><strong>Sign In</strong></span>, we use the <code class="literal">isSessionValid</code> method of the <code class="literal">facebook</code> object to determine if we still have a valid connection to the <code class="literal">facebook</code> instance.</p><p>If it proves that our session has expired, we initialize and pass to our <code class="literal">authorize</code> method of the facebook class permissions to request for accessing the user's e-mail, and allow the iOS to publish to the <span class="strong"><strong>Open Graph API</strong></span> <a id="id979" class="indexterm"/>actions. Finally, we release the memory that has been allocated by our <code class="literal">permissions</code> object and then update the title of the button to read <span class="strong"><strong>Sign Out</strong></span>. If our button reads <span class="strong"><strong>Sign Out</strong></span> as determined by the <code class="literal">loginButton:</code> method, we update the title of the button to read <span class="strong"><strong>Sign In</strong></span> and then call the <code class="literal">logout</code> method of the <code class="literal">Facebook</code> class, and then pass in our <code class="literal">mainDelegate</code> object. When this method is called, it will call the <code class="literal">fbDidLogout</code> method of the <code class="literal">FBSessionDelegate</code> within our <code class="literal">AppDelegate</code> class to handle any post logout actions and releasing of objects as well as for notifying the user that a successful logout has taken place.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note70"/>Note</h3><p>When making a call to the <code class="literal">logout</code> <a id="id980" class="indexterm"/>method, your application's permissions will not be revoked; it will simply clear the value of your application's <code class="literal">access_token</code>. If a user who has previously logged out of your application decides to run it again, they will simply see a notification that they are logging back into your application, not a notification requesting for permissions. For more information on the Facebook protocol methods, refer to the following URL: <a class="ulink" href="http://developers.facebook.com/docs/reference/iossdk/#protocols">http://developers.facebook.com/docs/reference/iossdk/#protocols</a>
</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec366"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Requesting additional Facebook permissions</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Requesting additional Facebook permissions"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec101"/>Requesting additional Facebook permissions</h1></div></div></div><p>In this recipe, we will learn <a id="id981" class="indexterm"/>how to specify additional permissions to be used by our application.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec367"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe, we will learn how to implement additional permissions.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec368"/>How to do it...</h2></div></div></div><p>To begin, follow the simple steps as outlined in the given order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">AppDelegate.m</code> implementation file from the <span class="strong"><strong>Project Navigator</strong></span>.</li><li class="listitem">Next, modify the <code class="literal">didFinishLaunchingWithOptions:</code> method as shown in the following code snippet:<div class="informalexample"><pre class="programlisting">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
  self.window = [[[UIWindow alloc] initWithFrame:[[UIScreen 
  mainScreen] bounds]] autorelease];

  // Override point for customization after 
  // application launch.
 self.viewController = [[[ViewController alloc] 
 initWithNibName:@"ViewController" bundle:nil] autorelease];
 self.window.rootViewController = self.viewController;

 // Do any additional setup after loading the view, 
 // typically from a nib.
 self.facebook = [[Facebook alloc] 
 initWithAppId:@"YOUR_APPID_HERE" andDelegate:self];

 // Check and retrieve authorization information
 NSUserDefaults *defaults = [NSUserDefaults
 standardUserDefaults];
 if ([defaults objectForKey:@"FBAccessTokenKey"] &amp;&amp;
     [defaults objectForKey:@"FBExpirationDateKey"]) {
     self.facebook.accessToken = [defaults 
     objectForKey:@"FBAccessTokenKey"];
    self.facebook.expirationDate = [defaults 
    objectForKey:@"FBExpirationDateKey"];
  }
<span class="strong"><strong>  // Set up the permissions to use for this App</strong></span>
<span class="strong"><strong>  NSArray *permissions = [[NSArray alloc]</strong></span>
<span class="strong"><strong>  initWithObjects:</strong></span>
<span class="strong"><strong>              @"user_likes",</strong></span>
<span class="strong"><strong>              @"user_birthday",</strong></span>
<span class="strong"><strong>              @"user_interests",</strong></span>
<span class="strong"><strong>              @"read_stream",nil];</strong></span>

  // Check to ensure that we have a valid session object
  if (![self.facebook isSessionValid]) {
<span class="strong"><strong>      [self.facebook authorize:permissions];</strong></span>
  }

<span class="strong"><strong>  [permissions release];</strong></span>
  [self.window makeKeyAndVisible];
  return YES;
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec369"/>How it works...</h2></div></div></div><p>In this recipe, we begin by declaring an <code class="literal">NSArray</code> <a id="id982" class="indexterm"/>object variable permission that will be used to store each of our permissions that <a id="id983" class="indexterm"/>we want to request. We then pass this variable to our <code class="literal">authorize</code> method of the <code class="literal">facebook</code> object, before finally releasing the memory allocated by the object.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note71"/>Note</h3><p>For more information on the full list of available permissions that are made available to you, refer to the Facebook Permissions reference at the following URL: <a class="ulink" href="https://developers.facebook.com/docs/authentication/permissions/">https://developers.facebook.com/docs/authentication/permissions/</a>
</p></div></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec370"/>There's more…</h2></div></div></div><p>When using Facebook integration within your application, you can specify additional permissions to be used by your application. When you launch the application without specifying additional permissions, this will use the default permissions and will only get the ability to read only the user's basic information and this includes certain properties of the <code class="literal">User</code> object such as id, name, picture, gender, and their locale. If you want to read additional data or publish data back to Facebook, you will need to request these additional permissions.</p><p>These additional permissions fall into the following sections, as shown in the given table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Requested permissions</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Basic information (no permissions)</p>
</td><td style="text-align: left" valign="top">
<p>When a user authorizes your application and you don't specify additional permissions, your application will only have access to the user's basic information. This includes certain properties such as their id, name, gender, locale, and their profile picture.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>User and friend permissions</p>
</td><td style="text-align: left" valign="top">
<p>As a part of the authorization process, you can also request for additional access to your user's profile. You can access information such as their birthday, activities, checkins, and education history. The user must, however, authorize this at startup, in order to continue and authorize your application.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Extended <a id="id984" class="indexterm"/>permissions</p>
</td><td style="text-align: left" valign="top">
<p>If you are using the Enhanced Authorization Dialog, the extended permissions will be presented to the user. These types of permissions allow you to read your user's friend lists, read the user's mail inbox, access your user's friend requests, and create and modify events on the user's behalf.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Open graph permissions</p>
</td><td style="text-align: left" valign="top">
<p>These types of permissions allow your applications to publish actions to the Open Graph API and enable it to retrieve any actions that have been published by any other application.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Page permissions</p>
</td><td style="text-align: left" valign="top">
<p>These types of permissions allow you to retrieve <code class="literal">access_tokens</code> for pages and applications that the user administrates, and is only compatible with the Graph API.</p>
</td></tr></tbody></table></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec371"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Implementing the Single Sign On (SSO) feature</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Using the Graph API to read JSON data</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Using the Graph API to read JSON data"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec102"/>Using the Graph API to read JSON data</h1></div></div></div><p>In this recipe we will learn <a id="id985" class="indexterm"/>about the Graph API and the Facebook Query Language (FQL). The Graph API is the core of Facebook and represents a simple social graph pertaining to people and each of the connections they have, by representing each of the objects in the graph (for example, people, photos, events, and pages) and the connections between them (for example, friend relationships, shared content, and photo tags).</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec372"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe, we will learn how simple it is to access the Graph API by passing the Graph Path to the <code class="literal">request</code> method. This can be achieved by following the steps as outlined.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec373"/>How to do it...</h2></div></div></div><p>Within the <span class="strong"><strong>facebook DEVELOPERS</strong></span> website, you can access the <span class="strong"><strong>Graph API Explorer</strong></span> to learn more about what type of <a id="id986" class="indexterm"/>information is returned, and see a visual representation of the data schema that the <span class="strong"><strong>Facebook Query </strong></span>
<a id="id987" class="indexterm"/>
<span class="strong"><strong>Language</strong></span> (<span class="strong"><strong>FQL</strong></span>) produces.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to the <span class="strong"><strong>facebook DEVELOPERS</strong></span> website at the following address: <a class="ulink" href="http://developers.facebook.com/tools">http://developers.facebook.com/tools</a>.</li><li class="listitem">Next, from the <span class="strong"><strong>Tools</strong></span> section, click on the <span class="strong"><strong>Graph API Explorer</strong></span> link.<div class="mediaobject"><img src="graphics/3349_09_09.jpg" alt="How to do it..."/></div><p>This will display the <span class="strong"><strong>Graph API Explorer</strong></span> window and display an explanation of each of the data fields returned within the center view.</p></li><li class="listitem">Next, from the <span class="strong"><strong>Application</strong></span> section, select <span class="strong"><strong>Social Networking App</strong></span> from the drop-down menu.<div class="mediaobject"><img src="graphics/3349_09_10.jpg" alt="How to do it..."/></div></li><li class="listitem">Then, click on the <span class="strong"><strong>Submit</strong></span> button to retrieve all basic information for the current user ID.</li></ol></div><p>You have seen how easy it is to use the Graph API Explorer to retrieve a visual representation of the data for various <a id="id988" class="indexterm"/>types of information. Let's take a look at how we can access information about the currently logged in user.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file, located within the <code class="literal">SocialNetworkApp</code> folder.</li><li class="listitem">Next, create the following code sections, as specified in the code snippets:<div class="informalexample"><pre class="programlisting">#pragma mark - Facebook GraphAPI Method
-(void)getGraphAPIData {
  // Make a call using the Facebook Query Language to 
  // get the current user details.
  NSMutableDictionary *params = [NSMutableDictionary
  dictionaryWithObjectsAndKeys:
  @"SELECT quotes, uid, name, pic FROM user
  WHERE uid = me()", @"query",nil];

 [self.facebook requestWithMethodName:@"FQL.query"
  andParams:params
  andHttpMethod:@"POST"
  andDelegate:self];
}
#pragma markCalled when the Graph API call has completed.
-(void)request:(FBRequest *)request didLoad:(id)result
{
  if ([result isKindOfClass:[NSArray class]]) {
  result = [result objectAtIndex:0];
}
// This callback can be a result of getting the users
// basic information or getting the user's permissions.
if ([result objectForKey:@"name"]) {
  // Retrieve back the basic user information.
  NSString *concatString = [[NSString alloc] 
  initWithFormat:@"ID: %@\nName: %@\nQuotes: %@\n", 
  [result objectForKey:@"uid"],
  [result objectForKey:@"name"], 
  [result objectForKey:@"quotes"]];

  // Get the profile image
  UIImage *image = [UIImage imageWithData:[NSData
  dataWithContentsOfURL:[NSURL URLWithString:[result 
  objectForKey:@"pic"]]]];
  self.imgPhoto.image = image;
  self.userInfoDetails.text = concatString;
 }
}
#pragma markCalled when an error has occurred while 
#pragma mark retrieving GraphAPI details
-(void)request:(FBRequest *)request didFailWithError:(NSError *)error
{
  NSLog(@"An error occurred obtaining details: %@",error);
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec374"/>How it works...</h2></div></div></div><p>In this recipe, we start by declaring an <code class="literal">NSMutableDictionary</code> object variable <code class="literal">param</code> that will be used to pass an SQL query to the FQL object. This enables us to use an SQL style interface using the Graph <a id="id989" class="indexterm"/>API to query the data.</p><p>We then call the <a id="id990" class="indexterm"/>
<code class="literal">requestWithMethodName</code> method of the <code class="literal">facebook</code> object and set up <code class="literal">type</code> to be <code class="literal">FQL.query</code>, which tells the method that we are passing in a query string and to return the contents as a dictionary array object. When our <code class="literal">requestWithMethodName</code> method completes, it calls the <code class="literal">didLoad</code> method of the <code class="literal">request</code> method. This method parses the result using a JSON call.</p><p>Next, we check to see the type that has been returned. If multiple results are returned, an <code class="literal">NSArray</code> object is returned, otherwise an <a id="id991" class="indexterm"/>
<code class="literal">NSDictionary</code> object is returned for single result values. We then set our result to point to the first position within the array, and then retrieve each of the fields for the <code class="literal">uid</code>, <code class="literal">name</code>, and <code class="literal">quotes</code>. We then declare a <code class="literal">UIImage</code> variable image and then typecast the profile picture to be of the type <code class="literal">UIImage</code>, before assigning this to our <code class="literal">imgPhoto</code> control on our form, as well as display the relevant profile details. Finally, if any JSON parsing <a id="id992" class="indexterm"/>errors are determined when our <a id="id993" class="indexterm"/>
<code class="literal">requestWithMethodName</code> method completes, the <code class="literal">didFailWithError</code> <a id="id994" class="indexterm"/>method is called. Any error information is contained within the <code class="literal">NSError</code> variable error object.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note72"/>Note</h3><p>For more information on the Graph API and FQL Query language, please refer to the Facebook API and FQL reference material at the following locations: <a class="ulink" href="https://developers.facebook.com/docs/reference/api/">https://developers.facebook.com/docs/reference/api/</a> and <a class="ulink" href="https://developers.facebook.com/docs/reference/fql/">https://developers.facebook.com/docs/reference/fql/</a>
</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec375"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Integrating with the Facebook social channels</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Integrating with the Facebook social channels"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec103"/>Integrating with the Facebook social channels</h1></div></div></div><p>In this recipe we will learn how to <a id="id995" class="indexterm"/>
<a id="id996" class="indexterm"/>delete an item from a table view, as well our Core Data model.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec376"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe, we will learn how to delete a row from our table view, and permanently remove this from our Core Data database.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec377"/>How to do it...</h2></div></div></div><p>To begin, follow the simple steps as outlined in the given order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file, located within the <code class="literal">SocialNetworkApp</code> folder.</li><li class="listitem">Next, create the following code sections, as specified in the code snippets:<div class="informalexample"><pre class="programlisting">#pragma markSend a notification request to a group of friends
- (void)sendNotificationRequest{
  NSMutableDictionary *params =
  [NSMutableDictionary dictionaryWithObjectsAndKeys:
  @"invites you to check out some great stuff.", @"message",
  @"Check this out", @"notification_text",nil];

// Display the Facebook Request Notifications DialogBox
[self.facebook dialog:@"apprequests" 
  andParams:params andDelegate:self.mainDelegate];
}
#pragma markFBDialogDelegate
- (void)dialogDidComplete:(FBDialog *)dialog {
  NSLog(@"dialog completed successfully");
}
#pragma markPost a message to the current user's Wall.
- (void)postMessagetoWall{
  NSMutableDictionary *params =
  [NSMutableDictionary dictionaryWithObjectsAndKeys:
  @"Testing FacebookSampleApp Feed Dialog", @"name",
  @"Using Feed Dialogs within iOS are great.", @"caption",
  @"Click to check out my BlockHeadz game on the AppStore", 
  @"description",
  @"http://itunes.apple.com/app/blockheadz/
  id386884355?mt=8#", @"link",
  @"http://geniesoftstudios.com/blog/wp-
  content/uploads/2011/03/blockhead.png",@"picture",nil];

  // Display the Facebook feed dialog with our array.
  [self.facebook dialog:@"feed" andParams:params
  andDelegate:self.mainDelegate];
} 
#pragma mark called when user presses the Post Message Button
- (IBAction)postMessage:(id)sender {
	
  // Define an instance of our action sheet
  UIActionSheet *actionSheet;

  // Initialize our action sheet with the 
  // differen't mapping types.
  actionSheet = [[UIActionSheet alloc]
  initWithTitle:@"Choose from the list below"
  delegate:self
  cancelButtonTitle:@"Cancel"
  destructiveButtonTitle:@"Close"
  otherButtonTitles:@"Send Notification",@"Submit new post",
  @"Obtain User Details",nil];

  // Set our Action Sheet style and then 
  // display it to the user.
  actionSheet.actionSheetStyle = UIBarStyleBlackTranslucent;
  [actionSheet showInView:self.view];
}
// Delegate that handles the chosen action sheet options
-(void)actionSheet:(UIActionSheet *)actionSheetclickedButtonAtIndex:(NSInteger)buttonIndex{

 // Determine the chosen item
 switch (buttonIndex) {
  case 1:  [self sendNotificationRequest]; break;
  case 2:  [self postMessagetoWall];       break;
  case 3:  [self getGraphAPIData];         break;
  default: break;  // Catch the Close button and exit.
 }
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec378"/>How it works...</h2></div></div></div><p>In this recipe, we start by declaring an <a id="id997" class="indexterm"/>
<code class="literal">NSMutableDictionary</code> object variable <code class="literal">params</code> that will be used to pass the message and the notification text, using the <code class="literal">@message</code> and <code class="literal">@notification_text</code> parameters. We then use the <code class="literal">dialog</code> method of our <code class="literal">facebook</code> object, and tell the dialog that we want to use the <code class="literal">apprequests</code> dialog. Next, we declare the method called <code class="literal">dialogDidComplete</code>, which gets called if the <code class="literal">requests</code> dialog gets successfully displayed to the user. In the <code class="literal">postMessagetoWall:</code> method, we declare an <code class="literal">NSMutableDictionary</code> object variable <code class="literal">params</code> that will be used to pass the message and the notification text, using the <code class="literal">@name</code>, <code class="literal">@caption</code>, <code class="literal">@description</code>, <code class="literal">@link</code>, and <code class="literal">@picture</code> properties. These define what <a id="id998" class="indexterm"/>
<a id="id999" class="indexterm"/>information is displayed when posting the messageto the user's wall. Next, we use the <code class="literal">dialog</code> method of our <code class="literal">facebook</code> object, and tell the dialog that we want to use the <code class="literal">feed</code> dialog, since we are posting details to the wall.</p><p>Next, in our <code class="literal">postMessage:</code> method, we declare and instantiate an <code class="literal">actionsheet</code> object that is based on the <code class="literal">UIActionSheet</code> class, and then initialize our action sheet to display the different types of actions we want to perform, to have displayed as the list of options to choose from. Next, we proceed to set the style for our action sheet using the <code class="literal">actionSheetStyle</code> property of the <code class="literal">UIActionSheet</code> class, and then display the action sheet into the current view using the <code class="literal">showInView:self.view</code> method.</p><p>In our next part, we define a delegate method to determine the button that was pressed from the action sheet and used the <code class="literal">clickedButtonAtIndex</code> method of the <code class="literal">actionSheet</code> property. We then check the value of the <code class="literal">buttonIndex</code> variable to determine the index of the button that was pressed.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec379"/>There's more…</h2></div></div></div><p>The Facebook iOS SDK provides you with an easy way of making your applications integrate with the Facebook social <a id="id1000" class="indexterm"/>
<a id="id1001" class="indexterm"/>channels. Using these social channels allows your users to submit posts to their wall, or send notification requests to their friends.</p><p>The iOS SDK provides you with a method to integrate through the social channels using the Facebook platform dialogs. The following table lists the dialogs that are currently supported by Facebook:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Social channel dialogs</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Feed <a id="id1002" class="indexterm"/>dialog</p>
</td><td style="text-align: left" valign="top">
<p>This dialog is used for publishing posts to a user's news feed.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Requests <a id="id1003" class="indexterm"/>dialog</p>
</td><td style="text-align: left" valign="top">
<p>This type of dialog allows you to send a request to one or more of your friends.</p>
</td></tr></tbody></table></div><p>When using Facebook requests, these social channel dialogs provide you with a great way of allowing users to invite their friends to your iOS application or even accept gifts from their friends.</p><p>Requests are sent using the <code class="literal">Request</code> dialog, and if the user's iOS device supports <code class="literal">push</code> notifications, they will receive a push notification via the Facebook iOS application whenever a notification request is sent.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec380"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>How to handle Facebook errors in your application</em></span> recipe</li></ul></div></div></div>
<div class="section" title="Handling Facebook errors within your application"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec104"/>Handling Facebook errors within your application</h1></div></div></div><p>In this recipe, we will learn how to handle <a id="id1004" class="indexterm"/>
<a id="id1005" class="indexterm"/>Facebook errors within our application.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec381"/>Getting ready</h2></div></div></div><p>Following on from our previous recipe, handling errors within your application when using the Facebook SDK is extremely easy. Should any errors occur within your iOS application, the <code class="literal">FBRequestDelegate</code> and the <code class="literal">FBDialogDelegateprotocols</code> will immediately handle them.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec382"/>How to do it...</h2></div></div></div><p>To begin, follow the simple steps as <a id="id1006" class="indexterm"/>
<a id="id1007" class="indexterm"/>outlined in the given order:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file from the <span class="strong"><strong>Project Navigator</strong></span>.</li><li class="listitem">Next, create the following code sections, as specified in the following code snippets:<div class="informalexample"><pre class="programlisting"># pragma mark method is called when an error has occurred 
# while pragma mark retrieving GraphAPI details.
-(void)request:(FBRequest *)request didFailWithError:(NSError *)error{
  NSLog(@"An error occurred obtaining details: %@",error);
}

- (void)dialog:(FBDialog*)dialog didFailWithError:(NSError *)error{
  NSLog(@"An error occurred obtaining details: %@",error);
}</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec383"/>How it works...</h2></div></div></div><p>In this recipe, we start by creating the <a id="id1008" class="indexterm"/>
<code class="literal">request::(FBRequest *)request:didFailWithError:</code>, which gets called upon whenever an error during the requesting of information using the Graph API occurs. Any errors that occur will be captured and returned in the <code class="literal">error</code> object.</p><p>The <code class="literal">dialog:didFailWithError</code> <a id="id1009" class="indexterm"/>method is invoked if there is an error during the dialog process. Any errors that occur will be captured and returned in the <code class="literal">error</code> object.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note73"/>Note</h3><p>For more information on how to handle errors when using the Facebook iOS SDK, you can refer to the Facebook iOS Reference documentation at the following URL: <a class="ulink" href="https://developers.facebook.com/docs/mobile/ios/build/#errors">https://developers.facebook.com/docs/mobile/ios/build/#errors</a>
</p></div></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec384"/>There's more…</h2></div></div></div><p>We just have a few more things to implement before we have a complete working application. We will need to make some changes to our application's property list to enable SSO support when the application is run.</p><p>This can be achieved by following the given, simple steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select the <code class="literal">SocialNetworkApp-info.plist</code> file from within <span class="strong"><strong>Project Navigator</strong></span>.</li><li class="listitem">Next, right-click within the center of the panel, then select <span class="strong"><strong>Add Row</strong></span> from the pop up list.</li><li class="listitem">Add a new <a id="id1010" class="indexterm"/><a id="id1011" class="indexterm"/>entry called <code class="literal">URL Types</code>, and set its type to be <span class="strong"><strong>Array</strong></span>.</li><li class="listitem">Right-click and select <span class="strong"><strong>Add Row</strong></span> inside the <span class="strong"><strong>URL</strong></span> types.</li><li class="listitem">Then, create a new item called <code class="literal">Item 0</code>, and set its type to be <span class="strong"><strong>Dictionary</strong></span>.</li><li class="listitem">Next, create a new entry called <code class="literal">URL Schemes</code>, and set its type to be <span class="strong"><strong>Array</strong></span>.</li><li class="listitem">Then, create a new item called <code class="literal">Item 0</code>, and set its type to be <span class="strong"><strong>String</strong></span>.</li><li class="listitem">Finally, using the Facebook AppID value when we registered our mobile application, enter this in for the <span class="strong"><strong>Value</strong></span> field. You must prefix this with <code class="literal">fb</code> followed by your App ID for this to work correctly.<div class="mediaobject"><img src="graphics/3349_09_11.jpg" alt="There's more…"/></div><p>As you can see from the preceding screenshot, we have modified our <code class="literal">.plist</code> file so that it can support SSO. We specifically created and registered two URL variables: <code class="literal">URL Types</code> and <code class="literal">URL Schemes</code>, so that it can uniquely identify your application with iOS.</p></li><li class="listitem">Next, build and run the application by choosing <span class="strong"><strong>Product</strong></span> | <span class="strong"><strong>Run from the Product</strong></span> menu, or Mac users can alternatively press <span class="emphasis"><em>Command</em></span>+ <span class="emphasis"><em>R</em></span>.</li></ol></div><p>The following screenshot shows the <a id="id1012" class="indexterm"/>
<a id="id1013" class="indexterm"/>application running on the iOS device:</p><div class="mediaobject"><img src="graphics/3349_09_12.jpg" alt="There's more…"/></div><p>From the preceding screenshot, you can see that when we first load our social networking application, we receive the authorization dialog box with the permissions that we have requested. </p><p>Once the user has pressed on the <span class="strong"><strong>Log In</strong></span> button, the dialog box will disappear, and our iOS application will be displayed (as shown in the second part of the screenshot).</p><p>We then press the <span class="strong"><strong>Action</strong></span> button and select the <span class="strong"><strong>Submit new post</strong></span> button to display the posted new message to our wall, which is shown in the final screenshot.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec385"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Integrating with the Facebook social channels</em></span> recipe</li><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Implementing the Single Sign On (SSO) feature</em></span> recipe</li></ul></div></div></div></body></html>