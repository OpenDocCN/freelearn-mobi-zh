<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Auto Layout 2.0</h1></div></div></div><p>In this chapter, we will create our project and start building our application, <strong>Food and Me</strong>, starting with the custom menu view. First, we will create the project itself in Xcode 5. Next, we will create our storyboard. This consists of adding all the required elements and using the new Auto Layout to add constraints to our views. This is where we will dive directly into how Auto Layout works and how you will continue using Auto Layout for your future projects. Lastly, we will hook everything up to our code and set up our navigation. On completing this chapter, we will have a functional menu view complete with a bare navigation controller.</p><div><div><div><div><h1 class="title"><a id="ch03lvl1sec25"/>Why you should use Auto Layout</h1></div></div></div><p>Prior to Auto Layout, building applications to dynamically support multiple screen sizes and orientations required large amounts of work. Auto-resizing masks, springs, and struts are all examples of the tools<a id="id51" class="indexterm"/> that developers would commonly struggle to use. These tools did not always produce the correct result, so the typical next best action was to detect screen sizes in code and adjust the layout accordingly. When working on an application with many views and layouts, this can become frustrating.</p><p>With iOS 6, Apple introduced a new feature called Auto Layout. The premise was pretty straightforward: allow developers to define constraints on all visual elements in a storyboard in order to control the layout and flow of an application. Unfortunately, Auto Layout caused many headaches.</p><p>The main issue was related to the fact that Auto Layout required every object to have proper constraints attached to it. If you failed to provide a single constraint, Xcode would generate it automatically, sometimes overriding some of your currently set constraints. This would commonly cause many layout issues at runtime, resulting in a poor user experience.</p><p>With iOS 7, Apple has completely revamped Auto Layout, making it much easier to provide layout constraints with simple tools and giving developers more control over each constraint.</p><p>Properly using Auto Layout will drastically reduce the time spent on building dynamic layouts. This is accomplished by replacing complex and cumbersome code with easily defined constraints created <a id="id52" class="indexterm"/>in our storyboard. Auto Layout does not provide a solution for everything, so it is important to decide when to use code versus when to use Auto Layout.</p><p>You can download all of the assets, including the completed project, by visiting the project's downloadable content and downloading the files to your computer. Let's get started!</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Creating our project</h1></div></div></div><p>We are going to use Auto Layout to set up constraints for our main menu of the <strong>Food and Me</strong> app. We will not be using Auto Layout for the entire application for the sake of simplicity, but we will be covering all of the necessary elements to learn how to use the new Auto Layout.</p><p>First, let's create a new project<a id="id53" class="indexterm"/>. Open Xcode and select <strong>Create a new Xcode project</strong> on the welcome screen (or navigate to <strong>File</strong> | <strong>New</strong> | <strong>Project</strong> from the menu bar if the welcome screen does not appear). Select <strong>Single View Application</strong> and then click on <strong>Next</strong>.</p><p>Fill in the template options as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Product Name</strong>: <code class="literal">Food and Me</code></li><li class="listitem" style="list-style-type: disc"><strong>Organization Name</strong>: Enter the name of your organization or company</li><li class="listitem" style="list-style-type: disc"><strong>Company Identifier</strong>: Input your desired identifier that will be used on the developer portal, using reverse domain notation</li><li class="listitem" style="list-style-type: disc"><strong>Class Prefix</strong>: Leave this option empty</li><li class="listitem" style="list-style-type: disc"><strong>Devices</strong>: <strong>iPhone</strong></li></ul></div><p>Xcode creates a standard project for us, including the app delegate, a single view controller, a storyboard file, and an asset catalog for our launch image and icon. First, let's rename <code class="literal">ViewController.h</code> and <code class="literal">ViewController.m</code> to something more descriptive. Select <code class="literal">ViewController.h</code> in the navigator to show this file in the editor. Right-click on the <code class="literal">ViewController</code> text found immediately after <code class="literal">@interface</code>, and then navigate to <strong>Refactor</strong> | <strong>Rename...</strong>. It is possible for this refactor to sometimes skip renaming filenames in storyboards, so it is always a good practice to double-check this. Using snapshots and/or source control is another great way to reduce risk.</p><p>We will be creating the menu view in this file, so let's rename it <code class="literal">MenuViewController</code>. Type this in and make sure <strong>Rename related files</strong> is checked, and then click on <strong>Preview</strong>. A new window will appear giving you a preview of what files will be changed and where. You should see a header file and an implementation file in the preview as well as the storyboard (Xcode is smart enough to update every related project file). After clicking on the <strong>Save</strong> button, a prompt will appear asking if you would like to enable snapshots. This is similar to the <strong>Source Control</strong> menu and is completely optional.</p><p>Lastly, we need to add our<a id="id54" class="indexterm"/> image files to the provided Asset Catalog. Open the <code class="literal">Food and Me</code> folder that we downloaded earlier. You will see another folder titled <code class="literal">Final Image Files</code>. If you open this folder, you will see all the image files (both regular size and <em>2x</em> retina size) used for our project. Switch to your Xcode project and select <code class="literal">Images.xcassets</code>. Drag-and-drop every single image in the <code class="literal">Final Images Files</code> folder onto the box that contains the <code class="literal">AppIcon</code> and <code class="literal">LaunchImage</code> set. A new image set will be created for each <em>2x</em> and regular size image pair.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec27"/>Starting our storyboard</h1></div></div></div><p>Now that all of our files and images are added,<a id="id55" class="indexterm"/> we can start building our storyboard and apply Auto Layout constraints. Open <code class="literal">Main.storyboard</code> and we should see an empty view controller assigned to our <a id="id56" class="indexterm"/>
<code class="literal">MenuViewController</code> class.</p><p>Our menu will be made up of four separate components. Let's start by adding the first three to our storyboard file (the fourth will be created programmatically). Open the Xcode <strong>Utilities</strong> pane (if it is not already open) and select the object library at the bottom of the view.</p><p>First, drag one <code class="literal">UIImageView</code> class<a id="id57" class="indexterm"/> onto our <code class="literal">MenuViewController</code> making sure it is sized to fit the entire view. Next, drag two <code class="literal">UIButton</code>s on top of the <code class="literal">UIImageView</code> without worrying about their position. In our <strong>Utilities</strong> pane, select the <strong>Attributes Inspector</strong>, and then select one of the two buttons. Erase the <strong>Default Title</strong> option so that it is blank. Next, click on the drop-down menu for <strong>Image</strong> and select <code class="literal">foodButton</code> as our image. Xcode will automatically resize <code class="literal">UIButton</code> to the dimensions of our button image. Repeat this process for the remaining <code class="literal">UIButton</code>, except this time select <code class="literal">addButton</code> for the image property in the <strong>Attributes Inspector</strong>.</p><p>Now reposition the buttons at the bottom of the screen, evenly spaced apart from one another. The exact position is not important, so adjust the position based on personal preference. The final view of the storyboard should now look similar to the following screenshot:</p><div><img src="img/0319OT_03_01.jpg" alt="Starting our storyboard"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec28"/>Setting up button actions</h1></div></div></div><p>Our final step before applying <a id="id58" class="indexterm"/>our Auto Layout constraints is to connect our buttons to the class, using an <code class="literal">IBAction</code> for each button. While <code class="literal">MenuViewController</code> is selected, open the assistant editor from the toolbar and make sure you select the header file (<code class="literal">MenuViewController.h</code>).</p><p>While holding down the <em>control</em> key on your keyboard, click on and drag the <strong>My Foods</strong> button into the header file. Position your mouse between <code class="literal">@interface</code> and <code class="literal">@end</code> and release the mouse once you see a small popup that says <strong>Inset Outlet, Action, or Outlet Collection</strong>. In the new view that pops up, select <strong>Action</strong> from the <strong>Connection</strong> drop-down menu, and name this action <code class="literal">myFoodsPressed</code>. Lastly, select the <strong>Type</strong> drop-down option, and select <code class="literal">UIButton</code>. Repeat this process for <strong>Add New</strong> with an action name <code class="literal">addNewPressed</code>.</p><p>Your header file should now look like the following code snippet:</p><div><pre class="programlisting">#import &lt;UIKit/UIKit.h&gt;

@interface MenuViewController : UIViewController

- (IBAction)myFoodsPressed:(UIButton *)sender;
- (IBAction)addNewPressed:(UIButton *)sender;


@end</pre></div><p>Now that our view is populated<a id="id59" class="indexterm"/> and all actions have been created, we can get started with Auto Layout.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec29"/>Using Auto Layout</h1></div></div></div><p>Simply put, Auto Layout is a set of instructions given to each view related to the size and position in its superview or the nearest <a id="id60" class="indexterm"/>neighboring views. Two very common uses for Auto Layout is to make sure your views know what to do when an application runs on a 3.5-inch screen versus a 4-inch screen versus an iPad screen or when the device changes orientation. We want our application to support both screen sizes, so we will be focusing on this when adding our constraints.</p><p>Xcode provides multiple ways to apply your constraints, and each constraint also has its own properties that can be individually manipulated. With all of these options, I prefer to set up my Xcode environment to fully embrace all Auto Layout options.</p><p>Be sure that your <strong>Utilities</strong> pane is open. This will allow you to manually change your constraints' properties while working on your layouts. In the bottom-left corner of the storyboard view, you will see a button with an arrow pointing towards the right. This button will open the document outline view. This pane allows you to have a bird's-eye view of all view controllers and their subviews, including all constraints applied to each view. Open this view and your Xcode view should now look similar to the following screenshot:</p><div><img src="img/0319OT_03_02.jpg" alt="Using Auto Layout"/></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec30"/>Applying constraints</h1></div></div></div><p>Our<a id="id61" class="indexterm"/> menu view features two buttons to navigate to separate areas of the application. We want the buttons to always be in alignment with one another, so let's add some constraints to our buttons to make that happen.</p><p>One way to add a<a id="id62" class="indexterm"/> constraint between two objects is the control drag from one object to the other. Hold down the <em>control</em> key on your keyboard and then click-and-drag from the <strong>Add New</strong> button to the <strong>My Foods</strong> button. A new pop up will show these multiple options to add constraints. Each of these items can be selected and will provide the respective constraints between the two objects. Holding down the <em>shift</em> key will allow you to select more than one option at a time.</p><p>From the menu, select <strong>Horizontal Spacing</strong>. You will notice an orange outline appear around the <strong>Add New</strong> button, and a horizontal I-shaped line will appear between the two buttons, as shown in the following screenshot:</p><div><img src="img/0319OT_03_03.jpg" alt="Applying constraints"/></div><p>In order for Auto Layout to<a id="id63" class="indexterm"/> properly calculate the position of our views, it must have a complete set of constraints. All constraints will be highlighted in orange until a complete set of constraints is provided. Currently, we have only one constraint between the two buttons, which tells Xcode that these two views need to always remain an equal distance apart.</p><p>Let's add some more constraints. Each button should also remain vertically aligned, so let's add that constraint. This time, however, hold down the <em>command</em> key and select both buttons. With both items selected, Xcode 5 knows that any constraints provided will be applied to these two views. On the bottom-right corner of the storyboard view, you will notice a group of buttons as shown in the following screenshot:</p><div><img src="img/0319OT_03_04.jpg" alt="Applying constraints"/></div><p>These buttons provide quick access to all Auto Layout options. With both buttons still selected, click on the second button in the group of four buttons as shown in the previous screenshot. A new pop up will appear (see the following image) with a complete list of options and properties to set/edit. You may have recognize some of these properties and constraints from the previous menu displayed when we used control dragging from one button to another.</p><p>We want to focus on<a id="id64" class="indexterm"/> alignment, which can be found at the bottom of the pop-up view. Check the box next to <strong>Alignment</strong>, and from the drop-down menu select <strong>Top Edges</strong>. Now click on <strong>Add Constraint</strong> to apply it to our button views. A new line will appear above both the buttons to indicate that both will always be top aligned to one another.</p><p>Our constraints will still appear orange, which means we still need to add more constraints for Xcode to make proper calculations. Xcode has detected this as well and provides a really great tool that provides suggestions based on what is required. In the document outline view to the left, a small red circle with an arrow has appeared next to <strong>Menu View Controller Scene</strong>. Clicking on this arrow will push a new view that lists all of the missing constraints and warnings.</p><div><img src="img/0319OT_03_05.jpg" alt="Applying constraints"/></div><p>Our warnings are pointing to two very specific issues related to the X position and the Y position. We need to add constraints that will tell Xcode how to lay out the buttons' X and Y positions, so let's do that now.</p><p>Select just the <strong>Add New</strong> button. Our application has a pretty simple layout, and it is safe to say that we would prefer our buttons to keep an equal distance from the bottom of the screen regardless of size, so let's add a <a id="id65" class="indexterm"/>constraint that does just that. While keeping the button selected, navigate your mouse to the <strong>Editor</strong> menu option at the top of the screen, and select <strong>Pin</strong> | <strong>Leading Space To Superview</strong>. A new I-shaped bar appears between the edge of the view and the <strong>Add New</strong> button. This will make sure that an equal distance is kept between the button and the main view.</p><p>Now that we have taken care of the X position, let's do the same for the Y position. Select <strong>Editor</strong> | <strong>Pin</strong> | <strong>Bottom Space To Superview</strong>. A new bar appears from the bottom of the button to the bottom of the screen. This will make sure there is an equal distance between the button and the bottom of the screen.</p><p>With this new constraint, all of our constraints have now turned blue, which means Xcode has all the information it needs to calculate the positions of our views! You may be wondering how this is the case, when we have not added these superview constraints to the <strong>My Foods</strong> button.</p><p>The answer is that we don't need to. The first couple of constraints we added actually take care of this for us. Both buttons will always stay top aligned, which will take care of the Y position of the other button. Additionally, we set the horizontal spacing between the buttons, which will automatically take care of the other button's X position. The following image illustrates how this is possible:</p><div><img src="img/0319OT_03_06.jpg" alt="Applying constraints"/></div><p>Now that our constraints are set up, let's set the background image. Select the image view we added earlier, and in the <strong>Attributes Inspector</strong>, set the image to Background. Now go ahead and run the application<a id="id66" class="indexterm"/> first on the 4-inch iPhone and then on the 3.5-inch iPhone. The buttons at the bottom of our screen will automatically position themselves based on our constraints, and we didn't have to write a single line of code to do so!</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec31"/>Resolving Auto Layout issues</h1></div></div></div><p>After seeing our application<a id="id67" class="indexterm"/> running on an iPhone, it may be in our best interest to move the buttons down just a bit for a more balanced layout. Return to Xcode, and select both buttons by holding down the <em>command</em> key and clicking on each. Move them down a few pixels based on preference.</p><p>You will notice that suddenly there are two dashed red lines surrounding our buttons. Xcode does not automatically update constraints when a view is manually repositioned, so now the previous calculations are no longer valid. The dashed red lines let you know there is an error with our constraints that requires correction.</p><p>Thankfully, Xcode has some handy features available to help correct these issues. From the menu bar, navigate to <strong>Editor</strong> | <strong>Resolve Auto Layout Issues</strong> | <strong>Update Constraints</strong>. This can also be accomplished using the fourth button to the bottom-right corner of the storyboard. By selecting this, Xcode will recalculate the previous constraints based on our view's current physical position. The whole of the error will now disappear with no issues.</p><p>In addition to updating <a id="id68" class="indexterm"/>constraints, this menu option also gives you the ability to add missing constraints, update current constraints, and even clear all constraints. These automated options can be very helpful, but it is always recommended to set your constraints manually for better accuracy. If you are not sure what to do next, these options may also give you some guidance.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec32"/>Finishing our menu view</h1></div></div></div><p>Our buttons tend to blend into the<a id="id69" class="indexterm"/> background slightly, so let's add a new view that will help them stand out better. First, let's navigate to our storyboard and create a new outlet for our background image. Select our <code class="literal">MenuViewController</code> class, and open the assistant editor. Control drag from the background image in our storyboard to the <code class="literal">MenuViewController.h</code> file (between <code class="literal">@interface</code> and <code class="literal">@end</code>). Name this outlet <code class="literal">mainBackground</code>. Now switch to <code class="literal">MenuViewController.m</code>, and add the following code to <code class="literal">ViewDidLoad</code>:</p><div><pre class="programlisting">// Create a white transparent bar for the bottom of the screen
// Set the color to white with an alpha of 0.5
UIView *bottomBarBG = [[UIView alloc] initWithFrame:CGRectMake(0, self.view.bounds.size.height - 130, self.view.bounds.size.width, 130)];
bottomBarBG.backgroundColor = [UIColor colorWithWhite:1.0f alpha:0.5f];

// Add the view to the background
    [self.view insertSubview:bottomBarBG aboveSubview:self.mainBackground];</pre></div><p>The first line creates a new <code class="literal">UIView</code> and sets its frame. We set its Y position based on the screen height to guarantee that regardless of screen size, the <code class="literal">UIview</code> will be at the very bottom of the view.</p><p>Next, we set the background color to be solid white and set the alpha to <code class="literal">0.5</code> (half) so that the view appears slightly transparent.</p><p>Lastly, we add the<a id="id70" class="indexterm"/> button background view to our main view. We know that our button background should be above the main background but below the buttons, so we insert the view using <code class="literal">aboveSubview</code> so that it will always be directly above the main background. Run the application and take a look at the final design of our menu.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec33"/>Preparing for navigation</h1></div></div></div><p>The last thing we need to do is add a navigation controller<a id="id71" class="indexterm"/> for our view. This will be required to display (or push) our <strong>My Foods</strong> view. We can accomplish this in our storyboards with a single click of a menu item.</p><p>Switch to our <code class="literal">Main.storyboard</code> and then select <code class="literal">MenuViewController</code>. From the top menu bar, navigate to <strong>Editor</strong> | <strong>Embed In</strong> | <strong>Navigation Controller</strong>. Xcode will automatically add a navigation controller to the storyboard, set our <code class="literal">MenuViewController</code> as the root view controller, and then set our new navigation controller as the initial view to load. Our storyboard will now look like the following screenshot:</p><div><img src="img/0319OT_03_07.jpg" alt="Preparing for navigation"/></div><p>We don't want our menu<a id="id72" class="indexterm"/> view to display the navigation bar, so let's switch back to <code class="literal">MenuViewController.m</code> and add the following final line of code to <code class="literal">viewDidLoad</code>:</p><div><pre class="programlisting">[self.navigationController setNavigationBarHidden:YES];</pre></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec34"/>Summary</h1></div></div></div><p>In this chapter, we covered the new features of Auto Layout by building our menu view and applying constraints. Now that you have a good understanding of the new features of Auto Layout and how to use them, I highly recommend that you practice all the different types of constraints available on multiple views. Auto Layout is very powerful and, when used correctly, will eliminate a large portion of code normally attributed to dynamic layouts!</p><p>In the next chapter, we will continue by building the next part of our application. We will explore some of the new design principles of iOS 7 and apply them to our app, <strong>Food and Me</strong>.</p></div></body></html>