<html><head></head><body>
		<div><h1 id="_idParaDest-267"><em class="italic"><a id="_idTextAnchor319"/>Chapter 19</em>: Getting Started with Custom UIControls</h1>
			<p>At this point, your app has data in all of its screens, but the <strong class="bold">Restaurant Detail</strong> screen is incomplete. You can't set a star rating for a restaurant, and you can't add photos or reviews.</p>
			<p>You have been using Apple's standard UI elements so far. In this chapter, you'll create a custom subclass of the <code>UIControl</code> class that displays restaurant ratings in the form of stars. You'll modify this subclass so users can set a rating for a restaurant by tapping it. After that, you'll implement a review form that allows users to submit restaurant reviews.</p>
			<p>By the end of this chapter, you'll have learned how to create custom <code>UIControl</code> classes, handle touch events, and implement review forms for your own apps.</p>
			<p>The following topics will be covered in this chapter:</p>
			<ul>
				<li>Creating a custom <code>UIControl</code> subclass</li>
				<li>Displaying stars in your custom <code>UIControl</code> subclass</li>
				<li>Adding support for touch events</li>
				<li>Implementing an unwind method for the <strong class="bold">Cancel</strong> button</li>
				<li>Creating the <code>ReviewFormViewController</code> class</li>
			</ul>
			<h1 id="_idParaDest-268"><a id="_idTextAnchor320"/>Technical requirements</h1>
			<p>You will continue working on the <code>LetsEat</code> project that you modified in the previous chapter.</p>
			<p>The completed Xcode project for this chapter is in the <code>Chapter19</code> folder of the code bundle for this book, which can be downloaded here: <a href="https://github.com/PacktPublishing/iOS-15-Programming-for-Beginners-Sixth-Edition"/></p>
			<p><a href="https://github.com/PacktPublishing/iOS-15-Programming-for-Beginners-Sixth-Edition">https://github.com/PacktPublishing/iOS-15-Programming-for-Beginners-Sixth-Edition</a><a href="https://github.com/PacktPublishing/iOS-15-Programming-for-Beginners-Sixth-Edition&#13;"/></p>
			<p>Check out the following video to see the code in action:</p>
			<p><a href="https://bit.ly/3cRFcXa">https://bit.ly/3cRFcXa</a></p>
			<p>Let's start by learning how to create a custom <code>UIControl</code> subclass that will display a star rating on the screen.</p>
			<h1 id="_idParaDest-269"><a id="_idTextAnchor321"/>Creating a custom UIControl subclass</h1>
			<p>You've only <a id="_idIndexMarker1010"/>used Apple's predefined UI elements so far, such as labels and buttons. All you had to do was click the Library button, search for the object you want, and drag it into the storyboard. However, there will be cases where the objects provided by Apple are either unsuitable or don't exist. In such cases, you will need to build your own. Let's review the <strong class="bold">Restaurant Detail</strong> screen that you saw in the app tour:</p>
			<div><div><img src="img/Figure_19.01_B17469.jpg" alt="Figure 19.1: Restaurant Detail screen showing the star rating&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 19.1: Restaurant Detail screen showing the star rating</p>
			<p>You can see a <a id="_idIndexMarker1011"/>group of five stars just above the <code>RestaurantDetail</code> storyboard file and the <code>ReviewForm</code> storyboard file have blank view objects where the stars should be. You will create the <code>RatingsView</code> class, a custom subclass of the <code>UIControl</code> class, that you will use in both scenes. The <code>UIControl</code> class is a subclass of the <code>UIView</code> class, and it is used as the superclass for the <code>RatingsView</code> class because <code>RatingsView</code> instances have to respond when the user taps on them.</p>
			<p class="callout-heading">Important Information</p>
			<p class="callout">You can learn more about <code>UIControl</code> at <a href="https://developer.apple.com/documentation/uikit/uicontrol">https://developer.apple.com/documentation/uikit/uicontrol</a>.</p>
			<p>A <code>RatingsView</code> instance will display ratings as stars. The user will also be able to select half-stars. Let's begin by creating a subclass of the <code>UIControl</code> class. Follow these steps:</p>
			<ol>
				<li>Right-click<a id="_idIndexMarker1012"/> the <code>Review Form</code> folder and select <strong class="bold">New File</strong>.</li>
				<li><strong class="bold">iOS</strong> should already be selected. Choose <strong class="bold">Cocoa Touch Class</strong> and then click <strong class="bold">Next</strong>.</li>
				<li>Configure the file as follows:<p><code>RatingsView</code></p><p><code>UIControl </code></p><p><code>Swift </code></p><p>Click <strong class="bold">Next</strong>.</p></li>
				<li>Click <code>RatingsView</code> file will appear in the Project navigator.</li>
			</ol>
			<p>Now you need to set the identity of the view object next to the <code>RatingsView</code>. Follow these steps:</p>
			<ol>
				<li value="1">Expand the <code>RestaurantDetail</code> folder in the Project navigator. Click the <code>RestaurantDetail</code> storyboard file and select the <strong class="bold">View</strong> object next to the <strong class="bold">0.0</strong> <strong class="bold">Label</strong> as shown:<div><img src="img/Figure_19.02_B17469.jpg" alt="Figure 19.2: Editor area showing View object next to the 0.0 Label&#13;&#10;"/></div><p class="figure-caption">Figure 19.2: Editor area showing View object next to the 0.0 Label</p></li>
				<li>Click the <a id="_idIndexMarker1013"/>Identity inspector button. Under <code>RatingsView</code>:</li>
			</ol>
			<div><div><img src="img/Figure_19.03_B17469.jpg" alt="Figure 19.3: Identity inspector with Class set to RatingsView&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 19.3: Identity inspector with Class set to RatingsView</p>
			<p>Now let's modify the <code>RatingsView</code> class to make it display stars. You'll use the graphic assets <a id="_idIndexMarker1014"/>inside the <code>Assets.xcassets</code> file to do this in the next section.</p>
			<h2 id="_idParaDest-270"><a id="_idTextAnchor322"/>Displaying stars in your custom UIControl subclass</h2>
			<p>So far, you <a id="_idIndexMarker1015"/>have created a new <code>UIControl</code> subclass <a id="_idIndexMarker1016"/>named <code>RatingsView</code> in your project. You have also assigned the class of the view object next to the <code>Restaurant </code><code>Detail</code> screen to the <code>RatingsView</code> class. For the rest of this chapter, an instance of the <code>RatingsView</code> class will be referred to as a ratings view (the same way an instance of the <code>UIButton</code> class is referred to as a button). In this section, you will add some code to the <code>RatingsView</code> class to make a ratings view display stars. Follow these steps:</p>
			<ol>
				<li value="1">Click the <code>RatingsView</code> file in the Project navigator and remove all the commented code.</li>
				<li>Type the following after the <code>RatingsView</code> class declaration to declare the properties for the class:<pre>private let filledStarImage = UIImage(named: 
"filled-star")
private let halfStarImage = UIImage(named: 
"half-star")
private let emptyStarImage = UIImage(named: 
"empty-star")
private var totalStars = 5
var rating = 0.0</pre><p>The first three properties, <code>filledStarImage</code>, <code>halfStarImage</code>, and <code>emptyStarImage</code>, are assigned the star images stored in the <code>Assets.xcassets</code> file.</p><p>The <code>totalStars</code> property determines the total number of stars to be drawn.</p><p>The <code>rating</code> property is used to store a restaurant rating. The types of stars drawn will be determined by the value of <code>rating</code>. For instance, if <code>rating</code> is <code>3.5</code>, the ratings view will display three filled stars, one half-filled star, and one empty star.</p></li>
			</ol>
			<p>Next, let's create <a id="_idIndexMarker1017"/>the method that will draw the ratings<a id="_idIndexMarker1018"/> view on the screen. All <code>UIView</code> subclasses have a <code>draw(_:)</code> method, which is responsible for drawing their views on the screen. You'll override the superclass implementation of this method for the <code>RatingsView</code> class. Follow these s<a id="_idTextAnchor323"/><a id="_idTextAnchor324"/>teps:</p>
			<ol>
				<li value="1">Add the following code in the class declaration after the property declarat<a id="_idTextAnchor325"/><a id="_idTextAnchor326"/>ions:<pre>override func draw(_ rect: CGRect) {
   let context = UIGraphicsGetCurrentContext()
   context!.setFillColor(UIColor.systemBackground.
   cgColor)
   context!.fill(rect)
   let ratingsViewWidth = rect.size.width
   let availableWidthForStar = ratingsViewWidth /
   Double(totalStars)
   let starSidelength = (availableWidthForStar &lt;= 
   rect.size.height) ? availableWidthForStar : 
   rect.size.height
   for index in 0..&lt;totalStars {
      let starOriginX = (availableWidthForStar * 
      Double(index)) + ((availableWidthForStar - 
      starSidelength) / 2)
      let starOriginY = ((rect.size.height - 
      starSidelength) / 2)
      let frame = CGRect(x: starOriginX, 
      y: starOriginY, width: starSidelength,
      height: starSidelength)
      var starToDraw: UIImage!
      if (Double(index + 1) &lt;= self.rating) {
         starToDraw = filledStarImage
      } else if (Double(index + 1) &lt;= 
      self.rating.rounded()) {
         starToDraw = halfStarImage
      } else {
         starToDraw = emptyStarImage
      }
      starToDraw.draw(in: frame)
   }
}</pre><p>Let's break this down:</p><pre>let context = UIGraphicsGetCurrentContext()</pre><p>Creates an<a id="_idIndexMarker1019"/> instance of <code>UIGraphicsGetCurrentContext</code> and assigns it to <code>context</code>. You can think of it as a <a id="_idIndexMarker1020"/>sketchpad, where you will compose UI elements together.</p><pre>context!.setFillColor(UIColor.systemBackground.
cgColor)</pre><p>Sets the fill color of <code>context</code> to the default system background color.</p><pre>context!.fill(rect)</pre><p>Fills the rectangular area specified by <code>rect</code> with the fill color.</p><pre>let ratingsViewWidth = rect.size.width
let availableWidthForStar = ratingsViewWidth / 
Double(totalStars)
let starSidelength = (availableWidthForStar &lt;= 
rect.size.height) ? availableWidthForStar : 
rect.size.height</pre><p>These statements determine how big each star should be. The first statement gets the width of the ratings view and assigns it to <code>ratingsViewWidth</code>. The next statement gets the width available for each star by dividing the width of the ratings view by the number of stars that need to be drawn. This value is assigned to <code>availableWidthForStar</code>. For the third statement, imagine that each <a id="_idIndexMarker1021"/>star is enclosed in a rectangle. This <a id="_idIndexMarker1022"/>statement calculates how long each side of this rectangle should be in order to fit within the ratings view. If <code>availableWidthForStar</code> is less than or equal to the ratings view's height, <code>starSideLength</code> is set to <code>availableWidthForStar</code>; otherwise, it's set to be the same as the ratings view's height.</p><p class="callout-heading">Important Information</p><p class="callout">The third statement makes use of a <strong class="bold">ternary operator</strong>. More information can be found at this link: <a href="https://docs.swift.org/swift-book/LanguageGuide/BasicOperators.html">https://docs.swift.org/swift-book/LanguageGuide/BasicOperators.html</a>.</p></li>
			</ol>
			<p>For example, let's assume the ratings view is 200 points wide and 50 points high. <code>availableWidthForStar</code> would be 200/5 = 40. Since 40 &lt;= 50 evaluates to <code>true</code>, <code>starSideLength</code> will be set to <code>40</code>.</p>
			<pre>for index in 0..&lt;totalStars {</pre>
			<p>Since <code>totalStars</code> is set to <code>5</code>, this <code>for</code> loop repeats five times.</p>
			<pre>let starOriginX = (availableWidthForStar * 
Double(index)) +  ((availableWidthForStar – 
starSidelength) / 2
let starOriginY = ((rect.size.height - starSidelength)
/ 2)
let frame = CGRect(x: starOriginX, y: starOriginY, 
width: starSidelength, height: starSidelength)</pre>
			<p>These statements calculate the origin and size of the rectangle where each star should be drawn within the ratings view. This is then assigned to <code>frame</code>. The origin values are offset from the top-left corner of the ratings view, and the width and height are set to <code>starSidelength</code>. </p>
			<p>For<a id="_idIndexMarker1023"/> example, for <a id="_idIndexMarker1024"/>the first star, <code>starOriginX</code> is (40*0.0) + (40-40)/2 = <code>0</code>. <code>starOriginY </code>is (50 – 40)/2 = <code>5</code>. <code>frame</code> would thus be a <code>CGRect</code> where <code>x</code> is <code>0</code>, <code>y</code> is <code>5</code>, <code>width</code> is <code>40</code>, and <code>height</code> is <code>40</code>.</p>
			<pre>var starToDraw: UIImage!
if (Double(index + 1) &lt;= self.rating) {
   starToDraw = filledStarImage
} else if (Double(index + 1) &lt;= self.rating.rounded())
{ 
   starToDraw = halfStarImage
} else {
   starToDraw = emptyStarImage
}</pre>
			<p>Depending on the value of the ratings view's <code>rating</code> property, these statements determine whether the star to be drawn is filled, half-filled, or empty.</p>
			<p>For example, let's assume <code>rating</code> is <code>3.5</code>.</p>
			<p>The first star has an index of <code>0</code>. This means <code>Double</code>(0 + 1) &lt;= 3.5 will be 1.0 &lt;= 3.5, which evaluates to <code>true</code>. This means the first star that's drawn will be a filled star. The same is true for the second and third stars.</p>
			<p>The fourth star has an index of <code>3</code>. This means <code>Double</code>(3 + 1) &lt;= 3.5 will be 4.0 &lt;= 3.5, which evaluates to <code>false</code>. The <code>else</code> clause evaluates <code>Double</code>(3 + 1) &lt;= 4.0, which evaluates to <code>true</code>, so the fourth star drawn will be a half-filled star.</p>
			<p>The fifth star has an index of <code>4</code>. This means <code>Double</code>(4 + 1) &lt;= 3.5 will be 5.0 &lt;= 3.5, which evaluates to <code>false</code>. The <code>else</code> clause evaluates <code>Double</code>(4 + 1) &lt;= 4.0, which also evaluates to <code>false</code>, so the fifth star drawn will be an empty star.</p>
			<pre>starToDraw.draw(in: frame)</pre>
			<p>This <a id="_idIndexMarker1025"/>statement draws the star in the specified <code>frame</code>.</p>
			<p>That's all<a id="_idIndexMarker1026"/> the code that's needed for the <code>RatingsView</code> class. Now, let's add an outlet to the <code>RestaurantDetailViewController</code> class so that it can manage what the ratings view displays. Follow these steps:</p>
			<ol>
				<li value="1">Click the <code>RestaurantDetailViewController</code> file in the Project navigator.</li>
				<li>Type in the following code after the <code>overallRating<a id="_idTextAnchor327"/><a id="_idTextAnchor328"/>Label</code> outlet:<pre>@IBOutlet var ratingsView: RatingsView!</pre><p>This creates an outlet in the <code>RestaurantDetailViewController</code> class for the ratings view. You now have an outlet named <code>ratingsView</code> of type <code>RatingsView</code> that you will connect to the ratings view in the storyboard later.</p></li>
				<li>Add a method to assign <code>3.5</code> to a <code>ratingsView</code> instance's <code>rating</code> property. Type the following in your <code>private</code> extension after the <code>initial<a id="_idTextAnchor329"/><a id="_idTextAnchor330"/><a id="_idTextAnchor331"/>ize()</code> method:<pre>func createRating() {
   ratingsView.rating = 3.5
}</pre></li>
				<li>Modify the <code>initalize()</code> method to call the <code>createRating()</code> method:<pre>func initialize() { 
   setupLabels() 
   createMap() 
   <strong class="bold">createRating()</strong>
}</pre></li>
				<li>Open the <code>RestaurantDetail</code> storyboard file and select <code>ratingsView</code> outlet<a id="_idIndexMarker1028"/> to the ratings view:</li>
			</ol>
			<div><div><img src="img/Figure_19.04_B17469.jpg" alt="Figure 19.4: Connections inspector showing the ratingsView outlet&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 19.4: Connections inspector showing the ratingsView outlet</p>
			<p>Build and run your project and go to the <strong class="bold">Restaurant Detail</strong> screen for any restaurant. The ratings view should display three and a half stars:</p>
			<div><div><img src="img/Figure_19.05_B17469.jpg" alt="Figure 19.5: iOS Simulator showing ratings view displaying 3.5 stars&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 19.5: iOS Simulator showing ratings view displaying 3.5 stars</p>
			<p>You have <a id="_idIndexMarker1029"/>created and implemented the ratings <a id="_idIndexMarker1030"/>view for the <strong class="bold">Restaurant Detail</strong> screen. It looks great, but at the moment, the ratings view does not respond when you tap on it. You will make it respond to touch events in the next section so the user can select a rating.</p>
			<h1 id="_idParaDest-271"><a id="_idTextAnchor332"/>Adding support for touch events</h1>
			<p>At <a id="_idIndexMarker1031"/>present, the <code>RestaurantDetailViewController</code> class has an outlet, <code>ratingsView</code>, connected to a ratings view in the <strong class="bold">Restaurant Detail</strong> screen. It displays a rating of three and a half stars, but you can't change the rating. You will need to support touch events to make the ratings view respond to taps.</p>
			<p class="callout-heading">Important Information</p>
			<p class="callout">You can learn more about handling touches at <a href="https://developer.apple.com/documentation/uikit/touches_presses_and_gestures/handling_touches_in_your_view">https://developer.apple.com/documentation/uikit/touches_presses_and_gestures/handling_touches_in_your_view</a>.</p>
			<p>To support touch events, you'll modify the <code>RatingsView</code> class to track the user's touches on the screen and use them to determine the rating. Follow these steps:</p>
			<ol>
				<li value="1">Click the <code>RatingsView</code> file in the Project navigator and add the following property after the <code>draw(_:)</code> method:<pre>override var canBecomeFirstResponder: Bool {
   true
}</pre><p><code>canBecomeFirstResponder</code> is a <code>UIControl</code> property that determines whether an object can become the first responder. The ratings view needs to become the first responder to respond to touch events. This method returns <code>false</code> by default, as not all user interface elements need to respond to touches. You override this method to make it return <code>true</code> so the ratings view can become the first responder.</p></li>
				<li>To track <a id="_idIndexMarker1032"/>the user's touches on the screen, add the following code after the <code>canBecomeFirstResponder</code> propert<a id="_idTextAnchor333"/><a id="_idTextAnchor334"/>y you just added:<pre>override func beginTracking(_ touch: UITouch, with 
event: UIEvent?) -&gt; Bool {
   guard self.isEnabled else { 
      return false
   } 
   super.beginTracking(touch, with: event)
   handle(with: touch)
   return true
}</pre><p>Let's break this down:</p><pre>override func beginTracking(_ touch: UITouch, with event: UIEvent?) -&gt; Bool {</pre><p>This method is one of the methods declared in the <code>UIControl</code> class. It is called when the user's touch is within the bounds of a <code>UIControl</code> instance. The location, size, movement, and force of a touch on the screen are stored in a <code>UITouch</code> instance. This method needs to return <code>true</code> if you want to track the user's touches. You override this method so you can define custom behavior when the user touches the ratings view.</p><pre>guard self.isEnabled else { 
   return false
}</pre><p>The <code>isEnabled</code> property is checked in this <code>guard</code> statement to see if the ratings view is enabled. If<a id="_idIndexMarker1033"/> the ratings view is not enabled, the user's touches will not be tracked. </p><pre>super.beginTracking(touch, with: event)</pre><p>Calls the superclass implementation of this method. This will take care of any initialization required by the parent class. </p><pre>handle(with: touch) </pre><p>You'll pass the <code>UITouch</code> instance to this method, which will be executed for every touch. You'll declare and define this method in the next step.</p><pre>return true</pre><p>Tracks the user's touches when the ratings view is enabled.</p></li>
				<li>You'll see an error because you haven't implemented <code>handle(with:)</code> yet, so create a <code>private</code> extension for <code>RatingsView</code> after all other code in the file and type the follo<a id="_idTextAnchor335"/><a id="_idTextAnchor336"/>wing code into it:<pre>private extension RatingsView {
   func handle(with touch: UITouch) {
      let starRectWidth = self.bounds.size.width / 
      Double(totalStars)
      let location = touch.location(in: self)
      var value = location.x / starRectWidth
      if (value + 0.5) &lt; value.rounded(.up) {
         value = floor(value) + 0.5
      } else {
         value = value.rounded(.up)
      }
      updateRating(with: value)
   }
}</pre><p><code>handle(with:)</code> will calculate the rating value based on the location of the user's touch. It takes a <code>UITouch</code> instance as a parameter. First, <code>starRectWidth</code> is assigned the ratings view's <code>width</code>, divided by <code>5</code>. Next, the <code>UITouch</code> instance's location within the ratings view is assigned to <code>location</code>. Then, <code>value</code> is assigned the <code>x</code> position of <code>location</code> divided by <code>starRectWidth</code>. This means <code>value</code> will contain a range of values between 0 and 5. Next, the <code>if</code> statement <a id="_idIndexMarker1034"/>calculates the rating corresponding to the position of the touch and calls <code>updateRating(with:)</code>, passing <code>value</code> to it. You'll implement <code>updateRating(with:)</code> in the next step.</p><p>To understand how the if statement works, let's say the ratings view's <code>width</code> is <code>200</code>. <code>starRectWidth</code> would be set to 200/5 = <code>40</code>. Let's assume the user touched the screen at position <code>x</code> = <code>130</code>, <code>y</code> = <code>17</code>, which corresponds to a point between the third and fourth stars. <code>value</code> would be assigned 130/40 = <code>3.25</code>. So, the <code>if</code> statement would evaluate <code>(3.25 + 0.5 &lt; 3.25.rounded(.up)</code>, which becomes (3.75 &lt; 4.0), which returns <code>true</code>, thus <code>value</code> would be set to <code>floor(3.25)</code> + 0.5, which becomes 3.0 + 0.5, which is <code>3.5</code>. So, <code>updateRating(with:)</code> would be passed a value of <code>3.5</code>.</p></li>
				<li>You'll see an error because you haven't implemented <code>updateRating(with:)</code> yet, so type the following code into the <code>private</code> extension after the <code>ha<a id="_idTextAnchor337"/><a id="_idTextAnchor338"/>ndle(with:)</code> method:<pre>func updateRating(with newValue: Double) {
   if (self.rating != newValue &amp;&amp; newValue &gt;= 0 &amp;&amp; 
   newValue &lt;= Double(totalStars)) { 
      self.rating = newValue 
   }
}</pre><p><code>updateRating(with:)</code> checks to see if <code>value</code> is not equal to the current rating and between 0 and 5. If it is, <code>value</code> is assigned to <code>rating</code>.</p><p>Following on from <a id="_idIndexMarker1035"/>the preceding example, since <code>3.5</code> is between 0 and 5, it will be assigned to <code>rating</code> if it's not equal to the current value of <code>rating</code>.</p></li>
				<li>The ratings view will have to be redrawn once the rating has changed to display the correct state of the stars. Modify the <code>rating</code> property declaration as follows:<pre>var rating = 0.0 {
   didSet {
      setNeedsDisplay()
   }
}</pre><p>Here, you have defined a <code>rating</code> property's value. Every time <code>rating</code> changes, <code>setNeedsDisplay()</code> is called and the ratings view is redrawn. Since the screen is redrawn only if the rating changes, there is a small performance benefit.</p></li>
			</ol>
			<p>You've added all the code that's necessary for the ratings view to respond to touches. Now, you'll need to update the <code>RestaurantDetailViewController</code> class to set the <code>isEnabled</code> property for the ratings view. Click the <code>RestaurantDetailViewController</code> file in the Project navigator and modify the <code>createRating()</code> method, as follows:</p>
			<pre>func createRating() { 
   ratingsView.rating = 3.5 
<strong class="bold">   ratingsView.isEnabled = true</strong>
}</pre>
			<p>Setting the <code>isEnabled</code> property to <code>true</code> allows the ratings view to become the first responder and begin tracking touches, which will trigger <code>handle(with:)</code> to calculate the rating based on the position of the touch, which in turn calls <code>updateRating(with:)</code> to update the ratings view.</p>
			<p>Build and run your project. Tapping on the ratings view now changes the rating, depending on where you tapped. Tap between the first and second stars, as shown:</p>
			<div><div><img src="img/Figure_19.06_B17469.jpg" alt="Figure 19.6: iOS Simulator showing ratings view tap location&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 19.6: iOS Simulator showing ratings view tap location</p>
			<p>The rating will <a id="_idIndexMarker1036"/>change to one and a half stars.</p>
			<p>Eventually, you'll calculate the overall rating by aggregating all the ratings submitted by users in the <strong class="bold">Review Form</strong> screen. If you tap the <strong class="bold">Add Review</strong> button, the <strong class="bold">Review Form </strong>screen is displayed but you can't dismiss it or set a rating. In the next section, you'll configure the <strong class="bold">Cancel</strong> button to dismiss the <strong class="bold">Review Form</strong> screen when tapped.</p>
			<h1 id="_idParaDest-272"><a id="_idTextAnchor339"/>Implementing an unwind method for the Cancel button</h1>
			<p>Let's <a id="_idIndexMarker1037"/>take a look at the <strong class="bold">Review Form</strong> screen. The <a id="_idIndexMarker1038"/>segue between the <strong class="bold">Add Review</strong> button and the <strong class="bold">Review Form</strong> screen has already been made for you. Build and run your project, go to the <strong class="bold">Restaurant Detail</strong> screen, and tap the <strong class="bold">Add Review</strong> button:</p>
			<div><div><img src="img/Figure_19.07_B17469.jpg" alt="Figure 19.7: iOS Simulator showing Add Review button&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 19.7: iOS Simulator showing Add Review button</p>
			<p>The <strong class="bold">Review Form</strong> screen <a id="_idIndexMarker1039"/>is displayed (note that the top<a id="_idIndexMarker1040"/> table view cell has a blank space where a ratings view should be, which you will add later):</p>
			<div><div><img src="img/Figure_19.08_B17469.jpg" alt="Figure 19.8: iOS Simulator showing Review Form screen&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 19.8: iOS Simulator showing Review Form screen</p>
			<p>Once<a id="_idIndexMarker1041"/> the <strong class="bold">Review Form</strong> screen appears<a id="_idIndexMarker1042"/> on the screen, you can't dismiss it, as the button actions for the <strong class="bold">Save</strong> and <strong class="bold">Cancel</strong> buttons have not been configured. Just as you did with the <strong class="bold">Locations</strong> screen, you need to implement an unwind method to dismiss the <strong class="bold">Review Form</strong> screen. Follow these steps:</p>
			<ol>
				<li value="1">Click the <code>RestaurantDetailViewController</code> file in the Project navigator.</li>
				<li>Implement the unwind method as follows in the <code>private</code> extension, before th<a id="_idTextAnchor340"/><a id="_idTextAnchor341"/>e <code>createRating()</code> method:<pre>@IBAction func unwindReviewCancel(segue:
UIStoryboardSegue) {
}</pre><p>This method will be called when the <strong class="bold">Review Form</strong> screen transitions to the <strong class="bold">Restaurant Detail</strong> screen.</p></li>
				<li>Open the <code>ReviewForm</code> storyboard file and <em class="italic">Ctrl + Drag</em> from the <strong class="bold">Cancel</strong> button to the Exit icon in the Scene Dock, as shown:<div><img src="img/Figure_19.09_B17469.jpg" alt="Figure 19.9: Table View Controller Scene showing Cancel button action being set&#13;&#10;"/></div><p class="figure-caption">Figure 19.9: Table View Controller Scene showing Cancel button action being set</p></li>
				<li>Choose <code>unwindReviewCancelWithSegue</code> in the popup menu:</li>
			</ol>
			<div><div><img src="img/Figure_19.10_B17469.jpg" alt="Figure 19.10: Pop-up menu with unwindReviewCancelWithSegue: selected&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 19.10: Pop-up menu with unwindReviewCancelWithSegue: selected</p>
			<p>Build and run<a id="_idIndexMarker1043"/> your project. You can now dismiss <a id="_idIndexMarker1044"/>the <strong class="bold">Review Form</strong> screen by tapping the <strong class="bold">Cancel</strong> button.</p>
			<p>Next, let's look at the <strong class="bold">Save</strong> button. You'll create a view controller for the <strong class="bold">Review Form </strong>screen to process the data inside the <strong class="bold">Review Form</strong> screen's fields when the <strong class="bold">Save</strong> button is tapped. You'll do this in the next section.</p>
			<h1 id="_idParaDest-273"><a id="_idTextAnchor342"/>Creating the ReviewFormViewController class</h1>
			<p>To process<a id="_idIndexMarker1045"/> user input, you'll create the <code>ReviewFormViewController</code> class to be the view controller for the <strong class="bold">Review Form</strong> screen. For the time being, you'll configure this class to grab all the values from the <strong class="bold">Review Form</strong> screen's fields and print them in the Debug area. You will learn how to store reviews later in <a href="B17469_21_Final_VK_ePub.xhtml#_idTextAnchor362"><em class="italic">Chapter 21</em></a><em class="italic">, Understanding Core Data</em>. Follow these steps:</p>
			<ol>
				<li value="1">Right-click the <code>ReviewForm</code> folder and select <strong class="bold">New File</strong>.</li>
				<li><strong class="bold">iOS</strong> should already be selected. Choose <strong class="bold">Cocoa Touch Class</strong> and then click <strong class="bold">Next</strong>.</li>
				<li>Configure the file as follows:<p><code>ReviewFor<a id="_idTextAnchor343"/><a id="_idTextAnchor344"/>mViewController</code></p><p><code>UITableViewController </code></p><p><code>Swift</code></p><p>Click <strong class="bold">Next</strong>.</p></li>
				<li>Click <code>ReviewFormViewController</code> file will appear in the Project navigator.</li>
				<li>Delete <a id="_idIndexMarker1046"/>everything after the <code>viewDidLoad()</code> method and all the commented code. Add the following outlets after the class declaration. They correspond to the fields insi<a id="_idTextAnchor345"/><a id="_idTextAnchor346"/>de the <strong class="bold">Review Form</strong> screen:<pre>@IBOutlet var ratingsView: RatingsView!
@IBOutlet var titleTextField: UITextField!
@IBOutlet var nameTextField: UITextField!
@IBOutlet var reviewTextView: UITextView!</pre></li>
				<li>You also need to configure the action for the <code>viewDidLoad()</code> method:<pre>@IBAction func onSaveTapped(_ sender: Any) { 
   print(ratingsView.rating) 
   print(titleTextField.text as Any) 
   print(nameTextField.text as Any) 
   print(reviewTextView.text as Any) 
   dismiss(animated: true, completion: nil)
}</pre><p>This method prints the contents of the <strong class="bold">Review Form</strong> screen's fields to the Debug area and dismisses it.</p></li>
			</ol>
			<p>Now let's<a id="_idIndexMarker1047"/> connect the outlets in the <code>ReviewForm</code> storyboard file, as follows:</p>
			<ol>
				<li value="1">Click the <code>ReviewForm</code> storyboard file in the Project navigator and click the <code>ReviewFormViewController</code>:<div><img src="img/Figure_19.11_B17469.jpg" alt="Figure 19.11: Identity inspector with Class set to ReviewFormViewController&#13;&#10;"/></div><p class="figure-caption">Figure 19.11: Identity inspector with Class set to ReviewFormViewController</p><p>Note that the name <strong class="bold">Table View Controller Scene</strong> will change to <strong class="bold">Review Form View Controller Scene</strong>.</p></li>
				<li>Click the <code>RatingsView</code>. The view's name will change to <strong class="bold">Ratings View</strong>:<div><img src="img/Figure_19.12_B17469.jpg" alt="Figure 19.12: Identity inspector with Class set to RatingsView&#13;&#10;"/></div><p class="figure-caption">Figure 19.12: Identity inspector with Class set to RatingsView</p></li>
				<li>Next, you<a id="_idIndexMarker1048"/> will connect the outlets. Click the <strong class="bold">Review Form View Controller</strong> icon in the document outline and click the Connections inspector button:<div><img src="img/Figure_19.13_B17469.jpg" alt="Figure 19.13: Connections Inspector button&#13;&#10;"/></div><p class="figure-caption">Figure 19.13: Connections Inspector button</p></li>
				<li>Connect the <code>ratingsView</code> outlet to the <strong class="bold">Ratings View</strong>:<div><img src="img/Figure_19.14_B17469.jpg" alt="Figure 19.14: Connections inspector showing ratingsView outlet&#13;&#10;"/></div><p class="figure-caption">Figure 19.14: Connections inspector showing ratingsView outlet</p></li>
				<li>Connect the <code>titleTextField</code> outlet to the first <strong class="bold">Text Field</strong>:<div><img src="img/Figure_19.15_B17469.jpg" alt="Figure 19.15: Connections inspector showing titleTextField outlet&#13;&#10;"/></div><p class="figure-caption">Figure 19.15: Connections inspector showing titleTextField outlet</p></li>
				<li>Connect the <code>nameTextField</code> outlet to the second <strong class="bold">Text Field</strong>:<div><img src="img/Figure_19.16_B17469.jpg" alt="Figure 19.16: Connections inspector showing nameTextField outlet&#13;&#10;"/></div><p class="figure-caption">Figure 19.16: Connections inspector showing nameTextField outlet</p></li>
				<li>Connect <a id="_idIndexMarker1049"/>the <code>reviewTextView</code> outlet to the <strong class="bold">Text View</strong>:<div><img src="img/Figure_19.17_B17469.jpg" alt="Figure 19.17: Connections inspector showing reviewTextView outlet&#13;&#10;"/></div><p class="figure-caption">Figure 19.17: Connections inspector showing reviewTextView outlet</p></li>
				<li>Finally, connect the <code>onSaveTapped:</code> action to the <strong class="bold">Save</strong> button:</li>
			</ol>
			<div><div><img src="img/Figure_19.18_B17469.jpg" alt="Figure 19.18: Connections inspector showing Save button action being set&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 19.18: Connections inspector showing Save button action being set</p>
			<p>Build and<a id="_idIndexMarker1050"/> run your app. Go to the <strong class="bold">Review Form</strong> screen, set a rating, add some sample text to the fields, and tap the <strong class="bold">Save</strong> button:</p>
			<div><div><img src="img/Figure_19.19_B17469.jpg" alt="Figure 19.19: iOS Simulator showing Review Form screen&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 19.19: iOS Simulator showing Review Form screen</p>
			<p>You'll see the data you entered appear in the Debug area:</p>
			<div><div><img src="img/Figure_19.20_B17469.jpg" alt="Figure 19.20: Debug area showing contents of Review Form screen text fields&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 19.20: Debug area showing contents of Review Form screen text fields</p>
			<p>Congratulations! The <strong class="bold">Review Form</strong> screen is<a id="_idIndexMarker1051"/> now able to accept user input. You'll learn how to save and present the review data in <a href="B17469_21_Final_VK_ePub.xhtml#_idTextAnchor362"><em class="italic">Chapter 21</em></a><em class="italic">, Understanding Core Data</em>.</p>
			<h1 id="_idParaDest-274"><a id="_idTextAnchor349"/>Summary</h1>
			<p>In this chapter, you created a new custom <code>UIControl</code> subclass, <code>RatingsView</code>, from scratch and added it to the <code>ReviewFormViewController</code> class, a view controller for the <strong class="bold">Review Form</strong> screen, and configured the <strong class="bold">Cancel</strong> and <strong class="bold">Save</strong> button actions so that the user can dismiss the Review Form screen or submit a review.</p>
			<p>You now have a good grasp of how to create custom <code>UIControl</code> classes, how to make them respond to user interaction, and how to implement a review form that can accept user input. This will be useful when you write your own apps.</p>
			<p>In the next chapter, you'll learn how to work with photos from the camera or Photo Library, as well as how to apply photo filters to the photos that you have.</p>
		</div>
	</body></html>