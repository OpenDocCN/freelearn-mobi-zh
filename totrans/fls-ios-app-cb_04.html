<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Porting Flash Projects to iOS</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Handling user interaction</li><li class="listitem" style="list-style-type: disc">Saving application state</li><li class="listitem" style="list-style-type: disc">Flattening the display list</li><li class="listitem" style="list-style-type: disc">Converting vectors to bitmaps</li><li class="listitem" style="list-style-type: disc">Resizing bitmaps</li><li class="listitem" style="list-style-type: disc">Masking content</li><li class="listitem" style="list-style-type: disc">Working with external SWFs</li></ul></div><div><div><div><div><h1 class="title"><a id="ch04lvl1sec01"/>Introduction</h1></div></div></div><p>Apple prohibits the installation of third-party plugins on iOS, preventing Safari or any other browser from running Flash content. Unfortunately, this prevents those using iOS devices from accessing the thousands of popular web-based Flash games and applications that are out there.</p><p>Until recently, the growing popularity of iOS had left Flash developers, who were wishing to deliver their existing content to Apple's platform, in a difficult position. The only realistic solution was to completely rewrite their projects for iOS using Objective-C, while continuing to maintain the existing ActionScript codebase for web users on other platforms.</p><p>However, one of the primary advantages of AIR for iOS is that developers can re-publish their existing Flash-enabled content as native iOS apps while leaving much of the project's codebase untouched. Adobe's multi-platform goal for the Flash Platform has meant that Flash developers can target iOS while using the same development environment that they are comfortable with.<a id="id276" class="indexterm"/>
</p><p>This chapter will take you through recipes that will aid you when porting existing Flash projects to the iOS platform. These should get you started on the right foot and help you grow in confidence as you continue to work with AIR for iOS. And remember, what you will learn here isn't just applicable when porting existing content; you should also apply the same techniques and principles to any new applications you plan to create.<a id="id277" class="indexterm"/>
</p><p>Of course, this chapter alone won't guarantee that your Flash projects can be successfully ported, but the recipes selected should give you a flavor of what is required if you are to succeed. The limitations of mobile platforms can make development daunting. However, as your knowledge of AIR for iOS grows, so will your ability to identify areas within your applications that can be optimized to fit those constraints.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec02"/>Handling user interaction</h1></div></div></div><p>Mouse interaction allows a level of accuracy that is impossible to achieve with a finger. Take for example a simple button within a menu screen. With a mouse, the user will be able to make a selection with almost pixel-perfect precision. A finger, however, obscures parts of the screen, including the item being selected, and also makes contact with a larger area.<a id="id278" class="indexterm"/>
</p><p>If your existing Flash applications are designed primarily for mouse interaction, then you will need to redesign your user interface to accommodate touch. The most beneficial changes you can make are to increase the size of your buttons and create larger hit targets around them.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec01"/>Getting ready</h2></div></div></div><p>An FLA has been provided as a starting point for this recipe.</p><p>If you haven't already done so, download this book's code bundle from its companion website.</p><p>Open<code class="literal"> chapter4\recipe1\recipe.fla</code> into Flash Professional.</p><p>Within its library are bitmaps that you will use to create a button. Also, its AIR for iOS settings have already been applied, saving you the time and effort when you eventually need to build and deploy the recipe to a device.</p><p>Going forward, a starting FLA will be provided for all recipes, with the majority of AIR for iOS settings for each being pre-configured.<a id="id279" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec02"/>How to do it...</h2></div></div></div><p>We will split this recipe into two parts. First we will create a movie clip representing the button, before writing and linking a custom class to it.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec01"/>Creating the button movie clip</h3></div></div></div><p>Let us start by creating the movie clip:<a id="id280" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Select<strong> Insert</strong> |<strong> New Symbol</strong> <em>(Ctrl + F8</em> |<em> Cmd</em> +<em> F8)</em>. From the<strong> Create New Symbol</strong> panel, enter<code class="literal"> Start Button</code> into the<strong> Name</strong> field and select<strong> Movie Clip</strong> from the<strong> Type</strong> field's drop-down box. Click on the<strong> OK</strong> button.<p>An empty movie-clip symbol will be created within the library and you will be moved to its timeline.
</p></li><li class="listitem">Drag the<strong> button-normal.png</strong> bitmap from the library to the stage. From the<strong> Properties</strong> panel, expand the<strong> POSITION AND SIZE</strong> section and position the bitmap at (0, 0).</li><li class="listitem">Click on frame 2 of the timeline and select<strong> Insert</strong> |<strong> Timeline</strong> |<strong> Blank Keyframe</strong>. Also drag<strong> button-select.png</strong> from the library to the stage and position it at (0,0).</li><li class="listitem">Create a new layer on the timeline by selecting<strong> Insert</strong> |<strong> Timeline</strong> |<strong> Layer</strong> from Flash Professional's drop-down menu. The layer will be named<strong> Layer 2</strong> by default and will sit on top of<strong> Layer 1</strong>.</li><li class="listitem">From the<strong> Tools</strong> panel, select the<strong> Rectangle Tool  (R).</strong> On<strong> Layer 2</strong>, draw a rectangle that has a width of 290 pixels and a height of 77 pixels. Position it at (-28,-14). The rectangle should span across both frames of the timeline and represents the button's hit region.</li><li class="listitem">Finally, select the rectangle by double-clicking on it, then from the<strong> Properties</strong> panel set the alpha for both the rectangle's fill and stroke to<strong> 0%</strong>, making it invisible.<p>You should now have a button movie clip that has a timeline identical to the following screenshot:
</p><div><img src="img/1383_04_01.jpg" alt="Creating the button movie clip"/></div></li><li class="listitem">Move out of the<strong> Start Button</strong> movie-clip symbol and back to your FLA's root timeline.<a id="id281" class="indexterm"/></li><li class="listitem">Save the FLA.</li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec02"/>Linking a class to the button</h3></div></div></div><p>With the button's visual taken care of, it is time to add some interactivity using ActionScript:<a id="id282" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Select<strong> File</strong> |<strong> New</strong> and create a new<strong> ActionScript 3.0 Class</strong>. Name the class as<code class="literal"> Button</code>.</li><li class="listitem">Add the following code to the class:<div><pre class="programlisting">package {
import flash.display.MovieClip;
import flash.events.MouseEvent;
public class Button extends MovieClip {
public function Button() {
addEventListener(MouseEvent.ROLL_OVER, touched);
addEventListener(MouseEvent.ROLL_OUT, released);
gotoAndStop(1);
}
private function touched(e:MouseEvent):void {
gotoAndStop(2);
}
private function released(e:MouseEvent):void {
gotoAndStop(1);
}
}
}
</pre></div></li><li class="listitem">Save the class as<code class="literal"> Button.as</code> to the same location as your FLA.<a id="id283" class="indexterm"/></li><li class="listitem">Move back to your FLA. Now you can link the class to your button.</li><li class="listitem">Within the<strong> Library</strong>, right-click on the<strong> Start Button</strong> movie-clip symbol and select<strong> Properties</strong>. Check on the<strong> Export for ActionScript</strong> checkbox. Enter<code class="literal"> StartButton</code> into the<strong> Class</strong> field and<code class="literal"> Button</code> into the<strong> Base Class</strong> field. Click on the<strong> OK</strong> button. Flash will inform you that a definition for the<code class="literal"> StartButton</code> class will be generated. Click on the<strong> OK</strong> button.<a id="id284" class="indexterm"/></li><li class="listitem">Now, drag an instance of the<strong> Start Button</strong> movie-clip symbol from the<strong> Library</strong> onto the stage. Position it at (43,217).</li><li class="listitem">Test your FLA using ADL <em> (Ctrl + Enter</em> |<em> Cmd</em> +<em> Enter)</em> to ensure that there are no compiler errors.</li><li class="listitem">Finally publish your app for iOS.</li></ol></div><p>The FLA will be compiled and a file named<code class="literal"> c4-r1.ipa</code> will be created. Deploy the file to your device and test it.</p><div><h3 class="title"><a id="note32"/>Note</h3><p>The remaining recipes within this book will follow a convention for the naming of their IPA file. The IPA's name will contain the chapter number that the recipe belongs to, followed by the recipe's position within the chapter.</p><p>For example, this recipe belongs to Chapter 4 (c4) and is the chapter's first recipe (r1). Therefore, the IPA file generated by this recipe's FLA will be named<code class="literal"> c4-r1.ipa</code>. To ensure you can easily find your installed apps on your device, each app's name will reflect that of the IPA. You will find the preceding recipe's example app listed on your home screen as<code class="literal"> c4 r1.</code>
</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec03"/>How it works...</h2></div></div></div><p>With some simple timeline work and a small amount of ActionScript, you have constructed a two-state button that is suitable for use on an iOS device.</p><p>Being large in size and having a generous rectangular hit target makes the button an easy target. Even those who operate their device with one hand and make selections with their thumb should have no problems.</p><p>The<code class="literal"> Button.as</code> class simply manages the timeline movement between the button's two states. When not being pressed, the first frame of the timeline is shown. When the user's finger touches the button, the second frame of its timeline is shown. Its state is also updated in response to the user's finger rolling onto or out of the button.<a id="id285" class="indexterm"/>
</p><p>A strong user experience is vital to the success of your app. When porting your existing Flash projects to iOS, spend the necessary time adapting your buttons and other UI elements to the platform.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec04"/>There's more...</h2></div></div></div><p>The following are a few more points of interest regarding user interaction.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec03"/>Re-using the button class</h3></div></div></div><p>You can re-use the class provided with this recipe, linking it to any button within the library of your own projects. The class simply updates your button's visual state but you can easily add an event listener to any of your button instances in order to respond to a successful user selection.<a id="id286" class="indexterm"/>
</p><p>As a quick example, name the button instance on your stage as<code class="literal"> startButton</code>. Now, create a document class for your FLA. Name the class<code class="literal"> Main</code> and add the following code to it:</p><div><pre class="programlisting">package {
import flash.display.MovieClip;
import flash.events.MouseEvent;
public class Main extends MovieClip {
public function Main() {
startButton.addEventListener(MouseEvent.MOUSE_UP,
buttonPressed);
}
private function buttonPressed(e:MouseEvent):void {
startButton.visible = false;
}
}
}
</pre></div><p>The code above simply listens for the<code class="literal"> startButton</code> instance dispatching a<code class="literal"> MouseEvent.MOUSE_UP</code> event. When it does, the<code class="literal"> buttonPressed()</code> handler is called, which hides the button from view. Of course, for your own applications you will add your own functionality to the handler.<a id="id287" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec04"/>Handling keyboard controls</h3></div></div></div><p>As well as mouse interaction, many Flash-enabled projects designed for the web expect the presence of a physical keyboard to control the application in some way or form. While iOS devices do support a virtual keyboard, it is only present when a text field is being edited. Your application should not rely on keyboard events as a control mechanism. You may need to redesign how users interact with the app before porting it to iOS.<a id="id288" class="indexterm"/>
</p></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec05"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Linking classes to movie-clip symbols, <a class="link" href="ch03.html" title="Chapter 3. Writing your First App">Chapter 3</a></em></li><li class="listitem" style="list-style-type: disc"><em>Creating a basic document class Chapter 3</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec03"/>Saving application state</h1></div></div></div><p>When writing applications for iOS, you should anticipate that the app may at any point be closed. This can happen for a number of reasons such as the user deliberately exiting from the app, an incoming call being received, or iOS closing the app due to memory constraints.<a id="id289" class="indexterm"/>
</p><p>When an app is closed unexpectedly, the user will expect it to resume from its previous state when they eventually return to it. For any Flash projects you are porting to iOS, it is important you add functionality to save the app's state at convenient points throughout its lifetime.</p><p>This recipe will take you through the steps required to maintain the state of an application. We will use Flash's<code class="literal"> SharedObject</code> class to save data locally to your device.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec06"/>Getting ready</h2></div></div></div><p>From the book's accompanying code bundle, open<code class="literal"> chapter4\recipe2\recipe.fla</code> into Flash Professional.</p><p>On the stage, you will find a dynamic text field, and a movie clip that represents a button. A minimal document class has been written that increments a counter every time the button is pressed and shows its value within the text field.<a id="id290" class="indexterm"/>
</p><p>The movie clip's library symbol is linked to a class named<code class="literal"> Button</code>, which was introduced in the previous recipe, Handling user interaction.</p><p>Test the application using ADL<em> (Ctrl + Enter</em> |<em> Cmd</em> +<em> Enter)</em>. Increment the counter a few times by clicking on the button and then close the window. If you test the application again, then you will notice that the counter has reset to zero—the application does not yet remember its state.</p><p>The document class,<code class="literal"> Main.as</code>, can be found in the same location as the FLA. Open it and familiarize yourself with the code.</p><p>A<code class="literal"> MOUSE_UP</code> event listener has been added to the button on the stage. Its handler function simply increments a<code class="literal"> counter</code> member variable and then writes the value to the dynamic text field.<a id="id291" class="indexterm"/>
</p><p>Let us update the document class to allow it to manage your application's state.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec07"/>How to do it...</h2></div></div></div><p>You will require the use of the<code class="literal"> SharedObject</code> class for this recipe.</p><div><ol class="orderedlist"><li class="listitem">Within<code class="literal"> Main.as</code> add an import statement for it:<div><pre class="programlisting">import flash.net.SharedObject;
</pre></div></li><li class="listitem">Declare a member variable that will be used to store a reference to the shared object:<div><pre class="programlisting">private var so:SharedObject;
</pre></div></li><li class="listitem">Now, add a private method that either initializes the shared object or retrieves any data already stored by it:<div><pre class="programlisting">private function initSharedObject():void {
so = SharedObject.getLocal("savedData");
if(so.data.counter == null)
{
so.data.counter = counter;
}
else
{
counter = so.data.counter;
}
}
</pre></div></li><li class="listitem">Make a call to<code class="literal"> initSharedObject()</code> within the constructor:<a id="id292" class="indexterm"/><div><pre class="programlisting">public function Main() {
<strong>initSharedObject();
</strong>
counterField.text = String(counter);
btn.addEventListener(MouseEvent.MOUSE_UP, buttonPressed);
}
</pre></div></li><li class="listitem">Add a private method that saves the value of the<code class="literal"> counter</code> member variable to the shared object:<div><pre class="programlisting">private function saveSharedObject():void {
so.data.counter = counter;
so.flush();
}
</pre></div></li><li class="listitem">Within the<code class="literal"> buttonPressed()</code> event handler, make a call to the<code class="literal"> saveSharedObject()</code> method:<a id="id293" class="indexterm"/><div><pre class="programlisting">private function buttonPressed(e:MouseEvent):void {
++counter;
counterField.text = String(counter);
<strong>saveSharedObject();
</strong>
}
</pre></div></li><li class="listitem">Save your class file.</li><li class="listitem">Test your FLA using ADL. When you close the window and re-test the FLA, you will see that the counter's value has been successfully restored.</li><li class="listitem">Publish your app for iOS and deploy it to your device. Increment the counter and then close the app. If your device is using iOS 4.0 or above, then you will also need to forcibly kill the app from iOS's app switcher. When you re-launch it, the counter's value will be restored.</li></ol></div><div><h3 class="title"><a id="tip13"/>Tip</h3><p>To access the fast app switcher, double-press on the home button. To kill an app, tap and hold its icon until the minus symbol appears at the icon's corner. Tap the minus symbol and the app will be removed from the background. The app switcher is available on devices running iOS 4 or above.</p></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec08"/>How it works...</h2></div></div></div><p>A local shared object is a data file that is stored locally on your device. The<code class="literal"> SharedObject</code> class provides an API that can be used to easily save and retrieve data from the file.<a id="id294" class="indexterm"/>
</p><p>Before you can use a shared object, you must obtain a<code class="literal"> SharedObject</code> instance by making a call to the static<code class="literal"> getLocal()</code> method. If the shared object doesn't already exist, then one is created. When you call<code class="literal"> getLocal()</code>, you must pass it a string that is used to name the data file that is written to the device's file system. This was done within the recipe's<code class="literal"> initSharedObject()</code> method:<a id="id295" class="indexterm"/>
</p><div><pre class="programlisting">so = SharedObject.getLocal("savedData");
</pre></div><p>Once you have a reference to a<code class="literal"> SharedObject</code> you can add or retrieve attributes through its<code class="literal"> data</code> property. Each attribute represents data you would like to save and can be an object of any ActionScript type including<code class="literal"> Array, ByteArray</code>, and<code class="literal"> XML</code>. You can even save an instance of a custom class by first registering it using the<code class="literal"> flash.net.registerClassAlias()</code> package-level function.</p><p>We stored the<code class="literal"> counter</code> member variable's value by creating an attribute named<code class="literal"> counter</code> and setting it to the value of the member variable. This was done within our<code class="literal"> initSharedObject()</code> method to initialize the persistent data, and again within<code class="literal"> saveSharedObject()</code> to store the counter's latest value. The following line of code is used to implement this:<a id="id296" class="indexterm"/>
</p><div><pre class="programlisting">so.data.counter = counter;
</pre></div><p>It is also useful to know if your shared object contains data or has just been created. You can determine this by simply checking for the existence of one of your known attributes. This was done within<code class="literal"> initSharedObject()</code> where we checked to see if the<code class="literal"> counter</code> attribute was<code class="literal"> null</code>. If it was, then we set it to the<code class="literal"> counter</code> member variable's current default value; otherwise we used the stored value to actually set the<code class="literal"> counter</code> member variable. The following is the code again as a reminder:</p><div><pre class="programlisting">so = SharedObject.getLocal("savedData");
if(so.data.counter == null)
{
so.data.counter = counter;
}
else
{
counter = so.data.counter;
}
</pre></div><p>Setting attributes within the data object doesn't actually save them. You must explicitly do this by making a call to the<code class="literal"> flush()</code> method, which was done within our<code class="literal"> saveSharedObject()</code> method.<a id="id297" class="indexterm"/>
</p><p>Making calls to<code class="literal"> flush()</code> can be expensive as data must be written to the file system. For this recipe's example code, it is acceptable to repeatedly make calls to<code class="literal"> flush()</code> when the application's state changes. However, for real-world apps, you should attempt to save data as often as possible but without degrading the performance of your app. Try to find convenient moments to save, for example, between levels or during periods of user inactivity.</p><p>For more information regarding the<code class="literal"> SharedObject</code> class, perform a search for<code class="literal"> flash.net.SharedObject</code> within Adobe Community Help.<a id="id298" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec09"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Handling multitasking, <a class="link" href="ch03.html" title="Chapter 3. Writing your First App">Chapter 3</a></em></li><li class="listitem" style="list-style-type: disc"><em>Exiting gracefully from an app, <a class="link" href="ch03.html" title="Chapter 3. Writing your First App">Chapter 3</a></em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec04"/>Flattening the display list</h1></div></div></div><p>Flash's drawing tools and rendering engine makes it convenient to create a deeply nested display list. When examining artwork created in Flash, it is fairly common to have to drill down into the top-level clip for several levels and navigate through a complex hierarchical structure until you find your target display object.<a id="id299" class="indexterm"/>
</p><p>Unfortunately, while a desktop computer will be able to easily render complex scenes, the same content running on an iOS device may degrade performance. Deeply nested display lists also cause long event chains that can further hurt the performance. A touch event, for example, must traverse the display list in order to determine the display objects that are to receive the event.</p><p>When porting to iOS, rendering is often the biggest performance bottleneck. Consider flattening your display list in order to keep your application's frame rate as high as possible.</p><p>We will see how this is done by completely flattening an example nested display list.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec10"/>Getting ready</h2></div></div></div><p>From the book's accompanying code bundle, open<code class="literal"> chapter4\recipe3\recipe.fla</code> into Flash Professional.<a id="id300" class="indexterm"/>
</p><p>The FLA's scene should look familiar. It is the same content that was used in Chapter 2 and  3's  example Bubbles application, except the assets in this FLA have been arranged in a hierarchical structure.</p><p>At the top level is a single container movie clip named<code class="literal"> bubbles</code> that holds all the bubble clips. Within<code class="literal"> bubbles</code> are four additional container clips named<code class="literal"> small, medium, large</code>, and<code class="literal"> huge</code>. These containers are used to store collections of bubbles by size. For example, all the small bubbles are held inside the<code class="literal"> small</code> container.</p><p>The following diagram shows the full hierarchy:</p><div><img src="img/1383_04_02.jpg" alt="Getting ready"/></div><p>Explore the display list within Flash Professional. It isn't too dissimilar to how scenes are constructed in most Flash-based websites and games.</p><p>Let us now flatten this display list by breaking apart movie clips.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec11"/>How to do it...</h2></div></div></div><p>Ensure you are on the root timeline and walk through the following steps:<a id="id301" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Using the<strong> Selection Tool (V)</strong> , click on the<code class="literal"> bubbles</code> movie clip that is sitting on the stage.</li><li class="listitem">Select<strong> Modify</strong> |<strong> Break Apart</strong> <em>(Ctrl + B</em> |<em> Cmd</em> +<em> B).</em><a id="id302" class="indexterm"/><p>The <code class="literal">small, medium, large </code>, and huge movie clips will now be ungrouped from bubbles, which will now have been removed from the display list.
</p></li><li class="listitem">Select the<code class="literal"> small</code> movie clip container by clicking on any of the small bubbles sitting on the stage. Now select<strong> Modify</strong> |<strong> Break Apart</strong> <em>(Ctrl + B</em> |<em> Cmd</em> +<em> B)</em> to break apart the<code class="literal"> small</code> movie clip container, ungrouping the<strong> Bubble Small</strong> instances that are held within it.</li><li class="listitem">Repeat the previous step to break apart the<code class="literal"> medium, large</code>, and<code class="literal"> huge</code> container clips.</li><li class="listitem">You will now need to rename each of the bubble instances to ensure they all have unique names. This wasn't a problem when the clips were grouped within containers but now that they all sit on the same level their names need to be unique. Starting with the small bubbles and working your way to the largest, name the movie clip instances<code class="literal"> bubble1</code> to<code class="literal"> bubble9</code>.</li><li class="listitem">Finally, remove symbols from the library that are no longer required. To do this, move to the<strong> Library</strong> panel and click on<strong> Select Unused Items</strong> from the panel menu. Right-click on one of the highlighted symbols in the library and select<strong> Delete</strong>. All the highlighted symbols will be removed.<div><h3 class="title"><a id="tip14"/>Tip</h3><p>The library's panel menu is represented by a small icon on the top-right corner of the panel. Clicking it reveals a drop-down list of options.</p></div></li><li class="listitem">Save your FLA.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec12"/>How it works...</h2></div></div></div><p>Breaking apart movie-clip instances is an ideal way to flatten the display list. Of course, you can reduce the display list's depth rather than completely flatten it. How far you want to take it really depends on the performance you are after and the complexity of the scene you wish to render.<a id="id303" class="indexterm"/>
</p><p>Instance naming, however, can become a little trickier. A hierarchical structure allows several clips with the same name to co-exist. For example, both the<code class="literal"> small</code> and<code class="literal"> medium</code> movie clips from this recipe's example contained a clip named<code class="literal"> bubble1</code>. Although both clips shared the same name, they belonged to different parent clips, avoiding a naming conflict. However, once flattened, we were left with several clips sitting on the stage that shared the same name.</p><p>If you decide to flatten your display list, then consider carefully the impact this will have on your code. Any target path references will have to be updated and you will need to spend time renaming display object instances to avoid potential naming conflicts. Flattening the display list will also affect the relative<code class="literal"> x</code> and<code class="literal"> y</code> position of display objects. However, if the application you are porting requires a consistent and high frame rate, then it may be your only choice, especially when targeting older devices.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec05"/>Converting vectors to bitmaps</h1></div></div></div><p>Most Flash projects take full advantage of Flash's vector rendering engine and timeline animation system. Rendering vector content, however, can be computationally expensive, particularly with complex vector shapes that contain a large number of control points, gradients, and alpha transparency.<a id="id304" class="indexterm"/>
</p><p>Although even a modest desktop computer can easily render the vector graphics found in most Flash projects; mobile devices are optimized for bitmap graphics meaning compromises need to be made sometimes. Drawing bitmaps is typically less expensive than vectors.</p><p>Where performance is critical, consider converting complex vector artwork into bitmaps. If your project already contains existing vector content, then you can use Flash Professional to produce bitmaps from each library symbol. You can then replace your vector content with the bitmap renditions.</p><p>Let us see how this is done.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec13"/>Getting ready</h2></div></div></div><p>An FLA has been provided as a starting point for this recipe.<a id="id305" class="indexterm"/>
</p><p>From Flash Professional, open<code class="literal"> chapter4\recipe4\recipe.fla</code> from the book's accompanying code bundle.</p><p>You will be working with assets from the previous chapter's example Bubbles application. Although the application previously used bitmaps, the bubble assets within this FLA's library are now represented by vectors.</p><p>Inside the<strong> Library</strong> panel, you will find a movie-clip symbol named<strong> Bubble Vector</strong>. This is a master clip that is used and resized within the four bubble types—<strong> Bubble Small, Bubble Medium, Bubble Large</strong>, and<strong> Bubble Huge</strong>.</p><p>We will now use Flash Professional to convert the vector representation of each bubble into a bitmap.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec14"/>How to do it...</h2></div></div></div><p>Let us start by converting<strong> Bubble Small</strong> to a bitmap:<a id="id306" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">From the<strong> Library</strong> panel, double-click on<strong> Bubble Small</strong>. This will move you to that symbol's timeline.</li><li class="listitem">Select<strong> File</strong> |<strong> Export</strong> |<strong> Export Image</strong> from Flash Professional's drop-down menu.<p>A file-browser window will appear.
</p></li><li class="listitem">Using the browser window, navigate to your FLA's root folder. Within the<strong> Save as type</strong> field, select<strong> PNG</strong> and enter<strong> bubble-small.png</strong> into the<strong> File name</strong> field. Click on the<strong> Save</strong> button.<p>An <strong>Export PNG</strong> dialog box will appear providing export options for the PNG that Flash is about to create as shown in the following screenshot:
</p><div><img src="img/1383_04_03.jpg" alt="How to do it..."/></div></li><li class="listitem">For the<strong> Include</strong> field, select<strong> Minimum Image Area</strong> from the drop-down box. Ensure that the<strong> Colors</strong> field is set to<strong> 24 bit with alpha channel</strong> and that the<strong> Filter</strong> field is set to<strong> None</strong>. In addition, ensure that the<strong> Smooth</strong> checkbox is unchecked.<a id="id307" class="indexterm"/></li><li class="listitem">Click on<strong> OK</strong> to export the PNG.</li><li class="listitem">Now, double-click on<strong> Bubble Medium</strong> from the<strong> Library</strong> panel. Again, select<strong> File</strong> |<strong> Export</strong> |<strong> Export Image</strong> and enter a file name of<strong> bubble-medium.png</strong>. From the<strong> Export PNG</strong> panel, use the same settings as before.</li><li class="listitem">Repeat the process for<strong> Bubble Large</strong> and<strong> Bubble Huge</strong>, exporting them as<strong> bubble-large.png</strong> and<strong> bubble-huge.png</strong> respectively.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec15"/>How it works...</h2></div></div></div><p>You now have four bitmap images—one for each bubble—that you can import into your FLA and replace the vector versions with.</p><p>The<strong> Graphics Processing Units (GPU)</strong>  found on mobile devices, such as the iPhone, are optimized for rendering bitmaps; for many situations you should see a significant performance increase if you opt to use bitmaps instead of vectors.<a id="id308" class="indexterm"/>
</p><p>Your bitmap images will also look consistent whether you use CPU or GPU rendering modes, and with the exception of smoothing will remain relatively unaffected by the stage's render quality. This is in stark contrast to vectors, which are affected by both the rendering mode and stage quality.</p><p>Using CPU render mode utilizes the same software renderer used by the Flash Player installed on desktop computers and also produces the same high quality results. However, this comes at the cost of performance compared to using the GPU rendering pipeline.<a id="id309" class="indexterm"/>
</p><p>Although fast, rendering vectors using the GPU will always result in an approximation of your source artwork. For fast moving content, this may be acceptable but for stationary objects the differences may be noticeable.</p><p>Essentially each rendering path will produce different results when dealing with vectors. CPU rendering is accurate but slower, while the GPU is faster but inaccurate. Both options, however, are typically more computationally expensive than using bitmaps.</p><p>Where appropriate, replace your complex vector artwork with bitmaps. However, be aware that bitmaps can significantly increase the size of your final<code class="literal"> .ipa</code> file compared to vectors. The larger your IPA becomes, the longer your app will take to load and the more memory it will consume. Increased memory consumption itself can lead to degradation in performance.</p><p>Additionally, Apple currently imposes an over-the-air download limit of 20 MB. It is important your IPA doesn't exceed this limit as it prevents users from downloading your app over carrier networks and may affect sales.</p><p>Take a look at<code class="literal"> chapter4\recipe4-final\recipe.fla</code> to see the exported PNGs being used in place of the original vector artwork.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec16"/>There's more...</h2></div></div></div><p>Intelligent use of bitmaps is vital in order to maximize the performance of your app. You may find the following options and information helpful in achieving this.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec05"/>Export as Bitmap</h3></div></div></div><p>For those using Flash Professional CS5.5, a more convenient option is available that allows you to instruct Flash to export bitmap representations of vector movie clips during publication. This not only provides you with optimized bitmap content for your app but also maintains the original vector artwork within the FLA.<a id="id310" class="indexterm"/>
</p><p>To export a symbol as a bitmap, first select the symbol from the stage. Then from the<strong> Properties</strong> panel, expand the<strong> DISPLAY</strong> section and select<strong> Export as Bitmap</strong> from the<strong> Render</strong> field's drop-down box. If your clip requires transparency, then also ensure that the drop-down box directly beneath is set to<strong> Transparent</strong>.</p><p>Export as Bitmap is not available in Flash CS5.<a id="id311" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec06"/>Convert to Bitmap</h3></div></div></div><p>An additional option named<strong> Convert to Bitmap</strong> is available from Flash Professional CS5.5 that converts vector symbols to bitmaps. Although<strong> Export as Bitmap</strong> does not alter your FLA's display list, this option replaces instances on the stage with a bitmap representation. The new bitmap representation is added to the library allowing you to make further edits using an image editor such as Adobe Photoshop.<a id="id312" class="indexterm"/>
</p><p>To convert a symbol to a bitmap, simply right-click on an instance of it on the stage and select<strong> Convert to Bitmap</strong> from the context menu.</p><p>Convert to Bitmap is not available in Flash CS5.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec07"/>Working with timeline animation</h3></div></div></div><p>Vector-based timeline animations may further impact performance. This is especially true of complex tweens, which can be extremely expensive operations. On lower-end devices, such as the first and second generation iPhones and iPod touches, even relatively simple tweens can perform poorly. However, with the huge rendering improvements made since AIR 2.6 combined with the ever increasing hardware specification of each new generation of iOS device, this is becoming less of an issue. Remember, Apple itself no longer supports first and second generation devices.<a id="id313" class="indexterm"/>
</p><p>If you are experiencing performance issues with a timeline animation, then consider exporting each frame of your animation as a PNG. Its length will be an important factor as bitmap-based animation can consume considerable memory and increase load time. In such cases you may need to make-do with a vector implementation or consider re-working the animation to make it suitable for mobile.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec08"/>Targeting multiple screen sizes</h3></div></div></div><p>The screen resolution varies across iOS devices. For example, the iPhone 3GS has a resolution of 320x480 whereas the iPhone 4 supports 640x960 pixels.<a id="id314" class="indexterm"/>
</p><p>When targeting multiple screen sizes, consider creating different sized versions of your bitmaps—one for each screen resolution. This will avoid image quality degradation due to bitmap scaling and will also prevent any performance issues associated with scaling content.</p><p>Creating multiple versions of each bitmap will increase the final file size of your IPA but if performance is a priority, then it is likely to be worth the effort.</p><p>If you would rather avoid the overheads of bundling multiple bitmaps within your application, then it is also possible to scale vector artwork at runtime before storing a bitmap representation of it in memory. This technique is know as bitmap caching and is explored in detail in<a class="link" href="ch06.html" title="Chapter 6. Graphics and Hardware Acceleration"> Chapter 6</a>.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec09"/>Pre-rendering filters and blends</h3></div></div></div><p>Filters are often used in Flash projects to add visual effects such as drop shadows, beveled edges, and blur to display objects. Although filters can add impact to your application, they can seriously affect performance. This is especially true on iOS devices where the CPU speeds are limited compared to desktop computers. Additionally, in Flash Professional CS5.5, filters are no longer supported when using the GPU rendering pipeline.<a id="id315" class="indexterm"/>
</p><p>It is recommended that you pre-render the graphical effects into the artwork, rather than applying filters at runtime using Flash. This will aid device performance and also ensure your effects work across both CPU and GPU rendering modes.</p><p>Rather than using an image editor to completely recreate the effects from scratch, you can use Flash Professional to create a bitmap representation of any filters applied to display objects on the stage. There are various ways to do this, including setting the instance's render property to<strong> Export as Bitmap</strong>, converting the whole library clip to a bitmap, or exporting a PNG image before re-importing it into Flash.</p><p>Non-normal blend modes are also expensive operations and should be 'baked' into your artwork in a similar fashion to filters.</p></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec17"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Adding content to the stage, <a class="link" href="ch02.html" title="Chapter 2. Building iOS Apps Using Flash">Chapter 2</a></em></li><li class="listitem" style="list-style-type: disc"><em>Comparing vector and bitmap graphics, <a class="link" href="ch06.html" title="Chapter 6. Graphics and Hardware Acceleration">Chapter 6</a></em></li><li class="listitem" style="list-style-type: disc"><em>Using Cache as Bitmap, <a class="link" href="ch06.html" title="Chapter 6. Graphics and Hardware Acceleration">Chapter 6</a></em></li><li class="listitem" style="list-style-type: disc"><em>Targeting the Retina display, <a class="link" href="ch08.html" title="Chapter 8. Screen Resolution and Orientation Changes">Chapter 8</a></em></li><li class="listitem" style="list-style-type: disc"><em>Supporting multiple resolutions, <a class="link" href="ch08.html" title="Chapter 8. Screen Resolution and Orientation Changes">Chapter 8</a></em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec06"/>Resizing bitmaps</h1></div></div></div><p>It is a common occurrence to see scaling being applied to bitmaps unnecessarily within Flash projects. Resizing bitmaps at runtime can be computationally expensive and degrades the image quality. Doing so can also result in a larger IPA file if the included artwork is actually larger than its intended display size.<a id="id316" class="indexterm"/>
</p><p>Let us see how to resize existing bitmap artwork within Flash Professional.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec18"/>Getting ready</h2></div></div></div><p>From Flash Professional, open<code class="literal"> chapter4\recipe5\recipe.fla</code> from the book's accompanying code bundle.</p><p>Again, you will be working with the familiar visuals from Chapter 2 and 3's example Bubbles application. The assets for this recipe are made up of both vectors and bitmaps. The bubbles themselves are vectors, whereas the background image and the Flash logo are bitmaps. The bitmaps have been scaled to fit the screen. To see the comparison in size between the scaled instances on the stage and the original bitmaps stored in the library, you may want to drag both<strong> background.png</strong> and<strong> flash-logo.png</strong> onto the stage. Delete both from the stage before continuing.</p><p>Let us use Flash Professional to resize the bitmaps stored within the library, preventing the need for Flash to do this at runtime.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec19"/>How to do it...</h2></div></div></div><p>Resize the bitmaps by following the steps:<a id="id317" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">From the<strong> Library</strong> panel, double-click on<strong> Bubble Huge</strong>. This will move you to that symbol's timeline where you will see an instance of the<strong> Huge Bubble with Logo</strong> symbol.</li><li class="listitem">Move inside this symbol by again double-clicking on it.<p>On its timeline you will see two layers—<strong>Bubble</strong> and <strong>Logo</strong>. The <strong>Logo</strong> layer contains a bitmap representation of the Flash logo. This clip has been scaled down from 894x894 pixels to 200x200 pixels. Let us create a new version of this bitmap that is already scaled to the correct size.
</p></li><li class="listitem">From the<strong> Library</strong>, right-click on<strong> flash-logo.png</strong> and select<strong> Edit with</strong> from the context menu. When prompted, browse to and select an external editor such as Adobe Photoshop.<a id="id318" class="indexterm"/></li><li class="listitem">Within your editor, resize the image to 200x200 pixels and save it.</li><li class="listitem">Move back to Flash Professional.<p>You should now see the new version of the logo within the bubble, however, the logo will now be significantly smaller than the intended size. This is because the scale transformation that was originally applied to the 894x894 version is still being applied to the new bitmap.
</p></li><li class="listitem">Lock the<strong> Bubble</strong> layer and click on the bitmap sitting on the<strong> Logo</strong> layer. From the<strong> Properties</strong> panel, change the width and height settings to the source bitmap's exact dimensions of 200x200.</li><li class="listitem">From the library, double-click on the<strong> Background</strong> movie-clip symbol.<p>This clip uses a bitmap named <strong>background.png</strong>, which is actually 640x960 pixels scaled down to 320x480. Again let us resize this bitmap within an image editor, preventing the need for it to be scaled within your app at runtime.
</p></li><li class="listitem">Find<strong> background.png</strong> within the library. Right-click on it and select to edit the bitmap using the image editor of your choice. Resize the image to 320x480 and save it.</li><li class="listitem">Move back to Flash Professional. Using the<strong> Selection Tool (V)</strong> , click on<strong> background.png</strong> sitting within the<strong> Background</strong> movie-clip symbol and set its width to 320 and its height to 480.<a id="id319" class="indexterm"/></li><li class="listitem">Save your FLA.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec20"/>How it works...</h2></div></div></div><p>You have successfully replaced the FLA's existing bitmaps with new versions that have been pre-rendered to the size they are intended to be viewed at. This will save valuable CPU cycles as there is no need to scale down the bitmaps at runtime. Resizing bitmaps can also reduce the overall size of your SWF significantly as long as those bitmaps were originally being scaled-down at runtime rather than being increased in size.<a id="id320" class="indexterm"/>
</p><p>Take a look at<code class="literal"> chapter4\recipe5-final\recipe.fla</code> to see the resized bitmaps being used in place of the original oversized bitmaps. When running on a more recent device, it may be difficult to notice any discernable difference in performance between the original version <code class="literal">(recipe5\recipe.fla)</code> and the final version <code class="literal">(recipe5-final\recipe.fla)</code>, but for lower-end devices or more demanding projects, the gains can be significant.<a id="id321" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec21"/>There's more...</h2></div></div></div><p>The following information will also be of benefit to you when resizing or optimizing assets.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec10"/>Targeting multiple screen sizes</h3></div></div></div><p>The screen resolution varies across iOS devices. For example, the iPhone 3GS has a resolution of 320x480 whereas the iPhone 4 supports 640x960 pixels.<a id="id322" class="indexterm"/>
</p><p>When writing apps that target multiple screen sizes, you could be tempted to simply scale your bitmap content at runtime to fit each resolution. If you take this approach, then be aware that you may experience performance issues if your app attempts to render complex scenes at high frame rates. Additionally, the quality of your bitmaps will suffer as they are scaled.</p><p>Instead, consider creating different versions of each asset—one for each screen size you wish to support. Of course, having multiple versions of each asset will increase the final file size of your IPA but the end result will likely be worth the effort.</p><p>If you must resize your images at runtime, then you can take advantage of hardware acceleration to scale bitmaps with less impact on performance. You can find out more in<a class="link" href="ch06.html" title="Chapter 6. Graphics and Hardware Acceleration"> Chapter 6</a>.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec11"/>Optimizing vector shapes</h3></div></div></div><p>While this recipe has focused primarily on bitmaps, it is all too easy to create unnecessarily detailed vector content, which impacts rendering time and also bloats the size of your<code class="literal"> .ipa</code> file.<a id="id323" class="indexterm"/>
</p><p>To reduce the number of calculations required to draw your vector artwork, spend time removing unnecessary control points. With intelligent use of the<strong> Subselection Tool (A)</strong>  and the<strong> Delete Anchor Point Tool (-)</strong> , you can simplify the paths within your assets without any perceptual reduction in image quality.<a id="id324" class="indexterm"/>
</p><p>The screen's pixel density makes it harder for a user to see much of the detail they would normally notice on a standard monitor. Removing unnecessary control points reduces the final size of your IPA and also improves rendering performance.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec12"/>Stage quality</h3></div></div></div><p>You can further increase performance by reducing the stage render quality used by your app. At present there are three quality settings available for iOS—low, medium, and high (AIR 2.0-2.7 supports only low and medium). By default, AIR for iOS uses the medium setting but you can change this in ActionScript by setting the<code class="literal"> Stage.quality</code> property to one of the constants provided by the<code class="literal"> flash.display.StageQuality</code> class.<a id="id325" class="indexterm"/>
</p><p>For example, adding the following line of code to your document class will use the lowest render quality setting:</p><div><pre class="programlisting">stage.quality = StageQuality.LOW;
</pre></div><p>The stage render quality is a global setting and is applied to all vector content within your application. However, bitmaps remain relatively unaffected and, with the exception of smoothing, will look identical across all quality settings. This conveniently allows you to get the highest level of performance from your vector assets without compromising the quality of any bitmaps within your application.</p></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec22"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Converting vectors to bitmaps</em></li><li class="listitem" style="list-style-type: disc"><em>Comparing vector and bitmap graphics, <a class="link" href="ch06.html" title="Chapter 6. Graphics and Hardware Acceleration">Chapter 6</a></em></li><li class="listitem" style="list-style-type: disc"><em>Using Cache as Bitmap Matrix, <a class="link" href="ch06.html" title="Chapter 6. Graphics and Hardware Acceleration">Chapter 6</a></em></li><li class="listitem" style="list-style-type: disc"><em>Targeting the Retina display, <a class="link" href="ch08.html" title="Chapter 8. Screen Resolution and Orientation Changes">Chapter 8</a></em></li><li class="listitem" style="list-style-type: disc"><em>Supporting multiple resolutions, <a class="link" href="ch08.html" title="Chapter 8. Screen Resolution and Orientation Changes">Chapter 8</a></em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec07"/>Masking content</h1></div></div></div><p>Mask layers are frequently used throughout Flash projects to partially reveal content sitting on layers directly beneath the mask. The mask itself can be a filled shape, text, an instance of a graphic symbol, or a movie clip. Dynamic effects can even be created by applying shape or motion tweening to your masks.<a id="id326" class="indexterm"/>
</p><p>This level of flexibility and sophistication can place a lot of demand on the CPU, leading to a drop in frame rate. Although desktop computers can handle most masking operations, the same effects will degrade the performance of your iOS apps. Wherever possible, limit your use of masks. For existing projects, rather than use masks, obscure your content with other clips that sit on top of it.</p><p>In this recipe we will do just that; removing a mask layer and instead using two movie clips to obscure the content that was previously clipped by the mask.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec23"/>Getting ready</h2></div></div></div><p>From the book's accompanying code bundle, open<code class="literal"> chapter4\recipe6\recipe.fla</code> into Flash Professional.</p><p>The FLA shows a credits screen from a game. A mask layer is used to clip the credits text as it scrolls vertically upwards, ensuring that only text within a rectangular region in the center of the screen is shown.</p><p>To see the masked area for yourself, unlock the<strong> Mask</strong> layer within the FLA's timeline. Any text that scrolls into this region will be rendered on screen. Text that falls outside this region will be hidden. The text itself is a movie clip that sits on the<strong> Credits</strong> layer and is attached directly below the mask layer. Lock the layer again to re-apply the mask. The following screenshot shows the mask region and how the screen will look when the mask is applied to the credits text:<a id="id327" class="indexterm"/>
</p><div><img src="img/1383_04_04.jpg" alt="Getting ready"/></div><p>Test the FLA in ADL by selecting<strong> Control</strong> |<strong> Test Movie</strong> |<strong> in AIR Debug Launcher (Mobile) </strong> <em> (Ctrl + Enter</em> |<em> Cmd</em> +<em> Enter).</em>
<a id="id328" class="indexterm"/>
</p><p>Now publish the FLA for iOS and deploy the resulting IPA to your device. On older iOS devices such as first and second generation iPhones and iPod touches, you may find that the performance is seriously impaired. Masks are particularly problematic on older hardware. Remove the app from your device before proceeding.<a id="id329" class="indexterm"/>
</p><p>Let us now go through the steps required to remove the mask and instead obscure the credits text using movie clips.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec24"/>How to do it...</h2></div></div></div><p>We will start by removing the mask layer.<a id="id330" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Right-click on the<strong> Mask</strong> layer on the timeline and select<strong> Delete Layers</strong> from the context menu.<div><img src="img/1383_04_05.jpg" alt="How to do it..."/></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">Now let us copy some new library symbols into your FLA.</li></ul></div></li><li class="listitem">Select<strong> File</strong> |<strong> Open</strong> and browse to<code class="literal"> chapter4\recipe6\resources\resources.fla</code>. Click on<strong> Open</strong> to load the FLA.<a id="id331" class="indexterm"/></li><li class="listitem">Copy all the library symbols from<code class="literal"> resources.fla</code> and paste them into the library of<code class="literal"> recipe.fla</code>.<p>The two new movie-clip symbols you copied—<strong>Background Top</strong> and <strong>Background Bottom</strong>—will be used to obscure any credits text that is outside the rectangular region that was previously defined by the mask.
</p></li><li class="listitem">Create a new layer directly above the<strong> Credits</strong> layer and name it<strong> Background Front</strong>.<div><img src="img/1383_04_06.jpg" alt="How to do it..."/></div></li><li class="listitem">Drag an instance of<strong> Background Top</strong> from the library onto the<strong> Background Front</strong> layer. From the<strong> Properties</strong> panel, assign the position of x and y to<code class="literal"> 0</code> for the instance. If you are using Flash Professional CS5, then you should also expand the<strong> DISPLAY</strong> section and check the<strong> Cache as bitmap</strong> checkbox.</li><li class="listitem">Also, drag an instance of<strong> Background Bottom</strong> from the library onto the<strong> Background Front</strong> layer. Set its x position to<code class="literal"> 0</code> and its y position to<code class="literal"> 385</code>. Again, if you are using Flash Professional CS5, then within the<strong> DISPLAY</strong> section, check the<strong> Cache as bitmap</strong> checkbox.</li><li class="listitem">Save your FLA and test using ADL <em> (Ctrl + Enter</em> |<em> Cmd</em> +<em> Enter).</em><a id="id332" class="indexterm"/></li><li class="listitem">Finally, publish and deploy to your device. If you are using an older generation device, then the performance improvement will be significant.<a id="id333" class="indexterm"/></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec25"/>How it works...</h2></div></div></div><p>Although the implementation is different, the end result should be identical to the original mask layer implementation. However, using movie clips to obscure content is less computationally expensive compared to clipping with masks.</p><p>Obscuring is a fairly simple technique. In this example, two new clips were used that contained bitmap content from the FLA's background image. The credits text was then sandwiched between the original background image and the two new clips, giving the illusion that a mask was being applied to the text.</p><p>You may not be familiar with the<strong> Cache as bitmap</strong> render option. It is used in this example to take advantage of GPU acceleration for apps built using Flash Professional CS5. Cache as Bitmap and GPU acceleration will be covered in more detail in<a class="link" href="ch06.html" title="Chapter 6. Graphics and Hardware Acceleration"> Chapter 6</a>.<a id="id334" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec26"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Using Cache as Bitmap, <a class="link" href="ch06.html" title="Chapter 6. Graphics and Hardware Acceleration">Chapter 6</a></em></li><li class="listitem" style="list-style-type: disc"><em>Using Cache as Bitmap Matrix, <a class="link" href="ch06.html" title="Chapter 6. Graphics and Hardware Acceleration">Chapter 6</a></em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec08"/>Working with external SWFs</h1></div></div></div><p>To reduce the initial load time, web-based Flash projects often keep resources such as graphics in separate<code class="literal"> .swf</code> files that are loaded on demand. For example, a game that is split across multiple levels may have an external SWF for each level. When the player completes a level, the SWF containing the next level's resources is loaded at runtime.<a id="id335" class="indexterm"/>
</p><p>Due to restrictions put in place by Apple, iOS applications cannot run interpreted code from an external source. This causes a problem for anyone hoping to load external SWFs that contain class files or ActionScript embedded within the timelines of library symbols. There is currently no way to create an external SWF that contains native ARM machine code.</p><p>If you are attempting to port a Flash project that loads external SWFs that contain ActionScript, then you will need to include the resources directly within your iOS app instead. Any resource files need to be published as SWC files rather than SWFs, allowing them to be statically linked and compiled with your iOS app.<a id="id336" class="indexterm"/>
</p><p>Let us see how to do that.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec27"/>Getting ready</h2></div></div></div><p>We will require the use of various files from the book's accompanying code bundle. A resources FLA has been provided at<code class="literal"> chapter4\recipe7\resources\assets.fla</code>. It is this FLA that we will publish as a<code class="literal"> .swc</code> file and statically link to a second FLA,<code class="literal"> chapter4\recipe7\recipe.fla.</code>
<a id="id337" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec28"/>How to do it...</h2></div></div></div><p>This recipe is broken into two main steps. First, we will publish a SWC from the resources FLA, then we will statically link the SWC to our application's FLA.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec13"/>Publishing a SWC</h3></div></div></div><p>Let us begin by creating a SWC from<code class="literal"> assets.fla.</code>
<a id="id338" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Open<code class="literal"> chapter4\recipe7\resources\assets.fla</code> into Flash Professional.<p>This FLA contains a collection of resources intended to be loaded and used by <code class="literal">recipe.fla</code>. The FLA's stage is empty but within its library you will find movie-clip symbols with linkage IDs, allowing them to be instantiated and added to the display list at runtime.
</p><p>Now let us configure the FLA's publish settings, allowing a <code class="literal">.swc </code> file to be exported from its SWF.
</p></li><li class="listitem">Select<strong> File</strong> |<strong> Publish Settings</strong> from the drop-down menu.<p>How you proceed depends on the version of Flash Professional that you are using. For Flash CS5.5, uncheck the <strong>Flash (.swf)</strong> checkbox and check on the <strong>SWC</strong> checkbox within the <strong>PUBLISH</strong> section. If you are using CS5, then click on the <strong>Flash</strong> tab before clicking on the <strong>Export SWC</strong> checkbox from the <strong>SWF Settings</strong> section.
</p></li><li class="listitem">Click on<strong> OK</strong> to set the changes and close the<strong> Publish Settings</strong> panel.<a id="id339" class="indexterm"/></li><li class="listitem">Save the changes to the FLA and then publish it by selecting<strong> File</strong> |<strong> Publish</strong> <em>(Alt + Shift</em> +<em> F12</em> |<em> Shift</em> +<em> Cmd</em> +<em> F12)</em> from the drop-down menu. A file named<code class="literal"> assets.swc</code> will be output to the same folder as your FLA.<a id="id340" class="indexterm"/></li></ol></div></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec14"/>Statically linking the SWC</h3></div></div></div><p>Now, let us write a simple iOS app and statically link the assets SWC to it.<a id="id341" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Start by opening<code class="literal"> chapter4\recipe7\recipe.fla</code> into Flash Professional.</li><li class="listitem">Create a document class. Name the class<code class="literal"> Main</code> and add the following code to it:<div><pre class="programlisting">package {
import flash.display.Sprite;
public class Main extends Sprite {
public function Main() {
var background:Background = new Background();
background.x = 0;
background.y = 0;
addChild(background);
var bubble:BubbleHuge = new BubbleHuge();
bubble.x = stage.stageWidth / 2;
bubble.y = stage.stageHeight / 2;
addChild(bubble);
}
}
}
</pre></div></li><li class="listitem">Save the document class.</li><li class="listitem">Move back to your FLA and select<strong> File</strong> |<strong> ActionScript Settings</strong> from the drop-down menu. This will open the<strong> Advanced ActionScript 3.0 Settings</strong> panel where you can statically link<code class="literal"> assets.swc</code> to your app.<div><img src="img/1383_04_07.jpg" alt="Statically linking the SWC"/></div></li><li class="listitem">To do this, first click on the<strong> Library path</strong> tab, then click on the<strong> Add New Path</strong> icon, which is represented by a<strong> +</strong> symbol. Now click on the<strong> Browse to SWC file</strong> icon. Browse to and select your<code class="literal"> assets.swc</code> file. It will be added to a list of SWC files to be included with your app when published. Expand the assets SWC entry by clicking on the icon to the left of its path. Ensure that its<strong> Link Type</strong> is set to<strong> Merged into code</strong>.<a id="id342" class="indexterm"/></li><li class="listitem">Close the<strong> Advanced ActionScript 3.0 Settings</strong> panel by clicking on the<strong> OK</strong> button at the bottom.<a id="id343" class="indexterm"/></li><li class="listitem">Save your FLA.</li><li class="listitem">Publish and test your FLA within ADL <em> (Ctrl + Enter</em> |<em> Cmd</em> +<em> Enter)</em>. The app should instantiate and add to its display list the<strong> Background</strong> and<strong> Bubble Huge</strong> symbols from the<code class="literal"> assets.swc</code>.</li><li class="listitem">Finally, publish and deploy the app for iOS and ensure that it works as expected on your device.<a id="id344" class="indexterm"/></li></ol></div></div></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec29"/>How it works...</h2></div></div></div><p>We created a SWC file from the assets FLA and statically linked it to our iOS app. A SWC file is a package containing precompiled Flash symbols and ActionScript code. While SWC files can normally be loaded at runtime, you must statically link SWCs when writing apps that target iOS. This guarantees that Flash Professional compiles the SWC's ActionScript bytecode into native ARM machine code.<a id="id345" class="indexterm"/>
</p><p>The document class in this recipe's example simply uses the linkage IDs associated with the assets SWC's library symbols to instantiate and add objects to the app's display list. Specifically the class creates and displays an instance of<code class="literal"> Background</code> and an instance of<code class="literal"> BubbleHuge</code> from<code class="literal"> assets.swc</code>.</p><p>You should consider the total size of the resource files you will have to link to your iOS app. All statically linked content must be loaded up-front and will impact your app's initial load time and the amount of memory it consumes. With large projects, you run the risk of the app being closed by iOS if memory consumption is too high. The memory threshold will vary from device to device and will also depend upon the number of apps held in the background.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec30"/>There's more...</h2></div></div></div><p>Loading external SWF files isn't impossible but you are limited in what you can do.</p><p>The SWF cannot contain any ActionScript, including the assignment of linkage IDs to library symbols. This prevents you from being able to dynamically instantiate any of the SWF's library symbols from within your app. It is also not possible to lace ActionScript within your SWF's timeline to perform simple programmatic control of your animations.</p><p>You can however, place content on the SWF's stage; load the SWF into your app; then add the SWF to the display list. You can also embed sound within the external SWF's timeline and have it played back. Additionally, ActionScript calls can be made from your app to the external SWF, allowing programmatic control of instances within its display list. It is limited compared to what many Flash developers are used to but there are still uses for external SWFs in your iOS projects.<a id="id346" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec31"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Creating a basic document class, <a class="link" href="ch03.html" title="Chapter 3. Writing your First App">Chapter 3</a></em></li><li class="listitem" style="list-style-type: disc"><em>Linking classes to movie-clip symbols, <a class="link" href="ch03.html" title="Chapter 3. Writing your First App">Chapter 3</a></em></li></ul></div></div></div></body></html>