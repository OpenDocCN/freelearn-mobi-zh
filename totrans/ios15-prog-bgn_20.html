<html><head></head><body>
		<div id="_idContainer418">
			<h1 id="_idParaDest-243"><em class="italic"><a id="_idTextAnchor248"/>Chapter 17</em>: Getting Started with JSON Files</h1>
			<p>In the previous chapter, you configured the <strong class="bold">Map</strong> screen to display a list of restaurants using data from a <strong class="source-inline">.plist</strong> file. You configured custom annotations for each restaurant location and configured the callout buttons in them to present the <strong class="bold">Restaurant Detail</strong> screen when tapped. You also organized your code using extensions to make it easier to read and maintain.</p>
			<p>In this chapter, you will use data stored in <strong class="bold">JavaScript Object Notation</strong> (<strong class="bold">JSON</strong>) format to populate the <strong class="bold">Map</strong> and <strong class="bold">Restaurant Detail</strong> screens. You'll start by learning about the JSON format, create a data manager class that can load data from JSON files, and modify the <strong class="bold">MapViewController </strong>class to display a list of restaurants from a JSON file instead of a <strong class="source-inline">.plist</strong> file. Next, you'll configure the <strong class="source-inline">LocationViewController</strong> class to store the location selected by the user in the <strong class="bold">Locations</strong> screen and pass it to the <strong class="source-inline">ExploreViewController</strong> instance when the <strong class="bold">Done</strong> button is tapped. After that, you'll configure the <strong class="source-inline">ExploreViewController</strong> class to pass the selected location and cuisine to the <strong class="source-inline">RestaurantListViewController</strong> instance when a type of cuisine is selected. Finally, the <strong class="source-inline">RestaurantListViewController</strong> class will then be modified to get a list of restaurants from a JSON file corresponding to the selected location and cuisine and display them in the <strong class="bold">Restaurant List</strong> screen.</p>
			<p>By the end of this chapter, you'll know how to load and parse data from JSON files for use in your own apps. You'll also learn about <strong class="source-inline">UITableViewDelegate</strong> methods and ways to pass data from one view controller to another.</p>
			<p>The following topics will be covered:</p>
			<ul>
				<li>Getting data from JSON files</li>
				<li>Using data from JSON files in your app</li>
				<li>Configuring the <strong class="source-inline">MapDataManager</strong> instance to use data from the <strong class="source-inline">RestaurantDataManager</strong> instance</li>
				<li>Storing a user-selected location</li>
				<li>Passing location and cuisine information to the <strong class="source-inline">RestaurantListViewController</strong> instance</li>
			</ul>
			<h1 id="_idParaDest-244"><a id="_idTextAnchor249"/>Technical requirements</h1>
			<p>You will continue working on the <strong class="source-inline">LetsEat</strong> project that you modified in the previous chapter.</p>
			<p>The resource files and completed Xcode project for this chapter are in the <strong class="source-inline">Chapter17 </strong>folder of the code bundle for this book, which can be downloaded here:</p>
			<p><a href="https://github.com/PacktPublishing/iOS-15-Programming-for-Beginners-Sixth-Edition">https://github.com/PacktPublishing/iOS-15-Programming-for-Beginners-Sixth-Edition</a></p>
			<p>Check out the following video to see the code in action:</p>
			<p><a href="https://bit.ly/3Hl8Ulz">https://bit.ly/3Hl8Ulz</a></p>
			<p>Let's start by learning how to read and parse JSON files to get data for use in your app.</p>
			<h1 id="_idParaDest-245"><a id="_idTextAnchor250"/>Getting data from JSON files</h1>
			<p>In <a href="B17469_14_Final_VK_ePub.xhtml#_idTextAnchor201"><em class="italic">Chapter 14</em></a><em class="italic">, Getting Data into Collection Views</em>, you learned how to load a file, read data <a id="_idIndexMarker865"/>from it using a data manager class, and put it into <a id="_idIndexMarker866"/>objects in your app. In this chapter, you will also do the same thing, the difference is that you will be reading data from a JSON file instead of a <strong class="source-inline">.plist</strong> file. This will simulate reading data from an online web-based service, where JSON is a commonly used format. Let's start by learning more about JSON files and how they work.</p>
			<h2 id="_idParaDest-246"><a id="_idTextAnchor251"/>Understanding the JSON format</h2>
			<p>JavaScript <a id="_idIndexMarker867"/>Object Notation (JSON) is a way to structure data in a file that can be easily read by both people and computers. Many iOS apps work with an online web-based service to access JSON files, which are then used to provide the app with data. </p>
			<p>You will not be learning about how to connect to an online service in this chapter. Instead, you will use sample JSON files downloaded from <a href="http://opentable.herokuapp.com">http://opentable.herokuapp.com</a>, which have been modified by Craig Clayton for this book. As you will see, working with JSON files is similar to working with <strong class="source-inline">.plist</strong> files. </p>
			<p>To help you to understand the JSON format, you will add the sample JSON files to your project and look at the structure of one of them. Follow these steps:</p>
			<ol>
				<li>In the Project navigator, create a new group inside the <strong class="source-inline">Misc</strong> folder and name it <strong class="source-inline">JSON</strong>. </li>
				<li>If you have not yet downloaded the project files for this chapter, go ahead and download them from this link: <a href="https://github.com/PacktPublishing/iOS-15-Programming-for-Beginners-Sixth-Edition">https://github.com/PacktPublishing/iOS-15-Programming-for-Beginners-Sixth-Edition</a>.</li>
				<li>Unzip the <a id="_idIndexMarker868"/>folder and open the <strong class="source-inline">resources</strong> folder in the <strong class="source-inline">Chapter17</strong> folder. You should see several JSON files inside. </li>
				<li>Drag all of the JSON files there into the <strong class="source-inline">JSON</strong> folder you just created. </li>
				<li>Click <strong class="bold">Finish</strong> on the screen that appears. </li>
				<li>Each JSON file contains restaurant details for a particular city. Click <strong class="source-inline">Charleston.json</strong> and you should see the following:</li>
			</ol>
			<div>
				<div id="_idContainer391" class="IMG---Figure">
					<img src="image/Figure_17.01_B17469.jpg" alt="Figure 17.1: Editor area showing contents for Charleston.json&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 17.1: Editor area showing contents for Charleston.json</p>
			<p>As you can see, the file starts with an opening square bracket, and each item inside consists of key-value pairs containing restaurant information, enclosed by curly braces and separated by commas. At the very end of the file, you can see a closing square bracket. The square brackets denote arrays, and the curly braces denote dictionaries. In other words, the JSON file contains an array of dictionaries, exactly the same as the <strong class="source-inline">.plist</strong> files you have been using earlier.</p>
			<p>Now that you have seen what a JSON file looks like, let's create a data manager class to load data from <a id="_idIndexMarker869"/>JSON files into your app in the next section.</p>
			<h2 id="_idParaDest-247"><a id="_idTextAnchor252"/>Creating the RestaurantDataManager class</h2>
			<p>You have<a id="_idIndexMarker870"/> learned how to create a data<a id="_idIndexMarker871"/> manager class to load data from a <strong class="source-inline">.plist</strong> file in <a href="B17469_14_Final_VK_ePub.xhtml#_idTextAnchor201"><em class="italic">Chapter 14</em></a><em class="italic">, Getting Data into Collection Views</em>. You will now create <strong class="source-inline">RestaurantDataManager</strong>, a data manager class that loads data from the JSON files that you added to your project earlier. As you will see, loading data from a JSON file will be similar to loading data from a <strong class="source-inline">.plist</strong> file.</p>
			<p class="callout-heading">Important Information</p>
			<p class="callout">To learn more about parsing JSON files, watch the video available here: <a href="https://developer.apple.com/videos/play/wwdc2017/212/">https://developer.apple.com/videos/play/wwdc2017/212/</a>.</p>
			<p>Before you create the <strong class="source-inline">RestaurantDataManager</strong> class, you'll need to modify the <strong class="source-inline">RestaurantItem</strong> class so it conforms to the <strong class="source-inline">Decodable</strong> protocol. Adopting this protocol allows you to use the <strong class="source-inline">JSONDecoder</strong> class to populate <strong class="source-inline">RestaurantItem</strong> instances using data from JSON files.</p>
			<p class="callout-heading">Important Information</p>
			<p class="callout">To learn more about Decodable and the JSON Decoder class, see these links:</p>
			<p class="callout"><a href="https://developer.apple.com/documentation/foundation/archives_and_serialization/encoding_and_decoding_custom_types">https://developer.apple.com/documentation/foundation/archives_and_serialization/encoding_and_decoding_custom_types</a></p>
			<p class="callout"><a href="https://developer.apple.com/documentation/foundation/jsondecoder">https://developer.apple.com/documentation/foundation/jsondecoder</a></p>
			<p>To modify the <strong class="source-inline">RestaurantItem</strong> class so it conforms to the <strong class="source-inline">Decodable</strong> protocol, follow these steps: </p>
			<ol>
				<li value="1">In the Project navigator, click the <strong class="source-inline">RestaurantItem</strong> file inside the <strong class="source-inline">Model</strong> folder in the <strong class="source-inline">Map</strong> folder. Modify the class declaration for <strong class="source-inline">RestaurantItem</strong> as shown to adopt the <strong class="source-inline">Decodable</strong> protocol:<p class="source-code">class RestaurantItem: NSObject, MKAnnotation<strong class="bold">, </strong></p><p class="source-code"><strong class="bold">Decodable {</strong></p></li>
				<li>Remove the <strong class="source-inline">init()</strong> method and add the following enumeration to make the <strong class="source-inline">RestaurantItem</strong> class<a id="_idIndexMarker872"/> conform <a id="_idIndexMarker873"/>to the <strong class="source-inline">Decodable</strong> protocol:<p class="source-code">enum CodingKeys: String, CodingKey {</p><p class="source-code">   case name</p><p class="source-code">   case cuisines </p><p class="source-code">   case lat</p><p class="source-code">   case long </p><p class="source-code">   case address</p><p class="source-code">   case postalCode = "postal_code" </p><p class="source-code">   case state</p><p class="source-code">   case imageURL = "image_url"</p><p class="source-code">   case restaurantID = "id"</p><p class="source-code">}</p><p>The <strong class="source-inline">CodingKeys</strong> enumeration matches the <strong class="source-inline">RestaurantItem</strong> class properties to the keys in the JSON file. This allows the <strong class="source-inline">JSONDecoder</strong> instance to get values from the JSON file and assign them to properties in the <strong class="source-inline">RestaurantItem</strong> class. If the key name does not match the property name, you can map the key to the property, as shown in the preceding code block for <strong class="source-inline">postalCode</strong>, <strong class="source-inline">imageURL</strong>, and restaurantID.</p><p>After you modify the <strong class="source-inline">RestaurantItem</strong> class, you'll see an error in the <strong class="source-inline">fetch(completion:)</strong> method in the <strong class="source-inline">MapDataManager</strong> file. Don't worry about it as you will fix it in the next section.</p></li>
			</ol>
			<p>Now let's create the <strong class="source-inline">RestaurantDataManager</strong> class, which will read the JSON file and put the data into an array of <strong class="source-inline">RestaurantItem</strong> instances. Follow these steps:</p>
			<ol>
				<li value="1">Right-click on the <strong class="source-inline">Restaurants</strong> folder and create a new group named <strong class="source-inline">Model</strong>. Then right-click on the <strong class="source-inline">Model</strong> folder and choose <strong class="bold">New File</strong>.</li>
				<li><strong class="bold">iOS</strong> should <a id="_idIndexMarker874"/>already be <a id="_idIndexMarker875"/>selected. Choose <strong class="bold">Swift File</strong> and then click <strong class="bold">Next</strong>.</li>
				<li>Name this file <strong class="source-inline">RestaurantDataManager</strong>. Click <strong class="bold">Create</strong>. The <strong class="source-inline">RestaurantDataManager</strong> file appears in the Project navigator.</li>
				<li>Add the following after the <strong class="source-inline">import</strong> statement to declare the <strong class="source-inline">RestaurantDataManager</strong> class: <p class="source-code">class RestaurantDataManager {</p><p class="source-code"> </p><p class="source-code">}</p></li>
				<li>Add the following property between the curly braces to hold an array of <strong class="source-inline">RestaurantItem</strong> instances:<p class="source-code">private var restaurantItems: [RestaurantItem] = []</p><p>The <strong class="source-inline">restaurantItems</strong> array will store the <strong class="source-inline">RestaurantItem</strong> instances obtained from the JSON file. The <strong class="source-inline">private</strong> keyword means it is only accessible from within this class.</p></li>
				<li>Add the following method after the <strong class="source-inline">restaurantItems</strong> property to read a JSON file <a id="_idIndexMarker876"/>and return an array <a id="_idIndexMarker877"/>of <strong class="source-inline">RestaurantItem</strong> instances:<p class="source-code">func fetch(location: String, selectedCuisine: </p><p class="source-code">String = "All", completionHandler: (_ </p><p class="source-code">restaurantItems: [RestaurantItem]) -&gt; Void) { </p><p class="source-code">   if let file = Bundle.main.url(forResource: </p><p class="source-code">   location, withExtension: "json") {</p><p class="source-code">      do {</p><p class="source-code">         let data = try Data(contentsOf: file)</p><p class="source-code">         let restaurants = try JSONDecoder().decode(</p><p class="source-code">         [RestaurantItem].self, from: data)</p><p class="source-code">         if selectedCuisine != "All" {</p><p class="source-code">            restaurantItems = restaurants.filter {</p><p class="source-code">              ($0.cuisines.contains(selectedCuisine))</p><p class="source-code">            }</p><p class="source-code">         } else { </p><p class="source-code">            restaurantItems = restaurants </p><p class="source-code">         }</p><p class="source-code">      } catch {</p><p class="source-code">         print("There was an error \(error)")</p><p class="source-code">      }</p><p class="source-code">   }</p><p class="source-code">   completionHandler(restaurantItems)</p><p class="source-code">}</p><p>Let's break this down:</p><p class="source-code">func fetch(location: String, selectedCuisine: </p><p class="source-code">String = "All", completionHandler: (_ restaurantItems:</p><p class="source-code">[RestaurantItem]) -&gt; Void)</p><p>This method takes three parameters: <strong class="source-inline">location</strong>, a string containing the restaurant location, <strong class="source-inline">selectedCuisine</strong>, a string containing the cuisine selected by the user, and <strong class="source-inline">completionHandler</strong>, a closure used to process the result of <a id="_idIndexMarker878"/>this method <a id="_idIndexMarker879"/>when it has finished execution. If you do not provide a value for <strong class="source-inline">selectedCuisine</strong>, it will default to <strong class="source-inline">"All"</strong>. </p><p class="source-code">if let file = Bundle.main.url(forResource: location, </p><p class="source-code">withExtension: "json")</p><p>This gets the URL of the JSON file in the app bundle and assigns it to <strong class="source-inline">file</strong>.</p><p><strong class="source-inline">do</strong> code block:</p><p>The first statement attempts to assign the contents of <strong class="source-inline">file</strong> to <strong class="source-inline">data</strong>. The next statement attempts to use a <strong class="source-inline">JSONDecoder</strong> instance to parse <strong class="source-inline">data</strong> and store it as an array of <strong class="source-inline">RestaurantItem</strong> instances, which is assigned to <strong class="source-inline">restaurants</strong>. In the next statement, if <strong class="source-inline">selectedCuisine</strong> is not <strong class="source-inline">All</strong>, the <strong class="source-inline">filter</strong> method is applied to the <strong class="source-inline">restaurants</strong> array using the <strong class="source-inline">{($0.cuisines.contains(selectedCuisine))}</strong> closure. This results in an array of <strong class="source-inline">RestaurantItem</strong> instances where the <strong class="source-inline">cuisines</strong> property contains the user-selected cuisine, and this array is assigned to <strong class="source-inline">restaurantItems</strong>. Otherwise, the entire <strong class="source-inline">restaurants</strong> array is assigned to <strong class="source-inline">restaurantItems</strong>.</p><p><strong class="source-inline">catch</strong> code block:</p><p>This prints an error message to the Debug area if the <strong class="source-inline">do</strong> code block fails.</p><p class="source-code">completionHandler(items)</p><p>This statement processes the <strong class="source-inline">restaurantItems</strong> array using the closure provided.</p><p>Note that when you call this method in Xcode, the autocomplete feature gives you two possible choices; one that includes the <strong class="source-inline">selectedCuisine:</strong> parameter (that takes a string containing the selected cuisine) and one that doesn't (<strong class="source-inline">selectedCuisine</strong> is set to All).</p></li>
				<li>Add a method after the <strong class="source-inline">fetch(location:selectedCuisine:completionHandler:)</strong> method to<a id="_idIndexMarker880"/> return the number<a id="_idIndexMarker881"/> of items in the <strong class="source-inline">restaurantItems</strong> array:<p class="source-code">func numberOfRestaurantItems() -&gt; Int {</p><p class="source-code">   restaurantItems.count</p><p class="source-code">}</p><p>You'll call this method to determine the number of collection view cells to display in the <strong class="bold">Restaurant List</strong> screen.</p></li>
				<li>Add a method just after the <strong class="source-inline">numberOfRestaurantItems()</strong> method to return a <strong class="source-inline">RestaurantItem</strong> instance from the <strong class="source-inline">restaurantItems</strong> array at the index provided:<p class="source-code">func restaurantItem(at index: Int) -&gt; </p><p class="source-code">RestaurantItem {</p><p class="source-code">   restaurantItems[index]</p><p class="source-code">}</p><p>You'll call this method to configure the content of each collection view cell in the <strong class="bold">Restaurant List</strong> screen.</p></li>
			</ol>
			<p>The <strong class="source-inline">RestaurantDataManager</strong> class has been created, which allows you to read data stored in <strong class="source-inline">JSON</strong> files and put it into an array of <strong class="source-inline">RestaurantItem</strong> instances. Before you can use it, you'll need to modify your project quite a bit. Let's see what's required to <a id="_idIndexMarker882"/>display<a id="_idIndexMarker883"/> restaurant information in the <strong class="bold">Map</strong> and <strong class="bold">RestaurantList</strong> screens in the next section.</p>
			<h1 id="_idParaDest-248"><a id="_idTextAnchor253"/>Using data from JSON files in your app</h1>
			<p>Let's <a id="_idIndexMarker884"/>review <a id="_idIndexMarker885"/>how the <a id="_idIndexMarker886"/>app works. In the <strong class="bold">Map</strong> screen, the user will see all the restaurants near the user's location. Tapping a restaurant will display a callout bubble, and tapping the button in the callout button will display the details of said restaurant in the <strong class="bold">Restaurant Detail</strong> screen. </p>
			<p>In the <strong class="bold">Explore</strong> screen, the user will tap the <strong class="bold">LOCATION</strong> button and select a location such as <strong class="bold">Charleston, NC</strong> on the <strong class="bold">Locations</strong> screen. After a location has been selected, the user taps <strong class="bold">Done</strong> and will be returned to the <strong class="bold">Explore </strong>screen. The user will then select a cuisine in the <strong class="bold">Explore</strong> screen, and a list of restaurants in that location that offer that cuisine will be displayed in the <strong class="bold">Restaurant List</strong> screen. Tapping a restaurant will display the details of said restaurant in the <strong class="bold">Restaurant Detail </strong>screen.</p>
			<p>You will do the following:</p>
			<ul>
				<li>Configure the <strong class="source-inline">MapViewController</strong> class to get a list of restaurants from a JSON file instead of a <strong class="source-inline">.plist</strong> file. This will also fix the error in the <strong class="source-inline">MapDataManager</strong> class's <strong class="source-inline">fetch(completion:)</strong> method.</li>
				<li>Configure the <strong class="source-inline">LocationViewController</strong> class to store the location selected by the user.</li>
				<li>Pass the selected location to the <strong class="source-inline">ExploreViewController</strong> instance.</li>
				<li>Configure the <strong class="source-inline">ExploreViewController</strong> class to pass the selected location and cuisine to the <strong class="source-inline">RestaurantListViewController</strong> instance.</li>
				<li>Configure the <strong class="source-inline">RestaurantListViewController</strong> class to get a list of restaurants from a JSON file corresponding to the selected location.</li>
				<li>Configure the <strong class="source-inline">RestaurantListViewController</strong> class to display a list of restaurants based on the location and cuisine selected.</li>
			</ul>
			<p>This may seem daunting, so you'll do things step by step. To start, you'll configure the <strong class="source-inline">MapDataManager</strong> class <a id="_idIndexMarker887"/>to<a id="_idIndexMarker888"/> read<a id="_idIndexMarker889"/> data from JSON files instead of <strong class="source-inline">.plist</strong> files.</p>
			<h1 id="_idParaDest-249"><a id="_idTextAnchor254"/>Configuring the MapDataManager instance to use data from the RestaurantDataManager instance</h1>
			<p>Currently, there<a id="_idIndexMarker890"/> is an <a id="_idIndexMarker891"/>error in the <strong class="source-inline">MapDataManager</strong> file. This is because the <strong class="source-inline">fetch(completion:)</strong> method in your <strong class="source-inline">MapDataManager</strong> class calls the initializer method that you removed from the <strong class="source-inline">RestaurantItem</strong> class. You will now update the <strong class="source-inline">MapDataManager</strong> class to use the <strong class="source-inline">RestaurantDataManager</strong> instance as a data source, fixing the error in the process. Click the <strong class="source-inline">MapDataManager</strong> file (inside the <strong class="source-inline">Model</strong> folder in the <strong class="source-inline">Map</strong> folder) in the Project navigator and update the <strong class="source-inline">fetch(completion:)</strong> method as follows:</p>
			<p class="source-code">func fetch(completion: (_ annotations: [RestaurantItem]) -&gt; ()){</p>
			<p class="source-code"><strong class="bold">   let manager = RestaurantDataManager()</strong></p>
			<p class="source-code"><strong class="bold">   manager.fetch(location: "Boston", completionHandler: { </strong></p>
			<p class="source-code"><strong class="bold">      (restaurantItems) in self.items = restaurantItems</strong></p>
			<p class="source-code"><strong class="bold">      completion(items)</strong></p>
			<p class="source-code"><strong class="bold">   })</strong></p>
			<p class="source-code">}</p>
			<p>Let's break this down:</p>
			<p class="source-code">func fetch(completion: (_ annotations: [RestaurantItem]) -&gt; ())</p>
			<p>This method has a completion method parameter. The completion method will be used to process the result when the method has finished execution.</p>
			<p class="source-code">let manager = RestaurantDataManager() </p>
			<p>This creates an instance of the <strong class="source-inline">RestaurantDataManager</strong> class and assigns it to <strong class="source-inline">manager</strong>.</p>
			<p class="source-code">manager.fetch(location: "Boston", completionHandler: { </p>
			<p class="source-code">   (restaurantItems) in self.items = restaurantItems</p>
			<p class="source-code">   completion(items)</p>
			<p class="source-code">})</p>
			<p>This calls the <strong class="source-inline">manager</strong> instance's <strong class="source-inline">fetch()</strong> method to get a list of restaurants from <strong class="source-inline">Boston.json</strong>. This<a id="_idIndexMarker892"/> is <a id="_idIndexMarker893"/>hardcoded for now as the iOS Simulator does not have a functional GPS. To see restaurants at a different location, change the name of the JSON file used to another location. The array of <strong class="source-inline">RestaurantItem</strong> instances returned by this method is assigned to the <strong class="source-inline">MapViewController</strong> instance's <strong class="source-inline">items</strong> array, and the completion method that was passed in is used to process this array. As you saw in the previous chapter, this will generate the annotations that will be added to the map view in the <strong class="bold">Map</strong> screen.</p>
			<p class="callout-heading">Important Information</p>
			<p class="callout">To learn more about how to determine your location, visit <a href="https://developer.apple.com/documentation/mapkit/mkmapview/converting_a_user_s_location_to_a_descriptive_placemark">https://developer.apple.com/documentation/mapkit/mkmapview/converting_a_user_s_location_to_a_descriptive_placemark</a>.</p>
			<p>If you run your app now and select the <strong class="bold">Map</strong> screen, you should see pins for restaurants in Boston. </p>
			<p>In the next section, you'll configure the <strong class="source-inline">LocationViewController</strong> class so it can store the location selected by the user.</p>
			<h1 id="_idParaDest-250"><a id="_idTextAnchor255"/>Storing a user-selected location</h1>
			<p>At present, the <strong class="source-inline">LocationDataManager</strong> class<a id="_idIndexMarker894"/> loads data from <strong class="source-inline">Locations.plist</strong> and stores location information in an array of strings. You will create a new structure, <strong class="source-inline">LocationItem</strong>, and configure the <strong class="source-inline">LocationDataManager</strong> class to store locations in an array of <strong class="source-inline">LocationItem</strong> instances. After that, you'll modify the <strong class="source-inline">LocationViewController</strong> class so that it can store a <strong class="source-inline">LocationItem</strong> instance containing the user-selected location. You can then pass this instance to the <strong class="source-inline">RestaurantListViewController</strong> instance in your app. Follow these steps:</p>
			<ol>
				<li value="1">Right-click on the <strong class="source-inline">Model</strong> folder inside the <strong class="source-inline">Location</strong> folder and select <strong class="bold">New File</strong>.</li>
				<li><strong class="bold">iOS</strong> should already be selected. Choose <strong class="bold">Swift File</strong> and then click <strong class="bold">Next</strong>.</li>
				<li>Name this file <strong class="source-inline">LocationItem</strong>. Click <strong class="bold">Create</strong>. The <strong class="source-inline">LocationItem</strong> file appears in the Project navigator.</li>
				<li>Click the <strong class="source-inline">LocationItem</strong> file and add the following after the <strong class="source-inline">import</strong> statement to declare and define the <strong class="source-inline">LocationItem</strong> structure:<p class="source-code">struct LocationItem { </p><p class="source-code">   let city: String?</p><p class="source-code">   let state: String?</p><p class="source-code">}</p><p class="source-code">extension LocationItem {</p><p class="source-code">   init(dict: [String: String]) {</p><p class="source-code">      self.city = dict["city"]</p><p class="source-code">      self.state = dict["state"]</p><p class="source-code">   }</p><p class="source-code">   var cityAndState: String {</p><p class="source-code">      guard let city = self.city, let state = </p><p class="source-code">      self.state else { </p><p class="source-code">         return "" </p><p class="source-code">      }</p><p class="source-code">      return "\(city), \(state)"</p><p class="source-code">   }</p><p class="source-code">}</p><p>The <strong class="source-inline">LocationItem</strong> structure has two <strong class="source-inline">String</strong> properties, <strong class="source-inline">city</strong> and <strong class="source-inline">state</strong>.</p><p>The <strong class="source-inline">init()</strong> method takes a dictionary, <strong class="source-inline">dict</strong>, as a parameter and assigns the values of the <strong class="source-inline">city</strong> and <strong class="source-inline">state</strong> keys to the <strong class="source-inline">city</strong> and <strong class="source-inline">state</strong> properties.</p><p>The <strong class="source-inline">cityAndState</strong> computed property returns a string made from combining the <strong class="source-inline">city</strong> and <strong class="source-inline">state</strong> values.</p></li>
			</ol>
			<p>Now you'll <a id="_idIndexMarker895"/>update the <strong class="source-inline">LocationDataManager</strong> class so that it can store city and state information in an array of <strong class="source-inline">LocationItem</strong> instances instead of strings. Follow these steps:</p>
			<ol>
				<li value="1">Click the <strong class="source-inline">LocationDataManager</strong> in the Project navigator and modify the <strong class="source-inline">locations</strong> array to store <strong class="source-inline">LocationItem</strong> instances instead of strings:<p class="source-code">private var locations:[<strong class="bold">LocationItem</strong>] = []</p></li>
				<li>The <strong class="source-inline">fetch()</strong> method will now show an error. Modify the <strong class="source-inline">fetch()</strong> method to work with <strong class="source-inline">LocationItem</strong> instances instead of strings:<p class="source-code">func fetch() {</p><p class="source-code">   for l<a id="_idTextAnchor256"/><a id="_idTextAnchor257"/>ocation in loadData() {</p><p class="source-code">      <strong class="bold">locations.append(LocationItem(dict: location))</strong></p><p class="source-code">   }</p><p class="source-code">}</p><p>Each dictionary provided by the <strong class="source-inline">loadData()</strong> method is now used to initialize <strong class="source-inline">LocationItem</strong> instances instead of strings, which are then appended to the <strong class="source-inline">locations</strong> array. The <strong class="source-inline">loadData()</strong> method still uses the same <strong class="source-inline">Locations.plist</strong> file that you created in <a href="B17469_15_Final_VK_ePub.xhtml#_idTextAnchor213"><em class="italic">Chapter 15</em></a>, <em class="italic">Getting Started with Table Views</em>.</p></li>
				<li>The <strong class="source-inline">locationItem(at:)</strong> method now shows an error. Modify it so it returns a <strong class="source-inline">LocationItem</strong> instance instead of a string:<p class="source-code">func locationItem(at index: Int) -&gt; </p><p class="source-code"><strong class="bold">LocationItem</strong> {</p><p class="source-code">   locations[index]</p><p class="source-code">}</p></li>
			</ol>
			<p>You are done with the <strong class="source-inline">LocationDataManager</strong> class at this point. Next, you'll update the <strong class="source-inline">LocationViewController</strong> class to use <strong class="source-inline">LocationItem</strong> instances instead of<a id="_idIndexMarker896"/> strings to populate the table view cells. Follow these steps:</p>
			<ol>
				<li value="1">Click the <strong class="source-inline">LocationViewController</strong> file in the Project navigator.</li>
				<li>You will see an error in the <strong class="source-inline">tableView(_:cellForRowAtIndexPath:)</strong> method. This error is because you can't assign a <strong class="source-inline">LocationItem</strong> instance to the cell's <strong class="source-inline">textLabel</strong> property. Modify this method as follows:<p class="source-code">func tableView(_ tableView: UITableView, cellForRowAt </p><p class="source-code">indexPath: IndexPath) -&gt; UITableViewCell {</p><p class="source-code">   let cell = tableView.dequeueReusableCell(</p><p class="source-code">   withIdentifier: "locationCell", for: indexPath)</p><p class="source-code">   <strong class="bold">let location = manager.locationItem(at: </strong></p><p class="source-code"><strong class="bold">   indexPath.row)</strong> </p><p class="source-code">   cell.textLabel?.text = <strong class="bold">location.cityAndState</strong></p><p class="source-code">   return cell</p><p class="source-code">}</p><p>The <strong class="source-inline">cityAndState</strong> property of the <strong class="source-inline">LocationItem</strong> structure returns a string that combines a location's <strong class="source-inline">city</strong> and <strong class="source-inline">state</strong> strings, fixing the error.</p></li>
				<li>You need a property to keep track of the user's selection. Add the following property declaration just after the <strong class="source-inline">manager</strong> declaration:<p class="source-code">let m<a id="_idTextAnchor258"/><a id="_idTextAnchor259"/>anager = LocationDataManager()</p><p class="source-code"><strong class="bold">var selectedCity: LocationItem?</strong></p></li>
			</ol>
			<p>To handle user interaction with the table view, you'll make the <strong class="source-inline">LocationViewController</strong> class <a id="_idIndexMarker897"/>conform to the <strong class="source-inline">UITableViewDelegate</strong> protocol. </p>
			<p class="callout-heading">Tip</p>
			<p class="callout">The <strong class="source-inline">UITableViewDelegate</strong> protocol is covered in <a href="B17469_15_Final_VK_ePub.xhtml#_idTextAnchor213"><em class="italic">Chapter 15</em></a><em class="italic">, Getting Started with Table Views</em>. </p>
			<p>The <strong class="source-inline">UITableViewDelegate</strong> protocol specifies the messages that a table view will send to its delegate when the user interacts with the rows in it. Follow these steps to adopt it:</p>
			<ol>
				<li value="1">Add the following extension after the <strong class="source-inline">UITableViewDataSource</strong> extension:<p class="source-code">// MARK: UITableViewDelegate</p><p class="source-code">extension LocationViewController: </p><p class="source-code">UITableViewDelegate {</p><p class="source-code"> </p><p class="source-code">}</p><p>The extension helps to keep your code organized, and the <strong class="source-inline">// MARK:</strong> syntax makes this extension easy to find in the Editor area.</p></li>
				<li>The <strong class="source-inline">UITableViewDelegate</strong> method triggered when a user taps a row in the table view is <strong class="source-inline">tableView(_:didSelectRowAt:)</strong>. Add this method between the extension's curly braces. It should look like the following:<p class="source-code">// MARK: UITableViewDelegate</p><p class="source-code">extension LocationViewContro<a id="_idTextAnchor260"/><a id="_idTextAnchor261"/>ller: UITableViewDelegate </p><p class="source-code">{</p><p class="source-code"><strong class="bold">   func tableView(_ tableView: UITableView, </strong></p><p class="source-code"><strong class="bold">   didSelectRowAt indexPath:IndexPath) {</strong></p><p class="source-code"><strong class="bold">      if let cell = tableView.cellForRow(at: </strong></p><p class="source-code"><strong class="bold">      indexPath) {</strong></p><p class="source-code"><strong class="bold">         cell.accessoryType = .checkmark</strong></p><p class="source-code"><strong class="bold">         selectedCity = </strong></p><p class="source-code"><strong class="bold">         manager.locationItem(at: indexPath.row)</strong></p><p class="source-code"><strong class="bold">      }</strong></p><p class="source-code"><strong class="bold">   }</strong></p><p class="source-code">}</p><p>When the user<a id="_idIndexMarker898"/> taps a row in the <strong class="bold">Locations</strong> screen, a checkmark will appear in that row, and the <strong class="source-inline">selectedCity</strong> property is assigned the corresponding <strong class="source-inline">LocationItem</strong> instance in the <strong class="source-inline">locations</strong> array. For example, if you tap the third row, the <strong class="source-inline">LocationItem</strong> instance with the values <strong class="source-inline">"Charleston"</strong> and <strong class="source-inline">"NC"</strong> is assigned to <strong class="source-inline">selectedCity</strong>. </p></li>
			</ol>
			<p>The <strong class="source-inline">LocationViewController</strong> class can now store a user-selected location, but when you choose a location in the <strong class="bold">Locations</strong> screen and tap <strong class="bold">Done</strong>, nothing happens. This is because you've not created or assigned an action to the <strong class="bold">Done</strong> button yet. Later you'll create an unwind action in the <strong class="source-inline">ExploreViewController</strong> class and assign it to the <strong class="bold">Done</strong> button, but before you do, you'll create a new view controller for the collection view section header in the <strong class="bold">Explore</strong> screen first. This will let you display the user-selected location in the <strong class="bold">Explore</strong> screen. You'll do this in the next section.</p>
			<h2 id="_idParaDest-251"><a id="_idTextAnchor262"/>Adding a UICollectionReusableView subclass for the section header in the Explore screen</h2>
			<p>The <strong class="bold">Explore</strong> screen's <a id="_idIndexMarker899"/>collection <a id="_idIndexMarker900"/>view has a collection view section header, which contains a subtitle label, a title label, and the <strong class="bold">LOCATION</strong> button. There is currently no way to set the subtitle label text. You'll create a <strong class="source-inline">UICollectionReusableView</strong> subclass for the collection view section header, and set up an outlet for the subtitle label, so you can display the user-selected location in the collection view section header. Follow these steps:</p>
			<ol>
				<li value="1">Right-click the <strong class="source-inline">View</strong> folder inside the <strong class="source-inline">Explore</strong> folder and select <strong class="bold">New File</strong>.</li>
				<li><strong class="bold">iOS</strong> should already be selected. Choose <strong class="bold">Cocoa Touch Class</strong> and then click <strong class="bold">Next</strong>.</li>
				<li>Configure the file as follows:<p><strong class="bold"><a id="_idTextAnchor263"/><a id="_idTextAnchor264"/>Class</strong>: <strong class="source-inline">ExploreHeaderView</strong></p><p><strong class="bold">Subclass</strong>: <strong class="source-inline">UICollectionReusableView</strong></p><p><strong class="bold">Also create XIB</strong>: Unchecked</p><p><strong class="bold">Language</strong>: <strong class="source-inline">Swift</strong></p><p>Click <strong class="bold">Next</strong>.</p></li>
				<li>Click <strong class="bold">Create</strong>. The <strong class="source-inline">ExploreHeaderView</strong> file appears in the Project navigator. Verify that it contains the following:<p class="source-code">class ExploreHeaderView: UICollectionReusableView {</p><p class="source-code"> </p><p class="source-code">}</p></li>
				<li>Click the <strong class="source-inline">Main</strong> storyboard file in the Project navigator. Select the <strong class="bold">Collection Reusable View</strong> in the <strong class="bold">Explore View Controller Scene</strong>. Click the Identity inspector button and under <strong class="bold">Custom Class</strong>, set <strong class="bold">Class</strong> to <strong class="source-inline">ExploreHeaderView</strong>: </li>
			</ol>
			<div>
				<div id="_idContainer392" class="IMG---Figure">
					<img src="image/Figure_17.02_B17469.jpg" alt="Figure 17.2: Identity inspector with Class set to ExploreHeaderView&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 17.2: Identity inspector with Class set to ExploreHeaderView</p>
			<p>Note that <strong class="bold">Collection Reusable View</strong> will change to <strong class="bold">Explore Header View</strong> in the document outline.</p>
			<p>The <strong class="source-inline">ExploreHeaderView</strong> class is now managing the collection view section header. In the <a id="_idIndexMarker901"/>next <a id="_idIndexMarker902"/>section, you will link the subtitle label in the collection view section header to an outlet in the <strong class="source-inline">ExploreHeaderView</strong> class, and add a property for the <strong class="source-inline">ExploreHeaderView</strong> class in the <strong class="source-inline">ExploreViewController</strong> class.</p>
			<h2 id="_idParaDest-252"><a id="_idTextAnchor265"/>Connecting the section header's label to the ExploreViewController class</h2>
			<p>To display<a id="_idIndexMarker903"/> the user-selected<a id="_idIndexMarker904"/> city in the collection view section header, you'll connect the subtitle label to an outlet in the <strong class="source-inline">ExploreHeaderView</strong> class, then add a property for it in the <strong class="source-inline">ExploreViewController</strong> class. Follow these steps:</p>
			<ol>
				<li value="1">In the document outline, click the subtitle label for the <strong class="bold">Explore Header View</strong> (it is the label that has the text <strong class="bold">PLEASE SELECT A LOCATION</strong>):<div id="_idContainer393" class="IMG---Figure"><img src="image/Figure_17.03_B17469.jpg" alt="Figure 17.3: Document outline with PLEASE SELECT A LOCATION label selected&#13;&#10;"/></div><p class="figure-caption">Figure 17.3: Document outline with PLEASE SELECT A LOCATION label selected</p></li>
				<li>Click the Adjust Editor Options button and choose Assistant from the menu. An assistant editor appears on the right side of the screen. Make sure that it's showing the contents of the <strong class="source-inline">ExploreHeaderView</strong> file.</li>
				<li><em class="italic">Ctrl + Drag</em> from the <strong class="bold">PLEASE SELECT A LOCATION</strong> label to the space between<a id="_idIndexMarker905"/> the curly <a id="_idIndexMarker906"/>braces:<div id="_idContainer394" class="IMG---Figure"><img src="image/Figure_17.04_B17469.jpg" alt="Figure 17.4: Editor area showing ExploreHeaderView file contents&#13;&#10;"/></div><p class="figure-caption">Figure 17.4: Editor area showing ExploreHeaderView file contents</p></li>
				<li>In the box that appears, set the name to <strong class="source-inline">locationLabel</strong> and click <strong class="bold">Connect</strong>.</li>
				<li>The <strong class="source-inline">locationLabel</strong> outlet has been created in the <strong class="source-inline">ExploreHeaderView</strong> class. Close the assistant editor by clicking the <strong class="bold">x</strong> button.</li>
				<li>Click the <strong class="source-inline">ExploreViewController</strong> file in the Project navigator. Add the following property declaration after the <strong class="source-inline">manager</strong> declaration to store the location passed to the <strong class="source-inline">ExploreViewController</strong> instance by the <strong class="source-inline">LocationViewController</strong> instanc<a id="_idTextAnchor266"/><a id="_idTextAnchor267"/>e:<p class="source-code">let manager = ExploreDataManager()</p><p class="source-code"><strong class="bold">var selectedCity: LocationItem?</strong></p></li>
				<li>After the <strong class="source-inline">selectedCity</strong> property declaration, declare a property that will be assigned an <strong class="source-inline">ExploreHeaderView</strong> instance, which will allow the <strong class="source-inline">ExploreViewController</strong> instance to set the value for <strong class="source-inline">locationLabel</strong>:<p class="source-code">let manager = ExploreDataMana<a id="_idTextAnchor268"/><a id="_idTextAnchor269"/>ger()</p><p class="source-code">var selectedCity: LocationItem?</p><p class="source-code"><strong class="bold">var headerView: ExploreHeaderView!</strong></p></li>
			</ol>
			<p>Next, let's configure the <strong class="bold">Done</strong> button to dismiss the <strong class="bold">Locations</strong> screen and set <strong class="source-inline">locationLabel</strong> to the user-selected city and state when tapped. The <strong class="bold">Explore</strong> screen will then<a id="_idIndexMarker907"/> appear with the <a id="_idIndexMarker908"/>selected city displayed in the collection view section header. You will do this in the next section.</p>
			<h2 id="_idParaDest-253"><a id="_idTextAnchor270"/>Adding an unwind action method to the Done button</h2>
			<p>In <a href="B17469_10_Final_VK_ePub.xhtml#_idTextAnchor155"><em class="italic">Chapter 10</em></a><em class="italic">, Building Your User Interface</em>, you <a id="_idIndexMarker909"/>added <a id="_idIndexMarker910"/>an unwind action method for the <strong class="bold">Cancel</strong> button in the <strong class="source-inline">ExploreViewController</strong> class, which dismisses the <strong class="bold">Locations</strong> screen when it is tapped. Now, you'll add an unwind action method for the <strong class="bold">Done</strong> button, which dismisses the <strong class="bold">Locations</strong> screen and sets the <strong class="source-inline">selectedCity</strong> property in the <strong class="source-inline">ExploreViewController</strong> instance to the location selected by the user. Follow these steps:</p>
			<ol>
				<li value="1">Add the following just after the <strong class="source-inline">unwindLocationCancel(segue:)</strong> method to impleme<a id="_idTextAnchor271"/><a id="_idTextAnchor272"/>nt the unwind action for the <strong class="bold">Done</strong> button:<p class="source-code">@IBAction func </p><p class="source-code">unwindLocationDone(segue: UIStoryboardSegue) {</p><p class="source-code">   if let viewController = segue.source as? </p><p class="source-code">   LocationViewController {</p><p class="source-code">      selectedCity = viewController.selectedCity </p><p class="source-code">      if let location = selectedCity {</p><p class="source-code">         headerView.locationLabel.text = </p><p class="source-code">         location.cityAndState</p><p class="source-code">      }</p><p class="source-code">   }</p><p class="source-code">}</p><p>You'll assign this method to the <strong class="bold">Done</strong> button later. The source view controller in this case is a <strong class="source-inline">LocationViewController</strong> instance and the destination view controller is an <strong class="source-inline">ExploreViewController</strong> instance. This method first checks to see if the source view controller is a <strong class="source-inline">LocationViewController</strong> instance. If it is, the<a id="_idIndexMarker911"/> value <a id="_idIndexMarker912"/>of the <strong class="source-inline">LocationViewController</strong> instance's <strong class="source-inline">selectedCity</strong> property is assigned to the <strong class="source-inline">ExploreViewController</strong> instance's <strong class="source-inline">selectedCity</strong> property, if it exists. If the <strong class="source-inline">ExploreViewController</strong> instance's <strong class="source-inline">selectedCity</strong> property has a value, it is assigned to <strong class="source-inline">location</strong>, and the text of the subtitle label is set to the <strong class="source-inline">cityAndState</strong> property of <strong class="source-inline">location</strong>.</p></li>
				<li>Modify the <strong class="source-inline">collectionView(_:viewForSupplementaryElementOf Kind:at:)</strong> method as follows:<p class="source-code">func collectionView(_ collectionView: UICollectionView, </p><p class="source-code">viewForSupplementaryElementOfKind kind: String, at </p><p class="source-code">indexPath: IndexPath) -&gt; UICollectionReusableView {</p><p class="source-code">   let <strong class="bold">header</strong> = </p><p class="source-code">   collectionView.dequeueReusableSupplementaryView </p><p class="source-code">   (ofKind: kind, withReuseIdentifier: "header", for: </p><p class="source-code">   indexPath)</p><p class="source-code">   <strong class="bold">headerView = header as? ExploreHeaderView </strong></p><p class="source-code">   return headerView</p><p class="source-code">}</p><p>This method is one of the data source methods declared in the <strong class="source-inline">UICollectionViewDataSource</strong> protocol. It returns the view that will be used as the collection view section header. Here, the collection view section header in the <strong class="bold">Explore</strong> screen is set to an <strong class="source-inline">ExploreHeaderView</strong> instance.</p><p class="callout-heading">Important Information</p><p class="callout">You can learn more about the <strong class="source-inline">UICollectionViewDataSource</strong> protocol at this link: <a href="https://developer.apple.com/documentation/uikit/uicollectionviewdatasource/1618037-collectionview"> https://developer.apple.com/documentation/uikit/uicollectionviewdatasource/1618037-collectionview</a>.</p></li>
				<li>Click the <strong class="source-inline">Main</strong> storyboard<a id="_idIndexMarker913"/> file. Select <a id="_idIndexMarker914"/>the <strong class="bold">Location View Controller Scene</strong>. To set the method to be triggered by the <strong class="bold">Done</strong> button, <em class="italic">Ctrl + Drag</em> from the <strong class="bold">Done</strong> button to the Exit icon in the Scene Dock:<div id="_idContainer395" class="IMG---Figure"><img src="image/Figure_17.05_B17469.jpg" alt="Figure 17.5: Location View Controller Scene showing Done button action being set&#13;&#10;"/></div><p class="figure-caption">Figure 17.5: Location View Controller Scene showing Done button action being set</p></li>
				<li>Choose <strong class="source-inline">unwindLocationDoneWithSegue:</strong> from the pop-up menu. This links the <strong class="bold">Done</strong> button to the <strong class="source-inline">unwindLocationDone(segue:)</strong> unwind action in the <strong class="source-inline">ExploreViewController</strong> class:</li>
			</ol>
			<div>
				<div id="_idContainer396" class="IMG---Figure">
					<img src="image/Figure_17.06_B17469.jpg" alt="Figure 17.6: Pop-up menu with unwindLocationDoneWithSegue: selected&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 17.6: Pop-up menu with unwindLocationDoneWithSegue: selected</p>
			<p>Build and run<a id="_idIndexMarker915"/> your<a id="_idIndexMarker916"/> app and tap the <strong class="bold">LOCATION</strong> button. Tap a city and a tick will appear in the row. Tap <strong class="bold">Done</strong>:</p>
			<div>
				<div id="_idContainer397" class="IMG---Figure">
					<img src="image/Figure_17.07_B17469.jpg" alt="Figure 17.7: iOS Simulator showing Locations screen with location selected&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 17.7: iOS Simulator showing Locations screen with location selected</p>
			<p>The selected <a id="_idIndexMarker917"/>city <a id="_idIndexMarker918"/>name and state will replace the <strong class="bold">PLEASE SELECT A LOCATION</strong> text in the subtitle label inside the collection view section header:</p>
			<div>
				<div id="_idContainer398" class="IMG---Figure">
					<img src="image/Figure_17.08_B17469.jpg" alt="Figure 17.8: iOS Simulator showing Explore screen with subtitle label set&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 17.8: iOS Simulator showing Explore screen with subtitle label set</p>
			<p>Although this <a id="_idIndexMarker919"/>works, there<a id="_idIndexMarker920"/> are two issues that you need to fix when selecting a location. The first issue is that you can select multiple locations:</p>
			<div>
				<div id="_idContainer399" class="IMG---Figure">
					<img src="image/Figure_17.09_B17469.jpg" alt="Figure 17.9: iOS simulator showing Locations screen with multiple locations selected&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 17.9: iOS simulator showing Locations screen with multiple locations selected</p>
			<p>You want the user<a id="_idIndexMarker921"/> to <a id="_idIndexMarker922"/>only select one location, and if another is selected, the location selected earlier should be deselected.</p>
			<p>The second issue is that the checkmark next to the user-selected location disappears if you click <strong class="bold">Done</strong> in the <strong class="bold">Locations</strong> screen and click the <strong class="bold">LOCATION</strong> button in the <strong class="bold">Explore </strong>screen again:</p>
			<div>
				<div id="_idContainer400" class="IMG---Figure">
					<img src="image/Figure_17.10_B17469.jpg" alt="Figure 17.10: iOS simulator showing Locations screen with missing checkmark&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 17.10: iOS simulator showing Locations screen with missing checkmark</p>
			<p>The last<a id="_idIndexMarker923"/> selected<a id="_idIndexMarker924"/> location should have a checkmark when you go back to the <strong class="bold">Locations </strong>screen again.</p>
			<p>Let's modify the <strong class="source-inline">LocationDataManager</strong> class to make sure only one location can be selected at a time in the next section.</p>
			<h2 id="_idParaDest-254"><a id="_idTextAnchor273"/>Selecting only one location in the Locations screen</h2>
			<p>At present, you <a id="_idIndexMarker925"/>can select multiple locations in the <strong class="bold">Locations</strong> screen. You should only be able to select one location, and if another is selected, the previously selected location selected should be deselected. Follow these steps:</p>
			<ol>
				<li value="1">Click the <strong class="source-inline">LocationItem</strong> file. Make <strong class="source-inline">LocationItem</strong> conform to the <strong class="source-inline">Equatable</strong> protocol by modifying the <strong class="source-inline">LocationItem</strong> structure as follows:<p class="source-code">struct LocationItem: <strong class="bold">Equatable</strong> { </p><p class="source-code">   let city: String?</p><p class="source-code">   let state: String?</p><p class="source-code">}</p><p>This allows you to check if two <strong class="source-inline">LocationItem</strong> instances are equal.</p></li>
				<li>Click the <strong class="source-inline">LocationViewController</strong> file. After the <strong class="source-inline">viewDidLoad()</strong> method, add a method that sets a check<a id="_idTextAnchor274"/><a id="_idTextAnchor275"/>mark only on the row containing the selected city:<p class="source-code">private func setCheckmark(for cell: UITableViewCell, </p><p class="source-code">location: LocationItem) {</p><p class="source-code">   if selectedCity == location {</p><p class="source-code">      cell.accessoryType = .checkmark {</p><p class="source-code">   } else {</p><p class="source-code">      cell.accessoryType = .none</p><p class="source-code">   }</p><p class="source-code">}</p><p>The <strong class="source-inline">setCheckmark(for:location:)</strong> method takes <strong class="source-inline">cell</strong>, a table view cell, and <strong class="source-inline">location</strong>, a <strong class="source-inline">LocationItem</strong> instance, as arguments. If <strong class="source-inline">location</strong> and <strong class="source-inline">selectedCity</strong> are equal, the checkmark for that row is set. Otherwise, the checkmark is not set.</p></li>
				<li>In the <strong class="source-inline">tableView(_:cellForRowAt:)</strong> method, modify the code as follows to call <strong class="source-inline">setCheckmark(for:location:)</strong> after the line that sets the text for<a id="_idIndexMarker926"/> the cell's <strong class="source-inline">textLabel</strong> property:<p class="source-code">func tableView(_ tableView: UITableView, cellForRowAt </p><p class="source-code">indexPath: IndexPath) -&gt; UITableViewCell {</p><p class="source-code">   let cell = tableView.dequeueReusableCell(</p><p class="source-code">   withIdentifier: "locationCell", for: indexPath)</p><p class="source-code">   let location = manager.locationItem(at </p><p class="source-code">   indexPath.row)</p><p class="source-code"><a id="_idTextAnchor276"/><a id="_idTextAnchor277"/>   cell.textLabel?.text = location.cityAndState </p><p class="source-code">   <strong class="bold">setCheckmark(for: cell, location: location) </strong></p><p class="source-code">   return cell</p><p class="source-code">}</p><p>This means <strong class="source-inline">setCheckmark(for:at:)</strong> will be called when each row in the table view is rendered, and the checkmark will only be set on the row containing the selected location.</p></li>
				<li>In the <strong class="source-inline">tableView(_:didSelectRowAt:)</strong> method, modify the code in the <strong class="source-inline">if</strong> statement as follows to reload the table view (thus rendering all the rows in it) after a location has been selected: <p class="source-code">if let cell = tableView.cellForRow(at: indexPath) {</p><p class="source-code">   cell.accessoryType = .checkmark</p><p class="source-code">   selectedCity = manager.locationItem(at:</p><p class="source-code">   indexPath.row)</p><p class="source-code">   <strong class="bold">tableView.reloadData()</strong></p><p class="source-code">}</p></li>
			</ol>
			<p>Build and run your project. You should only be able to set one location now, and if you choose another location, the location you chose earlier will be deselected.</p>
			<p>You'll fix the second issue in the next section so that once a location is selected, it will remain selected when you go back to the <strong class="bold">Locations</strong> screen. You'll also pass location and cuisine information to the <strong class="source-inline">RestaurantListViewController</strong> instance, so it can eventually display a list of restaurants at a particular location matching the cuisine selected by<a id="_idIndexMarker927"/> the user.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">This is a long chapter, so you may wish to take a break here.</p>
			<h1 id="_idParaDest-255"><a id="_idTextAnchor278"/>Passing location and cuisine information to the RestaurantListViewController instance</h1>
			<p>At present, you're <a id="_idIndexMarker928"/>able to set a location in the <strong class="bold">Locations</strong> screen and have that location appear in the collection view section header of the <strong class="bold">Explore</strong> screen. Now, you will add code so you can pass the location and cuisine values to the <strong class="source-inline">RestaurantListViewController</strong> instance, which will then display the restaurants at the selected location that offer the selected cuisine. You'll also make the checkmark next to your selected location reappear if you have selected a location in the <strong class="bold">Locations </strong>screen earlier. Follow these steps:</p>
			<ol>
				<li value="1">You'll add identifiers for each segue connected to the <strong class="bold">Explore</strong> screen so that you know which segue is occurring later. Open the <strong class="source-inline">Main</strong> storyboard file and click the <strong class="bold">Explore View Controller Scene</strong>. Select the segue between the <strong class="bold">Explore View Controller Scene</strong> and the <strong class="bold">Location View Controller Scene</strong>:<div id="_idContainer401" class="IMG---Figure"><img src="image/Figure_17.11_B17469.jpg" alt="Figure 17.11: Editor area showing segue between Explore and Location screens selected&#13;&#10;"/></div><p class="figure-caption">Figure 17.11: Editor area showing segue between Explore and Location screens selected</p></li>
				<li>Click the<a id="_idIndexMarker929"/> Attributes inspector button. Under <strong class="bold">Storyboard Segue</strong>, set <strong class="bold">Identifier</strong> to <strong class="source-inline">locationList</strong>:<div id="_idContainer402" class="IMG---Figure"><img src="image/Figure_17.12_B17469.jpg" alt="Figure 17.12: Attributes inspector with Identifier set to locationList&#13;&#10;"/></div><p class="figure-caption">Figure 17.12: Attributes inspector with Identifier set to locationList</p></li>
				<li>Select the segue between <strong class="bold">Explore View Controller Scene</strong> and the <strong class="bold">Restaurant List View Controller Scene</strong>. Click the Attributes inspector button. Under <strong class="bold">Storyboard Segue</strong>, set <strong class="bold">Identifier</strong> to <strong class="source-inline">restaurantList</strong>:<div id="_idContainer403" class="IMG---Figure"><img src="image/Figure_17.13_B17469.jpg" alt="Figure 17.13: Attributes inspector identifier setting for the segue between &#13;&#10;the Explore and Restaurant List screens&#13;&#10;"/></div><p class="figure-caption">Figure 17.13: Attributes inspector identifier setting for the segue between the Explore and Restaurant List screens</p><p>Once you<a id="_idIndexMarker930"/> know which segue is occurring, you can specify the methods to be executed for each segue. You'll create two methods, <strong class="source-inline">showLocationList(segue:)</strong> and <strong class="source-inline">showRestaurantList(segue:)</strong>, and you'll use the <strong class="source-inline">prepare(for:sender:)</strong> method to execute the desired method depending on which segue is occurring.</p></li>
				<li>Click the <strong class="source-inline">ExploreViewController</strong> file in the Project navigator. Inside the <strong class="source-inline">private</strong> extension, declare and define the <strong class="source-inline">showLocationList(segue:)</strong> method before the <strong class="source-inline">unwindLocationCancel()</strong> method to pass the user-selected city back to the <strong class="source-inline">Lo<a id="_idTextAnchor279"/><a id="_idTextAnchor280"/>cationViewController</strong> instance if it was set earlier:<p class="source-code">func showLocationList(segue: UIStoryboardSegue) {</p><p class="source-code">   guard let navController = segue.destination as? </p><p class="source-code">   UINavigationController, let viewController = </p><p class="source-code">   navController.topViewController as? </p><p class="source-code">   LocationViewController else {</p><p class="source-code">      return</p><p class="source-code">   }</p><p class="source-code">   viewController.selectedCity = selectedCity</p><p class="source-code">}</p><p>The <strong class="source-inline">showLocationList(segue:)</strong> method will be called before the <strong class="bold">Explore </strong>screen <a id="_idIndexMarker931"/>transitions to the <strong class="bold">Locations</strong> screen. Let's see how it works. </p><p>Remember that in the <strong class="source-inline">Main</strong> storyboard file, you embedded the <strong class="bold">Location View Controller Scene</strong> in a navigation controller. A navigation controller has a <strong class="source-inline">viewControllers</strong> property that holds an array of view controllers, and the last view controller in the array has its view visible onscreen. You can access the last view controller in the array using the <strong class="source-inline">topViewController</strong> property of the navigation controller.</p><p>The <strong class="source-inline">guard</strong> statement checks whether the segue destination is a <strong class="source-inline">UINavigationController</strong> instance and whether <strong class="source-inline">topViewController</strong> is the <strong class="source-inline">LocationViewController</strong> instance. If it is, the <strong class="source-inline">selectedCity</strong> property of the <strong class="source-inline">ExploreViewController</strong> instance is checked to see if it contains a value. If it does, that value is assigned to the <strong class="source-inline">selectedCity</strong> property of the <strong class="source-inline">LocationViewController</strong> instance. Remember that the <strong class="source-inline">setCheckmark(for:at:)</strong> method of the <strong class="source-inline">LocationViewController</strong> instance will be called for each row in the table view, and this sets a checkmark on the row containing the selected city.</p></li>
			</ol>
			<p>This will fix the second issue with the <strong class="bold">Locations</strong> screen. Now, let's add code to pass the location and cuisine to the <strong class="source-inline">RestaurantListViewController</strong> instance. Follow these steps:</p>
			<ol>
				<li value="1">Click the <strong class="source-inline">RestaurantListViewController</strong> file in the Project navigator. Add the following properties inside the <strong class="source-inline">RestaurantListViewCo<a id="_idTextAnchor281"/><a id="_idTextAnchor282"/>ntroller</strong> class just before the <strong class="source-inline">@IBOutlet</strong> declaration:<p class="source-code"><strong class="bold">var selectedRestaurant: RestaurantItem?</strong></p><p class="source-code"><strong class="bold">var selectedCity: LocationItem?</strong></p><p class="source-code"><strong class="bold">var selectedCuisine: String?</strong></p><p class="source-code">@IBOutlet var collectionView: UICollectionView!</p><p><strong class="source-inline">selectedRestaurant</strong> will <a id="_idIndexMarker932"/>be set if you pick a restaurant in the <strong class="bold">Restaurant List</strong> screen, and will be passed to the <strong class="bold">Restaurant Detail</strong> screen later. You'll add code to do this in the next chapter.</p><p><strong class="source-inline">selectedCity</strong> stores the city you picked in the <strong class="bold">Locations</strong> screen.</p><p><strong class="source-inline">selectedCuisine</strong> stores the cuisine you picked in the <strong class="bold">Explore</strong> screen.</p></li>
				<li>Add the following code after the <strong class="source-inline">viewDidLoad()</strong> method to print the selected city and cuisine to the Debug area when the view for the <strong class="source-inline">R<a id="_idTextAnchor283"/><a id="_idTextAnchor284"/>estaurantListViewController</strong> instance appears onscreen:<p class="source-code">override func viewDidAppear(_ animated: Bool) {</p><p class="source-code">   super.viewDidAppear(animated)</p><p class="source-code">   print("selected city \(selectedCity as Any)")</p><p class="source-code">   print("selected cuisine \(selectedCuisine as Any)")</p><p class="source-code">}</p><p><strong class="source-inline">viewDidAppear()</strong> is called every time a view controller's view appears onscreen, while <strong class="source-inline">viewDidLoad()</strong> is only called once when a view controller initially loads its view. <strong class="source-inline">viewDidAppear()</strong> is used here because the <strong class="source-inline">RestaurantListViewController</strong> instance will show a different list of restaurants each time its view appears onscreen, depending on the choices made by the user. At the moment, the code just prints the selected location and cuisine to the Debug area, so you can see that these values are being passed correctly.</p><p class="callout-heading">Important Information</p><p class="callout">To learn more about the view controller lifecycle, see this link: <a href="https://developer.apple.com/documentation/uikit/uiviewcontroller">https://developer.apple.com/documentation/uikit/uiviewcontroller</a>.</p></li>
				<li>Click <a id="_idIndexMarker933"/>the <strong class="source-inline">ExploreViewController</strong> file in the Project navigator. Declare and define the <strong class="source-inline">showRestaurantList(segue:)</strong> method after the <strong class="source-inline">showLocationList(segue:)</strong> method to set the <strong class="source-inline">RestaurantListViewController</strong> <a id="_idTextAnchor285"/><a id="_idTextAnchor286"/><a id="_idTextAnchor287"/>instance's <strong class="source-inline">selectedCuisine</strong> and <strong class="source-inline">selectedCity</strong> properties:<p class="source-code">func showRestaurantList(segue: UIStoryboardSegue) {</p><p class="source-code">   if let viewController = segue.destination as? </p><p class="source-code">   RestaurantListViewController, let city = </p><p class="source-code">   selectedCity, let index = </p><p class="source-code">   collectionView.indexPathsForSelectedItems?.first?</p><p class="source-code">   .row {</p><p class="source-code">      viewController.selectedCuisine = </p><p class="source-code">      manager.exploreItem(at: index).name</p><p class="source-code">      viewController.selectedCity = city</p><p class="source-code">   }</p><p class="source-code">}</p><p>You will call this method before the <strong class="bold">Explore</strong> screen transitions to the <strong class="bold">Restaurant List</strong> screen. The <strong class="source-inline">if-let</strong> statement checks to see whether the destination view controller is the <strong class="source-inline">RestaurantListViewController</strong> instance, sets <strong class="source-inline">city</strong> to the <strong class="source-inline">selectedCity</strong> value of the <strong class="source-inline">ExploreViewController</strong> instance if it is, and gets the index of the collection view cell the user tapped. If the statement is successful, the <strong class="source-inline">RestaurantListViewController</strong> instance's <strong class="source-inline">selectedCuisine</strong> property is set to the <strong class="source-inline">name</strong> of the <strong class="source-inline">ExploreItem</strong> instance located at that index in the <strong class="source-inline">items</strong> array. In the next line, the <strong class="source-inline">RestaurantListViewController</strong> instance's <strong class="source-inline">selectedCity</strong> property will be assigned the value stored in <strong class="source-inline">city</strong>.</p></li>
			</ol>
			<p>For this method <a id="_idIndexMarker934"/>to work, the <strong class="source-inline">selectedCity</strong> property of the <strong class="source-inline">ExploreViewController</strong> instance has to be set first before transitioning to the <strong class="bold">Restaurant Detail</strong> screen. You will alert the user to set the city before choosing a cuisine. Follow these steps:</p>
			<ol>
				<li value="1">Click the <strong class="source-inline">ExploreViewController</strong> file in the Project navigator. Add the following m<a id="_idTextAnchor288"/><a id="_idTextAnchor289"/>ethod before <strong class="source-inline">unwindLocationCancel()</strong> to display an alert:<p class="source-code">func showLocationRequiredAlert() {</p><p class="source-code">   let alertController = UIAlertController(title: </p><p class="source-code">   "Location Needed", message: "Please select a </p><p class="source-code">   location.", preferredStyle: .alert)</p><p class="source-code">   let okAction = UIAlertAction(title: "OK", style: </p><p class="source-code">   .default, handler: nil)</p><p class="source-code">   alertController.addAction(okAction)</p><p class="source-code">   present(alertController, animated: true, </p><p class="source-code">   completion: nil)</p><p class="source-code">}</p><p>The <strong class="source-inline">showLocationRequiredAlert()</strong> method creates a <strong class="source-inline">UIAlertController</strong> instance with the title set to <strong class="source-inline">"Location Needed"</strong> and a message, <strong class="source-inline">"Please select a location."</strong>. A <strong class="source-inline">UIAlertAction</strong> instance with an OK button is then added to the <strong class="source-inline">UIAlertController</strong> instance. Finally, the alert is presented to the user, and tapping the OK button dismisses it.</p></li>
				<li>Add the following code after <strong class="source-inline">viewDidLoad()</strong> to display this alert if a location has not <a id="_idIndexMarker935"/>been selected:<p class="source-code">override func shouldPerformSegue(withIdentifier </p><p class="source-code">identifier: String, sender: Any?) -&gt; Bool {</p><p class="source-code">   if identifier == Segue.restaurantList.rawValue, </p><p class="source-code">   selectedCity == nil {</p><p class="source-code">      showLocationRequiredAlert()</p><p class="source-code">      return false</p><p class="source-code">   }</p><p class="source-code">   return true</p><p class="source-code">}</p><p>The <strong class="source-inline">shouldPerformSegue(withIdentifier:sender:)</strong> method is used to check whether the <strong class="bold">Explore</strong> screen should transition to the <strong class="bold">Restaurant List</strong> screen. First, you check whether the segue identifier for the segue between these two screens matches <strong class="source-inline">restaurantList</strong> and if the <strong class="source-inline">selectedCity</strong> is set; if not, the <strong class="source-inline">showLocationRequiredAlert()</strong> method is called and <strong class="source-inline">shouldPerformSegue(withIdentifier:sender:)</strong> returns <strong class="source-inline">false</strong>. Otherwise, <strong class="source-inline">shouldPerformSegue(withIdentifier:sender:)</strong> returns <strong class="source-inline">true</strong>, and the <strong class="bold">Restaurant List</strong> screen appears.</p></li>
			</ol>
			<p>Now that you've created the <strong class="source-inline">showLocationList(segue:)</strong> and the <strong class="source-inline">showRestaurantList(segue:)</strong> methods, you'll add code to implement the <strong class="source-inline">prepare(for:sender:)</strong> method after <strong class="source-inline">viewDidLoad()</strong> and before <strong class="source-inline">shouldPerformSegue(withIdentifier:)</strong>. This method calls <strong class="source-inline">showLocationList(segue:)</strong> or <strong class="source-inline">showRestaurantList(segue:)</strong> depending on the segue<a id="_idIndexMarker936"/> that will be executed:</p>
			<p class="source-code">override func prepare(for segue: UIStoryboardSegue, sender: Any?) {</p>
			<p class="source-code">   switch segue.identifier! {</p>
			<p class="source-code">   case Segue.locationList.rawValue:</p>
			<p class="source-code">     showLocationList(segue: segue)</p>
			<p class="source-code">   case Segue.restaurantList.rawValue:</p>
			<p class="source-code">     showRestaurantList(segue: segue)</p>
			<p class="source-code">   default:</p>
			<p class="source-code">      print("Segue not added")</p>
			<p class="source-code">   }</p>
			<p class="source-code">}</p>
			<p>When the <strong class="bold">LOCATION</strong> button is tapped, the segue identifier is <strong class="source-inline">locationList</strong>, so the <strong class="source-inline">showLocationList(segue:)</strong> method is executed before the transition to the <strong class="bold">Locations</strong> screen, which sets the checkmark for the selected city in the table view. When a cell in the <strong class="bold">Explore</strong> screen is tapped, the segue identifier is <strong class="source-inline">restaurantList</strong>, so the <strong class="source-inline">showRestaurantListing(segue:)</strong> method is executed before the transition to the <strong class="bold">Restaurant List</strong> screen. This sets the <strong class="source-inline">selectedType</strong> and <strong class="source-inline">selectedCity</strong> properties in the <strong class="source-inline">RestaurantListViewController</strong> instance, which will be printed to the Debug area.</p>
			<p>Build and run your project. If you try to select a cuisine, you'll see this alert, stating you need to select a location:</p>
			<div>
				<div id="_idContainer404" class="IMG---Figure">
					<img src="image/Figure_17.14_B17469.jpg" alt="Figure 17.14: iOS Simulator showing alert&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 17.14: iOS Simulator showing alert</p>
			<p>If you pick a<a id="_idIndexMarker937"/> location, tap <strong class="bold">Done</strong>, and tap the <strong class="bold">LOCATION</strong> button again the location you selected earlier should still be selected:</p>
			<div>
				<div id="_idContainer405" class="IMG---Figure">
					<img src="image/Figure_17.15_B17469.jpg" alt="Figure 17.15: iOS simulator showing Locations screen with checkmark&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 17.15: iOS simulator showing Locations screen with checkmark</p>
			<p>If you pick a <a id="_idIndexMarker938"/>cuisine, you'll see the <strong class="bold">Restaurant List</strong> screen:</p>
			<div>
				<div id="_idContainer406" class="IMG---Figure">
					<img src="image/Figure_17.16_B17469.jpg" alt="Figure 17.16: iOS Simulator showing Restaurant List screen&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 17.16: iOS Simulator showing Restaurant List screen</p>
			<p>The location<a id="_idIndexMarker939"/> and cuisine you picked will appear in the Debug area:</p>
			<div>
				<div id="_idContainer407" class="IMG---Figure">
					<img src="image/Figure_17.17_B17469.jpg" alt="Figure 17.17: Debug area showing location and cuisine you selected&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 17.17: Debug area showing location and cuisine you selected</p>
			<p>Now that the <strong class="source-inline">RestaurantListViewController</strong> instance has a location, you can get the restaurant data for that location from the <strong class="source-inline">RestaurantDataManager</strong> instance. Click the <strong class="source-inline">RestaurantListViewController</strong> file in the Project navigator and update <strong class="source-inline">viewDidAppear()</strong> as follows. This prints the list of restaurants from the selected <a id="_idIndexMarker940"/>location that serves the selected cuisine:</p>
			<p class="source-code">override func viewDidAppear(_ animated: Bool) {</p>
			<p class="source-code">   super.viewDidAppear(animated)</p>
			<p class="source-code"><strong class="bold">   guard let city = selectedCity?.city, let cuisine = </strong></p>
			<p class="source-code"><strong class="bold">   selectedCuisine else { </strong></p>
			<p class="source-code"><strong class="bold">      return </strong></p>
			<p class="source-code"><strong class="bold">   }</strong></p>
			<p class="source-code"><strong class="bold">   let manager = RestaurantDataManager()</strong></p>
			<p class="source-code"><strong class="bold">   manager.fetch(location: city, selectedCuisine: cuisine) {</strong></p>
			<p class="source-code"><strong class="bold">      restaurantItems in if !restaurantItems.isEmpty {</strong></p>
			<p class="source-code"><strong class="bold">         for restaurantItem in restaurantItems {</strong></p>
			<p class="source-code"><strong class="bold">            if let restaurantName = restaurantItem.name {</strong></p>
			<p class="source-code"><strong class="bold">               print(restaurantName)</strong></p>
			<p class="source-code"><strong class="bold">            }</strong></p>
			<p class="source-code"><strong class="bold">         }</strong></p>
			<p class="source-code"><strong class="bold">      } else {</strong></p>
			<p class="source-code"><strong class="bold">         print("No data")</strong></p>
			<p class="source-code"><strong class="bold">      }</strong></p>
			<p class="source-code"><strong class="bold">   }</strong></p>
			<p class="source-code">}</p>
			<p>The <strong class="source-inline">guard</strong> statement checks to see if <strong class="source-inline">city</strong> and <strong class="source-inline">cuisine</strong> have been assigned values successfully, and returns if they have not. Next, an instance of <strong class="source-inline">RestaurantDataManager</strong> is created and assigned to <strong class="source-inline">manager</strong>. The <strong class="source-inline">fetch(location:selectedCuisine:completion:)</strong> method returns an array of <strong class="source-inline">RestaurantItem</strong> instances for the selected <strong class="source-inline">city</strong> and <strong class="source-inline">cuisine</strong>, and the <strong class="source-inline">for</strong> loop prints the restaurant names to the Debug area. If there are no restaurants matching the criteria, <strong class="source-inline">No data</strong> will be printed to the Debug area. Build and run your project, select a city, tap a cuisine, and note the results in the Debug area. </p>
			<p>You can also see the results in the Report navigator. Click the Report navigator button and select<a id="_idIndexMarker941"/> the first entry as shown:</p>
			<div>
				<div id="_idContainer408" class="IMG---Figure">
					<img src="image/Figure_17.18_B17469.jpg" alt="Figure 17.18: Report navigator showing list of restaurant names&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 17.18: Report navigator showing list of restaurant names</p>
			<p>You'll see either a list of restaurants or <strong class="source-inline">No data</strong> in the Editor area.</p>
			<p>So, at this point, the <strong class="source-inline">RestaurantListViewController</strong> instance is successfully getting the data that it needs to display the list of restaurants. Now that you have this data, you need to configure the collection view to display it to the user. To do that, you will need to create a view controller for the collection view cells, and configure the <strong class="source-inline">RestaurantListViewController</strong> instance to populate them. You will do this in the next section.</p>
			<h2 id="_idParaDest-256"><a id="_idTextAnchor290"/>Creating a view controller for the cells on the Restaurant List screen</h2>
			<p>At present <a id="_idIndexMarker942"/>the <strong class="bold">Restaurant List</strong> screen does not have a class to manage the collection view cells inside its collection view. You'll create a <strong class="source-inline">RestaurantCell</strong> class for this purpose. Follow these steps:</p>
			<ol>
				<li value="1">Right-click the <strong class="source-inline">Restaurants</strong> folder and choose <strong class="bold">New Group</strong>. Name it <strong class="source-inline">View</strong>.</li>
				<li>Right-click the <strong class="source-inline">View</strong> folder and select <strong class="bold">New File</strong>.</li>
				<li><strong class="bold">iOS</strong> should already be selected. Choose <strong class="bold">Cocoa Touch Class</strong> and then click <strong class="bold">Next</strong>.</li>
				<li>Configure <a id="_idIndexMarker943"/>the file as follows:<p><strong class="bold">Class</strong>: <strong class="source-inline">RestaurantCell</strong></p><p><strong class="bold">Subclass</strong>: <strong class="source-inline">UICollectionViewCell </strong></p><p><strong class="bold">Also create XIB</strong>: Unchecked </p><p><strong class="bold">Language</strong>: <strong class="source-inline">Swift</strong></p><p>Click <strong class="bold">Next</strong>.</p></li>
				<li>Click <strong class="bold">Create</strong>. The <strong class="source-inline">RestaurantCell</strong> file appears in the Project navigator. It contains the implementation of the <strong class="source-inline">RestaurantCell</strong> class:<p class="source-code">import UIKit</p><p class="source-code">class RestaurantCell: UICollectionViewCell {</p><p class="source-code">}</p></li>
			</ol>
			<p>Now let's create the outlets for the collection view cell in the <strong class="bold">Restaurant List</strong> screen so their contents can be managed by the <strong class="source-inline">RestaurantCell</strong> class. You will do this in the next section.</p>
			<h2 id="_idParaDest-257"><a id="_idTextAnchor291"/>Connecting the outlets for the RestaurantCell class</h2>
			<p>Now that you've <a id="_idIndexMarker944"/>created the <strong class="source-inline">RestaurantCell</strong> class, you'll need to create outlets in it and link them to the UI elements inside the collection view cells for the <strong class="bold">Restaurant List </strong>screen. This will allow <strong class="source-inline">RestaurantCell</strong> instances to manage what is displayed by the collection view cell. Follow these steps:</p>
			<ol>
				<li value="1">Click the <strong class="source-inline">Main</strong> storyboard file. Click <strong class="source-inline">restaurantCell</strong> in the <strong class="bold">Restaurant List View Controller Scene</strong>. In the<a id="_idIndexMarker945"/> Identity inspector, under <strong class="bold">Custom Class</strong>, set <strong class="bold">Class</strong> to <strong class="source-inline">RestaurantCell</strong>:<div id="_idContainer409" class="IMG---Figure"><img src="image/Figure_17.19_B17469.jpg" alt="Figure 17.19: Identity inspector Class settings for restaurantCell&#13;&#10;"/></div><p class="figure-caption">Figure 17.19: Identity inspector Class settings for restaurantCell</p></li>
				<li>In <strong class="bold">Restaurant List View Controller Scene</strong>, click on the label with the text <strong class="bold">Available Times</strong> in the document outline. This is to ensure you can select the correct file (<strong class="source-inline">RestaurantCell.swift</strong>) to be displayed in the assistant editor when the Adjust Editor Options button is clicked: <div id="_idContainer410" class="IMG---Figure"><img src="image/Figure_17.20_B17469.jpg" alt="Figure 17.20: Document outline with Available Times label selected&#13;&#10;"/></div><p class="figure-caption">Figure 17.20: Document outline with Available Times label selected</p></li>
				<li>Click the<a id="_idIndexMarker946"/> Adjust Editor Options button and choose <strong class="bold">Assistant</strong> from the menu.</li>
				<li>The assistant editor appears. The path bar at the top should show <strong class="bold">Automatic &gt; RestaurantCell.swift</strong>. If it does not, select it from the pop-up menu. <em class="italic">Ctrl + Drag</em> from the title <strong class="bold">Label</strong> to the space between the curly braces in the <strong class="source-inline">RestaurantCell</strong> file:<div id="_idContainer411" class="IMG---Figure"><img src="image/Figure_17.21_B17469.jpg" alt="Figure 17.21: Assistant editor showing RestaurantCell.swift&#13;&#10;"/></div><p class="figure-caption">Figure 17.21: Assistant editor showing RestaurantCell.swift</p></li>
				<li>In the box that appears, type <strong class="source-inline">titleLabel</strong> in the <strong class="bold">Name</strong> field and click <strong class="bold">Connect</strong>:<div id="_idContainer412" class="IMG---Figure"><img src="image/Figure_17.22_B17469.jpg" alt="Figure 17.22: Dialog box showing label Name set to titleLabel&#13;&#10;"/></div><p class="figure-caption">Figure 17.22: Dialog box showing label Name set to titleLabel</p></li>
				<li><em class="italic">Ctrl + Drag</em> from the subtitle <strong class="bold">Label</strong> to just after the <strong class="source-inline">titleLabel</strong> property you just <a id="_idIndexMarker947"/>created. In the box that appears, type <strong class="source-inline">cuisineLabel</strong> in the <strong class="bold">Name</strong> field and click <strong class="bold">Connect</strong>:<div id="_idContainer413" class="IMG---Figure"><img src="image/Figure_17.23_B17469.jpg" alt="Figure 17.23: Dialog box showing label Name set to cuisineLabel&#13;&#10;"/></div><p class="figure-caption">Figure 17.23: Dialog box showing label Name set to cuisineLabel</p></li>
				<li><em class="italic">Ctrl + Drag</em> from the <strong class="source-inline">american</strong> image view to just after the other properties you created. In the box that appears, type <strong class="source-inline">restaurantImageView</strong> in the <strong class="bold">Name</strong> field and click <strong class="bold">Connect</strong>:<div id="_idContainer414" class="IMG---Figure"><img src="image/Figure_17.24_B17469.jpg" alt="Figure 17.24: Dialog box showing image view Name set to restaurantImageView&#13;&#10;"/></div><p class="figure-caption">Figure 17.24: Dialog box showing image view Name set to restaurantImageView</p></li>
				<li>Click the <strong class="bold">x</strong> button to close the assistant editor.</li>
			</ol>
			<p>The outlets for the <strong class="source-inline">RestaurantCell</strong> class are now connected to the UI elements in the collection view cell. Later you'll configure the <strong class="source-inline">RestaurantListViewController</strong> instance to populate this collection view, but before you<a id="_idIndexMarker948"/> do, there is a possibility to consider. The user's choices for location and cuisine may not return any results, so you will implement a screen that informs the user when there is no data to be displayed. You'll do this in the next section.</p>
			<h2 id="_idParaDest-258"><a id="_idTextAnchor292"/>Displaying a custom UIView to indicate no data is available</h2>
			<p>The location <a id="_idIndexMarker949"/>and cuisine choices the user makes on the <strong class="bold">Explore</strong> screen may not return any results. If this is the case, you will display a custom view stating that fact on the <strong class="bold">Restaurant List</strong> screen. To do this, you will create a <strong class="source-inline">UIView</strong> subclass and an accompanying <strong class="bold">XIB</strong> file. XIB stands for <strong class="bold">Xcode Interface Builder</strong> and XIB files were used to create the user interface before storyboards were implemented. Let's create both files now by following these steps:</p>
			<ol>
				<li value="1">Right-click on the <strong class="source-inline">Misc</strong> folder and select <strong class="bold">New Group</strong>. Name it <strong class="source-inline">No Data</strong>.</li>
				<li>Right-click on the <strong class="source-inline">No Data</strong> folder and choose <strong class="bold">New File</strong>.</li>
				<li><strong class="bold">iOS</strong> should already be selected. Choose <strong class="bold">Cocoa Touch Class</strong> and then click <strong class="bold">Next</strong>.</li>
				<li>Configure the file as follows:<p><strong class="bold">Class</strong>: <strong class="source-inline">NoDataView</strong></p><p><strong class="bold">Subclass</strong>: <strong class="source-inline">UIView</strong></p><p><strong class="bold">Also create XIB</strong>: Grayed out</p><p><strong class="bold">Language</strong>: <strong class="source-inline">Swift</strong></p><p>Click <strong class="bold">Next</strong>.</p></li>
				<li>Click <strong class="bold">Create</strong>. The <strong class="source-inline">NoDataView</strong> file <a id="_idIndexMarker950"/>appears in the Project navigator.</li>
				<li>Right-click on the <strong class="source-inline">No Data</strong> folder and create a new file.</li>
				<li><strong class="bold">iOS</strong> should already be selected. Choose <strong class="bold">View</strong> and then click <strong class="bold">Next</strong>.</li>
				<li>Name this file <strong class="source-inline">NoDataView</strong>. Click <strong class="bold">Create</strong>. The <strong class="source-inline">NoDataView</strong> XIB file appears in the Project navigator.</li>
				<li>Click the <strong class="source-inline">NoDataView</strong> file in the Project navi<a id="_idTextAnchor293"/><a id="_idTextAnchor294"/>gator and declare and define the <strong class="source-inline">NoDataView</strong> class as follows:<p class="source-code">class NoDataView: UIView {</p><p class="source-code">   var view: UIView!</p><p class="source-code">   @IBOutlet var titleLabel: UILabel!</p><p class="source-code">   @IBOutlet var descLabel: UILabel!</p><p class="source-code">   override init(frame: CGRect) { </p><p class="source-code">      super.init(frame: frame) </p><p class="source-code">      setupView()</p><p class="source-code">   }</p><p class="source-code">   required init?(coder: NSCoder) { </p><p class="source-code">      super.init(coder: coder)</p><p class="source-code">      setupView()</p><p class="source-code">   }</p><p class="source-code">   func loadViewFromNib() -&gt; UIView {</p><p class="source-code">      let nib = UINib(nibName: "NoDataView", bundle: </p><p class="source-code">      Bundle.main)</p><p class="source-code">      let view = nib.instantiate(withOwner: self, </p><p class="source-code">      options: nil) [0] as! UIView </p><p class="source-code">      return view</p><p class="source-code">   }</p><p class="source-code">   func setupView() {</p><p class="source-code">      view = loadViewFromNib()</p><p class="source-code">      view.frame = bounds</p><p class="source-code">      view.autoresizingMask = [.flexibleWidth, </p><p class="source-code">      .flexibleHeight]</p><p class="source-code">      addSubview(view)</p><p class="source-code">   }</p><p class="source-code">   func set(title: String, desc: String) {</p><p class="source-code">      titleLabel.text = title</p><p class="source-code">      descLabel.text = desc</p><p class="source-code">   }</p><p class="source-code">}</p></li>
			</ol>
			<p>This class is a subclass of the <strong class="source-inline">UIView</strong> class, and it will manage the view in the <strong class="source-inline">NoDataView</strong> XIB file. Let's break this down:</p>
			<p class="source-code">var view: UIView!</p>
			<p class="source-code">@IBOutlet var titleLabel: UILabel!</p>
			<p class="source-code">@IBOutlet var descLabel: UILabel!</p>
			<p><strong class="source-inline">view</strong> will be assigned the view from the <strong class="source-inline">NoDataView</strong> XIB file during initialization.</p>
			<p><strong class="source-inline">titleLabel</strong> and <strong class="source-inline">descLabel</strong> will be assigned to two <strong class="source-inline">UILabel</strong> instances that will be placed <a id="_idIndexMarker951"/>in the <strong class="source-inline">NoDataView</strong> XIB file when you build the user interface in the next section.</p>
			<p class="source-code">override init(frame: CGRect) { </p>
			<p class="source-code">   super.init(frame:frame) </p>
			<p class="source-code">   setupView()</p>
			<p class="source-code">}</p>
			<p class="source-code">required init?(coder: NSCoder) { </p>
			<p class="source-code">   super.init(coder: coder)</p>
			<p class="source-code">   setupView()</p>
			<p class="source-code">}</p>
			<p>The <strong class="source-inline">NoDataView</strong> class is a subclass of <strong class="source-inline">UIView</strong>. A <strong class="source-inline">UIView</strong> object has two <strong class="source-inline">init</strong> methods: the first handles view creation programmatically, and the second handles the loading of XIB files from the app bundle stored on the device. Here, both methods will call <strong class="source-inline">setupView()</strong>.</p>
			<p class="source-code">func loadViewFromNib() -&gt; UIView {</p>
			<p class="source-code">   let nib = UINib(nibName: "NoDataView", bundle: </p>
			<p class="source-code">   Bundle.main)</p>
			<p class="source-code">   let view = nib.instantiate(withOwner: self, </p>
			<p class="source-code">   options: nil) [0] as! UIView</p>
			<p class="source-code">   return view</p>
			<p class="source-code">}</p>
			<p>This method finds and loads the <strong class="source-inline">NoDataView</strong> XIB file from the app bundle and returns a <strong class="source-inline">UIView</strong> instance stored inside it.</p>
			<p class="source-code">func setupView() {</p>
			<p class="source-code">   view = loadViewFromNib()</p>
			<p class="source-code">   view.frame = bounds</p>
			<p class="source-code">   view.autoresizingMask = [.flexibleWidth, .flexibleHeight]</p>
			<p class="source-code">   addSubview(view)</p>
			<p class="source-code">}</p>
			<p>This method calls <strong class="source-inline">loadViewFromNib()</strong>, configures the view so it is the same size as the device<a id="_idIndexMarker952"/> screen, makes the width and height of the view flexible to adapt to size and orientation changes, and adds it to the device view hierarchy so it is visible onscreen.</p>
			<p class="source-code">func set(title: String, desc: String) {</p>
			<p class="source-code">   titleLabel.text = title</p>
			<p class="source-code">   descLabel.text = desc</p>
			<p class="source-code">}</p>
			<p>This method sets the text of the <strong class="source-inline">titleLabel</strong> and <strong class="source-inline">descLabel</strong> properties. </p>
			<p>Now let's set up the <strong class="source-inline">NoDataView</strong> XIB file. You may want to refer to <a href="B17469_12_Final_VK_ePub.xhtml#_idTextAnchor182"><em class="italic">Chapter 12</em></a><em class="italic">, Modifying and Configuring Cells</em>, which covers using the Size inspector and the Auto Layout constraint menus in more detail. Follow these steps:</p>
			<ol>
				<li value="1">Click the <strong class="source-inline">NoDataView</strong> XIB file in the Project navigator.</li>
				<li>Select <strong class="bold">File's Owner</strong> in the document outline. In the Identity inspector, under <strong class="bold">Custom Class</strong>, set <strong class="bold">Class</strong> to <strong class="source-inline">NoDataView</strong> and press <em class="italic">Return</em>.</li>
				<li>Click the Library button to display the library. Type <strong class="source-inline">label</strong> in the filter field. A <strong class="bold">Label</strong> object appears in the results.</li>
				<li>Drag two <strong class="bold">Label</strong> objects into the <strong class="bold">View</strong>, with one <strong class="bold">Label</strong> object above the other.</li>
				<li>Select the top label to represent the title. In the Attributes inspector, update the following values:<p><strong class="bold">Text</strong>: Add <strong class="source-inline">TITLE GOES HERE</strong> to the text field under the <strong class="bold">Text</strong> setting</p><p><strong class="bold">Color</strong>: <strong class="source-inline">Default (Label Color)</strong></p><p><strong class="bold">Alignment</strong>: <strong class="source-inline">Center</strong></p><p><strong class="bold">Font</strong>: <strong class="source-inline">System Bold 26.0</strong></p></li>
				<li>With the <a id="_idIndexMarker953"/>same label selected, update the following values in the Size inspector:<p><strong class="bold">Width</strong>: <strong class="source-inline">335</strong></p><p><strong class="bold">Height</strong>: <strong class="source-inline">36</strong></p></li>
				<li>Select the bottom label. This will represent the description. In the Attributes inspector, update the following values:<p><strong class="bold">Text</strong>: Add <strong class="source-inline">Description goes here</strong> to the text field under the <strong class="bold">Text</strong> setting</p><p><strong class="bold">Color</strong>: <strong class="source-inline">Default (Label Color)</strong></p><p><strong class="bold">Alignment</strong>: <strong class="source-inline">Center</strong></p><p><strong class="bold">Font</strong>: <strong class="source-inline">System Thin 17.0</strong></p></li>
				<li>In the Size inspector, update the following values:<p><strong class="bold">Width</strong>: <strong class="source-inline">335</strong></p><p><strong class="bold">Height</strong>: <strong class="source-inline">21</strong></p></li>
				<li>Select both labels by clicking the first label and holding down the <em class="italic">Shift</em> key while selecting the second label. </li>
				<li>With both labels still selected, click the <strong class="bold">Editor</strong> menu and choose <strong class="bold">Embed In </strong>|<strong class="bold"> Stack View</strong>.</li>
				<li>Select the <strong class="bold">Stack View</strong> in the document outline, and click the Attributes inspector button. Under <strong class="bold">Stack View</strong>, set the following values:<p><strong class="bold">Axis</strong>: <strong class="source-inline">Vertical</strong></p><p><strong class="bold">Alignment</strong>: <strong class="source-inline">Center</strong></p><p><strong class="bold">Spacing</strong>: <strong class="source-inline">8</strong></p></li>
				<li>With the <strong class="bold">Stack View</strong> selected, click the Add New Constraints button. Set the following <a id="_idIndexMarker954"/>values:<p><strong class="bold">Left</strong>: <strong class="source-inline">10</strong></p><p><strong class="bold">Right</strong>: <strong class="source-inline">10</strong></p><p>Click the <strong class="bold">Add 2 constraints</strong> button.</p></li>
				<li>With the <strong class="bold">Stack View</strong> still selected, click the Align button. Set the following values:<p><strong class="bold">Horizontally in Container</strong> (ticked) </p><p><strong class="bold">Vertically in Container</strong> (ticked) </p><p>Click the <strong class="bold">Add 2 Constraints</strong> button.</p></li>
				<li>Select <strong class="bold">File's Owner</strong> in the document outline.</li>
				<li>Open the Connections inspector and connect <strong class="source-inline">titleLabel</strong> to the label that says <strong class="source-inline">TITLE GOES HERE</strong>.</li>
				<li>Connect <strong class="source-inline">descLabel</strong> to the other label.</li>
			</ol>
			<p>When you are done, you should see the following:</p>
			<div>
				<div id="_idContainer415" class="IMG---Figure">
					<img src="image/Figure_17.25_B17469.jpg" alt="Figure 17.25: Editor area showing NoDataView XIB file contents&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 17.25: Editor area showing NoDataView XIB file contents</p>
			<p>You have completed configuring <strong class="source-inline">NoDataView.xib</strong>. Now, let's put it all together so that the <strong class="bold">Restaurant List</strong> screen will display a list of restaurants based on the selected location and cuisine, or display the <strong class="source-inline">NoDataView</strong> if there aren't any restaurants offering the <a id="_idIndexMarker955"/>selected cuisine at a particular location. You will do this in the next section.</p>
			<h2 id="_idParaDest-259"><a id="_idTextAnchor295"/>Displaying a list of restaurants on the Restaurant List screen</h2>
			<p>You now have <a id="_idIndexMarker956"/>everything you need to display a list of restaurants based on the selected location and cuisine on the <strong class="bold">Restaurant List</strong> screen. So, now it's time to put it all together. Follow these steps:</p>
			<ol>
				<li value="1">Click the <strong class="source-inline">RestaurantListViewController</strong> file in the Project navigator. Before the <strong class="source-inline">selectedRestaurant</strong> property, add the following to create an instance of <strong class="source-inline">RestaurantDataManager</strong> and assign it to a <strong class="source-inline">manager</strong> property:<p class="source-code"><strong class="bold">private let manager = RestaurantDataManager()</strong></p><p class="source-code">var selectedRestaurant: RestaurantItem?</p></li>
				<li>Add the following method inside the <strong class="source-inline">private</strong> extension to populate <strong class="source-inline">manager</strong>'s <strong class="source-inline">items</strong> array and to set the background view for the <strong class="bold">Restaurant List </strong>screen:<p class="source-code">func createData() {</p><p class="source-code">   guard let city = selectedCity?.city, let </p><p class="source-code">   cuisine = selectedCuisine else { </p><p class="source-code">      return </p><p class="source-code">   }</p><p class="source-code">   manager.fetch(location: city, </p><p class="source-code">   selectedCuisine: cuisine) {restaurantItems in </p><p class="source-code">      if !restaurantItems.isEmpty {</p><p class="source-code">         collectionView.backgroundView = nil</p><p class="source-code">      } else {</p><p class="source-code">         let view = NoDataView(frame: CGRect(x: 0, </p><p class="source-code">         y: 0, width: collectionView.frame.width, </p><p class="source-code">         height: collectionView.frame.height)) </p><p class="source-code">         view.set(title: "Restaurants", desc: </p><p class="source-code">         "No restaurants found.")</p><p class="source-code">         collectionView.backgroundView = view</p><p class="source-code">      }</p><p class="source-code">      collectionView.reloadData()</p><p class="source-code">   }</p><p class="source-code">}</p><p>Let's break<a id="_idIndexMarker957"/> this down:</p><p class="source-code">guard let city = selectedCity?.city, let cuisine = </p><p class="source-code">selectedCuisine else { </p><p class="source-code">   return </p><p class="source-code">}</p><p>Checks to see whether the <strong class="source-inline">selectedCity</strong> and <strong class="source-inline">selectedCuisine</strong> properties are set; if they are, assign <strong class="source-inline">selectedCity</strong> to <strong class="source-inline">city</strong> and <strong class="source-inline">selectedCuisine</strong> to <strong class="source-inline">cuisine</strong>. Otherwise, exit the method.</p><p class="source-code">manager.fetch(location: city, selectedCuisine: cuisine)</p><p>Calls the <strong class="source-inline">fetch(location:selectedCuisine:completion:)</strong> method of the <strong class="source-inline">RestaurantDataManager</strong> instance, which loads the appropriate <strong class="source-inline">RestaurantItem</strong> instances<a id="_idIndexMarker958"/> into its <strong class="source-inline">restaurantItems</strong> array.</p><p class="source-code">{ restaurantItems in</p><p class="source-code">   if !restaurantItems.isEmpty {</p><p class="source-code">      collectionView.backgroundView = nil</p><p class="source-code">   } else {</p><p class="source-code">      let view = NoDataView(frame: CGRect(x: 0, y: 0, </p><p class="source-code">      width: collectionView.frame.width, height: </p><p class="source-code">      collectionView.frame.height))</p><p class="source-code">      view.set(title: "Restaurants", desc: </p><p class="source-code">      "No restaurants found.") </p><p class="source-code">      collectionView.backgroundView = view</p><p class="source-code">   }</p><p>If the <strong class="source-inline">restaurantItems</strong> array of the <strong class="source-inline">RestaurantDataManager</strong> instance is not empty, set <strong class="source-inline">backgroundView</strong> of the <strong class="source-inline">collectionView</strong> instance to <strong class="source-inline">nil</strong>. Otherwise, create an instance of <strong class="source-inline">NoDataView</strong>, set its title and description, and set it as the <strong class="source-inline">backgroundView</strong> property of the <strong class="source-inline">collectionView</strong> instance.</p><p class="source-code">collectionView.reloadData()</p><p>Tells <strong class="source-inline">collectionView</strong> to refresh its view.</p></li>
				<li>Update <strong class="source-inline">collectionView(_:cellForItemAt:)</strong> as follows to set the <strong class="source-inline">RestaurantCell</strong> instance's<a id="_idIndexMarker959"/> properties:<p class="source-code">func collectionView(_ collectionView: </p><p class="source-code">UICollectionView, cellForItemAt indexPath: IndexPath) </p><p class="source-code">-&gt; UICollectionViewCell {</p><p class="source-code">   <strong class="bold">let cell =</strong> collectionView.dequeueReusableCell(</p><p class="source-code">   withReuseIdentifier: "restaurantCell", for: </p><p class="source-code">   indexPath) <strong class="bold">as! RestaurantCell</strong></p><p class="source-code"><strong class="bold">   let restaurantItem = manager.restaurantItem(at:</strong></p><p class="source-code"><strong class="bold">   indexPath.row)</strong></p><p class="source-code"><strong class="bold">   cell.titleLabel.text = restaurantItem.name</strong></p><p class="source-code"><strong class="bold">   if let cuisine = restaurantItem.subtitle { </strong></p><p class="source-code"><strong class="bold">      cell.cuisineLabel.text = cuisine </strong></p><p class="source-code"><strong class="bold">   }</strong></p><p class="source-code"><strong class="bold">   if let imageURL = restaurantItem.imageURL {</strong></p><p class="source-code"><strong class="bold">      if let url = URL(string: imageURL) {</strong></p><p class="source-code"><strong class="bold">         let data = try? Data(contentsOf: url)</strong></p><p class="source-code"><strong class="bold">         if let imageData = data { </strong></p><p class="source-code"><strong class="bold">            DispatchQueue.main.async {</strong></p><p class="source-code"><strong class="bold">               cell.restaurantImageView.image = </strong></p><p class="source-code"><strong class="bold">               UIImage(data: imageData)</strong></p><p class="source-code"><strong class="bold">            }</strong></p><p class="source-code"><strong class="bold">         }</strong></p><p class="source-code"><strong class="bold">      }</strong></p><p class="source-code"><strong class="bold">   }</strong></p><p class="source-code"><strong class="bold">   return cell</strong></p><p class="source-code"><strong class="bold">}</strong></p><p>Let's break this down:</p><p class="source-code">let restaurantItem = manager.restaurantItem(at:</p><p class="source-code">indexPath.row)</p><p>Gets the <strong class="source-inline">RestaurantItem</strong> instance from the <strong class="source-inline">restaurantItems</strong> array of the <strong class="source-inline">RestaurantDataManager</strong> instance corresponding to the <strong class="source-inline">RestaurantCell</strong> instance's position.</p><p class="source-code">cell.titleLabel.text = restaurantItem.name</p><p>This sets the text of the <strong class="source-inline">RestaurantCell</strong> instance's <strong class="source-inline">titleLabel</strong> to the value of<a id="_idIndexMarker960"/> the <strong class="source-inline">RestaurantItem</strong> instance's <strong class="source-inline">name</strong>.</p><p class="source-code">if let cuisine = restaurantItem.subtitle { </p><p class="source-code">   cell.cuisineLabel.text = cuisine</p><p class="source-code">}</p><p>This sets the text of the <strong class="source-inline">RestaurantCell</strong> instance's <strong class="source-inline">cuisineLabel</strong> to the value of the <strong class="source-inline">RestaurantItem</strong> instance's <strong class="source-inline">subtitle</strong>.</p><p class="source-code">if let imageURL = restaurantItem.imageURL {</p><p class="source-code">   if let url = URL(string: imageURL) {</p><p class="source-code">      let data = try? Data(contentsOf: url) </p><p class="source-code">      if let imageData = data {</p><p class="source-code">         DispatchQueue.main.async {</p><p class="source-code">            cell.restaurantImageView.image =</p><p class="source-code">            UIImage(data: imageData)</p><p class="source-code">         }</p><p class="source-code">      }</p><p class="source-code">   }</p><p class="source-code">}</p><p>This downloads the picture of the restaurant from the URL specified in the <strong class="source-inline">RestaurantItem</strong> instance's <strong class="source-inline">imageURL</strong> and assigns it to the <strong class="source-inline">image</strong> property of the <strong class="source-inline">RestaurantCell</strong> instance's <strong class="source-inline">imgRestaurant</strong> property.</p><p class="source-code">   return cell</p><p class="source-code">}</p><p>Returns <a id="_idIndexMarker961"/>the collection view cell.</p><p class="callout-heading">Important Information</p><p class="callout">You will notice that scrolling is jerky, and if there is no internet connection, the <strong class="bold">Restaurant List</strong> screen will be blank. This is because downloading images from the internet takes time, and is interrupting the rendering of the collection view. These issues will be fixed in <a href="B17469_24_Final_VK_ePub.xhtml#_idTextAnchor469"><em class="italic">Chapter 24</em></a><em class="italic">, Swift Concurrency</em>.</p></li>
				<li>Update <strong class="source-inline">collectionView(_:numberOfItemsInSection:)</strong> as follows to get the number of collection views to be displayed from <strong class="source-inline">manager</strong>:<p class="source-code">func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -&gt; Int {</p><p class="source-code">   <strong class="bold">manager.numberOfRestaurantItems()</strong></p><p class="source-code">}</p></li>
				<li>Update <strong class="source-inline">viewDidAppear()</strong> as follows to call <strong class="source-inline">createData()</strong> when the collection view appears onscreen:<p class="source-code">override func viewDidAppear(animated: Bool) {</p><p class="source-code">   super.viewDidAppear(animated)</p><p class="source-code">   <strong class="bold">createData()</strong></p><p class="source-code">}</p></li>
			</ol>
			<p>Build and run your app. Set a location and click a cuisine. If there are restaurants that match the selected criteria, you'll see them displayed in the <strong class="bold">Restaurant List</strong> screen. Otherwise, the <strong class="source-inline">NoDataView</strong> instance<a id="_idIndexMarker962"/> will be displayed.</p>
			<div>
				<div id="_idContainer416" class="IMG---Figure">
					<img src="image/Figure_17.26_B17469.jpg" alt="Figure 17.26: iOS simulator showing Restaurant List screen&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 17.26: iOS simulator showing Restaurant List screen</p>
			<p>Before you finish with the <strong class="source-inline">RestaurantListViewController</strong> class, there is just one more thing. It would be nice if the selected city were shown in the <strong class="bold">Restaurant List</strong> screen. Let's add code to display it at the top of the <strong class="bold">Restaurant List</strong> screen's navigation bar using large titles. Follow these steps:</p>
			<ol>
				<li value="1">In the <strong class="source-inline">RestaurantListViewController</strong> file, add the following method into the <strong class="source-inline">private</strong> extension<a id="_idTextAnchor296"/><a id="_idTextAnchor297"/> after <strong class="source-inline">createData()</strong> to display the selected city in the navigation bar:<p class="source-code">func setupTitle() {</p><p class="source-code">   navigationController?.setNavigationBarHidden(</p><p class="source-code">   false, animated: false)</p><p class="source-code">   title = selectedCity?.cityAndState.uppercased()</p><p class="source-code">   navigationController?.navigationBar.</p><p class="source-code">   prefersLargeTitles = true</p><p class="source-code">}</p><p>Every <strong class="source-inline">UIViewController</strong> instance has a <strong class="source-inline">title</strong> property, and if the navigation<a id="_idIndexMarker963"/> bar is visible, <strong class="source-inline">title</strong> will be visible as well. This method shows the navigation bar and sets the <strong class="source-inline">RestaurantListViewController</strong> instance's <strong class="source-inline">title</strong> to a string containing the city and state names in uppercase.</p></li>
				<li>Call <strong class="source-inline">setupTitle()</strong> after <strong class="source-inline">createData()</strong> in the <strong class="source-inline">viewDidLoad()</strong> method:<p class="source-code">override func viewDidLoad(_ animated: Bool){</p><p class="source-code">   super.viewDidLoad(animated)</p><p class="source-code">   createData()</p><p class="source-code">   <strong class="bold">setupTitle()</strong></p><p class="source-code">}</p><p>This calls the <strong class="source-inline">setupTitle()</strong> method when the <strong class="bold">Restaurant List</strong> screen appears.</p></li>
			</ol>
			<p>Build and run your app. Select a location and cuisine. You should see the city and state in uppercase letters at the top of the <strong class="bold">Restaurant List</strong> screen:</p>
			<div>
				<div id="_idContainer417" class="IMG---Figure">
					<img src="image/Figure_17.27_B17469.jpg" alt="Figure 17.27: iOS Simulator showing Restaurant List screen with title&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 17.27: iOS Simulator showing Restaurant List screen with title</p>
			<p>You have<a id="_idIndexMarker964"/> completed the implementation of the <strong class="bold">Restaurant List</strong> screen, and you have finally reached the end of this chapter. Good job!</p>
			<h1 id="_idParaDest-260"><a id="_idTextAnchor298"/>Summary</h1>
			<p>You have accomplished a lot in this chapter. You started by learning about the JSON format, and you created the <strong class="source-inline">RestaurantDataManager</strong> class, a data manager class that can load data from JSON files. You configured the <strong class="source-inline">MapViewController</strong> class to get data from a <strong class="source-inline">RestaurantDataManager</strong> instance to display a list of restaurants on the <strong class="bold">Map</strong> screen. Next, you configured the <strong class="source-inline">LocationViewController</strong> class to store the location selected by the user and pass it to an <strong class="source-inline">ExploreViewController</strong> instance when the <strong class="bold">Done</strong> button is tapped. After that, you configured the <strong class="source-inline">ExploreViewController</strong> class to pass the selected location and cuisine to the <strong class="source-inline">RestaurantListViewController</strong> instance when a type of cuisine is selected. Finally, you configured the <strong class="source-inline">RestaurantListViewController</strong> class to get a list of restaurants from the <strong class="source-inline">RestaurantDataManager</strong> instance, and display them in the <strong class="bold">Restaurant List</strong> screen, filtered by the selected cuisine. You also created a <strong class="source-inline">NoDataView</strong> class and view, which is displayed if there are no restaurants at a particular location offering the selected cuisine.  </p>
			<p>You are now able to load and read data from JSON files and pass that data between different view controllers in your app for display in collection views and map views. You also learned how to use <strong class="source-inline">UITableViewController</strong> delegate methods to handle user interaction with table views. This will be useful when you're creating your own apps.</p>
			<p>In the next chapter, you'll implement the <strong class="bold">Restaurant Detail</strong> screen, which displays details of a specific restaurant using a table view containing static cells.</p>
		</div>
	</body></html>