<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Playing Sounds and Music</h1></div></div></div><div><blockquote class="blockquote"><p>We hear sound effects and music in almost every type of media we encounter daily. Many notable games such as PAC-MAN, Angry Birds, and Fruit Ninja can be recognized just by their theme music or sound effects alone. Aside from the visual imagery we see in games, sounds help impact the mood conveyed in the storyline and/or during game play. Quality sound effects and music that pertain to the theme of your game helps to give your audience a realistic feel to the experience.</p></blockquote></div><p>In this chapter, you will learn how to apply sound effects and music that can be added to your applications. We have the visual appeal down from creating Breakout and Panda Star Catcher in the previous chapters. Now let's enhance the sensory experience with our ears!</p><p>The main points we'll be going over are:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Loading, playing, and looping audio</li><li class="listitem" style="list-style-type: disc">Understanding how to play, pause, resume, rewind, and stop</li><li class="listitem" style="list-style-type: disc">Memory management (disposing audio)</li><li class="listitem" style="list-style-type: disc">Volume control</li><li class="listitem" style="list-style-type: disc">Performance and encoding tips</li></ul></div><p>Let's create some more magic!</p><div><div><div><div><h1 class="title"><a id="ch06lvl1sec01"/>Corona Audio System</h1></div></div></div><p>The Corona Audio System has advanced <strong>OpenAL (Open Audio Library)</strong> features. OpenAL is designed for efficient rendering of multichannel three-dimensional positional audio. The general functionality of OpenAL is encoded in source objects, audio buffers, and a single listener. A source object contains a pointer to a buffer, the velocity, position and direction of the sound, and the intensity of the sound. Buffers contain audio data in PCM format, either 8 or 16-bit, in either mono or stereo format. The listener object contains the velocity, position and direction of the listener, and the general gain applied to all sound.<a id="id410" class="indexterm"/>
</p><div><h3 class="title"><a id="note15"/>Note</h3><p>For more information on the Corona Audio System you can go to:<a class="ulink" href="http://developer.anscamobile.com/partner/audionotes"> http://developer.anscamobile.com/partner/audionotes</a>. General information on OpenAL can be found at:<a class="ulink" href="http://www.openal.com"> http://www.openal.com.</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec01"/>Sound formats</h2></div></div></div><p>The following are sound formats that are compatible with iOS and Android platforms:<a id="id411" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">All platforms support 16-bit, little endian, linear, <code class="literal">.wav</code> files</li><li class="listitem" style="list-style-type: disc">The iOS and Mac simulator support <code class="literal">.mp3, .caf</code>, and <code class="literal">.aac</code></li><li class="listitem" style="list-style-type: disc">The Windows simulator supports <code class="literal">.mp3</code> and <code class="literal">.wav</code></li><li class="listitem" style="list-style-type: disc">Android supports <code class="literal">.mp3</code> and <code class="literal">.ogg</code> formats</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec02"/>Sound filename limitations on Android</h2></div></div></div><p>File extensions are ignored when building in Android, so files are considered the same regardless of extension. The workaround for the mean time is to change the filenames to differentiate file extensions. See the following examples:<a id="id412" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">tap_aac.aac</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">tap_aif.aif</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">tap_caf.caf</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">tap_mp3.mp3</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">tap_ogg.ogg</code></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec03"/>Mono sounds at their best</h2></div></div></div><p>Using mono sounds take half the amount of memory than stereo sounds. Since the Corona Audio System uses OpenAL, it will only apply spatialized/3D effects to mono sounds. OpenAL does not apply 3D effects to stereo samples.<a id="id413" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec04"/>Maximum number of simultaneous channels</h2></div></div></div><p>The maximum number of channels that can be run is 32. This allows up to 32 distinct sounds to be played simultaneously. The API to see the resulting number of channels in your code is:<a id="id414" class="indexterm"/>
</p><div><pre class="programlisting">audio.totalChannels
</pre></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec02"/>Time to play</h1></div></div></div><p>Audio can be loaded in two different ways as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">loadSound()</code> preloads an entire sound into memory<a id="id415" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">loadStream()</code> prepares the sound to be played by reading small chunks at a time to save memory<a id="id416" class="indexterm"/></li></ul></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec05"/>audio.loadSound()</h2></div></div></div><p>Loads an entire file completely into memory and returns a reference to the audio data. Files that are loaded completely into memory can be reused, played, and shared simultaneously on multiple channels so you only need to load one instance of the file. Sounds that you would use as sound effects in your game would fit in this category.<a id="id417" class="indexterm"/>
</p><p>Syntax:<a id="id418" class="indexterm"/>
</p><div><pre class="programlisting">audio.loadSound(audiofileName [, baseDir ])
</pre></div><p>Parameters:<a id="id419" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">audiofileName</code> - Specifies the name of the audio file you want to load. Supported file formats are determined by the platform you are running the audio file on.</li><li class="listitem" style="list-style-type: disc"><code class="literal">baseDir</code> - By default, sound files are expected to be in the application resources directory. If the sound file is in the application documents directory, use <code class="literal">system.DocumentsDirectory</code>.</li></ul></div><p>Example:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">tapSound = audio.loadSound("tap.wav")</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">smokeSound = audio.loadSound("smoke.mp3")</code></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec06"/>audio.loadStream()</h2></div></div></div><p>This loads a file to be read as a stream. Streamed files are read in small chunks at a time to minimize memory use. Files that are large in size and have a long duration are intended for this. These files cannot be shared simultaneously across multiple channels. If need be, you must load multiple instances of the file.<a id="id420" class="indexterm"/>
</p><p>Syntax:</p><div><pre class="programlisting">audio.loadStream(audioFileName [, baseDir ])
</pre></div><p>Parameters:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">audiofileName</code> - Specifies the name of the audio file you want to load. Supported file formats are determined by the platform you are running the audio file on.<a id="id421" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">baseDir</code> - By default, sound files are expected to be in the application resources directory. If the sound file is in the application documents directory, use <code class="literal">system.DocumentsDirectory</code>.<a id="id422" class="indexterm"/></li></ul></div><p>Example:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">music1 = audio.loadStream("song1.mp3")</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">music2 = audio.loadStream("song2.wav")</code></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec07"/>audio.play()</h2></div></div></div><p>Plays the audio specified by the audio handle on a channel. If a channel is not specified, an available channel will be automatically chosen for you.<a id="id423" class="indexterm"/>
</p><p>Syntax:</p><div><pre class="programlisting">audio.play(audioHandle [, {[channel=c] [, loops=l] [, duration=d] [, fadein=f] [, onComplete=o]}])
</pre></div><p>Parameters:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">audioHandle</code> - This is the audio data you want to play.<a id="id424" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">channel</code> - The channel number you want to play on. Channel number 1 to the maximun number of channels, which is 32, are valid channels. Specify 0 or omit this parameter to have a channel automatically picked for you.<a id="id425" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">loops</code> - The number of times you want the audio to loop. 0 means the audio will loop 0 times which means that the sound will play once and not loop. Passing -1 will tell the system to infinitely loop the sample.<a id="id426" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">duration</code> - In milliseconds, this will cause the system to play the audio for the specified amount of time.<a id="id427" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">fadein</code> - In milliseconds, this will start playing a sound at the minimum channel volume and transition to the normal channel volume over the specified number of milliseconds.<a id="id428" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">onComplete</code> - A callback function you want to be called when playback ends. The <code class="literal">onComplete</code> callback function passes back an event parameter.<a id="id429" class="indexterm"/></li></ul></div><p>Example:</p><div><pre class="programlisting">backgroundMusic = audio.loadStream("backgroundMusic.mp3")
backgroundMusicChannel = audio.play( backgroundMusic, { channel=1, loops=-1, fadein=5000 })
-- play the background music on channel 1, loop infinitely, and fadein over 5 seconds
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec08"/>Looping</h2></div></div></div><p>Highly compressed formats like mp3, aac, ogg vorbis, can remove samples at the end of an audio sample and possibly break a clip that is looped correctly. If you experience gaps in looping playback, try using WAV (compatible with iOS and Android) and make sure your lead-in and ending points are clean.<a id="id430" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec09"/>Simultaneous playback</h2></div></div></div><p>Sounds loaded via <code class="literal">loadSound()</code> can be played back simultaneously on multiple channels. For example, you can load a sound effect like so:<a id="id431" class="indexterm"/>
</p><div><pre class="programlisting">bellSound = audio.loadSound("bell.wav")
</pre></div><p>If you want to make a variety of bell sounds occur for multiple objects, you can. The audio engine is highly optimized to handle this case. Call <code class="literal">audio.play()</code> using that same handle as many times as you need it (up to the maximum number of channels).<a id="id432" class="indexterm"/>
</p><div><pre class="programlisting">audio.play(bellSound)
audio.play(bellSound)
audio.play(bellSound)
</pre></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec03"/>Time for action—playing audio</h1></div></div></div><p>We're going to listen to how sound effects and music are implemented in Corona to get an idea of how it really works:<a id="id433" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Create a new project folder on your desktop called <code class="literal">Playing Audio</code>.</li><li class="listitem">In the <code class="literal">Chapter 6 Resources</code> folder, copy the <code class="literal">ring.wav</code> and <code class="literal">song1.mp3</code> sound files into your project folder and create a new <code class="literal">main.lua</code> file. You can download the project files accompanying this book from the Packt website.</li><li class="listitem">Preload the following audio with <code class="literal">loadSound()</code> and <code class="literal">loadStream():</code><div><pre class="programlisting">ringSound = audio.loadSound("ring.wav")
backgroundSound = audio.loadStream("song1.mp3")
<a id="id434" class="indexterm"/>
</pre></div></li><li class="listitem">Play <code class="literal">backgroundSound</code> by setting it to channel 1, loop it infinitely, and fade in after for 3 seconds:<div><pre class="programlisting">mySong = audio.play(backgroundSound, {channel=1, loops=-1, fadein=3000})
</pre></div></li><li class="listitem">Add in <code class="literal">ringSound</code> and have it played once:<div><pre class="programlisting">myRingSound = audio.play(ringSound)
</pre></div></li><li class="listitem">Save and run the project in the Corona simulator to hear the results.</li></ol></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec10"/>What Just Happened?</h2></div></div></div><p>For audio that is merely a short sound effect, we used <code class="literal">audio.loadSound()</code> to prepare the sound. For audio that is large in size or long in duration, <code class="literal">audio.loadStream()</code> is used.</p><p>The <code class="literal">backgroundSound</code> file is set to channel 1 and fades in at 3 seconds when it starts playing. <code class="literal">loops = -1</code> means that the file loops infinitely from beginning to end.</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec11"/>Have a go hero—repeating audio with delay</h2></div></div></div><p>As you can see, loading and playing audio is really simple. It only takes 2 lines of code to play a simple sound. Let's see if you can take it up a notch.</p><p>Use the <code class="literal">ring.wav</code> file and load it through <code class="literal">loadSound()</code>. Create a function that plays the audio. Play the sound five times at an interval of 2 seconds.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec04"/>Time to take control</h1></div></div></div><p>We have the ability to control our sounds now that we can have them play in the simulator. If you think back to the days of cassette tape players, they had the ability to use functions such as pause, stop, and rewind. Corona's audio API library can do just that.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec12"/>audio.stop()</h2></div></div></div><p>Stops playback on a channel and clears the channel so it can be played again.<a id="id435" class="indexterm"/>
</p><p>Syntax:<a id="id436" class="indexterm"/>
</p><div><pre class="programlisting">audio.stop([channel])
</pre></div><p>or:</p><div><pre class="programlisting">audio.stop([{channel = c}])
</pre></div><p>Parameters:<a id="id437" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Having no parameters stops all active channels.</li><li class="listitem" style="list-style-type: disc"><code class="literal">channel</code> - The channel to stop. Specifying 0 stops all channels.</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec13"/>audio.pause()</h2></div></div></div><p>This pauses playback on a channel and has no effect on channels that aren't playing.<a id="id438" class="indexterm"/>
</p><p>Syntax:</p><div><pre class="programlisting">audio.pause([channel])
<a id="id439" class="indexterm"/>
</pre></div><p>or:</p><div><pre class="programlisting">audio.pause([{channel = c}])
</pre></div><p>Parameters:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Having no parameters pauses all active channels.<a id="id440" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">channel</code> - The channel to pause. Specifying 0 pauses all channels.</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec14"/>audio.resume()</h2></div></div></div><p>This resumes playback on a channel that is paused. It has no effect on channels that aren't paused.<a id="id441" class="indexterm"/>
</p><p>Syntax:<a id="id442" class="indexterm"/>
</p><div><pre class="programlisting">audio.pause([channel])
</pre></div><p>or:</p><div><pre class="programlisting">audio.pause([{channel = c}])
</pre></div><p>Parameters:<a id="id443" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Having no parameters resumes all paused channels.</li><li class="listitem" style="list-style-type: disc"><code class="literal">channel</code> - The channel to resume. Specifying 0 resumes all channels.<a id="id444" class="indexterm"/></li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec15"/>audio.rewind()</h2></div></div></div><p>This rewinds audio to the beginning position on either an active channel or directly on the audio handle.<a id="id445" class="indexterm"/>
</p><p>Syntax:<a id="id446" class="indexterm"/>
</p><div><pre class="programlisting">audio.rewind([, audioHandle ] [, {channel=c} ])
</pre></div><p>Parameters:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">audioHandle</code> - The audio handle of the data you want to rewind. Best for audio loaded with <code class="literal">audio.loadStream()</code>. Don't try using this with the channel parameter in the same call.<a id="id447" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">channel</code> - The channel you want the rewind operation to apply to. Best for audio loaded with <code class="literal">audio.loadSound()</code>. Don't try using this with the <code class="literal">audioHandle</code> parameter in the same call.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec05"/>Time for action—controlling audio</h1></div></div></div><p>Let's simulate our own little music player by creating user interface buttons that will control the audio calls:<a id="id448" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">In the <code class="literal">Chapter 6</code> folder, copy the <code class="literal">Controlling Audio</code> project folder to your desktop. You will notice several art assets, a <code class="literal">ui.lua</code> library and a <code class="literal">song2.mp3</code> file inside. You can download the project files accompanying this book from the Packt website:<div><img src="img/1888_06_01.jpg" alt="Time for action—controlling audio"/></div></li><li class="listitem">In the same project folder, create a brand new <code class="literal">main.lua</code> file.</li><li class="listitem">Load the audio file via <code class="literal">loadStream()</code>, name it <code class="literal">backgroundSound</code>, and call the UI library. Also add in a local variable called <code class="literal">myMusic:</code><a id="id449" class="indexterm"/><div><pre class="programlisting">local ui = require("ui")
local backgroundSound = audio.loadStream("song2.mp3")
local myMusic
</pre></div></li><li class="listitem">Create a local function called <code class="literal">onPlayTouch()</code> with an event parameter to play the audio file. Add an <code class="literal">if</code> statement that contains <code class="literal">event.phase == "release"</code>, so that the music starts playing upon button release. Apply the <code class="literal">playBtn</code> display object as a new UI button:<div><pre class="programlisting">local onPlayTouch = function( event )
if event.phase == "release" then
myMusic = audio.play(backgroundSound, {channel=1, loops=-1})
end
end
playBtn = ui.newButton{
defaultSrc = "playbtn.png",
defaultX = 100,
defaultY = 50,
overSrc = "playbtn-over.png",
overX = 100,
overY = 50,
onEvent = onPlayTouch,
id = "PlayButton",
text = "",
font = "Helvetica",
textColor = {255, 255, 255, 255},
size = 16,
emboss = false
}
playBtn.x = 160; playBtn.y = 100
</pre></div></li><li class="listitem">Create a local function called <code class="literal">onPauseTouch()</code> with an event parameter to pause the audio file. Add an <code class="literal">if</code> statement when <code class="literal">event.phase == "release"</code>, so that the music pauses. Apply the <code class="literal">pauseBtn</code> display object as a new UI button:<a id="id450" class="indexterm"/><div><pre class="programlisting">local onPauseTouch = function(event)
if event.phase == "release" then
myMusic = audio.pause(backgroundSound)
print("pause")
end
end
pauseBtn = ui.newButton{
defaultSrc = "pausebtn.png",
defaultX = 100,
defaultY = 50,
overSrc = "pausebtn-over.png",
overX = 100,
overY = 50,
onEvent = onPauseTouch,
id = "PauseButton",
text = "",
font = "Helvetica",
textColor = {255, 255, 255, 255},
size = 16,
emboss = false
}
pauseBtn.x = 160; pauseBtn.y = 160
</pre></div></li><li class="listitem">Add a local function called <code class="literal">onResumeTouch()</code> with an event parameter to resume the audio file. Add an <code class="literal">if</code> statement when <code class="literal">event.phase == "release"</code>, so that the music resumes. Apply the <code class="literal">resumeBtn</code> display object as a new UI button:<a id="id451" class="indexterm"/><div><pre class="programlisting">local onResumeTouch = function(event)
if event.phase == "release" then
myMusic = audio.resume(backgroundSound)
print("resume")
end
end
resumeBtn = ui.newButton{
defaultSrc = "resumebtn.png",
defaultX = 100,
defaultY = 50,
overSrc = "resumebtn-over.png",
overX = 100,
overY = 50,
onEvent = onResumeTouch,
id = "ResumeButton",
text = "",
font = "Helvetica",
textColor = {255, 255, 255, 255},
size = 16,
emboss = false
}
resumeBtn.x = 160; resumeBtn.y = 220
</pre></div></li><li class="listitem">Add a local function called <code class="literal">onStopTouch()</code> with an event parameter to stop the audio file. Create an <code class="literal">if</code> statement when <code class="literal">event.phase == "release"</code>, so that the music stops. Apply the <code class="literal">stopBtn</code> display object as a new UI button:<div><pre class="programlisting">local onStopTouch = function(event)
if event.phase == "release" then
myMusic = audio.stop(backgroundSound)
print("stop")
end
end
stopBtn = ui.newButton{
defaultSrc = "stopbtn.png",
defaultX = 100,
defaultY = 50,
overSrc = "stopbtn-over.png",
overX = 100,
overY = 50,
onEvent = onStopTouch,
id = "StopButton",
text = "",
font = "Helvetica",
textColor = { 255, 255, 255, 255 },
size = 16,
emboss = false
}
stopBtn.x = 160; stopBtn.y = 280
</pre></div></li><li class="listitem">Add a local function called <code class="literal">onRewindTouch()</code> with an <code class="literal">event</code> parameter to rewind the audio file. Create an <code class="literal">if</code> statement when <code class="literal">event.phase == "release"</code>, that the music rewinds to the beginning of the track. Apply the <code class="literal">rewindBtn</code> display object as a new UI button:<a id="id452" class="indexterm"/><div><pre class="programlisting">local onRewindTouch = function(event)
if event.phase == "release" then
myMusic = audio.rewind(backgroundSound)
print("rewind")
end
end
rewindBtn = ui.newButton{
defaultSrc = "rewindbtn.png",
defaultX = 100,
defaultY = 50,
overSrc = "rewindbtn-over.png",
overX = 100,
overY = 50,
onEvent = onRewindTouch,
id = "RewindButton",
text = "",
font = "Helvetica",
textColor = { 255, 255, 255, 255 },
size = 16,
emboss = false
}
rewindBtn.x = 160; rewindBtn.y = 340
</pre></div></li><li class="listitem">Save your project and run it in the simulator. You now have created a functional media player!<div><img src="img/1888_06_02.jpg" alt="Time for action—controlling audio"/></div></li></ol></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec16"/>What Just Happened?</h2></div></div></div><p>We added a UI library for our user interface buttons by calling <code class="literal">require("ui")</code>. This produces the "on press" look when a button has been pushed down on.<a id="id453" class="indexterm"/>
</p><p>A variety of functions were created to run each button:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">onPlayTouch()</code> calls out <code class="literal">myMusic = audio.play(backgroundSound, {channel=1, loops=-1})</code> when the event is triggered by the user pressing the button</li><li class="listitem" style="list-style-type: disc"><code class="literal">onPauseTouch()</code> calls out <code class="literal">myMusic = audio.pause(backgroundSound)</code> to pause the song when the button is pressed</li><li class="listitem" style="list-style-type: disc"><code class="literal">onResumeTouch()</code> calls out <code class="literal">myMusic = audio.resume(backgroundSound)</code> to resume the song if it has been paused</li><li class="listitem" style="list-style-type: disc"><code class="literal">onStopTouch()</code> calls out <code class="literal">myMusic = audio.stop(backgroundSound)</code> if the song is currently playing and will stop the audio</li><li class="listitem" style="list-style-type: disc"><code class="literal">onRewindTouch()</code> calls out <code class="literal">myMusic = audio.rewind(backgroundSound)</code> to rewind the song to the beginning of the track<div><h3 class="title"><a id="note27"/>Note</h3><p>When a song is paused, it resumes only by pressing the<strong> Resume</strong> button. The<strong> Play</strong> button will have no effect when the<strong> Pause</strong> button is pressed.</p></div></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec06"/>Memory management</h1></div></div></div><p>It is important to call <code class="literal">audio.dispose()</code> on your loaded audio when you are completely done with the audio file. Doing so allows you to recover the memory.<a id="id454" class="indexterm"/>
</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec17"/>audio.dispose()</h2></div></div></div><p>Releases audio memory associated with the handle.<a id="id455" class="indexterm"/>
</p><p>Syntax:<a id="id456" class="indexterm"/>
</p><div><pre class="programlisting">audio.dispose(audioHandle)
</pre></div><p>Parameters:<a id="id457" class="indexterm"/>
</p><p>
<code class="literal">audioHandle</code> - The handle returned by the <code class="literal">audio.loadSound()</code> or <code class="literal">audio.loadStream()</code> functions that you want to free.</p><div><h3 class="title"><a id="tip06"/>Tip</h3><p>You must not use the handle once the memory is freed. The audio should not be playing or paused on any channel when you try to free it.</p></div><p>Example:</p><div><pre class="programlisting">mySound = audio.loadSound("sound1.wav")
myMusic = audio.loadStream("music.mp3")
audio.dispose(mySound)
audio.dispose(myMusic)
mySound = nil
myMusic = nil
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec18"/>Have a go hero—disposing audio</h2></div></div></div><p>You have just learned how to dispose audio files properly to recover memory in your application. Try the following:</p><div><ol class="orderedlist"><li class="listitem">Load your audio file and have it played over a set duration. Create a function that will dispose of the file when calling an <code class="literal">onComplete</code> command.</li><li class="listitem">In the <code class="literal">Controlling Audio</code> project file, dispose of the audio in the <code class="literal">onStopTouch()</code> function.</li></ol></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec07"/>Alterations to audio</h1></div></div></div><p>The audio system also has the ability to alter the minimum and maximum states of audio volume as well as audio fades when needed in your application.<a id="id459" class="indexterm"/>
</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec19"/>Volume control</h2></div></div></div><p>The volume of audio can be set with values ranging from 0 to 1.0. This setting can be adjusted at any time before or during the extended sound playback.<a id="id460" class="indexterm"/>
</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec01"/>audio.setVolume()</h3></div></div></div><p>Syntax:<a id="id461" class="indexterm"/>
</p><div><pre class="programlisting">audio.setVolume( volume [, {[channel=c]} ] )
<a id="id462" class="indexterm"/>
</pre></div><p>Parameters:<a id="id463" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">volume</code> - The new volume level you want to apply. Valid numbers range from 0.0 to 1.0, where 1.0 is the maximum volume value. Default volume is based on your device ringer volume and will vary.</li><li class="listitem" style="list-style-type: disc"><code class="literal">channel</code> - The channel number you want to set the volume on. Channel number 1 to the maximum number of channels. Specify 0 to apply the volume to all the channels. Omitting this parameter entirely sets the master volume, which is different than the channel volume.</li></ul></div><p>Example:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">audio.setVolume(0.75) -- set master volume</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">audio.setVolume(0.5, {channel=2}) -- set volume on channel 2</code><a id="id464" class="indexterm"/></li></ul></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec02"/>audio.setMinVolume()</h3></div></div></div><p>Clamps the minimum volume to the set value. Any volumes that go below the minimum volume will be played at the minimum volume level.<a id="id465" class="indexterm"/>
</p><p>Syntax:</p><div><pre class="programlisting">audio.setMinVolume(volume, {channel=c})
<a id="id466" class="indexterm"/>
</pre></div><p>Parameters:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">volume</code> - The new minimum volume level you want to apply. Valid numbers range from 0.0 to 1.0, where 1.0 is the maximum volume value.<a id="id467" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">channel</code> - The channel number you want to set the minimum volume on. Channel number 1 to the minimum number of channels are valid channels. Specify 0 to apply the minimum volume to all the channels.</li></ul></div><p>Example:</p><div><pre class="programlisting">audio.setMinVolume(0.10, {channel=1}) -- set the min volume on channel 1
</pre></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec03"/>audio.setMaxVolume()</h3></div></div></div><p>Clamps the maximum volume to the set value. Any volumes that exceed the maximum volume will be played at the maximum volume level.<a id="id468" class="indexterm"/>
</p><p>Syntax:</p><div><pre class="programlisting">audio.setMaxVolume(volume, {channel=c})
<a id="id469" class="indexterm"/>
</pre></div><p>Parameters:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">volume</code> - The new maximum volume level you want to apply. Valid numbers range from 0.0 to 1.0, where 1.0 is the maximum value.<a id="id470" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">channel</code> - The channel number you want to set the maximum volume on. 1 to the maximum number of channels are valid channels. Specify 0 to apply the maximum volume to all the channels.</li></ul></div><p>Example:</p><div><pre class="programlisting">audio.setMaxVolume(0.90, {channel=1}) -- set the max volume on channel 1
</pre></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec04"/>audio.getVolume()</h3></div></div></div><p>This gets the volume either for a specific channel or gets the master volume.<a id="id471" class="indexterm"/>
</p><p>Syntax:<a id="id472" class="indexterm"/>
</p><div><pre class="programlisting">audio.getVolume([{[channel=c]}])
</pre></div><p>Parameters:</p><p>
<code class="literal">channel</code> - The channel number you want to get the volume on. There can be a maximum number of 32 channels that are valid. Specifying 0 will return the average volume across all channels. Omitting this parameter entirely gets the master volume, which is different than the channel volume.<a id="id473" class="indexterm"/>
</p><p>Example:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">masterVolume = audio.getVolume() -- get the master volume</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">channel1Volume = audio.getVolume({channel=1}) -- get the volume on channel 1</code></li></ul></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec05"/>audio.getMinVolume()</h3></div></div></div><p>This gets the minimum volume for a specific channel.<a id="id474" class="indexterm"/>
</p><p>Syntax:<a id="id475" class="indexterm"/>
</p><div><pre class="programlisting">audio.getMinVolume({channel=c})
</pre></div><p>Parameters:</p><p>
<code class="literal">channel</code> - The channel number you want to get the minimum volume on. There can be a maximum number of 32 channels that are valid. Specifying 0 will return the average minimum volume across all channels.<a id="id476" class="indexterm"/>
</p><p>Example:</p><div><pre class="programlisting">channel1MinVolume = audio.getMinVolume({channel=1}) -- get the min volume on channel 1
</pre></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec06"/>audio.getMaxVolume()</h3></div></div></div><p>This gets the maximum volume for a specific channel.<a id="id477" class="indexterm"/>
</p><p>Syntax:<a id="id478" class="indexterm"/>
</p><div><pre class="programlisting">audio.getMaxVolume({channel=c})
</pre></div><p>Parameters:</p><p>
<code class="literal">channel</code> - The channel number you want to get the maximum volume on. There can be a maximum number of 32 channels that are valid. Specifying 0 will return the average volume across all channels.<a id="id479" class="indexterm"/>
</p><p>Example:</p><div><pre class="programlisting">channel1MaxVolume = audio.getMaxVolume({channel=1}) -- get the max volume on channel 1
</pre></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec20"/>Fading audio</h2></div></div></div><p>You can fade in volume at the time any audio starts playing, but there are other ways to control it as well.<a id="id480" class="indexterm"/>
</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec07"/>audio.fade()</h3></div></div></div><p>This fades a playing sound in a specified amount to a specified volume. The audio will continue playing after the fade completes.<a id="id481" class="indexterm"/>
</p><p>Syntax:</p><div><pre class="programlisting">audio.fade([{ [channel=c] [, time=t] [, volume=v] }])
</pre></div><p>Parameters:<a id="id482" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">channel</code> - The channel number you want to fade on. 1 to the maximum number of channels are valid channels. Specify 0 to apply fade to all the channels.</li><li class="listitem" style="list-style-type: disc"><code class="literal">time</code> - The amount of time from now that you want the audio to fade over and stop. Omitting this parameter invokes a default fade time, which is 1000 milliseconds.</li><li class="listitem" style="list-style-type: disc"><code class="literal">volume</code> - The target volume you want to change the fade to. Valid numbers are 0.0 to 1.0 where 1.0 is the maximum volume. If this parameter is omitted, the default value is 0.0.</li></ul></div><p>Example:</p><div><pre class="programlisting">audio.fade({channel=1, time=3000, volume=0.5})
</pre></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec08"/>audio.fadeOut()</h3></div></div></div><p>This stops playing sound in a specified amount of time and fades to the minimum volume. The audio will stop at the end of the time and the channel will be freed.<a id="id483" class="indexterm"/>
</p><p>Syntax:</p><div><pre class="programlisting">audio.fadeOut([{ [channel=c] [, time=t] }])
<a id="id484" class="indexterm"/>
</pre></div><p>Parameters:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">channel</code> - The channel number you want to fade out on. 1 to the maximum number of channels are valid channels. Specify 0 to apply <code class="literal">fadeOut</code> to all the channels.<a id="id485" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">time</code> - The amount of time from now that you want the audio to fade out over and stop. Omitting this parameter invokes a default fade out time, which is 1000 milliseconds.</li></ul></div><p>Example:</p><div><pre class="programlisting">audio.fadeOut({ channel=1, time=5000 })
</pre></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec08"/>Performance tips</h1></div></div></div><p>The following are some helpful notes when creating good quality audio for your games.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec21"/>Pre-loading phase</h2></div></div></div><p>It is best to pre-load all your files at the startup of your application. While <code class="literal">loadStream()</code> is generally fast, <code class="literal">loadSound()</code> may take awhile since it must load and decode the entire file the instant it needs to be used. Generally, you don't want to be calling <code class="literal">loadSound()</code> in the parts of your app where users expect it to be running smoothly when events occur, such as during gameplay.<a id="id486" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec22"/>audioPlayFrequency</h2></div></div></div><p>In your <code class="literal">config.lua</code> file, you may specify a field called <code class="literal">audioPlayFrequency</code>.<a id="id487" class="indexterm"/>
</p><div><pre class="programlisting">application =
{
content =
{
width = 320,
height = 480,
scale = "letterbox",
audioPlayFrequency = 22050
},
}
</pre></div><p>This tells the OpenAL system what sample rate to mix and playback at. For best results, set this no higher than you actually need. So if you never need better than 22050 Hz playback, set this to 22050. It produces quality speech recordings or middle-quality recordings of music. If you really do need high quality, then set this to 44100 to produce audio CD quality at playback.</p><p>It is best to have all your audio files encoded at the same frequency when you have this set. Supported values are 11025, 22050, and 44100.<a id="id488" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec23"/>Patents and royalties</h2></div></div></div><p>For highly compressed formats, such as MP3 and AAC, AAC is the better option. AAC is the official successor to MP3 by the MPEG group. MP3 has patent and royalty issues you may need to concern yourself with if you distribute anything yourself. You may need to consult your lawyers for guidance. When AAC was ratified, it was agreed there would be no royalties required for distribution. If you prefer to use AAC over MP3, here's a tutorial on how to convert MP3s to AAC or any file format of your preference on the Apple website:<a class="ulink" href="http://support.apple.com/kb/ht1550"> http://support.apple.com/kb/ht1550</a>.<a id="id489" class="indexterm"/>
</p><p>
<strong>Ogg Vorbis</strong> is a royalty free and patent free format. However, this is not supported on iOS devices.</p><div><h3 class="title"><a id="note17"/>Note</h3><p>More information on audio formats can be found at:<a class="ulink" href="http://www.nch.com.au/acm/formats.html"> http://www.nch.com.au/acm/formats.html</a>. Ray Wenderlich, a mobile developer also has a tutorial available based on file and data formats for audio at:<a class="ulink" href="http://www.raywenderlich.com/204/audio-101-for-iphone-developers-file-and-data-formats"> http://www.raywenderlich.com/204/audio-101-for-iphone-developers-file-and-data-formats</a>.</p></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec24"/>Pop quiz—all about audio</h2></div></div></div><div><ol class="orderedlist"><li class="listitem">What is the proper way to clear audio files from memory?<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">a. <code class="literal">audio.pause()</code></li><li class="listitem" style="list-style-type: none">b. <code class="literal">audio.stop()</code></li><li class="listitem" style="list-style-type: none">c. <code class="literal">audio.dispose()</code></li><li class="listitem" style="list-style-type: none">d. <code class="literal">audio.fadeOut()</code></li></ul></div></li><li class="listitem">How many channels of audio can be played simultaneously in an application?<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">a. 10</li><li class="listitem" style="list-style-type: none">b. 18</li><li class="listitem" style="list-style-type: none">c. 25</li><li class="listitem" style="list-style-type: none">d. 32</li></ul></div></li><li class="listitem">How do you make your audio file loop infinitely?<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">a. loops = -1</li><li class="listitem" style="list-style-type: none">b. loops = 0</li><li class="listitem" style="list-style-type: none">c. loops = 1</li><li class="listitem" style="list-style-type: none">d. None of the above</li></ul></div></li></ol></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec09"/>Summary</h1></div></div></div><p>We're now caught up on understanding the important aspects of using audio files in the Corona SDK. Now you can go off and add your own sound effects and music to your games or even add them to any of the samples we have made in the previous chapters. In doing so, you add another layer to the user experience that will draw players into the environment you created.</p><p>Up until now, you have learned how to:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Pre-load and play sound effects and music using <code class="literal">loadSound()</code> and <code class="literal">loadStream()</code></li><li class="listitem" style="list-style-type: disc">Control audio functions that pause, resume, stop, and rewind a music track under the Audio System API</li><li class="listitem" style="list-style-type: disc">Dispose audio from memory when it is no longer in use</li><li class="listitem" style="list-style-type: disc">Adjust the volume in your audio files</li></ul></div><p>In the next chapter, we will be combining everything we have learned thus far into creating our final game in this book. We'll also be going over other ways to implement physical objects and collision mechanics that are popular in mobile games in the market to date. More exciting information to learn awaits us. Let's power through!</p></div></body></html>