<html><head></head><body><h1 id="e-jKbh">Chapter 7. Designing for Multiple Screen Sizes</h1>
<p id="e-NgqG">In early 2011, Android Honeycomb 3.0 (API level 11) was released specifically to support larger screen-sized tablets. Since then, the Android ecosystem has exploded and all subsequent Android releases have been targeted to offer more screen sizes, including smart phones, tablets, and Google TV.</p>
<p id="e-hHtx">This chapter will walk you through dealing with multiple screen sizes and making your application compatible to work with smart phones and tablets. In the course of this chapter, we will extend the <code>POIApp</code> we have been developing and optimize it for Android tablets. The following topics will be covered in this chapter:</p>
<ul id="e-vqjh">
<li id="e-wY2w">Introduction to the Android tablets ecosystem</li>
<li id="e-KO9G">Creating and managing fragments</li>
<li id="e-Ya10">Making <code>POIApp</code> compatible with Android tablets</li>
<li id="e-c4cM">Dealing with <code>ListFragment</code> to display the POI list</li>
<li id="e-cqir">Creating the multi-pane layout for tablets</li>
<li id="e-AS1y">Adding alternative layouts for Android tablets</li>
<li id="e-Wdag">Using <code>DialogFragment</code> to display dialogs</li>
<li id="e-i7fA">Working with fragments for older Android devices</li>
<li id="e-lEqy">Retaining the fragment state on device configuration changes</li>
</ul>
<h1 id="e-aR4e">An introduction to Android tablets</h1>
<p id="e-qgBs">The first ever Android tablet was released in 2011 with Android Version 3.0. However, all subsequent Android releases were targeted to support a range of screen sizes, including small, medium, and large ones. Due to its open nature, the Android ecosystem has a variety of device manufacturers, and hence, there are devices with different screen sizes and densities.</p>
<p id="e-uQQc">Applications built for Android smart phones can run on tablets without making any changes. However, if the UI is not optimized, it will give you a disagreeable user experience. Developers must take the extra space as an opportunity and use it efficiently to design a UI that can display more information on larger screens. For example, the Gmail application in the Android phone will have two activities for displaying the recent e-mail list and details of a selected e-mail. However, the same app in the tablet displays the e-mail list and the details on the same page, using the multi-pane split view layout.</p>
<p id="e-sEyI">The key things to be considered while designing user interfaces for Android applications are as follows:</p>
<ul id="e-RGkc">
<li id="e-yacN">
<strong>Screen size</strong>: This is the actual physical screen size of the device; generally, grouped into small, normal, large, and extra large. Although there is no official confirmation on the minimum and maximum screen sizes, they usually range from 2.55 to 10.1 inches.</li>
<li id="e-ftMu">
<strong>Screen density</strong>: This is the number of pixels present in the physical area of the screen, which is represented as dpi (dots per inch). High-density screens have more pixels than low-density screens.</li>
<li id="e-zfbc">
<strong>Resolution</strong>: This is the number of pixels present on the device screen. It is usually defined as <code>width x height</code>. For example, the resolution for a Nexus 5 device is <code>1080 x 1920</code>.</li>
<li id="e-qAYY">
<strong>Screen orientation</strong>: A device's orientation could be either in landscape or portrait mode.</li>
</ul>

<h1 id="e-hrYR">Creating an Android tablet emulator</h1>
<p id="e-Zmxj">So far, we have built the <code>POIApp</code> to display the list of POIs fetched from the server and tested it on the Android smart phone. Before we begin with extending the <code>POIApp</code> to support Android tablets, let's create a new emulator instance for the Android tablet and run the existing <code>POIApp</code> built so far.</p>
<p id="e-lkw3">In order to create an emulator for the tablet, perform the following steps:</p>
<ol id="e-YAtS">
<li id="e-laVh">From the main menu bar, navigate to <strong>Tools</strong> and open <strong>Google Emulator Manager</strong>. This will open the AVD manager window.</li>
<li id="e-ykTF">To create a new emulator, click on the <strong>Create</strong> button, in the right-hand side pane.</li>
<li id="e-BeJQ">Set the <strong>AVD Name</strong> field to <code>Nexus10</code>, select <strong>Nexus 10</strong> from the <strong>Device</strong> drop-down menu, set the <strong>Target</strong> field to <code>Android 4.4.x</code>, if needed, uncheck the <strong>Hardware keyboard present</strong> option, and click on <strong>OK</strong>.</li>
<li id="e-FaxU">Note that the <strong>Target</strong> setting specifies the version of the Android platform and the API level that will be used for the emulator.</li>
<li id="e-TF4M">Provide the configurations such as the <strong>AVD name</strong>, <strong>Device</strong>, <strong>Skin</strong>, <strong>Target</strong>, <strong>Memory Options</strong>, and so on, as shown in the following screenshot:<img data-width="706" data-height="666" src="dGehWnxQ.jpg"/>
</li>
</ol>
<p id="e-W4Pf">If you're using third-party emulator solutions, such as Xamarin Android Player or Genymotion, you can download either the Nexus 7 or Nexus 10 simulator for testing purposes in the tablet configuration.</p>
<p id="e-loyj">Now start the Nexus 10 emulator created in the previous steps and run the existing <code>POIApp</code> built so far. The following screenshot depicts the UI of the <code>POIApp</code> on the tablet that has not been optimized for larger screens:</p>
<img data-width="800" data-height="500" src="SBTOtSYO.jpg"/><p id="e-BNLX">With the additional screen real estate, the UI elements can be organized in various locations to make the app look nicer. Currently, the <code>POIApp</code> is using two activities for displaying the POI list and POI details. For tablets, we can use a multi-pane split layout to display both the POI list and details in the same activity by sharing the same screen space. Android activities are meant to be for single purposes and they don't allow embedding one activity inside another. The Android fragment can be used to solve this problem. A fragment is a reusable user interface component used to build dynamic and modular user interfaces for different screen sizes. An activity can contain one fragment or multiple fragments.</p>

<h1 id="e-MAA5">An introduction to fragments</h1>
<p id="e-eoFZ">Fragments are reusable pieces of a user interface component that provide flexibility to the application design. As you have already learnt from Chapter 1, <em>The Anatomy of an Android App</em>, fragments are reusable mini-activities, such as UI components, that can manage their own life cycles. Fragments are always intended to work without depending on another activity or fragment. Like an <code>Activity</code> class, a fragment class needs to extend from the <code>Fragment</code> class. To make things even easier, Android provides some of the additional specialized fragment subclasses such as <code>ListFragment</code>, <code>DialogFragment</code>, and <code>PreferenceFragment</code>.</p>
<p id="e-EnRm">The following table shows the list of fragment subclasses and their purposes. You may also extend any of the following fragment subclasses to create your own fragment.</p>
<p id="e-E1OR"><code>ListFragment</code></p>
<p id="e-jYVd">This displays a list of data items from different sources, such as an array, a cursor, and so on.</p>
<p id="e-VZ58"><code>DialogFragment</code></p>
<p id="e-QVSL">This displays a fragment as a floating dialog window.</p>
<p id="e-MyP8"><code>PreferenceFragment</code></p>
<p id="e-bdoT">This displays the hierarchical app preferences list. The preferences are saved when any changes are made by a user. The Nexus device settings screen design follows the <code>PreferenceFragment</code> pattern.</p>
<h2 id="e-fPvu">Creating a new fragment</h2>
<p id="e-cg40">A fragment can be seen as a modular component of an activity, which maintains its own life cycle, that handles user events and can be added to or removed from a running activity. The process of creating a fragment is very similar to creating an activity.</p>
<p id="e-TTjl">Perform the following steps to create and add a fragment in Android:</p>
<ol id="e-swph">
<li id="e-lMEh">The first step toward creating a fragment is to define its layout. Like the activity layout, you can either use the drag-and-drop interface builder available in Xamarin Studio, or you may use the XML code editor to create the layouts.</li>
<li id="e-BhbD">Create a new class that directly extends the <code>Fragment</code> class or its subclasses. The following code snippet extends the <code>Fragment</code> base class:<pre id="e-BaEY">public class MyFragment : Fragment
{
-----
-----
}</pre>
</li>
<li id="e-SLUg">Now implement the necessary fragment methods. To begin with, let's override the <code>OnCreateView()</code> method. This method adds the fragment to the view hierarchy and returns a <code>View</code> instance that represents the fragment. <p id="e-MkvS">The fragments UI can be created in two ways: by declaring the XML layout and inflating the fragment layout inside <code>OnCreateView()</code>, or by creating all the interfaces dynamically. For simplicity, the XML declarative approach is always preferred:</p>
<pre id="e-YwfL">public override View OnCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)
{
  // Inflate the layout for your fragment
  View view = inflater.Inflate(Resource.Layout.MyFragmentLayout, container, false);
   // Initialize other view controls
  return view;
}</pre>
<p id="e-GDiy">Optionally, you may override other fragment life cycles such as <code>OnPause()</code>, <code>OnResume()</code>, and so on, to control other life cycle event callbacks.</p>
</li>
<li id="e-ZUHk">Finally, let's add the fragments to the activity. This can be done in two ways: either by declaratively adding the activity layout, or by adding it programmatically.</li>
</ol>
<p id="e-MqKf">Use the following code snippet to add the fragment by declaring the <code>&amp;lt;fragment&amp;gt;</code> tag in the activity layout:</p>
<pre id="e-m3mC">&amp;lt;fragment class="MyApp.MyFragment"
  android:id="@+id/myFragment"
  android:layout_width="match_parent"
  android:layout_height="match_parent" /&amp;gt;</pre>
<p id="e-UWPw">To add the fragment dynamically, you need to first create a fragment placeholder container layout and assign an ID to it:</p>
<pre id="e-E5iq">&amp;lt;FrameLayout
  android:id="@+id/myFragmentContainer"
    android:layout_width="match_parent"
  android:layout_height="match_parent" /&amp;gt;</pre>
<p id="e-Mdn3">Now that you have specified the <code>ViewGroup</code> in which the fragment will be added dynamically, you can use the <code>FragmentTransaction</code> instance to add, remove, and replace the transactions. Use the following snippets to get the instance of <code>FragmentTransaction</code>:</p>
<pre id="e-t4je">MyFragment myFragment = new MyFragment();
FragmentTransaction ft = FragmentManager.BeginTransaction();</pre>
<p id="e-jWqf">You can then use the <code>Add()</code>, <code>Remove()</code>, and <code>Replace()</code> methods by passing the instance of the fragment and the ID of the <code>View</code> to which the fragment will be added. Once the fragment transactions are completed, you must call the <code>Commit()</code> method for the changes to take effect:</p>
<pre id="e-nBY3">ft.Add(Resource.Id.myFragmentContainer, myFragment);
ft.Commit();</pre>
<p id="e-JSNj">So far, you have a fair idea of how to work with fragments; let's now proceed to make the <code>POIApp</code> work with fragments and reuse the fragments to optimize the tablet's layouts.</p>

<h1 id="e-n4cN">Making POIApp compatible with Android tablets</h1>
<p id="e-WCRT">We have already covered a lot of ground on the fragment basics and life cycle in Chapter 1, <em>The Anatomy of an Android App</em>. I recommend that you read the concepts if you haven't gone through them already. Let's now go through the steps to create and manage fragments and build the <code>POIApp</code> to support the multi-pane tablet layout.</p>
<p id="e-ElWd">Currently, the <code>POIApp</code> is using two activities: <code>POIListActivity</code> for displaying the list of POIs, and <code>POIDetailsActivity</code> for displaying the details. Now we will create two new fragments: <code>POIListFragment</code> and <code>POIDetailFragment</code>, which will be reused for both the smart phone and multi-pane tablet layout:</p>
<img data-width="800" data-height="413" src="iZ5oaLuk.jpg"/><p id="e-xUQv">Notice the following points in the preceding screenshot, which will be implemented in the rest of the sections in this chapter:</p>
<ol id="e-Fvmj">
<li id="e-USyG">The phone layout contains two activities; <code>POIListActivity</code> and <code>POIDetailsActivity</code>, that host <code>POIListFragment</code> and <code>POIDetailFragment</code> respectively. Here, the activities will work like placeholders to hold fragments. Most of the application logic is to be moved from an activity to fragments.</li>
<li id="e-L9jx">The <code>POIListFragment</code> will contain the logic to initialize the list view, download the data using methods declared in the <code>POIService</code> class, and prepare the UI. Currently, the same logic is placed on <code>POIListActivity</code>.</li>
<li id="e-k0x9">The <code>POIDetailFragment</code> will contain the logic to display the details of the selected POI and the ability to create, update, and delete the POI.</li>
<li id="e-MywX">The tablet real estate is comparatively larger, and hence its layout can hold both <code>POIListFragment</code> and <code>POIDetailFragment</code> on a single activity. This allows us to reuse the fragments and enables different user experiences on different screen sizes.</li>
</ol>
<p id="e-uJVb">The following sections in this chapter will guide you through how to use fragments to build the <code>POIApp</code> using the multi-pane split view layout for Android tablets.</p>

<h1 id="e-e7gZ">Using fragments for displaying POIDetails</h1>
<p id="e-OPFp">In order to make things simple, we will move step by step. First, let's create a new fragment to display the details of the POI, and this will enable you to edit, update, and delete the POI. Currently, the <code>POIDetailActivity</code> activity contains the same logic. At this point, let's keep it simple and not complicate things by thinking about the multi-pane tablet layout.</p>
<h2 id="e-hIju">Creating the POIDetailsFragment layout</h2>
<p id="e-cwnm">Let's begin with creating a new layout file for the POI details fragment and name it <code>POIDetailFragment.axml</code>:</p>
<ol id="e-MYxn">
<li id="e-axjI">Select the <code>Resources/Layout</code> folder in the <strong>Solution</strong> pad.</li>
<li id="e-KZZL">Right-click on <strong>Add</strong> and select <strong>New File</strong>.</li>
<li id="e-gbrc">In the <strong>New File</strong> dialog box, click on <strong>Android</strong> and select <strong>Layout</strong>, enter <code>POIDetailFragment</code> in the <strong>Name</strong> field, and select <strong>New</strong>.</li>
<li id="e-dpsS">Note that we will not make any changes to the POI details screen layout. So, let's just copy the layout XML source code from <code>POIDetail.axml</code> and paste it into the newly created <code>POIDetailFragment.axml</code> file.</li>
</ol>
<h2 id="e-vOHl">Creating the POIDetailFragment</h2>
<p id="e-YTd8">Now that we have the POI details fragment layout ready, we need a corresponding fragment. To create <code>POIDetailFragment</code>, perform the following steps:</p>
<ol id="e-PybI">
<li id="e-BwTf">Select the <code>POIApp</code> project in the <strong>Solution</strong> pad, right-click on it, and navigate to <strong>Add</strong> | <strong>New File</strong>.</li>
<li id="e-zbAY">From the <strong>New File</strong> dialog box, click on <strong>Android</strong> and select <strong>Fragment</strong>, enter <code>POIDetailFragment</code> in the <strong>Name</strong> field, and click on <strong>New</strong>.<p id="e-H5b0">The <code>POIDetailFragment</code> created in the previous steps will contain the logic to display the details of the POI and enables various actions, such as create, update, and delete the POI. Currently, the business logic is in <code>POIDetailsActivity</code>.</p>
</li>
<li id="e-nCYZ">Declare the following set of private variables for each of the input widgets we created in the layout. Add the following listing to your <code>POIDetailFragment</code> class:<pre id="e-uJDq">PointOfInterest _poi;
 EditText _nameEditText;
EditText _descrEditText;
EditText _addrEditText;
EditText _latEditText;
EditText _longEditText;</pre>
</li>
<li id="e-T8NA">Override the <code>OnAttach()</code> method and save the reference of the <code>activity</code> instance:<pre id="e-HCJc">private Activity activity;
public override void OnAttach (Activity activity)
{
  base.OnAttach (activity);
  this.activity = activity;
}</pre>
</li>
<li id="e-N6O8">Override the <code>OnCreateView()</code> method, inflate the fragment layout, and bind each variable to its corresponding user interface widget by calling the <code>FindViewById&amp;lt;T&amp;gt;</code> method and the <code>UpdateUI()</code> method:<pre id="e-ESCr">public override View OnCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)
{
  View view = inflater.Inflate(Resource.Layout.POIDetailFragment, container, false);
   _nameEditText = view.FindViewById&amp;lt;EditText&amp;gt;(Resource.Id.nameEditText);
  _descrEditText = view.FindViewById&amp;lt;EditText&amp;gt; (Resource.Id.descrEditText);
  _addrEditText = view.FindViewById&amp;lt;EditText&amp;gt; (Resource.Id.addrEditText);
  _latEditText = view.FindViewById&amp;lt;EditText&amp;gt; (Resource.Id.latEditText);
  _longEditText = view.FindViewById&amp;lt;EditText&amp;gt; (Resource.Id.longEditText);
 UpdateUI();
  return view;
}</pre>
</li>
<li id="e-FNvk">Copy and paste the <code>UpdateUI()</code>, <code>SavePOI()</code>, <code>DeletePOI()</code>, and <code>ConfirmDelete()</code> methods' code from the <code>POIDetailsActivity</code> class to the <code>POIDetailFragment</code> class. You will get a compilation error wherever this keyword is used. Replace this with the activity instance.</li>
<li id="e-z333">Now copy both the <code>CreateOrUpdatePOIAsync()</code> and <code>DeletePOIAsync()</code> methods from <code>POIDetailsActivity</code> to the <code>POIDetailFragment</code> class. Here, you will again notice a compilation error near the <code>Finish()</code> method and the <code>Toast</code> initialization. For the <code>Toast</code> instantiation, replace this with the activity instance and replace <code>Finish()</code> with <code>activity.Finish()</code>.</li>
<li id="e-NxeE">Now let's override the <code>OnCreate()</code> method. Here, we will retrieve the details of the POI sent to <code>POIDetailFragment</code>. Each fragment has an <code>Arguments</code> property that contains the data bundles. As with activities, we can use a series of <code>GetXXX()</code> methods, where <code>XXX</code> represents the type of the value of a name/value pair:<pre id="e-Mz7W">public override void OnCreate (Bundle savedInstanceState)
{
  base.OnCreate (savedInstanceState);
  if (Arguments!=null &amp;amp;&amp;amp; Arguments.ContainsKey("poi")) {
    string poiJson = Arguments.GetString ("poi");
    _poi = JsonConvert.DeserializeObject&amp;lt;PointOfInterest&amp;gt;(poiJson);
  } else {
    _poi = new PointOfInterest ();
  }
}</pre>
</li>
</ol>
<h2 id="e-RbO5">Working with the save and delete actions</h2>
<p id="e-jnJn">The <code>POIDetailFragment</code> displays the details of the selected POI to the user and also retains the ability to save a new or delete an existing POI. The save and delete actions are to be added to the action bar in <code>POIDetailFragment</code>.</p>
<p id="e-TyuL">The following steps will guide you through what is needed to add the actions in the <code>POIDetailFragment</code>:</p>
<ol id="e-pAFM">
<li id="e-LXGd">To make the action bar button work on the fragments, you need to first enable this option by calling the <code>SetHasOptionsMenu ()</code> method and passing the <code>bool</code> value <code>true</code>. The <code>bool</code> value represents whether or not the fragment wants to contribute in order to populate the menu items. Add the following block to <code>OnCreateView()</code> before the <code>return</code> statement:<pre id="e-jdIP">SetHasOptionsMenu (true);</pre>
</li>
<li id="e-I00e">In Chapter 5, <em>Adding a Details View</em>, we have already added the menu declaration to the <code>POIDetailMenu.xml</code> file. The <code>POIDetailFragment</code> will continue to use the same menu XML declaration.</li>
<li id="e-nYmP">Override the fragment version of the <code>OnCreateOptionsMenu()</code> and <code>OnOptionsItemSelected()</code> methods in <code>POIDetailFragment</code>, and add the following code blocks:<pre id="e-j4eM">public override void OnCreateOptionsMenu (IMenu menu, MenuInflater inflater)
{
  inflater.Inflate(Resource.Menu.POIDetailMenu, menu);
  base.OnCreateOptionsMenu (menu, inflater);
}
 public override bool OnOptionsItemSelected (IMenuItem item)
{
  switch (item.ItemId)
  {
    case Resource.Id.actionSave:
      SavePOI ();
      return true;
    case Resource.Id.actionDelete: 
      DeletePOI ();
      return true;
    default:
      return base.OnOptionsItemSelected(item);
  }
}</pre>
<p id="e-VLvC">Notice that in the previous code blocks, we are not making any changes to the logic while populating the <code>save</code> and <code>delete</code> actions. It is just the copy of the same code, which was used in the <code>POIDetailActivity</code> class.</p>
</li>
<li id="e-K204">Override the <code>OnPrepareOptionsMenu()</code> method in <code>POIDetailFragment</code> to disable the delete action while a new POI is being created.</li>
</ol>
<p id="e-vgde">The following listing shows how to disable the delete action when a new POI is being created:</p>
<pre id="e-B8dr">public override void OnPrepareOptionsMenu (IMenu menu)
{
  base.OnPrepareOptionsMenu (menu);
  if (_poi.Id &amp;lt;= 0) {
    IMenuItem item = menu.FindItem (Resource.Id.actionDelete);
    item.SetEnabled (false);
    item.SetVisible(false);
  }
}</pre>
<h2 id="e-LScA">Adding the POIDetailFragment to POIDetailActivity</h2>
<p id="e-C5TV">Now that we are ready with the <code>POIDetailFragment</code>, we can add it to <code>POIDetailActivity</code> to make it fully functional. As discussed earlier in this chapter, a fragment can be added to an activity in two ways: using a declarative approach, or by dynamically inflating the layout. For <code>POIDetailActivity</code>, we will add the fragment dynamically.</p>
<p id="e-ayRx">The following sections will take you through the code refactoring process of adding <code>POIDetailFragment</code> to the <code>POIDetailActivity</code> activity.</p>
<h3 id="e-SdnK">Modifying the POI details activity layout</h3>
<p id="e-MgD6">Now that we have placed the entire details view layout in the <code>POIDetailFragment</code> layout, the <code>POIDetail</code> activity layout will have a simple container that can host the fragment. For this purpose, we can use <code>FrameLayout</code>.</p>
<p id="e-uVfj"><code>FrameLayout</code> is a special kind of a layout manager, generally used to display a single item. When multiple views are added, they are placed in a stack with the most recently added child on the top.</p>
<p id="e-U4Dc">Let's make the following changes to the POI details activity layout and add a dummy view that acts as a placeholder to hold the fragment:</p>
<ol id="e-xYSx">
<li id="e-lp3p">Open the <code>Resources/POIDetail.axml</code> file, and in the <strong>Document Outline</strong> view, click on <strong>ScrollView</strong> and then click on <strong>Delete</strong>. Notice that the layout will be empty.</li>
<li id="e-OQx5">Search for <strong>FrameLayout</strong> in the <strong>Toolbox</strong> and drag it to the simulator window to add it as a root element.</li>
<li id="e-Vndc">Click on <strong>FrameLayout</strong> in the <strong>Document Outline</strong> view and then click on the <strong>Properties</strong> window. Set the view ID to <code>poiDetailLayout</code>.</li>
<li id="e-zBsM">Click on the <strong>Source</strong> tab in the layout editor and notice that the following code is generated:<pre id="e-Wh7C">&amp;lt;?xml version="1.0" encoding="utf-8"?&amp;gt;
&amp;lt;FrameLayout 
    p1:minWidth="25px"
    p1:minHeight="25px"
    p1:layout_width="match_parent"
    p1:layout_height="match_parent"
    p1:id="@+id/poiDetailLayout " /&amp;gt;</pre>
</li>
</ol>
<h3 id="e-s17D">Refactoring POIDetailActivity to add POIDetailFragment</h3>
<p id="e-ODhI">Currently, the <code>POIDetailFragment</code> contains the logic we wrote earlier to perform the add, update, or delete operations in <code>POIDetailActivity</code>. Now let's refactor <code>POIDetailActivity</code> to thin out the logic and just add <code>POIDetailFragment</code> to it:</p>
<ol id="e-knHg">
<li id="e-COf8">Open the <code>POIDetailActivity</code> class from the Solution Explorer.</li>
<li id="e-SElm">Select all of the code and delete everything except the basic activity template. For the sake of simplicity, you may replace the whole <code>POIDetailActivity</code> class with the following code:<pre id="e-M2zs">using Android.App;
 namespace POIApp
{
  [Activity (Label = "POIDetailActivity")]    
  public class POIDetailActivity : Activity
  {
    PointOfInterest _poi;
    protected override void OnCreate (Bundle bundle)
    {
      base.OnCreate (bundle);
      SetContentView (Resource.Layout.POIDetail);  
    }
  }
}</pre>
</li>
<li id="e-PYOX">Now it is time to add <code>POIDetailFragment</code> to <code>Activity</code>. Let's first initialize the <code>POIDetailFragment</code> and pass the POI details data received from <code>POIListActivity</code>.<p id="e-IBYD">To display the details of the selected POI, the <code>POIDetailFragment</code> expects the POI data to be passed to it. Like any other activity, data bundles can be passed to a fragment using its <code>Arguments</code> property. The <code>Arguments</code> property has its own set of the <code>PutXX()</code> and <code>GetXX()</code> methods (<code>XX</code> represents the data types, such as string, double, and so on) that are used to send and retrieve data from fragments.</p>
<p id="e-Hnde">Add the following code snippet to the <code>OnCreate()</code> callback right after the <code>SetContentView()</code> method:</p>
<pre id="e-kY8i">var detailFragment = new POIDetailFragment();
detailFragment.Arguments = new Bundle ();
if (Intent.HasExtra ("poi")) {
    string poiJson = Intent.GetStringExtra ("poi");
    detailFragment.Arguments.PutString("poi", poiJson);}</pre>
</li>
<li id="e-AYKA">The <code>POIDetailActivity</code> layout contains a placeholder layout where the <code>POIDetailFragment</code> will be added. The <code>FragmentTransaction</code> class can be used to perform any of the fragment transactions, such as adding, replacing, or deleting fragments. Instantiate the fragment transaction to add <code>POIDetailFragment</code> to the <code>POIDetailActivity</code> view hierarchy: <pre id="e-RMxx">FragmentTransaction ft = FragmentManager.BeginTransaction();
ft.Add(Resource.Id.poiDetailLayout, detailFragment);
ft.Commit();</pre>
</li>
<li id="e-ntZW">Let's now build and run the app in a simulator. Notice that you will see the same output that we built in Chapter 5, <em>Adding a Details View</em>. Now we are using <code>POIDetailFragment</code> that holds the logic to add, update, and delete POIs.</li>
</ol>
<p id="e-N4St">The same <code>POIDetailFragment</code> will be reused while creating the multi-pane split view layout for the tablet.</p>

<h1 id="e-wg17">Using the list fragment for displaying the POI list</h1>
<p id="e-oC9p">So far, we have created a fragment using the <code>Fragment</code> subclass to display the details of the point of interest. Let's now use a specialized <code>ListFragment</code> class to create a new fragment to display the POI list fetched from the server.</p>
<h2 id="e-Rp07">Understanding ListFragment</h2>
<p id="e-pQP7">Before we start creating the <code>POIListFragment</code>, let's understand the following key concepts of <code>ListFragment</code>:</p>
<ul id="e-rQY6">
<li id="e-hnY8">
<code>ListFragment</code> is a specialized <code>Fragment</code> subclass used to display the list of items from different data sources, such as an array or a cursor, that hold the query results.</li>
<li id="e-XmZW">
<code>ListFragment</code> provides a default layout that contains a single list view. However, it can be customized using your own custom layout.</li>
<li id="e-pW3m">While using a custom layout for <code>ListFragment</code>, your layout must contain a <code>ListView</code> object with the ID <code>@android:id/list</code>.</li>
<li id="e-Ds0N">Like the normal <code>ListView</code>, the list fragment needs the instance of an adapter to operate on. It exposes a public <code>ListAdapter</code> property to set the list adapter.</li>
<li id="e-USyS">You can override <code>OnListItemClick()</code>, provided <code>ListFragment</code> allows you to detect user-click events on the list items.</li>
</ul>
<h2 id="e-b4YK">Creating the POIListFragment layout</h2>
<p id="e-Yilc">Here, in our example, the <code>POIDetailsFragment</code> will contain a <code>ListView</code> that takes the full width and height of the parent and a <code>ProgressBar</code> to the center of the screen. We will now create a custom layout for <code>ListFragment</code>.</p>
<p id="e-IwCg">Let's begin by creating a new layout file for the POI list fragment and name it <code>POIListFragment.axml</code>.</p>
<ol id="e-Eaig">
<li id="e-P7mF">Select the <code>Resources/Layout</code> folder in the <strong>Solution</strong> pad.</li>
<li id="e-C0Ej">Right-click on <strong>Add</strong> and select <strong>New File</strong>.</li>
<li id="e-wFd7">In the <strong>New File</strong> dialog box, click on <strong>Android</strong> and select <strong>Android Layout</strong>, enter <code>POIListFragment</code> in the <strong>Name</strong> field, and select <strong>New</strong>.</li>
<li id="e-doDY">Copy the layout XML source code from <code>POIList.axml</code> and paste it in to the newly created <code>POIListFragment.axml</code> file.</li>
<li id="e-zhzW">Notice that we are declaring the custom layout for <code>ListFragment</code>. We must change the list view ID to <code>@android:id/list</code>.</li>
</ol>
<p id="e-SOiS">The <code>POILsitFragment.axml</code> file will have the following code snippets:</p>
<pre id="e-jKsq">&amp;lt;?xml version="1.0" encoding="utf-8"?&amp;gt;
&amp;lt;RelativeLayout 
    android:orientation="vertical"
    android:layout_width="fill_parent"
    android:layout_height="fill_parent"
    android:minWidth="25px"
    android:minHeight="25px"&amp;gt;
    &amp;lt;ListView
        android:minWidth="25px"
        android:minHeight="25px"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:id="@android:id/list" /&amp;gt;
    &amp;lt;ProgressBar
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:id="@+id/progressBar"
        android:layout_centerInParent="true"
        android:visibility="gone" /&amp;gt;
&amp;lt;/RelativeLayout&amp;gt;</pre>
<h2 id="e-wnRH">Creating the fragment to display the POI list using POIListFragment</h2>
<p id="e-yVkT">Now that we have the layout ready for the <code>POIListFragment</code>, let's move ahead to create a new fragment to display the list of POIs. Note that we are not making any significant changes to the logic we have written for <code>POIListActivity</code>. Instead, we will refactor the same logic to work with fragments.</p>
<p id="e-JjT8">Perform the following steps to create <code>POIListFragment</code> and make it fully functional:</p>
<ol id="e-Ci3g">
<li id="e-O0qG">Select the <code>POIApp</code> in the <strong>Solution</strong> pad, right-click on <strong>Add</strong>, and select <strong>New File</strong>.</li>
<li id="e-URS5">In the <strong>New File</strong> dialog box, click on <strong>Android</strong> and select <strong>New file</strong>, enter <code>POIListFragment</code> in the <strong>Name</strong> field, and select <strong>New</strong>.</li>
<li id="e-JZoh">Extend it from <code>ListFragment</code> and implement <code>OnCreateView()</code> to inflate the POI list fragment layout:<pre id="e-XOef">namespace POIApp {
  public class POIListFragment: ListFragment 
  {
    public override View OnCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)
    {
      View view = inflater.Inflate(Resource.Layout.POIListFragment, container, false);
      return view;
    }
  }
}</pre>
<p id="e-gWFk">Note that the list fragments with the custom layout need to have a <code>ListView</code> object declaration with the ID <code>@android:id/list</code>.</p>
</li>
<li id="e-CX7G">Declare the following set of private variables to hold the instance of the list adapter, progress bar, and list of POIs, after the download is complete:<pre id="e-dAYT">private ProgressBar progressBar;
private List&amp;lt;PointOfInterest&amp;gt; poiListData;
private POIListViewAdapter poiListAdapter;</pre>
</li>
<li id="e-Wath">Override the <code>OnAttach()</code> method and save the reference of the <code>activity</code> instance:<pre id="e-rNFd">private Activity activity;
public override void OnAttach (Activity activity)
{
  base.OnAttach (activity);
  this.activity = activity;
}</pre>
</li>
<li id="e-zuYn">Add the following code blocks to the <code>OnCreateView()</code> method before the <code>return</code> statements to initialize the progress bar:<pre id="e-txQS">progressBar = view.FindViewById&amp;lt;ProgressBar&amp;gt; (Resource.Id.progressBar);</pre>
</li>
<li id="e-f2ge">Create a new method named <code>DownloadPoisListAsync</code> (the same as declared in <code>POIListActivity</code>). We will be using the same logic we wrote earlier for <code>POIListActivity</code> with a small modification as follows. You will get a compilation error wherever the <code>this</code> keyword is used. Replace <code>this</code> with the <code>activity</code> instance:<pre id="e-Hnzy">public async void DownloadPoisListAsync(){
  POIService service = new POIService ();
  if (!service.isConnected (activity)) {
    Toast toast = Toast.MakeText (activity, "Not conntected to internet. Please check your device network settings.", ToastLength.Short);
    toast.Show ();
  } else {
    progressBar.Visibility = ViewStates.Visible;
    poiListData = await service.GetPOIListAsync ();
    progressBar.Visibility = ViewStates.Gone;
     poiListAdapter = new POIListViewAdapter (activity, poiListData);
    this.ListAdapter = poiListAdapter;
  }
}</pre>
<p id="e-pzc8">Notice that in the preceding code blocks, we use the <code>ListAdapter</code> property defined in the <code>ListFragment</code> class to set the adapter instance.</p>
</li>
<li id="e-kd7o">Override the <code>OnResume()</code> life cycle method  and call <code>DownloadPoisListAsync()</code> to start the download when a fragment is resumed:<pre id="e-YJhL">public override void OnResume ()
{
    DownloadPoisListAsync ();
  base.OnResume ();
}</pre>
</li>
<li id="e-kfTY">Note that <code>POIListFragment</code> contributes to the action bar menu items and enables this option for the fragment by adding the following statement to <code>OnCreateView()</code> before the <code>return</code> statement:<pre id="e-iSmQ">SetHasOptionsMenu (true);</pre>
</li>
<li id="e-Xtbi">Override the fragment version of the <code>OnCreateOptionsMenu</code> and <code>OnOptionsItemSelected</code> methods and paste in the following code. We are just reusing the same logic from <code>POIListActivity</code>:<pre id="e-tblp">public override void OnCreateOptionsMenu (IMenu menu, MenuInflater inflater)
{
  &lt;span class="strong"&gt;&lt;strong&gt;inflater.Inflate(Resource.Menu.POIListViewMenu, menu);&lt;/strong&gt;&lt;/span&gt;
  base.OnCreateOptionsMenu (menu, inflater);
}
 public override bool OnOptionsItemSelected (IMenuItem item)
{
  switch (item.ItemId)
  {
  case Resource.Id.actionNew:
&lt;span class="strong"&gt;&lt;strong&gt;    Intent intent = new Intent (activity, typeof(POIDetailActivity));&lt;/strong&gt;&lt;/span&gt;
    StartActivity (intent);
    return true;
  case Resource.Id.actionRefresh:
    DownloadPoisListAsync ();
    return true;
  default :
    return base.OnOptionsItemSelected(item);
  }
}</pre>
</li>
<li id="e-az0S">Override the <code>OnListItemClick()</code> method from <code>ListFragment</code> to detect the list row click action. The following code block is a copy of the same logic we wrote for the <code>POIClicked()</code> method in <code>POIListActivity</code>:<pre id="e-wH5X">public override void OnListItemClick (ListView l, View v, int position, long id)
{
  &lt;span class="strong"&gt;&lt;strong&gt;PointOfInterest poi = poiListData[position];  &lt;/strong&gt;&lt;/span&gt;
Intent poiDetailIntent = new Intent(activity, typeof(POIDetailActivity));
   string poiJson = JsonConvert.SerializeObject(poi); 
  poiDetailIntent.PutExtra("poi", poiJson);
  StartActivity(poiDetailIntent);
}</pre>
</li>
</ol>
<p id="e-EI6o">At this point, the list fragment will display the list of POIs and is ready to be added to <code>POIListActivity</code>.</p>
<h2 id="e-dCdA">Adding POIListFragment to POIListActivity</h2>
<p id="e-cuU5">For <code>POIListFragment</code> to work, it has to be added to <code>POIListActivity</code>. In the previous section, you learned how to add the fragment dynamically. Now let's add the <code>POIListFragment</code> using a declarative approach.</p>
<h3 id="e-Q6hM">Modifying the POI list activity layout</h3>
<p id="e-QLIi">A fragment can be added to an activity view hierarchy using the <code>&amp;lt;fragment&amp;gt;</code> tag declaration in its layout. The <code>layout_width</code> and <code>layout_height</code> attributes of the <code>&amp;lt;fragment&amp;gt;</code> tag are used to control the <code>LayoutParams</code> provided when attaching the fragment's view to the activity layout.</p>
<p id="e-DgoQ">Make the following changes to the POI list activity layout (<code>POIList.axml</code>) to add <code>POIListFragment</code> statically:</p>
<pre id="e-R2QG">&amp;lt;?xml version="1.0" encoding="utf-8"?&amp;gt;
&amp;lt;LinearLayout 
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:minWidth="25px"
    android:minHeight="25px"
    android:orientation="horizontal"&amp;gt;
    &amp;lt;fragment
        class="POIApp.POIListFragment"
        android:id="@+id/listFragment"
        android:layout_width="match_parent"
        android:layout_height="match_parent" /&amp;gt;
&amp;lt;/LinearLayout&amp;gt;</pre>
<p id="e-UIhf">The value of the <code>&amp;lt;fragment&amp;gt;</code> attribute should be a fully qualified fragment class name. The <code>class</code> attribute indicates that the specified fragment class will be attached to the activity's content layout.</p>
<h3 id="e-cvCQ">Adding POIListFragment to POIListActivity</h3>
<p id="e-CbRl">Now that we are ready with <code>POIListFragment</code>, and we have attached it to the POI list activity content layout, we do not have to do anything much inside <code>POIListActivity</code>. Update the existing <code>POIListActivity</code> class with the following code blocks:</p>
<pre id="e-Oij6">using Android.App;
using Android.Os;
 namespace POIApp
{
  [Activity (Label = "POI List")]
  public class POIListActivity : Activity
  {
    protected override void OnCreate (Bundle bundle)
    {
      base.OnCreate (bundle);
      SetContentView (Resource.Layout.POIList);
    }
  }
}</pre>
<p id="e-njbG">So far, we have done a great deal of work by creating two fragments that hold the logic to download and display the POI details. Now it's time to compile and run the app. Compile and run the application on the Android emulator:</p>
<img data-width="800" data-height="313" src="jsNKGobJ.jpg"/><p id="e-nheF">Notice that the app will download the data from the POI web service and display the list of POIs on the scrollable list view. It works in exactly the same way as it did when we built it in Chapter 5, <em>Adding a Details View</em>, but now it works with fragments.</p>

<h1 id="e-HOM6">Creating a multi-pane layout for tablets</h1>
<p id="e-ixXd">By now, you have a fair idea of how fragments work, and we have refactored the existing <code>POIApp</code> to work with fragments. The following sections will walk you through the key steps required to build the multi-pane layout and make the application compatible with Android tablets.</p>
<p id="e-TfBn">In Chatper 6, <em>Making App Orientation Aware</em>, we discussed the various configuration qualifiers to be considered while adding alternative layouts in Android. One of the qualifiers is the device's screen size. The Android powered device sizes ranges from small, normal, large, xlarge to layout-xxlarge. Since Android 3.2, Android has recommended that you use the <code>sw&amp;lt;N&amp;gt;dp</code> configuration qualifier to define an extra large layout for a tablet.</p>
<p id="e-rMk8">Let's assume that we require at least <code>600dp</code> of screen width to build a multi-pane layout for the <code>POIApp</code>. For this, we need add a new <code>layout-sw600dp</code> subdirectory under the <code>Resources</code> directory. The Android runtime will pick the layout placed under this directory if the device configuration matches <code>600dp</code> of width.</p>
<p id="e-ES6b">For tablet configuration, the <code>POIListActivity</code> layout will host both <code>POIListFragment</code> and the <code>POIDetailFragment</code> in a single activity. The POI list fragment will be placed to the left of the screen covering 40 percent of the total width, and the details fragment is docked to the right, covering the remaining 60 percent of the total width.</p>
<p id="e-pUOH">Xamarin Studio provides an easy-to-use layout designer that allows you to alternatively add layouts for various device configurations without any hassle. You don't need to remember or manually add the different folder names for different configuration qualifiers. The designer takes care of creating, editing, and deleting alternative layouts for different configurations.</p>
<p id="e-RLmE">The following section shows the usages of the Xamarin Studio layout designer to add alternative layouts for Android tablets:</p>
<ol id="e-ucLr">
<li id="e-B9EB">Open the <code>POIList.axml</code> layout file and click on the <strong>Content</strong> tab to open the layout designer.</li>
<li id="e-aoqO">Click on the <strong>Alternative Layouts</strong> button located in the top-left corner. This enables a special editor to manage the alternative layouts. The following screenshot depicts the special editor provided in Xamarin Studio to edit and manage the alternative layouts for different configurations:<img data-width="800" data-height="498" src="zOfxWkZc.jpg"/>
</li>
<li id="e-LU6O">Click on the <strong>+New Version</strong> button to add another version of the layout for a given configuration.</li>
<li id="e-M5Li">This will open a dialog asking for different configuration parameters. For now, we will consider the minimum width for the tablet layout to be <code>600dp</code>. Enter the smallest screen width value as <code>600</code>, and then click on <strong>Add</strong>:<img data-width="800" data-height="458" src="mW606wsD.jpg"/>
</li>
<li id="e-GkCo">Notice that a new folder with the name <code>layout-sw600dp</code>, and that a new version of the <code>POIList</code> layout will be created in the Project Explorer.</li>
<li id="e-aRaP">Select the <code>sw600dp</code> layout to edit.</li>
<li id="e-Wnd4">Search for <strong>FrameLayout</strong> in the <strong>Toolbox</strong> and drag it to the simulator window to add it as a root element. This will be used to add <code>POIDetailFragment</code> dynamically when a user selects any POI from the list.</li>
<li id="e-jO4x">Click on <strong>FrameLayout</strong> in the <strong>Document Outline</strong> view and then click on the <strong>Properties</strong> window. Set the view ID to <code>poiDetailLayout</code>.</li>
<li id="e-MfBj">Now we have a list fragment and a frame layout in the screen. Let's assign 40 percent of the screen width for the list to appear and 60 percent for the details layout. This can be done using the <code>weight</code> property.<p id="e-dTeS">Select <code>listFragment</code> from the <strong>Document Outline</strong> view and change the weight property to <code>2</code> and the <code>layout_width</code> property to <code>0dp</code>. This allows the weight property to decide the width of the view. Now, select <code>detailsLayout</code> from the document outline view, and change the weight property to <code>3</code> and the <code>layout_width</code> property to <code>0dp</code>.</p>
</li>
<li id="e-wbQV">Set the <strong>Padding left</strong>and <strong>Padding right</strong> properties to <code>20dp</code> for both <code>listFragment</code> and <code>detailsLayout</code>.<p id="e-MUZw">The following screenshot depicts the layout built so far:</p>
<img data-width="800" data-height="518" src="Z73UBBUs.jpg"/>
</li>
<li id="e-UrMu">Click on the <strong>Source</strong> tab and notice that the following code gets generated: <pre id="e-LfZM">&amp;lt;?xml version="1.0" encoding="utf-8"?&amp;gt;
&amp;lt;LinearLayout 
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:minWidth="25px"
    android:minHeight="25px"
    android:orientation="horizontal"&amp;gt;
    &amp;lt;fragment
      class="POIApp.POIListFragment"
      android:id="@+id/listFragment"
      android:layout_width="0dp"
      android:layout_height="match_parent"
      android:layout_weight="2" 
      android:paddingLeft="20dp"
      android:paddingRight="20dp" /&amp;gt;
    &amp;lt;FrameLayout
      android:minWidth="25px"
      android:minHeight="25px"
      android:layout_width="0dp"
      android:layout_height="match_parent"
      android:id="@+id/poiDetailLayout"
      android:layout_weight="3"
      android:paddingLeft="20dp"
      android:paddingRight="20dp" /&amp;gt;
&amp;lt;/LinearLayout&amp;gt;</pre>
</li>
</ol>

<h1 id="e-uc36">Updating the POIApp to support the multi-pane split layout</h1>
<p id="e-V0jC">In an Android tablet, the POI activity layout is declared to host both the POI list and POI details fragments by sharing the same screen space. The <code>POIListFragment</code> is statically added to the layout, and <code>POIDetailFragment</code> will be added dynamically when a user selects any POI item from the list. The <code>FrameLayout</code> with the <code>detailsLayout</code> ID is used as a placeholder to host the <code>POIDetailFragment</code>. However, in mobile devices, when a user clicks on any POI list item, it will continue to start <code>POIDetailActivity</code>.</p>
<p id="e-J34g">The following steps will take you through the changes required to make the <code>POIApp</code> work for the multi-pane layout in Android powered tablets:</p>
<ol id="e-mTIt">
<li id="e-LUwI">First, we need to find out if the device is running in the multi-pane mode. This is useful in order to understand whether you want to start a new activity or update the fragment content in the same activity. Let's declare a static Boolean variable that holds the information about whether or not an app is running in the dual mode:<pre id="e-uTMp">public static bool isDualMode = false;</pre>
</li>
<li id="e-J0Yr">If the <code>detailsLayout</code> is not <code>null</code> and visible, then we can assume that the device is running in the multi-pane view mode. Add the following code blocks to your <code>POIListActivity</code> in the <code>OnCreate()</code> method to initialize the <code>isDualMode</code> variable:<pre id="e-SHir">var detailsLayout = FindViewById (Resource.Id.poiDetailLayout);
if (detailsLayout != null &amp;amp;&amp;amp; detailsLayout.Visibility == ViewStates.Visible) {
    isDualMode = true;
}else{
isDualMode = false;
}</pre>
</li>
<li id="e-g7ti">Currently, the new action in <code>POIListFragment</code> takes the user to <code>POIDetailActivity</code>. Now for tablets, instead of invoking another activity, the <code>POIDetailFragment</code> will be shown on the right-hand side of the same activity.<p id="e-BJo2">Add the following code blocks to the <code>OnOptionsItemSelected()</code> method under a new action:</p>
<pre id="e-NCaJ">case Resource.Id.actionNew:
    if (POIListActivity.isDualMode) {
        var detailFragment = new POIDetailFragment();
        FragmentTransaction ft = FragmentManager.BeginTransaction ();
        ft.Replace (Resource.Id.poiDetailLayout, detailFragment);
        ft.Commit ();
    } else {
        Intent intent = new Intent (activity, typeof(POIDetailActivity));
        StartActivity (intent);
    }
return true;</pre>
<p id="e-BIzT">Note that, as we are not passing any details of the POI, the <code>POIDetailsFragment</code> will show the empty fields and allow the user to add a new POI.</p>
</li>
<li id="e-Xpib">As in the previous steps, we need the same implementation in the <code>OnListItemClick()</code> method. When a user clicks on the POI list item, instead of taking them to another activity, the POI details will be shown on the same activity in the right-hand details pane.<p id="e-AOKU">Update the <code>OnListItemClick()</code> method with the following code snippets:</p>
<pre id="e-Ul46">public override void OnListItemClick (ListView l, View v, int position, long id)
{
  PointOfInterest poi = poiListData[position];
  if (POIListActivity.isDualMode) {
    var detailFragment = new POIDetailFragment();
    detailFragment.Arguments = new Bundle ();
    detailFragment.Arguments.PutString("poi", JsonConvert.SerializeObject(poi));
     FragmentTransaction ft = FragmentManager.BeginTransaction ();
    ft.Replace (Resource.Id.poiDetailLayout, detailFragment);
    ft.Commit ();
  } else {
    Intent poiDetailIntent = new Intent(activity, typeof(POIDetailActivity));
    poiDetailIntent.PutExtra("poi", JsonConvert.SerializeObject(poi));
    StartActivity(poiDetailIntent);
  }
}</pre>
</li>
</ol>
<p id="e-MbrZ">We are almost done! Let's now run the <code>POIApp</code> in the Android tablet emulator. You will notice that the POI app shows the multi-pane layout, as shown in the following screenshot:</p>
<img data-width="800" data-height="306" src="SpXNlUS6.jpg"/>
<h1 id="e-XRSg">Working with DialogFragment</h1>
<p id="e-rcOW">In this chapter, we already covered how to use the fragment and <code>ListFragment</code> to optimize layout for Android tablets. Let's now discuss another specialized fragment subclass, <code>DialogFragment</code>. The current implementation of the <code>POIApp</code> uses <code>AlertDialog</code> to display the confirmation dialog to a user before deleting the POI. In this section, we will replace the <code>AlertDialog</code> implementation with <code>DialogFragment</code>.</p>
<p id="e-cSpo"><code>DialogFragment</code> is used to display a fragment as a floating dialog window that pops up on top of the current window. <code>DialogFragment</code> is the subclass of fragment and was introduced in Android 3.0 API level 11. Google recommends that you use <code>DialogFragment</code> for implementing the dialog because of the following reasons:</p>
<ul id="e-ZEzg">
<li id="e-Ksjl">Like normal fragments, <code>DialogFragment</code> manages its own life cycle. Events such as the user pressing the device's Back button or rotating the screen are handled in <code>DialogFragment</code>.</li>
<li id="e-GJq4">A <code>DialogFragment</code> UI can be reused and embedded inside another activity. For example, if you wish your dialog to appear differently on different screen sizes, you can embed the <code>DialogFragment</code> inside the activity layout, which is similar to normal fragments.</li>
<li id="e-DfFN">Although <code>DialogFragment</code> was introduced in Android 3.0, Google has released the Android support library, using which you can use the <code>DialogFragment</code> class for devices running on Android 1.6 or higher. The subsequent section (fragment for older Android devices) will describe how to add the Android Support Library to the Xamarin Studio solution.</li>
</ul>
<p id="e-s5Q4">Keeping the preceding points in mind, we will replace the <code>AlertDialog</code> and use <code>DialogFragment</code> in the <code>POIDetailFragment</code> class. Creating a dialog fragment is similar to the process of creating normal fragments. You need to first create a class that inherits from <code>DialogFragment</code> and overrides one of the following methods to provide the view hierarchy for your dialog:</p>
<ul id="e-JfnO">
<li id="e-jcWR">
<code>OnCreateView()</code>: This method is used to inflate the layout for the dialog. It is the same as the <code>Fragment.OnCreateView()</code> callback. If you want your fragment UI to be reusable / embedded inside another view, you must override <code>OnCreateView()</code> and inflate the layout.</li>
<li id="e-MXSH">
<code>OnCreateDialog()</code>: This method returns an instance of <code>Dialog</code>. This method is called automatically while creating the layout for the dialog. As we have already used <code>AlertDialog</code> in the <code>POIApp</code>; in this example, we will override the <code>OnCreateDialog()</code> to create the <code>DialogFragment</code>.</li>
</ul>
<p id="e-MYVl">The following steps will show you how use the <code>DialogFragment</code> class to show the <strong>Delete</strong> confirmation dialog to a user:</p>
<ol id="e-cQyH">
<li id="e-YUia">Create a new fragment class and name it <code>DeleteDialogFragment</code>.</li>
<li id="e-EIgM">Inherit the <code>DeleteDialogFragment</code> class from <code>DialogFragment</code>:<pre id="e-y7Q6">public class DeleteDialogFragment : DialogFragment
{
}</pre>
</li>
<li id="e-Sud1">Override the <code>OnCreateDialog()</code> method and add the following code snippets. The code blocks used in the <code>OnCreateDialog()</code> method are similar to the code we used in <code>POIDetailFragment</code> in the <code>DeletePOI()</code> method:<pre id="e-OBCk">public override Dialog OnCreateDialog (Bundle savedInstanceState)
{
  AlertDialog.Builder alertConfirm = new AlertDialog.Builder(this.Activity);
  alertConfirm.SetTitle("Confirm delete");
  alertConfirm.SetCancelable(false);
  alertConfirm.SetPositiveButton("OK", delegate {});
  alertConfirm.SetNegativeButton("Cancel", delegate {});
  alertConfirm.SetMessage("Are you sure you want to delete?");
  return alertConfirm.Create ();
}</pre>
</li>
<li id="e-zrhH">We have constructed a basic version of <code>DialogFragment</code>. Now we need to initialize the fragment and use the <code>FragmentTransaction</code> to display the dialog box. Add the following code snippets to the <code>POIDetailFragment DeletePOI()</code> method:<pre id="e-O00t">FragmentTransaction ft = FragmentManager.BeginTransaction();
DeleteDialogFragment dialogFragment = new DeleteDialogFragment ();
dialogFragment.Show(ft, "dialog");</pre>
<p id="e-XjEf">Like any other fragment, the operations on the dialog fragments are done using fragment transactions. The <code>Show()</code> method is used to add the dialog fragment to the activity view hierarchy and then commit the transaction. This takes two parameters: an instance of the fragment transaction, and a tag. The string value tag can be used later to retrieve the fragment instance from the fragment manager.</p>
</li>
<li id="e-bsQS">Now run and test the <code>POIApp</code>. Notice that the dialog fragment works great. However, it doesn't display the name of the POI that the user wants to delete.</li>
<li id="e-uew7">To display the name of the POI in the <strong>Delete</strong> confirmation dialog, we need to pass the POI name to <code>DeleteDialogFragment</code>. This can be accomplished using the fragment <code>Arguments</code> property. <p id="e-EWYt">Add the following code snippets to the <code>DeletePOI()</code> method after the fragment initialization and before calling <code>dialogFragment.Show()</code>:</p>
<pre id="e-Zlbq">Bundle bundle = new Bundle();
bundle.PutString("name", _poi.Name);
dialogFragment.Arguments = bundle;</pre>
</li>
<li id="e-XDHj">Now we need to make the following changes to the <code>DeleteDialogFragment</code> class in the <code>OnCreateDialog()</code> method to retrieve and display the name of the POI:<pre id="e-wZWh">public override Dialog OnCreateDialog (Bundle savedInstanceState)
{
  &lt;span class="strong"&gt;&lt;strong&gt;string poiName = Arguments.GetString("name");&lt;/strong&gt;&lt;/span&gt;
  AlertDialog.Builder alertConfirm = new AlertDialog.Builder(this.Activity);
  ...
  ....
  &lt;span class="strong"&gt;&lt;strong&gt;alertConfirm.SetMessage(String.Format("Are you sure you want to delete {0}?", poiName));&lt;/strong&gt;&lt;/span&gt;
  return alertConfirm.Create ();
}</pre>
</li>
<li id="e-Ihoh">Run the <code>POIApp</code> and notice that the <strong>Delete</strong> confirmation dialog now displays the name of the POI to be deleted. However, when you click on the <strong>OK</strong> button, the dialog is dismissed but the <code>delete</code> action is not working. We will pass the event callback from the fragment dialog to the <code>POIDetailFragment</code>. This can be easily accomplished using the <code>TargetFragment</code> property.<p id="e-Sr1p">While adding the dialog fragment, we need to provide the target fragment information to the dialog by calling the <code>SetTargetFragment()</code> method. This method accepts two parameters: an instance of fragments that is the target of the dialog, and an optional integer request code.</p>
<p id="e-RCh5">The following code snippet shows the changes required in the <code>DeletePOI()</code> method:</p>
<pre id="e-ATau">protected void DeletePOI()
{
  FragmentTransaction ft = FragmentManager.BeginTransaction();
  DeleteDialogFragment dialogFragment = new DeleteDialogFragment();
  &lt;span class="strong"&gt;&lt;strong&gt;dialogFragment.SetTargetFragment (this,0);&lt;/strong&gt;&lt;/span&gt;
  Bundle bundle = new Bundle();
  bundle.PutString("name", _poi.Name);
  dialogFragment.Arguments = bundle;
  dialogFragment.Show(ft, "dialog");
}</pre>
</li>
<li id="e-p50N">Now we can access the instance of POIDetailsFragment from the dialog fragment using the <code>TargetFragment</code> property, and call the <code>DeletePOIAsync()</code> method to initiate the delete POI web service request.<p id="e-ebZX">The following code shows what should be present in the <code>DeleteDialogFragment</code> class:</p>
<pre id="e-r3LU">public class DeleteDialogFragment : DialogFragment
{
  public override Dialog OnCreateDialog (Bundle savedInstanceState)
  {
    &lt;span class="strong"&gt;&lt;strong&gt;POIDetailFragment targetFragment = (POIDetailFragment) TargetFragment;&lt;/strong&gt;&lt;/span&gt;
     string poiName = Arguments.GetString("name");
     AlertDialog.Builder alertConfirm = new AlertDialog.Builder(this.Activity);
    alertConfirm.SetTitle("Confirm delete");
    alertConfirm.SetCancelable(false);
    alertConfirm.SetPositiveButton("OK", (sender, e) =&amp;gt; {
      &lt;span class="strong"&gt;&lt;strong&gt;targetFragment.DeletePOIAsync();&lt;/strong&gt;&lt;/span&gt;
    });
    alertConfirm.SetNegativeButton("Cancel", delegate {});
    alertConfirm.SetMessage(String.Format("Are you sure you want to delete {0}?", poiName));
    return alertConfirm.Create ();
  }
}</pre>
</li>
</ol>
<p id="e-RLLA">Now run and test the <code>POIApp</code>. Notice that the <code>DeletePOI</code> is fully functional with <code>FragmentDialog</code>.</p>

<h1 id="e-WFZf">Fragments for older Android devices</h1>
<p id="e-F9x2">As we discussed earlier, the Fragment API was added in Android 3.0 API level 11. In the <code>POIApp</code> example discussed so far, I have assumed that the user who tests my application will be using Android 3.0 or later. However, if your business demands that you support your app for older devices, then you can still take advantage of the new Fragment API classes.</p>
<p id="e-GDkm">As there is some portion of the market still running on 3.0, Google provides support libraries that allow you to implement fragments while maintaining backward compatibility. The Fragment features are available in the V4 support library, and it works in Android 1.6 API level 4.</p>
<p id="e-GSHC">You cannot directly use the <code>Fragment</code> class as we have used it in this chapter. You have to add the Support package to your solution. For users of Xamarin Studio 5.9.x or above, while creating a new solution, you can select <strong>Maximum Compatibility</strong> for the targeted platform selection to include support packages in your project.</p>
<p id="e-oEXp">Alternatively, you can add Android support packages by navigating to <strong>Packages</strong> | <strong>Add packages</strong>. This will open the NuGet package browser, as shown in the following screenshot. You can search for Support packages and click on the <strong>Add Package</strong> button to add the selected package to your project:</p>
<img data-width="800" data-height="532" src="iPwO3foe.jpg"/><p id="e-eHgI">After the Android Support packages are added to the project, you can start implementing the fragment features for older Android devices. The Support package fragment classes work pretty much similar to the native Android 3.0 compatible fragment classes. However, the following are some of the changes required by your app for using the supported compatible APIs:</p>
<ul id="e-LQIS">
<li id="e-J1l2">Your activity that will host the support fragment must extend now and inherit from <code>Support.V4.App.FragmentActivity</code>
</li>
<li id="e-VCcc">Use <code>Support.V4.App.Fragment</code> instead of <code>Android.App.Fragment</code>
</li>
<li id="e-iOIo">Use <code>SupportFragmentManager</code> instead of <code>FragmentManager</code>
</li>
</ul>

<h1 id="e-bbnx">Handling configuration changes with fragments</h1>
<p id="e-Rxdc">In Chapter 6, <em>Making Your App Orientation-aware</em>, we discussed how Android activities respond to device configuration changes. In this section, we will take a look at the fragment behavior in the event of configuration changes.</p>
<p id="e-ZhRb">Like activities, fragment provides the <code>OnSaveInstanceState()</code> method that can be used to save the state of your fragment. This works in pretty much the same way as its activity counterpart. The <code>OnSaveInstanceState()</code> method supplies a <code>Bundle</code> instance into which we can dump the data bundles. The saved fragment instance can be retrieved from the <code>OnCreate()</code>, <code>OnActivityCreated()</code>, or <code>OnCreateView()</code> callback.</p>
<p id="e-kgIo">The following steps will guide you through saving and retaining the POI list scroll position when the device configuration changes:</p>
<ol id="e-RYOQ">
<li id="e-ZknR">Get the index of the first visible list item and save it to a bundle in the <code>OnSaveInstanceState()</code> method:<pre id="e-Qye0">public override void OnSaveInstanceState (Bundle outState)
{
  base.OnSaveInstanceState (outState);
  int currentPosition = ListView.FirstVisiblePosition;
  outState.PutInt ("scroll_position", currentPosition);
}</pre>
<p id="e-GO3Y">In the preceding code snippet, the string <code>scroll_position</code> is used as the key to save the current scroll position of <code>ListView</code>.</p>
</li>
<li id="e-cecY">Restore the saved list's scrolling position in <code>OnCreate()</code>. Note that we have to use the same key that we used to save:<pre id="e-uRTW">public override void OnCreate (Bundle savedInstanceState)
{
  base.OnCreate (savedInstanceState);
  if (null != savedInstanceState) {
    scrollPosition = savedInstanceState.GetInt ("scroll_position");  
  }
}</pre>
</li>
<li id="e-lAMm">Add the following code snippet to the <code>DownloadPoisListAsync()</code> method in the <code>POIListFragment</code> class. This queues a message to scroll the POI list view to the previously saved scroll position:<pre id="e-bdXd">public async void DownloadPoisListAsync(){
  POIService service = new POIService ();
  if (!service.isConnected (activity)) {
    ...
    ...
  } else {
    ...
    ...
    this.ListAdapter = poiListAdapter;
    ListView.Post(() =&amp;gt; {
      ListView.SetSelection(scrollPosition);
    });
  }
}</pre>
</li>
</ol>
<p id="e-OGEB">Build and run the app on the Android device or emulator. Change your device orientation and notice that the list view scroll position is now retained.</p>

<h1 id="e-C8U9">Summary</h1>
<p id="e-dYMG">In this chapter, we covered a lot of ground on creating and managing fragments, including the following topics:</p>
<ul id="e-UXMz">
<li id="e-d34R">The <code>Fragment</code> class and what it does, and creating and managing fragments</li>
<li id="e-z4BG">How to use a declarative approach for adding fragments to activities using the <code>&amp;lt;fragment&amp;gt;</code> tag</li>
<li id="e-DekL">Using <code>ListFragment</code> with <code>ListAdapter</code> to populate the data</li>
<li id="e-fs3B">How to add alternative layout resources from Xamarin Studio layout designer</li>
<li id="e-T4A0">How to reuse the fragments to create a multi-pane split view layout for Android tablets</li>
<li id="e-wlbs">How to create a dialog using <code>DialogFragment</code>, and create its view hierarchy using the <code>OnCreateDialog()</code> method</li>
<li id="e-mezQ">Optimizing the <code>POIApp</code> layout to support large-screen Android tablets</li>
<li id="e-PGt6">Dealing with configuration changes to save and retain the fragment state</li>
</ul>
<p id="e-kG0h">The next chapter will guide you to deal with data persistence using SQLite in Android.</p>
<p id="e-ivNe">Let's take a look at the following references:</p>
<ul id="e-mHRP">
<li id="e-iCUH"><a href="http://android-developers.blogspot.in/2012/11/designing-for-tablets-were-here-to-help.html">http://android-developers.blogspot.in/2012/11/designing-for-tablets-were-here-to-help.html</a></li>
<li id="e-nybN"><a href="https://developer.android.com/distribute/essentials/quality/tablets.html">https://developer.android.com/distribute/essentials/quality/tablets.html</a></li>
<li id="e-iNgP"><a href="http://developer.xamarin.com/guides/android/user_interface/designer_overview/part_3_-_alternative_layout_views/">http://developer.xamarin.com/guides/android/user_interface/designer_overview/part_3_-_alternative_layout_views/</a></li>
</ul>
</body></html>