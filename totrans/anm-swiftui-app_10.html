<html><head></head><body>
<div id="_idContainer152">
<h1 class="chapter-number" id="_idParaDest-134"><a id="_idTextAnchor138"/><span class="koboSpan" id="kobo.1.1">10</span></h1>
<h1 id="_idParaDest-135"><a id="_idTextAnchor139"/><span class="koboSpan" id="kobo.2.1">Creating an Ocean Scene</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In this chapter, we will be creating an ocean scene. </span><span class="koboSpan" id="kobo.3.2">To do that, we will be revisiting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.4.1">Shape</span></strong><span class="koboSpan" id="kobo.5.1"> protocol and </span><strong class="source-inline"><span class="koboSpan" id="kobo.6.1">path</span></strong><span class="koboSpan" id="kobo.7.1"> function that we used in the previous project to create the waves, as well as a new SwiftUI property called </span><strong class="source-inline"><span class="koboSpan" id="kobo.8.1">animatableData</span></strong><span class="koboSpan" id="kobo.9.1">, which will help to make our curvy lines animate in a fluid </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">wave-like motion.</span></span></p>
<p><span class="koboSpan" id="kobo.11.1">We will also add an image of a buoy to our scene and animate it in multiple different ways, including moving it along an anchor point, rotating it around the center of this point, and making it rise up and down along the </span><em class="italic"><span class="koboSpan" id="kobo.12.1">y</span></em><span class="koboSpan" id="kobo.13.1">-axis – so the buoy looks like it’s bobbing in </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">the water.</span></span></p>
<p><span class="koboSpan" id="kobo.15.1">Finally, we will add some sound effects to the project to help it really </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">come alive.</span></span></p>
<p><span class="koboSpan" id="kobo.17.1">In this chapter, we will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.19.1">Adding the wave’s </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">offset property</span></span></li>
<li><span class="koboSpan" id="kobo.21.1">Creating a wave shape using the Shape protocol and </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">Path function</span></span></li>
<li><span class="koboSpan" id="kobo.23.1">Adding the wave’s </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.24.1">animatableData</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.25.1"> property</span></span></li>
<li><span class="koboSpan" id="kobo.26.1">Setting up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.27.1">ContentView</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.28.1">for animation</span></span></li>
<li><span class="koboSpan" id="kobo.29.1">Duplicating and animating the wave shape in </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">the </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.31.1">ContentView</span></strong></span></li>
<li><span class="koboSpan" id="kobo.32.1">Adding an animated floating buoy to the </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1">ocean scene</span></span></li>
<li><span class="koboSpan" id="kobo.34.1">Adding </span><span class="No-Break"><span class="koboSpan" id="kobo.35.1">sound effects</span></span></li>
</ul>
<h1 id="_idParaDest-136"><a id="_idTextAnchor140"/><span class="koboSpan" id="kobo.36.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.37.1">You can download the resources and finished project from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.38.1">Chapter 10</span></strong></span><span class="koboSpan" id="kobo.39.1"> folder on </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">GitHub: </span></span><a href="https://github.com/PacktPublishing/Animating-SwiftUI-Applications"><span class="No-Break"><span class="koboSpan" id="kobo.41.1">https://github.com/PacktPublishing/Animating-SwiftUI-Applications</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.42.1">.</span></span></p>
<h1 id="_idParaDest-137"><a id="_idTextAnchor141"/><span class="koboSpan" id="kobo.43.1">Adding the wave’s offset property</span></h1>
<p><span class="koboSpan" id="kobo.44.1">Okay, let’s start by creating</span><a id="_idIndexMarker550"/><span class="koboSpan" id="kobo.45.1"> a new SwiftUI project – I’ll be calling it </span><strong class="source-inline"><span class="koboSpan" id="kobo.46.1">Making Waves</span></strong><span class="koboSpan" id="kobo.47.1">. </span></p>
<p><span class="koboSpan" id="kobo.48.1">Then, let’s add a new file that will be in charge of making the waves for the ocean. </span><span class="koboSpan" id="kobo.48.2">Press </span><em class="italic"><span class="koboSpan" id="kobo.49.1">Command</span></em><span class="koboSpan" id="kobo.50.1"> + </span><em class="italic"><span class="koboSpan" id="kobo.51.1">N</span></em><span class="koboSpan" id="kobo.52.1"> to create a new file, then select the </span><strong class="bold"><span class="koboSpan" id="kobo.53.1">SwiftUIView</span></strong><span class="koboSpan" id="kobo.54.1"> file, and call it </span><strong class="source-inline"><span class="koboSpan" id="kobo.55.1">WaveView</span></strong><span class="koboSpan" id="kobo.56.1">. </span></p>
<p><span class="koboSpan" id="kobo.57.1">Inside this new file, we will make</span><a id="_idIndexMarker551"/><span class="koboSpan" id="kobo.58.1"> some minor modifications to the structure so that it conforms to the Shape protocol, as we did in the previous project. </span><span class="koboSpan" id="kobo.58.2">So, at the top of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.59.1">WaveView</span></strong><span class="koboSpan" id="kobo.60.1"> struct, right after its name, remove the </span><strong class="source-inline"><span class="koboSpan" id="kobo.61.1">View</span></strong><span class="koboSpan" id="kobo.62.1"> protocol and replace it with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.63.1">Shape</span></strong><span class="koboSpan" id="kobo.64.1"> protocol. </span><span class="koboSpan" id="kobo.64.2">Also, remove the </span><strong class="source-inline"><span class="koboSpan" id="kobo.65.1">body</span></strong><span class="koboSpan" id="kobo.66.1"> property as we don’t need that here. </span><span class="koboSpan" id="kobo.66.2">The file should look </span><span class="No-Break"><span class="koboSpan" id="kobo.67.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.68.1">
struct WaveView: Shape {
}</span></pre>
<p><span class="koboSpan" id="kobo.69.1">The reason why we removed the </span><strong class="source-inline"><span class="koboSpan" id="kobo.70.1">body</span></strong><span class="koboSpan" id="kobo.71.1"> property was that it was used to return a view; however, we will be returning a </span><strong class="source-inline"><span class="koboSpan" id="kobo.72.1">path</span></strong><span class="koboSpan" id="kobo.73.1"> variable that will hold the shape of the wave we want </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">to animate.</span></span></p>
<p><span class="koboSpan" id="kobo.75.1">The animation we want to create will be a wavy line that moves up and down in a wave-like motion, on the </span><em class="italic"><span class="koboSpan" id="kobo.76.1">y</span></em><span class="koboSpan" id="kobo.77.1"> axis. </span><span class="koboSpan" id="kobo.77.2">We will need a variable to control this animation movement, so let’s add a variable inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.78.1">WaveView</span></strong><span class="koboSpan" id="kobo.79.1"> struct to </span><span class="No-Break"><span class="koboSpan" id="kobo.80.1">handle this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.81.1">
var yOffset: CGFloat = 0.0</span></pre>
<p><span class="koboSpan" id="kobo.82.1">It’s called </span><strong class="source-inline"><span class="koboSpan" id="kobo.83.1">yOffset</span></strong><span class="koboSpan" id="kobo.84.1"> because that’s what the variable will do: it will offset the line only on the </span><em class="italic"><span class="koboSpan" id="kobo.85.1">y</span></em><span class="koboSpan" id="kobo.86.1"> axis. </span><span class="koboSpan" id="kobo.86.2">It gets an initial value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.87.1">0.0</span></strong><span class="koboSpan" id="kobo.88.1">. </span><span class="koboSpan" id="kobo.88.2">Its type is set </span><span class="No-Break"><span class="koboSpan" id="kobo.89.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.90.1">CGFloat</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.92.1">We will need another special built-in Swift variable that will dynamically change the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.93.1">yOffset</span></strong><span class="koboSpan" id="kobo.94.1"> variable and make things animate, called </span><strong class="source-inline"><span class="koboSpan" id="kobo.95.1">animatableData</span></strong><span class="koboSpan" id="kobo.96.1">, but let’s first create the wave shape itself before </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">adding that.</span></span></p>
<h1 id="_idParaDest-138"><a id="_idTextAnchor142"/><span class="koboSpan" id="kobo.98.1">Creating a wave shape using the Shape protocol and  Path function</span></h1>
<p><span class="koboSpan" id="kobo.99.1">For the wave shape, it’s easy – we</span><a id="_idIndexMarker552"/><span class="koboSpan" id="kobo.100.1"> just need to make three straight lines and one curved line and join them together. </span><span class="koboSpan" id="kobo.100.2">Think of it as a rectangle, with the top line of the rectangle being the curvy wave part (skip to </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.101.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.102.1">.4</span></em><span class="koboSpan" id="kobo.103.1"> to see what </span><span class="No-Break"><span class="koboSpan" id="kobo.104.1">I mean).</span></span></p>
<p><span class="koboSpan" id="kobo.105.1">Before we start adding the wave code, let’s first modify the </span><strong class="source-inline"><span class="koboSpan" id="kobo.106.1">Previews</span></strong><span class="koboSpan" id="kobo.107.1"> struct so that we can see the results of each line of code we add. </span><span class="koboSpan" id="kobo.107.2">Modify the code so it looks like </span><span class="No-Break"><span class="koboSpan" id="kobo.108.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.109.1">
struct WaveView_Previews: PreviewProvider {
    static var previews: some View {
        Group {
        WaveView(yOffset: 0.7)
            .stroke(Color.blue, lineWidth: 3)
            .frame(height: 250)
        .padding()
            .previewDisplayName("Wave")
            
        }
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.110.1">We start off by giving the </span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">yOffset</span></strong><span class="koboSpan" id="kobo.112.1"> parameter in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.113.1">Previews</span></strong><span class="koboSpan" id="kobo.114.1"> struct a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.115.1">0.7</span></strong><span class="koboSpan" id="kobo.116.1">. </span><span class="koboSpan" id="kobo.116.2">This is a simple hardcoded value that allows us to display our wave shape in the previews on the right in Xcode. </span><strong class="source-inline"><span class="koboSpan" id="kobo.117.1">yOffset</span></strong><span class="koboSpan" id="kobo.118.1"> works by offsetting two control points in the Bezier curve – one control point will be offset in the up direction for the curvy line and the other control point will be offset in the down direction on the curvy line. </span><span class="koboSpan" id="kobo.118.2">The next line of code adds a stroke to the wave shape, so we can see it in the preview, and gives the wave a height of </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.119.1">250</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.120.1"> points.</span></span></p>
<p><span class="koboSpan" id="kobo.121.1">Now, with these changes in the previews, any code we add to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.122.1">WaveView</span></strong><span class="koboSpan" id="kobo.123.1"> struct will immediately be visible in the </span><a id="_idIndexMarker553"/><span class="koboSpan" id="kobo.124.1">previews. </span><span class="koboSpan" id="kobo.124.2">Let’s add the wave shape code now, small pieces of code at a time, so we can better understand how the wave shape </span><span class="No-Break"><span class="koboSpan" id="kobo.125.1">is formed:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.126.1">
func path(in rect: CGRect) -&gt; Path {
        var path = Path()
        path.move(to: .zero)
        path.addLine(to: CGPoint(x: rect.minX, 
          y: rect.maxY))
        return path
    }</span></pre>
<p><span class="koboSpan" id="kobo.127.1">The first thing we do is create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">path</span></strong><span class="koboSpan" id="kobo.129.1"> instance; this is the variable that we’re going to load up with all the lines that make the wave shape. </span></p>
<p><span class="koboSpan" id="kobo.130.1">The next line calls the </span><strong class="source-inline"><span class="koboSpan" id="kobo.131.1">move_to</span></strong><span class="koboSpan" id="kobo.132.1"> method. </span><span class="koboSpan" id="kobo.132.2">This is the method that starts the drawing of the shape you’re making; in this project, that’s the wave shape. </span><span class="koboSpan" id="kobo.132.3">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.133.1">to</span></strong><span class="koboSpan" id="kobo.134.1"> parameter is asking where on the screen you want to add the first point. </span><span class="koboSpan" id="kobo.134.2">For that parameter, we pass in the value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.135.1">.zero</span></strong><span class="koboSpan" id="kobo.136.1">, which is another way of setting the </span><em class="italic"><span class="koboSpan" id="kobo.137.1">x</span></em><span class="koboSpan" id="kobo.138.1">- and </span><em class="italic"><span class="koboSpan" id="kobo.139.1">y</span></em><span class="koboSpan" id="kobo.140.1">-axis values to 0. </span><span class="koboSpan" id="kobo.140.2">(We could simply write out the values as </span><strong class="source-inline"><span class="koboSpan" id="kobo.141.1">X:</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.142.1">0</span></strong><span class="koboSpan" id="kobo.143.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.144.1">Y:</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.145.1">0</span></strong><span class="koboSpan" id="kobo.146.1">, but using </span><strong class="source-inline"><span class="koboSpan" id="kobo.147.1">.zero</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.148.1">is easier.)</span></span></p>
<p><span class="koboSpan" id="kobo.149.1">The next line of code calls the </span><strong class="source-inline"><span class="koboSpan" id="kobo.150.1">addLine</span></strong><span class="koboSpan" id="kobo.151.1"> function, which simply draws a straight line. </span><span class="koboSpan" id="kobo.151.2">Its parameters need an X and Y value to know where to put the next point to draw the line. </span><span class="koboSpan" id="kobo.151.3">For those X and Y values, we pass in two helper functions called </span><strong class="source-inline"><span class="koboSpan" id="kobo.152.1">minX</span></strong><span class="koboSpan" id="kobo.153.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.154.1">maxY</span></strong><span class="koboSpan" id="kobo.155.1">, which automatically get different points of the screen </span><span class="No-Break"><span class="koboSpan" id="kobo.156.1">for us.</span></span></p>
<p><span class="koboSpan" id="kobo.157.1">The iPhone uses the X and Y coordinate system – X runs from left to right, and Y runs from top to bottom. </span><span class="koboSpan" id="kobo.157.2">The top-left corner of the iPhone screen would have the X and Y values of 0, 0. </span><span class="koboSpan" id="kobo.157.3">As you move to the right of the screen, the X value increases, and as you move down the screen, the Y value increases. </span><span class="koboSpan" id="kobo.157.4">So, by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.158.1">minX</span></strong><span class="koboSpan" id="kobo.159.1"> function in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.160.1">addLine</span></strong><span class="koboSpan" id="kobo.161.1"> parameter, it will place a point at the far left of the screen (the minimum location on the X-coordinate plane). </span><span class="koboSpan" id="kobo.161.2">We could hardcode a value instead, such as 50 or 100, but by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">minX</span></strong><span class="koboSpan" id="kobo.163.1"> function, it tells Xcode to place the point over to the far left of the screen. </span><span class="koboSpan" id="kobo.163.2">Though this may seem vague, it is helpful when considering that Apple devices have different screen sizes. </span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.164.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.165.1">The following are the Swift helper functions available for use to place points on the screen without hardcoding them: </span><strong class="source-inline"><span class="koboSpan" id="kobo.166.1">minX</span></strong><span class="koboSpan" id="kobo.167.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.168.1">midX</span></strong><span class="koboSpan" id="kobo.169.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.170.1">maxX</span></strong><span class="koboSpan" id="kobo.171.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.172.1">minY</span></strong><span class="koboSpan" id="kobo.173.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.174.1">midY</span></strong><span class="koboSpan" id="kobo.175.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.176.1">maxY</span></strong><span class="koboSpan" id="kobo.177.1">. </span><span class="koboSpan" id="kobo.177.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.178.1">midX</span></strong><span class="koboSpan" id="kobo.179.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.180.1">midY</span></strong><span class="koboSpan" id="kobo.181.1"> functions, as you might imagine, add a point to the middle area of the screen, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.182.1">maxX</span></strong><span class="koboSpan" id="kobo.183.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.184.1">maxY</span></strong><span class="koboSpan" id="kobo.185.1">, when used together, add a point to the bottom-right area of </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">the screen.</span></span></p>
<p><span class="koboSpan" id="kobo.187.1">Now, the result of that </span><a id="_idIndexMarker554"/><span class="koboSpan" id="kobo.188.1">code is visible in the </span><strong class="bold"><span class="koboSpan" id="kobo.189.1">Previews</span></strong><span class="koboSpan" id="kobo.190.1"> window, showing a vertical </span><span class="No-Break"><span class="koboSpan" id="kobo.191.1">straight line:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer140">
<span class="koboSpan" id="kobo.192.1"><img alt="Figure 10.1: The first line " src="image/B18674_10_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.193.1">Figure 10.1: The first line</span></p>
<p><span class="koboSpan" id="kobo.194.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.195.1">move_to</span></strong><span class="koboSpan" id="kobo.196.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">addLine</span></strong><span class="koboSpan" id="kobo.198.1"> functions have drawn a line down from the middle-left area of the screen to the bottom-left area of the screen. </span><span class="koboSpan" id="kobo.198.2">The length of the line is set by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.199.1">frame</span></strong><span class="koboSpan" id="kobo.200.1"> modifier we used in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.201.1">Previews</span></strong><span class="koboSpan" id="kobo.202.1"> struct. </span><span class="koboSpan" id="kobo.202.2">By adding a bigger value in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.203.1">frame</span></strong><span class="koboSpan" id="kobo.204.1"> modifier’s parameter, you make the line bigger. </span></p>
<p><span class="koboSpan" id="kobo.205.1">Now, with the first line of the wave shape done, let’s draw the second line – this will be a horizontal line that </span><a id="_idIndexMarker555"/><span class="koboSpan" id="kobo.206.1">starts from the bottom of the first line and stretches to the right, across the screen. </span><span class="koboSpan" id="kobo.206.2">We can do this by adding the highlighted line to our </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">existing code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.208.1">
func path(in rect: CGRect) -&gt; Path {
        var path = Path()
        path.move(to: .zero)
        path.addLine(to: CGPoint(x: rect.minX,
          y: rect.maxY))
        </span><strong class="bold"><span class="koboSpan" id="kobo.209.1">path.addLine(to: CGPoint(x: rect.maxX,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.210.1">          y: rect.maxY))</span></strong><span class="koboSpan" id="kobo.211.1">
        return path
    }</span></pre>
<p><span class="koboSpan" id="kobo.212.1">This line of code calls the </span><strong class="source-inline"><span class="koboSpan" id="kobo.213.1">addLine</span></strong><span class="koboSpan" id="kobo.214.1"> function again, adding a point to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.215.1">maxX</span></strong><span class="koboSpan" id="kobo.216.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.217.1">maxY</span></strong><span class="koboSpan" id="kobo.218.1"> locations. </span><span class="koboSpan" id="kobo.218.2">The result should now look </span><span class="No-Break"><span class="koboSpan" id="kobo.219.1">like this:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer141">
<span class="koboSpan" id="kobo.220.1"><img alt="Figure 10.2: The second line " src="image/B18674_10_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.221.1">Figure 10.2: The second line</span></p>
<p><span class="koboSpan" id="kobo.222.1">With two lines and half of the wave shape done, let’s now add the third line, which is the last straight one. </span><span class="koboSpan" id="kobo.222.2">Add</span><a id="_idIndexMarker556"/><span class="koboSpan" id="kobo.223.1"> the following highlighted line to your </span><span class="No-Break"><span class="koboSpan" id="kobo.224.1">existing code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.225.1">
func path(in rect: CGRect) -&gt; Path {
        var path = Path()
        path.move(to: .zero)
        path.addLine(to: CGPoint(x: rect.minX,
          y: rect.maxY))
        path.addLine(to: CGPoint(x: rect.maxX,
          y: rect.maxY))
        </span><strong class="bold"><span class="koboSpan" id="kobo.226.1">path.addLine(to: CGPoint(x: rect.maxX,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.227.1">          y: rect.minY))</span></strong><span class="koboSpan" id="kobo.228.1">
        return path
    }</span></pre>
<p><span class="koboSpan" id="kobo.229.1">This line of code adds</span><a id="_idIndexMarker557"/><span class="koboSpan" id="kobo.230.1"> a point to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.231.1">maxX</span></strong><span class="koboSpan" id="kobo.232.1"> (far-right) and </span><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">minY</span></strong><span class="koboSpan" id="kobo.234.1"> (top-left) parts of the screen, so the result will look </span><span class="No-Break"><span class="koboSpan" id="kobo.235.1">like this:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer142">
<span class="koboSpan" id="kobo.236.1"><img alt="Figure 10.3: The third line " src="image/B18674_10_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.237.1">Figure 10.3: The third line</span></p>
<p><span class="koboSpan" id="kobo.238.1">Now that we have three straight lines, we just need to add the wavy line to the top to complete the wave shape. </span><span class="koboSpan" id="kobo.238.2">Let’s add </span><span class="No-Break"><span class="koboSpan" id="kobo.239.1">that now:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.240.1">
func path(in rect: CGRect) -&gt; Path {
        var path = Path()
        path.move(to: .zero)
        path.addLine(to: CGPoint(x: rect.minX,
          y: rect.maxY))
        path.addLine(to: CGPoint(x: rect.maxX,
          y: rect.maxY))
        path.addLine(to: CGPoint(x: rect.maxX,
          y: rect.minY))
</span><strong class="bold"><span class="koboSpan" id="kobo.241.1">        path.addCurve(to: CGPoint(x: rect.minX,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.242.1">          y: rect.minY),</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.243.1">        control1: CGPoint(x: rect.maxX * 0.45, </span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.244.1">          y: rect.minY - (rect.maxY * yOffset)),</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.245.1">        control2: CGPoint(x: rect.maxX * 0.45,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.246.1">          y: (rect.maxY * yOffset)))</span></strong><span class="koboSpan" id="kobo.247.1">
        return path
    }</span></pre>
<p><span class="koboSpan" id="kobo.248.1">Here, we have</span><a id="_idIndexMarker558"/><span class="koboSpan" id="kobo.249.1"> used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.250.1">addCurve</span></strong><span class="koboSpan" id="kobo.251.1"> function to create the Bezier curve. </span><span class="koboSpan" id="kobo.251.2">This has </span><span class="No-Break"><span class="koboSpan" id="kobo.252.1">three parameters.</span></span></p>
<p><span class="koboSpan" id="kobo.253.1">The first parameter, </span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">to</span></strong><span class="koboSpan" id="kobo.255.1">, is for adding a point to the screen for drawing the curvy line. </span><span class="koboSpan" id="kobo.255.2">The previous line of code drew a line that ended at the top-right side of the rectangle, so from there, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">addCurve</span></strong><span class="koboSpan" id="kobo.257.1"> function will draw to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">minX</span></strong><span class="koboSpan" id="kobo.259.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.260.1">minY</span></strong><span class="koboSpan" id="kobo.261.1"> location, which is the top left of the rectangle, effectively closing off </span><span class="No-Break"><span class="koboSpan" id="kobo.262.1">the shape.</span></span></p>
<p><span class="koboSpan" id="kobo.263.1">The next two parameters are what are called </span><strong class="bold"><span class="koboSpan" id="kobo.264.1">control points</span></strong><span class="koboSpan" id="kobo.265.1">, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.266.1">control1</span></strong><span class="koboSpan" id="kobo.267.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.268.1">control2</span></strong><span class="koboSpan" id="kobo.269.1"> points, specifically. </span><span class="koboSpan" id="kobo.269.2">These parameters are here to accept values that will adjust the amount of curve in a line that pertains to the </span><em class="italic"><span class="koboSpan" id="kobo.270.1">y</span></em><span class="koboSpan" id="kobo.271.1"> axis – </span><strong class="source-inline"><span class="koboSpan" id="kobo.272.1">control1</span></strong><span class="koboSpan" id="kobo.273.1"> will adjust the right portion of the line and </span><strong class="source-inline"><span class="koboSpan" id="kobo.274.1">control2</span></strong><span class="koboSpan" id="kobo.275.1"> will adjust the left portion of </span><span class="No-Break"><span class="koboSpan" id="kobo.276.1">the line.</span></span></p>
<p><span class="koboSpan" id="kobo.277.1">To understand how these control points work, if we pass in a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.278.1">0</span></strong><span class="koboSpan" id="kobo.279.1"> to both parameters, then the line created will be straight, not a curvy one; that’s because a value of 0 does not alter those points up or down, thus the line remains straight. </span><span class="koboSpan" id="kobo.279.2">But by passing in floating-point values, the control points start to bend the line on the right and left sides by the given amount. </span><span class="koboSpan" id="kobo.279.3">The control points do not act on the right and left ends of the line; those are </span><a id="_idIndexMarker559"/><span class="koboSpan" id="kobo.280.1">the connection points that close the wave shape. </span><span class="koboSpan" id="kobo.280.2">Instead, the control points are equally spaced and offset from </span><span class="No-Break"><span class="koboSpan" id="kobo.281.1">the ends.</span></span></p>
<p><span class="koboSpan" id="kobo.282.1">Looking at the values being used for the control points now, they have been computed to create a line that has a bend going upward on the right side and a bend going downward on the left side. </span><span class="koboSpan" id="kobo.282.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.283.1">x</span></strong><span class="koboSpan" id="kobo.284.1"> values for </span><strong class="source-inline"><span class="koboSpan" id="kobo.285.1">control1</span></strong><span class="koboSpan" id="kobo.286.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.287.1">control2</span></strong><span class="koboSpan" id="kobo.288.1"> get their results by multiplying the </span><strong class="source-inline"><span class="koboSpan" id="kobo.289.1">maxX</span></strong><span class="koboSpan" id="kobo.290.1"> value by 0.45 (this is a hardcoded value and helps shape the bend in the line on the </span><em class="italic"><span class="koboSpan" id="kobo.291.1">x</span></em><span class="koboSpan" id="kobo.292.1"> axis). </span></p>
<p><span class="koboSpan" id="kobo.293.1">On the other hand, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.294.1">y</span></strong><span class="koboSpan" id="kobo.295.1"> values for </span><strong class="source-inline"><span class="koboSpan" id="kobo.296.1">control1</span></strong><span class="koboSpan" id="kobo.297.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.298.1">control2</span></strong><span class="koboSpan" id="kobo.299.1"> are computed a little differently. </span><strong class="source-inline"><span class="koboSpan" id="kobo.300.1">control1</span></strong><span class="koboSpan" id="kobo.301.1"> gets its value by subtracting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.302.1">minY</span></strong><span class="koboSpan" id="kobo.303.1"> value by the result of multiplying </span><strong class="source-inline"><span class="koboSpan" id="kobo.304.1">maxX</span></strong><span class="koboSpan" id="kobo.305.1"> by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.306.1">yOffset</span></strong><span class="koboSpan" id="kobo.307.1"> variable. </span><strong class="source-inline"><span class="koboSpan" id="kobo.308.1">control2</span></strong><span class="koboSpan" id="kobo.309.1"> gets its value by multiplying the </span><strong class="source-inline"><span class="koboSpan" id="kobo.310.1">maxY</span></strong><span class="koboSpan" id="kobo.311.1"> value by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.312.1">yOffset</span></strong><span class="koboSpan" id="kobo.313.1"> value. </span></p>
<p><span class="koboSpan" id="kobo.314.1">These computations may be a bit unclear at first, but when you complete the project and experiment with different parameter values, you will see how the math works to make the bend in the line move; the amount of movement is related directly to how big or small a value the </span><strong class="source-inline"><span class="koboSpan" id="kobo.315.1">yOffset</span></strong><span class="koboSpan" id="kobo.316.1"> variable has. </span></p>
<p><span class="koboSpan" id="kobo.317.1">Let’s now have a look at the result of adding the </span><span class="No-Break"><span class="koboSpan" id="kobo.318.1">control points:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer143">
<span class="koboSpan" id="kobo.319.1"><img alt="Figure 10.4: The completed wave shape " src="image/B18674_10_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.320.1">Figure 10.4: The completed wave shape</span></p>
<p><span class="koboSpan" id="kobo.321.1">Now, with all four lines completed, we have created the wave shape. </span><span class="koboSpan" id="kobo.321.2">Up next, we will make the shape come</span><a id="_idIndexMarker560"/><span class="koboSpan" id="kobo.322.1"> alive using a special Swift property </span><span class="No-Break"><span class="koboSpan" id="kobo.323.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.324.1">animatableData</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.325.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.326.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.327.1">When working with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.328.1">path_in</span></strong><span class="koboSpan" id="kobo.329.1"> function, as we are doing here, there is also another function that is used to close off the shape we are drawing out: </span><strong class="source-inline"><span class="koboSpan" id="kobo.330.1">closeSubpath()</span></strong><span class="koboSpan" id="kobo.331.1">. </span><span class="koboSpan" id="kobo.331.2">This is helpful when closing the ends of a shape without needing to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.332.1">addLine()</span></strong><span class="koboSpan" id="kobo.333.1"> function and passing in X and Y points. </span><span class="koboSpan" id="kobo.333.2">We didn’t need to use it here because we drew the wave shape out and ended with the curvy line on top. </span><span class="koboSpan" id="kobo.333.3">If I drew the curvy line first and wanted to end with a straight line, then I could have used this function to save some code. </span></p>
<h1 id="_idParaDest-139"><a id="_idTextAnchor143"/><span class="koboSpan" id="kobo.334.1">Adding the wave’s animatableData property</span></h1>
<p><span class="koboSpan" id="kobo.335.1">We now have a wave shape that </span><a id="_idIndexMarker561"/><span class="koboSpan" id="kobo.336.1">we can duplicate as many times as needed to create a layered ocean scene. </span><span class="koboSpan" id="kobo.336.2">However, those waves are still static, meaning they won’t do anything unless we have a way of changing the value</span><a id="_idIndexMarker562"/><span class="koboSpan" id="kobo.337.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.338.1">yOffset</span></strong><span class="koboSpan" id="kobo.339.1"> variable. </span><span class="koboSpan" id="kobo.339.2">To accomplish that, we need to add one more important variable to the file here: </span><strong class="source-inline"><span class="koboSpan" id="kobo.340.1">animatableData</span></strong><span class="koboSpan" id="kobo.341.1">. </span></p>
<p><span class="koboSpan" id="kobo.342.1">So, let’s add it right under the declaration of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">yOffset</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.344.1"> variable:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.345.1">
var animatableData: CGFloat {
        get {
            return yOffset
        }
        set {
            yOffset = newValue
        }
    }</span></pre>
<p><span class="koboSpan" id="kobo.346.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.347.1">animatableData</span></strong><span class="koboSpan" id="kobo.348.1"> property is an instance of a Swift class called </span><strong class="source-inline"><span class="koboSpan" id="kobo.349.1">Animatable</span></strong><span class="koboSpan" id="kobo.350.1">, and is a built-in Swift property that has a getter and a setter attached to it. </span><span class="koboSpan" id="kobo.350.2">Properties with getters and setters do just that: they get a value and set a value. </span></p>
<p><span class="koboSpan" id="kobo.351.1">Using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.352.1">animatableData</span></strong><span class="koboSpan" id="kobo.353.1"> property provides a few benefits over animating with a simple </span><strong class="source-inline"><span class="koboSpan" id="kobo.354.1">@State</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.355.1">property alone:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.356.1">It allows you to declaratively specify that a view can be animated, making it clear to other developers (and to the framework) that the view is intended to </span><span class="No-Break"><span class="koboSpan" id="kobo.357.1">be animated</span></span></li>
<li><span class="koboSpan" id="kobo.358.1">It allows the framework to automatically interpolate between the old and new values, rather than requiring you to manually calculate the </span><span class="No-Break"><span class="koboSpan" id="kobo.359.1">intermediate values</span></span></li>
<li><span class="koboSpan" id="kobo.360.1">It allows you to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.361.1">animation()</span></strong><span class="koboSpan" id="kobo.362.1"> method to specify how the animation should be performed, such as the duration, curve, </span><span class="No-Break"><span class="koboSpan" id="kobo.363.1">and delay</span></span></li>
<li><span class="koboSpan" id="kobo.364.1">It allows you to use more advanced animation techniques, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.365.1">animation(_:)</span></strong><span class="koboSpan" id="kobo.366.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.367.1">transition(_:)</span></strong><span class="koboSpan" id="kobo.368.1">, to specify the animation between different states of </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">the view</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.370.1">In our project, we’re using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.371.1">animatableData</span></strong><span class="koboSpan" id="kobo.372.1"> property to get and set the values of the wave’s control </span><a id="_idIndexMarker563"/><span class="koboSpan" id="kobo.373.1">points. </span><span class="koboSpan" id="kobo.373.2">This getting and setting is happening constantly and thus making the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.374.1">yOffset</span></strong><span class="koboSpan" id="kobo.375.1"> variable change constantly too. </span><span class="koboSpan" id="kobo.375.2">Since the </span><strong class="source-inline"><span class="koboSpan" id="kobo.376.1">yOffset</span></strong><span class="koboSpan" id="kobo.377.1"> variable is being used to create the curvy line</span><a id="_idIndexMarker564"/><span class="koboSpan" id="kobo.378.1"> inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.379.1">path_in()</span></strong><span class="koboSpan" id="kobo.380.1"> function, the result will be that the curvy line dynamically changes too. </span></p>
<p><span class="koboSpan" id="kobo.381.1">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.382.1">animatableData</span></strong><span class="koboSpan" id="kobo.383.1"> property in place, and the wave shape completed, we can proceed to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.384.1">ContentView</span></strong><span class="koboSpan" id="kobo.385.1">, where we will add the animation to </span><span class="No-Break"><span class="koboSpan" id="kobo.386.1">the shape.</span></span></p>
<h1 id="_idParaDest-140"><a id="_idTextAnchor144"/><span class="koboSpan" id="kobo.387.1">Setting up the ContentView for animation</span></h1>
<p><span class="koboSpan" id="kobo.388.1">Here, in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.389.1">ContentView</span></strong><span class="koboSpan" id="kobo.390.1">, we are</span><a id="_idIndexMarker565"/><span class="koboSpan" id="kobo.391.1"> ready to use the wave shape and add the animation to it. </span><span class="koboSpan" id="kobo.391.2">Let’s start by creating a new struct at the bottom of the file, just above the </span><strong class="source-inline"><span class="koboSpan" id="kobo.392.1">Previews</span></strong><span class="koboSpan" id="kobo.393.1"> struct, and call </span><span class="No-Break"><span class="koboSpan" id="kobo.394.1">it </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.395.1">WaveCreation</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.396.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.397.1">
struct WaveCreation: View {
    var body: some View { 
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.398.1">This struct is very similar to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.399.1">ContentView</span></strong><span class="koboSpan" id="kobo.400.1"> struct – it conforms to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.401.1">View</span></strong><span class="koboSpan" id="kobo.402.1"> protocol, which means it must implement the </span><strong class="source-inline"><span class="koboSpan" id="kobo.403.1">body</span></strong><span class="koboSpan" id="kobo.404.1"> property. </span><span class="koboSpan" id="kobo.404.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.405.1">body</span></strong><span class="koboSpan" id="kobo.406.1"> property itself will return a view, and that will be the animated wave. </span><span class="koboSpan" id="kobo.406.2">By the end of the next section, we will have created six waves in total, spaced out neatly inside of </span><span class="No-Break"><span class="koboSpan" id="kobo.407.1">a stack.</span></span></p>
<p><span class="koboSpan" id="kobo.408.1">We will need several variables to get this working, some for the animation and some that allow us to alter the size of the wave curve. </span><span class="koboSpan" id="kobo.408.2">Add the following code above the </span><strong class="source-inline"><span class="koboSpan" id="kobo.409.1">body</span></strong><span class="koboSpan" id="kobo.410.1"> property, inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.411.1">WaveCreation</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.412.1"> struct:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.413.1">
@Binding var animateOffset: Bool
    var curveOne: CGFloat
    var curveTwo: CGFloat
    var radius: CGFloat
    var shadowX: CGFloat
    var shadowY: CGFloat
    var duration: Double</span></pre>
<p><span class="koboSpan" id="kobo.414.1">There are seven </span><span class="No-Break"><span class="koboSpan" id="kobo.415.1">variables here:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.416.1">The first one is a </span><strong class="source-inline"><span class="koboSpan" id="kobo.417.1">Binding</span></strong><span class="koboSpan" id="kobo.418.1"> variable, which we will use in </span><strong class="source-inline"><span class="koboSpan" id="kobo.419.1">ContentView</span></strong><span class="koboSpan" id="kobo.420.1"> to start the animation</span><a id="_idIndexMarker566"/><span class="koboSpan" id="kobo.421.1"> when it is set </span><span class="No-Break"><span class="koboSpan" id="kobo.422.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.423.1">true</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.424.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.425.1">The next two variables are called </span><strong class="source-inline"><span class="koboSpan" id="kobo.426.1">curveOne</span></strong><span class="koboSpan" id="kobo.427.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.428.1">curveTwo</span></strong><span class="koboSpan" id="kobo.429.1">, which will be used to set the size of the wave’s two curves. </span><span class="koboSpan" id="kobo.429.2">Remember the wavy line shape has two curves on it, and they were created using those two control points, one for the left curve of the wavy line and the other for the right curve of the wavy line. </span><span class="koboSpan" id="kobo.429.3">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.430.1">curveOne</span></strong><span class="koboSpan" id="kobo.431.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.432.1">curveTwo</span></strong><span class="koboSpan" id="kobo.433.1"> variables will allow us to alter the size of those curves on that wavy line; a bigger value will give us a bigger curve, and so a </span><span class="No-Break"><span class="koboSpan" id="kobo.434.1">bigger wave.</span></span></li>
<li><span class="koboSpan" id="kobo.435.1">Next is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.436.1">radius</span></strong><span class="koboSpan" id="kobo.437.1"> variable, which allows us to set the radius on a shadow. </span><span class="koboSpan" id="kobo.437.2">I want to give each wave a shadow later and so this variable makes that </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">customization easier.</span></span></li>
<li><span class="koboSpan" id="kobo.439.1">The placement of these shadows is also important; we can control this placement with two </span><a id="_idIndexMarker567"/><span class="koboSpan" id="kobo.440.1">variables, </span><strong class="source-inline"><span class="koboSpan" id="kobo.441.1">shadowX</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.442.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.443.1">shadowY</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.444.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.445.1">Finally, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.446.1">duration</span></strong><span class="koboSpan" id="kobo.447.1"> variable allows us to set the duration of the animation for each wave. </span></li>
</ul>
<p><span class="koboSpan" id="kobo.448.1">With those variables in place, we only need a few lines of code to complete the </span><strong class="source-inline"><span class="koboSpan" id="kobo.449.1">WaveCreation</span></strong><span class="koboSpan" id="kobo.450.1"> struct. </span><span class="koboSpan" id="kobo.450.2">Those lines are </span><span class="No-Break"><span class="koboSpan" id="kobo.451.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.452.1">
var body: some View {
    WaveView(yOffset: animateOffset ? </span><span class="koboSpan" id="kobo.452.2">curveOne : curveTwo)
        </span><strong class="bold"><span class="koboSpan" id="kobo.453.1">.fill(Color(UIColor.blue))</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.454.1">        .shadow(color: .gray, radius: radius, x: shadowX,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.455.1">          y: shadowY)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.456.1">        .animation(Animation.easeInOut(duration:</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.457.1">          duration).repeatForever(autoreverses: true),</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.458.1">          value:animateOffset)</span></strong><span class="koboSpan" id="kobo.459.1">
    }</span></pre>
<p><span class="koboSpan" id="kobo.460.1">The first line of code calls the </span><strong class="source-inline"><span class="koboSpan" id="kobo.461.1">WaveView</span></strong><span class="koboSpan" id="kobo.462.1"> struct, and that requires a value for its </span><strong class="source-inline"><span class="koboSpan" id="kobo.463.1">yOffset</span></strong><span class="koboSpan" id="kobo.464.1"> parameter. </span><span class="koboSpan" id="kobo.464.2">We’re passing in one of two values: when the </span><strong class="source-inline"><span class="koboSpan" id="kobo.465.1">animateOffset</span></strong><span class="koboSpan" id="kobo.466.1"> variable is </span><strong class="source-inline"><span class="koboSpan" id="kobo.467.1">true</span></strong><span class="koboSpan" id="kobo.468.1">, we’re going to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.469.1">curveOne</span></strong><span class="koboSpan" id="kobo.470.1"> variable, which means that one of the curves on the wavy line will be animated on the </span><em class="italic"><span class="koboSpan" id="kobo.471.1">y</span></em><span class="koboSpan" id="kobo.472.1"> axis. </span><span class="koboSpan" id="kobo.472.2">But when the </span><strong class="source-inline"><span class="koboSpan" id="kobo.473.1">animateOffset</span></strong><span class="koboSpan" id="kobo.474.1"> variable is </span><strong class="source-inline"><span class="koboSpan" id="kobo.475.1">false</span></strong><span class="koboSpan" id="kobo.476.1">, we will then use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.477.1">curveTwo</span></strong><span class="koboSpan" id="kobo.478.1"> variable, which will control the opposite side of the wavy line on the </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.479.1">y</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.480.1"> axis.</span></span></p>
<p><span class="koboSpan" id="kobo.481.1">The next line of code uses the </span><strong class="source-inline"><span class="koboSpan" id="kobo.482.1">shadow</span></strong><span class="koboSpan" id="kobo.483.1"> modifier to add a shadow to the wave. </span><span class="koboSpan" id="kobo.483.2">Looking at the parameters, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.484.1">color</span></strong><span class="koboSpan" id="kobo.485.1"> parameter gets a gray color (which will look good against the blue waves), the </span><strong class="source-inline"><span class="koboSpan" id="kobo.486.1">radius</span></strong><span class="koboSpan" id="kobo.487.1"> parameter sets the size of the shadow, and the X and Y parameters allow us to adjust the shadow up, down, left, </span><span class="No-Break"><span class="koboSpan" id="kobo.488.1">and right.</span></span></p>
<p><span class="koboSpan" id="kobo.489.1">Then, the final line adds the animation – this is an </span><strong class="source-inline"><span class="koboSpan" id="kobo.490.1">easeInOut</span></strong><span class="koboSpan" id="kobo.491.1"> timing curve, which means the animation will start slowly, then build up, and when it finishes, it will ease itself out slowly. </span><span class="koboSpan" id="kobo.491.2">The duration of the animation will be set using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.492.1">duration</span></strong><span class="koboSpan" id="kobo.493.1"> variable, with </span><strong class="source-inline"><span class="koboSpan" id="kobo.494.1">repeatForever</span></strong><span class="koboSpan" id="kobo.495.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.496.1">autoreverses</span></strong><span class="koboSpan" id="kobo.497.1"> set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.498.1">true</span></strong><span class="koboSpan" id="kobo.499.1">. </span><span class="koboSpan" id="kobo.499.2">Then, for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.500.1">value</span></strong><span class="koboSpan" id="kobo.501.1"> parameter, that gets the </span><strong class="source-inline"><span class="koboSpan" id="kobo.502.1">animateOffset</span></strong><span class="koboSpan" id="kobo.503.1"> variable to start </span><span class="No-Break"><span class="koboSpan" id="kobo.504.1">the animation.</span></span></p>
<p><span class="koboSpan" id="kobo.505.1">Now, rather than just </span><a id="_idIndexMarker568"/><span class="koboSpan" id="kobo.506.1">having one wave in our scene, we will call this structure inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.507.1">ContentView</span></strong><span class="koboSpan" id="kobo.508.1"> six times to make </span><span class="No-Break"><span class="koboSpan" id="kobo.509.1">the ocean.</span></span></p>
<h1 id="_idParaDest-141"><a id="_idTextAnchor145"/><span class="koboSpan" id="kobo.510.1">Duplicating and animating the wave shape in the ContentView</span></h1>
<p><span class="koboSpan" id="kobo.511.1">When creating our</span><a id="_idIndexMarker569"/><span class="koboSpan" id="kobo.512.1"> ocean, we’ll stack six waves in our scene and stagger the animation values so that they animate at different times. </span><span class="koboSpan" id="kobo.512.2">Working in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.513.1">ContentView</span></strong><span class="koboSpan" id="kobo.514.1"> file </span><a id="_idIndexMarker570"/><span class="koboSpan" id="kobo.515.1">now, we’ll start by adding a</span><a id="_idIndexMarker571"/><span class="koboSpan" id="kobo.516.1"> variable inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.517.1">ContentView</span></strong><span class="koboSpan" id="kobo.518.1"> struct that </span><a id="_idIndexMarker572"/><span class="koboSpan" id="kobo.519.1">will toggle the </span><a id="_idIndexMarker573"/><span class="No-Break"><span class="koboSpan" id="kobo.520.1">animation on:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.521.1">
@State private var animateOffset = false</span></pre>
<p><span class="koboSpan" id="kobo.522.1">Next, let’s add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.523.1">ZStack</span></strong><span class="koboSpan" id="kobo.524.1"> that will hold all the waves, and inside that, let’s set the background to a blue </span><span class="No-Break"><span class="koboSpan" id="kobo.525.1">sky color:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.526.1">
 ZStack {
            //MARK: - BACKGROUND
            Color.blue
                 .opacity(0.5)
                 .edgesIgnoringSafeArea(.all)
        }</span></pre>
<p><span class="koboSpan" id="kobo.527.1">This code adds a </span><strong class="source-inline"><span class="koboSpan" id="kobo.528.1">blue</span></strong><span class="koboSpan" id="kobo.529.1"> color with an opacity of </span><strong class="source-inline"><span class="koboSpan" id="kobo.530.1">0.5</span></strong><span class="koboSpan" id="kobo.531.1"> (50%) for the background, and then we stretch that background out all the way around the edges of the screen using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.532.1">edgesIgnoreSafeArea</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.533.1"> modifier.</span></span></p>
<p><span class="koboSpan" id="kobo.534.1">We are now ready to add the first wave. </span><span class="koboSpan" id="kobo.534.2">So, add the following code directly underneath the </span><strong class="source-inline"><span class="koboSpan" id="kobo.535.1">edgesIgnoring</span></strong><span class="koboSpan" id="kobo.536.1"> modifier, inside </span><span class="No-Break"><span class="koboSpan" id="kobo.537.1">the </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.538.1">ZStack</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.539.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.540.1">
//MARK: - WAVE 1
    WaveCreation(animateOffset: $animateOffset, curveOne:
      0.05, curveTwo: -0.05, radius: 50, shadowX: 0,
      shadowY: 50, duration: 5.0)
        .opacity(0.8)
        .offset(y: 575)</span></pre>
<p><span class="koboSpan" id="kobo.541.1">Adding the wave is simple because we have done all of the work already – here, we just call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.542.1">WaveCreation</span></strong><span class="koboSpan" id="kobo.543.1"> struct </span><a id="_idIndexMarker574"/><span class="koboSpan" id="kobo.544.1">and fill some values into </span><span class="No-Break"><span class="koboSpan" id="kobo.545.1">its parameters.</span></span></p>
<p><span class="koboSpan" id="kobo.546.1">The first value is for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.547.1">animateOffset</span></strong><span class="koboSpan" id="kobo.548.1"> parameter, a Boolean that will start </span><span class="No-Break"><span class="koboSpan" id="kobo.549.1">the animation.</span></span></p>
<p><span class="koboSpan" id="kobo.550.1">Then, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.551.1">curveOne</span></strong><span class="koboSpan" id="kobo.552.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.553.1">curveTwo</span></strong><span class="koboSpan" id="kobo.554.1"> parameters require a value for both parts of the wavy line we made in </span><strong class="source-inline"><span class="koboSpan" id="kobo.555.1">WaveView</span></strong><span class="koboSpan" id="kobo.556.1">. </span><span class="koboSpan" id="kobo.556.2">When you</span><a id="_idIndexMarker575"/><span class="koboSpan" id="kobo.557.1"> increase the value for one of the curve variables, you increase the height of the wave on one side. </span><span class="koboSpan" id="kobo.557.2">If you increase the size of both curve variables, you increase</span><a id="_idIndexMarker576"/><span class="koboSpan" id="kobo.558.1"> the height for both sides of the wave. </span><span class="koboSpan" id="kobo.558.2">Conversely, if you decrease the value for the curve variables by using </span><a id="_idIndexMarker577"/><span class="koboSpan" id="kobo.559.1">negative numbers, then the wave gets smaller. </span></p>
<p><span class="koboSpan" id="kobo.560.1">I’m using a small value here of </span><strong class="source-inline"><span class="koboSpan" id="kobo.561.1">.05</span></strong><span class="koboSpan" id="kobo.562.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.563.1">-.05</span></strong><span class="koboSpan" id="kobo.564.1">. </span><span class="koboSpan" id="kobo.564.2">That’s because this is the first wave in the scene, and it will be further out to sea, so I want this wave to be a little calmer than the waves that are closer to the shore (and </span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">the user).</span></span></p>
<p><span class="koboSpan" id="kobo.566.1">The next parameter is for the radius of the shadow. </span><span class="koboSpan" id="kobo.566.2">It’s set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.567.1">50</span></strong><span class="koboSpan" id="kobo.568.1">, which means it creates a shadow with a size of 50 points. </span><span class="koboSpan" id="kobo.568.2">The direction of the shadow will be controlled by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.569.1">shadowX</span></strong><span class="koboSpan" id="kobo.570.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.571.1">shadowY</span></strong><span class="koboSpan" id="kobo.572.1"> properties – </span><strong class="source-inline"><span class="koboSpan" id="kobo.573.1">shadowX</span></strong><span class="koboSpan" id="kobo.574.1"> gets a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.575.1">0</span></strong><span class="koboSpan" id="kobo.576.1"> because I don’t want to move the shadow on the </span><em class="italic"><span class="koboSpan" id="kobo.577.1">x</span></em><span class="koboSpan" id="kobo.578.1"> axis left or right, but I do want to adjust it on the </span><em class="italic"><span class="koboSpan" id="kobo.579.1">y</span></em><span class="koboSpan" id="kobo.580.1"> axis, and a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.581.1">50</span></strong><span class="koboSpan" id="kobo.582.1"> points for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.583.1">shadowY</span></strong><span class="koboSpan" id="kobo.584.1"> variable will bring the shadow upward by 50 points. </span></p>
<p><span class="koboSpan" id="kobo.585.1">Then, we have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.586.1">duration</span></strong><span class="koboSpan" id="kobo.587.1"> for the animation. </span><span class="koboSpan" id="kobo.587.2">We're setting it to </span><strong class="source-inline"><span class="koboSpan" id="kobo.588.1">5</span></strong><span class="koboSpan" id="kobo.589.1"> seconds to create the slower, calmer animation that we are aiming for with this first wave. </span></p>
<p><span class="koboSpan" id="kobo.590.1">Finally, We're setting the opacity of this wave to </span><strong class="source-inline"><span class="koboSpan" id="kobo.591.1">.8</span></strong><span class="koboSpan" id="kobo.592.1">, so it’s slightly less opaque than some of the other waves that we will be adding. </span><span class="koboSpan" id="kobo.592.2">Then, we offset this wave using a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.593.1">575</span></strong><span class="koboSpan" id="kobo.594.1"> on the </span><em class="italic"><span class="koboSpan" id="kobo.595.1">y</span></em><span class="koboSpan" id="kobo.596.1"> axis, putting it toward the bottom of </span><span class="No-Break"><span class="koboSpan" id="kobo.597.1">the screen.</span></span></p>
<p><span class="koboSpan" id="kobo.598.1">That completes our first wave. </span><span class="koboSpan" id="kobo.598.2">To see this animation, all we have to do is toggle the </span><strong class="source-inline"><span class="koboSpan" id="kobo.599.1">animateOffset</span></strong><span class="koboSpan" id="kobo.600.1"> variable</span><a id="_idIndexMarker578"/><span class="koboSpan" id="kobo.601.1"> inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.602.1">onAppear</span></strong><span class="koboSpan" id="kobo.603.1"> modifier. </span><span class="koboSpan" id="kobo.603.2">Add this code right at the end of </span><span class="No-Break"><span class="koboSpan" id="kobo.604.1">the </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.605.1">ZStack</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.606.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.607.1">
  .onAppear() {
            animateOffset.toggle()
        }</span></pre>
<p><span class="koboSpan" id="kobo.608.1">With that </span><a id="_idIndexMarker579"/><span class="koboSpan" id="kobo.609.1">code in place, we can</span><a id="_idIndexMarker580"/><span class="koboSpan" id="kobo.610.1"> now run the app</span><a id="_idIndexMarker581"/><span class="koboSpan" id="kobo.611.1"> and see </span><span class="No-Break"><span class="koboSpan" id="kobo.612.1">the result:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer144">
<span class="koboSpan" id="kobo.613.1"><img alt="Figure 10.5: Our first wave " src="image/B18674_10_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.614.1">Figure 10.5: Our first wave</span></p>
<p><span class="koboSpan" id="kobo.615.1">The first wave has a smooth animation flowing back and forth, and we’re ready to build our next wave on top </span><span class="No-Break"><span class="koboSpan" id="kobo.616.1">of it.</span></span></p>
<p><span class="koboSpan" id="kobo.617.1">The code</span><a id="_idIndexMarker582"/><span class="koboSpan" id="kobo.618.1"> for the rest of the </span><a id="_idIndexMarker583"/><span class="koboSpan" id="kobo.619.1">waves is nearly identical except for the specific values that we have set in each </span><a id="_idIndexMarker584"/><span class="koboSpan" id="kobo.620.1">parameter. </span><span class="koboSpan" id="kobo.620.2">Here is the code for the</span><a id="_idIndexMarker585"/><span class="koboSpan" id="kobo.621.1"> next </span><span class="No-Break"><span class="koboSpan" id="kobo.622.1">five waves:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.623.1">
//MARK: - WAVE 2
    WaveCreation(animateOffset: $animateOffset, 
      curveOne: -0.07, curveTwo: 0.07, radius: 100,
      shadowX: 0, shadowY: 10, duration: 4.0)
.offset(y: 610)
//MARK: - WAVE 3
    WaveCreation(animateOffset: $animateOffset, curveOne: 0.1,       curveTwo: -0.1, radius: 30, shadowX: 0, shadowY: 0,       duration: 3.7)
.offset(y: 645)
//MARK: - WAVE 4
    WaveCreation(animateOffset: $animateOffset, 
      curveOne: 0.14, curveTwo: -0.1, radius: 70, 
      shadowX: 0, shadowY: 10, duration: 3.5)
.offset(y: 705)
//MARK: - WAVE 5
    WaveCreation(animateOffset: $animateOffset, 
      curveOne: -0.05, curveTwo: 0.08, radius: 60, 
      shadowX: 0, shadowY: 20, duration: 3.2)
        .opacity(0.8)
.offset(y: 740)
//MARK: - WAVE 6
    WaveCreation(animateOffset: $animateOffset, 
      curveOne: -0.05, curveTwo: 0.08, radius: 60, 
      shadowX: 0, shadowY: 20, duration: 3.4)
.offset(y: 800)</span></pre>
<p><span class="koboSpan" id="kobo.624.1">As you can see, the values here are different from those of the first wave – for example, wave 2 has larger values for the curve variables, and the radius is bigger as well; however, the duration of this </span><a id="_idIndexMarker586"/><span class="koboSpan" id="kobo.625.1">wave is slightly shorter, with a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.626.1">4</span></strong><span class="koboSpan" id="kobo.627.1"> seconds, making the animation a little faster. </span><span class="koboSpan" id="kobo.627.2">Waves 3, 4, 5, and 6 also have</span><a id="_idIndexMarker587"/><span class="koboSpan" id="kobo.628.1"> shorter durations, so we are increasing the speed of the animation for each wave as we move closer to the user’s point </span><span class="No-Break"><span class="koboSpan" id="kobo.629.1">of view.</span></span></p>
<p><span class="koboSpan" id="kobo.630.1">The shadows vary too, adding a </span><a id="_idIndexMarker588"/><span class="koboSpan" id="kobo.631.1">nice white cresting look to the wave and helping to delineate the waves from each other. </span><span class="koboSpan" id="kobo.631.2">I’m using a gray</span><a id="_idIndexMarker589"/><span class="koboSpan" id="kobo.632.1"> color for the shadows as it’s not too pronounced; however, you can try white if you prefer a </span><span class="No-Break"><span class="koboSpan" id="kobo.633.1">brighter-looking wave.</span></span></p>
<p><span class="koboSpan" id="kobo.634.1">Now, go ahead and run the project in the simulator again and check out all the waves animating back and forth in our </span><span class="No-Break"><span class="koboSpan" id="kobo.635.1">ocean scene:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer145">
<span class="koboSpan" id="kobo.636.1"><img alt="Figure 10.6: All six waves together " src="image/B18674_10_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.637.1">Figure 10.6: All six waves together</span></p>
<p><span class="koboSpan" id="kobo.638.1">As with the first </span><a id="_idIndexMarker590"/><span class="koboSpan" id="kobo.639.1">wave, the animation is smooth and rhythmic, and by piling up wave upon wave and offsetting</span><a id="_idIndexMarker591"/><span class="koboSpan" id="kobo.640.1"> each of them a little bit</span><a id="_idIndexMarker592"/><span class="koboSpan" id="kobo.641.1"> downward, we have created an </span><span class="No-Break"><span class="koboSpan" id="kobo.642.1">ocean </span></span><span class="No-Break"><a id="_idIndexMarker593"/></span><span class="No-Break"><span class="koboSpan" id="kobo.643.1">scene.</span></span></p>
<p><span class="koboSpan" id="kobo.644.1">Next, we’re going to continue adding animations to the scene by adding a buoy that will bob up and down in the water, complete with a </span><span class="No-Break"><span class="koboSpan" id="kobo.645.1">blinking light.</span></span></p>
<h1 id="_idParaDest-142"><a id="_idTextAnchor146"/><span class="koboSpan" id="kobo.646.1">Adding an animated floating buoy to the ocean scene</span></h1>
<p><span class="koboSpan" id="kobo.647.1">When adding the buoy</span><a id="_idIndexMarker594"/><span class="koboSpan" id="kobo.648.1"> to our ocean scene, we will be giving it four different animations. </span><span class="koboSpan" id="kobo.648.2">It will do </span><span class="No-Break"><span class="koboSpan" id="kobo.649.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.650.1">Have a blinking light at the top </span><span class="No-Break"><span class="koboSpan" id="kobo.651.1">of it</span></span></li>
<li><span class="koboSpan" id="kobo.652.1">Tilt forward </span><span class="No-Break"><span class="koboSpan" id="kobo.653.1">and backward</span></span></li>
<li><span class="koboSpan" id="kobo.654.1">Move up </span><span class="No-Break"><span class="koboSpan" id="kobo.655.1">and down</span></span></li>
<li><span class="koboSpan" id="kobo.656.1">Rotate along its </span><span class="No-Break"><span class="koboSpan" id="kobo.657.1">leading anchor</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.658.1">All of these animations will combine to create a realistic-looking bobbing effect that simulates a floating object in an ocean reacting to the waves </span><span class="No-Break"><span class="koboSpan" id="kobo.659.1">and current.</span></span></p>
<p><span class="koboSpan" id="kobo.660.1">First, download the </span><strong class="source-inline"><span class="koboSpan" id="kobo.661.1">buoy</span></strong><span class="koboSpan" id="kobo.662.1"> image, which you can find in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.663.1">Chapter 10</span></strong></span><span class="koboSpan" id="kobo.664.1"> folder in the GitHub repository, and add the image to the Assets catalog. </span><span class="koboSpan" id="kobo.664.2">Then, create a new SwiftUI View file, which we will call </span><strong class="source-inline"><span class="koboSpan" id="kobo.665.1">BuoyView</span></strong><span class="koboSpan" id="kobo.666.1">. </span><span class="koboSpan" id="kobo.666.2">Inside the file, we will need six variables to get this buoy off the ground and into the water, so add the following code to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.667.1">BuoyView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.668.1"> struct:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.669.1">
@Binding var tiltForwardBackward: Bool
    @Binding var upAndDown: Bool
    @Binding var leadingAnchorAnimate: Bool
    @State private var red = 1.0
    @State private var green = 1.0
    @State private var blue = 1.0</span></pre>
<p><span class="koboSpan" id="kobo.670.1">Here, we are using three Boolean binding variables, which will oversee their respective animations: </span><strong class="source-inline"><span class="koboSpan" id="kobo.671.1">tiltForwardBackward</span></strong><span class="koboSpan" id="kobo.672.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.673.1">upAndDown</span></strong><span class="koboSpan" id="kobo.674.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.675.1">leadingAnchorAnimate</span></strong><span class="koboSpan" id="kobo.676.1">. </span><span class="koboSpan" id="kobo.676.2">Then, three </span><strong class="source-inline"><span class="koboSpan" id="kobo.677.1">State</span></strong><span class="koboSpan" id="kobo.678.1"> variables are used to make a blinking </span><span class="No-Break"><span class="koboSpan" id="kobo.679.1">light animation.</span></span></p>
<p><span class="koboSpan" id="kobo.680.1">We just added some binding variables to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.681.1">BuoyView</span></strong><span class="koboSpan" id="kobo.682.1"> struct, which will introduce some errors in the project. </span><span class="koboSpan" id="kobo.682.2">The reason why these errors occur is that anytime we add binding variables to the struct we are working in, we will need to add them in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.683.1">Preview</span></strong><span class="koboSpan" id="kobo.684.1"> struct as well; otherwise, the previews will complain. </span><span class="koboSpan" id="kobo.684.2">The Preview struct’s job is to display all the code that’s written within the file, so it works hand in hand with the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.685.1">BuoyView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.686.1"> struct.</span></span></p>
<p><span class="koboSpan" id="kobo.687.1">So, modify the Preview struct code to look like </span><span class="No-Break"><span class="koboSpan" id="kobo.688.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.689.1">
struct BuoyView_Previews: PreviewProvider {
    static var previews: some View {
        BuoyView(tiltForwardBackward: .constant(true),
        upAndDown: .constant(true), leadingAnchorAnimate:
        .constant(true))
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.690.1">We are now, once </span><span class="No-Break"><span class="koboSpan" id="kobo.691.1">again, error-free.</span></span></p>
<p><span class="koboSpan" id="kobo.692.1">Let’s now come into the</span><a id="_idIndexMarker595"/> <strong class="source-inline"><span class="koboSpan" id="kobo.693.1">body</span></strong><span class="koboSpan" id="kobo.694.1"> property and add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.695.1">ZStack</span></strong><span class="koboSpan" id="kobo.696.1">, then add the buoy image inside of </span><span class="No-Break"><span class="koboSpan" id="kobo.697.1">the </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.698.1">ZStack</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.699.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.700.1">
 ZStack {
           Image("buoy")
        }</span></pre>
<p><span class="koboSpan" id="kobo.701.1">We should see the buoy in the </span><span class="No-Break"><span class="koboSpan" id="kobo.702.1">previews now:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer146">
<span class="koboSpan" id="kobo.703.1"><img alt="Figure 10.7: The buoy " src="image/B18674_10_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.704.1">Figure 10.7: The buoy</span></p>
<p><span class="koboSpan" id="kobo.705.1">We’re going to work on the blinking light first. </span><span class="koboSpan" id="kobo.705.2">In order to achieve this effect, we have to add a rectangle shape, place</span><a id="_idIndexMarker596"/><span class="koboSpan" id="kobo.706.1"> it on top of the buoy (inside the curved top), then give it some color, and finally toggle that color on and off to make it look like the light is blinking. </span></p>
<h2 id="_idParaDest-143"><a id="_idTextAnchor147"/><span class="koboSpan" id="kobo.707.1">Making the buoy light blink</span></h2>
<p><span class="koboSpan" id="kobo.708.1">To start the process </span><a id="_idIndexMarker597"/><span class="koboSpan" id="kobo.709.1">of creating the light, let’s overlay a rectangle on the buoy image. </span><span class="koboSpan" id="kobo.709.2">Add the following code to do that, right under the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.710.1">Image</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.711.1"> initializer:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.712.1">
 ZStack {
           Image("buoy").overlay(Rectangle())
        }</span></pre>
<p><span class="koboSpan" id="kobo.713.1">This is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.714.1">overlay</span></strong><span class="koboSpan" id="kobo.715.1"> modifier, which allows us to add a new view over an existing view, to create layers </span><span class="No-Break"><span class="koboSpan" id="kobo.716.1">of views.</span></span></p>
<p><span class="koboSpan" id="kobo.717.1">If you look in your previews, you will see that the rectangle we just added is much too big for what we need. </span><span class="koboSpan" id="kobo.717.2">So, there needs to be a little more stylizing and resizing of it. </span><span class="koboSpan" id="kobo.717.3">But before we go any further, let’s set the color variables to some initial values in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.718.1">onAppear</span></strong><span class="koboSpan" id="kobo.719.1"> modifier so we can see our work progressing in the previews. </span><span class="koboSpan" id="kobo.719.2">Add this code to the end of </span><span class="No-Break"><span class="koboSpan" id="kobo.720.1">the </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.721.1">ZStack</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.722.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.723.1">
.onAppear() {
            red = 0.5
            green = 0.5
            blue = 0.5
        }</span></pre>
<p><span class="koboSpan" id="kobo.724.1">I’m setting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.725.1">red</span></strong><span class="koboSpan" id="kobo.726.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.727.1">green</span></strong><span class="koboSpan" id="kobo.728.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.729.1">blue</span></strong><span class="koboSpan" id="kobo.730.1"> variables to a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.731.1">0.5</span></strong><span class="koboSpan" id="kobo.732.1"> (50%). </span><span class="koboSpan" id="kobo.732.2">This equal combination of 50% for these RGB colors produces a gray or neutral color, which will look good blinking against the blue sky background later. </span></p>
<p><span class="koboSpan" id="kobo.733.1">Next, coming back to</span><a id="_idIndexMarker598"/><span class="koboSpan" id="kobo.734.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.735.1">Image</span></strong><span class="koboSpan" id="kobo.736.1"> initializer, let’s add that neutral gray color to the rectangle using another </span><strong class="source-inline"><span class="koboSpan" id="kobo.737.1">overlay</span></strong><span class="koboSpan" id="kobo.738.1"> modifier and passing in the color variables. </span><span class="koboSpan" id="kobo.738.2">Be careful to place the new code directly in front of the overlay’s closing brace, </span><span class="No-Break"><span class="koboSpan" id="kobo.739.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.740.1">
 ZStack {
           Image("buoy").overlay(Rectangle()
               </span><strong class="bold"><span class="koboSpan" id="kobo.741.1"> .overlay(Color(red: red,green: green,blue:</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.742.1">                  blue)))</span></strong><span class="koboSpan" id="kobo.743.1">
        }</span></pre>
<p><span class="koboSpan" id="kobo.744.1">Now, we have a big gray rectangle, but we don’t see the buoy anymore because the rectangle is too big and needs to be resized. </span><span class="koboSpan" id="kobo.744.2">We are going to fix that. </span><span class="koboSpan" id="kobo.744.3">Add the following rectangle modifiers, which will size and position the rectangle, and place them directly inside the closing brace of the first </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.745.1">overlay</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.746.1"> modifier:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.747.1">
 Image("buoy").overlay(Rectangle()
     .overlay(Color(red: red,green: green,blue: blue))
     //adds a corner radius only to the bottom corners of
       the rectangle
                </span><strong class="bold"><span class="koboSpan" id="kobo.748.1">.frame(width: 12, height: 17)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.749.1">                .position(x: 112.5, y: 19.5))</span></strong><span class="koboSpan" id="kobo.750.1">
                 }</span></pre>
<p><span class="koboSpan" id="kobo.751.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.752.1">frame</span></strong><span class="koboSpan" id="kobo.753.1"> modifier sets the width </span><a id="_idIndexMarker599"/><span class="koboSpan" id="kobo.754.1">and height of the rectangle to a small size of </span><strong class="source-inline"><span class="koboSpan" id="kobo.755.1">12</span></strong><span class="koboSpan" id="kobo.756.1"> by </span><strong class="source-inline"><span class="koboSpan" id="kobo.757.1">17</span></strong><span class="koboSpan" id="kobo.758.1">. </span><span class="koboSpan" id="kobo.758.2">Then, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.759.1">position</span></strong><span class="koboSpan" id="kobo.760.1"> modifier places the rectangle at the X and Y coordinates of </span><strong class="source-inline"><span class="koboSpan" id="kobo.761.1">112.5</span></strong><span class="koboSpan" id="kobo.762.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.763.1">19.5</span></strong><span class="koboSpan" id="kobo.764.1">, which is at the top part of the buoy, the area that represents the light.  </span></p>
<p><span class="koboSpan" id="kobo.765.1">You can see the rectangle in the </span><span class="No-Break"><span class="koboSpan" id="kobo.766.1">following image:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer147">
<span class="koboSpan" id="kobo.767.1"><img alt="Figure 10.8: The buoy with the rectangle overlay " src="image/B18674_10_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.768.1">Figure 10.8: The buoy with the rectangle overlay</span></p>
<p><span class="koboSpan" id="kobo.769.1">The rectangle looks good; however, a </span><a id="_idIndexMarker600"/><span class="koboSpan" id="kobo.770.1">rectangle is, well, a rectangle. </span><span class="koboSpan" id="kobo.770.2">It has sharp corners on all four sides, whereas the top of the buoy has curved corners, as you can see in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.771.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.772.1">.9</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.773.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer148">
<span class="koboSpan" id="kobo.774.1"><img alt="Figure 10.9: A closer look at the rectangle overlay " src="image/B18674_10_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.775.1">Figure 10.9: A closer look at the rectangle overlay</span></p>
<p><span class="koboSpan" id="kobo.776.1">Using our current rectangle is a bit like fitting a square peg into a round hole. </span><span class="koboSpan" id="kobo.776.2">Luckily, SwiftUI does give us a modifier that rounds the corner radius of rectangles, but unluckily, there is still a problem with it: it rounds all four corners when all we want is for the top two corners to </span><span class="No-Break"><span class="koboSpan" id="kobo.777.1">be rounded.</span></span></p>
<p><span class="koboSpan" id="kobo.778.1">We could fix this by adding an extension to the corner radius modifier and altering its behavior so it will only act on two corners by writing numerous lines of code. </span><span class="koboSpan" id="kobo.778.2">However, a simpler way of achieving a two-corner radius modifier is by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.779.1">padding</span></strong><span class="koboSpan" id="kobo.780.1"> modifier in a unique way. </span></p>
<p><span class="koboSpan" id="kobo.781.1">To do this, after the last </span><a id="_idIndexMarker601"/><span class="koboSpan" id="kobo.782.1">variable in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.783.1">BuoyView</span></strong><span class="koboSpan" id="kobo.784.1"> struct, add a constant to store the radius we want for rounding the two corners of </span><span class="No-Break"><span class="koboSpan" id="kobo.785.1">our rectangle:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.786.1">
    let cRadius = 8.0</span></pre>
<p><span class="koboSpan" id="kobo.787.1">I’m calling this constant </span><strong class="source-inline"><span class="koboSpan" id="kobo.788.1">cRadius</span></strong><span class="koboSpan" id="kobo.789.1">, for the corner radius, and setting it to a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.790.1">8.0</span></strong><span class="koboSpan" id="kobo.791.1"> points. </span><span class="koboSpan" id="kobo.791.2">The larger you make the corner radius value, the more rounded the rectangle becomes; for our purposes, an eight-point value adds just enough rounding to our rectangle’s two top corners to make it fit perfectly within the buoy light. </span></p>
<p><span class="koboSpan" id="kobo.792.1">Add the following code, directly after the second </span><strong class="source-inline"><span class="koboSpan" id="kobo.793.1">overlay</span></strong><span class="koboSpan" id="kobo.794.1"> modifier, </span><span class="No-Break"><span class="koboSpan" id="kobo.795.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.796.1">
Image("buoy").overlay(Rectangle()
    .overlay(Color(red: red,green: green,blue: blue))
    ///add a corner radius only to the bottom corners
</span><strong class="bold"><span class="koboSpan" id="kobo.797.1">        .padding(.bottom, cRadius)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.798.1">        .cornerRadius(cRadius)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.799.1">        .padding(.bottom, -cRadius)</span></strong><span class="koboSpan" id="kobo.800.1">
    .frame(width: 12, height: 17)
    .position(x: 112.5, y: 19.5))</span></pre>
<p><span class="koboSpan" id="kobo.801.1">Here’s what the code does. </span><span class="koboSpan" id="kobo.801.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.802.1">.padding(.bottom, cRadius)</span></strong><span class="koboSpan" id="kobo.803.1"> line adds eight-point padding to the bottom of the rectangle. </span><span class="koboSpan" id="kobo.803.2">Then, we call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.804.1">cornerRadius</span></strong><span class="koboSpan" id="kobo.805.1"> modifier, which will put a corner radius on all four corners of the rectangle. </span><span class="koboSpan" id="kobo.805.2">But since we have an eight-point </span><a id="_idIndexMarker602"/><span class="koboSpan" id="kobo.806.1">padding on the bottom of the rectangle, we don’t see that corner radius placed on the bottom; we will only see the curved corners at the top of the rectangle, which is exactly what we want. </span></p>
<p><span class="koboSpan" id="kobo.807.1">Finally, we call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.808.1">padding</span></strong><span class="koboSpan" id="kobo.809.1"> modifier again, and again choose the </span><strong class="source-inline"><span class="koboSpan" id="kobo.810.1">.bottom</span></strong><span class="koboSpan" id="kobo.811.1"> option to place padding only on the bottom of the rectangle. </span><span class="koboSpan" id="kobo.811.2">This time, however, we set a value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.812.1">-8</span></strong><span class="koboSpan" id="kobo.813.1"> points. </span><span class="koboSpan" id="kobo.813.2">When we make this option negative, it effectively extends the rectangle downward on the </span><em class="italic"><span class="koboSpan" id="kobo.814.1">y</span></em><span class="koboSpan" id="kobo.815.1"> axis – by 8 points – but preserves those two sharp corners that we want at the bottom. </span><span class="koboSpan" id="kobo.815.2">This is a pretty neat trick and saves us some time writing code in an extension for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.816.1">cornerRadius</span></strong><span class="koboSpan" id="kobo.817.1"> modifier. </span><span class="koboSpan" id="kobo.817.2">This is the result we see in the </span><span class="No-Break"><span class="koboSpan" id="kobo.818.1">previews now:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer149">
<span class="koboSpan" id="kobo.819.1"><img alt="Figure 10.10: The rectangle overlay now fitting the curved tip of the buoy " src="image/B18674_10_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.820.1">Figure 10.10: The rectangle overlay now fitting the curved tip of the buoy</span></p>
<p><span class="koboSpan" id="kobo.821.1">The previews show that our gray rectangle now matches the curvature of the top portion of the light and has two sharp corners to match the bottom portion of </span><span class="No-Break"><span class="koboSpan" id="kobo.822.1">the light.</span></span></p>
<p><span class="koboSpan" id="kobo.823.1">To finish off the light and make it blink, we only have to add one line of code after the last line of code in </span><span class="No-Break"><span class="koboSpan" id="kobo.824.1">the </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.825.1">ZStack</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.826.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.827.1">
    ///the animation for the blinking light
    .animation(Animation.easeOut(duration:
      1).repeatForever(autoreverses: true),value: red)</span></pre>
<p><span class="koboSpan" id="kobo.828.1">With that code in place, if you run the previews here in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.829.1">BuoyView</span></strong><span class="koboSpan" id="kobo.830.1"> file, you’ll see that now we have a </span><a id="_idIndexMarker603"/><span class="koboSpan" id="kobo.831.1">blinking light that will blink on and off for a duration of 1 second, repeating forever, or until the </span><span class="No-Break"><span class="koboSpan" id="kobo.832.1">app stops:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer150">
<span class="koboSpan" id="kobo.833.1"><img alt="Figure 10.11: The completed buoy with a blinking light " src="image/B18674_10_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.834.1">Figure 10.11: The completed buoy with a blinking light</span></p>
<p><span class="koboSpan" id="kobo.835.1">Let’s add the animations that make the buoy move now. </span></p>
<h2 id="_idParaDest-144"><a id="_idTextAnchor148"/><span class="koboSpan" id="kobo.836.1">Making the buoy move</span></h2>
<p><span class="koboSpan" id="kobo.837.1">The first animation</span><a id="_idIndexMarker604"/><span class="koboSpan" id="kobo.838.1"> that we will add to make the buoy move will be to rotate the buoy along its leading anchor point. </span><span class="koboSpan" id="kobo.838.2">To do this, add the following code right after the previous line of code in </span><span class="No-Break"><span class="koboSpan" id="kobo.839.1">the </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.840.1">ZStack</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.841.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.842.1">
   ///the animation for the anchor point motion
    .rotationEffect(.degrees(leadingAnchorAnimate ? </span><span class="koboSpan" id="kobo.842.2">7 :
      -3), anchor: .leading) 
    .animation(Animation.easeOut(duration:
      0.9).repeatForever(autoreverses: true),
      value: leadingAnchorAnimate)</span></pre>
<p><span class="koboSpan" id="kobo.843.1">This code uses the </span><strong class="source-inline"><span class="koboSpan" id="kobo.844.1">rotationEffect</span></strong><span class="koboSpan" id="kobo.845.1"> modifier and will rotate the buoy by either </span><strong class="source-inline"><span class="koboSpan" id="kobo.846.1">7</span></strong><span class="koboSpan" id="kobo.847.1"> degrees when the </span><strong class="source-inline"><span class="koboSpan" id="kobo.848.1">leadingAnchorAnimate</span></strong><span class="koboSpan" id="kobo.849.1"> property becomes </span><strong class="source-inline"><span class="koboSpan" id="kobo.850.1">true</span></strong><span class="koboSpan" id="kobo.851.1">, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.852.1">-3</span></strong><span class="koboSpan" id="kobo.853.1"> when it's </span><strong class="source-inline"><span class="koboSpan" id="kobo.854.1">false</span></strong><span class="koboSpan" id="kobo.855.1">. </span><span class="koboSpan" id="kobo.855.2">For the </span><strong class="source-inline"><span class="koboSpan" id="kobo.856.1">anchor</span></strong><span class="koboSpan" id="kobo.857.1"> parameter, we used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.858.1">leading</span></strong><span class="koboSpan" id="kobo.859.1"> anchor option, which pivots the image around the leading edge, but you can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.860.1">bottom</span></strong><span class="koboSpan" id="kobo.861.1"> option as well for a slightly </span><span class="No-Break"><span class="koboSpan" id="kobo.862.1">different rotation.</span></span></p>
<p><span class="koboSpan" id="kobo.863.1">Then, we added the </span><strong class="source-inline"><span class="koboSpan" id="kobo.864.1">animation</span></strong><span class="koboSpan" id="kobo.865.1"> modifier, setting its </span><strong class="source-inline"><span class="koboSpan" id="kobo.866.1">duration</span></strong><span class="koboSpan" id="kobo.867.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.868.1">0.9</span></strong><span class="koboSpan" id="kobo.869.1"> seconds, with </span><strong class="source-inline"><span class="koboSpan" id="kobo.870.1">repeatForever</span></strong><span class="koboSpan" id="kobo.871.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.872.1">autoreverses</span></strong><span class="koboSpan" id="kobo.873.1"> set </span><span class="No-Break"><span class="koboSpan" id="kobo.874.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.875.1">true</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.876.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.877.1">We will also toggle the </span><strong class="source-inline"><span class="koboSpan" id="kobo.878.1">leadingAnchorAnimate</span></strong><span class="koboSpan" id="kobo.879.1"> property to </span><strong class="source-inline"><span class="koboSpan" id="kobo.880.1">true</span></strong><span class="koboSpan" id="kobo.881.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.882.1">onAppear</span></strong><span class="koboSpan" id="kobo.883.1"> modifier shortly, but first, let’s add the other two animations to the buoy. </span></p>
<p><span class="koboSpan" id="kobo.884.1">The next animation to add will make the buoy tilt forward and backward. </span><span class="koboSpan" id="kobo.884.2">Add the code for this right under the </span><span class="No-Break"><span class="koboSpan" id="kobo.885.1">previous code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.886.1">
   ///the animation for the tilt forward and backward
     motion
    .rotationEffect(.degrees(tiltForwardBackward ? </span><span class="koboSpan" id="kobo.886.2">-20 :
      15))
    .animation(Animation.easeInOut(duration:
      1.0).delay(0.2).repeatForever(autoreverses:
      true),value: tiltForwardBackward)</span></pre>
<p><span class="koboSpan" id="kobo.887.1">The is almost identical to the previous code, but the value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.888.1">.rotationEffect</span></strong><span class="koboSpan" id="kobo.889.1"> is now set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.890.1">tiltForwardBackward</span></strong><span class="koboSpan" id="kobo.891.1">. </span><span class="koboSpan" id="kobo.891.2">The amount of rotation or tilt forward and back is going to be either </span><strong class="source-inline"><span class="koboSpan" id="kobo.892.1">-20</span></strong><span class="koboSpan" id="kobo.893.1"> degrees or </span><strong class="source-inline"><span class="koboSpan" id="kobo.894.1">15</span></strong><span class="koboSpan" id="kobo.895.1"> degrees, depending on the value inside of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.896.1">tiltForwardBackward</span></strong><span class="koboSpan" id="kobo.897.1"> variable. </span><span class="koboSpan" id="kobo.897.2">Also, in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.898.1">animation</span></strong><span class="koboSpan" id="kobo.899.1"> modifier, we’re adding a slight delay of </span><strong class="source-inline"><span class="koboSpan" id="kobo.900.1">0.2</span></strong><span class="koboSpan" id="kobo.901.1">, as this will help to add to a real-looking </span><span class="No-Break"><span class="koboSpan" id="kobo.902.1">bobbing motion.</span></span></p>
<p><span class="koboSpan" id="kobo.903.1">Now, to add the final animation to the buoy, which will make the image move up and down, add this line of code directly after the </span><span class="No-Break"><span class="koboSpan" id="kobo.904.1">previous code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.905.1">
.offset(y: upAndDown ? </span><span class="koboSpan" id="kobo.905.2">-10 : 10)</span></pre>
<p><span class="koboSpan" id="kobo.906.1">A negative value will </span><a id="_idIndexMarker605"/><span class="koboSpan" id="kobo.907.1">move an image up the </span><em class="italic"><span class="koboSpan" id="kobo.908.1">y</span></em><span class="koboSpan" id="kobo.909.1"> axis and a positive value will move the image down the </span><em class="italic"><span class="koboSpan" id="kobo.910.1">y</span></em><span class="koboSpan" id="kobo.911.1"> axis. </span><span class="koboSpan" id="kobo.911.2">So, this code will move the entire buoy image 10 points up or down depending on the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.912.1">upAndDown</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.913.1"> variable.</span></span></p>
<p><span class="koboSpan" id="kobo.914.1">The last bit of code we need in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.915.1">BuoyView</span></strong><span class="koboSpan" id="kobo.916.1"> file is code that toggles on these three animations in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.917.1">onAppear</span></strong><span class="koboSpan" id="kobo.918.1"> modifier. </span><span class="koboSpan" id="kobo.918.2">So, add the </span><span class="No-Break"><span class="koboSpan" id="kobo.919.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.920.1">
.onAppear() {
</span><strong class="bold"><span class="koboSpan" id="kobo.921.1">           leadingAnchorAnimate.toggle()</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.922.1">             tiltForwardBackward.toggle()</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.923.1">             upAndDown.toggle()</span></strong><span class="koboSpan" id="kobo.924.1">
            red = 0.5
            green = 0.5
            blue = 0.5
        }</span></pre>
<p><span class="koboSpan" id="kobo.925.1">That completes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.926.1">BuoyView</span></strong><span class="koboSpan" id="kobo.927.1"> file, and now we can proceed to </span><strong class="source-inline"><span class="koboSpan" id="kobo.928.1">ContentView</span></strong><span class="koboSpan" id="kobo.929.1"> and add the buoy to </span><span class="No-Break"><span class="koboSpan" id="kobo.930.1">the scene.</span></span></p>
<h2 id="_idParaDest-145"><a id="_idTextAnchor149"/><span class="koboSpan" id="kobo.931.1">Adding the buoy to the scene</span></h2>
<p><span class="koboSpan" id="kobo.932.1">We want to place</span><a id="_idIndexMarker606"/><span class="koboSpan" id="kobo.933.1"> the buoy slightly in the distance of our ocean scene, so let’s add it right after wave 1. </span><span class="koboSpan" id="kobo.933.2">Add the following code after the closing brace of the </span><span class="No-Break"><span class="koboSpan" id="kobo.934.1">first wave:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.935.1">
  //MARK: - BUOY
      BuoyView(tiltForwardBackward: $tiltForwardBackward,
        upAndDown: $upAndDown, leadingAnchorAnimate:
        $leadingAnchorAnimnate)
      .offset(y: 205)</span></pre>
<p><span class="koboSpan" id="kobo.936.1">Inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.937.1">BuoyView</span></strong><span class="koboSpan" id="kobo.938.1"> initializer, we pass in the three binding properties that initiate three separate animations. </span><span class="koboSpan" id="kobo.938.2">We add a dollar sign before those binding properties, which tells the compiler that there’s a two-way binding between the </span><strong class="source-inline"><span class="koboSpan" id="kobo.939.1">BuoyView</span></strong><span class="koboSpan" id="kobo.940.1"> struct and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.941.1">ContentView</span></strong><span class="koboSpan" id="kobo.942.1"> struct. </span><span class="koboSpan" id="kobo.942.2">Next, using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.943.1">offset</span></strong><span class="koboSpan" id="kobo.944.1"> modifier, we can place the buoy at the proper height in the </span><span class="No-Break"><span class="koboSpan" id="kobo.945.1">ocean scene.</span></span></p>
<p><span class="koboSpan" id="kobo.946.1">Now, go ahead and run the project in the simulator to see </span><span class="No-Break"><span class="koboSpan" id="kobo.947.1">the animations:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer151">
<span class="koboSpan" id="kobo.948.1"><img alt="Figure 10.12: The completed animation " src="image/B18674_10_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.949.1">Figure 10.12: The completed animation</span></p>
<p><span class="koboSpan" id="kobo.950.1">Though the code for the waves and buoy work independently, the two elements visually work together to create our </span><span class="No-Break"><span class="koboSpan" id="kobo.951.1">ocean scene.</span></span></p>
<p><span class="koboSpan" id="kobo.952.1">The final element </span><a id="_idIndexMarker607"/><span class="koboSpan" id="kobo.953.1">that we can add next is some sound effects. </span><span class="koboSpan" id="kobo.953.2">How about the sound of some ocean waves and a buoy bell ringing in the background? </span><span class="koboSpan" id="kobo.953.3">That would really complete </span><span class="No-Break"><span class="koboSpan" id="kobo.954.1">the project.</span></span></p>
<h1 id="_idParaDest-146"><a id="_idTextAnchor150"/><span class="koboSpan" id="kobo.955.1">Adding sound effects</span></h1>
<p><span class="koboSpan" id="kobo.956.1">We already added</span><a id="_idIndexMarker608"/><span class="koboSpan" id="kobo.957.1"> sound in </span><a href="B18674_04.xhtml#_idTextAnchor060"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.958.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.959.1">, when building </span><a id="_idIndexMarker609"/><span class="koboSpan" id="kobo.960.1">the record player project, and there’s nothing complicated </span><span class="No-Break"><span class="koboSpan" id="kobo.961.1">about it.</span></span></p>
<p><span class="koboSpan" id="kobo.962.1">First, start by creating a Swift file (just a Swift file, not a SwiftUI View one), and call it </span><strong class="source-inline"><span class="koboSpan" id="kobo.963.1">PlaySound</span></strong><span class="koboSpan" id="kobo.964.1">. </span><span class="koboSpan" id="kobo.964.2">Next, drag the M4A sound effects file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.965.1">buoyBells</span></strong><span class="koboSpan" id="kobo.966.1"> (which you can find on GitHub) and place it into the </span><span class="No-Break"><span class="koboSpan" id="kobo.967.1">file navigator.</span></span></p>
<p><span class="koboSpan" id="kobo.968.1">Inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.969.1">PlaySound</span></strong><span class="koboSpan" id="kobo.970.1"> file, the first thing we need to do is import the </span><span class="No-Break"><span class="koboSpan" id="kobo.971.1">AVFoundation framework:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.972.1">
import AVFoundation</span></pre>
<p><span class="koboSpan" id="kobo.973.1">The AVFoundation framework gives us access to all the classes and methods needed to add audio to </span><span class="No-Break"><span class="koboSpan" id="kobo.974.1">a project.</span></span></p>
<p><span class="koboSpan" id="kobo.975.1">Next, create an </span><strong class="source-inline"><span class="koboSpan" id="kobo.976.1">audioPlayer</span></strong><span class="koboSpan" id="kobo.977.1"> object to play our </span><span class="No-Break"><span class="koboSpan" id="kobo.978.1">sound file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.979.1">
var audioPlayer: AVAudioPlayer?</span></pre>
<p><span class="koboSpan" id="kobo.980.1">This </span><strong class="source-inline"><span class="koboSpan" id="kobo.981.1">audioPlayer</span></strong><span class="koboSpan" id="kobo.982.1"> object is </span><a id="_idIndexMarker610"/><span class="koboSpan" id="kobo.983.1">optional, which you can tell by the question mark at the end. </span><span class="koboSpan" id="kobo.983.2">It needs to be optional because the sound file may not exist for whatever reason – maybe the file gets </span><a id="_idIndexMarker611"/><span class="koboSpan" id="kobo.984.1">corrupted, or the sound file has been downloaded from a server and the internet has timed out – and so this protects the project </span><span class="No-Break"><span class="koboSpan" id="kobo.985.1">from crashing.</span></span></p>
<p><span class="koboSpan" id="kobo.986.1">Finally, under the previous line of code, all we need to do is add a function to handle the audio needs of </span><span class="No-Break"><span class="koboSpan" id="kobo.987.1">this project:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.988.1">
func playSound(name: String, type: String) {
    if let path = Bundle.main.path(forResource: sound,
      ofType: type) {
        do {
            audioPlayer = try AVAudioPlayer(contentsOf:
              URL(fileURLWithPath: path))
            audioPlayer?.play()
        } catch {
            print("Could not find and play the sound file")
        }
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.989.1">The function is called </span><strong class="source-inline"><span class="koboSpan" id="kobo.990.1">playSound</span></strong><span class="koboSpan" id="kobo.991.1">. </span><span class="koboSpan" id="kobo.991.2">It accepts two strings, one to hold the name of the file and another to hold the file’s </span><span class="No-Break"><span class="koboSpan" id="kobo.992.1">extension type.</span></span></p>
<p><span class="koboSpan" id="kobo.993.1">The first thing we do is try to access the sound file that’s in the app bundle by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.994.1">path_forResource()</span></strong><span class="koboSpan" id="kobo.995.1"> function. </span><span class="koboSpan" id="kobo.995.2">The app bundle is an internal hidden folder that is created for each app to hold all the necessary files to get </span><a id="_idIndexMarker612"/><span class="koboSpan" id="kobo.996.1">the app up </span><span class="No-Break"><span class="koboSpan" id="kobo.997.1">and running.</span></span></p>
<p><span class="koboSpan" id="kobo.998.1">If the file exists with the specified name and type, then the code proceeds into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.999.1">do</span></strong><span class="koboSpan" id="kobo.1000.1"> block and tries to create the audio player with the path of the file’s location stored in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1001.1">path</span></strong><span class="koboSpan" id="kobo.1002.1"> constant. </span><span class="koboSpan" id="kobo.1002.2">If, for whatever reason, the file cannot be found or it’s corrupt, then the code will fall into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1003.1">catch</span></strong><span class="koboSpan" id="kobo.1004.1"> block and print out </span><span class="No-Break"><span class="koboSpan" id="kobo.1005.1">an error.</span></span></p>
<p><span class="koboSpan" id="kobo.1006.1">And that’s really it for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1007.1">PlaySound</span></strong><span class="koboSpan" id="kobo.1008.1"> file. </span><span class="koboSpan" id="kobo.1008.2">Let’s go back into </span><strong class="source-inline"><span class="koboSpan" id="kobo.1009.1">ContentView</span></strong><span class="koboSpan" id="kobo.1010.1"> and add the sound effects to the project. </span><span class="koboSpan" id="kobo.1010.2">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1011.1">onAppear</span></strong><span class="koboSpan" id="kobo.1012.1"> modifier, set the sound to start playing with the</span><a id="_idIndexMarker613"/> <span class="No-Break"><span class="koboSpan" id="kobo.1013.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1014.1">
.onAppear() {
            animateOffset.toggle()
            playSound(name: "buoyBells", type: "m4a")
        }</span></pre>
<p><span class="koboSpan" id="kobo.1015.1">We also need a way of stopping the sound too, when the app stops running on the device or the user closes the app. </span><span class="koboSpan" id="kobo.1015.2">The way to make the sound stop is to call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1016.1">onDisappear</span></strong><span class="koboSpan" id="kobo.1017.1"> modifier, which we can use directly on the closing brace of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1018.1">onAppear</span></strong><span class="koboSpan" id="kobo.1019.1"> modifier, </span><span class="No-Break"><span class="koboSpan" id="kobo.1020.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1021.1">
       .onDisappear()
        {
            audioPlayer?.stop()
        }</span></pre>
<p><span class="koboSpan" id="kobo.1022.1">And with that, the project </span><span class="No-Break"><span class="koboSpan" id="kobo.1023.1">is complete!</span></span></p>
<h1 id="_idParaDest-147"><a id="_idTextAnchor151"/><span class="koboSpan" id="kobo.1024.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.1025.1">In this chapter, we created an ocean scene, with moving waves and a bobbing buoy with a flashing light, and added some </span><span class="No-Break"><span class="koboSpan" id="kobo.1026.1">sounds too.</span></span></p>
<p><span class="koboSpan" id="kobo.1027.1">More specially, you used the Shape protocol, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1028.1">path</span></strong><span class="koboSpan" id="kobo.1029.1"> function, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1030.1">animatableData</span></strong><span class="koboSpan" id="kobo.1031.1"> property, and curve variables to make the wave shape come alive. </span><span class="koboSpan" id="kobo.1031.2">When working on the buoy, we looked at how to combine multiple types of animation to create unique effects, and how to turn different colors on and off to create a </span><span class="No-Break"><span class="koboSpan" id="kobo.1032.1">blinking effect.</span></span></p>
<p><span class="koboSpan" id="kobo.1033.1">The parameters in this project are highly customizable, so feel free to experiment further – maybe you want to create bigger waves or more of them, create the waves in landscape orientation, alter the shadow to create a horizon, or even replace the buoy with </span><span class="No-Break"><span class="koboSpan" id="kobo.1034.1">a boat!</span></span></p>
<p><span class="koboSpan" id="kobo.1035.1">Let’s keep going. </span><span class="koboSpan" id="kobo.1035.2">In the next project, we will create a working elevator animation using timers and </span><span class="No-Break"><span class="koboSpan" id="kobo.1036.1">sound effects.</span></span></p>
</div>
<div>
<div class="IMG---Figure" id="_idContainer153">
</div>
</div>
</body></html>