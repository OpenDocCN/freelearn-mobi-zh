<html><head></head><body><div class="chapter" title="Chapter&#xA0;6.&#xA0;Web Services"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Web Services</h1></div></div></div><p>In this chapter, we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Consuming web services</li><li class="listitem" style="list-style-type: disc">Invoking web services</li><li class="listitem" style="list-style-type: disc">Consuming WCF services</li><li class="listitem" style="list-style-type: disc">Reading JSON data</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec01"/>Introduction</h1></div></div></div><p>Providing online information to the user is a crucial part of mobile development. In this chapter, we will discuss developing applications that communicate with web services to provide information. We will see how to consume and invoke web services, based on SOAP. We will also discuss how to use WCF web services and how to parse the popular JSON data format from a web server.<a id="id532" class="indexterm"/>
</p><p>All examples in this chapter use the xsp lightweight web server that ships with the Mono Framework, so there is no need to have a live web service up and running online to make use of the provided code.<a id="id533" class="indexterm"/>
</p></div></div>
<div class="section" title="Consuming web services"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec02"/>Consuming web services</h1></div></div></div><p>In this recipe, we will learn how to use a SOAP web service in a MonoTouch project.<a id="id534" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec01"/>Getting ready</h2></div></div></div><p>Create a new project in MonoDevelop, and name it<code class="literal"> WebServiceApp</code>. This chapter's code contains a web service project, named<code class="literal"> MTWebService</code>. This is the web service that will be used.<a id="id535" class="indexterm"/>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec02"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> To use the<code class="literal"> MTWebService</code> web service, we need a web server. Mono Framework provides the xsp lightweight web server for testing purposes.</li><li class="listitem"> Open a terminal and type the following command to get to the web service's directory, replacing<code class="literal">&lt;code_directory&gt;</code> with the path the downloaded code is in:<div class="informalexample"><pre class="programlisting">cd &lt;code_directory&gt;/CH06_code/MTWebService/MTWebService
</pre></div></li><li class="listitem"> Run the xsp web server by typing<code class="literal"> xsp4</code> in the prompt. You will see an output similar to the following:<a id="id536" class="indexterm"/><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>xsp4
Listening on address: 0.0.0.0
Root directory: /Users/dtavlikos/projects/CH06_code/MTWebService/ MTWebService
Listening on port: 8080 (non-secure)
Hit Return to stop the server.
</strong></span>
</pre></div></li><li class="listitem"> Now, we need to add a web reference to the web service in the project. Right-click on the project in the<span class="strong"><strong> Solution</strong></span> pad and select<span class="strong"><strong> Add | Add Web Reference</strong></span>.<a id="id537" class="indexterm"/></li><li class="listitem"> In the dialog that will be shown, add the information provided in the following screenshot:<div class="mediaobject"><img src="graphics/1468EXP_06_01.jpg" alt="How to do it..."/></div></li><li class="listitem"> After adding the web reference to the<span class="strong"><strong> MTTestWebService</strong></span> web service, add a button and a label on the view of<code class="literal"> MainController</code>. Override the<code class="literal"> ViewDidLoad</code> method of the<code class="literal"> MainController</code> class, and enter the following code in it:<a id="id538" class="indexterm"/><div class="informalexample"><pre class="programlisting">this.buttonFetchData.TouchUpInside += delegate {
using (MTTestWebService webService = new MTTestWebService()){
this.lblMessage.Text = webService.GetMessage ("Hello Web Service!");
}
} ;
</pre></div></li><li class="listitem"> Finally, provide a<code class="literal"> using</code> directive for our web service's namespace:<a id="id539" class="indexterm"/><div class="informalexample"><pre class="programlisting">using WebServiceApp.mtWebService;
</pre></div></li><li class="listitem"> Compile and run the application on the simulator.</li><li class="listitem"> Tap the button to invoke the web service, and notice the output message in the label.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec03"/>How it works...</h2></div></div></div><p>MonoTouch can consume web services just like a .NET desktop application. The<code class="literal"> xsp</code> lightweight web server is installed by default when installing the Mono Framework, which is a requirement for the MonoTouch installation. When running the<code class="literal"> xsp4</code> command in the terminal without any parameters, it sets its base directory to the current directory by default and starts listening on the<code class="literal"> 8080</code> port. If the web server is started, the web service description can be viewed by entering<code class="literal">
http://localhost:8080/MTTestWebService.asmx</code> in a browser:<a id="id540" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/1468EXP_06_02.jpg" alt="How it works..."/></div><p>The link that needs to be entered in the<span class="strong"><strong> Web Service Url</strong></span> field of the web reference dialog can be found by clicking on the<span class="strong"><strong> Service Description</strong></span> link in the service description page, and then by clicking on the<span class="strong"><strong> Download</strong></span> link above the web service's WSDL description.</p><p>We then set the<span class="strong"><strong> Framework</strong></span> value to<span class="strong"><strong> .NET 2.0 Web Services</strong></span>, and provide a<span class="strong"><strong> Reference</strong></span> name, which will reflect the namespace of the web reference. To make use of the web service within our code, we instantiate it, and then just call the method we are interested in:<a id="id541" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">this.lblMessage.Text = webService.GetMessage ("Hello Web Service!");
</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec04"/>There's more...</h2></div></div></div><p>Apart from using a local hosted web service, there are also numerous sample web services on the Internet. A simple search will yield many results.</p><div class="section" title="XSP shutdown"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec01"/>XSP shutdown</h3></div></div></div><p>To shutdown the<code class="literal"> xsp</code> web server, just press the<span class="emphasis"><em> return</em></span> key in the terminal where it was executed from.<a id="id542" class="indexterm"/>
</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec05"/>See also</h2></div></div></div><p>In this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Invoking web services</em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Consuming WCF services</em></span></li></ul></div></div></div>
<div class="section" title="Invoking web services"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec03"/>Invoking web services</h1></div></div></div><p>In this recipe, we will discuss how to properly use web services with MonoTouch.<a id="id543" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec06"/>Getting ready</h2></div></div></div><p>Create a new project in MonoDevelop, and name it<code class="literal"> WebServiceApp2</code>. Start the<code class="literal"> xsp</code> web server, and add a web reference in the project to the<code class="literal"> TTestWebService</code> web service, as described in the previous task.<a id="id544" class="indexterm"/>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec07"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Add a label and a button on the view of<code class="literal"> MainController</code>.<a id="id545" class="indexterm"/></li><li class="listitem"> In the<code class="literal"> MainController</code> class in MonoDevelop, override the<code class="literal"> ViewDidLoad</code> method, and enter the following code in it:<div class="informalexample"><pre class="programlisting">this.buttonInvoke.TouchUpInside += delegate {
int a = 5;
int b = 12;
MTTestWebService webService = new MTTestWebService ();
<span class="strong"><strong>webService.MultiplyNumbersCompleted += MultiplyNumbers_CompletedHandler;</strong></span>
webService.MultiplyNumbersAsync (a, b);
UIApplication.SharedApplication. NetworkActivityIndicatorVisible = true;
this.lblMessage.Text = String.Format ( "Multiplying {0} by {1}", a, b);
} ;
</pre></div></li><li class="listitem"> Finally, add the following method:<a id="id546" class="indexterm"/><div class="informalexample"><pre class="programlisting">private void MultiplyNumbers_CompletedHandler ( object sender, MultiplyNumbersCompletedEventArgs args){
UIApplication.SharedApplication. NetworkActivityIndicatorVisible = false;
this.InvokeOnMainThread (delegate {
this.lblMessage.Text = String.Format ( "Multiplication result: {0}", args.Result);
} );
}
</pre></div></li><li class="listitem"> Compile and run the application on the simulator.<a id="id547" class="indexterm"/></li><li class="listitem"> Tap on the button and see the result from the web service being displayed on the label.</li></ol></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec08"/>How it works...</h3></div></div></div><p>As you may already have noticed, the application from the previous task froze while it was communicating with the web service, until it received the result. In this task, we use the asynchronous invocation so that the user interface will not freeze while the application is contacting the web service.</p><p>We want to be notified when our application receives a response from the web service, but we also need its result. Prior to calling the web method that we are interested in, we subscribe to the web service object's<code class="literal"> MultiplyNumbersCompleted</code> event, as the highlighted code shows in the<code class="literal"> ViewDidLoad</code> override. This event is part of the class that was created by MonoDevelop when we added the web reference, and every web method has a corresponding event. We then call the web method asynchronously by accessing the<code class="literal"> MultiplyNumbersAsync</code> method. This call returns instantly. The next call is interesting:<a id="id548" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">UIApplication.SharedApplication.NetworkActivityIndicatorVisible = true;
</pre></div><p>Through the<code class="literal"> UIApplication.SharedApplication</code> static property, we have access to some application-wide components, such as the status bar that is displayed on the screen. It is recommended to provide some sort of information to the user when a process is pending. The status bar contains an activity indicator, which is what is displayed when the device connects to the Internet in native iOS applications. Hence, the user is accustomed to this control and knows that when it is displayed, the device connects to receive data. By setting the<code class="literal"> NetworkActivityIndicatorVisible</code> property to<code class="literal"> true</code>, the network indicator is activated and displayed.<a id="id549" class="indexterm"/>
</p><p>When a call to a web method is completed, the appropriate event is triggered. Inside the<code class="literal"> MultiplyNumbers_CompletedHandler</code> method, we first make sure to hide the network indicator to inform the user that the application is no longer connected. We can access the result of the web method through the<code class="literal"> MultiplyNumbersCompletedEventArgs. Result</code> property.<a id="id550" class="indexterm"/>
</p><p>In this example, we want to display the result in the label directly, from within our handler. Because the web method was asynchronously called, the handler will most likely be executed on a different thread than the main thread. So, we wrap the assignment of the result to the label to an anonymous method and execute it on the main thread, as shown in the highlighted code of the handler implementation.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec09"/>There's more...</h3></div></div></div><p>The web service object contains a more common set of asynchronous invocation that we can use. It follows the<code class="literal"> BeginInvoke EndInvoke</code> pattern, with the methods renamed according to the web method of the service. In this case, these methods are named<code class="literal"> BeginMultiplyNumbers</code> and<code class="literal"> EndMultiplyNumbers</code>.</p><div class="section" title="Error handling"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec02"/>Error handling</h4></div></div></div><p>The<code class="literal"> MultiplyNumbersCompletedEventArgs</code> class also contains an<code class="literal"> Error</code> property. It returns a value of the type<code class="literal"> System.Exception</code>, and if something went wrong, for example, due to lack of network connection, it will contain the appropriate information. If no error occurred, the<code class="literal"> Error</code> property will return<code class="literal"> null</code>. It is advisable to always check this property first, before proceeding to retrieving the result of the web method:<a id="id551" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">if (null != args.Error){
// Something went wrong, handle appropriately.
}
</pre></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec10"/>See also</h3></div></div></div><p>In this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Consuming WCF services</em></span></li></ul></div></div></div></div>
<div class="section" title="Consuming WCF services"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec04"/>Consuming WCF services</h1></div></div></div><p>In this recipe, we will learn how to consume WCF services with MonoTouch.<a id="id552" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec11"/>Getting ready</h2></div></div></div><p>For this project, we will need a running WCF service. A WCF service can be found in the code download of this chapter. To start the service, open a terminal and go to the project's directory. Start the service by running the<code class="literal"> start_wcfservice.sh</code> shell script:<a id="id553" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">cd &lt;code_directory&gt;/CH06_code/ WcfService/WcfService
./start_wcfservice.sh
</pre></div><p>After the service is started, create a new project in MonoDevelop, and name it<code class="literal"> WcfServiceApp</code>.<a id="id554" class="indexterm"/>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec12"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Add the references to the<code class="literal"> System.Runtime.Serialization</code> and<code class="literal"> System.ServiceModel</code> to the project and their corresponding<code class="literal"> using</code> directives in the<code class="literal"> MainController.cs</code> file.</li><li class="listitem"> MonoTouch does not yet provide full support for WCF services. To generate a proxy for the client, we will need to use the<code class="literal"> slsvcutil</code> tool on a Windows machine. Run the following command in the terminal under Windows:<a id="id555" class="indexterm"/><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>"c:\Program Files\Microsoft SDKs\Silverlight\v3.0\Tools\slsvcutil /noconfig http://192.168.1.18:8080/WcfService.svc?wsdl"
</strong></span>
</pre></div><p>This command will produce a C# source fi le named <code class="literal">service.cs
</code>. Add this fi le to the
MonoDevelop project.

</p></li><li class="listitem"> Add a label and a button on the view of<code class="literal"> MainController</code>. Override the<code class="literal"> ViewDidLoad</code> method of the<code class="literal"> MainController</code> class, and enter the following code in it:<div class="informalexample"><pre class="programlisting">this.buttonFetchData.TouchUpInside += delegate( object sender, EventArgs e) {
WcfTestServiceClient client = new WcfTestServiceClient ( new BasicHttpBinding (), new EndpointAddress ( "http://192.168.1.18:8080/WcfTestService.svc"));
<span class="strong"><strong>client.GetBookInfoCompleted += WcfTestServiceClient_GetBookInfoCompleted;</strong></span>
client.GetBookInfoAsync ();
UIApplication.SharedApplication. NetworkActivityIndicatorVisible = true;
} ;
</pre></div></li><li class="listitem"> Finally, add the following event handler:<a id="id556" class="indexterm"/><div class="informalexample"><pre class="programlisting">private void WcfTestServiceClient_GetBookInfoCompleted ( object sender, GetBookInfoCompletedEventArgs e){
this.InvokeOnMainThread (delegate {
UIApplication.SharedApplication. NetworkActivityIndicatorVisible = false;
this.labelResult.Text = String.Format ("Book title: {0}\nAuthor: {1}", e.Result.Title, e.Result.Name);
} );
}
</pre></div></li><li class="listitem"> Compile and run the application on the simulator.<a id="id557" class="indexterm"/></li><li class="listitem"> Tap on the button and watch the data returned from the service populate in the label.</li></ol></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec13"/>How it works...</h3></div></div></div><p>MonoTouch relies on Mono Framework's support on WCF services, which is not complete. However, the fact alone that WCF services can be used in iOS applications makes MonoTouch more appealing to .NET developers.</p><p>For instance, there is no tool to create the client proxy on a Mac, so we will have to have access to a Windows machine to do this, with the<span class="strong"><strong> Silverlight Service Model Proxy Generation Tool (slsvcutil.exe)</strong></span> . The source file this tool generates allows us to consume the WCF service in our project. It basically does what MonoDevelop does automatically when we add a web reference to an ASMX web service, like in the two previous tasks.<a id="id558" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note32"/>Note</h3><p>It is important to use the<span class="strong"><strong> Silverlight version 3.0</strong></span>
<code class="literal"> slsvcutil</code> to create the client proxy.</p></div><p>Apart from Mono Framework's support, there is another limitation: dynamic code generation is not allowed on iOS. This makes any code that relies on the<code class="literal"> System.Reflection.Emit</code> namespace unusable. In fact, the<code class="literal"> System.Reflection.Emit</code> namespace is not available at all in MonoTouch.</p><p>After copying the produced file on the Mac, we add it to the project and we are ready to use the WCF service. The previous highlighted code shows how to instantiate the service object. Note that the default constructor of the service object cannot be used, since MonoTouch does not support the<code class="literal"> System.Configuration</code> namespace.<a id="id559" class="indexterm"/>
</p><p>The actual communication occurs by calling the method's asynchronous implementation, after setting a handler to its corresponding completion event. Note that in this case, there is no alternative of using synchronous invocations, or<code class="literal"> BeginInvoke EndInvoke</code> pattern:<a id="id560" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">client.GetBookInfoCompleted += WcfTestServiceClient_GetBookInfoCompleted;
client.GetBookInfoAsync ();
</pre></div><p>The result returned from the service can be retrieved through the specified<code class="literal"> EventArgs</code> derivative's<code class="literal"> Result</code> property:</p><div class="informalexample"><pre class="programlisting">this.labelResult.Text = String.Format ( "Book title: {0}\nAuthor: {1}", e.Result.Title, e.Result.Name);
</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec14"/>There's more...</h3></div></div></div><p>When debugging a project that consumes WCF services, remember to set the address of the machine the service is running on, instead of<code class="literal"> localhost</code> or<code class="literal"> 127.0.0.1</code>. That is because when we run the application on the device, the application will fail to connect to the service.</p><div class="section" title="More information on MonoDevelop's WCF support"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec03"/>More information on MonoDevelop's WCF support</h4></div></div></div><p>There is an option of adding a WCF web reference through MonoDevelop in the<span class="strong"><strong> Add Web References</strong></span> window shown in the<span class="emphasis"><em> Consuming Web Services</em></span> recipe. However, it is not yet complete.<a id="id561" class="indexterm"/>
</p></div><div class="section" title="WCF service creation"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec04"/>WCF service creation</h4></div></div></div><p>The object returned from the<code class="literal"> WcfService</code> service and the actual service itself were created completely on a Mac with MonoDevelop. Since there is no WCF project template, the<span class="strong"><strong> Empty Project</strong></span> template was used.<a id="id562" class="indexterm"/>
</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec15"/>See also</h3></div></div></div><p>In this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Consuming web services</em></span></li></ul></div></div></div></div>
<div class="section" title="Reading JSON data"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec05"/>Reading JSON data</h1></div></div></div><p>In this recipe, we will learn how to read<span class="strong"><strong> JavaScript Object Notation (JSON )</strong></span>  data.<a id="id563" class="indexterm"/>
</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec16"/>Getting ready</h2></div></div></div><p>Create a new project in MonoDevelop, and name it<code class="literal"> JsonDataApp</code>. Add a button and a label on the view of the<code class="literal"> MainController</code>.<a id="id564" class="indexterm"/>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec17"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Add a reference to the project to the<code class="literal"> System.Json</code> assembly.</li><li class="listitem"> Add the following<code class="literal"> using</code> directives in the<code class="literal"> MainController.cs</code> file:<div class="informalexample"><pre class="programlisting">using System.Json;
using System.Net;
using System.IO;
</pre></div></li><li class="listitem"> Enter the following method:<div class="informalexample"><pre class="programlisting">private JsonValue GetJsonObject (){
string responseString = string.Empty;
Uri uri = new Uri ("http://192.168.1.18:8080/mtjson.txt");
HttpWebRequest request = new HttpWebRequest (uri);
request.Method = "GET";
HttpWebResponse response = request.GetResponse () as HttpWebResponse;
using (StreamReader sr = new StreamReader(response.GetResponseStream())) {
responseString = sr.ReadToEnd ();
}
response.Close ();
return JsonValue.Parse (responseString);
}
</pre></div></li><li class="listitem"> Attach a handler to the button's<code class="literal"> TouchUpInside</code> event, and enter the following code in it:<a id="id565" class="indexterm"/><div class="informalexample"><pre class="programlisting">JsonValue json = this.GetJsonObject ();
this.labelResponse.Text = String.Format ("File name: {0}\n Description: {1}", json ["filename"], json ["description"]);
</pre></div></li><li class="listitem"> Finally, run the<code class="literal"> xsp</code> server in the project's directory. The file "mtjson.txt" contains data in JSON format.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec18"/>How it works...</h2></div></div></div><p>JSON is a specific text format that is human-readable and easy to implement. Many popular websites use this format to distribute data. Its main advantage is that it is language-independent. The structure of JSON is based on name/value pairs and arrays. The JSON data object used in this task is fairly simple:<a id="id566" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">{
"filename":"mtjson.txt",
"description":"a sample json object"
}
</pre></div><p>To read the data from the web server, we simply create an<code class="literal"> HttpWebRequest</code> object, setting its<code class="literal"> Method</code> property to<code class="literal"> HTTP GET:</code>
<a id="id567" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">HttpWebRequest request = new HttpWebRequest (uri);
request.Method = "GET";
</pre></div><p>We then need to get the response from the server. We do this by retrieving the request's response object and read the data from its underlying stream with a<code class="literal"> StreamReader:</code>
<a id="id568" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">HttpWebResponse response = request.GetResponse () as HttpWebResponse;
using (StreamReader sr = new StreamReader(response.GetResponseStream())) {
responseString = sr.ReadToEnd ();
}
</pre></div><p>The<code class="literal"> responseString</code> variable now contains the raw JSON data shown previously. For parsing JSON data, MonoTouch provides the<code class="literal"> JsonValue</code> class. To create a<code class="literal"> JsonValue</code> object, we use its<code class="literal"> Parse</code> static method, passing it as the string containing the JSON data:<a id="id569" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">return JsonValue.Parse (responseString);
</pre></div><p>To access the data that the<code class="literal"> JsonValue</code> object has parsed, we use indexers:</p><div class="informalexample"><pre class="programlisting">this.labelResponse.Text = String.Format ("File name: {0}\nDescription: {1}", json ["filename"], json ["description"]);
</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec19"/>There's more...</h2></div></div></div><p>If a name that does not exist in the JSON object is passed, an exception will occur. If the names of the JSON object are not known, we can use integers to retrieve the data:</p><div class="informalexample"><pre class="programlisting">//json[0], json[1] etc...
</pre></div><p>The<code class="literal"> JsonValue</code> class inherits from the<code class="literal"> IEnumerable</code> interface.<a id="id570" class="indexterm"/>
</p><div class="section" title="Serialization"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec05"/>Serialization</h3></div></div></div><p>The<code class="literal"> System.Json</code> namespace provides objects for simple parsing of JSON data. It does not provide JSON serialization functionality. We can, however, create a<code class="literal"> JsonObject</code> from a set of<code class="literal"> KeyValuePair&lt;string, JsonValue&gt;</code> objects. To create the previous JSON object, we would write something like the following:<a id="id571" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">JsonObject obj = new JsonObject (new KeyValuePair&lt;string, JsonValue&gt; ("filename", JsonValue.Parse ("\"mtjson.txt\"")), new KeyValuePair&lt;string, JsonValue&gt;("description", JsonValue.Parse("\"a sample json object\"")));
</pre></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec20"/>See also</h2></div></div></div><p>In this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Consuming web services</em></span></li></ul></div></div></div></body></html>