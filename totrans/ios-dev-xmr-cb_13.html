<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch13"/>Chapter 13. Localization</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating an app for different languages</li><li class="listitem" style="list-style-type: disc">Localizable resources</li><li class="listitem" style="list-style-type: disc">Regional formatting</li></ul></div><div><div><div><div><h1 class="title"><a id="ch13lvl1sec112"/>Introduction</h1></div></div></div><p>With the release of the iOS platform and the global software marketplace in the form of the App Store, Apple has made it easier for developers to distribute applications worldwide.</p><p>However, users worldwide will not even bother to download and use an app that is released in a language they do not understand. To broaden the user base for their apps, developers<a id="id729" class="indexterm"/> have to localize it. Localization is the process of translating text into multiple languages, providing resources specific to multiple regions, and thus creating an app that will target audiences of different cultures.</p><p>In this chapter, we will discuss the best practices to provide translated text that will be displayed according to each user's locale preferences. We will also see how to provide resources (images and videos) based on these preferences. Finally, we will use common .NET practices to format dates, currencies, and numbers.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch13lvl1sec113"/>Creating an app for different languages</h1></div></div></div><p>In this <a id="id730" class="indexterm"/>recipe, we will create an app that will support two different languages.</p><div><div><div><div><h2 class="title"><a id="ch13lvl2sec456"/>Getting ready</h2></div></div></div><p>Create a new <strong>Single View Application</strong> in Xamarin Studio and name it <code class="literal">MultipleLanguageApp</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch13lvl2sec457"/>How to do it...</h2></div></div></div><p>Perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Add two labels on the view of <code class="literal">MultipleLanguageAppViewController</code>.</li><li class="listitem">Add two folders to the project. Name them <code class="literal">en.lproj</code> and <code class="literal">es.lproj</code>, respectively.</li><li class="listitem">Add a plain text file in the <code class="literal">en.lproj</code> folder and name it <code class="literal">Localizable.strings</code>. Enter the following in the file and save it:<div><pre class="programlisting">// Localized output on MultipleLanguageAppViewController
"Have a nice day!" = "Have a nice day!";</pre></div></li><li class="listitem">Add <a id="id731" class="indexterm"/>another plain text file in the <code class="literal">es.lproj</code> folder and name it the same as before: <code class="literal">Localizable.strings</code>. Enter the following in the file and save it:<div><pre class="programlisting">// Localized output on MultipleLanguageAppViewController
"Have a nice day!" = "¡Qué tenga un buen día!";</pre></div></li><li class="listitem">Enter the following code in the <code class="literal">MultipleLanguageAppViewController</code> class:<div><pre class="programlisting">public override void ViewWillAppear (bool animated)
{
  base.ViewWillAppear (animated);
  this.lblLocale.Text = string.Format("Locale: {0} - Language: {1}", NSLocale.CurrentLocale.LocaleIdentifier, NSLocale.PreferredLanguages[0]);
  string resourcePath = NSBundle.MainBundle.PathForResource(NSLocale.PreferredLanguages[0], "lproj");
  NSBundle localeBundle = NSBundle.FromPath(resourcePath);
  this.lblLocalizedOutput.Text = localeBundle.LocalizedString("Have a nice day!", "Localized output on MultipleLanguageAppViewController");
}</pre></div></li><li class="listitem">Through the settings app on the simulator, set the language to English (if it is not set already) and run the app. The message will be displayed in English. Try setting the language of the simulator to Spanish (<strong>Español</strong>) and run the app again. The message will be displayed in Spanish.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch13lvl2sec458"/>How it works...</h2></div></div></div><p>To make it easy for developers to provide support for multiple languages in apps, iOS reads text in different languages from the corresponding language folder. In this app, we support both English and Spanish. Their corresponding folders are <code class="literal">en.lproj</code> and <code class="literal">es.lproj</code>, respectively. When we call the <code class="literal">LocalizedString</code> method, it looks for and parses the <code class="literal">Localizable.strings</code> file to return the appropriate text.</p><p>The<a id="id732" class="indexterm"/> contents of the string files are defined by a set of quoted key-value pairs in a C style syntax, ending each set with a semicolon, as shown in the following code:</p><div><pre class="programlisting">// Localized output on MultipleLanguageAppViewController
"Have a nice day!" = "¡Qué tenga un buen día!";</pre></div><p>As you can see, we can also provide comments to assist the job of the person who will translate the text, even if we do it ourselves.</p><p>The <code class="literal">NSLocale.PreferredLanguages</code> static property returns a string array of the user's preferred language identifiers. The first item in this array is the currently selected language. If the selected language is English, it will return <code class="literal">en</code>; if it is Spanish, it will return <code class="literal">es</code>, and so on.</p><div><div><h3 class="title"><a id="note59"/>Note</h3><p>Both these language codes are based on the ISO 639-1 standard. The three-letter ISO 639-2 standard is also supported. A list of all the available language codes can be found at <a class="ulink" href="http://www.loc.gov/standards/iso639-2/php/code_list.php">http://www.loc.gov/standards/iso639-2/php/code_list.php</a>.</p></div></div><p>The <code class="literal">NSBundle.PathForResource</code> method returns the path of the app bundle for the parameters we pass to it. We use this path to get the appropriate <code class="literal">NSBundle</code> instance, according to the selected language, as follows:</p><div><pre class="programlisting">string resourcePath = NSBundle.MainBundle.PathForResource(NSLocale.PreferredLanguages[0], "lproj");
NSBundle localeBundle = NSBundle.FromPath(resourcePath);</pre></div><p>We then call the <code class="literal">LocalizedString</code> method to display the appropriate text, as follows:</p><div><pre class="programlisting">this.lblLocalizedOutput.Text = localeBundle.LocalizedString("Have a nice day!", "Localized output on MultipleLanguageAppViewController");</pre></div><p>The first parameter's purpose is dual. It is both the key to look for in order to return the translated text and also the text that will be displayed in case the specified localization path is not found. The second parameter is the comment or any instruction we want to give to the translator. It is not displayed and basically not used. We can pass null to this parameter, and no error will occur. However, it is wise to always include a comment or instruction since it will help avoid confusion when translating multiple strings.</p></div><div><div><div><div><h2 class="title"><a id="ch13lvl2sec459"/>There's more...</h2></div></div></div><p>It is advised to always provide keys that can act as the fallback text to be displayed in English, in case the language that the user has selected is not included in our app.</p><p>However, the <code class="literal">LocalizedString</code> method is overloaded. The second overload accepts three parameters. Consider the following example:</p><div><pre class="programlisting">this.lblLocalizedOutput.Text = localeBundle.LocalizedString("Have a nice day!", "Have a nice day!", "Localizable");</pre></div><p>The<a id="id733" class="indexterm"/> first parameter is the key to look for. The second parameter is the fallback value in case the specified localization path is not found. The third parameter is the name of the file containing the strings without the <code class="literal">.strings</code> extension. This overload is more helpful, and we can use different keys for our strings, which will help us identify where that particular string is used in the code. For example, in this case, we could set the key in the strings file to <code class="literal">MultipleLanguageAppViewController.lblLocalizedOutput</code>:</p><div><pre class="programlisting">// Localized output on MainController
"MultipleLanguageAppViewController.lblLocalizedOutput" = "Have a nice day!";</pre></div><p>Then, use it in our code as follows:</p><div><pre class="programlisting">this.lblLocalizedOutput.Text = localeBundle.LocalizedString("MultipleLanguageAppViewController.lblLocalizedOutput", "Have a nice day!", "Localizable");</pre></div><p>This overload also helps us to separate our strings into multiple <code class="literal">.strings</code> files, passing the corresponding filename as the third parameter.</p><p>The last overload contains four parameters. The first three are the same as the second overload. The fourth parameter is simply the comment that we want the particular string to have.</p><div><div><div><div><h3 class="title"><a id="ch13lvl3sec112"/>Localization in real-world app scenarios</h3></div></div></div><p>In this example, we use the <code class="literal">PathForResource</code> method to get an instance of the current locale<a id="id734" class="indexterm"/> bundle. This is because the values returned from the <code class="literal">LocalizedString</code> method are cached. In real-world app scenarios, where the app would be downloaded in a specific language and the user would most likely never change the language of the device to use it, just calling <code class="literal">NSBundle.MainBundle.LocalizedString</code> would be enough.</p></div><div><div><div><div><h3 class="title"><a id="ch13lvl3sec113"/>The localizable.strings encoding</h3></div></div></div><p>The <a id="id735" class="indexterm"/>encoding of the <code class="literal">Localizable.strings</code> file should always be either UTF-8 or UTF-16.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch13lvl1sec114"/>Localizable resources</h1></div></div></div><p>A localizable resource<a id="id736" class="indexterm"/> is content, such as images and sound files, which is specific to a locale. In this recipe, we will learn how to load and display resources based on the user's localization preferences.</p><div><div><div><div><h2 class="title"><a id="ch13lvl2sec460"/>Getting ready</h2></div></div></div><p>Create a new <strong>Single View Application</strong> in Xamarin Studio and name it <code class="literal">LocalizableResourcesApp</code>. Add a label and a <code class="literal">UIImageView</code> on the view of <code class="literal">LocalizableResourcesAppViewController</code>. Two different images will also be needed, one for each locale. The images of USA and Spain are used in this example.</p></div><div><div><div><div><h2 class="title"><a id="ch13lvl2sec461"/>How to do it...</h2></div></div></div><p>Perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Add two folders for the English and Spanish locales to the project (<code class="literal">en.lproj</code> and <code class="literal">es.lproj</code>).</li><li class="listitem">Add one image in each folder. Make sure that the filename for the images is the same within both the folders.</li><li class="listitem">Enter the following code in the <code class="literal">LocalizableResourcesAppViewController</code> class:<div><pre class="programlisting">public override void ViewWillAppear (bool animated)
{
  base.ViewWillAppear (animated);
  this.lblLocale.Text = NSLocale.PreferredLanguages[0];
  this.imageView.Image = UIImage.FromFile(NSBundle.MainBundle.PathForResource("flag", "jpg"));
}</pre></div></li><li class="listitem">Compile and run the app on the simulator with English as the language selected in the <em>Settings</em> app. The result should be similar to the following screenshot:<div><img src="img/8924OT_13_01.jpg" alt="How to do it..."/></div></li><li class="listitem">Now, set<a id="id737" class="indexterm"/> the simulator's language to Spanish and run the app again. The Spanish flag should be displayed instead, as shown in the following screenshot:<div><img src="img/8924OT_13_02.jpg" alt="How to do it..."/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch13lvl2sec462"/>How it works...</h2></div></div></div><p>The <code class="literal">PathForResource</code> method automatically searches for the appropriate language folder and<a id="id738" class="indexterm"/> loads the resource specified through its arguments. In this example, we pass the method's result to the <code class="literal">UIImage.FromFile</code> method in order to load the image and assign it to the image view's <code class="literal">Image</code> property.</p></div><div><div><div><div><h2 class="title"><a id="ch13lvl2sec463"/>There's more...</h2></div></div></div><p>Apart from images, we can use the <code class="literal">PathForResource</code> method to load videos, PDF files, and any other localizable resource we need.</p><div><div><div><div><h3 class="title"><a id="ch13lvl3sec114"/>More information on localizable resources</h3></div></div></div><p>We need to<a id="id739" class="indexterm"/> make sure the resource for the specific language folder exists. If it does not, an exception will occur. A way to avoid this is to add one universal image file in the project and use a <code class="literal">Localizable.strings</code> file inside each language folder, which contains the paths to the resources, as shown in the following code:</p><div><pre class="programlisting">// US flag image
"flag_path"="en.lproj/flag.jpg";</pre></div><p>To load the appropriate flag, we load the image with the <code class="literal">LocalizedString</code> method, as follows:</p><div><pre class="programlisting">this.Image = UIImage.FromFile(NSBundle.MainBundle.LocalizedString("flag_path", "path/to/universal/image.jpg", "Localizable");</pre></div><p>This way, the <code class="literal">image.jpg</code> image will be loaded if the corresponding language folder is not found.</p></div></div><div><div><div><div><h2 class="title"><a id="ch13lvl2sec464"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Creating an app for different languages</em> recipe</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch13lvl1sec115"/>Regional formatting</h1></div></div></div><p>Regional formatting<a id="id740" class="indexterm"/> is the manner in which various information, such as currency, date, and time is displayed according to the different regions of the world. In this recipe, we will discuss how to display formatted numbers and dates according to the user's regional formatting settings.</p><div><div><div><div><h2 class="title"><a id="ch13lvl2sec465"/>Getting ready</h2></div></div></div><p>Create a new <strong>Single View Application</strong> in Xamarin Studio and name it <code class="literal">RegionalFormattingApp</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch13lvl2sec466"/>How to do it...</h2></div></div></div><p>Perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Add five labels on the view of <code class="literal">RegionalFormattingAppViewController</code>.</li><li class="listitem">Enter the following code in the <code class="literal">RegionalFormattingAppViewController</code> class:<div><pre class="programlisting">public override void ViewDidAppear (bool animated)
{
  base.ViewDidAppear (animated);
  this.lblLocale.Text = string.Format("Locale: {0}", NSLocale.CurrentLocale.LocaleIdentifier);
  this.lblDate.Text = string.Format("Date: {0}", DateTime.Now.ToLongDateString());
  this.lblTime.Text = string.Format("Time: {0}", DateTime.Now.ToLongTimeString());
  this.lblCurrency.Text = string.Format("Currency: {0:c}", 250);
  this.lblNumber.Text = string.Format("Number: {0:n}", 1350);
}</pre></div></li><li class="listitem">Compile <a id="id741" class="indexterm"/>and run the app on the simulator with regional formatting set to <strong>United States</strong> and <strong>Spanish</strong> | <strong>Spain</strong> under <strong>Settings</strong> | <strong>General</strong> | <strong>International</strong> | <strong>Region Format</strong>. The output for the United States regional format will be similar to what is shown in the following screenshot:<div><img src="img/8924OT_13_03.jpg" alt="How to do it..."/></div><p>The output for the Spanish regional format will be similar to what is shown in the following screenshot:</p><div><img src="img/8924OT_13_04.jpg" alt="How to do it..."/></div></li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch13lvl2sec467"/>How it works...</h2></div></div></div><p>To format <a id="id742" class="indexterm"/>dates, currencies, and numbers, we use the standard .NET code. For date and time, the <code class="literal">DateTime.ToLongDateString</code> and <code class="literal">DateTime.ToLongTimeString</code> methods, respectively, return the values according to the locale.</p><p>For currency and numbers, we use C# numerical strings, as shown in the following code:</p><div><pre class="programlisting">this.lblCurrency.Text = string.Format("Currency: {0:c}", 250);
this.lblNumber.Text = string.Format("Number: {0:n}", 1350);</pre></div></div><div><div><div><div><h2 class="title"><a id="ch13lvl2sec468"/>There's more...</h2></div></div></div><p>The <code class="literal">System.Globalization</code> namespace is supported in Xamarin.iOS. To display the current locale, consider the following line of code:</p><div><pre class="programlisting">Console.WriteLine(CultureInfo.CurrentCulture.Name);</pre></div><p>Note that there is one difference between the preceding code and <code class="literal">NSLocale.CurrentLocale.LocaleIdentifier</code>. The former uses a dash (<code class="literal">-</code>), while the latter <a id="id743" class="indexterm"/>uses an underscore (<code class="literal">_</code>) in the locale name.</p></div></div></body></html>