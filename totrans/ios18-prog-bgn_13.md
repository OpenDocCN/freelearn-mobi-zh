# 11

# 构建你的用户界面

在上一章中，你修改了一个现有的 Xcode 项目，向你的应用添加了一个标签栏，允许用户在日记列表和地图屏幕之间进行选择，并配置了标签栏按钮的标题和图标。当你的应用启动时，显示的是日记列表屏幕，但它目前是空的。

正如你在第 10 章*设置用户界面*中的应用游览中看到的那样，日记列表屏幕应显示一个表格视图，显示表格视图单元格中的日记条目列表。

在本章中，你将使日记列表屏幕显示一个包含 10 个空表格视图单元格的表格视图，以及一个按钮，当点击时将显示一个表示添加新日记条目屏幕的视图。你还将配置一个**取消**按钮来关闭此视图并返回到日记列表屏幕。

你将在你的应用中添加少量代码，但不用担心太多——你将在本书的下一部分中了解更多关于它的内容。

到本章结束时，你将学会如何向故事板场景添加视图控制器，将视图控制器中的输出连接到场景，设置表格视图单元格，并以模态方式呈现视图控制器。这在你设计自己的应用的用户界面时将非常有用。

本章将涵盖以下主题：

+   将表格视图添加到日记列表屏幕

+   将故事板元素连接到视图控制器

+   为表格视图配置数据源方法

+   以模态方式呈现视图

# 技术要求

你将继续在上一章中创建的 `JRNL` Xcode 项目上工作。

本章的完成 Xcode 项目位于本书代码包的 `Chapter11` 文件夹中，可以在此处下载：

[https://github.com/PacktPublishing/iOS-18-Programming-for-Beginners-Ninth-Edition](https://github.com/PacktPublishing/iOS-18-Programming-for-Beginners-Ninth-Edition%0D)

查看以下视频以查看代码的实际效果：

[https://youtu.be/EsDaVgrGLus](https://youtu.be/EsDaVgrGLus%0D)

让我们从向日记列表屏幕添加表格视图开始，该表格视图最终将显示日记条目列表。

# 将表格视图添加到日记列表屏幕

正如你在应用游览中看到的那样，*JRNL* 应用在表格视图中显示日记条目。表格视图是 `UITableView` 类的一个实例。它显示一列单元格。表格视图中的每个单元格都是一个表格视图单元格，它是 `UITableViewCell` 类的一个实例。在本节中，你将首先在 `Main` 故事板文件中为日记列表屏幕的视图控制器场景添加一个表格视图，然后你将添加自动布局约束使其填充整个屏幕。

有关自动布局及其使用方法的更多信息，请访问 [https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/](https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/)。

打开您在前一章中创建的*JRNL*项目并运行应用程序，以确保一切仍然按预期工作，然后按照以下步骤操作：

1.  在项目导航器中点击**主**故事板文件，选择代表期刊列表屏幕的视图控制器场景，然后点击库按钮：

![图片](img/B31371_11_01.png)

图11.1：显示库按钮的工具栏

1.  库将出现。在过滤器字段中输入`table`。**表格视图**对象将作为结果之一出现。将其拖动到期刊列表屏幕视图控制器场景的中间：

![图片](img/B31371_11_02.png)

图11.2：选择表格视图对象的库

表格视图已添加，但它只占据了屏幕的一小部分。如前一章中的应用程序导游所示，它应该填充整个屏幕。

1.  您将使用**自动布局添加新约束**按钮将表格视图的边缘绑定到其封装视图的边缘。确保表格视图被选中，然后点击自动布局添加新约束按钮：

![图片](img/B31371_11_03.png)

图11.3：选择表格视图的视图控制器场景

1.  在顶部、左侧、右侧和底部边缘约束字段中输入`0`，然后点击所有浅红色支柱。确保所有支柱都已变为亮红色。点击**添加4个约束**按钮：

![图片](img/B31371_11_04.png)

图11.4：添加新约束的自动布局弹出对话框

这将设置表格视图边缘与封装视图边缘之间的空间为0，将表格视图的边缘绑定到封装视图的边缘。现在表格视图将填充屏幕，无论设备方向如何。

1.  确认表格视图的四面现在都已绑定到屏幕边缘，如下面的截图所示：

![图片](img/B31371_11_05.png)

图11.5：表格视图填充屏幕的视图控制器场景

您已将表格视图添加到期刊列表屏幕视图控制器场景的视图中，并使用自动布局约束使其填充整个屏幕，但构建并运行您的应用程序时，期刊列表屏幕仍然会保持空白。

在下一节中，您将实现`JournalListViewController`类的代码，并将此类的出口连接到期刊列表屏幕上的UI元素。这将使`JournalListViewController`类的一个实例能够控制期刊列表屏幕显示的内容。

# 将故事板元素连接到视图控制器

您已将表格视图添加到期刊列表屏幕，但它目前还没有显示任何内容。您需要修改现有的视图控制器以在期刊列表屏幕中管理表格视图。当您创建`JRNL`项目时，Xcode自动创建了`ViewController`文件。

它包含了名为 `ViewController` 的 `UIViewController` 子类的声明和定义，并且这个类目前被设置为 Journal List 屏幕的视图控制器。你需要在 `ViewController` 文件中将类的名称更改为 `JournalListViewController`，并为之前添加到视图控制器场景中的表格视图创建一个出口。按照以下步骤操作：

1.  在项目导航器中点击 **ViewController** 文件。在编辑区域，右键点击类名，选择 **重构** | **重命名**...

![](img/B31371_11_06.png)

图 11.6：编辑区域显示带有重命名...高亮的弹出菜单

1.  将类名更改为 `JournalListViewController` 并点击 **重命名**：

![](img/B31371_11_07.png)

图 11.7：显示 ViewController 类新名称的编辑区域

1.  确认类名和文件名都已更改为 **JournalListViewController**：

![](img/B31371_11_08.png)

图 11.8：文件名和类名都更改为 JournalListViewController

1.  在项目导航器中点击 **Main** 故事板文件，并在文档大纲中选择第一个 **Journal Scene**（包含表格视图的那个）。

![](img/B31371_11_09.png)

图 11.9：文档大纲显示已选择第一个 Journal Scene

1.  点击身份检查器按钮，并确认在 **自定义类** 下，**类** 设置为 **JournalListViewController**：

![](img/B31371_11_10.png)

图 11.10：身份检查器中类设置为 JournalListViewController

这意味着 Journal List 屏幕的内容由 `JournalListViewController` 类的一个实例管理。

1.  点击导航器和检查器按钮以隐藏导航器和检查器区域，以便有更多空间工作：

![](img/B31371_11_11.png)

图 11.11：工具栏显示导航器和检查器按钮

1.  点击调整编辑器选项按钮，并从弹出菜单中选择 **辅助**：

![](img/B31371_11_12.png)

图 11.12：调整编辑器选项菜单中已选择辅助

这将在辅助编辑器中显示与此场景关联的任何 Swift 文件。如你所见，**Main** 故事板文件的内容显示在编辑区域的左侧，而 `JournalListViewController` 类的定义显示在右侧。

1.  查看代码上方的小条，确认 **JournalListViewController.swift** 已被选中：

![](img/B31371_11_13.png)

图 11.13：显示已选择的 JournalListViewController.swift

如果你没有看到 **JournalListViewController.swift** 被选中，点击条并从弹出菜单中选择 **JournalListViewController.swift**。

1.  要将 Journal 场景中的表格视图连接到 `JournalListViewController` 类中的出口，从表格视图 *Ctrl* + *拖动* 到类名声明下方的 `JournalListViewController` 文件：

![](img/B31371_11_14.png)

图 11.14：显示拖拽目标位置的编辑区域

你也可以从文档大纲中的表格视图拖动。

1.  将会弹出一个小的弹出对话框。在 **名称** 文本框中输入出口名称，`tableView`，将 **存储** 设置为 **强**，然后点击 **连接**：

![](img/B31371_11_15.png)

图 11.15：出口创建的弹出对话框

1.  验证 `tableView` 出口声明是否已自动添加到 `JournalListViewController` 类。完成此操作后，点击 **x** 关闭辅助编辑器窗口：

![](img/B31371_11_16.png)

图 11.16：显示 tableView 出口的编辑区域

`JournalListViewController` 类现在在 **Journal List** 屏幕中有一个出口，`tableView`。这意味着一个 `JournalListViewController` 实例可以管理表格视图显示的内容。

使用 *Ctrl* + *拖动* 从故事板场景中的元素拖动到文件时，经常会出错。如果你在这个过程中出错，这可能会导致应用启动时崩溃。为了检查表格视图和 `JournalListViewController` 类之间的连接是否存在错误，请按照以下步骤操作：

1.  点击导航器和检查器按钮以显示导航器和检查器区域。

1.  在 **Journal Scene** 中选择 **Journal**，然后点击连接检查器按钮：

![](img/B31371_11_17.png)

图 11.17：选择连接检查器

连接检查器显示你的 UI 对象和代码之间的链接。你将在 **出口** 部分看到 **tableView** 出口连接到表格视图。

1.  如果你看到一个微小的黄色警告图标，点击 **x** 来断开连接：

![](img/B31371_11_18.png)

图 11.18：显示带有黄色警告图标的 tableView 出口的连接检查器

1.  在 **出口** 下，从 **tableView** 出口拖动到表格视图以重新建立连接：

![](img/B31371_11_19.png)

图 11.19：显示要连接的表格视图的编辑区域

如果你需要在创建后更改代码中的出口名称，右键单击出口名称，然后从弹出菜单中选择 **重构** | **重命名** 而不是手动更改，以避免错误。

你已经在 `JournalListViewController` 类中成功创建了一个用于表格视图的出口。做得好！

要在屏幕上显示表格视图单元格，你需要通过向 `JournalListViewController` 类添加一些代码来实现表格视图的数据源方法。你将在下一节中这样做。

# 配置表格视图的数据源方法

当您的应用运行时，`JournalListViewController` 类的一个实例充当 Journal 列表屏幕的视图控制器。它负责加载和显示该屏幕上的所有视图，包括您之前添加的表格视图。表格视图需要知道要显示多少个表格视图单元格以及每个单元格中要显示什么。通常，视图控制器负责提供这些信息。苹果为这个目的创建了一个协议，`UITableViewDataSource`。您需要做的只是将表格视图的 `dataSource` 属性设置为 `JournalListViewController` 类，并实现此协议的必需方法。

表格视图还需要知道如果用户点击表格视图单元格时应该做什么。同样，表格视图的视图控制器负责此事，而苹果为这个目的创建了 `UITableViewDelegate` 协议。您将设置表格视图的 `delegate` 属性为 `JournalListViewController` 类，但您目前不会实现此协议中的任何方法。

协议在 *第 8 章*，*协议、扩展和错误处理* 中有所介绍。

您在本章中需要输入少量代码。不用担心它的含义；您将在本书的 *第 3 部分* 中学习更多关于表格视图控制器及其相关协议的内容。

在下一节中，您将使用连接检查器将表格视图的 `dataSource` 和 `delegate` 属性分配给 `JournalListViewController` 类中的输出。

## 设置表格视图的委托和数据源属性

`JournalListViewController` 类的一个实例将提供表格视图将显示的数据，以及当用户与表格视图交互时将执行的方法。为了使这生效，您需要将表格视图的 `dataSource` 和 `delegate` 属性连接到 `JournalListViewController` 类中的输出。按照以下步骤操作：

1.  如果您还没有这样做，请点击导航器和检查器按钮以再次显示导航器和检查器区域。

1.  **主**故事板文件仍然被选中。在文档大纲中选择 **Journal Scene** 的 **表格视图**，然后点击连接检查器按钮。在 **输出** 部分，您将在 **dataSource** 和 **delegate** 输出旁边看到两个空圆圈。从每个空圆圈拖动到文档大纲中的 **Journal** 图标：

![图片](img/B31371_11_20.png)

图 11.20：连接检查器显示 dataSource 和 delegate 输出

1.  验证表格视图的 `dataSource` 和 `delegate` 属性是否已连接到 `JournalListViewController` 类中的输出：

![图片](img/B31371_11_21.png)

图 11.21：已设置 dataSource 和 delegate 输出的连接检查器

在下一节中，你将添加一些代码，使 `JournalListViewController` 类符合 `UITableViewDataSource` 协议，并在运行你的应用时配置表格视图以显示 10 个表格视图单元格。

## 采用 UITableViewDataSource 和 UITableViewDelegate 协议

到目前为止，你已经使 `JournalListViewController` 类成为表格视图的数据源和代理。下一步是使其采用 `UITableViewDataSource` 和 `UITableViewDelegate` 协议并实现任何必需的方法。你还将更改表格视图单元格的颜色，使它们在屏幕上可见。按照以下步骤操作：

1.  在文档大纲中点击 **表格视图** 并点击属性检查器按钮。在 **表格视图** 下，将 **原型单元格** 的数量更改为 `1`：

![图片](img/B31371_11_22.png)

图 11.22：属性检查器显示原型单元格设置为 1

1.  在文档大纲中点击 **表格视图** 旁边的 **>** 按钮，以显示 **表格视图单元格**：

![图片](img/B31371_11_23.png)

图 11.23：文档大纲显示 > 按钮

这表示表格视图将显示的表格视图单元格。

1.  在文档大纲中点击 **表格视图单元格**。在 **表格视图单元格** 下的 **属性检查器** 中，将 **标识符** 设置为 `journalCell` 并按 *Enter* 键：

![图片](img/B31371_11_24.png)

图 11.24：属性检查器中已设置标识符

文档大纲中的 **表格视图单元格** 名称将更改为 **journalCell**。

1.  在 **视图** 下的属性检查器中，将 **背景** 设置为 **系统青色**，这样在运行应用时可以轻松看到表格视图单元格：

![图片](img/B31371_11_25.png)

图 11.25：属性检查器中表格视图单元格背景色已设置

1.  在项目导航器中点击 **JournalListViewController** 文件。在类声明之后输入以下代码，使 `JournalListViewController` 类采用 `UITableViewDataSource` 和 `UITableViewDelegate` 协议：

    [PRE0]

几秒钟后，将出现一个错误：

![图片](img/B31371_11_26.png)

图 11.26：编辑区域显示错误

1.  点击它以显示错误信息。错误信息显示 **类型‘JournalListViewController’不符合协议‘UITableViewDataSource’**。**添加符合性的占位符**：

![图片](img/B31371_11_27.png)

图 11.27：显示错误信息的编辑区域

这意味着你需要实现 `UITableViewDataSource` 协议的必需方法，以使 `JournalListViewController` 符合该协议。

1.  点击 **修复** 以自动将必需方法的占位符添加到 `JournalListViewController` 类中。

1.  验证两个必需的 `UITableViewDataSource` 协议方法占位符已自动插入到 `JournalListViewController` 类中，如图所示：

![图片](img/B31371_11_28.png)

图 11.28：显示 UITableViewDataSource 方法占位符的编辑区域

第一个方法告诉表格视图显示多少个单元格，而第二个方法告诉表格视图在每个表格视图单元格中显示什么。

1.  将第一个方法中的占位符文本替换为`10`（如果只是一行代码，则`return`关键字是可选的）。这告诉表格视图显示10个单元格：

![](img/B31371_11_29.png)

图11.29：显示显示10个表格视图单元格的代码的编辑区域

1.  将第二个方法中的占位符文本替换为以下代码：

    [PRE1]

![](img/B31371_11_30.png)

图11.30：显示为每行显示一个表格视图单元格的代码的编辑区域

不要担心这现在意味着什么，因为您将在第3部分“表格视图”中学习更多关于表格视图的内容。

1.  构建并运行您的应用。模拟器将显示10个青色表格视图单元格的列，如图所示：

![](img/B31371_11_31.png)

图11.31：显示10个表格视图单元格的模拟器

正如您在第10章“设置用户界面”的应用程序游览中看到的那样，屏幕右上角应该有一个**+**按钮。您将在下一节中添加此按钮。

# 以模态方式呈现视图

期刊列表屏幕的导航栏可以配置为显示标题和按钮。您已经在第10章“设置用户界面”中配置了标题。现在您将向导航栏添加并配置一个栏按钮项。当点击时，此按钮将显示一个表示添加新期刊条目屏幕的视图。此视图将来自一个嵌入在导航控制器中的新视图控制器场景，您将将其添加到项目中。视图将以模态方式呈现，这意味着在它被关闭之前，您将无法执行其他任何操作。

要关闭它，您将在视图的导航栏中添加一个**取消**按钮。您还将添加一个**保存**按钮，但您将在第16章“在视图控制器之间传递数据”中实现其功能。让我们先在下一节中将库中的栏按钮项添加到导航栏中。

## 向导航栏添加栏按钮

正如第10章“设置用户界面”的应用程序游览中所示，屏幕右上角有一个**+**按钮。为了实现这一点，您将向期刊列表屏幕的导航栏添加一个栏按钮项。按照以下步骤操作：

1.  在项目导航器中单击**Main**故事板文件。确保在文档大纲中选择第一个**Journal Scene**。单击库按钮以显示库：

![](img/B31371_11_32.png)

图11.32：显示库按钮的工具栏

1.  在过滤器字段中键入`bar b`。一个**栏按钮项**对象将出现在结果中。将栏按钮对象拖到导航栏的右侧：

![](img/B31371_11_33.png)

图11.33：选择栏按钮项对象的库

1.  在选择栏按钮后，单击属性检查器按钮。在**栏按钮项**下，将**系统项**设置为**添加**：

![](img/B31371_11_34.png)

图11.34：将系统项设置为添加的属性检查器

你现在在导航栏中有一个 **+** 按钮。在下一节中，你将添加一个视图控制器场景来表示当按钮被点击时出现的添加新日记条目屏幕。

## 添加新的视图控制器场景

如 *第 10 章* 中应用程序浏览所示，在 *设置用户界面* 时，当你点击导航栏中的 **+** 按钮时，将显示添加新日记条目屏幕。你将在项目中添加一个新的视图控制器场景来表示此屏幕。按照以下步骤操作：

1.  点击库按钮以显示库，并在过滤器字段中输入 `view con`。**视图控制器** 对象将在搜索结果中。将 **视图控制器** 对象拖放到故事板中：

![](img/B31371_11_35.png)

图 11.35：库中已选择视图控制器对象

1.  将视图控制器放置在 **日记** 场景的右侧：

![](img/B31371_11_36.png)

图 11.36：显示视图控制器场景与日记场景并排的编辑区域

1.  选择新添加的视图控制器场景。在文档大纲中，点击此场景的 **视图控制器** 图标：

![](img/B31371_11_37.png)

图 11.37：选择视图控制器的文档大纲

1.  你将需要为 **取消** 和 **保存** 按钮留出空间，因此你将在这个视图控制器场景中嵌入导航控制器以提供一个可以放置按钮的导航栏。从 **编辑** 菜单中选择 **嵌入** | **导航控制器**。

1.  验证是否在视图控制器场景左侧出现了一个导航控制器场景：

![](img/B31371_11_38.png)

图 11.38：显示嵌入在导航控制器中的视图控制器场景的编辑区域

1.  在文档大纲中点击新视图控制器场景的 **导航项**。在属性检查器中，在 **导航项** 下，将 **标题** 设置为 `新条目`：

![](img/B31371_11_39.png)

图 11.39：属性检查器中标题设置为“新条目”

导航项的名称将更改为 **新条目**。

1.  *Ctrl* + *拖动*从按钮到导航控制器场景：

![](img/B31371_11_40.png)

图 11.40：显示拖动目标的编辑区域

1.  将出现切换弹出菜单。选择 **以模态方式呈现**：

![](img/B31371_11_41.png)

图 11.41：选择“以模态方式呈现”的切换弹出菜单

当按钮被点击时，这会使视图控制器视图从屏幕底部向上滑动。在此视图关闭之前，你无法与其他任何视图进行交互。

1.  验证是否有一个切换将 **日记** 场景和 **导航控制器** 场景连接在一起：

![](img/B31371_11_42.png)

图 11.42：显示从日记场景到导航控制器场景的切换的编辑区域

1.  构建并运行你的应用。点击 **+** 按钮，新的视图控制器视图将从屏幕底部向上滑动：

![](img/B31371_11_43.png)

图 11.43：模拟器显示新的视图控制器视图

目前您只能通过向下拖动来取消此视图。在下一节中，您将在导航栏中添加一个**取消**按钮，并编程使其取消视图。您还会添加一个**保存**按钮，但暂时不会对其进行编程。

## 在导航栏中添加取消和保存按钮

如您之前所见，将视图控制器嵌入导航控制器的一个好处是屏幕顶部的导航栏。您可以在其左右两侧放置按钮。按照以下步骤将**取消**和**保存**按钮添加到导航栏：

1.  点击文档轮廓中**新条目**场景的**导航项**。点击**图书馆**按钮：

![图片](img/B31371_11_44.png)

图11.44：显示图书馆按钮的工具栏

1.  在过滤器字段中输入`bar b`，并将**栏按钮项**对象拖到导航栏的每一侧：

![图片](img/B31371_11_45.png)

图11.45：选中栏按钮项对象的图书馆

1.  点击右侧的**项目**按钮。在**栏按钮项**的属性检查器下，将**样式**设置为**完成**，并将**系统项**设置为**保存**：

![图片](img/B31371_11_46.png)

图11.46：将样式设置为完成并将系统项设置为保存的属性检查器

1.  点击左侧的**项目**按钮，并将**系统项**设置为**取消**：

![图片](img/B31371_11_47.png)

图11.47：将系统项设置为取消的属性检查器

请记住，导航控制器有一个属性，`viewControllers`，它包含一个视图控制器数组。当您在期刊列表屏幕上点击**+**按钮时，新的视图控制器将被添加到`viewControllers`数组中，其视图从屏幕底部出现，覆盖期刊列表屏幕，唯一取消视图的方法是向下拖动。

1.  要使**取消**按钮能够取消视图，您需要将**取消**按钮链接到场景退出，并在`JournalListViewController`类中实现一个方法，该方法将在期刊列表屏幕重新出现时执行。在项目导航器中，点击**JournalListViewController**文件，并在文件底部在最后的闭合花括号之前添加以下方法：

    [PRE2]

1.  在项目导航器中，点击**主**故事板文件，并在**新条目**场景中点击**取消**按钮。在文档轮廓中，*Ctrl* + *拖动*从**取消**按钮到场景退出图标，并从弹出菜单中选择**unwindNewEntryCancelWithSegue:**：

![图片](img/B31371_11_48.png)

图11.48：文档轮廓显示正在设置取消按钮动作

当您的应用运行时，点击**取消**按钮将从导航控制器的`viewControllers`数组中移除视图控制器，取消所呈现的模态视图，并执行`unwindNewEntryCancel(segue:)`方法。请注意，此方法目前没有任何操作。

1.  构建并运行你的应用程序，点击Journal List屏幕导航栏中的**+**按钮。新视图将出现。当你点击**取消**按钮时，新视图将消失：

![](img/B31371_11_49.png)

图11.49：模拟器显示的取消按钮

恭喜！你已经完成了Journal List屏幕的基本结构！

# 摘要

在本章中，你将表格视图添加到主Storyboard文件中的Journal List屏幕，并修改现有的视图控制器类以实现`JournalListViewController`类。然后，你修改了`JournalListViewController`类，使其在Storyboard中有一个表格视图出口，并使其成为表格视图的数据源和代理。最后，你添加了一个按钮来显示第二个视图，并配置了一个**取消**按钮来关闭它。

到目前为止，你应该已经熟练使用Interface Builder向Storyboard场景添加视图和视图控制器，将视图控制器出口链接到Storyboard中的UI元素，设置表格视图，以及以模态方式显示视图。当你设计自己的应用程序的用户界面时，这将非常有用。

在下一章中，你将实现应用程序的Journal Entry Detail屏幕，并为Map屏幕实现一个地图视图。

# 加入我们的Discord！

与其他用户、专家以及作者本人一起阅读这本书。提出问题，为其他读者提供解决方案，通过“问我任何问题”的环节与作者聊天，以及更多。扫描二维码或访问链接加入社区。

[https://packt.link/ios-Swift](https://packt.link/ios-Swift%0D)

[![](img/QR_Code2370024260177612484.png)](https://packt.link/ios-Swift%0D)
