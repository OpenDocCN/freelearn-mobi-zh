<html><head></head><body><div id="book-content"><div id="sbo-rt-content"><div id="_idContainer506" class="Basic-Text-Frame">
    <h1 class="chapterNumber">21</h1>
    <h1 id="_idParaDest-267" class="chapterTitle">Getting Started with Search</h1>
    <p class="normal">In the previous chapter, you added a way for the user to get a photo from the camera or photo library, which can be added to a new journal entry.</p>
    <p class="normal">In this chapter, you will <a id="_idIndexMarker896"/>implement a <strong class="keyWord">search bar</strong> for the Journal List screen. You’ll start by modifying the <code class="inlineCode">JournalListViewController</code> class to conform to the <code class="inlineCode">UISearchResultsUpdating</code> protocol and display a search bar on the Journal List screen. Next, you’ll modify the data source methods to display the correct journal entries when the user types in a search term. After that, you’ll modify the <code class="inlineCode">prepare(for:sender:)</code> method to ensure that the correct journal entry details are displayed on the Journal Entry Detail screen. Finally, you’ll modify the method used to delete a journal entry.</p>
    <p class="normal">By the end of this chapter, you’ll have learned how to implement a search bar for your own apps. To name one example, if you were creating a contacts app, you could use a search bar to search for a particular contact.</p>
    <p class="normal">The following topics will be covered in this chapter:</p>
    <ul>
      <li class="bulletList">Implementing a search bar on the Journal List screen</li>
      <li class="bulletList">Modifying table view data source methods</li>
      <li class="bulletList">Modifying the <code class="inlineCode">prepare(for:sender:)</code> method</li>
      <li class="bulletList">Modifying the method to remove journal entries</li>
    </ul>
    <h1 id="_idParaDest-268" class="heading-1">Technical requirements</h1>
    <p class="normal">You will continue working on the <code class="inlineCode">JRNL</code> project that you modified in the previous chapter.</p>
    <p class="normal">The resource files and completed Xcode project for this chapter are in the <code class="inlineCode">Chapter21</code> folder of the code bundle for this book, which can be downloaded here:</p>
    <p class="normal"><a href="https://github.com/PacktPublishing/iOS-18-Programming-for-Beginners-Ninth-Edition%0D"><span class="url">https://github.com/PacktPublishing/iOS-18-Programming-for-Beginners-Ninth-Edition</span></a></p>
    <p class="normal">Check out the following video to see the code in action:</p>
    <p class="normal"><a href="https://youtu.be/hPwG2gfv448%0D"><span class="url">https://youtu.be/hPwG2gfv448</span></a></p>
    <p class="normal">Let’s start by modifying the <code class="inlineCode">JournalListViewController</code> class to conform to the <code class="inlineCode">UISearchResultsUpdating</code> protocol and to display a search bar on the Journal List screen.</p>
    <h1 id="_idParaDest-269" class="heading-1">Implementing a search bar for the Journal List screen</h1>
    <p class="normal">At present, you only have a few entries on the Journal List screen. But the longer you use the app, the more entries you’ll have, and it’s going to be hard to find a specific entry. To make <a id="_idIndexMarker897"/>it easier to look for a <a id="_idIndexMarker898"/>journal entry, you’ll implement a search bar in the navigation bar of the Journal List screen. You will use Apple’s <code class="inlineCode">UISearchController</code> class to do this. This class incorporates a <code class="inlineCode">UISearchBar</code> class that you can install in your user interface. To perform the search, you will adopt the <code class="inlineCode">UISearchResultsUpdating</code> protocol and implement the <code class="inlineCode">updateSearchResults(for:)</code> method required for this protocol.</p>
    <div class="note">
      <p class="normal">To learn <a id="_idIndexMarker899"/>more about the <code class="inlineCode">UISearchController</code> class, see <a href="https://developer.apple.com/documentation/uikit/uisearchcontroller"><span class="url">https://developer.apple.com/documentation/uikit/uisearchcontroller</span></a>.</p>
    </div>
    <p class="normal">You will now add an instance of the <code class="inlineCode">UISearchController</code> class to the <code class="inlineCode">JournalListViewController</code> class, adopt the <code class="inlineCode">UISearchResultsUpdating</code> protocol, and implement the <code class="inlineCode">updateSearchResults(for:)</code> method. Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">In the Project navigator, click the <strong class="screenText">JournalListViewController</strong> file. Add a new extension after all other code in this file to make the <code class="inlineCode">JournalListViewController</code> class conform to the <code class="inlineCode">UISearchResultsUpdating</code> protocol:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">extension</span> <span class="hljs-title">JournalListViewController</span>: <span class="hljs-type">UISearchResultsUpdating</span><span class="hljs-title"> {</span>
<span class="hljs-title">}</span>
</code></pre>
      </li>
      <li class="numberedList">You’ll see an error because the method required to conform to the <code class="inlineCode">UISearchResultsUpdating</code> protocol has not been implemented. Add the following code to the newly added extension to implement it:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// MARK: - Search</span>
<span class="hljs-keyword">func</span> <span class="hljs-template-variable">updateSearchResults</span>(<span class="hljs-template-variable">for</span> <span class="hljs-params">searchController</span>: <span class="hljs-type">UISearchController</span>) {
  <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> searchBarText <span class="hljs-operator">=</span> searchController.<span class="hljs-con-attribute">searchBar</span>.<span class="hljs-con-attribute">text</span>
  <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }
  <span class="hljs-con-attribute">print</span>(searchBarText)
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">Any text you type into the search bar will be printed to the Debug area.</p>
    <ol>
      <li class="numberedList" value="3">Declare <a id="_idIndexMarker900"/>the following <a id="_idIndexMarker901"/>properties in the <code class="inlineCode">JournalListViewController</code> class after the <code class="inlineCode">tableView</code> property:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">var</span> <span class="hljs-template-variable">tableView</span>: <span class="hljs-type">UITableView</span>!
<span class="code-highlight"><strong class="hljs-keyword-slc">private let</strong><strong class="hljs-slc"> </strong><strong class="hljs-template-variable-slc">search</strong><strong class="hljs-slc"> </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> </strong><strong class="hljs-type-slc">UISearchController</strong><strong class="hljs-slc">(</strong><strong class="hljs-con-attribute-slc">searchResultsController</strong><strong class="hljs-slc">: </strong><strong class="hljs-literal-slc">nil</strong><strong class="hljs-slc">)</strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc">private var</strong><strong class="hljs-slc"> </strong><strong class="hljs-template-variable-slc">filteredTableData</strong><strong class="hljs-slc">: [</strong><strong class="hljs-con-class-slc">JournalEntry</strong><strong class="hljs-slc">] </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> []</strong></span>
</code></pre>
      </li>
    </ol>
    <p class="normal-one">The <code class="inlineCode">search</code> property will store an instance of the <code class="inlineCode">UISearchController</code> class.</p>
    <p class="normal-one">The <code class="inlineCode">filteredTableData</code> property will store an array of <code class="inlineCode">JournalEntry</code> instances that match the search text entered by the user.</p>
    <ol>
      <li class="numberedList" value="4">Modify the <code class="inlineCode">viewDidLoad()</code> method in the <code class="inlineCode">JournalListViewController</code> class as shown:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-template-variable">viewDidLoad</span>() {
  <span class="hljs-keyword">super</span>.<span class="hljs-con-attribute">viewDidLoad</span>()
  <span class="hljs-title">SharedData</span>.<span class="hljs-variable">shared</span>.<span class="hljs-variable">loadJournalEntriesData</span>()
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-variable-slc">search</strong><strong class="hljs-slc">.</strong><strong class="hljs-con-attribute-slc">searchResultsUpdater</strong><strong class="hljs-slc"> </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">self</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-variable-slc">search</strong><strong class="hljs-slc">.</strong><strong class="hljs-con-attribute-slc">obscuresBackgroundDuringPresentation</strong><strong class="hljs-slc"> </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> </strong><strong class="hljs-literal-slc">false</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-variable-slc">search</strong><strong class="hljs-slc">.</strong><strong class="hljs-con-attribute-slc">searchBar</strong><strong class="hljs-slc">.</strong><strong class="hljs-con-attribute-slc">placeholder</strong><strong class="hljs-slc"> </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">"Search titles"</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-con-attribute-slc">navigationItem</strong><strong class="hljs-slc">.</strong><strong class="hljs-con-attribute-slc">searchController</strong><strong class="hljs-slc"> </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc">search</strong></span>
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">Let’s break this down:</p>
    <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-variable">search</span>.<span class="hljs-con-attribute">searchResultsUpdater</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>
</code></pre>
    <p class="normal-one">This statement sets the <code class="inlineCode">JournalListViewController</code> instance as the object responsible for updating the search results.</p>
    <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-variable">search</span>.<span class="hljs-con-attribute">obscuresBackgroundDuringPresentation</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
</code></pre>
    <p class="normal-one">This statement obscures the view controller containing the search content when <a id="_idIndexMarker902"/>the user interacts <a id="_idIndexMarker903"/>with the search bar. Since you’re using the table view on the Journal List screen to display the search results, this value is set to <code class="inlineCode">false</code>, otherwise, you will obscure the search results.</p>
    <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-variable">search</span>.<span class="hljs-con-attribute">searchBar</span>.<span class="hljs-con-attribute">placeholder</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Search titles"</span>
</code></pre>
    <p class="normal-one">This statement sets the placeholder text for the search bar.</p>
    <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-con-attribute">navigationItem</span>.<span class="hljs-con-attribute">searchController</span> <span class="hljs-operator">=</span> <span class="hljs-variable">search</span>
</code></pre>
    <p class="normal-one">This statement adds the search bar to the navigation bar on the screen.</p>
    <ol>
      <li class="numberedList" value="5">Build and run your app, and you’ll see a search bar on the Journal List screen. Type some text into the search bar:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_21_01.png" alt="" width="394" height="391"/></figure>
    <p class="packt_figref">Figure 21.1: Simulator showing a search bar on the Journal List screen</p>
    <ol>
      <li class="numberedList" value="6">Note <a id="_idIndexMarker904"/>that the text you type <a id="_idIndexMarker905"/>into the search bar appears in the Debug area:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_21_02.png" alt="" width="812" height="234"/></figure>
    <p class="packt_figref">Figure 21.2: Debug area showing the search text</p>
    <p class="normal">You’ve <a id="_idIndexMarker906"/>added a search bar to the <a id="_idIndexMarker907"/>Journal List screen. Great! In the next section, you’ll modify the <code class="inlineCode">JournalListViewController</code> file to display journal entries whose titles match the search text typed into the search bar.</p>
    <h1 id="_idParaDest-270" class="heading-1">Modifying table view data source methods</h1>
    <p class="normal">As you learned in <em class="chapterRef">Chapter 14</em>, <em class="italic">Getting Started with MVC and Table Views</em>, you can use <code class="inlineCode">UITableViewDataSource</code> methods to determine how many table view rows to display, and what to put in each row.</p>
    <p class="normal">In the <a id="_idIndexMarker908"/>previous section, you added a new property, <code class="inlineCode">filteredTableData</code>, to hold an array of <code class="inlineCode">JournalEntry</code> instances that match the search text. You’ll modify the <code class="inlineCode">updateSearchResults(for:)</code> method to populate <code class="inlineCode">filteredTableData</code> with <code class="inlineCode">JournalEntry</code> instances that match the search text, and you’ll modify the <code class="inlineCode">UITableViewDataSource</code> methods to display the contents of <code class="inlineCode">filteredTableData</code> on the Journal List screen while the search bar is active. Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">In the Project navigator, click the <strong class="screenText">JournalListViewController</strong> file. Modify the <code class="inlineCode">updateSearchResults(for:)</code> method in the <code class="inlineCode">UISearchResultsUpdating</code> extension as shown:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">//MARK: - Search</span>
<span class="hljs-keyword">func</span> <span class="hljs-template-variable">updateSearchResults</span>(<span class="hljs-template-variable">for</span> <span class="hljs-params">searchController</span>: <span class="hljs-type">UISearchController</span>) {
  <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> searchBarText <span class="hljs-operator">=</span> searchController.<span class="hljs-con-attribute">searchBar</span>.<span class="hljs-con-attribute">text</span>
<span class="hljs-keyword">  else</span> {
    <span class="hljs-keyword">return</span>
  }
<span class="code-highlight"><strong class="hljs-slc">  filteredTableData = </strong><strong class="hljs-title-slc">SharedData</strong><strong class="hljs-slc">.</strong><strong class="hljs-variable-slc">shared</strong><strong class="hljs-slc">.</strong><strong class="hljs-variable-slc">allJournalEntries</strong><strong class="hljs-slc">()</strong><strong class="hljs-slc">  .</strong><strong class="hljs-con-attribute-slc">filter</strong><strong class="hljs-slc"> { entry in</strong><strong class="hljs-slc">    entry.</strong><strong class="hljs-variable-slc">entryTitle</strong><strong class="hljs-slc">.</strong><strong class="hljs-con-attribute-slc">lowercased</strong><strong class="hljs-slc">().</strong><strong class="hljs-con-attribute-slc">contains</strong><strong class="hljs-slc">(searchBarText</strong><strong class="hljs-slc">    .</strong><strong class="hljs-con-attribute-slc">lowercased</strong><strong class="hljs-slc">())</strong></span>



<span class="code-highlight"><strong class="hljs-slc">  }</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-variable-slc">tableView</strong><strong class="hljs-slc">.</strong><strong class="hljs-con-attribute-slc">reloadData</strong><strong class="hljs-slc">()</strong></span>
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">This method gets a copy of the <code class="inlineCode">journalEntries</code> array and then adds only those <code class="inlineCode">JournalEntry</code> instances matching the search text to the <code class="inlineCode">filteredTableData</code> array. When done, the table view is reloaded.</p>
    <ol>
      <li class="numberedList" value="2">Modify <a id="_idIndexMarker909"/>the <code class="inlineCode">tableView(_:numberOfRowsInSection:)</code> method to get the number of <code class="inlineCode">JournalEntry</code> instances from the <code class="inlineCode">filteredTableData</code> array when the search bar is in use:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">//MARK: - UITableViewDataSource</span>
<span class="hljs-keyword">func</span> <span class="hljs-template-variable">tableView</span>(<span class="hljs-template-variable">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-template-variable">numberOfRowsInSection</span> <span class="hljs-params">section</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span> {
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">if</strong><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc">search</strong><strong class="hljs-slc">.</strong><strong class="hljs-con-attribute-slc">isActive</strong><strong class="hljs-slc"> {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-keyword-slc">return</strong><strong class="hljs-slc"> filteredTableData.</strong><strong class="hljs-con-attribute-slc">count</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  } </strong><strong class="hljs-keyword-slc">else</strong><strong class="hljs-slc"> {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-keyword-slc">return</strong><strong class="hljs-slc"> </strong><strong class="hljs-con-class-slc">SharedData</strong><strong class="hljs-slc">.</strong><strong class="hljs-variable-slc">shared</strong><strong class="hljs-slc">.</strong><strong class="hljs-variable-slc">numberOfJournalEntries</strong><strong class="hljs-slc">()</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  }</strong></span>
}
</code></pre>
      </li>
      <li class="numberedList">Modify the <code class="inlineCode">tableView(_:cellForRowAt:)</code> method to get the <code class="inlineCode">JournalEntry</code> instance for the specified row from the <code class="inlineCode">filteredTableData</code> array when the search bar is in use:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">func</span> <span class="hljs-template-variable">tableView</span>(<span class="hljs-template-variable">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-template-variable">cellForRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) -&gt; <span class="hljs-type">UITableViewCell</span> {
  <span class="hljs-keyword">let</span> journalCell <span class="hljs-operator">=</span>   tableView.<span class="hljs-con-attribute">dequeueReusableCell</span>(<span class="hljs-con-attribute">withIdentifier</span>: <span class="hljs-string">  "journalCell"</span>, <span class="hljs-con-attribute">for</span>: indexPath) <span class="hljs-keyword">as</span>!  <span class="hljs-title">JournalListTableViewCell</span>
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">let</strong><strong class="hljs-slc"> journalEntry: </strong><strong class="hljs-title-slc">JournalEntry</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">if</strong><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc">search</strong><strong class="hljs-slc">.</strong><strong class="hljs-con-attribute-slc">isActive</strong><strong class="hljs-slc"> {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    journalEntry </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> filteredTableData[indexPath.</strong><strong class="hljs-con-attribute-slc">row</strong><strong class="hljs-slc">]</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  } </strong><strong class="hljs-keyword-slc">else</strong><strong class="hljs-slc"> {    </strong></span>
<span class="code-highlight"><strong class="hljs-slc">    journalEntry </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">SharedData</strong><strong class="hljs-slc">.</strong><strong class="hljs-variable-slc">shared</strong><strong class="hljs-slc">.</strong><strong class="hljs-variable-slc">journalEntry</strong><strong class="hljs-slc">(</strong><strong class="hljs-slc">    </strong><strong class="hljs-variable-slc">at</strong><strong class="hljs-slc">: indexPath.</strong><strong class="hljs-con-attribute-slc">row</strong><strong class="hljs-slc">)</strong></span>

<span class="code-highlight"><strong class="hljs-slc">  }</strong></span>
  <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> photoData <span class="hljs-operator">=</span> journalEntry.<span class="hljs-variable">photoData</span> {
    journalCell.<span class="hljs-variable">photoImageView</span>.<span class="hljs-con-attribute">image</span> <span class="hljs-operator">=</span> <span class="hljs-type">    UIImage</span>(<span class="hljs-con-attribute">data</span>: photoData)
  }
  journalCell.<span class="hljs-variable">dateLabel</span>.<span class="hljs-con-attribute">text</span> <span class="hljs-operator">=</span> journalEntry.<span class="hljs-variable">date</span>.<span class="hljs-con-attribute">formatted</span>(
<span class="hljs-variable">  </span>.<span class="hljs-con-attribute">datetime</span>.<span class="hljs-con-attribute">month</span>().<span class="hljs-con-attribute">day</span>().<span class="hljs-con-attribute">year</span>()
)
  journalCell.<span class="hljs-variable">titleLabel</span>.<span class="hljs-con-attribute">text</span> <span class="hljs-operator">=</span> journalEntry.<span class="hljs-variable">entryTitle</span>
  <span class="hljs-keyword">return</span> journalCell
}
</code></pre>
      </li>
      <li class="numberedList">Build and <a id="_idIndexMarker910"/>run your app, and type some text that matches the title of one of your journal entries into the search bar. The journal entries with titles that match the search text will be displayed:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_21_03.png" alt="" width="536" height="241"/></figure>
    <p class="packt_figref">Figure 21.3: Simulator showing journal entries with titles that match the search text</p>
    <p class="normal">You can now display journal entries with titles that match the search text, but when you tap on them, the Journal Entry Detail screen may or may not display the details for the tapped journal entry. You will fix this issue in the next section.</p>
    <h1 id="_idParaDest-271" class="heading-1">Modifying the prepare(for:sender:) method</h1>
    <p class="normal">When you enter text in the search bar, the journal entries with titles matching the search text <a id="_idIndexMarker911"/>will appear in the table view on the Journal List screen. But if you were to tap one of them, the Journal Entry Detail screen may or may not display the details for the tapped journal entry. This is because the <code class="inlineCode">prepare(for:sender:)</code> method will reference the <code class="inlineCode">journalEntries</code> array in the <code class="inlineCode">SharedData.shared</code> instance instead of the <code class="inlineCode">filteredTableData</code> array. To fix this, follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">Modify the <code class="inlineCode">prepare(for:sender:)</code> method in the <code class="inlineCode">JournalListViewController</code> class as shown to assign the appropriate <code class="inlineCode">JournalEntry</code> instance from the <code class="inlineCode">filteredTableData</code> array to the <code class="inlineCode">journalEntry</code> property for the destination view controller when the search bar is active:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">//MARK: - Navigation</span>
<span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-template-variable">prepare</span>(<span class="hljs-template-variable">for</span> <span class="hljs-params">segue</span>: <span class="hljs-type">UIStoryboardSegue</span>, <span class="hljs-template-variable">sender</span>: <span class="hljs-keyword">Any</span><span class="hljs-operator">?</span>) {
  <span class="hljs-keyword">super</span>.<span class="hljs-con-attribute">prepare</span>(<span class="hljs-con-attribute">for</span>: segue, <span class="hljs-con-attribute">sender</span>: sender)
  <span class="hljs-keyword">guard</span> segue.<span class="hljs-con-attribute">identifier</span> <span class="hljs-operator">==</span> <span class="hljs-string">"entryDetail"</span> <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span>
  }
  <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> journalEntryDetailViewController <span class="hljs-operator">=</span> 
  segue.<span class="hljs-con-attribute">destination</span> <span class="hljs-keyword">as</span>?
  <span class="hljs-title">JournalEntryDetailViewController</span>, 
  <span class="hljs-keyword">let</span> selectedJournalEntryCell <span class="hljs-operator">=</span> sender <span class="hljs-keyword">as</span>?
  <span class="hljs-title">JournalListTableViewCell</span>,   <span class="hljs-keyword">let</span> indexPath <span class="hljs-operator">=</span> <span class="hljs-variable">tableView</span>.<span class="hljs-con-attribute">indexPath</span>(<span class="hljs-con-attribute">for</span>:
  selectedJournalEntryCell)
  <span class="hljs-keyword">else</span> {
    <span class="hljs-con-attribute">fatalError</span>(<span class="hljs-string">"Could not get indexpath"</span>)
  }
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">let</strong><strong class="hljs-slc"> selectedJournalEntry: </strong><strong class="hljs-con-class-slc">JournalEntry</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">if</strong><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc">search</strong><strong class="hljs-slc">.</strong><strong class="hljs-con-attribute-slc">isActive</strong><strong class="hljs-slc"> {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    selectedJournalEntry </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> filteredTableData[indexPath.</strong><strong class="hljs-con-attribute-slc">row</strong><strong class="hljs-slc">]</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  } </strong><strong class="hljs-keyword-slc">else</strong><strong class="hljs-slc"> {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    selectedJournalEntry </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> </strong></span>
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-title-slc">SharedData</strong><strong class="hljs-slc">.</strong><strong class="hljs-variable-slc">shared</strong><strong class="hljs-slc">.</strong><strong class="hljs-variable-slc">journalEntry</strong><strong class="hljs-slc">(</strong><strong class="hljs-variable-slc">at</strong><strong class="hljs-slc">: indexPath.</strong><strong class="hljs-con-attribute-slc">row</strong><strong class="hljs-slc">)</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  }</strong></span>
  journalEntryDetailViewController.<span class="hljs-variable">selectedJournalEntry</span> <span class="hljs-operator">=</span> 
  selectedJournalEntry
}
</code></pre>
      </li>
      <li class="numberedList">Build and run your app, and type some text that matches the title of one of your journal entries into the search bar. The journal entries with titles that match the <a id="_idIndexMarker912"/>search text will be displayed:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_21_04.png" alt="" width="624" height="285"/></figure>
    <p class="packt_figref">Figure 21.4: Simulator showing journal entries with titles that match the search text</p>
    <ol>
      <li class="numberedList" value="3">Tap one of the journal entries and the details displayed on the Journal Entry Detail screen now match the journal entry that was tapped:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_21_05.png" alt="" width="461" height="825"/></figure>
    <p class="packt_figref">Figure 21.5: Simulator showing details of the tapped journal entry on the Journal Entry Detail screen</p>
    <p class="normal">Your app <a id="_idIndexMarker913"/>now correctly displays the details of a tapped journal entry in the Journal Entry Detail screen. Cool! In the next section, you’ll modify the methods used to remove a journal entry in the <code class="inlineCode">JournalListViewController</code> class.</p>
    <h1 id="_idParaDest-272" class="heading-1">Modifying the method to remove journal entries</h1>
    <p class="normal">Up to this point, the method used to remove <code class="inlineCode">JournalEntry</code> instances from the <code class="inlineCode">journalEntries</code> array in the <code class="inlineCode">SharedData</code> instance uses the table view row to identify the index of the <code class="inlineCode">JournalEntry</code> instance to be removed. However, when the search bar is active, the table <a id="_idIndexMarker914"/>view row may not match the index of the <code class="inlineCode">JournalEntry</code> instance to be removed. You will add a property to the <code class="inlineCode">JournalEntry</code> class to store a value that will identify a <code class="inlineCode">JournalEntry</code> instance, and modify methods in the <code class="inlineCode">SharedData</code> and <code class="inlineCode">JournalListViewController</code> classes to use this property to determine the <code class="inlineCode">JournalEntry</code> instance to be removed. Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">In the Project navigator, click the <strong class="screenText">JournalEntry </strong>file. Add a new property to the <code class="inlineCode">JournalEntry</code> class to store what’s known as a <strong class="keyWord">UUID</strong> string:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">class</span> <span class="hljs-title">JournalEntry</span>: <span class="hljs-type">NSObject</span>, <span class="hljs-type">MKAnnotation</span>, <span class="hljs-type">Codable</span> {
  <span class="hljs-comment">// MARK: - Properties</span>
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">var</strong><strong class="hljs-slc"> </strong><strong class="hljs-template-variable-slc">key</strong><strong class="hljs-slc"> </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> </strong><strong class="hljs-type-slc">UUID</strong><strong class="hljs-slc">().</strong><strong class="hljs-con-attribute-slc">uuidString</strong></span>
  <span class="hljs-keyword">let</span> <span class="hljs-template-variable">date</span>: <span class="hljs-type">Date</span>
  <span class="hljs-keyword">let</span> <span class="hljs-template-variable">rating</span>: <span class="hljs-type">Int</span>
</code></pre>
      </li>
    </ol>
    <p class="normal-one">When a new <code class="inlineCode">JournalEntry</code> instance is created, the <code class="inlineCode">key</code> property is assigned a string, which is generated by the <code class="inlineCode">UUID</code> class, and is guaranteed to be unique.</p>
    <div class="note-one">
      <p class="normal">To learn <a id="_idIndexMarker915"/>more about the <code class="inlineCode">UUID</code> class, see <a href="https://developer.apple.com/documentation/foundation/uuid"><span class="url">https://developer.apple.com/documentation/foundation/uuid</span></a>.</p>
    </div>
    <ol>
      <li class="numberedList" value="2">Click the <strong class="screenText">SharedData</strong> file in the Project navigator. Add a method to the <code class="inlineCode">SharedData</code> class after the <code class="inlineCode">removeJournalEntry(at:)</code> method to remove a <code class="inlineCode">JournalEntry</code> instance with the <code class="inlineCode">UUID</code> string that matches the <code class="inlineCode">UUID</code> string of the <code class="inlineCode">JournalEntry</code> instance passed into it:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">func</span> <span class="hljs-template-variable">removeSelectedJournalEntry</span>(<span class="hljs-template-variable">_</span> <span class="hljs-params">selectedJournalEntry</span>: <span class="hljs-con-class">JournalEntry</span>) {
  <span class="hljs-variable">journalEntries</span>.<span class="hljs-con-attribute">removeAll</span> {
    $0.<span class="hljs-con-attribute">key</span> <span class="hljs-operator">==</span> selectedJournalEntry.<span class="hljs-title">key</span>
  }
}
</code></pre>
      </li>
      <li class="numberedList">Click the <strong class="screenText">JournalListViewController</strong> file in the Project navigator. Modify the <code class="inlineCode">tableView(_:commit:forRowAt:)</code> method in the <code class="inlineCode">JournalListViewController</code> class as shown:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">//MARK: - TableViewDelegate</span>
<span class="hljs-keyword">func</span> <span class="hljs-template-variable">tableView</span>(<span class="hljs-template-variable">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-template-variable">commit</span> <span class="hljs-params">editingStyle</span>: <span class="hljs-type">UITableViewCell</span>.<span class="hljs-type">EditingStyle</span>, <span class="hljs-template-variable">forRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) {
  <span class="hljs-keyword">if</span> editingStyle <span class="hljs-operator">==</span> .<span class="hljs-con-attribute">delete</span> {
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-keyword-slc">if</strong><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc">search</strong><strong class="hljs-slc">.</strong><strong class="hljs-con-attribute-slc">isActive</strong><strong class="hljs-slc"> {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      </strong><strong class="hljs-keyword-slc">let</strong><strong class="hljs-slc"> selectedJournalEntry </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc">filteredTableData</strong><strong class="hljs-slc">[</strong><strong class="hljs-slc">      indexPath.</strong><strong class="hljs-con-attribute-slc">row</strong><strong class="hljs-slc">]</strong></span>

<span class="code-highlight"><strong class="hljs-slc">      </strong><strong class="hljs-variable-slc">filteredTableData</strong><strong class="hljs-slc">.</strong><strong class="hljs-con-attribute-slc">remove</strong><strong class="hljs-slc">(</strong><strong class="hljs-con-attribute-slc">at</strong><strong class="hljs-slc">: indexPath.</strong><strong class="hljs-con-attribute-slc">row</strong><strong class="hljs-slc">)</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      </strong><strong class="hljs-title-slc">SharedData</strong><strong class="hljs-slc">.</strong><strong class="hljs-variable-slc">shared</strong><strong class="hljs-slc">.</strong><strong class="hljs-variable-slc">removeSelectedJournalEntry</strong><strong class="hljs-slc">(</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      selectedJournalEntry)</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    } </strong><strong class="hljs-keyword-slc">else</strong><strong class="hljs-slc"> {</strong></span>
      <span class="hljs-title">SharedData</span>.<span class="hljs-variable">shared</span>.<span class="hljs-variable">removeJournalEntry</span>(<span class="hljs-variable">at</span>:       indexPath.<span class="hljs-con-attribute">row</span>)
    <span class="code-highlight"><strong class="hljs-slc">}</strong></span>
    <span class="hljs-title">SharedData</span>.<span class="hljs-variable">shared</span>.<span class="hljs-variable">saveJournalEntriesData</span>()
    tableView.<span class="hljs-con-attribute">reloadData</span>()
  }
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">This method <a id="_idIndexMarker916"/>now checks to see if the search bar is active. If it is, the <code class="inlineCode">JournalEntry</code> instance in the <code class="inlineCode">filteredTableData</code> array corresponding to the row that was tapped is assigned to <code class="inlineCode">selectedJournalEntry</code>. This instance is then removed from the <code class="inlineCode">filteredTableData</code> array and passed as an argument to the <code class="inlineCode">removeSelectedJournalEntry(_:)</code> method. The <code class="inlineCode">journalEntry</code> instance with the same <code class="inlineCode">UUID</code> string as the one passed into the <code class="inlineCode">removeSelectedJournalEntry(_:)</code> method is removed from the <code class="inlineCode">journalEntries</code> array in the <code class="inlineCode">SharedData</code> instance.</p>
    <ol>
      <li class="numberedList" value="4">Build and run your app. Since you made changes to the <code class="inlineCode">JournalEntry</code> class, the previously saved journal entries stored in the JSON file will not load, so you will need to create new sample journal entries:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_21_06.png" alt="" width="460" height="488"/></figure>
    <p class="packt_figref">Figure 21.6: Simulator showing journal entries on the Journal List screen</p>
    <ol>
      <li class="numberedList" value="5">Type some <a id="_idIndexMarker917"/>text that matches the title of one of the journal entries into the search bar. Journal entries with titles that match the search text will be displayed. Swipe left on a row and click <strong class="screenText">Cancel</strong> to exit the search:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_21_07.png" alt="" width="511" height="226"/></figure>
    <p class="packt_figref">Figure 21.7: Simulator showing a row about to be deleted</p>
    <p class="normal-one">Swiping left <a id="_idIndexMarker918"/>on a table view row when the search bar is active will delete it from the table view and delete the corresponding journal entry from the <code class="inlineCode">journalEntries</code> array in the <code class="inlineCode">SharedData</code> instance.</p>
    <ol>
      <li class="numberedList" value="6">Verify that the deleted journal entry no longer appears on the Journal List screen:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_21_08.png" alt="" width="546" height="448"/></figure>
    <p class="packt_figref">Figure 21.8: Simulator showing remaining journal entries on the Journal List screen</p>
    <p class="normal">You have <a id="_idIndexMarker919"/>successfully modified the method to delete journal entries, and the implementation of a search bar on the Journal List screen is now complete. Excellent!</p>
    <h1 id="_idParaDest-273" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, you implemented a search bar for the Journal List screen. First, you modified the <code class="inlineCode">JournalListViewController</code> class to conform to the <code class="inlineCode">UISearchResultsUpdating</code> protocol and display a search bar on the Journal List screen. Next, you modified the data source methods to display the correct journal entries when the user types in a search term. After that, you modified the <code class="inlineCode">prepare(for:sender:)</code> method to ensure that the correct journal entry details are displayed on the Journal Entry Detail screen. Finally, you modified the method used to remove journal entries.</p>
    <p class="normal">You have now learned how to implement a search bar for your own apps, and you have also completed the <em class="italic">JRNL</em> app. Fantastic job!</p>
    <p class="normal">In the next chapter, you’ll learn how to get your app ready for iPads and Macs.</p>
    <h1 id="_idParaDest-274" class="heading-1">Join us on Discord!</h1>
    <p class="normal">Read this book alongside other users, experts, and the author himself. Ask questions, provide solutions to other readers, chat with the author via Ask Me Anything sessions, and much more. Scan the QR code or visit the link to join the community.</p>
    <p class="normal"><a href="https://packt.link/ios-Swift%0D"><span class="url">https://packt.link/ios-Swift</span></a></p>
    <p class="normal"><a href="https://packt.link/ios-Swift%0D"><img src="image/QR_Code2370024260177612484.png" alt="" width="177" height="177"/></a></p>
  </div>
</div></div></body></html>