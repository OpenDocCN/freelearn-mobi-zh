- en: Chapter 5. Push Notifications
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第5章。推送通知
- en: Push notifications allow you to send messages even when the application is in
    the background or not running at all. Push notifications increase the user's engagement
    with the application and keep all the users informed about the application through
    messages, which in turn generates revenue. Additionally, by having your data and
    push services interconnected allows you to send push notifications in a selective
    way, such as *Congrats on completing one year with Packt Publishing*. It's the
    easiest way to reach all your users. Parse provides you with the push notification
    services. This chapter will help you to configure push notifications for your
    application.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 推送通知允许您在应用处于后台或根本未运行时发送消息。推送通知增加了用户与应用的互动，并通过消息让所有用户了解应用，从而产生收入。此外，通过将您的数据和推送服务相互连接，您可以以选择性的方式发送推送通知，例如*祝贺您与Packt
    Publishing合作满一年*。这是接触所有用户的最简单方法。Parse为您提供推送通知服务。本章将帮助您为您的应用配置推送通知。
- en: Setting up push notifications
  id: totrans-2
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置推送通知
- en: Notification helps you in adding real-time messaging to your application. For
    this, you need to create an SSL certificate and then associate the created certificate
    with your **App ID** and **Provisioning Profile**.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 通知帮助您在应用中添加实时消息。为此，您需要创建SSL证书，然后将创建的证书与您的**App ID**和**配置文件**关联。
- en: Creating an SSL certificate
  id: totrans-4
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建SSL证书
- en: You need to create your **App ID** and associated SSL certificate on the Apple
    developer portal. The Parse server will use this certificate to send push notifications
    to the application identified by that **App ID**.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要在Apple开发者门户上创建您的**App ID**及其关联的SSL证书。Parse服务器将使用此证书向由该**App ID**标识的应用发送推送通知。
- en: Generating certificate requests
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 生成证书请求
- en: 'Perform the following steps to generate the certificate and save it to your
    disk:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤以生成证书并将其保存到您的磁盘：
- en: Open the **Keychain Access** application on your Mac.
  id: totrans-8
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的Mac上打开**钥匙串访问**应用程序。
- en: Navigate to **Keychain Access** | **Certificate Assistant** | **Request a Certificate
    From a Certificate Authority…**.
  id: totrans-9
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**钥匙串访问** | **证书助手** | **从证书颁发机构请求证书…**。
- en: In the **Certificate Information** window, enter your e-mail address and name.
  id: totrans-10
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**证书信息**窗口中，输入您的电子邮件地址和姓名。
- en: Select **Save to disk** to download the **.certSigningRequest** file to your
    desktop.
  id: totrans-11
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**保存到磁盘**以将**.certSigningRequest**文件下载到您的桌面。
- en: Setting up your App ID
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 设置您的App ID
- en: 'An App ID is required for all the iOS applications installed on your developer
    device. You can use your existing App ID, but make sure that it does not have
    a wildcard character. You can create a new App ID by performing the following
    steps:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 所有安装在开发者设备上的iOS应用都需要App ID。您可以使用现有的App ID，但请确保它没有通配符。您可以通过以下步骤创建新的App ID：
- en: Log in to the Apple developer portal ([https://developer.apple.com/membercenter/index.action](https://developer.apple.com/membercenter/index.action))
    and navigate to **Certificates, Identifiers & Profiles** ([https://developer.apple.com/account/overview.action](https://developer.apple.com/account/overview.action)).
  id: totrans-14
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到Apple开发者门户([https://developer.apple.com/membercenter/index.action](https://developer.apple.com/membercenter/index.action))并导航到**证书、标识符和配置文件**([https://developer.apple.com/account/overview.action](https://developer.apple.com/account/overview.action))。
- en: Click on **Identifiers** from the left panel of the portal.
  id: totrans-15
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击门户左侧面板中的**标识符**。
- en: Click on the **+** button on the top right-hand side to create a new App ID.
  id: totrans-16
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击右上角的**+**按钮以创建新的App ID。
- en: Enter the name of the new App ID and select the **Push Notifications** checkbox
    under the **App Services** section.
  id: totrans-17
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入新App ID的名称，并在**应用服务**部分下选择**推送通知**复选框。
- en: In the **App ID suffix** section, select **Explicit App ID**. Enter your iOS
    apps **Bundle ID**. This string should match the Bundle identifier in your iOS
    app's `info.plist` file.
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**App ID后缀**部分，选择**显式App ID**。输入您的iOS应用的**Bundle ID**。此字符串应与iOS应用`info.plist`文件中的Bundle标识符相匹配。
- en: Click on **Continue** followed by **Submit** to finalize your registration.
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**继续**然后点击**提交**以完成注册。
- en: Select your newly created App ID from the list of **iOS App IDs**, then click
    on **Settings**.
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从**iOS App ID**列表中选择您新创建的App ID，然后点击**设置**。
- en: Navigate to the **Push Notifications** section. You can download both **Development**
    and **Production SSL certificate**.
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**推送通知**部分。您可以下载**开发**和**生产**SSL证书。
- en: Click on **Create Certificate...**, then click on **Continue**.
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击 **创建证书...**，然后点击 **继续**。
- en: Now you can upload your certificate that you have generated in the previous
    section and then click on **Generate**.
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，你可以上传上一节中生成的证书，然后点击 **生成**。
- en: After uploading your certificate, click on **Done** and then download the generated
    SSL certificate from the **iOS App ID Settings** screen.
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 上传你的证书后，点击 **完成**，然后从 **iOS App ID 设置** 屏幕下载生成的 SSL 证书。
- en: Install the downloaded certificate in your Keychain by double-clicking on the
    SSL certificate.
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过双击 SSL 证书在你的密钥链中安装下载的证书。
- en: In **Keychain Access**, under the **My Certificates** section, select your installed
    certificate, it should have **Apple Development IOS Push Services:** as a prefix.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **密钥链访问** 中，在 **我的证书** 部分选择你安装的证书，它应该以 **Apple Development IOS Push Services:**
    作为前缀。
- en: Right-click on the selected certificate and save it as the `.p12` file format.
    Do not give any password when prompted.
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 右键单击选定的证书并将其保存为 `.p12` 文件格式。在提示时不要输入任何密码。
- en: Creating your provisioning profile
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建你的配置文件
- en: 'To authenticate your device for the application you need to create a provisioning
    profile. You need to regenerate your provisioning profile every time you update
    your App ID. Perform the following steps to create a provisioning profile:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 为了验证你的设备以用于应用程序，你需要创建一个配置文件。每次更新你的 App ID 时，你都需要重新生成你的配置文件。按照以下步骤创建配置文件：
- en: Log in to the Apple developer portal and navigate to the **Certificates, Identifiers
    & Profiles** section.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到苹果开发者门户并导航到 **证书、标识符和配置文件** 部分。
- en: Select **Provisioning Profiles** from the **iOS Apps** section.
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 **iOS 应用** 部分选择 **配置文件**。
- en: Click on the **+** button on the top right-hand side of the section, to add
    a new provisioning profile.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击该部分右上角的 **+** 按钮，以添加一个新的配置文件。
- en: Choose **iOS App Development** as the type of your provisioning profile and
    click on **Continue**.
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择你的配置文件类型为 **iOS 应用开发** 并点击 **继续**。
- en: Select the App ID created in the previous section and click on **Continue**.
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择上一节中创建的应用 ID 并点击 **继续**。
- en: Select your certificate and click on **Continue**.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择你的证书并点击 **继续**。
- en: Select the devices from the list of devices on which you want to install and
    test your application and click on **Continue**.
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从设备列表中选择你想要安装和测试应用程序的设备，并点击 **继续**。
- en: Provide a name to your provisioning profile and click on **Generate**.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为你的配置文件提供一个名称并点击 **生成**。
- en: Download the generated profile and double-click to install it.
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载生成的配置文件并双击以安装它。
- en: This should launch your Xcode's **Organizer** in the **Devices** panel. Your
    new provisioning profile should appear in the **Provisioning Profile** section
    of **LIBRARY**. Make sure that the **Status** of the profile is **Valid**.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该会在 **设备** 面板中启动你的 Xcode 的 **组织者**。你的新配置文件应该出现在 **库** 的 **配置文件** 部分中。确保配置文件的
    **状态** 是 **有效** 的。
- en: Configuring your Parse app
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置你的 Parse 应用
- en: 'To make use of push notification services with Parse, you would have to enable
    this feature in your Parse app by uploading the Push SSL certificate you generated
    in the previous sections:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用 Parse 的推送通知服务，你必须在 Parse 应用中启用此功能，通过上传上一节中生成的推送 SSL 证书：
- en: Navigate to your Parse app on the Parse **Dashboard** and select the **Settings**
    tab.
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到你的 Parse 应用在 Parse **仪表板**上，并选择 **设置** 选项卡。
- en: On the left-hand side of the settings panel, you will have **Push notifications**.
    Under the **Apple Push Certificate** header, click on **Select your certificate**
    and locate your `.p12` certificate you exported from the Keychain in the previous
    section.
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在设置面板的左侧，你将看到 **推送通知**。在 **Apple 推送证书** 标题下，点击 **选择你的证书** 并定位到上一节从密钥链导出的 `.p12`
    证书。
- en: Configuring an iOS application for push notifications
  id: totrans-44
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置 iOS 应用以使用推送通知
- en: 'You need to update the following application settings to configure push notifications:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要更新以下应用程序设置以配置推送通知：
- en: Your application bundle identifier should be exactly the same as you have provided
    on the Apple developer portal while creating the App ID.
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你的应用程序包标识符应该与你创建 App ID 时在苹果开发者门户上提供的完全相同。
- en: Update your **Code Signing Identity** field to match the provisioning profile
    we created in the previous section.
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 更新你的 **代码签名标识符** 字段以匹配上一节中创建的配置文件。
- en: Installation
  id: totrans-48
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装
- en: In all the previous sections, we have configured all that is required to get
    started with the push notifications. In this section, we will add some code to
    receive push notifications in our application.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在所有前面的部分中，我们已经配置了开始使用推送通知所需的所有内容。在本节中，我们将添加一些代码以在我们的应用程序中接收推送通知。
- en: You need to register your device to get the push notifications, add the following
    code in the app's delegate `[application:didFinishLaunchingWithOptions:]` method.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要注册您的设备以获取推送通知，在应用的代理方法 `[application:didFinishLaunchingWithOptions:]` 中添加以下代码。
- en: '[PRE0]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'On successful registration, your callback method `[application:didRegisterForRemoteNotificationsWithDeviceToken:]`
    in the app delegate will be executed. We need to configure this method to inform
    Parse about the new device:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 在成功注册后，您的应用代理中的回调方法 `[application:didRegisterForRemoteNotificationsWithDeviceToken:]`
    将被执行。我们需要配置此方法以通知 Parse 关于新设备的信息：
- en: '[PRE1]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'You can update the `PFInstallation` just like your `PFObject`. You can add
    variety of special fields which will help you to manage your devices on Parse.
    The following are some of the fields and their uses:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以像更新 `PFObject` 一样更新 `PFInstallation`。您可以添加各种特殊字段，这些字段将帮助您在 Parse 上管理您的设备。以下是一些字段及其用途：
- en: '`badges`: You can change this value in `PFInstallation` to update the badge
    on the app icon. It''s recommended to save the changes of badges on the server
    for future badge increment notifications.'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`badges`: 您可以在 `PFInstallation` 中更改此值以更新应用图标的徽章。建议在服务器上保存徽章更改，以便将来进行徽章增量通知。'
- en: '`channels`: This will store the array of channels that are subscribed to thecurrent
    device.'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`channels`: 这将存储订阅当前设备的频道数组。'
- en: '`timeZone`: This property is for the current location of the device. It''s
    updated automatically when we update the `Installation` object on the server.
    This is a read-only property.'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`timeZone`: 此属性用于设备的当前位置。当我们更新服务器上的 `Installation` 对象时，它会自动更新。这是一个只读属性。'
- en: '`deviceType`: This property is for any device type, that can be iOS, Android,
    winrt, winphone, or dotnet. This is a read-only property.'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`deviceType`: 此属性适用于任何设备类型，可以是 iOS、Android、winrt、winphone 或 dotnet。这是一个只读属性。'
- en: '`installationId`: This is a unique ID property for the device used by Parse.
    This is a read-only property.'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`installationId`: 这是 Parse 用于设备的唯一 ID 属性。这是一个只读属性。'
- en: '`deviceToken`: This is the Apple-generated token used for iOS devices. This
    is a read-only property.'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`deviceToken`: 这是用于 iOS 设备的 Apple 生成的令牌。这是一个只读属性。'
- en: '`channelUris`: This is the Microsoft-generated push URI for Windows devices.
    This is a read-only property.'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`channelUris`: 这是 Microsoft 为 Windows 设备生成的推送 URI。这是一个只读属性。'
- en: '`appName`: This is the display name of the client application to which this
    installation belongs. This is a read-only property.'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`appName`: 这是属于此安装的客户端应用程序的显示名称。这是一个只读属性。'
- en: '`appVersion`: This is the version of string of the client application to which
    the current installation belongs. This is a read-only property.'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`appVersion`: 这是属于当前安装的客户端应用程序的版本字符串。这是一个只读属性。'
- en: '`parseVersion`: This is the version of the Parse SDK that uses this installation.
    This is a read-only property.'
  id: totrans-64
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`parseVersion`: 这是使用此安装的 Parse SDK 的版本。这是一个只读属性。'
- en: '`appIdentifier`: This is a unique identifier for this installation''s client
    application. In iOS, this is the `Bundle Identifier`. This is a read-only property.'
  id: totrans-65
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`appIdentifier`: 这是此安装客户端应用程序的唯一标识符。在 iOS 中，这是 `Bundle Identifier`。这是一个只读属性。'
- en: 'When your application receives notification in foreground mode, you can handle
    the notification using the following code:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 当您的应用程序在前台模式下接收到通知时，您可以使用以下代码来处理通知：
- en: '[PRE2]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: After receiving notification, we can pass the notification over to Parse to
    handle it. It will automatically create a modal alert and will display it with
    the push message content.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在接收到通知后，我们可以将通知传递给 Parse 以处理。它将自动创建一个模态警报，并显示推送消息内容。
- en: You can now execute your application on your device to make sure that everything
    is set up correctly. If you are running the app for the first time on your device,
    you will receive a modal box requesting the permission for sending push notifications
    to the user.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在可以在您的设备上执行应用程序以确保一切设置正确。如果您是第一次在您的设备上运行此应用，您将收到一个模态框请求用户发送推送通知的权限。
- en: Sending push notifications
  id: totrans-70
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 发送推送通知
- en: You can send push notifications to devices using the following ways.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用以下方式向设备发送推送通知。
- en: Parse websites
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Parse 网站
- en: 'Perform the following steps to send notifications through the Parse website:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤通过Parse网站发送通知：
- en: Navigate to your Parse application on Parse.com.
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到您的Parse应用程序，位于Parse.com上。
- en: Click on the **Push Notifications** tab.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**推送通知**标签。
- en: You can click on **Send a push** on the top right-hand side of the box.
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您可以点击框的右上角的**发送推送**。
- en: Compose a message in the message box, and broadcast it to **Everyone**. You
    have other options available to select the device type.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在消息框中编写一条消息，并将其广播给**所有人**。您还有其他选项可供选择设备类型。
- en: Parse allows you to schedule the notifications as well. You can configure this
    schedule and click on **Send notification** to send the notification.
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Parse允许您安排通知。您可以配置此计划并点击**发送通知**来发送通知。
- en: Parse apps
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Parse应用程序
- en: 'Usually you can send push notifications through a web console, or by using
    the REST API, or Cloud Code. However, Parse also allows you to send push notifications
    from your mobile application as well. Remember, you have enabled the **Client
    push** as **Yes**. The enabled **Client push** setting allows you to send a notification
    from one device to another. There are lots of methods available in the `PFPush`
    class, which allow you to send push notifications through your mobile. You can
    access all the methods in the API documentation. Here is the example code to demonstrate
    the push notifications generated from an iOS device:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，您可以通过Web控制台、使用REST API或Cloud Code发送推送通知。然而，Parse还允许您从您的移动应用程序发送推送通知。请记住，您已将**客户端推送**设置为**是**。启用的**客户端推送**设置允许您从一个设备向另一个设备发送通知。`PFPush`类中提供了许多方法，您可以通过这些方法通过您的移动设备发送推送通知。您可以在API文档中访问所有这些方法。以下是从iOS设备生成的推送通知的示例代码：
- en: '[PRE3]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Cloud Code
  id: totrans-82
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Cloud Code
- en: 'Cloud Code also allows you to send push notifications using the `Parse.Cloud.afterSave`
    method, which will be executed after the object is saved successfully on Parse.
    Cloud can be written in JavaScript. You should be familiar with JavaScript to
    write Cloud Code. Let''s take an example of how to send push notifications after
    each comment:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: Cloud Code还允许您使用`Parse.Cloud.afterSave`方法发送推送通知，该方法将在对象在Parse上成功保存后执行。Cloud可以用JavaScript编写。您应该熟悉JavaScript才能编写Cloud
    Code。让我们以发送每条评论后发送推送通知的示例为例：
- en: '[PRE4]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Sending notifications
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 发送通知
- en: There are two ways to send push notifications to devices using Parse. They are
    as follows.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Parse向设备发送推送通知有两种方式。如下所示。
- en: Channels
  id: totrans-87
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 通道
- en: It's the easiest way to start sending notifications. It's based on the Publish/Subscribe
    model. For example, if you want to send a notification to the user on every comment
    on the post he/she created, then you have to create a channel and subscribe the
    user to that channel, and over every comment you need to send a push for that
    channel. This will let the user know when anyone comments on his/her post even
    when the application is not running or is in the background. So for sending the
    push notifications you need to allow the user to create a channel. A device can
    subscribe for one or more channels to receive notifications that can be sent to
    such subscribers. The subscribed channels for Installation are stored in the `channels`
    fields of the `Installation` object.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 这是开始发送通知的最简单方法。它基于发布/订阅模型。例如，如果您想向用户发送关于他/她创建的每条评论的通知，那么您必须创建一个通道并将用户订阅到该通道，并且对于每条评论您都需要为该通道发送一个推送。这将使用户知道当有人评论他/她的帖子时，即使应用程序未运行或处于后台。因此，为了发送推送通知，您需要允许用户创建一个通道。一个设备可以订阅一个或多个通道以接收可以发送给此类订阅者的通知。订阅的通道存储在`Installation`对象的`channels`字段中。
- en: Subscribing to channels
  id: totrans-89
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 订阅通道
- en: 'You can identify a channel by string, which can be a combination of alphanumeric
    characters, underscores, and dashes. Each installation can subscribe to any number
    of channels at any time. You can add a channel by using the following code in
    the `Installation` object:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过字符串识别一个通道，这可以是由字母数字字符、下划线和破折号组成的组合。每个安装可以在任何时候订阅任意数量的通道。您可以通过在`Installation`对象中使用以下代码来添加一个通道：
- en: '[PRE5]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'After subscribing to comments, your `Installation` object should look something
    like this:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 在订阅评论后，您的`Installation`对象应类似于以下内容：
- en: '[PRE6]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'To unsubscribe users from the channel, you can add the following code:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 要从通道中取消用户订阅，您可以添加以下代码：
- en: '[PRE7]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'To get a list of channels as an array for caching purposes, you can use the
    following code:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 为了缓存目的，获取通道列表作为数组，您可以使用以下代码：
- en: '[PRE8]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Sending push notifications to channels
  id: totrans-98
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 向通道发送推送通知
- en: 'To send push notifications to all the users who are subscribed with the `Comments`
    channel, the following code will send a push to all the subscribed users:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 要向所有订阅了`Comments`渠道的用户发送推送通知，以下代码将向所有订阅用户发送推送：
- en: '[PRE9]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'If you want to send a push to multiple channels at the same time, you can use
    the following code:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想同时向多个渠道发送推送，可以使用以下代码：
- en: '[PRE10]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Using advanced targeting
  id: totrans-103
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用高级定位
- en: In advanced push notifications, Parse allows you to embed a query and you can
    send the result of the query as push notifications to the users. This will help
    you to send pushes to customize a dynamic segment of users.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 在高级推送通知中，Parse允许您嵌入查询，并将查询结果作为推送通知发送给用户。这将帮助您向自定义动态用户群体发送推送。
- en: 'You can save the data to the `Installation` object just as any `PFObject`.
    Let''s say in your application you allow users to like, comment, and post. The
    following piece of code will help you achieve that:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以将数据保存到`Installation`对象中，就像任何`PFObject`一样。假设在您的应用程序中，您允许用户点赞、评论和发布。以下代码片段将帮助您实现这一点：
- en: '[PRE11]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Sending pushes to queries
  id: totrans-107
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 向查询发送推送
- en: 'You can filter the `Installation` objects by applying queries to the target
    devices for notifications. This can be achieved using the following code:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过对目标设备应用查询来过滤`Installation`对象。这可以通过以下代码实现：
- en: '[PRE12]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'We can set the query to `PFPush` before sending the notification. You can also
    store the data in relationships. Those relationships can also be used in query:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 在发送通知之前，我们可以将查询设置为`PFPush`。您还可以将数据存储在关系中。这些关系也可以用于查询：
- en: '[PRE13]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Customizing notifications
  id: totrans-112
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 自定义通知
- en: You can customize the push notifications data such as sound played, badge number,
    custom data to send, and expiration of notification.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以自定义推送通知数据，例如播放的声音、徽章编号、要发送的自定义数据和通知的过期时间。
- en: 'You can also customize the notification by wrapping all settings in a `NSDictionary`
    method. Let''s take an example of incrementing the badge by one with custom sound
    and message in the notification:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以通过将所有设置包装在`NSDictionary`方法中来自定义通知。以下是一个示例，通过通知增加徽章计数并添加自定义声音和消息：
- en: '[PRE14]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'To set the expiration date of the notification, you can use the following example
    code:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 要设置通知的过期日期，可以使用以下示例代码：
- en: '[PRE15]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Platform-based targeting
  id: totrans-118
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 基于平台的定位
- en: 'You can have the application working on various platforms. If you want to target
    the push to a specific platform device or operating system, then you can use the
    following code. This code will send a separate notification for iOS, Android,
    and Windows apps:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以让应用程序在多个平台上运行。如果您想针对特定平台设备或操作系统发送推送，则可以使用以下代码。此代码将为iOS、Android和Windows应用程序发送单独的通知：
- en: '[PRE16]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Receiving push notifications
  id: totrans-121
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 接收推送通知
- en: When you receive a customized notification, you can retrieve the associated
    data from your notification. This data can help in modifying the behavior of the
    application as per the notification. For example, if the notification is sent
    because of the comment on the post, you can directly open the post for that comment
    by reading the push notification data.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 当您收到自定义通知时，您可以从通知中检索相关数据。这些数据可以帮助根据通知修改应用程序的行为。例如，如果通知是因为对帖子的评论而发送的，您可以直接通过阅读推送通知数据来打开该评论的帖子。
- en: 'Apple has a package size restriction, so it is recommended to keep your data
    size as small as possible:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 苹果对包大小有限制，因此建议尽可能保持数据大小最小：
- en: '[PRE17]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Responding to payload
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 响应有效载荷
- en: 'If your application is launched using the notification, you can access the
    data from the `[application:didFinishLaunchingWithOptions:]` method through the
    `launchOptions` dictionary:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的应用是通过通知启动的，您可以通过`launchOptions`字典从`[application:didFinishLaunchingWithOptions:]`方法访问数据：
- en: '[PRE18]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'If your application is already running in foreground mode, the data can be
    fetched from the `[application:didRegisterForRemoteNotificationsWithDeviceToken:]`
    method in the `userInfo` dictionary:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的应用程序已经在前台模式下运行，则可以从`[application:didRegisterForRemoteNotificationsWithDeviceToken:]`方法中的`userInfo`字典中获取数据：
- en: '[PRE19]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Summary
  id: totrans-130
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we explored the setup and installation of push notifications
    in our application.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们探讨了在我们的应用程序中设置和安装推送通知。
- en: We started by setting up push notifications on the Apple developer portal and
    necessary installation in codebase.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先在Apple开发者门户上设置了推送通知，并在代码库中进行了必要的安装。
- en: Then, we learned about sending the push notifications and their scheduling.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们学习了发送推送通知及其调度。
- en: Finally, we saw the ways to receive payload from the notifications.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们了解了从通知中接收有效载荷的方法。
- en: In the next chapter, we will learn about Parse users and their roles.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将学习关于Parse用户及其角色的内容。
