<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Administering the Database</h1></div></div></div><p>In this chapter, we are going to introduce you to administering the <strong>SQLite</strong> database<a class="indexterm" id="id126"/> and make you aware of the different components of this relational database system that best suits the mobile or tablet devices. SQLite<a class="indexterm" id="id127"/> is an embedded SQL engine and simply reads and writes to ordinary disk files instead of having a separate server process. It was designed for this purpose and is much easier to maintain and look after.</p><p>Apart from being a great database for programmers, SQLite is also an easier database to administer and maintain. There is no configuration or setup required to administer this database. It comes with a standard <strong>command-line interface</strong> (<strong>CLI</strong>)<a class="indexterm" id="id128"/> client that is available to administer the database(s).</p><p>There is a variety of languages that work with SQLite which are easier to maintain and add new functionality.</p><p>The following are the features of SQLite:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">SQLite is one of the most easy-to-learn databases, is easy to interact with, and gets on with the task of building a new database from scratch</li><li class="listitem" style="list-style-type: disc">Its ability to integrate database engine itself into the code is a major boost for code development, performance, and interfacing</li><li class="listitem" style="list-style-type: disc">It is easy to start, learn, perform, and get practical with how a relational database system, functions, glued together and is a store for your application's data</li></ul></div><p>In the market, there are a variety of tools that can be used to make database administration on SQLite even easier to use, more practical to install and go and develop. In our case, only the <strong>command-line program</strong> (<strong>CLP</strong>)<a class="indexterm" id="id129"/> will be used.</p><p>These are some of the tools in the market:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>RazorSQL</strong>, <a class="indexterm" id="id130"/>located<a class="indexterm" id="id131"/> at <a class="ulink" href="http://www.razorsql.com/features/sqlite_features.html">http://www.razorsql.com/features/sqlite_features.html</a>, is a tailored piece of software that works in a browser environment. It can highlight syntax and comes with an editor to write and update code, some visual administrator tools, and functionality unique to SQLite.</li><li class="listitem" style="list-style-type: disc">Another tool is <strong>SQLite Maestro,</strong><a class="indexterm" id="id132"/> located at <a class="ulink" href="http://www.sqlmaestro.com/products/sqlite/maestro/">http://www.sqlmaestro.com/products/sqlite/maestro/</a>, which is a superior product aimed at the<a class="indexterm" id="id133"/> database management market for the creation, updation, and deletion of data using SQLite. For example, it includes a database designer, SQLite syntax checking, administrator tools, and a data exporter.</li><li class="listitem" style="list-style-type: disc"><strong>Navicat</strong> <a class="indexterm" id="id134"/>is another database management tool for SQLite,<a class="indexterm" id="id135"/> located at <a class="ulink" href="http://www.navicat.com/products/navicat-for-sqlite">http://www.navicat.com/products/navicat-for-sqlite</a>. Their product comes with some good visual tools, database maintenance functionality, reporting, and data exporting, for example.</li></ul></div><p>CLP is <a class="indexterm" id="id136"/>actually a separate program that has the SQLite engine compiled in it. CLP operates both as a command line tool and interactive shell. The command line mode is the facility <strong>database administrators</strong> (<strong>DBAs</strong>)<a class="indexterm" id="id137"/> can use to create tables for an application, upload data to the skeleton tables, and modify information so that it is ready for development, testing, and releasing. To start using the command, in terminal monitor, type <code class="literal">sqlite3</code>:</p><div><img alt="Administering the Database" src="img/4725_03_01.jpg"/></div><p>If you type <code class="literal">sqlite3 &lt;database name&gt;</code>, the system will be loaded into the named database and will be ready to do work. For example, you can also type <code class="literal">sqlite3 –help</code>, as shown in the following screenshot, which will outline the commands available as part of the help. As shown in the following screenshot, there are a variety of options that will help the DBA or user perform tasks as required. Within <code class="literal">sqlite3</code>, to exit at the prompt, type <code class="literal">.exit</code> to leave the program. At the terminal prompt, <code class="literal">$</code>, type<code class="literal"> sqlite3 –help</code> to get a list of commands, as shown here:</p><div><img alt="Administering the Database" src="img/4725_03_02.jpg"/></div><p>The preceding steps are manual and can be used by the database administrator. Shell scripts to automate database processes can ideally use the format, which can improve database performance.</p><div><div><div><div><h1 class="title"><a id="ch03lvl1sec31"/>Creating a database</h1></div></div></div><p>To start, a database<a class="indexterm" id="id138"/> must be created. By using the following command to create the database, although it will be created, nothing will be physically stored in the database yet. There is no default place to store the SQLite database once it has been created. The location could be your home directory, a working directory, or a pre-created database directory:</p><div><pre class="programlisting">
<strong>$ sqlite3 testdatabase.db</strong>
</pre></div><p>By default, an environment is prepared ready effectively, for database objects, as defined by the preceding statement. SQLite was designed with the distinct policy of avoiding any size limits. To have a policy that would easily fit in the device's memory and be a 32-bit integer would work, but was not the best option. It proved to create problems since the product was pushed to extremes and the exploitation of security loopholes may have made the product vulnerable. The default settings of objects are generous and adequate for most applications. There are also different settings statements such as <code class="literal">SQLITE_MAX_COLUMN</code> that controls the maximum number of columns in a table, indexes, or view.</p><p>It is only when tables and<a class="indexterm" id="id139"/> indexes are created that the physical creation of the database actually starts. This allows the DBA to alter different page settings before the disk parameters and allocations are created. Thereafter, it is more difficult to change the settings.</p><div><div><div><div><h2 class="title"><a id="ch03lvl2sec07"/>Creating a table</h2></div></div></div><p>To create a <a class="indexterm" id="id140"/>table in the new <a class="indexterm" id="id141"/>database, use the following commands:</p><div><img alt="Creating a table" src="img/4725_03_03.jpg"/></div><p>After the preceding command is run to create a database, the <code class="literal">create table temp</code> statement is executed to make a temporary table. It has three columns, <code class="literal">id</code> which is a primary key whose value is automatically incremented; <code class="literal">name</code>, which is text; and <code class="literal">address</code>; which is also of text.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec08"/>Inserting data</h2></div></div></div><p>To insert data <a class="indexterm" id="id142"/>into the new<a class="indexterm" id="id143"/> table, use the following command. It is a simple operation to insert data into the table with the columns listed on the left-hand side, and the values and parameters, or data on the right-hand side of the same format type:</p><div><img alt="Inserting data" src="img/4725_03_04.jpg"/></div><p>Data is input <a class="indexterm" id="id144"/>into the <code class="literal">temp</code> table using data for two columns: <code class="literal">name</code> and <code class="literal">address</code>. Please note that no values are required for the <code class="literal">id</code> field since its value is <a class="indexterm" id="id145"/>provided internally by SQLite, which automatically increments its value.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec09"/>Selecting data</h2></div></div></div><p>To select data from the<a class="indexterm" id="id146"/> new table, follow the next command. It is a simple operation to fetch the information for display on the screen:</p><div><img alt="Selecting data" src="img/4725_03_05.jpg"/></div><p>Data is selected from the <code class="literal">temp</code> table using all columns, hence the character <code class="literal">*</code>, otherwise, a column name could have been specified instead, retrieving only that column data.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec10"/>Creating an index</h2></div></div></div><p>To create an<a class="indexterm" id="id147"/> index<a class="indexterm" id="id148"/> for the <code class="literal">temp</code> table, which will allow faster selection using the <code class="literal">id</code> field and also have a small overhead, which may be overtaken by the performance gain, use the following command:</p><div><img alt="Creating an index" src="img/4725_03_06.jpg"/></div><p>An index <a class="indexterm" id="id149"/>called <code class="literal">temp_idx</code> is created in the <code class="literal">name</code> column, which <a class="indexterm" id="id150"/>will allow faster access with a minimal overhead for data access.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec11"/>Exporting data</h2></div></div></div><p>To export data from <a class="indexterm" id="id151"/>SQLite, the <code class="literal">.dump</code> command is used, as shown in the <a class="indexterm" id="id152"/>following screenshot. No arguments are required and the complete database can be exported in this way. If an argument is added like a table name, then only their contents will be exported. By default, the <code class="literal">.dump</code> command will output the data to the screen. If you want to direct the output to a filesystem, use the <code class="literal">.output</code> statement plus a space, and then the <code class="literal">file name</code>, as shown in the following screenshot.</p><p>After the commands are used, a file is created in your current directory. To get back to outputting the data back to the screen, use the <code class="literal">.output stdout</code> command, as shown here.</p><p>Using these methods allows more flexibility, control, and better formatting output:</p><div><img alt="Exporting data" src="img/4725_03_07.jpg"/></div><p>As shown in the preceding screenshot, there is an output to the <code class="literal">temp.sql</code> file. The <code class="literal">.dump</code> command is issued to output all the information about the database to the <code class="literal">temp.sql</code> file. To put the output back to the screen, use the <code class="literal">.output stdout</code> command.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec32"/>Viewing database schema data</h1></div></div></div><p>SQLite offers several commands<a class="indexterm" id="id153"/> as part of a command set to get information about the contents of a database. For example, to get a list of tables, use the <code class="literal">.table</code> command. To find a specific table name, use a <code class="literal">%</code> symbol and text as a pattern to find the result, for example, <code class="literal">.tables [pattern]</code>, as shown in the following screenshot. By issuing the <code class="literal">.tables</code> command and appending a <code class="literal">%te%</code> text to it, is a request to SQLite to list all its tables within the database that has the word <code class="literal">te</code> (in our case <code class="literal">temp</code>) in their name which are displayed correctly:</p><div><img alt="Viewing database schema data" src="img/4725_03_08.jpg"/></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec12"/>Index data</h2></div></div></div><p>Prior to the following<a class="indexterm" id="id154"/> example, a <code class="literal">temp_idx</code> index has been created, to get a list of indexes for the <code class="literal">temp</code> table, at the <code class="literal">sqlite3</code> prompt <code class="literal">.indices temp</code>, which is actually the <code class="literal">.indices</code> command followed by the table name, as shown here:</p><div><img alt="Index data" src="img/4725_03_09.jpg"/></div><p>By using the preceding command, the <code class="literal">temp</code> table's index can be seen.</p></div><div><div><div><div><h2 class="title"><a id="ch03lvl2sec13"/>Schema data</h2></div></div></div><p>To view the schema of the <a class="indexterm" id="id155"/>database, the following command can be issued, <code class="literal">.schema</code>, but type the <code class="literal">.schema &lt;table name&gt;</code> command to get specific information on a <code class="literal">name</code> database object. See the following screenshot for more information:</p><div><img alt="Schema data" src="img/4725_03_010.jpg"/></div><p>The preceding command shows the output from the <code class="literal">temp</code> set of tables and index from the database. The next command shows the whole database schema:</p><div><img alt="Schema data" src="img/4725_03_011.jpg"/></div><p>The SQLite master schema<a class="indexterm" id="id156"/> table shows tables and indexes that exist on the SQLite database.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec33"/>Backing up the database</h1></div></div></div><p>There are a couple of ways to back up your <a class="indexterm" id="id157"/>SQLite database. To make it portable, use the <code class="literal">.dump</code> statement as part of the CLP, which can export the entire database and scripts to the filesystem. An example can be seen as follows:</p><div><img alt="Backing up the database" src="img/4725_03_012.jpg"/></div><p>The preceding statement shows how to invoke SQLite with a database name and pipe the output to a file called <code class="literal">temp.sql</code>.</p><p>Following is another way to invoke SQLite and then perform a backup interactively.</p><p>User can directly import the data, by the following set of commands:</p><div><img alt="Backing up the database" src="img/4725_03_013.jpg"/></div><p>The following command will open SQLite and the <code class="literal">temp.db</code> database, and import the <code class="literal">temp.sql</code> file to it. Within the <code class="literal">temp.sql</code> file, there will be scripts to read the source files and import data back to database (existing or new version):</p><div><img alt="Backing up the database" src="img/4725_03_014.jpg"/></div><p>There is another way, <a class="indexterm" id="id158"/>just copy the <code class="literal">temp.db</code> file to a version called <code class="literal">temp.backup</code>, but the aforementioned methods are much better and portable, and there may be binary compatibility issues since SQLite does not have a great reputation for backward compatibility.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec34"/>Database tools</h1></div></div></div><p>There is a vast array<a class="indexterm" id="id159"/> of SQLite administration tools, and one of them is<a class="indexterm" id="id160"/> <strong>SQL Browser</strong> (<a class="ulink" href="http://sqlitebrowser.org/">http://sqlitebrowser.org/</a>), which works on different platforms. Databases can be managed, tables can be exported or imported, and queries can be created, updated, and executed. The other tools are listed as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>RazorSQL</strong></li><li class="listitem" style="list-style-type: disc"><strong>Navicat</strong></li><li class="listitem" style="list-style-type: disc"><strong>SQL Maestro</strong></li><li class="listitem" style="list-style-type: disc"><strong>SQL Browser</strong></li><li class="listitem" style="list-style-type: disc"><strong>phpSQLiteAdmin</strong></li><li class="listitem" style="list-style-type: disc"><strong>SQLiteManager</strong></li><li class="listitem" style="list-style-type: disc"><strong>SQLite Expert</strong></li></ul></div><p>Another previous or abandoned project for SQLite administration is <a class="indexterm" id="id161"/>
<strong>phpSQLiteAdmin</strong>. This is now abandoned and the last update was in 2008. It is available at <a class="ulink" href="http://phpsqliteadmin.sourceforge.net/">http://phpsqliteadmin.sourceforge.net/</a>. phpSQLiteAdmin is a web interface for the administration of SQLite databases. It allows users to drop, create, and manage databases, and view database information like the schema, tables, indexes, and file metadata. There is a similar project in the market, namely; <a class="indexterm" id="id162"/>
<strong>Bitbucket</strong> (available at <a class="ulink" href="https://bitbucket.org/phpliteadmin/public/">https://bitbucket.org/phpliteadmin/public/</a>).</p><p><strong>SQLiteManager</strong> <a class="indexterm" id="id163"/>is a product that can manage databases to create, update, and import or export data; SQLiteManager<a class="indexterm" id="id164"/> is available at <a class="ulink" href="http://www.sqlitemanager.org/">http://www.sqlitemanager.org/</a>. This is a web-based administration tool for SQLite. Rows in the tables can be managed and user functions can be created as required. Again, this project and <a class="indexterm" id="id165"/>product is not active at present and there have been no updates since 2013. This product has now moved to Bitbucket and is no longer valid as SQLiteManager. However, since moving to Bitbucket in 2013, there have been no updates.</p><p>There is an additional tool, namely <a class="indexterm" id="id166"/>SQLite Expert (available at <a class="ulink" href="http://www.sqliteexpert.com/">http://www.sqliteexpert.com/</a>) that has a personal and a professional edition. For example, it has a built-in <strong>SQL Query Builder</strong><a class="indexterm" id="id167"/>, facilities to import and export data, and data editing.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec35"/>Database file information</h1></div></div></div><p>The <code class="literal">sqlite_master</code> view outlines the<a class="indexterm" id="id168"/> details of all the database objects within SQLite. In SQLite, the maximum size for a database would be 2,147,483,646 pages at 65,536 bytes per page or 140,737,488,224,256 bytes (about 140 terabytes), While the minimum size for an SQLite database is a single 512-byte page. The best way to see which tables exist is by performing an SQL statement on the master table, as shown in the following set of commands:</p><div><img alt="Database file information" src="img/4725_03_015.jpg"/></div><p>Effectively, download the <code class="literal">sqlite3_analyzer</code> program from the SQLite website. The program performs many functions, such as interrogating the database file and outputs a summary in text format showing the database structure, its environment, tables, indexes, the page sizes, entries, storage in bytes consumed, pages used, overflow pages, and unused bytes on primary pages.</p><p>The amount of detail available is impressive and useful when it comes to analyzing resources, components, and structure of a database.</p><p>The <code class="literal">sqlite3_analyzer</code> program<a class="indexterm" id="id169"/> can also be<a class="indexterm" id="id170"/> used in a variety of ways to use the statistics gained from using it. <code class="literal">sqlite3_analyzer</code> is a <a class="indexterm" id="id171"/>TCL script and is available at <a class="ulink" href="http://www.sqlite.org/src/artifact/8e50b217c56a6a08">http://www.sqlite.org/src/artifact/8e50b217c56a6a08</a>.</p></div>
<div><div><div><div><h1 class="title"><a id="ch03lvl1sec36"/>Summary</h1></div></div></div><p>In this chapter, you learned how to administer and look after the SQLite relational database system, which has shown you in a simple way how to look after the database for your application. This chapter showed some of the basic elements of the SQLite database. It has covered the essentials of table creation and viewing tables that make up the schema. The topics are enough to get a grasp of the subject and master the basics. This chapter covers the basic elements and gave a helping hand to administer this easy-to-use database for mobile development. This chapter also summarizes how easy it is to administer as compared to other databases in the market. There are additional tools for SQLite Administration that can be found on the web. There are many more commands and not all have been shown as examples in this chapter. These are some of the methods of using and administering SQLite. This chapter showed you what is possible when you learn a few commands and how it can help use this simple, mobile database.</p><p>In the next chapter, you will learn all about the essentials of SQL. The chapter will outline how SQL can be used properly on this mobile database. It will show you how to use the SQLite method of using SQL compared to other databases and how easy it is to pick up SQL with SQLite.</p></div></body></html>