- en: Chapter 2. Testing on Android
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now that we have introduced the reasons and the basic concepts behind testing,
    it's time to put them into practice.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: 'In this second chapter, we are covering:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: Testing on Android
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Unit testing and JUnit
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating an Android Test project
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Running tests
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We will be creating a simple Android **main** project and its companion **test**
    project. The main project will be almost empty and will just highlight testing
    components.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
- en: From my personal experience, I suggest that this chapter is useful for new developers
    with no Android Testing experience. If you have some experience with Android Projects
    and have been using testing techniques for them, you might read this chapter as
    a revision or reaffirmation of the concepts.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: Though not mandatory, best practices dictate that tests should live in a separate
    correlated project. This feature is now supported by the Android ADP plugin, but
    this has not always been the case. Some time ago I published an article ([http://dtmilano.blogspot.com/2008/11/android-testing-on-android-platf.html](http://dtmilano.blogspot.com/2008/11/android-testing-on-android-platf.html))
    describing a method for manually maintaining two correlated projects—a main project
    and a test project.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
- en: 'The advantages of this decision may not be immediately evident, but among them
    we can count:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: Testing code is easily stripped out from a production build as it is not included
    in the main project and thus not in the APK
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Ease the way of running the tests in the emulator through the Instrumentation
    option in Dev Tools
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: With large projects, deploying the main package and the tests takes less time
    if they are separated
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Encourages code reusability in similar projects
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: JUnit
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We had an overview of JUnit in the previous chapter, so no introduction is needed
    here. It is worth mentioning that the JUnit testing framework is the default option
    for Android testing projects and it is supported by Eclipse, the Android ADT plugin,
    and by Ant as well, in case you are not developing with an IDE.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
- en: So you are free to choose the best alternative for every case.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: Most of the following examples will be based on Eclipse because is the most
    common option. So, let's open Eclipse and start with no preamble.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
- en: Creating the Android main project
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We will create a new Android project. This is done from Eclipse menu **File**
    | **New** | **Project..**. | **Android** | **Android Project**.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
- en: 'In this particular case, we are using the following values for the required
    component names:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
- en: '| Project name: | **MyFirstProject** |'
  id: totrans-22
  prefs: []
  type: TYPE_TB
- en: '| Build Target: | **Android 2.3.1** |'
  id: totrans-23
  prefs: []
  type: TYPE_TB
- en: '| Application name: | **My First Project** |'
  id: totrans-24
  prefs: []
  type: TYPE_TB
- en: '| Package name: | **com.example.aatg.myfirstproject** |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
- en: '| Create Activity: | **MyFirstProjectActivity** |'
  id: totrans-26
  prefs: []
  type: TYPE_TB
- en: '| Min SDK Version: | **9** |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
- en: 'This is what your project creation dialog will look like after entering these
    values:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating the Android main project](img/3500_02_01.jpg)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
- en: Creating the Android test project
  id: totrans-30
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Press the **Next** button and the Android Test Project creation dialog will
    be displayed. Note that some values have been already picked according to the
    corresponding values selected in the main project.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Alternatively, to create a Test project for an existing Android project you
    can select the main project and then **Android Tools | Create Test Project**.
    Under *Test Target* select the name of the existing project and the required values
    will be filled in automatically.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: This image shows the Android Test Project creation dialog after entering the
    corresponding values. All the values have been already entered for us and we should
    only have to click **Finish:**
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating the Android test project](img/3500_02_02.jpg)'
  id: totrans-35
  prefs: []
  type: TYPE_IMG
- en: Package explorer
  id: totrans-36
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: After having created both projects, our Package explorer should look like the
    next image. We can note the existence of the two correlated projects, each with
    an independent set of components and project properties.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
- en: '![Package explorer](img/3500_02_03.jpg)'
  id: totrans-38
  prefs: []
  type: TYPE_IMG
- en: Now that we have the basic infrastructure set up, it's time for us to start
    adding some tests.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
- en: There's nothing to test right now, but as we are setting up the fundamentals
    of Test Driven Development discipline we are adding a dummy test just to get acquainted
    with the technique.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: The `src` folder on `MyFirstProjectTest` project is the perfect place to add
    the tests. It is not mandatory but a good practice. The package should be the
    same as the corresponding package of the component being tested.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: Right now, we are not concentrating on the tests but on the concepts and placement
    of those tests.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: Creating a test case
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As described before, we are creating our test cases in the `src` folder of the
    Test project.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: In this particular case, we are creating a unit test using JUnit TestCase. Eclipse
    provides a wizard to help us **(File | New... | Junit Test Case)**.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
- en: We are selecting the main project's Activity as the class under test; however
    this is not relevant in this example.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: 'These are the values that we should enter when we create the test case:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: '| Junit: | **Junit 3** |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
- en: '| Source folder: | **MyFirstProjectTest/src** |'
  id: totrans-49
  prefs: []
  type: TYPE_TB
- en: '| Package: | **com.example.aatg.myfirstproject.test** |'
  id: totrans-50
  prefs: []
  type: TYPE_TB
- en: '| Name: | **MyFirstProjectTests** |'
  id: totrans-51
  prefs: []
  type: TYPE_TB
- en: '| Superclass: | **junit.framework.TestCase** |'
  id: totrans-52
  prefs: []
  type: TYPE_TB
- en: '| Which method stubs would you like to create? | **setUp(), tearDown(), constructor**
    |'
  id: totrans-53
  prefs: []
  type: TYPE_TB
- en: '| Class under test: | **com.example.aatg.myfirstproject.MyFirstProjectActivity**
    |'
  id: totrans-54
  prefs: []
  type: TYPE_TB
- en: Note
  id: totrans-55
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Strictly speaking we could have left the **setUp(), tearDown()**, and **constructor**
    options unselected and this basic test we are creating would not be affected,
    but here we are describing the most general practices and we will find in many
    real life scenarios that these methods are needed.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: 'After entering all the required values our JUnit test case creation dialog
    would look like this:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a test case](img/3500_02_04.jpg)'
  id: totrans-58
  prefs: []
  type: TYPE_IMG
- en: The basic infrastructure for our tests is in place; what is left is adding a
    dummy test to verify that everything is working as expected.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: 'Eclipse also provides a way of creating stubs for the test methods. After pressing
    **Next >** the following dialog is presented where you can choose the methods
    under tests you want to generate the stubs for:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a test case](img/3500_02_05.jpg)'
  id: totrans-61
  prefs: []
  type: TYPE_IMG
- en: These stub methods may be useful in some cases but you have to consider that
    testing should be behavior driven rather than method driven.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: We now have a test case template, so the next step is to start completing it
    to suit our needs. To do it, open the recently created case class and add the
    test `testSomething()`. As a best practice, add the tests at the end of the class.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
- en: 'We should have something like this:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'This test will always fail, presenting the message: **Not implemented yet**.
    In order to do this we are using the `fail` method from the `junit.framework.Assert`
    class that fails the test with the given message.'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-67
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The no-argument constructor is needed to run a specific test from the command
    line as explained later using `am instrumentation`.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: Special methods
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The following table describes the special methods found in our test case class:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
- en: '| Method | Description |'
  id: totrans-71
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  id: totrans-72
  prefs: []
  type: TYPE_TB
- en: '| `setUp` | Sets up the fixture. For example, opens a network connection or
    creates global objects that may be needed by the tests. This method is called
    before a test is executed.In this case we are only invoking the super method.See
    [Chapter 1](ch01.html "Chapter 1. Getting Started with Testing"), *Getting Started
    with Testing* for details. |'
  id: totrans-73
  prefs: []
  type: TYPE_TB
- en: '| `tearDown` | Tears down the fixture. For example, close a network connection.
    This method is called after a test is executed.In this case we are only invoking
    the super method.See [Chapter 1](ch01.html "Chapter 1. Getting Started with Testing"),
    *Getting Started with Testing* for details. |'
  id: totrans-74
  prefs: []
  type: TYPE_TB
- en: '| `testSomething` | A simple test. In order to be discovered by JUnit 3 using
    reflection, test methods should start with the word `test`.The rest of the method
    name should clearly identify the feature under test. |'
  id: totrans-75
  prefs: []
  type: TYPE_TB
- en: Test annotations
  id: totrans-76
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Looking carefully at the test definition you may find that we decorated the
    test using `@MediumTest` annotation. This is a way to organize or categorize our
    tests and run them separately.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
- en: 'There are other annotations that can be used by the tests, such as:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
- en: '| Annotation | Description |'
  id: totrans-79
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  id: totrans-80
  prefs: []
  type: TYPE_TB
- en: '| `@SmallTest` | Marks a test that should run as part of the small tests. |'
  id: totrans-81
  prefs: []
  type: TYPE_TB
- en: '| `@MediumTest` | Marks a test that should run as part of the medium tests.
    |'
  id: totrans-82
  prefs: []
  type: TYPE_TB
- en: '| `@LargeTest` | Marks a test that should run as part of the large tests. |'
  id: totrans-83
  prefs: []
  type: TYPE_TB
- en: '| `@Smoke` | Marks a test that should run as part of the smoke tests. The `android.test.suitebuilder.SmokeTestSuiteBuilder`
    will run all tests with this annotation. |'
  id: totrans-84
  prefs: []
  type: TYPE_TB
- en: '| `@FlakyTest` | Use this annotation on `InstrumentationTestCase` class'' test
    methods. When this is present, the test method is re-executed if the test fails.
    The total number of executions is specified by the tolerance and defaults to 1\.
    This is useful for tests that may fail due to an external condition that could
    vary with time.For example, to specify a tolerance of 4, you would annotate your
    test with: `@FlakyTest(tolerance=4)`. |'
  id: totrans-85
  prefs: []
  type: TYPE_TB
- en: '| `@UIThreadTest` | Use this annotation on `InstrumentationTestCase` class''
    test methods. When this is present, the test method is executed on the application''s
    main thread (or UI thread).Because instrumentation methods may not be used when
    this annotation is present there are other techniques if, for example, you need
    to modify the UI and get access to the instrumentation within the same test.In
    those cases you can resort to the `Activity.runOnUIThread` method allowing to
    create any `Runnable` and run it in the UI thread from within your test.'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '|'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
- en: '| `@Suppress` | Use this annotation on test classes or test methods that should
    not be included in a test suite.This annotation can be used at the class level,
    where none of the methods in that class are included in the test suite, or at
    the method level to exclude just a single method or set of methods. |'
  id: totrans-89
  prefs: []
  type: TYPE_TB
- en: Now that we have the tests in place, it's time to run them, and that's what
    we are going to do next.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
- en: Running the tests
  id: totrans-91
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: There are several ways of running our tests, and we will analyze them here.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
- en: Additionally, as was mentioned in the previous section about annotations, tests
    can be grouped or categorized and run together, depending on the situation.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
- en: Running all tests from Eclipse
  id: totrans-94
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This is perhaps the simplest method if you have adopted Eclipse as your development
    environment. This will run all the tests in the package.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
- en: Select the test project and then **Run As | Android Junit Test**.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
- en: If a suitable device or emulator is not found, one will be started automatically.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
- en: Then the tests are run and the results presented inside the Eclipse DDMS perspective,
    which you may need to change to manually.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
- en: '![Running all tests from Eclipse](img/3500_02_06.jpg)'
  id: totrans-99
  prefs: []
  type: TYPE_IMG
- en: 'A more detailed view of the results and the messages produced during their
    execution can also be obtained in the LogCat view within the Eclipse DDMS perspective:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
- en: '![Running all tests from Eclipse](img/3500_02_07.jpg)'
  id: totrans-101
  prefs: []
  type: TYPE_IMG
- en: Running a single test case from Eclipse
  id: totrans-102
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: There is an option to run a single test case from Eclipse, should you need to.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
- en: Select the test project and then **Run As | Run Configurations**.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
- en: 'Then create a new configuration and under *Test*, use the following values:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
- en: '| Run a single test: | **checked** |'
  id: totrans-106
  prefs: []
  type: TYPE_TB
- en: '| Project: | **MyFirstProjectTest** |'
  id: totrans-107
  prefs: []
  type: TYPE_TB
- en: '| Test class: | **com.example.aatg.myfirstproject.test.MyFirstProjectTests**
    |'
  id: totrans-108
  prefs: []
  type: TYPE_TB
- en: When you run as usual, only this test will be executed. In our case, we have
    only one test, so the result will be similar to the screenshot presented earlier.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  id: totrans-110
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: There is a shortcut for this that you can use from within the Eclipse editor.
    Selecting the method name you can press *Shift+Alt+X T* or right-click on it and
    then choosing **Run As | JUnit Test**.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
- en: Running from the emulator
  id: totrans-112
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The default system image used by the emulator has the *Dev Tools* application
    installed, providing several handy tools and settings. Among these tools, we can
    find a rather long list as is shown in this screenshot:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: '![Running from the emulator](img/3500_02_08.jpg)'
  id: totrans-114
  prefs: []
  type: TYPE_IMG
- en: 'We are interested in **Instrumentation** now, which is the way to run our tests.
    This application lists all of the packages installed that define the `instrumentation`
    tag in their `AndroidManifest.xml`. By default, packages are listed using the
    default instrumentation which normally is `android.test.InstrumentationTestRunner`
    which is a problem to identify if you have more than one package list. To solve
    this problem you can set an optional label in the manifest, under the Instrumentation
    tab, as shown here:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
- en: '![Running from the emulator](img/3500_02_09.jpg)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
- en: 'Once this is done and the Instrumentation list is re-displayed, our package
    will be listed under this new label and we can run the tests by selecting it:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
- en: '![Running from the emulator](img/3500_02_10.jpg)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
- en: When the tests are run in this way, the results can be seen through **LogCat**
    as described in the previous section.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-120
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You can see how, as mentioned previously, if you don't set the optional Label
    more than one instrumentation appears under the same default label `android.test.InstrumentationTestRunner`.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
- en: Running tests from the command line
  id: totrans-122
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Finally, tests can be run from the command line too. This is useful if you want
    to automate or script the process.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
- en: To run the tests we are using the `am instrument` command (strictly speaking
    the `am` command and `instrument` subcommand) which allows us to run instrumentations
    specifying the package name and some other options.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
- en: You may wonder what `am` stands for. It is short for **Activity Manager**, a
    main component of the internal Android infrastructure that is started by the **System
    Server** at the beginning of the boot process and is responsible for managing
    Activities and their life cycle. Additionally, as we can see here, it is also
    responsible for Activity instrumentation.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
- en: 'The general usage of the `am instrument` command is:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'This table summarizes the most common options:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
- en: '| Option | Description |'
  id: totrans-129
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  id: totrans-130
  prefs: []
  type: TYPE_TB
- en: '| `-r` | Print raw results. Useful to collect raw performance data. |'
  id: totrans-131
  prefs: []
  type: TYPE_TB
- en: '| `-e <NAME> <VALUE>` | Set arguments by name. We will examine its usage shortly.This
    is a generic option argument that allows us to set`<name, value>` pairs. |'
  id: totrans-132
  prefs: []
  type: TYPE_TB
- en: '| `-p <FILE>` | Write profiling data to an external file. |'
  id: totrans-133
  prefs: []
  type: TYPE_TB
- en: '| `-w` | Wait for instrumentation to finish before exiting. Normally used in
    commands, although not mandatory it''s very handy, as otherwise you will not be
    able to see the test''s results. |'
  id: totrans-134
  prefs: []
  type: TYPE_TB
- en: To invoke the `am` command we will be using the `adb shell` command or, if you
    already have a shell running on an emulator or device, you can issue the `am`
    command directly at the shell command prompt.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
- en: Running all tests
  id: totrans-136
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'This command line will run all tests with the exception of performance tests:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Running tests from a specific test case
  id: totrans-139
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To run all the tests in a specific test case, you may use:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Running a specific test by name
  id: totrans-142
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Additionally we have the alternative of specifying which test we want to run
    in the command line:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: This test cannot be run in this way unless we have a no-argument constructor
    in our test case — that is the reason we added it before.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
- en: Running specific tests by category
  id: totrans-146
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: As we mentioned before, tests can be grouped into different categories using
    annotations *(Test Annotations)* and you can run all tests in this category.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
- en: 'The following options can be added to the command line:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
- en: '| `-e unit true` | Run all unit tests. These are tests that are not derived
    from `InstrumentationTestCase` (and are not performance tests). |'
  id: totrans-149
  prefs: []
  type: TYPE_TB
- en: '| `-e func true` | Run all functional tests. These are tests that are derived
    from `InstrumentationTestCase`. |'
  id: totrans-150
  prefs: []
  type: TYPE_TB
- en: '| `-e perf true` | Include performance tests. |'
  id: totrans-151
  prefs: []
  type: TYPE_TB
- en: '| `-e size {small &#124; medium &#124; large}` | Run small, medium, or large
    tests depending on the annotations added to the tests. |'
  id: totrans-152
  prefs: []
  type: TYPE_TB
- en: '| `-e annotation <annotation-name>` | Run tests annotated with this annotation.
    This option is mutually exclusive with the size option. |'
  id: totrans-153
  prefs: []
  type: TYPE_TB
- en: In our example, we annotated the test method `testSomething()` with `@SmallTest`.
    So this test is considered to be in that category and thus run, eventually with
    other tests belonging to that same category, when we specify `small` as the test
    size.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
- en: This command line will run all the tests annotated with `@SmallTest:`
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Creating a custom annotation
  id: totrans-157
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: In case you decide to sort the tests by a different criterion than their size,
    a custom annotation can be created and then specified in the command line.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
- en: As an example, let's say we want to arrange them according to their importance,
    so we create an annotation `@VeryImportantTest`.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Following this, we can create another test and annotate it with `@VeryImportantTest`.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'So, as we mentioned before, we can include this annotation in the `am instrument`
    command line to run only the annotated tests:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Running performance tests
  id: totrans-165
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: We will be reviewing performance test details in [Chapter 9](ch09.html "Chapter 9. Performance
    Testing and Profiling"), *Performance Testing* but here we will introduce the
    available options to the `am instrument` command.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
- en: To include performance tests on your test run you should add this command line
    option
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
- en: '| `-e perf true` | Include performance tests. |'
  id: totrans-168
  prefs: []
  type: TYPE_TB
- en: Dry run
  id: totrans-169
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Sometimes you may need to know only what tests will be run instead of actually
    running them.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
- en: 'This is the option you need to add to your command line:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
- en: '| `-e log true` | Display the tests to be run instead of running them. |'
  id: totrans-172
  prefs: []
  type: TYPE_TB
- en: This is useful if you are writing scripts or perhaps building other tools.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
- en: Debugging tests
  id: totrans-174
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Your tests might have bugs too; you should assume that. In that case usual debugging
    techniques apply, for example adding messages through LogCat.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
- en: If a more sophisticated debugging technique is needed you should attach the
    debugger to the test runner. In order to do so, there are two main alternatives.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
- en: The first is easy — not leaving the convenience of Eclipse and not having to
    remember hard-to-memorize command-line options. In the latest version of the Android
    ADT plugin, the option **Debug As| Android JUnit Test** was added. Thus you can
    set a breakpoint in your tests and use it.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
- en: 'To toggle a breakpoint you can select the desired line in the editor and then
    use the menu option **Run | Toggle Line Breakpoint**. Alternatively you can slightly
    alter the code of your tests to wait for the debugger connection. But don''t worry,
    this change is extremely simple. Add the following snippet to the constructor
    or any other test you want to debug. The place where you add it is not really
    relevant as the debugger would stop at breakpoints anyway. In this case, we decided
    to add `Debug.waitForDebugger()` to the constructor as follows:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: When you run the tests as usual, using **Run As | Android JUnit Test**, you
    will probably be asked to change the perspective.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
- en: '![Debugging tests](img/3500_02_11.jpg)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
- en: Once it is done, you will be in a standard debugging perspective and session.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
- en: Additionally if you can't or don't want to alter your tests' code, you can set
    breakpoints in it and pass the following option to `am instrument`.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
- en: '| `-e debug true` | Attach to debugger. |'
  id: totrans-184
  prefs: []
  type: TYPE_TB
- en: Once your tests have been started, the test runner will wait for your debugger
    to attach.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
- en: 'Execute this command line to debug the tests:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'You will see this line while waiting at the first breakpoint reached:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-189
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: This will continue and exit normally once the debug was attached and your debugging
    session will be completed.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
- en: Other command-line options
  id: totrans-191
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The `am instrument` command accepts other`<name, value>` pairs beside the previously
    mentioned ones:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
- en: '| Name | Value |'
  id: totrans-193
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  id: totrans-194
  prefs: []
  type: TYPE_TB
- en: '| package | Fully qualified package name of one or several packages in the
    test application.Multiple values are separated by commas (,). |'
  id: totrans-195
  prefs: []
  type: TYPE_TB
- en: '| class | A fully qualified test case class to be executed by the test runner.Optionally
    this could include the test method name separated from the class name by a hash
    (`#`). |'
  id: totrans-196
  prefs: []
  type: TYPE_TB
- en: '| coverage | TrueRuns the EMMA code coverage and writes output to a file that
    can also be specified.We will dig into details about supporting EMMA code coverage
    for our tests in [Chapter 10](ch10.html "Chapter 10. Alternative Testing Tactics"),
    *Alternative Testing Tactics.* |'
  id: totrans-197
  prefs: []
  type: TYPE_TB
- en: Summary
  id: totrans-198
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We have reviewed the main techniques and tools behind testing in Android.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
- en: 'The following is what we have covered in this chapter:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
- en: Created our first Android test project as a companion for a sample Android project.
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Followed the best practice of always creating our companion test project even
    if initially you may think it's not needed.
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 跟随最佳实践，我们始终创建我们的伴随测试项目，即使最初你可能认为它不是必需的。
- en: Created a simple test class to test the Activity in the project. We haven't
    added any useful test cases yet but adding those simple ones was intended to validate
    all of our infrastructure.
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建了一个简单的测试类来测试项目中的 Activity。我们还没有添加任何有用的测试用例，但添加这些简单的用例是为了验证我们的所有基础设施。
- en: We also ran this simple test from Eclipse and from the command line to understand
    the alternatives we have. In this process, we mentioned the Activity Manager and
    its command line incarnation `am`.
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们还从 Eclipse 和命令行运行了这个简单的测试，以了解我们拥有的替代方案。在这个过程中，我们提到了活动管理器及其命令行版本 `am`。
- en: Analyzed the most used command lines and explained their options.
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 分析了最常用的命令行并解释了它们的选项。
- en: Created a custom annotation to sort our tests and demonstrated its usage.
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建了一个自定义注解来排序我们的测试，并演示了其用法。
- en: Running the tests and interpreting the results let us know how well our application
    is behaving.
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 运行测试并解释结果让我们了解到我们的应用程序表现如何。
- en: In the next chapter we will start analyzing the mentioned techniques, frameworks,
    and tools in much greater detail and provide examples of their usage.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将更详细地分析提到的技术、框架和工具，并提供它们用法的示例。
