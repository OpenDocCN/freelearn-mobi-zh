<html><head></head><body><div class="chapter" title="Chapter&#xA0;10.&#xA0;Gameplay Scripting"><div class="titlepage"><div><div><h1 class="title"><a id="ch10"/>Chapter 10. Gameplay Scripting</h1></div></div></div><div class="blockquote"><blockquote class="blockquote"><p>We've come a long way in the past few chapters and have created a great deal of our game, but we still need to do a bit of work to implement some of our gameplay concepts. In this chapter we'll explore some of the gameplay scripts needed to implement the play mechanics of our game.<a id="id437" class="indexterm"/>
</p></blockquote></div><p>In this chapter we shall learn:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">How to add a particle system to our imported models to simulate a weapon</li><li class="listitem" style="list-style-type: disc">How to use animation to drive events in the game</li><li class="listitem" style="list-style-type: disc">How to handle ragdoll physics on our character and enemies</li><li class="listitem" style="list-style-type: disc">How to keep score and trigger events based on gameplay</li></ul></div><p>With these basics we'll have the core of an actual game's play mechanics completed and all we'll need to do is add this to the world the characters live in.</p><div class="section" title="Gunplay as gameplay"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec01"/>Gunplay as gameplay</h1></div></div></div><p>As our game is a shooter, one of the primary gameplay mechanics we need to provide is a mechanism through which guns can fire projectiles and hit other objects in the world. While there are many ways to accomplish gunfire in the game such as simulating the gunfire or creating game objects that represent projectiles, the more efficient mechanism to represent gunfire is a particle system. By attaching a particle system to our gun object, we can easily draw a representation of projectiles being fired at objects in the game world.<a id="id438" class="indexterm"/>
</p><p>Particle Systems in Unity support physics, collision, and memory management in a way that is particularly efficient for mobile devices. The only issue to watch for is that the fill rate (the rate at which the screen can be filled or drawn) for mobile devices is not as high as that of their desktop cousins. Similarly, if you perform actions such that the engine must redraw certain areas of the screen repetitively, you will see the same fill-rate issues. So if you have a lot of particles that are taking up large sections of the screen, you will likely have a performance issue. We will discuss this in much greater detail during the optimization chapter.<a id="id439" class="indexterm"/>
</p></div></div>
<div class="section" title="Time for action &#x2014; Readying the weapon"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec02"/>Time for action —  Readying the weapon</h1></div></div></div><p>For this example we will create a new project called gun range so that we can easily test our gameplay without having to build and deploy the entire project. Whenever you are making a large play mechanic change to your game, it is often useful to do this in isolation so that you can be more agile in your development. Large projects can get cluttered pretty quickly so it's best to test in simple projects:<a id="id440" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create a new project called<span class="strong"><strong> GunRange</strong></span>. Save the scene in the project as<span class="strong"><strong> level_0</strong></span>.</li><li class="listitem">Import a static gun model and put it in a hierarchy group called<span class="strong"><strong> Weapons</strong></span>.</li><li class="listitem">Next we need to ensure that the weapon is pointed along the Z-axis. We accomplish this by rotating the model so that the business end (that is, the end our projectiles will come out of) is pointed along the positive Z-axis.</li></ol></div><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_1.jpg" alt="Time for action — Readying the weapon"/></div><p>As we will attach this entire weapon and its gunfire particle system to the character as a prefab, we want to make sure that we define everything at this point relative to the coordinate system of the prefab. This is so that when it is attached to our character, or other object, it behaves properly.</p><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec01"/>What just happened?</h2></div></div></div><p>We just imported a gun model to our scene and aligned it to the Z-axis. We did this relative to the prefabs, coordinate system and not specifically to the game's coordinate system. We did this because we want projectiles being fired along the prefabs Z-axis regardless of what else is going on in the world's coordinate system.<a id="id441" class="indexterm"/>
</p><p>It doesn't really matter which axis you align the weapon to (so long as you adjust your model and scripts), but it makes logical sense to align the weapon so that it is pointed down the Z-axis so that when we fire projectiles they are going down the positive Z. Why? In the traditional orientation for 3d graphics, movement along the positive Z-axis represents things moving away from the camera — so it makes sense to use that here.</p></div><div class="section" title="Firing projectiles"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec02"/>Firing projectiles</h2></div></div></div><p>We have two approaches that we can use to add a particle system to our weapon. We can either add it directly to our gun's Game Object or we can add a child Game Object to the gun that does the actual emitting. The approach you choose really depends on how much flexibility you need versus your desire to have more objects in the hierarchy.<a id="id442" class="indexterm"/>
</p><p>If you add the particle system directly to the gun's Game Object, the particles will be emitted from the center of the Game Object and that would not be visually correct. The more universal case is to create a Game Object that will serve as the emission point and attach that to a point on the weapon. This is the approach we will use for our project.</p></div></div>
<div class="section" title="Time for action &#x2014; Adding a particle system"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec03"/>Time for action —  Adding a particle system</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create an empty game object from the<span class="strong"><strong> GameObject</strong></span> menu and select<span class="strong"><strong> Create Empty</strong></span>.<a id="id443" class="indexterm"/><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_15.jpg" alt="Time for action — Adding a particle system"/></div></li><li class="listitem">Name this game object<span class="strong"><strong> MuzzlePoint</strong></span>.<a id="id444" class="indexterm"/><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_16.jpg" alt="Time for action — Adding a particle system"/></div></li><li class="listitem">Select the<span class="strong"><strong> MuzzlePoint</strong></span> game object in the<span class="strong"><strong> Hierarchy</strong></span> view to bring up the components associated with it.<a id="id445" class="indexterm"/><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_18.jpg" alt="Time for action — Adding a particle system"/></div></li><li class="listitem">In the<span class="strong"><strong> Component</strong></span> menu select<span class="strong"><strong> Ellipsoid Particle Emitter</strong></span> so that it has a particle system associated with it.<div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_17.jpg" alt="Time for action — Adding a particle system"/></div></li><li class="listitem">Position the<span class="strong"><strong> MuzzlePoint</strong></span> game object on your gun model in Unity to designate where the projectiles should be emitted.<a id="id446" class="indexterm"/><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_18.jpg" alt="Time for action — Adding a particle system"/></div></li><li class="listitem">The next thing we need to do is have our particle emitter actually emit particles. Since we set up our weapon so that it was pointing down the Z-axis, it is pretty easy to configure our particle system so that it will send the particles down the positive Z-axis as well.<a id="id447" class="indexterm"/><p>Remember that since we've made this particle emitter a child of our gun, we want to make sure that the coordinate system we define for it is relative to the origin of the gun model. You will need to adjust it from the gun model's origin to position it properly on the gun, but realize that the coordinate system for the <span class="strong"><strong>MuzzlePoint</strong></span> is relative to that of the gun.
</p><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_23.jpg" alt="Time for action — Adding a particle system"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">Since we've made this a child of our gun model, we want to configure it to be at the gun models, origin. You may have to adjust this for your particular model, but you should make sure you start at the gun model's origin.<p>Since we are creating a particle system that represents bullets, we want to have all of our projectiles moving along the same axis. To accomplish this with an <span class="strong"><strong>Ellipsoid Particle Emitter</strong></span>, we change the Ellipsoid for the emitter to only emit particles along one axis, the Z-axis in this case. If we didn't do this, we would have particles that would spray along random axes.
</p></li></ul></div><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_19.jpg" alt="Time for action — Adding a particle system"/></div></li><li class="listitem">Finally, we need to add a simple script, call it Gunfire, to our<span class="strong"><strong> MuzzlePoint</strong></span> game object that is tied to the fire button of our gun and we're done.<a id="id448" class="indexterm"/><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
public class Gunfire : MonoBehaviour {
public GameObject muzzlePoint;
// Use this for initialization
void Start () {
muzzlePoint = GameObject.Find("MuzzlePoint");
}
void fireWeapon() {
muzzlePoint.particleEmitter.Emit(1);
}
}
</pre></div></li><li class="listitem">Import the soldier model into our scene as done previously.<div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_21.jpg" alt="Time for action — Adding a particle system"/></div></li><li class="listitem">Adjust the gun in the soldier's hierarchy such that it is a child of the hand so that the soldier is carrying the item and will move in sync with the player as they move.<a id="id449" class="indexterm"/><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_22.jpg" alt="Time for action — Adding a particle system"/></div></li><li class="listitem">Update the<span class="strong"><strong> Gunfire</strong></span> script adding a<code class="literal"> GUI.Button</code> to simulate our fire button in the real game.<a id="id450" class="indexterm"/><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
public class Gunfire : MonoBehaviour {
public GameObject muzzlePoint;
// Use this for initialization
void Start () {
muzzlePoint = GameObject.Find("MuzzlePoint");
}
void fireWeapon() {
muzzlePoint.particleEmitter.Emit(1);
}
// Update is called once per frame
void OnGUI () {
if ( GUI.Button( new Rect(0,0,50,50), "Fire" ) )
{
//Debug.Log("Firing the weapon");
fireWeapon();
}
}
}
</pre></div></li><li class="listitem">Run the game and press the fire button.<a id="id451" class="indexterm"/></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec03"/>What just happened?</h2></div></div></div><p>We just gave our weapon the ability to fire particles that represent bullets. We have also attached that weapon to our normal player so that it is an integral part of our player and will move as the player animates in the scene. We now have one of the fundamental building blocks for a game that involves shooting as a primary play mechanic.</p><p>Currently our particles have a default appearance, but if we want to change that appearance we can simply add a Particle Renderer component to this<span class="strong"><strong> MuzzlePoint</strong></span> game object. We can then change the appearance of the particles by providing our own texture that is representative of what our bullets will look like.<a id="id452" class="indexterm"/>
</p></div></div>
<div class="section" title="Let the animation drive"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec04"/>Let the animation drive</h1></div></div></div><p>There will often be times where there is a lot of contextual information in the animation data that has been given to us by our animators. In our case we have an animation where our character will go through a throwing animation to represent throwing a grenade, but currently we have no way of actually putting a game object into the world that will respond to this. One certainly wouldn't want to hard code the frame of animation that the throw represents, as this is likely to change throughout the course of the game. We can, fortunately, associate any arbitrary part of an animation with a callback in Unity.<a id="id453" class="indexterm"/>
</p><div class="section" title="Animation Events"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec04"/>Animation Events</h2></div></div></div><p>In Unity's animation system we have the ability to associate events with arbitrary parts of an animation. Unity refers to this capability as Animation Events. With an Animation Event we can have the animation system execute scripts and consequently drive some of the logic of the game. Animation Events can be added to any Animation Clip that you have imported from your modeling environment or any ad hoc animation you create using the<span class="strong"><strong> Animation</strong></span> view.<a id="id454" class="indexterm"/>
</p></div></div>
<div class="section" title="Time for action &#x2014; Adding animation events"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec05"/>Time for action —  Adding animation events</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem">To add an event to our soldier's animation, select the character and examine the<span class="strong"><strong> Animation</strong></span> view.<a id="id455" class="indexterm"/><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_9.jpg" alt="Time for action — Adding animation events"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">Above the animation data are two tracks — the top-most track shows all of the events added for this animation. The bottom track shows all of the defined key frames for our animation data.<a id="id456" class="indexterm"/></li></ul></div><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_10.jpg" alt="Time for action — Adding animation events"/></div></li><li class="listitem">Create a C# script called<code class="literal"> GrenadeToss</code> and make it a child of our soldier object.<a id="id457" class="indexterm"/></li><li class="listitem">Delete the<code class="literal"> Start()</code> and<code class="literal"> Update()</code> methods in the class and create a method called<code class="literal"> TossIt</code> in the class and add a log statement to it. The<code class="literal"> Start()</code> and<code class="literal"> Update()</code> methods are not necessary for our purposes.<a id="id458" class="indexterm"/><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
public class GrenadeToss : MonoBehaviour {
// Use this for initialization
void TossIt () {
Debug.Log("We have arrived at the toss point of the script");
}
}
</pre></div></li><li class="listitem">Next, scroll through the animation in the<span class="strong"><strong> Animation</strong></span> view until you get to the point in the animation where you want to have the throw take place.<div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_12.jpg" alt="Time for action — Adding animation events"/></div></li><li class="listitem">Create a new Animation Event by clicking on the<span class="strong"><strong> Add Animation Event</strong></span> button. You can also accomplish this task by clicking on the event track above the animation data. An<span class="strong"><strong> Edit Animation Event</strong></span> dialog will appear that will allow you to configure the script function that will be called when that event is reached.<a id="id459" class="indexterm"/><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_14.jpg" alt="Time for action — Adding animation events"/></div></li><li class="listitem">Open the list box and you will see a list of all of the functions that can be called.<a id="id460" class="indexterm"/></li><li class="listitem">Select the<code class="literal"> TossIt()</code> function.<a id="id461" class="indexterm"/><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_13.jpg" alt="Time for action — Adding animation events"/></div></li><li class="listitem">Press the play button for the animation. If everything is successful, you will see the log message printed out when that frame of animation is reached.</li><li class="listitem">Create a folder called<code class="literal"> Grenade</code> in the<code class="literal"> Weapons</code> folder of the project.</li><li class="listitem">Create a new Prefab object called<span class="strong"><strong> Grenade</strong></span> as a simple sphere, stretched in one dimension.<a id="id462" class="indexterm"/><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_24.jpg" alt="Time for action — Adding animation events"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">This is the object that we will create when the character reaches the animation position for <code class="literal">TossIt().
</code><a id="id463" class="indexterm"/></li></ul></div></li><li class="listitem">Update our<code class="literal"> GrenadeToss</code> script to instantiate a game object when the player reaches the<code class="literal"> TossIt()</code> function of our script. Since we want this object to be simulated by the physics system, we want to create it as a<span class="strong"><strong> Rigidbody</strong></span>. Accomplish this by selecting the Grenade object from the hierarchy and add a<span class="strong"><strong> Rigidbody</strong></span> to it.<a id="id464" class="indexterm"/><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_25.jpg" alt="Time for action — Adding animation events"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">Now every Grenade object we instantiate will be simulated by the physics system.</li></ul></div></li><li class="listitem">We also want to instantiate this grenade at the location of the hand when we reach this point in the animation. Since all of the parts of our soldier model are named, we can use the Transform of that object after we look it up from the hierarchy.<div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
public class GrenadeToss : MonoBehaviour {
public Rigidbody grenade;
// Use this for initialization
void TossIt(){
Debug.Log("We have arrived at the toss point of the script");
Transform handLocation = GameObject.Find("LeftHandIndex1").transform;
Instantiate( grenade, handLocation.position, handLocation.rotation );
animation eventsadding}
}
</pre></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec05"/>What just happened?</h2></div></div></div><p>We have just added some realism to our game and provided some flexibility to our artists. By importing our animation data and then associating an event with it we have created a path to drive gameplay behavior entirely based on the scripts. We can expand this further by allowing the artists to model weapons behavior in animations and as the modeled bullets are ejected from the gun, we can update our ammo counter such that it and the animation are in perfect sync.</p><p>Further, we have provided functionality for the player to create a new game object on demand and put it in the game world, driven by the physics engine.<a id="id466" class="indexterm"/>
</p></div></div>
<div class="section" title="You are already dead"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec06"/>You are already dead</h1></div></div></div><p>Now that we have a player that can fire a gun, we need to have the projectiles fired from that gun to collide with enemies and for those enemies to take damage when hit and be destroyed.</p><p>To accomplish this we will add a Particle Collider to our gun system and add a damage script to our enemies so they can respond to being hit by projectiles.<a id="id467" class="indexterm"/>
</p><div class="section" title="World Particle Colliders"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec06"/>World Particle Colliders</h2></div></div></div><p>The World Particle Collider is what is used to detect collisions between particles and other colliders in a scene. The other colliders in the scene can be any one of the normal spheres, boxes, capsules, and wheel or mesh colliders that Unity can assign to a game object.<a id="id468" class="indexterm"/>
</p></div></div>
<div class="section" title="Time for action &#x2014; Detecting collisions"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec07"/>Time for action —  Detecting collisions</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Import the Target Dummy model from the project assets folder.</li><li class="listitem">To ensure that your game objects have collision data, be sure to check the<span class="strong"><strong> Generate Colliders</strong></span> setting in the Import Settings for your mesh.<a id="id469" class="indexterm"/><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note13"/>Note</h3><p>In many cases, however, it is less costly and reasonably accurate to use a simple sphere or box collider for your enemies. If you want to do location specific damage, this is one of the cheaper ways to accomplish the effect on mobile devices.</p></div><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_2.jpg" alt="Time for action — Detecting collisions"/></div></li><li class="listitem">Now that we have collision data for our target game objects, we need to add a particle collider to the particle system we created earlier. We do this by selecting the component in the<span class="strong"><strong> Component | Particles</strong></span> |<span class="strong"><strong> World Particle Collider</strong></span> menu.<div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_3.jpg" alt="Time for action — Detecting collisions"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">By itself this will result in particles colliding with other objects, but what we really want is for the game objects to be notified when the collision happens so we can have our target react to being hit.<a id="id470" class="indexterm"/></li></ul></div></li><li class="listitem">To do this we select the<span class="strong"><strong> Send Collision Message</strong></span> in the<span class="strong"><strong> World Particle Collider</strong></span> so that each particle game object and the game object involved in the collision receive a collision message.<div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_4.jpg" alt="Time for action — Detecting collisions"/></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">We can look for this event in scripts that we attach to any object we want to receive collision events from the particle system.</li></ul></div></li><li class="listitem">Create a script called<code class="literal"> Damage</code> and attach the collision script to the Test Dummy objects that will process the damage.<a id="id471" class="indexterm"/><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
public class Damage : MonoBehaviour {
void OnParticleCollision()
{
Debug.Log("Hit!");
}
}
</pre></div></li><li class="listitem">Update the<code class="literal"> OnParticleCollision()</code> method to update the health of the object that has been hit by the particle. When the health of that item reaches zero, remove the test dummy from the game.<a id="id472" class="indexterm"/><div class="informalexample"><pre class="programlisting">void OnParticleCollision()
{
HealthScript healthScript = GetComponent&lt;HealthScript&gt;();
healthScript.takeHit(1);
Debug.Log("Hit!");
}
</pre></div></li><li class="listitem">Here we are going to have our Damage script communicate with a <code class="literal">HealthScript
</code>, which will define the health of our target dummy objects and remove them when they have run out of health.</li><li class="listitem">Attach the<code class="literal"> HealthScript</code> to the target dummies.<div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
public class HealthScript : MonoBehaviour {
public int initialHealth;
private int currentHealth;
// Use this for initialization
void Start () {
currentHealth = initialHealth;
}
public void TakeHit( int damage ) {
currentHealth = currentHealth - damage;
if ( currentHealth &lt;= 0 )
{
Destroy( this.gameObject );
}
}
}
</pre></div></li></ol></div><p>Here we will simply remove the game object after it has taken enough damage by telling the game object that this script is attached to to destroy itself. If we wanted this object to explode or take some other behavior we could Instantiate an explosion prefab at this game object's location when we destroy the original object.<a id="id473" class="indexterm"/>
</p><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec07"/>What just happened?</h2></div></div></div><p>We have now handled the other part of our gameplay. The player can fire a weapon, the projectiles will be emitted using a particle system and when the particles come into contact with another object the damage can be calculated and this object removed from the game.</p></div></div>
<div class="section" title="Playing with (rag) dolls"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec08"/>Playing with (rag) dolls</h1></div></div></div><p>Up to this point we have simply removed enemies from the game when they have taken damage from our weapons. However, we want the enemies to respond realistically to damage from weapons based on the physics properties of the damage. In particular, when a grenade impacts an enemy, the force of the blast — something that is not currently simulated at all, should toss them around.</p><p>To accomplish this we will use Unity's Rag Doll system and assign it to our target dummies, so that when they take damage, physics will drive their motion.<a id="id474" class="indexterm"/>
</p></div>
<div class="section" title="Time for action &#x2014; Attaching a rag doll"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec09"/>Time for action —  Attaching a rag doll</h1></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create a new scene in the project.<a id="id475" class="indexterm"/></li><li class="listitem">Create a ground plane and texture it.</li><li class="listitem">Import the target dummy model into the scene.<div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_5.jpg" alt="Time for action — Attaching a rag doll"/></div></li><li class="listitem">Create a Ragdoll by selecting<span class="strong"><strong> GameObject | Create Other | Ragdoll</strong></span><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_6.jpg" alt="Time for action — Attaching a rag doll"/></div></li><li class="listitem">Next we need to map the skeleton of our target dummy model to the bone hierarchy of the rag doll. Unity makes this simple by providing a Ragdoll wizard with which we can perform the mapping between the two bone hierarchies.<a id="id476" class="indexterm"/></li><li class="listitem">Select the circle to the right of the Ragdoll item to bring up a list of transforms that you can connect it to.</li><li class="listitem">Drag and drop the<span class="strong"><strong> soldier (Transform)</strong></span> onto the<span class="strong"><strong> Root</strong></span> of the item in the list for the Ragdoll nodes that are to be mapped.<a id="id477" class="indexterm"/><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_7.jpg" alt="Time for action — Attaching a rag doll"/></div></li><li class="listitem">Select the root of the Soldier model in the<span class="strong"><strong> Hierarchy</strong></span> view so you can see the Ragdoll mapped onto the geometry of the soldier.<a id="id478" class="indexterm"/><div class="mediaobject"><img src="graphics/978-1-84969-040-9_10_11.jpg" alt="Time for action — Attaching a rag doll"/></div></li><li class="listitem">Examine the scene by pressing the<span class="strong"><strong> Play</strong></span> button.<a id="id479" class="indexterm"/></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec08"/>What just happened?</h2></div></div></div><p>You will note that the physics system has simulated the various forces on the rag doll and it has collapsed, as gravity is the only force on the dummy and there is nothing preventing it from falling to the ground plane.</p><p>This brings up the first problem that we have to solve — we need our model to be rigid until we want it to be impacted by the world of physics. We can accomplish this by either turning off physics until the character is in a state where it should not be in control of its actions, such as in the case of an explosion, or we need to attach the character to some other system that prevents it from slumping over.</p><p>We have attached rag dolls and rigid body physics systems to our enemies so that they can animate properly when hit affected by the physics of explosions and other in-world physics simulations. When we turn on the rag dolls, Unity uses physics, as opposed to our animation data, to determine what happens to the character. This results in a more realistic reflection of the world.<a id="id480" class="indexterm"/>
</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec10"/>Summary</h1></div></div></div><p>In this chapter we walked through all of the basic requirements for gameplay in our game.</p><p>Specifically, we covered:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">How to equip a character with weapons</li><li class="listitem" style="list-style-type: disc">How to have the character move through the animations of firing the weapons</li><li class="listitem" style="list-style-type: disc">How to display the projectiles using a particle system</li><li class="listitem" style="list-style-type: disc">How to have the weapons impact enemies</li><li class="listitem" style="list-style-type: disc">How to create weapons that have Rigid Body physics and how to assign Rag Dolls to objects.</li></ul></div><p>Now that we have a better understanding of gameplay scripting knowledge under our belt, it's time to look at how to optimize our game for optimal performance on the target device. While the scripts provided will work on any platform, as we'll see in the next chapter, there are some particular tricks to making them perform optimally on the iOS platform.</p></div></body></html>