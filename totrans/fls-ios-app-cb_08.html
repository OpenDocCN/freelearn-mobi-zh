<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;Screen Resolution and Orientation Changes"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Screen Resolution and Orientation Changes</h1></div></div></div><p>In this chapter, we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Targeting a device</li><li class="listitem" style="list-style-type: disc">Targeting the Retina display</li><li class="listitem" style="list-style-type: disc">Supporting multiple resolutions</li><li class="listitem" style="list-style-type: disc">Setting the default aspect ratio</li><li class="listitem" style="list-style-type: disc">Enabling auto-orientation</li><li class="listitem" style="list-style-type: disc">Listening for orientation changes</li><li class="listitem" style="list-style-type: disc">Responding to orientation changes</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec01"/>Introduction</h1></div></div></div><p>The inclusion of an accelerometer allowed the original iPhone to detect changes in its physical orientation; reflowing its on-screen content to suit the user's preference for either portrait or landscape viewing. Offering this, however, meant that an application had to be designed and coded for two screen aspect ratios—one for the portrait and another for landscape.<a id="id665" class="indexterm"/>
</p><p>As the iOS family has grown, so too has the number of screen resolutions that must be supported. With the launch of the iPad and the introduction of Retina display devices, there are now three separate resolutions. If you also take into consideration the two aspect ratios, then screen layout management for your application can become daunting.</p><p>This chapter provides recipes that will help you render content properly on any iOS device, regardless of its screen resolution and physical orientation.</p></div></div>
<div class="section" title="Targeting a device"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec02"/>Targeting a device</h1></div></div></div><p>The iOS family consists of three devices: iPhone, iPod touch, and iPad. When developing for iOS, you must state the devices that you are specifically targeting. Your choice will dictate how your app is run by each of the three.<a id="id667" class="indexterm"/>
</p><p>This recipe will take you through the necessary steps required to create an app that targets the entire family.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec01"/>Getting ready</h2></div></div></div><p>An FLA has been provided as a starting point for this recipe. Open<code class="literal"> chapter8\recipe1\recipe.fla</code> from the book's accompanying code bundle.<a id="id668" class="indexterm"/>
</p><p>Sitting on the stage is a dynamic text field with an instance name of<code class="literal"> output</code>. We will use this text field to report which device your app is currently being run on.</p><p>For the avoidance of doubt, this recipe will not take advantage of the Retina display resolution of the iPhone 4/4S and fourth-generation iPod touch. If you would like to provide Retina support, then refer to this chapter's<span class="emphasis"><em> Targeting the Retina display</em></span> recipe.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec02"/>How to do it...</h2></div></div></div><p>We will specify the target devices from the AIR for iOS Settings panel and then write some ActionScript to report which device the app is currently running on.</p><div class="section" title="Setting the target devices"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec01"/>Setting the target devices</h3></div></div></div><p>Let us start by setting the target devices:<a id="id669" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Open the AIR for iOS Settings panel by selecting<span class="strong"><strong> File</strong></span> |<span class="strong"><strong> AIR for iOS Settings</strong></span> from Flash Professional.</li><li class="listitem">Ensure that the<span class="strong"><strong> General</strong></span> tab is selected.</li><li class="listitem">Select<span class="strong"><strong> iPhone and iPad</strong></span> from the<span class="strong"><strong> Device</strong></span> field.</li><li class="listitem">If you are using Flash Professional CS5.5, then also set the<span class="strong"><strong> Resolution</strong></span> field to<span class="strong"><strong> Standard</strong></span>.</li><li class="listitem">Click on<span class="strong"><strong> OK</strong></span> to close the panel.</li></ol></div></div><div class="section" title="Detecting the current device"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec02"/>Detecting the current device</h3></div></div></div><p>Now, let us move onto the ActionScript required for this recipe:<a id="id670" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create a document class; name it<code class="literal"> Main</code>.</li><li class="listitem">Add the following three import statements to the class:<div class="informalexample"><pre class="programlisting">import flash.display.MovieClip;
<span class="strong"><strong>
import flash.display.StageAlign;
import flash.display.StageScaleMode;
import flash.system.Capabilities;</strong></span>
</pre></div></li><li class="listitem">Within the constructor, set a scale mode and alignment for the stage:<a id="id671" class="indexterm"/><div class="informalexample"><pre class="programlisting">public function Main() {
<span class="strong"><strong>stage.scaleMode = StageScaleMode.NO_SCALE;
stage.align = StageAlign.TOP_LEFT;</strong></span>
}
</pre></div></li><li class="listitem">Using the<code class="literal"> Capabilities</code> class, determine which device the app is running on:<a id="id672" class="indexterm"/><div class="informalexample"><pre class="programlisting">public function Main() {
stage.scaleMode = StageScaleMode.NO_SCALE;
stage.align = StageAlign.TOP_LEFT;
<span class="strong"><strong>
if(Capabilities.screenResolutionX == 320)
{
output.text = "iPhone / iPod touch";
}
else if(Capabilities.screenResolutionX == 768)
{
output.text = "iPad";
}
</strong></span>
}
</pre></div></li><li class="listitem">Save the document class within the same folder as your FLA and name it<code class="literal"> Main.as</code>. Also save the FLA.<a id="id673" class="indexterm"/></li><li class="listitem">Publish and test the app on your device. Install it on multiple devices if you have access to more than one.</li></ol></div><p>When you run it on an iPhone or iPod touch, the following text will be output to the screen:</p><p><span class="strong"><strong>iPhone / iPod touch</strong></span>
</p><p>Those testing on an iPad will see the following:</p><div class="informalexample"><pre class="programlisting">iPad
</pre></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec03"/>How it works...</h2></div></div></div><p>You specify the devices you wish to target by setting the<span class="strong"><strong> Device</strong></span> field within the AIR for iOS Settings panel. The following three options are available to you:<a id="id674" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>iPhone</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>iPad</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>iPhone and iPad</strong></span><a id="id675" class="indexterm"/></li></ul></div><p>The iPod touch is not listed because it is treated as an iPhone—both devices share the same aspect ratio and resolution.</p><p>Selecting<span class="strong"><strong> iPhone</strong></span> restricts your screen size to that of the iPhone and the iPod touch. Your app will still run on the iPad but it won't attempt to take advantage of the iPad's increased resolution. Instead, the iPad will run the app using the iPhone's standard 320x480 resolution. Users can either run the app at its normal size or use pixel-doubling to cover almost the entire screen.</p><p>Selecting<span class="strong"><strong> iPad</strong></span> does take advantage of the iPad's entire 768x1024 resolution but restricts your app to that device.</p><p>If you are writing an app that can run across all three devices by adapting to the different screen sizes then select<span class="strong"><strong> iPhone and iPad</strong></span>. This is more commonly known as a universal app and is the type of application we have opted for in this recipe.<a id="id676" class="indexterm"/>
</p><p>Apple acknowledges the difficulty of writing for multiple devices and screen resolutions. To ease development, they provide the following two options when targeting the entire iOS family:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Write two separate apps—one for iPad and another for iPhone/iPod touch</li><li class="listitem" style="list-style-type: disc">Write a universal app that adapts to each device's screen size</li></ul></div><p>Of course it is not mandatory that you support all three devices. For example, it is perfectly acceptable to write an app that only targets the iPad.</p><p>It is possible to determine the device your app is running on by querying the device's screen resolution. Both the iPhone and iPod touch have a horizontal resolution of 320 pixels, while the iPad's is 768 pixels wide. Therefore, we only need to query the static<code class="literal"> Capabilities.screenResolutionX</code> property to determine the device type rather than also examining the vertical resolution with<code class="literal"> Capabilities.screenResolutionY</code>.<a id="id677" class="indexterm"/>
</p><p>You may be tempted to use<code class="literal"> Stage.stageWidth</code> instead, but remember that with the stage dimensions fixed, the same width will be returned across all device types for this recipe.</p><p>You can obtain more information regarding<code class="literal"> flash.system.Capabilities, flash.display.StageScaleMode</code> and<code class="literal"> flash.display.StageAlign</code> from Adobe Community Help.<a id="id678" class="indexterm"/>
</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec04"/>There's more...</h2></div></div></div><p>It is also worth considering the following information when targeting multiple devices.</p><div class="section" title="Application launch image"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec03"/>Application launch image</h3></div></div></div><p>When targeting multiple device types, remember to include a launch image for each supported resolution. Alternative launch images can also be provided for different orientations if you choose to support them. For more detail, refer to the<span class="emphasis"><em> Including an application launch image</em></span> recipe from<a class="link" href="ch03.html" title="Chapter 3. Writing your First App"> Chapter 3</a>.<a id="id679" class="indexterm"/>
</p></div><div class="section" title="Including icons"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec04"/>Including icons</h3></div></div></div><p>Remember to include the appropriate icon artwork required by each device type you wish to support. Refer to the<span class="emphasis"><em> Including icons</em></span> recipe from<a class="link" href="ch03.html" title="Chapter 3. Writing your First App"> Chapter 3</a> for more detail.<a id="id680" class="indexterm"/>
</p></div><div class="section" title="Landscape aspect ratio"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec05"/>Landscape aspect ratio</h3></div></div></div><p>The<code class="literal"> screenResolutionX</code> and<code class="literal"> screenResolutionY</code> properties are always returned as if the device is being held in its portrait orientation. For example, an iPad app that has a default landscape orientation will still return a horizontal resolution of 768 pixels and a vertical resolution of 1024 pixels.<a id="id681" class="indexterm"/>
</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec05"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>AIR for iOS general settings, <a class="link" href="ch02.html" title="Chapter 2. Building iOS Apps Using Flash">Chapter 2</a></em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Targeting the Retina display</em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Setting the default aspect ratio</em></span></li></ul></div></div></div>
<div class="section" title="Targeting the Retina display"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec03"/>Targeting the Retina display</h1></div></div></div><p>The iPhone 4 introduced the world to the Retina display. It packs four times the number of pixels into the same screen found on earlier models, providing the sharpest images yet seen on a mobile device.<a id="id682" class="indexterm"/>
</p><p>Those using Flash Professional CS5.5 and at least AIR 2.6 can use the full 640x960 resolution provided by Retina display iPhones and iPod touches.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec06"/>Getting ready</h2></div></div></div><p>From the book's accompanying code samples, open<code class="literal"> chapter8\recipe2\recipe.fla</code> into Flash Professional CS5.5.<a id="id683" class="indexterm"/>
</p><p>This FLA has been provided as a starting point and has a dynamic text field named<code class="literal"> output</code> sitting on the stage. We will use this text field to report whether or not the app is being run on a Retina display device.</p><p>While this recipe's example app will run on an iPad, it won't target its 768x1024 screen resolution. Instead, it will simulate a standard resolution iPhone/iPod touch.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec07"/>How to do it...</h2></div></div></div><p>Retina display support is specified from the AIR for iOS Settings panel. We will also write a basic document class to determine whether the app is actually running on a Retina device or not.<a id="id684" class="indexterm"/>
</p><div class="section" title="Setting Retina display support"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec06"/>Setting Retina display support</h3></div></div></div><p>Let us start by enabling support for the Retina display's screen resolution:<a id="id685" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Open the AIR for iOS Settings panel by selecting<span class="strong"><strong> File</strong></span> |<span class="strong"><strong> AIR for iOS Settings</strong></span>.</li><li class="listitem">Ensure the<span class="strong"><strong> General</strong></span> tab is selected.</li><li class="listitem">Set the<span class="strong"><strong> Resolution</strong></span> field to<span class="strong"><strong> High</strong></span>.</li><li class="listitem">Also, for this recipe, ensure that the<span class="strong"><strong> Device</strong></span> field is set to<span class="strong"><strong> iPhone</strong></span>.</li><li class="listitem">Click on the<span class="strong"><strong> OK</strong></span> button to close the panel.</li></ol></div></div><div class="section" title="Detecting a Retina display device"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec07"/>Detecting a Retina display device</h3></div></div></div><p>With the AIR for iOS settings taken care of, we can turn our attention to the ActionScript required to determine if the app is being run on a Retina display device:<a id="id686" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create a document class and name it<code class="literal"> Main</code>.</li><li class="listitem">Add the following three import statements to the class:<div class="informalexample"><pre class="programlisting">import flash.display.MovieClip;
<span class="strong"><strong>
import flash.display.StageAlign;
import flash.display.StageScaleMode;
import flash.system.Capabilities;
</strong></span>
</pre></div></li><li class="listitem">Set the stage's scale mode and alignment properties:<div class="informalexample"><pre class="programlisting">public function Main() {
<span class="strong"><strong>
stage.scaleMode = StageScaleMode.NO_SCALE;
stage.align = StageAlign.TOP_LEFT;
</strong></span>
}
</pre></div></li><li class="listitem">Query the device's screen resolution to determine whether or not it has a Retina display:<div class="informalexample"><pre class="programlisting">public function Main() {

stage.scaleMode = StageScaleMode.NO_SCALE;
stage.align = StageAlign.TOP_LEFT;
<span class="strong"><strong>
if(Capabilities.screenResolutionX == 320)
{
output.text = "Standard Resolution";
}
else if(Capabilities.screenResolutionX == 640)
{
output.text = "Retina Resolution";
}
</strong></span>
}
</pre></div></li><li class="listitem">Save the class file as<code class="literal"> Main.as</code> within the same folder as the FLA. Also save the FLA.</li><li class="listitem">Publish and deploy the IPA to your device. If you have a Retina and a standard display device available, then install the app on both.</li></ol></div><p>When you run the app on a Retina display iPhone or iPod touch, the following text will be output to the screen:</p><p><span class="strong"><strong>Retina Resolution
</strong></span>
</p><p>For standard display devices, you will see the following:</p><p><span class="strong"><strong>Standard Resolution</strong></span>
</p></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec08"/>How it works...</h2></div></div></div><p>Although the aspect ratio has been maintained, there are now two screen resolutions that you can target when developing for iPhone and iPod touch:<a id="id687" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Standard: 320x480</li><li class="listitem" style="list-style-type: disc">Retina: 640x960</li></ul></div><p>The Retina display resolution is found in post third-generation iPhone and iPod touches. All previous models use the standard display resolution.</p><p>If you choose to support the Retina display, then your app must also provide support for the standard display. Apple does not permit you to submit separate IPAs for each supported resolution. You can, however, opt to support just the standard display and the app will be pixel-doubled by iOS to fit Retina display screens.</p><p>To specify the resolutions your app will support, set the<span class="strong"><strong> Resolution</strong></span> field within the AIR for iOS Settings panel. The following two options are available:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Standard</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>High</strong></span></li></ul></div><p>Select<span class="strong"><strong> High</strong></span> if you are providing support for both the Retina and standard displays. Otherwise select<span class="strong"><strong> Standard</strong></span>.</p><p>When targeting multiple screen resolutions, it is important you set the stage's scale mode and alignment.</p><p>Setting the scale mode to<code class="literal"> NO_SCALE</code> prevents the stage's content from being scaled to fit the Retina screen's resolution. Instead, your content will maintain its defined size. Setting the stage alignment to<code class="literal"> TOP_LEFT</code> forces all content to be positioned relative to the top left-hand corner.</p><p>While scaling may sound desirable, it really isn't advisable for applications that use bitmap images, which become pixelated when scaled. Instead, you should write logic within your app to swap between standard and Retina resolution versions of any bitmaps and also handle the layout and positioning of content yourself.</p><p>In addition, your FLA's stage size should match that of the standard resolution display—320x480 pixels. When running on a Retina display device and with the stage's scale mode set to<code class="literal"> NO_SCALE</code>, the stage's dimensions will be reported as being twice what you set within Flash Professional. This will allow you to take advantage of the higher resolution.</p><p>It is possible to determine the screen resolution your app is using by querying the static<code class="literal"> screenResolutionX</code> and<code class="literal"> screenResolutionY</code> properties that belong to the<code class="literal"> Capabilities</code> class. For this recipe, we simply checked<code class="literal"> screenResolutionX</code> as this was enough to determine whether the standard or Retina screen resolution was being used.</p><p>You can obtain more information regarding<code class="literal"> flash.system.Capabilities, flash.display.StageScaleMode</code>, and<code class="literal"> flash.display.StageAlign</code> from Adobe Community Help.<a id="id688" class="indexterm"/>
</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec09"/>There's more...</h2></div></div></div><p>There are several other considerations when utilizing the Retina display.</p><div class="section" title="Retina home screen icon"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec08"/>Retina home screen icon</h3></div></div></div><p>When supporting the Retina display, you must provide a home screen icon of size 114x114. Detailed instructions are available from the<span class="emphasis"><em> Including icons</em></span> recipe in<a class="link" href="ch03.html" title="Chapter 3. Writing your First App"> Chapter 3</a>.<a id="id689" class="indexterm"/>
</p></div><div class="section" title="Retina application launch image"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec09"/>Retina application launch image</h3></div></div></div><p>You can include with your IPA an additional launch image that takes advantage of the Retina display's higher resolution. For more details, refer to the<span class="emphasis"><em> Including an application launch image</em></span> recipe from<a class="link" href="ch03.html" title="Chapter 3. Writing your First App"> Chapter 3</a>.<a id="id690" class="indexterm"/>
</p></div><div class="section" title="Vector-only apps"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec10"/>Vector-only apps</h3></div></div></div><p>If your application uses only vector content, then you can simply let AIR take care of scaling for you. This will allow you to write an app targeting the standard 320x480 pixel display, which will also take advantage of the higher resolution Retina display.<a id="id691" class="indexterm"/>
</p><p>To enable this, set the stage's scale mode and alignment to the following:</p><div class="informalexample"><pre class="programlisting">stage.scaleMode = StageScaleMode.SHOW_ALL;
stage.align = StageAlign.TOP_LEFT;
</pre></div><p>Also, remember to set the<span class="strong"><strong> Resolution</strong></span> field from the AIR for iOS Settings panel to<span class="strong"><strong> High</strong></span>.</p><p>Don't confuse this with pixel doubling that's employed by iOS. Your app's vector content will actually be scaled, rather than each pixel being doubled in size. Essentially there will be a noticeable improvement in image fidelity on Retina devices.</p><p>Of course, you can still use bitmaps but unlike the vector content, pixelation will be obvious when they are scaled up.</p></div><div class="section" title="iPad display"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec11"/>iPad display</h3></div></div></div><p>Both the iPad 1 and 2 support a single screen resolution of 768x1024. When targeting the iPad or the non-Retina display iPhone and iPod touch, set the<span class="strong"><strong> Resolution</strong></span> field to<span class="strong"><strong> Standard</strong></span>.<a id="id692" class="indexterm"/>
</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec10"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>AIR for iOS general settings, <a class="link" href="ch02.html" title="Chapter 2. Building iOS Apps Using Flash">Chapter 2</a></em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Targeting a device</em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Supporting multiple resolutions</em></span></li></ul></div></div></div>
<div class="section" title="Supporting multiple resolutions"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec04"/>Supporting multiple resolutions</h1></div></div></div><p>The launch of the iPad led to developers having to support two different physical screen sizes and resolutions. This was exacerbated by the introduction of the Retina display for iPhone and iPod touch, where screen resolutions were no longer guaranteed to be identical across the same device type.</p><p>When targeting multiple device types and models, it is important that your app can adapt its layout to different screen resolutions.<a id="id693" class="indexterm"/>
</p><p>Let us walk through a simple example that creates a universal app that supports the various portrait resolutions used by the iPhone, iPod touch, and iPad.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec11"/>Getting ready</h2></div></div></div><p>An FLA containing graphics has been provided in the book's accompanying code bundle for you to work from.</p><p>Open<code class="literal"> chapter8\recipe3\recipe.fla</code> into Flash Professional.</p><p>Within the FLA's library, you will find three PNGs—one for each screen resolution we intend to support. Each has also been linked for ActionScript usage allowing it to be easily added to the screen at runtime. The following table summarizes this:<a id="id694" class="indexterm"/>
</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><tbody><tr><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="bottom">
<p>Bitmap name</p>
</td><td style="text-align: left" valign="bottom">
<p>AS linkage</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Standard display 320x480</p>
</td><td style="text-align: left" valign="top">
<p>rocket-standard.png</p>
</td><td style="text-align: left" valign="top">
<p>RocketStandardBitmapData</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Retina display 640x960</p>
</td><td style="text-align: left" valign="top">
<p>rocket-retina.png</p>
</td><td style="text-align: left" valign="top">
<p>RocketRetinaBitmapData</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>iPad display 768x1024</p>
</td><td style="text-align: left" valign="top">
<p>rocket-ipad.png</p>
</td><td style="text-align: left" valign="top">
<p>RocketIPadBitmapData</p>
</td></tr></tbody></table></div><p>When running on a standard display iPhone or iPod touch,<span class="strong"><strong> rocket-standard.png</strong></span> will be shown on screen. For Retina display screens, the app will use<span class="strong"><strong> rocket-retina.png</strong></span>. Finally,<span class="strong"><strong> rocket-ipad.png</strong></span> will be shown if an iPad's screen resolution is detected.</p><p>If you are using Flash Professional CS5 for this recipe, then your app will be unable to take advantage of the higher resolution provided by Retina display devices. Retina display support is only available from AIR 2.6 onwards.<a id="id695" class="indexterm"/>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec12"/>How to do it...</h2></div></div></div><p>We will split this recipe into two parts. First, from the AIR for iOS Settings panel, we will declare support for all device resolutions. Secondly, we will write the code required to display the correct bitmap for each supported resolution.</p><div class="section" title="Setting supported devices and resolutions"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec12"/>Setting supported devices and resolutions</h3></div></div></div><p>Let us start by targeting all available device resolutions:<a id="id696" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Open the AIR for iOS Settings panel by selecting<span class="strong"><strong> File</strong></span> |<span class="strong"><strong> AIR for iOS Settings</strong></span>.</li><li class="listitem">Ensure the<span class="strong"><strong> General</strong></span> tab is selected.</li><li class="listitem">Set the<span class="strong"><strong> Device</strong></span> field to<span class="strong"><strong> iPhone and iPad</strong></span>.</li><li class="listitem">If you are using Flash Professional CS5.5, then also set the<span class="strong"><strong> Resolution</strong></span> field to<span class="strong"><strong> High</strong></span>.<p>These settings are required if you wish a single app to support all devices in the iOS family and take advantage of the higher resolution provided by Retina display devices.
</p></li><li class="listitem">Click on the<span class="strong"><strong> OK</strong></span> button to close the panel.</li></ol></div></div><div class="section" title="Displaying the correct bitmap"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec13"/>Displaying the correct bitmap</h3></div></div></div><p>Now, we will write some ActionScript to adapt to each of the expected screen resolutions:<a id="id697" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create a document class and name it<code class="literal"> Main</code>.</li><li class="listitem">Add import statements for the required classes:<div class="informalexample"><pre class="programlisting">import flash.display.MovieClip;
<span class="strong"><strong>
import flash.display.Bitmap;
import flash.display.StageAlign;
import flash.display.StageScaleMode;
import flash.system.Capabilities;
</strong></span>
</pre></div></li><li class="listitem">Within the constructor, set the stage's scale mode and alignment properties:<a id="id698" class="indexterm"/><div class="informalexample"><pre class="programlisting">public function Main() {
<span class="strong"><strong>
stage.scaleMode = StageScaleMode.NO_SCALE;
stage.align = StageAlign.TOP_LEFT;</strong></span>
}
</pre></div></li><li class="listitem">Staying within the constructor, call a method to create the correct bitmap for the current device's screen resolution:<div class="informalexample"><pre class="programlisting">public function Main() {
stage.scaleMode = StageScaleMode.NO_SCALE;
stage.align = StageAlign.TOP_LEFT;
<span class="strong"><strong>var b:Bitmap = createRocketBitmap();
addChild(b);</strong></span>
}
</pre></div></li><li class="listitem">Now, write the method which instantiates and returns the bitmap:<div class="informalexample"><pre class="programlisting">private function createRocketBitmap():Bitmap {
var b:Bitmap;
if(Capabilities.screenResolutionX == 320)
{
b = new Bitmap(new RocketStandardBitmapData());
}
else if(Capabilities.screenResolutionX == 640)
{
b = new Bitmap(new RocketRetinaBitmapData());
}
else if(Capabilities.screenResolutionX == 768)
{
b = new Bitmap(new RocketIPadBitmapData());
}
return b;
}
</pre></div></li><li class="listitem">Save the class file as<code class="literal"> Main.as</code>. Also move back to your FLA and save it too.</li><li class="listitem">Publish the FLA and test your app on a range of iOS devices.</li></ol></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec13"/>How it works...</h2></div></div></div><p>This recipe's example determines the screen resolution being used and displays a bitmap image that has been prepared for that resolution.<a id="id699" class="indexterm"/>
</p><p>The following portrait resolutions are supported:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">iPad<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">768x1024</li></ul></div></li><li class="listitem" style="list-style-type: disc">iPhone and iPod touch<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">320x480: Standard</li><li class="listitem" style="list-style-type: disc">640x960: Retina</li></ul></div></li></ul></div><p>From the AIR for iOS Settings panel, you must explicitly state that you intend to create a universal app that supports all three devices and their screen resolutions. This is done by setting the<span class="strong"><strong> Device</strong></span> field to<span class="strong"><strong> iPhone and iPad</strong></span> and the<span class="strong"><strong> Resolution</strong></span> field to<span class="strong"><strong> High</strong></span>.</p><p>When targeting multiple screen resolutions, it is important that you set the stage's scale mode and alignment.</p><p>Setting the stage's scale mode to<code class="literal"> NO_SCALE</code> ensures that your content maintains its defined size across multiple screen resolutions. This leaves you in full control of the sizing and layout of your content. It also ensures that any bitmaps being used aren't scaled at runtime, which will prevent them from becoming pixelated. Setting the stage alignment to<code class="literal"> TOP_LEFT</code> forces all content to be positioned relative to the top left-hand corner, making positioning easier to work with.</p><p>The actual code that creates the correct bitmap simply examines the static<code class="literal"> Capabilities.screenResolutionX</code> property to determine which of the three expected screen resolutions the app currently has to cater for. Once a decision is made, the correct bitmap from the library is instantiated and added to the display list at its default position of (0,0).<a id="id700" class="indexterm"/>
</p><p>While the stage and timeline are still an option for the layout of content, you may find yourself relying more heavily on ActionScript for more complex projects.</p><p>You can obtain more information from Adobe Community Help. Perform a search for the following classes:<code class="literal"> flash.system.Capabilities, flash.display.StageScaleMode</code>, and<code class="literal"> flash.display.StageAlign</code>.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec14"/>There's more...</h2></div></div></div><p>Our example was somewhat trivial. Unfortunately, adapting a real-world application to multiple screen resolutions can be difficult.</p><div class="section" title="Default stage size"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec14"/>Default stage size</h3></div></div></div><p>When its scale mode is set to<code class="literal"> NO_SCALE</code>, the stage's default size is of little importance to a universal app. For example, this recipe's FLA uses a stage size of 320x480, which obviously falls far short of the iPad's 768x1024 resolution. This, however, does not restrict the app's display list to the stage's default dimensions—the app is still able to target the full screen resolution of the device it is running on.<a id="id701" class="indexterm"/>
</p><p>Try not to rely on the default stage size when performing layout management across multiple resolutions. The same is also true when determining what device your app is currently running on. Instead use<code class="literal"> Capabilities.screenResolutionX</code> and<code class="literal"> Capabilities.screenResolutionY</code>.</p></div><div class="section" title="Model-View-Controller architecture"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec15"/>Model-View-Controller architecture</h3></div></div></div><p>Although outside the scope of this book, you should consider using the Model-View-Controller (MVC) design pattern to manage layout across each supported screen resolution.<a id="id702" class="indexterm"/>
</p><p>MVC consists of three elements: a single Model that contains the application's data and state management logic; at least one View, which presents the application's on-screen state; and at least one Controller, which handles user interaction.</p><p>Typically, a View is paired with a Controller, and you will write a View-Controller pair for each screen resolution you wish to support. The Controller acts as an intermediary between its own View and the Model.</p><p>There are many ActionScript MVC frameworks available, such as PureMVC and Robotlegs. You can visit the PureMVC home page at<a class="ulink" href="http://puremvc.org"> http://puremvc.org</a>, while Robotlegs can be downloaded from<a class="ulink" href="http://www.robotlegs.org"> www.robotlegs.org</a>.<a id="id703" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip17"/>Tip</h3><p>Apple encourages the use of MVC when writing apps for iOS.</p></div></div><div class="section" title="Dynamic sizing and layout"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec16"/>Dynamic sizing and layout</h3></div></div></div><p>When working with multiple screen resolutions and pixel densities, you may consider developing your app to dynamically re-size and lay out its content. Although this can be a complex approach, it will future-proof your app, allowing it to fit additional screens that may one day become available. However, for a limited number of screens, you may find MVC more feasible.<a id="id704" class="indexterm"/>
</p><p>For more detail, take a look at the "Writing multi-screen AIR apps" article on the Adobe AIR Developer Center:<a class="ulink" href="http://www.adobe.com/devnet/air/flex/articles/writing_multiscreen_air_apps.html"> www.adobe.com/devnet/air/flex/articles/writing_multiscreen_air_apps.html</a>.</p></div><div class="section" title="Supporting iPad separately"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec17"/>Supporting iPad separately</h3></div></div></div><p>The aspect ratio of the iPad's screen differs from that of the iPhone and the iPod touch. This can make the development of a single app that works across all three devices awkward as the app will need to tailor its UI at runtime for three different resolutions. In addition, for bitmap-heavy applications, storing three sets of graphics will consume a significant portion of memory.<a id="id705" class="indexterm"/>
</p><p>To alleviate the complexities of supporting three devices within a single app, you can write your iPad version separately. The App Store will accept an iPad-specific version of your app and another that supports both the iPhone and iPod touch. Simply specify your target device from the AIR for iOS Settings panel.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec15"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>AIR for iOS general settings, <a class="link" href="ch02.html" title="Chapter 2. Building iOS Apps Using Flash">Chapter 2</a></em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Accessing bitmaps with ActionScript, <a class="link" href="ch06.html" title="Chapter 6. Graphics and Hardware Acceleration">Chapter 6</a></em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Resizing bitmaps, <a class="link" href="ch04.html" title="Chapter 4. Porting Flash Projects to iOS">Chapter 4</a></em></span></li></ul></div></div></div>
<div class="section" title="Setting the default aspect ratio"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec05"/>Setting the default aspect ratio</h1></div></div></div><p>Devices, such as the iPhone, can be freely rotated in real space. This is convenient as it provides two aspect ratios that can be worked with—portrait and landscape.<a id="id706" class="indexterm"/>
</p><p>Let us see how to select a default aspect ratio.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec16"/>Getting ready</h2></div></div></div><p>Using Flash Professional, open<code class="literal"> chapter8\recipe4\recipe.fla</code> from the book's accompanying code bundle.</p><p>The library contains a bitmap image of a fire truck that has been designed for a landscape resolution of 480x320 pixels.<a id="id707" class="indexterm"/>
</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec17"/>How to do it...</h2></div></div></div><p>We will begin by locking the FLA to a landscape aspect ratio:<a id="id708" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Using the<span class="strong"><strong> Selection Tool (V)</strong></span> , click anywhere on the stage. From the<span class="strong"><strong> Properties</strong></span> panel, change the stage's aspect ratio from<span class="strong"><strong> portrait</strong></span> to<span class="strong"><strong> landscape</strong></span>. To do this, simply set its width to<span class="strong"><strong> 480</strong></span> and the height to<span class="strong"><strong> 320</strong></span>.</li><li class="listitem">Although the stage size implies it, the AIR for iOS settings also need to be changed to reflect our choice of aspect ratio. Select<span class="strong"><strong> File</strong></span> |<span class="strong"><strong> AIR for iOS Settings</strong></span> from the drop-down menu.</li><li class="listitem">Ensure the<span class="strong"><strong> General</strong></span> tab is selected.</li><li class="listitem">Select<span class="strong"><strong> Landscape</strong></span> from the<span class="strong"><strong> Aspect ratio</strong></span> drop-down box.</li><li class="listitem">Click on<span class="strong"><strong> OK</strong></span> to close the panel.</li><li class="listitem">Finally, drag the bitmap image from the library onto the stage and position it at the top-left corner of the screen.</li><li class="listitem">Save your FLA and publish it.</li><li class="listitem">Install the app on your device and launch it.</li></ol></div><p>In order to correctly view the fire truck image, you will be forced to turn your device on its side, matching the device's physical orientation with that of the stage.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec18"/>How it works...</h2></div></div></div><p>You can have your application start in one of two aspect ratios: Portrait or Landscape. This is done from the<span class="strong"><strong> General</strong></span> tab within the AIR for iOS Settings panel. Simply make a selection from the<span class="strong"><strong> Aspect ratio</strong></span> drop-down box.<a id="id709" class="indexterm"/>
</p><p>In addition, you will need to set the stage to match that of your chosen aspect ratio. This will allow you to properly lay out any content when designing your app.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note46"/>Note</h3><p>When you create a new AIR for iOS document, a portrait aspect ratio is set by default.</p></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec19"/>There's more...</h2></div></div></div><p>There is an additional option available when setting the default aspect ratio from Flash Professional CS5.5.</p><div class="section" title="Auto aspect ratio"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec18"/>Auto aspect ratio</h3></div></div></div><p>From AIR 2.6 onwards, your app can be instructed to select, when launched, the aspect ratio that matches the device's current orientation. To accommodate this, a third option named<span class="strong"><strong> Auto</strong></span> is provided from the<span class="strong"><strong> Aspect Ratio</strong></span> drop-down box.<a id="id710" class="indexterm"/>
</p><p>This feature can only be enabled in conjunction with auto-orientation, which is covered in the next recipe.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec20"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>AIR for iOS general settings, <a class="link" href="ch02.html" title="Chapter 2. Building iOS Apps Using Flash">Chapter 2</a></em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Enabling auto-orientation</em></span></li></ul></div></div></div>
<div class="section" title="Enabling auto-orientation"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec06"/>Enabling auto-orientation</h1></div></div></div><p>The user can change the device's orientation in real space at any moment and will likely expect the on-screen content to reflect this. AIR for iOS can detect these changes and automatically rotate the stage to match the device's new physical orientation.<a id="id711" class="indexterm"/>
</p><p>This recipe will show you how to enable auto-orientation.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec21"/>Getting ready</h2></div></div></div><p>If you have completed the<span class="emphasis"><em> Setting the default aspect ratio</em></span> recipe, then you can continue to work from its FLA. Alternatively, from the book's accompanying source code, open<code class="literal"> chapter8\recipe5\recipe.fla</code> into Flash Professional and work from there.</p><p>In either case, you will find a bitmap image of a fire truck sitting on the stage. The stage itself is sized to fit a landscape aspect ratio and the FLA's AIR for iOS settings reflect this.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec22"/>How to do it...</h2></div></div></div><p>Enable auto-orientation by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Open the AIR for iOS Settings panel by selecting<span class="strong"><strong> File</strong></span> |<span class="strong"><strong> AIR for iOS Settings</strong></span>.</li><li class="listitem">Ensure the<span class="strong"><strong> General</strong></span> tab is selected.</li><li class="listitem">Set the<span class="strong"><strong> Aspect ratio</strong></span> drop-down box to<span class="strong"><strong> Portrait</strong></span>.</li><li class="listitem">Check on the<span class="strong"><strong> Auto orientation</strong></span> checkbox.</li><li class="listitem">Click on the<span class="strong"><strong> OK</strong></span> button to close the panel.</li><li class="listitem">Save your FLA and publish it.</li><li class="listitem">Deploy the app to your device and launch it.</li></ol></div><p>As the device's physical orientation changes, the stage will be automatically rotated to match the change.<a id="id712" class="indexterm"/>
</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec23"/>How it works...</h2></div></div></div><p>When auto-orientation is enabled, the stage will attempt to match the device's current orientation each time it is rotated. Four orientations are supported on iOS:<a id="id713" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Default: The default portrait orientation for iOS devices</li><li class="listitem" style="list-style-type: disc">Rotated left: Rotated 90 degrees clockwise</li><li class="listitem" style="list-style-type: disc">Rotated right: Rotated 90 degrees counter-clockwise</li><li class="listitem" style="list-style-type: disc">Upside down: Rotated 180 degrees</li></ul></div><p>Auto-orientation is convenient as it prevents you from having to manually rotate objects on the display list yourself. Instead, this task will be performed on your behalf.</p><p>During auto-orientation, the stage's scale mode and its current alignment setting will be adhered to.</p><p>Also, if you decide to support both portrait and landscape aspect ratios, then Apple recommends that your app be launched in portrait mode.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec24"/>There's more...</h2></div></div></div><p>It is likely that you will want some control over how the content on the stage is handled during auto-orientation.<a id="id714" class="indexterm"/>
</p><div class="section" title="Checking for orientation support"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec19"/>Checking for orientation support</h3></div></div></div><p>Although Flash provides support for device orientation changes across all iOS devices, when writing cross-platform code, you may want to confirm support by checking that the stage's<code class="literal"> supportsOrientationChange</code> property returns<code class="literal"> true</code>.<a id="id715" class="indexterm"/>
</p></div><div class="section" title="Programmatically setting auto-orientation"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec20"/>Programmatically setting auto-orientation</h3></div></div></div><p>In addition to using the AIR for iOS Settings panel, you can activate and deactivate auto-orientation programmatically by setting the<code class="literal"> Stage.autoOrients</code> property. The property's initial value is derived from the value of the<span class="strong"><strong> Auto Orientation</strong></span> field from the AIR for iOS Settings panel.<a id="id716" class="indexterm"/>
</p><p>The following ActionScript activates auto-orientation:</p><div class="informalexample"><pre class="programlisting">stage.autoOrients = true;
</pre></div></div><div class="section" title="Stage scale mode"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec21"/>Stage scale mode</h3></div></div></div><p>You can specify how the stage is scaled when the device's physical orientation changes. This is achieved by setting the<code class="literal"> Stage.scaleMode</code> property to one of four constants provided by the<code class="literal"> flash.display.StageScaleMode</code> class.<a id="id717" class="indexterm"/>
</p><p>The default mode is<code class="literal"> StageScaleMode.SHOW_ALL</code> and ensures that the entire stage is made visible within the screen while maintaining its aspect ratio. If you don't want resizing of the stage's content to take place during changes in orientation, then set the scale mode to<code class="literal"> NO_SCALE</code>. This specifies that the size of the content on the stage is to be fixed.</p><p>More information regarding scale modes can be obtained from Adobe Community Help.</p></div><div class="section" title="Stage alignment"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec22"/>Stage alignment</h3></div></div></div><p>How the stage content is aligned when the device's physical orientation changes can also be specified. Simply set the<code class="literal"> Stage.align</code> property to one of the constants defined by<code class="literal"> flash.display.StageAlign</code>.<a id="id718" class="indexterm"/>
</p><p>The stage's content will align to the center of the screen by default, however, there are eight constants that can be used to align the stage's content around the edges of the screen. For example, the following ActionScript will align the stage to the top left:</p><div class="informalexample"><pre class="programlisting">stage.align = StageAlign.TOP_LEFT;
</pre></div><p>More information regarding stage alignment can be found on Adobe Community Help.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec25"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>AIR for iOS general settings, <a class="link" href="ch02.html" title="Chapter 2. Building iOS Apps Using Flash">Chapter 2</a></em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Listening for orientation changes</em></span></li></ul></div></div></div>
<div class="section" title="Listening for orientation changes"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec07"/>Listening for orientation changes</h1></div></div></div><p>The accelerometer present in iOS devices can detect changes in physical orientation. AIR provides APIs for detecting these changes and determining the device's actual orientation in real space.<a id="id719" class="indexterm"/>
</p><p>Let us see how this is done.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec26"/>Getting ready</h2></div></div></div><p>Start by opening<code class="literal"> chapter8\recipe6\recipe.fla</code> from the book's accompanying code bundle.</p><p>A dynamic text field named<code class="literal"> output</code> can be found on the stage. We will use this text field to report any orientation changes experienced by the device.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec27"/>How to do it...</h2></div></div></div><p>Perform the following steps to listen for changes in orientation:<a id="id720" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Select<span class="strong"><strong> File</strong></span> |<span class="strong"><strong> AIR for iOS Settings</strong></span> from Flash Professional's drop-down menu.</li><li class="listitem">From the<span class="strong"><strong> General</strong></span> tab, check on the<span class="strong"><strong> Auto orientation</strong></span> checkbox; then click on the panel's<span class="strong"><strong> OK</strong></span> button.</li><li class="listitem">Create a document class and name it<code class="literal"> Main</code>.</li><li class="listitem">Add the following import statements:<div class="informalexample"><pre class="programlisting">import flash.display.MovieClip;
<span class="strong"><strong>
import flash.display.StageAlign;
import flash.display.StageScaleMode;
import flash.events.StageOrientationEvent;
</strong></span>
</pre></div></li><li class="listitem">Within the constructor, set up the stage, and listen for the<code class="literal"> ORIENTATION_CHANGING</code> and<code class="literal"> ORIENTATION_CHANGE</code> events being dispatched:<div class="informalexample"><pre class="programlisting">public function Main() {
<span class="strong"><strong>
stage.align = StageAlign.TOP_LEFT;
stage.scaleMode = StageScaleMode.NO_SCALE;
stage.addEventListener(
StageOrientationEvent.ORIENTATION_CHANGING,
orientationChanging);
stage.addEventListener(
StageOrientationEvent.ORIENTATION_CHANGE,
orientationChanged);
output.text = "Rotate the device.";
</strong></span>
}
</pre></div></li><li class="listitem">Write a handler for the<code class="literal"> ORIENTATION_CHANGING</code> event:<div class="informalexample"><pre class="programlisting">private function orientationChanging(e:StageOrientationEvent):void {
output.text = "Orientation Changing\n";
output.appendText(
"Current orientation: " + e.beforeOrientation + "\n");
output.appendText(
physical orientation changeslistening"Target orientation: " + e.afterOrientation + "\n\n");
}
</pre></div></li><li class="listitem">Finally, add a handler for the<code class="literal"> ORIENTATION_CHANGE</code> event:<a id="id722" class="indexterm"/><div class="informalexample"><pre class="programlisting">private function orientationChanged(e:StageOrientationEvent):void {
output.appendText("Orientation Changed\n");
output.appendText(
"Previous orientation: " + e.beforeOrientation + "\n");
output.appendText(
"Current orientation: " + e.afterOrientation + "\n\n");
}
</pre></div></li><li class="listitem">Save the class and name it<code class="literal"> Main.as</code> when prompted. Also, save your FLA.</li><li class="listitem">Publish the app and test it on your device.</li></ol></div><p>Experiment by rotating the device. As changes in orientation are detected they will be reported on-screen.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec28"/>How it works...</h2></div></div></div><p>Changes in orientation can be detected by listening for the following two events from the stage:<a id="id723" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">StageOrientationEvent.ORIENTATION_CHANGING</code><a id="id724" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">StageOrientationEvent.ORIENTATION_CHANGE</code><a id="id725" class="indexterm"/></li></ul></div><p>The<code class="literal"> ORIENTATION_CHANGING</code> event is dispatched as the device's accelerometer detects that an orientation change is taking place and before auto-orientation's default behavior occurs. The<code class="literal"> ORIENTATION_CHANGE</code> event is dispatched after any default behavior has taken place.</p><p>Your app receives the<code class="literal"> ORIENTATION_CHANGING</code> and<code class="literal"> ORIENTATION_CHANGE</code> events only if auto-orientation is enabled from the AIR for iOS Settings panel or through ActionScript.</p><p>You can retrieve information regarding the change in orientation by querying the event's<code class="literal"> beforeOrientation</code> and<code class="literal"> afterOrientation</code> properties. Both properties are read-only and will be set to one of the following constants from<code class="literal"> flash.display.StageOrientation:</code>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">DEFAULT:</code> The default portrait orientation for iOS devices.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ROTATED_LEFT:</code> Rotated 90 degrees clockwise.</li><li class="listitem" style="list-style-type: disc"><code class="literal">ROTATED_RIGHT:</code> Rotated 90 degrees counter-clockwise.</li><li class="listitem" style="list-style-type: disc"><code class="literal">UPSIDE_DOWN:</code> Rotated 180 degrees.</li></ul></div><p>When handling an<code class="literal"> ORIENTATION_CHANGING</code> event,<code class="literal"> beforeOrientation</code> will hold the device's current orientation while<code class="literal"> afterOrientation</code> will specify the target orientation that the device is being rotated towards.<a id="id726" class="indexterm"/>
</p><p>For the<code class="literal"> ORIENTATION_CHANGE</code> event, use<code class="literal"> beforeOrientation</code> to find out the device's previous orientation and<code class="literal"> afterOrientation</code> to determine the current orientation.<a id="id727" class="indexterm"/>
</p><p>You can see both these properties being used within our document class'<code class="literal"> orientationChanging()</code> and<code class="literal"> orientationChanged()</code> event handlers. Their values are obtained and written to the<code class="literal"> output</code> text field.<a id="id728" class="indexterm"/>
</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec29"/>There's more...</h2></div></div></div><p>It is also possible to determine the device's orientation without using event listeners.</p><div class="section" title="Determining device orientation"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec23"/>Determining device orientation</h3></div></div></div><p>You can also determine the device's physical orientation by accessing the<code class="literal"> deviceOrientation</code> property of the<code class="literal"> Stage</code> class. This property is read-only and will return one of the constants defined in the<code class="literal"> StageOrientation</code> class.<a id="id729" class="indexterm"/>
</p><p>In addition to the four constants that we have already covered,<code class="literal"> deviceOrientation</code> can also return<code class="literal"> StageOrientation.UNKNOWN</code>. The<code class="literal"> deviceOrientation</code> property does not contain the starting orientation of the device and is, therefore, set to<code class="literal"> UNKNOWN</code> until the first change in physical orientation takes place.<a id="id730" class="indexterm"/>
</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec30"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>AIR for iOS general settings, <a class="link" href="ch02.html" title="Chapter 2. Building iOS Apps Using Flash">Chapter 2</a></em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Responding to orientation changes</em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Enabling auto-orientation</em></span></li></ul></div></div></div>
<div class="section" title="Responding to orientation changes"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec08"/>Responding to orientation changes</h1></div></div></div><p>It is likely that you will want to update your app's on-screen content to reflect a change in the device's physical orientation. While auto-orientation in conjunction with the stage's default alignment and scale mode will attempt this on your behalf, you may want to handle the layout yourself.<a id="id731" class="indexterm"/>
</p><p>This recipe will show you how to do that.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec31"/>Getting ready</h2></div></div></div><p>An FLA has been provided as a starting point. From the book's accompanying code bundle, open<code class="literal"> chapter8\recipe7\recipe.fla</code> within Flash Professional.</p><p>You will find two movie clips sitting on the stage. The first movie clip is an image of an arrow pointing upwards and has been created to fit the screen's dimensions using a portrait orientation. The second shows the same arrow but this time the image's dimensions fit the screen's landscape orientations.</p><p>Both movie clips are positioned at the top-left corner of the stage and have instance names of<code class="literal"> portrait</code> and<code class="literal"> landscape</code> respectively.</p><p>We will write some code to ensure that the user sees an arrow pointing upwards no matter which of the four possible physical orientations they rotate the device to. We will do this by showing the appropriate movie clip for the current device orientation.</p><p>The stage dimensions are set for an initial portrait aspect ratio and this is already reflected in the AIR for iOS settings.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec32"/>How to do it...</h2></div></div></div><p>We will make a quick change to the AIR for iOS settings before moving onto the ActionScript:<a id="id732" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Select<span class="strong"><strong> File</strong></span> |<span class="strong"><strong> AIR for iOS Settings</strong></span> from Flash Professional's drop-down menu.</li><li class="listitem">From the<span class="strong"><strong> General</strong></span> tab, check the<span class="strong"><strong> Auto orientation</strong></span> checkbox; then click on the panel's<span class="strong"><strong> OK</strong></span> button.</li><li class="listitem">Create a document class and name it<code class="literal"> Main</code>.</li><li class="listitem">Add the following import statements to the class:<div class="informalexample"><pre class="programlisting">import flash.display.MovieClip;
<span class="strong"><strong>
import flash.display.StageAlign;
import flash.display.StageScaleMode;
import flash.display.StageOrientation;
import flash.events.StageOrientationEvent;
</strong></span>
<a id="id733" class="indexterm"/>
</pre></div></li><li class="listitem">Within the constructor, set up the stage and listen for the<code class="literal"> ORIENTATION_CHANGING</code> event:<a id="id734" class="indexterm"/><div class="informalexample"><pre class="programlisting">public function Main() {
<span class="strong"><strong>
stage.align = StageAlign.TOP_LEFT;
stage.scaleMode = StageScaleMode.NO_SCALE;
stage.addEventListener(
StageOrientationEvent.ORIENTATION_CHANGING,
orientationChanging);
landscape.visible = false;
</strong></span>
}
</pre></div></li><li class="listitem">Finally, add a handler for the<code class="literal"> ORIENTATION_CHANGING</code> event:<a id="id735" class="indexterm"/><div class="informalexample"><pre class="programlisting">private function orientationChanging(e:StageOrientationEvent):void {
if(
e.afterOrientation == StageOrientation.DEFAULT || e.afterOrientation == StageOrientation.UPSIDE_DOWN
)
{
portrait.visible = true;
landscape.visible = false;
}
else if(
e.afterOrientation == StageOrientation.ROTATED_LEFT || e.afterOrientation == StageOrientation.ROTATED_RIGHT
)
{
portrait.visible = false;
landscape.visible = true;
}
}
</pre></div></li><li class="listitem">Save the class file as<code class="literal"> Main.as</code>. Also move to your FLA and save it too.</li><li class="listitem">Publish the FLA and deploy the IPA to your device.</li><li class="listitem">Test the app by rotating your device. The screen will update to reflect any change in orientation.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec33"/>How it works...</h2></div></div></div><p>Rather than letting the stage's current on-screen content automatically resize when the device's orientation changes, we instead opted to display a different view.</p><p>The first step towards accomplishing this is to set the stage's scale mode and alignment.</p><p>Setting the scale mode to<code class="literal"> NO_SCALE</code> prevents your content from being scaled to fit any changes in stage size. This ensures that the<code class="literal"> portrait</code> and<code class="literal"> landscape</code> movie clips maintain their defined sizes during orientation changes.</p><p>Setting the alignment to<code class="literal"> TOP_LEFT</code> forces all content to be positioned relative to the top-left corner of the screen. Essentially both our movie clips, which are positioned at (0,0) on the stage will always start from the screen's top-left corner no matter what orientation the device is in.</p><p>The next step is to make the appropriate movie clip visible in response to a change in orientation. This is done by handling the<code class="literal"> ORIENTATION_CHANGING</code> event and selecting a movie clip depending on the value of the<code class="literal"> afterOrientation</code> property.<a id="id736" class="indexterm"/>
</p><p>If the device is being rotated to one of the two portrait orientations <code class="literal">(DEFAULT</code> or<code class="literal"> UPSIDE_DOWN)</code>, then the<code class="literal"> portrait</code> movie clip is made visible and<code class="literal"> landscape</code> is hidden. For either of the two landscape orientations <code class="literal">(ROTATED_LEFT</code> or<code class="literal"> ROTATED_RIGHT)</code> the<code class="literal"> landscape</code> movie clip is shown and<code class="literal"> portrait</code> is hidden from view.</p><p>You may be wondering why we only have two movie clips for four possible orientations. Won't<code class="literal"> portrait</code> and<code class="literal"> landscape</code> appear upside-down for the<code class="literal"> UPSIDE_DOWN</code> and<code class="literal"> ROTATED_LEFT</code> orientations? Well they are for a brief moment, but remember that one of the benefits of auto-orientation is that it rotates your on-screen content ensuring that it is shown the right way up. Without auto-orientation, you would have to rotate all the items on the display list manually.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec34"/>There's more...</h2></div></div></div><p>Here are some more details to help complete your knowledge of screen orientation.</p><div class="section" title="The stage color"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec24"/>The stage color</h3></div></div></div><p>Your choice of stage color is important as areas outside the stage's dimensions will be visible while auto-orientation is taking place. Select a stage color that will compliment your content. For example, this recipe used black as it matched the background color of both movie clips.<a id="id737" class="indexterm"/>
</p><p>Change the stage color to white and re-deploy the app to your device. During orientation changes, you will now be able to see just how much area is actually visible.</p></div><div class="section" title="Stage orientation"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec25"/>Stage orientation</h3></div></div></div><p>Although they often match, the actual orientation of the device in real space is independent of the content viewed on screen. For example, the user could be holding the device in landscape orientation while the app's content is still being rendered in portrait.<a id="id738" class="indexterm"/>
</p><p>While the<code class="literal"> Stage.deviceOrientation</code> property is available to determine the device's physical orientation, you can use the<code class="literal"> Stage.orientation</code> property to retrieve the current orientation of the stage in relation to the device.<a id="id739" class="indexterm"/>
</p><p>It is also possible to change the stage's orientation independently of the device's. This is achieved by calling<code class="literal"> Stage.setOrientation()</code> and passing to it one of the constants defined in the<code class="literal"> flash.display.StageOrientation</code> class. You can respond to this orientation change by listening for and responding to the<code class="literal"> ORIENTATION_CHANGING</code> and<code class="literal"> ORIENTATION_CHANGE</code> events.</p></div><div class="section" title="Preventing auto-orientation"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec26"/>Preventing auto-orientation</h3></div></div></div><p>Auto-orientation takes place immediately after the<code class="literal"> ORIENTATION_CHANGING</code> event but before<code class="literal"> ORIENTATION_CHANGE</code> is dispatched. It is, therefore, possible to prevent auto-orientation for a particular orientation (or all of them) by calling<code class="literal"> preventDefault()</code> on the<code class="literal"> ORIENTATION_CHANGING</code> event's object.<a id="id740" class="indexterm"/>
</p><p>For example, the following modification to our<code class="literal"> orientationChanging()</code> handler will prevent the stage being orientated when the device is rotated to either of the two landscape orientations:<a id="id741" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">private function orientationChanging(e:StageOrientationEvent):void {
<span class="strong"><strong>
if(
e.afterOrientation == StageOrientation.ROTATED_LEFT ||
e.afterOrientation == StageOrientation.ROTATED_RIGHT
)
{
e.preventDefault();
}
</strong></span>
}
</pre></div><p>You can also use<code class="literal"> preventDefault()</code> to block auto-orientation in order to completely manage the rotation and positioning of the stage's content yourself.<a id="id742" class="indexterm"/>
</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec35"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>AIR for iOS general settings, <a class="link" href="ch02.html" title="Chapter 2. Building iOS Apps Using Flash">Chapter 2</a></em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Listening for orientation changes</em></span></li><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Enabling auto-orientation</em></span></li></ul></div></div></div></body></html>