<html><head></head><body>
		<div><h1 id="_idParaDest-88" class="chapter-number"><a id="_idTextAnchor232"/>7</h1>
			<h1 id="_idParaDest-89"><a id="_idTextAnchor233"/>Advertising Using Unity Ads</h1>
			<p>When working on mobile titles, you need to think about how you are going to sell your game. Deciding on how to best sell a game can be difficult. Of course, you can sell your game for a price, and there is a possibility that it will be successful, but you’ll be limiting your audience numbers to a much lower amount. This could work well for a niche game, but if you’re trying to make a game with a broad appeal where you want to get as many players as possible to play your title, you may have some issues.</p>
			<p>Having a price on the game can be a major hurdle in getting initial customers who will share the game via word of mouth and contribute to having more people play your game. To solve this potential issue, you do have the option of making your game free.</p>
			<p>Afterward, you can give players the opportunity to purchase things or show advertisements when playing the game.</p>
			<p>That’s not to say that having a bunch of advertisements in a free game is the best option either. Having too many ads, or even the wrong kind of ads, can drive users away, which can be even worse. Many developers have their own opinions on whether it’s a good idea to use ads or not, but that’s not the purpose of this chapter. In this chapter, we will look into the different options available to us in terms of advertising over the course of our game and show how to implement them, should you choose to add this content to your game.</p>
			<p><a id="_idTextAnchor234"/>This chapter is split into a number of topics. It contains a simple step-by-step process, from beginning to end. The following is the outline of our tasks:</p>
			<ul>
				<li>Setting up Unity Ads</li>
				<li>Creating a simple ad</li>
				<li>Adding in-ad callback methods</li>
				<li>Opt-in advertisements with rewards</li>
				<li>Integrating a cooldown timer</li>
			</ul>
			<p>In this chapter, we will integrate the Unity Ads framework into our project and learn how to create both simple and complex versions of advertisements. This is done by first setting up Unity’s Ads system, then creating a simple ad before adding additional callback options. We will then see how we can give additional incentives to view ads by utilizing opt-in rewards and adding a cooldown timer to prevent players from watching too many ads.</p>
			<h1 id="_idParaDest-90"><a id="_idTextAnchor235"/>Technical requirements</h1>
			<p>This book utilizes Unity 2022.1.0b16 and Unity Hub 3.3.1, but the steps should work with minimal changes in future versions of the editor. If you would like to download the exact version used in this book, and there is a new version out, you can visit Unity’s download archive at <a href="https://unity3d.com/get-unity/download/archive">https://unity3d.com/get-unity/download/archive</a>. You can also find the system requirements for Unity at <a href="https://docs.unity3d.com/2022.1/Documentation/Manual/system-requirements.html">https://docs.unity3d.com/2022.1/Documentation/Manual/system-requirements.html</a> in the <strong class="bold">Unity Editor system </strong><strong class="bold">requirements</strong> section.</p>
			<p>You can find the code files present in this chapter on GitHub at <a href="https://github.com/PacktPublishing/Unity-2022-Mobile-Game-Development-3rd-Edition/tree/main/Chapter06%20and%2007">https://github.com/PacktPublishing/Unity-2022-Mobile-Game-Development-3rd-Edition/tree/main/Chapter06%20and%2007</a>.</p>
			<h1 id="_idParaDest-91"><a id="_idTextAnchor236"/>Setting up Unity Ads</h1>
			<p>Unity Ads is a video <a id="_idIndexMarker457"/>ad network for iOS and Android that can monetize your existing player base by showing ads. Unity Ads offers video ads that can be shown as either rewarded or non-rewarded placements. As the name suggests, rewarded ads will give the users a reward or incentive that will help them while playing the game. Before we can enable Unity Ads, we must first enable Unity’s Services suite. To activate Unity Services, you have to link your project to a Unity Services Project ID, which is how Unity can tell the difference between the different projects you are creating. So let’s see how to do that:</p>
			<ol>
				<li>Open the <strong class="bold">Services</strong> window by going to <strong class="bold">Window | General | Services</strong> or by pressing <em class="italic">Ctrl</em> + <em class="italic">0</em>. This will open up the Unity Package Manager and will automatically <a id="_idIndexMarker458"/>select the <strong class="bold">Advertisement</strong> option:</li>
			</ol>
			<div><div><img src="img/B18868_07_01.jpg" alt="Figure 7.1 – The Advertisement option in the Unity Package Manager"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.1 – The Advertisement option in the Unity Package Manager</p>
			<ol>
				<li value="2"> Click on the <strong class="bold">Install</strong> button and wait for it to finish installing. Upon finishing the installation, you should see a window that looks like the following:</li>
			</ol>
			<div><div><img src="img/B18868_07_02.jpg" alt="Figure 7.2 – Service Activation window"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.2 – Service Activation window</p>
			<p>You can also <a id="_idIndexMarker459"/>access this menu by going to <strong class="bold">Services | Ads | Configure</strong> after the package has been installed.</p>
			<p>Assuming that you haven’t worked with Unity Services before, you will need to create <strong class="bold">Organization</strong> and <strong class="bold">Project </strong><strong class="bold">Name details</strong>.</p>
			<ol>
				<li value="3">Click on the dropdown and select your username and then click on the <strong class="bold">Create project ID</strong> button. The project name is automatically created according to the name of your project when you first created it, but you can change this in the <strong class="bold">Settings</strong> section of the <strong class="bold">Services</strong> window.</li>
			</ol>
			<p class="callout-heading">Important note</p>
			<p class="callout">Unity automatically creates an organization using your account username; however, if you need to create another one, you can do so at <a href="https://id.unity.com/organizations">https://id.unity.com/organizations</a>.</p>
			<ol>
				<li value="4">You’ll then be asked questions about your game. If your game is not directed toward children, go ahead and select <strong class="bold">No</strong> from the drop-down menu and then click on<a id="_idIndexMarker460"/> the <strong class="bold">Save</strong> button. Otherwise, select <strong class="bold">Yes</strong> and then click on <strong class="bold">Save</strong>.</li>
			</ol>
			<p class="callout-heading">Important note</p>
			<p class="callout">When you indicate that your game is designed for children under the age of 13 years, ads will not be behaviorally targeted to users in your game. Behavioral targeting can yield a higher <strong class="bold">effective cost per thousand impressions </strong>(<strong class="bold">eCPM</strong>) by showing ads that are more relevant to your users, but its use is prohibited with users under the age of 13 due to <strong class="bold">Children’s Online Privacy Protection Rule Act (COPPA)</strong> regulations. For more info on this, check out <a href="https://forum.unity.com/threads/age-designation.326930/">https://forum.unity.com/threads/age-designation.326930/</a>.</p>
			<div><div><img src="img/B18868_07_03.jpg" alt="Figure 7.3 – Answering the COPPA compliance question﻿"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.3 – Answering the COPPA compliance question<a id="_idTextAnchor237"/></p>
			<ol>
				<li value="5">Then, when brought to the <strong class="bold">Ads</strong> menu, click on the toggle at the top right to turn it on. Ads should be toggled on at this point.</li>
				<li>If you scroll down, you’ll see a property called <strong class="bold">Game Id</strong>; note down those values as we will need them in order to initialize Unity Ads at the start of the game.</li>
				<li>To get started, it would be a good idea for us to have all of the ad-related behavior to share a script, so we will create a new class called <code>UnityAd Controller</code> by going to the <code>Assets/Scripts</code> folder, and selecting <strong class="bold">Create</strong> | <strong class="bold">C# Script</strong>.</li>
				<li>Open up the file <a id="_idIndexMarker461"/>in the IDE of your choice, and use the following code:<pre class="source-code">
using UnityEngine;
using UnityEngine.Advertisements; /* Advertisement class */
public class UnityAdController : MonoBehaviour
{
    /// &lt;summary&gt;
    /// If we should show ads or not
    /// &lt;/summary&gt;
    public static bool showAds = true;
    /// &lt;summary&gt;
    /// Replace with your actual gameId
    /// &lt;/summary&gt;
    private string gameId = "1234567";
    /// &lt;summary&gt;
    /// If the game is in test mode or not
    /// &lt;/summary&gt;
    private bool testMode = true;
    /// &lt;summary&gt;
    /// Unity Ads must be initialized or else ads will
    /// not work properly
    /// &lt;/summary&gt;
    private void Start()
    {
        /* No need to initialize if it already is done
        */
        if (!Advertisement.isInitialized)
        {
            Advertisement.Initialize(gameId,
                testMode);
        }
    }
}</pre></li>
			</ol>
			<p>The preceding code <a id="_idIndexMarker462"/>does a number of things. We first state that we are using the <code>UnityEngine.Advertisments</code> namespace to get access to the <code>Advertisement</code> class. If you only intend to implement video, interstitial, and banner ads for your monetization strategy, this is the API that Unity suggests to use. In addition to this, in order to use Unity Ads, you must call the <code>Advertisement.Initialize</code> function, which I do inside of the <code>Start</code> function of this object.</p>
			<ol>
				<li value="9">From the <code>GameObject</code> (<code>Unity Ad Controller</code>. Once created, attach the <strong class="bold">Unity Ad Controller </strong>script to it:</li>
			</ol>
			<div><div><img src="img/B18868_07_04.jpg" alt="Figure 7.4 – Creating the Unity Ad Controller object"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.4 – Creating the Unity Ad Controller object</p>
			<ol>
				<li value="10">Because this object is spawned at the <strong class="bold">MainMenu</strong> level, it is loaded at the beginning of the game, which is perfect for what we will use it for.</li>
			</ol>
			<p>At this point, we have finished the setup process required to utilize Unity Ads by enabling Unity Analytics<a id="_idIndexMarker463"/> and then turning the <strong class="bold">Ads</strong> menu on. With the setup process complete,<a id="_idTextAnchor238"/> we can now proceed to actually adding a simple ad to our projec<a id="_idTextAnchor239"/>t.</p>
			<h1 id="_idParaDest-92"><a id="_idTextAnchor240"/>Displaying a simple ad</h1>
			<p>Advertisements <a id="_idIndexMarker464"/>are a<a id="_idIndexMarker465"/> possible way to generate revenue from players playing your game. As mentioned previously, Unity Ads has two different types of ads that we can display: simple and rewarded. Simple ads are easy to use, hence the name, and allow users to have simple full-screen interstitial ads. This can be really useful when moving between levels or perhaps when the player wants to restart the game. Let’s see how we can implement that feature now. Implement the following steps:</p>
			<ol>
				<li>To get started, we <a id="_idIndexMarker466"/>will need <a id="_idIndexMarker467"/>to add a new function to the <code>UnityAdController</code> class:<pre class="source-code">
/// &lt;summary&gt;
/// Will get the appropriate Ad ID for the platform we
/// are on
/// &lt;/summary&gt;
/// &lt;returns&gt;A usable Ad ID&lt;/returns&gt;
private static string GetAdID()
{
    string adID = "Interstitial_";
    if (Application.platform ==
        RuntimePlatform.IPhonePlayer)
    {
        adID += "iOS";
    }
    else
    {
        adID += "Android";
    }
    return adID;
}
/// &lt;summary&gt;
/// Will load and display an ad on the screen
/// &lt;/summary&gt;
public static void ShowAd()
{
    // Load an Ad to play
    Advertisement.Load(GetAdID());
    // Display it after it is loaded
    Advertisement.Show(GetAdID());
}</pre></li>
			</ol>
			<p>Here, we created a static method called <code>ShowAd</code>. We made this static so that we can access the function without actually having to create an instance of this class in order to call it. The function will load an advertisement into memory and then, when it is ready, we will call the <code>Show()</code> function to display it on the<a id="_idIndexMarker468"/> screen. We <a id="_idIndexMarker469"/>also created a helper function called <code>GetAdID</code> in order to give us the correct ad type to use depending on the platform we are deploying to.</p>
			<ol>
				<li value="2">Save your script and then open up the <code>MainMenuBehaviour</code> file and add the following highlighted code:<pre class="source-code">
/// &lt;summary&gt;
/// Will load a new scene upon being called
/// &lt;/summary&gt;
/// &lt;param name="levelName"&gt;The name of the level we
/// want to go to&lt;/param&gt;
public void LoadLevel(string levelName)
{
    <strong class="bold">if (UnityAdController.showAds)</strong>
<strong class="bold">    {</strong>
<strong class="bold">        /* Show an ad */</strong>
<strong class="bold">        UnityAdController.ShowAd();</strong>
<strong class="bold">    }</strong>
    SceneManager.LoadScene(levelName);
}</pre></li>
			</ol>
			<p>This will have <a id="_idIndexMarker470"/>an<a id="_idIndexMarker471"/> advertisement play each time we call the <code>LoadLevel</code> function if it is supported. We also added a new parameter with a default value. The nice thing about this is that we can optionally decide when we want to show an ad.</p>
			<p>For instance, we may want to make it so that when we restart the game, we don’t play an ad. </p>
			<ol>
				<li value="3">Now let’s see this in action. Play the game and then click on the <strong class="bold">Play</strong> button:</li>
			</ol>
			<div><div><img src="img/B18868_07_05.jpg" alt="Figure 7.5 – An example ad being shown"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.5 – An example ad being shown</p>
			<p>As you can see in the preceding screenshot, the ad works correctly. This screen is what is shown when playing the game in the editor. It has buttons to allow us to test whether a player skips or<a id="_idIndexMarker472"/> watches<a id="_idIndexMarker473"/> a video in full. When we disable test mode, we will then see live video ads.</p>
			<p>You’ll also see this happen if, once in the game, you open the pause menu and click on the <strong class="bold">Main </strong><strong class="bold">Menu</strong> button.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">If this does not work and/or show up, check the <strong class="bold">Player Settings</strong> menu you learned about previously and ensure that your current platform is set to Android or iOS.</p>
			<p>This provides us with the easiest way of getting an ad to show up in our game, but there are still a number of things we need to do to ensure our ads work properly, which we will look at next.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">Another type of ad that can be used is banner ads. These work similarly to default ads but you’d use <code>Banner</code> instead of <code>Interstitial</code> when calling <code>GetAdID</code>.</p>
			<p class="callout">For more<a id="_idIndexMarker474"/> information on this, check out <a href="https://docs.unity.com/monetization-dashboard/AdUnits.html">https://docs.unity.com/monetization-dashboard/AdUnits.html</a>.</p>
			<h1 id="_idParaDest-93"><a id="_idTextAnchor242"/>Utilizing ad callback methods</h1>
			<p>The code we<a id="_idIndexMarker475"/> wrote for the <code>LoadLevel</code> function works <a id="_idIndexMarker476"/>perfectly fine when we go to the main menu of the game; however, if we dive into the game itself from the main menu, the game will still be going on in the background with the ad blocking the player from playing the game.</p>
			<p>When running your app on an actual mobile device, the Unity project will pause while Unity Ads are shown. However, if you are testing in the Unity Editor, the game is not paused while the placeholder ads are shown. However, we can simulate that behavior ourselves using the <code>Advertisement.ShowOptions</code> class.</p>
			<p>We will pause the game when an ad is shown and then resume the game once the ad is finished. To do so, perform the following steps:</p>
			<ol>
				<li>Let’s first open up the <code>UnityAdController</code> class and add the following variable and update the <code>Start</code> function to the following:<pre class="source-code">
/// &lt;summary&gt;
/// A static reference to this object
/// &lt;/summary&gt;
public static UnityAdController instance;
/// &lt;summary&gt;
/// Unity Ads must be initialized or else ads will not
/// work properly
/// &lt;/summary&gt;
private void Start()
{
    /* No need to initialize if it already is done */
    if (!Advertisement.isInitialized)
    {
        <strong class="bold">instance = this;</strong>
        // Use the functions provided by this to allow
        // custom
        Advertisement.Initialize(gameId, testMode);
    }
}</pre></li>
			</ol>
			<p>The <code>instance</code> variable <a id="_idIndexMarker477"/>is going to be used to give<a id="_idIndexMarker478"/> the <code>Advertisement.Show</code> function a second parameter to reference the object to run code on.</p>
			<ol>
				<li value="2">Update the <code>ShowAd</code> function to have the second parameter added to our function:<pre class="source-code">
    /// &lt;summary&gt;
    /// Will load and display an ad on the screen
    /// &lt;/summary&gt;
    public static void ShowAd()
    {
        // Load an Ad to play
        Advertisement.Load(GetAdID());
        // Display it after it is loaded
        Advertisement.Show(GetAdID(), <strong class="bold">instance</strong>);
    }</pre></li>
			</ol>
			<p>For the second parameter, the <code>Advertisement.Show</code> function takes in an <code>IUnityAdsShowListener</code> object. <code>I</code> at the start of the name here indicates that this type is an interface. This is a keyword in C#, designating something like a contract, promising that whatever you provide to this function contains the functionalities required by the interface.</p>
			<ol>
				<li value="3">Now update the class definition to the following:<pre class="source-code">
public class UnityAdController : MonoBehaviour, <strong class="bold">IUnityAdsShowListener</strong></pre></li>
			</ol>
			<p>By adding<a id="_idIndexMarker479"/> the <a id="_idIndexMarker480"/>comma and then <code>IUnityAdsShowListener</code>, we are stating that we will implement the methods provided by the <code>IUnityAdsShowListener</code> interface.</p>
			<p>In C#, whenever we add an interface to our class definition, we are making a promise that we will include an implementation for all of the methods that were declared inside of that interface, and if we don’t, our code won’t compile. This is needed because later on we are going to pass in an object of type <code>IUnityAdsShowListener</code> to Unity’s code and it will use those methods at the appropriate times.</p>
			<p>To see what those methods are, from your IDE, you may be able to right-click on the <code>IUnityAdsShowListener</code> option and select <strong class="bold">Go to Definition</strong>. From there, you may see something like the following:</p>
			<pre class="source-code">
namespace UnityEngine.Advertisements
{
    public interface IUnityAdsShowListener
    {
        void OnUnityAdsShowClick(string placementId);
        void OnUnityAdsShowComplete(
            string placementId,
                UnityAdsShowCompletionState
                    showCompletionState);
        void OnUnityAdsShowFailure(string placementId,
            UnityAdsShowError error, string message);
        void OnUnityAdsShowStart(string placementId);
    }
}</pre>
			<p>We will need to create four methods inside our own class with the exact same names, parameters, and return types.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">For more information on interfaces and how they work in C#, check out <a href="https://www.tutorialsteacher.com/csharp/csharp-interface">https://www.tutorialsteacher.com/csharp/csharp-interface</a>.</p>
			<ol>
				<li value="4">After<a id="_idIndexMarker481"/> doing <a id="_idIndexMarker482"/>this, we need to implement the functions used by the interface:<pre class="source-code">
#region IUnityAdsShowListener Methods
/// &lt;summary&gt;
/// This callback method handles logic for the ad
/// starting to play.
/// &lt;/summary&gt;
/// &lt;param name="placementId"&gt;The identifier for the
    Ad Unit showing the content.&lt;/param&gt;
public void OnUnityAdsShowStart(string placementId)
{
    /* Pause game while ad is shown */
    PauseScreenBehaviour.paused = true;
    Time.timeScale = 0f;
}
/// &lt;summary&gt;
/// This callback method handles logic for the ad
/// finishing.
/// &lt;/summary&gt;
/// &lt;param name="placementId"&gt;The identifier for the
/// Ad Unit showing the content&lt;/param&gt;
/// &lt;param name="showCompletionState"&gt;Indicates the
/// final state of the ad (whether the ad was skipped
/// or completed).&lt;/param&gt;
public void OnUnityAdsShowComplete(string placementId,
UnityAdsShowCompletionState showCompletionState)
{
    /* Unpause game when ad is over */
    PauseScreenBehaviour.paused = false;
    Time.timeScale = 1f;
}
/* This callback method handles logic for the user clicking on the ad. */
public void OnUnityAdsShowClick(string placementId) { }
/* This callback method handles logic for the Ad Unit failing to show. */
public void OnUnityAdsShowFailure(string placementId, UnityAdsShowError error, string message) { }
#endregion</pre></li>
			</ol>
			<p>Each of these four functions does something when we are creating ads. Of note is the <code>OnUnityAdsShowStart</code> method, where we pause the game, and then the <code>OnUnityAdsShowComplete</code> method where we unpause. We utilize a region here in <a id="_idIndexMarker483"/>order to make it easier to <a id="_idIndexMarker484"/>compartmentalize our code.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">For more information on the <code>#region</code> block, check out <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/preprocessor-directives/preprocessor-region">https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/preprocessor-directives/preprocessor-region</a>.</p>
			<ol>
				<li value="5">Next, we will make it so that <code>PauseScreenBehaviour</code> doesn’t override this new change. So, we will replace the <code>Start()</code> function with the following:<pre class="source-code">
void Start()
{
    if (!UnityAdController.showAds)
    {
        /* If not showing ads, just start the game */
        SetPauseMenu(false);
    }
}</pre></li>
			</ol>
			<p>The preceding snippet is important because otherwise the game will immediately be turned off when the level loads in the <code>Start</code> function, after we tell the game to pause, which is called after the level loads. This is needed for the PC version of the game, as there is nothing else to unpause the static value.</p>
			<ol>
				<li value="6">Save our <a id="_idIndexMarker485"/>scripts<a id="_idIndexMarker486"/> and start the game up again:</li>
			</ol>
			<div><div><img src="img/B18868_07_06.jpg" alt="Figure 7.6 – The game is paused until the player ends the ad"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.6 – The game is paused until the player ends the ad</p>
			<p>With that, when we transition from the main menu to the game, we will pause the game until we are ready to jump in. Now that we can see how to work with basic advertisements that aren’t optional, let’s give players the opportunity to see an ad for some kind of benefit.</p>
			<h1 id="_idParaDest-94"><a id="_idTextAnchor243"/>Opt-in advertisements with rewards</h1>
			<p>According to AdColony, the<a id="_idIndexMarker487"/> most recommended <a id="_idIndexMarker488"/>form of mobile game ad according to 58% of mobile developers is the rewarded video ad. By that, we’re referring to making ads an opt-in experience where players choose to see an ad and receive some kind of bonus in return. That way, users feel it’s a choice for them whether or not to watch the ad, and they feel more compelled to watch it because they will get something out of it.</p>
			<p>Rewarded ad placements typically <a id="_idIndexMarker489"/>yield higher <strong class="bold">effective Cost Per 1000 Impressions (eCPMs)</strong> since they offer more engagement from users by allowing them to opt in before watching an ad in exchange for some in-game reward.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">If you’re interested in learning more about why reward ads are recommended, check out <a href="https://www-staging.adcolony.com/blog/2016/04/26/the-top-ads-recommended-by-mobile-game-developers/">https://www-staging.adcolony.com/blog/2016/04/26/the-top-ads-recommended-by-mobile-game-developers/</a>.</p>
			<p>In our game, we could add the choice of restarting the game or seeing an ad to continue the game. This means that we will need to create some kind of menu in order for the player to select whether or not to see the ad, so let’s add that next:</p>
			<ol>
				<li>Stop the game if you haven’t done so already, and then open up the <strong class="bold">Gameplay</strong></li>
				<li>scene. Afterward, let’s create a <code>Game Over</code> and then turn off the <strong class="bold">Pause Menu</strong> so that we can see the <strong class="bold">Game Over</strong> object clearly. To make it easier to see, feel free to toggle to the 2D mode we used previously when creating the UI elements of our game.</li>
				<li>Next, expand the <code>Game Over Contents</code> and change the child <code>Game </code><code>Over</code> instead.</li>
				<li>Now, change the <code>Continue (Play Ad)</code> and change the button object’s name to <code>Continue Button</code>:</li>
			</ol>
			<div><div><img src="img/B18868_07_07.jpg" alt="Figure 7.7 – Game Over menu setup"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.7 – Game Over menu setup</p>
			<ol>
				<li value="5">We’ll first need<a id="_idIndexMarker490"/> to<a id="_idIndexMarker491"/> update the <code>ObstacleBehaviour</code> script to handle it; add the following highlighted code:<pre class="source-code">
using UnityEngine;
using UnityEngine.UI; // Button
public class ObstacleBehaviour : MonoBehaviour
{
[Tooltip("How long to wait before restarting the game")] 
public float waitTime = 2.0f;
public GameObject explosion;
<strong class="bold">private GameObject player;</strong>
private void OnCollisionEnter(Collision collision)
{
    // First check if we collided with the player
    if (collision.gameObject.GetComponent
        &lt;PlayerBehaviour&gt;())
    {
<strong class="bold">        // Destroy (Hide) the player</strong>
<strong class="bold">        </strong><strong class="bold">collision.gameObject.SetActive(false);</strong>
<strong class="bold">        player = collision.gameObject;</strong>
        // Call the function ResetGame after waitTime
       // has passed 
       Invoke("ResetGame", waitTime);
    }
}
/// &lt;summary&gt;
/// Will restart the currently loaded level
/// &lt;/summary&gt;
private void ResetGame()
{
    <strong class="bold">//Bring up restart menu</strong>
<strong class="bold">    var go = GetGameOverMenu();</strong>
<strong class="bold">    go.SetActive(true);</strong>
<strong class="bold">    // Get our continue button</strong>
<strong class="bold">    var buttons =</strong>
<strong class="bold">    go.transform.GetComponentsInChildren&lt;Button&gt; ();</strong>
    <strong class="bold">Button continueButton = null;</strong>
<strong class="bold">    foreach (var button in buttons)</strong>
<strong class="bold">    {</strong>
<strong class="bold">        if (button.gameObject.name == "Continue</strong>
<strong class="bold">            Button")</strong>
<strong class="bold">        {</strong>
<strong class="bold">            continueButton = button;</strong>
<strong class="bold">            break;</strong>
<strong class="bold">        }</strong>
<strong class="bold">    }</strong>
<strong class="bold">    // If we found the button we can use it</strong>
<strong class="bold">    if (continueButton)</strong>
<strong class="bold">    {</strong>
<strong class="bold">        if (UnityAdController.showAds)</strong>
<strong class="bold">        {</strong>
<strong class="bold">            // If player clicks on button we want to</strong>
            <strong class="bold">// play ad and then continue</strong>
<strong class="bold">            continueButton.onClick.AddListener</strong>
<strong class="bold">            </strong><strong class="bold">(UnityAdController.ShowAd);</strong>
<strong class="bold">            UnityAdController.obstacle = this;</strong>
<strong class="bold">        }</strong>
<strong class="bold">        else</strong>
<strong class="bold">        {</strong>
<strong class="bold">            // If can't play an ad, no need for</strong>
<strong class="bold">            // continue button</strong>
<strong class="bold">           continueButton.gameObject.SetActive(false);</strong>
<strong class="bold">        }</strong>
<strong class="bold">    }</strong>
}
/// &lt;summary&gt;
/// If the object is tapped, we spawn an explosion and
/// destroy this object
/// &lt;/summary&gt;
private void PlayerTouch()
{
    if (explosion != null)
    {
        var particles = Instantiate(explosion,
            transform.position, Quaternion.identity);
        Destroy(particles, 1.0f);
    }
        Destroy(this.gameObject);
}
<strong class="bold">/// &lt;summary&gt;</strong>
<strong class="bold">/// Retrieves the Game Over menu game object</strong>
<strong class="bold">/// &lt;/summary&gt;</strong>
<strong class="bold">/// &lt;returns&gt;The Game Over menu object&lt;/returns&gt;</strong>
<strong class="bold">GameObject GetGameOverMenu()</strong>
<strong class="bold">{</strong>
<strong class="bold">    var canvas = GameObject.Find("Canvas").transform;</strong>
<strong class="bold">    return canvas.Find("Game Over").gameObject;</strong>
<strong class="bold">}</strong>
<strong class="bold">/// &lt;summary&gt;</strong>
<strong class="bold">/// Handles resetting the game if needed</strong>
<strong class="bold">/// &lt;/summary&gt;</strong>
<strong class="bold">public void Continue()</strong>
<strong class="bold">{</strong>
<strong class="bold">    var go = GetGameOverMenu();</strong>
<strong class="bold">    go.SetActive(false);</strong>
<strong class="bold">    player.SetActive(true);</strong>
<strong class="bold">    // Explode this as well (So if we respawn player</strong>
<strong class="bold">    // can continue) </strong>
<strong class="bold">    PlayerTouch();</strong>
<strong class="bold">}</strong>
}</pre></li>
				<li>First, add the following variable and update the <code>OnCollisionEnter</code> function to<a id="_idIndexMarker492"/> the<a id="_idIndexMarker493"/> following:<pre class="source-code">
    /// &lt;summary&gt;
    /// A reference to the player object
    /// &lt;/summary&gt;
    private GameObject player;
    private void OnCollisionEnter(Collision collision)
    {
        // First check if we collided with the player
        if (collision.gameObject.GetComponent
            &lt;PlayerBehaviour&gt;())
        {
            // Destroy the player
            //Destroy(collision.gameObject);
            // Destroy (Hide) the player
            player = collision.gameObject;
            player.SetActive(false);
            // Call the function ResetGame after
            // waitTime has passed
            Invoke("ResetGame", waitTime);
        }
    }</pre></li>
			</ol>
			<p>In this instance, we remove the code that was destroying the <code>player</code> object and hide it instead. The reason we do this is so that, if the player decides to play the ad, we can then unhide it and resume the game as normal.</p>
			<ol>
				<li value="7">We will use the <code>Button</code> class next, so we want to add the following to the top of the <code>ObstacleBehaviour</code> script:<pre class="source-code">
using UnityEngine.UI;</pre></li>
				<li>With<a id="_idIndexMarker494"/> that<a id="_idIndexMarker495"/> done, we will then update the <code>ResetGame</code> function to the following:<pre class="source-code">
/// &lt;summary&gt;
/// Will restart the currently loaded level
/// &lt;/summary&gt;
private void ResetGame()
{
    //Bring up restart menu
    var go = GetGameOverMenu();
    go.SetActive(true);
    // Get our continue button
    var buttons =
       go.transform.GetComponentsInChildren&lt;Button&gt;();
    Button continueButton = null;
    foreach (var button in buttons)
    {
        if (button.gameObject.name == "Continue
            Button")
        {
            continueButton = button;
            break;
        }
    }
    /*If we found the button we can use it */
    if (continueButton)
    {
        if (UnityAdController.showAds)
        {
            // If player clicks on button we want to
            // play ad and then continue
            continueButton.onClick.AddListener(
                UnityAdController.ShowAd);
            UnityAdController.obstacle = this;
        }
        else
        {
            /* If can't play an ad, no need for
               continue button */
           continueButton.gameObject.SetActive(false);
        }
    }
}</pre></li>
			</ol>
			<p>We also destroy what the player hit. So, if we do restart the game, then the player will be<a id="_idIndexMarker496"/> able to start from right <a id="_idIndexMarker497"/>where they initially began.</p>
			<ol>
				<li value="9">Next, add the following two helper functions:<pre class="source-code">
/// &lt;summary&gt;
/// Retrieves the Game Over menu game object
/// &lt;/summary&gt;
/// &lt;returns&gt;The Game Over menu object&lt;/returns&gt;
GameObject GetGameOverMenu()
{
    var canvas = GameObject.Find("Canvas").transform;
    return canvas.Find("Game Over").gameObject;
}
/// &lt;summary&gt;
/// Handles resetting the game if needed
/// &lt;/summary&gt;
public void Continue()
{
    var go = GetGameOverMenu();
    go.SetActive(false);
    player.SetActive(true);
    /* Explode this as well (So if we respawn player
       can continue) */
    PlayerTouch();
}</pre></li>
			</ol>
			<p>With <a id="_idIndexMarker498"/>that in<a id="_idIndexMarker499"/> mind, we also created a <code>Continue</code> function, which will set up the game to be continued if we need to do so.</p>
			<ol>
				<li value="10">Open up the <code>UnityAdController</code> script and add the following variable declaration at the top of the file:<pre class="source-code">
/// &lt;summary&gt;
/// For holding the obstacle for continuing the game
/// &lt;/summary&gt;
public static ObstacleBehaviour obstacle;</pre></li>
				<li>Afterward, staying in the <code>UnityAdController</code> script, update the <code>OnUnityAdsShowComplete</code> function to the following:<pre class="source-code">
/// &lt;summary&gt;
/// This callback method handles logic for the ad
/// finishing.
/// &lt;/summary&gt;
/// &lt;param name="placementId"&gt;The identifier for the Ad Unit showing the content&lt;/param&gt;
/// &lt;param name="showCompletionState"&gt;Indicates the final state of the ad (whether the ad was skipped or completed).&lt;/param&gt;
public void OnUnityAdsShowComplete(string placementId, UnityAdsShowCompletionState showCompletionState)
{
    /* If there is an obstacle, we can remove it to
       continue the game */
    if (obstacle != null &amp;&amp; showCompletionState ==
        UnityAdsShowCompletionState.COMPLETED)
    {
        obstacle.Continue();
    }
    /* Unpause game when ad is over */
    PauseScreenBehaviour.paused = false;
    Time.timeScale = 1f;
}</pre></li>
			</ol>
			<p>Our additions first<a id="_idIndexMarker500"/> check whether there is an obstacle that our player has hit. If there is, we then check the value of the <code>showCompletionState</code> variable that is provided by the function. We utilize the <code>UnityAdsShowCompletionState</code> enum to verify that the player actually completed the ad and did not click on the <strong class="bold">Skip</strong> button.</p>
			<ol>
				<li value="12">We want to make sure that Unity’s Advertisement system works in both scenes, so we can copy-paste the <code>GameManager</code> script<a id="_idIndexMarker501"/> and add the<a id="_idIndexMarker502"/> following highlighted code to the <code>Start</code> function:<pre class="source-code">
/// &lt;summary&gt;
/// Start is called before the first frame update
/// &lt;/summary&gt;
private void Start()
{
    /* If there is no UnityAdController, we can add it
       through code */
    if (!GameObject.FindObjectOfType
        &lt;UnityAdController&gt;())
    {
       var adController = new GameObject("Unity Ad
           Controller");
       adController.AddComponent&lt;UnityAdController&gt;();
    }
    // Set our starting point
    nextTileLocation = startPoint;
    nextTileRotation = Quaternion.identity;
    for (int i = 0; i &lt; initSpawnNum; ++i)
    {
        SpawnNextTile(i &gt;= initNoObstacles);
    }
}</pre></li>
				<li>Save your scripts and return to the Unity Editor.</li>
				<li>Click on the <strong class="bold">Game Over</strong> object and disable it, save our scene, and then open the <strong class="bold">Main Menu</strong> scene<a id="_idIndexMarker503"/> and dive into the <a id="_idIndexMarker504"/>game.</li>
			</ol>
			<p class="callout-heading">Tip</p>
			<p class="callout">If you do not see the ads there, it may be due to the fact that Unity Ads was not initialized. This is done in the <strong class="bold">Main Menu</strong> scene, so you’ll need to<a id="_idTextAnchor245"/> go there first before you see the ads.</p>
			<p>At this point, when we die in the game, we’ll be shown a <strong class="bold">Game </strong><strong class="bold">Over</strong> screen:</p>
			<div><div><img src="img/B18868_07_08.jpg" alt="Figure 7.8 – Game Over screen"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.8 – Game Over screen</p>
			<p>If we<a id="_idIndexMarker505"/> click <a id="_idIndexMarker506"/>on <strong class="bold">Continue (Play Ad)</strong>, we will have an ad play. If the player skips it, nothing will happen, but if they watch all the way through, it should take them back into the game as if nothing happened:</p>
			<div><div><img src="img/B18868_07_09.jpg" alt="Figure 7.9 – Continuing the game"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.9 – Continuing the game</p>
			<p>With that, our ad system is working correctly. We have now seen how we can integrate the use of ads <a id="_idIndexMarker507"/>into<a id="_idIndexMarker508"/> our gameplay and provide a reas<a id="_idTextAnchor246"/>on for players to actually want to see this content.</p>
			<h1 id="_idParaDest-95"><a id="_idTextAnchor247"/>Adding in a cooldown timer</h1>
			<p>Ads are great <a id="_idIndexMarker509"/>for developers; however, according to Unity’s <a id="_idIndexMarker510"/>Monetization FAQs, each user is only able to view 25 ads per day. With that in mind, we will likely want to make it so that players can only trigger ads every once in a while. This also has the benefit of making players want to come back to our game after a period of time.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">For more information on Unity’s Monetization FAQs, che<a id="_idTextAnchor248"/>ck out <a href="https://docs.unity.com/ads/FAQ.html">https://docs.unity.com/ads/FAQ.html</a>.</p>
			<p>We will now implement a feature where our <strong class="bold">Continue</strong> option will only work once in a while with a short delay that we can easily customize if we like:</p>
			<ol>
				<li>To get started, go back to the <code>UnityAdController</code> script and add the following new <a id="_idIndexMarker511"/>variable to it, shown in the highlighted <a id="_idIndexMarker512"/>code:<pre class="source-code">
<strong class="bold">using System; // DateTime</strong>
using UnityEngine;
using UnityEngine.Advertisements; /* Advertisement class */
public class UnityAdController : MonoBehaviour, IUnityAdsShowListener
{
    /// &lt;summary&gt;
    /// A static reference to this object
    /// &lt;/summary&gt;
    public static UnityAdController instance;
    /// &lt;summary&gt;
    /// If we should show ads or not
    /// &lt;/summary&gt;
    public static bool showAds = true;
    <strong class="bold">// Nullable type</strong>
<strong class="bold">    public static DateTime? nextRewardTime = null;</strong>
    /// &lt;summary&gt;
    /// For holding the obstacle for continuing the
    /// game
    /// &lt;/summary&gt;
    public static ObstacleBehaviour obstacle;
// Rest of UnityAdController...</pre></li>
			</ol>
			<p>The <code>nextRewardTime</code> variable is of the <code>DateTime</code> type, which we haven’t talked about previously. Basically, it’s a structure that represents a point in time that we can compare to other points in time and is built into .NET Framework. We’ll use this to store the time that needs to pass before the player is able to play <a id="_idIndexMarker513"/>another <a id="_idIndexMarker514"/>ad if needed. Note that <code>DateTime</code> is part of the <code>System</code> namespace. That is why we added the <code>using System;</code> line in the preceding code as well.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">For more information on the <code>DateTime</code> class, check out <a href="https://msdn.microsoft.com/en-us/library/system.datetime(v=vs.110).aspx">https://msdn.microsoft.com/en-us/library/system.datetime(v=vs.110).aspx</a>.</p>
			<p>You may notice the <code>?</code> symbol next to the type of this variable. When we do this, we create what’s called a nullable type. The advantage of using them is that they can be <code>null</code> in addition to having normal values. We do this so that we don’t have to fill in a default value just for the sake of having one.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">For more information on nullable types, check out <a href="https://www.tutorialspoint.com/csharp/csharp_nullables.htm">https://www.tutorialspoint.com/csharp/csharp_nullables.htm</a>.</p>
			<ol>
				<li value="2">To add a time delay between ads showing, we will create a new function for this purpose:<pre class="source-code">
public static void ShowRewardAd()
{
    nextRewardTime = DateTime.Now.AddSeconds(15);
    ShowAd();
}</pre></li>
			</ol>
			<p>Now when we show a reward ad, we set <code>nextRewardTime</code> to 15 seconds from when the function is called. Of course, we can just as easily set this to minutes or hours using the <code>AddMinutes</code> and <code>AddHours</code> function.</p>
			<ol>
				<li value="3">Save your script<a id="_idIndexMarker515"/> and then open up the <code>ObstacleBehaviour</code> script. At<a id="_idIndexMarker516"/> the top of the script, add the following new <code>using</code> statements:<pre class="source-code">
using System; // DateTime
using System.Collections; // IEnumerator</pre></li>
				<li>Afterward, we will need to modify the bottom part of the <code>ResetGame()</code> function to have the following code:<pre class="source-code">
// Rest of ResetGame above...
        /*If we found the button we can use it */
        if (continueButton)
        {
            if (UnityAdController.showAds)
            {
                // If player clicks on button we want
                // to play ad and then continue
                StartCoroutine(ShowContinue(
                    continueButton));
            }
            else
            {
                /* If can't play an ad, no need for
                   continue button */
                continueButton.gameObject.SetActive(
                    false);
            }
        }
    }</pre></li>
			</ol>
			<p>Now, instead of <a id="_idIndexMarker517"/>just<a id="_idIndexMarker518"/> adding a listener to this button, we have replaced it with a call to the <code>StartCoroutine</code> function, which takes in a function that we haven’t written yet. I think it’s probably a good idea to talk a little bit about coroutines before we actually write one.</p>
			<p>A coroutine is like a function that has the ability to pause execution and continue where it left off after a period of time. By default, a coroutine is resumed on the frame after we start to use <code>yield</code>, but it is also possible to introduce a time delay using the <code>WaitForSeconds</code> function to specify how long you want to wait before it’s called again.</p>
			<ol>
				<li value="5">Next, use the<a id="_idIndexMarker519"/> following <a id="_idIndexMarker520"/>script for the <code>ShowContinue</code> function:<pre class="source-code">
    public IEnumerator ShowContinue(Button contButton)
    {
        while (true)
        {
            var btnText =
                contButton.GetComponentInChildren
                    &lt; TMPPro.TMP_Text&gt;();
            /* Check if we haven't reached the next
               reward time yet (if one exists) */
            var rewardTime =
                UnityAdController.nextRewardTime;
            bool validTime = rewardTime.HasValue;
            bool timePassed = true;
            if (validTime)
            {
                timePassed =
                    DateTime.Now &gt; rewardTime.Value;
            }
            if (!timePassed)
            {
                /* Unable to click on the button */
                contButton.interactable = false;
                /* Get the time remaining until we get
                   to the next reward time */
                TimeSpan remaining =
                    rewardTime.Value - DateTime.Now;
                /* Get the time left in the following
                   format 99:99 */
                var countdownText =
                    string.Format("{0:D2}:{1:D2}",
                        remaining.Minutes,
                            remaining.Seconds);
                /* Set our button's text to reflect
                   the new time */
                btnText.text = countdownText;
                /* Come back after 1 second and check
                   again */
                yield return new WaitForSeconds(1f);
            }
            else
            {
                /* It's valid to click the button now
                */
                contButton.interactable = true;
                /* If player clicks on button we want
                   to play ad and then continue */
                contButton.onClick.AddListener(
                    UnityAdController.ShowRewardAd);
                UnityAdController.obstacle = this;
                /* Change text to its original version
                */
                btnText.text = "Continue (Play Ad)";
                /* We can now leave the coroutine */
                break;
            }
        }
    }</pre></li>
			</ol>
			<p>This coroutine will do a number of things, starting off by entering a <code>while (true)</code> loop. Now, usually, this is a very bad thing, as it would cause an infinite loop, but we break out of the loop if we have no reward time set or if we’ve passed the<a id="_idIndexMarker521"/> time <a id="_idIndexMarker522"/>set in the <code>nextRewardTime</code> variable. If not, we will figure out how much time is left before that time has passed and will change the button’s text to display it. We then use the <code>WaitForSeconds</code> function to pause execution and come back after 1 second has passed.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">If you’re interested in learning more about the behind-the-scenes aspects of how coroutines work, Oliver Booth wrote a neat article on it at <a href="https://blog.oliverbooth.dev/2021/04/27/how-do-unitys-coroutines-actually-work/">https://blog.oliverbooth.dev/2021/04/27/how-do-unitys-coroutines-actually-work/</a>.</p>
			<ol>
				<li value="6">Save all of our scripts and dive back into Unity and play the game:</li>
			</ol>
			<div><div><img src="img/B18868_07_10.jpg" alt="Figure 7.10 – Delay screen working correctly"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 7.10 – Delay screen working correctly</p>
			<p>Upon restarting the game once, you’ll see that if we try to do so again, we are brought to a delay screen. After the time gets down to 0, the player will then be able to <a id="_idIndexMarker523"/>continue <a id="_idIndexMarker524"/>once again.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">For additional information on the best practices for rewarded ads such as this, check<a id="_idTextAnchor249"/> out <a href="https://docs.unity.com/ads/MonetizationStrategy.html">https://docs.unity.com/ads/MonetizationStrategy.html</a>.</p>
			<h1 id="_idParaDest-96"><a id="_idTextAnchor250"/>Summary</h1>
			<p>With that, we’ve got a good foundation of how to add ads to our game. Hopefully, you can see how easy it is to implement and can think of new ways to engage players to have the best experience possible. Over the course of this chapter, we discovered how to set up Unity Ads. We then saw how we could create simple ads and learned how to react to the player’s actions by implementing the <code>IUnityAdsShowListener</code> interface. Afterward, we saw how we can add rewards for players using opt-in advertisements in the game, and we added a cooldown to the system to make the game less annoying for players. With these newly acquired skills, you should be able to add advertisements and gain additional revenue from your own games that you create in the future.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">By default, ads should be in test mode. It is against Unity Ads’ terms of service to distribute live ads to beta testers. If they were to click on or install any of the advertised games, their activity would be monetized and the automated fraud system would flag the game for fraud and disable it.</p>
			<p class="callout">To disable test mode, you can go to the Analytics Monetization Dashboard by going to <strong class="bold">Services | Ads | Configure</strong> and then clicking on <strong class="bold">Go to Dashboard</strong>. (If you need to, select <strong class="bold">Set Meditation Partner</strong> and <strong class="bold">I only plan to use </strong><strong class="bold">Unity ads</strong>.)</p>
			<p class="callout">From your project, select <strong class="bold">Settings</strong>. Scroll down to the <strong class="bold">Test mode</strong> section and modify the <strong class="bold">Apple App Store</strong> or <strong class="bold">Google Play Store</strong> properties as you wish.</p>
			<p>While this is a valid way to monetize our games, we will dive into another more popular form of in-game monetization in the next chapter: in-app purchases.</p>
		</div>
	</body></html>