<html><head></head><body>
<div id="_idContainer021" class="calibre2">
<h1 class="chapter-number" id="_idParaDest-15"><a id="_idTextAnchor015" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.1.1">1</span></h1>
<h1 id="_idParaDest-16" class="calibre5"><a id="_idTextAnchor016" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.2.1">Building the UI for Your Messaging App</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.3.1">In this first chapter, we’re going to start building a messaging app called WhatsPackt (referring to a popular messaging app that you probably already know about). </span><span class="kobospan" id="kobo.3.2">At this point in the project, we must make some important technical decisions and create the structure needed to build it. </span><span class="kobospan" id="kobo.3.3">This is what we will be focusing on, as well as working on the app’s </span><span><span class="kobospan" id="kobo.4.1">user interface.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.5.1">By the end of this chapter, you will have hands-on experience creating a messaging app from scratch, organizing and defining the app modules, deciding which dependency injection framework you will use, using Jetpack Navigation to navigate between the app features, and using Jetpack Compose to build the main parts of the </span><span><span class="kobospan" id="kobo.6.1">user interface.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.7.1">This chapter is organized into the </span><span><span class="kobospan" id="kobo.8.1">following topics:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><span class="kobospan" id="kobo.9.1">Defining the app structure </span><span><span class="kobospan" id="kobo.10.1">and navigation</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.11.1">Building the </span><span><span class="kobospan" id="kobo.12.1">main screen</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.13.1">Building the </span><span><span class="kobospan" id="kobo.14.1">chats list</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.15.1">Building the </span><span><span class="kobospan" id="kobo.16.1">messages list</span></span></li>
</ul>
<h1 id="_idParaDest-17" class="calibre5"><a id="_idTextAnchor017" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.17.1">Technical requirements</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.18.1">Android Studio is the official </span><a id="_idIndexMarker000" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.19.1">standard </span><strong class="bold"><span class="kobospan" id="kobo.20.1">integrated development environment</span></strong><span class="kobospan" id="kobo.21.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.22.1">IDE</span></strong><span class="kobospan" id="kobo.23.1">) for developing Android apps. </span><span class="kobospan" id="kobo.23.2">Although you can use other IDEs, editors, and Android tools if you prefer, all the examples in this book will be based on </span><span><span class="kobospan" id="kobo.24.1">this IDE.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.25.1">For that reason, we recommend that you set up your computer with the latest stable version of Android Studio installed. </span><span class="kobospan" id="kobo.25.2">If you haven’t already, you can download it here: </span><a href="https://developer.android.com/studio" class="calibre6 pcalibre1 pcalibre"><span class="kobospan" id="kobo.26.1">https://developer.android.com/studio</span></a><span class="kobospan" id="kobo.27.1">. </span><span class="kobospan" id="kobo.27.2">By following the installation steps, you will be able to install the IDE and set up at least one emulator with one Android </span><span><span class="kobospan" id="kobo.28.1">SDK installed.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.29.1">Once installed, we can start creating the project. </span><span class="kobospan" id="kobo.29.2">Android Studio will offer us a set of templates to start with. </span><span class="kobospan" id="kobo.29.3">We will choose the </span><strong class="bold"><span class="kobospan" id="kobo.30.1">Empty Activity</span></strong><span class="kobospan" id="kobo.31.1"> option, as shown in the </span><span><span class="kobospan" id="kobo.32.1">following screenshot:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer008">
<span class="kobospan" id="kobo.33.1"><img alt="Figure 1.1: Android Studio new project template selection with the Empty Activity option selected" src="image/B19443_01_1.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.34.1">Figure 1.1: Android Studio new project template selection with the Empty Activity option selected</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.35.1">You will</span><a id="_idIndexMarker001" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.36.1"> then be asked to select a project and </span><span><span class="kobospan" id="kobo.37.1">package name:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer009">
<span class="kobospan" id="kobo.38.1"><img alt="Figure 1.2: Android Studio – adding a new project name and package name" src="image/B19443_01_2.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.39.1">Figure 1.2: Android Studio – adding a new project name and package name</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.40.1">After that, you’re </span><a id="_idIndexMarker002" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.41.1">all set! </span><span class="kobospan" id="kobo.41.2">Android Studio will generate the main folders and files needed so that you can start working on our project. </span><span class="kobospan" id="kobo.41.3">Your project structure should look </span><span><span class="kobospan" id="kobo.42.1">as follows:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer010">
<span class="kobospan" id="kobo.43.1"><img alt="Figure 1.3: Android Studio – project template structure" src="image/B19443_01_3.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.44.1">Figure 1.3: Android Studio – project template structure</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.45.1">Note that all the code for this chapter can be found in this book’s GitHub </span><span><span class="kobospan" id="kobo.46.1">repository: </span></span><a href="https://github.com/PacktPublishing/Thriving-in-Android-Development-using-Kotlin/tree/main/Chapter-1/WhatsPackt" class="calibre6 pcalibre1 pcalibre"><span><span class="kobospan" id="kobo.47.1">https://github.com/PacktPublishing/Thriving-in-Android-Development-using-Kotlin/tree/main/Chapter-1/WhatsPackt</span></span></a><span><span class="kobospan" id="kobo.48.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.49.1">Now, we are ready to start coding our new messaging app. </span><span class="kobospan" id="kobo.49.2">To do so, we will have to make some important technical decisions: we will have to decide how our project is going to be</span><a id="_idIndexMarker003" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.50.1"> structured, how we will navigate between the different screens or features, and how we are going to set and provide the components needed (defining and organizing the dependencies between </span><span><span class="kobospan" id="kobo.51.1">every component).</span></span></p>
<h1 id="_idParaDest-18" class="calibre5"><a id="_idTextAnchor018" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.52.1">Defining the app structure and navigation</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.53.1">Before designing </span><a id="_idIndexMarker004" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.54.1">the app structure, we must have a basic idea of the features it should include. </span><span class="kobospan" id="kobo.54.2">In our case, we want to have </span><span><span class="kobospan" id="kobo.55.1">the following:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><span class="kobospan" id="kobo.56.1">A main screen to create new or access already </span><span><span class="kobospan" id="kobo.57.1">existing conversations</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.58.1">A list containing all </span><span><span class="kobospan" id="kobo.59.1">the conversations</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.60.1">A screen for a </span><span><span class="kobospan" id="kobo.61.1">single conversation</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.62.1">As this is going to be a production-ready app, we must design its code base while considering that it should be easy to scale and maintain. </span><span class="kobospan" id="kobo.62.2">In that regard, we should </span><span><span class="kobospan" id="kobo.63.1">use modularization.</span></span></p>
<h2 id="_idParaDest-19" class="calibre7"><a id="_idTextAnchor019" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.64.1">Modularization</span></h2>
<p class="calibre3"><strong class="bold"><span class="kobospan" id="kobo.65.1">Modularization</span></strong><span class="kobospan" id="kobo.66.1"> is the </span><a id="_idIndexMarker005" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.67.1">practice of </span><a id="_idIndexMarker006" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.68.1">dividing the code of an application into loosely coupled and self-contained parts, each of which can be compiled and tested in isolation. </span><span class="kobospan" id="kobo.68.2">This technique allows developers to break down large and complex applications into more manageable parts that are easier </span><span><span class="kobospan" id="kobo.69.1">to maintain.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.70.1">By modularizing Android applications, modules can be built in parallel, which can significantly improve build time. </span><span class="kobospan" id="kobo.70.2">Additionally, independent modules can be tested separately, which makes it easier to identify and </span><span><span class="kobospan" id="kobo.71.1">correct errors.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.72.1">While the most common way to create modules in Android development is by utilizing the Android libraries system via Gradle dependencies, alternative build systems such as Bazel and Buck also facilitate modularization. </span><span class="kobospan" id="kobo.72.2">Bazel provides a robust system for declaring modules and dependencies, and its parallelized building capabilities can lead to even faster build times. </span><span class="kobospan" id="kobo.72.3">Similarly, Buck also supports modular development by providing fine-grained build rules and speeding up </span><span><span class="kobospan" id="kobo.73.1">incremental builds.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.74.1">By exploring various build systems, such as Gradle, Bazel, and Buck, developers can find the most suitable modular approach to structure their Android applications. </span><span class="kobospan" id="kobo.74.2">Each build system offers unique features for managing dependencies and organizing code, enabling developers to implement various patterns to achieve a </span><span><span class="kobospan" id="kobo.75.1">modular architecture.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.76.1">Among the</span><a id="_idIndexMarker007" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.77.1"> organizational </span><a id="_idIndexMarker008" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.78.1">patterns, the most common ones are modularization by layers and modularization by </span><span><span class="kobospan" id="kobo.79.1">feature modules.</span></span></p>
<h3 class="calibre9"><span class="kobospan" id="kobo.80.1">Modularization by layers</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.81.1">It is common to</span><a id="_idIndexMarker009" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.82.1"> structure</span><a id="_idIndexMarker010" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.83.1"> an app by grouping its components based on a set of layers depending on the architecture chosen by the developers. </span><span class="kobospan" id="kobo.83.2">One popular architecture is clean architecture, which splits the code base between the data, domain (or business), and </span><span><span class="kobospan" id="kobo.84.1">presentation layers.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.85.1">With this approach, each module focuses on a specific layer of the architecture, such as the presentation layer, domain layer, or data layer. </span><span class="kobospan" id="kobo.85.2">These modules are usually more independent of each other and may have different responsibilities and technologies, depending on the layer they belong to. </span><span class="kobospan" id="kobo.85.3">Following this pattern, our app structure would look </span><span><span class="kobospan" id="kobo.86.1">like this:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer011">
<span class="kobospan" id="kobo.87.1"><img alt="Figure 1.4: App modularization by layers" src="image/B19443_01_4.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.88.1">Figure 1.4: App modularization by layers</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.89.1">From this </span><a id="_idIndexMarker011" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.90.1">diagram, you can see</span><a id="_idIndexMarker012" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.91.1"> why layer modularization is also referred to as </span><span><span class="kobospan" id="kobo.92.1">vertical modularization.</span></span></p>
<h3 class="calibre9"><span class="kobospan" id="kobo.93.1">Modularization by feature</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.94.1">When modularizing</span><a id="_idIndexMarker013" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.95.1"> an app </span><a id="_idIndexMarker014" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.96.1">by feature (or using horizontal modularization), the application is divided into modules that focus on specific features or related tasks, such as authentication or navigation. </span><span class="kobospan" id="kobo.96.2">These horizontal modules can share common components and resources. </span><span class="kobospan" id="kobo.96.3">We can see this structure in the </span><span><span class="kobospan" id="kobo.97.1">following figure:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer012">
<span class="kobospan" id="kobo.98.1"><img alt="Figure 1.5: App modularization by feature" src="image/B19443_01_05.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.99.1">Figure 1.5: App modularization by feature</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.100.1">In our case, we are going to have a main </span><strong class="source-inline"><span class="kobospan" id="kobo.101.1">app</span></strong><span class="kobospan" id="kobo.102.1"> module that will depend on every one of the feature modules that our app needs (one for every one of the features we are going to implement). </span><span class="kobospan" id="kobo.102.2">Then, every one of the feature modules will also depend on two other common modules (in this example, we have divided them into </span><strong class="source-inline"><span class="kobospan" id="kobo.103.1">common</span></strong><span class="kobospan" id="kobo.104.1"> and </span><strong class="source-inline"><span class="kobospan" id="kobo.105.1">common_framework</span></strong><span class="kobospan" id="kobo.106.1">, using the first to include framework-independent code, and the second to use code that depends on the </span><span><span class="kobospan" id="kobo.107.1">Android framework).</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.108.1">One of the main advantages of this pattern is that it can scale with the company if it evolves into a feature-based team (where every team is focused on a single or group of features). </span><span class="kobospan" id="kobo.108.2">This will enable every team to be responsible for one feature module, or a set of feature modules, where</span><a id="_idIndexMarker015" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.109.1"> they have ownership of the code in those modules. </span><span class="kobospan" id="kobo.109.2">It also allows</span><a id="_idIndexMarker016" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.110.1"> teams to be easily autonomous regarding their problem space </span><span><span class="kobospan" id="kobo.111.1">and features.</span></span></p>
<h3 class="calibre9"><span class="kobospan" id="kobo.112.1">WhatsPackt modularization</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.113.1">In our WhatsPackt</span><a id="_idIndexMarker017" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.114.1"> example, we are going to combine both </span><span><span class="kobospan" id="kobo.115.1">modularization approaches:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><span class="kobospan" id="kobo.116.1">We will use a modularization based on features for </span><span><span class="kobospan" id="kobo.117.1">our features.</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.118.1">We will use a modularization based on layers for the common modules. </span><span class="kobospan" id="kobo.118.2">This will allow us to share common code between the </span><span><span class="kobospan" id="kobo.119.1">feature modules.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.120.1">The structure of our modules and its dependencies will be </span><span><span class="kobospan" id="kobo.121.1">as follows:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer013">
<span class="kobospan" id="kobo.122.1"><img alt="Figure 1.6: Our app modules structure and dependencies" src="image/B19443_01_6.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.123.1">Figure 1.6: Our app modules structure and dependencies</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.124.1">Now, we are </span><a id="_idIndexMarker018" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.125.1">going to start creating this structure in Android Studio. </span><span class="kobospan" id="kobo.125.2">To create a module, follow </span><span><span class="kobospan" id="kobo.126.1">these steps:</span></span></p>
<ol class="calibre13">
<li class="calibre14"><span class="kobospan" id="kobo.127.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.128.1">File</span></strong><span class="kobospan" id="kobo.129.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.130.1">New...</span></strong><span class="kobospan" id="kobo.131.1"> | </span><span><strong class="bold"><span class="kobospan" id="kobo.132.1">New Module</span></strong></span><span><span class="kobospan" id="kobo.133.1">.</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.134.1">In the </span><strong class="bold"><span class="kobospan" id="kobo.135.1">Create New Module</span></strong><span class="kobospan" id="kobo.136.1"> dialog, choose the </span><strong class="bold"><span class="kobospan" id="kobo.137.1">Android </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.138.1">Library</span></strong></span><span><span class="kobospan" id="kobo.139.1"> template.</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.140.1">Fill in the </span><strong class="bold"><span class="kobospan" id="kobo.141.1">Module name</span></strong><span class="kobospan" id="kobo.142.1">, </span><strong class="bold"><span class="kobospan" id="kobo.143.1">Package name</span></strong><span class="kobospan" id="kobo.144.1">, and </span><strong class="bold"><span class="kobospan" id="kobo.145.1">Language</span></strong><span class="kobospan" id="kobo.146.1"> fields, as </span><span><span class="kobospan" id="kobo.147.1">shown here:</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer014">
<span class="kobospan" id="kobo.148.1"><img alt="Figure 1.7: The Create New Module dialog" src="image/B19443_01_7.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.149.1">Figure 1.7: The Create New Module dialog</span></p>
<ol class="calibre13">
<li value="4" class="calibre14"><span><span class="kobospan" id="kobo.150.1">Click </span></span><span><strong class="bold"><span class="kobospan" id="kobo.151.1">Finish</span></strong></span><span><span class="kobospan" id="kobo.152.1">.</span></span></li>
</ol>
<p class="calibre3"><span class="kobospan" id="kobo.153.1">We will have to do </span><a id="_idIndexMarker019" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.154.1">this same process for all the modules we want to build, except for the </span><strong class="source-inline"><span class="kobospan" id="kobo.155.1">:app</span></strong><span class="kobospan" id="kobo.156.1"> module, which should have been already created when we created the project. </span><span class="kobospan" id="kobo.156.2">This is going to be our main point of entry to the app. </span><span class="kobospan" id="kobo.156.3">So, we must create the </span><span><span class="kobospan" id="kobo.157.1">following modules:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.158.1">:</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.159.1">common:domain</span></strong></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.160.1">:</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.161.1">common:data</span></strong></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.162.1">:</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.163.1">common:framework</span></strong></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.164.1">:</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.165.1">feature:create_chat</span></strong></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.166.1">:</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.167.1">feature:conversations</span></strong></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.168.1">:</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.169.1">feature:chat</span></strong></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.170.1">Once we’ve done this, we should have built the following </span><span><span class="kobospan" id="kobo.171.1">project structure:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer015">
<span class="kobospan" id="kobo.172.1"><img alt="Figure 1.8: Project structure, including all modules" src="image/B19443_01_8.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.173.1">Figure 1.8: Project structure, including all modules</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.174.1">The next step is to set the dependencies between modules. </span><span class="kobospan" id="kobo.174.2">We will do this in the </span><strong class="source-inline"><span class="kobospan" id="kobo.175.1">build.gradle</span></strong><span class="kobospan" id="kobo.176.1"> file of</span><a id="_idIndexMarker020" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.177.1"> every module. </span><span class="kobospan" id="kobo.177.2">For example, in the </span><strong class="source-inline"><span class="kobospan" id="kobo.178.1">build.gradle</span></strong><span class="kobospan" id="kobo.179.1"> file of the </span><strong class="source-inline"><span class="kobospan" id="kobo.180.1">:app</span></strong><span class="kobospan" id="kobo.181.1"> module, include the following code in the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.182.1">dependencies</span></strong></span><span><span class="kobospan" id="kobo.183.1"> section:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.184.1">
dependencies {
    implementation project(':feature:chat')
    implementation project(':feature:conversations')
    implementation project(':feature:create_chat')
    // The rest of dependencies
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.185.1">Now that our app modules are ready, we can start working on the next step: </span><span><span class="kobospan" id="kobo.186.1">dependency</span></span><span><a id="_idIndexMarker021" class="calibre6 pcalibre1 pcalibre"/></span><span><span class="kobospan" id="kobo.187.1"> injection.</span></span></p>
<h2 id="_idParaDest-20" class="calibre7"><a id="_idTextAnchor020" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.188.1">Dependency injection</span></h2>
<p class="calibre3"><strong class="bold"><span class="kobospan" id="kobo.189.1">Dependency injection</span></strong><span class="kobospan" id="kobo.190.1"> is a design </span><a id="_idIndexMarker022" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.191.1">pattern </span><a id="_idIndexMarker023" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.192.1">and technique that’s used in software engineering to decouple the objects in an application and reduce dependencies between them. </span><span class="kobospan" id="kobo.192.2">In Android, dependency injection involves providing an instance of a class or a component to another class, rather than creating it explicitly within the </span><span><span class="kobospan" id="kobo.193.1">class itself.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.194.1">By implementing dependency injection in an Android app, you can make the app’s code more modular, reusable, and testable. </span><span class="kobospan" id="kobo.194.2">Dependency injection also helps improve the maintainability of the code base and reduce the complexity of the </span><span><span class="kobospan" id="kobo.195.1">application architecture.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.196.1">Some of the most popular dependency injection libraries that are used in Android development are </span><span><span class="kobospan" id="kobo.197.1">as follows:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.198.1">Dagger</span></strong><span class="kobospan" id="kobo.199.1"> (</span><a href="https://dagger.dev/" class="calibre6 pcalibre1 pcalibre"><span class="kobospan" id="kobo.200.1">https://dagger.dev/</span></a><span class="kobospan" id="kobo.201.1">): Dagger </span><a id="_idIndexMarker024" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.202.1">is a compile-time dependency injection library developed</span><a id="_idIndexMarker025" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.203.1"> by Google that uses annotations and code generation to create a dependency graph that can be used to provide dependencies to the app’s components. </span><span class="kobospan" id="kobo.203.2">Its main advantage is that it builds this dependency graph at compile time, whereas other libraries (such as Koin) do it at runtime. </span><span class="kobospan" id="kobo.203.3">For larger apps, this can imply a </span><span><span class="kobospan" id="kobo.204.1">performance problem.</span></span></li>
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.205.1">Hilt</span></strong><span class="kobospan" id="kobo.206.1"> (</span><a href="https://dagger.dev/hilt/" class="calibre6 pcalibre1 pcalibre"><span class="kobospan" id="kobo.207.1">https://dagger.dev/hilt/</span></a><span class="kobospan" id="kobo.208.1">): Hilt is a dependency injection library built on top of Dagger that</span><a id="_idIndexMarker026" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.209.1"> provides a simplified way to perform dependency injection in Android apps. </span><span class="kobospan" id="kobo.209.2">It reduces the boilerplate code required for Dagger and provides predefined bindings for Android-specific components, such as activities </span><span><span class="kobospan" id="kobo.210.1">and fragments.</span></span></li>
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.211.1">Koin</span></strong><span class="kobospan" id="kobo.212.1"> (</span><a href="https://insert-koin.io/" class="calibre6 pcalibre1 pcalibre"><span class="kobospan" id="kobo.213.1">https://insert-koin.io/</span></a><span class="kobospan" id="kobo.214.1">): Koin is </span><a id="_idIndexMarker027" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.215.1">a lightweight dependency injection library for Kotlin that focuses on simplicity and ease of use. </span><span class="kobospan" id="kobo.215.2">It uses a </span><strong class="bold"><span class="kobospan" id="kobo.216.1">domain-specific language</span></strong><span class="kobospan" id="kobo.217.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.218.1">DSL</span></strong><span class="kobospan" id="kobo.219.1">) to</span><a id="_idIndexMarker028" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.220.1"> define the dependencies and provide them to the app’s components, which</span><a id="_idIndexMarker029" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.221.1"> makes it easier to do the setup and start </span><span><span class="kobospan" id="kobo.222.1">using it.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.223.1">Ultimately, the choice of dependency injection library depends on your specific requirements and preferences, and both Dagger and Koin are worth considering, depending on your needs. </span><span class="kobospan" id="kobo.223.2">In this case, we are going to use Hilt as it is the current recommendation </span><span><span class="kobospan" id="kobo.224.1">by Google.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.225.1">To set up Hilt in our project, follow </span><span><span class="kobospan" id="kobo.226.1">these steps:</span></span></p>
<ol class="calibre13">
<li class="calibre14"><span class="kobospan" id="kobo.227.1">Add the Hilt </span><a id="_idIndexMarker030" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.228.1">Gradle plugin to your project-level </span><strong class="source-inline1"><span class="kobospan" id="kobo.229.1">build.gradle</span></strong><span class="kobospan" id="kobo.230.1"> file (replace </span><strong class="source-inline1"><span class="kobospan" id="kobo.231.1">[version]</span></strong><span class="kobospan" id="kobo.232.1"> with the latest version available </span><span><span class="kobospan" id="kobo.233.1">for you):</span></span><pre class="source-code"><span class="kobospan1" id="kobo.234.1">
buildscript {
    repositories {
        google()
    }
    dependencies {
        classpath "com.google.dagger:hilt-android-
            gradle-plugin:[version]"
    }
}</span></pre></li> <li class="calibre14"><span class="kobospan" id="kobo.235.1">Apply the </span><a id="_idIndexMarker031" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.236.1">Hilt Gradle plugin and enable view binding in your app-level </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.237.1">build.gradle</span></strong></span><span><span class="kobospan" id="kobo.238.1"> file:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.239.1">
apply plugin: 'kotlin-kapt'
apply plugin: 'dagger.hilt.android.plugin'
android {
    ...
</span><span class="kobospan1" id="kobo.239.2">    buildFeatures {
        viewBinding true
    }
}
dependencies {
    implementation "com.google.dagger:hilt-
        android:[version]"
    kapt "com.google.dagger:hilt-android-
        compiler:[version]"
    ...
</span><span class="kobospan1" id="kobo.239.3">}</span></pre></li> <li class="calibre14"><span class="kobospan" id="kobo.240.1">Finally, create an </span><strong class="source-inline1"><span class="kobospan" id="kobo.241.1">Application</span></strong><span class="kobospan" id="kobo.242.1"> class in our </span><strong class="source-inline1"><span class="kobospan" id="kobo.243.1">:app</span></strong><span class="kobospan" id="kobo.244.1"> module. </span><span class="kobospan" id="kobo.244.2">The </span><strong class="source-inline1"><span class="kobospan" id="kobo.245.1">Application</span></strong><span class="kobospan" id="kobo.246.1"> class serves as a base class for maintaining the global application state (this refers to data or settings that need to be maintained throughout the entire life cycle of the application). </span><span class="kobospan" id="kobo.246.2">While it’s not created by default, creating</span><a id="_idIndexMarker032" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.247.1"> a custom </span><strong class="source-inline1"><span class="kobospan" id="kobo.248.1">Application</span></strong><span class="kobospan" id="kobo.249.1"> class is crucial for initialization tasks, such as setting up dependency injection frameworks or initializing libraries. </span><span class="kobospan" id="kobo.249.2">In this particular instance, to make Hilt work, you should annotate your </span><strong class="source-inline1"><span class="kobospan" id="kobo.250.1">Application</span></strong><span class="kobospan" id="kobo.251.1"> class with the </span><strong class="source-inline1"><span class="kobospan" id="kobo.252.1">@</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.253.1">HiltAndroidApp</span></strong></span><span><span class="kobospan" id="kobo.254.1"> annotation:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.255.1">
@HiltAndroidApp
class WhatsPacktApplication : Application() {
    // ...
</span><span class="kobospan1" id="kobo.255.2">}</span></pre></li> </ol>
<p class="calibre3"><span class="kobospan" id="kobo.256.1">With that, we</span><a id="_idIndexMarker033" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.257.1"> are all set – we will continue defining the modules and dependencies once we advance in </span><span><span class="kobospan" id="kobo.258.1">this project.</span></span></p>
<h2 id="_idParaDest-21" class="calibre7"><a id="_idTextAnchor021" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.259.1">Navigation</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.260.1">The next step is to </span><a id="_idIndexMarker034" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.261.1">decide what our approach to handling the navigation between screens and features in our application will be. </span><span class="kobospan" id="kobo.261.2">It is important to note that we are going to use Jetpack Compose to build the user interface of our app, so the chosen approach must be compatible </span><span><span class="kobospan" id="kobo.262.1">with it.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.263.1">In this case, we’re going to use Navigation Compose as it provides a simple and easy-to-use way to handle in-app navigation within an Android app. </span><span class="kobospan" id="kobo.263.2">Here are some benefits of using </span><span><span class="kobospan" id="kobo.264.1">Navigation Compose:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.265.1">Declarative UI</span></strong><span class="kobospan" id="kobo.266.1">: Navigation Compose follows the same declarative approach as Jetpack Compose, which makes it easier to understand and maintain the navigation flow in </span><span><span class="kobospan" id="kobo.267.1">your application.</span></span></li>
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.268.1">Type-safety</span></strong><span class="kobospan" id="kobo.269.1">: With Navigation Compose, you can define your navigation graph and actions in a type-safe way. </span><span class="kobospan" id="kobo.269.2">This helps prevent runtime crashes caused by incorrect navigation action names </span><span><span class="kobospan" id="kobo.270.1">and arguments.</span></span></li>
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.271.1">Animation and transition support</span></strong><span class="kobospan" id="kobo.272.1">: Navigation Compose provides built-in support for animating screen transitions, making it easy to create smooth and visually appealing </span><span><span class="kobospan" id="kobo.273.1">navigation experiences.</span></span></li>
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.274.1">Deep linking</span></strong><span class="kobospan" id="kobo.275.1">: Navigation Compose supports deep linking, allowing you to create URLs that can directly navigate to specific screens or actions within your app. </span><span class="kobospan" id="kobo.275.2">This is useful for implementing features such as app shortcuts, notifications, or </span><span><span class="kobospan" id="kobo.276.1">sharing content.</span></span></li>
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.277.1">Integration with Jetpack Compose</span></strong><span class="kobospan" id="kobo.278.1">: As part of the Jetpack Compose family, Navigation Compose works seamlessly with other Compose libraries and components, allowing you to build a consistent UI and navigation experience across </span><span><span class="kobospan" id="kobo.279.1">your app.</span></span></li>
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.280.1">Modularity and scalability</span></strong><span class="kobospan" id="kobo.281.1">: Navigation Compose enables you to build modular navigation graphs, making it easier to scale your app and manage complex </span><span><span class="kobospan" id="kobo.282.1">navigation flows.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.283.1">In summary, Navigation Compose simplifies navigation management, improves the robustness of our app, and will help us to create a more consistent, accessible, and visually appealing </span><span><span class="kobospan" id="kobo.284.1">user experience.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.285.1">To start using Navigation Compose, we must do </span><span><span class="kobospan" id="kobo.286.1">the following:</span></span></p>
<ol class="calibre13">
<li class="calibre14"><span class="kobospan" id="kobo.287.1">First, we need to include the dependencies that are required in our </span><span><span class="kobospan" id="kobo.288.1">Gradle files:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.289.1">
dependencies {
    implementation "androidx.navigation:navigation-
    compose:2.5.3"
}</span></pre></li> </ol>
<p class="callout-heading"><span class="kobospan" id="kobo.290.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.291.1">The version used in the previous code is the latest stable one at the time of writing this book, but there will likely be a new version by the time you are </span><span><span class="kobospan" id="kobo.292.1">reading this.</span></span></p>
<ol class="calibre13">
<li value="2" class="calibre14"><span class="kobospan" id="kobo.293.1">Next, in the </span><strong class="source-inline1"><span class="kobospan" id="kobo.294.1">app</span></strong><span class="kobospan" id="kobo.295.1"> module, create a new package called </span><strong class="source-inline1"><span class="kobospan" id="kobo.296.1">ui.navigation</span></strong><span class="kobospan" id="kobo.297.1">. </span><span class="kobospan" id="kobo.297.2">Then, create </span><a id="_idIndexMarker035" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.298.1">a file </span><span><span class="kobospan" id="kobo.299.1">called </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.300.1">WhatsPacktNavigation</span></strong></span><span><span class="kobospan" id="kobo.301.1">.</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.302.1">Now, create a </span><strong class="source-inline1"><span class="kobospan" id="kobo.303.1">NavHost</span></strong><span class="kobospan" id="kobo.304.1"> composable and provide a </span><strong class="source-inline1"><span class="kobospan" id="kobo.305.1">NavController</span></strong><span class="kobospan" id="kobo.306.1"> instance. </span><span class="kobospan" id="kobo.306.2">The </span><strong class="source-inline1"><span class="kobospan" id="kobo.307.1">NavHost</span></strong><span class="kobospan" id="kobo.308.1"> composable functions as a container for managing navigation between different composables in an app. </span><span class="kobospan" id="kobo.308.2">It acts as the central hub where navigation routes are defined and composables are switched in and out based on the navigation state. </span><span class="kobospan" id="kobo.308.3">Each screen or view in your application corresponds to a composable that </span><strong class="source-inline1"><span class="kobospan" id="kobo.309.1">NavHost</span></strong><span class="kobospan" id="kobo.310.1"> can display. </span><span class="kobospan" id="kobo.310.2">Here, we will start by creating the </span><strong class="source-inline1"><span class="kobospan" id="kobo.311.1">WhatsPacktNavigation</span></strong><span class="kobospan" id="kobo.312.1"> composable function. </span><span class="kobospan" id="kobo.312.2">This will be responsible for </span><span><span class="kobospan" id="kobo.313.1">holding </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.314.1">NavHost</span></strong></span><span><span class="kobospan" id="kobo.315.1">:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.316.1">
import androidx.compose.runtime.Composable
import androidx.navigation.compose.NavHost
import
androidx.navigation.compose.rememberNavController
@Composable
fun WhatsPacktNavigation() {
    val navController = rememberNavController()
    NavHost(navController = navController,
    startDestination = "start_screen") {
        // Add composable destinations here
    }
}</span></pre></li> <li class="calibre14"><span class="kobospan" id="kobo.317.1">Once we’ve created the first screen (which we’ll call </span><strong class="source-inline1"><span class="kobospan" id="kobo.318.1">MainScreen</span></strong><span class="kobospan" id="kobo.319.1">), we will complete </span><strong class="source-inline1"><span class="kobospan" id="kobo.320.1">NavHost</span></strong><span class="kobospan" id="kobo.321.1">, </span><span><span class="kobospan" id="kobo.322.1">as follows:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.323.1">
    NavHost(navController = navController,
    startDestination = "start_screen") {
        composable("start_screen") {
        MainScreen(navController) }
    }</span></pre></li> <li class="calibre14"><span class="kobospan" id="kobo.324.1">We can also</span><a id="_idIndexMarker036" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.325.1"> include dynamic parameters in the route, </span><span><span class="kobospan" id="kobo.326.1">like so:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.327.1">
NavHost(
    navController = navController,
    startDestination = "start_screen"
) {
    composable("start_screen") {
        MainScreen(navController) }
    composable("chat/{chatId}") { backStackEntry -&gt;
        val chatId =
            backStackEntry.arguments?.getString(
                "chatId")
        ChatScreen(navController, chatId)
    }
}</span></pre><p class="calibre3"><span class="kobospan" id="kobo.328.1">Here, we have a second composable that defines another navigation destination associated with the </span><strong class="source-inline"><span class="kobospan" id="kobo.329.1">"chat/{chatId}"</span></strong><span class="kobospan" id="kobo.330.1"> route. </span><span class="kobospan" id="kobo.330.2">The </span><strong class="source-inline"><span class="kobospan" id="kobo.331.1">{chatId}</span></strong><span class="kobospan" id="kobo.332.1"> part is a dynamic parameter that can be passed when navigating to </span><span><span class="kobospan" id="kobo.333.1">this destination.</span></span></p></li> </ol>
<p class="calibre3"><span class="kobospan" id="kobo.334.1">Using these two configurations – that is, navigation with and without parameters – should have us covered but since we are using feature-based modularization, we might encounter the problem of having to navigate from one module to another where there isn’t a direct dependency between them. </span><span class="kobospan" id="kobo.334.2">In those cases, we will use </span><span><span class="kobospan" id="kobo.335.1">deep links.</span></span></p>
<p class="calibre3"><strong class="bold"><span class="kobospan" id="kobo.336.1">Deep linking</span></strong><span class="kobospan" id="kobo.337.1"> allows </span><a id="_idIndexMarker037" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.338.1">users to navigate to specific screens or actions within your app using URLs. </span><span class="kobospan" id="kobo.338.2">When defining your composable destinations within </span><strong class="source-inline"><span class="kobospan" id="kobo.339.1">NavHost</span></strong><span class="kobospan" id="kobo.340.1">, you need to add a </span><strong class="source-inline"><span class="kobospan" id="kobo.341.1">deepLink</span></strong><span class="kobospan" id="kobo.342.1"> parameter with the URI pattern you want to use for that destination. </span><span class="kobospan" id="kobo.342.2">This pattern should include </span><a id="_idIndexMarker038" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.343.1">a scheme, a host, and an optional path. </span><span class="kobospan" id="kobo.343.2">In our example, if we have </span><strong class="source-inline"><span class="kobospan" id="kobo.344.1">ChatScreen</span></strong><span class="kobospan" id="kobo.345.1">, which takes a </span><strong class="source-inline"><span class="kobospan" id="kobo.346.1">chatId</span></strong><span class="kobospan" id="kobo.347.1"> argument, we can add a deep link </span><strong class="source-inline"><span class="kobospan" id="kobo.348.1">URI</span></strong> <span><span class="kobospan" id="kobo.349.1">like this:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.350.1">
NavHost(
    navController = navController,
    startDestination = "start_screen")
{
    composable("start_screen") { MainScreen(navController)
    }
    composable(
        route = "chat?id={id}",
        deepLinks = listOf(navDeepLink { uriPattern =
            "whatspackt://chat/{id}" })
    ) { backStackEntry -&gt;
        ChatScreen(
            navController,
            backStackEntry.arguments?.getString("id"))
    }
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.351.1">One common practice to keep our </span><strong class="source-inline"><span class="kobospan" id="kobo.352.1">NavHost</span></strong><span class="kobospan" id="kobo.353.1"> leaner and delegate the definition of routes and URIs to</span><a id="_idIndexMarker039" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.354.1"> every screen is to define the route with constants. </span><span class="kobospan" id="kobo.354.2">Here is </span><span><span class="kobospan" id="kobo.355.1">an example:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.356.1">
@Composable
fun ChatScreen(
    ...
</span><span class="kobospan1" id="kobo.356.2">) {
    object {
        val uri = "whatspackt://chat/{id}"
        val name = "chat?id={id}"
    }
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.357.1">By doing this, developers can easily manage, update, and maintain the routes in a </span><span><span class="kobospan" id="kobo.358.1">centralized manner.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.359.1">Then, in </span><strong class="source-inline"><span class="kobospan" id="kobo.360.1">NavHost</span></strong><span class="kobospan" id="kobo.361.1">, we would define </span><strong class="source-inline"><span class="kobospan" id="kobo.362.1">uriPattern</span></strong><span class="kobospan" id="kobo.363.1"> using </span><span><span class="kobospan" id="kobo.364.1">these constants:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.365.1">
composable(
    route = NavRoutes.Chat,
    arguments = listOf(
        navArgument(NavRoutes.ChatArgs.ChatId) {
            type = NavType.StringType
        }
    )
) { backStackEntry -&gt;
    val chatId = backStackEntry.arguments?.getString(
        NavRoutes.ChatArgs.ChatId)
    ChatScreen(chatId = chatId, onBack = {
        navController.popBackStack() })
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.366.1">Instead of adding this information to every screen, a better option is to create a class where we are going to put all the </span><span><span class="kobospan" id="kobo.367.1">route constants:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.368.1">
object NavRoutes {
    const val ConversationsList = "conversations_list"
    const val NewConversation = "create_conversation"
    const val Chat = "chat/{chatId}"
    object ChatArgs {
        const val ChatId = "chatId"
    }
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.369.1">Having the route’s </span><a id="_idIndexMarker040" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.370.1">definition in the same place will facilitate reading and maintaining our code so that we can easily manage, update, and maintain the routes in a centralized manner, while also improving code readability and reducing the possibility of errors caused by hardcoded or duplicated strings throughout the </span><span><span class="kobospan" id="kobo.371.1">code base.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.372.1">We will place the file that contains this class in our </span><strong class="source-inline"><span class="kobospan" id="kobo.373.1">:common:framework</span></strong><span class="kobospan" id="kobo.374.1"> module as we will need to access those constants from every feature module. </span><span class="kobospan" id="kobo.374.2">Another common practice is to create a dedicated </span><strong class="source-inline"><span class="kobospan" id="kobo.375.1">:common:navigation</span></strong><span class="kobospan" id="kobo.376.1"> module and add the definition of the route and even the </span><strong class="source-inline"><span class="kobospan" id="kobo.377.1">NavHost</span></strong><span class="kobospan" id="kobo.378.1"> definition there. </span><span class="kobospan" id="kobo.378.2">In our case, we will define the routes using the latest approach – that is, </span><span><span class="kobospan" id="kobo.379.1">route constants:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.380.1">
package com.packt.whatspackt.ui.navigation
import androidx.compose.runtime.Composable
import androidx.navigation.NavGraphBuilder
import androidx.navigation.NavHostController
import androidx.navigation.NavType
import androidx.navigation.compose.NavHost
import androidx.navigation.compose.composable
import com.packt.feature.chat.ui.ChatScreen
import androidx.navigation.navArgument
import com.packt.framework.navigation.NavRoutes
@Composable
fun MainNavigation(navController: NavHostController) {
    NavHost(
        navController,
        startDestination = NavRoutes.ConversationsList)
    {
        addConversationsList(navController)
        addNewConversation(navController)
        addChat(navController)
    }
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.381.1">In the preceding code, we completed our </span><span><strong class="source-inline"><span class="kobospan" id="kobo.382.1">NavHost</span></strong></span><span><span class="kobospan" id="kobo.383.1"> definition.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.384.1">In our app, we will want to navigate to three different parts of the app (conversations list, create new chat, and the single chat screen). </span><span class="kobospan" id="kobo.384.2">The navigation destinations can be added to </span><strong class="source-inline"><span class="kobospan" id="kobo.385.1">NavHost</span></strong><span class="kobospan" id="kobo.386.1"> by using extension functions on </span><strong class="source-inline"><span class="kobospan" id="kobo.387.1">NavGraphBuilder</span></strong><span class="kobospan" id="kobo.388.1">. </span><span class="kobospan" id="kobo.388.2">These extension</span><a id="_idIndexMarker041" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.389.1"> functions are defined </span><span><span class="kobospan" id="kobo.390.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.391.1">
private fun NavGraphBuilder.addConversationsList(
    navController: NavHostController
) {
    composable(NavRoutes.ConversationsList) {
        ConversationsListScreen(
            onNewConversationClick = {
                navController.navigate(
                    NavRoutes.NewConversation)
            },
            onConversationClick = { chatId -&gt;
                navController.navigate(
                NavRoutes.Chat.replace("{chatId}", chatId))
            }
        )
    }
}
private fun NavGraphBuilder.addNewConversation(
navController: NavHostController) {
    composable(NavRoutes.NewConversation) {
        CreateConversationScreen(onCreateConversation = {
            navController.navigate(NavRoutes.Chat)
        })
    }
}
private fun NavGraphBuilder.addChat(navController:
NavHostController) {
    composable(
        route = NavRoutes.Chat,
        arguments = listOf(navArgument(
        NavRoutes.ChatArgs.ChatId) {
            type = NavType.StringType
        })
    ) { backStackEntry -&gt;
        val chatId = backStackEntry.arguments?.getString(
            NavRoutes.ChatArgs.ChatId)
        ChatScreen(chatId = chatId, onBack = {
            navController.popBackStack() })
    }
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.392.1">Here, </span><strong class="source-inline"><span class="kobospan" id="kobo.393.1">addConversationsList(navController)</span></strong><span class="kobospan" id="kobo.394.1"> sets up </span><strong class="source-inline"><span class="kobospan" id="kobo.395.1">ConversationsListScreen</span></strong><span class="kobospan" id="kobo.396.1"> and </span><a id="_idIndexMarker042" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.397.1">defines click listeners for navigating to the </span><strong class="source-inline"><span class="kobospan" id="kobo.398.1">NewConversation</span></strong><span class="kobospan" id="kobo.399.1"> and </span><span><strong class="source-inline"><span class="kobospan" id="kobo.400.1">Chat</span></strong></span><span><span class="kobospan" id="kobo.401.1"> destinations.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.402.1">Then, </span><strong class="source-inline"><span class="kobospan" id="kobo.403.1">addNewConversation(navController)</span></strong><span class="kobospan" id="kobo.404.1"> sets up </span><strong class="source-inline"><span class="kobospan" id="kobo.405.1">CreateConversationScreen</span></strong><span class="kobospan" id="kobo.406.1"> and defines a click listener for navigating to the </span><strong class="source-inline"><span class="kobospan" id="kobo.407.1">Chat</span></strong><span class="kobospan" id="kobo.408.1"> destination upon creating a </span><span><span class="kobospan" id="kobo.409.1">new conversation.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.410.1">Finally, </span><strong class="source-inline"><span class="kobospan" id="kobo.411.1">addChat(navController)</span></strong><span class="kobospan" id="kobo.412.1"> sets up </span><strong class="source-inline"><span class="kobospan" id="kobo.413.1">ChatScreen</span></strong><span class="kobospan" id="kobo.414.1"> and extracts the </span><strong class="source-inline"><span class="kobospan" id="kobo.415.1">chatId</span></strong><span class="kobospan" id="kobo.416.1"> argument from </span><strong class="source-inline"><span class="kobospan" id="kobo.417.1">backStackEntry</span></strong><span class="kobospan" id="kobo.418.1">. </span><span class="kobospan" id="kobo.418.2">It also defines a click listener for navigating back to the previous screen </span><span><span class="kobospan" id="kobo.419.1">using </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.420.1">navController.popBackStack()</span></strong></span><span><span class="kobospan" id="kobo.421.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.422.1">Now, we are almost ready to hit the </span><strong class="bold"><span class="kobospan" id="kobo.423.1">Run</span></strong><span class="kobospan" id="kobo.424.1"> button for the first time. </span><span class="kobospan" id="kobo.424.2">But first, to avoid compilation problems, we should create the screen’s composables in their </span><span><span class="kobospan" id="kobo.425.1">respective modules:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.426.1">ConversationsListScreen</span></strong> <span><span class="kobospan" id="kobo.427.1">in </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.428.1">:feature:conversations</span></strong></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.429.1">CreateConversationScreen</span></strong> <span><span class="kobospan" id="kobo.430.1">in </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.431.1">:feature:create_chat</span></strong></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.432.1">ChatScreen</span></strong> <span><span class="kobospan" id="kobo.433.1">in </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.434.1">:feature:chat</span></strong></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.435.1">For example, we </span><a id="_idIndexMarker043" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.436.1">can create </span><strong class="source-inline"><span class="kobospan" id="kobo.437.1">ChatScreen</span></strong><span class="kobospan" id="kobo.438.1"> and leave it </span><span><span class="kobospan" id="kobo.439.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.440.1">
package com.packt.feature.chat.ui
import androidx.compose.runtime.Composable
@Composable
fun ChatScreen(
    chatId: String?,
    onBack: () -&gt; Unit
) {
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.441.1">We are missing one last change (for now). </span><span class="kobospan" id="kobo.441.2">We need to include the </span><strong class="source-inline"><span class="kobospan" id="kobo.442.1">MainNavigation</span></strong><span class="kobospan" id="kobo.443.1"> composable as the content </span><span><span class="kobospan" id="kobo.444.1">in </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.445.1">MainActivity</span></strong></span><span><span class="kobospan" id="kobo.446.1">:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.447.1">
class MainActivity : ComponentActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContent {
            WhatsPacktTheme {
                val navHostController =
                    rememberNavController()
                MainNavigation(navController =
                    navHostController)
            }
        }
    }
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.448.1">As we can see, we’ve added </span><strong class="source-inline"><span class="kobospan" id="kobo.449.1">navHostController</span></strong><span class="kobospan" id="kobo.450.1">, which we created </span><span><span class="kobospan" id="kobo.451.1">using </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.452.1">rememberNav</span></strong></span><strong class="source-inline"><span class="kobospan" id="kobo.453.1">
Controller()</span></strong><span class="kobospan" id="kobo.454.1">. </span><span class="kobospan" id="kobo.454.2">This is used to remember the navigation state across recompositions. </span><span class="kobospan" id="kobo.454.3">Here, </span><strong class="source-inline"><span class="kobospan" id="kobo.455.1">navHostController</span></strong><span class="kobospan" id="kobo.456.1"> manages the navigation between different composables in the application. </span><span class="kobospan" id="kobo.456.2">Then, the </span><strong class="source-inline"><span class="kobospan" id="kobo.457.1">MainNavigation</span></strong><span class="kobospan" id="kobo.458.1"> composable is called </span><span><span class="kobospan" id="kobo.459.1">with </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.460.1">navHostController</span></strong></span><span><span class="kobospan" id="kobo.461.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.462.1">So far, we have chosen and created the module structure for our app, chosen a dependency injection framework, added the dependencies we need, and structured the navigation that </span><a id="_idIndexMarker044" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.463.1">defines how our screens are going to be accessed. </span><span class="kobospan" id="kobo.463.2">Now, it’s time for us to start working on each of the screens we need to build </span><span><span class="kobospan" id="kobo.464.1">this app.</span></span></p>
<h1 id="_idParaDest-22" class="calibre5"><a id="_idTextAnchor022" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.465.1">Building the main screen</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.466.1">Now that we have</span><a id="_idIndexMarker045" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.467.1"> the main structure of our app ready, it is time to start building the </span><span><span class="kobospan" id="kobo.468.1">main screen.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.469.1">Let’s analyze what components our main screen </span><span><span class="kobospan" id="kobo.470.1">will have:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer016">
<span class="kobospan" id="kobo.471.1"><img alt="Figure 1.9: The ConversationsList screen" src="image/B19443_01_9.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.472.1">Figure 1.9: The ConversationsList screen</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.473.1">As you can see, we </span><a id="_idIndexMarker046" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.474.1">are going to include </span><span><span class="kobospan" id="kobo.475.1">the following:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><span class="kobospan" id="kobo.476.1">A </span><span><span class="kobospan" id="kobo.477.1">top bar</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.478.1">A tab bar to navigate to the main sections (note that this book will only cover the development of the chat section; we will not cover the status and </span><span><span class="kobospan" id="kobo.479.1">calls sections)</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.480.1">A list containing the current conversations (which we will complete later in </span><span><span class="kobospan" id="kobo.481.1">this chapter)</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.482.1">A floating button to create a </span><span><span class="kobospan" id="kobo.483.1">new chat</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.484.1">Let’s start with</span><a id="_idIndexMarker047" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.485.1"> the </span><span><span class="kobospan" id="kobo.486.1">main screen.</span></span></p>
<h2 id="_idParaDest-23" class="calibre7"><a id="_idTextAnchor023" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.487.1">Adding a scaffold to the main screen</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.488.1">Previously, we</span><a id="_idIndexMarker048" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.489.1"> created an empty version </span><a id="_idIndexMarker049" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.490.1">of the first screen (</span><strong class="source-inline"><span class="kobospan" id="kobo.491.1">ConversationsListScreen</span></strong><span class="kobospan" id="kobo.492.1">), </span><span><span class="kobospan" id="kobo.493.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.494.1">
package com.packt.feature.conversations.ui
import androidx.compose.runtime.Composable
@Composable
fun ConversationsListScreen(
    onNewConversationClick: () -&gt; Unit,
    onConversationClick: (chatId: String) -&gt; Unit
) {
// We will add here the ConversactionsListScreen components
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.495.1">Now, it’s time to start working on this screen. </span><span class="kobospan" id="kobo.495.2">The first component we are going to add is a </span><strong class="bold"><span class="kobospan" id="kobo.496.1">scaffold</span></strong><span class="kobospan" id="kobo.497.1">. </span><span class="kobospan" id="kobo.497.2">This is a composable that provides a basic structure for your app’s UI. </span><span class="kobospan" id="kobo.497.3">It helps you create a consistent layout by providing slots for common UI elements, such as a top app bar, a bottom app bar, a navigation drawer, a floating action button, and content. </span><span class="kobospan" id="kobo.497.4">By using </span><strong class="source-inline"><span class="kobospan" id="kobo.498.1">Scaffold</span></strong><span class="kobospan" id="kobo.499.1">, you can easily organize your app’s layout and maintain a consistent look and feel across </span><span><span class="kobospan" id="kobo.500.1">different screens.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.501.1">Here’s a brief overview of the main components </span><span><span class="kobospan" id="kobo.502.1">of </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.503.1">Scaffold</span></strong></span><span><span class="kobospan" id="kobo.504.1">:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.505.1">topBar</span></strong><span class="kobospan" id="kobo.506.1">: A slot for placing a top app bar, typically used for displaying the app’s title and navigation icons. </span><span class="kobospan" id="kobo.506.2">You can use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.507.1">TopAppBar</span></strong><span class="kobospan" id="kobo.508.1"> composable to create a top </span><span><span class="kobospan" id="kobo.509.1">app bar.</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.510.1">bottomBar</span></strong><span class="kobospan" id="kobo.511.1">: A slot for placing a bottom app bar, typically used for actions, navigation tabs, or a bottom navigation bar. </span><span class="kobospan" id="kobo.511.2">You can use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.512.1">BottomAppBar</span></strong><span class="kobospan" id="kobo.513.1"> or </span><strong class="source-inline1"><span class="kobospan" id="kobo.514.1">TabRow</span></strong><span class="kobospan" id="kobo.515.1"> composable to create a bottom </span><span><span class="kobospan" id="kobo.516.1">app bar.</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.517.1">drawerContent</span></strong><span class="kobospan" id="kobo.518.1">: A slot for placing a navigation drawer, which is a panel that displays the app’s navigation options. </span><span class="kobospan" id="kobo.518.2">You can use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.519.1">Drawer</span></strong><span class="kobospan" id="kobo.520.1"> or </span><strong class="source-inline1"><span class="kobospan" id="kobo.521.1">ModalDrawer</span></strong><span class="kobospan" id="kobo.522.1"> composable to create a </span><span><span class="kobospan" id="kobo.523.1">navigation drawer.</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.524.1">floatingActionButton</span></strong><span class="kobospan" id="kobo.525.1">: A slot for placing a floating action button, which is a circular button that hovers above the content and represents the primary action of the screen. </span><span class="kobospan" id="kobo.525.2">You can use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.526.1">FloatingActionButton</span></strong><span class="kobospan" id="kobo.527.1"> composable to create a floating </span><span><span class="kobospan" id="kobo.528.1">action button.</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.529.1">content</span></strong><span class="kobospan" id="kobo.530.1">: A slot for placing the main content of the screen, which can be any composable that displays the app’s data or </span><span><span class="kobospan" id="kobo.531.1">UI elements.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.532.1">In our case, we are going to use </span><strong class="source-inline"><span class="kobospan" id="kobo.533.1">topBar</span></strong><span class="kobospan" id="kobo.534.1">, </span><strong class="source-inline"><span class="kobospan" id="kobo.535.1">bottomBar</span></strong><span class="kobospan" id="kobo.536.1"> with </span><strong class="source-inline"><span class="kobospan" id="kobo.537.1">TabRow</span></strong><span class="kobospan" id="kobo.538.1"> (to navigate between tabs), </span><strong class="source-inline"><span class="kobospan" id="kobo.539.1">floatingActionButton</span></strong><span class="kobospan" id="kobo.540.1"> (to create new chats), and the content, where we are </span><a id="_idIndexMarker050" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.541.1">going to place our main content – in </span><a id="_idIndexMarker051" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.542.1">our case, the list </span><span><span class="kobospan" id="kobo.543.1">of conversations.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.544.1">Let’s create the </span><strong class="source-inline"><span class="kobospan" id="kobo.545.1">Scaffold</span></strong><span class="kobospan" id="kobo.546.1"> composable in our </span><strong class="source-inline"><span class="kobospan" id="kobo.547.1">ConversationsListScreen</span></strong><span class="kobospan" id="kobo.548.1">. </span><span class="kobospan" id="kobo.548.2">We will add the modifiers for all the components we want to include, but we’ll leave them empty (</span><span><span class="kobospan" id="kobo.549.1">for now):</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.550.1">
@Composable
fun ConversationsListScreen(
    onNewConversationClick: () -&gt; Unit,
    onConversationClick: (chatId: String) -&gt; Unit
) {
    Scaffold(
        topBar = { /* TopAppBar code */ },
        bottomBar = { /* TabRow code */ },
        floatingActionButton =
            { /* FloatingActionButton code */ }
    ) {
        /* Content code */
    }
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.551.1">The </span><strong class="source-inline"><span class="kobospan" id="kobo.552.1">Scaffold</span></strong><span class="kobospan" id="kobo.553.1"> composable we have created includes </span><strong class="source-inline"><span class="kobospan" id="kobo.554.1">topBar</span></strong><span class="kobospan" id="kobo.555.1">, </span><span><strong class="source-inline"><span class="kobospan" id="kobo.556.1">bottomBar</span></strong></span><span><span class="kobospan" id="kobo.557.1">, </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.558.1">floatingAction</span></strong></span><strong class="source-inline"><span class="kobospan" id="kobo.559.1">
Button</span></strong><span class="kobospan" id="kobo.560.1">, and the content of the main area of the screen. </span><span class="kobospan" id="kobo.560.2">We will continue implementing each of </span><span><span class="kobospan" id="kobo.561.1">those components.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.562.1">Now, depending on your Android Studio version, you may see the </span><span><span class="kobospan" id="kobo.563.1">following error:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer017">
<span class="kobospan" id="kobo.564.1"><img alt="Figure 1.10: An error with the content padding parameter" src="image/B19443_01_10.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.565.1">Figure 1.10: An error with the content padding parameter</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.566.1">This is</span><a id="_idIndexMarker052" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.567.1"> happening</span><a id="_idIndexMarker053" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.568.1"> because the </span><strong class="source-inline"><span class="kobospan" id="kobo.569.1">Scaffold</span></strong><span class="kobospan" id="kobo.570.1"> composable provides a padding parameter to the content Lambda. </span><span class="kobospan" id="kobo.570.2">We will need to take this padding into account when we place the inside components since the scaffold could overlap them if we don’t. </span><span class="kobospan" id="kobo.570.3">For example, in our case, we must consider the padding because otherwise, our content will be kept behind </span><strong class="source-inline"><span class="kobospan" id="kobo.571.1">bottomBar</span></strong><span class="kobospan" id="kobo.572.1">. </span><span class="kobospan" id="kobo.572.2">We will</span><a id="_idIndexMarker054" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.573.1"> use this parameter layer</span><a id="_idIndexMarker055" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.574.1"> when we build </span><span><span class="kobospan" id="kobo.575.1">the content.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.576.1">Now, we will add a </span><strong class="source-inline"><span class="kobospan" id="kobo.577.1">TopAppBar</span></strong><span class="kobospan" id="kobo.578.1"> composable to the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.579.1">Scaffold</span></strong></span><span><span class="kobospan" id="kobo.580.1"> composable.</span></span></p>
<h2 id="_idParaDest-24" class="calibre7"><a id="_idTextAnchor024" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.581.1">Adding the TopAppBar composable to the main screen</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.582.1">The </span><strong class="source-inline"><span class="kobospan" id="kobo.583.1">TopAppBar</span></strong><span class="kobospan" id="kobo.584.1"> composable </span><a id="_idIndexMarker056" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.585.1">represents a toolbar </span><a id="_idIndexMarker057" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.586.1">located at the top of the screen and provides a consistent look and feel across different screens in your app. </span><span class="kobospan" id="kobo.586.2">It typically displays the </span><span><span class="kobospan" id="kobo.587.1">following elements:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.588.1">Title</span></strong><span class="kobospan" id="kobo.589.1">: The main text that’s displayed in the app bar, usually representing the app’s name or the current </span><span><span class="kobospan" id="kobo.590.1">screen’s title</span></span></li>
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.591.1">Navigation icon</span></strong><span class="kobospan" id="kobo.592.1">: An optional icon located at the beginning of the app bar, usually used to open a navigation drawer or navigate back into </span><span><span class="kobospan" id="kobo.593.1">the app</span></span></li>
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.594.1">Actions</span></strong><span class="kobospan" id="kobo.595.1">: A set of optional icons or buttons located at the end of the app bar, representing common actions or settings related to the </span><span><span class="kobospan" id="kobo.596.1">current screen</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.597.1">To add a </span><strong class="source-inline"><span class="kobospan" id="kobo.598.1">TopAppBar</span></strong><span class="kobospan" id="kobo.599.1"> composable, we must create the </span><strong class="source-inline"><span class="kobospan" id="kobo.600.1">conversations_list_title</span></strong><span class="kobospan" id="kobo.601.1"> string in the module’s </span><span><strong class="source-inline"><span class="kobospan" id="kobo.602.1">strings.xml</span></strong></span><span><span class="kobospan" id="kobo.603.1"> file.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.604.1">Then, we are going to create the </span><strong class="source-inline"><span class="kobospan" id="kobo.605.1">TopAppBar</span></strong><span class="kobospan" id="kobo.606.1"> composable while setting the title to </span><strong class="source-inline"><span class="kobospan" id="kobo.607.1">WhatsPackt</span></strong><span class="kobospan" id="kobo.608.1"> and adding </span><strong class="source-inline"><span class="kobospan" id="kobo.609.1">IconButton</span></strong><span class="kobospan" id="kobo.610.1"> with a menu icon. </span><span class="kobospan" id="kobo.610.2">Here, </span><strong class="source-inline"><span class="kobospan" id="kobo.611.1">IconButton</span></strong><span class="kobospan" id="kobo.612.1"> has an </span><strong class="source-inline"><span class="kobospan" id="kobo.613.1">onClick</span></strong><span class="kobospan" id="kobo.614.1"> function where you can define the action to perform when the button </span><span><span class="kobospan" id="kobo.615.1">is clicked:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.616.1">
topBar = {
    TopAppBar(
        title = {
            Text(stringResource(
            R.string.conversations_list_title))
        },
        actions = {
            IconButton(onClick = { /* Menu action */ }) {
                Icon(Icons.Rounded.Menu,
                contentDescription = "Menu")
            }
        }
    )
},</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.617.1">Next, we </span><a id="_idIndexMarker058" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.618.1">are </span><a id="_idIndexMarker059" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.619.1">going to create a </span><span><strong class="source-inline"><span class="kobospan" id="kobo.620.1">TabRow</span></strong></span><span><span class="kobospan" id="kobo.621.1"> composable.</span></span></p>
<h2 id="_idParaDest-25" class="calibre7"><a id="_idTextAnchor025" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.622.1">Adding the TabRow composable to the bottom of the main screen</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.623.1">The </span><strong class="source-inline"><span class="kobospan" id="kobo.624.1">TabRow</span></strong><span class="kobospan" id="kobo.625.1"> composable is</span><a id="_idIndexMarker060" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.626.1"> a horizontal</span><a id="_idIndexMarker061" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.627.1"> row of tabs that allows users to navigate between different views or sections within an app. </span><span class="kobospan" id="kobo.627.2">The </span><strong class="source-inline"><span class="kobospan" id="kobo.628.1">TabRow</span></strong><span class="kobospan" id="kobo.629.1"> composable mainly consists of the </span><span><span class="kobospan" id="kobo.630.1">following elements:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.631.1">Tabs</span></strong><span class="kobospan" id="kobo.632.1">: A collection of individual </span><strong class="source-inline1"><span class="kobospan" id="kobo.633.1">Tab</span></strong><span class="kobospan" id="kobo.634.1"> composables that represent different sections or views within the app. </span><span class="kobospan" id="kobo.634.2">Each </span><strong class="source-inline1"><span class="kobospan" id="kobo.635.1">Tab</span></strong><span class="kobospan" id="kobo.636.1"> composable can have a text label, an icon, or both to describe </span><span><span class="kobospan" id="kobo.637.1">its content.</span></span></li>
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.638.1">Selected tab indicator</span></strong><span class="kobospan" id="kobo.639.1">: A visual indicator that highlights the currently selected tab, making it easy for users to understand which section they </span><span><span class="kobospan" id="kobo.640.1">are viewing.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.641.1">Before creating the </span><strong class="source-inline"><span class="kobospan" id="kobo.642.1">TabRow</span></strong><span class="kobospan" id="kobo.643.1"> composable, we’ll have to provide a list and the tabs it is going </span><span><span class="kobospan" id="kobo.644.1">to contain:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.645.1">
@Composable
fun ConversationsListScreen(
    onNewConversationClick: () -&gt; Unit,
    onConversationClick: (chatId: String) -&gt; Unit
) {
    val tabs = listOf("Status", "Chats", "Calls")
    Scaffold(
        topBar = {
...</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.646.1">Then, we can </span><span><span class="kobospan" id="kobo.647.1">add </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.648.1">TabRow</span></strong></span><span><span class="kobospan" id="kobo.649.1">:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.650.1">
bottomBar = {
    TabRow(selectedTabIndex = 1) {
        tabs.forEachIndexed { index, tab -&gt;
            Tab(
                text = { Text(tab) },
                selected = index == 1,
                onClick = { /* Navigation action */ }
            )
        }
    }
},</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.651.1">For every row, we are adding a </span><strong class="source-inline"><span class="kobospan" id="kobo.652.1">Tab</span></strong><span class="kobospan" id="kobo.653.1"> composable, where we indicate the title (using a </span><strong class="source-inline"><span class="kobospan" id="kobo.654.1">Text</span></strong><span class="kobospan" id="kobo.655.1"> composable), the selected value when the tab is selected, and the </span><strong class="source-inline"><span class="kobospan" id="kobo.656.1">onClick</span></strong><span class="kobospan" id="kobo.657.1"> action (which we are </span><span><span class="kobospan" id="kobo.658.1">not implementing).</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.659.1">After that, we</span><a id="_idIndexMarker062" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.660.1"> can make </span><a id="_idIndexMarker063" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.661.1">our code more readable by creating a data class to store the title of the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.662.1">Tab</span></strong></span><span><span class="kobospan" id="kobo.663.1"> composable:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.664.1">
data class ConversationsListTab(
    @StringRes val title: Int
)
fun generateTabs(): List&lt;ConversationsListTab&gt; {
    return listOf(
        ConversationsListTab(
            title = R.string.conversations_tab_status_title
        ),
        ConversationsListTab(
            title = R.string.conversations_tab_chats_title
        ),
        ConversationsListTab(
            title = R.string.conversations_tab_calls_title
        ),
    )
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.665.1">Then, we can </span><a id="_idIndexMarker064" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.666.1">change our </span><span><strong class="source-inline"><span class="kobospan" id="kobo.667.1">TabRow</span></strong></span><span><span class="kobospan" id="kobo.668.1"> code:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.669.1">
bottomBar = {
    TabRow(selectedTabIndex = 1) {
        tabs.forEachIndexed { index, _ -&gt;
            Tab(
                text = { Text(stringResource(
                    tabs[index].title)) },
                selected = index == 1,
                onClick = {
                    // Navigate to every tab content
                }
            )
        }
    }
}</span></pre> <p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.670.1">TabRow</span></strong><span class="kobospan" id="kobo.671.1"> composables </span><a id="_idIndexMarker065" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.672.1">are usually</span><a id="_idIndexMarker066" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.673.1"> combined with a pager, where the content will be shown. </span><span class="kobospan" id="kobo.673.2">When clicking and navigating between tabs, the main content that’s displayed </span><span><span class="kobospan" id="kobo.674.1">should change.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.675.1">Now, let’s add the pager to our </span><span><span class="kobospan" id="kobo.676.1">screen content.</span></span></p>
<h2 id="_idParaDest-26" class="calibre7"><a id="_idTextAnchor026" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.677.1">Adding a pager</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.678.1">A pager is a UI </span><a id="_idIndexMarker067" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.679.1">component that allows users to </span><a id="_idIndexMarker068" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.680.1">swipe through multiple pages or screens horizontally or vertically. </span><span class="kobospan" id="kobo.680.2">It is commonly used to display screens or views in a </span><span><span class="kobospan" id="kobo.681.1">carousel-like fashion.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.682.1">We are going to use </span><strong class="source-inline"><span class="kobospan" id="kobo.683.1">HorizontalPager</span></strong><span class="kobospan" id="kobo.684.1">, which, as its name suggests, allows the user to horizontally swipe between screens or composables. </span><span class="kobospan" id="kobo.684.2">One of its main advantages is that it will not create all pages at once; it will only create the current page and the immediate previous/next pages, which will be off-screen. </span><span class="kobospan" id="kobo.684.3">Once a page is out of this three-page window, it will </span><span><span class="kobospan" id="kobo.685.1">be removed.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.686.1">To do so, we are going to have to tweak some of the previous code we had in </span><span><span class="kobospan" id="kobo.687.1">our </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.688.1">Conversations</span></strong></span><strong class="source-inline">
</strong><span><strong class="source-inline"><span class="kobospan" id="kobo.689.1">ListScreen</span></strong></span><span><span class="kobospan" id="kobo.690.1"> composable:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.691.1">
@OptIn(ExperimentalFoundationApi::class)
@Composable
fun ConversationsListScreen(
    onNewConversationClick: () -&gt; Unit,
    onConversationClick: (chatId: String) -&gt; Unit
) {
    val tabs = generateTabs()
    val selectedIndex = remember { mutableStateOf(1) }
    val pagerState = rememberPagerState(initialPage = 1)
    …
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.692.1">First, since </span><strong class="source-inline"><span class="kobospan" id="kobo.693.1">HorizontalPager</span></strong><span class="kobospan" id="kobo.694.1"> is part of the foundation API and is (at the time of writing) an experimental API (which means that it could change its public interface in the future), we need to add the </span><strong class="source-inline"><span class="kobospan" id="kobo.695.1">@</span></strong><span><strong class="source-inline"><span class="kobospan" id="kobo.696.1">OptIn(ExperimentalFoundationApi::class)</span></strong></span><span><span class="kobospan" id="kobo.697.1"> annotation.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.698.1">Second, we have added a new field called </span><strong class="source-inline"><span class="kobospan" id="kobo.699.1">pagerState</span></strong><span class="kobospan" id="kobo.700.1">. </span><span class="kobospan" id="kobo.700.2">Its responsibility is to hold the state of the pager, including information about the number of pages, the current page, the scrolling position, and the </span><span><span class="kobospan" id="kobo.701.1">scrolling behavior.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.702.1">Next, we will</span><a id="_idIndexMarker069" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.703.1"> add </span><strong class="source-inline"><span class="kobospan" id="kobo.704.1">HorizontalPager</span></strong><span class="kobospan" id="kobo.705.1"> to</span><a id="_idIndexMarker070" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.706.1"> the content function, </span><span><span class="kobospan" id="kobo.707.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.708.1">
content = { innerPadding -&gt;
    HorizontalPager(
    modifier = Modifier.padding(innerPadding),
    pageCount = tabs.size,
    state = pagerState
) { index -&gt;
    when (index) {
        0 -&gt; {
            //Status
        }
        1 -&gt; {
            ConversationList(
                conversations = emptyList(),
                onConversationClick = onConversationClick
            )
        }
        2-&gt; {
            // Calls
        }
    }
}
    LaunchedEffect(selectedIndex.value) {
        pagerState.animateScrollToPage(selectedIndex.value)
    }
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.709.1">Here, we will be using a </span><strong class="source-inline"><span class="kobospan" id="kobo.710.1">LaunchedEffect</span></strong><span class="kobospan" id="kobo.711.1"> function. </span><span class="kobospan" id="kobo.711.2">This function is used to manage side effects, such as launching tasks that have been completed asynchronously in the context of a composable hierarchy. </span><span class="kobospan" id="kobo.711.3">Side effects are operations that can have an impact outside of the composable function itself, such as network requests, database operations, or, in the case of the previous example, scrolling to a specific page in </span><span><span class="kobospan" id="kobo.712.1">a pager.</span></span></p>
<p class="calibre3"><strong class="source-inline"><span class="kobospan" id="kobo.713.1">LaunchedEffect</span></strong><span class="kobospan" id="kobo.714.1"> takes a key (or a set of keys) as its first parameter. </span><span class="kobospan" id="kobo.714.2">When the key changes, the effect will be re-launched, canceling any ongoing work from the previous effect. </span><span class="kobospan" id="kobo.714.3">The second parameter is a suspending Lambda function, which will be executed in the effect’s </span><span><span class="kobospan" id="kobo.715.1">coroutine scope.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.716.1">The main advantage of using </span><strong class="source-inline"><span class="kobospan" id="kobo.717.1">LaunchedEffect</span></strong><span class="kobospan" id="kobo.718.1"> is that it integrates well with the Compose life cycle. </span><span class="kobospan" id="kobo.718.2">When the composable that called </span><strong class="source-inline"><span class="kobospan" id="kobo.719.1">LaunchedEffect</span></strong><span class="kobospan" id="kobo.720.1"> leaves the composition, the effect will be automatically canceled, cleaning up any </span><span><span class="kobospan" id="kobo.721.1">ongoing work.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.722.1">Coming back to our code, in our case, we are changing the current page in </span><strong class="source-inline"><span class="kobospan" id="kobo.723.1">pagerState</span></strong><span class="kobospan" id="kobo.724.1"> and animating the scroll to the next selected page. </span><span class="kobospan" id="kobo.724.2">This will be triggered every time </span><strong class="source-inline"><span class="kobospan" id="kobo.725.1">selectedIndex.value</span></strong> <span><span class="kobospan" id="kobo.726.1">is changed.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.727.1">The next </span><a id="_idIndexMarker071" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.728.1">component</span><a id="_idIndexMarker072" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.729.1"> will allow the user to create a new chat – we will create this button using a </span><span><strong class="source-inline"><span class="kobospan" id="kobo.730.1">FloatingActionButton</span></strong></span><span><span class="kobospan" id="kobo.731.1"> composable.</span></span></p>
<h2 id="_idParaDest-27" class="calibre7"><a id="_idTextAnchor027" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.732.1">Adding the FloatingActionButton composable</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.733.1">The </span><strong class="source-inline"><span class="kobospan" id="kobo.734.1">FloatingActionButton</span></strong><span class="kobospan" id="kobo.735.1"> composable is a Material Design composable that represents a</span><a id="_idIndexMarker073" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.736.1"> circular button </span><a id="_idIndexMarker074" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.737.1">floating above the UI. </span><span class="kobospan" id="kobo.737.2">It’s typically used to promote the primary action in an application (for example, adding a new item, composing a message, or starting a new process). </span><span class="kobospan" id="kobo.737.3">Following the Material Design guidelines (you can check them here: </span><a href="https://m3.material.io/" class="calibre6 pcalibre1 pcalibre"><span class="kobospan" id="kobo.738.1">https://m3.material.io/</span></a><span class="kobospan" id="kobo.739.1">), we are going to use it to create a new chat </span><span><span class="kobospan" id="kobo.740.1">from </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.741.1">ConversationsListScreen</span></strong></span><span><span class="kobospan" id="kobo.742.1">:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.743.1">
floatingActionButton = {
    FloatingActionButton(
        onClick = { onNewConversationClick() }
    ) {
        Icon(
            imageVector = Icons.Default.Add,
            contentDescription = "Add"
        )
    }
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.744.1">Our </span><strong class="source-inline"><span class="kobospan" id="kobo.745.1">FloatingActionButton</span></strong><span class="kobospan" id="kobo.746.1"> composable is taking an </span><strong class="source-inline"><span class="kobospan" id="kobo.747.1">onClick</span></strong><span class="kobospan" id="kobo.748.1"> modifier. </span><span class="kobospan" id="kobo.748.2">Here, we will include the code </span><a id="_idIndexMarker075" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.749.1">to navigate to the create chat screen. </span><span class="kobospan" id="kobo.749.2">Inside this button, we have included an </span><strong class="source-inline"><span class="kobospan" id="kobo.750.1">Icon</span></strong><span class="kobospan" id="kobo.751.1"> composable, which we are using as an image of one of the </span><strong class="source-inline"><span class="kobospan" id="kobo.752.1">Icons.Default</span></strong> <span><span class="kobospan" id="kobo.753.1">predefined images.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.754.1">At this point, our conversations list screen should look similar </span><span><span class="kobospan" id="kobo.755.1">to this:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer018">
<span class="kobospan" id="kobo.756.1"><img alt="Figure 1.11: The conversations list screen with a top bar, tab bar, and floating action button" src="image/B19443_01_11.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.757.1">Figure 1.11: The conversations list screen with a top bar, tab bar, and floating action button</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.758.1">With that, we have created our </span><strong class="source-inline"><span class="kobospan" id="kobo.759.1">Scaffold</span></strong><span class="kobospan" id="kobo.760.1"> composable with all the elements we need to help the user navigate. </span><span class="kobospan" id="kobo.760.2">Now, we are ready for the last step (and the most important one) to</span><a id="_idIndexMarker076" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.761.1"> complete </span><a id="_idIndexMarker077" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.762.1">the screen: creating the list of existing conversations. </span><span class="kobospan" id="kobo.762.2">To do that, we are going to start creating a </span><span><span class="kobospan" id="kobo.763.1">conversation item.</span></span></p>
<h1 id="_idParaDest-28" class="calibre5"><a id="_idTextAnchor028" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.764.1">Creating the conversations list</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.765.1">In this section, we </span><a id="_idIndexMarker078" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.766.1">are going to create all the pieces</span><a id="_idIndexMarker079" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.767.1"> we need to show the conversations list. </span><span class="kobospan" id="kobo.767.2">We will start with the UI data model, which will represent the information that the app is going to show in the list, the </span><strong class="source-inline"><span class="kobospan" id="kobo.768.1">Conversation</span></strong><span class="kobospan" id="kobo.769.1"> composable, which will draw every item of the list, and finally the list </span><span><span class="kobospan" id="kobo.770.1">composable itself.</span></span></p>
<h2 id="_idParaDest-29" class="calibre7"><a id="_idTextAnchor029" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.771.1">Modeling the conversation</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.772.1">First, we are going to </span><a id="_idIndexMarker080" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.773.1">model what is going to be the entity we</span><a id="_idIndexMarker081" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.774.1"> will be using through our conversations list components: the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.775.1">Conversation</span></strong></span><span><span class="kobospan" id="kobo.776.1"> model.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.777.1">As part of the conversation model, we want to show the avatar of the other participant (we are just doing one-to-one conversations), their name, the first line of the last message, the time the message was received, and a number indicating how many unread messages </span><span><span class="kobospan" id="kobo.778.1">there are.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.779.1">Taking that information into account, we will start creating a data class to hold the data </span><span><span class="kobospan" id="kobo.780.1">we’ll need:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.781.1">
data class Conversation(
    val id: String,
    val name: String,
    val message: String,
    val timestamp: String,
    val unreadCount: Int,
    val avatar: String
)</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.782.1">As the avatar could be reusable across the app, we are going to create it first. </span><span class="kobospan" id="kobo.782.2">We can include it in the </span><strong class="source-inline"><span class="kobospan" id="kobo.783.1">:common:framework</span></strong><span class="kobospan" id="kobo.784.1"> module so that it is visible and can be reused from the other </span><span><span class="kobospan" id="kobo.785.1">feature modules.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.786.1">Jetpack Compose doesn’t include support to asynchronously load images from a URL out of the box, but there are plenty of third-party libraries that will help us accomplish this. </span><span class="kobospan" id="kobo.786.2">The most popular options are Coil and Glide, which, in terms of performance, caching, and image loading, are quite similar. </span><span class="kobospan" id="kobo.786.3">We are going to use Coil just for simplicity and because it is Kotlin-first (whereas Glide is programmed </span><span><span class="kobospan" id="kobo.787.1">in Java).</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.788.1">As always, we need to include the dependency in our module’s </span><span><strong class="source-inline"><span class="kobospan" id="kobo.789.1">build.gradle</span></strong></span><span><span class="kobospan" id="kobo.790.1"> file:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.791.1">
dependencies {
...
</span><span class="kobospan1" id="kobo.791.2">implementation "io.coil-kt:coil-compose:${latest_version}"
...
</span><span class="kobospan1" id="kobo.791.3">}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.792.1">At this </span><a id="_idIndexMarker082" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.793.1">point, we’re</span><a id="_idIndexMarker083" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.794.1"> ready to create our </span><span><strong class="source-inline"><span class="kobospan" id="kobo.795.1">Avatar</span></strong></span><span><span class="kobospan" id="kobo.796.1"> composable:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.797.1">
@Composable
fun Avatar(
    modifier: Modifier = Modifier,
    imageUrl: String,
    size: Dp,
    contentDescription: String? </span><span class="kobospan1" id="kobo.797.2">= "User avatar"
) {
    AsyncImage(
        model = imageUrl,
        contentDescription = contentDescription,
        modifier = modifier
            .size(size)
            .clip(CircleShape),
        contentScale = ContentScale.Crop
    )
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.798.1">Here, we are creating an avatar using </span><strong class="source-inline"><span class="kobospan" id="kobo.799.1">AsyncImage</span></strong><span class="kobospan" id="kobo.800.1">, which will load an image provided by a URL. </span><span class="kobospan" id="kobo.800.2">This image will be modified to have a circular shape. </span><span class="kobospan" id="kobo.800.3">Also, we should pass the size of the image when using this composable (we have chosen 50 </span><span><span class="kobospan" id="kobo.801.1">density-independent pixels).</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.802.1">Now, we </span><a id="_idIndexMarker084" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.803.1">can </span><a id="_idIndexMarker085" class="calibre6 pcalibre1 pcalibre"/><span><span class="kobospan" id="kobo.804.1">create </span></span><span><strong class="source-inline"><span class="kobospan" id="kobo.805.1">ConversationItem</span></strong></span><span><span class="kobospan" id="kobo.806.1">:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.807.1">
import androidx.compose.foundation.layout.*
import androidx.compose.material.MaterialTheme
import androidx.compose.material.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.unit.dp
import com.packt.feature.conversations.ui.model.Conversation
import com.packt.framework.ui.Avatar
@Composable
fun ConversationItem(conversation: Conversation) {
    Row(
        modifier = Modifier
            .fillMaxWidth()
            .padding(8.dp),
        verticalAlignment = Alignment.CenterVertically
    ) {
        Avatar(
            imageUrl = conversation.avatar,
            size = 50.dp,
            contentDescription =
                "${conversation.name}'s avatar"
        )
        Spacer(modifier = Modifier.width(8.dp))
        Column {
            Text(
                text = conversation.name,
                fontWeight = FontWeight.Bold,
                modifier = Modifier.fillMaxWidth(0.7f)
            )
            Text(text = conversation.message)
        }
        Spacer(modifier = Modifier.width(8.dp))
        Column(horizontalAlignment = Alignment.End) {
            Text(text = conversation.timestamp)
            if (conversation.unreadCount &gt; 0) {
                Text(
                    text =
                    conversation.unreadCount.toString(),
                    color = MaterialTheme.colors.primary,
                    modifier = Modifier.padding(top = 4.dp)
                )
            }
        }
    }
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.808.1">Let’s take a closer look at what this </span><span><span class="kobospan" id="kobo.809.1">composable does:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><span class="kobospan" id="kobo.810.1">The </span><strong class="source-inline1"><span class="kobospan" id="kobo.811.1">ConversationItem</span></strong><span class="kobospan" id="kobo.812.1"> composable accepts the following parameters: name, message, timestamp, </span><strong class="source-inline1"><span class="kobospan" id="kobo.813.1">avatarUrl</span></strong><span class="kobospan" id="kobo.814.1">, and an optional </span><strong class="source-inline1"><span class="kobospan" id="kobo.815.1">unreadMessages </span></strong><span class="kobospan" id="kobo.816.1">with a default value </span><span><span class="kobospan" id="kobo.817.1">of </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.818.1">0</span></strong></span><span><span class="kobospan" id="kobo.819.1">.</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.820.1">A </span><strong class="source-inline1"><span class="kobospan" id="kobo.821.1">Row</span></strong><span class="kobospan" id="kobo.822.1"> layout is used to arrange the contents horizontally. </span><span class="kobospan" id="kobo.822.2">It has a </span><strong class="source-inline1"><span class="kobospan" id="kobo.823.1">fillMaxWidth()</span></strong><span class="kobospan" id="kobo.824.1"> modifier to occupy the full width of the parent and a padding of 8 </span><span><span class="kobospan" id="kobo.825.1">density-independent pixels.</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.826.1">The </span><strong class="source-inline1"><span class="kobospan" id="kobo.827.1">Avatar</span></strong><span class="kobospan" id="kobo.828.1"> composable is used to display the avatar. </span><span class="kobospan" id="kobo.828.2">We already know how it works – the only thing to remark on is that we want it to have a size of 50 </span><span><span class="kobospan" id="kobo.829.1">density-independent pixels.</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.830.1">A </span><strong class="source-inline1"><span class="kobospan" id="kobo.831.1">Spacer</span></strong><span class="kobospan" id="kobo.832.1"> composable with a width of 8 density pixels is added to provide some space between the avatar and the </span><span><span class="kobospan" id="kobo.833.1">text content.</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.834.1">A </span><strong class="source-inline1"><span class="kobospan" id="kobo.835.1">Column</span></strong><span class="kobospan" id="kobo.836.1"> layout is used to arrange the name and message text vertically. </span><span class="kobospan" id="kobo.836.2">The </span><strong class="source-inline1"><span class="kobospan" id="kobo.837.1">Column</span></strong><span class="kobospan" id="kobo.838.1"> layout has a </span><strong class="source-inline1"><span class="kobospan" id="kobo.839.1">Modifier.weight()</span></strong><span class="kobospan" id="kobo.840.1"> modifier, which ensures that it takes up all the available space between the avatar and </span><span><span class="kobospan" id="kobo.841.1">the timestamp.</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.842.1">Inside the </span><strong class="source-inline1"><span class="kobospan" id="kobo.843.1">Column</span></strong><span class="kobospan" id="kobo.844.1"> layout, a </span><strong class="source-inline1"><span class="kobospan" id="kobo.845.1">Text</span></strong><span class="kobospan" id="kobo.846.1"> composable is used to display the name with a bold font</span><a id="_idIndexMarker086" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.847.1"> weight and a font size</span><a id="_idIndexMarker087" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.848.1"> of 16 scale-independent pixels. </span><span class="kobospan" id="kobo.848.2">Another </span><strong class="source-inline1"><span class="kobospan" id="kobo.849.1">Text</span></strong><span class="kobospan" id="kobo.850.1"> composable is used to display the message with a maximum of one line and an </span><span><span class="kobospan" id="kobo.851.1">ellipsis overflow.</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.852.1">Another </span><strong class="source-inline1"><span class="kobospan" id="kobo.853.1">Column</span></strong><span class="kobospan" id="kobo.854.1"> layout is added to the main </span><strong class="source-inline1"><span class="kobospan" id="kobo.855.1">Row</span></strong><span class="kobospan" id="kobo.856.1"> layout to arrange the timestamp and unread messages badge vertically. </span><span class="kobospan" id="kobo.856.2">The </span><strong class="source-inline1"><span class="kobospan" id="kobo.857.1">Column</span></strong><span class="kobospan" id="kobo.858.1"> layout has a </span><strong class="source-inline1"><span class="kobospan" id="kobo.859.1">horizontalAlignment</span></strong><span class="kobospan" id="kobo.860.1"> value of </span><strong class="source-inline1"><span class="kobospan" id="kobo.861.1">Alignment.End</span></strong><span class="kobospan" id="kobo.862.1"> to align its children to the end of the </span><span><span class="kobospan" id="kobo.863.1">available space.</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.864.1">Inside this second </span><strong class="source-inline1"><span class="kobospan" id="kobo.865.1">Column</span></strong><span class="kobospan" id="kobo.866.1"> layout, a </span><strong class="source-inline1"><span class="kobospan" id="kobo.867.1">Text</span></strong><span class="kobospan" id="kobo.868.1"> composable is used to display the time with a font size of 12 scale-independent pixels and a </span><span><span class="kobospan" id="kobo.869.1">gray color.</span></span></li>
<li class="calibre14"><span class="kobospan" id="kobo.870.1">A conditional statement checks if there are any unread messages (that is, </span><strong class="source-inline1"><span class="kobospan" id="kobo.871.1">conversation.unreadMessages &gt; 0</span></strong><span class="kobospan" id="kobo.872.1">). </span><span class="kobospan" id="kobo.872.2">If there are unread messages, the unread messages count shows a text with a circular background drawn using the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.873.1">drawBehind</span></strong></span><span><span class="kobospan" id="kobo.874.1"> modifier.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.875.1">Now that we </span><a id="_idIndexMarker088" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.876.1">have our </span><strong class="source-inline"><span class="kobospan" id="kobo.877.1">ConversationItem</span></strong><span class="kobospan" id="kobo.878.1"> composable, it is</span><a id="_idIndexMarker089" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.879.1"> time to finish this screen. </span><span class="kobospan" id="kobo.879.2">Let’s create the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.880.1">ConversationList</span></strong></span><span><span class="kobospan" id="kobo.881.1"> composable!</span></span></p>
<h2 id="_idParaDest-30" class="calibre7"><a id="_idTextAnchor030" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.882.1">Creating the ConversationList composable</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.883.1">As the last step</span><a id="_idIndexMarker090" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.884.1"> for this screen, we</span><a id="_idIndexMarker091" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.885.1"> are going to create the list </span><span><span class="kobospan" id="kobo.886.1">of conversations:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.887.1">
@Composable
fun ConversationList(conversations: List&lt;Conversation&gt;) {
    LazyColumn {
        items(conversations) { conversation -&gt;
            ConversationItem(
                conversation = conversation
            )
        }
    }
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.888.1">The </span><strong class="source-inline"><span class="kobospan" id="kobo.889.1">ConversationList</span></strong><span class="kobospan" id="kobo.890.1"> composable takes a list of </span><strong class="source-inline"><span class="kobospan" id="kobo.891.1">Conversation</span></strong><span class="kobospan" id="kobo.892.1"> objects and uses </span><strong class="source-inline"><span class="kobospan" id="kobo.893.1">LazyColumn</span></strong><span class="kobospan" id="kobo.894.1"> to display them efficiently. </span><span class="kobospan" id="kobo.894.2">The </span><strong class="source-inline"><span class="kobospan" id="kobo.895.1">items</span></strong><span class="kobospan" id="kobo.896.1"> function is used to loop through the conversations list and will render </span><strong class="source-inline"><span class="kobospan" id="kobo.897.1">ConversationItem</span></strong><span class="kobospan" id="kobo.898.1"> for </span><span><span class="kobospan" id="kobo.899.1">each conversation.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.900.1">Finally, we will include the list in the </span><strong class="source-inline"><span class="kobospan" id="kobo.901.1">HorizontalPager</span></strong><span class="kobospan" id="kobo.902.1"> logic, in our </span><strong class="source-inline"><span class="kobospan" id="kobo.903.1">ConversationsListScreen</span></strong> <span><span class="kobospan" id="kobo.904.1">composable:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.905.1">
HorizontalPager(
    modifier = Modifier.padding(innerPadding),
    pageCount = tabs.size,
    state = pagerState
) { index -&gt;
    when (index) {
        0 -&gt; {
            //Status
        }
        1 -&gt; {
            ConversationList(
                conversations = emptyList(), // Leaving the
                                                list empty
                                                for now
                onConversationClick = onConversationClick
            )
        }
        2-&gt; {
            // Calls
        }
    }
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.906.1">If we want to </span><a id="_idIndexMarker092" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.907.1">test it, we </span><a id="_idIndexMarker093" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.908.1">can fake the data of </span><span><span class="kobospan" id="kobo.909.1">the conversations:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.910.1">
fun generateFakeConversations(): List&lt;Conversation&gt; {
    return listOf(
        Conversation(
            id = "1",
            name = "John Doe",
            message = "Hey, how are you?",
            timestamp = "10:30",
            avatar = "https://i.pravatar.cc/150?u=1",
            unreadCount = 2
        ),
        Conversation(
            id = "2",
            name = "Jane Smith",
            message = "Looking forward to the party!",
            timestamp = "11:15",
            avatar = "https://i.pravatar.cc/150?u=2"
        ),
//Add more conversations here</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.911.1">Note that here, I’m</span><a id="_idIndexMarker094" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.912.1"> using a random avatar </span><a id="_idIndexMarker095" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.913.1">generator just to make it as similar as possible to how it would be when we connect this UI with </span><span><span class="kobospan" id="kobo.914.1">real conversations.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.915.1">The following screenshot shows what our app would look like with </span><span><span class="kobospan" id="kobo.916.1">more conversations:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer019">
<span class="kobospan" id="kobo.917.1"><img alt="Figure 1.12: ConversationsList screen completed" src="image/B19443_01_12.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.918.1">Figure 1.12: ConversationsList screen completed</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.919.1">Now, let’s switch to the chat screen, also known as the messages list. </span><span class="kobospan" id="kobo.919.2">Whereas the conversations</span><a id="_idIndexMarker096" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.920.1"> list is a list showing all the</span><a id="_idIndexMarker097" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.921.1"> conversations we have, the messages list will show the list of messages we have with one user (a single </span><span><span class="kobospan" id="kobo.922.1">chat screen).</span></span></p>
<h1 id="_idParaDest-31" class="calibre5"><a id="_idTextAnchor031" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.923.1">Building the messages list</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.924.1">In this section, we</span><a id="_idIndexMarker098" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.925.1"> are going to create the UI models</span><a id="_idIndexMarker099" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.926.1"> that are needed to create the chat screen and the messages two users could have exchanged. </span><span class="kobospan" id="kobo.926.2">Then, we will create the </span><strong class="source-inline"><span class="kobospan" id="kobo.927.1">Message</span></strong><span class="kobospan" id="kobo.928.1"> composable, and finally, the rest of the screen, including</span><a id="_idIndexMarker100" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.929.1"> the list </span><a id="_idIndexMarker101" class="calibre6 pcalibre1 pcalibre"/><span><span class="kobospan" id="kobo.930.1">of messages.</span></span></p>
<h2 id="_idParaDest-32" class="calibre7"><a id="_idTextAnchor032" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.931.1">Modeling the Chat and Message models</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.932.1">Taking into account </span><a id="_idIndexMarker102" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.933.1">the</span><a id="_idIndexMarker103" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.934.1"> information we have to show on the chat screen, we are going to need two data models: one for the static data related to the conversation (for example, the name of the user we are talking to, their avatar, and so on) and one data model per message. </span><span class="kobospan" id="kobo.934.2">This will be the model for the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.935.1">Chat</span></strong></span><span><span class="kobospan" id="kobo.936.1"> model:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.937.1">
data class Chat(
    val id: String,
    val name: String,
    val avatar: String
)</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.938.1">In this case, we will need the ID of the chat, the name of the person we are talking to, and their </span><span><span class="kobospan" id="kobo.939.1">avatar address.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.940.1">Regarding the </span><strong class="source-inline"><span class="kobospan" id="kobo.941.1">Message</span></strong><span class="kobospan" id="kobo.942.1"> model, we will create the </span><span><span class="kobospan" id="kobo.943.1">following classes:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.944.1">
data class Message(
    val id: String,
    val senderName: String,
    val senderAvatar: String,
    val timestamp: String,
    val isMine: Boolean,
    val messageContent: MessageContent
)
sealed class MessageContent {
    data class TextMessage(val message: String) :
        MessageContent()
    data class ImageMessage(val imageUrl: String,
        val contentDescription: String) : MessageContent()
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.945.1">In this case, we need the sender’s name, their avatar, the timestamp, whether the message is mine or not (which we will take into account so that we can arrange the message one to the left or the right), and the content of </span><span><span class="kobospan" id="kobo.946.1">the message.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.947.1">Since our application is going to have two types of content (messages and images), we need two different kinds of </span><strong class="source-inline"><span class="kobospan" id="kobo.948.1">MessageContent</span></strong><span class="kobospan" id="kobo.949.1">. </span><span class="kobospan" id="kobo.949.2">That’s the reason it has been modeled as a sealed class. </span><span class="kobospan" id="kobo.949.3">We</span><a id="_idIndexMarker104" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.950.1"> have </span><a id="_idIndexMarker105" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.951.1">two data classes with the data needed for every type of </span><span><span class="kobospan" id="kobo.952.1">message content.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.953.1">Now, we need to convert these models into </span><span><span class="kobospan" id="kobo.954.1">some composables.</span></span></p>
<h2 id="_idParaDest-33" class="calibre7"><a id="_idTextAnchor033" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.955.1">Creating the MessageItem composable</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.956.1">The </span><strong class="source-inline"><span class="kobospan" id="kobo.957.1">MessageItem</span></strong><span class="kobospan" id="kobo.958.1"> composable </span><a id="_idIndexMarker106" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.959.1">is going</span><a id="_idIndexMarker107" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.960.1"> to draw each of our </span><span><span class="kobospan" id="kobo.961.1">chat messages.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.962.1">To start, we will create a </span><strong class="source-inline"><span class="kobospan" id="kobo.963.1">Row</span></strong><span class="kobospan" id="kobo.964.1"> layout. </span><span class="kobospan" id="kobo.964.2">We will set the arrangement of the row contents depending on the </span><span><span class="kobospan" id="kobo.965.1">message’s author:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.966.1">
@Composable
fun MessageItem(message: Message) {
    Row(
        modifier = Modifier.fillMaxWidth(),
        horizontalArrangement = if (message.isMine)
        Arrangement.End else Arrangement.Start
    ) {
...
</span><span class="kobospan1" id="kobo.966.2">}
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.967.1">Then, inside this row, we are going to place the rest of the components of the message. </span><span class="kobospan" id="kobo.967.2">We will start with the avatar; we will only show the avatar if the message is not from </span><span><span class="kobospan" id="kobo.968.1">the user:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.969.1">
if (!message.isMine) {
    Avatar(
        imageUrl = message.senderAvatar,
        size = 40.dp,
        contentDescription = "${message.senderName}'s
                              avatar"
    )
    Spacer(modifier = Modifier.width(8.dp))
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.970.1">Then, we </span><a id="_idIndexMarker108" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.971.1">are </span><a id="_idIndexMarker109" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.972.1">going to add a </span><strong class="source-inline"><span class="kobospan" id="kobo.973.1">Column</span></strong><span class="kobospan" id="kobo.974.1"> layout so that we can arrange the rest of the </span><span><span class="kobospan" id="kobo.975.1">message information:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.976.1">
Column {
    if (message.isMine) {
        Spacer(modifier = Modifier.height(8.dp))
    } else {
        Text(
            text = message.senderName,
            fontWeight = FontWeight.Bold
        )
    }
    when (val content = message.messageContent) {
        is MessageContent.TextMessage -&gt; {
            Surface(
                shape = RoundedCornerShape(8.dp),
                color = if (message.isMine)
                MaterialTheme.colors.primarySurface else
                MaterialTheme.colors.secondary
            ) {
                Text(
                    text = content.message,
                    modifier = Modifier.padding(8.dp),
                    color = if (message.isMine)
                    MaterialTheme.colors.onPrimary else
                    Color.White
                )
            }
        }
        is MessageContent.ImageMessage -&gt; {
            AsyncImage(
                model = content.imageUrl,
                contentDescription =
                content.contentDescription,
                modifier = Modifier
                    .size(40.dp)
                    .clip(CircleShape),
                contentScale = ContentScale.Crop
            )
        }
    }
    Text(
        text = message.timestamp,
        fontSize = 12.sp
    )
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.977.1">The message will include the </span><span><span class="kobospan" id="kobo.978.1">following information:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.979.1">The name of the sender (if the author is not the current user)</span></strong><span class="kobospan" id="kobo.980.1">: To know if the message is from the current user, the app will check if the author of the message is the current user using </span><strong class="source-inline1"><span class="kobospan" id="kobo.981.1">if (message.isMine</span></strong><span class="kobospan" id="kobo.982.1">. </span><span class="kobospan" id="kobo.982.2">If this is positive, we will add a </span><strong class="source-inline1"><span class="kobospan" id="kobo.983.1">Space</span></strong><span class="kobospan" id="kobo.984.1"> composable; if the message author is not the current user, we will show the </span><strong class="source-inline1"><span class="kobospan" id="kobo.985.1">Text</span></strong><span class="kobospan" id="kobo.986.1"> composable and </span><span><span class="kobospan" id="kobo.987.1">their name.</span></span></li>
<li class="calibre14"><strong class="bold"><span class="kobospan" id="kobo.988.1">The content</span></strong><span class="kobospan" id="kobo.989.1">: The app will show a bubble containing text if the content is text. </span><span class="kobospan" id="kobo.989.2">The color of the bubble will depend on whether the sender of the message is the current user and the time the message was created. </span><span class="kobospan" id="kobo.989.3">A timestamp with the date and time of creation will be shown at the bottom of </span><span><span class="kobospan" id="kobo.990.1">the message.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.991.1">Now that we</span><a id="_idIndexMarker110" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.992.1"> have </span><strong class="source-inline"><span class="kobospan" id="kobo.993.1">MessageItem</span></strong><span class="kobospan" id="kobo.994.1">, it’s time </span><a id="_idIndexMarker111" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.995.1">to create the rest of the </span><span><span class="kobospan" id="kobo.996.1">chat screen.</span></span></p>
<h2 id="_idParaDest-34" class="calibre7"><a id="_idTextAnchor034" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.997.1">Adding the TopAppBar and BottomRow composables</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.998.1">As we did for the</span><a id="_idIndexMarker112" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.999.1"> conversations list, we </span><a id="_idIndexMarker113" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.1000.1">are going to add the </span><strong class="source-inline"><span class="kobospan" id="kobo.1001.1">Scaffold</span></strong><span class="kobospan" id="kobo.1002.1"> structure and its </span><strong class="source-inline"><span class="kobospan" id="kobo.1003.1">TopAppBar</span></strong><span class="kobospan" id="kobo.1004.1"> and </span><strong class="source-inline"><span class="kobospan" id="kobo.1005.1">BottomRow</span></strong><span class="kobospan" id="kobo.1006.1"> composables to </span><span><span class="kobospan" id="kobo.1007.1">this screen:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1008.1">
@Composable
fun ChatScreen(
    chatId: String?,
    onBack: () -&gt; Unit
) {
    Scaffold(
        topBar = {
            TopAppBar(
                title = {
                    Text(stringResource(
                    R.string.chat_title, "Alice"))
                }
            )
        },
        bottomBar = {
            SendMessageBox()
        }
    ) { paddingValues-&gt;
        ListOfMessages(paddingValues = paddingValues)
    }
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.1009.1">Note that we are hardcoding the title of the chat. </span><span class="kobospan" id="kobo.1009.2">This is just for preview purposes; we’ll correct that in</span><a id="_idIndexMarker114" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.1010.1"> the</span><a id="_idIndexMarker115" class="calibre6 pcalibre1 pcalibre"/> <span><span class="kobospan" id="kobo.1011.1">next chapter.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1012.1">In the case of the bottom bar, we are adding a new composable that will contain </span><strong class="source-inline"><span class="kobospan" id="kobo.1013.1">Textfield</span></strong><span class="kobospan" id="kobo.1014.1"> and the send button needed to send a message. </span><span class="kobospan" id="kobo.1014.2">This is what this composable will </span><span><span class="kobospan" id="kobo.1015.1">look like:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1016.1">
@Composable
fun SendMessageBox() {
    Box(
        modifier = Modifier
            .defaultMinSize()
            .padding(top = 0.dp, start = 16.dp,
                end = 16.dp,
            bottom = 16.dp)
            .fillMaxWidth()
    ) {
        var text by remember { mutableStateOf("") }
        OutlinedTextField(
            value = text,
            onValueChange = { newText -&gt; text = newText },
            modifier = Modifier
                .fillMaxWidth(0.85f)
                .align(Alignment.CenterStart)
                .height(56.dp),
        )
        IconButton(
            modifier = Modifier
                .align(Alignment.CenterEnd)
                .height(56.dp),
            onClick = {
                // Send message here
                text = ""
            }
        ) {
            Icon(
                imageVector = Icons.Default.Send,
                tint = MaterialTheme.colors.primary,
                contentDescription = "Send message"
            )
        }
    }
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.1017.1">Here, we are creating a </span><strong class="source-inline"><span class="kobospan" id="kobo.1018.1">Box</span></strong><span class="kobospan" id="kobo.1019.1"> composable to arrange the children composables accordingly (the text field at the left and the </span><strong class="source-inline"><span class="kobospan" id="kobo.1020.1">Send</span></strong><span class="kobospan" id="kobo.1021.1"> button at the right). </span><span class="kobospan" id="kobo.1021.2">Then, we’re defining a property called </span><strong class="source-inline"><span class="kobospan" id="kobo.1022.1">text</span></strong><span class="kobospan" id="kobo.1023.1"> to store text field changes and using the </span><strong class="source-inline"><span class="kobospan" id="kobo.1024.1">remember</span></strong><span class="kobospan" id="kobo.1025.1"> delegate to remember its last value </span><span><span class="kobospan" id="kobo.1026.1">between recompositions.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1027.1">As shown in the preceding code block, the main components of this composable are </span><span><span class="kobospan" id="kobo.1028.1">as follows:</span></span></p>
<ul class="calibre15">
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.1029.1">OutlinedTextField</span></strong><span class="kobospan" id="kobo.1030.1">: To write the message. </span><span class="kobospan" id="kobo.1030.2">It will take its value from the text property and modify it every time the value of the text </span><span><span class="kobospan" id="kobo.1031.1">field changes.</span></span></li>
<li class="calibre14"><strong class="source-inline1"><span class="kobospan" id="kobo.1032.1">IconButton</span></strong><span class="kobospan" id="kobo.1033.1">: To send the message. </span><span class="kobospan" id="kobo.1033.2">Its </span><strong class="source-inline1"><span class="kobospan" id="kobo.1034.1">onClick</span></strong><span class="kobospan" id="kobo.1035.1"> parameter is not doing anything yet (apart from restarting the </span><strong class="source-inline1"><span class="kobospan" id="kobo.1036.1">text</span></strong><span class="kobospan" id="kobo.1037.1"> property value). </span><span class="kobospan" id="kobo.1037.2">We will configure this in the </span><span><span class="kobospan" id="kobo.1038.1">next chapter.</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.1039.1">With that, our </span><a id="_idIndexMarker116" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.1040.1">chat screen </span><a id="_idIndexMarker117" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.1041.1">is almost ready. </span><span class="kobospan" id="kobo.1041.2">The last thing we need to do is add the </span><span><span class="kobospan" id="kobo.1042.1">messages list.</span></span></p>
<h2 id="_idParaDest-35" class="calibre7"><a id="_idTextAnchor035" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.1043.1">Adding the messages list</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.1044.1">Earlier, we were adding </span><a id="_idIndexMarker118" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.1045.1">the messages list as a composable</span><a id="_idIndexMarker119" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.1046.1"> in the </span><strong class="source-inline"><span class="kobospan" id="kobo.1047.1">content</span></strong><span class="kobospan" id="kobo.1048.1"> parameter of the </span><strong class="source-inline"><span class="kobospan" id="kobo.1049.1">Scaffold</span></strong><span class="kobospan" id="kobo.1050.1"> composable. </span><span class="kobospan" id="kobo.1050.2">This composable will look </span><span><span class="kobospan" id="kobo.1051.1">as follows:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1052.1">
@Composable
fun ListOfMessages(paddingValues: PaddingValues) {
    Box(modifier = Modifier
        .fillMaxSize()
        .padding(paddingValues)) {
        Row(modifier = Modifier
            .fillMaxWidth()
            .padding(16.dp)
        ) {
            LazyColumn(
                modifier = Modifier
                    .fillMaxSize(),
                verticalArrangement =
                    Arrangement.spacedBy(8.dp),
            ) {
                items(getFakeMessages()) { message -&gt;
                    MessageItem(message = message)
                }
            }
        }
    }
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.1053.1">With that, we have </span><a id="_idIndexMarker120" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.1054.1">added </span><strong class="source-inline"><span class="kobospan" id="kobo.1055.1">LazyColumn</span></strong><span class="kobospan" id="kobo.1056.1">, which will </span><a id="_idIndexMarker121" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.1057.1">show the list – every item in the list is a </span><span><strong class="source-inline"><span class="kobospan" id="kobo.1058.1">MessageItem</span></strong></span><span><span class="kobospan" id="kobo.1059.1"> composable.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1060.1">Since we haven’t connected it to any kind of data source yet, we are using a function to generate a list of fake messages just for </span><span><span class="kobospan" id="kobo.1061.1">preview purposes:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.1062.1">
fun getFakeMessages(): List&lt;Message&gt; {
    return listOf(
        Message(
            id = "1",
            senderName = "Alice",
            senderAvatar =
                "https://i.pravatar.cc/300?img=1",
            isMine = false,
            timestamp = "10:00",
            messageContent = MessageContent.TextMessage(
                message = "Hi, how are you?"
</span><span class="kobospan1" id="kobo.1062.2">            )
        ),
        Message(
            id = "2",
            senderName = "Lucy",
            senderAvatar =
                "https://i.pravatar.cc/300?img=2",
            isMine = true,
            timestamp = "10:01",
            messageContent = MessageContent.TextMessage(
                message = "I'm good, thank you! </span><span class="kobospan1" id="kobo.1062.3">And you?"
</span><span class="kobospan1" id="kobo.1062.4">            )
        ),
)
}</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.1063.1">You can add </span><a id="_idIndexMarker122" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.1064.1">more messages if you want by adding them</span><a id="_idIndexMarker123" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.1065.1"> to the list that’s been created inside the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.1066.1">getFakeMessages()</span></strong></span><span><span class="kobospan" id="kobo.1067.1"> function.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1068.1">Finally, we should have a screen that looks </span><span><span class="kobospan" id="kobo.1069.1">like this:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer020">
<span class="kobospan" id="kobo.1070.1"><img alt="Figure 1.13: Chat screen UI finished" src="image/B19443_01_13.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.1071.1">Figure 1.13: Chat screen UI finished</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1072.1">With that, we </span><a id="_idIndexMarker124" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.1073.1">are done with the user interface for</span><a id="_idIndexMarker125" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.1074.1"> now. </span><span class="kobospan" id="kobo.1074.2">We will continue working on this app during the next </span><span><span class="kobospan" id="kobo.1075.1">two chapters!</span></span></p>
<h1 id="_idParaDest-36" class="calibre5"><a id="_idTextAnchor036" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.1076.1">Summary</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.1077.1">In this first chapter, we started our first project, WhatsPackt, a </span><span><span class="kobospan" id="kobo.1078.1">messaging app.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1079.1">We accomplished several initial tasks to build this app, such as organizing modules, preparing dependency injection and navigation, constructing the main screen, creating the conversations list, and building the </span><span><span class="kobospan" id="kobo.1080.1">messages list.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1081.1">Throughout this process, we’ve learned about modularization and the various approaches to organizing it. </span><span class="kobospan" id="kobo.1081.2">We’ve also learned about popular libraries for managing dependency injection, how to initialize them, and how to set up Compose navigation. </span><span class="kobospan" id="kobo.1081.3">Additionally, we became familiar with using Jetpack Compose to create our </span><span><span class="kobospan" id="kobo.1082.1">user interface.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.1083.1">As we move forward, it’s time to give some love and life to our chats. </span><span class="kobospan" id="kobo.1083.2">In the next chapter, we will explore how to retrieve and send messages and integrate them into our recently created </span><span><span class="kobospan" id="kobo.1084.1">user interfaces.</span></span></p>
</div>
</body></html>