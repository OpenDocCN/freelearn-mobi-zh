<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Managing RecyclerViews and Their Data</h1></div></div></div><p>In the previous chapter, we saw how to work with more than one Activity, but the data displayed in both was static. To progress, we need a way to apply a choice of data to a predefined layout and ideally present this as part of a list. Android 5 has introduced the RecyclerView-a more efficient and flexible version of the previously used ListView. To implement a RecyclerView, we will need a LayoutManager, an Adapter and some data to work with. In this chapter, we will start a new app that creates a list of CardViews, each displaying the relevant data and serving as a link to more detailed information.</p><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating a RecyclerView</li><li class="listitem" style="list-style-type: disc">Designing a CardView Layout</li><li class="listitem" style="list-style-type: disc">Including a LayoutManager</li><li class="listitem" style="list-style-type: disc">Creating Data and an Adapter</li><li class="listitem" style="list-style-type: disc">Adding a ViewHolder</li><li class="listitem" style="list-style-type: disc">Responding to the RecyclerView selections</li><li class="listitem" style="list-style-type: disc">Connecting a View to a web page</li></ul></div><div><div><div><div><h1 class="title"><a id="ch04lvl1sec23"/>Creating a RecyclerView</h1></div></div></div><p>The main <a id="id134" class="indexterm"/>Activity of our new project will consist entirely of a RecyclerView nested inside the root Layout, and is very quick and simple to construct. However, similar to the CardView, it is new to Android 5 and therefore, a part of the V7 Support Libraries and also, one of the Gradle build files will need to be modified, for it to work. The following steps demonstrate how to create a RecyclerView:</p><div><ol class="orderedlist arabic"><li class="listitem">Start a new project in the Android studio. Give it an <strong>Application name:</strong> of <code class="literal">Ancient Britain</code>; check the Phone and Tablet checkbox and select <strong>Blank Activity</strong>.</li><li class="listitem">Open the <a id="id135" class="indexterm"/>Gradle script file, <code class="literal">build.gradle</code> (Module app) and add the following two dependencies:<div><pre class="programlisting">dependencies {
  compile fileTree(dir: 'libs', include: ['*.jar'])
  <strong>compile 'com.android.support:cardview-v7:21.0.+'</strong>
  <strong>compile 'com.android.support:recyclerview-v7:21.0.+'</strong>
}</pre></div></li><li class="listitem">Open the <code class="literal">activity_main.xml</code> file in <code class="literal">res/layout</code> and replace the <code class="literal">TextView</code> tag with the following code:<div><pre class="programlisting">&lt;android.support.v7.widget.RecyclerView
  android:id="@+id/main_recycler_view"
  android:layout_width="match_parent"
  android:layout_height="match_parent"
  /&gt;</pre></div></li><li class="listitem">Create a color theme in the same way as we did in previous chapters.</li><li class="listitem">Rebuild the project.</li></ol></div><p>That's all there is to it! Our RecyclerView now fills the screen, apart from the margins, which are set automatically to Google's recommended design standards. Adding dependencies to the Gradle build scripts is something we are already familiar with and needs no explanation. The <code class="literal">text_secondary</code> color name will set smaller text to a dark gray.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec18"/>Adding a CardView with layout</h2></div></div></div><p>Our Recycler list <a id="id136" class="indexterm"/>will be comprised of <a id="id137" class="indexterm"/>CardViews, each conforming to the layout that we will design next. By the end of this section, our main Activity will look like this:</p><div><img src="img/B04321_04_01.jpg" alt="Adding a CardView with layout"/></div><p>The first thing <a id="id138" class="indexterm"/>we need to do is design our <a id="id139" class="indexterm"/>CardView.</p><div><ol class="orderedlist arabic"><li class="listitem">Right-click on <strong>layout</strong> in the project explorer and select <strong>New</strong> | <strong>Layout resource file</strong> from the menu.</li><li class="listitem">Call it <code class="literal">card_main</code> and make sure its root element is a horizontal <code class="literal">LinearLayout</code>.</li><li class="listitem">Design a card layout similar to those in the image above, with the following component structure and IDs.<div><img src="img/B04321_04_02.jpg" alt="Adding a CardView with layout"/></div><div><div><h3 class="title"><a id="tip13"/>Tip</h3><p>The layout components can be moved and reordered directly from the Component Tree by <a id="id140" class="indexterm"/>dragging and dropping them.</p></div></div></li><li class="listitem">Position<a id="id141" class="indexterm"/> the two inner <code class="literal">LinearLayout</code> and <code class="literal">ImageView</code> instances to match the following:<div><img src="img/B04321_04_03.jpg" alt="Adding a CardView with layout"/></div></li><li class="listitem">For the rest of this section, set the margins and/or padding to your own liking. Where <code class="literal">layout_width</code> and <code class="literal">layout_height</code> are not mentioned, use <code class="literal">wrap_content</code>.</li><li class="listitem">Set the corner<a id="id142" class="indexterm"/> radius and elevation as<a id="id143" class="indexterm"/> you like, but make sure that the following properties are included in the <code class="literal">CardView</code> element:<div><pre class="programlisting">android:id="@+id/card_view"
android:layout_width="match_parent"
android:layout_height="100dp"</pre></div></li><li class="listitem">Ensure that the <code class="literal">ImageView</code> has the following properties:<div><pre class="programlisting">android:id="@+id/card_image"
android:layout_width="0dp"
android:layout_weight="2"
android:src="img/li><li class="listitem">Set these properties in the inner (vertical) <code class="literal">LinearLayout</code>:<div><pre class="programlisting">android:layout_width="0dp"
android:layout_height="match_parent"
android:layout_weight="5"
android:orientation="vertical"</pre></div></li><li class="listitem">Include these settings in the upper of the two <code class="literal">TextView</code> instances:<div><pre class="programlisting">android:id="@+id/card_name"
android:textAppearance="?android:attr/textAppearanceLarge"</pre></div></li><li class="listitem">Finally, set these properties in the lower <code class="literal">TextView</code>:<div><pre class="programlisting">android:id="@+id/card_info"
android:textAppearance="?android:attr/textAppearanceSmall"</pre></div></li></ol></div><p>Most of the properties set here are the ones we are familiar with: most importantly the <code class="literal">id</code> property, which allows us access through Java. However, one or two things may need explaining.</p><p>
<code class="literal">LinearLayout</code> allows us to allocate proportional amounts of screen space to individual views, according to their <code class="literal">layout_weight</code> property. Instead of telling a view to take up as much space as it can (<code class="literal">match_parent</code>), or as little (<code class="literal">wrap_content</code>), using <code class="literal">layout_weight</code> allows us to allocate a certain proportion of the parent view group. Two views each with a weight of 1 will both take up 50% of the space, weights of 1 and 4 would take up 20% and 80% respectively. Here, we used weights of 2 and 5, meaning that 2/7 of the available space is allocated to the image and 5/7 to the vertical layout. We set the layout widths to <code class="literal">0dp</code> so as not to interfere with the weighting.</p><div><div><h3 class="title"><a id="note07"/>Note</h3><p>The drawable <code class="literal">ic_launcher.png</code> was simply used as a placeholder to facilitate designing the layout; it will be replaced in the code later.</p></div></div><p>We <a id="id144" class="indexterm"/>used <code class="literal">textAppearanceSmall</code> and <code class="literal">textAppearanceLarge</code> to set our text sizes. This is often preferable to using specific dp<a id="id145" class="indexterm"/> amounts, as these settings automatically adjust to suit the size of the user's screen.</p><div><div><h3 class="title"><a id="note08"/>Note</h3><p>Despite the obvious advantages of using weights in our layouts, it does need pointing out that this can have an adverse effect on performance, as the system has to recalculate its/the position more often.</p></div></div><p>Now that we have a <code class="literal">RecyclerView</code> and a <code class="literal">CardView</code> layout, we can go ahead and bring the two together with a <code class="literal">LayoutManager</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec19"/>Adding a LayoutManager</h2></div></div></div><p>Views are<a id="id146" class="indexterm"/> positioned in the <code class="literal">RecyclerView</code> by a <code class="literal">RecyclerView.LayoutManager</code>, which in turn communicates with a <code class="literal">RecyclerView.Adapter</code>, and this<a id="id147" class="indexterm"/> binds our data to our views. First, let's set up a <code class="literal">LayoutManager</code>.</p><div><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">MainActivity.Java</code> file.</li><li class="listitem">At the top of the class, declare the following fields:<div><pre class="programlisting">private RecyclerView recyclerView;
public static int currentItem;</pre></div></li><li class="listitem">Inside the <code class="literal">onCreate()</code> method, add these lines:<div><pre class="programlisting">recyclerView = (RecyclerView) findViewById(R.id.main_recycler_view);
recyclerView.setHasFixedSize(true);

RecyclerView.LayoutManager layoutManager = new LinearLayoutManager(this);
recyclerView.setLayoutManager(layoutManager);</pre></div></li></ol></div><p>By now, the use of <code class="literal">findViewById()</code> should be familiar to us. The use of the <code class="literal">setFixedSize()</code> method is very useful. If you know that your list will remain the same length during runtime, then setting it to true will improve the performance of your app, as it cleverly recycles items when they are out of view, hence the name <code class="literal">RecyclerView</code>.</p><p>Giving the RecyclerView a LayoutManager is as simple as declaring a new <code class="literal">LinearLayoutManager</code>, passing it the current context and using <code class="literal">RecyclerView.setLayoutManager()</code> to set the connection. The <code class="literal">LayoutManager</code> can be thought <a id="id148" class="indexterm"/>of as belonging to the RecyclerView <a id="id149" class="indexterm"/>and it is the view's way of communicating with the data adapter, which in turn accesses a dataset, as can be seen in this diagram:</p><div><img src="img/B04321_04_04.jpg" alt="Adding a LayoutManager"/></div><p>Before we <a id="id150" class="indexterm"/>move on to create our <code class="literal">Adapter</code> class, we<a id="id151" class="indexterm"/> will set up some data for it to work with.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec20"/>Adding a dataset</h2></div></div></div><p>The Android<a id="id152" class="indexterm"/> system utilizes SQLite for use with large<a id="id153" class="indexterm"/> and complex datasets, and we will return to this later in the book. For the purposes of this project, we will create the data arrays we need with Java. here's how this is done:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new Java class by right-clicking on <strong>MainActivity</strong> on the project explorer and selecting <strong>New</strong> | <strong>Java Class</strong> from the menu. Call it <code class="literal">MainDataDef</code>.</li><li class="listitem">Fill it out as follows:<div><pre class="programlisting">public class MainDataDef {
  int image;
  String name;
  String info;

  public MainDataDef(int image, String name, String info) {
    this.image = image;
    this.name = name;
    this.info = info;
  }

  public int getImage() { return image; }

  public String getName() { return name; }

  public String getInfo() { return info; }
}</pre></div></li><li class="listitem">If you have downloaded the project files from the Packt website, then the dataset will contain ten records. However, the app will work just fine with any number and just the first five are included here. Create another Java class called <code class="literal">MainData</code> and complete it as follows:<div><pre class="programlisting">public class MainData {

  static Integer[] imageArray = {R.drawable.henge_icon, R.drawable.horse_icon, R.drawable.wall_icon, R.drawable.skara_brae_icon, R.drawable.tower_icon};

  static String[] nameArray = {"Stonehenge", "Uffington White Horse", "Hadrian's Wall", "Skara Brae", "Tower of London"};

  static String[] infoArray = {"Aylsbury, Wiltshire", "Uffington, Oxfordshire", "Cumbria - Durham", "Mainland, Orkney", "Tower Hamlets, London"};

  static Integer[] detailImageArray = {R.drawable.henge_large, R.drawable.horse_large, R.drawable.wall_large, R.drawable.skara_brae_large, R.drawable.tower_large};

  static Integer[] detailTextArray = {R.string.detail_text_henge, R.string.detail_text_horse, R.string.detail_text_wall, R.string.detail_text_skara, R.string.detail_text_tower};

  static String[] detailWebLink = {"https://en.wikipedia.org/wiki/Stonehenge", "https://en.wikipedia.org/wiki/Uffington_White_Horse", "https://en.wikipedia.org/wiki/Hadrian%27s_Wall", "https://en.wikipedia.org/wiki/Skara_Brae", "https://en.wikipedia.org/wiki/Tower_of_London"};
}</pre></div></li><li class="listitem">If you have <a id="id154" class="indexterm"/>downloaded the project files, you <a id="id155" class="indexterm"/>will see that the <code class="literal">drawable</code> directory contains images: if not, you will need to add your own. If you are using the dataset seen above, then you will need ten images, with the names shown below. Make sure the <code class="literal">*_icon.png</code> files are roughly 160 x 160 px and the <code class="literal">*_large.png</code> files are about 640 x 480 px.<div><img src="img/B04321_04_05.jpg" alt="Adding a dataset"/></div></li><li class="listitem">The final <a id="id156" class="indexterm"/>part of the data consists of rather long<a id="id157" class="indexterm"/> strings. If you have downloaded the project files these can be found in the <code class="literal">strings.xml</code> resource file, if not, then you will need five strings of about 100 words a piece, with the following names:<div><pre class="programlisting">&lt;string name="detail_text_henge"&gt;
&lt;string name="detail_text_horse"&gt;
&lt;string name="detail_text_wall"&gt;
&lt;string name="detail_text_skara"&gt;
&lt;string name="detail_text_tower"&gt;</pre></div></li></ol></div><p>Putting our data arrays together was quite straightforward, but it is interesting to note how we used integers to refer to images and strings, using the automatically generated <code class="literal">R</code> class, which associates each individual resource with a static integer. This can be found by selecting <strong>Packages</strong> under <strong>app</strong> | <strong>package name</strong>. It cannot be edited, but it is helpful to see how it works.</p><p>We used the <code class="literal">strings.xml</code> file to store the long strings. This is not practical for lengthy text and usually we would store these resources as text files in the raw resource folder, and this is something we will cover later in the book.</p><p>Android TextViews are able to handle basic markup formatting tags, such as <code class="literal">&lt;b&gt;&lt;/b&gt;</code> and <code class="literal">&lt;i&gt;&lt;/i&gt;</code>. Below is a list of some of the formatting tags available:</p><div><pre class="programlisting">&lt;big&gt;&lt;/big&gt;
&lt;b&gt;&lt;/b&gt;
&lt;i&gt;&lt;/i&gt;
&lt;small&gt;&lt;/small&gt;
&lt;strike&gt;&lt;/strike&gt;
&lt;sup&gt;&lt;/sup&gt;
&lt;sub&gt;&lt;/sub&gt;
&lt;tt&gt;&lt;/tt&gt;
&lt;u&gt;&lt;/u&gt;</pre></div><p>With<a id="id158" class="indexterm"/> our data in place, we can now get around to creating our <a id="id159" class="indexterm"/>data adapter.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec24"/>Creating an Adapter</h1></div></div></div><p>The <code class="literal">RecyclerView.Adapter</code> is responsible for binding our data to our views. We control how this happens through another <code class="literal">RecyclerView</code> sub-class, the <code class="literal">ViewHolder</code>, which we will<a id="id160" class="indexterm"/> create inside our Adapter. This can be achieved by following these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new Java class alongside the others in our project called <code class="literal">MainAdapter</code>.</li><li class="listitem">Change the class declaration to this:<div><pre class="programlisting">public class MainAdapter extends RecyclerView.Adapter&lt;MainAdapter.MainViewHolder&gt; {</pre></div></li><li class="listitem">Directly under this, type:<div><pre class="programlisting">private ArrayList&lt;MainDataDef&gt; mainData;

public MainAdapter(ArrayList&lt;MainDataDef&gt; a) {
  this.mainData = a;
}

public static class MainViewHolder extends RecyclerView.ViewHolder {</pre></div></li><li class="listitem">This last line will generate an error, indicated by a red underline. Place the cursor somewhere on the class declaration and press <em>Alt</em> + <em>Enter</em>.</li><li class="listitem">Select <strong>Implement Methods</strong> from the drop-down list and then all three methods shown here:<div><img src="img/B04321_04_06.jpg" alt="Creating an Adapter"/></div></li><li class="listitem">Beneath<a id="id161" class="indexterm"/> this, add the following class:<div><pre class="programlisting">public static class MainViewHolder extends RecyclerView.ViewHolder {
  ImageView imageIcon;
  TextView textName;
  TextView textInfo;

  public MainViewHolder(View v) {
    super(v);
    this.imageIcon = (ImageView) v.findViewById(R.id.card_image);
    this.textName = (TextView) v.findViewById(R.id.card_name);
    this.textInfo = (TextView) v.findViewById(R.id.card_info);
  }
}</pre></div></li><li class="listitem">Complete the <code class="literal">onCreateViewHolder()</code> method like this:<div><pre class="programlisting">@Override
public MainViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {

  View v = LayoutInflater.from(parent.getContext())
    .inflate(R.layout.card_main, parent, false);

  v.setOnClickListener(MainActivity.mainOnClickListener);

  return new MainViewHolder(v);
}</pre></div></li><li class="listitem">Then, the <code class="literal">onBindViewHolder()</code> method:<div><pre class="programlisting">@Override
public void onBindViewHolder(final MainViewHolder holder, final int position) {
  ImageView imageIcon = holder.imageIcon;
  TextView textName = holder.textName;
  TextView textInfo = holder.textInfo;

  imageIcon.setImageResource(mainData.get(position).getImage());
  textName.setText(mainData.get(position).getName());
  textInfo.setText(mainData.get(position).getInfo());
}</pre></div></li><li class="listitem">And, the <code class="literal">getItemCount()</code> method:<div><pre class="programlisting">@Override
public int getItemCount() {
  return mainData.length();
}</pre></div></li><li class="listitem">Open <a id="id162" class="indexterm"/>the <code class="literal">MainActivity</code> file.</li><li class="listitem">At the bottom of the <code class="literal">onCreate()</code> method, add this code:<div><pre class="programlisting">ArrayList&lt;MainDataDef&gt; mainData = new ArrayList&lt;MainDataDef&gt;();
for (int i = 0; i &lt; MainData.nameArray.length; i++) {
  mainData.add(new MainDataDef(
    MainData.imageArray[i],
    MainData.nameArray[i],
    MainData.infoArray[i]
  ));
}

RecylerView.Adapter adapter = new MainAdapter(mainData);
recyclerView.setAdapter(adapter);</pre></div></li><li class="listitem">You can now test the project on an emulator or a handset.</li></ol></div><p>Most of the <a id="id163" class="indexterm"/>work of the Adapter is carried out by the ViewHolder. This class is responsible, as its name suggests, for holding information about each of the views in our RecyclerView, including a view's metadata and its position in the list. We use the class definition and constructor to define three views that are associated with those in our card layout. The ViewHolder requires three callback methods, <code class="literal">onCreateViewHolder()</code>, which inflates the CardView and performs any other operations on it such as adding an <code class="literal">onClickListener</code>, <code class="literal">onBindViewHolder()</code>. This takes the ViewHolder's version of our card's inner views and connects them to our data, and <code class="literal">getItemCount()</code>, which returns the length of our list.</p><p>Finally, to connect the data to the RecyclerView, we build our ArrayList <code class="literal">mainData</code> and then set up a new <code class="literal">MainAdapter</code> from <code class="literal">mainData</code> and connect the RecyclerView to its Adapter with the <code class="literal">setAdapter()</code> method.</p><p>With our RecyclerView in place and connected to our dataset with an Adapter, we are ready to add a click listener and a second activity.</p></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec25"/>Responding to the RecyclerView selections</h1></div></div></div><p>Having <a id="id164" class="indexterm"/>successfully produced a RecyclerView, and populated it with CardViews containing our data, we need to be able to select individual items and do something with them. Next, we will provide the RecyclerView with <a id="id165" class="indexterm"/>a <strong>click listener</strong> and add a new Activity that will present our records in greater detail on a separate screen.</p><div><div><div><div><h2 class="title"><a id="ch04lvl2sec21"/>Creating the OnClickListener</h2></div></div></div><p>Before we <a id="id166" class="indexterm"/>create our new Activity, we<a id="id167" class="indexterm"/> need an <code class="literal">OnClickListener</code> that can tell which CardView was clicked on. Here's how it's done:</p><div><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">MainActivity</code> class.</li><li class="listitem">Add the following class member:<div><pre class="programlisting">static View.OnClickListener mainOnClickListener;</pre></div></li><li class="listitem">Assign the listener in the <code class="literal">onCreate()</code> method like this:<div><pre class="programlisting">mainOnClickListener = new MainOnClickListener(this);</pre></div></li><li class="listitem">Create<a id="id168" class="indexterm"/> the following<a id="id169" class="indexterm"/> class:<div><pre class="programlisting">private class MainOnClickListener implements View.OnClickListener {
  private final Context context;

  private MainOnClickListener(Context c) {
    this.context = c;
  }

  @Override
  public void onClick(View v) {
    currentItem = recyclerView.getChildPosition(v);
    startActivity(new Intent(getApplicationContext(), DetailActivity.class));
  }
}</pre></div></li></ol></div><p>This is very similar to the way that we implemented the <code class="literal">OnClickListener</code> before, only here, rather than assigning it to just a single view, we made it available to the whole class. This means that we must construct the listener in such a way as to pass the <code class="literal">Context</code> object of the calling view. The <code class="literal">onClick()</code> method is a good time to record which view was clicked on with the RecyclerView's <code class="literal">getChildPosition()</code> method. With this done, it is now a matter of creating the new Activity.</p></div><div><div><div><div><h2 class="title"><a id="ch04lvl2sec22"/>Adding the new Activity</h2></div></div></div><p>The last method <a id="id170" class="indexterm"/>we entered will have generated an <a id="id171" class="indexterm"/>error message, as the class <code class="literal">DetailActivity</code> does not yet exist. The Activity will display greater detail about our ancient sites and provide a web link to each site's Wikipedia page.</p><div><div><div><div><h3 class="title"><a id="ch04lvl3sec03"/>Creating the portrait layout</h3></div></div></div><p>As is often the <a id="id172" class="indexterm"/>case, there are two parts to creating an Android Activity, and before we can write the code, we need to define its layouts. To do this, follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a new vertical <code class="literal">LinearLayout</code> XML file in the <code class="literal">layout</code> directory and call it <code class="literal">activity_detail</code>.</li><li class="listitem">In the design mode, create a layout to match the following component tree and provide the <a id="id173" class="indexterm"/>views with the IDs and contents, as shown:<div><img src="img/B04321_04_07.jpg" alt="Creating the portrait layout"/></div></li><li class="listitem">If you have not downloaded the project files, find or create a small image, suitable for use as a web icon, about 48 x 48 px. Call it <code class="literal">web_icon.png</code> and place it in your <code class="literal">drawable</code> directory.</li><li class="listitem">Adjust the view's properties to match the structure shown here:<div><img src="img/B04321_04_08.jpg" alt="Creating the portrait layout"/></div></li><li class="listitem">Set the <a id="id174" class="indexterm"/>following properties on the ImageView <code class="literal">detail_image</code>:<div><pre class="programlisting">android:layout_height="0dp"
android:layout_gravity="center_horizontal"
android:layout_weight="3"</pre></div></li><li class="listitem">Add <code class="literal">android:textAppearance="?android:attr/textAppearanceLarge"</code> to the <code class="literal">detail_name</code> TextView:</li><li class="listitem">The TextView <code class="literal">detail_distance</code> should have <code class="literal">android:textAppearance="?android:attr/textAppearanceMedium"</code> set.</li><li class="listitem">The <code class="literal">detail_text</code> TextView needs these properties:<div><pre class="programlisting">android:layout_height="0dp"
android:layout_weight="2"
android:textAppearance="?android:attr/textAppearanceSmall"
android:maxLines = "100"
android:scrollbars = "vertical"</pre></div></li><li class="listitem"> With the <code class="literal">detail_web_icon</code> ImageView, set <code class="literal">layout_gravity</code> to <code class="literal">"right"</code>.</li></ol></div><p>There is<a id="id175" class="indexterm"/> nothing in this process that we have not encountered before, apart from the two properties in the <code class="literal">detail_text</code> TextView, <code class="literal">maxLines</code> and <code class="literal">scrollbars</code>, and these are self-explanatory. The text we have allocated to this view may well be too long for many smaller screens and so we have set this view up to be scrollable. There is still a line of code we need to add in Java to fully implement this, but we will come to that shortly.</p><p>The use of <code class="literal">layout_weight</code> to define our layout means that, even when we rotate the screen, all of the views will remain in view. Nevertheless, if you test this on a device, you will see that this is not an attractive or space efficient layout. Next, we will redesign the landscape layout to more suitably fit the orientation.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec04"/>Creating the landscape layout</h3></div></div></div><p>The<a id="id176" class="indexterm"/> vertical linear layout we designed is not at all well suited to a landscape screen. To best fill the space, it is not enough to simply rearrange the views, we will need to change the root layout to a horizontal orientation and insert a vertical layout for the text and web icon. Follow these steps to create the layout:</p><div><ol class="orderedlist arabic"><li class="listitem">If it is not open already, open the <code class="literal">activity_detail.xml</code> file in design mode or in text mode with the preview pane open.</li><li class="listitem">Select <strong>Create Landscape Variation</strong> from the preview drop-down, as follows:<div><img src="img/B04321_04_09.jpg" alt="Creating the landscape layout"/></div></li><li class="listitem">Open<a id="id177" class="indexterm"/> the <code class="literal">detail_activity.xml</code> (land) file in the text mode.</li><li class="listitem">In <code class="literal">detail_image</code> ImageView, change the following lines:<div><pre class="programlisting">android:layout_width="0dp"
android:layout_height="wrap_content"
android:layout_gravity="center_vertical"</pre></div></li><li class="listitem">Insert the following vertical linear layout, so that it contains the three TextViews and the other ImageView:<div><pre class="programlisting">&lt;LinearLayout
  android:orientation="vertical"
  android:layout_width="0dp"
  android:layout_weight="3"
  android:layout_height="fill_parent"&gt;

  &lt; TextView ... /&gt;
  &lt; TextView ... /&gt;
  &lt; TextView ... /&gt;
  &lt; ImageView ... /&gt;

&lt;/LinearLayout&gt;</pre></div></li><li class="listitem">Change these lines in the <code class="literal">detail_text</code> TextView:<div><pre class="programlisting">android:layout_height="0dp"
android:layout_weight="2"
android:layout_gravity="left"</pre></div></li><li class="listitem">And, add this one:<div><pre class="programlisting">android:layout_marginLeft="8dp"</pre></div></li></ol></div><p>The<a id="id178" class="indexterm"/> landscape layout should now look like this:</p><div><img src="img/B04321_04_10.jpg" alt="Creating the landscape layout"/></div><p>There is nothing here that we have not encountered before. However, it is worth noting that, although it would have taken more time, we could have used a <code class="literal">RelativeLayout</code> for this purpose and had we done so, we would not have needed the inner vertical <code class="literal">LinearLayout</code>. ViewGroups, such as Layouts, require a considerable amount of memory, and although it does not matter for a small app such as this one, it is a good practice to keep the number of view containers to a minimum. Rebuilding <code class="literal">activity_detail.xml</code> (land) as a <code class="literal">RelativeLayout</code> is left as an exercise for the reader.</p><p>All that<a id="id179" class="indexterm"/> remains now is to create the Java Activity class <code class="literal">ActivityDetail</code>, which will select and display its content according to the card that was clicked on.</p></div><div><div><div><div><h3 class="title"><a id="ch04lvl3sec05"/>Connecting Views to web pages</h3></div></div></div><p>The <code class="literal">ActivityDetail</code> class is not at all complicated, although we do get to add the Java component<a id="id180" class="indexterm"/> of the code, which will make our TextView scrollable and we also get to see how we can use an <code class="literal">Intent</code> object to launch the browser and open a specific web page. Follow these steps to complete the Activity:</p><div><ol class="orderedlist arabic"><li class="listitem">From the project explorer, by right-clicking any of the classes we have already constructed, create a new Activity by selecting <strong>New</strong> | <strong>Activity</strong> | <strong>Blank Activity</strong>, calling the file <code class="literal">DetailActivity</code> and accepting the other values the dialog suggests.</li><li class="listitem">Open the <code class="literal">DetailActivity</code> Java code.</li><li class="listitem">Change the line <code class="literal">setContentView(R.layout.activity_detail2);</code> in <code class="literal">onCreate()</code> to the following:<div><pre class="programlisting">setContentView(R.layout.activity_detail);</pre></div></li><li class="listitem">When you created the Activity, the IDE will have created a matching layout file <code class="literal">activity_detail2</code>. Delete this file by selecting it in the project explorer and pressing <em>Delete</em>.</li><li class="listitem">Add the following class wide fields:<div><pre class="programlisting">private ImageView detailImage;
private ArrayList&lt;MainDataDef&gt; detailData;</pre></div></li><li class="listitem">Assign them like this:<div><pre class="programlisting">detailImage = (ImageView) findViewById(R.id.detail_image);
TextView detailName = (TextView) findViewById(R.id.detail_name);
TextView detailDistance = (TextView) findViewById(R.id.detail_distance);

TextView detailText = (TextView) findViewById(R.id.detail_text);
detailText.setMovementMethod(new ScrollingMovementMethod());

ImageView detailWebLink = (ImageView) findViewById(R.id.detail_web_link);</pre></div></li><li class="listitem">Still in <code class="literal">onCreate()</code>, add these lines to link our views to our data:<div><pre class="programlisting">int i = MainActivity.currentItem;
Random n = new Random();
int m = n.nextInt((600 - 20) + 1) + 20;

setTitle(getString(R.string.app_name) + " - " + MainData.nameArray[i]);

detailImage.setImageResource(MainData.detailImageArray[i]);
detailName.setText(MainData.nameArray[i]);
detailDistance.setText(String.valueOf(m) + " miles");
detailText.setText(MainData.detailTextArray[i]);</pre></div></li><li class="listitem">Beneath<a id="id181" class="indexterm"/> that, add these lines to program the web link:<div><pre class="programlisting">detailWebLink.setOnClickListener(new View.OnClickListener() {

  @Override
  public void onClick(View v) {
    Intent intent = new Intent();
    intent.setAction(Intent.ACTION_VIEW);
    intent.addCategory(Intent.CATEGORY_BROWSABLE);
    intent.setData(Uri.parse(MainData.detailWebLink[MainActivity.currentItem]));
    startActivity(intent);
  }
});</pre></div></li><li class="listitem">Run the app on an emulator or a handset. Hopefully, the second activity will look like this:<div><img src="img/B04321_04_11.jpg" alt="Connecting Views to web pages"/></div></li></ol></div><p>The<a id="id182" class="indexterm"/> Activity wizard automatically created a layout file for us, even though we had already created one, which is why we had to edit the <code class="literal">ContentView</code> of the Activity and delete the unwanted XML file. We could have of course constructed our class from scratch and avoided doing this, but the Activity wizard builds a time saving class template for us, including all the required members.</p><p>The naming and assigning of our views requires no explanation. However, this section of code also provides the final part of our scrollable TextView by calling its <code class="literal">setMovementMethod(new ScrollingMovementMethod())</code>.</p><p>We used the public field <code class="literal">currentItem</code> to access our data, which we kept in the same array list for convenience. We filled the distance field with a random number for now, but we will return to make this function operate correctly when we get to geo-locations later in the book.</p><p>Linking views to web pages is new and requires explanation. This is the only view in the layout that is clickable, so it is a simple matter to provide it with its own <code class="literal">OnClickListener</code>. Here, we get to see the <code class="literal">Intent</code> object in more detail and also just how useful it can be. The <code class="literal">setAction()</code> method tells the Intent which action to perform, in the form<a id="id183" class="indexterm"/> of a static, final String which here is <code class="literal">ACTION_VIEW</code>, the most <a id="id184" class="indexterm"/>widely used <strong>Intent action</strong>, and it tells the Intent to display the data in the most appropriate way. This means that, more often than not, the system will select the correct way to display the data, such as displaying images in an ImageView, contacts in the contacts app, and web pages in the default browser.</p><div><div><h3 class="title"><a id="note09"/>Note</h3><p>Note that, there is a corresponding <code class="literal">Intent.getAction()</code> method for when we need to know what action has been set to an Intent.</p></div></div><p>The <code class="literal">addCategory(Intent.CATEGORY_BROWSABLE)</code> call is not strictly necessary and the app will run fine without it in most circumstances. <strong>Intent categories</strong> cause the Intent to only consider <a id="id185" class="indexterm"/>apps (or more accurately, activities), that are labeled with that category when resolving the action. To place an app in one or more categories, add them to the <code class="literal">&lt;intent-filter&gt;</code> tab in the manifest file like so: <code class="literal">&lt;category android:name="android.intent.category.CATEGORY"/&gt;</code>. The <code class="literal">Intent</code> object defines a wide selection of category constants, such as, <code class="literal">APP_MUSIC, APP_MESSAGING</code>, and <code class="literal">APP_CALENDAR</code>.</p><p>With the second Activity and its layout files in place, we can now display detailed information about each of our ancient sites and provide a link to the web page with further information. With this done, we have completed the exercise.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch04lvl1sec26"/>Summary</h1></div></div></div><p>In this chapter, we have constructed a small but complete app. The structure is by no means dictated by the subject matter and is such that it could be applied to any number of apps. We took advantage of both of Android's latest widgets and produced a RecyclerView list of CardViews, which displayed a simple dataset. In doing this, we saw how to connect our data to our views with an Adapter and how this in turn uses a ViewHolder to maintain our individual views and layouts. Adding an <code class="literal">OnClickListener</code> allowed the user to select data items and navigate to a new screen with further information and a link to a website.</p><p>Next, we will delve deeper into the RecyclerView and see how to move items up and down the list. To do this, we will first have to learn how to detect a swipe gesture from the user, using an <code class="literal">OnTouchListener</code>.</p></div></body></html>