<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Apple Pay API Summary</h1></div></div></div><p>You process Apple Pay transactions in three phases:</p><div><ol class="orderedlist arabic"><li class="listitem"><strong>Preparation</strong>: Create a payment request and populate it with payment information and details <a id="id220" class="indexterm"/>about the product the user is purchasing.</li><li class="listitem"><strong>Payment sheet interaction</strong>: Respond to<a id="id221" class="indexterm"/> user interactions with the payment sheet (such as changes to the shipping address or the desired shipping method) through the methods of the <code class="literal">PKPaymentAuthorizationViewControllerDelegate</code> protocol.</li><li class="listitem"><strong>Payment processing</strong>: Process the <a id="id222" class="indexterm"/>Apple Pay transaction on the user's device and your own servers through the API provided by your payment gateway and HTTP requests to your order processing web app.</li></ol></div><p>Earlier chapters showed the workflows you use to interact with the major actors in Apple Pay transactions. This chapter provides helpful information on the classes, methods, and properties of the Apple Pay API that you must become familiar with to use it effectively. However, when you need even more detailed information, you should consult the Apple developer documentation.</p><p>In this chapter, you will learn about the major Apple Pay classes involved in payment transactions, such as the <code class="literal">PKPaymentReqest</code> and <code class="literal">PKPaymentSummaryItem</code> classes. You will also learn how to respond to payment sheet events through the <code class="literal">PKPaymentAuthorizationViewControllerDelegate</code> protocol. Finally, the chapter will describe the additional classes that the Apple Pay API uses to work with addresses, such as the <code class="literal">PKContact</code> class.</p><p>This chapter covers the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Major Apple Pay classes involved in payment transactions, such as the <code class="literal">PKPaymentReqest</code> and <code class="literal">PKPaymentSummaryItem</code> classes</li><li class="listitem" style="list-style-type: disc">Responses to payment sheet events through the <code class="literal">PKPaymentAuthorizationViewControllerDelegate</code> protocol</li><li class="listitem" style="list-style-type: disc">Additional classes that the Apple Pay API uses to work</li></ul></div><div><div><div><div><h1 class="title"><a id="ch06lvl1sec38"/>Main classes</h1></div></div></div><p>This section describes the major Apple Pay classes you use to process Apple Pay transactions. These classes include:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentButton</code>: You use<a id="id223" class="indexterm"/> this class to display<a id="id224" class="indexterm"/> a <strong>Pay</strong> button, which the user uses to begin an Apple Pay transaction.</li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentRequest</code>: This class <a id="id225" class="indexterm"/>represents a payment request, which<a id="id226" class="indexterm"/> the user authorizes or cancels in the payment sheet.</li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentSummaryItem</code>: Instances of this class represent summary items (such as subtotal, shipping costs, and total) in the payment sheet.</li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentMethod</code>: This class provides access to information about the payment card used in Apple Pay transaction.</li><li class="listitem" style="list-style-type: disc"><code class="literal">PKShippingMethod</code>: Instances of this class represent the shipment methods you support.</li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentAuthorizationViewController</code>: This class determines whether the user can use Apple Pay on the device. It is also used to present the payment sheet on the screen.</li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPayment</code>: Instances of this class store payment information for Apple Pay transactions.</li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentToken</code>: Instances of this class contain encrypted payment information ready to be submitted to a payment processor to charge the user's payment card.</li></ul></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec29"/>The PKPaymentButton class</h2></div></div></div><p>The <code class="literal">PKPaymentButton</code> class provides users with a button they tap to start an Apple Pay transaction. You should use <a id="id227" class="indexterm"/>Apple Pay buttons to start only Apple Pay transactions.</p><p>Before displaying the <strong>Apple</strong>
<strong> Pay</strong> button, you must ensure that the device supports Apple Pay by calling the <code class="literal">canMakePayments</code> method of the <code class="literal">PKPaymentAuthorizationViewController</code> class. You should also call either <code class="literal">canMakePaymentsUsingNetworks:</code> or <code class="literal">canMakePaymentsUsingNetworks:capabilities:</code> of the same class to ensure that the user's payment cards support the payment networks and payment processor capabilities you require. Refer to <em>The PKPaymentAuthorizationViewController class</em> later in this section for details.</p><p>If the device does not support Apple Pay, or the payment cards that the user has added to the device are not compatible with the payment networks and payment processor capabilities you require, use a standard<a id="id228" class="indexterm"/> button with a title such as <strong>Buy</strong> to start standard payment transactions.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec01"/>Creating the button</h3></div></div></div><p>Use this method to create <a id="id229" class="indexterm"/>a <strong>Apple</strong>
<strong> Pay</strong> button. Use Apple Pay buttons only for Apple Pay transactions.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec01"/>+buttonWithType:style</h4></div></div></div><p>This method <a id="id230" class="indexterm"/>provides an <strong>Apple</strong>
<strong> Pay</strong> button.</p><p>Here are the arguments:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">type</code> (<code class="literal">PKPaymentButtonType</code>): This specifies the button's title. The options are plain (<strong>Pay</strong>), buy (<strong>Buy with Pay</strong>), and set up (<strong>Set up Pay</strong>). To learn more about using the last option, refer to <em>Apple Pay Programming Guide</em> in the Apple Developer library.</li><li class="listitem" style="list-style-type: disc"><code class="literal">style</code> (<code class="literal">PKPaymentButtonStyle</code>): This specifies the button's appearance. Use it to ensure that the button stands out from the background. The options are white, white outline, and black.</li></ul></div></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec30"/>The PKPaymentRequest class</h2></div></div></div><p>The <code class="literal">PKPaymentRequest</code> class<a id="id231" class="indexterm"/> represents a request for payment for particular goods. This is the main class you use in Apple Pay transactions. You can use one instance of this class per Apple Pay transaction. A payment request contains information about the merchant requesting the payment, the country where the payment is to be processed, the currency to use, the price of the items for which the payment is requested (including shipping cost, tax, and so on), and the supported payment networks (such as Amex, Discover, and Visa).</p><p>When the user authorizes a payment request in the payment sheet, you will get a <code class="literal">PKPayment</code> object, which you need to submit to your payment gateway to obtain a <code class="literal">PKPaymentToken</code> object (or a substitute), which, in turn, you can use in your order processing system to charge the user's payment card.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec02"/>Payment processing information</h3></div></div></div><p>These required properties<a id="id232" class="indexterm"/> specify information that your payment gateway uses to process the payment. These should be the first things you set on a payment request.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec02"/>countryCode (NSString*)</h4></div></div></div><p>This is a two-letter code (ISO 3166) for the <a id="id233" class="indexterm"/>country in which the payment is to be processed, for example <code class="literal">"US"</code>.</p><p>This code sets the <code class="literal">countryCode</code> property of a payment request to <code class="literal">US</code>, as follows:</p><div><pre class="programlisting">_payment_request.countryCode=@"US";</pre></div></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec03"/>currencyCode (NSString*)</h4></div></div></div><p>This is a three-letter code (ISO 4217) for the <a id="id234" class="indexterm"/>currency to be used to process the payment, for example <code class="literal">"USD".</code>
</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec04"/>merchantCapabilities (PKMerchantCapability)</h4></div></div></div><p>These are the payment processing protocols your payment gateway supports. The 3-D Secure protocol is required. Other <a id="id235" class="indexterm"/>protocols available are EMV (Europay, MasterCard, Visa), credit card, and debit card.</p><p>These constants identify the following payment processing capabilities that Apple Pay supports:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">PKMerchantCapability3DS</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKMerchantCapabilityEMV</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKMerchantCapabilityCredit</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKMerchantCapabilityDebit</code></li></ul></div><p>The following code sets the <code class="literal">merchantCapabilities</code> property of a payment request to 3D Secure and EMV:</p><div><pre class="programlisting">_payment_request.merchantCapabilities= 
  PKMerchantCapability3DS | PKMerchantCapabilityEMV;</pre></div></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec05"/>merchantIdentifier (NSString*)</h4></div></div></div><p>This is a merchant identifier stored in<a id="id236" class="indexterm"/> your project's <code class="literal">Entitlements</code> file.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec06"/>supportedNetworks (NSArray&lt;NSString*&gt;*)</h4></div></div></div><p>This includes the payment networks (or associations) you support. The options available are Discover, MasterCard, Visa, and<a id="id237" class="indexterm"/> private label (store card).</p><p>These constants identify the following payment networks that Apple Pay supports:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentNetworkAmex</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentNetworkDiscover</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentNetworkMasterCard</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentNetworkPrivateLabel</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentNetworkVisa</code></li></ul></div><p>For example, this code sets the <code class="literal">supportedNetworks</code> property of a payment request to Amex and MasterCard:</p><div><pre class="programlisting">_payment_request.supportedNetworks= 
  PKPaymentNetworkAmex | PKPaymentNetworkMasterCard;</pre></div></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec03"/>Payment summary items</h3></div></div></div><p>Summary items identify and price the <a id="id238" class="indexterm"/>product that the customer is purchasing (the subtotal) and related items, such as the tax, shipping cost, and total.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec07"/>paymentSummaryItems (NSArray&lt;PKPaymentSummaryItem*&gt;*)</h4></div></div></div><p>This is an array of <a id="id239" class="indexterm"/>summary items, which specify a label and price for each item. Additionally, you can identify an item as <em>pending</em> (the price is not yet set, but it will be determined after the service is complete, such as for a taxi ride) or <em>final</em>. Refer to the <em>The PKSummaryItem class</em> section for details.</p></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec04"/>The required address fields</h3></div></div></div><p>These properties specify which fields<a id="id240" class="indexterm"/> of the billing and shipping address you require to be entered in the payment sheet so that they are available in the <code class="literal">PKPayment</code> object provided by the payment sheet when the user authorizes the payment request.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec08"/>requiredBillingAddressFields (PKAddressField), requiredShippingAddressFields (PKAddressField)</h4></div></div></div><p>If you<a id="id241" class="indexterm"/> require a name, e-mail, and postal address in<a id="id242" class="indexterm"/> the shipping information, you can use code similar to this:</p><div><pre class="programlisting">payment_request.requiredShippingAddressFields= 
    PKAddressFieldName | PKAddressFieldEmail | PKAddressFieldPostalAddress;</pre></div><p>These are the address field specifier constants:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">PKAddressFieldNone</code> (no field is required)</li><li class="listitem" style="list-style-type: disc"><code class="literal">PKAddressFieldPostalAddress</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKAddressFieldPhone</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKAddressFieldEmail</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKAddressFieldName</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKAddressFieldAll</code></li></ul></div></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec05"/>Billing and shipping contacts</h3></div></div></div><p>These properties specify the<a id="id243" class="indexterm"/> billing and shipping contact information. You can set them before displaying the payment sheet (however, this is<a id="id244" class="indexterm"/> not recommended because the user is most likely to have up-to-date contact information). The user can also change them by picking or specifying a different contact on the payment sheet.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec09"/>billingContact (PKContact*), shippingContact (PKContact*)</h4></div></div></div><p>These are<a id="id245" class="indexterm"/> the components<a id="id246" class="indexterm"/> of a <code class="literal">PKContact</code> object:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">emailAddress    (NSString*)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">name            (NSPersonNameComponents*)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">phoneNumber     (CNPhoneNumber*)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">postalAddress   (CNPostalAddress*)</code></li></ul></div></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec06"/>Shipping methods</h3></div></div></div><p>Shipping methods are the shipping <a id="id247" class="indexterm"/>options (carriers or speed) that <a id="id248" class="indexterm"/>you support.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec10"/>shippingMethods (NSArray&lt;PKShippingMethod*&gt;*)</h4></div></div></div><p>This property contains the set of shipping <a id="id249" class="indexterm"/>methods available to the customer.</p><p>Each <code class="literal">PKShippingMethod</code> object has these properties:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">detail (NSString*)</code>: This describes the shipping method to the user, for example <code class="literal">"Delivers in four days"</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">identifier (NSString*)</code>: This identifies the shipping method within the app. When the user selects a shipping<a id="id250" class="indexterm"/> method, use this property to identify the method chosen.</li></ul></div></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec07"/>Shipping type</h3></div></div></div><p>This specifies the way in which the product is<a id="id251" class="indexterm"/> transported, for example whether it is shipped by the merchant, or picked up by the customer from the<a id="id252" class="indexterm"/> merchant's store.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec11"/>shippingType (PKShippingType)</h4></div></div></div><p>These are the shipping types available:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">PKShippingTypeShipping</code> (default): The merchant ships the product to the customer using the shipping method that the<a id="id253" class="indexterm"/> customer selects.</li><li class="listitem" style="list-style-type: disc"><code class="literal">PKShippingTypeDelivery</code>: The merchant delivers (using a vehicle) the product to the customer. This is<a id="id254" class="indexterm"/> used for food, groceries, furniture, or specialty items that cannot be shipped.</li><li class="listitem" style="list-style-type: disc"><code class="literal">PKShippingTypeStorePickup</code>: The customer picks up the product from the merchant's store. In this case, set <code class="literal">shippingContact</code> to your store's address or hide it from the <a id="id255" class="indexterm"/>payment sheet by setting <code class="literal">requiredShippingAddressFields</code> to <code class="literal">PKAddressFieldNone</code>. Remember to confirm the pickup location with the customer in a reliable way.</li><li class="listitem" style="list-style-type: disc"><code class="literal">PKShippingTypeServicePickup</code>: The <a id="id256" class="indexterm"/>merchant picks up an object from the address specified in <code class="literal">shippingContact</code> (for example, when the customer is paying to have something delivered).</li></ul></div></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec08"/>Application data</h3></div></div></div><p>This property <a id="id257" class="indexterm"/>stores the hash of an <code class="literal">NSData</code> object.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec12"/>applicationData (NSData*)</h4></div></div></div><p>When set, this property contains <a id="id258" class="indexterm"/>a hash of the data specified (it does not, however, contain the value of the data). If your payment gateway supports it, the <code class="literal">paymentData</code> property of the <code class="literal">PKPaymentToken</code> object you get from the payment gateway API is set to the same hash value generated when you set <code class="literal">applicationData</code>. You can send this hash as part of sending payment information to your order-processing server. Separately, you can send the actual data to your server. You can then compute the hash on your server and compare the two hashes to ensure that the data was not changed in transit.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec31"/>The PKPaymentSummaryItem class</h2></div></div></div><p>The <code class="literal">PKPaymentSummaryItem</code> class represents an item for which the customer is paying, such as the subtotal representing the <a id="id259" class="indexterm"/>product price, tax, shipping cost, and so on. You can identify one or more items as "pending" (the price cannot be<a id="id260" class="indexterm"/> determined until some time in the future) or "final". The payment sheet does not show the price of "pending" items; therefore, you should set the price of such items to zero. You can compute the actual price when the service (such as a taxi ride) is completed and report it to the customer when the transaction is complete.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec09"/>Creating a summary item</h3></div></div></div><p>These methods<a id="id261" class="indexterm"/> create summary<a id="id262" class="indexterm"/> items.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec13"/>+summaryItemWithLabel:amount:</h4></div></div></div><p>This creates a "final" summary<a id="id263" class="indexterm"/> item with a label and amount.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec14"/>+summaryItemWithLabel:amount:type:</h4></div></div></div><p>This creates a "pending" or "final" summary item with a label and amount.</p><p>The following code creates <a id="id264" class="indexterm"/>a "pending" summary item:</p><div><pre class="programlisting">PKPaymentSummaryItem* trip= 
[PKPaymentSummaryItem 
      summaryItemWithLabel: @"Trip"
                                 amount: [NSDecimalNumber zero] 
                                      type: PKPaymentSummaryItemTypePending];</pre></div></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec10"/>Summary item components</h3></div></div></div><p>These properties<a id="id265" class="indexterm"/> access the components of a summary item.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec15"/>label (NSString*)</h4></div></div></div><p>This is the label of the <a id="id266" class="indexterm"/>summary item.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec16"/>amount (NSDecimalNumber*)</h4></div></div></div><p>This is the price of the <a id="id267" class="indexterm"/>summary item (it is shown in the payment sheet if the item is "final").</p></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec11"/>Pending or final</h3></div></div></div><p>This property <a id="id268" class="indexterm"/>determines the type of the summary item.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec17"/>type (PKPaymentSummaryItemType)</h4></div></div></div><p>This specifies <a id="id269" class="indexterm"/>whether the item is "pending" or "final."</p><p>These are the possible values of the <code class="literal">type</code> property:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentSummaryItemTypeFinal</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentSummaryItemTypePending</code></li></ul></div></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec32"/>The PKPaymentMethod class</h2></div></div></div><p>The <code class="literal">PKPaymentMethod</code> class<a id="id270" class="indexterm"/> provides access to information about the payment card used in an Apple Pay transaction. When the user selects a <a id="id271" class="indexterm"/>payment card in the payment sheet, the payment sheet calls the <code class="literal">paymentAuthorizationViewController:didSelectPaymentMethod:completion:</code> method of its delegate.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec12"/>Card tame</h3></div></div></div><p>This property identifies<a id="id272" class="indexterm"/> the payment card for the <code class="literal">payment</code> method.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec18"/>displayName (NSString*)</h4></div></div></div><p>This identifies the<a id="id273" class="indexterm"/> payment card to the user.</p></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec13"/>Card type</h3></div></div></div><p>This property identifies the type of the payment card.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec19"/>type (PKPaymentMethodType)</h4></div></div></div><p>This identifies the<a id="id274" class="indexterm"/> type of payment card used (Amex, Visa, and so on). Old cards may not have this information; in this case, the value of this property is <code class="literal">PKPaymentMethodTypeUnknown</code>.</p><p>These constants identify the types of cards that Apple Pay supports:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentMethodTypeUnknown</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentMethodTypeDebit</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentMethodTypeCredit</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentMethodTypePrepaid</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentMethodTypeStore</code></li></ul></div></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec14"/>Payment network</h3></div></div></div><p>This property identifies the <a id="id275" class="indexterm"/>payment network.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec20"/>network (NSString*)</h4></div></div></div><p>This identifies the card's<a id="id276" class="indexterm"/> payment network (or association).</p><p>These constants identify the payment networks that Apple Pay supports:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentNetworkAmex</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentNetworkDiscover</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentNetworkMasterCard</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentNetworkPrivateLabel</code> (this is for store cards)</li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentNetworkVisa</code></li></ul></div></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec15"/>Payment pass</h3></div></div></div><p>This property is used <a id="id277" class="indexterm"/>with a payment pass.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec21"/>paymentPass (PKPaymentPass*)</h4></div></div></div><p>You can use this, for example, to support custom branded payment cards. Take a look at Apple's documentation<a id="id278" class="indexterm"/> for more details.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec33"/>The PKShippingMethod class</h2></div></div></div><p>The <code class="literal">PKShippingMethod</code> class represents a<a id="id279" class="indexterm"/> shipping method you support for<a id="id280" class="indexterm"/> the delivery of goods to a customer.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec16"/>User-friendly description</h3></div></div></div><p>This property provides the user<a id="id281" class="indexterm"/> with information about the shipping method.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec22"/>detail (NSString*)</h4></div></div></div><p>This describes the shipping method<a id="id282" class="indexterm"/> to the user, for example: <em>"Delivers in four days"</em>.</p></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec17"/>App-level identifier</h3></div></div></div><p>This property identifies <a id="id283" class="indexterm"/>the shipping method within the app.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec23"/>identifier (NSString*)</h4></div></div></div><p>When the user changes the<a id="id284" class="indexterm"/> shipping method, use this property to identify the shipping method chosen.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec34"/>The PKPaymentAuthorizationViewController class</h2></div></div></div><p>The <code class="literal">PKPaymentAuthorizationViewController</code> class has two functions:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">To determine<a id="id285" class="indexterm"/> whether the user can make payments with Apple Pay</li><li class="listitem" style="list-style-type: disc">To present the <a id="id286" class="indexterm"/>payment sheet to the user</li></ul></div><p>This class communicates with its delegate (which you implement) using the methods of the <code class="literal">PKPaymentAuthorizationViewControllerDelegate</code> protocol.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec18"/>Determining Apple Pay support</h3></div></div></div><p>The following methods <a id="id287" class="indexterm"/>determine whether the device supports Apple Pay and whether the payment cards that the user has added support particular payment networks and payment processing capabilities.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec24"/>+canMakePayments</h4></div></div></div><p>This indicates whether the<a id="id288" class="indexterm"/> device supports Apple Pay.</p><p>For example, to determine whether the device supports Apple Pay, you can use code similar to this:</p><div><pre class="programlisting">BOOL can_use_ApplePay= [PKPaymentAuthorizationViewController canMakePayments];</pre></div></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec25"/>+canMakePaymentsUsingNetworks:</h4></div></div></div><p>This indicates whether<a id="id289" class="indexterm"/> the user can use Apple Pay through the networks you support. If the user has not added a payment card to the device, the method returns <code class="literal">NO</code>.</p><p>You can call this method after calling <code class="literal">canMakePayments</code>.</p><p>For example, to accept only payment cards from Visa or Amex, use code similar to this:</p><div><pre class="programlisting">BOOL can_use_ApplePay_with_Amex_and_Visa= 
  [PKPaymentAuthorizationViewController
           canMakePaymentsUsingNetworks:, @[PKPaymentNetworkVisa, PKPaymentNetworkAmex];</pre></div><p>These constants identify the payment networks that Apple Pay supports:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentNetworkAmex</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentNetworkDiscover</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentNetworkMasterCard</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentNetworkPrivateLabel</code> (this is for store cards)</li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentNetworkVisa</code></li></ul></div></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec26"/>+canMakePaymentsUsingNetworks:capabilities:</h4></div></div></div><p>This indicates whether the<a id="id290" class="indexterm"/> user can use Apple Pay on the device through the payment networks and payment processing capabilities you support (such as 3D Secure and EMV). If the user has not added a compatible payment card to the device, the method returns <code class="literal">NO</code>.</p><p>You can call this method after calling <code class="literal">canMakePayments</code>.</p><p>For example, to accept only payment cards from Visa or Amex that support the 3D Secure and EMV protocols, you can use this code:</p><div><pre class="programlisting">BOOL can_use_ApplePay_with_Amex_and_Visa_debit_card= 
  [PKPaymentAuthorizationViewController
        canMakePaymentsUsingNetworks: @[PKPaymentNetworkVisa, PKPaymentNetworkAmex]
                        capabilities: PKMerchantCapability3DS | PKMerchantCapabilityEMV];</pre></div><p>These constants identify<a id="id291" class="indexterm"/>  the payment processing capabilities that Apple Pay supports:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">PKMerchantCapability3DS</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKMerchantCapabilityEMV</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKMerchantCapabilityCredit</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">PKMerchantCapabilityDebit</code></li></ul></div></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec19"/>Initializing and presenting</h3></div></div></div><p>The following methods <a id="id292" class="indexterm"/>prepare and present<a id="id293" class="indexterm"/> a payment sheet.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec27"/>-initWithPaymentRequest:</h4></div></div></div><p>This initializes an allocated <code class="literal">PKPaymentAuthorizationViewController</code> object with a payment<a id="id294" class="indexterm"/> request.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec28"/>-initWithPaymentRequest:</h4></div></div></div><p>If the user can use Apple Pay, this<a id="id295" class="indexterm"/> method initializes a payment authorization view controller (payment sheet) with the provided <code class="literal">PKPaymentRequest</code> object.</p><p>You can call this method after you configure a payment request.</p></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec20"/>Payment sheet delegate</h3></div></div></div><p>This property identifies the object to which the payment sheet reports changes to the payment request:</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec29"/>delegate id &lt;PKPaymentAuthorizationViewControllerDelegate&gt;</h4></div></div></div><p>This is the object<a id="id296" class="indexterm"/> that adopts the <code class="literal">PKPaymentAuthorizationViewControllerDelegate</code> protocol to respond to payment sheet user events.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec35"/>The PKPayment class</h2></div></div></div><p>The <code class="literal">PKPayment</code> class<a id="id297" class="indexterm"/> represents a user-authorized payment. You will get a <code class="literal">PKPayment</code> object when the user authorizes a payment request in the <a id="id298" class="indexterm"/>payment sheet (through the <code class="literal">paymentAuthorizationViewController:didAuthorizePayment:completion:</code> method of the <code class="literal">PKPaymentAuthorizationViewControllerDelegate</code> protocol). A <code class="literal">PKPayment</code> object has the payment information required by your payment gateway and the issuing and acquiring banks to process the payment, charge the user's card, and deposit the funds in your account. This is also for your order processing web app to initiate the service or ship the purchased goods to the customer after the issuing bank authorizes the transaction.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec21"/>Payment information</h3></div></div></div><p>This property contains information about the payment, which identifies the payment card used, the banks involved in the transaction, and other details:</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec30"/>token (PKPaymentToken*)</h4></div></div></div><p>This is the encrypted payment information <a id="id299" class="indexterm"/>used by the payment gateway, the issuing bank, and the acquiring bank.</p></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec22"/>Billing and shipping contacts</h3></div></div></div><p>This property contains the billing and shipping information marked as “required” in the payment request used to initialize the payment sheet:</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec31"/>billingContact (PKContact*)</h4></div></div></div><p>This contains the billing <a id="id300" class="indexterm"/>contact information for the transaction. Only the fields identified in the <code class="literal">requiredBillingAddressFields</code> property of the payment request are populated. If no fields are requested, this property will be <code class="literal">nil</code>.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec32"/>shippingContact (PKContact*)</h4></div></div></div><p>This is the shipping contact information for the transaction. Only the fields identified in the <code class="literal">requiredShippingAddressFields</code> property of the payment request are populated. If no fields are requested, this property will be <code class="literal">nil</code>.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec33"/>shippingMethod</h4></div></div></div><p>This identifies the shipping method chosen by the user from the list of shipping methods in the <code class="literal">shippingMethods</code> property of the payment request.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec36"/>The PKPaymentToken class</h2></div></div></div><p>A <code class="literal">PKPaymentToken</code> object <a id="id301" class="indexterm"/>contains the encrypted<a id="id302" class="indexterm"/> payment information used by the payment gateway and banks, the type of payment card used to fund the payment (debit, credit, or private label), and an identifier for the transaction.</p><p>Note that some payment gateway APIs do not use this class in their workflow. Instead, they provide their own payment token class. The example project, which uses Stripe, uses the <code class="literal">STPToken</code> class. Take a<a id="id303" class="indexterm"/> look at the <code class="literal">process_ApplePay_payment_with_Stripe:completion:</code> method of the <code class="literal">ProductCard</code> class (<code class="literal">ProductCard.m</code>) for details.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec23"/>Encrypted payment information</h3></div></div></div><p>This property is <a id="id304" class="indexterm"/>decrypted only by the entities authorized to do so, such as your payment gateway.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec34"/>paymentData (NSData*)</h4></div></div></div><p>This is the encrypted payment information for the transaction.</p></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec24"/>Payment method and transaction identifier</h3></div></div></div><p>These properties provide information about the payment token.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec35"/>paymentMethod (PKPaymentMethod*)</h4></div></div></div><p>This is the payment method to use for the transaction.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec36"/>transactionIdentifier (NSString*)</h4></div></div></div><p>This is the identifier for the transaction that is assigned by your payment gateway.</p></div></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec39"/>Payment sheet user event protocol</h1></div></div></div><p>This section describes the <a id="id305" class="indexterm"/>protocol used by the payment sheet to communicate with its delegate.</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec37"/>The PKPaymentAuthorizationViewControllerDelegate protocol</h2></div></div></div><p>The <code class="literal">PKPaymentAuthorizationViewControllerDelegate</code> protocol specifies the set of methods that the payment sheet uses to communicate events to its delegate (which you can implement to respond to<a id="id306" class="indexterm"/> calls to these methods). The following sections identify the actions that the user can perform in the payment sheet and the delegate<a id="id307" class="indexterm"/> methods called when the user performs them.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec25"/>The user chooses a payment card</h3></div></div></div><p>The user can switch<a id="id308" class="indexterm"/> payment cards in the payment sheet (that is, if the user added more than one payment card to Apple Pay on the device).</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec37"/>-paymentAuthorizationViewController:didSelectPaymentMethod: completion:</h4></div></div></div><p>This is called when the user chooses a payment card. If the payment card affects the payment request's summary items (for example, if you provide a discount to use a store card), you must compute the summary items (which are an array of <code class="literal">PKPaymentSummaryItem</code> objects) for the payment request. In any event, you must provide the summary items array as the argument to this method's completion handler.</p></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec26"/>The user selects a shipping address</h3></div></div></div><p>The user can select a shipping <a id="id309" class="indexterm"/>address from a list of previously entered addresses or enter a new one in the payment sheet.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec38"/>-paymentAuthorizationViewController:didSelectShippingContact: completion:</h4></div></div></div><p>This is called after the user specifies a shipping address. The payment sheet provides the shipping address in the <code class="literal">PKContact* contact</code> parameter. This shipping address is anonymized (that is, it excludes personal information). In the U.S., this information includes only city, state, and zip code.</p><p>If your shipping methods vary depending on the shipping address, in this method, you should create an array of the shipping methods that are available for the new shipping address. You should also recompute the summary item array for the payment request using the first shipping method in the recomputed shipping method array to compute shipping costs (the payment sheet selects the first shipping method in the shipping method array).</p><p>The completion block for this method takes three arguments: <code class="literal">status</code>, <code class="literal">shippingMethods</code>, and <code class="literal">summaryItems</code>:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">status</code>: This indicates whether the shipping address is valid. If the shipping address the user specified is correct, set this argument to <code class="literal">PKPaymentAuthorizationStatusSuccess</code>. Otherwise, set its value to <code class="literal">PKPaymentAuthorizationStatusInvalidShippingPostalAddress</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">shippingMethods</code>: This is the recomputed shipping method array.</li><li class="listitem" style="list-style-type: disc"><code class="literal">summaryItems</code>: This is the recomputed summary item array.</li></ul></div></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec27"/>The user selects a shipping method</h3></div></div></div><p>The user can select a shipping method<a id="id310" class="indexterm"/> from the list of shipping methods you support (this is stored in the <code class="literal">shippingMethods</code> property of the payment request).</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec39"/>-paymentAuthorizationViewController:didSelectShippingMethod: completion:</h4></div></div></div><p>This is called when the user selects a shipment method. If the shipment method that the user chooses affects the payment request's summary items (for example, if the shipment methods have different prices), you must recompute the summary items (an array of <code class="literal">PKPaymentSummaryItem</code> objects) for the payment request.</p><p>The completion block for this method takes two arguments: <code class="literal">status</code>, and <code class="literal">summaryItems</code>.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">status</code>: This indicates whether the shipping method and shipping address (specified in the call to the <code class="literal">paymentAuthorizationViewController:didSelectShippingContact:completion:</code> delegate method) are valid. If the shipping address the user specified is correct, set this argument to <code class="literal">PKPaymentAuthorizationStatusSuccess</code>. Otherwise, set its value to <code class="literal">PKPaymentAuthorizationStatusInvalidShippingPostalAddress</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">summaryItems</code>: This is the recomputed summary item array.</li></ul></div></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec28"/>The user authorizes the payment request</h3></div></div></div><p>After the user confirms or <a id="id311" class="indexterm"/>changes the information in the payment sheet, the user can authorize the payment request to proceed with the Apple Pay transaction.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec40"/>-paymentAuthorizationViewControllerWillAuthorizePayment:</h4></div></div></div><p>This is called after the user authenticates the payment sheet but before <code class="literal">paymentAuthorizationViewController:didAuthorizePayment:completion:</code> is called. Use this method to prepare for authorization.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec41"/>-paymentAuthorizationViewController:didAuthorizePayment: completion: </h4></div></div></div><p>This is called after the user authorizes the payment request. This is where you process the payment with your payment gateway. When done, you must call the completion handler block (<code class="literal">(void (^)(PKPaymentAuthorizationStatus status)) completion</code>) with the appropriate value for the status argument.</p><p>These are the possible values for the <code class="literal">status</code> argument of the completion handler:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentAuthorizationStatusSuccess</code>: This indicates successful payment authorization by the payment card's issuing bank</li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentAuthorizationStatusFailure</code>: This indicates failure due to a failed authorization by the payment card's issuing bank</li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentAuthorizationStatusInvalidBillingPostalAddress</code>: This indicates failure due to an invalid billing address</li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentAuthorizationStatusInvalidShippingPostalAddress</code>: This indicates failure due to an invalid shipping address</li><li class="listitem" style="list-style-type: disc"><code class="literal">PKPaymentAuthorizationStatusInvalidShippingContact</code>: This indicates failure due to <a id="id312" class="indexterm"/>an invalid shipping contact</li></ul></div></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec29"/>The payment sheet is done</h3></div></div></div><p>The payment sheet is <a id="id313" class="indexterm"/>done after the user authorizes the payment request and the app processes the Apple Pay transaction, or the user cancels the payment sheet.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec42"/>-paymentAuthorizationViewControllerDidFinish:</h4></div></div></div><p>This is called when the transaction is done or the user cancels the payment sheet. You must dismiss the payment sheet and perform any other necessary updates.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec40"/>Auxiliary classes</h1></div></div></div><p>This section describes some <a id="id314" class="indexterm"/>additional classes you must use to work with the Apple Pay API. The classes are:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">PKContact</code>: This is used to<a id="id315" class="indexterm"/> represent contact information (name, phone number, and e-mail) and addresses</li><li class="listitem" style="list-style-type: disc"><code class="literal">CNPhoneNumber</code>: This is used to represent a phone number</li><li class="listitem" style="list-style-type: disc"><code class="literal">CNPostalAddress</code>: This is used to represent addresses</li></ul></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec38"/>The PKContact class</h2></div></div></div><p>The <code class="literal">PKContact</code> class contains properties<a id="id316" class="indexterm"/> that represent the components of a billing or shipping address. The payment sheet provides instances of this class to its delegate when the user selects a shipping address (<code class="literal">paymentAuthorizationViewController: didSelectShippingContact:completion:</code>), and in the <code class="literal">PKPayment</code> object it provides when the user authorizes the payment request (<code class="literal">paymentAuthorizationViewController:didAuthorizePayment:completion:</code>).</p></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec39"/>Contact address components</h2></div></div></div><p>These properties <a id="id317" class="indexterm"/>contain the information requested in the <code class="literal">requiredBillingAddressFields</code> or <code class="literal">requiredShippingAddressFields</code> properties of the <code class="literal">PKPaymentRequest</code> object. The value of properties corresponding to the unrequested address fields is <code class="literal">nil</code>.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec30"/>emailAddress (NSString*)</h3></div></div></div><p>This is the contact's <a id="id318" class="indexterm"/>e-mail address.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec31"/>name (NSPersonNameComponents*)</h3></div></div></div><p>This is the contact's<a id="id319" class="indexterm"/> name.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec32"/>phoneNumber (CNPhoneNumber*)</h3></div></div></div><p>This is the contact's <a id="id320" class="indexterm"/>phone number.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec33"/>postalAddress (CNPostalAddress*)</h3></div></div></div><p>This is the<a id="id321" class="indexterm"/> contact's postal address.</p></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec40"/>The NSPersonNameComponents class</h2></div></div></div><p>The <code class="literal">NSPersonNameComponents</code> <a id="id322" class="indexterm"/>class contains<a id="id323" class="indexterm"/> properties that represent the components of a person's name.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec34"/>Person name components</h3></div></div></div><p>These<a id="id324" class="indexterm"/> properties represent the components of a person's name.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec43"/>namePrefix (NSString*)</h4></div></div></div><p>This is<a id="id325" class="indexterm"/> a prefix (or title) used in front of a person's name, for example <code class="literal">"Dr."</code>, <code class="literal">"Ms."</code>, or <code class="literal">"Mr."</code>.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec44"/>givenName (NSString*)</h4></div></div></div><p>This is the given <a id="id326" class="indexterm"/>name (or first name) of the person.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec45"/>middleName (NSString*)</h4></div></div></div><p>This is the second <a id="id327" class="indexterm"/>name of the person.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec46"/>familyName (NSString*)</h4></div></div></div><p>This is the family <a id="id328" class="indexterm"/>name of the person (generally shared with siblings).</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec47"/>nameSuffix (NSString*)</h4></div></div></div><p>These are the letters added to a<a id="id329" class="indexterm"/> person's full name that provide additional information about the person, for example <code class="literal">"Jr."</code> or <code class="literal">"Ph.D."</code>.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec48"/>nickname (NSString)</h4></div></div></div><p>This is the familiar <a id="id330" class="indexterm"/>or humorous name used for the person.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec49"/>phoneticRepresentation (NSPersonNameComponents*)</h4></div></div></div><p>If specified, this is the <a id="id331" class="indexterm"/>phonetic representation of each of the other properties in this class, except <code class="literal">phoneticRepresentation</code>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec41"/>The CNPhoneNumber class</h2></div></div></div><p>The <code class="literal">CNPhoneNumber</code> class represents the <a id="id332" class="indexterm"/>phone number component of a <code class="literal">PKContact</code> object.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec35"/>Creating a phone number</h3></div></div></div><p>When creating a<a id="id333" class="indexterm"/> <code class="literal">PKContact</code> object, to set its <code class="literal">phoneNumber</code> property, use this method to create the <code class="literal">CNPhoneNumber</code> value to store in the property.</p><p>For example, this code sets the phone number of a contact:</p><div><pre class="programlisting">PKContact contact= [PKContact new];
contact.phoneNumber= 
  [CNPhoneNumber phoneNumberWithStringValue: @"678-555-1234"];</pre></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec50"/>+phoneNumberWithStringValue:</h4></div></div></div><p>This creates a phone number component with the text provided.</p></div></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec36"/>Phone number string</h3></div></div></div><p>This property <a id="id334" class="indexterm"/>contains a string representing the contact's phone number.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec51"/>stringValue (NSString*)</h4></div></div></div><p>This is the text representing the phone number.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec42"/>The CNPostalAddress class</h2></div></div></div><p>The <code class="literal">CNPostalAddress</code> class represents the <a id="id335" class="indexterm"/>postal address component of a <code class="literal">PKContact</code> object.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec37"/>Postal address components</h3></div></div></div><p>These properties represent the <a id="id336" class="indexterm"/>components of an address.</p><div><div><div><div><h4 class="title"><a id="ch06lvl4sec52"/>street (NSString*)</h4></div></div></div><p>This is the street address<a id="id337" class="indexterm"/> for the contact.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec53"/>city (NSString*)</h4></div></div></div><p>This is the city where the contact is<a id="id338" class="indexterm"/> located.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec54"/>state (NSString*)</h4></div></div></div><p>This is the state where the <a id="id339" class="indexterm"/>contact is located.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec55"/>postalCode (NSString*)</h4></div></div></div><p>This is the <a id="id340" class="indexterm"/>postal (or zip) code on which the contact is located.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec56"/>country (NSString*)</h4></div></div></div><p>This is the country where the <a id="id341" class="indexterm"/>contact is located.</p></div><div><div><div><div><h4 class="title"><a id="ch06lvl4sec57"/>ISOCountryCode (NSString*)</h4></div></div></div><p>This is the ISO 3166 country<a id="id342" class="indexterm"/> code for the country property.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec41"/>Summary</h1></div></div></div><p>This chapter described most of the classes you have to work with to process Apple Pay payments. It also described the protocol used by the payment sheet to communicate user actions to its delegate so that you can respond appropriately. Finally, the chapter listed a few additional classes that you must work with to access address components, such as a person's name, phone number, and postal address.</p><p>This is the end of <em>Apple Pay Essentials</em>, conceived to help you add Apple Pay support to your apps. This book introduced the world of online payments, describing how payment associations, payment gateways, and banks work together to transfer funds from a customer's payment card to a merchant's account. Apple Pay improves on this model by adding convenience, privacy, and security to the process.</p><p>You learned about using the REST API in your client app to communicate with server web apps that provide the information that the app needs (such as details about the products you have for sale and the shipping methods you support), and to process payments and orders from the app.</p><p>The book provided an example workflow for displaying product information to your customers and displaying an <strong>Apple</strong> <strong>Pay</strong> button when appropriate. You learned how to create a payment request and add payment and order information to it, and to present the main Apple Pay user interface and the payment sheet. The book showed how to respond to the changes that the user makes in the payment sheet, such as selecting a different payment card, shipping address, or shipping method.</p><p>You learned how to process payment and order information in your app and backend servers after the user authorizes the payment request. The book also showed how to dispose of the payment sheet when the transaction is complete.</p><p>Finally, the book described the major elements and processes of an order management system, using <code class="literal">Node.js</code> to process orders and payments and the Mongoose module to interact with a document-based database.</p><p>With this knowledge, you are now able to provide the users of your apps with the convenience and security of Apple Pay-based payments.</p></div></body></html>