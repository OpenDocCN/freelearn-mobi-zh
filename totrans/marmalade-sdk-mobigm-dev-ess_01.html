<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Getting Started with Marmalade"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Getting Started with Marmalade</h1></div></div></div><p>In this chapter, we will first be learning how to get the Marmalade SDK set up for development. While Marmalade is available in both Windows and Mac versions, the Windows version is the most developed of the two and is what we shall be primarily covering in this book. By the end of this chapter, we will know how to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Set up a Windows PC for development using the Marmalade SDK</li><li class="listitem" style="list-style-type: disc">Create and build a "Hello World" project</li><li class="listitem" style="list-style-type: disc">Deploy and run the "Hello World" project on several mobile platforms</li></ul></div><p>So without further ado, let's get started!</p><div class="section" title="Installing the Marmalade SDK"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Installing the Marmalade SDK</h1></div></div></div><p>The following <a id="id0" class="indexterm"/>sections <a id="id1" class="indexterm"/>will show <a id="id2" class="indexterm"/>you how to get your PC set up for development using Marmalade, from installing a suitable development environment through to licensing, downloading, and installing your copy of Marmalade.</p><div class="section" title="Installing a development environment"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec07"/>Installing a development environment</h2></div></div></div><p>Before we can start <a id="id3" class="indexterm"/>
<a id="id4" class="indexterm"/>
<a id="id5" class="indexterm"/>coding, we will first need to install a version of Microsoft's Visual C++, which is the Windows development environment that Marmalade uses. If you don't already have a version installed, you can download a copy for free. At the time of writing, the Express 2012 version had just been released but the most recent, free version directly supported by Marmalade was still<a id="id6" class="indexterm"/> Visual C++ 2010 Express, which can be downloaded from the following URL:</p><p>
<a class="ulink" href="http://www.microsoft.com/visualstudio/en-us/products/2010-editions/visual-cpp-express">http://www.microsoft.com/visualstudio/en-us/products/2010-editions/visual-cpp-express</a>
</p><p>Follow the instructions on this web page to download and install the product.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>For the Apple Mac version of Marmalade, the supported development environment is <a id="id7" class="indexterm"/>Xcode, which is available as a free download from the Mac App Store. In this book, we will be assuming that the Windows version of Marmalade will be used, unless specifically stated otherwise.</p></div></div></div><div class="section" title="Choosing your Marmalade license type"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec08"/>Choosing your Marmalade license type</h2></div></div></div><p>With a suitable <a id="id8" class="indexterm"/>development environment in place, we can now get on to downloading Marmalade itself. First, you need to head over to the Marmalade<a id="id9" class="indexterm"/> website using the following URL:</p><p>
<a class="ulink" href="http://www.madewithmarmalade.com">http://www.madewithmarmalade.com</a>
</p><p>At the top of the website<a id="id10" class="indexterm"/> are two buttons labeled <span class="strong"><strong>Buy</strong></span> and <span class="strong"><strong>Free Trial</strong></span>. Click on one of these (it doesn't matter which, as they both go to the same place!) and you'll see a page explaining the licensing options, which are also described in the following table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>License type</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Evaluation<a id="id11" class="indexterm"/>
<a id="id12" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This is free to use but is time limited (currently 45 days), and while you can deploy it to all supported platforms, you are not allowed to distribute the applications built with this version.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Community<a id="id13" class="indexterm"/>
<a id="id14" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the cheapest way of getting started with Marmalade, but you are limited to only being able to release it on iOS and Android, and your application will also feature a Marmalade splash screen on startup.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Indie<a id="id15" class="indexterm"/>
<a id="id16" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This version removes the limitations of the basic license, with no splash screen and the ability to target any supported platform.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Professional<a id="id17" class="indexterm"/>
<a id="id18" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This version adds dedicated support from Marmalade should you face any issues during development, and provides early access to the new versions of Marmalade.</p>
</td></tr></tbody></table></div><p>When you have<a id="id19" class="indexterm"/> chosen the license level, you will first need to register with the Marmalade website by providing an e-mail address and password.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>The e-mail address you register will be linked to your license and will be used to activate it later. Make sure you use a valid e-mail address when registering.</p></div></div><p>Once you are<a id="id20" class="indexterm"/> registered, you will be taken to a web page where you can choose the level of license you require. After confirming payment, you will be sent an e-mail that allows you to activate your license and download the Marmalade installer.</p></div><div class="section" title="Downloading and installing Marmalade"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec09"/>Downloading and installing Marmalade</h2></div></div></div><p>Now that you have a valid license, head back to the Marmalade website using the same URL we used earlier.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">If you are not <a id="id21" class="indexterm"/><a id="id22" class="indexterm"/><a id="id23" class="indexterm"/><a id="id24" class="indexterm"/>already logged on to the website, do so using the <span class="strong"><strong>Login</strong></span> link at the top-right corner of the web page.</li><li class="listitem">Click on the <span class="strong"><strong>Download</strong></span> button, and you will be taken to a page where you can download both the most recent and previous releases of the Marmalade installer. Click on the button for the version you require, to start downloading it. Once the download is complete, run the installer and follow the instructions. The installer will first ask you to accept the <span class="strong"><strong>End User License Agreement</strong></span> by selecting a radio button, and will then ask for an installation location.</li><li class="listitem">Next, enter the file location you want to install to. The default installation directory drops the minor revision number (so version 6.1.1 will be installed into a subdirectory called 6.1). You may want to add the minor revision number back in, to make it easier to have multiple versions of Marmalade installed at the same time.</li><li class="listitem">Once the installer has finished copying the files to your hard drive, it will then display the Marmalade Configuration Utility, which is described in greater detail in the next section. Once the Configuration Utility has been closed, the installer will then offer you the option of launching some useful resources, such as the SDK documentation, before it exits.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>It is possible to have more than one version of the Marmalade SDK installed at a time and switch between versions as you need, hence the advice regarding <a id="id25" class="indexterm"/>
<a id="id26" class="indexterm"/>
<a id="id27" class="indexterm"/>
<a id="id28" class="indexterm"/>the installation directory. This becomes very useful when device-specific bugs are fixed in a new version of Marmalade, but you still need to support an older project that requires a different version of Marmalade.</p></div></div></li></ol></div></div><div class="section" title="Using the Marmalade Configuration Utility"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>Using the Marmalade Configuration Utility</h2></div></div></div><p>The <a id="id29" class="indexterm"/> <span class="strong"><strong>Marmalade Configuration Utility</strong></span> window appears at the end of the installation process, but it can also be launched from its shortcut icon:</p><div class="mediaobject"><img src="graphics/3363_01_01.jpg" alt="Using the Marmalade Configuration Utility"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>When launching <a id="id30" class="indexterm"/>the Marmalade Configuration Utility on Windows Vista or Windows 7, you should right-click on the icon and select the <span class="strong"><strong>Run as administrator</strong></span> option, otherwise any changes that you make might not be applied.</p></div></div><p>The most important<a id="id31" class="indexterm"/> element is the <span class="strong"><strong>License Information</strong></span> box. Below this is a button labeled <span class="strong"><strong>Activate License...</strong></span> that allows you to activate your Marmalade installation. Follow these steps to get activated:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on the <span class="strong"><strong>Activate License...</strong></span> button to display a dialog box that asks you to enter the e-mail address and password you used when obtaining your license.</li><li class="listitem">The dialog box also has a drop-down box labeled <span class="strong"><strong>Machine ID (Ethernet MAC address)</strong></span>, which you should make sure is set to the MAC address of an Ethernet port that will always be present on your computer. Normally you won't need to change this.</li><li class="listitem">Click on the <span class="strong"><strong>OK</strong></span> button to connect to the Marmalade licensing server. You will be asked to select the license you want to install. (Normally there will only be a single option available.) Do so and click on <span class="strong"><strong>OK</strong></span>.</li><li class="listitem">A summary of the <a id="id32" class="indexterm"/> <span class="strong"><strong>End User License Agreement</strong></span> (<span class="strong"><strong>EULA</strong></span>), appropriate to the type of license you are using, will be displayed, so click on <span class="strong"><strong>OK</strong></span> to accept it. A reference to the full EULA is also provided in the dialog box.</li><li class="listitem">You should now see a message confirming successful license installation. At this point Marmalade is ready to go!</li></ol></div><p>Before we finish here though, let's look at the other available options. The first is labeled <span class="strong"><strong>Marmalade System (S3E) Base</strong></span> and consists of a drop-down box that allows you to select the version of the Marmalade SDK you want to use, if you have more than one installed of course!</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>S3E<a id="id33" class="indexterm"/> is short for Segundo Embedded Execution Environment and this is the lowest layer of the Marmalade SDK. This naming convention was adopted by the SDK during its early days of development, and it remains to this day. As you will see later in this book, there are a great many APIs that are prefixed with this name.</p></div></div><p>The <span class="strong"><strong>Default Build Environment</strong></span> lets you choose which development environment you wish to use, assuming you have more than one supported version of Visual C++ installed.</p><p>The drop-down box labeled <span class="strong"><strong>RVCT ARM Compiler</strong></span> allows you to change the compiler that will be used when making a device build. (Most mobile devices contain an ARM CPU, so we must compile our code for this processor type.) Marmalade ships with the GCC compiler and uses this by default, but it can also make use of the RVCT C++ compiler from ARM, which is an additional purchase and can produce better optimized code. We normally do not need to change this setting and can leave it on the first option labeled <span class="strong"><strong>Do not use RVCT</strong></span>.</p><p>The <span class="strong"><strong>Advanced Options...</strong></span> button provides access to a more verbose project-building option and also some experimental parts of the SDK. You will not normally need to make any changes here.</p></div><div class="section" title="Managing your Marmalade account and licenses"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>Managing your Marmalade account and licenses</h2></div></div></div><p>Before we get on to doing some actual coding, it is worth mentioning how you can manage your Marmalade license and account. If you head back to the Marmalade website and log on, you'll notice a link at the top-right corner of the site labeled <span class="strong"><strong>My Account</strong></span>.</p><p>Hover your mouse pointer over this link, and a menu of options that allow you to change your account details and license usage will appear. The following sections provide further information on each of these options.</p><div class="section" title="Viewing an overview of your account"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec02"/>Viewing an overview of your account</h3></div></div></div><p>The menu option <a id="id34" class="indexterm"/>
<a id="id35" class="indexterm"/>called <span class="strong"><strong>Overview</strong></span> takes you to a page where you can see your personal details along with a summary of the number of licenses and users you have set up under your account. From this screen, there are buttons that allow you to update your profile, modify registered user information, buy new licenses, and manage existing ones.</p></div><div class="section" title="Updating your profile information"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec03"/>Updating your profile information</h3></div></div></div><p>Clicking the <span class="strong"><strong>Profile</strong></span> option<a id="id36" class="indexterm"/>
<a id="id37" class="indexterm"/> in the <span class="strong"><strong>My Account</strong></span> menu or clicking on the <span class="strong"><strong>Update Profile Information</strong></span> button on the profile overview screen will display a page that allows you to alter information such as your name, contact information, address, and account login password. There is also a checkbox that allows you to sign up for e-mail news updates from Marmalade.</p></div><div class="section" title="Managing your licenses"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec04"/>Managing your licenses</h3></div></div></div><p>Clicking the <a id="id38" class="indexterm"/>
<a id="id39" class="indexterm"/>
<span class="strong"><strong>Licenses</strong></span> link in the <span class="strong"><strong>My Account</strong></span> menu or clicking on the button labeled <span class="strong"><strong>Manage</strong></span> on the overview screen will take you to a page where you can upgrade the level of your license or buy further licenses for new team members.</p><p>The <span class="strong"><strong>Manage Licenses</strong></span> section at the bottom of this page shows all the currently active licenses in your account, and also allows you to release a license that is currently in use so that it can be transferred to another computer.</p><p>Releasing a license is useful if you need to work on a different computer for some reason, or if you have a new development computer that you wish to transfer your license to. You can release a license <a id="id40" class="indexterm"/>
<a id="id41" class="indexterm"/>as often as you like, but a single license can only be used on a single computer at a time.</p></div><div class="section" title="Managing your user list"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec05"/>Managing your user list</h3></div></div></div><p>If you are working in a <a id="id42" class="indexterm"/>
<a id="id43" class="indexterm"/>team then you will obviously need more than one Marmalade license, but you also need to manage who has access to those licenses. Clicking on the <span class="strong"><strong>Users</strong></span> option in the <span class="strong"><strong>My Account</strong></span> menu or clicking on the <span class="strong"><strong>Manage Users</strong></span> button on the overview page allows you to do this.</p><p>This page shows a list of all the users assigned to your account, and also has an <span class="strong"><strong>Invite Users</strong></span> section that allows you to add new users to your account. Enter their e-mail addresses in the boxes provided, and click the <span class="strong"><strong>Send invite</strong></span> button to send them a mail telling them how to activate their own Marmalade account.</p></div></div></div></div>
<div class="section" title="Creating a Marmalade project"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Creating a Marmalade project</h1></div></div></div><p>With Marmalade <a id="id44" class="indexterm"/>installed, we can now get down to doing some coding, and what better place to start than with the classic example of a "Hello World" program.</p><div class="section" title="Creating the &quot;Hello World&quot; project"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>Creating the "Hello World" project</h2></div></div></div><p>To begin a new project, we <a id="id45" class="indexterm"/>must first create an MKB file, which is Marmalade's own project file format. We use MKB files to specify all the source files, libraries, and build options needed to build our project.</p><p>The MKB file is actually used to generate a Visual C++ project file, but whenever we want to add or remove a source file to our project, we must do so by editing the MKB file and regenerating the Visual C++ project file from it using Marmalade's make file builder script, which we'll be looking at in just a moment.</p><p>In addition to source files, the MKB file also allows you to list all the other datafiles and resource files that your application will need in order to run, as this information will be needed when it comes to deploying your application on different mobile platforms.</p><p>Marmalade does come with a small tool called the<a id="id46" class="indexterm"/> LaunchPad, which can be used to create a new project, but in the interest of learning how a Marmalade project is put together, we will go about creating everything from scratch instead.</p><div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.PacktPub.com">http://www.PacktPub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.PacktPub.com/support">http://www.PacktPub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div><div class="section" title="The MKB file for the &quot;Hello World&quot; project"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec06"/>The MKB file for the "Hello World" project</h3></div></div></div><p>Let's make a start on our "<a id="id47" class="indexterm"/>Hello World" project. Create a new directory to hold the project files, and then create a file called <code class="literal">Hello.mkb</code> in this directory and <a id="id48" class="indexterm"/>enter the following into it:</p><div class="informalexample"><pre class="programlisting">#
# Main MKB file for Hello project
#

# Modules used by this project
subprojects
{
  iwgx
}
 
# The files that make up the project (source, data etc.)
files
{
  [SourceCode]
  (source)

  Main.cpp
}

# Settings to configure the deployment process 
deployments
{
  name="Hello"
  caption="Hello World"
}</pre></div><p>The first section of <code class="literal">Hello.mkb</code> is the <code class="literal">subprojects</code> section, which lists all the additional code modules used by our application. In this instance, a code module is a library that can be added to our project either as a group of C or C++ source files or, alternatively, as pre-compiled, linkable object files accompanying header files. In the previous example, there is just one, <code class="literal">iwgx</code>, which is the Marmalade code module responsible for rendering graphics.</p><p>All the higher level modules within Marmalade are referenced in this manner, and you can also use this system to create your own modules to enable code re-use across projects. To create a subproject module we use an MKF file, which amounts to a little more than an MKB file with a different file extension! When we add an entry to the <code class="literal">subprojects</code> list, the Marmalade makefile builder script will search for a suitable MKF file that describes each subproject. We'll see detailed examples of how to do this later in the book.</p><p>The next section is labeled <code class="literal">files</code>, and this is where we list all the source code files for our project. It is possible to split your source files up into different directories. To make it easy, you simply put the directory name in brackets (<code class="literal">(source)</code> in our example) and then list all the source files in the directory below.</p><p>It is also possible to group the related files together into subsections, which we do using square brackets (<code class="literal">[SourceCode]</code> in our example). Any source files below this will be added to that section and will then appear in a separate folder in the Visual C++ Solution Explorer. There is no need for the directory and group names to match, and indeed you can have more than one directory in a group if you so wish.</p><p>Finally we<a id="id49" class="indexterm"/>
<a id="id50" class="indexterm"/> have the <code class="literal">deployments</code> section, which is where various settings are made that control the process of deploying our application to different device types.</p><p>In our example we are making two settings. The <code class="literal">name</code> setting provides the filename of our final executable and is also used in file and directory names created for us by Marmalade, while <code class="literal">caption</code> sets the name that will appear under the application's icon when installed on a device.</p><p>Both the aforementioned settings are examples of general settings that apply across all device types, but there are also a great many other settings available, which are specific to particular platforms, such as iOS or Android. A full list of these can be found in the <code class="literal">Marmalade Documentation</code> help file<a id="id51" class="indexterm"/> that is installed as part of the Marmalade SDK, and we'll also be looking at this in <a class="link" href="ch08.html" title="Chapter 8. Supporting a Wide Range of Devices">Chapter 8</a>, <span class="emphasis"><em>Supporting a Wide Range of Devices</em></span>, of this book along with the additional sections of the MKB file that have not yet been shown for this example.</p><p>The use of whitespace in the MKB file is pretty much up to your own personal preference. Though most of the Marmalade examples tend to indent entries within blocks, tabs or spaces can also be used.</p><p>Comments can also be added using the hash (<code class="literal">#</code>) character. Everything after the hash character till the end of the current line is then considered a comment.</p></div><div class="section" title="The source file for the &quot;Hello World&quot; project"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec07"/>The source file for the "Hello World" project</h3></div></div></div><p>We may now use the <a id="id52" class="indexterm"/>
<a id="id53" class="indexterm"/>MKB file for our project but we still can't do anything with it yet, as we've told Marmalade that there is a source file called <code class="literal">Main.cpp</code>, which doesn't exist yet. If we were to try and use the MKB file to build the project, we would get an error reported about this missing file, so let's create it.</p><p>You will recall that we said that our <code class="literal">Main.cpp</code> file<a id="id54" class="indexterm"/> would reside in a directory called <code class="literal">source</code> in the MKB file, so first create this new subdirectory in the project directory. Now, create a file called <code class="literal">Main.cpp</code> in the source directory and enter the following<a id="id55" class="indexterm"/>
<a id="id56" class="indexterm"/> into it:</p><div class="informalexample"><pre class="programlisting">//---------------------------------------------------------
// Learning Mobile Game Development with Marmalade
// Chapter 1 - Hello
//---------------------------------------------------------
 
// Marmalade SDK includes
#include "IwGx.h"
#include "s3eConfig.h"
#include "s3eDevice.h"
 
//---------------------------------------------------------
// Main entry point
//---------------------------------------------------------
int main()
{
  // Initialise Marmalade modules
  IwGxInit();
 
  // Set a default message, then check the ICF file to see if
  // a proper message has been specified
  char lMessage[S3E_CONFIG_STRING_MAX] = "Hello!";
  s3eConfigGetString("APP", "Message", lMessage);

  // Set screen clear colour to black
  IwGxSetColClear(0, 0, 0, 255);

  // Draw text at double default size
  IwGxPrintSetScale(2);
 
  // Loop until we receive a quit message
  while (!s3eDeviceCheckQuitRequest())
  {
    // Allow device to process its internal events
    s3eDeviceYield(0);
 
    // Clear the screen
    IwGxClear();
 
    // Display our message on screen
    IwGxPrintString(10, 10, lMessage);
 
    // Flush IwGx draw buffers to screen
    IwGxFlush();
 
    // Swap screen double buffer
    IwGxSwapBuffers();
  }
 
  // Terminate Marmalade modules
  IwGxTerminate();

  return 0;
}</pre></div><p>The code should be fairly simple to follow, but here is a quick breakdown.</p><p>First we reference<a id="id57" class="indexterm"/>
<a id="id58" class="indexterm"/> the include files to allow us to use the parts of Marmalade that are necessary for our application, and then we create our main entry point function <code class="literal">main</code>. This is equivalent to the <code class="literal">main()</code> function<a id="id59" class="indexterm"/> in a standard C or C++ program, except that it takes no parameters as Marmalade does not accept command-line parameters. It's quite hard to specify command-line parameters on mobile devices, so there really isn't any need!</p><p>The first thing our application needs to do is initialize Marmalade's rendering module with a call to<a id="id60" class="indexterm"/> <code class="literal">IwGxInit()</code>, which will initialize the screen and set up standard behavior such as double buffering of the display.</p><p>Next we allocate a character buffer that will contain the message that we will be displaying on screen. We initialize it to a default message to make sure that there is something to be shown, but we then use a call to the <code class="literal">s3eConfigGetString</code> function<a id="id61" class="indexterm"/> to see if another message has been specified in the application's configuration file, which will be explained in more detail shortly.</p><p>The following call to<a id="id62" class="indexterm"/> <code class="literal">IwGxSetColClear</code> sets the desired screen background color to black, and then the call to<a id="id63" class="indexterm"/> <code class="literal">IwGxPrintSetScale</code> tells Marmalade to display text using its built-in font (which is quite small in size) at double its default resolution.</p><p>We now enter our main processing loop that will continue until the <code class="literal">s3eDeviceCheckQuitRequest</code> function <a id="id64" class="indexterm"/>returns a true value, which will happen if the user quits the application or if the device sends a quit request to the application for any reason.</p><p>The first line of our main loop is a call to <code class="literal">s3eDeviceYield</code>. This is a very important function that must be called at regular intervals during our application, to allow the device's OS to perform important tasks such as handling events—user inputs, incoming phone calls, and so on. Under most circumstances, a single call to this function in the main loop is sufficient.</p><p>The value passed to <code class="literal">s3eDeviceYield</code> is the maximum time (in milliseconds) that our application will yield to the OS for. Normally this value is set to zero, which yields long enough for the device to process the events, but will return control to our application as soon as all the events have been processed.</p><p>Next, we call <code class="literal">IwGxClear</code> to clear the screen and then use<a id="id65" class="indexterm"/> <code class="literal">IwGxPrintString</code> to display a message on the screen. <code class="literal">IwGxFlush</code> <a id="id66" class="indexterm"/>causes the Marmalade engine to then process all our drawing requests to yield a final screen image that we can then display to the world using<a id="id67" class="indexterm"/> <code class="literal">IwGxSwapBuffers</code>.</p><p>Finally, outside <a id="id68" class="indexterm"/>
<a id="id69" class="indexterm"/>the main loop, we call <code class="literal">IwGxTerminate</code> to shut down Marmalade's rendering engine, and finally return zero to indicate that our application was completed without any errors.</p></div></div><div class="section" title="Building the &quot;Hello World&quot; project"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>Building the "Hello World" project</h2></div></div></div><p>Now that we have set up<a id="id70" class="indexterm"/> our project and written the necessary code, it is finally time to build it. To do this open a Windows Explorer window and navigate to the folder containing <code class="literal">Hello.mkb</code>, and then just double-click on the file. You might see a brief flash of a command-prompt window, but after a short delay, Visual C++ should automatically start up with our project.</p><p>The act of double-clicking the MKB file actually causes the Marmalade makefile builder script to be executed. This is actually a script written in the Python language, which takes the MKB file and outputs a Visual C++ solution file and other required elements. A file association is automatically set up when installing Marmalade, so you can either double-click the file, or alternatively use the command prompt to create your project by changing to the project directory and entering <code class="literal">Hello.mkb</code>.</p><p>Before we go on to compile and run the project though, let's take a quick look at what Marmalade has created for us.</p><p>If you look in the project directory, there should be two new directories, which are described in the following sections.</p><div class="section" title="The build directory"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec08"/>The build directory</h3></div></div></div><p>One of the directories created by the MKB file will be named <code class="literal">build_hello_vcxx</code>, where the "xx" part is dependent on the version of Visual C++ you are using.</p><p>This <a id="id71" class="indexterm"/>directory is Marmalade's working directory and is where all the object files created during building are stored. It will also be the home to our deployment packages when it comes to making device builds.</p><p>A Visual C++ solution file created from the MKB file also lives in this directory, and while you can use these files to switch between projects, you should never add files or change project <a id="id72" class="indexterm"/>settings using the options in the Visual C++ IDE.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>Always make project changes to the MKB file, then either close Visual C++ and double-click the MKB file to rebuild the solution, or alternatively perform a build inside Visual C++ to update the solution file with any changes. You should not make changes directly within the Visual C++ IDE as they will be lost the next time that the MKB file is used to recreate the project file.</p></div></div></div><div class="section" title="The data directory"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec09"/>The data directory</h3></div></div></div><p>The MKB file will also generate a directory <a id="id73" class="indexterm"/>called <code class="literal">data</code>, and this is where Marmalade requires you to place any files that your application will need to load, such as images, 3D model data, sound files, and others. While you can create this directory and these files yourself, and it will not cause a problem, we might as well let the makefile builder do it for us!</p><p>If you take a look inside the <code class="literal">data</code> directory, you will see that the build process has also created two more files called <code class="literal">app.icf</code> and <code class="literal">app.config.txt</code>. These files are used to configure your application and are explained in the following sections.</p><div class="section" title="The app.config.txt file"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec03"/>The app.config.txt file</h4></div></div></div><p>This file provides a <a id="id74" class="indexterm"/>list of all the <a id="id75" class="indexterm"/>application-specific settings that can be made in the <code class="literal">app.icf</code> file, along with a description of what each setting does and how it is used. There are two reasons for using this file:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Adding entries to this file keeps your project settings documented in a single place, so other coders can check this file to see what a particular setting does.</li><li class="listitem">Any setting contained in the <code class="literal">app.icf</code> file that is not documented in the <code class="literal">app.config.txt</code> file will generate a runtime error message when you try to specify or access it in your program.</li></ol></div><p>Additionally, the <code class="literal">app.config.txt</code> file also requires you to define a group name for your settings, which is specified by using square brackets.</p><p>If you look at the <code class="literal">s3eConfigGetString</code> function <a id="id76" class="indexterm"/>call in the "Hello World" project code, you will see an example of this. This call is trying to access a setting called <code class="literal">Message</code> from the group <code class="literal">APP</code>, so let's add this into the <code class="literal">app.config.txt</code> file now, to stop any asserts from firing when running our application. Edit the file and add the following lines to the bottom of it:</p><div class="informalexample"><pre class="programlisting">[APP]
Message      The message we want to display on screen</pre></div></div><div class="section" title="The app.icf file"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec04"/>The app.icf file</h4></div></div></div><p>The <code class="literal">app.icf</code> file is<a id="id77" class="indexterm"/> used <a id="id78" class="indexterm"/>to add the configuration settings to your application, and as already stated these must be either documented in your project's <code class="literal">app.config.txt</code> file or must alternatively be defined in a similar file within one of the subprojects used by your application.</p><p>Adding a configuration setting is simply a matter of adding the setting name followed by an equals sign and then the value you wish to use. You must also ensure that you add the setting to the correct group, using the same square bracket notation used in the <code class="literal">app.config.txt</code> file. Here's an example:</p><div class="informalexample"><pre class="programlisting">[APP]
Message="Hello World"</pre></div><p>The settings made in the <code class="literal">app.icf</code> file can then be accessed in code using the <code class="literal">s3eConfigGetInt</code> and <code class="literal">s3eConfigGetString</code> functions.</p><p>The <code class="literal">app.icf</code> file also has another couple of tricks up its sleeve, as settings can also be made that are specific to a certain platform or even specific to an individual device. Here's how you achieve this:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">To limit the application to a particular platform add the line <code class="literal">{OS=platform}</code>, and any settings following this will only apply to that device platform. The value used for <code class="literal">platform</code> is normally just the name of the operating system, for example, <code class="literal">ANDROID</code>, <code class="literal">BADA</code>, or <code class="literal">WINDOWS</code>, although it is worth mentioning that you should use <code class="literal">IPHONE</code> to refer to iPhones, iPods, and iPads! If in doubt, you can use a call to <code class="literal">s3eDeviceGetString(S3E_DEVICE_OS)</code> to discover the value that you need to use for a particular operating system.</li><li class="listitem" style="list-style-type: disc">To limit the application to a particular device or devices, add the line <code class="literal">{ID=platform id}</code>, and any following settings will only be applied when run on the specified device. The <code class="literal">platform</code> value is the same as that used previously, while the <code class="literal">id</code> is an identifier for a particular device. The format of the <code class="literal">id</code> value depends on the operating system, but you can discover what value to use for a particular device by calling <code class="literal">s3eDeviceGetString(S3E_DEVICE_ID)</code>. It is also possible to provide a comma-separated list of <code class="literal">id</code> values if you need the settings to apply to more than one device.</li></ul></div><p>Note that both of these settings will continue to take effect until a new OS or ID value is specified. If you wish to return to applying all the settings globally, just add <code class="literal">{}</code> after your last OS- or ID-specific setting.</p><div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>It is good practice to ensure that your OS- or ID-specific sections always terminate with <code class="literal">{}</code>, as not doing so can lead to a major head-scratching session when you deploy to device and find that some setting you have just changed doesn't appear to be taking effect.</p></div></div><p>To illustrate<a id="id79" class="indexterm"/> the use of <code class="literal">{}</code> , let's add some settings to the "Hello <a id="id80" class="indexterm"/>World" project <code class="literal">app.icf</code> file. Open the file and add the following lines to the bottom of it:</p><div class="informalexample"><pre class="programlisting">[APP]
{OS=ANDROID}
Message="Hello Android!"
{}
 
{OS=BADA}
Message="Hello Bada!"
{}
 
{OS=IPHONE}
Message="Hello iOS!"
{}

{OS=QNX}
Message="Hello BlackBerry!"
{}
 
{OS=WINDOWS}
Message="Hello Windows!"
{}</pre></div><p>You should be able to see from this that we have specified a different message string for each different platform type that we wish to support.</p></div></div></div><div class="section" title="Building and running in the Windows simulator"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>Building and running in the Windows simulator</h2></div></div></div><p>Now it's time for us to <a id="id81" class="indexterm"/>
<a id="id82" class="indexterm"/>see the "Hello World" project in action. It is just a simple matter of compiling the code in Visual C++ and running it.</p><p>To compile the code, simply select <span class="strong"><strong>Build</strong></span> | <span class="strong"><strong>Build Solution</strong></span> or press the <span class="emphasis"><em>F7</em></span> key. Visual C++ will compile and link the <code class="literal">Main.cpp</code> file.</p><p>Now we can <a id="id83" class="indexterm"/>
<a id="id84" class="indexterm"/>execute the program. Select <span class="strong"><strong>Debug</strong></span> | <span class="strong"><strong>Start Debugging</strong></span> or simply press <span class="emphasis"><em>F5</em></span>. The Marmalade Windows Simulator<a id="id85" class="indexterm"/> will be launched, which will in turn load and execute our program. The following image shows what the "Hello World" project should look like when run in the Windows Simulator:</p><div class="mediaobject"><img src="graphics/3363_01_02.jpg" alt="Building and running in the Windows simulator"/></div><p>You will notice that the Windows Simulator contains a number of menu options. These allow you to make the Windows Simulator run in as close a manner to any device you choose as possible. The best way to see what you can change is to explore the menu options yourself, but here are a few of the more useful things you can do:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Accelerometer: Testing accelerometer inputs on Windows would be impossible without <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>Accelerometer...</strong></span>. This brings up a dialog box that allows you to use the mouse to rotate a 3D image of a phone, to simulate the accelerometer input.</li><li class="listitem" style="list-style-type: disc">OpenGL ES version: The Windows Simulator option <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>GL...</strong></span> allows you to emulate different versions of OpenGL ES, which makes it easy to see what your game may look like on different types of hardware. It also allows you to disable OpenGL ES support entirely, which will then force Marmalade to use its built-in software renderer.</li><li class="listitem" style="list-style-type: disc">Screen resolution: Mobile devices have a wide range of supported screen resolutions, so <span class="strong"><strong>Configuration</strong></span> | <span class="strong"><strong>Surface...</strong></span> allows you to select any size for the screen that you desire.</li><li class="listitem" style="list-style-type: disc">Emulation <a id="id86" class="indexterm"/><a id="id87" class="indexterm"/>of device suspend and resume: It is easy to forget that the primary function of many devices is actually that of a telephone rather than of a gaming platform, which means your application could potentially be interrupted at any time by an incoming call. Marmalade takes care of most of the fiddly details of handling this automatically, but there may still be situations when you need to do something special under such circumstances. The Windows Simulator allows you to test whether your application responds correctly by way of <span class="strong"><strong>Events</strong></span> | <span class="strong"><strong>Simulate Suspend </strong></span>and <span class="strong"><strong>Events</strong></span> | <span class="strong"><strong>Simulate Resume</strong></span>.</li></ul></div></div></div>
<div class="section" title="Deploying a Marmalade project"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Deploying a Marmalade project</h1></div></div></div><p>We have now<a id="id88" class="indexterm"/> managed to create and run our first Marmalade application, but running it on Windows isn't our ultimate goal. The whole reason for the Marmalade SDK is to make it easy for us to develop our application once and then deploy it on a whole range of mobile device platforms.</p><p>Of course we might need to alter some of our assets, for example, because we are targeting a wide range of different screen resolutions and want our application to look its best at all times, the code itself should need no modification in order to run successfully.</p><p>To illustrate this, we will now take the "Hello World" project and get it running on a number of different mobile device platforms.</p><div class="section" title="Compiling the &quot;Hello World&quot; project for the ARM CPU"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>Compiling the "Hello World" project for the ARM CPU</h2></div></div></div><p>Running our project in <a id="id89" class="indexterm"/>
<a id="id90" class="indexterm"/>Windows meant we were compiling our code using the standard Visual C++ compiler and therefore generating Intel x86 code. However, it is a fact that the vast majority of mobile devices available today contain some version or other of the ARM processor, so the first thing we need to do is compile our code for ARM.</p><p>Luckily, Marmalade has made this incredibly easy for us. At the top of the Visual C++ window, you should see a drop-down box that defaults to a setting called <span class="strong"><strong>(x86) Debug</strong></span>.</p><p>If you open the drop-down <a id="id91" class="indexterm"/>
<a id="id92" class="indexterm"/>box, you will see several build types pre-configured for us, but the one we are interested in is the <span class="strong"><strong>GCC (ARM) Release</strong></span> option<a id="id93" class="indexterm"/>. Select this and build the solution again (<span class="strong"><strong>Build</strong></span> | <span class="strong"><strong>Build Solution</strong></span> or press <span class="emphasis"><em>F7</em></span>), and Visual C++ will use the GCC compiler to create an ARM version of our application.</p><p>Now we just need to get the code onto a device!</p></div><div class="section" title="Deploying the &quot;Hello World&quot; project"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/>Deploying the "Hello World" project</h2></div></div></div><p>Now that we have an <a id="id94" class="indexterm"/>ARM-compiled version of our code, we need to create an install package so we can test it on a real mobile device. To do this we need to use <a id="id95" class="indexterm"/> <span class="strong"><strong>Marmalade System Deployment Tool</strong></span>. Follow these steps to go through the deployment process:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">To launch the tool, make <a id="id96" class="indexterm"/>sure the <span class="strong"><strong>GCC (ARM) Release</strong></span> build type is selected and the code has been compiled. Select <span class="strong"><strong>Debug | Start Debugging</strong></span> (or press <span class="emphasis"><em>F5</em></span>). Instead of running the code in the debugger (which would make little sense given that the Visual C++ debugger can only debug an Intel x86 executable), <span class="strong"><strong>Marmalade System Deployment Tool</strong></span> will be launched instead.<div class="mediaobject"><img src="graphics/3363_01_04.jpg" alt="Deploying the &quot;Hello World&quot; project"/></div></li><li class="listitem">The program will first ask us to select the build type we wish to deploy and will have a number of radio buttons for the types available. Only those build types that are currently built will be selectable. In our case, we need to select the <span class="strong"><strong>ARM GCC Release</strong></span> radio button and then click on the button labeled <span class="strong"><strong>Next Stage &gt;</strong></span>, to proceed to the next step.</li><li class="listitem">The next page asks us to select a deployment configuration. We can specify the directory where we want our deployed package files to be created, and we also have a list of checkboxed items for the available deployment configurations that we can choose from. Marmalade allows us to create different configurations, which means we can deploy different resource packages to different devices. For now we won't concern ourselves with any of this, so just ensure that the <span class="strong"><strong>Default</strong></span> setting is checked and then click on the <span class="strong"><strong>Next Stage &gt;</strong></span> button again.</li><li class="listitem">We are <a id="id97" class="indexterm"/>now presented with a page listing all the device types that we can deploy to. Use the checkboxes to select which platforms to deploy to, and then click on <span class="strong"><strong>Next Stage &gt;</strong></span> once more to be taken to the final page.</li><li class="listitem">At the top of this last page, we can see a brief description of the different deployment types we are about to make, with drop-down boxes for each, to specify whether we should just generate the necessary package files, ignore that build type completely, or optionally install and run the package as well.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>The <span class="strong"><strong>Package and Install</strong></span> options available in the Marmalade System Configuration Tool often rely on your system being set up with extra third-party software that isn't automatically installed as part of the Marmalade SDK. For this reason in this book, we will generally keep to using the <span class="strong"><strong>Package</strong></span> option and install and run our deployment packages using manual methods.</p></div></div></li><li class="listitem">Now that we have configured the type of deployment we want, just press the <span class="strong"><strong>Deploy All</strong></span> button and Marmalade will make packages for all the different targets we selected.</li></ol></div><p>The default location for the deployment packages is within the Marmalade <code class="literal">Build</code> directory. If you use Windows Explorer to look into this directory, you will see that a new directory called <code class="literal">deployments</code> has been created. In turn, this directory contains a folder called <code class="literal">default</code>, which comes from the deployment configuration we used.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note09"/>Note</h3><p>It is possible to open Windows Explorer to the deployment folder by clicking on the <span class="strong"><strong>Explore…</strong></span> button on the final page of the deployment utility.</p></div></div><p>The <code class="literal">default</code> directory contains subdirectories for each of our selected deployment platforms, and each of these will contain a <code class="literal">release</code> directory since it was the release build that we created the deployments from. Note that it is also possible to deploy a debug build, which can be useful when debugging. Go into the <code class="literal">release</code> folder and there you will find our freshly made deployment package.</p><p>All that is left to <a id="id98" class="indexterm"/>do now is to install and run it on a device.</p><div class="section" title="Installing on Android devices "><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec10"/>Installing on Android devices </h3></div></div></div><p>Let's start by looking <a id="id99" class="indexterm"/>
<a id="id100" class="indexterm"/>
<a id="id101" class="indexterm"/>at how to install an Android build.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>Before being able to make an Android deployment with the deployment tool, there is a prerequisite that the Java JDK must be installed. You can download this from the following web page:</p><p>
<a class="ulink" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a>
</p></div></div><p>The Android package file for the "Hello World" project is called <code class="literal">Hello.apk</code>, and to install it we first need to copy it to an Android device. This can be done by copying the file to an SD card, or if your device has built-in storage memory, copying the file into that.</p><p>Before we can install our package, we first need to make sure that the Android device will allow us to do so. Go into your device's <span class="strong"><strong>Settings</strong></span> program and select the <span class="strong"><strong>Applications</strong></span> option. Here there is an <span class="strong"><strong>Unknown sources</strong></span> option, which allows us to install our own packages. Make sure this option is ticked.</p><p>Next find the file manager application on your device. Different devices may have different names for this application, but it often has an icon with a picture of a filing cabinet folder on it. Navigate the directories to find the location <a id="id102" class="indexterm"/>where you copied the <code class="literal">Hello.apk</code> file, then tap on the file's entry in the list.</p><p>The screen will <a id="id103" class="indexterm"/>
<a id="id104" class="indexterm"/>
<a id="id105" class="indexterm"/>change to show a big list of things that the application is asking to access, along with the <span class="strong"><strong>Install</strong></span> and <span class="strong"><strong>Cancel</strong></span> buttons. Click on the <span class="strong"><strong>Install</strong></span> button and the package will be installed. You can then choose the <span class="strong"><strong>Open</strong></span> button to start your application, or the <span class="strong"><strong>Done</strong></span> button if you don't want to run it now. Click on <span class="strong"><strong>Open</strong></span> and we should then be greeted with our <span class="strong"><strong>Hello Android!</strong></span> message.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note11"/>Note</h3><p>By installing the Android SDK, it is also possible to speed up testing on the device by allowing the deployment tool to automatically package, install, and run the deployed package. Instructions on setting up the Android SDK so this will work can be found in <a class="link" href="ch10.html" title="Chapter 10. Extending Marmalade with the Extensions Development Kit (EDK)">Chapter 10</a>, <span class="emphasis"><em>Extending Marmalade with the Extensions Development Kit (EDK)</em></span> of this book.</p></div></div></div><div class="section" title="Installing on iOS devices"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec11"/>Installing on iOS devices</h3></div></div></div><p>If you've tried to create an<a id="id106" class="indexterm"/>
<a id="id107" class="indexterm"/>
<a id="id108" class="indexterm"/> iOS build of the "Hello World" project, you will have noticed that it currently fails to complete with a signing error. This is because you will need to provide Marmalade with some certificate files, which can only be generated by becoming a registered Apple developer.</p><p>Joining the <span class="strong"><strong>iOS Developer Program</strong></span>
<a id="id109" class="indexterm"/> currently costs $99 per year, and you can find more details about it at the following web page:</p><p>
<a class="ulink" href="https://developer.apple.com/programs/which-program/">https://developer.apple.com/programs/which-program/</a>
</p><p>Once you've signed up, you'll be able to access the <span class="strong"><strong>iOS Dev Center</strong></span>
<a id="id110" class="indexterm"/> that will then allow you to create the required certificates. Normally you would require an Apple Mac to generate these certificates, but, handily, Marmalade provides a small utility called the <span class="strong"><strong>iPhone Sign Request Tool</strong></span>
<a id="id111" class="indexterm"/> that gets around this issue. Here is what you need to do:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Launch the <a id="id112" class="indexterm"/><a id="id113" class="indexterm"/><a id="id114" class="indexterm"/>Marmalade iPhone Sign Request Tool and fill in the fields as follows:<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Certificate Request File</strong></span>: Pick a location where this file will be saved. You will need to upload this to the iOS Dev Center shortly.</li><li class="listitem"><span class="strong"><strong>Key File</strong></span>: Choose <span class="strong"><strong>developer_identity.key</strong></span> from the drop-down box.</li><li class="listitem"><span class="strong"><strong>Common Name</strong></span>: The name you used when registering with the iOS Developer Program.</li><li class="listitem"><span class="strong"><strong>Email Address</strong></span>: The e-mail address you used when registering with the iOS Developer Program.</li></ol></div></li><li class="listitem">Now log on to the iOS Dev Center and click on the <span class="strong"><strong>iOS Provisioning Portal</strong></span> link.</li><li class="listitem">In the left-hand pane, click on the <span class="strong"><strong>Certificates</strong></span> link. Click on the <span class="strong"><strong>Development</strong></span> tab and then on the <span class="strong"><strong>Request Certificate</strong></span> button to bring up a page of instructions. On this new page, press the <span class="strong"><strong>Choose File</strong></span> button to upload the file you generated in step 1.</li><li class="listitem">Click on the <span class="strong"><strong>Certificates</strong></span> link in the left-hand pane again, and click on the link telling you to download the WWDR intermediate certificate. Save this file into the subdirectory <code class="literal">s3e\deploy\plugins\iphone\certificates</code> of your Marmalade SDK installation.</li><li class="listitem">Refresh the <span class="strong"><strong>Certificates</strong></span> page in your web browser until you see a <span class="strong"><strong>Download</strong></span> button in the <span class="strong"><strong>Action</strong></span> column. Click on this button and save the file into the directory from step 4, renaming it to <code class="literal">developer_identity.cer</code>.</li><li class="listitem">In the left-hand pane, click on the <span class="strong"><strong>Devices</strong></span> link to register your test devices with the iOS Dev Center by clicking on the <span class="strong"><strong>Add Devices</strong></span> button and then entering a description for the device and its 40-character hex device ID. There is a link labeled <span class="strong"><strong>Finding the Device ID</strong></span>, which tells you how to discover this value for a particular device.</li><li class="listitem">Next click on the <span class="strong"><strong>App IDs</strong></span> link and then on the <span class="strong"><strong>New App ID</strong></span> button, and register a new App ID to use for your applications. You just need to enter a description (which can be anything you want) and a bundle identifier that is of the form <code class="literal">com.domainname.appname</code>. The <code class="literal">domainname</code> part can be pretty much anything you like (it doesn't necessarily have to relate to a real URL), while the <code class="literal">appname</code> part should either be the name of your application, or you can use an asterisk that then lets you use that App ID for any application.</li><li class="listitem">Click on the <span class="strong"><strong>Provisioning</strong></span> link and then click on the <span class="strong"><strong>New Profile</strong></span> button. Enter a descriptive name for the profile and tick the checkbox next to your certificate name. Select the App ID you generated in step 7 from the drop-down box, and then tick all the checkboxes for any device that you want this provisioning profile to apply to.</li><li class="listitem">Click on the <span class="strong"><strong>Provisioning</strong></span> link again and keep refreshing this page until a <span class="strong"><strong>Download</strong></span> button appears next to your new provisioning profile.</li></ol></div><p>There is more information<a id="id115" class="indexterm"/>
<a id="id116" class="indexterm"/>
<a id="id117" class="indexterm"/> on this process in the Marmalade Documentation help file, and there are also <span class="strong"><strong>How To</strong></span> tabs on most of the iOS Provisioning Portal pages explaining the processes involved, although most of these assume that you are using an Apple Mac to generate the various files.</p><p>With all those hurdles negotiated, we can then use <span class="strong"><strong>Marmalade System Deployment Tool</strong></span> to generate a properly signed iOS install package, which will be named <code class="literal">Hello.ipa</code>. Now to get it installed onto a device!</p><p>It is possible to use iTunes to install your builds, but be warned that it tends to be a little bit of hit and miss as to whether it will work. Sometimes iTunes does not recognize that a new build is available and needs to be synched to the device. In my experience, a more reliable option is to use the <span class="strong"><strong>iPhone Configuration Utility</strong></span>
<a id="id118" class="indexterm"/>, which is a freely available Apple tool that can be downloaded from the following URL:</p><p>
<a class="ulink" href="http://support.apple.com/kb/DL1466">http://support.apple.com/kb/DL1466</a>
</p><div class="mediaobject"><img src="graphics/3363_01_03.jpg" alt="Installing on iOS devices"/></div><p>First of all, you need to let the iPhone Configuration Utility know about your provisioning profile. Click on <span class="strong"><strong>Provisioning Profiles</strong></span> in the far left pane and then click on the <span class="strong"><strong>Add</strong></span> button in the toolbar. Navigate to the provisioning profile file you created in step 9 and click the <span class="strong"><strong>Open</strong></span> button to add it to the list of available profiles. Alternatively, you can drag-and-drop the file into the list from Windows Explorer.</p><p>Next, click on the <span class="strong"><strong>Applications</strong></span> entry in the left-hand panel and then click on the <span class="strong"><strong>Add</strong></span> button. Find the <code class="literal">Hello.ipa</code> file<a id="id119" class="indexterm"/> in the deployment's <code class="literal">release</code> directory and click on <span class="strong"><strong>OK</strong></span> to add it to the list of known applications, or again you can drag-and-drop the file from Windows Explorer into the list.</p><p>Now connect your<a id="id120" class="indexterm"/>
<a id="id121" class="indexterm"/>
<a id="id122" class="indexterm"/> iOS device to your computer using a USB cable. It should appear in the bottom of the left-hand pane after a short delay. Click on the name of your device and you should see five tabs appear in the main panel. Click the <span class="strong"><strong>Provisioning Profiles</strong></span> tab and then click on the <span class="strong"><strong>Install</strong></span> button next to your provisioning profile. Once done, this button will change to become a <span class="strong"><strong>Remove</strong></span> button.</p><p>Our next step is to install the application itself, so click on the <span class="strong"><strong>Applications</strong></span> tab to see a list of all applications that are either installed on the device already, or which can be installed. Find the entry labeled <span class="strong"><strong>Hello</strong></span> and click on its <span class="strong"><strong>Install</strong></span> button, which will change to read <span class="strong"><strong>Remove</strong></span> once the application is installed.</p><p>After all that, we <a id="id123" class="indexterm"/>
<a id="id124" class="indexterm"/>
<a id="id125" class="indexterm"/>can finally run our application by finding its icon on the device and tapping on it. You should see the message <span class="strong"><strong>Hello iOS!</strong></span>, which I admit may seem like something of an anticlimax after going through such a drawn-out process.</p></div><div class="section" title="Installing on BlackBerry QNX devices"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec12"/>Installing on BlackBerry QNX devices</h3></div></div></div><p>Marmalade can also deploy to <a id="id126" class="indexterm"/>
<a id="id127" class="indexterm"/>BlackBerry QNX devices, the best known of which is the <a id="id128" class="indexterm"/>PlayBook tablet. In order to deploy to PlayBook, we need to do some setup work first. In the steps that follow, there are some commandlines that need to be entered. In these commandlines there are some arguments enclosed in angled brackets. After each set of commands, there is a table explaining what to replace the angle-bracketed arguments with.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First head over to the following URL to download the BlackBerry Native SDK, which contains some tools needed for signing builds:<p>
<a class="ulink" href="https://developer.blackberry.com/native/download/">https://developer.blackberry.com/native/download/</a>
</p></li><li class="listitem">Run the installer by right-clicking on its icon in Windows Explorer and selecting the <span class="strong"><strong>Run as Administrator</strong></span> option to avoid permission problems when installing the SDK.</li><li class="listitem">After the installation is complete, head over to the following URL to request some signing keys:<p>
<a class="ulink" href="https://www.blackberry.com/SignedKeys/nfc-form.html">https://www.blackberry.com/SignedKeys/nfc-form.html</a>
</p></li><li class="listitem">We need to request a <a id="id129" class="indexterm"/> <span class="strong"><strong>Device Code Signing Key</strong></span>, so select the first radio button to request this key type and then enter the personal information requested (your name, company name, and so on). You will also be asked to enter a PIN value consisting of eight alphanumeric characters. Ensure that you remember what you enter at this stage because you will need it to complete the registration of the keys.</li><li class="listitem">Make sure the checkbox labeled <span class="strong"><strong>For BlackBerry PlayBook OS and BlackBerry 10 and Higher</strong></span> is checked before ticking the license agreement checkbox and clicking on the <span class="strong"><strong>Submit</strong></span> button.</li><li class="listitem">The key files will be e-mailed to you, but there can be a delay of a few hours before they arrive. When you have the key files, create an empty folder on your PC and save them into it. We'll be assuming a folder called <code class="literal">C:\PlayBook</code> for the following steps.</li><li class="listitem">Open a command-prompt window and change the current directory to be the one you created in step 6, and enter the following commands. The first command sets up the <code class="literal">PATH</code> environment variable<a id="id130" class="indexterm"/> so that the other commands can be executed. These commands register your key files with the BlackBerry signing servers and <a id="id131" class="indexterm"/><a id="id132" class="indexterm"/>allow your PC to generate debug tokens:<div class="informalexample"><pre class="programlisting">C:\PlayBook&gt; C:\bbndk-2.0.1\bbndk-env.bat
C:\PlayBook&gt; blackberry-keytool -genkeypair -keystore sigtool.p12 -storepass &lt;password&gt; -dname "cn=&lt;company name&gt;" -alias author
C:\PlayBook&gt; blackberry-signer -csksetup -cskpass &lt;password&gt;
C:\PlayBook&gt; blackberry-signer -register -csjpin &lt;pin&gt; -cskpass &lt;password&gt; &lt;RDK file&gt;
C:\PlayBook&gt; blackberry-debugtokenrequest.bat -register -cskpass &lt;password&gt; -csjpin &lt;pin&gt; &lt;PBDT file&gt;</pre></div><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Argument</p>
</th><th style="text-align: left" valign="bottom">
<p>Value to enter</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">&lt;company name&gt;</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The company name you specified when requesting the key files in step 4.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">&lt;password&gt;</code>
</p>
</td><td style="text-align: left" valign="top">
<p>A password of your choosing. Use the same value in each command.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">&lt;PBDT file&gt;</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The filename of the PBDT key file that was e-mailed to you in step 6. This filename should be of the form <code class="literal">client-PBDT-1234567.csj</code>, where the numeric part will be unique to your key file.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">&lt;pin&gt;</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The PIN value you specified when requesting the key files in step 4.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">&lt;RDK file&gt;</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The filename of the RDK key file that was e-mailed to you in step 6. This filename should be of the form <code class="literal">client-RDK-1234567.csj</code>, where the numeric part will be unique to your key file.</p>
</td></tr></tbody></table></div></li><li class="listitem">We can now generate a debug token file with the following commandline:<div class="informalexample"><pre class="programlisting">C:\PlayBook&gt; blackberry-debugtokenrequest -cskpass &lt;password&gt; -keystore sigtool.p12 -storepass &lt;password&gt; -deviceId 0x&lt;device id&gt; debugtoken.bar</pre></div><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Argument</p>
</th><th style="text-align: left" valign="bottom">
<p>Value to enter</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">&lt;device id&gt;</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The device ID of your BlackBerry device. As an example, you can find out this value on a PlayBook by going into the settings screen, clicking on the <span class="strong"><strong>About</strong></span> item in the left-hand pane, and selecting the <span class="strong"><strong>Hardware</strong></span> option in the drop-down box. The value labeled <span class="strong"><strong>PIN</strong></span> is the device ID. When you specify this value in the commandline, make sure you prefix it with <code class="literal">0x</code>, as you would in C++ source code, to indicate a hexadecimal value.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">&lt;password&gt;</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the same password you used in the previous set of commands.</p>
</td></tr></tbody></table></div></li><li class="listitem">To install the debug token on to the device, first ensure that the device is connected via WiFi to the same network as your PC and then look at the device settings to determine the IP address assigned to it. This can be found by going to the <span class="strong"><strong>About</strong></span> panel and selecting <span class="strong"><strong>Network</strong></span> in the drop-down box.</li><li class="listitem">Next we must enable development mode on the device, which can be done in the settings screen. Choose the <span class="strong"><strong>Security</strong></span> panel and then click on the <span class="strong"><strong>Development Mode</strong></span> entry on that screen. Set the toggle control next to <span class="strong"><strong>Use Development Mode</strong></span> to <span class="strong"><strong>On</strong></span>. You will be asked to enter a password for using development mode, so enter one into the edit boxes and click on the <span class="strong"><strong>Upload Debug Token</strong></span> button.</li><li class="listitem">Now we have to <a id="id133" class="indexterm"/><a id="id134" class="indexterm"/>enter one more commandline to install the debug token on the device.<div class="informalexample"><pre class="programlisting">C:\PlayBook&gt; blackberry-deploy -installDebugToken debugtoken.bar -device &lt;ip address&gt; -password &lt;device password&gt;</pre></div><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Argument</p>
</th><th style="text-align: left" valign="bottom">
<p>Value to Enter</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">&lt;device password&gt;</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The device password you set in step 10.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">&lt;ip address&gt;</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The IP address of the device as discovered in step 9.</p>
</td></tr></tbody></table></div></li><li class="listitem">Now we have to add the following two lines to the <code class="literal">deployments</code> sections of the MKB file, to allow us to make a valid deployment package:<div class="informalexample"><pre class="programlisting">playbook-author="&lt;company name&gt;"
playbook-authorid="&lt;author id&gt;"</pre></div><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Argument</p>
</th><th style="text-align: left" valign="bottom">
<p>Value to Enter</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">&lt;company name&gt;</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The company name value you specified when requesting the key files in step 4.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">&lt;author id&gt;</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Finding the value for this is a little convoluted. First make a copy of the <code class="literal">debugtoken.bar</code> file generated in step 8, renaming it with the extension <code class="literal">.zip</code>. You can now use an archiving program to look inside this file. Enter the <code class="literal">META_INF</code> directory and extract the <code class="literal">MANIFEST.MF</code> file. Open this file in a text editor and look for an entry called <code class="literal">Package-Author-Id</code>. The string of characters following this entry is the value you need to put in the MKB file.</p>
</td></tr></tbody></table></div></li><li class="listitem">If Visual C++ is open, shut it down. Double-click the project MKB file to rebuild it with the changes made previously and start up Visual C++. Perform a <span class="strong"><strong>GCC (ARM) Release</strong></span> build of the project and then press <span class="emphasis"><em>F5</em></span> to launch the deployment tool.</li><li class="listitem">In the deployment tool, change the settings to create a BlackBerry QNX deployment. When you reach the page labeled <span class="strong"><strong>Deployment Summary</strong></span>, change the drop-down box to the <span class="strong"><strong>Package and Install</strong></span> option before clicking the <span class="strong"><strong>Deploy All</strong></span> button.</li><li class="listitem">The final page in the deployment tool will be displayed, which for BlackBerry deployments has two additional fields. The first is labeled <span class="strong"><strong>Device hostname (or IP address)</strong></span> for which you should supply the IP address of the device that you want to install the package to. The other field is labeled <span class="strong"><strong>Device password</strong></span>, and you should enter the password you set up in step 10. Click on the <span class="strong"><strong>Deploy All</strong></span> button again and the deployment will be made and installed to the device over WiFi.</li></ol></div><p>The build should now be <a id="id135" class="indexterm"/>
<a id="id136" class="indexterm"/>installed on the device, so breathe a sigh of relief and then look for its icon in the applications list. Touch the icon to run the program, and you should be greeted with the merry little message <span class="strong"><strong>Hello BlackBerry!</strong></span>
</p></div><div class="section" title="Installing on Bada devices"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec13"/>Installing on Bada devices</h3></div></div></div><p>Installing a <a id="id137" class="indexterm"/>
<a id="id138" class="indexterm"/>
<a id="id139" class="indexterm"/>build on to a Bada device is one example where using the <span class="strong"><strong>Package, Install and Run</strong></span> option in <span class="strong"><strong>Marmalade System Deployment Tool</strong></span>
<a id="id140" class="indexterm"/> is actually a very good idea, as it is not possible to copy the package to a Bada device manually to install it.</p><p>To begin with, you need to install some device drivers for your Bada device so that the deployment tool can connect to it. Marmalade does ship with some drivers for Bada, but working out which of the three possible drivers matches your device can be hard to work out. For this reason, it is better to first install the <a id="id141" class="indexterm"/>Samsung Kies utility, which comes with a number of drivers and will install the correct one for you automatically. You can<a id="id142" class="indexterm"/> download Kies from the following web address:</p><p>
<a class="ulink" href="http://www.samsung.com/uk/support/usefulsoftware/KIES/JSP">http://www.samsung.com/uk/support/usefulsoftware/KIES/JSP</a>
</p><p>After installing Kies, connect your device to your computer with a USB cable and run the deployment tool. When you get to the platform selection page, you will see that there are four possible options for Bada. You must select the correct one for your device, which is based on both the version of Bada your device has and also its screen resolution.</p><p>Having chosen the correct Bada platform option, click on the <span class="strong"><strong>Next Stage &gt;</strong></span> button and then choose <span class="strong"><strong>Package, Install and Run</strong></span> in the drop-down box at the top of the window. Click on the <span class="strong"><strong>Deploy All</strong></span> button and an install package will be made, which is installed on to your device and <a id="id143" class="indexterm"/>
<a id="id144" class="indexterm"/>
<a id="id145" class="indexterm"/>executed, and you should then see the <span class="strong"><strong>Hello Bada!</strong></span> message in all its monochrome glory!</p></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Summary</h1></div></div></div><p>The "Hello World" project may have been very simple, but it has served to demonstrate a surprising amount of the power of Marmalade. We now know how to create a new Marmalade project, build it, and create and apply our own application-specific settings to it.</p><p>We then ran our project in the Windows simulator and learned how to deploy and run it on a number of different mobile platforms.</p><p>Displaying some text on the screen isn't the most exciting thing in the world though, so in the next chapter we will learn how we can use the Marmalade SDK to draw simple 2D images on the screen. We'll also be finding out how Marmalade makes it easy for us to use bitmapped images.</p></div></body></html>