<html><head></head><body><div><div><div><h1 class="chapterNumber">8</h1>
    <h1 id="_idParaDest-125" class="chapterTitle">Protocols, Extensions, and Error Handling</h1>
    <p class="normal">In the previous chapter, you learned how to represent complex objects using classes or structures and how to use enumerations to group related values together.</p>
    <p class="normal">In this chapter, you’ll <a id="_idIndexMarker312"/>learn about <strong class="keyWord">protocols</strong>, <strong class="keyWord">extensions</strong>, and <strong class="keyWord">error handling</strong>. Protocols define <a id="_idIndexMarker313"/>a blueprint of methods, properties, and other requirements <a id="_idIndexMarker314"/>that can be adopted by a class, structure, or enumeration. Extensions enable you to provide new functionality for an existing class, structure, or enumeration. Error handling covers how to respond to and recover from errors in your program.</p>
    <p class="normal">By the end of this chapter, you’ll be able to write your own protocols to meet the requirements of your apps, use extensions to add new capabilities to existing types, and handle error conditions in your apps without crashing.</p>
    <p class="normal">The following topics will be covered in this chapter:</p>
    <ul>
      <li class="bulletList">Exploring protocols</li>
      <li class="bulletList">Exploring extensions</li>
      <li class="bulletList">Exploring error handling</li>
    </ul>
    <h1 id="_idParaDest-126" class="heading-1">Technical requirements</h1>
    <p class="normal">The Xcode playground for this chapter is in the <code class="inlineCode">Chapter08</code> folder of the code bundle for this book, which can be downloaded here:</p>
    <p class="normal"><a href="https://github.com/PacktPublishing/iOS-18-Programming-for-Beginners-Ninth-Edition">https://github.com/PacktPublishing/iOS-18-Programming-for-Beginners-Ninth-Edition</a></p>
    <p class="normal">Check out the following video to see the code in action:</p>
    <p class="normal"><a href="https://youtu.be/fV6VNlDyyG0%0D">https://youtu.be/fV6VNlDyyG0</a></p>
    <p class="normal">If you wish to start from scratch, create a new playground and name it <code class="inlineCode">ProtocolsExtensionsAndErrorHandling</code>. You can type in and run all the code in this chapter as you go along. Let’s start with protocols, which is a way of specifying the properties and methods that a class, structure, or enumeration should have.</p>
    <h1 id="_idParaDest-127" class="heading-1">Exploring protocols</h1>
    <p class="normal">Protocols are like blueprints that determine what properties or methods an object must have. After you’ve <a id="_idIndexMarker315"/>declared a protocol, classes, structures, and enumerations can adopt it and provide their own implementation for the required properties and methods.</p>
    <p class="normal">Here’s what a protocol declaration looks like:</p>
    <pre class="programlisting code"><code class="hljs-code">protocol ProtocolName {
  var readWriteProperty1 {get set}
  var readOnlyProperty2 {get}
  func methodName1()
  func methodName2()
}
</code></pre>
    <p class="normal">Just like classes and structures, protocol names start with an uppercase letter. Properties are declared using the <code class="inlineCode">var</code> keyword. You use <code class="inlineCode">{get set}</code> if you want a property that can be read from or written to, and you use <code class="inlineCode">{get}</code> if you want a read-only property. Note that you just specify property and method names; the implementation is done within the adopting class, structure, or enumeration.</p>
    <div><p class="normal">For more <a id="_idIndexMarker316"/>information on protocols, visit <a href="https://docs.swift.org/swift-book/documentation/the-swift-programming-language/protocols">https://docs.swift.org/swift-book/documentation/the-swift-programming-language/protocols</a>.</p>
    </div>
    <p class="normal">To help you understand protocols, imagine an app used by a fast-food restaurant. The management has decided to show calorie counts for the meals being served. The app currently has the following class, structure, and enumeration, and none of them have calorie counts implemented:</p>
    <ul>
      <li class="bulletList">A <code class="inlineCode">Burger</code> class</li>
      <li class="bulletList">A <code class="inlineCode">Fries</code> structure</li>
      <li class="bulletList">A <code class="inlineCode">Sauce</code> enumeration</li>
    </ul>
    <p class="normal">Add the following code to your playground to declare the <code class="inlineCode">Burger</code> class, the <code class="inlineCode">Fries</code> structure, and the <code class="inlineCode">Sauce</code> enumeration:</p>
    <pre class="programlisting code"><code class="hljs-code">class Burger {
}
struct Fries {
}
enum Sauce {
  case chili
  case tomato
}
</code></pre>
    <p class="normal">These represent <a id="_idIndexMarker317"/>the existing class, structure, and enumeration in the app. Don’t worry about the empty definitions, as they are not required for this lesson. As you can see, none of them have calorie counts at present. Let’s learn how to create a protocol that specifies the properties and methods needed to implement calorie counts. You’ll start by declaring this protocol in the next section.</p>
    <h2 id="_idParaDest-128" class="heading-2">Creating a protocol declaration</h2>
    <p class="normal">Let’s create <a id="_idIndexMarker318"/>a protocol that specifies a required <a id="_idIndexMarker319"/>property, <code class="inlineCode">calories</code>, and a method, <code class="inlineCode">description()</code>. Type the following into your playground before the class, structure, and enumeration declarations:</p>
    <pre class="programlisting code"><code class="hljs-code">protocol CalorieCountable {
  var calories: Int { get }
  func description() -&gt; String
}
</code></pre>
    <p class="normal">This protocol is named <code class="inlineCode">CalorieCountable</code>. It specifies that any object that adopts it must have a property, <code class="inlineCode">calories</code>, that holds the calorie count, and a method, <code class="inlineCode">description()</code>, that returns a string.<code class="inlineCode">{ get }</code> means that you only need to be able to read the value stored in <code class="inlineCode">calories</code>, and you don’t have to write to it. Note that the definition of the <code class="inlineCode">description()</code> method is not specified, as that will be done in the class, structure, or enumeration. All you need to do to adopt a protocol is type a colon after the class name, followed by the protocol name, and implement the required properties and methods.</p>
    <p class="normal">To make the <code class="inlineCode">Burger</code> class conform to this protocol, modify your code as follows:</p>
    <pre class="programlisting code"><code class="hljs-code">class Burger<strong class="hljs-slc">: </strong><strong class="hljs-con-class-slc">CalorieCountable</strong> {
<strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">let</strong><strong class="hljs-slc"> </strong><strong class="hljs-template-variable-slc">calories</strong><strong class="hljs-slc"> </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> </strong><strong class="hljs-number-slc">800</strong>
<strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">func</strong><strong class="hljs-slc"> </strong><strong class="hljs-template-variable-slc">description</strong><strong class="hljs-slc">() -&gt; </strong><strong class="hljs-type-slc">String</strong><strong class="hljs-slc"> {</strong>
<strong class="hljs-slc">    </strong><strong class="hljs-string-slc">"This burger has </strong><strong class="hljs-slc">\(</strong><strong class="hljs-variable-slc">calories</strong><strong class="hljs-slc">)</strong><strong class="hljs-string-slc"> calories"</strong>
<strong class="hljs-slc">  }</strong>
}
</code></pre>
    <p class="normal">As you <a id="_idIndexMarker320"/>can see, the <code class="inlineCode">calories</code> property and the <code class="inlineCode">description()</code> method have been added to the <code class="inlineCode">Burger</code> class. Even though the protocol <a id="_idIndexMarker321"/>specifies a variable, you can use a constant here because the protocol only requires that you get the value for <code class="inlineCode">calories</code>, not set it.</p>
    <p class="normal">Let’s make the <code class="inlineCode">Fries</code> structure adopt this protocol as well. Modify your code for the <code class="inlineCode">Fries</code> structure as follows:</p>
    <pre class="programlisting code"><code class="hljs-code">struct Fries<strong class="hljs-slc">: </strong><strong class="hljs-con-class-slc">CalorieCountable</strong><strong class="hljs-slc"> </strong>{
<strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">let</strong><strong class="hljs-slc"> </strong><strong class="hljs-template-variable-slc">calories</strong><strong class="hljs-slc"> </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> </strong><strong class="hljs-number-slc">500</strong>
<strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">func</strong><strong class="hljs-slc"> </strong><strong class="hljs-template-variable-slc">description</strong><strong class="hljs-slc">() -&gt; </strong><strong class="hljs-type-slc">String</strong><strong class="hljs-slc"> {</strong>
<strong class="hljs-slc">    </strong><strong class="hljs-string-slc">"</strong><strong class="hljs-string-slc">These fries have </strong><strong class="hljs-slc">\(</strong><strong class="hljs-variable-slc">calories</strong><strong class="hljs-slc">)</strong><strong class="hljs-string-slc"> calories"</strong>
<strong class="hljs-slc">  }</strong>
}
</code></pre>
    <p class="normal">The code added to the <code class="inlineCode">Fries</code> structure is similar to that added to the <code class="inlineCode">Burger</code> class, and it now conforms to the <code class="inlineCode">CalorieCountable</code> protocol as well.</p>
    <p class="normal">You could modify the <code class="inlineCode">Sauce</code> enumeration in the same way, but let’s do it using extensions instead. Extensions extend the capabilities of an existing class, structure, or enumeration. You’ll add the <code class="inlineCode">CalorieCountable</code> protocol to the <code class="inlineCode">Sauce</code> enumeration using an extension in the next section.</p>
    <h1 id="_idParaDest-129" class="heading-1">Exploring extensions</h1>
    <p class="normal">Extensions allow you to provide extra capabilities to an object without modifying the original <a id="_idIndexMarker322"/>object definition. You can use them on Apple-provided objects (where you don’t have access to the object definition) or when you wish to segregate your code for readability and ease of maintenance. Here’s what an extension looks like:</p>
    <pre class="programlisting code"><code class="hljs-code">class ExistingType {
  property1
  method1()
}
extension ExistingType : ProtocolName {
  property2
  method2()
}
</code></pre>
    <p class="normal">Here, an extension is used to provide an additional property and method to an existing class.</p>
    <div><p class="normal">For more <a id="_idIndexMarker323"/>information on extensions, visit <a href="https://docs.swift.org/swift-book/documentation/the-swift-programming-language/extensions">https://docs.swift.org/swift-book/documentation/the-swift-programming-language/extensions</a>.</p>
    </div>
    <p class="normal">Let’s look at how to use extensions. You’ll start by making the <code class="inlineCode">Sauce</code> enumeration conform to the <code class="inlineCode">CalorieCountable</code> protocol using an extension in the next section.</p>
    <h2 id="_idParaDest-130" class="heading-2">Adopting a protocol via an extension</h2>
    <p class="normal">At present, the <code class="inlineCode">Sauce</code> enumeration does not conform to the <code class="inlineCode">CalorieCountable</code> protocol. You’ll <a id="_idIndexMarker324"/>use an extension to add the properties <a id="_idIndexMarker325"/>and methods required to make it conform. Type in the following code after the declaration for the <code class="inlineCode">Sauce</code> enumeration:</p>
    <pre class="programlisting code"><code class="hljs-code">enum Sauce {
  case chili
  case tomato
}
<strong class="hljs-keyword-slc">extension</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">Sauce</strong><strong class="hljs-slc">: </strong><strong class="hljs-con-class-slc">CalorieCountable</strong><strong class="hljs-slc"> {</strong>
<strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">var</strong><strong class="hljs-slc"> </strong><strong class="hljs-template-variable-slc">calories</strong><strong class="hljs-slc">: </strong><strong class="hljs-type-slc">Int</strong><strong class="hljs-slc"> {</strong>
<strong class="hljs-slc">    </strong><strong class="hljs-keyword-slc">switch</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">self</strong><strong class="hljs-slc"> {</strong>
<strong class="hljs-slc">    </strong><strong class="hljs-keyword-slc">case</strong><strong class="hljs-slc"> .</strong><strong class="hljs-variable-slc">chili</strong><strong class="hljs-slc">:</strong>
<strong class="hljs-slc">      </strong><strong class="hljs-number-slc">20</strong>
<strong class="hljs-slc">    </strong><strong class="hljs-keyword-slc">case</strong><strong class="hljs-slc"> .</strong><strong class="hljs-variable-slc">tomato</strong><strong class="hljs-slc">:</strong>
<strong class="hljs-slc">      </strong><strong class="hljs-number-slc">15</strong>
<strong class="hljs-slc">    }</strong>
<strong class="hljs-slc">  }</strong>
<strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">func</strong><strong class="hljs-slc"> </strong><strong class="hljs-template-variable-slc">description</strong><strong class="hljs-slc">() -&gt; </strong><strong class="hljs-type-slc">String</strong><strong class="hljs-slc"> {</strong>
<strong class="hljs-slc">    </strong><strong class="hljs-string-slc">"This sauce has</strong><strong class="hljs-slc"> \(</strong><strong class="hljs-variable-slc">calories</strong><strong class="hljs-slc">)</strong><strong class="hljs-string-slc"> calories"</strong>
<strong class="hljs-slc">  }</strong>
<strong class="hljs-slc">}</strong>
</code></pre>
    <p class="normal">As you can see, no changes were made to the original definition for the <code class="inlineCode">Sauce</code> enumeration. This is also useful if you want to extend the capabilities of existing Swift standard types, such as <code class="inlineCode">String</code> and <code class="inlineCode">Int</code>.</p>
    <p class="normal">Enumeration <a id="_idIndexMarker326"/>instances can’t store values in properties <a id="_idIndexMarker327"/>the way structures and classes can, so a <code class="inlineCode">switch</code> statement is used to return the number of calories based on the enumeration’s value. The <code class="inlineCode">description()</code> method is the same as the one in the <code class="inlineCode">Burger</code> class and the <code class="inlineCode">Fries</code> structure.</p>
    <p class="normal">All three objects have a <code class="inlineCode">calories</code> property and a <code class="inlineCode">description()</code> method. Great!</p>
    <p class="normal">Let’s see how you can put them in an array and perform an operation to get the total calorie count for a meal in the next section.</p>
    <h2 id="_idParaDest-131" class="heading-2">Creating an array of different types of objects</h2>
    <p class="normal">Ordinarily, an <a id="_idIndexMarker328"/>array’s elements must be of <a id="_idIndexMarker329"/>the same type. However, since the <code class="inlineCode">Burger</code> class, the <code class="inlineCode">Fries</code> structure, and the <code class="inlineCode">Sauce</code> enumeration all conform to the <code class="inlineCode">CalorieCountable</code> protocol, you can make an array that contains elements conforming to this protocol. Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">To add instances of the <code class="inlineCode">Burger</code> class, the <code class="inlineCode">Fries</code> structure, and the <code class="inlineCode">Sauce</code> enumeration to an array, type in the following code after all other code in the file:
        <pre class="programlisting code-one"><code class="hljs-code">let burger = Burger()
let fries = Fries()
let sauce = Sauce.tomato
let foodArray: [CalorieCountable] = [burger, fries, sauce]
</code></pre>
      </li>
      <li class="numberedList">To get the total calorie count, add the following code after the line where you created the <code class="inlineCode">foodArray</code> constant:
        <pre class="programlisting code-one"><code class="hljs-code">let totalCalories = foodArray.reduce(0, {$0 + $1.calories})
print(totalCalories)
</code></pre>
      </li>
    </ol>
    <p class="normal-one">The <code class="inlineCode">reduce</code> method is used to produce a single value from the elements of the <code class="inlineCode">foodArray</code> array. The first parameter of this method is the initial value, and it is set to <code class="inlineCode">0</code>. The second parameter is a closure that combines the initial value with the value stored in an element’s <code class="inlineCode">calories</code> property. This is repeated for each element in the <code class="inlineCode">foodArray</code> array and the result is assigned to <code class="inlineCode">totalCalories</code>. The total amount, <strong class="screenText">1315</strong>, will be displayed in the Debug area.</p>
    <p class="normal">You have <a id="_idIndexMarker330"/>learned how to create a protocol and make <a id="_idIndexMarker331"/>a class, structure, or enumeration conform to it, either within the class definition or via extensions. Let’s look at error handling next, and see how to respond to or recover from errors in your program.</p>
    <h1 id="_idParaDest-132" class="heading-1">Exploring error handling</h1>
    <p class="normal">When you write apps, bear in mind that error conditions may happen, and error handling is how your app responds to and recovers from such conditions.</p>
    <p class="normal">First, you create <a id="_idIndexMarker332"/>a type that conforms to Swift’s <code class="inlineCode">Error</code> protocol, which lets this type be used for error handling. Enumerations are normally used, as you can specify associated values for different kinds of errors. When something unexpected happens, you can stop program execution by throwing an error. You use the <code class="inlineCode">throw</code> statement for this and provide an instance of the type conforming to the <code class="inlineCode">Error</code> protocol, with the appropriate value. This allows you to see what went wrong.</p>
    <p class="normal">Of course, it would be better if you could respond to an error without stopping your program. For this, you can use a <code class="inlineCode">do-catch</code> block, which looks like this:</p>
    <pre class="programlisting code"><code class="hljs-code">do {
  try expression1
  statement1
} catch {
  statement2
}
</code></pre>
    <p class="normal">Here, you attempt to execute code in the <code class="inlineCode">do</code> block using the <code class="inlineCode">try</code> keyword. If an error is thrown, the statements in the <code class="inlineCode">catch</code> block are executed. You can have multiple <code class="inlineCode">catch</code> blocks to handle different error types.</p>
    <div><p class="normal">For more <a id="_idIndexMarker333"/>information on error handling, visit <a href="https://docs.swift.org/swift-book/documentation/the-swift-programming-language/errorhandling">https://docs.swift.org/swift-book/documentation/the-swift-programming-language/errorhandling</a>.</p>
    </div>
    <p class="normal">As an example, let’s say you have an app that needs to access a web page. However, if the server <a id="_idIndexMarker334"/>where that web page is located is down, it is up to you to write the code to handle the error, such as trying an alternative web server or informing the user that the server is down.</p>
    <p class="normal">Let’s create an enumeration that conforms to the <code class="inlineCode">Error</code> protocol, use a <code class="inlineCode">throw</code> statement to stop program execution when an error occurs, and use a <code class="inlineCode">do-catch</code> block to handle an error. Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">Type the following code into your playground:
        <pre class="programlisting code-one"><code class="hljs-code">enum WebsiteError: Error {
  case noInternetConnection
  case siteDown
  case wrongURL
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">This declares an enumeration, <code class="inlineCode">WebsiteError</code>, that adopts the <code class="inlineCode">Error</code> protocol. It covers three possible error conditions: there is no internet connection, the website is down, or the URL cannot be resolved.</p>
    <ol>
      <li class="numberedList" value="2">Type the following code after the <code class="inlineCode">WebsiteError</code> definition to declare a function that checks if a website is up after the <code class="inlineCode">WebpageError</code> declaration:
        <pre class="programlisting code-one"><code class="hljs-code">func checkWebsite(siteUp: Bool) throws -&gt; String {
  if !siteUp {
    throw WebsiteError.siteDown
  }
  return "Site is up"
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">If <code class="inlineCode">siteUp</code> is <code class="inlineCode">true</code>, <code class="inlineCode">"Site is up"</code> is returned. If <code class="inlineCode">siteUp</code> is <code class="inlineCode">false</code>, the program will stop executing and throw an error.</p>
    <ol>
      <li class="numberedList" value="3">Type the following code after the <code class="inlineCode">checkWebsite(siteUp:)</code> function definition and run your program:
        <pre class="programlisting code-one"><code class="hljs-code">let siteStatus = true
try checkWebsite(siteUp: siteStatus)
</code></pre>
      </li>
    </ol>
    <p class="normal-one">Since <code class="inlineCode">siteStatus</code> is <code class="inlineCode">true</code>, <strong class="screenText">Site is up</strong> will appear in the Results area.</p>
    <ol>
      <li class="numberedList" value="4">Change the value of <code class="inlineCode">siteStatus</code> to <code class="inlineCode">false</code> and run your program. Your program <a id="_idIndexMarker335"/>crashes and the following error message is displayed in the Debug area:
        <pre class="programlisting con-one"><code class="hljs-con">Playground execution terminated: An error was thrown and was not caught:
error: error:
</code></pre>
      </li>
      <li class="numberedList">Of course, it is always better if you can handle errors without making your program crash. You can do this by using a <code class="inlineCode">do-catch</code> block. Modify your code as shown and run it:
        <pre class="programlisting code-one"><code class="hljs-code">let siteStatus = false
<strong class="hljs-keyword-slc">do</strong><strong class="hljs-slc"> {</strong>
<strong class="hljs-slc">  print(</strong>try checkWebsite(siteUp: siteStatus)<strong class="hljs-slc">)</strong>
<strong class="hljs-slc">} </strong><strong class="hljs-keyword-slc">catch</strong><strong class="hljs-slc"> {</strong>
<strong class="hljs-slc">  </strong><strong class="hljs-slc">print(</strong><strong class="hljs-variable-slc">error</strong><strong class="hljs-slc">)</strong>
<strong class="hljs-slc">}</strong>
</code></pre>
      </li>
    </ol>
    <p class="normal-one">The <code class="inlineCode">do</code> block tries to execute the <code class="inlineCode">checkWebsite(siteUp:)</code> function and prints the status if successful. If there is an error, instead of crashing, the statements in the <code class="inlineCode">catch</code> block are executed, and the error message <code class="inlineCode">siteDown</code> appears in the Debug area.</p>
    <div><p class="normal">You can make your program handle different error conditions by implementing multiple <code class="inlineCode">catch</code> blocks. See this link for details: <a href="https://docs.swift.org/swift-book/documentation/the-swift-programming-language/errorhandling">https://docs.swift.org/swift-book/documentation/the-swift-programming-language/errorhandling</a>.</p>
    </div>
    <p class="normal">You have learned how to handle errors in your app without making it crash. Great!</p>
    <h1 id="_idParaDest-133" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, you learned how to write protocols and how to make classes, structures, and enumerations conform to them. You also learned how to extend the capabilities of a class by using an extension. Finally, you learned how to handle errors using the <code class="inlineCode">do-catch</code> block.</p>
    <p class="normal">These may seem rather abstract and hard to understand now, but in <em class="italic">Part 3</em> of this book, you will see how to use protocols to implement common functionalities in different parts of your program instead of writing the same program over and over. You will see how useful extensions are in organizing your code, which makes it easy to maintain. Finally, you’ll see how good error handling makes it easy to pinpoint the mistakes you made while coding your app.</p>
    <p class="normal">In the next chapter, you will learn about <strong class="keyWord">Swift concurrency</strong>, a new way to handle asynchronous operations in Swift.</p>
    <h1 id="_idParaDest-134" class="heading-1">Join us on Discord!</h1>
    <p class="normal">Read this book alongside other users, experts, and the author himself. Ask questions, provide solutions to other readers, chat with the author via Ask Me Anything sessions, and much more. Scan the QR code or visit the link to join the community.</p>
    <p class="normal"><a href="https://packt.link/ios-Swift">https://packt.link/ios-Swift</a></p>
    <p class="normal"><a href="https://packt.link/ios-Swift"><img src="img/QR_Code2370024260177612484.png" alt="" width="177" height="177"/></a></p>
  </div>
</div></div></body></html>