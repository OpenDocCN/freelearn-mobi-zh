<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-47"><a id="_idTextAnchor272"/>3</h1>
<h1 id="_idParaDest-48"><a id="_idTextAnchor273"/>iPhone Project – Tax Calculator Functionality</h1>
<p>In this chapter, we will work on implementing the tax calculation and page navigation functionality in our first project, the tax calculator. In the previous chapter, we looked at the design of the calculator and broke it down into two views and all the components required. We then implemented all the components using SwiftUI. At the end of the previous chapter, we effectively only had a fancy wireframe. Now, we will implement all the functionality to provide navigation between the two views, calculating the tax breakdown and displaying the calculation.</p>
<p>This chapter will be split into the following sections:</p>
<ul>
<li>Navigating from <code>ContentView</code> to <code>ResultsView</code></li>
<li>Input validation</li>
<li>Calculating tax breakdown</li>
<li>Extra tasks</li>
</ul>
<p>By the end of this chapter, you will have created a fully functional tax calculator that can be used as a foundation. I’ll provide exercises as we reach the end of the chapter to implement more advanced functionality within the tax calculator. The code is yours to use, modify, and distribute as you see fit. This will transition nicely into our next project, the iPad gallery app.</p>
<h1 id="_idParaDest-49"><a id="_idTextAnchor274"/>Technical Requirements</h1>
<p>This chapter requires you to download Xcode version 14 or above from Apple’s App Store.</p>
<p>To install Xcode, just search for <code>Xcode</code> in the App Store, and select and download the latest version. Open Xcode and follow any additional installation instructions. Once Xcode has opened and launched, you’re ready to go.</p>
<p>Version 14 of Xcode has the following features/requirements:</p>
<ul>
<li>Includes SDKs for iOS 16, iPadOS 16, macOS 12.3, tvOS 16, and watchOS 9</li>
<li>Supports on-device debugging in iOS 11 or later, tvOS 11 or later, and watchOS 4 or later</li>
<li>Requires a Mac running macOS Monterey 12.5 or later</li>
<li>For further information regarding the technical details, please refer to <a href="B18783_01.xhtml#_idTextAnchor014"><em class="italic">Chapter 1</em></a>.</li>
</ul>
<p>The code files for this chapter and the previous chapter to use as a base can be found here: <a href="https://github.com/PacktPublishing/Elevate-SwiftUI-Skills-by-Building-Projects">https://github.com/PacktPublishing/Elevate-SwiftUI-Skills-by-Building-Projects</a></p>
<h1 id="_idParaDest-50"><a id="_idTextAnchor275"/>Navigating from ContentView to ResultsView</h1>
<p>In <a id="_idIndexMarker160"/>this section, we will finally implement the navigational system for moving from <code>ContentView</code> to <code>ResultsView</code> and back again.</p>
<p>If you recall back to the previous chapter, when viewing the UI for the <code>ResultsView</code>, we were forced to use the Live Preview Window instead of running the application. The reason was that there was no functionality for navigating from <code>ContentView</code> to <code>ResultsView</code>. We have already added the button for calculating the tax, but we need to implement the code for the button triggering the navigation.</p>
<p>First, we need to wrap our <code>VStack</code> in <code>ContentView</code> in a <code>NavigationView</code>. The <code>NavigationView</code> allows us to present a stack of views which is very useful for navigation, as it effectively has a history of all previous views, allowing an easy and extendable navigation system:</p>
<pre class="source-code">
import SwiftUIstruct ContentView: View
{
    @State private var salary: String = ""
    var body: some View
    {
        NavigationView
        {
            VStack
            {
                Text( "Annual Salary" )
                    .padding(.bottom, 75.0)
                TextField( "", text: $salary )
                    .frame( width: 200.0 )
                    .border( Color.black, width: 1 )
                    .padding( .bottom, 75.0 )
                    .keyboardType( .decimalPad )
                Button
                { }
                label:
                { Text( "Calculate Tax" ) }
                    .buttonStyle( .borderedProminent )
            }
            .padding( )
        }
    }
    func GoToResultsView( )
    {
        ResultsView( )
    }
}
struct ContentView_Previews: PreviewProvider
{
    static var previews: some View
    {
        ContentView( )
    }
}</pre>
<p>We <a id="_idIndexMarker161"/>have now implemented <code>NavigationView</code>, which allows us to use our existing code and design for navigation. There is one extra piece of code we require – a <code>GoToResultsView</code> function. An empty version has been added to the preceding code. We will use it later in this chapter.</p>
<p>As of now, this won’t have any effect on our application, as we need to modify the button to become a <code>NavigationLink</code>, which is basically a fancy button allowing us to navigate between views. Fortunately for us, it can be styled in any way we desire, but first let’s implement a basic <code>NavigationLink</code>. To do this, replace the button code in <code>ContentView</code> with the following code:</p>
<pre class="source-code">
NavigationLink( destination: ResultsView( ), label:{
    Text( "Calculate Tax" )
} )</pre>
<p>Let’s <a id="_idIndexMarker162"/>break down the code we just added. The first parameter it takes is the destination for the application’s view system, so the new view that will be pushed onto the stack. We have specified <code>ResultsView</code> but you could easily specify a simple component, which would create its own view. The next parameter is called <code>label</code>; this is similar to the label specified in the button itself. Currently, we have a <code>Text</code> component, which looks like this:</p>
<div><div><img alt="Figure 3.1 – Basic NavigationLink button" src="img/Figure_3.01_B18783.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.1 – Basic NavigationLink button</p>
<p>Let’s style the <code>NavigationLink</code> button and modify the code to look as follows:</p>
<pre class="source-code">
NavigationLink( destination: ResultsView( ), label:{
    Text( "Calculate Tax" )
        .bold( )
        .frame( width: 200, height: 50 )
        .background( Color.blue )
        .foregroundColor( Color.white )
        .cornerRadius( 10 )
} )</pre>
<p>We <a id="_idIndexMarker163"/>have added five main style aspects to the button. Let’s take a look at each one:</p>
<ul>
<li><code>.bold( )</code>: Makes the text bold</li>
<li><code>.frame( width: 200, height: 50 )</code>: Sets the size of the button</li>
<li><code>.background( Color.blue )</code>: Sets the background color to blue</li>
<li><code>.foregroundColor( Color.white )</code>: Sets the text color to white</li>
<li><code>.cornerRadius( 10 )</code>: Makes the button’s corners rounded, giving a more natural, iOS-like feel</li>
</ul>
<p>After these styles have been applied to the application and, more specifically, the button, it will look like the following figure:</p>
<div><div><img alt="Figure 3.2 – NavigationLink button styled" src="img/Figure_3.02_B18783.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.2 – NavigationLink button styled</p>
<p>We <a id="_idIndexMarker164"/>will now add a navigation title. This provides a nice consistent method for adding a title/header to the view. This is simple – add the following code to the bottom of the <code>VStack</code>, just after the padding:</p>
<pre class="source-code">
.padding( ).navigationTitle( "Main Page" )</pre>
<p>Running the application will show the following:</p>
<div><div><img alt="Figure 3.3 – Navigation title" src="img/Figure_3.03_B18783.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.3 – Navigation title</p>
<p>Navigating to <code>ResultsView</code> by clicking the <strong class="bold">Calculate Tax</strong> button will show that the back button’s text in the top left is now the same as the navigation title that was added. This can be seen in the following screenshot:</p>
<div><div><img alt="Figure 3.4 – Updated back button text" src="img/Figure_3.04_B18783.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.4 – Updated back button text</p>
<p>Let’s <a id="_idIndexMarker165"/>now update <code>ResultsView</code> to use a navigation title instead of a <code>Text</code> component for the heading of the page. First, we need to remove the <code>Text</code> component with the following code from <code>ResultsView</code>:</p>
<pre class="source-code">
Text( "Summary" )    .font( .system( size: 36 ) )
    .fontWeight( .bold )</pre>
<p>Now that <code>ResultsView</code> has no title, let’s add the navigation link. Like before, add the following code after the <code>VStack</code>, right after the padding:</p>
<pre class="source-code">
.padding( ).navigationBarTitle( "Summary" )</pre>
<p>This little addition will change <code>ResultsView</code> as follows:</p>
<div><div><img alt="Figure 3.5 – ResultsView navigation title" src="img/Figure_3.05_B18783.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.5 – ResultsView navigation title</p>
<p>So, we<a id="_idIndexMarker166"/> have added a fair bit of code. This is what the <code>ContentView</code> and <code>ResultsView</code> code should look like before we move on<a id="_idTextAnchor276"/>:</p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US">ContentView</p>
<pre class="source-code">
import SwiftUIstruct ContentView: View
{
    @State private var salary: String = ""
    var body: some View
    {
        NavigationView
        {
            VStack
            {
                Text( "Annual Salary" )
                    .padding(.bottom, 75.0)
                TextField( "", text: $salary )
                    .frame( width: 200.0 )
                    .border( Color.black, width: 1 )
                    .padding( .bottom, 75.0 )
                    .keyboardType( .decimalPad )
                NavigationLink( destination: ResultsView( ), label:
                {
                    Text( "Calculate Tax" )
                        .bold( )
                        .frame( width: 200, height: 50 )
                        .background( Color.blue )
                        .foregroundColor( Color.white )
                        .cornerRadius( 10 )
                } )
            }
            .padding( )
            .navigationTitle( "Main Page" )
        }
    }
}
struct ContentView_Previews: PreviewProvider
{
    static var previews: some View
    {
        ContentView( )
    }
<a id="_idTextAnchor277"/>}</pre>
<p class="SC---Heading" lang="en-US" xml:lang="en-US">ResultsView</p>
<pre class="source-code">
import SwiftUIimport SwiftUICharts
struct ResultsView: View
{
    var taxBreakdown: [Double] = [5, 10, 15]
    var body: some View
    {
        VStack
        {
            PieChart( )
                .data( taxBreakdown )
                .chartStyle( ChartStyle( backgroundColor: .white,
                                         foregroundColor: ColorGradient( .blue, .purple ) ) )
            Text( "Before Tax" )
                .font( .system( size: 32 ) )
                .padding(.vertical)
            Text( "£100,000.00" )
                .font( .system( size: 32 ) )
                .padding(.vertical)
            Text( "After Tax" )
                .font( .system( size: 32 ) )
                .padding(.vertical)
            Text( "£65,000.00" )
                .font( .system( size: 32 ) )
                .padding(.vertical)
            Group
            {
                Text( "Post Tax Salary" )
                ProgressView( "", value: 20, total: 100 )
                Text( "Tax" )
                ProgressView( "", value: 20, total: 100 )
                Text( "National Insurance" )
                ProgressView( "", value: 20, total: 100 )
            }
        }
        .padding( )
        .navigationBarTitle( "Summary" )
    }
}
struct ResultsView_Previews: PreviewProvider
{
    static var previews: some View
    {
        ResultsView( )
    }
<a id="_idTextAnchor278"/>}<a id="_idTextAnchor279"/></pre>
<p>Wow, we <a id="_idIndexMarker167"/>have done a lot. Take the time to pat yourself on the back. All this allowed us to implement a seamless yet familiar navigation system. We learned how to implement a navigation system to navigate to <code>ResultsView</code> and back to <code>ContentView</code> easil<a id="_idTextAnchor280"/>y.</p>
<p>In the next section, we will validate the salary to make sure we do not pass through any data that is incorrect.</p>
<h1 id="_idParaDest-51"><a id="_idTextAnchor281"/>Validating salary input</h1>
<p>As of now, if you<a id="_idIndexMarker168"/> press the <strong class="bold">Calculate Tax</strong> button, it takes the user to the results page from the front page. However, it does this regardless of input, so it will go to the next page even if there is no salary. The following validation checks must be done for it to be an acceptable value:</p>
<ul>
<li>Does it contain a value that is a number?</li>
<li>Is the value above 0 (this rules out negatives)?</li>
</ul>
<p>You might be wondering why we can’t just check whether the salary is above 0 as we have chosen a decimal keypad. There are two main reasons for this:</p>
<ul>
<li>The user can insert <a id="_idIndexMarker169"/>decimal points in a way that makes the input <code>4.5.6..</code>.</li>
<li>Even though the user cannot directly type text due to the keyboard being a decimal pad, they can still copy it from another application and paste it into our calculator, thus breaking the number-only <code>TextField</code>. You may think it’s worth just disabling pasting but it’s important to retain this functionality, as the user may legitimately want to paste a number instead of typing it out, especially if it isn’t a simple small number.</li>
</ul>
<p>If not correctly handled, the application will crash upon the user pressing the <strong class="bold">Calculate Tax</strong> button. The way we will achieve these conditions is explained in the following secti<a id="_idTextAnchor282"/>ons.</p>
<h2 id="_idParaDest-52"><a id="_idTextAnchor283"/>Using a variable to track if the salary is valid</h2>
<p>We will <a id="_idIndexMarker170"/>add a Boolean variable after the salary string to track whether the salary is valid; if it is, then <code>ResultsView</code> will be displayed. The salary string is only checked when the <strong class="bold">Calculate Tax</strong> button is pressed. Add the following code before the body:</p>
<pre class="source-code">
@State private var isSalaryValid: Bool = <a id="_idTextAnchor284"/>false</pre> <h2 id="_idParaDest-53"><a id="_idTextAnchor285"/>isActive NavigationLink</h2>
<p>Now we will <a id="_idIndexMarker171"/>link the <code>isSalaryValid</code> variable created previously with <code>NavigationLink</code> using the <code>isActive</code> parameter. Update the <code>NavigationLink</code> code to look like the following:</p>
<pre class="source-code">
NavigationLink( destination: ResultsView( ), isActive: $isSalaryValid, label:</pre> <p><code>isActive</code> is a simple concept – if <code>true</code>, it immediately takes you to the destination view, and if it is <code>false</code>, then nothing happens.</p>
<p>In the following section, we will validate the s<a id="_idTextAnchor286"/>alary.</p>
<h2 id="_idParaDest-54"><a id="_idTextAnchor287"/>Validating the salary</h2>
<p>Firstly, we <a id="_idIndexMarker172"/>will override the tap gesture and call a custom function called <code>GoToResultsView</code>. Add the following code to the end of all text <a id="_idIndexMarker173"/>properties:</p>
<pre class="source-code">
.onTapGesture{
    GoToResultsView( )
}</pre>
<p>Finally, we must check whether the string is valid, then navigate to the results view. Add the following function to handle this:</p>
<pre class="source-code">
func GoToResultsView( ){
    if ( Float( salary ) != nil )
    {
        if ( Float( salary )! &gt; 0 )
        { isSalaryValid = true }
    }
}</pre>
<p>Let’s unpack this function to see what it does:</p>
<ul>
<li><code>if ( Float( salary ) != nil )</code>: Checks whether the salary is a number. This is accomplished by casting the string to a <code>Float</code>. If unsuccessful, it is <code>nil</code> – this allows us to check for this. This also includes validating an empty string.</li>
<li><code>if ( Float( salary )! &gt; 0 )</code>: Checks whether the salary is greater than zero. The exclamation mark says that the variable salary is definitely a <code>Float</code> to avoid any problems, as it’s already been checked we can do this.</li>
<li><code>isSalaryValid = true</code>: Sets the <code>isSalaryValid</code> check variable to <code>true</code>, which triggers <code>ResultsView</code> and loads it up.</li>
</ul>
<p>All of these <a id="_idIndexMarker174"/>additions should result in the following<a id="_idIndexMarker175"/> code in the following <code>ContentView</code> file:</p>
<pre class="source-code">
import SwiftUIstruct ContentView: View
{
    @State private var salary: String = ""
    @State private var isSalaryValid: Bool = false
    var body: some View
    {
        NavigationView
        {
            VStack
            {
                Text( "Annual Salary" )
                    .padding(.bottom, 75.0)
                TextField( "", text: $salary )
                    .frame( width: 200.0 )
                    .border( Color.black, width: 1 )
                    .padding( .bottom, 75.0 )
                    .keyboardType( .decimalPad )
                NavigationLink( destination: ResultsView( ), isActive: $isSalaryValid, label:
                {
                    Text( "Calculate Tax" )
                        .bold( )
                        .frame( width: 200, height: 50 )
                        .background( Color.blue )
                        .foregroundColor( Color.white )
                        .cornerRadius( 10 )
                        .onTapGesture
                        {
                            GoToResultsView( )
                        }
                } )
            }
            .padding( )
            .navigationTitle( "Main Page" )
        }
    }
    func GoToResultsView( )
    {
        if ( Float( salary ) != nil )
        {
            if ( Float( salary )! &gt; 0 )
            { isSalaryValid = true }
        }
    }
}
struct ContentView_Previews: PreviewProvider
{
    static var previews: some View
    {
        ContentView( )
    }
}</pre>
<p>With the <a id="_idIndexMarker176"/>preceding code, we validated the<a id="_idIndexMarker177"/> salary, and a variable was used to track the status of the validation, which allowed us to navigate to <code>ResultsView</code> when it was validated.</p>
<p>In the next section, we will pass the salary between <code>ContentView</code> and <a id="_idTextAnchor288"/><code>ResultsView</code>.</p>
<h2 id="_idParaDest-55"><a id="_idTextAnchor289"/>Passing the salary through to ResultsView</h2>
<p>As of <a id="_idIndexMarker178"/>now, when we click <code>ResultsView</code> is still using dummy data. Let’s change that by passing in the salary we validated in the previous section. Doing this is simple when using State and Bind. The salary variable in <code>ContentView</code> is already a state variable, simply meaning when it changes, the part of the view linked to it also changes and vice versa. When we change the text in the <code>TextField</code> salary, our application updates the state variable. We can use a binding variable in <code>ResultsView</code>, which allows us to pass in data between views.</p>
<p>First, in <code>ResultsView</code>, add the following line above the <code>taxBreakdown</code> array:</p>
<pre class="source-code">
@Binding var salary: String</pre> <p>This simply declares a <code>salary</code> variable of type <code>String</code>, which is the same format as the <code>salary</code> variable in <code>ContentView</code>. <code>@Binding</code> just states that it is expecting this value to be passed in.</p>
<p>Now we must update <code>NavigationLink</code> to pass in the <code>salary</code> variable from <code>ContentView</code> to <code>ResultsView</code> like so:</p>
<pre class="source-code">
NavigationLink( destination: ResultsView( salary: $salary ), isActive: $isSalaryValid, label:</pre> <p>Though we have completed all the binding, if we try and run the application, the following error will be thrown:</p>
<div><div><img alt="Figure 3.6 – Preview error" src="img/Figure_3.06_B18783.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.6 – Preview error</p>
<p>This error relates to the preview view, which appears usually to the right of the code. Without this, the preview cannot run. To fix this error, we can give a default hardcoded value just for the preview. Update the code as follows:</p>
<pre class="source-code">
struct ResultsView_Previews: PreviewProvider{
    static var previews: some View
    {
        ResultsView( salary: .constant( "100" ) )
    }
}</pre>
<p>Now once <a id="_idIndexMarker179"/>we run the application, we get no errors because we solved the missing argument error, and can move on to calculating the tax breakdown from the salary we passed <a id="_idTextAnchor290"/>through.</p>
<p class="callout-heading">Note</p>
<p class="callout">If you would like to test to make sure the variable has been passed through, you can use a breakpoint or <code>print</code> statement. I will let you do that as a<a id="_idTextAnchor291"/>n extra task.</p>
<h1 id="_idParaDest-56"><a id="_idTextAnchor292"/>Calculating tax breakdown</h1>
<p>In the<a id="_idIndexMarker180"/> previous chapter, we passed through the <code>salary</code> variable, but we still need to calculate the tax. I will be doing it in line with the UK income tax rates of 2023/2024, but this can be adapted easily for any other tax system. In the following table, we have the tax rates for 2023/2024:</p>
<table class="No-Table-Style _idGenTablePara-1" id="table001">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">Income</strong></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Tax rate</strong></p>
</td>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Up to £12,570</p>
</td>
<td class="No-Table-Style">
<p>0%</p>
</td>
<td class="No-Table-Style">
<p>Personal allowance</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>£12,571 to £37,700</p>
</td>
<td class="No-Table-Style">
<p>20%</p>
</td>
<td class="No-Table-Style">
<p>Basic rate</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>£37,701 to £150,000</p>
</td>
<td class="No-Table-Style">
<p>40%</p>
</td>
<td class="No-Table-Style">
<p>Higher rate</p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>over £150,000</p>
</td>
<td class="No-Table-Style">
<p>45%</p>
</td>
<td class="No-Table-Style">
<p>Additional rate</p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 3.1 – Tax brackets</p>
<p>As there are brackets and not a single fixed tax, we will need to do a few calculations to figure out the exact tax to be deducted. On top of the income tax, there is also national insurance tax. National insurance tax isn’t so simple as there are different categories, but let’s <a id="_idIndexMarker181"/>keep it at a simple 13%, which it roughly is.</p>
<p class="callout-heading">Note</p>
<p class="callout">There are definitely more aspects to calculating tax, such as pension contributions, student loans, and so on; however, we will leave it at this.<a id="_idTextAnchor293"/></p>
<h2 id="_idParaDest-57"><a id="_idTextAnchor294"/>Tax calculation</h2>
<p>Let’s implement a<a id="_idIndexMarker182"/> formula in <code>ResultsView</code> to calculate the income tax. Add the following code at the start of the body:</p>
<pre class="source-code">
var body: some View {let salaryNum = Double( salary )!
var incomeTax: Double = 0
if ( salaryNum &gt; 12570 )
{
    if ( salaryNum &gt; 37700 )
    {
        if ( salaryNum &gt; 150000 )
        {
            incomeTax += ( 37700 - 12571 ) * 0.2
            incomeTax += ( 150000 - 37701 ) * 0.4
            incomeTax += ( salaryNum - 150000 ) * 0.45
        }
        else
        {
            incomeTax += ( 37700 - 12571 ) * 0.2
            incomeTax += ( salaryNum - 37700 ) * 0.4
        }
    }
    else
    { incomeTax += ( salaryNum - 12570 ) * 0.2 }
}
return VStack {
….
}
}</pre>
<p>We check each tax <a id="_idIndexMarker183"/>bracket and calculate the tax accordingly. Next, we will calculate the national insurance. First, add another double variable below <code>incomeTax</code>:</p>
<pre class="source-code">
let salaryNum = Double( salary )!var incomeTax: Double = 0
var nationalInsuranceTax: Double = 0</pre>
<p>Now we can simply calculate it by multiplying the salary by <code>0.13</code> to get <code>13%</code>. Add the following code below the income tax calculation:</p>
<pre class="source-code">
nationalInsuranceTax = salaryNum * 0.13</pre> <p>Now that we<a id="_idIndexMarker184"/> have all of the taxes calculated, we can move on to working out the post-tax salary. This is simple – we just subtract the income tax and national insurance tax from the salary. Add the following code beneath the previous code:</p>
<pre class="source-code">
let postTaxSalary = salaryNum - incomeTax - nationalInsuranceTax</pre> <p>Let’s format these values into strings, which will be used when displaying the tax figures. Add the following code below <code>post-tax </code><code>salary</code> calculation:</p>
<pre class="source-code">
let salaryString = String( format:"£%.2F", salaryNum )let postTaxSalaryString = String( format: "£%.2F", postTaxSalary )
let incomeTaxString = String( format: "£%.2F", incomeTax )
let nationalInsuranceTaxSting = String( format: "£%.2F",
nationalInsuranceTax )</pre>
<p>This creates a string from the respective numbers rounded to two decimal places. Next, move the <code>taxBreakdown</code> hardcoded pie chart array beneath the formatted strings, and update it as follows:</p>
<pre class="source-code">
let taxBreakdown: [Double] = [postTaxSalary, incomeTax, nationalInsuranceTax]</pre> <p>We are using let instead of var as it won’t need to be changed.</p>
<p>Now we are finally ready to start updating each component in the UI. First, we will update the <code>Text</code> components, which display the <code>Before Tax</code> and <code>After Tax</code> figures like so:</p>
<pre class="source-code">
Text( "Before Tax" )    .font( .system( size: 32 ) )
    .padding(.vertical)
Text( salaryString )
    .font( .system( size: 32 ) )
    .padding(.vertical)
Text( "After Tax" )
    .font( .system( size: 32 ) )
    .padding(.vertical)
Text( postTaxSalaryString )
    .font( .system( size: 32 ) )
    .padding(.vertical)</pre>
<p>Finally, update <code>ProgressView</code> to<a id="_idIndexMarker185"/> display the correct percentage and value for the tax and salary:</p>
<pre class="source-code">
Text( "Post Tax Salary" )ProgressView( postTaxSalaryString, value: postTaxSalary / salaryNum * 100, total: 100 )
Text( "Tax" )
ProgressView( incomeTaxString, value: incomeTax / salaryNum * 100, total: 100 )
Text( "National Insurance" )
ProgressView( nationalInsuranceTaxSting, value: 13, total: 100 )</pre>
<p>The reason for dividing the <code>postTaxSalary</code> and <code>incomeTax</code> variables by <code>salaryNum</code> and multiplying it by <code>100</code> is to work out the percentage for <code>ProgressView</code>. Before running, update the <code>VStack</code> to be returned. There seems to be an issue with the code, causing conflicts for the compiler. To resolve this, we need to explicitly state what to draw by returning it:</p>
<pre class="source-code">
return VStack</pre> <p>If we run our<a id="_idIndexMarker186"/> application and insert the salary of £100,000, <code>ResultsView</code> will appear as follows:</p>
<div><div><img alt="Figure 3.7 – ResultsView updated" src="img/Figure_3.07_B18783.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.7 – ResultsView updated</p>
<p>That definitely was tiring, all that code. For reference, here is what the <code>ContentView</code> and <code>ResultsView</code> code should look like before moving<a id="_idTextAnchor295"/> on:</p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US">ContentView:</p>
<pre class="source-code">
import SwiftUIstruct ContentView: View
{
    @State private var salary: String = ""
    @State private var isSalaryValid: Bool = false
    var body: some View
    {
        NavigationView
        {
            VStack
            {
                Text( "Annual Salary" )
                    .padding(.bottom, 75.0)
                TextField( "", text: $salary )
                    .frame( width: 200.0 )
                    .border( Color.black, width: 1 )
                    .padding( .bottom, 75.0 )
                    .keyboardType( .decimalPad )
                NavigationLink( destination: ResultsView( salary: $salary ), isActive: $isSalaryValid, label:
                {
                    Text( "Calculate Tax" )
                        .bold( )
                        .frame( width: 200, height: 50 )
                        .background( Color.blue )
                        .foregroundColor( Color.white )
                        .cornerRadius( 10 )
                        .onTapGesture
                        {
                            GoToResultsView( )
                        }
                } )
            }
            .padding( )
            .navigationTitle( "Main Page" )
        }
    }
    func GoToResultsView( )
    {
        if ( nil != Float( salary ) )
        {
            if ( Float( salary )! &gt; 0 )
            { isSalaryValid = true }
        }
    }
}
struct ContentView_Previews: PreviewProvider
{
    static var previews: some View
    {
        ContentView( )
    }
}</pre>
<p class="SC---Heading" lang="en-US" xml:lang="en-US">ResultsView:</p>
<pre class="source-code">
import SwiftUIimport SwiftUICharts
struct ResultsView: View
{
    @Binding var salary: String
    var body: some View
    {
        let salaryNum = Double( salary )!
        var incomeTax: Double = 0
        var nationalInsuranceTax: Double = 0
        if ( salaryNum &gt; 12570 )
        {
            if ( salaryNum &gt; 37700 )
            {
                if ( salaryNum &gt; 150000 )
                {
                    incomeTax += ( 37700 - 12571 ) * 0.2
                    incomeTax += ( 150000 - 37701 ) * 0.4
                    incomeTax += ( salaryNum - 150000 ) * 0.45
                }
                else
                {
                    incomeTax += ( 37700 - 12571 ) * 0.2
                    incomeTax += ( salaryNum - 37700 ) * 0.4
                }
            }
            else
            { incomeTax += ( salaryNum - 12570 ) * 0.2 }
        }
        nationalInsuranceTax = salaryNum * 0.13
        let postTaxSalary = salaryNum - incomeTax - nationalInsuranceTax
        let salaryString = String( format:"£%.2F", salaryNum )
        let postTaxSalaryString = String( format: "£%.2F", postTaxSalary )
        let incomeTaxString = String( format: "£%.2F", incomeTax )
        let nationalInsuranceTaxSting = String( format: "£%.2F", nationalInsuranceTax )
        let taxBreakdown: [Double] = [postTaxSalary, incomeTax, nationalInsuranceTax]
        return VStack
        {
            PieChart( )
                .data( taxBreakdown )
                .chartStyle( ChartStyle( backgroundColor: .white,
                                         foregroundColor: ColorGradient( .blue, .purple ) ) )
            Text( "Before Tax" )
                .font( .system( size: 32 ) )
                .padding(.vertical)
            Text( salaryString )
                .font( .system( size: 32 ) )
                .padding(.vertical)
            Text( "After Tax" )
                .font( .system( size: 32 ) )
                .padding(.vertical)
            Text( postTaxSalaryString )
                .font( .system( size: 32 ) )
                .padding(.vertical)
            Group
            {
                Text( "Post Tax Salary" )
                ProgressView( postTaxSalaryString, value: postTaxSalary / salaryNum * 100, total: 100 )
                Text( "Tax" )
                ProgressView( incomeTaxString, value: incomeTax / salaryNum * 100, total: 100 )
                Text( "National Insurance" )
                ProgressView( nationalInsuranceTaxSting, value: 13, total: 100 )
            }
        }
        .padding( )
        .navigationBarTitle( "Summary" )
    }
}
struct ResultsView_Previews: PreviewProvider
{
    static var previews: some View
    {
        ResultsView( salary: .constant( "100" ) )
    }
}</pre>
<p>In the next<a id="_idIndexMarker187"/> section, we will fix an error that occurs in <code>ContentView</code>; see whether you can figure out what the erro<a id="_idTextAnchor296"/>r is.</p>
<h2 id="_idParaDest-58"><a id="_idTextAnchor297"/>Fixing the ContentView binding error</h2>
<p>There is an<a id="_idIndexMarker188"/> error in <code>ContentView</code>. It can be triggered by following these steps:</p>
<ol>
<li>Navigate to <code>ResultsView</code> by clicking the <strong class="bold">Calculate </strong><strong class="bold">Tax</strong> button.</li>
<li>Go back to <code>ContentView</code> by pressing the back arrow on the top left.</li>
<li>Input invalid data, which can be any of the following:<ol><li>Delete all the text in <code>TextField</code></li><li>Space character</li><li>Any non-numerical character</li><li>Two or more decimal points</li></ol></li>
</ol>
<p>Once these steps are complete, the following error will appear:</p>
<div><div><img alt="Figure 3.8 – Invalid input error" src="img/Figure_3.08_B18783.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.8 – Invalid input error</p>
<p>This occurs because the variable is bound to <code>ResultsView</code>, which uses the value numerically. As the input is no longer numerical, it crashes. The problem is that <code>Double( salary )</code> returns <code>nil</code> and forces it to be assigned using <code>!</code>, which makes it crash. We will default assign a value of <code>0</code> to the <code>salaryNum</code> variable and if it’s not <code>nil</code>, then cast the salary string as <code>Double</code>. Update the code as follows:</p>
<pre class="source-code">
var salaryNum: Double = 0if ( nil != Double( salary ) )
{
    salaryNum = Double( salary )!
}</pre>
<p>Alternatively, you can use the coalescing operator to reduce the preceding check as follows: <code>let salaryNum = Double( salary ) ?? 0</code>. For more information on the coalescing operator, visit <a href="https://docs.swift.org/swift-book/documentation/the-swift-programming-language/basicoperators/#Nil-Coalescing-Operator">https://docs.swift.org/swift-book/documentation/the-swift-programming-language/basicoperators/#Nil-Coalescing-Operator</a>.</p>
<p>First, we<a id="_idIndexMarker189"/> change the variable to <code>var</code> instead of <code>let</code> as it needs to be modifiable just for checking whether the cast equates to <code>nil</code>. Then, we check that it’s not <code>nil</code> and assign the value accordingly. <em class="italic">Assigning 0 won’t have any effect as the view isn’t visible at this time</em>. Now if you run the application, it won’t crash if you followed the preceding steps.</p>
<p>In the next section, we will rename <code>Conten<a id="_idTextAnchor298"/>tView</code>.</p>
<h2 id="_idParaDest-59"><a id="_idTextAnchor299"/>Renaming ContentView to FrontView</h2>
<p>In this small section, we will <a id="_idIndexMarker190"/>change <code>ContentView</code>’s name to <code>FrontView</code>. The default name of <code>ContentView</code> doesn’t provide much information to us. We will rename it <code>FrontView</code>. You could rename the file and manually change every occurrence of <code>ContentView</code> to <code>FrontView</code>, which wouldn’t be too tedious in an application this size. However, in a larger and more complex application, it would take away a lot of valuable development time. We can use Xcode’s renaming tool to aid us.</p>
<p>Simply go to any reference to <code>ContentView</code> in the application’s code, right-click it, and go to <strong class="bold">Refactor</strong> | <strong class="bold">Rename…</strong>:</p>
<div><div><img alt="Figure 3.9 – Rename… button" src="img/Figure_3.09_B18783.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.9 – Rename… button</p>
<p>In the next<a id="_idIndexMarker191"/> view, set the name to <code>FrontView</code> and press <em class="italic">Enter</em>:</p>
<div><div><img alt="Figure 3.10 – Xcode renaming tool" src="img/Figure_3.10_B18783.jpg"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.10 – Xcode renaming tool</p>
<p>Renaming files <a id="_idIndexMarker192"/>and updating all references is as easy as that. This also works for variables and functions; feel free to use it whenever you need to.</p>
<p>We have now completed the calculator application; in the next section, you will see some of the extra tasks for you to co<a id="_idTextAnchor300"/>mplete.</p>
<h1 id="_idParaDest-60"><a id="_idTextAnchor301"/>Extra tasks</h1>
<p>Now that the application is complete, here is a list of tasks for you to complete to enhance your application and also to test your knowledge of the concepts learned in this chapter:</p>
<ul>
<li>Show an error when submitting an invalid salary</li>
<li>Formatting salary and tax components with commas</li>
<li>Abstracting tax brackets and percentages to make the app more dynamic</li>
<li>Pie chart labeling</li>
<li>Different types of tax</li>
<li>Corporation tax</li>
<li>Inheritance tax</li>
<li>Provide more inputs for the current salary calculator such as pension contributions and student loans</li>
<li>Back button styling</li>
</ul>
<p class="callout-heading">Note</p>
<p class="callout">If at any point you require help, feel free to join my Discord group at <a href="https://discord.gg/7e78FxrgqH">https://discord.gg/7e78FxrgqH</a>.</p>
<p>We will summarize what we have covered in this chapter. However, before that, I will provide additional code for the extra tasks for you to implement at your own l<a id="_idTextAnchor302"/>eisure.</p>
<h2 id="_idParaDest-61"><a id="_idTextAnchor303"/>Different tax options</h2>
<p>To add <a id="_idIndexMarker193"/>different tax options to your code, you can modify <code>ResultsView</code> to include a picker or segmented control for selecting different tax options. Here’s an example of how you can modify your code to add a picker for tax options:</p>
<pre class="source-code">
import SwiftUIstruct FrontView: View {
    @State private var salary: String = ""
    @State private var isSalaryValid: Bool = false
    @State private var selectedTaxOption: TaxOption = .option1 // Default tax option
    enum TaxOption: String, CaseIterable {
        case option1 = "Income Tax"
        case option2 = "Dividen Tax"
        case option3 = "Corporation Tax"
        // You can add more tax options if needed
    }
    var body: some View {
        NavigationView {
            VStack {
                Text("Annual Salary")
                    .padding(.bottom, 75.0)
                TextField("", text: $salary)
                    .frame(width: 200.0)
                    .border(Color.black, width: 1)
                    .padding(.bottom, 75.0)
                    .keyboardType(.decimalPad)
                Picker("Tax Option", selection: $selectedTaxOption) {
                    ForEach(TaxOption.allCases, id: \.self) { option in
                        Text(option.rawValue)
                    }
                }
                .pickerStyle(SegmentedPickerStyle())
                .padding(.bottom, 75.0)
                NavigationLink(destination: ResultsView(salary: $salary, taxOption: selectedTaxOption), isActive: $isSalaryValid) {
                    Text("Calculate Tax")
                        .bold()
                        .frame(width: 200, height: 50)
                        .background(Color.blue)
                        .foregroundColor(Color.white)
                        .cornerRadius(10)
                        .onTapGesture {
                            goToResultsView()
                        }
                }
            }
            .padding()
            .navigationTitle("Main Page")
        }
    }
    func goToResultsView() {
        if let salaryFloat = Float(salary), salaryFloat &gt; 0 {
            isSalaryValid = true
        }
    }
}
struct ResultsView: View {
    var salary: String
    var taxOption: FrontView.TaxOption
    var body: some View {
        VStack {
            Text("Results")
                .font(.title)
                .padding()
            Text("Salary: \(salary)")
                .padding()
            Text("Tax Option: \(taxOption.rawValue)")
                .padding()
            // Calculate and display tax results based on the selected tax option
            Spacer()
        }
        .navigationTitle("Results")
    }
}
struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        FrontView()
    }
}
```</pre>
<p>In this <a id="_idIndexMarker194"/>example, I’ve added the <code>TaxOption</code> enum to define different tax options. The <code>selectedTaxOption</code> property is used to store the selected tax option. I’ve added a picker (using a segmented control style) to allow the user to select the tax option.</p>
<p>When the user taps <code>ResultsView</code>, where you can calculate and display the tax results based on the selecte<a id="_idTextAnchor304"/>d option.</p>
<h2 id="_idParaDest-62"><a id="_idTextAnchor305"/>Tax geography</h2>
<p>To add the<a id="_idIndexMarker195"/> ability to calculate tax breakdowns for different geographies, including countries and states, you can modify <code>ResultsView</code> and introduce a selection mechanism for geographies. Here’s an example of how you can modify your code to achieve that:</p>
<pre class="source-code">
import SwiftUIstruct FrontView: View {
    @State private var salary: String = ""
    @State private var isSalaryValid: Bool = false
    @State private var selectedGeography: Geography = .country("USA") // Default geography
    enum Geography {
        case country(String)
        case state(String, String) // Country, State
        var displayText: String {
            switch self {
            case .country(let country):
                return country
            case .state(let country, let state):
                return "\(state), \(country)"
            }
        }
    }
    var body: some View {
        NavigationView {
            VStack {
                Text("Annual Salary")
                    .padding(.bottom, 75.0)
                TextField("", text: $salary)
                    .frame(width: 200.0)
                    .border(Color.black, width: 1)
                    .padding(.bottom, 75.0)
                    .keyboardType(.decimalPad)
                Picker("Geography", selection: $selectedGeography) {
                    Text("USA").tag(Geography.country("USA"))
                    Text("California, USA").tag(Geography.state("USA", "California"))
                    // Add more geography options as needed
                }
                .pickerStyle(SegmentedPickerStyle())
                .padding(.bottom, 75.0)
                NavigationLink(destination: ResultsView(salary: $salary, geography: selectedGeography), isActive: $isSalaryValid) {
                    Text("Calculate Tax")
                        .bold()
                        .frame(width: 200, height: 50)
                        .background(Color.blue)
                        .foregroundColor(Color.white)
                        .cornerRadius(10)
                        .onTapGesture {
                            goToResultsView()
                        }
                }
            }
            .padding()
            .navigationTitle("Main Page")
        }
    }
    func goToResultsView() {
        if let salaryFloat = Float(salary), salaryFloat &gt; 0 {
            isSalaryValid = true
        }
    }
}
struct ResultsView: View {
    var salary: String
    var geography: FrontView.Geography
    var body: some View {
        VStack {
            Text("Results")
                .font(.title)
                .padding()
            Text("Salary: \(salary)")
                .padding()
            Text("Geography: \(geography.displayText)")
                .padding()
            // Calculate and display tax breakdown based on the selected geography
            Spacer()
        }
        .navigationTitle("Results")
    }
}
struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        FrontView()
    }
}</pre>
<p>In this example, I’ve <a id="_idIndexMarker196"/>introduced the <code>Geography</code> enum, which represents different geographies. It can be either a country or a state within a country. The <code>selectedGeography</code> property is used to store the selected geography.</p>
<p>In <code>FrontView</code>, I’ve added a picker (using a segmented control style) to allow the user to select the geography. You can add more geography options as needed.</p>
<p>When the user taps <code>ResultsView</code>, where you can calculate and display the tax breakdown based on the selected geography.</p>
<p>In <code>ResultsView</code>, I’ve added a <code>displayText</code> computed property to format and display the selected geography. You can modify the code to calculate and display the tax breakdown based on the selected geography.</p>
<p class="callout-heading">Note</p>
<p class="callout">This code provides a basic structure for adding tax breakdowns based on geographies. The actual tax calculations and breakdowns would need to be implemented based on the tax laws and rules of the specific countries and states involved.</p>
<p>Here’s the updated code for <code>ResultsView</code> with the tax breakdown based on the given logic and the addition of the <code>Geography<a id="_idTextAnchor306"/></code> selection:</p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US">ResultsView</p>
<pre class="source-code">
import SwiftUIimport SwiftUICharts
struct ResultsView: View {
    @Binding var salary: String
    var geography: FrontView.Geography
    var body: some View {
        let salaryNum: Double = Double(salary) ?? 0
        let taxBreakdown = calculateTaxBreakdown(for: salaryNum, in: geography)
        let salaryString = formatCurrency(salaryNum)
        let postTaxSalaryString = formatCurrency(taxBreakdown.postTaxSalary)
        let incomeTaxString = formatCurrency(taxBreakdown.incomeTax)
        let nationalInsuranceTaxString = formatCurrency(taxBreakdown.nationalInsuranceTax)
        return VStack {
            PieChart()
                .data(taxBreakdown.chartData)
                .chartStyle(ChartStyle(backgroundColor: .white, foregroundColor: ColorGradient(.blue, .purple)))
            Text("Before Tax")
                .font(.system(size: 32))
                .padding(.vertical)
            Text(salaryString)
                .font(.system(size: 32))
                .padding(.vertical)
            Text("After Tax")
                .font(.system(size: 32))
                .padding(.vertical)
            Text(postTaxSalaryString)
                .font(.system(size: 32))
                .padding(.vertical)
            Group {
                Text("Post Tax Salary")
                ProgressView(postTaxSalaryString, value: taxBreakdown.postTaxPercentage, total: 100)
                Text("Tax")
                ProgressView(incomeTaxString, value: taxBreakdown.incomeTaxPercentage, total: 100)
                Text("National Insurance")
                ProgressView(nationalInsuranceTaxString, value: taxBreakdown.nationalInsurancePercentage, total: 100)
            }
        }
        .padding()
        .navigationBarTitle("Summary")
    }
    private func calculateTaxBreakdown(for salary: Double, in geography: FrontView.Geography) -&gt; TaxBreakdown {
        var incomeTax: Double = 0
        var nationalInsuranceTax: Double = 0
        if salary &gt; 12570 {
            if salary &gt; 37700 {
                if salary &gt; 150000 {
                    incomeTax += (37700 - 12571) * 0.2
                    incomeTax += (150000 - 37701) * 0.4
                    incomeTax += (salary - 150000) * 0.45
                } else {
                    incomeTax += (37700 - 12571) * 0.2
                    incomeTax += (salary - 37700) * 0.4
                }
            } else {
                incomeTax += (salary - 12570) * 0.2
            }
        }
        nationalInsuranceTax = salary * 0.13
        let postTaxSalary = salary - incomeTax - nationalInsuranceTax
        let chartData: [(String, Double)] = [("Post Tax Salary", postTaxSalary), ("Tax", incomeTax), ("National Insurance", nationalInsuranceTax)]
        let totalSalary = salary + nationalInsuranceTax
        let postTaxPercentage = postTaxSalary / totalSalary * 100
        let incomeTaxPercentage = incomeTax / totalSalary * 100
        let nationalInsurancePercentage = nationalInsuranceTax / totalSalary * 100
        return TaxBreakdown(postTaxSalary: postTaxSalary, incomeTax: incomeTax, nationalInsuranceTax: nationalInsuranceTax, chartData: chartData, postTaxPercentage: postTax
Percentage, incomeTaxPercentage: incomeTaxPercentage, nationalInsurancePercentage: nationalInsurancePercentage)
    }
    private func formatCurrency(_ value: Double) -&gt; String {
        let formatter = NumberFormatter()
        formatter.numberStyle = .currency
        formatter.currencySymbol = "£"
        return formatter.string(from: NSNumber(value: value)) ?? ""
    }
}
struct TaxBreakdown {
    var postTaxSalary: Double
    var incomeTax: Double
    var nationalInsuranceTax: Double
    var chartData: [(String, Double)]
    var postTaxPercentage: Double
    var incomeTaxPercentage: Double
    var nationalInsurancePercentage: Double
}
struct ResultsView_Previews: PreviewProvider {
    static var previews: some View {
        ResultsView(salary: .constant("100"), geography: .country("USA"))
    }
}</pre>
<p>In this updated<a id="_idIndexMarker197"/> code, <code>ResultsView</code> now accepts a <code>geography</code> parameter of type <code>FrontView.Geography</code>. The <code>calculateTaxBreakdown(for:in:)</code> function is added to calculate the tax breakdown based on the salary and selected geography.</p>
<p>The tax breakdown is stored in the <code>TaxBreakdown</code> struct, which includes the post-tax salary, income tax, national insurance tax, chart data, and percentage values for each tax category.</p>
<p>The <code>formatCurrency(_:)</code> function is used to format currency values with the pound sign (£).</p>
<p>The calculated tax breakdown is used to populate the <code>PieChart</code> and <code>ProgressView</code> components to display the tax breakdown and percentages.</p>
<p>Please note that the tax calculation logic in the code provided is based on the initial logic and may not be accurate or applicable to real-world tax calculations. It serves as an example structure for integrating tax breakdown calculations into your S<a id="_idTextAnchor307"/>wiftUI code.</p>
<h1 id="_idParaDest-63"><a id="_idTextAnchor308"/>Summary</h1>
<p>In this chapter, we implemented all the calculator’s functionality. We linked all the UI components that we implemented in the previous chapter. First, we provided a means to navigate to and from <code>ResultsView</code>. Then, we checked the salary input to make sure it was above zero and didn’t contain any invalid characters. Once validated, we passed the salary from <code>ContentView</code> to <code>ResultsView</code>. Using the salary, we calculated the tax breakdown in <code>ResultsView</code>, fixed an annoying error, and renamed <code>ContentView</code> to <code>FrontView</code>. Finally, we also implemented a few extra tasks for our tax calculator app.</p>
<p>In the next chapter, we’ll start our next application, which will be a photo gallery for the iPad. We will leverage many of the skills learned already, so feel free to take a moment and go back over anything you didn’t fully understand.</p>
</div>
</body></html>