<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Our First Game with Moai"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Our First Game with Moai</h1></div></div></div><p>Adventure time! We're going to start working on our first game made with Moai SDK, a simple <span class="emphasis"><em>Concentration</em></span>-like game. For this you'll need some understanding of Lua syntax, nothing too fancy, just the basics. If you've never used Lua before, it'd be a good idea to read some quick introduction material and have a syntax cheat sheet around when reading this book.</p><div class="section" title="Concentration"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec23"/>Concentration</h1></div></div></div><p>For those readers who are <a id="id36" class="indexterm"/>not familiar with this game, let's describe it.</p><p>The game requires a set of tiles. There must be an even number of them. The tiles have figures (in pairs, since we're going to match them) on one side and a flat color or identical image on the other side (the back of the tile).</p><p>The gameplay is as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Place all the tiles facing down and shuffle them. This way you hide the pairs and have no idea where they are.<div class="mediaobject"><img src="graphics/5064_04_01.jpg" alt="Concentration"/></div></li><li class="listitem">Then, you have to choose two tiles <a id="id37" class="indexterm"/>and flip them, to reveal the images.<div class="mediaobject"><img src="graphics/5064_04_02.jpg" alt="Concentration"/></div></li><li class="listitem">If they're different, you have to flip them back again and pick a different pair.<div class="mediaobject"><img src="graphics/5064_04_03.jpg" alt="Concentration"/></div></li><li class="listitem">If they are the same, you <a id="id38" class="indexterm"/>remove them from the board and the game continues with two tiles less.<div class="mediaobject"><img src="graphics/5064_04_04.jpg" alt="Concentration"/></div></li></ol></div><p>The game ends when there are no tiles left.</p><p>We will implement this game, with the addition of a ticking clock, so things get a little bit more challenging.</p><p>In order to do this we'll examine all of Moai SDK's basic features and how to use them.</p></div></div>
<div class="section" title="Project setup"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec24"/>Project setup</h1></div></div></div><p>To set up the project we <a id="id39" class="indexterm"/>need to perform a couple of steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a folder for our project somewhere on your hard drive.</li><li class="listitem">After that open ZeroBrane Studio and navigate to that folder.</li><li class="listitem">You'll now see an empty folder and a blank file named <code class="literal">untitled.lua</code>.</li><li class="listitem">Save that file as <code class="literal">main.lua</code>, which <a id="id40" class="indexterm"/>is the usual name for a game entry point file. You can name it whatever you want, but we'll use this as a standard.</li><li class="listitem">Now we are ready to start.</li></ol></div></div>
<div class="section" title="Opening a window"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec25"/>Opening a window</h1></div></div></div><p>The first thing we'll learn is how <a id="id41" class="indexterm"/>to open the main game window using Moai SDK.</p><p>This is a relatively easy task. The code is as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>MOAISim.openWindow ( "Concentration", 320, 480 )</strong></span>
</pre></div><p>What we are doing here is calling the <a id="id42" class="indexterm"/>
<a id="id43" class="indexterm"/>
<code class="literal">MOAISim.openWindow</code> class method with the necessary parameters, namely, <code class="literal">title</code> for window (a string), <code class="literal">width</code>, and <code class="literal">height</code>. As you may have noticed, we used 320 x 480, which is the display resolution of an iPhone 3GS (without Retina Display).</p><p>If you run the script now, you'll see that a window opens. So that's it, our main window is ready. But before going further, let's take a look at an important aspect of Moai SDK.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a> . If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div><div class="section" title="Resolution independence"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec13"/>Resolution independence</h2></div></div></div><p>The window we just opened has a specific width and height. But, as we know, different devices have different resolutions and we can't just open up a screen with a fixed width and height because it won't behave correctly on say, an iPhone and an iPad.</p><p>So we'll introduce a concept here <a id="id44" class="indexterm"/>
<a id="id45" class="indexterm"/>
<a id="id46" class="indexterm"/>
<span class="strong"><strong>world resolution</strong></span> versus <span class="strong"><strong>screen/window resolution</strong></span>.</p><p>The idea is that your game will use world resolution for all the calculations and object placement, and then you'll use a viewport that understands that world resolution and translates it into window resolution. So, let's set that up our script as follows:</p><div class="informalexample"><pre class="programlisting">WORLD_RESOLUTION_X = 320
WORLD_RESOLUTION_Y = 480

SCREEN_RESOLUTION_X = 2 * WORLD_RESOLUTION_X
SCREEN_RESOLUTION_Y = 2 * WORLD_RESOLUTION_Y

-- Open main screen
MOAISim.openWindow ( "Concentration", SCREEN_RESOLUTION_X, SCREEN_RESOLUTION_Y )

-- Setup viewport
viewport = MOAIViewport.new ()
viewport:setSize ( SCREEN_RESOLUTION_X, SCREEN_RESOLUTION_Y )
viewport:setScale ( WORLD_RESOLUTION_X, WORLD_RESOLUTION_Y )</pre></div><p>Let's take a look at the preceding code line by line:</p><div class="informalexample"><pre class="programlisting">WORLD_RESOLUTION_X = 320
WORLD_RESOLUTION_Y = 480</pre></div><p>These lines are defining two constants, namely, our world resolution along the X and Y axes. Remember that these are not the dimensions of the screen, just our world.</p><div class="informalexample"><pre class="programlisting">SCREEN_RESOLUTION_X = 2 * WORLD_RESOLUTION_X
SCREEN_RESOLUTION_Y = 2 * WORLD_RESOLUTION_Y</pre></div><p>Now we define <code class="literal">X</code> and <code class="literal">Y</code> dimensions <a id="id47" class="indexterm"/>
<a id="id48" class="indexterm"/>
<a id="id49" class="indexterm"/>for our screen's resolution. As you can see, we made our screen double the size of our world. We do this is in order to better illustrate the independence of screen resolution with respect to world resolution. In the following chapters, we'll see that anything you place in the world will look twice as big on the screen as follows:</p><div class="mediaobject"><img src="graphics/5064_04_05.jpg" alt="Resolution independence"/></div><p>We now need to tell Moai to open a window, this is needed during development to create a window for our game, on the devices it will just do nothing.</p><div class="informalexample"><pre class="programlisting">MOAISim.openWindow ( "Concentration", SCREEN_RESOLUTION_X, SCREEN_RESOLUTION_Y )</pre></div><p>This is the same line we saw before, but now, we are using our <a id="id50" class="indexterm"/>
<code class="literal">SCREEN_RESOLUTION_X</code> and <code class="literal">SCREEN_RESOLUTION_Y</code> constant<a id="id51" class="indexterm"/>s. Note that in devices that have fixed size screens, this method won't do anything special, but we need it to run our samples in the computer.</p><div class="informalexample"><pre class="programlisting">viewport = MOAIViewport.new ()</pre></div><p>Now, here is something new (literally). In order to handle the conversion between world and screen coordinates, we will use the <a id="id52" class="indexterm"/>
<code class="literal">MOAIViewport</code> instances. Note that you may have an arbitrary number of viewports, each using different coordinate scales. For example, we could use another viewport with the same scale as the window for some specific effect or for a user interface (GUI) that doesn't need scaling.</p><div class="informalexample"><pre class="programlisting">viewport:setSize ( SCREEN_RESOLUTION_X, SCREEN_RESOLUTION_Y )</pre></div><p>Now we set the size for the viewport. <a id="id53" class="indexterm"/>
<a id="id54" class="indexterm"/>
<a id="id55" class="indexterm"/>This is usually the same size as the screen resolution (additionally, on devices this must match the screen resolution if you want it to take up the entire screen), but you could make a smaller viewport in order to display a small map or something like that, but keep in mind that the whole idea of the size is that it will be the target resolution.</p><div class="informalexample"><pre class="programlisting">viewport:setScale ( WORLD_RESOLUTION_X, WORLD_RESOLUTION_Y )</pre></div><p>And this is what completes the magic. We set a scale, using a different resolution. If you think about this, what we're doing is simply telling the viewport that whatever we put on our layers in the future, needs to be stretched/shrunk from the world coordinates (<code class="literal">WORLD_RESOLUTION_X</code> and <code class="literal">WORLD_RESOLUTION_Y</code>) to another set of coordinates (<code class="literal">SCREEN_RESOLUTION_X</code> and <code class="literal">SCREEN_RESOLUTION_Y</code>).</p><p>That's it, we now have a resolution-independent screen. It's just a matter of changing <code class="literal">SCREEN_RESOLUTION_X</code> and/or <code class="literal">SCREEN_RESOLUTION_Y</code> and the game will adjust accordingly.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec26"/>Summary</h1></div></div></div><p>So, we are now committed to making a <span class="emphasis"><em>Concentration</em></span> game using Moai SDK. We reviewed the rules and goals of the <span class="emphasis"><em>Concentration</em></span> game. We also wrote our first lines with Moai SDK to open a window and discussed how to implement resolution-independent games using world versus screen coordinate systems.</p><p>The next chapter will teach you how to display images on screen, the most basic skill for today's game developers.</p></div></body></html>