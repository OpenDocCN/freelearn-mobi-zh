<html><head></head><body>
		<div id="_idContainer213">
			<h1 id="_idParaDest-80" class="chapter-number"><a id="_idTextAnchor206"/>6</h1>
			<h1 id="_idParaDest-81"><a id="_idTextAnchor207"/>Implementing In-App Purchases</h1>
			<p>As mentioned in <a href="B18868_07.xhtml#_idTextAnchor232"><span class="No-Break"><em class="italic">Chapter 7</em></span></a>, <em class="italic">Advertising Using Unity Ads</em>, there are many options out there when it comes to selling your game on a mobile platform. If you decide to go free-to-play, in addition to showing ads, there is also the ability to sell people additional content and/or advantages through the use of <strong class="bold">In-App Purchases</strong> (<strong class="bold">IAPs</strong>). This can <a id="_idIndexMarker423"/>be a way to engage users of your game and convert them from free players into <span class="No-Break">paying customers.</span></p>
			<p>Typically, these can be options such as removing ads or offering themes to players, but you can also do things such as unlock new levels and add additional content so that people addicted to your game will be clamoring to give you more of their time. Alternatively, you can also think of your IAPs as items that players will want to buy in order to enhance their gameplay experiences, such as power-ups <span class="No-Break">and upgrades.</span></p>
			<p>In this chapter, we will integrate Unity’s IAP system into our project and take a look at how to create an IAP that is for consumable content as well as permanently unlocking features. By the end of the chapter, we will see how to set up Unity’s IAP system and create our first possible purchasable item, and then we will see how to restore purchases on certain devices before seeing additional resources for the various app stores <span class="No-Break">that exist.</span></p>
			<p>This chapter is split into a number of topics. It contains a simple step-by-step process from beginning to end. The following is the outline of <span class="No-Break">our tasks:</span></p>
			<ul>
				<li>Setting up <span class="No-Break">Unity IAP</span></li>
				<li>Creating our <span class="No-Break">first purchase</span></li>
				<li><a id="_idTextAnchor208"/>Adding a button to <span class="No-Break">restore purchases</span></li>
				<li>Configuring purchases for the stores of <span class="No-Break">your choice</span></li>
			</ul>
			<h1 id="_idParaDest-82"><a id="_idTextAnchor209"/>Technical requirements</h1>
			<p>This book utilizes Unity 2022.1.0b16 and Unity Hub 3.3.1, but the steps should work with minimal changes in future versions of the editor. If you would like to download the exact version used in this book, and there is a new version out, you can visit Unity’s download archive at <a href="https://unity3d.com/get-unity/download/archive">https://unity3d.com/get-unity/download/archive</a>. You can also find the system requirements for Unity at <a href="https://docs.unity3d.com/2022.1/Documentation/Manual/system-requirements.html">https://docs.unity3d.com/2022.1/Documentation/Manual/system-requirements.html</a> in the <em class="italic">Unity Editor system </em><span class="No-Break"><em class="italic">requirements</em></span><span class="No-Break"> section.</span></p>
			<p>You can find the code files for this chapter on GitHub <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Unity-2022-Mobile-Game-Development-3rd-Edition/tree/main/Chapter06%20and%2007"><span class="No-Break">https://github.com/PacktPublishing/Unity-2022-Mobile-Game-Development-3rd-Edition/tree/main/Chapter06%20and%2007</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-83"><a id="_idTextAnchor210"/>Setting up Unity IAP</h1>
			<p>Unity IAP is a service that <a id="_idIndexMarker424"/>allows us to sell a variety of different items to players within our game projects and is currently supported by the iOS App Store, Mac App Store, Google Play, Windows Store, Amazon Appstore, and more, by default. So, using this, we can easily sell our items in many different places. We have already set up Unity Services in <a href="B18868_07.xhtml#_idTextAnchor232"><span class="No-Break"><em class="italic">Chapter 7</em></span></a>, <em class="italic">Advertising Using Unity Ads</em>, so this will be a lot easier to get going. Perform the following steps to add <span class="No-Break">Unity IAP:</span></p>
			<ol>
				<li>Open the <strong class="bold">Services</strong> window by going to <strong class="bold">Window</strong> | <strong class="bold">Package Manager</strong>, and then click on the <strong class="bold">Services</strong> button on the <span class="No-Break">top toolbar.</span></li>
				<li>From there, scroll down to the <strong class="bold">In App Purchasing</strong> item and then click on the <span class="No-Break"><strong class="bold">Install</strong></span><span class="No-Break"> button.</span></li>
			</ol>
			<div>
				<div id="_idContainer198" class="IMG---Figure">
					<img src="image/B18868_06_01.jpg" alt="Figure 6.1: The In App Purchasing option from Package Manager"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.1: The In App Purchasing option from Package Manager</p>
			<ol>
				<li value="3"> A window will pop up asking for you to confirm that you would like to activate the <strong class="bold">Purchasing</strong> service package. Click on the <span class="No-Break"><strong class="bold">Ok</strong></span><span class="No-Break"> button.</span></li>
			</ol>
			<div>
				<div id="_idContainer199" class="IMG---Figure">
					<img src="image/B18868_06_02.jpg" alt="Figure 6.2: Activating the Purchasing service"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.2: Activating the Purchasing service</p>
			<ol>
				<li value="4">Once completed, you can close out of <strong class="bold">Package Manager</strong> and then go into the <strong class="bold">Project Settings</strong> menu by going to <strong class="bold">Edit</strong> | <strong class="bold">Project Settings</strong> and then going to the <strong class="bold">Services</strong> section. If all went well, you should<a id="_idIndexMarker425"/> see an <strong class="bold">In-App Purchases</strong> menu section. Select it and you should notice that it has been <span class="No-Break">toggled on.</span></li>
			</ol>
			<p class="callout-heading">Important note</p>
			<p class="callout">The IAP package is created externally from the main engine itself because the code is meant to be extremely flexible and can be updated to fit any policies that are needed. We can then just update the package instead of having to update it to the latest version of Unity, which can be very important when working on a <span class="No-Break">large project.</span></p>
			<div>
				<div id="_idContainer200" class="IMG---Figure">
					<img src="image/B18868_06_03.jpg" alt="Figure 6.3: In-App Purchases are enabled"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.3: In-App Purchases are enabled</p>
			<p>Now that we have the IAP system brought into our project, we can now utilize it to create our first purchasable<a id="_idIndexMarker426"/> object for <span class="No-Break">our players.</span></p>
			<h2 id="_idParaDest-84">C<a id="_idTextAnchor211"/><a id="_idTextAnchor212"/><a id="_idTextAnchor213"/>reating our first purchase</h2>
			<p>To make our first in-app purchase, we will make<a id="_idIndexMarker427"/> use of a feature of Unity that was just added<a id="_idIndexMarker428"/> to our project, Codeless IAP. It is called Codeless IAP because you do not need to write any code for the actual IAP transaction, just the script that defines what users get if they make a purchase. It’s by far the easiest way to integrate IAPs into Unity games and a great way to start trying out IAPs in <span class="No-Break">our project.</span></p>
			<p>One of the most common IAPs <a id="_idIndexMarker429"/>is the ability to disable advertisements in mobile games. Using the following steps, let’s add that functionality by creating a button that, when clicked, will <span class="No-Break">disable advertisements:</span></p>
			<ol>
				<li>Open up our Main Menu level by going to the <strong class="bold">Project</strong> window, opening the <strong class="source-inline">Assets/Scenes</strong> folder, and then double-clicking on the <span class="No-Break"><strong class="source-inline">MainMenu</strong></span><span class="No-Break"> file.</span></li>
				<li>From there, return to the <strong class="bold">Scene</strong> window if not there already, and then click on the <strong class="bold">2D</strong> button to go into 2D mode since we’ll be working with <span class="No-Break">the UI.</span></li>
				<li>We will first need to have something to sell and to do that, we will use the IAP Catalog, which we can access by going to <strong class="bold">Services</strong> | <strong class="bold">In-App Purchasing</strong> | <span class="No-Break"><strong class="bold">IAP Catalog…</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer201" class="IMG---Figure">
					<img src="image/B18868_06_04.jpg" alt="Figure 6.4: Opening the IAP Catalog"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.4: Opening the IAP Catalog</p>
			<p>Once we get to the menu, it should look something <span class="No-Break">like this:</span></p>
			<div>
				<div id="_idContainer202" class="IMG---Figure">
					<img src="image/B18868_06_05.jpg" alt="Figure 6.5: The IAP Catalog"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.5: The IAP Catalog</p>
			<p><a id="_idTextAnchor214"/>Now, the first thing we’ll need to do is create<a id="_idIndexMarker430"/> an ID for our product, which is how we will identify our product in different app stores. In our case, let’s go with <strong class="source-inline">removeAds</strong>. Then, under <strong class="bold">Type</strong>, change it to <span class="No-Break"><strong class="bold">Non Consumable</strong></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer203" class="IMG---Figure">
					<img src="image/B18868_06_06.jpg" alt="Figure 6.6: Creating an IAP"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.6: Creating an IAP</p>
			<p>By non-consumable, we mean<a id="_idIndexMarker431"/> that the players only need to buy this once, and the game will keep that in mind for later. The others are consumable, meaning that they are used for things that can be bought over and over again, such as special power-ups and subscriptions. These give access to some kind of content for a period of time, possibly recurring until a user <span class="No-Break">cancels them.</span></p>
			<p>4.	Next, we can close out of <strong class="bold">IAP Catalog</strong> by clicking on <strong class="bold">X</strong> in the top-right corner of <span class="No-Break">the window.</span></p>
			<p>5.	Select the <strong class="bold">Canvas - Scale Physical</strong> object in the <strong class="bold">Hierarchy</strong> window. From there, select <strong class="bold">Services</strong> | <strong class="bold">In-App Purchasing </strong>| <strong class="bold">Create IAP Button</strong>, and we should see a new button created in <span class="No-Break">our scene:</span></p>
			<div>
				<div id="_idContainer204" class="IMG---Figure">
					<img src="image/B18868_06_07.jpg" alt="Figure 6.7: Creating an IAP button"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.7: Creating an IAP button</p>
			<p>This button will be used to perform an IAP to remove the ads in the game. The button currently uses Unity’s legacy text system, but it can easily be adjusted to use <strong class="source-inline">TextMeshPro</strong> if <span class="No-Break">you’d like.</span></p>
			<p>To ensure that both the <strong class="bold">Start</strong> and <strong class="bold">Remove Ads</strong> buttons show up correctly on the screen, we will create<a id="_idIndexMarker432"/> a menu that can hold both of them. This means creating another panel as a child of our Safe <span class="No-Break">Area panel.</span></p>
			<p>From the <strong class="bold">Hierarchy</strong> window, select our <strong class="bold">Panel</strong> object and, in the <strong class="bold">Inspector</strong> window, rename <span class="No-Break">it </span><span class="No-Break"><strong class="source-inline">SafeAreaHolder</strong></span><span class="No-Break">.</span></p>
			<p>6.	Afterward, create a child <strong class="bold">Panel</strong> object of <strong class="source-inline">SafeAreaHolder</strong> and have it fill the entire screen as done before. Add a <strong class="bold">Vertical Layout Group</strong> component to it. From there, change <strong class="bold">Child Alignment</strong> to <strong class="bold">Middle Center</strong> and set all <strong class="bold">Padding</strong> and <strong class="bold">Spacing</strong> <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">10</strong></span><span class="No-Break">.</span></p>
			<p>7.	Then, add a <strong class="bold">Content Size Fitter</strong> component and set the <strong class="bold">Vertical Fit</strong> and <strong class="bold">Horizontal Fit</strong> fields to <span class="No-Break"><strong class="bold">Preferred Size</strong></span><span class="No-Break">.</span></p>
			<p>8.	Rename the newly added<a id="_idIndexMarker433"/> button <strong class="source-inline">Remove Ads Button</strong> and then add a <strong class="bold">Horizontal Layout Group</strong> component to it with all <strong class="bold">Padding</strong> options set to <strong class="source-inline">10</strong> and at the <strong class="bold">Child Controls Size</strong> property check both the <strong class="bold">Width</strong> and <strong class="bold">Height</strong> options. Also, add a <strong class="bold">Content Size Fitter</strong> component to it with both <strong class="bold">Fit</strong> options set to <strong class="bold">Preferred Size</strong>. Then, in the child <strong class="bold">Text (Legacy)</strong> object’s <strong class="bold">Text</strong> component, change the <strong class="bold">Text</strong> property to show <strong class="source-inline">Remove </strong><span class="No-Break"><strong class="source-inline">Ads</strong></span><span class="No-Break"> instead.</span></p>
			<p class="callout-heading">Tip</p>
			<p class="callout">For a reminder on what these instructions mean and what each step does, check out <a href="B18868_04.xhtml#_idTextAnchor165"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>, <span class="No-Break"><em class="italic">Resolution-Independent U<a id="_idTextAnchor215"/>I</em></span><span class="No-Break">.</span></p>
			<ol>
				<li>Finally, drag and drop the two buttons onto the <strong class="bold">Panel</strong> object, with the <strong class="bold">Play</strong> button in the top half and the <strong class="bold">Remove Ads</strong> button below it, <span class="No-Break">as follows:</span></li>
			</ol>
			<div>
				<div id="_idContainer205" class="IMG---Figure">
					<img src="image/B18868_06_08.jpg" alt="Figure 6.8: The Remove Ads button added to the scene"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.8: The Remove Ads button added to the scene</p>
			<ol>
				<li value="2">Next, with the <strong class="bold">Remove Ads</strong> object selected, move to the <strong class="bold">Inspector</strong> tab, and scroll down to the <strong class="bold">IAP Button</strong> component. Under <strong class="bold">Product ID:</strong>, click the dropdown, and select <strong class="bold">removeAds</strong>. You’ll note that the <strong class="source-inline">IAP Button</strong> class has an <strong class="bold">On Purchase Complete (Product)</strong> function, which works similarly to <strong class="bold">On Click</strong> as we’ve used with <strong class="bold">Button</strong> components in the past. With that in mind, we will need to create a function<a id="_idIndexMarker434"/> that we would like to call when the player presses <span class="No-Break">the button.</span></li>
			</ol>
			<p>In <a href="B18868_07.xhtml#_idTextAnchor232"><span class="No-Break"><em class="italic">Chapter 7</em></span></a><em class="italic">,</em> <em class="italic">Advertising Using Unity Ads</em>, we created a <strong class="source-inline">static</strong> variable inside the <strong class="source-inline">UnityAdController</strong> class called <strong class="source-inline">showAds</strong>. We will use this variable to check whether we should <span class="No-Break">show ads<a id="_idTextAnchor216"/>.</span></p>
			<p>We will need to open up the <strong class="source-inline">MainMenuBehaviour</strong> script and add the following functions to <span class="No-Break">the class:</span></p>
			<pre class="source-code">
public void DisableAds()
{
    UnityAdController.showAds = false;
    /* Used to store that we shouldn't show ads */
    PlayerPrefs.SetInt("Show Ads", 0);
}
protected virtual void Start()
{
    /* Initialize the showAds variable */
    bool showAds = (PlayerPrefs.GetInt("Show Ads", 1)
        == 1);
    UnityAdController.showAds = showAds;
}</pre>
			<p>Here, we are using Unity’s <strong class="source-inline">PlayerPrefs</strong> system in order to save whether a player should be shown ads or not. <strong class="source-inline">PlayerPrefs</strong> is cool because it saves information between playthroughs<a id="_idIndexMarker435"/> of the game and is used often for things such as high scores and player preferences (hence the name). To reset the properties for testing, you can go to <strong class="bold">Edit</strong> | <strong class="bold">Clear All PlayerPrefs</strong>. <strong class="source-inline">PlayerPrefs</strong> may be removed if the app is uninstalled or if the app’s data is cleared, so we will later add a <strong class="bold">Restore Purchases</strong> button that will allow the players to restore their purchases on platforms that allow it. For platforms that don’t, you’ll want to make an API call to the server to check whether the current user has already purchased the non-consumable IAP item. More details on this will be covered in the <em class="italic">Adding a button to restore purchases</em> section of <span class="No-Break">this chapter.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">For more<a id="_idIndexMarker436"/> information on PlayerPrefs, check <span class="No-Break">out </span><a href="https://docs.unity3d.com/ScriptReference/PlayerPrefs.html"><span class="No-Break">https://docs.unity3d.com/ScriptReference/PlayerPrefs.html</span></a><span class="No-Break">.</span></p>
			<p>Note that I made the <strong class="source-inline">Start</strong> function <strong class="source-inline">virtual</strong>, which means that inherited classes can also use this as a foundation for their own scripts. We also marked the function as <strong class="source-inline">protected</strong>, which works the same as a <strong class="source-inline">private</strong> function but it also is accessible in <span class="No-Break">child classes.</span></p>
			<ol>
				<li value="3">With that in mind, we will also need to update the <strong class="source-inline">Start</strong> function of <strong class="source-inline">PauseScreenBehaviour</strong> to <span class="No-Break">the following:</span><pre class="source-code">
<strong class="bold">protected override void Start()</strong>
{
    /* Initialize Ads if needed */
<strong class="bold">    base.Start();</strong>
    if (!UnityAdController.showAds)
    {
        /* If not showing ads, just start the game */
        SetPauseMenu(false);
    }
}</pre></li>
			</ol>
			<p>The <strong class="source-inline">override</strong> keyword will replace the default behavior of <strong class="source-inline">Start</strong>. However, when we call <strong class="source-inline">base.Start()</strong>, we are ensuring that the preceding content from <strong class="source-inline">MainMenuBehaviour</strong> will be called—in this case, we ensure that <strong class="source-inline">UnityAdController</strong> has the correct <span class="No-Break">value set.</span></p>
			<ol>
				<li value="4">Finally, we will need<a id="_idIndexMarker437"/> to adjust the <strong class="source-inline">ObstacleBehaviour</strong> script to handle not playing ads as well. Update the <strong class="source-inline">ShowContinue</strong> function to use <span class="No-Break">the following:</span><pre class="source-code">
    // Other code above...
    /* Come back after 1 second and check again */
    yield return new WaitForSeconds(1f);
}
<strong class="bold">else if (!UnityAdController.showAds)</strong>
<strong class="bold">{</strong>
<strong class="bold">    /* It's valid to click the button now */</strong>
<strong class="bold">    contButton.interactable = true;</strong>
<strong class="bold">    /* If player clicks on button we want to just</strong>
<strong class="bold">       continue */</strong>
<strong class="bold">    contButton.onClick.AddListener(Continue);</strong>
<strong class="bold">    UnityAdController.obstacle = this;</strong>
<strong class="bold">    /* Change text to allow continue */</strong>
<strong class="bold">    btnText.text = "Free Continue";</strong>
<strong class="bold">    /* We can now leave the coroutine */</strong>
<strong class="bold">    break;</strong>
}
else
{
    /* It's valid to click the button now */
    contButton.interactable = true;
    // More code below...</pre></li>
				<li>We will also need to make<a id="_idIndexMarker438"/> a slight adjustment to the <strong class="source-inline">ResetGame</strong> method by removing or commenting out the <span class="No-Break">following lines:</span><pre class="source-code">
/*If we find the button, we can use it */
if (continueButton)
{
    //if (UnityAdController.showAds)
    //{
        // If a player clicks on a button, we want to
           play an ad
        // and then continue
        StartCoroutine(ShowContinue(continueButton));
    //}
    //else
    //{
        /* If we can't play an ad, no need for the
           continue button */
    //    continueButton.gameObject.SetActive(false);
    //}
}</pre></li>
				<li>Save your script and dive <span class="No-Break">into Unity.</span></li>
				<li>From the <strong class="bold">Hierarchy</strong> window, select the <strong class="bold">Remove Ads</strong> button. Go into the <strong class="bold">Inspector</strong> tab and then scroll down<a id="_idIndexMarker439"/> to the <strong class="bold">IAP Button</strong> component. Go ahead and click on the plus button underneath the <strong class="bold">On Purchase Complete (Product)</strong> option, and then add the <strong class="source-inline">Main Menu</strong> object to the little box below the <strong class="bold">Runtime Only</strong> dropdown. Then, select <strong class="bold">Main Menu Behaviour</strong> | <strong class="bold">DisableAds</strong> from the dropdown to <span class="No-Break">the right:</span></li>
			</ol>
			<div>
				<div id="_idContainer206" class="IMG---Figure">
					<img src="image/B18868_06_09.jpg" alt="Figure 6.9: Adding the DisableAds function call to Purc﻿hase"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.9: Adding the DisableAds function call to Purc<a id="_idTextAnchor217"/>hase</p>
			<ol>
				<li value="8">Now, save our scene and start <span class="No-Break">the game:</span></li>
			</ol>
			<div>
				<div id="_idContainer207" class="IMG---Figure">
					<img src="image/B18868_06_10.jpg" alt="Figure 6.10: The purchase menu appears to work correctly"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.10: The purchase menu appears to work correctly</p>
			<p>Now, if we click on the <strong class="bold">Remove Ads</strong> button, it will ask<a id="_idIndexMarker440"/> whether we want to make the purchase. If we do, it will then make it so that when we go into the game, there are no ads. Likewise, now when we die, it will display a <strong class="bold">Free </strong><span class="No-Break"><strong class="bold">Continue</strong></span><span class="No-Break"> but<a id="_idTextAnchor218"/>ton:</span></p>
			<div>
				<div id="_idContainer208" class="IMG---Figure">
					<img src="image/B18868_06_11.jpg" alt="Figure 6.11: Making sure the purchase works correctly"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.11: Making sure the purchase works correctly</p>
			<p>With that, we now have created a simple purchase <span class="No-Break">in Unity.</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">If you’re interested in learning<a id="_idIndexMarker441"/> more about Codeless IAP, <span class="No-Break">checkout </span><a href="https://docs.unity3d.com/Manual/UnityIAPCodelessIAP.html"><span class="No-Break">https://docs.unity3d.com/Manual/UnityIAPCodelessIAP.html</span></a><span class="No-Break">.</span></p>
			<p>With this, you can<a id="_idIndexMarker442"/> now build as many products as you’d like to have in your game. However, certain platforms also have requirements with regard to the functionality to restore previous purchases. In the next section, we will see how to <span class="No-Break">do <a id="_idTextAnchor219"/><a id="_idTextAnchor220"/><a id="_idTextAnchor221"/>that.</span></p>
			<h1 id="_idParaDest-85"><a id="_idTextAnchor222"/>Adding a button to restore purchases</h1>
			<p>On platforms<a id="_idIndexMarker443"/> that support it (Google Play and Universal Windows Applications, most notably), if you purchase<a id="_idIndexMarker444"/> something, uninstall, and then reinstall a game using Unity IAP, it automatically restores any products the user owned during the first initialization <span class="No-Break">following reinstallation.</span></p>
			<p>For those on iOS, users must have the ability to restore their purchases via a button due to Apple requiring them to reauthenticate their password beforehand. Not doing so will prevent our game from being accepted on the iOS App Store, so it’s a good idea to include this functionality if we wish to deploy it there. Let’s look at the steps to do <span class="No-Break">just that:</span></p>
			<ol>
				<li>Go to the <strong class="bold">Hierarchy</strong> window and select the <strong class="bold">Remove Ads Button</strong> object. Once selected, duplicate it by pressing <em class="italic">Ctrl + </em><span class="No-Break"><em class="italic">D</em></span><span class="No-Break">.</span></li>
				<li>Change the duplicate’s name by selecting it and changing its name to <strong class="source-inline">Restore Button</strong> in the <span class="No-Break"><strong class="bold">Inspector</strong></span><span class="No-Break"> window.</span></li>
				<li>From the <strong class="bold">Hierarchy</strong> window, open up the <strong class="bold">Text</strong> object and change the text to <strong class="source-inline">Restore Purchases</strong> <span class="No-Break">as well.</span></li>
				<li>Now, select the <strong class="bold">Restore</strong> object, and then, in the <strong class="bold">IAP Button</strong> component, go to <strong class="bold">Button Type</strong> and <span class="No-Break">select </span><span class="No-Break"><strong class="bold">Restore</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer209" class="IMG---Figure">
					<img src="image/B18868_06_12.jpg" alt="Figure 6.12: Adding the Restore button"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.12: Adding the Restore button</p>
			<p>You should note<a id="_idIndexMarker445"/> that the properties of the <strong class="bold">IAP Button</strong> component<a id="_idIndexMarker446"/> have changed and now only allow you to set <strong class="bold">Button Type</strong>, as there is nothing left <span class="No-Break">to <a id="_idTextAnchor223"/>customize.</span></p>
			<ol>
				<li value="5">Save your scene and jump <span class="No-Break">into Unity.</span></li>
				<li>When you start the game and try to click on <strong class="bold">Restore</strong>, you’ll get a warning in the <strong class="bold">Console</strong> window stating that this isn’t a <span class="No-Break">supported platform:</span></li>
			</ol>
			<div>
				<div id="_idContainer210" class="IMG---Figure">
					<img src="image/B18868_06_13.jpg" alt="Figure 6.13: Warning upon trying to restore on Windows"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.13: Warning upon trying to restore on Windows</p>
			<p>So, with that in mind, we can adjust our game so that the button will only show up if we are currently running on a <span class="No-Break">supported platform.</span></p>
			<ol>
				<li value="7">Go to the <strong class="source-inline">Scripts</strong> folder and create<a id="_idIndexMarker447"/> a C# script called <strong class="source-inline">RestoreAdsChecker</strong>. Once it opens, use <a id="_idIndexMarker448"/>the following script <span class="No-Break">for it:</span><pre class="source-code">
using UnityEngine;
/// &lt;summary&gt;
/// Will show or remove a button depending on whether
/// we can restore ads or not
/// &lt;/summary&gt;
public class RestoreAdsChecker : MonoBehaviour
{
    // Use this for initialization
    void Start()
    {
        bool canRestore = false;
        switch (Application.platform)
        {
            // Windows Store
            case RuntimePlatform.WSAPlayerX86:
            case RuntimePlatform.WSAPlayerX64:
            case RuntimePlatform.WSAPlayerARM:
            // iOS, OSX, tvOS
            case RuntimePlatform.IPhonePlayer:
            case RuntimePlatform.OSXPlayer:
            case RuntimePlatform.tvOS:
                canRestore = true;
                break;
        }
        gameObject.SetActive(canRestore);
    }
}</pre></li>
			</ol>
			<p>This script goes through all of the stores listed in Unity’s <strong class="source-inline">IAPButton</strong> class, and if they are something that can be restored, we set <strong class="source-inline">canRestore</strong> to <strong class="source-inline">true</strong>; otherwise, it will stay <strong class="source-inline">false</strong>. Finally, we will remove<a id="_idIndexMarker449"/> the object if we cannot restore it, without having<a id="_idIndexMarker450"/> to create specific things for <span class="No-Break">different builds.</span></p>
			<ol>
				<li value="8">Save the script and dive back <span class="No-Break">into Unity.</span></li>
				<li>Attach our newly created <strong class="source-inline">RestoreAdsChecker</strong> component to our <strong class="bold">Restore </strong><span class="No-Break"><strong class="bold">Button </strong></span><span class="No-Break">object:</span></li>
			</ol>
			<div>
				<div id="_idContainer211" class="IMG---Figure">
					<img src="image/B18868_06_14.jpg" alt="Figure 6.14: Adding the Restore Ads Checke﻿r component"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.14: Adding the Restore Ads Checke<a id="_idTextAnchor224"/>r component</p>
			<ol>
				<li value="10">Save your project<a id="_idIndexMarker451"/> and start<a id="_idIndexMarker452"/> up <span class="No-Break">the game:</span></li>
			</ol>
			<div>
				<div id="_idContainer212" class="IMG---Figure">
					<img src="image/B18868_06_15.jpg" alt="Figure 6.15: The result of the RestoreAdsChecker component"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 6.15: The result of the RestoreAdsChecker component</p>
			<p>Now, due to the <strong class="bold">RestoreAdsChecker </strong>component that we added on our PC build of the game, the <strong class="bold">Restore</strong> button doesn’t show up, but if we export for iOS, it will show up on <span class="No-Break">our device!</span></p>
			<p class="callout-heading">Note</p>
			<p class="callout">For more information on restoring transactions and how this functionally works, check <span class="No-Break">out </span><a href="https://docs.unity3d.com/Manual/UnityIAPRestoringTransactions.html"><span class="No-Break">https://docs.unity3d.com/Manual/UnityIAPRestoringTransactions.html</span></a><span class="No-Break">.</span></p>
			<p>This ensures that our game<a id="_idIndexMarker453"/> has this particular feature on each<a id="_idIndexMarker454"/> of the different platforms that support it. With that in mind, we will next look at some of the specific stores and places you may wish to add support for IAPs<a id="_idTextAnchor225"/><a id="_idTextAnchor226"/> in <span class="No-Break">your game.</span></p>
			<h2 id="_idParaDest-86"><a id="_idTextAnchor227"/>Configuring purchases for the stores of your choice</h2>
			<p>Unfortunately, we do not have enough<a id="_idIndexMarker455"/> room in the book to go step by step through the process for every store, but I do have pages that you can reference to go through the entire process for the <span class="No-Break">following stores:</span></p>
			<ul>
				<li>The Apple App Store and Mac App <span class="No-Break">Store: </span><a href="https://docs.unity3d.com/Manual/UnityIAPAppleConfiguration.html"><span class="No-Break">https://docs.unity3d.com/Manual/UnityIAPAppleConfiguration.html</span></a></li>
				<li>Google Play <span class="No-Break">Store: </span><a href="https://docs.unity3d.com/Manual/UnityIAPGoogleConfiguration.html"><span class="No-Break">https://docs.unity3d.com/Manual/UnityIAPGoogleConfiguration.html</span></a></li>
				<li>The Windows <span class="No-Break">Store: </span><a href="https://docs.unity3d.com/Manual/UnityIAPWindowsConfiguration.html"><span class="No-Break">https://docs.unity3d.com/Manual/UnityIAPWindowsConfiguration.html</span></a></li>
				<li>Amazon <span class="No-Break">Appstore: </span><a href="https://docs.unity3d.com/Manual/UnityIAPAmazonConfiguration.html"><span class="No-Break">https://docs.unity3d.com/Manual/UnityIAPAmazonConfiguration.html</span></a></li>
			</ul>
			<p>There are some potential issues when trying to publish to multiple Android IAP stores (such as Samsung and Google) with the same build. You can find<a id="_idIndexMarker456"/> information on resolving those issues <span class="No-Break">at </span><a href="https://docs.unity3d.com/Manual/UnityIAPCrossStoreInstallationIssues.html"><span class="No-Break">https://docs.unity3d.com/Manual/UnityIAPCrossStoreInstalla<span id="_idTextAnchor228"/>tionIssues.html</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-87"><a id="_idTextAnchor229"/>Summary</h1>
			<p>In this chapter, we covered how to create IAPs by making use of Unity in your project. We first covered how to set up Unity’s IAP system and then dived into using Codeless IAP to easily add a purchasable item to your game. We then created the functionality to restore our purchase if we uninstall and reinstall our game and went over where we can go to set up our purchases depending on the store we want to target. These new skills give you the ability to make additional revenue from your game while also allowing you to target multiple stores and platforms, making it possible for even more people to <span class="No-Break">see it.</span></p>
			<p>Now, of course, having all these ways to make money isn’t going to help us if no one plays our game. In the next chapter, we will get social, learning how we can make use of social media to share our score and get other players interested in <span class="No-Break">our title.</span></p>
			<p><a id="_idTextAnchor230"/><a id="_idTextAnchor231"/><span class="No-Break">Further reading</span></p>
			<p>For more tips and tricks on improving your freemium strategy, I suggest that you check out the following article by Pepe Agell <span class="No-Break">at </span><a href="https://www.chartboost.com/blog/inapp-purchases-for-indie-mobile-games-freemium-strategy"><span class="No-Break">https://www.chartboost.com/blog/inapp-purchases-for-indie-mobile-games-freemium-strategy</span></a><span class="No-Break">.</span></p>
		</div>
	</body></html>