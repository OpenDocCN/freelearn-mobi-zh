<html><head></head><body><h1 id="e-gtNc">Chapter 11. Publishing an App to the App Store</h1>
<p id="e-cofV">An app is useful if everyone can enjoy it, and this means finding a way to make it available to the masses. In this chapter, we will take a look at the various aspects of getting your app ready for deployment and discuss the various options available for publishing the Android application to market. In this chapter, we will cover the following topics:</p>
<ul id="e-PaLX">
<li id="e-ipMW">Preparing application for release</li>
<li id="e-O8CS">Publishing a signed APK for uploading</li>
<li id="e-qZwR">Different app distribution options</li>
<li id="e-tn1J">Publishing on Google Play</li>
</ul>
<h1 id="e-vzQY">Preparing the application for release</h1>
<p id="e-v4Om">As your application is fully developed, the moment when you put a significant amount of effort to verify each of the key functional modules is crucial. Many developers prefer to test the app using different test automation frameworks (such as Robotium, Appium, Xamarin Test Cloud, and so on), or some developers use manual testing to verify the app on targeted devices. Once you're convinced that the application doesn't contain any obvious glitches and works as smoothly as expected, you're ready to deploy the app to the app store.</p>
<p id="e-KXDq">The following sections discuss the various aspects to be considered prior to producing a release APK.</p>
<h2 id="e-xK0h">Disabling the debug mode</h2>
<p id="e-xE2e">During the development of an application, Xamarin Studio supports debugging Xamarin.Android apps using <strong>Java Debug Wire Protocol</strong> (<strong>JDWP</strong>). This is great for development purposes but poses security risks for deployed applications and thus needs to be disabled in the released apps. There are two different ways to accomplish this:</p>
<ol id="e-Kir1">
<li id="e-GRDi">Setting the application <code>android:debuggable</code> property in the <code>AndroidManifest.xml</code> file.</li>
<li id="e-IkMa">Using the <code>AssemblyInfo.cs</code> conditional directives.</li>
</ol>
<p id="e-ZXrn">To remove the debug mode using the Android <code>AndroidManifest.xml</code> descriptor, you need to set the value of the <code>android:debuggable</code> property to <code>false</code>. The following listing shows how to turn off the JDWP debugging from the manifest file:</p>
<pre id="e-kNwj">&amp;lt;application ...
  android:debuggable="false" ...
&amp;lt;/application&amp;gt;</pre>
<p id="e-AFbJ">Another way of disabling the debug mode is using the conditional directive in the <code>AssemblyInfo.cs</code> file. The following listing shows how to use a conditional directive to turn the JDWP debugging off or on based on the configuration that is selected. This approach has the advantage of being based on the currently selected configuration:</p>
<pre id="e-eX6f">#if RELEASE
   [assembly: Application(Debuggable=false)]
 #else
   [assembly: Application(Debuggable=true)]
 #endif</pre>
<h2 id="e-P1lJ">Configuring linking options</h2>
<p id="e-B4bJ">By default, the release mode turns off using shared runtime and turns on linking so that your distribution APK only contains the portions of the Xamarin.Android runtime required by your app. The linker does this by performing a static analysis of your compiled code in order to determine which assemblies, types, and type members are used by your application. All unused assemblies, types, and members are striped out in order to reduce the overall size of the application.</p>
<p id="e-oAA8"><strong>Linker Options</strong> can be viewed and set in the <strong>Project Options</strong> dialog under the <strong>Android Build</strong> section:</p>
<img data-width="776" data-height="664" src="kGBIis26.jpg"/><p id="e-fJzr">When viewing and adjusting <strong>Linker Options</strong>, make sure to first select <strong>Release</strong> from the <strong>Configuration</strong> drop-down box. Xamarin.Android provides the following linking behaviors:</p>
<ul id="e-Ni59">
<li id="e-RfzZ">
<strong>Don't link</strong>: This turns off the linker; no linking will be performed.</li>
<li id="e-msp4">
<strong>Link SDK assemblies only</strong>: This will only link the assemblies that are required by Xamarin.Android. Other assemblies will not be linked; they will be distributed as separate assemblies.</li>
<li id="e-v8Me">
<strong>Link all assemblies</strong>: This will link all assemblies that are required by the application and not just the ones required by Xamarin.Android.</li>
</ul>
<h3 id="e-El6r">Side effects of linking</h3>
<p id="e-UQgA">In some cases, linking can have some unintended side effects, including needed types and members being accidentally discarded. It is very important for an application that is compiled and linked in a release mode to be put through a thorough testing cycle in order to ensure that the app does not suffer from this side effect. In fact, in most cases, testing beyond the initial developer's testing should be conducted using an APK file and produced in the release mode.</p>
<p id="e-GWnL">If you encounter runtime exceptions or build failure issues related to missing types or have trouble locating specific methods, you may need to provide a custom linker file that gives explicit instructions concerning specific types or members to the linker.</p>
<p id="e-x1uV">The following listing is an example of a custom linking file that directs the linker to always include a specific type and specific set of members for the type:</p>
<pre id="e-vmUh">&amp;lt;?xml version="1.0" encoding="UTF-8" ?&amp;gt;
&amp;lt;linker&amp;gt;
    &amp;lt;assembly fullname="Mono.Android"&amp;gt;
       &amp;lt;type fullname="Android.Widget.AdapterView" &amp;gt;
         &amp;lt;method name="GetGetAdapterHandler" /&amp;gt;
         &amp;lt;method name="GetSetAdapter_Landroid_widget_Adapter_Handler" /&amp;gt;
       &amp;lt;/type&amp;gt;
    &amp;lt;/assembly&amp;gt;
&amp;lt;/linker&amp;gt;</pre>
<p id="e-c7IZ">A custom linking file can be added to a project as a simple XML file. After adding the file to the project, select the file, open the <strong>Properties</strong> pad, and choose <strong>LinkDescription</strong> from the <strong>Build action</strong> menu, as shown in the following screenshot:</p>
<img data-width="352" data-height="227" src="gcixsNDU.jpg"/><h2 id="e-JlIG">Selecting supported ABIs</h2>
<p id="e-Rovf">Android supports several different CPU architectures. The Android platform defines a set of <strong>Application Binary Interfaces</strong> (<strong>ABIs</strong>) that correspond to different CPU architectures. By default, Xamarin.Android assumes that <strong>armeabi-v7a</strong> is appropriate in most circumstances. If you need to support additional architectures, then you must check each one that applies. This will cause the build process to generate the code that will run on all the target ABIs as well as include native libraries that are appropriate for each architecture.</p>
<p id="e-u6XS">Supported ABIs can be specified in the <strong>Project Options</strong> dialog under the <strong>Android Build</strong> section:</p>
<img data-width="774" data-height="665" src="WNxGP7Da.jpg"/><p id="e-C3z1">One scenario where I have run into the need of specifying additional ABIs is the testing process. I have worked with a group of testers many times; some of which have physical devices and some of which use emulators. To support the use of the x86 emulator, you will need to include x86 in the supported ABI's list.</p>
<h2 id="e-drem">Verifying the package name, icon, and app version</h2>
<p id="e-ucU9">There are several additional manifest properties that you need to verify before preparing a release build for uploading it to the Android market. This section will take you through some of those key items.</p>
<h3 id="e-udIY">The package name</h3>
<p id="e-GQSp">A package name is a unique identifier for your application in Google Play. An application package name is defined in the <code>AndroidManifest.xml</code> file. Once your application is deployed to the market with this name, you cannot change it later. Changing the app package name means that it will be treated as a completely new application.</p>
<p id="e-llyV">The Android application package name should be unique and the name may contain the uppercase or lowercase letters ('A' through 'Z'), numbers, and underscores ('_'). Usually, it is a best practice to use your Internet domain ownership as the basis for your package names. For example, applications published by Yahoo will start with <code>com.yahoo.&amp;lt;app id&amp;gt;</code>.</p>
<p id="e-WDVl">Most of the app settings can be either controlled directly by editing the <code>AndroidManifest.xml</code> file or from the project <strong>Options</strong> window. To modify the package name in the <code>AndroidManifest.xml</code>, you need to use the <code>package</code> attribute, as shown in the following code snippet:</p>
<pre id="e-sJA5">&amp;lt;?xml version="1.0" encoding="utf-8"?&amp;gt;
&amp;lt;manifest 
  package="com.packt.poiapp"&amp;gt;
  ...
&amp;lt;/manifest&amp;gt;</pre>
<p id="e-DnI0">Right-click on your project in the Xamarin Solution Explorer and select <strong>Options</strong> to open the <strong>Project Options</strong> window. The following screenshot depicts the project options window in Xamarin Studio:</p>
<img data-width="776" data-height="664" src="KDV0sTwL.jpg"/><h3 id="e-m4Ez">The application name and icon</h3>
<p id="e-ggZ7">Making an app that works in a device isn't just enough. You will need to provide a high-quality app icon that represents your brand or product. After all, the app icon is the first thing that a user will notice after the app is installed on the device. You must prepare your app launcher icon for devices of mdpi, hdpi, xhdpi, and xxhdpi density.</p>
<p id="e-muav">Once the launcher icons are ready, add them to their respective drawable resource folder for different screen densities. You can set the app name by setting the <code>android:label</code> property to the <code>&amp;lt;application&amp;gt;</code> element in the <code>AndroidManifest.xml</code> file, and for setting the application icon, you can use the <code>android:icon</code> property:</p>
<pre id="e-hJ01">&amp;lt;manifest &amp;#x2026;&amp;#x2026;. &amp;gt;
     &amp;lt;application
android:label="POIApp"
    android:icon="@drawable/ic_launcher"&amp;gt;
&amp;lt;/application&amp;gt;
&amp;lt;/manifest&amp;gt;</pre>
<p id="e-PIoh">You can refer to the official Google app icon design guidelines at <a href="http://www.google.com/design/spec/style/icons.html#icons-product-icons">http://www.google.com/design/spec/style/icons.html#icons-product-icons</a>.</p>
<h3 id="e-GyFD">The application versioning scheme</h3>
<p id="e-kmCN">The application versioning scheme is used to track different build versions. This also helps notify a user when there is an upgrade version of the application available for download. Android uses the following two different manifest attributes to define the build version information:</p>
<ul id="e-Btjc">
<li id="e-ibPD">
<code>android:versionCode</code>: This is an integer value that represents the current build version of the application. Internally, Google Play uses this property to handle the build update process such as notifying the user when a new version of the app is available. You must increase the value of <code>versionCode</code> for each successive release.</li>
<li id="e-rgP0">
<code>android:verionName</code>: This is a string that represents the release version of the application. This version code will be displayed publicly to the user on Google Play. Note that this string is not made mandatory on Google Play and is not used internally, but it is just displayed it to the user.</li>
</ul>
<p id="e-Bu1h">Both of these attributes can be set either from the <strong>Project Options</strong> window or from the application manifest file:</p>
<pre id="e-YCbt">&amp;lt;manifest 
  android:versionCode="1"
  android:versionName="1.0"
  package="com.packt.POIApp"&amp;gt;
  ....
  ....
&amp;lt;/manifest&amp;gt;</pre>
<h2 id="e-GkJT">Review user permissions</h2>
<p id="e-s4LG">The Android application must declare the list of permissions it requires for accessing certain features in the app. Android app permissions are declared in the <code>AndroidManifest.xml</code> file using the <code>&amp;lt;uses-permission&amp;gt;</code> tag. When an application is being installed on the user device, the Android system reads the manifest file and displays the list to the user. The user must decide to allow the permissions for the installation to complete. The following screenshot depicts the app permissions dialog while downloading the Facebook mobile app:</p>
<img data-width="500" data-height="779" src="aInBxN41.jpg"/><p id="e-BcjF">While preparing a release version build of your application, verify that your app manifest file defines only the permissions that are required for your application. For example, a camera application that requests for the read call log permission could be a reason for annoyance with a high degree of a chance for the user to not download your application.</p>

<h1 id="e-yXEl">Publishing a signed APK for uploading</h1>
<p id="e-wy1D">Once we have completed all the previous steps, we will proceed to the final step of preparing a signed APK to be published on different app stores. The following sections discuss the steps of producing a signed APK from within Xamarin Studio.</p>
<h2 id="e-Mexo">Android keystores</h2>
<p id="e-DPXA">A <strong>keystore</strong> is a database of security certificates created and managed by the <strong>keytool</strong> program from the Java SDK. The keystore is an important aspect of creating a release version of the Android app. The Android device cannot run applications that have not been digitally signed. This may come as some surprise because we have been running our app for some time now. During the development process, Xamarin.Android uses a <strong>debug keystore</strong> that signs the build while running the application from an IDE, and as such the apps to run on the device. This keystore works for debugging purposes only, but will not be recognized as a valid keystore for the distribution of released apps.</p>
<p id="e-rALt">A keystore must be kept safe as the same keystore key is required for publishing all of the future versions of an application. If a keystore is lost, it will not be possible to publish updates to an app on Google Play. The only solution would be to create a new keystore and publish the new version as a completely new app.</p>
<p id="e-Sy51">A keystore can be created using a <strong>keytool</strong> and <strong>jarsigner</strong> command-line tool available in Java JDK. The following command is used to create a keystore using the Java keytool utility:</p>
<img data-width="800" data-height="460" src="Zb4RUfjg.jpg"/><p id="e-jf4c">Note that the preceding command prompts the user to provide the password and other required details in order to generate the <strong>release.keystore</strong> key.</p>
<p id="e-ebEU">While the command-line keytool utility can be used directly to create and manage keystores, Xamarin.Android provides a user interface to the tool, which is integrated into the publishing process. The following section will guide you with the steps to create a keystore and prepare a signed Android build for publishing.</p>
<h2 id="e-Z0QI">Publishing from Xamarin.Android</h2>
<p id="e-EozV">The following steps will guide you through creating a new keystore as part of the process while creating a signed <code>.apk</code> file:</p>
<ol id="e-LBqZ">
<li id="e-qStT">In the <strong>Run Configuration</strong> drop-down box, select the <strong>Release</strong> option:<img data-width="462" data-height="174" src="fpt2MwXn.jpg"/>
</li>
<li id="e-JPKO">Navigate to the <strong>Build</strong> | <strong>Achieve for Publishing</strong> option in the Xamarin Studio toolbar. You will see a list of the latest <code>POIApp</code> builds, as shown in the following screenshot. If you have never build your code, it will build and generate one for you:<img data-width="800" data-height="463" src="OOxtJgQS.jpg"/>
</li>
<li id="e-CknV">Select the latest build from the list and click on the <strong>Sign and Distribute…</strong> button from the bottom-right corner. You will see two options: <strong>Ad-Hoc</strong> or <strong>Google Play</strong>. If you select the <strong>Ad-Hoc</strong> option, it will create a build and save it in your disk. You need to manually publish the app to Google Play. However, the <strong>Google Play</strong> option allows you to distribute your app on Google Play directly from Xamarin Studio.<p id="e-D9GA">However, it is always a good idea to create a signed build and save it in your computer so that you can verify all the features before publishing it to Google Play:</p>
<img data-width="652" data-height="342" src="y0zfZ2ZF.jpg"/>
</li>
<li id="e-JTfc">Let's select <strong>Ad-Hoc</strong> and click on <strong>Next</strong>. Notice that it will open the <strong>Android Signing Identity</strong> wizard with two buttons: <strong>Create a New Key</strong> and <strong>Import an Existing Key</strong>. If you have created the keystore using the Java keytool command-line utility as explained earlier, you will need to directly select <strong>Import Existing Key</strong>.<p id="e-npHu">In this example, I have selected <strong>Create a New Key</strong> button to demonstrate how Xamarin Studio facilitates the process of creating a new keystore.</p>
</li>
<li id="e-DFJT">Select <strong>Create a New Key</strong> button.</li>
<li id="e-ba7X">Fill in all of the required details, such as alias, password, full name, validity, and so on, and then select <strong>OK</strong> to confirm:<img data-width="605" data-height="461" src="fi7OrH2o.jpg"/>
</li>
<li id="e-P1Lj">It will create a new key and display the <strong>Android Signing Identity</strong> dialog. Select the key and click on <strong>Next</strong>.</li>
<li id="e-jKaU">Notice that it will display a confirmation dialog, as shown in the following screenshot:<img data-width="653" data-height="675" src="faPYUaIb.jpg"/>
</li>
<li id="e-kmM9">Select <strong>Publish</strong>. It will prompt you to select the location to save the apk file. As prompted, you need to provide the keystore password while generating the signed APK:<img data-width="653" data-height="673" src="avi4HWgt.jpg"/>
</li>
</ol>
<p id="e-NPnF">The resulting APK is ready for final testing and potential distribution.</p>
<h2 id="e-FmfW">Republishing the app</h2>
<p id="e-s8yX">The keystore that was created while deploying the very first version of an application is very important and should be kept safe. The keystore, alias, and passwords should be kept secure so that only those authorized to publish a new version of the app will have access to them.</p>

<h1 id="e-WxRc">Different app distribution options</h1>
<p id="e-spxt">Android developers have a number of options for distributing their applications, which include the following:</p>
<ul id="e-spVh">
<li id="e-Jcrs">Self-publishing via a private Cloud or via website links</li>
<li id="e-mHY6">Distributing via e-mail attachments</li>
<li id="e-UQQb">Publishing in Google Play</li>
<li id="e-xN80">Publishing in third-party app stores</li>
</ul>
<h2 id="e-BWc9">Self-publishing via website links or e-mails</h2>
<p id="e-Ta3R">Website links and e-mail attachments are pretty straightforward, easy to accomplish, and may be suitable for some apps that are used internally by a company or by a small group of associates.</p>
<p id="e-EGYD">Prior to installing apps from a website link or an e-mail attachment, you must first update your device security settings to allow apps to be installed from <strong>Unknown sources</strong>. Let's take a look at the following screenshot:</p>
<img data-width="500" data-height="506" src="EVdkKSLM.jpg"/><p id="e-j8Eb">After enabling this option, you will be prompted to install an app when selecting an e-mail attachment or a web link that is an APK.</p>
<p id="e-r5vM">Note that for general consumers, website links and e-mails as a means of distribution are not ideal. Marketplaces such as Google Play and Amazon Appstore provide significant advantages over self-publishing methods. The following are some of the advantages of distributing your application via an app store:</p>
<ul id="e-a6ag">
<li id="e-QwdW">Most app stores provide a review process to ensure that apps are not malicious in nature. Google has recently introduced an app store review process that verifies the violation of the Android developer policy, build size, permissions, and so on. The review process strengthens the Android community and helps to build consumers' trust.</li>
<li id="e-KTrB">Provides a robust infrastructure to reach out to millions of consumers by distributing apps on App Store.</li>
<li id="e-K7Oi">Promotes apps and allow content rating from consumers.</li>
<li id="e-DYVE">Handles financial settlements for applications that use subscriptions or purchases.</li>
</ul>
<h2 id="e-fmcz">Publishing on Google Play</h2>
<p id="e-plhH">Google Play is an ideal marketplace to upload and distribute your application to a wider range of audience. It is a single platform that allows an app publisher to distribute, advertise, make dollars by selling your app, and analyze the usage and stats of your application. On the other hand, every Android device is shipped with a Google Play Android app through which your published application will be discovered and downloaded to users.</p>
<p id="e-mzkD">Before your application is pushed into the wild, it is always valuable to get some real-world feedback from users. Developers prefer to distribute an alpha/beta version of their application to a group of users and gather feedback. Beta testing helps you get the early feedback from real users and address them before heading to the production move.</p>
<p id="e-uPaZ">Google Play allows you to set up and distribute the alpha beta staging release of your app. After the release version of your application is prepared and uploaded to the beta stage, you can invite a group of testers to whom you would like to distribute your application. The testers with an invitation can download the app, provide the feedback, and rate your application. This book does not include the detailed steps to use the Google Play beta testing program. For more details, you can visit <a href="http://developer.android.com/distribute/tools/launch-checklist.html">http://developer.android.com/distribute/tools/launch-checklist.html</a>.</p>
<p id="e-dTzg">To publish your application to Google Play, you need to follow some of the specific steps described as follows:</p>
<ol id="e-DHPG">
<li id="e-uuQE">To distribute apps on Google Play, you will require a developer account. To register as a developer, there is a one time registration fee of $25 USD. You can follow the on-screen instructions to register as a developer, which is available at <a href="https://play.google.com/apps/publish/signup/">https://play.google.com/apps/publish/signup/</a>.</li>
<li id="e-OKs6">Prepare the promotional assets such as graphics, video, and promotional messages required while uploading your application. The following is the list:<ul id="e-BN8g">
<li id="e-zCEe">Prepare the promotional messages, including an application title, a short description, and a full description</li>
<li id="e-nGcl">High-resolution application icons of size 512 w x 512 h</li>
<li id="e-RGLU">Feature graphic of size 1024 w x 500 h</li>
<li id="e-xJOc">Promo graphic of size 180 w x 120 h</li>
<li id="e-NxKE">An optional promo YouTube video showcasing your application</li>
</ul>
</li>
<li id="e-CVYG">Once you are ready with the release version of APK and the promotional contents, the application can be uploaded to Google Play. This is done by logging to the Google Play publisher dashboard:<img data-width="800" data-height="244" src="S2d52OQ0.jpg"/>
</li>
<li id="e-AWmw">Click on the <strong>Add new application</strong> button to help you with the process of uploading an APK:<img data-width="616" data-height="360" src="iRs16e1G.jpg"/>
</li>
<li id="e-aJal">Provide a <strong>Title</strong> for your app to be displayed on Google Play and click on <strong>Upload APK</strong>.</li>
<li id="e-yt9y">Once the APK is uploaded, you need to complete the <strong>Store listing</strong> details by uploading the required screenshots and other promotional materials.</li>
<li id="e-gEpN">While uploading, all the apps must be rated according to the Google Play ratings system. To learn more about the new content rating system, you can refer to <a href="https://support.google.com/googleplay/android-developer/answer/188189">https://support.google.com/googleplay/android-developer/answer/188189</a>.</li>
<li id="e-jFEC">The <strong>Pricing and Distribution</strong> tab on the dashboard allows you to select the geo location for your app availability.</li>
<li id="e-pkCG">Once you furnish all the particulars required, you can now click on the <strong>Publish app</strong> button to make your application live for download.</li>
</ol>
<h2 id="e-uxT4">Third-party app stores</h2>
<p id="e-hx1P">Google Play is not the only option available to distribute your application to the world. You should consider using other distribution channels such as Mall.Soc.io (<a href="http://soc.io/apps">http://soc.io/apps</a>), GetJar (<a href="http://www.getjar.com/">http://www.getjar.com/</a>), Amazon Appstore, and so on. There is no restriction imposed on Google for redistributing the same application on other marketplaces. Consider all the available options to make the most of your efforts.</p>

<h1 id="e-JLjN">Summary</h1>
<p id="e-UMBy">In this chapter, we briefly discussed the process to prepare and sign the release version of an APK. We also discussed the different app distribution channels that are available to developers for distributing the Android apps.</p>
<p id="e-H5Cy">We have now completed the <code>POIApp</code> app that exercises many of the Xamarin.Android features you will need while developing a professional Android application. However, there are tons of great features in Android that remained undiscovered in this book, which include audio, video, face recognition, Bluetooth, NFC, and so on.</p>
<p id="e-yLB9">In the context of this starter guide, we simply do not have enough space to cover all features that are supported in Android. Make sure that you explore the <a href="http://developer.android.com/index.html">http://developer.android.com/index.html</a> and <a href="http://developer.xamarin.com/">http://developer.xamarin.com/</a> to enhance your knowledge on the other interesting Android features.</p>
<p id="e-vNkB">I wish you good luck with the Xamain.Android development! Happy coding!</p>
</body></html>