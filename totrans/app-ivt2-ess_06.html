<html><head></head><body>
<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch06" class="calibre1"/>Chapter 6. Introduction to Databases</h1></div></div></div><p class="calibre9">Now that we've successfully created the first part of the Event app, it is time to make it more functional. In this chapter, we will build onto our Event app by adding code that will enable guests to respond to the invitation by sending an RSVP (<em class="calibre19">répondez s'il vous plaît</em>—<em class="calibre19">please reply</em>, in French). The app will aggregate all the data and display a guest list so that both guests and party organizers can see who is attending.</p><p class="calibre9">In order for the app to collect all the RSVP data from individuals in a central repository, we will have to use an online database. App Inventor has built-in support for three online databases, TinyWebDB, and Google Fusion Tables (which we will use).</p><p class="calibre9">Both, TinyWebDB and Google Fusion Tables have their limitations in aggregating data. TinyWebDB, while easy to use, is not secure. This means that anyone has access to the database, could by mistake (or on purpose), delete or change the data that is collected. On the other hand, Google Fusion Tables is secure, but is more complicated to use. In order to integrate Fusion Tables into our app, while keeping the design of the app relatively simple, we had to make some tradeoffs. The learning objective is to introduce you to the process of building a database with a relatively simple app. But, as you will discover, the resulting app is challenging to disseminate to a broad public audience. At the time of publication for this book, another App Inventor database alternative, FirebaseDB was under development. We will offer updates about the adoption of FirebaseDB as it becomes available. You can check the supplementary materials on both the Packt Publishing and MIT App Inventor websites for new information about FirebaseDB.</p><p class="calibre9">In this chapter you will learn:</p><div><ul class="itemizedlist"><li class="listitem">How to create a Google Fusion Table</li><li class="listitem">How to establish Google API credentials</li><li class="listitem">How to set up an RSVP form</li><li class="listitem">How to push data from an App Inventor app into a Google Fusions Table</li><li class="listitem">How to request and receive data from a Google Fusion Table into an App Inventor app</li><li class="listitem">How to display a guest list</li></ul></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_1"><a id="ch06lvl1sec35" class="calibre1"/>Creating a database</h1></div></div></div><p class="calibre9">In this app, invitees <a id="id271" class="calibre1"/>will send an RSVP to let the party organizer (and other guests) know whether or not they can attend an event. So, naturally, we will have to include a mechanism to collate all of that distributed information into one central place. To achieve this, we will create an online database using a Google Fusion Table. In professional programming, this aspect is often referred to as creating the backend.</p></div></div>

<div><div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch06lvl2sec36" class="calibre1"/>Creating a Google Fusion Table</h2></div></div></div><p class="calibre9">To create a <a id="id272" class="calibre1"/>Google Fusion Table, go to the <a class="calibre1" href="https://drive.google.com">https://drive.google.com</a> website on your computer and click on the big red button on the top-left side of the screen <a id="id273" class="calibre1"/>labeled <strong class="calibre10">NEW</strong>. Scroll down the list of options and select <strong class="calibre10">More</strong> and select <strong class="calibre10">Google Fusion Tables</strong>:</p><div><img src="img/00164.jpeg" alt="Creating a Google Fusion Table" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">If you have never used Google Fusion Tables before, chances are, when you click on <strong class="calibre10">More</strong>, you will not see the <strong class="calibre10">Google Fusion Tables</strong> option listed. If this is the case, select the last option with the plus sign, <strong class="calibre10">Connect more apps</strong>. A pop-up window will appear with a lot of apps that you can connect to your Google Drive. You should see a view similar to the following screenshot. At the top left of this pop-up window you will see a button that by default shows the word <strong class="calibre10">All</strong>. This button lets you filter the apps into various categories. Click on it and select the second option, <strong class="calibre10">By Google</strong>, from the drop-down menu, as shown in the following screenshot:</p><div><img src="img/00165.jpeg" alt="Creating a Google Fusion Table" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Now, you will see <a id="id274" class="calibre1"/>a list of all Google-created apps as shown on the right-hand side of the preceding screenshot. Find the Google Fusion Tables app in the list and click on it. After doing so, the next time you click the red <strong class="calibre10">NEW</strong> button in <a class="calibre1" href="https://drive.google.com">https://drive.google.com</a> and select <strong class="calibre10">More</strong>, Google <strong class="calibre10">Fusion Tables</strong> will appear as an option.</p><p class="calibre9">When you create a new Fusion Table, you will be given the option to create an empty table (along with some other options). For our purpose, select <strong class="calibre10">Create empty table</strong>.</p><div><img src="img/00166.jpeg" alt="Creating a Google Fusion Table" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Next, we will make the format of the table suitable for our app. First, rename the table to give it a meaningful name. Click on the current table name, which is <strong class="calibre10">New Table</strong>, in the top left corner. This will <a id="id275" class="calibre1"/>open a <strong class="calibre10">Table information</strong> <a id="id276" class="calibre1"/>window. Give your table a descriptive name such as <code class="email">EventApp Table</code> and hit the <strong class="calibre10">Save</strong> button:</p><div><img src="img/00167.jpeg" alt="Creating a Google Fusion Table" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">We will need to make further modifications to the table before it is ready to be used as the backend of our Event app. By default, a blank row is inserted in Fusion Tables. We want our table to be completely empty. To clear out the table, select the <strong class="calibre10">Edit</strong> tab on the top left corner of the screen, below the table name. You will see a <strong class="calibre10">Delete all rows</strong> option; click on it and confirm that you want to delete all rows:</p><div><img src="img/00168.jpeg" alt="Creating a Google Fusion Table" class="calibre11"/></div><p class="calibre12"> </p><div><img src="img/00169.jpeg" alt="Creating a Google Fusion Table" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Now that we have a clean table, we need to decide what columns to use. For this Event app, we want to know who is coming (the name of the guest), how many people that person is bringing (the number of guests), and what items that guest is bringing to the party (potluck). This information is going to be used by the organizer to plan the party.</p><p class="calibre9">Each of these three pieces of information will be saved in a column on the Fusion Table. Four columns are automatically included when a Fusion Table is created. Since we only need three columns, we <a id="id277" class="calibre1"/>are going to delete one of the <a id="id278" class="calibre1"/>four default columns and modify the other three.</p><p class="calibre9">The <strong class="calibre10">Edit</strong> tab that you clicked to delete all the rows and clean up the table also contains another option called <strong class="calibre10">Change columns</strong>. We will use that options several times now to make all the changes to the columns. The default column names are <strong class="calibre10">Text</strong>, <strong class="calibre10">Number</strong>, <strong class="calibre10">Location</strong>, and <strong class="calibre10">Date</strong>. We will change them to <strong class="calibre10">Guest Names</strong>, <strong class="calibre10">NumGuests</strong>, and <strong class="calibre10">ItemsBringing</strong>.</p><p class="calibre9">To change the first column to <strong class="calibre10">Guest Names</strong>, click on the Edit tab and select the <strong class="calibre10">Change columns</strong> option and you will see the following screenshot. The first column is selected by default (the gray background on the left panel indicates it is active). Change the <strong class="calibre10">Column name</strong> to <strong class="calibre10">Guest Names</strong>. This column is already configured to save <strong class="calibre10">Text</strong> data (the <strong class="calibre10">Type</strong> option), hence we do not need to make any changes here:</p><div><img src="img/00170.jpeg" alt="Creating a Google Fusion Table" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Now that we have changed the first column, we will do the same to the second column. Select the second column (currently called <strong class="calibre10">Number</strong>). Once you click on it, the background will become gray. Now change the <strong class="calibre10">Column name</strong> to <strong class="calibre10">NumGuests</strong>. Since, this column is <a id="id279" class="calibre1"/>already configured to store numbers, we do not need to make any changes here:</p><div><img src="img/00171.jpeg" alt="Creating a Google Fusion Table" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Next, we need to rename the third column (currently called <strong class="calibre10">Location</strong>). Just like the previous examples, select that column and change the name to <strong class="calibre10">ItemsBringing</strong>. By default this column is preconfigured to store <strong class="calibre10">Location</strong> data. We actually want to store <strong class="calibre10">Text</strong> data (items that guests will bring). So we need to change the datatype. When you click on <strong class="calibre10">Location</strong> (the <strong class="calibre10">Type</strong> option), a drop-down menu will appear as shown in the following screenshot. Select the <strong class="calibre10">Text</strong> option.</p><div><img src="img/00172.jpeg" alt="Creating a Google Fusion Table" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Finally, since we <a id="id280" class="calibre1"/>need only three columns, we will delete the fourth column by hovering over the fourth column to make it active (gray) and clicking on the <strong class="calibre10">x</strong> next to it (as shown in the following screenshot) and confirming the deletion in the pop-up box:</p><div><img src="img/00173.jpeg" alt="Creating a Google Fusion Table" class="calibre11"/></div><p class="calibre12"> </p><div><img src="img/00174.jpeg" alt="Creating a Google Fusion Table" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Now that the table is ready to be used, click on the <strong class="calibre10">File</strong> tab in the upper left corner and select <strong class="calibre10">About this table</strong> from the drop-down menu.</p><div><img src="img/00175.jpeg" alt="Creating a Google Fusion Table" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Another page will open with various details of the table. Note the information given in the very last piece of <a id="id281" class="calibre1"/>information, the <strong class="calibre10">Id</strong>, as shown in the following screenshot. Double-click on the alphanumeric string to highlight it, copy/paste it in another place on your computer, such as a Notepad file or an empty document. (You may have to use your browser's copy/paste feature to do this, as keyboard shortcuts may not work. You can find copy/paste under the <strong class="calibre10">Edit</strong> menu heading at the top of your browser window.) You will use this <strong class="calibre10">Id</strong> in the App Inventor app to push/pull data to/from this table:</p><div><img src="img/00176.jpeg" alt="Creating a Google Fusion Table" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">We will make one small final change to the Fusion Table (to its <strong class="calibre10">Sharing</strong> settings) but, we are not ready to do that just yet. So keep the Fusion Table window <a id="id282" class="calibre1"/>open and start working with App Inventor in the separate browser window.</p></div></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec36" class="calibre1"/>Designing the RSVP screen</h1></div></div></div><p class="calibre9">For our app, we are <a id="id283" class="calibre1"/>asking the invited guests to provide their names, the total number of guests, and the food or drink to share at the potluck. Once a guest presses the <strong class="calibre10">Send RSVP</strong> button, something magical will happen. We will push all the data from the app to the Fusion Table that we created.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch06lvl2sec37" class="calibre1"/>Creating the GUI in the designer window</h2></div></div></div><p class="calibre9">In <a class="calibre1" title="Chapter 5. Building an Event App" href="part0033_split_000.html#VF2I1-9c0b907946184095a315b26c8a9b12bc">Chapter 5</a>, <em class="calibre19">Building an Event App</em> we <a id="id284" class="calibre1"/>created the <code class="email">RSVP_Screen</code> and now we will build the GUI (Graphical User Interface) that the guests will use. Navigate to the RSVP screen in the <strong class="calibre10">Designer</strong> window. The screen is empty except for the background pool image and the navigation buttons that we added along the bottom.</p><p class="calibre9">Since you have already gained experience adding various components in the previous chapters, we are pretty confident about your abilities. Of course, we will help specify which components to use! The guest provides three pieces of data here: the name, the number of guests, and the item to bring. We will place all the components related to these three pieces of data within a VerticalArrangement for a streamlined look. Hence, the first component to add is: <strong class="calibre10">VerticalArrangement</strong>. Drag it to the <strong class="calibre10">Viewer</strong> and set its <strong class="calibre10">Height</strong> and <strong class="calibre10">Width</strong> properties to <strong class="calibre10">Fill parent</strong>.</p><p class="calibre9">To collect the first piece of data, the name, add a <strong class="calibre10">Label</strong> and below that a <strong class="calibre10">Textbox</strong> by dragging them onto the Vertical Arrangement in the <strong class="calibre10">Viewer</strong>. Rename the <strong class="calibre10">Label</strong> to <code class="email">NameLabel</code> and change the <strong class="calibre10">BackgroundColor</strong> property to <strong class="calibre10">Dark Gray</strong>. Check the <strong class="calibre10">FontBold</strong> property and change the <strong class="calibre10">Text</strong> property to <strong class="calibre10">Name</strong>.</p><p class="calibre9">Similarly, rename the <strong class="calibre10">Textbox</strong> to <code class="email">NameTextBox</code>. Change the <strong class="calibre10">Width</strong> property to <strong class="calibre10">Fill parent</strong>. Type <strong class="calibre10">Enter your first and last name</strong> for the <strong class="calibre10">Hint</strong> property.</p><p class="calibre9">For the second piece of data, the number of guests, add a <strong class="calibre10">Label</strong> and another component called <strong class="calibre10">ListPicker</strong> (found just below the <strong class="calibre10">Label</strong> component in the <strong class="calibre10">User Interface</strong> palette). Drag the Components onto the VerticalArrangement underneath the Label and Textbox. Rename this Label to <code class="email">GuestsLabel</code>. Change the <strong class="calibre10">BackgroundColor</strong> property to <strong class="calibre10">Dark Gray</strong>, check the <strong class="calibre10">FontBold</strong> property and change the <strong class="calibre10">Text</strong> property to <strong class="calibre10">Number of guests (including you)</strong>.</p><p class="calibre9">We will use the ListPicker Component to track the number of people attending when a guest submits an RSVP. The ListPicker is a button that, when clicked, opens up a list of items from which a user can select. Rename the <strong class="calibre10">ListPicker</strong> to <code class="email">NumGuestListPicker</code>. We will make just two changes to the <strong class="calibre10">ListPicker</strong> properties. Put <code class="email">1,2,3,4,5,6,7</code> as the <strong class="calibre10">ElementsFromString</strong> property. These are the items what we want displayed when the user clicks the <strong class="calibre10">NumGuestListPicker</strong>. We are assuming the number of guests (including the person who is completing the RSVP) is in the range 1-7. You can add more or fewer guest options as you wish.</p><p class="calibre9">Just remember that the comma-separated numbers that you specify are the options that the users will be able to select from. Finally, make the <strong class="calibre10">Selection</strong> property <strong class="calibre10">1</strong>. This means that, if the user <a id="id285" class="calibre1"/>does not choose a number from the <strong class="calibre10">NumGuestListPicker</strong>, the default value of 1 will be used to count the user who sent the RSVP.</p><div><img src="img/00177.jpeg" alt="Creating the GUI in the designer window" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Finally, we will add a <strong class="calibre10">Button</strong> and rename it to <code class="email">SendRSVPButton</code>. The user will click this button to send the RSVP after completing the form. Just as we did for the labels, make the <strong class="calibre10">BackgroundColor</strong> dark gray, and insert <strong class="calibre10">Send RSVP</strong> as the <strong class="calibre10">Text</strong> property.</p><p class="calibre9">Next, drag the <strong class="calibre10">FusiontablesControl</strong> component from the <strong class="calibre10">Storage Palette</strong> drawer to the Viewer. (Notice how the <strong class="calibre10">FusiontablesControl1</strong> component drops down below the <strong class="calibre10">Viewer</strong>, because it is a non-visible component.) After you have added all the components, the <code class="email">RSVP_Screen</code> will resemble the <a id="id286" class="calibre1"/>following screenshot:</p><div><img src="img/00178.jpeg" alt="Creating the GUI in the designer window" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">This completes the GUI for the <code class="email">RSVP_Screen</code>. In professional programming lingo, this is also called creating the frontend.</p></div></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec37" class="calibre1"/>Setting up Google Authentication</h1></div></div></div><p class="calibre9">Fusion <a id="id287" class="calibre1"/>Tables is software that Google has designed. For various security- and privacy-related issues, Google only wants verified software to send/receive data to/from Fusion Tables. Hence, we need to establish our identity before our Event App can exchange data with Google Fusion Tables. In this section, we will describe how to create Google service-level authentication to establish this credential.</p><p class="calibre9">To establish the service-level authentication credentials, follow these instructions:</p><div><ol class="orderedlist"><li class="listitem" value="1">Go to <a class="calibre1" href="https://console.developers.google.com/">https://console.developers.google.com/</a> and log in with your Google account if necessary. On the <strong class="calibre10">Getting started</strong> page, click on the <strong class="calibre10">Use Google APIs</strong> button as shown in the following screenshot:<div><img src="img/00179.jpeg" alt="Setting up Google Authentication" class="calibre11"/></div><p class="calibre21"> </p><p class="calibre22">The acronym API stands for <strong class="calibre10">Application Programming Interface</strong>. To describe it in a very simple manner, an API defines  a way for computers to interact with websites (essentially for software programs to interact). Developers at companies like Twitter, Facebook, and Google create protocols for their software to enable other programs to communicate with it. In this case App Inventor will be communicating with the Google Fusion Tables API.</p></li><li class="listitem" value="2">You will <a id="id288" class="calibre1"/>be prompted to create a new project that uses APIs. Name your project <strong class="calibre10">Event App Project</strong>. Make the selections shown in the following screenshot, and click on <strong class="calibre10">Create</strong>:<div><img src="img/00180.jpeg" alt="Setting up Google Authentication" class="calibre11"/></div><p class="calibre21"> </p></li><li class="listitem" value="3">On the <a id="id289" class="calibre1"/>right-hand side, you will see a tab named <strong class="calibre10">Enabled APIs (7)</strong>, as follows. Click on that tab:<div><img src="img/00181.jpeg" alt="Setting up Google Authentication" class="calibre11"/></div><p class="calibre21"> </p><p class="calibre22">This will show you a list of APIs that are enabled by default. Since we will not use these APIs, click on the <strong class="calibre10">Disable</strong> option next to each API and disable each one of them.</p><div><img src="img/00182.jpeg" alt="Setting up Google Authentication" class="calibre11"/></div><p class="calibre21"> </p><p class="calibre22">After you have disabled all APIs, your screen will look like the following screenshot:</p><div><img src="img/00183.jpeg" alt="Setting up Google Authentication" class="calibre11"/></div><p class="calibre21"> </p></li><li class="listitem" value="4">Our next <a id="id290" class="calibre1"/>goal is to enable the one API that our app will use—the <strong class="calibre10">Fusion Tables API</strong>. To do so, look for the <strong class="calibre10">Other popular APIs</strong> column. You will find it to the bottom-right group of links (look for the blue hexagon icon), as shown in the screenshot that follows:<div><img src="img/00184.jpeg" alt="Setting up Google Authentication" class="calibre11"/></div><p class="calibre21"> </p></li><li class="listitem" value="5">Click on the <strong class="calibre10">Fusion Tables API</strong> listed in this column. And then, in the next screen, click on the blue <strong class="calibre10">Enable API</strong> button shown in the following screenshot:<div><img src="img/00185.jpeg" alt="Setting up Google Authentication" class="calibre11"/></div><p class="calibre21"> </p></li><li class="listitem" value="6">Now that <a id="id291" class="calibre1"/>we have enabled the <strong class="calibre10">Fusion Tables API</strong>, it is time to create credentials (ways for software to verify the authenticity of other software). Click on the <strong class="calibre10">Credentials</strong> option on the left vertical pane, as shown in the following screenshot:<div><img src="img/00186.jpeg" alt="Setting up Google Authentication" class="calibre11"/></div><p class="calibre21"> </p><p class="calibre22">This will result in a pop-up window with the blue <strong class="calibre10">Add credentials</strong> button, as shown in the following screenshot. Click on that button and select the last option—<strong class="calibre10">Service account</strong>.</p><div><img src="img/00187.jpeg" alt="Setting up Google Authentication" class="calibre11"/></div><p class="calibre21"> </p><p class="calibre22">In the next window, make the selections shown in the following screenshot and click on <strong class="calibre10">Create</strong>:</p><div><img src="img/00188.jpeg" alt="Setting up Google Authentication" class="calibre11"/></div><p class="calibre21"> </p><p class="calibre22">This will create the service account and download a special file onto your computer. This file has a <code class="email">.p12</code> extension. Depending on your browser's <a id="id292" class="calibre1"/>setting, you might see a window such as the following one. This window asks you where to save the file. Save the file somewhere on your hard drive and remember the location. We will upload this file in to App Inventor later on:</p><div><img src="img/00189.jpeg" alt="Setting up Google Authentication" class="calibre11"/></div><p class="calibre21"> </p><p class="calibre22">If you do not see the pop-up window like the one shown previously, in all likelihood your browser is set to download everything to the default <code class="email">Downloads</code> folder. In that case, the <code class="email">.p12</code> file will automatically be saved in that folder:</p><div><img src="img/00190.jpeg" alt="Setting up Google Authentication" class="calibre11"/></div><p class="calibre21"> </p><p class="calibre22">After this <code class="email">.p12</code> file has been downloaded to to your computer, you will see a message resembling the one shown previously. Click the <strong class="calibre10">Close</strong> button to dismiss the message.</p></li><li class="listitem" value="7">Now that we have created the credentials we are going to use, Google will automatically <a id="id293" class="calibre1"/>generate an e-mail address that goes with this credential. This email address is something we will have to specify in App Inventor as well. As shown in the following screenshot, a long and complicated email address will be displayed under the <strong class="calibre10">Service</strong> accounts. Copy this email and paste it into the document that you used to store the ID of the Fusion Table that you created earlier. Just like the ID of the Fusion Table, you will need this email address later on:<div><img src="img/00191.jpeg" alt="Setting up Google Authentication" class="calibre11"/></div><p class="calibre21"> </p></li><li class="listitem" value="8">The <strong class="calibre10">Fusion Tables API</strong> is now enabled and the credentials are established.</li></ol><div></div></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec38" class="calibre1"/>Sharing the Fusion Table with the service account email</h1></div></div></div><p class="calibre9">When <a id="id294" class="calibre1"/>you created the Fusion Table in a <a id="id295" class="calibre1"/>previous section, you used your own Google account to do so. So right now only you can access and change the Fusion Table. However, for this app to work, you need all your guests to have the ability to insert data into the Fusion Table and read from the Fusion Table.</p><p class="calibre9">The service account email that you created in the previous step will come in handy to achieve just that. That email is associated with your app and not any individual. Hence, anyone else using the app should be able to access the Fusion Table as long as that email address has proper access to the Fusion Table.</p><p class="calibre9">To enable the service level email access to the Fusion Table, go back to your Fusion Table (left open in the separate browser window/tab) and click on the blue <strong class="calibre10">Share</strong> button in the top-right corner. This will open the <strong class="calibre10">Sharing settings</strong> menu, as shown in the following screenshot.</p><p class="calibre9">Copy and paste the service email address that you saved earlier into the <strong class="calibre10">Invite people</strong> box. Make sure the button next to the box says <strong class="calibre10">Can edit</strong>, and click on <strong class="calibre10">Send</strong>.</p><div><img src="img/00192.jpeg" alt="Sharing the Fusion Table with the service account email" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">This <a id="id296" class="calibre1"/>step ensures that any user of the <a id="id297" class="calibre1"/>app (not just you) is able to insert data into or receive data from the Fusion Table.</p></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec39" class="calibre1"/>Connecting the app to the Google Fusion Table</h1></div></div></div><p class="calibre9">So far, we <a id="id298" class="calibre1"/>have created a Fusion Table and the GUI for the <code class="email">RSVP_Screen</code>, and established our Google API credentials. Now it is time to create the code for <code class="email">RSVP_Screen</code>.</p></div>

<div><div><div><div><div><h2 class="title1" id="calibre_pb_1"><a id="ch06lvl2sec38" class="calibre1"/>Our goal</h2></div></div></div><p class="calibre9">When the user clicks the <strong class="calibre10">Send RSVP</strong> button:</p><div><ol class="orderedlist"><li class="listitem" value="1">The app takes the name from the <strong class="calibre10">NameTextBox</strong>, the selection from the <strong class="calibre10">NumGuestListPicker</strong>, and the contents of the <strong class="calibre10">ItemsBringingTextBox</strong> and inserts them as a single row in the appropriate column in the Fusion Table.</li><li class="listitem" value="2">Then the app clears textboxes and reset the Listpicker selection to 1.</li></ol><div></div><p class="calibre9">We created the service-level credentials (the <code class="email">.p12</code> file and the service-level email address) so that our app is authorized to send or receive information from Google Fusion Tables. Next, we need to provide the <strong class="calibre10">FusiontablesControl</strong> component in our app with this information. We want to do this when a user opens the <code class="email">RSVP_Screen</code>.</p><p class="calibre9">As shown in the following screenshot, once in the <strong class="calibre10">RSVP_Screen</strong> in the Designer, select the <strong class="calibre10">FusionTablesControl1</strong> component under the <strong class="calibre10">Components</strong> column. This will display all the properties of <strong class="calibre10">FusiontablesControl1</strong>. Under the <strong class="calibre10">KeyFile</strong> property, click currently shows <strong class="calibre10">None</strong>. Then click on the <strong class="calibre10">Upload File</strong> button:</p><div><img src="img/00193.jpeg" alt="Our goal" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">This will open up another pop-up, which will let you select the file that you want to upload. The following screenshot shows the pop-up. Select the <code class="email">.p12</code> file that you earlier downloaded to <a id="id299" class="calibre1"/>your computer and click on the <strong class="calibre10">OK</strong> button:</p><div><img src="img/00194.jpeg" alt="Our goal" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Next, copy the service-level email address that you have saved in a document and paste it into the <strong class="calibre10">ServieAccountEmail</strong> property.</p><p class="calibre9">Finally, check the <strong class="calibre10">UserServiceAuthentication</strong> checkbox.</p><div><img src="img/00195.jpeg" alt="Our goal" class="calibre11"/></div><p class="calibre12"> </p></div></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec40" class="calibre1"/>Pushing data to the Fusion Table</h1></div></div></div><p class="calibre9">When using multiple screens, you want to keep your blocks organized according to screen in the Blocks editor. Since we are getting ready to program blocks for the RSVP_Screen, we need to make sure we are on the RSVP_Screen in the Blocks editor.</p><p class="calibre9">To check this, look at the first of three buttons in the green menu bar next to the EventApp name. If you just finished working on the RSVP_Screen in the Designer and switched over to the Blocks editor, you will be on RSVP_Screen. But if not, you can easily navigate to RSVP_Screen by clicking the button that displays another screen name (Screen1 as shown in the following screenshot) and choosing RSVP_ Screen from the drop-down menu:</p><div><img src="img/00196.jpeg" alt="Pushing data to the Fusion Table" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">When the <a id="id300" class="calibre1"/>user clicks the <strong class="calibre10">Send RSVP</strong> button, we want to <a id="id301" class="calibre1"/>insert all three pieces of data into the Fusion Table. The following screenshot shows the block to achieve just this. This might look intimidating, but is actually quite simple:</p><div><img src="img/00197.jpeg" alt="Pushing data to the Fusion Table" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Since we want our app to react to the <strong class="calibre10">Send RSVP</strong> button click, we will of course need to get a <strong class="calibre10">SendRSVPButton.Click</strong> event. As you might have already guessed, you will find this event block in the Blocks Palette in the <strong class="calibre10">SendRSVPButton</strong> Blocks drawer.</p><p class="calibre9">The purple <a id="id302" class="calibre1"/>
<strong class="calibre10">call FusiontablesControl1.InsertRow</strong> block <a id="id303" class="calibre1"/>enables an app to insert a row into a Fusion Table. In the <strong class="calibre10">Fusiontables1</strong> Blocks drawer, select and place the <strong class="calibre10">FusiontablesControl1.InsertRow</strong> block within the <strong class="calibre10">SendRSVPButton.Click</strong> event.</p><p class="calibre9">As you can see, the <strong class="calibre10">InsertRow</strong> block has three empty sockets. The first socket is the <strong class="calibre10">Id</strong> of the table that you want to use. Recall that we found the <strong class="calibre10">Id</strong> of our table during the last step when creating the table. Copy and paste that <strong class="calibre10">Id</strong> here within an empty <strong class="calibre10">Text</strong> block.</p><p class="calibre9">In the second socket of the <strong class="calibre10">InsertRow</strong> block, we will specify the column names. When inserting a row with multiple pieces (columns) of data into a Fusion Table, we need to specify which columns those pieces of data fit into. Recall that we named our columns <strong class="calibre10">Guest Names</strong>, <strong class="calibre10">NumGuests</strong>, and <strong class="calibre10">ItemsBringing</strong>. In a blank <strong class="calibre10">Text</strong> block, enter the column names within single-quotes, separated by commas, as shown in the following screenshot (note there are no spaces):</p><div><img src="img/00198.jpeg" alt="Pushing data to the Fusion Table" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">The third and final piece of information that the <strong class="calibre10">InsertRow</strong> block needs is the actual values to insert into the Fusion Table. Just like the column names, we will be entering multiple pieces of data into a single row in the Fusion Table. As with the columns, these three pieces of data must be entered within single quotes and separated by commas but we will insert them a little differently. To create one single-quoted, comma-separated text from three pieces of information that a guest will enters in the three separate fields in the <strong class="calibre10">RSVP_Screen</strong>, we will use a <strong class="calibre10">join</strong> block, From the built-in <strong class="calibre10">Text </strong>Block drawer, drag and connect the <strong class="calibre10">join</strong> block to the values socket of <strong class="calibre10">InsertRow</strong>.</p><p class="calibre9">We will need to join 11 things—three pieces of information, six single quotes (one before and one <a id="id304" class="calibre1"/>after each piece of information), and two commas to separate the three pieces of single-quoted information. By default, the <strong class="calibre10">join</strong> block joins <a id="id305" class="calibre1"/>two things. So we need to make room for nine more items. Click on the blue button on the top left corner of the <strong class="calibre10">join</strong> block, and drag the string block on the left of the pop-up into the join block on the right of the pop-up, shown as follows. This will create more sockets in the <strong class="calibre10">join</strong> block. Do this nine times:</p><div><img src="img/00199.jpeg" alt="Pushing data to the Fusion Table" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">The first, third, fifth, seventh, ninth, and eleventh <strong class="calibre10">join</strong> sockets will contain a single quote, entered into a Text box. The fourth and eight sockets will contain a comma entered into a Text box. In the second socket, the app will get the first set of information that a user enters: their first and last name. So, we need a block that allows the user to enter a name. You will find it in the <strong class="calibre10">NameTextBox</strong> blocks. Select and connect the light green <strong class="calibre10">NameTextBox.Text</strong> block into the second join socket.</p><p class="calibre9">The sixth socket will get the number of guests that the user selected from the list picker. In the <strong class="calibre10">NumGuestListPicker</strong> blocks, select and connect the light-green <strong class="calibre10">NumGuestListPicker.Selection</strong> block. And in the tenth socket, the app will get the information about which food/drink item the user inputted. In the <strong class="calibre10">ItemsBringingTextBox</strong> blocks, select and connect the light green <strong class="calibre10">ItemsBringingTextBox.Text</strong> block.</p><p class="calibre9">Again, recall the first goal that we specified in this section: take the three pieces of information that a guest provides and insert them in the Fusion Table. The three pieces of data come from the <strong class="calibre10">NameTextBox</strong> text property, the <strong class="calibre10">NumGuestListPicker</strong> selection property, and the <strong class="calibre10">ItemsBringingTextBox</strong> text property. This step was a complicated one, but it is very important to get this set of blocks right because, if not, no data will be inserted into the Fusion Table.</p><p class="calibre9">Now that we are done with the <strong class="calibre10">InsertRow</strong> block, all that is left is to clear out the textboxes and <a id="id306" class="calibre1"/>revert the <strong class="calibre10">ListPicker</strong> selection to the default value of <code class="email">1</code>. Since blocks are executed from top to bottom and we want to clear out the Textboxes and reset the ListPicker after the app sends the information to the Fusion Table, insert the next set of blocks after the InsertRow block. Find the <strong class="calibre10">set NameTextBox.Text to</strong>, <strong class="calibre10">set ItemsBringingTextBox.Text to</strong>, and <strong class="calibre10">set NumGuestListPicker.Selection</strong> blocks and insert them into the bottom of the <strong class="calibre10">when SendRSVPButton.Click</strong> block. The first two blocks—<strong class="calibre10">set NameTextBox.Text to</strong> and <strong class="calibre10">set ItemsBringingTextBox.Text to</strong>—get blank Text blocks. Setting the textboxes to empty strings will clear out the previous data. Since we want the <strong class="calibre10">set NumGuestListPicker.Selection</strong> to reset the default selection property of the <strong class="calibre10">NumGuestListPicker</strong> to <code class="email">1</code>, attach a <strong class="calibre10">Math 0</strong> block and change the number to <strong class="calibre10">1</strong>. Lastly, we will call a procedure to make sure any keyboard that might have popped-up when the guest was typing in information gets hidden. Find the call <strong class="calibre10">NameTextBox.HideKeyboard</strong> block in the <strong class="calibre10">NameTextBox</strong> blocks. Connect it at the very bottom of the blocks.</p></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec41" class="calibre1"/>Ensuring empty rows are not inserted</h1></div></div></div><p class="calibre9">Right now, the <a id="id307" class="calibre1"/>
<strong class="calibre10">InsertRow</strong> does not have any way to tell if the data that it is inserting is valid or not. For example, the user might click on the <strong class="calibre10">SendRSVPButton</strong> by mistake and that will insert a blank row. We can fix this by checking to make sure that the guest has typed in at least the name before we insert anything.</p><p class="calibre9">To achieve this, we can place all the blocks that we created within an if /then statement. The condition that we will check for is whether the NameTextBox. Text is empty or not. If the NameTextBox.Text is not empty, then that means the guest must have typed something and we will allow the insertion to happen. "If the NameTextBox.Text is empty, then the if statement is not true, and the then set of blocks will not fire. As a result, nothing will happen. The following screenshot shows the blocks for the if statement:</p><div><img src="img/00200.jpeg" alt="Ensuring empty rows are not inserted" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">You can find the lime-green (unequal) block in the <strong class="calibre10">Build In Logic </strong>Block drawer. The block will appear <a id="id308" class="calibre1"/>with an equals sign, as follows:</p><div><img src="img/00201.jpeg" alt="Ensuring empty rows are not inserted" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Click on the arrow and select the unequal option from the drop down menu. In the first blank, insert the <strong class="calibre10">NameTextBox.Text</strong> block and, in the second blank, insert a blank <strong class="calibre10">Text</strong> block. Now our code indicates that, <strong class="calibre10">if</strong> the name field is not blank, <strong class="calibre10">then</strong> it should get the data and insert it into the Fusion Table.</p></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec42" class="calibre1"/>Viewing the guest list</h1></div></div></div><p class="calibre9">Now that we <a id="id309" class="calibre1"/>have implemented the <strong class="calibre10">RSVP_Screen</strong>, we have a way for guests to send RSVPs and aggregate all the RSVPs from different guests into the Fusion Table. In any event organization app, it is helpful for others to be able to see a list of guests who have already RSVP'ed.</p><p class="calibre9">The purpose of the <a id="id310" class="calibre1"/>GuestList_Screen is just that—enabling all attendees (and the organizer) to see who else is coming to the event. To display information gathered in the Fusion Table, we will use a Label. In the Designer window, navigate to the <strong class="calibre10">GuestList_Screen</strong>. Just like in the RSVP_Screen, first drag a <strong class="calibre10">VerticalArragment</strong> to the top portion of the <strong class="calibre10">GuestList_Screen</strong>, above the <strong class="calibre10">HorizontalArrangement</strong>, which contains all the navigation buttons. Make the <strong class="calibre10">BackgroundColor</strong> property in <strong class="calibre10">VerticalArrangement</strong> to <strong class="calibre10">None</strong>. Also set both the <strong class="calibre10">Height </strong>and<strong class="calibre10"> Width</strong> properties to <strong class="calibre10">Fill parent</strong>. Now drag a <strong class="calibre10">Label</strong> component into the <strong class="calibre10">VerticalArrangement</strong>. Rename the Label <code class="email">GuestListLabel</code>. Change the <strong class="calibre10">BackgroundColor</strong> property of <strong class="calibre10">GuestListLabel</strong> to <strong class="calibre10">None</strong>. Change the <strong class="calibre10">FontSize</strong> property to <strong class="calibre10">18</strong> (you might have to try various values for this property depending on your device's screen size and screen resolution). Finally, change the <strong class="calibre10">TextColor</strong> property to <strong class="calibre10">White</strong>. Then add a <strong class="calibre10">FusiontablesControl</strong> component just like you did in the <strong class="calibre10">RSVP_Screen</strong>. You can view the changes in the following screenshot:</p><div><img src="img/00202.jpeg" alt="Viewing the guest list" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Just like in the <strong class="calibre10">RSVP_Screen</strong>. We will change the three properties of the <strong class="calibre10">FusiontablesConrol1</strong> component. Since you already know how to change the three <strong class="calibre10">FusiontablesControl1</strong> properties—<strong class="calibre10">KeyFile</strong>, <strong class="calibre10">ServiceAccountEmail</strong>, and <strong class="calibre10">UseServiceAuthentication</strong>—we will not go into the details here. Just follow the steps that we completed in the <em class="calibre19">Connecting the app to the Google Fusion Table</em> section.</p><p class="calibre9">Whereas in the RSVP_Screen, the app sends information to the Fusion Table, in the GuestList_Screen, the app is requests information from the Fusion Table, receives it and then displays it. To program this, head to the <strong class="calibre10">Blocks</strong> editor.</p></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec43" class="calibre1"/>Coding the blocks – requesting data</h1></div></div></div><p class="calibre9">The first code that we need to program is to request data from the Fusion <a id="id311" class="calibre1"/>Table. Click on <a id="id312" class="calibre1"/>
<strong class="calibre10">GuestList_Screen</strong> in the Blocks drawer and drag the <strong class="calibre10">when GuestList_Screen.Initialize</strong> event. This event is automatically triggered whenever a screen is launched. We want to request data from the Fusion Table when the <strong class="calibre10">GuestList</strong> screen is launched. Thus, we will add to this event is the <strong class="calibre10">call FusiontablesControl1.GetRows</strong> block. This block will let us request data from the Fusion Table. You can find this block in the <strong class="calibre10">FusiontablesControl1</strong> blocks drawer. The <strong class="calibre10">GetRows</strong> block needs two pieces of information to fetch rows from Fusion Tables: the ID of the table and name of the column. We identified the table ID when we were creating the Fusion Table. Paste that ID into the <strong class="calibre10">tableId</strong> socket of the <strong class="calibre10">GetRows</strong> block using a <strong class="calibre10">Text</strong> block. Use another <strong class="calibre10">Text</strong> block to specify the column name, <strong class="calibre10">'Guest Names'</strong>. Note the single quotes; just like in the <strong class="calibre10">InsertRows</strong> block, the column names have to be single-quoted here as well. The following screenshot shows the completed set of blocks:</p><div><img src="img/00203.jpeg" alt="Coding the blocks – requesting data" class="calibre11"/></div><p class="calibre12"> </p></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec44" class="calibre1"/>Coding the blocks – receiving data</h1></div></div></div><p class="calibre9">The <a id="id313" class="calibre1"/>previous blocks request in data from the Fusion Table, <a id="id314" class="calibre1"/>now we need to code receiving the information from the Fusion Table. The <strong class="calibre10">when FusiontablesControl1.GotResult</strong> block does this. You will find it in the <strong class="calibre10">FusiontablesControl1</strong> blocks. As we mentioned before, when data from Fusion Tables is received, this event gets triggered. The data is placed in the <strong class="calibre10">result</strong> variable of this event.</p><p class="calibre9">By default, the data we receive from the Fusion Table is a block of text with each row placed on its own line. This <a id="id315" class="calibre1"/>data also includes the column header. So, let's say the Guest Names column of our Fusion Table has three rows with the names Olivienne, Dash, and Eva. Then the data that is placed in the result variable has four lines—Guest Names, Olivienne, Dash, and Eva (the column header followed by the three names).</p><p class="calibre9">Since we want the <strong class="calibre10">when FusiontablesControl1.GotResult</strong> event to automatically display the guest names (and the header), select and connect the <strong class="calibre10">set GuestListLabel.Text to</strong> block. What do we want it to display? The <strong class="calibre10">result</strong> variable. Hover your cursor over the light orange <strong class="calibre10">result</strong> variable embedded in the gold event block. A pop-up with two orange blocks will appear, as shown in the following screenshot. Select the <strong class="calibre10">get result</strong> block and attach it to the open socket in the <strong class="calibre10">GuestListLabel.Text</strong> block:</p><div><img src="img/00204.jpeg" alt="Coding the blocks – receiving data" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">That's it! Now your <strong class="calibre10">GuestList_Screen</strong> will display all the guests who have RSVP'ed. The following screenshot shows the completed sets of blocks:</p><div><img src="img/00205.jpeg" alt="Coding the blocks – receiving data" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">It is time to try your app! Fill out the RSVP form to see if it populates into your Fusion Table. Does the app then clear the RSVP screen fields and display the names in the <strong class="calibre10">Guest List</strong> screen?</p><p class="calibre9">If you recall, we set up our app to gather other data from the RSVP besides the list of guest names. We <a id="id316" class="calibre1"/>created fields so guests could input the number of <a id="id317" class="calibre1"/>people they are bringing and the food/drink item to share. You could also display this information for other guests to see, but really that data is for the host, who can easily view it along with the names in the Fusion Table columns we created.</p></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec45" class="calibre1"/>Sharing the Event App</h1></div></div></div><p class="calibre9">With the Event App, we wanted to introduce you to the process of collecting and retrieving data. Now that you are approaching apps from more of a developer’s perspective, you will probably be aware that every time you enter your email address or other information into an app, that data is getting stored into a database. But, as we mentioned at the beginning of this chapter, Fusion Tables as a database has its limitations. If you were to share the Event App as it is with multiple event organizers, who start using it on different devices, there will be a problem because the app uses a single Fusion Table as the back end. If many people use the app for their different events, all of the data from all the different devices will be aggregated in to one single Fusion Table. Of course this will create mass confusion for the event organizers (and guests) as all of the data for different parties will be all mixed up!</p><p class="calibre9">Before we outline a possible fix to this problem, lets discuss what we did in this app. Since our app accesses and modifies the Fusion Table, we had to create Google service level authentication. This step ensures that our app is authorized by Google to access Fusion Tables. Then, we inserted the Fusion Table Id into our app to let the app know which Fusion Table to access. Additionally, we created a service email address for our app and shared the Fusion Table with this service email address. These steps ensure that the Fusion Table allows our app to read/write data. So we basically had three different entities interacting with each other - Google service level authentication, our app, and the Fusion Table.</p><p class="calibre9">One way to address the problem of the single Fusion Table associated with the Event App is for the developer to create different copies of the app that uses different copies of a Fusion Table. This means that each copy of the app will have to be updated with the Id of the new copy of the Fusion Table. Additionally, this also means the Fusion Table will have to be re-shared with the app's service level email (using the original service email address).</p><p class="calibre9">It is easier than it sounds. First, open the Fusion Table that you used previously, go to the File menu and select, Make a copy. This will create a new copy of the original Fusion Table with all of the changes we made to the columns and settings. If your previous Fusion Table had any data in it, you will need to clear the data. Next, repeat the Fusion Table Id identification step outlined in the last few paragraphs of Creating a Google Fusion Table section. (Since you are creating a new Fusion Table, you will have to use the Id of this new table.) You will also have to repeat the Sharing the Fusion Table with the service account email section for this new Fusion Table (using the original service email address).</p><p class="calibre9">Lastly, in Blocks editor, paste the new Fusion Table Id into the Text box (attached to the TableID slot of the call FusiontablesControl1.InsertRow block) to ensure that the app uses the new Fusion Table.</p><div><h3 class="title2"><a id="note09" class="calibre1"/>Note</h3><p class="calibre9">If you want to share your Event App with 7 people, you will need to repeat these steps 7 times, so that each person has a unique version of the app with a unique Fusion Table.</p></div></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec46" class="calibre1"/>Summary</h1></div></div></div><p class="calibre9">In this chapter we explored a lot of App Inventor advanced features, namely a database. Google Fusion Tables makes it possible for us to store data in the backend. We learned how to create a new Fusion Table and how to establish Google API credentials so that our app is authorized to access Google Fusion Tables. Finally we learned how to insert, retrieve, and display data from the Fusion Tables.</p><p class="calibre9">You are amassing quite a programming toolkit! And in the next chapter, you will learn yet another tool to help expand your coding skills. A loop is a structure or sequence of instructions that enables you to iterate or repeat steps until certain conditions are met. This is handy because, instead of copying and pasting blocks to perform the same function for each item in a long list, we can program one set of blocks to execute repeatedly.</p></div></body></html>