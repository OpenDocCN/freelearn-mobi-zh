<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Handling Multiple Devices and Networking your Apps</h1></div></div></div><div><blockquote class="blockquote"><p>Allowing your application to integrate with social networks is a great way to promote your finished product. Many games enable the player to upload their high scores and share them among other users playing the same title. Some provide challenges that need to be completed successfully in order to unlock achievements. Social networks enhance the gaming experience and provide great exposure for the developer.</p></blockquote></div><div><blockquote class="blockquote"><p>We'll also go into more detail about build configuration since we're getting more accustomed to programming. Understanding the importance of configuring your device builds is mandatory for cross-platform development. This is a capability that Corona SDK can handle with ease across iOS and Android devices.</p></blockquote></div><p>In this chapter, we will learn the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Revisiting configuration settings</li><li class="listitem" style="list-style-type: disc">Posting messages to Twitter</li><li class="listitem" style="list-style-type: disc">Posting messages to Facebook</li><li class="listitem" style="list-style-type: disc">Adding achievements and leaderboards with OpenFeint</li></ul></div><p>Let's add in these finishing touches!</p><div><div><div><div><h1 class="title"><a id="ch09lvl1sec01"/>Return to configuration</h1></div></div></div><p>Build settings and runtime configuration were briefly discussed in<a class="link" href="ch02.html" title="Chapter 2. Lua Crash Course and the Corona Framework"> Chapter 2</a>,<em> Lua Crash Course and the Corona Framework</em>. Let's get into more specific details on handling a variety of devices on the iOS and Android platform.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec01"/>Build configuration</h2></div></div></div><p>There are a variety of ways to handle device orientation to match the settings your game design requires.<a id="id597" class="indexterm"/>
</p><div><div><div><div><h3 class="title"><a id="ch09lvl3sec01"/>Orientation support (iOS)</h3></div></div></div><p>There are scenarios in which you want the native UI elements to autorotate, or to be oriented in a certain way, but you also want to maintain a fixed coordinate system within Corona.<a id="id598" class="indexterm"/>
</p><p>To lock Corona's orientation while allowing native iPhone UI elements to rotate, add a content parameter in <code class="literal">build.settings</code> as follows:</p><div><pre class="programlisting">settings =
{
orientation =
{
<strong>default = "portrait",
content = "portrait",</strong>
supported =
{
"landscapeLeft", "landscapeRight", "portrait", "portraitUpsideDown",
},
},
}
</pre></div><p>To lock Corona's internal coordinate system to portrait orientation while locking iPhone UI elements to landscape orientation, you could do the following in <code class="literal">build.settings:</code>
</p><div><pre class="programlisting">settings =
{
orientation =
{
<strong>default ="landscapeRight",
content = "portrait",</strong>
supported =
{
"landscapeRight", "landscapeLeft",
},
},
}
</pre></div></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec02"/>Orientation support (Android)</h3></div></div></div><p>The Android platform supports two orientations: <code class="literal">portrait</code> and <code class="literal">landscapeRight</code>. The orientations<em> landscapeLeft</em> and<em> portraitUpsideDown</em> have no effect on Android. Also, autorotation is not currently supported on Android. The default orientation doesn't affect Android devices. The orientation is initialized to the actual orientation of the device (unless only one orientation is specified).<a id="id599" class="indexterm"/>
</p><p>Here is an example of an Android-specific <code class="literal">build.settings</code> file (you may also combine Android and iPhone settings in the same file):</p><div><pre class="programlisting">settings =
{
android =
{
versionCode = "2",
versionName = "2.0"
},
androidPermissions =
{
"android.permission.INTERNET"
},
orientation =
{
default = "portrait"
},
}
</pre></div></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec03"/>Version code and version name (Android)</h3></div></div></div><p>The <code class="literal">versionCode</code> and <code class="literal">versionName</code> can be set within an optional<code class="literal">"android"</code> table in <code class="literal">build.settings</code>.<a id="id600" class="indexterm"/>
</p><p>The <code class="literal">versionCode</code> field is defaulted to<code class="literal">"1"</code>, while the <code class="literal">versionName</code> field is defaulted at<code class="literal">"1.0"</code> if it's not set in the <code class="literal">build.settings</code> file. When an updated version of an application is submitted to the Google Play Store, the <code class="literal">versionCode</code> and <code class="literal">versionName</code> also have to be updated. All version numbers for <code class="literal">versionCode</code> have to be whole numbers. The <code class="literal">versionCode</code> cannot contain any decimal numbers. The <code class="literal">versionName</code> can contain decimals.</p><p>For more information, see<em> android:versionCode</em> and<em> android:versionName:</em><code class="literal">http://developer.android.com/guide/topics/manifest/manifest-element.html#vcode.</code>
</p><div><h3 class="title"><a id="note28"/>Note</h3><p>The <code class="literal">versionCode</code> is an internal number used to distinguish application releases for the Google Play Store. It is not the same as the version provided by the Corona build dialog. The <code class="literal">versionName</code> is the version number shown to users.</p></div></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec04"/>Application permissions (Android)</h3></div></div></div><p>An optional<code class="literal">"androidPermissions"</code> table can be used to specify permissions, using string values as given in the<em> Android Manifest Reference:</em>
<a class="ulink" href="http://developer.android.com/reference/android/Manifest.permission.html">http://developer.android.com/reference/android/Manifest.permission.html</a>.
<a id="id601" class="indexterm"/>
</p><p>Developers should use permissions that match their application requirements. For example, if network access is required, the Internet permission needs to be set.</p></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec02"/>Content scaling on an easier level</h2></div></div></div><p>Content scaling throughout multiple devices can be frustrating at times if you've never addressed them before. While the iPhone and iPhone 4 are easy to scale across evenly, it takes some other individual sizes to manipulate screen sizes with the iPad, which is at 768 x 1024. The Droid is 480 x 854 and Samsung Galaxy tablet is 600 x 1024 just to name a few.<a id="id602" class="indexterm"/>
</p><p>When setting up your <code class="literal">config.lua</code> like we've done in the previous chapters, we had our content set to <code class="literal">width = 320, height = 480</code>, and <code class="literal">scale = "letterbox"</code>. If building for Android devices,<code class="literal">"zoomStretch"</code> works best to accommodate varying screen sizes on the platform. This helps to build between iOS/Android devices together and present display images that are large enough to fit on a variety of screen sizes.</p><p>If you want to scale for larger screen sizes and then scale down, use the screen size of the iPad. Your <code class="literal">config.lua</code> would look similar to the following code:</p><div><pre class="programlisting">application =
{
content =
{
width = 768,
height = 1024,
scale = "letterbox"
}
}
</pre></div><p>While the preceding example is another solution to scale content, it's important to remember the limitations in texture memory involved with larger (high resolution) images. While devices such as the iPad, iPhone 4, and the Samsung Galaxy tablet will handle this just fine, the iPhone 3GS and older devices will have far less texture memory available to handle large graphics.</p><p>A way to resolve this potential problem is to use<em> Dynamic Image Resolution</em> to substitute assets that are better suited for low-end devices and high-end devices. We will discuss this topic in more detail later in this section.<a id="id603" class="indexterm"/>
</p><div><div><div><div><h3 class="title"><a id="ch09lvl3sec05"/>The best of both worlds</h3></div></div></div><p>As you may have noticed, some of the background images we used in our sample apps are scaled at 380 x 570. This happens to be the size that fills the entire screen on all common devices for both iOS and Android. And better yet, it is a middle ground for compensating for higher- and lower-resolution images on any device.<a id="id604" class="indexterm"/>
</p><p>In order for your content to be displayed as evenly as possible, the following must be set up accordingly:</p><p>Settings for the <code class="literal">config.lua</code> are as follows:<a id="id605" class="indexterm"/>
</p><div><pre class="programlisting">application =
{
content =
{
width = 320,
height = 480,
scale = "letterbox"
}
}
</pre></div><p>In any file that contains any of your display images, a typical background would be displayed as follows:</p><div><pre class="programlisting">local backgroundImage = display.newImage( "bg.png", true )
backgroundImage.x = display.contentWidth / 2
backgroundImage.y = display.contentHeight / 2
</pre></div><p>Any content with a size of 320 x 480 is considered the focus area. Anything outside of the area is cropped, but will fill the screen with content on any device.</p></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec03"/>The deeper meaning of dynamic image resolutions</h2></div></div></div><p>We know we can swap base images<code class="literal">"image.png"</code> used for iOS devices (3GS and lower) and double-resolution images<code class="literal">"image@2x.png"</code> (for the iPhone 4 which has retina display). This only occurs since Apple devices can tell when the screen size is twice the resolution size of the original content.</p><p>A naming scheme is available for use to handle devices such as the iPad and Android handsets. Knowing how to handle the scaling of assets affected for the device proposed is half the battle. We'll have to define what resolution scale needs to be addressed for Corona to access the assets they're directed towards.</p><p>By using the line: <code class="literal">display.newImageRect( [parentGroup,] filename [, baseDirectory] w, h )</code> will call out your dynamic resolution images.</p><p>Typically, we've used <code class="literal">["@2x"] = 2</code> to call out the higher resolution image when available in our project for iOS devices:</p><div><pre class="programlisting">application =
{
content =
{
width = 320,
height = 480,
scale = "letterbox",
imageSuffix =
{
["@2x"] = 2,
},
},
}
</pre></div><p>The preceding example will only work for iPhone 4 and iPad since it surpasses the base size of 320 x 480 on both devices. If we wanted to make it accessible to the Droid, the scale threshold would be 1.5. For an Android tablet to work, such as the Samsung Galaxy tablet, the scale threshold is 1.875. So how do we figure out these numbers? Simple. Take the width of the higher-end device and divide it by 320 (the base size). For example:</p><p>The Droid dimensions are 480 x 854. Divide 480 by 320 and it equals 1.5.</p><p>The Samsung Galaxy tablet dimensions are 600 x 1024. Divide 600 by 320 and it equals 1.875.</p><p>If trying to manage both iOS and Android devices in the same project, you can change your <code class="literal">imageSuffix</code> in the <code class="literal">config.lua</code> as follows:</p><div><pre class="programlisting">imageSuffix =
{
<strong>["@2x"] = 1.5, -- this will handle most Android devices such as the Droid, Nexus, Galaxy Tablet, etc...</strong>
}
</pre></div><p>-- or</p><div><pre class="programlisting">imageSuffix =
{
<strong>["@2x"] = 1.8, -- this will handle the Galaxy Tablet and similar sized devices</strong>
}
</pre></div><p>Using either of the preceding examples will trigger the proposed Android devices to display the higher resolution image.</p><p>The <code class="literal">imageSuffix</code> doesn't necessarily have to be<code class="literal">"@2x"</code>, it can be anything like<code class="literal">"@2", "_lrg"</code>, or even<code class="literal">"-2x"</code>. As long as your higher-resolution image has the intended suffix after the primary image name, it'll work just fine.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec04"/>High-resolution sprite sheets</h2></div></div></div><p>High-resolution sprite sheets are not handled the same way as dynamic image resolutions. While you can continue using the same naming convention to differentiate your high-resolution images from your basic images, the image will not be able to use <code class="literal">display.newImageRect()when</code> referring to sprite sheets.<a id="id606" class="indexterm"/>
</p><p>If your current content scale is <code class="literal">width = 320, height = 480</code>, and <code class="literal">scale = "letterbox"</code> in your <code class="literal">config.lua</code> file, then the scale output for the following devices will demonstrate the following:<a id="id607" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">iPhone = 1</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">iPhone 4 = 0.5</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">Droid = 0.666666668653488</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">iPad = 0.46875</code></li></ul></div><p>Applying a basic sprite sheet that matches the scale for an iPhone will display sharp and clean images. When the same sprite sheet is applied to the iPhone 4, the display will match the content scale of the device, but the sprite sheet will look slightly pixilated and blurry around the edges. Using <code class="literal">display.contentScaleX</code> and calling some methods will solve that problem for you. Notice that <code class="literal">displayScale &lt; 1</code> will access the high-resolution sprite sheet based on the preceding device scale.</p><div><pre class="programlisting">local spriteSheet
local myObject
<strong>local displayScale = display.contentScaleX - scales sprite sheets down
if displayScale &lt; 1 then - pertains to all high-res devices
</strong>
spriteSheet = sprite.newSpriteSheet( "mySprite@2x.png", 512, 512 )
else
spriteSheet = sprite.newSpriteSheet( "mySprite.png", 256, 256 )
end
local spriteSet = sprite.newSpriteSet(spriteSheet, 1, 4)
sprite.add( spriteSet, "walk", 1, 4, 300, 0 ) -- play 4 frames every 300 ms
myObject = sprite.newSprite( spriteSet )
<strong>if displayScale &lt; 1 then --scale the high-res sprite sheet if you're on a high-res device.
</strong>
myObject.xScale = .5; myObject.yScale = .5
end
myObject.x = display.contentWidth / 2
myObject.y = display.contentHeight / 2
myObject.x = 150; myObject.y = 195
myObject:prepare("walk")
myObject:play()
</pre></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec02"/>Networking your apps</h1></div></div></div><p>When you have completed developing your main game framework, it's good to think about how to network it if you decide to do so.<a id="id609" class="indexterm"/>
</p><p>We all have used some kind of networking tool during some point in our lives, such as Twitter and Facebook. Maybe you currently use these applications, but the point is you've read updates from other users about a new game that came out or someone is spreading the word to download a game and compete with them. You can be that developer and develop the game they're talking about!</p><p>Incorporating networking mechanisms in your game does not have to be a hassle. It only takes several lines of code to get it working.</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec05"/>Posting to Twitter</h2></div></div></div><p>Tweet, tweet, tweet... Twitter is a networking tool that connects you to the latest information that appeals to your interests. It is also a great tool to share information with others about your business and of course your game. Reach out to the game development audience by promoting your application.<a id="id610" class="indexterm"/>
</p><p>In order for posting on Twitter to work, you need to create a Twitter account at:<a class="ulink" href="http://twitter.com/"> http://twitter.com/</a> and make sure that you're logged in.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec03"/>Time for action—adding Twitter in your apps</h1></div></div></div><p>We're going to implement Twitter in our apps by accessing a web service through UI buttons.<a id="id611" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">In the <code class="literal">Chapter 9</code> folder, copy the <code class="literal">Twitter Web Pop-Up</code> project folder to your desktop. All the configuration, libraries, and assets needed are already included. You can download the project files accompanying this book from the Packt website.</li><li class="listitem">Create a new <code class="literal">main.lua</code> file and save it to the project folder.</li><li class="listitem">Set the following variables at the beginning of the code:<div><pre class="programlisting">display.setStatusBar( display.HiddenStatusBar )
local ui = require("ui")
local openBtn
local closeBtn
local score = 100
</pre></div></li><li class="listitem">Create a local function called <code class="literal">onOpenTouch()</code> with an event parameter. Add in an <code class="literal">if</code> statement so the event receives a<code class="literal">"release"</code> action.<div><pre class="programlisting">local onOpenTouch = function( event )
if event.phase == "release" then
</pre></div></li><li class="listitem">Using the local variable called <code class="literal">message</code>, add in the following string statement and concatenate <code class="literal">score</code>.<div><pre class="programlisting">local message = "Posting to Twitter from Corona SDK and got a final score of " ..score.. "."
</pre></div></li><li class="listitem">Add in <code class="literal">local myString</code> and apply a <code class="literal">string.gsub()</code> for <code class="literal">message</code> to replace space instances.<div><pre class="programlisting">local myString = string.gsub(message, "( )", "%%20")
</pre></div></li><li class="listitem">Introduce the <code class="literal">native.showWebPopup()</code> function that links to the Twitter account. Concatenate <code class="literal">myString</code> to include the pre-loaded message. Close the function.<div><pre class="programlisting">native.showWebPopup(0, 0, 320, 300, "http://twitter.com/intent/tweet?text="..myString)
end
end
</pre></div></li><li class="listitem">Set up the <code class="literal">openBtn</code> UI function.<div><pre class="programlisting">openBtn = ui.newButton{
defaultSrc = "openbtn.png",
defaultX = 90,
defaultY = 90,
overSrc = "openbtn-over.png",
overX = 90,
overY = 90,
onEvent = onOpenTouch,
}
openBtn.x = 110; openBtn.y = 350
</pre></div></li><li class="listitem">Create a local function called <code class="literal">onCloseTouch()</code> with an <code class="literal">event</code> parameter. Add an <code class="literal">if</code> statement with <code class="literal">event.phase == "release"</code> to activate <code class="literal">native.cancelWebPopup()</code>.<a id="id612" class="indexterm"/><div><pre class="programlisting">local onCloseTouch = function( event )
if event.phase == "release" then
native.cancelWebPopup()
end
end
</pre></div></li><li class="listitem">Set up the <code class="literal">closeBtn</code> UI function.<div><pre class="programlisting">closeBtn = ui.newButton{
defaultSrc = "closebtn.png",
defaultX = 90,
defaultY = 90,
overSrc = "closebtn-over.png",
overX = 90,
overY = 90,
onEvent = onCloseTouch,
}
closeBtn.x = 210; closeBtn.y = 350
</pre></div></li><li class="listitem">Save the file and run the project in the simulator. Make sure you're connected to the Internet to see the results.<div><h3 class="title"><a id="note21"/>Note</h3><p>If you're currently not logged in to your Twitter account, you'll be asked to log in before you see the results of the tweet from our code.</p></div><div><img src="img/1888_09_01.jpg" alt="Time for action—adding Twitter in your apps"/></div></li></ol></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec06"/>What just happened?</h2></div></div></div><p>Near the top of the code we set a variable, <code class="literal">local score = 100</code>. This will be used in our Twitter message.</p><p>In the <code class="literal">onOpenTouch(event)</code> function, a web pop-up will load upon the release of <code class="literal">openBtn</code>. The text that will be posted is displayed in a string format under the variable, local message. You will notice that we concatenate <code class="literal">score</code> into the string so it displays the value in the message post.<a id="id613" class="indexterm"/>
</p><p>
<code class="literal">local myString, string.gsub()</code> is used to replace all the instances indicated in a pattern inside the string. In this case, it takes the string inside message and searches for every empty space between each word and replaces it with <code class="literal">%20. %20</code> encodes URL parameters to indicate spaces. The extra <code class="literal">%</code> acts as an escape character.</p><p>The <code class="literal">native.showWebPopup()</code> function displays at dimensions 320 x 300; about half the screen size on a device. The URL to display the Twitter message dialog is added and concatenates <code class="literal">myString</code>.</p><p>When the web pop-up no longer needs to be used and needs to be closed, <code class="literal">onCloseTouch(event)</code> is called by <code class="literal">closeBtn</code>. This will take the <code class="literal">event</code> parameter<code class="literal">"release"</code> and call the <code class="literal">native.cancelWebPopup()</code>. This particular function will dismiss the current web pop-up.</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec07"/>Posting to Facebook</h2></div></div></div><p>Another social networking tool that can be used to share information about your game is Facebook. You can easily customize a post to link information about your game or share messages about high scores and insist upon other users downloading it.<a id="id614" class="indexterm"/>
</p><p>In order to post messages to Facebook, you need to be logged in to your Facebook account or create one at:<a class="ulink" href="http://www.facebook.com/"> http://www.facebook.com/</a>. You will have to obtain an App ID from the<em> Facebook Developer</em> website at:<a class="ulink" href="http://https://developers.facebook.com/"> https://developers.facebook.com/</a>. The App ID is a unique identifier for your site that determines what the right level of security is in place between the user and the app page/website.</p><p>Once you have created an App ID, you will also need to edit the app information and choose how you want it to integrate with Facebook. You are given several choices, such as: Website, Native iOS App, and Native Android App, just to name a few. The website integration must be selected and filled in with a valid URL in order for Facebook to redirect to the specified URL for posts dealing with web pop-ups.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec04"/>Time for action—adding Facebook to your apps</h1></div></div></div><p>Similar to our Twitter example, we'll be incorporating Facebook posts with a web pop-up as well.<a id="id615" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">In the <code class="literal">Chapter 9</code> folder, copy the <code class="literal">Facebook Web Pop-Up</code> project folder to your desktop. All the configuration, libraries, and assets needed are already included. You can download the project files accompanying this book from the Packt website.</li><li class="listitem">Create a new <code class="literal">main.lua</code> file and save it to the project folder.</li><li class="listitem">Set the following variables at the beginning of the code:<div><pre class="programlisting">display.setStatusBar( display.HiddenStatusBar )
local ui = require("ui")
local openBtn
local closeBtn
local score = 100
</pre></div></li><li class="listitem">Create a local function called <code class="literal">onOpenTouch()</code> with an event parameter. Add in an <code class="literal">if</code> statement when the event receives a<code class="literal">"release"</code> action.<div><pre class="programlisting">local onOpenTouch = function( event )
if event.phase == "release" then
</pre></div></li><li class="listitem">Add in the following local variables that include the strings we'll be implementing into the Facebook post.<div><pre class="programlisting"><strong>local appId = "0123456789" -- Your personal FB App ID from the facebook developer's website</strong>
local message1 = "Your App Name Here"
local message2 = "Posting to Facebook from Corona SDK and got a final score of " ..score.. "."
local message3 = "Download the game and play!"
local myString1 = string.gsub(message1, "( )", "%%20")
local myString2 = string.gsub(message2, "( )", "%%20")
local myString3 = string.gsub(message3, "( )", "%%20")
</pre></div></li><li class="listitem">Introduce the native web pop-up function that links to the Facebook account. Include parameters for the Facebook Dialog box that redirects the URL of your preferred website, the display with a touch mode that connects to your app URL, and an image URL that presents your app icon or company logo. Concatenate all variables with string methods to output all messages. Close the function. Add in the <code class="literal">openBtn</code> UI function. (You will need to replace all the URL information below with your own).<div><pre class="programlisting">native.showWebPopup(0, 0, 320, 300, "http://www.facebook.com/dialog/feed?app_id=" .. appId .. "&amp;redirect_uri=http://www.yourwebsite.com&amp;display=touch&amp;link=http://www.yourgamelink.com&amp;picture=http://www.yourwebsite.com/image.png&amp;name=" ..myString1.. "&amp;caption=" ..myString2.. "&amp;description=".. myString3)
end
end
openBtn = ui.newButton{
defaultSrc = "openbtn.png",
defaultX = 90,
defaultY = 90,
overSrc = "openbtn-over.png",
overX = 90,
overY = 90,
onEvent = onOpenTouch,
}
openBtn.x = 110; openBtn.y = 350
</pre></div><div><h3 class="title"><a id="note30"/>Note</h3><p>More information pertaining to the Facebook Dialog can be found on the<em> Facebook Developers</em> website at:<a class="ulink" href="http://developers.facebook.com/docs/reference/dialogs/"> http://developers.facebook.com/docs/reference/dialogs/</a>.</p></div></li><li class="listitem">Create a local function called <code class="literal">onCloseTouch()</code> with an event parameter. Add an <code class="literal">if</code> statement with <code class="literal">event.phase == "release"</code> to activate <code class="literal">native.cancelWebPopup()</code>. Set up the <code class="literal">closeBtn</code> UI function.<div><pre class="programlisting">local onCloseTouch = function( event )
if event.phase == "release" then
native.cancelWebPopup()
end
end
closeBtn = ui.newButton{
defaultSrc = "closebtn.png",
defaultX = 90,
defaultY = 90,
overSrc = "closebtn-over.png",
overX = 90,
overY = 90,
onEvent = onCloseTouch,
}
closeBtn.x = 210; closeBtn.y = 350
</pre></div></li><li class="listitem">Save the file and run the project in the simulator. Make sure you're connected to the Internet and your Facebook account to see the results.<a id="id616" class="indexterm"/><div><img src="img/1888_09_02.jpg" alt="Time for action—adding Facebook to your apps"/></div></li></ol></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec08"/>What just happened?</h2></div></div></div><p>Within the <code class="literal">onOpenTouch(event)</code> function, several variables are called when <code class="literal">openBtn</code> is pressed and released. Notice that <code class="literal">local appId</code> indicates a string of numbers that you can obtain after creating an app on the Facebook Developers website.</p><p>
<code class="literal">message1, message2</code>, and <code class="literal">message3</code> are the strings that display the message post. <code class="literal">myString1, myString2</code>, and <code class="literal">myString3</code> help replace the spaces indicated in <code class="literal">message1, message2</code>, and <code class="literal">message3</code>.</p><p>The <code class="literal">native.showWebPopup()</code> function displays with a dimension of 320 x 300 and presents the dialog URL to Facebook. The following parameters display accordingly:<a id="id617" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">app_id</code>—Example: <code class="literal">"1234567"</code> (This is your unique ID created on the Facebook Developer website).<a id="id618" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">redirect_uri</code>—The URL to redirect to after the user clicks a button on the dialog. This is required in the parameters.<a id="id619" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">display</code>—Displays the mode to render the dialog.<a id="id620" class="indexterm"/><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">touch</code>—Used on smart phone devices like iPhone and Android. Fits the dialog screen within small dimensions.</li></ul></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">link</code>—The link attached to the post.<a id="id621" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">picture</code>—The URL of a picture to the post.<a id="id622" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">name—name</code> of the link attachment.<a id="id623" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">caption</code>—Caption of the link (appears beneath the link name).<a id="id624" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">description</code>—Description of the link (appears beneath the link caption).<a id="id625" class="indexterm"/></li></ul></div><p>When the web pop-up no longer needs to be used and needs to be closed, <code class="literal">onCloseTouch(event)</code> is called by <code class="literal">closeBtn</code>. This will take the event parameter<code class="literal">"release"</code> and call <code class="literal">native.cancelWebPopup()</code>. This particular function will dismiss the current web pop-up.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec05"/>Facebook Connect</h1></div></div></div><p>This library supplies a number of functions that interface to<a class="ulink" href="http://www.facebook.com"> http://www.facebook.com</a> through the official Facebook Connect interface.<a id="id626" class="indexterm"/>
</p></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec06"/>Time for action—posting scores using Facebook Connect</h1></div></div></div><p>Facebook Connect is another way to post on the wall feed by using the native Facebook UI features. We'll be creating a different way to post messages and scores to the newsfeed. In order to see how Facebook Connect operates, you need to load the build to a device to view the results. It will not run in the simulator.<a id="id627" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">In the <code class="literal">Chapter 9</code> folder, copy the <code class="literal">Facebook Connect</code> project folder to your desktop. All the configuration, libraries, and assets needed are already included. You can download the project files accompanying this book from the Packt website.</li><li class="listitem">Create a new <code class="literal">main.lua</code> file and save it to the project folder.</li><li class="listitem">Set up the following variables at the beginning of the code:<div><pre class="programlisting">display.setStatusBar( display.HiddenStatusBar )
local ui = require("ui")
local facebook = require "facebook"
local fbBtn
local score = 100
</pre></div></li><li class="listitem">Create a local function called <code class="literal">onFBTouch()</code> with an event parameter. Add in an <code class="literal">if</code> statement containing <code class="literal">event.phase == release</code>. Also include your Facebook app ID in a string format.<div><pre class="programlisting">local onFBTouch = function( event )
if event.phase == "release" then
<strong>local fbAppID = "0123456789" -- Your FB App ID from facebook developer's panel
</strong>
</pre></div></li><li class="listitem">Create another local function within <code class="literal">onFBTouch(event)</code> called <code class="literal">facebookListener()</code> with an event parameter as well. Include an <code class="literal">if</code> statement that refers to<code class="literal">"session" == event.type</code>.<div><pre class="programlisting">local facebookListener = function( event )
if ( "session" == event.type ) then
</pre></div></li><li class="listitem">Add in another <code class="literal">if</code> statement where<code class="literal">"login" == event.phase</code>. Include a local variable called <code class="literal">theMessage</code> to display the message you want to share with other Facebook users.<div><pre class="programlisting">if ( "login" == event.phase ) then
local theMessage = "Got a score of " .. score .. " on Your App Name Here!"
</pre></div></li><li class="listitem">Add in the <code class="literal">facebook.request()</code> function that will post the following messages to the user's Facebook wall. Close any remaining <code class="literal">if</code> statements with <code class="literal">end</code> in the <code class="literal">facebookListener(event)</code> function.<a id="id628" class="indexterm"/><div><pre class="programlisting">facebook.request( "me/feed", "POST", {
message=theMessage,
name="Your App Name Here",
caption="Download and compete with me!",
link="http://itunes.apple.com/us/app/your-app-name/id382456881?mt=8",
picture="http://www.yoursite.com/yourimage.png"} )
end
end
end
</pre></div><div><h3 class="title"><a id="note31"/>Note</h3><p>The <code class="literal">link</code> parameter demonstrates a URL for an iOS application. You can direct the URL to an Android application that will look something like: <a class="ulink" href="https://play.google.com/store/apps/details?id=com.yourcompany.yourappname">https://play.google.com/store/apps/details?id=com.yourcompany.yourappname</a> or a general website URL of your choosing.</p></div></li><li class="listitem">Call the <code class="literal">facebook.login()</code> that includes your appID, listener, and permissions to post on the user's Facebook wall. Close the remainder of the <code class="literal">onFBTouch(event)</code> function.<div><pre class="programlisting">facebook.login( fbAppID, facebookListener, { "publish_stream" } )
end
end
</pre></div></li><li class="listitem">Enable the <code class="literal">fbBtn</code> UI function and save your file.<div><pre class="programlisting">fbBtn = ui.newButton{
defaultSrc = "facebookbtn.png",
defaultX = 100,
defaultY = 100,
overSrc = "facebookbtn-over.png",
overX = 100,
overY = 100,
onEvent = onFBTouch,
}
fbBtn.x = 160; fbBtn.y = 160
</pre></div></li><li class="listitem">Create a new device build for either iOS or Android. Load the build to your device and run the application. You will be asked to log in to your Facebook account before you can see the results from the application.<a id="id629" class="indexterm"/><div><img src="img/1888_09_03.jpg" alt="Time for action—posting scores using Facebook Connect"/></div></li></ol></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec09"/>What just happened?</h2></div></div></div><p>One of the most important things that needs to be done is <code class="literal">require "facebook"</code> in order to have the Facebook API to work. We also created a local variable called <code class="literal">score</code> with the value of 100.</p><p>The <code class="literal">onFBTouch(event)</code> function will initiate the event parameter upon<code class="literal">"release"</code> of <code class="literal">fbBtn</code>. Within the function, <code class="literal">fbAppID</code> is included with characters in a string format. This will be a unique set of numbers that you must obtain from the Facebook Developers website. The App ID will be created for you when you make an App page on the site.</p><p>Another function, <code class="literal">facebookListener(event)</code>, is created and it will initiate all <code class="literal">fbConnect</code> events. Under the <code class="literal">if</code> statement containing <code class="literal">("login" == event.phase )</code> will request to post a message to your feed through<code class="literal">"me/feed, "POST"</code>. The feed contains the following:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">message=theMessage</code>—Refers to the string belonging to the variable. It also concatenates scores so it displays the value as well.</li><li class="listitem" style="list-style-type: disc"><code class="literal">name</code>—A message that includes your app name or subject matter.</li><li class="listitem" style="list-style-type: disc"><code class="literal">caption</code>—A short persuasive message to catch other users attention about playing the game.</li><li class="listitem" style="list-style-type: disc"><code class="literal">link</code>—The URL to download the game from either the App Store or Google Play Store.</li><li class="listitem" style="list-style-type: disc"><code class="literal">picture</code>—A URL containing your image that displays your app icon or visual representation of the game.</li></ul></div><p>After the parameters are set, <code class="literal">facebook.login()</code> will refer to <code class="literal">fbAppID</code> and <code class="literal">facebookListener()</code> to see if a valid application ID is being used to post on Facebook. Upon success, the post is published through<code class="literal">"publish_stream".</code>
<a id="id630" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec10"/>Have a go hero—create a dialog box</h2></div></div></div><p>See if you can figure out how to display a dialog box using Facebook Connect and using the same setup as the preceding example. The following line will display this as:<a id="id631" class="indexterm"/>
</p><div><pre class="programlisting">facebook.showDialog( {action="stream.publish"} )
</pre></div><p>Now see where in the code <code class="literal">facebook.showDialog()</code> can be accessed. This is another way of posting messages to Facebook.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec07"/>The wonders of OpenFeint</h1></div></div></div><p>OpenFeint is a third-party library that enables social gaming features such as public leaderboards and achievements. For more information, see<a class="ulink" href="http://www.openfeint.com/"> http://www.openfeint.com/</a>.<a id="id632" class="indexterm"/>
</p><p>It is very simple to implement leaderboards and achievements once you are ready to network your mobile game to the public.</p><p>You will need to create a user account on the OpenFeint Developer site at:<a class="ulink" href="http://www.openfeint.com/developers"> http://www.openfeint.com/developers</a> to integrate its features in your application.<a id="id633" class="indexterm"/>
</p><div><div><div><div><h2 class="title"><a id="ch09lvl2sec11"/>Game network API</h2></div></div></div><p>Game network allows access to third-party libraries such as OpenFeint, Papaya, and Game Center which enable social gaming features such as public leaderboards and achievements. The API will be able to access those libraries once you implement them in your application. We'll be focusing on the easy-to-use OpenFeint library, which will implement the following features from the game network API.<a id="id634" class="indexterm"/>
</p><p>The following line makes the game network features available under the OpenFeint namespace:<a id="id635" class="indexterm"/>
</p><div><pre class="programlisting">local gameNetwork = require "gameNetwork"
</pre></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec06"/>gameNetwork.init()</h3></div></div></div><p>Initializes ans (product key, secret, display name, and so on) required by the game network provider. After you have logged in to your OpenFeint developer account, you'll need to select the<strong> Add New Game</strong> button and create a new application name. The<strong> App ID, Product Key</strong>, and<strong> Product Secret</strong> can be found in the<strong> Application Information</strong> section of your application name.<a id="id636" class="indexterm"/>
</p><p>Syntax:<a id="id637" class="indexterm"/>
</p><div><pre class="programlisting">gameNetwork.init( providerName [, parms ...] )
</pre></div><p>Parameters:<a id="id638" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">providerName</code>—The string of the game network provider ("openfeint")</li><li class="listitem" style="list-style-type: disc"><code class="literal">parms</code>—Additional parameters required by the<code class="literal">"openfeint"</code> provider<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Product Key</code>—The string of your application's OpenFeint product key (provided by OpenFeint)</li><li class="listitem" style="list-style-type: disc"><code class="literal">Product Secret</code>—The string of your application's product secret (provided by OpenFeint)</li><li class="listitem" style="list-style-type: disc"><code class="literal">Display Name</code>—The string of the name to display in OpenFeint leaderboards and other views</li><li class="listitem" style="list-style-type: disc"><code class="literal">App ID</code>—The string of the application ID (provided by OpenFeint)</li></ul></div></li></ul></div><p>Example:<a id="id639" class="indexterm"/>
</p><div><pre class="programlisting">gameNetwork.init( "openfeint", "&lt;OpenFeint Product Key&gt;", "&lt;OpenFeint Product Secret&gt;", "Display Name", "&lt;App ID&gt;" )
</pre></div><p>Initializes an app with the specified product key, secret, and display name. This should only be called once.</p></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec07"/>gameNetwork.show()</h3></div></div></div><p>Shows information from the game network provider on the screen.<a id="id640" class="indexterm"/>
</p><p>For the OpenFeint provider, launch the OpenFeint dashboard in one of the following configurations: leaderboards, challenges, achievements, friends, playing, or high score.</p><p>Syntax:<a id="id641" class="indexterm"/>
</p><div><pre class="programlisting">gameNetwork.show( name [, data] )
</pre></div><p>Parameters:<a id="id642" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">name</code>—Strings supported by the OpenFeint provider:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">gameNetwork.show()</code>—Launches the OpenFeint dashboard</li><li class="listitem" style="list-style-type: disc"><code class="literal">gameNetwork.show( "leaderboards")</code>—Opens the user's Leaderboard dashboard</li><li class="listitem" style="list-style-type: disc"><code class="literal">gameNetwork.show( "challenges")</code>—Opens the user's Challenge dashboard (not supported in Android)</li><li class="listitem" style="list-style-type: disc"><code class="literal">gameNetwork.show( "achievements")</code>—Opens the user's Achievements dashboard</li><li class="listitem" style="list-style-type: disc"><code class="literal">gameNetwork.show( "friends")</code>—Opens the user's Friends dashboard (not supported in Android)</li><li class="listitem" style="list-style-type: disc"><code class="literal">gameNetwork.show( "playing ")</code>—Opens the user's Playing dashboard (not supported in Android)</li><li class="listitem" style="list-style-type: disc"><code class="literal">gameNetwork.show( "highscore", "LeaderboardID")</code>—Opens the user's High Score dashboard for a particular item</li></ul></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">data-String</code>—When the OpenFeint dashboard view is<code class="literal">"highscore"</code>, the string should contain the<code class="literal">"leaderboardID"</code> property whose value is the corresponding OpenFeint leaderboard ID.<a id="id643" class="indexterm"/></li></ul></div></div><div><div><div><div><h3 class="title"><a id="ch09lvl3sec08"/>gameNetwork.request()</h3></div></div></div><p>Send or request information to/from the game network provider.<a id="id644" class="indexterm"/>
</p><p>Syntax:<a id="id645" class="indexterm"/>
</p><div><pre class="programlisting">gameNetwork.request( command [, parms ...] )
</pre></div><p>Parameters:<a id="id646" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">command</code>—Strings supported by the OpenFeint provider:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">setHighScore</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">unlockAchievement</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">uploadBlob</code>—Not supported on Android</li><li class="listitem" style="list-style-type: disc"><code class="literal">downloadBlob</code>—Not supported on Android</li></ul></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">parms</code>—Parameters used in the preceding OpenFeint commands:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">setHighScore: { leaderboardID="123456", score=50 }</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">unlockAchievement: "achievementId"</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">uploadBlob: "uploadBlob", key, data</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">downloadBlob: key, [listener]</code>—listener for<code class="literal">"completion"</code> event with<code class="literal">"blob"</code> key set</li></ul></div></li></ul></div><p>Example:<a id="id647" class="indexterm"/>
</p><p>The following unlocks the specified achievement:</p><div><pre class="programlisting">gameNetwork.request( "unlockAchievement", "achievementId" )
</pre></div><p>The following sets a high score on the leaderboard:<a id="id648" class="indexterm"/>
</p><div><pre class="programlisting">gameNetwork.request( "setHighScore", { leaderboardID="1234567", score=50, displayText="50 points" } )
</pre></div><p>The preceding function takes a table as the parameter with the following elements:<a id="id649" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">leaderboardID:</code> String. The ID of the OpenFeint leaderboard where the high score should be posted.</li><li class="listitem" style="list-style-type: disc"><code class="literal">score:</code> Number. The new high score value to post to the specified leaderboard.</li><li class="listitem" style="list-style-type: disc"><code class="literal">displayText:</code> String. An optional string to display in place of the numeric score specified by the value assigned to the score parameter.</li></ul></div><p>The following saves a blob of game data in the cloud, using OpenFeint's<em> Network Save Card</em> feature:</p><div><pre class="programlisting">gameNetwork.request( "uploadBlob", key, data )
</pre></div><p>The following downloads data saved previously saved uploadBlob:</p><div><pre class="programlisting">gameNetwork.request( "downloadBlob", key, listener ) -- listener for "completion" event with "blob" key set.
</pre></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec08"/>OpenFeint in a jiffy</h1></div></div></div><p>What better way to implement OpenFeint than by using a game we have already made in this book!<a id="id650" class="indexterm"/>
</p></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec09"/>Time for action—setting up OpenFeint leaderboards and achievements in Egg Drop</h1></div></div></div><p>We'll be incorporating our Egg Drop game with the OpenFeint features that we have discussed so far.<a id="id651" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Create an account on the OpenFeint Developers site:<a class="ulink" href="http://openfeint.com/developers"> http://openfeint.com/developers</a>. You can use<strong> Egg Drop</strong> as the game name to test and then delete it later. You can choose to have it work for iOS or Android or both. The choice is up to you. Once you're logged in, click on the<strong> Account Information</strong> tab to view the<strong> Product key, Product secret</strong>, and<strong> Client Application ID</strong>. These will need to be added into your application.<div><img src="img/1888_09_04.jpg" alt="Time for action—setting up OpenFeint leaderboards and achievements in Egg Drop"/></div></li><li class="listitem">From the <code class="literal">Chapter 9</code> folder, copy the <code class="literal">Egg Drop with OF</code> project folder to your desktop. You can download the project files accompanying this book from the Packt website. Open up the <code class="literal">mainmenu.lua</code> file. Insert the game network features after the UI module and initialize it with information obtained from the OpenFeint developer account.<a id="id652" class="indexterm"/><div><pre class="programlisting">local gameNetwork = require("gameNetwork")
gameNetwork.init( "openfeint", "&lt;OpenFeint Product Key&gt;", "&lt;OpenFeint Product Secret&gt;", "Display Name", "&lt;App ID&gt;" )
</pre></div></li><li class="listitem">Underneath the chunk of code pertaining to <code class="literal">optBtn</code>, create a new UI button called <code class="literal">local ofBtn</code> that transitions from offscreen to y=280 in 500 milliseconds. Add in a local function called <code class="literal">onOFTouch()</code> with an <code class="literal">event</code> parameter. Upon an <code class="literal">event.phase == "release"</code> have the game network display the leaderboard. Save and close your file.<div><pre class="programlisting">local ofBtn
local onOFTouch = function( event )
if event.phase == "release" then
audio.play( btnSound )
gameNetwork.show( "leaderboards" )
end
end
ofBtn = ui.newButton{
defaultSrc = "ofbtn.png",
defaultX = 60,
defaultY = 60,
overSrc = "ofbtn-over.png",
overX = 60,
overY = 60,
onEvent = onOFTouch,
id = "OFButton",
text = "",
font = "Helvetica",
textColor = { 255, 255, 255, 255 },
size = 16,
emboss = false
}
ofBtn.x = 50; ofBtn.y = 440
screenGroup:insert( ofBtn )
btnAnim = transition.to( ofBtn, { time=500, y=280, transition=easing.inOutExpo } )
<a id="id653" class="indexterm"/>
</pre></div></li><li class="listitem">Go back into the OpenFeint developer portal and click on the<strong> Features</strong> tab and then the<strong> Achievements</strong> tab. Click on the orange button that says<strong> Add Achievement</strong>.<div><img src="img/1888_09_05.jpg" alt="Time for action—setting up OpenFeint leaderboards and achievements in Egg Drop"/></div></li><li class="listitem">The particular achievement we will create is when the character catches his first egg. Create a title for the achievement, determine a point value you want to determine out of 1000 Feint points, and write a short subscription. You can add an achievement icon if you wish, but is not necessary for this tutorial. Click on<strong> Save Achievement</strong> when you have finished.<a id="id654" class="indexterm"/><div><img src="img/1888_09_06.jpg" alt="Time for action—setting up OpenFeint leaderboards and achievements in Egg Drop"/></div></li><li class="listitem">In the next screen, you will see the achievement added along with a<strong> Unique ID</strong>, which we'll be using to create an achievement in the game. You will be using your own Unique ID that is generated for you in OpenFeint unlike the one displayed in the following screenshot:<a id="id655" class="indexterm"/><div><img src="img/1888_09_07.jpg" alt="Time for action—setting up OpenFeint leaderboards and achievements in Egg Drop"/></div></li><li class="listitem">Open the <code class="literal">maingame.lua</code> file in the project folder. In the <code class="literal">onEggCollision()</code> function, locate the <code class="literal">if</code> statement containing <code class="literal">event.force &gt; 1.0 and self.isHit == false</code>. Create another <code class="literal">if</code> statement near the bottom of the function that requests <code class="literal">gameNetwork()</code>, the achievement, and your own Unique ID when one egg has been caught.<a id="id656" class="indexterm"/><div><pre class="programlisting">if eggCount == 1 then
gameNetwork.request( "unlockAchievement", "1315272" ) -- replace the Unique ID with the one you created in OpenFeint
end
</pre></div></li><li class="listitem">Go back to the OpenFeint developer portal and click on the<strong> Leaderboards</strong> tab. Click on the orange button that says<strong> Add Leaderboard</strong>. You can create any name that pertains to the level. You can keep the checkboxes as is. Click on the<strong> Save Leaderboard</strong> button.<div><img src="img/1888_09_08.jpg" alt="Time for action—setting up OpenFeint leaderboards and achievements in Egg Drop"/></div></li><li class="listitem">You will be greeted with your new Unique ID for the Leaderboard on the next screen.<a id="id657" class="indexterm"/><div><img src="img/1888_09_09.jpg" alt="Time for action—setting up OpenFeint leaderboards and achievements in Egg Drop"/></div></li><li class="listitem">In the <code class="literal">maingame.lua</code> file, locate the <code class="literal">callGameOver()</code> function. Within the <code class="literal">if</code> statement that says <code class="literal">gameScore &gt; highScore</code>, add in the <code class="literal">gameNetwork()</code> request to post the highest score of the game to OpenFeint. Use the Unique ID to fill in the <code class="literal">Leaderboard ID</code>. You will be using your own Unique ID for the Leaderboard which was generated for you in OpenFeint to determine the high score, <code class="literal">score=gamescore</code>. Save your file.<a id="id658" class="indexterm"/><div><pre class="programlisting">gameNetwork.request( "setHighScore", { leaderboardID="957686", score=gameScore } ) -- replace the Unique ID with the one you created in OpenFeint
</pre></div></li><li class="listitem">Adding achievements and leaderboards is done! OpenFeint capabilities cannot be run on the simulator. You'll have to load the game build to a device to view the results.</li></ol></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec12"/>What just happened?</h2></div></div></div><p>
<code class="literal">gameNetwork.init()</code> initializes an app with the parameters <code class="literal">("openfeint","&lt;OpenFeint Product Key&gt;", "&lt;OpenFeint Product Secret&gt;", "Display Name", "&lt;App ID&gt;")</code> required by the game network provider.</p><p>The main menu displays <code class="literal">ofBtn</code> and establishes the connection to <code class="literal">gameNetwork.show ( "leaderboards" )</code> and opens the user's Leaderboard dashboard.</p><p>When adding achievements, we added <code class="literal">if eggCount == 1 then gameNetwork.request( "unlockAchievement", "1315272" ) end</code> in the <code class="literal">onEggCollision()</code> function because we know that <code class="literal">eggCount</code> is tracked through every collision made by the main character. This will unlock the achievement in OpenFeint since we specified it through the unique ID we created.</p><p>Leaderboards keep track of the high scores implemented overall in each level. We added <code class="literal">gameNetwork.request( "setHighScore", { leaderboardID="957686", score=gameScore } )</code> within the <code class="literal">callGameOver()</code> function and inside the <code class="literal">if</code> statement that compares <code class="literal">gameScore</code> and <code class="literal">highScore</code>. If a high score is achieved for the level, it is sent to the leaderboard in OpenFeint under the unique ID set in the developer portal.</p><div><h3 class="title"><a id="note22"/>Note</h3><p>Having an OpenFeint membership does not cost any money when you register under the developer portal. When you have completed your game, make sure to register it so it will have full access to OpenFeint features amongst the public.</p></div></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec13"/>Have a go hero—adding more OpenFeint achievements</h2></div></div></div><p>By using the current game, try coming up with other achievements that can be unlocked and figure out how they can be accessed by OpenFeint. Here are some ideas to get you started:<a id="id659" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Reaching a certain amount of points</li><li class="listitem" style="list-style-type: disc">Catching a certain amount of eggs</li><li class="listitem" style="list-style-type: disc">Catching a certain amount of eggs with all three lives available</li></ul></div><p>There are many possibilities that can be created. Give it a try!</p></div><div><div><div><div><h2 class="title"><a id="ch09lvl2sec14"/>Pop quiz—handling social networks</h2></div></div></div><div><ol class="orderedlist"><li class="listitem">What is the specific API that scales down high-resolution sprite sheets?<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">a. <code class="literal">object.xScale</code></li><li class="listitem" style="list-style-type: none">b. <code class="literal">display.contentScaleX</code></li><li class="listitem" style="list-style-type: none">c. <code class="literal">object.xReference</code></li><li class="listitem" style="list-style-type: none">d. None of the above</li></ul></div></li><li class="listitem">What is the maximum amount of Feint points that can be given to a user in OpenFeint throughout the application?<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">a. 200</li><li class="listitem" style="list-style-type: none">b. 750</li><li class="listitem" style="list-style-type: none">c. 10000</li><li class="listitem" style="list-style-type: none">d. 1000</li></ul></div></li><li class="listitem">Which of the following are valid parameters required for <code class="literal">gameNetwork.init()?</code><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">a. App ID</li><li class="listitem" style="list-style-type: none">b. Product Key</li><li class="listitem" style="list-style-type: none">c. Product Secret</li><li class="listitem" style="list-style-type: none">d. All of the above</li></ul></div></li></ol></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch09lvl1sec10"/>Summary</h1></div></div></div><p>We have covered several more areas on enhancing configuration settings and integrating three of the most popular social networks in today's media in our apps.</p><p>We took an in-depth look into:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Build settings</li><li class="listitem" style="list-style-type: disc">Dynamic content scaling and dynamic image resolution</li><li class="listitem" style="list-style-type: disc">High-resolution sprite sheets</li><li class="listitem" style="list-style-type: disc">Post message feeds to Twitter and Facebook</li><li class="listitem" style="list-style-type: disc">Implement achievements and leaderboards in OpenFeint</li></ul></div><p>In the next chapter, we will go over the process on how to submit our games to the App Store and Google Play Store. You don't want to miss this for the world!</p></div></body></html>