<html><head></head><body>
        

                            
                    <h1 class="header-title">ARCore on Unity</h1>
                
            
            
                
<p class="mce-root">The next platform we will set up is Unity. Unity is a leading cross-platform game engine that is exceptionally easy to use for building game and graphic applications quickly. As such, it will be the platform we use when we build our final application in <a href="6a8f64fb-080f-47a2-9565-4099269831b1.xhtml" target="_blank">Chapter 10</a>, <em>Mixing in Mixed Reality</em>.</p>
<p>Unity has developed something of a bad reputation in recent years due to its overuse in poor-quality games. It isn't because Unity can't produce high-quality games, it most certainly can. However, the ability to create games quickly often gets abused by developers seeking to release cheap games for profit.</p>
<p class="mce-root">In this chapter, we will learn how to install, build, and deploy Unity ARCore apps for Android. Then, we will set up for remote debugging and, finally, we will explore making some changes to the sample app. The following is a summary of the topics we will cover in this chapter:</p>
<ul>
<li>Installing Unity and ARCore</li>
<li>Building and deploying to Android</li>
<li>Remote debugging</li>
<li>Exploring the code</li>
</ul>
<p class="mce-root">We have already covered setting up the Android tools in <a href="c5c4b444-3342-457a-b756-266772b70d06.xhtml" target="_blank">Chapter 2</a>, <em>ARCore on Android</em>. If you omitted that chapter, you will need to go back and do the exercises in the first few sections before continuing. If you are an experienced Unity developer with an Android environment set up, you should still review this chapter as it may have some useful tips or settings.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Installing Unity and ARCore</h1>
                
            
            
                
<p>Installing the Unity editor is relatively straightforward. However, the version of Unity we will be using may still be in beta. Therefore, it is important that you pay special attention to the following instructions when installing Unity:</p>
<ol>
<li>Navigate a web browser to <a href="https://unity3d.com/unity/beta">https://unity3d.com/unity/beta</a>.</li>
</ol>
<p>At the time of writing, we will use the most recent beta version of Unity since ARCore is also still in beta preview. Be sure to note the version you are downloading and installing. This will help in the event you have issues working with ARCore. </p>
<ol start="2">
<li>Click on the Download installer button. This will download <kbd>UnityDownloadAssistant</kbd>.</li>
<li>Launch <kbd>UnityDownloadAssistant</kbd>.</li>
<li>Click on Next and then agree to the Terms of Service. Click on <strong>Next</strong> again.</li>
<li>Select the components, as shown:</li>
</ol>
<div><img src="img/6c872cf8-3dee-465f-8f9e-33f4e081d75f.png" style="font-family: 'Times New Roman', times, serif;font-size: 10pt;text-align: center;width:29.25em;height:22.75em;"/></div>
<p>Selecting the components to install</p>
<ol start="6">
<li>Install Unity in a folder that identifies the version, as follows:</li>
</ol>
<div><img src="img/0a7e0c49-98b4-420e-9270-03e966f2465a.png" style="font-family: 'Times New Roman', times, serif;font-size: 10pt;text-align: center;width:29.92em;height:23.25em;"/></div>
<p>Setting the Unity installation path</p>
<ol start="7">
<li>Click on Next to download and install Unity. This can take a while, so get up, move around, and grab a beverage.</li>
<li>Click on the Finish button and ensure that Unity is set to launch automatically. Let Unity launch and leave the window open. We will get back to it shortly.</li>
</ol>
<p>Once Unity is installed, we want to download the ARCore SDK for Unity. This will be easy now that we have Git installed. Follow the given instructions to install the SDK:</p>
<ol>
<li>Open a shell or Command Prompt.</li>
<li>Navigate to your <kbd>Android</kbd> folder. On Windows, use this:</li>
</ol>
<pre style="padding-left: 60px"><strong>cd C:\Android</strong></pre>
<ol start="3">
<li>Type and execute the following:</li>
</ol>
<pre class="devsite-terminal devsite-click-to-copy" style="padding-left: 60px"><strong>git clone https://github.com/google-ar/arcore-unity-sdk.git</strong></pre>
<ol start="4">
<li>After the <kbd>git</kbd> command completes, you will see a new folder called <kbd>arcore-unity-sdk</kbd>.</li>
</ol>
<p>If this is your first time using Unity, you will need to go online to <a href="https://unity3d.com/">https://unity3d.com/</a> and create a Unity user account. The Unity editor will require that you log in on first use and from time to time.</p>
<p>Now that we have Unity and ARCore installed, it's time to open the sample project by implementing the following steps:</p>
<ol>
<li>If you closed the Unity window, launch the Unity editor. The path on Windows will be <kbd>C:\Unity 2017.3.0b8\Editor\Unity.exe</kbd>. Feel free to create a shortcut with the version number in order to make it easier to launch the specific Unity version later.</li>
<li>Switch to the Unity project window and click on the Open button.</li>
<li>Select the <kbd>Android/arcore-unity-sdk</kbd> folder. This is the folder we used the <kbd>git</kbd> command to install the SDK to earlier, as shown in the following dialog:</li>
</ol>
<div><img src="img/73ee0401-034c-4218-8640-9184520dbbe3.png" style="font-family: 'Times New Roman', times, serif;font-size: 10pt;text-align: center;"/></div>
<p>Opening the sample ARCore Unity project</p>
<ol start="4">
<li>Click on the Select Folder button. This will launch the editor and load the project.</li>
<li>Open the <kbd>Assets/GoogleARCore/HelloARExample/Scenes</kbd> folder in the Project window, as shown in the following excerpt:</li>
</ol>
<div><img src="img/13f763bf-8f5e-4384-a1ef-85ee250b95b9.png" style="font-family: 'Times New Roman', times, serif;font-size: 10pt;text-align: center;width:45.08em;height:18.83em;"/></div>
<p>Opening the scenes folder</p>
<ol start="6">
<li>Double-click on the HelloAR scene, as shown in the Project window and in the preceding screenshot. This will load our AR scene into Unity.</li>
</ol>
<p>At any point, if you see red console or error messages in the bottom status bar, this likely means you have a version conflict. You will likely need to install a different version of Unity. Consult <a href="e7c0bdd1-e380-4498-af5a-fe9e627eb6cb.xhtml" target="_blank">Chapter 11</a>,<em> Performance Tips and Troubleshooting</em> for more help.</p>
<p>Now that we have Unity and ARCore installed, we will build the project and deploy the app to an Android device in the next section.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Building and deploying to Android</h1>
                
            
            
                
<p>With most Unity development, we could just run our scene in the editor for testing. Unfortunately, when developing ARCore applications, we need to deploy the app to a device for testing. Fortunately, the project we are opening should already be configured for the most part. So, let's get started by following the steps in the next exercise:</p>
<ol>
<li>Open up the Unity editor to the sample ARCore project and open the HelloAR scene. If you left Unity open from the last exercise, just ignore this step.</li>
<li>Connect your device via USB.</li>
<li>From the menu, select File | Build Settings. Confirm that the settings match the following dialog:</li>
</ol>
<div><img src="img/aac2543a-3ea2-4f06-a6f0-ecdcc85f437e.png" style="font-family: 'Times New Roman', times, serif;font-size: 10pt;text-align: center;width:35.67em;height:34.58em;"/></div>
<p>Build settings dialog</p>
<ol start="4">
<li>Confirm that the HelloAR scene is added to the build. If the scene is missing, click on the Add Open Scenes button to add it.</li>
<li>Click on Build and Run. Be patient, first-time builds can take a while.</li>
<li>After the app gets pushed to the device, feel free to test it, as you did with the Android version.</li>
</ol>
<p>Great! Now we have a Unity version of the sample ARCore project running. In the next section, we will look at remotely debugging our app.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Remote debugging</h1>
                
            
            
                
<p>Having to connect a USB all the time to push an app is inconvenient. Not to mention that, if we wanted to do any debugging, we would need to maintain a physical USB connection to our development machine at all times. Fortunately, there is a way to connect our Android device via Wi-Fi to our development machine. Use the following steps to establish a Wi-Fi connection:</p>
<ol>
<li>Ensure that a device is connected via USB.</li>
<li>Open Command Prompt or shell.</li>
</ol>
<p>On Windows, we will add <kbd>C:\Android\sdk\platform-tools</kbd> to the path just for the prompt we are working on. It is recommended that you add this path to your environment variables. Google it if you are unsure of what this means.</p>
<ol start="3">
<li>Enter the following commands:</li>
</ol>
<pre style="padding-left: 60px">//WINDOWS ONLY<br/><strong>path C:\Android\sdk\platform-tools</strong><br/><br/>//FOR ALL <br/><strong>adb devices</strong><br/><strong>adb tcpip 5555</strong></pre>
<ol start="4">
<li>If it worked, you will see <kbd>restarting in TCP mode port: 5555</kbd>. If you encounter an error, disconnect and reconnect the device.</li>
</ol>
<ol start="5">
<li>Disconnect your device.</li>
<li>Locate the IP address of your device by doing as follows:
<ol>
<li>Open your phone and go to Settings and then About phone.</li>
<li>Tap on Status<strong>. </strong>Note down the IP address.</li>
</ol>
</li>
</ol>
<ol start="7">
<li>Go back to your shell or Command Prompt and enter the following:</li>
</ol>
<pre style="padding-left: 60px"><strong>adb connect [IP Address]</strong></pre>
<ol start="8">
<li>Ensure that you use the IP Address you wrote down from your device.</li>
<li>You should see <kbd>connected to [IP Address]:5555</kbd>. If you encounter a problem, just run through the steps again.</li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">Testing the connection</h1>
                
            
            
                
<p>Now that we have a remote connection to our device, we should test it to ensure that it works. Let's test our connection by doing the following:</p>
<ol>
<li>Open up Unity to the sample AR project.</li>
<li>Expand the Canvas object in the Hierarchy window until you see the SearchingText object and select it, just as shown in the following excerpt:</li>
</ol>
<div><img src="img/d741b850-b1e4-48ae-a454-683a3e60f474.png" style="font-family: 'Times New Roman', times, serif;font-size: 10pt;text-align: center;width:27.67em;height:14.83em;"/></div>
<p>Hierarchy window showing the selected SearchingText object</p>
<ol start="3">
<li>Direct your attention to the Inspector window, on the right-hand side by default. Scroll down in the window until you see the text <kbd>"Searching for surfaces…"</kbd>.</li>
</ol>
<ol start="4">
<li>Modify the text to read <kbd>"Searching for ARCore surfaces…"</kbd>, just as we did in the last chapter for Android.</li>
<li>From the menu, select File | Build and Run.</li>
<li>Open your device and test your app.</li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">Remotely debugging a running app</h1>
                
            
            
                
<p>Now, building and pushing an app to your device this way will take longer, but it is far more convenient. Next, let's look at how we can debug a running app remotely by performing the following steps:</p>
<ol>
<li>Go back to your shell or Command Prompt.</li>
<li>Enter the following command:</li>
</ol>
<pre style="padding-left: 60px"><strong>adb logcat</strong></pre>
<ol start="3">
<li>You will see a stream of logs covering the screen, which is not something very useful.</li>
<li>Enter <em>Ctrl</em> + <em>C</em> (<em>command</em> + <em>C</em> on Mac) to kill the process.</li>
<li>Enter the following command:</li>
</ol>
<pre style="padding-left: 60px">//ON WINDOWS<br/><strong>C:\Android\sdk\tools\monitor.bat</strong><br/><br/>//ON LINUX/MAC<strong><em><br/></em>cd android-sdk/tools/</strong><br/><strong>monitor</strong></pre>
<ol start="6">
<li>This will open Android Device Monitor. You should see your device on the list to the left. Ensure that you select it. You will see the log output start streaming in the <strong>LogCat</strong> window. Drag the LogCat window so that it is a tab in the main window, as illustrated:</li>
</ol>
<div><img src="img/35d81f86-82a5-4b7f-aa78-f4fe1aa967bc.png" style="font-family: 'Times New Roman', times, serif;font-size: 10pt;text-align: center;"/></div>
<p>Android Device Monitor showing the LogCat window</p>
<ol start="7">
<li>Leave the Android Device Monitor window open and running. We will come back to it later.</li>
</ol>
<p>Now we can build, deploy, and debug remotely. This will give us plenty of flexibility later when we want to become more mobile. Of course, the remote connection we put in place with <kbd>adb</kbd> will also work with Android Studio. Yet, we still are not actually tracking any log output. We will output some log messages in the next section.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Exploring the code</h1>
                
            
            
                
<p>Unlike Android, we were able to easily modify our Unity app right in the editor without writing code. In fact, given the right Unity extensions, you can make a working game in Unity without any code. However, for us, we want to get into the nitty-gritty details of ARCore, and that will require writing some code. Jump back to the Unity editor, and let's look at how we can modify some code by implementing the following exercise:</p>
<ol>
<li>From the Hierarchy window, select the ExampleController object. This will pull up the object in the Inspector window.</li>
<li>Select the Gear icon beside Hello AR Controller (Script) and from the context menu, select Edit Script, as in the following excerpt:</li>
</ol>
<div><img src="img/a9df4631-92ce-4a17-8b8d-e6457f9c3885.png" style="font-family: 'Times New Roman', times, serif;font-size: 10pt;text-align: center;width:27.83em;height:22.25em;"/></div>
<p>Editing a script in Unity</p>
<ol start="3">
<li>This will open your script editor and load the script, by default, <kbd>MonoDevelop</kbd>.</li>
</ol>
<p>Unity supports a number of <strong>Integrated Development Environments</strong> (<strong>IDE</strong>s) for writing C# scripts. Some popular options are Visual Studio 2015-2017 (Windows), VS Code (All), JetBrains Rider (Mac), and even Notepad++(All). Do yourself a favor and try one of the options listed for your OS.</p>
<ol start="4">
<li>Scroll down in the script until you see the following block of code:</li>
</ol>
<pre style="padding-left: 60px">public void Update ()<br/>{<br/>    _QuitOnConnectionErrors();</pre>
<ol start="5">
<li>After the <kbd>_QuitOnConnectionErrors();</kbd> line of code, add the following code:</li>
</ol>
<pre style="padding-left: 60px">Debug.Log("Unity Update Method");</pre>
<ol start="6">
<li>Save the file and then go back to Unity. Unity will automatically recompile the file. If you made any errors, you will see red error messages in the status bar or console.</li>
<li>From the menu, select File | Build and Run. As long as your device is still connected via TCP/IP, this will work. If your connection broke, just go back to the previous section and reset it.</li>
<li>Run the app on the device.</li>
<li>Direct your attention to Android Device Monitor and see whether you can spot those log messages.</li>
</ol>


            

            
        
    

        

                            
                    <h1 class="header-title">Unity Update method</h1>
                
            
            
                
<p>The Unity <kbd>Update</kbd> method is a special method that runs before/during a frame update or render. For your typical game running at 60 frames per second, this means that the <kbd>Update</kbd> method will be called 60 times per second as well, so you should be seeing lots of messages tagged as Unity. You can filter these messages by doing the following:</p>
<ol>
<li>Jump to the Android Device Monitor window.</li>
<li>Click on the green plus button in the Saved Filters panel, as shown in the following excerpt:</li>
</ol>
<div><img src="img/bff2dc8d-253a-4451-bdb3-b5d399d409bd.png" style="width:30.83em;height:24.25em;"/></div>
<p>Adding a new tag filter</p>
<ol start="3">
<li>Create a new filter by entering a Filter Name (use <kbd>Unity</kbd>) and by Log Tag (use <kbd>Unity</kbd>), as shown in the preceding screenshot.</li>
<li>Click on OK to add the filter.</li>
<li>Select the new <kbd>Unity</kbd> filter. You will now see a list of filtered messages specific to Unity platform when the app is running on the device. If you are not seeing any messages, check your connection and try to rebuild. Ensure that you saved your edited code file in <kbd>MonoDevelop</kbd> as well.</li>
</ol>
<p>Good job. We now have a working Unity set up with remote build and debug support, which will certainly make our job easier going forward. Now that you have everything set up, go back to Unity platform and get more familiar with the interface. Try not to change any settings as we will use the sample project as our base in later chapters.</p>


            

            
        
    

        

                            
                    <h1 class="header-title">Summary</h1>
                
            
            
                
<p>In this chapter, we set up a new platform for our ARCore development, called Unity. Unity, as we learned, is a leading, powerful, flexible, and simple game/graphic engine we will use extensively in later chapters. For now though, we installed Unity and the ARCore SDK for Unity. We then took a slight diversion by setting up a remote build and debug connection to our device using TCP/IP over Wi-Fi. Next, we tested out our ability to modify the C# script in Unity by adding some debug log output. Finally, we tested our code changes using the Android Device Monitor tool to filter and track log messages from the Unity app deployed to the device.</p>
<p>We will continue to grind away in the next chapter and set up our environment for web ARCore development. Web ARCore development is substantially different from Android and Unity. However, we will still cover some essential setup for components we will use in <a href="6a8f64fb-080f-47a2-9565-4099269831b1.xhtml" target="_blank">Chapter 10</a>, <em>Mixing in Mixed Reality</em>, so don't feel you can bypass the next chapter, even if you are not doing web development.</p>


            

            
        
    </body></html>