<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Working with Text and the Virtual Keyboard</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using device fonts within text fields</li><li class="listitem" style="list-style-type: disc">Using embedded fonts within text fields</li><li class="listitem" style="list-style-type: disc">Providing text entry</li><li class="listitem" style="list-style-type: disc">Capturing text input</li><li class="listitem" style="list-style-type: disc">Configurable panning with virtual keyboard activation</li><li class="listitem" style="list-style-type: disc">Updating dynamic text fields</li><li class="listitem" style="list-style-type: disc">Using native iOS text controls</li></ul></div><div><div><div><div><h1 class="title"><a id="ch07lvl1sec01"/>Introduction</h1></div></div></div><p>With the omission of physical buttons the iPhone has changed forever how many of us will enter text. Gone are the fixed keypad configurations of previous phones; replaced instead by a touch-screen keyboard that adapts its keys and layout for different applications. In addition, iOS comes with a comprehensive library of fonts and impressive text rendering capabilities, allowing user input to be shown in crisp detail.</p><p>In this chapter, you will explore Flash's support for the native iOS virtual keyboard and learn how to work with text.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec02"/>Using device fonts within text fields</h1></div></div></div><p>A comprehensive list of fonts is installed on iOS devices and is available for use directly within your AIR for iOS app.<a id="id584" class="indexterm"/>
</p><p>This recipe will take you through the steps required to create a text field that uses a device font.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec01"/>Getting ready</h2></div></div></div><p>From the book's accompanying code bundle, open<code class="literal"> chapter7\recipe1\recipe.fla</code> into Flash Professional. The FLA's stage is empty but its AIR for iOS settings have already been applied, saving you the time and effort when you build and deploy it to a device.<a id="id585" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec02"/>How to do it...</h2></div></div></div><p>Perform the following steps to take advantage of a device font:</p><div><ol class="orderedlist"><li class="listitem">Using the<strong> Text Tool (T)</strong> , draw a text field on the stage.<div><img src="img/1383_07_01.jpg" alt="How to do it..."/></div></li><li class="listitem">Enter<strong> Flash iOS Apps Cookbook</strong> into the text field.</li><li class="listitem">From the<strong> Properties</strong> panel, ensure that<strong> Classic Text</strong> and<strong> Dynamic Text</strong> are selected from the two top-most drop-down boxes.</li><li class="listitem">Position the text field at (21,52). Set its width and height to 278 and 240 respectively.</li><li class="listitem">Expand the<strong> CHARACTER</strong> section within the Properties panel. Set the<strong> Family</strong> drop-down to<strong> Trebuchet MS</strong>, the<strong> Size</strong> to<strong> 60.0</strong> pt, and change the font color to black. Also, select<strong> Use device fonts</strong> for the<strong> Anti-alias</strong> field and ensure that the<strong> Selectable</strong> icon directly underneath is not selected. All these settings are shown in the preceding screenshot.<a id="id586" class="indexterm"/></li><li class="listitem">Finally, expand the<strong> PARAGRAPH</strong> section. Select<strong> Align center</strong> for the<strong> Format</strong> field and<strong> Multiline</strong> from the<strong> Behavior</strong> field's drop-down box.</li><li class="listitem">Save your FLA.</li><li class="listitem">Publish the FLA and install the IPA on your device.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec03"/>How it works...</h2></div></div></div><p>Although Flash can embed fonts directly within your SWF, iOS provides its own, which can be used instead. These are known as<strong> device fonts</strong> and using them carries a number of advantages:<a id="id587" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The final size of your app will be reduced as there will be no need for Flash to include any of the font's glyphs directly within your SWF</li><li class="listitem" style="list-style-type: disc">It will guarantee that the font renders identically to other iOS apps that use it</li><li class="listitem" style="list-style-type: disc">Device fonts render to the screen faster than fonts embedded by Flash</li></ul></div><p>Device fonts have a few drawbacks too, which might dictate whether or not you can use them in your project:<a id="id588" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Alpha transparency can't be applied directly to your text</li><li class="listitem" style="list-style-type: disc">Embedded fonts will not render if the text field has been rotated</li></ul></div><p>If you select a font that is available on the device, then ensure that<strong> Use device fonts</strong> is selected from the<strong> Anti-alias</strong> field. The fonts must also be installed on your development computer or you won't be able to select them from Flash Professional.</p><p>Flash can't stop you from selecting a font that is not actually installed on your device—there is no way for it to tell. If a font you selected isn't available, then all text fields that require its use will default to<strong> _sans</strong>.</p><p>Device fonts can be used with all three classic text types: static, dynamic, and input text.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec04"/>There's more...</h2></div></div></div><p>Choosing the correct fonts for your application is important. First you need to know which fonts are actually available.<a id="id589" class="indexterm"/>
</p><div><div><div><div><h3 class="title"><a id="ch07lvl3sec01"/>Device fonts on iOS</h3></div></div></div><p>Not being able to tell from Flash Professional's IDE which fonts are actually embedded on your device can be problematic. Fortunately, there are several apps that list the fonts installed on a device and let you preview them at various point sizes. Most will also let you enter and preview your own text.<a id="id590" class="indexterm"/>
</p><p>Two apps worth taking a look at are<strong> Fast Fonts</strong> and<strong> Fonts</strong>. Both are free and can be downloaded from iTunes or the App Store.<a id="id591" class="indexterm"/>
</p><p>Be careful, the number of installed fonts varies across devices and versions of iOS. For example, on iOS 4.3, 40 font families are installed on iPhone whereas iPad has 57. Check the availability of a font across all devices you wish to target before using it.</p><p>The following are a few device fonts that are commonly used:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Serif: Times New Roman, Georgia, and _serif<a id="id592" class="indexterm"/></li><li class="listitem" style="list-style-type: disc">Sans-serif: Helvetica, Arial, Verdana, Trebuchet, Tahoma, and _sans<a id="id593" class="indexterm"/></li><li class="listitem" style="list-style-type: disc">Fixed-width: Courier, Courier New, and _typewriter<a id="id594" class="indexterm"/></li></ul></div><p>For a complete list of the fonts supported on the most recent version of iOS, take a look at the iOS Fonts website at<a class="ulink" href="http://iosfonts.com."> http://iosfonts.com.</a>
<a id="id595" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec02"/>Enumerating the available device fonts</h3></div></div></div><p>It is possible to determine the fonts that are installed on a device. The following is a simple code example:<a id="id596" class="indexterm"/>
</p><div><pre class="programlisting">var f:Font;
var fonts:Array = Font.enumerateFonts(true);
for(var i:int = 0; i &lt; fonts.length; i++)
{
f = fonts[i];
trace(f.fontName + "," + f.fontStyle + "," + f.fontType);
}
</pre></div><p>By passing<code class="literal"> true</code> to the static<code class="literal"> Font.enumerateFonts()</code> method, you can retrieve an array of<code class="literal"> Font</code> instances that represent the device's embedded fonts. Simply query an instance's<code class="literal"> fontName, fontStyle</code>, and<code class="literal"> fontType</code> properties to find out more about the font it represents.<a id="id597" class="indexterm"/>
</p><p>Also, you will need to import<code class="literal"> flash.text.Font</code> before using the<code class="literal"> Font</code> class. To find out more about each property, perform a search for the<code class="literal"> Font</code> class within Adobe Community Help.<a id="id598" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec03"/>Pixel density</h3></div></div></div><p>The pixel density of your iOS device is likely to be higher than that of a typical monitor. Font sizes that look adequate when working within Flash Professional could potentially be too small when viewed on an actual device. This is particularly true when targeting the iPhone 4/4S's Retina display. An app such as Fast Fonts will help you select a suitable size directly from your device. Try not to use a point size lower than 14.<a id="id599" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec04"/>TLF text</h3></div></div></div><p>Flash Professional CS5 introduced a new text engine called<strong> Text Layout Framework (TLF).</strong>  While TLF provides superior text layout features compared to the previous classic text engine, it is not recommended that you use it when targeting iOS due to the framework's heavy performance constraints. TLF text will not be covered in this book.<a id="id600" class="indexterm"/>
</p></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec05"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Using embedded fonts within text fields</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec03"/>Using embedded fonts within text fields</h1></div></div></div><p>It is likely that you will eventually want to make use of a font that isn't installed on your device. When this is the case, you can embed the font allowing it to be rendered correctly within your app.<a id="id601" class="indexterm"/>
</p><p>Let us see how this is done.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec06"/>Getting ready</h2></div></div></div><p>Launch Flash Professional and open<code class="literal"> chapter7\recipe2\recipe.fla</code> from the book's accompanying code bundle. The FLA's stage is empty but its AIR for iOS settings have already been applied letting you easily publish once you are ready.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec07"/>How to do it...</h2></div></div></div><p>The Impact font isn't installed on iOS devices. Let us create a text field that makes use of it by embedding the font directly within your app.<a id="id602" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Select the<strong> Text Tool (T)</strong>  and draw a text field on the stage.</li><li class="listitem">Enter<strong> Flash iOS Apps Cookbook</strong> into the text field.</li><li class="listitem">From the<strong> Properties</strong> panel, select<strong> Classic Text</strong> and<strong> Dynamic Text</strong> from the two top-most drop-down boxes.</li><li class="listitem">Position the text field at (21,52). Set its width and height to 278 and 240 respectively.</li><li class="listitem">Expand the<strong> CHARACTER</strong> section within the Properties panel. Set the<strong> Family</strong> field to<strong> Impact</strong>, the<strong> Size</strong> to<strong> 60.0</strong> pt, and change the font color to black. Also, ensure that the<strong> Selectable</strong> icon is not selected.</li><li class="listitem">Staying within the<strong> CHARACTER</strong> section, set the<strong> Anti-alias</strong> field to<strong> Anti-alias for readability</strong>. A<strong> Font Embedding Warning</strong> dialog box may appear stating that you need to select the fonts and characters to embed. If it does, then click on its<strong> Embed</strong> button to open the<strong> Font Embedding</strong> panel. If it doesn't, then simply click on the<strong> Embed</strong> button next to the<strong> Style</strong> field to open the panel as shown in the following screenshot:<div><img src="img/1383_07_02.jpg" alt="How to do it..."/></div></li><li class="listitem">From the<strong> Font Embedding</strong> panel, check the<strong> Uppercase [A..Z]</strong> and<strong> Lowercase [a..z]</strong> checkboxes within the<strong> Character ranges</strong> list. Click on the<strong> OK</strong> button to close the panel.<a id="id603" class="indexterm"/></li><li class="listitem">Now expand the<strong> PARAGRAPH</strong> section within the<strong> Properties</strong> panel. Select<strong> Align center</strong> for the<strong> Format</strong> field and<strong> Multiline</strong> from the<strong> Behavior</strong> field's drop-down box.</li><li class="listitem">Save your FLA.</li><li class="listitem">Publish the FLA and install the IPA on your device.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec08"/>How it works...</h2></div></div></div><p>Any font installed on your computer can be embedded within your SWF. This will allow the font to be rendered correctly within your app, even if it is not available directly from your device.<a id="id604" class="indexterm"/>
</p><p>You can manage the fonts you would like to embed from the Font Embedding panel, which is launched by clicking on the<strong> Embed</strong> button on the Properties panel. From here you can also set the range of characters that you wish to include for a particular font. It is important you select only the characters that are required as your app's file size will increase with the number of character glyphs you add. Additionally, you can export fonts for ActionScript usage from this panel too.<a id="id605" class="indexterm"/>
</p><p>Embedded fonts can be used with all classic text field types. However, when using a static text field, you have no control over the range of characters that get embedded into your SWF. Instead, Flash simply includes the characters that appear within the field.</p><p>When using embedded fonts, make sure the text field's<strong> Anti-alias</strong> option is set to anything other than<strong> Use device fonts</strong>. Setting it to<strong> Use device fonts</strong> won't actually embed the font and will instead assume that the font comes installed with the device.</p><p>Only embed a font if it isn't available on the device and there isn't a suitable alternative device font that you can use. Embedded fonts increase the size of your app and in most cases don't render as quickly as device fonts.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec09"/>There's more...</h2></div></div></div><p>You should carefully manage the fonts you embed and try to keep your app's file size as small as possible.</p><div><div><div><div><h3 class="title"><a id="ch07lvl3sec05"/>Size considerations</h3></div></div></div><p>Embedding a font is useful when that font isn't available directly from the device. However, embedded fonts can impact the final size of your app.<a id="id606" class="indexterm"/>
</p><p>You can generate a size report from Flash, which provides a breakdown of all the assets within your SWF and how much of the SWF's file size they consume. This report will also include size information for each of your embedded fonts. Simply move to the<strong> Publish Settings</strong> panel and check the<strong> Generate Size Report</strong> checkbox. Flash CS5 users should click on the<strong> Flash</strong> tab within the<strong> Publish Settings</strong> panel first.</p><p>When you publish the FLA, a size report will be generated and displayed in the<strong> Output</strong> panel. Within the report is a section where you can see a list of the embedded fonts and their character sets. The number of bytes used by each font is also shown.</p><p>The following is the result taken from the size report for this recipe's FLA:</p><div><pre class="programlisting">Font Name Bytes Characters
--------- ---------- ----------
Impact 6606 ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijk lmnopqrstuvwxyz
</pre></div><p>As you can see, approximately 7 KB is required to hold this font's character set.</p><p>Move back to the Font Embedding panel and include all the font's glyphs by checking the first checkbox within the<strong> Character ranges</strong> list.</p><p>Re-publish the FLA and take a look at the new size report. The font now consumes almost 47 KB!<a id="id607" class="indexterm"/>
</p><div><h3 class="title"><a id="note43"/>Note</h3><p>It is important that you include only fonts that are required and that you keep each font's character set to the absolute minimum. Your app's final file size can quickly escalate due to poor management of embedded fonts.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec10"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Using device fonts within text fields</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec04"/>Providing text entry</h1></div></div></div><p>All iOS devices forego a physical keyboard in favor of a virtual touch-screen equivalent. AIR provides virtual keyboard support, allowing a user to enter text within an input text field.<a id="id608" class="indexterm"/>
</p><p>Let us see how this is done.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec11"/>Getting ready</h2></div></div></div><p>An FLA has been provided as a starting point for this recipe.</p><p>From the book's accompanying code bundle, open<code class="literal"> chapter7\recipe3\recipe.fla</code> into Flash Professional.<a id="id609" class="indexterm"/>
</p><p>Three static text fields are already sitting on the stage and will act as labels. We will add three input text fields to the stage, associating one with each of the labels.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec12"/>How to do it...</h2></div></div></div><p>Perform the following steps to create the three input text fields:<a id="id610" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Create a new layer on the timeline by selecting<strong> Insert</strong> |<strong> Timeline</strong> |<strong> Layer</strong>.</li><li class="listitem">Select the<strong> Text Tool (T)</strong>  from the Tools panel.</li><li class="listitem">On the newly created layer, draw a text field adjacent to the<strong> Forename</strong> text field as shown in the following screenshot:<div><img src="img/1383_07_03.jpg" alt="How to do it..."/></div></li><li class="listitem">From the<strong> Properties</strong> panel, select<strong> Classic Text</strong> and<strong> Input Text</strong> from the two top-most drop-down boxes.<a id="id611" class="indexterm"/></li><li class="listitem">Expand the Properties panel's<strong> CHARACTER</strong> section. Set the<strong> Family</strong> drop-down to<strong> Trebuchet MS</strong>, the<strong> Size</strong> to<strong> 20.0</strong> pt, and the text color to black. Also, set the<strong> Anti-alias</strong> field to<strong> Use device fonts</strong> and select the<strong> Show border around text</strong> icon.</li><li class="listitem">Position the text field at (114,33) and set its size to 193x28.</li><li class="listitem">Expand the<strong> PARAGRAPH</strong> section. Set the<strong> Format</strong> by selecting the<strong> Align right</strong> icon, and select<strong> Single line</strong> from the<strong> Behavior</strong> drop-down box.</li><li class="listitem">Create a second input text field similar to the first. Position this one next to the<strong> Surname</strong> label at (114,83) and set its<strong> Format</strong> field to<strong> Align center</strong>.</li><li class="listitem">Finally draw a third input text field directly below the<strong> Details</strong> label. Position it at (11,174) and set its size to 298x154. Within the<strong> PARAGRAPH</strong> section, select the<strong> Align left</strong> icon for the<strong> Format</strong> field and select<strong> Multiline</strong> from the<strong> Behavior</strong> drop-down box.<a id="id612" class="indexterm"/></li><li class="listitem">Save your FLA.</li><li class="listitem">Publish the FLA and install the IPA on your device.</li><li class="listitem">Run the app and enter text into each of the fields.</li></ol></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec13"/>How it works...</h2></div></div></div><p>The virtual keyboard will automatically appear when a user touches any input text field. Many of the same features provided by native iOS applications are also available directly from your input text fields, including predictive text and a button to clear the field. Apps running on iOS 4 or above will also benefit from copy and paste support.<a id="id613" class="indexterm"/>
</p><p>The first two fields are single-line and, if text has been entered, will provide a clear button on the far-right. However, if the text field is too narrow, the button won't be shown.</p><p>When you have finished entering text into a single-line text field, you can dismiss the virtual keyboard by tapping the<strong> Done</strong> key or by tapping outside the text field.</p><div><h3 class="title"><a id="note44"/>Note</h3><p>If you built your app using Flash Professional CS5, then you will notice that the alignment settings for the<strong> Forename</strong> and<strong> Surname</strong> fields are ignored when entering text. When using the AIR 2.0 SDK, input text fields in iOS only support left alignment. It is, therefore, recommended that you don't select alternative alignments when working with CS5.</p></div><p>When editing the<strong> Details</strong> field, which is multiline, the virtual keyboard doesn't provide a<strong> Done</strong> key. Instead a<strong> return</strong> key is found in its place, allowing the user to jump to the next line. To dismiss the virtual keyboard when editing a multiline input text field, the user must tap anywhere outside the field. Unfortunately this is not standard practice for iOS apps and may confuse users. Also, make sure you include an area outside the text field that the user can tap. If the field is too large, then it may be impossible for the user to dismiss the keyboard.</p><p>The position of input text fields is important. If the field you wish to edit sits within the area used by the virtual keyboard, then AIR will adjust the position of the stage at runtime. You can see this by attempting to edit the<strong> Details</strong> input text field. The stage will be panned, ensuring that the field isn't obscured. Both the<strong> Forename</strong> and<strong> Surname</strong> input fields, however, are pushed out of view to make room for<strong> Details</strong>.</p><div><h3 class="title"><a id="tip15"/>Tip</h3><p>When designing your application, take into consideration the area used by the keyboard and the effects of editing a text field that sits within this area.</p></div><p>You should also ensure that the height of your multiline text fields does not exceed the height remaining after the virtual keyboard has been raised as text field scrolling is not directly provided.<a id="id614" class="indexterm"/>
</p><div><h3 class="title"><a id="tip16"/>Tip</h3><p>To improve performance and render quality, use device fonts over embedded fonts within your input text fields.</p></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec14"/>There's more...</h2></div></div></div><p>Activation of the virtual keyboard and its many text editing features comes free of charge. But what if you want a little more control?</p><div><div><div><div><h3 class="title"><a id="ch07lvl3sec06"/>Keyboard types</h3></div></div></div><p>Whereas those developing native apps using the iOS SDK can configure the type of keyboard that appears, AIR does not currently provide such control when working with input text fields. You are limited to two very similar layouts—one for single-line input fields and another for multiline.<a id="id615" class="indexterm"/>
</p><p>If the virtual keyboard does not meet your requirements, then consider using the native iOS text controls provided by AIR 3.0. Doing so will provide you with access to additional keyboard configurations. Refer to the<em> Using native iOS text controls</em> recipe at the end of this chapter for more detail.</p></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec07"/>Launching the virtual keyboard programmatically</h3></div></div></div><p>The virtual keyboard is launched automatically when a user taps on an input text field. However, there may be times when you need to launch the keyboard programmatically using ActionScript.<a id="id616" class="indexterm"/>
</p><p>In AIR 2.6 and above, you can force the virtual keyboard to appear by setting a text field's<code class="literal"> needsSoftKeyboard</code> property to<code class="literal"> true</code> and then calling its<code class="literal"> requestSoftKeyboard()</code> method. The following code is an example that launches the virtual keyboard by setting focus on a text field with an instance name of<code class="literal"> forename</code>.<a id="id617" class="indexterm"/>
</p><div><pre class="programlisting">forename.needsSoftKeyboard = true;
var success:Boolean = forename.requestSoftKeyboard();
</pre></div><p>The<code class="literal"> requestSoftKeyboard()</code> method returns a Boolean value indicating whether or not the virtual keyboard was successfully raised.<a id="id618" class="indexterm"/>
</p><p>If you are using Flash Professional CS5 and AIR 2.0, then you can force the virtual keyboard to appear by using the<code class="literal"> Stage</code> class'<code class="literal"> focus</code> property. The following code is an example using a text field with an instance name of<code class="literal"> forename:</code>
<a id="id619" class="indexterm"/>
</p><div><pre class="programlisting">stage.focus = forename;
</pre></div><p>Remember you can retrieve a reference to the stage from any<code class="literal"> DisplayObject</code> including your document class. The<code class="literal"> DisplayObject</code> class provides a<code class="literal"> stage</code> property that you can access.<a id="id620" class="indexterm"/>
</p></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec15"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Capturing text input</em></li><li class="listitem" style="list-style-type: disc"><em>Configurable panning with virtual keyboard activation</em></li><li class="listitem" style="list-style-type: disc"><em>Using native iOS text controls</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec05"/>Capturing text input</h1></div></div></div><p>You can obtain text stored within any non-static text field. This is particularly useful for input text fields where an app may want to immediately respond to the user's input or collect the information for use later.<a id="id621" class="indexterm"/>
</p><p>This recipe will show you how to capture user input.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec16"/>Getting ready</h2></div></div></div><p>From the book's accompanying code bundle, open<code class="literal"> chapter7\recipe4\recipe.fla</code> into Flash Professional.</p><p>An input text field named<code class="literal"> submit</code> is sitting on the stage. Beneath it is a dynamic text field named<code class="literal"> echo</code>.</p><p>We will write some ActionScript to grab any text that the user enters into the<code class="literal"> submit</code> field and display it within the<code class="literal"> echo</code> field.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec17"/>How to do it...</h2></div></div></div><p>Perform the following steps:<a id="id622" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Create a document class named<code class="literal"> Main</code>.</li><li class="listitem">Within the class, listen for<code class="literal"> FocusEvent.FOCUS_OUT</code> being dispatched from the<code class="literal"> submit</code> input field. You will also need to add an import statement for the<code class="literal"> FocusEvent</code> class:<div><pre class="programlisting">package {
import flash.display.MovieClip;
<strong>import flash.events.FocusEvent;</strong>
public class Main extends MovieClip {
public function Main() {
<strong>submit.addEventListener(FocusEvent.FOCUS_OUT,
focusLost);</strong>
}
}
}
</pre></div></li><li class="listitem">Now, add a handler for the<code class="literal"> FOCUS_OUT</code> event:<div><pre class="programlisting">private function focusLost(e:FocusEvent):void {
echo.text = e.target.text;
}
</pre></div></li><li class="listitem">Save the class and when prompted name the file<code class="literal"> Main.as</code>.</li><li class="listitem">Finally save and compile the FLA. Test the app on your device.</li></ol></div><p>Any text you enter into the input text field will be echoed to the dynamic text field below it. This will happen whenever you tap outside the input field.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec18"/>How it works...</h2></div></div></div><p>Both dynamic and input fields provide a<code class="literal"> text</code> property that can be used to get or set their current text. However, before we can obtain the<code class="literal"> submit</code> field's text, we need to know when the user has actually finished typing. We can tell this by listening for the<code class="literal"> FOCUS_OUT</code> event, which is dispatched by an input text field in response to the following user actions:<a id="id623" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The user touches the screen anywhere outside the text field's bounds</li><li class="listitem" style="list-style-type: disc">The user taps the virtual keyboard's<strong> Done</strong> key</li></ul></div><p>Within this recipe's code, the<code class="literal"> focusLost()</code> handler responds to the<code class="literal"> submit</code> field's<code class="literal"> FOCUS_OUT</code> event. It sets the text within the<code class="literal"> echo</code> field to that of the<code class="literal"> submit</code> field. The following is the handler's code again:</p><div><pre class="programlisting">private function focusLost(e:FocusEvent):void {
echo.text = e.target.text;
}
</pre></div><p>The<code class="literal"> submit</code> field is actually accessed through the<code class="literal"> FocusEvent</code> parameter's<code class="literal"> target</code> property. We can do this because the<code class="literal"> FOCUS_OUT</code> event was dispatched from the<code class="literal"> submit</code> field making it the event's target. Alternatively, we could have ignored the actual<code class="literal"> FocusEvent</code> parameter and accessed the<code class="literal"> submit</code> field directly by using the following code snippet:<a id="id624" class="indexterm"/>
</p><div><pre class="programlisting">private function focusLost(e:FocusEvent):void {
echo.text = submit.text;
}
</pre></div><p>As the recipe has shown, the mechanics of retrieving and setting text within fields is trivial. When capturing a user's text input, however, you first need to make sure the user has finished typing.</p><p>For more information perform a search for<code class="literal"> flash.text.TextField</code> and<code class="literal"> flash.events.FocusEvent</code> within Adobe Community Help.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec19"/>There's more...</h2></div></div></div><p>Before we move on, the following is some additional information.</p><div><div><div><div><h3 class="title"><a id="ch07lvl3sec08"/>Listening for focus</h3></div></div></div><p>As well as<code class="literal"> FocusEvent.FOCUS_OUT</code>, you can also listen for the<code class="literal"> FOCUS_IN</code> event, which lets you know when a user has tapped on an input text field. This is ideal if you need to carry out any preparation before the user starts entering text. For example, you may want to clear a field's current text before the user starts typing. Let us go ahead and implement this.<a id="id625" class="indexterm"/>
</p><p>Within your document class' constructor, listen for the<code class="literal"> FOCUS_IN</code> event:</p><div><pre class="programlisting">submit.addEventListener(FocusEvent.FOCUS_IN, clearField);
</pre></div><p>Now add a handler for the event, which simply clears the text field:</p><div><pre class="programlisting">private function clearField(e:FocusEvent):void {
e.target.text = "";
}
</pre></div><p>Save the class and test the latest version of the app on your device.</p></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec20"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Providing text entry</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec07"/>Configurable panning with virtual keyboard activation</h1></div></div></div><p>The virtual keyboard appears automatically when a user touches an input text field. If the text field sits within the region used by the keyboard, then the stage will automatically pan to prevent the text field from being obscured. However, it is possible to switch off this default behavior and modify the layout yourself in response to the keyboard being activated.<a id="id626" class="indexterm"/>
</p><p>The steps covered here are applicable only to those using Flash Professional CS5.5 and AIR 2.6 or above.</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec21"/>Getting ready</h2></div></div></div><p>An FLA has been provided as a starting point.</p><p>From the book's accompanying code bundle, open<code class="literal"> chapter7\recipe5\recipe.fla</code> into Flash Professional.</p><p>Centered on the stage is an input text field named<code class="literal"> field</code>. We will write some ActionScript to reposition this text field when the virtual keyboard is activated.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec22"/>How to do it...</h2></div></div></div><p>First, you will need to switch off automatic panning from the application descriptor file.<a id="id627" class="indexterm"/>
</p><div><ol class="orderedlist"><li class="listitem">Select<strong> File</strong> |<strong> Open</strong> from Flash Professional CS5.5. From the file browser, select<code class="literal"> recipe-app.xml</code>, which can be found within the same folder as your FLA.</li><li class="listitem">Add the following line to the descriptor file's XML:<div><pre class="programlisting">&lt;initialWindow&gt;
&lt;content&gt;recipe.swf&lt;/content&gt;
&lt;systemChrome&gt;standard&lt;/systemChrome&gt;
&lt;transparent&gt;false&lt;/transparent&gt;
&lt;visible&gt;true&lt;/visible&gt;
&lt;fullScreen&gt;true&lt;/fullScreen&gt;
&lt;aspectRatio&gt;portrait&lt;/aspectRatio&gt;
&lt;renderMode&gt;gpu&lt;/renderMode&gt;
&lt;autoOrients&gt;false&lt;/autoOrients&gt;
<strong>&lt;softKeyboardBehavior&gt;none&lt;/softKeyboardBehavior&gt;</strong>
&lt;/initialWindow&gt;
</pre></div></li><li class="listitem">Save the file.</li><li class="listitem">Now, create a document class for your FLA and name it<code class="literal"> Main</code>.</li><li class="listitem">Add the following import statements:<div><pre class="programlisting">import flash.display.MovieClip;
<strong>import flash.events.SoftKeyboardEvent;
import flash.geom.Rectangle;</strong>
</pre></div></li><li class="listitem">Within the constructor, listen for the virtual keyboard being activated and deactivated:<div><pre class="programlisting">public function Main() {
<strong>stage.addEventListener(
SoftKeyboardEvent.SOFT_KEYBOARD_ACTIVATE, activate);
stage.addEventListener(
SoftKeyboardEvent.SOFT_KEYBOARD_DEACTIVATE, deactivate);
}</strong>
</pre></div></li><li class="listitem">Add a handler for the<code class="literal"> SOFT_KEYBOARD_ACTIVATE</code> event. It will be called when the virtual keyboard has been activated and will position the input text field outside of the keyboard's bounds:<a id="id628" class="indexterm"/><div><pre class="programlisting">private function activate(e:SoftKeyboardEvent):void {
var keysRect:Rectangle = stage.softKeyboardRect;
if(field.y + field.height &gt; keysRect.top)
{
offset = field.y + field.height - keysRect.top;
field.y -= offset;
}
else
{
offset = 0;
}
}
</pre></div></li><li class="listitem">The<code class="literal"> activate()</code> handler calculates the number of pixels the text field needs to be moved by vertically in order to be positioned outside the keyboard's bounding area. This value is stored within a member variable named<code class="literal"> offset</code>. Declare the<code class="literal"> offset</code> member variable within your class:<a id="id629" class="indexterm"/><div><pre class="programlisting">public class Main extends MovieClip {
<strong>private var offset:Number;</strong>
public function Main() {
</pre></div></li><li class="listitem">Finally, we need to place the text field back in its original position when the keyboard is removed. The handler for the<code class="literal"> SOFT_KEYBOARD_DEACTIVATE</code> event will use the<code class="literal"> offset</code> member variable to take care of this:<div><pre class="programlisting">private function deactivate(e:SoftKeyboardEvent):void {
field.y += offset;
}
</pre></div></li><li class="listitem">Save the class and when prompted, name the file<code class="literal"> Main.as</code>. Also save your FLA.</li><li class="listitem">Publish the app and test it on your device.</li></ol></div><p>When you select the input text field, the virtual keyboard will be shown and the field will be repositioned directly above it. Tapping outside the field will place it back in its original position after the keyboard has left the screen.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec23"/>How it works...</h2></div></div></div><p>Normally the stage is automatically panned if the virtual keyboard obscures the input text field that has focus. However, we disabled this default behavior by setting the<code class="literal"> softKeyboardBehavior</code> element in the application descriptor file to<code class="literal"> none:</code>
<a id="id630" class="indexterm"/>
</p><div><pre class="programlisting">&lt;softKeyboardBehavior&gt;none&lt;/softKeyboardBehavior&gt;
</pre></div><div><h3 class="title"><a id="note45"/>Note</h3><p>The term<strong> Soft Keyboard</strong> refers to a software keyboard, which is AIR's generic term for the virtual keyboard used by iOS.</p></div><p>With automatic panning switched off, we can simply change the application's layout whenever the user taps on an input text field, and change it back when the user has finished typing.</p><p>In order to do this, we listened for the following two events being dispatched from the stage:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">SoftKeyboardEvent.SOFT_KEYBOARD_ACTIVATE</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">SoftKeyboardEvent.SOFT_KEYBOARD_DEACTIVATE</code></li></ul></div><p>The<code class="literal"> SOFT_KEYBOARD_ACTIVATE</code> event is fired when the virtual keyboard appears on screen. It is in response to this event that we reposition the input text field. When the user taps outside an input text field or presses the<strong> Done</strong> key, the virtual keyboard is dismissed and<code class="literal"> SOFT_KEYBOARD_DEACTIVATE</code> is dispatched. When we capture this event, we place the input text field back in its original position.<a id="id631" class="indexterm"/>
</p><p>Although it is perfectly acceptable to hard-code the positions of the text field for these two events, our example code goes a little further and dynamically shifts the text field away from the area occupied by the keyboard, before shifting it back once the keyboard is dismissed.</p><p>It does this by first checking to see if the input text field is within the keyboard's bounding region. If so it positions the text field above the keyboard by calculating how far it needs to be offset by. The following is the code again:</p><div><pre class="programlisting">private function activate(e:SoftKeyboardEvent):void {
var keysRect:Rectangle = stage.softKeyboardRect;
if(field.y + field.height &gt; keysRect.top)
{
offset = field.y + field.height - keysRect.top;
field.y -= offset;
}
else
{
offset = 0;
}
}
</pre></div><p>The virtual keyboard's bounding region is retrieved from<code class="literal"> Stage.softKeyboardRect</code> and represents the area of the stage that is covered by the virtual keyboard. Be careful when using this property as it will return a size of zero when the keyboard is not visible. Also notice that the offset is stored within our<code class="literal"> offset</code> member variable and will be set to zero if the text field doesn't fall within the keyboard's bounds.<a id="id632" class="indexterm"/>
</p><p>Finally, when the virtual keyboard is dismissed, we use the value of the<code class="literal"> offset</code> member variable to shift the text field back:</p><div><pre class="programlisting">private function deactivate(e:SoftKeyboardEvent):void {
field.y += offset;
}
</pre></div><p>For more information, perform a search for<code class="literal"> flash.events.SoftKeyboardEvent</code> and<code class="literal"> Stage.softKeyboardRect</code> within Adobe Community Help.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec24"/>There's more...</h2></div></div></div><p>You may find the following information of interest.</p><div><div><div><div><h3 class="title"><a id="ch07lvl3sec09"/>Related object</h3></div></div></div><p>The<code class="literal"> SoftKeyboardEvent</code> class provides the<code class="literal"> relatedObject</code> property, which holds the<code class="literal"> InteractiveObject</code> that previously had focus. This is useful when listening for<code class="literal"> SoftKeyboardEvent.DEACTIVATE</code> as you will be able to determine which input text field the user was last editing.<a id="id633" class="indexterm"/>
</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec08"/>Updating dynamic text fields</h1></div></div></div><p>Rendering text is expensive and can reduce the overall performance of your app. This is particularly noticeable on older devices such as the first and second-generation iPhone and iPod touch where every CPU cycle counts. Minimize the amount of text you update and the frequency with which these updates take place.<a id="id634" class="indexterm"/>
</p><p>Let us look at ways to do this.<a id="id635" class="indexterm"/>
</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec25"/>Getting ready</h2></div></div></div><p>An FLA has been provided at<code class="literal"> chapter7\recipe6\recipe.fla</code> within the book's accompanying code bundle.</p><p>You will find two text fields sitting on the stage. The first is static and contains the text<strong> Elapsed Time:</strong>. The second is dynamic, contains a zero and has an instance name of<code class="literal"> timerField</code>.</p><p>We will write some ActionScript to continuously update the<code class="literal"> timerField</code> with the number of seconds that have elapsed since the app was launched.<a id="id636" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec26"/>How to do it...</h2></div></div></div><p>Let us go ahead and do this by performing the following steps:</p><div><ol class="orderedlist"><li class="listitem">Create a document class and named it<code class="literal"> Main</code>.</li><li class="listitem">We will require two member variables. One to store the time the app was launched and another to store the number of seconds that have elapsed. Let us also initialize both variables within the class' constructor:<div><pre class="programlisting">package {
import flash.display.MovieClip;
public class Main extends MovieClip {
<strong>
private var startTime:Date;
private var elapsed:uint;
</strong>
public function Main() {
<strong>
startTime = new Date();
elapsed = 0;
</strong>
}
}
}
</pre></div></li><li class="listitem">We will use a loop to calculate the number of seconds that have elapsed and update the<code class="literal"> timerField</code> with that value. The loop will be called on every frame redraw.<a id="id637" class="indexterm"/><p>First, add a listener for <code class="literal">Event.ENTER_FRAME</code> and also add an import statement for the <code class="literal">Event</code> class:
</p><div><pre class="programlisting">package {
import flash.display.MovieClip;
<strong>import flash.events.Event;</strong>
public class Main extends MovieClip {
private var startTime:Date;
private var elapsed:uint;
public function Main() {
startTime = new Date();
elapsed = 0;
<strong>addEventListener(Event.ENTER_FRAME, update);</strong>
}
}
}
</pre></div></li><li class="listitem">Now, add the event handler that will act as the update loop:<div><pre class="programlisting">private function update(e:Event):void {
var currTime:Date = new Date();
var prevElapsed:uint = elapsed;
elapsed = (currTime.getTime()-startTime.getTime()) / 1000;
if(elapsed != prevElapsed)
{
timerField.text = String(elapsed);
}
}
</pre></div></li><li class="listitem">Save the class and when prompted, name the file<code class="literal"> Main.as</code>. Save the FLA.</li><li class="listitem">Compile the app and deploy it to your device.</li></ol></div><p>When you test the app, you should see the dynamic text field continuously update with the number of seconds that have elapsed.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec27"/>How it works...</h2></div></div></div><p>Although the<code class="literal"> update()</code> handler is called on every<code class="literal"> ENTER_FRAME</code>, we only set the elapsed time within the text field when it has actually changed. A common mistake is to repeatedly write an identical string to a text field, which is unnecessary and will degrade performance. We guard against this with the following<code class="literal"> if</code> statement:<a id="id638" class="indexterm"/>
</p><div><pre class="programlisting">if(elapsed != prevElapsed)
{
timerField.text = String(elapsed);
}
</pre></div><p>Basically the text field only gets updated if the number of seconds that have elapsed differs from the value used in the previous call to the loop. For this recipe, it means the text field only gets updated once every second rather than 24 times per second (the FLA's frame rate). This is a significant saving.<a id="id639" class="indexterm"/>
</p><p>As well as reducing the frequency with which a text field is updated, we can also improve performance by only setting the characters that need to change. The two text fields within this recipe could easily have been represented by a single field. If we had taken this approach, then the code to update the field would have looked like this:</p><div><pre class="programlisting">timerField.text = "Elapsed Time: " + elapsed;
</pre></div><p>Of course this is wasteful, as the string<strong> Elapsed Time:</strong> would be written to the text field every time. Displaying and updating just the time within its own separate text field helped further improve the performance of this recipe's app.</p><p>Although these suggestions may seem obvious, they are often overlooked by developers used to targeting the Flash and AIR desktop runtimes. Every saving counts when developing for iOS and this is equally true for text, which can have a large performance impact, even for small amounts of text.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec28"/>There's more...</h2></div></div></div><p>The following may help you obtain further performance gains.</p><div><div><div><div><h3 class="title"><a id="ch07lvl3sec10"/>Device fonts</h3></div></div></div><p>This recipe used embedded fonts. However, an additional saving can be made by using the fonts that come installed directly on iOS devices. This will not only reduce the size of your SWF but will also increase performance as device fonts render to the screen faster than embedded fonts. Also, before embedding a font, check to see if it is available on the device.<a id="id640" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec11"/>Appending text</h3></div></div></div><p>Appending a string to the end of a text field is another common task that can be expensive. It is often done using the concatenation assignment operator (+=) and is shown in the following simple example:<a id="id641" class="indexterm"/>
</p><div><pre class="programlisting">textField.text = "Hello ";
textField.text += "Christopher";
</pre></div><p>The<code class="literal"> TextField</code> class, however, provides<code class="literal"> appendText()</code> which performs this operation many times faster:</p><div><pre class="programlisting">textField.text = "Hello ";
textField.appendText("Christopher");
</pre></div><p>If you are appending text, then use this method instead of the concatenation assignment operator.<a id="id642" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec12"/>Replacing text fields with bitmaps</h3></div></div></div><p>Where performance is critical, use bitmaps to represent text.<a id="id643" class="indexterm"/>
</p><p>As an example, consider a game where the user's score is constantly being updated. Using a dynamic text field can hurt performance. Instead, write some ActionScript to display and arrange bitmap representations of each number. Although it will require more effort to code, using bitmaps will typically outperform fonts, which are constructed from complex vector shapes.</p></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec13"/>Cache as Bitmap</h3></div></div></div><p>A text field can be cached as a bitmap, preventing it from being re-rendered under certain circumstances, and providing a performance boost. Caching of text fields cannot be applied from the Flash IDE and instead must be done using ActionScript. Use the<code class="literal"> cacheAsBitmap</code> and<code class="literal"> cacheAsBitmapMatrix</code> properties, which are available to the<code class="literal"> TextField</code> class. Bitmap caching cannot be directly applied to a static text field.<a id="id644" class="indexterm"/>
</p><p>For more information, refer to the<em> Using Cache As Bitmap</em> and<em> Using Cache As Bitmap Matrix</em> recipes from<a class="link" href="ch06.html" title="Chapter 6. Graphics and Hardware Acceleration"> Chapter 6</a>.</p></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec29"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Using an update loop, <a class="link" href="ch03.html" title="Chapter 3. Writing your First App">Chapter 3</a></em></li><li class="listitem" style="list-style-type: disc"><em>Using device fonts within text fields</em></li><li class="listitem" style="list-style-type: disc"><em>Using embedded fonts within text fields</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec09"/>Using native iOS text controls</h1></div></div></div><p>AIR 3.0 introduced the<code class="literal"> StageText</code> class, which provides access to iOS's native text-input controls and the ability to customize the virtual keyboard.</p><p>Let us see how to create a native text input field and specify the type of virtual keyboard that is launched when performing text entry.</p><p>The steps covered here are applicable only to those using AIR 3.0 and above. If you are using Flash Professional CS5, then you will be unable to attempt this recipe as it only supports AIR 2.0.<a id="id645" class="indexterm"/>
</p><div><div><div><div><h2 class="title"><a id="ch07lvl2sec30"/>Getting ready</h2></div></div></div><p>An FLA has been provided as a starting point. From the book's accompanying code bundle, open<code class="literal"> chapter7\recipe7\recipe.fla</code> into Flash Professional CS5.5.<a id="id646" class="indexterm"/>
</p><p>Sitting on the stage is a background bitmap image. We will write some ActionScript to overlay a native text input field, which when tapped will launch a virtual keyboard configured for entering a person's name.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec31"/>How to do it...</h2></div></div></div><p>We will make heavy use of the classes found in the<code class="literal"> flash.text</code> package by performing the following steps:</p><div><ol class="orderedlist"><li class="listitem">Create a document class and name it<code class="literal"> Main</code>.</li><li class="listitem">Add the following import statements to the class:<div><pre class="programlisting">import flash.display.MovieClip;
<strong>
import flash.events.FocusEvent;
import flash.geom.Rectangle;
import flash.text.ReturnKeyLabel;
import flash.text.SoftKeyboardType;
import flash.text.StageText;
import flash.text.TextFormatAlign;
import flash.text.engine.FontWeight;
</strong>
</pre></div></li><li class="listitem">Declare a<code class="literal"> StageText</code> member variable:<div><pre class="programlisting">private var nativeText:StageText;
</pre></div></li><li class="listitem">Now within the constructor, create and initialize a native text input field. As part of initialization, we will ensure that it contains text prompting the user to enter their name:<div><pre class="programlisting">public function Main() {
nativeText = new StageText();
nativeText.stage = stage;
nativeText.viewPort = new Rectangle(30, 28, 420, 116);
nativeText.fontFamily = "ChalkboardSE-Bold";
nativeText.fontSize = 50;
nativeText.color = 0xB88858;
nativeText.fontWeight = FontWeight.BOLD;
nativeText.textAlign = TextFormatAlign.CENTER;
nativeText.text = "enter name";
nativeText.maxChars = 11;
nativeText.softKeyboardType = SoftKeyboardType.CONTACT;
nativeText.returnKeyLabel = ReturnKeyLabel.DONE;
}
</pre></div></li><li class="listitem">In addition, listen for the text field receiving focus when the user touches it by adding the highlighted code:<div><pre class="programlisting">nativeText.returnKeyLabel = ReturnKeyLabel.DONE;
nativeText.addEventListener(FocusEvent.FOCUS_IN, focusIn);
}
</pre></div></li><li class="listitem">When it receives focus, we will remove the field's default text, allowing the user to enter their name without first having to delete characters. The following code snippet is the event handler for this:<a id="id647" class="indexterm"/><div><pre class="programlisting">private function focusIn(e:FocusEvent):void {
if(nativeText.text == "enter name")
{
nativeText.text = "";
}
}
</pre></div></li><li class="listitem">Save the class and when prompted name the file<code class="literal"> Main.as</code>.</li><li class="listitem">Move back to your FLA and save it. Now publish the app and test it on your device.</li></ol></div><div><img src="img/1383_07_04.jpg" alt="How to do it..."/></div><p>Tap the<strong> enter name</strong> text field and use the virtual keyboard to input text. Press the<strong> Done</strong> key to commit your changes.<a id="id648" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec32"/>How it works...</h2></div></div></div><p>The<code class="literal"> StageText</code> class allows native iOS text input fields to be added to an application. Unlike Flash's Classic and TLF text field types,<code class="literal"> StageText</code> provides the same user interaction behaviors found on iOS such as magnification, text selection, auto-capitalization, auto-correction, and virtual keyboard customization.<a id="id649" class="indexterm"/>
</p><p>However, while Classic and TLF text fields can be added using the IDE's Tools panel, each<code class="literal"> StageText</code> instance must be added, positioned, and sized programmatically. This is shown in the following code snippet:</p><div><pre class="programlisting">nativeText = new StageText();
nativeText.stage = stage;
nativeText.viewPort = new Rectangle(30, 28, 420, 116);
</pre></div><p>In this code snippet, the<code class="literal"> stage</code> property is used to add a text field<code class="literal">—StageText</code> objects can't be added to the display list and instead must be attached directly to the stage. The text field's position and size are specified by passing a<code class="literal"> Rectangle</code> object to its<code class="literal"> viewPort</code> property. Additionally, all<code class="literal"> StageText</code> instances will appear above content in the display list and their depths cannot be ordered. It is, therefore, advisable that you avoid overlapping native text fields.</p><p>The<code class="literal"> fontFamily</code> property is used to dictate the device font to use—embedded Flash fonts can't be used. When specifying a device font, ensure that it is available on all iOS devices you wish to target.<a id="id650" class="indexterm"/>
</p><p>The current text shown within the native text field can be set using the<code class="literal"> text</code> property, and if the field permits user input, then the number of characters can be restricted with<code class="literal"> maxChars.</code>
<a id="id651" class="indexterm"/>
</p><p>Finally, the type of keyboard that is to be used when entering text is set using the<code class="literal"> softKeyboardType</code> property. The keyboard can be further configured by using<code class="literal"> returnKeyLabel</code> to specify the label used for its return key:<a id="id652" class="indexterm"/>
</p><div><pre class="programlisting">nativeText.softKeyboardType = SoftKeyboardType.CONTACT;
nativeText.returnKeyLabel = ReturnKeyLabel.DONE;
</pre></div><p>Constants provided by the<code class="literal"> SoftKeyboardType</code> class are used to specify the keyboard type, while the<code class="literal"> ReturnKeyLabel</code> class represents the various different labels that can be used for the return key. This code specifies a keyboard configured for name entry with its return label set to<strong> Done</strong>.</p><p>If the field's<code class="literal"> editable</code> property is set to<code class="literal"> true</code> (it is by default), then a virtual keyboard will appear when the user touches it.<a id="id653" class="indexterm"/>
</p><p>For more information, perform a search for<code class="literal"> flash.text.StageText</code> within Adobe Community Help.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec33"/>There's more...</h2></div></div></div><p>Before we leave this chapter, here is some additional detail regarding native text input fields and the virtual keyboard.</p><div><div><div><div><h3 class="title"><a id="ch07lvl3sec14"/>Virtual keyboard types</h3></div></div></div><p>The supported virtual keyboard types are specified as public constants within the<code class="literal"> flash.text.SoftKeyboardType</code> class and are listed as follows for your convenience:<a id="id654" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">CONTACT:</code> Designed for entering a person's name or phone number</li><li class="listitem" style="list-style-type: disc"><code class="literal">DEFAULT:</code> The default keyboard configuration</li><li class="listitem" style="list-style-type: disc"><code class="literal">EMAIL:</code> This configuration is suited to the entry of email addresses</li><li class="listitem" style="list-style-type: disc"><code class="literal">NUMBER:</code> A numeric keypad</li><li class="listitem" style="list-style-type: disc"><code class="literal">PUNCTUATION:</code> Designed for text entry that includes punctuation</li><li class="listitem" style="list-style-type: disc"><code class="literal">URL:</code> Optimized for URL entry</li></ul></div></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec15"/>Return key label types</h3></div></div></div><p>The<code class="literal"> flash.text.ReturnKeyLabel</code> class provides the following constants, which can be used to set the virtual keyboard's return key:<code class="literal"> DEFAULT, DONE, GO, NEXT</code>, and<code class="literal"> SEARCH</code>.<a id="id655" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec16"/>Enumerating device fonts</h3></div></div></div><p>It is possible to enumerate a device's available fonts by passing<code class="literal"> true</code> to the<code class="literal"> flash.text.Font.enumarateFonts()</code> static method. This will let you know, which strings you can select from when setting a native text input field's<code class="literal"> fontFamily</code> property.<a id="id656" class="indexterm"/>
</p></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec17"/>Events</h3></div></div></div><p>The following events may be dispatched when interacting with a<code class="literal"> StageText</code> instance:<a id="id657" class="indexterm"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">FocusEvent.FOCUS_IN:</code> The native text input field has received focus<a id="id658" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">FocusEvent:FOCUS_OUT:</code> The native text input field has lost focus<a id="id659" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">KeyboardEvent.KEY_DOWN:</code> A virtual key has been pressed<a id="id660" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">KeyboardEvent.KEY_UP:</code> A virtual key as been released<a id="id661" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">SoftKeyboardEvent.SOFT_KEYBOARD_ACTIVATING:</code> The virtual keyboard is being activated and is currently moving into view<a id="id662" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><code class="literal">SoftKeyboardEvent.SOFT_KEYBOARD_ACTIVATE:</code> The virtual keyboard has been activated and can now be interacted with<code class="literal"> SoftKeyboardEvent.SOFT_KEYBOARD_ACTIVATE</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">SoftKeyboardEvent.SOFT_KEYBOARD_DEACTIVATE:</code> The virtual keyboard has been deactivated<a id="id663" class="indexterm"/></li></ul></div></div><div><div><div><div><h3 class="title"><a id="ch07lvl3sec18"/>Auto-correction and auto-capitalization</h3></div></div></div><p>You can enable iOS's auto-correction and auto-capitalization features by setting your<code class="literal"> StageText</code> object's<code class="literal"> autoCorrect</code> and<code class="literal"> autoCapitalize</code> properties to<code class="literal"> true</code>.<a id="id664" class="indexterm"/>
</p></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec34"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><em>Using device fonts within text fields</em></li><li class="listitem" style="list-style-type: disc"><em>Configurable panning with virtual keyboard activation</em></li></ul></div></div></div></body></html>