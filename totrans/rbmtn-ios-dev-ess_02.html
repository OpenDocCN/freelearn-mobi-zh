<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Instant Gratification – Your First Application</h1></div></div></div><p>
<em>"Dream the impossible, seek the unknown, and achieve greatness."</em>
</p><p>
<em>–<em>Anonymous</em>
</em>
</p><p>Now that we are all charged up about RubyMotion and have our system set up, let's create a simple RubyMotion application. We will try and keep it simple, but sometimes you may feel disconnected by monotonously typing the code. Although, going along is enough for now. <a id="id42" class="indexterm"/>Remember that mimicry is a powerful form of learning; that's how we have learned most of our skills, such as talking, reading, writing, and that is how you will learn to program with RubyMotion. We promise you that by the end of this book, you will have sufficient knowledge of RubyMotion to create an iOS application and make it live on the App Store. In this chapter we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating your first RubyMotion application</li><li class="listitem" style="list-style-type: disc">Understanding the folder structure</li><li class="listitem" style="list-style-type: disc">Exploring the command line</li><li class="listitem" style="list-style-type: disc">Configuring your application</li><li class="listitem" style="list-style-type: disc">REPL – the interactive console</li><li class="listitem" style="list-style-type: disc">The debugger</li></ul></div><div><div><div><div><h1 class="title"><a id="ch02lvl1sec15"/>Your first application</h1></div></div></div><p>Let's start with the classic <a id="id43" class="indexterm"/>
<code class="literal">HelloWorld</code> application. As we have discussed in the last chapter, RubyMotion has a terminal-based flow, so let's fire up our terminal and create our very first RubyMotion application.</p><div><pre class="programlisting">$motion create HelloWorld
Create HelloWorld
    Create HelloWorld/.gitignore
    Create HelloWorld/Rakefile
    Create HelloWorld/app
    Create HelloWorld/app/app_delegate.rb
    Create HelloWorld/resources
    Create HelloWorld/spec
<strong>    </strong>Create HelloWorld/spec/main_spec.rb</pre></div><p>If you observe closely the output on the terminal screen, you will see that a lot of files and directories have been generated by a single <code class="literal">motion</code> command, which automatically creates standard <a id="id44" class="indexterm"/>directories, and you will also see the file structure that will quickly bring us onboard with app development, which we can work on later and enhance to make a fully functional application. Moreover, since the structure is common to all the RubyMotion apps, it's easy to understand.</p><div><div><h3 class="title"><a id="note05"/>Note</h3><p>Just like the <code class="literal">motion</code> command, popular frameworks such as Ruby on Rails also have commands such as <code class="literal">rails</code> to create a predefined layout of the application.</p></div></div><p>The following steps automatically compile the code and start the application on a simulator:</p><div><ol class="orderedlist arabic"><li class="listitem">Start the application, traverse to the application directory, and type the following command:<div><pre class="programlisting">
<strong>$ cd HelloWorld</strong>
<strong>$rake</strong>
<strong>Build ./build/iPhoneSimulator-6.0-Development</strong>
<strong>Compile ./app/app_delegate.rb</strong>
<strong>Create ./build/iPhoneSimulator-6.0-Development/HelloWorld.app</strong>
<strong>Link ./build/iPhoneSimulator-6.0-Development/HelloWorld.app/HelloWorld</strong>
<strong>Create ./build/iPhoneSimulator-6.0-Development/HelloWorld.app/Info.plist</strong>
<strong>Create ./build/iPhoneSimulator-6.0-Development/HelloWorld.app/PkgInfo</strong>
<strong>Create ./build/iPhoneSimulator-6.0-Development/HelloWorld.dSYM</strong>
<strong>warning: no debug symbols in executable (-arch i386)</strong>
<strong>Simulate ./build/iPhoneSimulator-6.0-Development/HelloWorld.app</strong>
</pre></div><div><img src="img/5220OT_02_01.jpg" alt="Your first application"/></div><p>Wow! The <code class="literal">rake</code> command automatically compiles the code and starts the <a id="id45" class="indexterm"/>application on a simulator. So far, we have not created any views for our application; that's why we can see a blank screen. It looks boring, but remember that we have not written a single line of code. So let's write some code, create some views, and build our application again.</p><div><div><h3 class="title"><a id="tip09"/>Tip</h3><p>You can open the RubyMotion project in your favorite editor. If you don't have an editor yet, you can use either TextEdit or VIM.</p></div></div></li><li class="listitem">Open the file <code class="literal">app_delegate.rb</code> in the app folder and add the following code in it:<div><pre class="programlisting">class AppDelegate
  def application(application, didFinishLaunchingWithOptions:launchOptions)
   alert = UIAlertView.new
   alert.message = "Hello World!"
   alert.show
   true
  end
end</pre></div></li><li class="listitem">Let's re-run our application by traversing to the application directory and typing<a id="id46" class="indexterm"/> the execute command (<code class="literal">rake</code>):<div><pre class="programlisting">
<strong>$rake</strong>
</pre></div><p>The <code class="literal">rake</code> command will compile our code and fire up the iPhone simulator. We can see a blue pop-up saying <strong>Hello World!</strong> in the following screenshot:</p><div><img src="img/5220OT_02_02.jpg" alt="Your first application"/></div><p>Let's understand the code that we have written in <code class="literal">AppDelegate</code>. Here the application method (<code class="literal">didFinishLaunchingWithOptions:launchOptions</code>) is called first when our application starts. This will be the starting point of our application<a id="id47" class="indexterm"/> and the right place to define our window.</p><p>RubyMotion functions are a combination of the usual Ruby name method (<code class="literal">didFinishLaunchingWithOptions</code>) with their named parameters; a variable directly follows the function, which it refers to, and therefore, we don't need to know the implementation of the function.</p><div><div><h3 class="title"><a id="note06"/>Note</h3><p>Named parameters were added to RubyMotion to preserve the existing Objective-C APIs, and the extra symbols are required parts of the method name, for example, <code class="literal">didFinishLaunchingWithOptions</code>:<code class="literal">launchOptions</code>.</p></div></div><p>As discussed, the code written in <code class="literal">AppDelegate</code> will be called automatically as the application is initialized.</p><p>In the following code snippet, we created an object alert of the <code class="literal">UIAlertView</code> class and then we assigned a <code class="literal">Hello World!</code> string to the message attribute of the object. Now we have our alert object ready. To display this alert on the device screen, we call the show method on the alert object as follows:</p><div><pre class="programlisting">   alert = UIAlertView.new
   alert.message = "Hello World!"
   alert.show</pre></div><p>
<code class="literal">UIAlertView</code> is a class that is bundled in the <code class="literal">UIKit</code> framework of the iOS. We can use this class to display an alert message on the screen. This class is inherited from <code class="literal">UIView</code> that is inherited from <code class="literal">UIResponder</code> that, in turn, is inherited from <code class="literal">NSObject</code>.</p><div><div><h3 class="title"><a id="note07"/>Note</h3><p>
<strong>Why do we see the NS prefix?</strong>
</p><p>Objective-C is a superset of C and thus doesn't have namespaces like in C++; therefore, the symbols must be prefixed with a unique prefix so that they don't collide. This is particularly important for symbols defined in a framework. The original code for the Cocoa frameworks came from the NextStep libraries, and so the NextStep engineers chose to prefix their symbols with NS.</p></div></div></li><li class="listitem">To exit<a id="id48" class="indexterm"/> the application, close the simulator by selecting the <strong>exit</strong> option or press <em>Command</em> + <em>Q</em>.<div><div><h3 class="title"><a id="tip10"/>Tip</h3><p>The iOS simulator is a great tool for testing your applications quickly. It comes bundled with Xcode. But you can't test everything on the simulator. To test the shaking of a device, camera, GPS, Accelerometer, Gyroscope, and other device capabilities, you may require additional products to pass device data to the app in the simulator.</p></div></div></li></ol></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Folder structure</h1></div></div></div><p>In this section, we will understand the folder structure of our application as we know from the previous section that <code class="literal">motion create &lt;project name&gt;</code> sets up the directory structure with all the essential files to run a simple RubyMotion application. Let's walk through each one of them to have a <a id="id49" class="indexterm"/>precise understanding of their function:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">app</code> folder: This is the core of your application code; you will write most of your code in this folder.<a id="id50" class="indexterm"/> RubyMotion iterates in this folder and loads any <code class="literal">.rb</code> file that it catches.<div><div><h3 class="title"><a id="tip11"/>Tip</h3><p>If you want to keep your code somewhere else other than the <code class="literal">app</code> directory, add the folder path to the <code class="literal">Rakefile</code>.</p></div></div></li><li class="listitem" style="list-style-type: disc">The <code class="literal">app_delegate.rb</code> file in the <code class="literal">app</code> folder: This file is at the heart of the RubyMotion application. If <a id="id51" class="indexterm"/>you are a little familiar with iOS development, this is the delegate file. A delegate is an object that usually reacts to some event in another object and/or can affect how another object behaves. There are various methods that can be implemented in <code class="literal">UIApplicationDelegate</code>. These methods are called during the different phases of an application, <a id="id52" class="indexterm"/>such as during the finish of its launch, during termination, when the application is low on memory, and during the occurrence of important changes. While the application is running, tracking its state transitions is one of the main jobs of the application delegate.<p>App delegates use the method <code class="literal">application:didFinishLaunchingWithOptions</code> as the first entry point. This method is called after your application has been launched. When this method is called, your application is in the inactive state. A few other methods available are:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">applicationWillEnterForeground</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">applicationWillTerminate</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">application:shouldSaveApplicationState</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">application:shouldRestoreApplicationState</code></li></ul></div><p>A full list of available methods can be obtained from the <a id="id53" class="indexterm"/>iOS developer library (<a class="ulink" href="http://developer.apple.com/library/ios">http://developer.apple.com/library/ios</a>). The good part here is that most of the methods are self-explanatory by their name. For example, <code class="literal">applicationWillEnterForeground</code> will be called when your application is relaunched.</p><div><div><h3 class="title"><a id="tip12"/>Tip</h3><p>We see that in some iOS 6 applications, the app is restored to the previous state; we can handle this in an application delegate.</p></div></div></li><li class="listitem" style="list-style-type: disc">The <code class="literal">resources</code> folder: <a id="id54" class="indexterm"/>As the name suggests, the <code class="literal">resources</code> folder contains static content, such as images, sounds, UI layouts, and icons that we use in our applications.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">Spec</code> folder: This folder <a id="id55" class="indexterm"/>contains automated test cases. RubyMotion supports a Ruby testing framework, Bacon; it is a small RSpec clone that is used for writing unit, functional, and UI tests. By default, it creates <code class="literal">main_spec.rb</code> as an example.</li><li class="listitem" style="list-style-type: disc"><code class="literal">Rakefile</code>: With <code class="literal">Rakefile</code> we can configure our application name, resources, gems to be included, and the code location. We will discuss more about <code class="literal">Rakefile</code> later in<a id="id56" class="indexterm"/> this chapter.</li></ul></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Some more goodies</h1></div></div></div><p>We know that it's not so much fun to have only a simple <code class="literal">HelloWorld</code> pop-up as our very first application, so let's jazz up our code by adding some more goodies to our alert box; and this time, let's do things in a much better way.</p><p>Earlier we had added an alert box in the delegate itself. Actually it is not a good idea to write code in the application <a id="id57" class="indexterm"/>delegate. It is better to write code in a Model-View-Controller (MVC) way. Right now we won't cover all three parts of the MVC architecture for now let's begin with the controller for our application and add three buttons in this alert box, add a title, and add a message for the title box.</p><p>The class <code class="literal">UIAlertView</code> that we've used in the last section has numerous properties, such as title, message, delegate, cancelButtonTitle, otherButtonTitles, and many more. Let's use a few of them in our application as follows:</p><div><ol class="orderedlist arabic"><li class="listitem">Create a file <code class="literal">root_controller.rb</code> in the <code class="literal">app</code> folder and add the following code:<div><pre class="programlisting">class RootController &lt; UIViewController
    def viewDidLoad
    alert = UIAlertView.alloc.initWithTitle "This is foo title",
      message:"Do you like this example?",
        delegate: nil,
        cancelButtonTitle: "cancel"
        otherButtonTitles: "Yes","No",nil
    alert.show
    end
end</pre></div></li><li class="listitem">To call this controller, we need to update our <code class="literal">AppDelegate</code> class. Replace the following code in your <code class="literal">app_delegate.rb</code> <code class="literal">file</code>:<div><pre class="programlisting">class AppDelegate
  def application
    (application,didFinishLaunchingWithOptions:
      launchOptions)
    @window = UIWindow.alloc.initWithFrame
      (UIScreen.mainScreen.bounds)
    @window.rootViewController = RootController.alloc.init
    @window.rootViewController.wantsFullScreenLayout = true
    @window.makeKeyAndVisible
    true
  end
end</pre></div></li><li class="listitem">Start the<a id="id58" class="indexterm"/> simulator by running the <code class="literal">rake</code> command from the console inside your application directory as follows:<div><img src="img/5220OT_02_03.jpg" alt="Some more goodies"/></div><p>That's cool; our earlier <code class="literal">HelloWorld</code> pop-up has now been replaced with an alert box that has a title, a cancel button, and two other buttons.</p><div><div><h3 class="title"><a id="note08"/>Note</h3><p>The iOS SDK has been built around the MVC pattern that separates responsibilities and ends up with an application that is easy to design and maintain.</p></div></div></li></ol></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec22"/>Let's understand the code</h2></div></div></div><p>When an iPhone application<a id="id59" class="indexterm"/> starts, it puts a window on the screen, which we have created using the <code class="literal">UIWindow</code> class. You can think of a window as a drawing board where you can put anything, such as a button, textbox or label. The instance of the <code class="literal">UIWindow</code> class manages and coordinates the views of an application, which are displayed on a device screen.</p><p>A <code class="literal">UIScreen</code> object <a id="id60" class="indexterm"/>contains the bounding rectangle of the device's entire screen. So, <code class="literal">UIScreen.mainScreen.bounds</code> returns the rectangle size according to the screen size and orientation of the device.</p><div><div><h3 class="title"><a id="tip13"/>Tip</h3><p>Every iOS application needs at least one window, which is an instance of the <code class="literal">UIWindow</code> class.</p></div></div><p>You might be wondering, should I remember all the properties and methods of the Apple iOS SDK, such as <code class="literal">UIAlertView</code>? It is not necessary to memorize them as one can always refer to the properties and methods from the iOS development library. Nevertheless, having a basic idea about the usage of a class can come in handy at times. The popular IDE, RubyMine, supports RubyMotion. It also has a useful autocompletion feature.</p><div><div><h3 class="title"><a id="tip14"/>Tip</h3><p>The more you understand, the less you have to memorize.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Exploring the command line</h1></div></div></div><p>RubyMotion is based on<a id="id61" class="indexterm"/> an underlying principle, "to use the tools which developers love". Therefore, to create an application using RubyMotion, we require only two tools; the first is your favorite editor and the second is the terminal. While developing a RubyMotion application, you will be required to familiarize yourself with the command line. Familiarity with the terminal always helps in faster and comfortable development.</p><p>Now that we have created our <code class="literal">HelloWorld</code> application, let us explore a few commands that we have<a id="id62" class="indexterm"/> already used, and remember that RubyMotion uses them considerably. These commands are responsible for inaugurating our RubyMotion projects, <code class="literal">motion</code> and <code class="literal">rake</code>.</p><div><div><div><div><h2 class="title"><a id="ch02lvl2sec23"/>Motion command – one-stopshop</h2></div></div></div><p>As used previously, the <code class="literal">motion</code> command creates our RubyMotion project and also supports various other <a id="id63" class="indexterm"/>options. The <code class="literal">motion</code> command is similar to the popular framework Ruby on Rails' <code class="literal">rails</code> command. Before we go any further, let's fire up our terminal and see what can be done using the <code class="literal">motion</code> command.<a id="id64" class="indexterm"/>
</p><div><pre class="programlisting">
<strong>$ motion</strong>
<strong>Usage:</strong>
<strong>  motion [-h, --help]</strong>
<strong>  motion [-v, --version]</strong>
<strong>  motion &lt;command&gt; [&lt;args...&gt;]</strong>
<strong>Commands:</strong>
<strong>  account      Access the software license account</strong>
<strong>  activate     Activate the software license</strong>
<strong>  create       Create a new project </strong>
<strong>  ri           Display API reference </strong>
<strong>  update       Update the software</strong>
<strong>  support      Create a support ticket</strong>
</pre></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">motion account</code>: This <a id="id65" class="indexterm"/>displays the account/license information on the browser.</li><li class="listitem" style="list-style-type: disc"><code class="literal">motion activate</code>: If you<a id="id66" class="indexterm"/> want to activate your RubyMotion framework with a new license or if you have not yet activated the framework, <code class="literal">motion activate</code> can be used.</li><li class="listitem" style="list-style-type: disc"><code class="literal">motion create &lt;project name&gt;</code>: This <a id="id67" class="indexterm"/>command will generate a RubyMotion project's skeleton that will have all the essential files needed to begin developing an iOS application.</li><li class="listitem" style="list-style-type: disc"><code class="literal">motion ri &lt;API-name&gt;</code>: This command<a id="id68" class="indexterm"/> helps us to find the documentation for the API that has been mentioned.</li><li class="listitem" style="list-style-type: disc"><code class="literal">motion update</code>: RubyMotion is a fast-moving framework and often requires updates. <code class="literal">motion update</code> <a id="id69" class="indexterm"/>updates your framework from the command line itself.</li><li class="listitem" style="list-style-type: disc"><code class="literal">motion support</code>: There may be times when you have questions only an expert can answer. <code class="literal">motion </code><a id="id70" class="indexterm"/><code class="literal">support</code> helps you connect with RubyMotion directly, and you can ask a question by filling up a form. It can also be used for any feature <a id="id71" class="indexterm"/>request or for reporting a bug.</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec24"/>Rake tasks – get things done fast</h2></div></div></div><p>Rake is a simple Ruby build program with capabilities similar to <code class="literal">Make</code>. RubyMotion's <code class="literal">rake</code> command has many predefined tasks that help you do several trivial jobs, such as compiling your <a id="id72" class="indexterm"/>code to test in a simulator or creating a package to test on a device, with ease. Let's fire up our terminal again and check what tasks can be performed using <code class="literal">rake --tasks</code>.</p><div><pre class="programlisting">
<strong>$ rake ––tasks</strong>
</pre></div><p>The following table elaborates the different Rake tasks:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Rake task</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Rake archive<a id="id73" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Create a <code class="literal">.ipa</code> archive</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Rake archive:distribution<a id="id74" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Create a <code class="literal">.ipa</code> archive for distribution</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Rake build<a id="id75" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Build everything</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Rake build:device<a id="id76" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Build the device version</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Rake build:simulator<a id="id77" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Build the simulator version</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Rake clean<a id="id78" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Clear build objects</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Rake config<a id="id79" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Show project config</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Rake ctags<a id="id80" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Generate ctags</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Rake default<a id="id81" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Build the project, then run the simulator</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Rake device<a id="id82" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Deploy on the device</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Rake simulator<a id="id83" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Run the simulator</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Rake spec<a id="id84" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Same as a <code class="literal">spec:simulator</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Rake spec:device<a id="id85" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Run the test/spec suite on the device</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Rake spec:simulator<a id="id86" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Run the test/spec suite on the simulator</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Rake static<a id="id87" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Create a static library</p>
</td></tr></tbody></table></div><p>So Rake has plenty of tasks to do, but most importantly, out of all these tasks, if we simply run Rake, it will build and run our application on the iOS simulator.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec25"/>Rake file – configuring your application</h2></div></div></div><p>RubyMotion applications<a id="id88" class="indexterm"/> are highly configurable using different attributes in a <code class="literal">Rakefile</code>. These attributes, by default, come with a sensible value but can be <a id="id89" class="indexterm"/>overridden with custom values. Let's explore each one of them—this section will come in handy, time and again, as we proceed with our application.</p><p>To see your current application configuration, run the <code class="literal">rake config</code> task, and you will be presented with the following list:</p><div><pre class="programlisting">
<strong>$ rake config</strong>
<strong>background_modes       : []</strong>
<strong>build_dir              : "./build"</strong>
<strong>codesign_certificate   : "Error"</strong>
<strong>delegate_class         : "AppDelegate"</strong>
<strong>deployment_target      : "6.0"</strong>
<strong>device_family          : :iphone</strong>
<strong>entitlements           : {}</strong>
<strong>files                  : ["./app/app_delegate.rb", "./app/twitter.rb", "./app/twitter_controller.rb"]</strong>
<strong>fonts                  : []</strong>
<strong>frameworks             : ["UIKit", "Foundation", "CoreGraphics", "CoreGraphics"]</strong>
<strong>icons                  : []</strong>
<strong>identifier             : "com.yourcompany.MacBaconUI"</strong>
<strong>interface_orientations : [:portrait, :landscape_left, :landscape_right]</strong>
<strong>libs                   : []</strong>
<strong>motiondir              : "/Library/RubyMotion"</strong>
<strong>name                   : "MacBacon UI"</strong>
<strong>prerendered_icon       : false</strong>
<strong>provisioning_profile   : "Error"</strong>
<strong>resources_dir          : "./resources"</strong>
<strong>sdk_version            : "6.0"</strong>
<strong>seed_id                : "Error"</strong>
<strong>short_version          : "1"</strong>
<strong>specs_dir              : "./spec"</strong>
<strong>status_bar_style       : :default</strong>
<strong>version                : "1.0"</strong>
<strong>weak_frameworks        : []</strong>
<strong>xcode_dir              : "/Applications/Xcode.app/Contents/Developer"</strong>
</pre></div><p>You can see the entire configuration settings for your application. These settings can be modified in a <code class="literal">Rakefile</code>. <a id="id90" class="indexterm"/>You may find it easy to understand what these properties do by their names, but let us explain a few of them:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">name</code>: This is where you can specify the name of your project as a string. By default, the name of your <a id="id91" class="indexterm"/>application will be the attribute that you passed during <code class="literal">motion create</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">version</code>: This variable<a id="id92" class="indexterm"/> saves the current application version as a string; it is 1.0 by default.</li><li class="listitem" style="list-style-type: disc"><code class="literal">identifier</code>: The project<a id="id93" class="indexterm"/> identifier is a string that is in reverse DNS—a naming convention that is in the reverse order of the domain name notation—such as <code class="literal">com.yourcompany.yourapp</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">delegate_class</code>: This is where <a id="id94" class="indexterm"/>you specify your application delegate class as a string that is loaded once the application starts. The default value is <code class="literal">AppDelegate</code> and the class is defined in the <code class="literal">app</code>/<code class="literal">app_delegate.rb</code> file. However, we can rename the <code class="literal">AppDelegate</code> class to a custom name of our choice and this then has to be updated in the <code class="literal">Rakefile</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">Files</code>: This shows every <code class="literal">.rb</code> file <a id="id95" class="indexterm"/>in the <code class="literal">app</code> directory in an array format. The default value is the result of executing the following expression:<div><pre class="programlisting">Dir.glob(./app/*/.rb)</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">framework</code>: This shows the<a id="id96" class="indexterm"/> names of the iOS frameworks that are used in our application in an array format. Soon you will be using many iOS frameworks, such as CoreFoundation, CoreMotion, and others, with your application. The build system is capable of dealing with dependencies, therefore they should be mentioned here. The default value is either <code class="literal">UIKit</code>, <code class="literal">Foundation</code>, or <code class="literal">CoreGraphics</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">libs</code>: This variable <a id="id97" class="indexterm"/>shows the library paths that are to be linked to the application in an array format. It contains the path to public system libraries, for example, <strong>/usr/lib/libz.dylib</strong>. The default value is <code class="literal">[]</code>, an empty array.</li><li class="listitem" style="list-style-type: disc"><code class="literal">build_dir</code>: This variable<a id="id98" class="indexterm"/> is used to specify the directory path where you want the application build to be created in a string format. It must be relative to the project directory. The directory initially gets created automatically. In case it is not created, a temporary directory will be used instead. The default value is <code class="literal">build</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">resources_dir</code>: This <a id="id99" class="indexterm"/>variable is used to specify the directory for the resource files where all the images and icons go in a string format. It must be relative to the project directory. The default value is <code class="literal">resources</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">spec_dir</code>: This variable is used to specify the directory of <code class="literal">spec</code> files where all our test cases are present in a String format. <a id="id100" class="indexterm"/>The default value is <code class="literal">spec</code>. It should be relative to the project directory.</li><li class="listitem" style="list-style-type: disc"><code class="literal">icons</code>: This variable lists the icons <a id="id101" class="indexterm"/>used for the application present in the <code class="literal">resources</code> folder in an <code class="literal">array</code> format, for example, <code class="literal">icon.png</code> and/or <code class="literal">icon-72.png</code>. The files should be in tune with Apple's <strong>HIG </strong>(<strong>Human Interface Guidelines</strong>). By default, the value is <code class="literal">[]</code>, an empty array.</li><li class="listitem" style="list-style-type: disc"><code class="literal">fonts</code>: This variable lists the names <a id="id102" class="indexterm"/>of the font files present in the <code class="literal">resources</code> directory in an <code class="literal">array</code> format. These fonts will be taken into account while either generating the application bundle or testing on a simulator.</li><li class="listitem" style="list-style-type: disc"><code class="literal">prerendered_icon</code>: iOS<a id="id103" class="indexterm"/> application icons usually have a reflective shine on them. For that purpose, this property is used. If it is false, we will get the reflective shine on the icon. By default, the value is false.</li><li class="listitem" style="list-style-type: disc"><code class="literal">device_family</code>: With this property, <a id="id104" class="indexterm"/>we can specify which family of iOS device our application supports. The values can be <code class="literal">iphone</code>, <code class="literal">ipad</code>, or for universal application [<code class="literal">:iphone</code>, <code class="literal">:ipad</code>]. By default it is <code class="literal">:iphone</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">interface_orientations</code>: Apple<a id="id105" class="indexterm"/> iOS devices support various orientations for an application. They can be <code class="literal">portrait</code>, <code class="literal">landscape_left</code>, <code class="literal">landscape_right</code>, or <code class="literal">portrait_upside_down</code>. By default, the value is an array of <code class="literal">:portrait</code>, <code class="literal">:landscape_left</code>, or <code class="literal">:landscape_right</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">Xcode_dir</code>: This configuration<a id="id106" class="indexterm"/> tells us where the Xcode is installed.<div><div><h3 class="title"><a id="note09"/>Note</h3><p>Giving a new value to the <code class="literal">XCode_dir</code> property should generally be done first, before changing other <code class="literal">Rakefile</code> properties.</p></div></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">sdk_version</code>: This configuration <a id="id107" class="indexterm"/>lets us decide which SDK version will be used. By default, the value is the most recent version of the supported SDK.</li><li class="listitem" style="list-style-type: disc"><code class="literal">deployment_target</code>: This <a id="id108" class="indexterm"/>configuration shows which iOS SDK to target for the RubyMotion project. By default, the value is of the current SDK version that is installed, but this can be changed to any desired version of the iOS SDK, for example, 6.0 that will use iOS SDK Version 6.0.</li><li class="listitem" style="list-style-type: disc"><code class="literal">codesign_certificate</code>: <a id="id109" class="indexterm"/>This configuration shows which code-signing certificate is used. By default, the value is the first iPhone developer certificate in the keychain utility; for example, in our case it is <strong>iPhone developer: Paul Akshat (S3KPMT842Z)</strong>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">provisioning_profile</code>: This <a id="id110" class="indexterm"/>configuration variable specifies the path of the provisioning profile.</li><li class="listitem" style="list-style-type: disc"><code class="literal">seed_id</code>: The Apple<a id="id111" class="indexterm"/> provisioning profile has an identifier. This configuration shows us the same, which is usually the first application identifier picked from the provisioning profile.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec19"/>REPL – the interactive console</h1></div></div></div><p>RubyMotion comes with an interactive console that lets us traverse and scan the code that we are using in our application. <a id="id112" class="indexterm"/>The good thing is that the console is connected to the application running on the simulator. This means that if we make any changes from the console, it will be reflected on the simulator in real time. Let's try this with our <code class="literal">HelloWorld</code> application.</p><p>Run the application as follows:</p><div><pre class="programlisting">
<strong>$rake</strong>
</pre></div><p>As expected, it will open a simulator and the terminal screen will show:</p><div><pre class="programlisting">
<strong>(main)&gt;</strong>
</pre></div><p>Now hold the <em>Command</em> key<a id="id113" class="indexterm"/> and hover the mouse over the simulator. You will see a red-bordered box. As we move the mouse pointer over an element, we can see its corresponding class object appearing in the terminal window <code class="literal">(UIView:0xc5710c0)?</code> as seen in the following screenshot. Now click the mouse to select the object that you want to work on dynamically.</p><div><img src="img/5220OT_02_04.jpg" alt="REPL – the interactive console"/></div><p>Try the following command on the terminal and observe the changes in the simulator:</p><p>
<code class="literal">self</code> returns the current object selected by the mouse.</p><div><pre class="programlisting">
<strong>(#&lt;UIView:0x7652680&gt;)&gt; self</strong>
<strong>=&gt; #&lt;UIView:0x7652680&gt;</strong>
</pre></div><p>Create an object <code class="literal">blue</code> for the <code class="literal">UIColor</code> class and assign the color blue to the variable as follows:</p><div><pre class="programlisting">
<strong>(#&lt;UIView:0x7652680&gt;)&gt; blue = UIColor.blueColor</strong>
</pre></div><p>To change the<a id="id114" class="indexterm"/> background color of the view, use the <code class="literal">backgroundColor</code> property of the selected view as follows:</p><div><pre class="programlisting">
<strong>=&gt; #&lt;UICachedDeviceRGBColor:0xb05a800&gt;</strong>
<strong> (#&lt;UIView:0x7652680&gt;)&gt;  self.backgroundColor = blue</strong>
<strong>=&gt; #&lt;UICachedDeviceRGBColor:0xb05a800&gt;</strong>
</pre></div><p>Make sure that the background color on the simulator has been changed to blue as shown in the following screenshot:</p><div><img src="img/5220OT_02_05.jpg" alt="REPL – the interactive console"/></div><p>Let's dismiss the<a id="id115" class="indexterm"/> alert box by clicking on any button and put a new alert box with the following code:</p><div><pre class="programlisting">a = UIAlertView.new
a.title = "My Title"
a.message = "Hello World!"
a.show</pre></div><p>The simulator shows a new alert box on screen without compiling the code as shown in the following screenshot:</p><div><img src="img/5220OT_02_06.jpg" alt="REPL – the interactive console"/></div><p>You can dismiss the alert box as follows:</p><div><pre class="programlisting">
<strong>(main) &gt; a.dismiss</strong>
</pre></div><p>We can see how<a id="id116" class="indexterm"/> REPL is a great tool for developing applications for iOS and how it helps us make changes dynamically. To make these changes permanent we need to add the same code to our source code.</p></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Debugger – catch your mistakes!</h1></div></div></div><p>A typical debugger provides the ability to halt when specific conditions are encountered. It also offers sophisticated functions, such as running a program step by step, breaking or pausing the program for an examination based on breakpoints, and tracking the values of the variables at that state. RubyMotion Version 1.24 and above support debugging using GDB: the <a id="id117" class="indexterm"/>GNU project debugger (<a class="ulink" href="http://www.gnu.org/software/gdb/">http://www.gnu.org/software/gdb/</a>).</p><p>The RubyMotion debugger provides the following inbuilt debugging facilities:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">It stops the program <a id="id118" class="indexterm"/>at a specific line</li><li class="listitem" style="list-style-type: disc">It examines the problem when the program has stopped</li><li class="listitem" style="list-style-type: disc">It checks the value for the variables at a specific breakpoint<div><div><h3 class="title"><a id="note10"/>Note</h3><p>The RubyMotion compiler implements the <a id="id119" class="indexterm"/>
<strong>DWARF</strong> debugging format's metadata for the <a id="id120" class="indexterm"/>Ruby language. This allows external programs, such as the debugger in our case, to retrieve source-level information about the RubyMotion application. The metadata is saved under a <code class="literal">.dSYM</code> bundle file at the same level as the <code class="literal">.app</code> bundle in the build directory of your project.</p></div></div></li></ul></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec26"/>How to start debugging</h2></div></div></div><p>There are three ways <a id="id121" class="indexterm"/>in which we can start the debugger.</p><div><div><div><div><h3 class="title"><a id="ch02lvl3sec02"/>While testing on a simulator</h3></div></div></div><p>We can start the<a id="id122" class="indexterm"/> debugger with a simulator. The debugger will directly<a id="id123" class="indexterm"/> attach itself to the app and replace the interactive shell (REPL).</p><p>To start, just type:</p><div><pre class="programlisting">
<strong>$rake simulator debug=1</strong>
</pre></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec03"/>While testing on a device</h3></div></div></div><p>We can start<a id="id124" class="indexterm"/> debugging with the device running simultaneously. The build system will start the iOS debugging server on the device and then remotely attach the debugger on your shell right after the application has been deployed on the device.</p><div><pre class="programlisting">
<strong>$rake device debug=1</strong>
</pre></div><p>In the release mode, local variables might not be accessible in the debugger as they are optimized to fit into CPU registers.</p><div><div><h3 class="title"><a id="tip15"/>Tip</h3><p>To test your application on a device, you are required to enroll for the <strong>Apple Developer Program</strong>. We will discuss this in detail in later chapters.</p></div></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec04"/>Entering commands before starting</h3></div></div></div><p>We might need some<a id="id125" class="indexterm"/> breakpoint before loading the application; we can do this as follows:</p><div><pre class="programlisting">
<strong>$rake debug=1 no_continue=1</strong>
</pre></div><p>On execution of this command, the GDB will start and we will be able to set the breakpoints. This is discussed in more detail in the next section.</p></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec27"/>Breakpoint</h2></div></div></div><p>We can put breakpoints at a specific location of our application code using the <code class="literal">break</code> command and then pass the location where the debugger should stop the execution of the code using the <code class="literal">file_name:line_number</code> notation.</p><p>Let's try putting a breakpoint in our current application. To do so, we need to start our <code class="literal">HelloWorld</code> application in debugging mode as follows:</p><div><pre class="programlisting">
<strong>$rake simulator debug=1</strong>
<strong>/Library/RubyMotion/lib/motion/project/config.rb:89: </strong>
<strong>     Build ./build/iPhoneSimulator-5.1-Development</strong>
<strong>  Simulate ./build/iPhoneSimulator-5.1-Development/HelloWorld.app</strong>
<strong>Attaching to process 86665.</strong>
<strong>Reading symbols for shared libraries . done</strong>
<strong>0x8fe6c030 in __dyld__dyld_start ()</strong>
<strong>Function "rb_exc_raise" not defined.</strong>
<strong>Breakpoint 1 (rb_exc_raise) pending.</strong>
<strong>Function "malloc_error_break" not defined.</strong>
<strong>Breakpoint 2 (malloc_error_break) pending.</strong>
<strong>Reading symbols for shared libraries .............................................................................................................. done</strong>
<strong>Breakpoint 1 at 0x37136</strong>
<strong>Pending breakpoint 1 – "rb_exc_raise" resolved</strong>
<strong>Breakpoint 2 at 0x97bdec97</strong>
<strong>Pending breakpoint 2 – "malloc_error_break" resolved</strong>
<strong>Reading symbols for shared libraries . done</strong>
<strong>Reading symbols for shared libraries . done</strong>
<strong>Reading symbols for shared libraries ... done</strong>
<strong>(gdb)</strong>
</pre></div><p>Now let's set a breakpoint on the eighth line of the file <code class="literal">app_delegate.rb</code> as follows:</p><div><pre class="programlisting">
<strong>(gdb) break app_delegate.rb:8</strong>
<strong>Breakpoint 3 at 0x80085: file app_delegate.rb, line 8</strong>
</pre></div><p>With the preceding command, the execution of your application will halt at line number 8 of the <code class="literal">app_delegate.rb</code> file.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec28"/>Listing breakpoints</h2></div></div></div><p>To list the breakpoints that have been set up in the current debugging environment, we use the <code class="literal">info breakpoint</code> command as follows:</p><div><pre class="programlisting">
<strong>(gdb) info breakpoint</strong>
<strong>Num Type           Disp Enb Address    What</strong>
<strong>1   breakpoint     keep y   0x000adff6 &lt;rb_exc_raise+6&gt;</strong>
<strong>2   breakpoint     keep y   0x97bdec97 &lt;malloc_error_break+6&gt;</strong>
<strong>3   breakpoint     keep y   0x00080085 in rb_scope__application:didFinishLaunchingWithOptions:__ at app_delegate.rb:8</strong>
</pre></div><p>We can see that the list of breakpoints created in the last section can also be seen in the list.</p></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec29"/>Moving between the different breakpoints</h2></div></div></div><p>The <code class="literal">continue</code> command will continue the execution of the program until it reaches the next breakpoint.</p><div><pre class="programlisting">
<strong>(gdb) continue</strong>
</pre></div><p>We can also use its alias <code class="literal">c</code> as follows; it is more handy to use:</p><div><pre class="programlisting">
<strong>(gdb) c</strong>
<strong>Breakpoint 3, rb_scope__application:didFinishLaunchingWithOptions:__ (self=0x9408440, application=0x9401750, launchOptions=0x4) at app_delegate.rb:8</strong>
<strong>8    alert.show</strong>
</pre></div><p>The <code class="literal">next</code> command will continue the execution of the program until the next source-level location. This is usually the very next line in the Ruby source code. You should have a look at the terminal for the relevant source code line.</p><div><pre class="programlisting">
<strong>(gdb) next</strong>
</pre></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec05"/>Checking the value of a local variable</h3></div></div></div><p>This is an important feature of debugging, to check the value of a variable at a specific breakpoint.</p><div><pre class="programlisting">
<strong>(gdb) pro alert</strong>
<strong>#&lt;UIAlertView:0x944b9b0&gt;</strong>
</pre></div><p>This shows that the alert is an object of the <code class="literal">UIAlertView</code> class</p><p>
<strong>Pro</strong> (<strong>print-ruby-object</strong>) accepts two parameters as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The object on which the variable will be retrieved.</li><li class="listitem" style="list-style-type: disc">The variable name that you want to get.</li></ul></div><div><div><h3 class="title"><a id="tip16"/>Tip</h3><p>To check the variables available for us to execute, run the following command:</p><div><pre class="programlisting">$info locals</pre></div></div></div></div><div><div><div><div><h3 class="title"><a id="ch02lvl3sec06"/>Checking the value of an instance variable</h3></div></div></div><p>We can also check the value of an instance variable during some breakpoint using <strong>pri</strong> (<strong>print-ruby-ivar</strong>) as follows:</p><div><pre class="programlisting">
<strong>pri self "@tweet"</strong>
</pre></div><p>
<code class="literal">pri</code> accepts two commands as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The object on which the instance variable will be retrieved.</li><li class="listitem" style="list-style-type: disc">The instance variable that you want to get. Make sure to include the <code class="literal">@</code> character in the name.</li></ul></div><div><div><h3 class="title"><a id="tip17"/>Tip</h3><p>You can use <code class="literal">pri @tweet</code> instead of <code class="literal">pri self @tweet</code>.</p></div></div></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec30"/>Disable breakpoint</h2></div></div></div><p>To disable a breakpoint, use <code class="literal">disable</code> followed by the breakpoint number; it has to be disabled as follows:</p><div><pre class="programlisting">
<strong>(gdb) disable 3</strong>
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch02lvl2sec31"/>Exit debugger</h2></div></div></div><p>Type <code class="literal">quit</code> to exit the debugger as follows:</p><div><pre class="programlisting">
<strong>(gdb) quit</strong>
<strong>The program is running.  Quit anyway (and detach it)? (y or n) y</strong>
<strong>Detaching from process 6792.</strong>
</pre></div><div><div><h3 class="title"><a id="tip18"/>Tip</h3><p>
<strong>Downloading the example code</strong>
</p><p>You can download the example code files for all Packt books you have purchased, and the graphics bundle of this book from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>.</p><p>If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Summary</h1></div></div></div><p>Let's recap what we have done in this chapter:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Created a simple RubyMotion application</li><li class="listitem" style="list-style-type: disc">Discussed the basic RubyMotion application structure</li><li class="listitem" style="list-style-type: disc">Explored the commands available with RubyMotion</li><li class="listitem" style="list-style-type: disc">Performed different Rake tasks with RubyMotion</li><li class="listitem" style="list-style-type: disc">Learned how to configure your RubyMotion application</li><li class="listitem" style="list-style-type: disc">Worked with the interactive console—REPL</li><li class="listitem" style="list-style-type: disc">Debugged your application using the RubyMotion debugger</li></ul></div><p>In the next chapter, we turn our attention to RubyMotion data type objects—such as strings and arrays. We will also learn how to interface with C and we will focus on memory management in RubyMotion.</p></div></body></html>