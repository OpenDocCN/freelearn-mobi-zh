<html><head></head><body><div><div><div><div><h1 class="title"><a id="appA"/>Appendix A. Exploring the MultiTouch Interface</h1></div></div></div><p>In this appendix, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Sensing the movement and device orientation</li><li class="listitem" style="list-style-type: disc">Using the shake gesture with the touch interface</li><li class="listitem" style="list-style-type: disc">Detecting device touches with the touch interface</li><li class="listitem" style="list-style-type: disc">Sensing movement with the accelerometer input</li><li class="listitem" style="list-style-type: disc">Understanding the core motion framework</li><li class="listitem" style="list-style-type: disc">Working with the iOS device gyroscope</li></ul></div><div><div><div><div><h1 class="title"><a id="ch10lvl1sec115"/>Introduction</h1></div></div></div><p>The Apple iOS device's primary interface with which you communicate is its large Multi touch display. Since there is no physical keyboard attached, everything is done via the screen to allow you to interact with your applications in a more natural way. Any object can be moved around the screen, zoomed in and out, and scrolled up and down using simple gestures.</p><p>In this appendix, we will see how easy it is to incorporate both single touch and multi touch support into our applications, to detect when the iOS device orientation has changed as well as how to handle and respond to shake motions, before finally learning about the accelerometer and the gyroscope.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec116"/>Sensing the movement and device orientation</h1></div></div></div><p>In this recipe we will <a id="id1109" class="indexterm"/>
<a id="id1110" class="indexterm"/>learn how to detect the current orientation of the iOS device.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec423"/>Getting ready</h2></div></div></div><p>Create a new Single View Application Project and name it <code class="literal">OrientationExample</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec424"/>How to do it...</h2></div></div></div><p>To begin, follow these simple steps as outlined:</p><div><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file from the Project Navigator.</li><li class="listitem">Next, modify the <a id="id1111" class="indexterm"/><code class="literal">viewDidLoad</code> method as shown in the following code snippet:<div><pre class="programlisting">- (void)viewDidLoad{
  [super viewDidLoad];
  
  [[UIDevice
  currentDevice]
  beginGeneratingDeviceOrientationNotifications];
  
  [[NSNotificationCenter defaultCenter]addObserver:self
  selector:@selector(hasOrientationChanged:) 
  name:@"UIDeviceOrientationDidChangeNotification" 
  object:nil];
}</pre></div></li><li class="listitem">Next, create the <a id="id1112" class="indexterm"/><code class="literal">hasOrientationChanged</code> method as shown in the following code snippet:<div><pre class="programlisting">-(void)hasOrientationChanged:(NSNotification *)notification {
  UIDeviceOrientationcurrentOrientation;
  currentOrientation = [[UIDevice currentDevice]
  orientation];
  
  switch (currentOrientation) {
    case UIDeviceOrientationFaceUp:
      self.view.backgroundColor = [UIColor brownColor];
      break;
    case UIDeviceOrientationFaceDown:
      self.view.backgroundColor = [UIColor magentaColor];
      break;
    case UIDeviceOrientationPortrait:
      self.view.backgroundColor = [UIColor blueColor];
      break;
    case UIDeviceOrientationPortraitUpsideDown:
      self.view.backgroundColor = [UIColor blueColor];
      break;
    case UIDeviceOrientationLandscapeLeft:
      self.view.backgroundColor = [UIColor greenColor];
      break;
    case UIDeviceOrientationLandscapeRight:
      self.view.backgroundColor = [UIColor redColor];
      break;
    default:
      self.view.backgroundColor = [UIColor blackColor];
      break;
  }
}</pre></div></li><li class="listitem">Build and run the application by choosing <strong>Product</strong> | <strong>Run</strong> from the <strong>Product</strong> menu or alternatively by pressing <em>Command</em> + <em>R</em>.</li></ol></div><p>Try changing the different views of <a id="id1113" class="indexterm"/>
<a id="id1114" class="indexterm"/>orientation by pressing the <em>Command</em> + ;left arrow and <em>Command</em> + right arrow if you are running this within the iOS Simulator as shown in the screenshot:</p><div><img src="img/3349_ADX_01.jpg" alt="How to do it..."/></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec425"/>How it works…</h2></div></div></div><p>What we covered in this recipe were the steps to create our example application. We began by telling our iOS device to start generating the notifications for each of the changes in the orientation that the device will take. We then set up an observer to the <code class="literal">UIDeviceOrientationDidChangeNotification</code> class that gets fired each time the device changes its orientation. Next, <a id="id1115" class="indexterm"/>we determined the current orientation that our iOS device is in by deriving this from the <code class="literal">UIDeviceOrientation</code> <a id="id1116" class="indexterm"/>class. Finally, we proceeded and determined what the current orientation is by using the <code class="literal">switch…case</code> statements and then changed the background color of our view.</p><p>If you want to determine which way the iOS device is facing, you can get this information by using the <code class="literal">UIDevice</code> class <a id="id1117" class="indexterm"/>and then using its orientation property. When registering the <code class="literal">UIDeviceOrientationDidChangeNotificaiton</code> notification method of the <code class="literal">UIDevice</code> class, you are not <a id="id1118" class="indexterm"/>
<a id="id1119" class="indexterm"/>only told when the iOS device has been rotated between portrait and landscape views but also if the iOS device is facing up or down.</p><div><div><h3 class="title"><a id="note75"/>Note</h3><p>If you would like to find out more information on the <code class="literal">UIDevice</code> class, you can refer to the Apple Developer <a id="id1120" class="indexterm"/>documentation located on the link <a class="ulink" href="http://developer.apple.com/library/ios/#documentation/uikit/reference/UIDevice_Class/Reference/UIDevice.html">http://developer.apple.com/library/ios/#documentation/uikit/reference/UIDevice_Class/Reference/UIDevice.html</a>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec426"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Using the shake gesture with the touch interface</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Using Xcode to create an iOS project</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Getting and Installing the iOS SDK Development Tools">Chapter 1</a>, <em>Getting and Installing the iOS SDK Development Tools</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec117"/>Using the shake gesture with the touch interface</h1></div></div></div><p>In this recipe we will <a id="id1121" class="indexterm"/>
<a id="id1122" class="indexterm"/>
<a id="id1123" class="indexterm"/>
<a id="id1124" class="indexterm"/>learn how to detect and handle iOS device motion events.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec427"/>Getting ready</h2></div></div></div><p>Create a new Single View Application, and name it <code class="literal">ShakeExample</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec428"/>How to do it...</h2></div></div></div><p>To begin, follow these simple steps as outlined:</p><div><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file from the Project Navigator.</li><li class="listitem">Next, modify the <code class="literal">viewDidLoad</code> <a id="id1125" class="indexterm"/>method as shown in the following code snippet:<div><pre class="programlisting">- (void)viewDidLoad{
  [super viewDidLoad];
  [self becomeFirstResponder];
  self.view.backgroundColor =[UIColor greenColor];
}</pre></div></li><li class="listitem">Next, create the <a id="id1126" class="indexterm"/><a id="id1127" class="indexterm"/><a id="id1128" class="indexterm"/><a id="id1129" class="indexterm"/>following code sections as specified in the code snippet:<div><pre class="programlisting">- (void)motionBegan:(UIEventSubtype)motion
withEvent:(UIEvent *)event {
  if (event.type == UIEventTypeMotion &amp;&amp; event.subtype == UIEventSubtypeMotionShake) {
    self.view.backgroundColor =[UIColor yellowColor];
    NSLog(@"Device has been shaken");
  }
}
- (void)motionEnded:(UIEventSubtype)motion
withEvent:(UIEvent *)event {
  if (event.type == UIEventTypeMotion &amp;&amp; event.subtype == UIEventSubtypeMotionShake) {
    // Declare an instance of our Alert View dialog
    UIAlertView *dialog;
    
    // Initialize our Alert View Window with options
    dialog =[[UIAlertView alloc] 
    initWithTitle:@"Device has been shaken"
    message:@"I'm all shook up" delegate:self
    cancelButtonTitle:nil
    otherButtonTitles:@"OK",nil];
    // display our alert dialog
    [dialog show];
  }
}
- (void)motionCancelled:(UIEventSubtype)motion
  withEvent:(UIEvent *)event {
  self.view.backgroundColor = [UIColor blackColor];
  NSLog(@"Device shake has been cancelled");
}
- (BOOL)canBecomeFirstResponder {
  return YES;
}

// Responds to the options within our Alert View Dialog
-(void)alertView:(UIAlertView *)alertView
clickedButtonAtIndex:(NSInteger)buttonIndex {
  
  NSString *buttonTitle =[alertView
  buttonTitleAtIndex:buttonIndex];
  
  if ([buttonTitle isEqualToString:@"OK"]) {
    self.view.backgroundColor =[UIColor greenColor];
    NSLog(@"Device has stopped shaking");
    }
}</pre></div></li><li class="listitem">Change the deployment target to your iOS device.</li><li class="listitem">Build and <a id="id1130" class="indexterm"/><a id="id1131" class="indexterm"/><a id="id1132" class="indexterm"/><a id="id1133" class="indexterm"/>run the application by choosing <strong>Product</strong> | <strong>Run</strong> from the <strong>Product</strong> menu or alternatively by pressing <em>Command</em> + <em>R</em>.</li></ol></div><p>When the compilation completes, the application will be displayed onto your iOS device. Try shaking the device to see the alert messages as shown in the following screenshot:</p><div><img src="img/3349_ADX_02.jpg" alt="How to do it..."/></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec429"/>How it works…</h2></div></div></div><p>What we covered in this recipe were the steps to create our example application. We initialized our view background color to green in the <code class="literal">viewDidLoad</code> method to indicate that no shake has occurred and set our view to become the first responder by setting the <code class="literal">becomeFirstResponder</code> method in order to support the motion events. If this method is not included, none of the <a id="id1134" class="indexterm"/>
<a id="id1135" class="indexterm"/>
<a id="id1136" class="indexterm"/>
<a id="id1137" class="indexterm"/>motion events will fire and the application will not behave as designed.</p><p>Next, we needed to make our view controller the first responder in the <code class="literal">UIResponder</code> responder chain by overriding the <code class="literal">motionEnded:motion:withEvent</code> method which will show an alert message when the shake gesture ends. Finally, we implemented the <code class="literal">motionBegan</code> method, which determines when a shake occurs and then sets the background color of our view to yellow. When the device determines that the motion has stopped, the <code class="literal">motionEnded</code> <a id="id1138" class="indexterm"/>method is called and that is where we can detect what type of event happened. In this case, we declare and instantiate an instance of the <code class="literal">UIAlertView</code> <a id="id1139" class="indexterm"/>class and display a message to the user alerting them that the shake has ended. The method <code class="literal">motionCancelled</code> is called if the system thinks that the motion is not a shake. A device shake is determined <a id="id1140" class="indexterm"/>
<a id="id1141" class="indexterm"/>
<a id="id1142" class="indexterm"/>
<a id="id1143" class="indexterm"/>to be approximately a second or so in length and then a call is made to the <code class="literal">motionEnded</code> method to set the background color of our view controller to black.</p><div><div><h3 class="title"><a id="note76"/>Note</h3><p>If you would like to find out more <a id="id1144" class="indexterm"/>information on the <code class="literal">UIResponder</code> class, you can refer to the Apple Developer documentation located on the link <a class="ulink" href="http://developer.apple.com/library/ios/#documentation/uikit/reference/UIResponder_Class/Reference/Reference.html">http://developer.apple.com/library/ios/#documentation/uikit/reference/UIResponder_Class/Reference/Reference.html</a>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec430"/>There's more…</h2></div></div></div><p>When the iOS device is shaken, the system makes use of the accelerometer and then interprets the accelerometer data to see if it is a shake instruction.</p><p>If this has been determined to be a shake gesture, the system creates a <code class="literal">UIEvent</code> object which represents this gesture and then sends the object to the currently active application for processing. Using the shake gesture on the iPhone is a lot simpler to use than touch events. Events are still generated when a motion starts or stops and it is even possible for you to track individual motions, as you would do with touch events.</p><p>In order to make your applications incorporate and handle the iOS shake gesture, this can be easily accomplished by implementing the following three methods as shown in the following table:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Method</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">motionBegan:motion:withEvent:</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id1145" class="indexterm"/>method is called when a motion event begins.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">motionEnded:motion:withEvent:</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This method is <a id="id1146" class="indexterm"/>called when a motion event has ended.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">motionCancelled:motion:withEvent:</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id1147" class="indexterm"/>method is called if the system thinks that the motion is not a shake. Shakes are determined to be approximately a second or so in length.</p>
</td></tr></tbody></table></div><div><div><h3 class="title"><a id="note77"/>Note</h3><p>Motion events were first introduced in the iOS 3.0 SDK, with shaking motions currently being interpreted as gestures which then move on to become motion events.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec431"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Sensing movement and device orientation</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Using Xcode to create an iOS project</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Getting and Installing the iOS SDK Development Tools">Chapter 1</a>, <em>Getting and Installing the iOS SDK Development Tools</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec118"/>Detecting device touches with the touch interface</h1></div></div></div><p>In this recipe we will <a id="id1148" class="indexterm"/>
<a id="id1149" class="indexterm"/>
<a id="id1150" class="indexterm"/>
<a id="id1151" class="indexterm"/>learn how to detect and handle the various touch events of the iOS device.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec432"/>Getting ready</h2></div></div></div><p>Create a new Single View Application and name it <code class="literal">TapExample</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec433"/>How to do it...</h2></div></div></div><p>To begin, follow these simple steps as outlined:</p><div><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file from the Project Navigator.</li><li class="listitem">Next, create the <code class="literal">touchedBegan</code> method as shown in the following code snippet:<div><pre class="programlisting">- (void) touchesBegan:(NSSet *)touches withEvent:(UIEvent*)event {
  UITouch *touch = [[event allTouches] anyObject];
  switch ([touch tapCount]){
    case 1:
      self.view.backgroundColor =[UIColor redColor];break;
    case 2:
      self.view.backgroundColor =[UIColorgreenColor];break;
    case 3:
      self.view.backgroundColor =[UIColor blueColor];break;
    case 4:
      self.view.backgroundColor =[UIColoryellowColor];break;
    case 5:
      self.view.backgroundColor =[UIColororangeColor];break;
    default:
      self.view.backgroundColor =[UIColor redColor];break;
  }
}</pre></div></li><li class="listitem">Ensure that you have changed the deployment target to your iOS device.</li><li class="listitem">Build and run the application by choosing <strong>Product</strong> | <strong>Run</strong> from the <strong>Product</strong> menu, or alternatively by pressing <em>Command</em> + <em>R</em>.</li></ol></div><p>When the compilation completes, the application will be displayed <a id="id1152" class="indexterm"/>
<a id="id1153" class="indexterm"/>
<a id="id1154" class="indexterm"/>
<a id="id1155" class="indexterm"/>onto your iOS device. Try tapping the device screen to see the view background change as shown in the following screenshot:</p><div><img src="img/3349_ADX_03.jpg" alt="How to do it..."/></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec434"/>How it works…</h2></div></div></div><p>What we covered in this recipe were the steps to create our example application. We then implemented the <code class="literal">touchesBegan:touches</code> method which determines when a gesture has been made on the iOS device and then updates our views background color based on the total number of taps made.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec435"/>There's more…</h2></div></div></div><p>The <code class="literal">UIView</code> and <a id="id1156" class="indexterm"/>
<a id="id1157" class="indexterm"/>
<code class="literal">UIViewController</code> classes are all part of the <code class="literal">UIResponder</code> class as they can respond to and handle events within the view. By implementing any of the following methods, you are then able to override the methods used by your view or view controller:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal"> - (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">- (void)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">- (void)touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">- (void)touchesCancelled:(NSSet *)touches withEvent:(UIEvent *)event</code><div><img src="img/3349OT_ADX_04.jpg" alt="There's more…"/></div></li></ul></div><p>Each of the <em>UITouch</em> touches that <a id="id1158" class="indexterm"/>
<a id="id1159" class="indexterm"/>
<a id="id1160" class="indexterm"/>
<a id="id1161" class="indexterm"/>get received has a phase, location, the view in which the touch occurred, a timestamp, and a count of the number of taps that occurred. In the following table we explain what happens when each of the touch phases are fired:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>UITouch events</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">UITouchPhaseBegan</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Occurs at the <a id="id1162" class="indexterm"/>
<a id="id1163" class="indexterm"/>beginning of the touch life cycle when the user has touched an area of the iPhone screen.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">UITouchPhaseMoved</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Occurs when the <a id="id1164" class="indexterm"/>
<a id="id1165" class="indexterm"/>user has moves their finger or fingers around the screen of the iPhone.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">UITouchPhaseStationary</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Occurs when the <a id="id1166" class="indexterm"/>
<a id="id1167" class="indexterm"/>user has paused on an area of the screen.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">UITouchPhaseEnd</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Occurs when the <a id="id1168" class="indexterm"/>
<a id="id1169" class="indexterm"/>user has removed their fingers from the screen of the iPhone.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">UITouchPhaseCancelled</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Occurs when the iOS <a id="id1170" class="indexterm"/>
<a id="id1171" class="indexterm"/>device determines that something has happened and needs to abort the gesture. An example of this can be due to a system interruption caused when you are receiving an incoming phone <a id="id1172" class="indexterm"/>
<a id="id1173" class="indexterm"/>
<a id="id1174" class="indexterm"/>
<a id="id1175" class="indexterm"/>call or when an application or window view is no longer active.</p>
</td></tr></tbody></table></div><div><div><h3 class="title"><a id="note78"/>Note</h3><p>If you would like to find out more information on the <code class="literal">UIResponder</code> class, you can refer to the Apple Developer documentation located on the link <a class="ulink" href="http://developer.apple.com/library/ios/#documentation/uikit/reference/UIResponder_Class/Reference/Reference.html">http://developer.apple.com/library/ios/#documentation/uikit/reference/UIResponder_Class/Reference/Reference.html</a>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec436"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Using the shake gesture with the touch interface</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Sensing movement and device orientation</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Using Xcode to create an iOS project</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Getting and Installing the iOS SDK Development Tools">Chapter 1</a>, <em>Getting and Installing the iOS SDK Development Tools</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec119"/>Sensing movement with the accelerometer input</h1></div></div></div><p>In this recipe we will learn how to use the features of the <a id="id1176" class="indexterm"/>
<a id="id1177" class="indexterm"/>
<a id="id1178" class="indexterm"/>
<a id="id1179" class="indexterm"/>accelerometer events of the iOS device.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec437"/>Getting ready</h2></div></div></div><p>Create a new Single View Application, and name it <code class="literal">AccelGyroExample</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec438"/>How to do it...</h2></div></div></div><p>To begin, follow these simple steps as outlined:</p><div><ol class="orderedlist arabic"><li class="listitem">Select the <code class="literal">AccelGyroExample</code> project from the Project Navigator.</li><li class="listitem">Then select your project from under the <strong>TARGETS</strong> group.</li><li class="listitem">Select the <strong>Build Phases</strong> tab.</li><li class="listitem">Expand the <strong>Link Binary With Libraries</strong> disclosure triangle.</li><li class="listitem">Click on the <strong>+</strong> button and select the <strong>CoreMotion.framework</strong> from the list.</li><li class="listitem">Then click on the <strong>Add</strong> <a id="id1180" class="indexterm"/>button to add the framework to your project.<div><img src="img/3349_ADX_05.jpg" alt="How to do it..."/></div></li><li class="listitem">Our next step is to <a id="id1181" class="indexterm"/><a id="id1182" class="indexterm"/><a id="id1183" class="indexterm"/><a id="id1184" class="indexterm"/>create the code functionality that will be responsible for accessing the accelerometer device features.</li><li class="listitem">Open the <code class="literal">ViewController.h</code> interface file and create the following highlighted entries as shown in the following code snippet:<div><pre class="programlisting">//  ViewController.h
//  AccelGyroExample
//  Created by Steven F Daniel on 19/09/12.
//  Copyright (c) 2012 GenieSoft Studios. All rights reserved.

#import  &lt;UIKit/UIKit.h&gt;
<strong>#import &lt;CoreMotion/CoreMotion.h&gt;</strong>

<strong>@interface ViewController :  UIViewController  &lt;UIAccelerometerDelegate&gt; {</strong>
<strong>	CMMotionManager *motionManager;</strong>
<strong>}</strong>

<strong>@property (nonatomic, retain) CMMotionManager *motionManager;</strong>

@end</pre></div></li><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file, and add the following highlighted code snippet:<div><pre class="programlisting">#import "ViewController.h"

@interface ViewController ()
@end

@implementation ViewController

<strong>@synthesize motionManager;</strong>
</pre></div></li><li class="listitem">Next, <a id="id1185" class="indexterm"/><a id="id1186" class="indexterm"/><a id="id1187" class="indexterm"/><a id="id1188" class="indexterm"/>modify the <code class="literal">viewDidLoad</code> method as shown by the highlighted code sections:<div><pre class="programlisting">- (void)viewDidLoad
{
  [super viewDidLoad];
  
<strong>  // Set up the accelerometer</strong>
<strong>  UIAccelerometer *accelerometer = [UIAccelerometer</strong>
<strong>  sharedAccelerometer];</strong>
<strong>  accelerometer.updateInterval = 0.5;</strong>
<strong>  accelerometer.delegate = self;</strong>
}</pre></div></li><li class="listitem">Next, create the <a id="id1189" class="indexterm"/><code class="literal">handleAcceleration</code> method as shown in the following code snippet:<div><pre class="programlisting">// Handle processing of the Accelerometer
-(void)accelerometer:(UIAccelerometer *)accelerometer didAccelerate:(UIAcceleration *)acceleration
{
  UIAccelerationValue xAxes;
  UIAccelerationValue yAxes;
  UIAccelerationValue zAxes;

  xAxes = acceleration.x;
  yAxes = acceleration.y;
  zAxes = acceleration.z;

  if (xAxes &gt; 0.5) {         // Moving Right
    self.view.backgroundColor = [UIColor purpleColor];
  } else if (xAxes &lt; -0.5) { // Moving Left
    self.view.backgroundColor = [UIColor redColor];
  } else if (yAxes &gt; 0.5) {  // Moving Upside Down
    self.view.backgroundColor = [UIColor yellowColor];
  } else if (yAxes &lt; -0.5) { // Standing Up
    self.view.backgroundColor = [UIColor blueColor];
  } else if (zAxes &gt; 0.5) {  // Facing Up
    self.view.backgroundColor = [UIColor magentaColor];
  } else if (zAxes &lt; -0.5) { // Facing Down
    self.view.backgroundColor = [UIColor greenColor];
  }

  double value = fabs(xAxes);
  if (value &gt; 1.0) { value = 1.0;}
  self.view.alpha = value;
}</pre></div></li><li class="listitem">Change the deployment target to your iOS device.</li><li class="listitem">Build and run the application by choosing <strong>Product | Run</strong> from the <strong>Product</strong> menu, or alternatively by pressing <em>Command + R</em>.</li></ol></div><p>When the compilation completes, the application will be displayed onto your iOS device. Try moving your device in all directions and see the background color change.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec439"/>How it works…</h2></div></div></div><p>What we have done in <a id="id1190" class="indexterm"/>
<a id="id1191" class="indexterm"/>
<a id="id1192" class="indexterm"/>
<a id="id1193" class="indexterm"/>this recipe is implement the <code class="literal">UIAccelerometerDelegate</code> protocol so that we can use this within our <code class="literal">ViewController.m</code> implementation file.</p><p>We then declare an instance <code class="literal">CMMotionManager</code> of variable <code class="literal">motionManager</code> that will enable us to use the accelerometer and gyroscope features. We then need to synthesize our property we declared within our <code class="literal">ViewController.h</code> interface file. If we don't declare this, we will receive a warning error messages which can cause unexpected application errors.</p><p>Next, we declare our methods that will handle the accelerometer and the gyroscope features. In the first part, we declare a <a id="id1194" class="indexterm"/>delegate to the <code class="literal">UIAccelerometer</code> class, and then derive the values for the x, y, and z which will be used to determine the current device orientation and set the background color accordingly.</p><p>As a final step, we set the background alpha property from transparent to opaque depending on whether the value is within the range 0.0 to 1.0, where 0.0 represents totally transparent, and 1.0 represents opaque.</p><div><div><h3 class="title"><a id="note79"/>Note</h3><p>When you set the alpha property of a view, it only affects the current view and does not affect any of its embedded sub-views. The <code class="literal">fabs</code> function is a C/C++ library function that returns the absolute value of X.</p><p>If you would like to find out more information on the <code class="literal">CoreMotion</code> class, you can refer to the Apple Developer <a id="id1195" class="indexterm"/>documentation located at the following link provided: <a class="ulink" href="http://developer.apple.com/library/ios/#documentation/CoreMotion/Reference/CoreMotion_Reference/_index.html">http://developer.apple.com/library/ios/#documentation/CoreMotion/Reference/CoreMotion_Reference/_index.html</a>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec440"/>There's more…</h2></div></div></div><p>So far you have been focusing on how to detect when a user performs taps and how to detect device shakes. We now move on to the really exciting stuff, not that what you have not already covered is exciting, but the iPhone's accelerometer is much more powerful than you think and is capable of giving you live data for all three dimensions of the (x, y, and z) axes when the iOS device is tilted.</p><p>The iOS's device <a id="id1196" class="indexterm"/>
<a id="id1197" class="indexterm"/>
<a id="id1198" class="indexterm"/>
<a id="id1199" class="indexterm"/>accelerometer data is delivered via the <code class="literal">UIAccelerometer</code> class and the <a id="id1200" class="indexterm"/>delegate <code class="literal">accelerometer:didAccelerate</code> method which provides you with the data for each of the three axes, each being of <code class="literal">UIAcceleration</code> class. Each of the values returned have a range between -1 and <strong>+</strong>1 with 0 being the middle center point. When the device is moved or tilted, these values increase or decrease.</p><div><div><h3 class="title"><a id="note80"/>Note</h3><p>The iPhone 4 and above versions adds another sensor that is, a three-axis gyroscope and when combining the gyroscope with the accelerometer, this gives the iPhone 4 six axes on which it can operate and was designed to make the iPhone 4 more sensitive, responsive, and powerful for gaming.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec441"/>Understanding the core motion framework</h2></div></div></div><p>The Core Motion <a id="id1201" class="indexterm"/>framework is a system framework which obtains motion data from sensors on the iOS device. The application can then use these values. Handling of the sensor data is handled within the Core Motion's own thread and it detects the motion events for the accelerometer and the gyroscope (which is currently only available on the iPhone 4). This can be illustrated in the following diagram:</p><div><img src="img/3349OT_ADX_06.jpg" alt="Understanding the core motion framework"/></div><p>The following table describes each of the <a id="id1202" class="indexterm"/>components that make up the Core Motion framework:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Core Motion Classes</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CMMotionManager</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This class defines a <a id="id1203" class="indexterm"/>
<a id="id1204" class="indexterm"/>manager class that encapsulates measurements of motion data. </p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CMAccelerometerData</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This class records <a id="id1205" class="indexterm"/>
<a id="id1206" class="indexterm"/>measurement of device acceleration and gathers data from the accelerometer for each of its three axes.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CMDeviceMotion</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This captures device motion <a id="id1207" class="indexterm"/>
<a id="id1208" class="indexterm"/>data from both the accelerometer and gyroscope.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CMAttitude</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is contained as <a id="id1209" class="indexterm"/>
<a id="id1210" class="indexterm"/>part of the <code class="literal">CMDeviceMotion</code> class and contains properties that give different measurements of attitude, including the following: roll, pitch, and yaw.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CMGyroData</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This class records the <a id="id1211" class="indexterm"/>
<a id="id1212" class="indexterm"/>devices rate of rotation along its three spatial axes from the gyroscope.</p>
</td></tr></tbody></table></div><div><div><h3 class="title"><a id="note81"/>Note</h3><p>The iOS Simulator does not support the Accelerometer and Gyroscope features, so in the event that you want to run the examples shown in this appendix, you will need to deploy them to your iPhone device.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec442"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Using the shake gesture with the touch interface</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Working with the iOS device gyroscope</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Using Xcode to create an iOS project</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Getting and Installing the iOS SDK Development Tools">Chapter 1</a>, <em>Getting and Installing the iOS SDK Development Tools</em></li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec120"/>Working with the iOS device gyroscope</h1></div></div></div><p>In this recipe we will <a id="id1213" class="indexterm"/>
<a id="id1214" class="indexterm"/>learn how to use the features of the Gyroscope events of the iOS device.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec443"/>Getting ready</h2></div></div></div><p>We have looked at how to use the iOS devices accelerometer and modify the views background color based on the orientation of the axes. In this recipe we will look at how to incorporate the gyroscope features.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec444"/>How to do it...</h2></div></div></div><p>To begin, follow these simple steps as outlined:</p><div><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">AccelGyroExample.xcodeproj</code> project file.</li><li class="listitem">Open the <code class="literal">ViewController.m</code> implementation file and modify the <code class="literal">viewDidLoad</code> method as shown in the following highlighted code snippet:<div><pre class="programlisting">- (void)viewDidLoad
{
  [super viewDidLoad];
  // Set up the accelerometer
  UIAccelerometer *accelerometer = [UIAccelerometer
  sharedAccelerometer];
  accelerometer.updateInterval = 0.5;
  accelerometer.delegate = self;
<strong>  // Perform a check to see if the device </strong>
<strong>  // supports the Gyroscope feature</strong>
<strong>  if ([self isGyroscopeAvailable] == YES) {</strong>
<strong>    motionManager = [[CMMotionManager alloc] init];</strong>
<strong>    [motionManager</strong>
<strong>    startGyroUpdatesToQueue:[NSOperationQueue</strong>
<strong>    currentQueue]</strong>
<strong>    withHandler:^(CMGyroData *gyroData, NSError *error)</strong>
<strong>    {</strong>
<strong>      [self doGyroRotation:gyroData.rotationRate];</strong>
<strong>    }];</strong>
<strong>  }</strong>
<strong>  else {</strong>
<strong>    // Device does not support the gyroscope feature</strong>
<strong>    NSLog(@"No Gyroscope detected.");</strong>
<strong>  }</strong>
}</pre></div><p>Next, create the following code sections, as specified in the following code snippet:</p><div><pre class="programlisting">// Handles rotation of the Gyroscope
- (void)doGyroRotation:(CMRotationRate)rotation {
  double value = 
  (fabs(rotation.x)+fabs(rotation.y) + fabs(rotation.z)) / 8.0;
  if (value &gt; 1.0) { value = 1.0;}
  self.view.alpha = value;
}
// Checks to see if Gyroscope is available on the device
- (BOOL) isGyroscopeAvailable
{
  #ifdef __IPHONE_4_0
  CMMotionManager *gyroManager = 
  [[CMMotionManager alloc] init];
  gyroManager.gyroUpdateInterval = 1.0 / 60.0;
  BOOL gyroAvailable = gyroManager.gyroAvailable;
  return gyroAvailable;
  #else
  return NO;
  #endif
}</pre></div></li><li class="listitem">Change the deployment <a id="id1215" class="indexterm"/><a id="id1216" class="indexterm"/>target to your iOS device.</li><li class="listitem">Build and run the application by choosing <strong>Product</strong> | <strong>Run</strong> from the <strong>Product</strong> menu or alternatively by pressing <em>Command</em> + <em>R</em>.</li></ol></div><p>When the compilation completes, the application will be displayed onto your iOS device. Try moving your device in all directions to see the background color start cycling through the various colors.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec445"/>How it works…</h2></div></div></div><p>What we have done in this recipe is added code to determine by using the <code class="literal">#Ifdef __IPHONE_4_0</code> directive if the device currently in use is an iPhone 4. If this is the case, it then checks to see if the device supports the gyroscope feature and a Boolean status <code class="literal">YES</code> is returned; otherwise <code class="literal">NO</code> is returned.</p><p>Next, we set up our <code class="literal">UIAccelerometer</code> delegate and update intervals to be twice per second in order to request updates. We then make a call to our <code class="literal">isGyroscopeAvailable</code> function to check to see if the gyroscope feature is supported.</p><p>Finally, we call the <a id="id1217" class="indexterm"/>
<code class="literal">startGyroUpdatesToQueue</code> function and add a handler to call our <code class="literal">doGryroRotation</code> function that then updates the alpha <a id="id1218" class="indexterm"/>blend color of our view. If no gyroscope feature is supported, this <a id="id1219" class="indexterm"/>
<a id="id1220" class="indexterm"/>is logged out to the debug window.</p><div><div><h3 class="title"><a id="note82"/>Note</h3><p>To start receiving and handling rotation-rate data for the gyroscope feature, you need to create an instance of the <code class="literal">CMMotionManager</code> class and call one of the following methods to it.</p></div></div><p>The following image shows how the iPhone responds to changes on its three axes when the iPhone is tilted. Under normal gravity, each of these values will be between -1 and +1 with a value of 0 being the middle center point. Moving the phone in a rapid motion will increase these values:</p><div><img src="img/3349OT_ADX_07.jpg" alt="How it works…"/></div><p>The following table explains each of the <a id="id1221" class="indexterm"/>
<a id="id1222" class="indexterm"/>method calls relating to the <code class="literal">CMMotionManager</code> class:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>CMMotionManager methods</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">startGyroUpdates</code>
</p>
</td><td style="text-align: left" valign="top">
<p>When this <a id="id1223" class="indexterm"/>
<a id="id1224" class="indexterm"/>method is called, Core Motion kicks in and continuously updates the <code class="literal">gyroData</code> property of the <code class="literal">CMMotionManager</code> class with the latest measurement of activity. </p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">startGyroUpdatesToQueue:withHandler</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Before calling <a id="id1225" class="indexterm"/>
<a id="id1226" class="indexterm"/>this method, you need to ensure that you have set the update interval of the <code class="literal">gyroUpdateInterval</code> property.</p>
<p>When this method is called, it creates an <code class="literal">NSOperationQueue</code> event that queues the gyroscope event that then fires when the update interval has been reached, then calls the function and passes it the latest gyroscope data.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">stopGyroUpdates</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This method <a id="id1227" class="indexterm"/>
<a id="id1228" class="indexterm"/>turns off the Core Motion sensors and stops all updates of motion data. It is a good idea to always stop gyro updates as this will save battery power. </p>
</td></tr></tbody></table></div><div><div><h3 class="title"><a id="note83"/>Note</h3><p>If you would like to find <a id="id1229" class="indexterm"/>
<a id="id1230" class="indexterm"/>out more information about the <code class="literal">CoreMotion</code> class, you can refer to the Apple Developer documentation located on the link <a class="ulink" href="http://developer.apple.com/library/ios/#documentation/CoreMotion/Reference/CoreMotion_Reference/_index.html">http://developer.apple.com/library/ios/#documentation/CoreMotion/Reference/CoreMotion_Reference/_index.html</a>.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec446"/>See also</h2></div></div></div><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <em>Using the shake gesture with the touch interface</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Sensing movement with the accelerometer input</em> recipe</li><li class="listitem" style="list-style-type: disc">The <em>Using Xcode to create an iOS project</em> recipe in <a class="link" href="ch01.html" title="Chapter 1. Getting and Installing the iOS SDK Development Tools">Chapter 1</a>, <em>Getting and Installing the iOS SDK Development Tools</em></li></ul></div></div></div></body></html>