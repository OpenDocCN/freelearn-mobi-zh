<html><head></head><body><h1 id="e-FAF2">Chapter 1. Introduction to the Facebook Platform</h1>
<p id="e-P9vO">Platform is one of the main components of the Facebook project. It allows developers to produce third-party applications that are able to rely on Facebook's architectural layers to expand their own systems. Ever since May 2007, when Platform was launched, Facebook engineers have worked really hard on extending, improving, and making the architecture more flexible, reliable, secure, and robust. Since last year, Facebook has been focusing on improving the user experience on mobile devices leading them to extend their architecture with native SDKs such as iOS and Android.</p>
<p id="e-hlg9">In this chapter, we are going to take a look at Facebook Platform's architecture and features from a developer's point of view. We will be focusing on those parts of the Platform that can enable our application to go viral within the social world.</p>
<h1 id="e-d4bx">Facebook Platform – features</h1>
<p id="e-uFXf">Facebook has changed a lot since its initial launch. During its first release, it was nothing more than a repository for students' information. When Facebook became a leading social network site, Facebook engineers started to develop a set of REST APIs that would later allow developers to extract parts of users' data such as basic information, activity, and friends' lists.</p>
<p id="e-J1tE">As we mentioned earlier, during last year, Facebook has put lots of efforts into producing a variety of sets of SDKs to satisfy developers' demand.</p>
<img data-width="500" data-height="495" src="img/Gh1I9pcO.jpg"/><p id="e-hWp1">The preceding diagram displays Facebook's Platform having a modular architecture that provides multiple functionalities to developers.</p>
<h2 id="e-fbbY">Social Graph</h2>
<p id="e-J4FE">Social Graph is the core component of Facebook Platform. The Platform uses a graph structure to store users, objects, and connections across them. We can summarize the structure of Social Graph as follows:</p>
<ul id="e-ZgjB">
<li id="e-nKUJ">
<strong>User</strong>: This is the data structure that represents a single person on the Facebook Graph.</li>
<li id="e-Gw6R">
<strong>Action</strong>: This is the link between two objects. This can be customized using attributes defined by the Platform or created by developers.</li>
<li id="e-DO9K">
<strong>Object:</strong> This represents any entity besides the user; for example, Facebook Event and Facebook Page. It is possible to customize any object using Open Graphs.</li>
</ul>
<p id="e-IZHG">A use case of Social Graph is when a Facebook user likes a friend's picture. In this case, the picture is the object; the <em>like</em> corresponds to the action; and the Facebook user, of course, is the user.</p>
<p id="e-q0Wl">The following diagram displays Social Graph's basic structure based on the just-mentioned use case scenario:</p>
<img data-width="500" data-height="412" src="img/wvII6FtG.jpg"/><p id="e-i7cw">The graph structure provides the following advantages:</p>
<ul id="e-iNgH">
<li id="e-GGnF">
<strong>High relationship customization</strong>: Developers can use the predefined connections or create  their own connections.</li>
<li id="e-ERLH">
<strong>Distribution</strong>: Friends' activities are easily discoverable and shown on users' timelines using graph path algorithms.</li>
<li id="e-FcTO">
<strong>Object customization</strong>: Anything can be an object, users as well. If the default object definitions are not sufficient, no problem, developers can create our own customized objects and store them in the Social Graph.</li>
</ul>
<p id="e-MmLM">There are more technical advantages provided by the graph structure, but they are outside the scope of the book.</p>
<h2 id="e-GVB3">Graph API</h2>
<p id="e-gim3">Graph API being the most important part of Facebook Platform is available to the external world; in fact, it is the primary tool available to developers to interact with the Social Graph and life. This is an API system based on HTTP calls used to query, update, and create new objects and actions.</p>
<p id="e-Bw7i">Graph API is also the system that Facebook SDKs use to implement the low-level communication between our applications and Social Graph.</p>
<p id="e-OTjr">We will be focusing on Graph API in Chapter 6, <em>Facebook Graph API</em>.</p>
<h2 id="e-kWGq">Social Plugins</h2>
<p id="e-XMdV">Social Plugins are web tools that can be used to extend websites with social functionalities connected to Facebook Platform. The following list shows the current Social Plugins provided by the Platform:</p>
<ul id="e-pu5y">
<li id="e-A5tl">
<strong>Like Button</strong>: This enables users to share web pages from external websites to their Facebook profile</li>
<li id="e-HQ6Q">
<strong>Send Button</strong>: This sends the web content to Facebook friends</li>
<li id="e-zLjk">
<strong>Follow Button</strong>: This allows people to subscribe to other Facebook users</li>
<li id="e-bMth">
<strong>Comments</strong>: This lets users create a comment for any part of your website</li>
<li id="e-Sca8">
<strong>Activity Feed</strong>: This enables other websites to display a user's friends' activities</li>
<li id="e-M5hY">
<strong>Recommendation Box</strong>: This suggests which page the users may appreciate on your site</li>
<li id="e-K7Sd">
<strong>Like Box</strong>: This enables users to like and show your Facebook page on your website</li>
<li id="e-ZnH1">
<strong>Login Button</strong>: This shows Facebook's <strong>Login</strong> button and pictures of friends who have already logged in within the current site</li>
<li id="e-vj3a">
<strong>Registration</strong>: This enables your website to use Facebook as an authentication system</li>
<li id="e-JvbO">
<strong>Facepile</strong>: This shows friends' pictures who already liked the Facebook page or signed up onto your website</li>
</ul>
<p id="e-qjfi">All Social Plugins are available only for web applications.</p>
<h2 id="e-yOdn">Dialogs</h2>
<p id="e-DZh9">Dialogs provide consistent interfaces to access social features across multiple platforms. There are seven dialogs available currently and the most important ones in my opinion are the following:</p>
<ul id="e-h0Ky">
<li id="e-RHel">
<strong>Share Dialog</strong>: To post on a user's timeline</li>
<li id="e-dyyU">
<strong>Login Dialog</strong>: To authorize an application to use Facebook Platform as a single sign-on entry point</li>
<li id="e-PELz">
<strong>Friends Dialog</strong>: To send friend requests</li>
</ul>
<h2 id="e-Crwy">Authentication and permissions</h2>
<p id="e-wd8Z">The login part of the Facebook Platform is divided into two different pieces as follows:</p>
<ul id="e-cWXS">
<li id="e-qnNN">Application permissions giving our social apps access to user information. We will be discussing these permissions later in this chapter.</li>
<li id="e-LFom">A signed request is a part of the request that the Platform passes to the application in certain cases; this is not really important for the scope of the book; therefore, we will not talk about it.</li>
</ul>

<h1 id="e-C9Yj">Functionality – storing and using data from the Platform</h1>
<p id="e-TCGi">Due to the types of data that developers are dealing with, Facebook has implemented strict policies about the use of such users' information. Developers need to be careful about the way they handle data received from the Platform.</p>
<p id="e-MpRG">The Facebook Platform contains a plethora of information about any user. Due to this abundance, developers should only request the necessary data to operate with their applications in the best way possible.</p>
<p id="e-kbkE">Developers have access to basic user information after the users log in to their social applications without asking for any particular permission. Basic account information includes name, gender, profile picture, URL, and friends' list. In order to access more account data, we need to explicitly ask for a user's permission.</p>
<p id="e-JfXY">In order to access extra information, we need to ask for permissions. In addition, we will also need to define and make our application's privacy policy available to users. We need to exactly specify what we will be doing with user's information.</p>
<h3 id="e-hCXu">Note</h3>
<p id="e-CeTt">Note that no information can be shared with any third-party network, ad exchange and monetization, or the advertising service. Refer to <a href="https://developers.facebook.com/policy/">https://developers.facebook.com/policy/</a> for more information.</p>
<h2 id="e-Q8ON">Integration points</h2>
<p id="e-GdpF">It is really important to understand application integration points. These points will ensure the visibility of our social apps. Facebook Platform provides many integration points that will help in creating a seamless user experience between our users and applications.</p>
<p id="e-bLxd">When we build a Facebook application, either mobile or desktop, we always need to keep in mind to use all available integration or marketing points that could fit with our social application. The points provided by the Platform are as follows:</p>
<ul id="e-jp2Q">
<li id="e-Fzid">Content and information</li>
<li id="e-AM10">Communication and feeds</li>
<li id="e-lGRE">Mobile information and communications</li>
<li id="e-WKsE">User actions</li>
<li id="e-tc9F">Marketing and promotional mechanisms</li>
</ul>
<p id="e-JlUq">Integration points will be covered in Chapter 8, <em>Promoting Your Social Application</em>.</p>
<p id="e-Lcnq">Facebook defines a policy on integration points' usage. Developers should always define fair user experiences that will not discourage users from using Facebook's social channels. Once our application is granted the permission to post on a user's timeline, the application should always alert the user of the next timeline update. The kind of advertisements we place in our social applications must look different from any visual objects of Facebook Platform.</p>
<p id="e-Kgad">There is an important note about Facebook messaging. This channel should only be used for communication between users and not between application and users.</p>
<h2 id="e-EXiB">Facebook App Portal</h2>
<p id="e-ldMh">Facebook App Portal was introduced in May 2012 to help users install it on their timeline or mobile devices. The portal was initially launched with 600 mobile and web applications. In this portal, a team selects applications that will appear in the App Center in order to ensure high-quality products are made available to the public, based on user ratings and application engagement analytics. This does not mean we cannot create new Facebook apps but in order to see them alive in App Center, we will have to wait until our applications gain popularity.</p>
<p id="e-RItu">There are also some critics about the Facebook App Center. The same policy that helps improve the quality of the products offered on the portal denies visibility to new-born applications.</p>
<p id="e-PIXL">The goal of Facebook App Center is not to replace iOS App or the Google Play store. The real target is to redirect mobile users to such stores. To gain more data, we can take a look at the following statistics:</p>
<ul id="e-Kn5E">
<li id="e-F7nZ">App Center redirected people to the App Store more than 83 million times only in May 2012</li>
<li id="e-C2r8">Similarly, Facebook directed users to iOS apps 134 million times in May 2012</li>
</ul>
<p id="e-Y8Ur">Facebook App Center is available on <a href="http://Facebook.com">Facebook.com</a> in desktop and mobile versions and also on Facebook iOS and Android apps. We are going to have an overview of both, the desktop and mobile versions.</p>
<p id="e-F9XP">For the desktop version, you can find the  <strong>App Center</strong> link on the left side bar. Once you click on the link, you will be redirected to the actual portal; you can also access the App Center by going to <a href="https://www.facebook.com/appcenter/">https://www.facebook.com/appcenter/</a>.</p>
<img data-width="800" data-height="518" src="img/DrchvWYh.jpg"/><p id="e-ewhM">Facebook App Center – the main part</p>
<p id="e-M0bs">The user experience is completely customized based on the Facebook profile. In fact the page will look different based on the user who is visiting it. The suggestion system uses recommendation and data from your friends to customize your portal's landing page.</p>
<p id="e-i33b">As you can see in the preceding screenshot, the page layout is simple. Within the left side bar, we have three sections: search and categories, requests and our applications, and Facebook Gift Cards. In the center of the page, we can see different sections such as <strong>Top Games</strong> and <strong>Friends' Games</strong>. These sections are uniquely customized for each user.</p>
<p id="e-n01R">If we scroll down, we can also see a section as shown in the following screenshot:</p>
<img data-width="750" data-height="633" src="img/VASlBB26.jpg"/><p id="e-AWKC">We can easily understand how suggestions work on the portal—the most popular applications among our friends are always on top.</p>
<p id="e-RGVs">Of course, we are glad that Facebook decided to give us the option to go beyond and discover applications that are not used from our network.</p>
<p id="e-O7DM">We can also take a look at the Android mobile version of the App Center, as shown in the following screenshot:</p>
<img data-width="550" data-height="470" src="img/Ib1MEYOs.jpg"/><h2 id="e-KoTQ">Application permissions</h2>
<p id="e-ykIg">As already mentioned, privacy is the first concern when it comes to users' data. Facebook is aware of this issue and is in pursuit of protecting user information from unwanted access.</p>
<p id="e-DvKL">To regulate access to account information, Facebook engineers defined a privacy policy based on permissions. Permissions are the only way developers can access account information.</p>
<p id="e-Udb4">When we create a Facebook application (we will see how to do this later), we will have automatic access to certain information of a user. This is also called <strong>Basic Account Information or Public Profile and Friend List</strong>.</p>
<p id="e-ODim">Sometimes that information is not enough to serve our application experience; therefore, we can ask our users for the following permissions:</p>
<ul id="e-VeC3">
<li id="e-NTZe"><strong>Email Permissions</strong></li>
<li id="e-iyW0"><strong>Extended Profile Permissions</strong></li>
<li id="e-cRXy"><strong>Extended Permissions</strong></li>
<li id="e-DHaD"><strong>Open Graph Permissions</strong></li>
<li id="e-UmUj"><strong>Page Permissions</strong></li>
</ul>
<p id="e-hb3H"><strong>Basic Account Permission or Public Profile and Friend List</strong>: This provides access to the following account properties: <code>id</code>, <code>name</code>, <code>first_name</code>, <code>last_name</code>, <code>link</code>, <code>username</code>, <code>gender</code>, <code>locale</code>, <code>age range</code>, and all information that we set as public.</p>
<p id="e-joME"><strong>Email Permissions</strong>: This gives access to users' e-mail addresses. Be careful because, based on the Facebook Platform policy, you cannot spam users' email accounts. For better and more detailed information, please refer to <a href="https://developers.facebook.com/docs/reference/login/email-permissions/">https://developers.facebook.com/docs/reference/login/email-permissions/</a>.</p>
<p id="e-iyzk"><strong>Extended Profile Permissions</strong>: This is used to access the profile information. This set of permissions cannot be revoked during the login flow; therefore, they are not optional. If we want them to be optional, we have to design our workflow application to request them in a specific part of our app rather than at the time of login. For more detailed information, please refer to <a href="https://developers.facebook.com/docs/reference/login/extended-profile-properties/">https://developers.facebook.com/docs/reference/login/extended-profile-properties/</a>.</p>
<p id="e-GUxA"><strong>Extended Permissions</strong>: This allows developers to have access to sensitive information and gives the ability to publish and delete data.</p>
<p id="e-rUFF">When an application is granted access to publish permissions, we are able to perform the following actions:</p>
<ul id="e-JMDV">
<li id="e-Nc7h">Upload photos and videos (creating albums is included)</li>
<li id="e-jZ42">Post to the user's feed</li>
<li id="e-Fi74">Create a tag on photos and videos</li>
<li id="e-aiGz">Create likes and comments on stories</li>
<li id="e-XTql">Post questions</li>
<li id="e-iyXa">Create notes</li>
<li id="e-H4gI">Create content for events or group</li>
</ul>
<p id="e-wXKT">We should only ask for extended permissions as needed.</p>
<p id="e-aizS"><strong>Open Graph Permissions</strong>: This gives access to the Open Graph information, and the ability to create new actions.</p>
<p id="e-kEso"><strong>Page Permissions</strong>: This allows developers to retrieve information about pages and applications owned by the current user.</p>
<p id="e-Ce6b">Our application should be smart enough to understand which permissions we currently own on a user's account information at runtime. Every time we perform any operation on Facebook users' data, the application should check at runtime whether we are granted the permission to complete the requested operations. This is really important because the user is then able to modify/delete application permissions outside the application environment through the Facebook website.</p>
<p id="e-igB8">Handling missing permissions will definitely improve user interaction with our application. The user experience will result in being more fluid, and we will not deal with negative feedback on our App Store landing page.</p>
<h3 id="e-QDG7">Tip</h3>
<p id="e-Ajlg"><strong>Rule of thumb</strong></p>
<p id="e-nJRO">The more permissions you ask for, the more likely it is users will not grant them. Always give users the ability to turn on and off permissions as they wish.</p>

<h1 id="e-FdwD">New features in Facebook iOS SDK 3.x</h1>
<p id="e-yfSb">When Facebook engineers revealed Version 3.0 of Facebook iOS SDK, many developers were really excited because of the many improvements provided for developers to build a social app.</p>
<p id="e-DCQR">The new SDK provides several new features as follows:</p>
<ul id="e-dvHz">
<li id="e-iIHl">Integration in iOS 6</li>
<li id="e-BGwu">Native UI controls for common operations</li>
<li id="e-Qk2q">Better session management</li>
<li id="e-ECBl">Mobile aPnalytics</li>
</ul>
<h2 id="e-o9IX">Facebook integration in iOS 6</h2>
<p id="e-KJTe">Facebook is the second social service integrated in iOS; the first was Twitter in Version 5. Facebook integration will bring several advantages for developers who want to build social apps; in fact, the Facebook iOS SDK takes advantage of such an integration.</p>
<p id="e-xsQs">In order to use the Facebook integrated functionalities in iOS devices, we will need to set up a Facebook account in <strong>Settings</strong>.</p>
<p id="e-QJ0A">Once a Facebook account is connected with the iOS device, we will need to make some considerations about our application's data flow.</p>
<p id="e-CzXp">First of all, in order to use the native Login Dialog, we need to handle read/write permissions independently. Therefore, we need to perform different requests in order to obtain permissions on user account information.</p>
<p id="e-hfxA">The Facebook SDK provides support to use native Login Dialog; nevertheless, the same API will provide fallback to the fast-app-switching interface when no Facebook account was set up on the device.</p>
<img data-width="500" data-height="593" src="img/tjN8JXPX.jpg"/><p id="e-S3lS">Native UI Login Dialog</p>
<p id="e-X8XG">The preceding image shows an example of a native login interaction on iOS 6.</p>
<p id="e-IXRh">The other SDK feature that takes advantage of the iOS Facebook integration is the sharing functionality. Using the native sharing feature, users will be able to post status updates, links, photos, videos, along with friends and location-tagging actions through native iOS functionalities. Unfortunately this API has no fallback to support devices with no Facebook account setup. Therefore, it means we need to handle it manually.</p>
<p id="e-sObv">During our real application implementation journey, we will implement share functionalities using the native share dialog; however, we will also introduce fallback features in order to provide a practical substitute if our devices have no Facebook account associated with the application.</p>
<p id="e-Qf6S">All the native functionalities provided by iOS 6 can really improve the user's experience, avoiding the annoying fast-app-switching effects. Our flow will look more consistent application-wide.</p>
<p id="e-PG0J">The following image shows how the Share Dialog is used to post a status update with a picture.</p>
<img data-width="331" data-height="650" src="img/N2IcrHfS.jpg"/><p id="e-Aebq">Native UI Share Dialog</p>
<p id="e-q9km">I would like to raise one consideration about native functionalities. Of course, they are really useful since they will definitely increase the user experience with our social application. But there are two noticeable drawbacks as well. The need to change our way to ask permissions and native APIs are updated only with iOS updates. This means that, if an API needs to fix the time, we need to wait to get such a fix, which can be time-consuming. The Facebook SDK APIs are updated more often than native functionalities; therefore, they are more reliable and fully tested. Additionally, developers do not need to change the way the application requests permissions using the SDK APIs.</p>
<h2 id="e-bVo3">Native UI controls</h2>
<p id="e-igFZ">The new version of Facebook SDK provides several UI components ready to use in order to perform common operations such as friend, place picker, login, and profile picture.</p>
<p id="e-tlqi">The first one I would like to discuss is the login component also known as the <code>FBLoginView</code> class. It is really impressive how easy it is to implement the login/logout Facebook flow using this component. Adding the  <code>FBLoginView</code> object to our interface will enable our social application to perform login and logout in a transparent way. We only need to take care of callbacks in order to customize our system upon success or failure responses. We will dig into <code>FBLoginView</code> later during our coding journey.</p>
<p id="e-krPU">An important part of a social application includes the ability to show a user's profile information and Facebook profile picture. Before SDK 3.0, the way to show a user's profile picture was by downloading the picture itself and placing it in our interface. Of course dealing with this flow is not really complicated but many things can go wrong, such as errors during downloading and storing the picture can slow down our development process. Using the new component, <code>FBProfilePictureView</code>, we only need to add a new <code>FBProfilePictureView</code> instance to our interface. After the user is logged in, we pass the Facebook profile ID to the <code>FBProfilePictureView</code> object and we are done—we have our user's profile picture.</p>
<p id="e-sGvx">Whenever we think about creating our social application and turning it viral, the first thing that comes in our mind is to give users the ability to share their lives with friends. Every time we post something on the Facebook timeline, we always try to tag our friends along; therefore, we need a way to pick our friends and maybe pick a location too. The Framework SDK provides out-of-the-box components that are able to display and select friends and places. The only effort developers have to put in is to handle callbacks. These components can also be easily customized, and we will give an example of <code>FBFriendPickerViewController</code>.</p>
<h2 id="e-Q0zc">Better session management</h2>
<p id="e-tEMd">Session management was a pain in the SDK 2.x. In fact session management via the access token was the developer's duty. In the SDK 3.x, the Facebook engineers introduced the new session management flow APIs that will handle all the aspects related to authentication and sessions, refreshing tokens as well.</p>
<p id="e-TqYU">The core of the new session management process is the <code>FBSession</code>. In the new version of the framework, <code>FBSession</code> is in charge of managing the user login flow and handling the Facebook session during our app usage. There are several improvements and new features in the new session management component, such as the automatic refresh feature of the security token, which I personally prefer. With the previous version of the framework, the developer was in charge to extend the authentication token.</p>
<p id="e-F6Gx">The new session management classes use the Objective-C block metaphor to send responses back to our applications from any session operations, such as login, logout, and other state changes.</p>
<h2 id="e-pyDd">Mobile analytics</h2>
<p id="e-hHF8">It is important for developers to understand how users use their social applications. In the last release of the framework, Facebook engineers introduced new usage metrics, using ads to help developers to improve their app monetization potential.</p>
<p id="e-IkAB">App Usage Metrics offer analytics for native Login Dialog and share sheet (Share Dialogs) impressions and usage. Developers can also visualize those metrics using the AppInsight service.</p>
<p id="e-CC7d">Ads are becoming bigger on Facebook mobile products. The new framework can track conversion events from your applications. Conversion events help businesses to track their return on Facebook Ads' investments.</p>
<p id="e-TwcO">We also have a new feature in the framework, which is called <strong>Purchase event</strong>. The Purchase event is still in its beta version but will ultimately provide the ability to in-app purchase elements.</p>
<p id="e-GRvp">We will investigate Facebook analytics in great detail in Chapter 8, <em>Promoting Your Social Application</em>.</p>

<h1 id="e-RU9T">Platform references</h1>
<p id="e-W2ZF">Technical references are always really important in developing applications. The amount of information provided by Facebook for developers is considerable.</p>
<p id="e-oMPx">We may start from the Facebook Developers page (<a href="https://developers.facebook.com/">https://developers.facebook.com/</a>) from where we may find all the information we need to start developing our social applications.</p>
<p id="e-lZJA">In order to be always updated about Platform and SDK changes, we can visit Facebook Developer Blog at <a href="https://developers.facebook.com/blog/">https://developers.facebook.com/blog/</a> and Facebook Developers Live Page at <a href="https://www.facebook.com/FacebookDevelopers">https://www.facebook.com/FacebookDevelopers</a>.</p>
<p id="e-oiU4">For iOS developers, our page is the iOS SDK page at <a href="https://developers.facebook.com/ios/">https://developers.facebook.com/ios/</a>.</p>
<p id="e-lLnK">The Facebook Platform documentation can be found at <a href="https://developers.facebook.com/docs/coreconcepts/">https://developers.facebook.com/docs/coreconcepts/</a> along with the Platform Facebook page (<a href="https://www.facebook.com/platform">https://www.facebook.com/platform</a>). Wikipedia also has a really useful page about Facebook Platform (<a href="https://www.facebook.com/platform">https://www.facebook.com/platform</a>).</p>
<p id="e-YGza">The Open Graph reference can be found at <a href="https://developers.facebook.com/docs/concepts/opengraph/">https://developers.facebook.com/docs/concepts/opengraph/</a>.</p>

<h1 id="e-YLxQ">Summary</h1>
<p id="e-rnWk">In this chapter we talked about Facebook Platform and its features. Social Graph is the core data structure that will enable the social network to create a rich and engaging user experience.</p>
<p id="e-FpTs">In order to extend Facebook's popularity beyond their website, Facebook engineers created Social Plugin components. These components allow users to include part of Facebook functionalities on any website or web application.</p>
<p id="e-bK0Z">We also talked about Graph API. Graph API is the primary tool for developers to query the social platform and fetch data. They are used in all of the Facebook SDKs.</p>
<p id="e-ScU5">The huge amount of data Facebook is collecting through applications using their SDKs is enabling the social platform to provide usage analytics to developers and application owners. The most profitable mobile features for Facebook are mobile advertisement and application promoting.</p>
</body></html>