<html><head></head><body><div id="book-content"><div id="sbo-rt-content"><div id="_idContainer477" class="Basic-Text-Frame">
    <h1 class="chapterNumber">19</h1>
    <h1 id="_idParaDest-253" class="chapterTitle">Getting Started with Custom Views</h1>
    <p class="normal">At this point, your <em class="italic">JRNL</em> app is functional. All the screens are working, but as the rating user interface element is missing, you can’t set a star rating for a journal entry as shown in the app tour. You also can’t set a custom picture, but that will be addressed in <em class="chapterRef">Chapter 20</em>, <em class="italic">Getting Started with the Camera and Photo Library</em>.</p>
    <p class="normal">You have been using Apple’s standard UI elements so far. In this chapter, you’ll create a <strong class="keyWord">custom view</strong> subclass of the <code class="inlineCode">UIStackView</code> class that displays a journal entry rating in the form of stars, and you’ll modify this subclass so users can set a rating for a journal entry by tapping it. After that, you’ll implement it on the Add New Journal Entry screen. Finally, you’ll implement it on the Journal Entry Detail screen.</p>
    <p class="normal">By the end of this chapter, you’ll have learned how to create custom views for your own apps.</p>
    <p class="normal">The following topics will be covered in this chapter:</p>
    <ul>
      <li class="bulletList">Creating a custom <code class="inlineCode">UIStackView</code> subclass</li>
      <li class="bulletList">Adding your custom view to the Add New Journal Entry screen</li>
      <li class="bulletList">Adding your custom view to the Journal Entry Detail screen</li>
    </ul>
    <h1 id="_idParaDest-254" class="heading-1">Technical requirements</h1>
    <p class="normal">You will continue working on the <code class="inlineCode">JRNL</code> project that you modified in the previous chapter.</p>
    <p class="normal">The completed Xcode project for this chapter is in the <code class="inlineCode">Chapter19</code> folder of the code bundle for this book, which can be downloaded here:</p>
    <p class="normal"><a href="https://github.com/PacktPublishing/iOS-18-Programming-for-Beginners-Ninth-Edition%0D"><span class="url">https://github.com/PacktPublishing/iOS-18-Programming-for-Beginners-Ninth-Edition</span></a></p>
    <p class="normal">Check out the following video to see the code in action:</p>
    <p class="normal"><a href="https://youtu.be/Y21q6voqYuk%0D"><span class="url">https://youtu.be/Y21q6voqYuk</span></a></p>
    <p class="normal">Let’s start by learning how to create a custom <code class="inlineCode">UIStackView</code> subclass that will display a star rating on the screen.</p>
    <h1 id="_idParaDest-255" class="heading-1">Creating a custom UIStackView subclass</h1>
    <p class="normal">You’ve only used Apple’s <a id="_idIndexMarker841"/>predefined UI elements so far, such as labels and buttons. All you had to do was click the Library button, search for the object you want, and drag it into the storyboard. However, there will be cases where the objects provided by Apple are either unsuitable or don’t exist. In such cases, you will need to build your own. Let’s review the Add New Journal Entry screen that you saw in the app tour:</p>
    <figure class="mediaobject"><img src="image/B31371_19_01.png" alt="" width="419" height="236"/></figure>
    <p class="packt_figref">Figure 19.1: Add New Journal Entry screen showing the star rating</p>
    <p class="normal">You can see a group of five stars just above the <strong class="screenText">Get Location</strong> switch. Currently, the <strong class="screenText">New Entry Scene</strong> and the <strong class="screenText">Entry Detail Scene</strong> in the <code class="inlineCode">Main</code> storyboard file have placeholder view objects where the stars should be. You will create the <code class="inlineCode">RatingView</code> class, a custom subclass of the <code class="inlineCode">UIStackView</code> class, which you will use in both scenes. An instance of this class will display ratings as stars.</p>
    <p class="normal">For the rest of this chapter, an instance of the <code class="inlineCode">RatingView</code> class will be referred to as a rating view (the same way an instance of the <code class="inlineCode">UIButton</code> class is referred to as a button).</p>
    <p class="normal">Let’s begin by creating a subclass of the <code class="inlineCode">UIStackView</code> class. Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">In the Project navigator, right-click on the <strong class="screenText">JRNL</strong> folder and choose <strong class="screenText">New Group</strong> from the pop-up menu. Name this group <strong class="screenText">Views</strong>. Move this group to a new location <a id="_idIndexMarker842"/>below the <strong class="screenText">Model</strong> group:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_19_02.png" alt="" width="391" height="349"/></figure>
    <p class="packt_figref">Figure 19.2: Project navigator showing Views group below the Model group</p>
    <ol>
      <li class="numberedList" value="2">Right-click the <strong class="screenText">Views</strong> folder and select <strong class="screenText">New File from Template...</strong> from the pop-up menu.</li>
      <li class="numberedList"><strong class="screenText">iOS</strong> should already be selected. Choose <strong class="screenText">Cocoa Touch Class</strong> and then click <strong class="screenText">Next</strong>.</li>
      <li class="numberedList">Configure the file as follows:<ul>
          <li class="bulletList level-2"><strong class="screenText">Class</strong>: <code class="inlineCode">RatingView</code></li>
          <li class="bulletList level-2"><strong class="screenText">Subclass</strong>: <code class="inlineCode">UIStackView</code></li>
          <li class="bulletList level-2"><strong class="screenText">Language</strong>: <code class="inlineCode">Swift</code></li>
        </ul>
      </li>
    </ol>
    <p class="normal-one">Click <strong class="screenText">Next</strong>.</p>
    <ol>
      <li class="numberedList" value="5">Click <strong class="screenText">Create</strong>. The <code class="inlineCode">RatingView</code> file will appear in the Project navigator.</li>
      <li class="numberedList">Remove all the commented code in this file, and type the following after the <code class="inlineCode">RatingView</code> class declaration to declare the properties for the class:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// MARK: - Properties</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> <span class="hljs-template-variable">ratingButtons</span> <span class="hljs-operator">=</span> [<span class="hljs-type">UIButton</span>()]
<span class="hljs-keyword">var</span> <span class="hljs-template-variable">rating</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> <span class="hljs-template-variable">buttonSize</span> <span class="hljs-operator">=</span> <span class="hljs-type">CGSize</span>(<span class="hljs-con-attribute">width</span>: <span class="hljs-number">44.0</span>, <span class="hljs-con-attribute">height</span>: <span class="hljs-number">44.0</span>)
<span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> <span class="hljs-template-variable">buttonCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>
</code></pre>
      </li>
    </ol>
    <p class="normal-one">The <code class="inlineCode">ratingButtons</code> property is an array that will hold all the buttons for this class.</p>
    <p class="normal-one">The <code class="inlineCode">rating</code> property is<a id="_idIndexMarker843"/> used to store a journal entry rating. It determines the number and types of stars that will be drawn. For instance, if <code class="inlineCode">rating</code> contains <code class="inlineCode">3</code>, the rating view will display three filled stars and two empty stars.</p>
    <p class="normal-one">The <code class="inlineCode">buttonSize</code> property determines the height and the width of the buttons that will be drawn onscreen.</p>
    <p class="normal-one">The <code class="inlineCode">buttonCount</code> property determines the total number of buttons to be drawn onscreen.</p>
    <ol>
      <li class="numberedList" value="7">Implement the initializer for this class after the property declarations:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// MARK: - Initialization</span>
<span class="hljs-keyword">required</span> <span class="hljs-keyword">init</span>(<span class="hljs-template-variable">coder</span>: <span class="hljs-type">NSCoder</span>) {
  <span class="hljs-keyword">super</span>.<span class="hljs-con-attribute">init</span>(<span class="hljs-con-attribute">coder</span>: coder)
}
</code></pre>
      </li>
      <li class="numberedList">Implement a method to draw stars on the screen after the initializer:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-comment">// MARK: - Private methods</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-template-variable">setupButtons</span>() {
  <span class="hljs-keyword">for</span> button <span class="hljs-keyword">in</span> <span class="hljs-variable">ratingButtons</span> {
    <span class="hljs-con-attribute">removeArrangedSubview</span>(button)
    button.<span class="hljs-con-attribute">removeFromSuperView</span>()
  }
  <span class="hljs-variable">ratingButtons</span>.<span class="hljs-con-attribute">removeAll</span>()
  <span class="hljs-keyword">let</span> filledStar <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(<span class="hljs-con-attribute">systemName</span>:<span class="hljs-string">"star.fill"</span> )
  <span class="hljs-keyword">let</span> emptyStar <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(<span class="hljs-con-attribute">systemName</span>: <span class="hljs-string">"</span><span class="hljs-string">star"</span>)
  <span class="hljs-keyword">let</span> highlightedStar <span class="hljs-operator">=</span>
  <span class="hljs-type">UIImage</span>(<span class="hljs-con-attribute">systemName</span>: <span class="hljs-string">"star.fill"</span>)<span class="hljs-operator">?</span>.<span class="hljs-con-attribute">withTintColor</span>(.<span class="hljs-con-attribute">red</span>,
  <span class="hljs-con-attribute">renderingMode</span>: .<span class="hljs-con-attribute">alwaysOriginal</span>)
  <span class="hljs-keyword">for</span> <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span><span class="hljs-operator">..&lt;</span><span class="hljs-variable">buttonCount</span> {
    <span class="hljs-keyword">let</span> button <span class="hljs-operator">=</span> <span class="hljs-type">UIButton</span>()
    button.<span class="hljs-con-attribute">setImage</span>(emptyStar, <span class="hljs-con-attribute">for</span>: .<span class="hljs-con-attribute">normal</span>)
    button.<span class="hljs-con-attribute">setImage</span>(filledStar, <span class="hljs-con-attribute">for</span>: .<span class="hljs-con-attribute">selected</span>)
    button.<span class="hljs-con-attribute">setImage</span>(highlightedStar, <span class="hljs-con-attribute">for</span>: .<span class="hljs-con-attribute">highlighted</span>)
    button.<span class="hljs-con-attribute">setImage</span>(highlightedStar, <span class="hljs-con-attribute">for</span>: [.<span class="hljs-con-attribute">highlighted</span>,    .<span class="hljs-con-attribute">selected</span>])
    button.<span class="hljs-con-attribute">translatesAutoresizingMaskIntoConstraints</span> <span class="hljs-operator">=</span>
    <span class="hljs-literal">false</span>
    button.<span class="hljs-con-attribute">heightAnchor</span>.<span class="hljs-con-attribute">constraint</span>(<span class="hljs-con-attribute">equalToConstant</span>:     <span class="hljs-variable">buttonSize</span>.<span class="hljs-con-attribute">height</span>).<span class="hljs-con-attribute">isActive</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
    button.<span class="hljs-con-attribute">widthAnchor</span>.<span class="hljs-con-attribute">constraint</span>(<span class="hljs-con-attribute">equalToConstant</span>:     <span class="hljs-variable">buttonSize</span>.<span class="hljs-con-attribute">width</span>).<span class="hljs-con-attribute">isActive</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
    <span class="hljs-con-attribute">addArrangedSubview</span>(button)
    <span class="hljs-variable">ratingButtons</span>.<span class="hljs-con-attribute">append</span>(button)
  }
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">Let’s break this <a id="_idIndexMarker844"/>down:</p>
    <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">for</span> button <span class="hljs-keyword">in</span> <span class="hljs-variable">ratingButtons</span> {
  <span class="hljs-con-attribute">removeArrangedSubview</span>(button)
  button.<span class="hljs-con-attribute">removeFromSuperView</span>()
}
<span class="hljs-variable">ratingButtons</span>.<span class="hljs-con-attribute">removeAll</span>()
</code></pre>
    <p class="normal-one">These statements remove any existing buttons from the stack view and the <code class="inlineCode">ratingButtons</code> array.</p>
    <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">let</span> filledStar <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(<span class="hljs-con-attribute">systemName</span>:<span class="hljs-string">"star.fill"</span> )
<span class="hljs-keyword">let</span> emptyStar <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(<span class="hljs-con-attribute">systemName</span>: <span class="hljs-string">"star"</span>)
<span class="hljs-keyword">let</span> highlightedStar <span class="hljs-operator">=</span>
<span class="hljs-type">UIImage</span>(<span class="hljs-con-attribute">systemName</span>: <span class="hljs-string">"star.fill"</span>)<span class="hljs-operator">?</span>.<span class="hljs-con-attribute">withTintColor</span>(.<span class="hljs-con-attribute">red</span>,
<span class="hljs-con-attribute">renderingMode</span>: .<span class="hljs-con-attribute">alwaysOriginal</span>)
</code></pre>
    <p class="normal-one">These statements create three <code class="inlineCode">UIImage</code> instances from symbols in Apple’s <code class="inlineCode">SFSymbols</code> library. <code class="inlineCode">filledStar</code> will store an image of a filled star, <code class="inlineCode">emptyStar</code> will store an image of a star outline, and <code class="inlineCode">highlightedStar</code> will store an image of a filled star that has been tinted red.</p>
    <div class="note-one">
      <p class="normal">For more information on Apple’s <code class="inlineCode">SFSymbols</code> library, see <a href="https://developer.apple.com/design/human-interface-guidelines/sf-symbols"><span class="url">https://developer.apple.com/design/human-interface-guidelines/sf-symbols</span></a>.</p>
    </div>
    <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">for</span> <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span><span class="hljs-operator">..&lt;</span><span class="hljs-variable">buttonCount</span> {
</code></pre>
    <p class="normal-one">Since <code class="inlineCode">buttonCount</code> is set to <code class="inlineCode">5</code>, this <code class="inlineCode">for</code> loop will repeat five times.</p>
    <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">let</span> button <span class="hljs-operator">=</span> <span class="hljs-type">UIButton</span>()
</code></pre>
    <p class="normal-one">This statement <a id="_idIndexMarker845"/>assigns an instance of <code class="inlineCode">UIButton</code> to <code class="inlineCode">button</code>.</p>
    <div class="note-one">
      <p class="normal">For more information on <code class="inlineCode">UIButton</code>, see <a href="https://developer.apple.com/documentation/uikit/uibutton"><span class="url">https://developer.apple.com/documentation/uikit/uibutton</span></a>.</p>
    </div>
    <pre class="programlisting code-one"><code class="hljs-code">button.<span class="hljs-con-attribute">setImage</span>(emptyStar, <span class="hljs-con-attribute">for</span>: .<span class="hljs-con-attribute">normal</span>)
button.<span class="hljs-con-attribute">setImage</span>(filledStar, <span class="hljs-con-attribute">for</span>: .<span class="hljs-con-attribute">selected</span>)
button.<span class="hljs-con-attribute">setImage</span>(highlightedStar, <span class="hljs-con-attribute">for</span>: .<span class="hljs-con-attribute">highlighted</span>)
button.<span class="hljs-con-attribute">setImage</span>(highlightedStar, <span class="hljs-con-attribute">for</span>: [.<span class="hljs-con-attribute">highlighted</span>, .<span class="hljs-con-attribute">selected</span>])
</code></pre>
    <p class="normal-one">These statements set the images for the different states of the <code class="inlineCode">UIButton</code> instance. The <code class="inlineCode">.normal</code> state displays a star outline. When in the <code class="inlineCode">.selected</code> state, a filled star is displayed. If you tap the <code class="inlineCode">UIButton</code> instance, it will be in either the <code class="inlineCode">.highlighted</code> state or the <code class="inlineCode">.highlighted</code> and<code class="inlineCode"> .selected</code> states, depending on whether it was in the <code class="inlineCode">.normal</code> state or <code class="inlineCode">.selected</code> state prior to being tapped. It then displays a red-tinted filled star.</p>
    <pre class="programlisting code-one"><code class="hljs-code">button.<span class="hljs-con-attribute">translatesAutoresizingMaskIntoConstraints</span> <span class="hljs-operator">=</span>
<span class="hljs-literal">false</span>
button.<span class="hljs-con-attribute">heightAnchor</span>.<span class="hljs-con-attribute">constraint</span>(<span class="hljs-con-attribute">equalToConstant</span>: <span class="hljs-variable">buttonSize</span>.<span class="hljs-con-attribute">height</span>).<span class="hljs-con-attribute">isActive</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
button.<span class="hljs-con-attribute">widthAnchor</span>.<span class="hljs-con-attribute">constraint</span>(<span class="hljs-con-attribute">equalToConstant</span>: <span class="hljs-variable">buttonSize</span>.<span class="hljs-con-attribute">width</span>).<span class="hljs-con-attribute">isActive</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
</code></pre>
    <p class="normal-one">These statements set the size of the buttons. The first statement sets the <code class="inlineCode">UIButton</code> instance’s <code class="inlineCode">translatesAutoresizingMaskIntoConstraints</code> property to <code class="inlineCode">false</code>; otherwise, the system would create a set of constraints that duplicate the behavior specified by the view’s auto-resizing mask, and you would not be able to set your own constraints. The next two statements set the instance’s height and width by programmatically setting the height and width constraints using the value stored in <code class="inlineCode">buttonSize</code>.</p>
    <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-con-attribute">addArrangedSubview</span>(button)
</code></pre>
    <p class="normal-one">This statement adds the <code class="inlineCode">UIButton</code> instance as a subview of the stack view programmatically.</p>
    <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-variable">ratingButtons</span>.<span class="hljs-con-attribute">append</span>(button)
</code></pre>
    <p class="normal-one">This statement <a id="_idIndexMarker846"/>adds the <code class="inlineCode">UIButton</code> instance to the <code class="inlineCode">ratingButtons</code> array.</p>
    <ol>
      <li class="numberedList" value="9">Call the <code class="inlineCode">setupButtons()</code> method in the initializer:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">required</span> <span class="hljs-keyword">init</span>(<span class="hljs-template-variable">coder</span>: <span class="hljs-type">NSCoder</span>) {
  <span class="hljs-keyword">super</span> .<span class="hljs-con-attribute">init</span>(<span class="hljs-con-attribute">coder</span>: coder)
  <span class="code-highlight"><strong class="hljs-variable-slc">setupButtons</strong><strong class="hljs-slc">()</strong></span>
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">This draws the rating view onscreen when the rating view is initialized.</p>
    <p class="normal">You have created a custom <code class="inlineCode">UIStackView</code> subclass named <code class="inlineCode">RatingView</code>, and you have added code to make it draw five stars on the screen. Now let’s add code to enable the user to change the rating when the stars in the rating view are tapped. Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">Implement a method to change the rating view’s <code class="inlineCode">rating</code> property when a button in the <code class="inlineCode">ratingButtons</code> array is tapped after the <code class="inlineCode">setupButtons()</code> method:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">@objc</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-template-variable">ratingButtonTapped</span>(<span class="hljs-template-variable">_</span> <span class="hljs-params">button</span>: <span class="hljs-type">UIButton</span>) {
  <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> index <span class="hljs-operator">=</span> <span class="hljs-variable">ratingButtons</span>.<span class="hljs-con-attribute">firstIndex</span>(<span class="hljs-con-attribute">of</span>: button) <span class="hljs-keyword">  else</span> {
    <span class="hljs-con-attribute">fatalError</span>(<span class="hljs-string">"The button, </span><span class="hljs-subst">\(button)</span><span class="hljs-string">, is not in the </span>
<span class="hljs-string">    ratingButtons array: </span>\(<span class="hljs-variable">ratingButtons</span>)<span class="hljs-string">"</span>)
  }
  <span class="hljs-keyword">let</span> selectedRating <span class="hljs-operator">=</span> index <span class="hljs-operator">+ </span><span class="hljs-number">1</span>
  <span class="hljs-keyword">if</span> selectedRating <span class="hljs-operator">==</span> <span class="hljs-variable">rating</span> {
    <span class="hljs-variable">rating</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable">rating</span> <span class="hljs-operator">=</span> selectedRating
  }
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">When a button in the <code class="inlineCode">ratingButtons</code> array is tapped, the <code class="inlineCode">guard</code> statement assigns the index of the button to <code class="inlineCode">index</code>. <code class="inlineCode">selectedRating</code> is then set to the value stored in <code class="inlineCode">index</code> + 1. If the <code class="inlineCode">rating</code> property has the same value as <code class="inlineCode">selectedRating</code>, it is set to <code class="inlineCode">0</code>; otherwise, it is set to the same value as <code class="inlineCode">selectedRating</code>.</p>
    <p class="normal-one">For example, let’s say you tap the third star in the rating view. Since the third star is the third element in the <code class="inlineCode">ratingButtons</code> array, <code class="inlineCode">index</code> would be set to <code class="inlineCode">2</code> and <code class="inlineCode">selectedRating</code> would be set to 2 + 1 = <code class="inlineCode">3</code>. Assuming that the initial value of the <code class="inlineCode">rating</code> property is <code class="inlineCode">0</code>, <code class="inlineCode">selectedRating == rating</code> would return <code class="inlineCode">false</code>, and<a id="_idIndexMarker847"/> the <code class="inlineCode">rating</code> property’s value would be set to <code class="inlineCode">3</code>.</p>
    <ol>
      <li class="numberedList" value="2">Assign this method as the button action in the <code class="inlineCode">for</code> loop of the <code class="inlineCode">setupButtons</code> method after the statements setting the constraints:
        <pre class="programlisting code-one"><code class="hljs-code">button.<span class="hljs-con-attribute">widthAnchor</span>.<span class="hljs-con-attribute">constraint</span>(<span class="hljs-con-attribute">equalToConstant</span>: starSize.<span class="hljs-con-attribute">width</span>).<span class="hljs-con-attribute">isActive</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
<span class="code-highlight"><strong class="hljs-slc">button.</strong><strong class="hljs-con-attribute-slc">addTarget</strong><strong class="hljs-slc">(</strong><strong class="hljs-keyword-slc">self</strong><strong class="hljs-slc">, action: </strong><strong class="hljs-keyword-slc">#selector</strong><strong class="hljs-slc">(</strong><strong class="hljs-con-class-slc">RatingView</strong><strong class="hljs-slc">.</strong><strong class="hljs-variable-slc">ratingButtonTapped</strong><strong class="hljs-slc">(</strong><strong class="hljs-variable-slc">_</strong><strong class="hljs-slc">:)), </strong><strong class="hljs-con-attribute-slc">for</strong><strong class="hljs-slc">: .</strong><strong class="hljs-con-attribute-slc">touchUpInside</strong><strong class="hljs-slc">)</strong></span>
<span class="hljs-con-attribute">addArrangedSubview</span>(button)
</code></pre>
      </li>
      <li class="numberedList">Add a method to change the button state according to the rating that was set before the closing curly brace:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-template-variable">updateButtonSelectionStates</span>() {
  <span class="hljs-keyword">for</span> (index, button) <span class="hljs-keyword">in</span> <span class="hljs-variable">ratingButtons</span>.<span class="hljs-con-attribute">enumerated</span>() {
    button.<span class="hljs-con-attribute">isSelected</span> <span class="hljs-operator">=</span> index <span class="hljs-operator">&lt;</span> <span class="hljs-variable">rating</span>
  }
}
</code></pre>
      </li>
    </ol>
    <p class="normal-one">To see how this works, let’s say that the <code class="inlineCode">rating</code> property is set to <code class="inlineCode">3</code>. The default state for each button is <code class="inlineCode">.normal</code>.</p>
    <p class="normal-one">The first button is at index <code class="inlineCode">0</code>, so <code class="inlineCode">button.isSelected</code> is 0 &lt; 3, which returns <code class="inlineCode">true</code>. Since the image for the <code class="inlineCode">.selected</code> state is a filled star, this button’s image is set to a filled star. The same is true for the next two buttons.</p>
    <p class="normal-one">The fourth button is at index <code class="inlineCode">3</code>, so <code class="inlineCode">button.isSelected</code> is 3 &lt; 3, which returns <code class="inlineCode">false</code>. This means that the button’s state remains <code class="inlineCode">.normal</code>. The image for the <code class="inlineCode">.normal</code> state is a star outline, so this button’s image is set to a star outline. The same is true for the fifth button.</p>
    <p class="normal-one">In short, when the <code class="inlineCode">rating</code> property is set to <code class="inlineCode">3</code>, the rating view displays the first three buttons with filled stars, and the remaining two buttons with star outlines.</p>
    <ol>
      <li class="numberedList" value="4">You’ll need to call the <code class="inlineCode">updateButtonSelectionStates()</code> method every time the <code class="inlineCode">rating</code> property’s value changes. To do so, modify the <code class="inlineCode">rating</code> property as shown:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">var</span><span class="hljs-template-variable"> rating</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> <span class="code-highlight"><strong class="hljs-slc">{</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">didSet</strong><strong class="hljs-slc"> {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-variable-slc">updateButtonSelectionStates</strong><strong class="hljs-slc">()</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  }</strong></span>
<span class="code-highlight"><strong class="hljs-slc">}</strong></span>
</code></pre>
      </li>
    </ol>
    <p class="normal-one">This is known<a id="_idIndexMarker848"/> as a <strong class="keyWord">property observer</strong>, and every time the <code class="inlineCode">rating</code> property’s value changes, the <code class="inlineCode">updateButtonSelectionStates()</code> method will be called.</p>
    <p class="normal">You have completed the <a id="_idIndexMarker849"/>implementation of the rating view. In the next section, you’ll add it to the Add New Journal Entry screen.</p>
    <h1 id="_idParaDest-256" class="heading-1">Adding your custom view to the Add New Journal Entry screen</h1>
    <p class="normal">So far, you have <a id="_idIndexMarker850"/>created a new <code class="inlineCode">RatingView</code> class in<a id="_idIndexMarker851"/> your project and configured it to set its <code class="inlineCode">rating</code> property when a star in it is tapped. In this section, you will set the identity of the stack view object above the <strong class="screenText">Get Location</strong> switch in the <strong class="screenText">New Entry Scene</strong> to the <code class="inlineCode">RatingView</code> class, configure an outlet for it in the <code class="inlineCode">AddJournalEntryViewController</code> class, and add code to use the <code class="inlineCode">rating</code> property’s value when creating a new journal entry. Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">In the Project navigator, click the <strong class="screenText">AddJournalEntryViewController </strong>file. Add a new outlet for a rating view in the <code class="inlineCode">AddJournalEntryViewController</code> class after all other property declarations:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">var</span> <span class="hljs-template-variable">getLocationSwitch</span>: <span class="hljs-type">UISwitch</span>!
<span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">var</span> <span class="hljs-template-variable">getLocationSwitchLabel</span>: <span class="hljs-type">UILabel</span>!
<span class="code-highlight"><strong class="hljs-keyword-slc">@IBOutlet</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">var</strong><strong class="hljs-slc"> </strong><strong class="hljs-template-variable-slc">ratingView</strong><strong class="hljs-slc">: </strong><strong class="hljs-con-class-slc">RatingView</strong><strong class="hljs-slc">!</strong></span>
</code></pre>
      </li>
      <li class="numberedList">Modify the <code class="inlineCode">prepare(for:sender:)</code> method to get the rating view’s <code class="inlineCode">rating</code> property value when creating a new journal entry:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">let</span> <span class="hljs-operator">photo</span> <span class="hljs-operator">=</span> <span class="hljs-template-variable">photoImageView</span>.<span class="hljs-con-attribute">image</span>
<span class="hljs-keyword">let</span> <span class="hljs-operator">rating</span> <span class="hljs-operator">=</span> <span class="code-highlight"><strong class="hljs-template-variable-slc">ratingView</strong><strong class="hljs-slc">.</strong><strong class="hljs-template-variable-slc">rating</strong></span>
<span class="hljs-keyword">let</span> <span class="hljs-operator">lat</span> <span class="hljs-operator">=</span> <span class="hljs-template-variable">currentLocation</span><span class="hljs-operator">?</span>.<span class="hljs-con-attribute">coordinate</span>.<span class="hljs-con-attribute">latitude</span>
</code></pre>
      </li>
      <li class="numberedList">Click the <strong class="screenText">Main</strong> storyboard file and select <strong class="screenText">New Entry Scene</strong> in the document outline. Click <a id="_idIndexMarker852"/>the <code class="inlineCode">UIStackView</code> object<a id="_idIndexMarker853"/> above the <strong class="screenText">Get Location</strong> switch, as shown:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_19_03.png" alt="" width="812" height="348"/></figure>
    <p class="packt_figref">Figure 19.3: Editor area showing UIStackView object above the Get Location switch</p>
    <ol>
      <li class="numberedList" value="4">Click the Identity inspector button. Under <strong class="screenText">Custom Class</strong>, set <strong class="screenText">Class</strong> to <code class="inlineCode">RatingView</code>:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_19_04.png" alt="" width="452" height="262"/></figure>
    <p class="packt_figref">Figure 19.4: Identity inspector with Class set to RatingView</p>
    <ol>
      <li class="numberedList" value="5">Click the<a id="_idIndexMarker854"/> Attributes<a id="_idIndexMarker855"/> inspector button. Verify the settings under <strong class="screenText">Stack View</strong>, and under <strong class="screenText">View</strong>, set <strong class="screenText">Background</strong> to <code class="inlineCode">Default</code>:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_19_05.png" alt="" width="474" height="775"/></figure>
    <p class="packt_figref">Figure 19.5: Attributes inspector with Background set to Default</p>
    <ol>
      <li class="numberedList" value="6">Click <strong class="screenText">New Entry Scene</strong> in<a id="_idIndexMarker856"/> the <a id="_idIndexMarker857"/>document outline, and click the Connections inspector button. Connect the <code class="inlineCode">ratingView</code> outlet to the rating view in the <strong class="screenText">New Entry</strong> <strong class="screenText">Scene</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_19_06.png" alt="" width="812" height="460"/></figure>
    <p class="packt_figref">Figure 19.6: Connections inspector showing ratingView outlet</p>
    <ol>
      <li class="numberedList" value="7">Build and run<a id="_idIndexMarker858"/> your <a id="_idIndexMarker859"/>app. Tap the <strong class="screenText">+</strong> button to go to the Add New Journal Entry screen and you will see the rating view displayed above the <strong class="screenText">Get Location</strong> switch. Add a journal entry title, body, and rating, and tap <strong class="screenText">Save</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_19_07.png" alt="" width="493" height="398"/></figure>
    <p class="packt_figref">Figure 19.7: Simulator showing the rating view on the Add New Journal Entry screen</p>
    <p class="normal">A new journal entry with a rating is now visible on the Journal List screen. In the next section, you’ll modify the<a id="_idIndexMarker860"/> Journal <a id="_idIndexMarker861"/>Entry Detail screen to display the rating for this journal entry.</p>
    <h1 id="_idParaDest-257" class="heading-1">Adding your custom view to the Journal Entry Detail screen</h1>
    <p class="normal">At this point, you’re<a id="_idIndexMarker862"/> able to set a rating when <a id="_idIndexMarker863"/>you create a new journal entry using the Add New Journal Entry screen, but the rating you set is not visible on the Journal Entry Detail screen. You’ll add an outlet for a rating view and modify the code in the <code class="inlineCode">JournalEntryDetailViewController</code> class, and you’ll add a rating view to the <strong class="screenText">Entry Detail Scene</strong>.</p>
    <p class="normal">Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">In the Project navigator, click the <strong class="screenText">JournalEntryDetailViewController</strong> file. Add an outlet for a rating view after all other property declarations:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">var</span> <span class="hljs-template-variable">photoImageView</span>: <span class="hljs-type">UIImageView</span>!
<span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">var</span> <span class="hljs-template-variable">mapImageView</span>: <span class="hljs-type">UIImageView</span>!
<span class="code-highlight"><strong class="hljs-keyword-slc">@IBOutlet</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">var</strong><strong class="hljs-slc"> </strong><strong class="hljs-template-variable-slc">ratingView</strong><strong class="hljs-slc">: </strong><strong class="hljs-con-class-slc">RatingView</strong><strong class="hljs-slc">!</strong></span>
</code></pre>
      </li>
      <li class="numberedList">Modify the code in the <code class="inlineCode">viewDidLoad()</code> method to set the value of the rating view’s <code class="inlineCode">rating</code> property:
        <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword">super</span>.<span class="hljs-con-attribute">viewDidLoad</span>()
<span class="hljs-template-variable">dateLabel</span>.<span class="hljs-con-attribute">text</span> = <span class="hljs-template-variable">selectedJournalEntry</span>?.<span class="hljs-template-variable">date</span>.<span class="hljs-con-attribute">formatted</span>(
.<span class="hljs-con-attribute">dateTime</span>.<span class="hljs-con-attribute">day</span>().<span class="hljs-con-attribute">month</span>(.<span class="hljs-con-attribute">wide</span>).<span class="hljs-con-attribute">year</span>()
)
<span class="code-highlight"><strong class="hljs-template-variable-slc">ratingView</strong><strong class="hljs-slc">.</strong><strong class="hljs-template-variable-slc">rating</strong><strong class="hljs-slc"> </strong><strong class="hljs-operator-slc">=</strong><strong class="hljs-slc"> </strong><strong class="hljs-template-variable-slc">selectedJournalEntry</strong><strong class="hljs-operator-slc">?</strong><strong class="hljs-slc">.</strong><strong class="hljs-template-variable-slc">rating</strong><strong class="hljs-slc"> </strong><strong class="hljs-operator-slc">??</strong><strong class="hljs-slc"> </strong><strong class="hljs-number-slc">0</strong></span>
<span class="hljs-template-variable">titleLabel</span>.<span class="hljs-con-attribute">text</span> <span class="hljs-operator">=</span> <span class="hljs-template-variable">selectedJournalEntry</span><span class="hljs-operator">?</span>.<span class="hljs-template-variable">entryTitle</span>
</code></pre>
      </li>
      <li class="numberedList">Click the <strong class="screenText">Main</strong> storyboard file and click <strong class="screenText">Entry Detail Scene</strong> in the document outline. Select the stack view in the second table view cell. Click the Identity inspector <a id="_idIndexMarker864"/>button <a id="_idIndexMarker865"/>and, under <strong class="screenText">Custom Class</strong>, set <strong class="screenText">Class</strong> to <code class="inlineCode">RatingView</code>:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_19_08.png" alt="" width="812" height="298"/></figure>
    <p class="packt_figref">Figure 19.8: Identity inspector with Class set to RatingView</p>
    <ol>
      <li class="numberedList" value="4">Click the Attributes inspector button and verify the settings under <strong class="screenText">Stack View</strong>. Under <strong class="screenText">View</strong>, untick the <strong class="screenText">User Interaction Enabled</strong> checkbox (as the user should not be able to change the rating on the Journal Entry Detail screen), and set <strong class="screenText">Background</strong> to <code class="inlineCode">Default</code>:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_19_09.png" alt="" width="472" height="770"/></figure>
    <p class="packt_figref">Figure 19.9: Attributes inspector with Background set to Default</p>
    <ol>
      <li class="numberedList" value="5">Click <strong class="screenText">Entry Detail Scene</strong> in<a id="_idIndexMarker866"/> the<a id="_idIndexMarker867"/> document outline, and click the Connections inspector button. Connect the <strong class="screenText">ratingView</strong> outlet to the rating view in the <strong class="screenText">Entry Detail </strong>scene:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_19_10.png" alt="" width="812" height="351"/></figure>
    <p class="packt_figref">Figure 19.10: Connections inspector showing ratingView outlet</p>
    <ol>
      <li class="numberedList" value="6">Build and run<a id="_idIndexMarker868"/> your app. Tap<a id="_idIndexMarker869"/> the journal entry you added in the previous section, and you’ll see the rating displayed in a rating view on the Journal Entry Detail screen:</li>
    </ol>
    <figure class="mediaobject"><img src="image/B31371_19_11.png" alt="" width="531" height="457"/></figure>
    <p class="packt_figref">Figure 19.11: Simulator showing the rating view on the Journal Entry Detail screen</p>
    <p class="normal">You’ve successfully added and<a id="_idIndexMarker870"/> configured a rating view<a id="_idIndexMarker871"/> on the Journal Entry Detail screen! Good job!</p>
    <h1 id="_idParaDest-258" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, you created a custom subclass of the <code class="inlineCode">UIStackView</code> class that displays a journal entry rating in the form of stars, and you modified this subclass so users can set a rating for a journal entry by tapping it. After that, you added it to the Add New Journal Entry screen. Finally, you implemented it on the Journal Entry Detail screen.</p>
    <p class="normal">You now know how to create custom views for your own apps.</p>
    <p class="normal">In the next chapter, you’ll learn how to work with photos from the camera or photo library.</p>
    <h1 id="_idParaDest-259" class="heading-1">Join us on Discord!</h1>
    <p class="normal">Read this book alongside other users, experts, and the author himself. Ask questions, provide solutions to other readers, chat with the author via Ask Me Anything sessions, and much more. Scan the QR code or visit the link to join the community.</p>
    <p class="normal"><a href="https://packt.link/ios-Swift%0D"><span class="url">https://packt.link/ios-Swift</span></a></p>
    <p class="normal"><a href="https://packt.link/ios-Swift%0D"><img src="image/QR_Code2370024260177612484.png" alt="" width="177" height="177"/></a></p>
  </div>
</div></div></body></html>