<html><head></head><body>
		<div id="_idContainer212">
			<h1 id="_idParaDest-265"><em class="italic"><a id="_idTextAnchor543"/>Chapter 18</em>: Creating a macOS app with Catalyst</h1>
			<p>At WWDC 2019, Apple introduced Mac Catalyst to developers worldwide. With Mac Catalyst, developers could bring iPad apps into Mac quite easily. Catalyst allows iPad apps to be ported to Mac without much effort. This brings a whole new audience (Mac users) to iPad apps and expands the possibilities of the macOS ecosystem. </p>
			<p>In this chapter, we are going to review the basics of Mac Catalyst. We will explore the new features introduced at WWDC 2020, and we will turn an iPad app into a Mac app using Catalyst. We will put into practice the two different ways to do this using Catalyst: <strong class="bold">Scale Interface to Match iPad</strong> and the new <strong class="bold">Optimize Interface for Mac</strong> option. We will compare the differences between them and the pros and cons of both approaches.</p>
			<p>In this chapter, we're going to cover the following main topics:</p>
			<ul>
				<li>Discovering Mac Catalyst</li>
				<li>Exploring new Mac Catalyst features</li>
				<li>Building your first Mac Catalyst app</li>
			</ul>
			<p>By the end of this chapter, you will be able to migrate your iPad apps to macOS and grow the audience and possibilities of your app within the Mac ecosystem. </p>
			<h1 id="_idParaDest-266"><a id="_idTextAnchor544"/>Technical requirements</h1>
			<p>The code bundle for this chapter includes a starter project called <strong class="source-inline">todo_start</strong> and its completed version. You can find them in the code bundle repository:</p>
			<p><a href="https://github.com/PacktPublishing/Mastering-iOS-14-Programming-4th-Edition">https://github.com/PacktPublishing/Mastering-iOS-14-Programming-4th-Edition</a></p>
			<h1 id="_idParaDest-267"><a id="_idTextAnchor545"/>Discovering Mac Catalyst</h1>
			<p>Mac Catalyst helps developers to bring their iPad apps into Mac. Native Mac apps can share code <a id="_idIndexMarker930"/>with iPad apps, creating a unified ecosystem for users and developers.</p>
			<p>With Mac Catalyst, developers can adapt touch gestures and controls from the iPad to mouse and keyboard controls in the Mac app counterpart. </p>
			<p>When Apple added support on Mac Catalyst for UIKit on Mac, it took a huge step forward in terms of compatibility between the iPad and Mac. Apps that use SwiftUI instead had the advantage of becoming Universal apps and therefore they adapt even better on both systems.</p>
			<p>Once an app has made the initial transition from iPad to iPad + Mac with the help of Mac Catalyst, the result is very promising. There is one codebase to serve both platforms. By having just one codebase, companies can reduce the amount of time and effort needed to develop, maintain, and fix features in the app (for both systems). </p>
			<p>There are also <a id="_idIndexMarker931"/>some drawbacks with Mac Catalyst. Not every iOS framework is supported right now. Apple is adding more and more every year. Also, some third-party libraries may not be supported, and it is the developer's responsibility to exclude them from the Mac system and look for an alternative.</p>
			<p>Another drawback of Mac Catalyst is that some apps that go from iPad to Mac can feel a bit out of context. I refer to some apps that make use of a heavy iOS look-and-feel and are ported to Mac as is. Some elements of the UI differ a lot in both systems (checkboxes, popups, placement of the buttons, and so on). Some apps may require some extra work to adapt the UI from the iPad to the Mac style, but not every company or team has the resources, time, or intention to do so. </p>
			<p>In order <a id="_idIndexMarker932"/>to help with this issue, Mac Catalyst has a new feature called <strong class="bold">Optimize Interface for Mac</strong>. Instead of the former <strong class="bold">Scale Interface to Match iPad</strong> option, Mac Catalyst allows this new feature that transforms some UIKit controls into more Mac-styled ones automatically. </p>
			<p>In this section, we have learned about the basics of Mac Catalyst. Let's discuss the new improvement showcased during WWDC 2020 for Mac Catalyst in the next section.</p>
			<h1 id="_idParaDest-268"><a id="_idTextAnchor546"/>Exploring new Mac Catalyst features</h1>
			<p>During WWDC 2020, Apple showcased the new <strong class="bold">Optimize Interface for Mac</strong> method. When we <a id="_idIndexMarker933"/>port an iPad app to Mac using this method, it brings some significant differences from the previous method, <strong class="bold">Scale Interface to Match iPad</strong>. The differences are as follows:</p>
			<ol>
				<li>Content is rendered 1:1. With <strong class="bold">Scale Interface</strong>, the views are scaled to 77% of their original sizes on Mac. This could cause problems in some views with <strong class="bold">AutoLayout</strong> rules that break or that simply change the overall shape of your UI. Now, with 1:1 rendering, the iPad app and the Mac app will keep the same dimensions and sizes. This increases the text quality a lot by not scaling it down on Mac; the text looks better and easier to read on your app.</li>
				<li>macOS controls for UIKit counterparts. With the new <strong class="bold">Optimize Interface for Mac</strong> option, Catalyst uses Mac-style controls instead of the UIKit ones from your iPad app. By doing so, the UI of the app in Mac looks much more familiar to Mac users. </li>
				<li>Similar to the previous point, macOS font spacing and standard macOS spacing are used in the Mac Catalyst app instead of those defined on the iPad version (which is different).</li>
				<li>Much more iOS frameworks have been made available to Mac with Catalyst. Examples include <strong class="source-inline">AVFoundation</strong>, <strong class="source-inline">NotificationCenter</strong>, <strong class="source-inline">ReplayKit</strong>, <strong class="source-inline">StoreKit</strong>, <strong class="source-inline">MessageUI</strong>, and tons more.</li>
				<li>Added support for physical keyboard events on iOS. Now they are available on Mac Catalyst on Mac. Games can benefit from this.</li>
				<li>The focus engine from tvOS is available now.</li>
				<li><strong class="source-inline">.selectionFollowsFocus</strong> from <strong class="source-inline">tableViews</strong> and <strong class="source-inline">collectionViews</strong> is now available.</li>
				<li>Now we can hide the cursor on Mac when needed.</li>
				<li>There are a new color wheel and color picker.</li>
				<li><strong class="source-inline">UISplitViewController</strong> now supports three columns.</li>
				<li><strong class="source-inline">SFSymbols</strong> are fully supported.</li>
				<li>Mac Catalyst's new extensions such as the Photo Editing extension are now available.</li>
				<li>Widgets <a id="_idIndexMarker934"/>from WidgetKit are also available from iPad to Mac thanks to Catalyst.</li>
				<li>Users can enjoy universal purchases (buying items on iPad and using them on the Mac app too).</li>
				<li>New toolbar styles.</li>
			</ol>
			<p>Later in the chapter, when building an app with both methods, you will be able to see these differences, and you will be applying the necessary fixes and steps to avoid them in your apps. </p>
			<p>In this section, we have learned about the new features launched in 2020 for Mac Catalyst. Now, let's start building our first Mac Catalyst app in the next section!</p>
			<h1 id="_idParaDest-269"><a id="_idTextAnchor547"/>Building your first Mac Catalyst app</h1>
			<p>In this section, we are going to start working with a simple iPad to-do app, and we will transform it <a id="_idIndexMarker935"/>into a macOS app using two different techni<a id="_idTextAnchor548"/><a id="_idTextAnchor549"/>ques. The base app is very basic (you can't even add new to-do elements to it!) but it illustrates what kinds of errors, UI modifications, and methods you need to go through when going from iPad to Mac.</p>
			<p>We will follow these steps:</p>
			<ol>
				<li value="1">First, we will explore the iPad app itself to understand its essential elements and components. </li>
				<li>Then, we will use the first method to make it compatible with macOS: <strong class="bold">Scale Interface to Match iPad</strong>.</li>
				<li>Finally, we will use the new method, <strong class="bold">Optimize Interface for Mac</strong>. We will compare the <a id="_idIndexMarker936"/>results with the <strong class="bold">Scale Interface</strong> method to match the iPad method, so you will learn when to use one or another, depending on your app.</li>
			</ol>
			<p>Let's start by exploring our iPad to-do app!</p>
			<h2 id="_idParaDest-270"><a id="_idTextAnchor550"/>Exploring the iPad app</h2>
			<p>In this section, we <a id="_idIndexMarker937"/>are going to take a quick look at <a id="_idIndexMarker938"/>the base app and its components to be able to modify them while understanding what we are doing.</p>
			<p>You can find the code in the code bundle of this book. The project name is <strong class="source-inline">todo_start</strong>. Go ahead and open the project. Build and run it. You should see something like this in the iPad simulator in landscape mode:</p>
			<div>
				<div id="_idContainer189" class="IMG---Figure">
					<img src="image/Figure_18.01_B14717.jpg" alt="Figure 18.1 – To-do app landscape mode&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.1 – To-do app landscape mode</p>
			<p>If you are familiar with iPad apps, you will already be able to tell from these screenshots that the main component of this iPad<a id="_idTextAnchor551"/><a id="_idTextAnchor552"/><a id="_idTextAnchor553"/> app is <strong class="source-inline">SplitViewController</strong>. <strong class="source-inline">SplitViewController</strong> typically has two or three columns (<strong class="source-inline">UIViewController</strong> instances) inside it. In our case, we have two: a side menu on the left and a detail panel on the right (in landscape mode). In portrait <a id="_idIndexMarker939"/>mode, the side menu becomes <a id="_idIndexMarker940"/>a popover menu, and the detail panel is the main view.</p>
			<p>Let's quickly check out the project structure and highlight the most important fil<a id="_idTextAnchor554"/><a id="_idTextAnchor555"/>es in it:</p>
			<ul>
				<li>The <strong class="source-inline">MasterViewController.swift</strong> file contains <strong class="source-inline">MasterViewController</strong>, which is the <a id="_idIndexMarker941"/>side menu of <strong class="source-inline">SplitViewController</strong>. It has a table view with its corresponding table view cells (<strong class="source-inline">CategoryTableView<a id="_idTextAnchor556"/><a id="_idTextAnchor557"/>Cell</strong>).</li>
				<li>The <strong class="source-inline">DetailViewController.swift</strong> file contains <strong class="source-inline">DetailViewController</strong>, which is the <a id="_idIndexMarker942"/>detail view of <strong class="source-inline">SplitViewController</strong>. It has a table view, with its corresponding table view cells (<strong class="source-inline">EntryTableViewCell</strong>).</li>
				<li>The <strong class="source-inline">Datasource.swift</strong> file contains the <strong class="source-inline">Datasource</strong> of the project, which will feed the <a id="_idIndexMarker943"/>view controllers with the to-do list using the <strong class="source-inline">load() -&gt; [Category]</strong> method. It also contains the models of our to-do project. The to-do list is built using categories (such as work, grocery, or home), and entries inside those categories (such as "call my boss"). The <strong class="source-inline">Datasource.swift</strong> file contains structs representing these models: <strong class="source-inline">Category</strong>, <strong class="source-inline">Entry</strong>, and <strong class="source-inline">Priority</strong>. In a real-world app, you would separate these models into their own file/directory, but for simplicity, we are keeping them within the <strong class="source-inline">Datasource</strong> itself.</li>
			</ul>
			<p>So, to summarize the components of the app, the side menu (<strong class="source-inline">MasterViewController</strong>) displays a list of to-do categories in the form of a table (<strong class="source-inline">Category</strong> and <strong class="source-inline">CategoryTableViewCell</strong> instances). When selecting one category, the detail view (<strong class="source-inline">DetailViewController</strong>) displays a table with different to-do entrie<a id="_idTextAnchor558"/><a id="_idTextAnchor559"/>s (<strong class="source-inline">Entry</strong> and <strong class="source-inline">EntryTableViewCell</strong> instances). All the data is provided by <strong class="source-inline">Datasource</strong>. </p>
			<p>The entries of the to-do in each category are represented by cells that contain different information in each to-do (<strong class="source-inline">EntryTableViewCell</strong>):</p>
			<div>
				<div id="_idContainer190" class="IMG---Figure">
					<img src="image/Figure_18.02_B14717.jpg" alt="Figure 18.2 – Entry cell&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.2 – Entry cell</p>
			<p>These <a id="_idIndexMarker944"/>table view cells contain the following:</p>
			<ul>
				<li>One <strong class="source-inline">UISwitch</strong> to represent whether the to-do is pending or complete.</li>
				<li>One <strong class="source-inline">UIPickerView</strong> to represent the priority of the task (<strong class="bold">High</strong>, <strong class="bold">Medium</strong>, or <strong class="bold">Low</strong>).</li>
				<li>One <strong class="source-inline">UILabel</strong> to describe the task.</li>
				<li>One <strong class="source-inline">UIButton</strong> to set an alarm in the task.</li>
			</ul>
			<p>There <a id="_idIndexMarker945"/>is also an additional button in the top-right corner:</p>
			<div>
				<div id="_idContainer191" class="IMG---Figure">
					<img src="image/Figure_18.03_B14717.jpg" alt="Figure 18.3 – Add to-do button&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.3 – Add to-do button</p>
			<p>This button represents the action that will allow the user to add a new entry to the to-do list.</p>
			<p>There is no functionality at all except for displaying the elements themselves right now, but you will understand later in the chapter why each of these elements is there. An easy and simple app, right? Let's start the transformation process from iPad to Mac now!</p>
			<h2 id="_idParaDest-271"><a id="_idTextAnchor560"/>Scaling your iPad app for Mac </h2>
			<p>In this <a id="_idIndexMarker946"/>section, we are going to transform <a id="_idIndexMarker947"/>the iPad app into a Mac-compatible app using th<a id="_idTextAnchor561"/><a id="_idTextAnchor562"/>e Mac Catalyst <strong class="bold">Scale Interface to Match iPad</strong> method. This was the first way introduced by Apple to transform iPad apps into Mac apps easily. </p>
			<p>Open the project from the current section and go to the project navigator. In the <strong class="bold">Deployment Info</strong> section, check the <strong class="bold">Mac</strong> checkbox and press <strong class="bold">Enable</strong> in the popup:</p>
			<div>
				<div id="_idContainer192" class="IMG---Figure">
					<img src="image/Figure_18.04_B14717.jpg" alt="Figure 18.4 – Enabling Mac support&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.4 – Enabling Mac support</p>
			<p>Make <a id="_idIndexMarker948"/>sure that the option is set to <strong class="bold">Scale Interface to Match iPad</strong>. </p>
			<p>Now, build <a id="_idIndexMarker949"/>and run the app using Mac as the target device. You should see the following UI:</p>
			<div>
				<div id="_idContainer193" class="IMG---Figure">
					<img src="image/Figure_18.05_B14717.jpg" alt="Figure 18.5 – The Mac version of the to-do app&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.5 – The Mac version of the to-do app</p>
			<p>That was extremely easy! It is true that our example app is very simple and straightforward. But with a simple click, it is already compatible and "usable" on Mac. We didn't <a id="_idIndexMarker950"/>have any work to do! However, even <a id="_idIndexMarker951"/>though the app is usable, it doesn't have the Mac style. Let's list some elements that differ from a traditional Mac app:</p>
			<ul>
				<li>Mac apps don't use toolbars to contain actions such as the <strong class="bold">+</strong> symbol. The actions are usually located in the bottom-right corner. </li>
				<li>Buttons such as <strong class="bold">Set Alarm</strong> don't look like Mac buttons.</li>
				<li>Mac apps don't use this kind of Picker that much.</li>
				<li>Mac apps use checkboxes instead of switches.</li>
				<li>The views have been scaled to 77% of the original ones. That can break some constraints in your code, and you may need to review parts of the UI.</li>
			</ul>
			<p>The more complex UI your app has on the iPad, the less "Mac" it will feel using this method. But we can't complain too much; we just made it compatible with one click! </p>
			<p>This first iteration is always recommended as the first step to port your iPad app to Mac. Now that <a id="_idIndexMarker952"/>we have a Mac app, we are going to work on improving <a id="_idIndexMarker953"/>the UI to give it a more Mac look-and-feel. To do so, we will use the new method created by Apple: <strong class="bold">Optimize Interface for Mac</strong>. This method has its pros and cons, and we will see them in the next section.</p>
			<h2 id="_idParaDest-272"><a id="_idTextAnchor563"/>Optimizing your iPad app for Mac</h2>
			<p>In this section, we ar<a id="_idTextAnchor564"/><a id="_idTextAnchor565"/>e going to use the <strong class="bold">Optimize Interface for Mac</strong> option on the iPad app <a id="_idIndexMarker954"/>and we will learn how to adapt the result to suit <a id="_idIndexMarker955"/>the expected Mac-style interface on our app.</p>
			<p>In the project navigator, in the <strong class="bold">Deployment Info</strong> section, go ahead and change the Mac option to <strong class="bold">Optimize Interface for Mac</strong>:</p>
			<div>
				<div id="_idContainer194" class="IMG---Figure">
					<img src="image/Figure_18.06_B14717.jpg" alt="Figure 18.6 – Using Optimize Interface for Mac&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.6 – Using Optimize Interface for Mac</p>
			<p>After selecting this option, change the target to Mac and launch the app. You should get a crash saying the following:</p>
			<p class="source-code">[General] UIPickerView is not supported when running Catalyst apps in the Mac idiom.</p>
			<p>We didn't have any problem when we used the <strong class="bold">Scale Interface</strong> option in the previous section. However, when using <strong class="bold">Optimize Interface</strong>, we are applying bigger and deeper changes in the transformation of our app into a Mac one. And things can get tricker. This error is displayed in the console because some UIKit elements are not available in Catalyst when using the <strong class="bold">Optimize Interface</strong> option. In such cases, we should provide an alternative component, hide the component for Mac, or adapt other solutions. We can't use <strong class="source-inline">UIPickerView</strong> instances as displayed in this example. One solution could be to use SwiftUI's Picker (which is available under <strong class="bold">Optimize Interface</strong> as <strong class="source-inline">ComboBox</strong>). </p>
			<p>We are going <a id="_idIndexMarker956"/>to learn now how to use or not use specific <a id="_idIndexMarker957"/>components in our app, depending on the device that is running it. We are going to install this <strong class="source-inline">UIPickerView</strong> on iPad, but we will remove it from the Mac version (to make it compile for now). We will achieve this by using storyboard variations.</p>
			<p>Storyboard variations can help us to install or uninstall specific components in our view controllers based on certain parameters, such as the device, the width of the screen, the height, and the gamut.</p>
			<p>Let's uninstall <strong class="source-inline">UIPickerView</strong> from the cell when the app runs on a Mac. Follow these steps:</p>
			<ol>
				<li value="1">Open the <strong class="source-inline">Main.storyboard</strong> file and go to <strong class="bold">Detail View Controller</strong>. Select the <strong class="bold">entry</strong> cell prototype:<div id="_idContainer195" class="IMG---Figure"><img src="image/Figure_18.07_B14717.jpg" alt="Figure 18.7 – Detail View Controller&#13;&#10;"/></div><p class="figure-caption">Figure 18.7 – Detail View Controller</p></li>
				<li>Now, select the <strong class="source-inline">UIPickerView</strong> of the cell, and in its <strong class="bold">Attributes Inspector </strong>window, add a variation on the <strong class="bold">Installed</strong> section by clicking on the <strong class="bold">+</strong> sign:<div id="_idContainer196" class="IMG---Figure"><img src="image/Figure_18.08_B14717.jpg" alt="Figure 18.8 – Adding an Installed variation&#13;&#10;"/></div><p class="figure-caption">Figure 18.8 – Adding an Installed variation</p></li>
				<li>In the <a id="_idIndexMarker958"/>popup that shows up, select <strong class="bold">Mac</strong> from the <strong class="bold">Idiom</strong> selector:<div id="_idContainer197" class="IMG---Figure"><img src="image/Figure_18.09_B14717.jpg" alt="Figure 18.9 – Adding a Mac idiom variation&#13;&#10;"/></div><p class="figure-caption">Figure 18.9 – Adding a Mac idiom variation</p></li>
				<li>Now, you <a id="_idIndexMarker959"/>want to uncheck the new variation so that this component will not be installed in the Mac idiom:</li>
			</ol>
			<div>
				<div id="_idContainer198" class="IMG---Figure">
					<img src="image/Figure_18.10_B14717.jpg" alt="Figure 18.10 – Uninstalling the Mac idiom variation&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.10 – Uninstalling the Mac idiom variation</p>
			<p>Great! By using variations in the storyboard, you are able to specify when to install certain components based on the device that is running it and other factors! Now try launching the app again, using Mac as the target. This time, the app should not crash and you will get the following screen:</p>
			<div>
				<div id="_idContainer199" class="IMG---Figure">
					<img src="image/Figure_18.11_B14717.jpg" alt="Figure 18.11 – First optimization for the Mac version of the to-do app&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.11 – First optimization for the Mac version of the to-do app</p>
			<p>Great! We managed <a id="_idIndexMarker960"/>to use storyboard variations to adapt the <a id="_idIndexMarker961"/>Mac version of our app. Ideally, you should now find an alternative to this <strong class="source-inline">UIPickerView</strong> that works on Mac (SwiftUI's Picker is an example). That will be homework for you!</p>
			<p>You can see in the preceding screenshot that there are still some issues that are common when translating an iPad app to Mac using the <strong class="bold">Optimize Interface</strong> option:</p>
			<ul>
				<li>In the <strong class="bold">Categories</strong> table cells, the word font size is different from the number font size. In our iPad app, the font size was the same. Take a closer look at the font size of <strong class="bold">Work (3)</strong> as an example.</li>
				<li>Mac apps don't use buttons such as <strong class="bold">+</strong> in the toolbar. The most common place for such actions is the bottom-right corner of the window.</li>
			</ul>
			<p>Let's work on these two issues next. Open the <strong class="source-inline">Main.storyboard</strong> file and check the font used in the labels of the <strong class="bold">Root View Controller</strong> table:</p>
			<div>
				<div id="_idContainer200" class="IMG---Figure">
					<img src="image/Figure_18.12_B14717.jpg" alt="Figure 18.12 – Root View Controller cell labels&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.12 – Root View Controller cell labels</p>
			<p>If you take a look at the font size used in these two labels, it is not the same. The first label is using the <strong class="bold">Body</strong> font. The second label is using the <strong class="bold">System - 17.0</strong> font. But then why <a id="_idIndexMarker962"/>do they look the same in <strong class="bold">Scale Interface to Match iPad</strong>? The reason is that in that option, the views are scaled down to 77% of the <a id="_idIndexMarker963"/>original size, and both fonts look the same. But in <strong class="bold">Optimize Interface for Mac</strong>, views are kept 1:1 in ratio and the predefined text styles adapt to the view content size. So, if you are going to use an iPad app in Mac with <strong class="bold">Optimize Interface</strong>, the best way to tackle fonts is to use these predefined styles all around your app. You will not have to tweak them later depending on the device.</p>
			<p>In order to fix the problem, change the <strong class="bold">System – 17.0</strong> font to the <strong class="bold">Body</strong> font in the label attribute inspector:</p>
			<div>
				<div id="_idContainer201" class="IMG---Figure">
					<img src="image/Figure_18.13_B14717.jpg" alt="Figure 18.13 – Using Text Styles&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.13 – Using Text Styles</p>
			<p>Now <a id="_idIndexMarker964"/>run the <a id="_idIndexMarker965"/>app on the Mac target:</p>
			<div>
				<div id="_idContainer202" class="IMG---Figure">
					<img src="image/Figure_18.14_B14717.jpg" alt="Figure 18.14 – New font style results on the Mac&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.14 – New font style results on the Mac</p>
			<p>As displayed in the previous screenshot, the font sizes of both <strong class="bold">Work</strong> and <strong class="bold">(3)</strong> are now the same. If you execute the app on an iPad, they will also be the same. We don't have any difference anymore.</p>
			<p>With this fix in place, it is time for us to hide the toolbar on <strong class="source-inline">DetailViewController</strong>. Mac apps don't use toolbars to display a single action as we are doing right now:</p>
			<div>
				<div id="_idContainer203" class="IMG---Figure">
					<img src="image/Figure_18.15_B14717.jpg" alt="Figure 18.15 – Toolbar with a right-side action button&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.15 – Toolbar with a right-side action button</p>
			<p>We learned <a id="_idIndexMarker966"/>how to show/hide elements using storyboard <a id="_idIndexMarker967"/>variations, but for this toolbar, we are going to do it programmatically. The component will still be installed, but we will hide it on Mac. Open the <strong class="source-inline">DetailViewController</strong> file and change the <strong class="source-inline">viewWillAppear</strong> method implementation for this one:</p>
			<p class="source-code">override func viewWillAppear(_ animated: Bool) {</p>
			<p class="source-code">  super.viewWillAppear(animated)</p>
			<p class="source-code">  <strong class="bold">if traitCollection.userInterf<a id="_idTextAnchor566"/><a id="_idTextAnchor567"/>aceIdiom == .mac {</strong></p>
			<p class="source-code"><strong class="bold">    navigationController?.setToolbarHidden(true, animated: false)</strong></p>
			<p class="source-code"><strong class="bold">  }</strong> else {</p>
			<p class="source-code">    navigationItem.rightBarButtonItem = UIBarButtonItem(barButtonSystemItem: .add, target: self, action: #selector(createTapped))</p>
			<p class="source-code">    navigationController?.setToolbarHidden(false, animated: animated)</p>
			<p class="source-code">  }</p>
			<p class="source-code">}</p>
			<p>Review the highlighted code. We are able to detect in which device we are launching the app by using the <strong class="source-inline">userInterfaceIdiom</strong> property of <strong class="source-inline">traitCollection</strong>. When it is <strong class="source-inline">.mac</strong>, we hide the toolbar, and only add the right-side <strong class="bold">+</strong> button when we are on another device (such as an iPad).</p>
			<p>If you build and execute the app on the Mac target, the <strong class="bold">+</strong> button is gone. Great! But now we cannot create new to-do items! We have lost access to this button for Mac. We need to adapt this scenario in a different way.</p>
			<p>Traditionally, for a <a id="_idIndexMarker968"/>Mac interface, the <strong class="bold">Create</strong> action will <a id="_idIndexMarker969"/>be in the bottom-right corner of the window. Let's add it now. Open the <strong class="source-inline">Main.storyboard</strong> file. Select the table view of <strong class="bold">Detail View Controller</strong>:</p>
			<div>
				<div id="_idContainer204" class="IMG---Figure">
					<img src="image/Figure_18.16_B14717.jpg" alt="Figure 18.16 – Detail View Controller table view&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.16 – Detail View Controller table view</p>
			<p>Now we are going to make space at the bottom of the controller for a new button, but only on Mac. Follow these steps:</p>
			<ol>
				<li value="1">Go into the size inspector of <strong class="bold">Table View</strong> of <strong class="bold">Detail View Controller</strong>.</li>
				<li>Edit the constraint that attaches the bottom of the table view with the bottom of the controller, <strong class="bold">Edit the Align Bottom with Safe Area</strong>, and give it a constant of <strong class="source-inline">-60</strong>:<div id="_idContainer205" class="IMG---Figure"><img src="image/Figure_18.17_B14717.jpg" alt="Figure 18.17 – Editing the table view bottom constraint&#13;&#10;"/></div><p class="figure-caption">Figure 18.17 – Editing the table view bottom constraint</p></li>
				<li>Now add <a id="_idIndexMarker970"/>a new <strong class="source-inline">UIButton</strong> in the space between <a id="_idIndexMarker971"/>the table and the bottom of the view controller. Set <strong class="bold">Create</strong> as the button title. Add the four constraints displayed in the following screenshot:<div id="_idContainer206" class="IMG---Figure"><img src="image/Figure_18.18_B14717.jpg" alt="Figure 18.18 – Adding a new button&#13;&#10;"/></div><p class="figure-caption">Figure 18.18 – Adding a new button</p></li>
				<li>Now add a <strong class="bold">Vertical Spacing</strong> constraint from the table view to the new <strong class="bold">Create</strong> button that you just added (you can hold <em class="italic">Ctrl</em> + drag from the table to the button).</li>
				<li>We want to add a variation to the button. We want the button to be installed only for Mac idioms. So, go ahead and add a variation for Mac and uncheck the default one (as we did previously in this chapter for <strong class="source-inline">UIPickerView</strong>). By doing this, the button will only be visible on Mac devices:<div id="_idContainer207" class="IMG---Figure"><img src="image/Figure_18.19_B14717.jpg" alt="Figure 18.19 – Installing the new button only in Mac&#13;&#10;"/></div><p class="figure-caption">Figure 18.19 – Installing the new button only in Mac</p></li>
				<li>If you did <a id="_idIndexMarker972"/>it properly, the button should disappear <a id="_idIndexMarker973"/>in the storyboard if you are using an iPad as the preview device. You can change the device to <strong class="bold">Mac</strong> with <strong class="bold">Mac Idiom</strong> (<em class="italic">not Mac with iPad Idiom!</em>) and it will be shown again (you can do this in the bottom options of the storyboard window):<div id="_idContainer208" class="IMG---Figure"><img src="image/Figure_18.20_B14717.jpg" alt="Figure 18.20 – Device preview selection&#13;&#10;"/></div><p class="figure-caption">Figure 18.20 – Device preview selection</p></li>
				<li>Finally, we need to again edit the constraint of item number 2 of this list. You added a <strong class="source-inline">-60</strong> constant to it. Now we want to put it back to <strong class="source-inline">0</strong>, as before.</li>
			</ol>
			<p>Now go ahead and execute the app on an iPad target. You should still see the <strong class="bold">+</strong> symbol in the top-right corner and not see the new <strong class="bold">Create</strong> button at the bottom. Execute it now on a Mac target. You should get the following error on the console:</p>
			<p class="source-code">[LayoutConstraints] Unable to simultaneously satisfy constraints.</p>
			<p>This is because we added two different constraints that are not able to co-exist:</p>
			<ul>
				<li><strong class="bold">TableView.Bottom</strong> to <strong class="bold">Safe Area.Bottom</strong> with constant <strong class="source-inline">0</strong></li>
				<li><strong class="bold">TableView.Bottom</strong> to <strong class="bold">Create Button</strong> with constant <strong class="source-inline">9</strong></li>
			</ul>
			<p>In fact, we need both constants, but one is for iPad devices and the other only applies to Mac. Go ahead and change the priority of one of them to <strong class="source-inline">250</strong>: </p>
			<div>
				<div id="_idContainer209" class="IMG---Figure">
					<img src="image/Figure_18.21_B14717.jpg" alt="Figure 18.21 – Changing the constraint priority&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.21 – Changing the constraint priority</p>
			<p>With this, we can <a id="_idIndexMarker974"/>keep both constraints, but they will not be <a id="_idIndexMarker975"/>exclusive to each other. When the Mac button is not installed, that constraint will not take effect and the other one will apply (attaching the table view bottom to the bottom of the safe area). Go ahead and execute the app using a Mac target:</p>
			<div>
				<div id="_idContainer210" class="IMG---Figure">
					<img src="image/Figure_18.22_B14717.jpg" alt="Figure 18.22 – Mac app final version&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.22 – Mac app final version</p>
			<p>That looks <a id="_idIndexMarker976"/>great! Now we have two different variations <a id="_idIndexMarker977"/>of the UI, one for iPad and another one more adapted to Mac standards. Compare it now with the previous iPad-looking version for Mac that <strong class="bold">Scale Interface to Match iPad</strong> provided us:</p>
			<div>
				<div id="_idContainer211" class="IMG---Figure">
					<img src="image/Figure_18.23_B14717.jpg" alt="Figure 18.23 – Initial scaled version for Mac&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.23 – Initial scaled version for Mac</p>
			<p>As you can see, it is quite different! The new version feels more Mac-native. The buttons, toolbar, controls placement, and overall scale of the elements feel much better for the Mac <a id="_idIndexMarker978"/>version. It requires a bit more work, but the <a id="_idIndexMarker979"/>results are worth the effort. You can always do an initial port of your iPad app to Mac with <strong class="bold">Scale Interface to Match iPad</strong>, and then work on <strong class="bold">Optimize Interface for Mac</strong> later on!</p>
			<p>In this section, we started with a simple to-do iPad app. We used Mac Catalyst to port it to the Mac. First, we used the <strong class="bold">Scale Interface to Match iPad</strong> option, making the app available on Mac with one click. But then, we wanted to improve the UI to feel more aligned with the Mac standards, so we used the new <strong class="bold">Optimize Interface for Mac</strong> option. This option is not as straightforward as the scaling one, and we had to adapt certain sizes, remove some UI controls that are not available on the Mac, and create different variations specifically for the Mac. But the results are looking great!</p>
			<p>Let's now wrap up the chapter with a summary.</p>
			<h1 id="_idParaDest-273"><a id="_idTextAnchor568"/>Summary</h1>
			<p>We started the chapter with a brief Mac Catalyst introduction. We explained how Apple has provided developers with an easy way to port iPad apps into Mac apps with Mac Catalyst, and all the benefits that this new feature provides.</p>
			<p>Then, we discussed the most recent improvements and changes on Mac Catalyst presented in 2020. Among those new features, we mentioned the implications of <strong class="bold">Optimize Interface for Mac</strong>, and how it can enhance your iPad apps to become great Mac apps.</p>
			<p>Finally, and taking an iPad app as the starting point, we created the Mac version using both Mac Catalyst methods: <strong class="bold">Scale Interface to Match iPad</strong> and <strong class="bold">Optimize Interface for Mac</strong>. We showcased their pros and cons, and we applied the most common fixes and improvements that you will find yourself using with these two methods. By comparing them with the same app, you have got an understanding of the main differences between them and when to apply one or the other.</p>
			<p>In the next chapter, we will learn how and when to test your code.</p>
		</div>
	</body></html>