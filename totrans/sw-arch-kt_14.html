<html><head></head><body><div><div><div><h1 id="_idParaDest-342" class="chapter-number"><a id="_idTextAnchor442"/>14</h1>
			<h1 id="_idParaDest-343"><a id="_idTextAnchor443"/>Security</h1>
			<p>This chapter covers the fundamental principles and practices associated with system security, with a focus on the aspects that affect software architecture and the everyday life of engineers.</p>
			<p>It begins <a id="_idIndexMarker1258"/>by defining key concepts such as <strong class="bold">confidentiality</strong>, <strong class="bold">integrity</strong>, and <strong class="bold">availability</strong> (the <strong class="bold">CIA</strong> triad), which form the backbone of security strategies. The chapter outlines several types of threats, including malware, phishing, and insider attacks, highlighting the need for comprehensive risk assessment and management.</p>
			<p>Next, it explores various aspects of authentication and how it affects the engineering design of <a id="_idIndexMarker1259"/>software features, such as <strong class="bold">multi-factor authentication</strong> (<strong class="bold">MFA</strong>). Then, we will discuss how to use access control to ensure that only authorized users can access certain resources.</p>
			<p>Additionally, the <a id="_idIndexMarker1260"/>chapter addresses compliance <a id="_idIndexMarker1261"/>with legal and regulatory requirements, such as the <strong class="bold">General Data Protection Regulation</strong> (<strong class="bold">GDPR</strong>) and the <strong class="bold">Health Insurance Portability and Accountability Act</strong> (<strong class="bold">HIPAA</strong>), and it shapes security practices. Moreover, we will explore some ways we can handle confidential data in the system.</p>
			<p>We will delve into how network security shapes software architecture, such as security layers, encryption, and secure API designs that protect the system from malicious attacks.</p>
			<p>Finally, we will run an exercise of threat modeling with a real-life example.</p>
			<p>We are going to cover the following topics:</p>
			<ul>
				<li>Authentication</li>
				<li>Authorization</li>
				<li>Handling sensitive data</li>
				<li>Network security</li>
				<li>DevSecOps and threat modeling</li>
			</ul>
			<h1 id="_idParaDest-344"><a id="_idTextAnchor444"/>Technical requirements</h1>
			<p>You can find all the code files used in this chapter on GitHub: <a href="https://github.com/PacktPublishing/Software-Architecture-with-Kotlin/tree/main/chapter-14">https://github.com/PacktPublishing/Software-Architecture-with-Kotlin/tree/main/chapter-14</a></p>
			<h1 id="_idParaDest-345"><a id="_idTextAnchor445"/>The importance of security in software architecture</h1>
			<p><strong class="bold">System security</strong> refers to <a id="_idIndexMarker1262"/>the processes, measures, and practices implemented to protect information systems from unauthorized access, misuse, damage, or disruption. It includes a wide range of mechanisms aimed at safeguarding the confidentiality, integrity, and availability of data and resources within a system.</p>
			<p>System <a id="_idIndexMarker1263"/>security consists of multiple dimensions, including hardware, software, policies, and human factors, to create resistance against malicious threats and vulnerabilities.</p>
			<p>Software systems often handle sensitive information. Sensitive data can be grouped into several categories:</p>
			<ul>
				<li><strong class="bold">Personally identifiable information (PII)</strong>: Full names, dates of birth, addresses, telephone numbers, and personal email addresses</li>
				<li><strong class="bold">Personal information</strong>: Health insurance policies, medical test results, treatment records, prescriptions, education certificates, transcripts, university grades, and student identification numbers</li>
				<li><strong class="bold">Authentication credentials</strong>: Passwords, PINs, security questions and answers, and fingerprints</li>
				<li><strong class="bold">Financial information</strong>: Bank account details, credit card numbers, tax returns, financial statements, and income information</li>
				<li><strong class="bold">Confidential business information</strong>: Client lists, business plans, trade secrets, and internal communications</li>
				<li><strong class="bold">Legal documents</strong>: Contracts, litigation documents, and settlement agreements</li>
				<li><strong class="bold">Intellectual property</strong>: Copyrights, patents, trademarks, source code, user activity history, system data, and proprietary algorithms</li>
				<li><strong class="bold">Government and national security information</strong>: Government contracts, intelligence reports, and classified documents</li>
			</ul>
			<p>Ensuring security in software architecture shields sensitive data from unauthorized access, breaches, and leaks, maintaining confidentiality and privacy.</p>
			<p>Security measures protect the integrity of data throughout its life cycle, free from unauthorized modifications. This can guarantee that users receive accurate and reliable information, which is important for decision-making and trust.</p>
			<p>A secure software architecture is designed to withstand vicious attacks and ensure that services <a id="_idIndexMarker1264"/>are available to legitimate users. This is critical for maintaining business continuity, building a positive reputation, fostering satisfaction and trust among users, and providing competitive advantages.</p>
			<p>Many industries are subject to regulations regarding data protection and privacy, such as GDPR in the European Union and HIPAA in the United States. Software architecture compliant with these regulations protects organizations from legal penalties and reputational damage.</p>
			<p>Security should be part of the early phase of software architecture design. The design process involves identifying potential threats and vulnerabilities. Proactively addressing security risks reduces the chance of security incidents from day one. It is also more cost-effective to implement security measures early than after a breach happens. The financial losses related to legal fees, remediations, and loss of business can be massive.</p>
			<p>Security threats are constantly evolving, and a well-designed software architecture is flexible to incorporate new security technologies and practices. This adaptability and extensibility are essential for staying ahead of potential vulnerabilities and maintaining a robust security posture.</p>
			<p>Security-focused architecture encourages the integration of secure coding practices into the software <a id="_idIndexMarker1265"/>development cycle, such as <strong class="bold">DevSecOps</strong>. This cultural shift enhances overall security awareness within development teams.</p>
			<p>A secure system is supported by logging, monitoring, and alerting mechanisms that facilitate quick detection and response to security incidents, as discussed in <a href="B21737_11.xhtml#_idTextAnchor358"><em class="italic">Chapter 11</em></a>. This is essential for reducing damage and recovering from breaches effectively.</p>
			<p>By prioritizing security from the beginning, organizations can build resilient systems that not only defend against current threats but also adapt to future challenges, fostering trust and enhancing their overall business success. One of the most discussed foundations of security is the CIA triad, which we are going to cover next.</p>
			<h1 id="_idParaDest-346"><a id="_idTextAnchor446"/>The CIA triad</h1>
			<p>The <strong class="bold">CIA triad</strong> is a <a id="_idIndexMarker1266"/>foundational model in information security that outlines the three core principles of information security: <strong class="bold">confidentiality</strong>, <strong class="bold">integrity</strong>, and <strong class="bold">availability</strong>. It was initially mentioned in <em class="italic">Computer Security Technology Planning Study</em>, known as <em class="italic">The Anderson Report</em>, in 1972, authored by a team led by William Anderson. The concept was then discussed in the book, <em class="italic">Computer Security A Practitioner’s Approach</em> in the 1980s by Frederick Cohen. The term <em class="italic">CIA triad</em> was coined later by Steve Lipner around 1986. The CIA triad was popularized by Willis Ware in 1993 from <a id="_idIndexMarker1267"/>his study distributed by the US think tank, <strong class="bold">Research and Development Corporation</strong> (<strong class="bold">RAND</strong>). Since then, it has gained popularity in the cybersecurity landscape.</p>
			<p>The CIA triad is shown in <em class="italic">Figure 14</em><em class="italic">.1</em>:</p>
			<div><div><img src="img/B21737_14_1.jpg" alt="Figure 14.1 – The CIA triad" width="753" height="546"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.1 – The CIA triad</p>
			<p>We will briefly introduce each principle in the following sections.</p>
			<h2 id="_idParaDest-347"><a id="_idTextAnchor447"/>Confidentiality</h2>
			<p><strong class="bold">Confidentiality</strong> ensures <a id="_idIndexMarker1268"/>that sensitive information is only accessible to authorized individuals or systems. This includes keeping data away from bad actors with malicious intent. Individuals within an organization are also subject to limits on data access.</p>
			<p>Common methods <a id="_idIndexMarker1269"/>to maintain confidentiality include the following:</p>
			<ul>
				<li><strong class="bold">Authentication</strong>: Confirm the identity of a user, device, or system. The primary goal is to ensure that an entity trying to access a system is who they claim to be.</li>
				<li><strong class="bold">Authorization</strong>: Grant or deny an authenticated identity to specific resources, actions, or data within a system.</li>
				<li><strong class="bold">Encryption</strong>: Convert readable data into encoded data to prevent unauthorized access. Even if unauthorized individuals have obtained encrypted data, they need to also have the keys and know the decryption algorithm to unlock the data.</li>
				<li><strong class="bold">Redaction</strong>: Retain functionality and usability without exposing sensitive information.</li>
			</ul>
			<p>Some of these methods will be used and discussed in the sections ahead.</p>
			<h2 id="_idParaDest-348"><a id="_idTextAnchor448"/>Integrity</h2>
			<p><strong class="bold">Integrity</strong> refers to <a id="_idIndexMarker1270"/>the accuracy and consistency of data throughout its life cycle. This principle ensures that information is not altered or tampered with by unauthorized users and that it remains accurate, trustworthy, and reliable.</p>
			<p>Common techniques <a id="_idIndexMarker1271"/>to ensure integrity include the following:</p>
			<ul>
				<li><strong class="bold">Checksums and hash functions</strong>: A fixed-length string calculated from the data by an algorithm. Checksums or hash values usually come with the data itself. Any tampering with the data would produce a checksum (or hash value) different from the original checksum, so it is detected by the system as corrupted data.</li>
				<li><strong class="bold">Digital signatures</strong>: A document is signed by a hash value generated by a private key from the sender. The recipient receives the document together with the digital signature. The recipient computes the hash value of the document using the same algorithm. The recipient decrypts the digital signature using the sender’s public key and retrieves the original hash value. Two hash values being identical confirms that the document has not been modified. The sender’s private and <a id="_idIndexMarker1272"/>public keys form a pair, whereas the private key is only known to the sender and the public key is available to anyone.</li>
				<li><strong class="bold">Versioning control</strong>: Version control systems maintain a complete audit trail and history of changes made to a document. If errors or corruptions are detected, the document can be reverted to a previous version.</li>
			</ul>
			<h2 id="_idParaDest-349"><a id="_idTextAnchor449"/>Availability</h2>
			<p><strong class="bold">Availability</strong> ensures that <a id="_idIndexMarker1273"/>information and resources are accessible to authorized users when needed. This principle focuses on maintaining system functionality and minimizing downtime due to attacks, failures, or other disruptions.</p>
			<p>Strategies <a id="_idIndexMarker1274"/>to enhance availability include the following:</p>
			<ul>
				<li><strong class="bold">Redundancy</strong>: Avoid a single point of failure by having extra components and alternative paths to ensure continued operations and data integrity in the event of failure.</li>
				<li><strong class="bold">Load balancing</strong>: Distribute incoming traffic across multiple servers to ensure incoming requests are served.</li>
				<li><strong class="bold">Regular backups</strong>: Maintain copies of the database, file storage, and messaging store across multiple servers or locations to ensure data availability and to recover from data issues.</li>
				<li><strong class="bold">Disaster recovery planning and drills</strong>: Outline specific steps to take during a disaster to bring the system back up and make it operational. Periodically run disaster recovery drills to verify the plan and identify gaps. Establish clear communication channels to keep engineers and stakeholders informed during a disaster.</li>
			</ul>
			<h2 id="_idParaDest-350"><a id="_idTextAnchor450"/>Importance of the CIA triad</h2>
			<p>The CIA triad serves as a guiding framework for organizations to develop and implement effective <a id="_idIndexMarker1275"/>security policies and practices. These three principles help organizations create a comprehensive approach to information security and protect the business from various threats and vulnerabilities.</p>
			<p>We are going to go deeper into selected subjects that are based on the CIA triad.</p>
			<h1 id="_idParaDest-351"><a id="_idTextAnchor451"/>Authentication</h1>
			<p><strong class="bold">Authentication</strong> is the <a id="_idIndexMarker1276"/>process of verifying the identity of a user or a device before granting access to resources. This is the first step of establishing trust between two parties. An oversimplified authentication process looks like <em class="italic">Figure 14</em><em class="italic">.2</em>:</p>
			<div><div><img src="img/B21737_14_2.jpg" alt="Figure 14.2 – Oversimplified interaction of authentication" width="1136" height="813"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.2 – Oversimplified interaction of authentication</p>
			<p>The client (a user, a device, or a system) initiates the authentication with the target system, and it provides credentials to claim who it is. The system receives the credentials and starts the verification process. The system acknowledges a positive result if it can identify the client, otherwise, a rejection is sent back to the entity.</p>
			<p>This interaction is merely conceptual as actual authentication has a lot of aspects to consider. Firstly, the transport layer needs to be secured to ensure there is no eavesdropping, also known as <strong class="bold">man-in-the-middle</strong> (<strong class="bold">MitM</strong>) attacks.</p>
			<p class="callout-heading">MitM attack</p>
			<p class="callout">A MitM <a id="_idIndexMarker1277"/>attack is a cyberattack where an attacker secretly intercepts and relays communication between two parties. The attacker eavesdrops and captures communication potentially containing sensitive information. The attack might alter the messages exchanged or record them for further malicious intents, such as identity theft and financial fraud. MitM attacks can occur in various forms, such as intercepting unencrypted Wi-Fi traffic, exploiting vulnerabilities in secure communications, or tricking users into connecting to malicious networks. The attack threatens the confidentiality and integrity of communication among individuals and organizations.</p>
			<h2 id="_idParaDest-352"><a id="_idTextAnchor452"/>Transport Layer Security (TLS)</h2>
			<p><strong class="bold">Transport Layer Security</strong> (<strong class="bold">TLS</strong>) plays a significant role in securing communications over <a id="_idIndexMarker1278"/>networks, as a defense against threats, such as MitM, we have just mentioned.</p>
			<p>TLS evolved <a id="_idIndexMarker1279"/>from its predecessor, <strong class="bold">Secure Sockets Layer</strong> (<strong class="bold">SSL</strong>). SSL was first developed by Netscape in 1994, as a protocol aimed to <a id="_idIndexMarker1280"/>provide secure communications over the internet. It was never published due to security flaws. Subsequently, SSL 2.0 and SSL 3.0 were released, but they still faced vulnerabilities that led to the need for further development.</p>
			<p>TLS was first released in 1999. It was based on SSL 3.0 but it addressed the weaknesses of SSL and it provided better support for modern cryptographic algorithms. Subsequent versions of TLS have brought significant improvements in security and performance. TLS is widely used in various ways to secure communications on the internet, such as secure web browsing, email <a id="_idIndexMarker1281"/>content encryption, secure messaging, <strong class="bold">virtual private networks</strong> (<strong class="bold">VPNs</strong>), and secure inter-system communications.</p>
			<p>TLS requires the client and server to exchange a few rounds of messages to establish a secure transport communication. TLS is built on top of <strong class="bold">Transmission Control Protocol</strong> (<strong class="bold">TCP</strong>). The <a id="_idIndexMarker1282"/>first few steps are the messages exchanged to establish a TCP connection. Afterward, there are a few exchanges <a id="_idIndexMarker1283"/>of messages to establish a TLS communication:</p>
			<ol>
				<li><strong class="bold">Client hello</strong>: The client initiates TLS by sending to the server a message specifying <a id="_idIndexMarker1284"/>supported TLS versions, cipher suites (known as encryption algorithms), and a random number generated by the client.</li>
				<li><strong class="bold">Server hello</strong>: The server responds with its chosen TLS version and cipher suite, and a random number generated by the server.</li>
				<li><strong class="bold">Server certificate</strong>: The server sends its TLS certificate containing the server’s public key and <a id="_idIndexMarker1285"/>is signed by a trusted <strong class="bold">certificate authority</strong> (<strong class="bold">CA</strong>). Certain cipher suites require the server to include additional key exchange parameters.</li>
			</ol>
			<p class="callout-heading">CA</p>
			<p class="callout">A CA is a trusted entity that issues digital certificates to verify the identity of individuals, organizations, or devices <a id="_idIndexMarker1286"/>within a secure communication framework. CAs play a crucial role in <strong class="bold">public key infrastructure</strong> (<strong class="bold">PKI</strong>) by binding public keys to the identities of their owners, enabling secure protocols, such as TLS/SSL, for encrypted communication. They conduct identity verification before issuing certificates, maintain a chain of trust through root and intermediate certificates, and manage certificate revocation to ensure ongoing security. By providing this trust foundation, CAs enable users to confidently communicate and transact over the internet.</p>
			<ol>
				<li value="4"><strong class="bold">Server hello done</strong>: The server acknowledges finishing its part of the handshake.</li>
				<li><strong class="bold">Client key exchange</strong>: The client generates a pre-master secret, which is a random string without meaningful data, encrypts it with the server’s public key received from the server certificate, and sends it to the server.</li>
				<li><strong class="bold">Session keys creation</strong>: Both the client and server use the pre-master secret along with the previously exchanged random numbers to generate session keys. These keys will be used for encrypting the data during the session.</li>
				<li><code>Finished</code> messages, indicating <a id="_idIndexMarker1287"/>that the handshake is complete and that <a id="_idIndexMarker1288"/>they will now start using the session keys for secure communication.</li>
			</ol>
			<p>The interaction is shown in <em class="italic">Figure 14</em><em class="italic">.3</em>:</p>
			<div><div><img src="img/B21737_14_3.jpg" alt="Figure 14.3 – TLS handshaking" width="1114" height="1328"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.3 – TLS handshaking</p>
			<p>During the <a id="_idIndexMarker1289"/>TLS handshake, both the client and <a id="_idIndexMarker1290"/>server independently generate session keys that are unique to that session only. Any replay of messages outside the session is not valid and will be detected. The session key never exists in messages exchanged.</p>
			<p>Also, if a MitM attacker wants to decrypt the content of application data, it needs the symmetric session key. The session key is formed by random numbers generated by both sides and the pre-master secret. The pre-master secret can only be decrypted by the server’s private key, which is never exposed in any message exchanged. In other words, the MitM attackers cannot read the encrypted application data.</p>
			<p>In addition, each message exchanged contains a sequence number. Any out-of-order message will <a id="_idIndexMarker1291"/>be detected and not processed further. Each message also contains a <strong class="bold">Message Authentication Code</strong> (<strong class="bold">MAC</strong>) that acts like a checksum to confirm whether the data has been altered in transit.</p>
			<p>TLS uses <a id="_idIndexMarker1292"/>digital certificates issued by trusted CAs to authenticate the server’s identity. This prevents MitM attacks, where an attacker <a id="_idIndexMarker1293"/>impersonates the server. In the case of mutual TLS, the client can also present a certificate to prove its identity, further enhancing security.</p>
			<p>At this point, we have confidence that we have secure transport between the clients and the server. However, we still need to verify the identity of the client to authorize resources and actions allowed. We are going to discuss further how to authenticate the client in the next section.</p>
			<h2 id="_idParaDest-353"><a id="_idTextAnchor453"/>Multi-factor authentication (MFA)</h2>
			<p>Simple <a id="_idIndexMarker1294"/>authentication requires only one <a id="_idIndexMarker1295"/>such piece of evidence (known as a factor), typically a password. This approach has several weaknesses that make it inadequate for securing sensitive information:</p>
			<ul>
				<li><strong class="bold">Weak passwords</strong>: Easily guessed by attackers</li>
				<li><strong class="bold">Phishing</strong>: Attackers trick users into revealing their passwords (e.g., fake landing page)</li>
				<li><strong class="bold">Password reuse</strong>: If one password is compromised, attackers can access other services using the same password</li>
				<li><strong class="bold">Brute force</strong>: Automated tools can keep guessing the one password</li>
				<li><strong class="bold">Social engineering</strong>: Manipulate users into sharing passwords</li>
				<li><strong class="bold">No user verification</strong>: Password verification only checks whether the provided credentials are the same as the ones in the record, instead of verifying that the person attempting to gain access is the actual user</li>
			</ul>
			<p>MFA aims to harden the authentication process by verifying multiple factors, further validating that the user is who they claim to be. These factors are categorized into three groups:</p>
			<ul>
				<li><strong class="bold">Knowledge factor</strong>: Passwords, security questions and answers, PINs, or IDs</li>
				<li><strong class="bold">Possession factor</strong>: Smartphones, hardware tokens, authentication applications, and one-time passcodes</li>
				<li><strong class="bold">Biometric factor</strong>: Fingerprints, faces, and voices</li>
			</ul>
			<p>At a minimum, MFA requires at least two factors from distinct categories. It is less likely for attackers <a id="_idIndexMarker1296"/>to get a hold of multiple factors from a <a id="_idIndexMarker1297"/>target user, and thus it reduces the risk of unauthorized access. Moreover, some industries, such as banking, have regulatory requirements to enforce the use of MFA to protect sensitive data.</p>
			<p>It is worth pointing out that MFA does not necessarily require TLS, but using TLS for MFA is strongly recommended to ensure there is no eavesdropping and interception during the MFA process, especially when transmitting sensitive information, such as biometric data and passwords.</p>
			<h2 id="_idParaDest-354"><a id="_idTextAnchor454"/>Implications of MFA to software architecture</h2>
			<p>The prevalence of MFA in everyday life, such as online banking and e-commerce, has influenced <a id="_idIndexMarker1298"/>modern software architecture. There is a strong need for dedicated services to focus on authentication and decouple <a id="_idIndexMarker1299"/>from business logic. This is due to the high complexity of the authentication process and the sensitivity of the data it handles. It is better to have a service specialized in authentication that keeps sensitive data within its bounded context to reduce risks.</p>
			<p>Together with the rise of serverless cloud computing, as discussed in <a href="B21737_06.xhtml#_idTextAnchor212"><em class="italic">Chapter 6</em></a>, every organization that runs its services in the cloud must choose one of the following:</p>
			<ul>
				<li>The <strong class="bold">identity providers</strong> (<strong class="bold">IdPs</strong>) native to the cloud providers (e.g., Active Directory <a id="_idIndexMarker1300"/>for Azure, Google Identity for GCP, Cognito for AWS)</li>
				<li>Platform independent IdPs, such as Okta, Auth0, and Duo Security</li>
				<li>Write its <a id="_idIndexMarker1301"/>own <strong class="bold">identity and access management</strong> (<strong class="bold">IAM</strong>) service, optionally as a proxy to other IdPs</li>
				<li>No authentication required</li>
			</ul>
			<p>It is exceedingly rare these days to see systems skipping authentication. There are a few cases, such as public websites, anonymous surveys, and low-risk functions, such as calculators, that may not require authentication.</p>
			<p>It may be <a id="_idIndexMarker1302"/>justified to build an IAM service tailored to an organization’s needs. Unless the organization itself specializes in security solutions, IAM services <a id="_idIndexMarker1303"/>belong to the generic subdomain, as discussed in <a href="B21737_08.xhtml#_idTextAnchor289"><em class="italic">Chapter 8</em></a>. Most third-party IdPs provide the sufficient authentication capabilities required by an organization. If there is any organization-specific justification, it is recommended to build an IAM service to act as a proxy for a third-party IdP. If the third-party IdPs provide new features that are currently custom-built, this approach minimizes the impact of feature migration.</p>
			<h3>A sample interaction of MFA</h3>
			<p>Given a user <a id="_idIndexMarker1304"/>wants to log on to a system to request an operation from an application on a smart device, the messages exchange may look like <em class="italic">Figure 14</em><em class="italic">.4</em>:</p>
			<div><div><img src="img/B21737_14_4.jpg" alt="Figure 14.4 – A sample business request with MFA" width="1544" height="1449"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.4 – A sample business request with MFA</p>
			<p>This is just a <a id="_idIndexMarker1305"/>sample interaction because the communication varies with different IdPs and different factors involved in authentication. In this sample, the IdPs provide a white-label page themed for the organization.</p>
			<p class="callout-heading">White label page</p>
			<p class="callout">A <strong class="bold">white label page</strong> is a <a id="_idIndexMarker1306"/>customizable web page or application that can be re-branded and used by different organizations. The screen is themed for the target organization and the original organization’s branding is hidden. It is a common feature for a SaaS product to allow seamless integration with any organization while maintaining a consistent user experience.</p>
			<p>The user signs in and provides the username and password, using HTTPS over TLS. The username and password are joined by a colon as a string:</p>
			<pre class="source-code">
username:password</pre>			<p>The string <a id="_idIndexMarker1307"/>is then encoded in Base64 and is passed to the HTTP header as a part of the <strong class="bold">HTTP basic authentication</strong>. Since it is HTTPS, the header is also encrypted. The sign-in request is equivalent to the following command:</p>
			<pre class="source-code">
curl -i http://api.example.com/api/sign-in \
  -H "Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ="</pre>			<p>This data <a id="_idIndexMarker1308"/>forms the knowledge factor of the authentication.</p>
			<p>The IdP confirms that the username and password do exist and match, but then it issues a challenge to <a id="_idIndexMarker1309"/>the client to enter a <strong class="bold">one-time passcode</strong> (<strong class="bold">OTP</strong>). The OTP <a id="_idIndexMarker1310"/>is then sent to the user’s phone number via <strong class="bold">Short Message Service</strong> (<strong class="bold">SMS</strong>). The user who possesses the phone receives the OTP and enters the passcode. The passcode is sent from the client to the IdP to solve the challenge. This is the possession factor of the authentication.</p>
			<p>The IdP verifies whether the OTP is correct or not. If it is incorrect, the IdP responds to the client <a id="_idIndexMarker1311"/>and reveals that the authentication has failed. If it is correct, the IdP generates a <strong class="bold">JSON Web Token</strong> (<strong class="bold">JWT</strong>) as an access token and sends it to the client as a response. Soon after, the IdP also informs the server that a user is successfully authenticated via a webhook.</p>
			<p>A <strong class="bold">JWT</strong> is an encrypted JSON string used to carry claims about the roles and permissions of the user. It consists of three parts:</p>
			<ul>
				<li><strong class="bold">Header</strong>: The type <a id="_idIndexMarker1312"/>of the token as “JWT” and the algorithm used to encrypt the token.</li>
				<li><strong class="bold">Payload</strong>: Registered <a id="_idIndexMarker1313"/>claims, such as issuer, audience, expiration time, and ID. Also contains public claims, such as application user roles, and private claims for information to be shared only between parties using the token.</li>
				<li><strong class="bold">Signature</strong>: The proof <a id="_idIndexMarker1314"/>that the sender is who it claims to be and the whole JSON string has not been modified.</li>
			</ul>
			<p>The authentication success response also triggers a screen redirect to the landing screen for the user to start making business requests.</p>
			<p>The authenticated user makes a business request. The client sends the request to the server <a id="_idIndexMarker1315"/>with the access token attached to the HTTP header as a <code>Bearer</code> token:</p>
			<pre class="source-code">
curl -i http://api.example.com/api/business-request \
  -H "Authorization: Bearer mytoken123"</pre>			<p>The server receives from the client the request along with the <code>Bearer</code> token. The server verifies with the IdP whether the token is valid. The IdP confirms that the token is valid, so the server processes the request and responds to the client.</p>
			<p>The client can continue to use the <code>Bearer</code> token for other operations, without further authentication, until the session ends. The IdP is in control of the validity of the token throughout the session. The token can also be refreshed upon request to the IdP.</p>
			<p>The token <a id="_idIndexMarker1316"/>exchange and refresh flows are a part of the industry standard protocol for authorization, <strong class="bold">OAuth</strong> (<a href="https://oauth.net/2/">https://oauth.net/2/</a>).</p>
			<p class="callout-heading">OAuth</p>
			<p class="callout"><strong class="bold">OAuth</strong> is an <a id="_idIndexMarker1317"/>authorization framework that enables third-party applications to obtain limited access to resources without exposing credentials. Users are granted access to their data from one service to another service through various grant types, such as authorization code, implicit, and client credentials. The user submits authentication requests to an authorization server, which then issues access tokens for accessing protected resources on a resource server. OAuth emphasizes flexibility and is widely adopted for secure delegated access in modern applications.</p>
			<p>This sample interaction also allows the <code>Bearer</code> token to be used for authentication of other systems that use the same IdP. As the user has already been authenticated by the IdP, other systems using the same IdP can verify the identity of the user in the same way. This mechanism <a id="_idIndexMarker1318"/>enables the <strong class="bold">single-sign-on</strong> (<strong class="bold">SSO</strong>) experience where a user only needs to be authenticated once to access a basket of applications and systems that share the same IdP.</p>
			<h3>Step-up authentication</h3>
			<p>Sometimes, the authenticated user is asked to perform additional verification beyond their initial <a id="_idIndexMarker1319"/>authentication. This additional step is called <strong class="bold">step-up authentication</strong>.</p>
			<p>Step-up authentication typically applies to deliberately chosen situations when they involve <a id="_idIndexMarker1320"/>accessing sensitive information or high-risk actions, such as updating passwords, making a bank transfer, or moving the account data to an unfamiliar device.</p>
			<p>Step-up authentication can also be dynamically applied based on the context of the access requests, such as a new geographic location, new device, new bank account, and so on.</p>
			<p>The simplest approach to step-up authentication is to repeat the same MFA process under TLS communication. Some companies would deliberately add more challenges, such as CAPTCHA or biometric verifications.</p>
			<p>By implementing step-up authentication, organizations can significantly reduce the risk of unauthorized access while maintaining a seamless user experience for lower-risk activities.</p>
			<p>We go to great lengths to get to the point where the system has verified the identity of an entity entering the system. Now that the entity has signed in the system the next question is this: What can the entity access and execute in the system? We are going to explore this in the next section.</p>
			<h1 id="_idParaDest-355"><a id="_idTextAnchor455"/>Authorization</h1>
			<p><strong class="bold">Authorization</strong> determines <a id="_idIndexMarker1321"/>what resources a user or entity is allowed to access and what actions they can perform. After a user is authenticated, it is authorized to only interact with data and features explicitly granted rights. This restricts sensitive information to only individuals the system knows and maintains the integrity of systems.</p>
			<p>Authorization <a id="_idIndexMarker1322"/>conforms to the <strong class="bold">principle of least privilege</strong> (<strong class="bold">PoLP</strong>), known as the <strong class="bold">principle of minimal privilege</strong> (<strong class="bold">PoMP</strong>) or the <strong class="bold">principle of least authority</strong> (<strong class="bold">PoLA</strong>). PoLP states that a user, entity, or system should have <a id="_idIndexMarker1323"/>only the essential permissions to operate <a id="_idIndexMarker1324"/>its functions. This minimizes risks and limits potential damage from accidents or malicious actions that we might not have anticipated or known.</p>
			<p>In addition, knowingly granting permissions for specific resources and actions improves accountability and compliance with security policies. Staying with the knowns promotes a safer sense of security.</p>
			<p>As we have briefly mentioned, authorization has two elements: data and actions. They are different concepts in authorization and can be managed differently:</p>
			<ul>
				<li><strong class="bold">Data entitlement</strong>: Whether the user is entitled to access specific data or resources</li>
				<li><strong class="bold">Permission</strong>: Which actions the user is allowed to perform on a resource or data</li>
			</ul>
			<p>For example, a user is entitled to see their own user account. A user in the Administrator role is entitled to see other users’ accounts. However, the user must be granted permission to read user accounts to start with. A user is granted write permission to update their own user account. A user in the Administrator role, however, may not have the write permission to update other users’ accounts.</p>
			<p>There are <a id="_idIndexMarker1325"/>four typical approaches to implementing authorization:</p>
			<ul>
				<li><strong class="bold">Role-based access </strong><strong class="bold">control</strong> (<strong class="bold">RBAC</strong>)</li>
				<li><strong class="bold">Attribute-based access </strong><strong class="bold">control</strong> (<strong class="bold">ABAC</strong>)</li>
				<li><strong class="bold">Access control </strong><strong class="bold">lists</strong> (<strong class="bold">ACLs</strong>)</li>
				<li><strong class="bold">Policy-based access </strong><strong class="bold">control</strong> (<strong class="bold">PBAC</strong>)</li>
			</ul>
			<p>We are going to perform a deep dive into them.</p>
			<h2 id="_idParaDest-356"><a id="_idTextAnchor456"/>Role-based access control (RBAC)</h2>
			<p>An RBAC <a id="_idIndexMarker1326"/>approach has users assigned <a id="_idIndexMarker1327"/>to roles, and each role has specific permissions assigned to it. Users are granted permissions based on the assigned roles within the organization. This is illustrated in <em class="italic">Figure 14</em><em class="italic">.5</em>:</p>
			<div><div><img src="img/B21737_14_5.jpg" alt="Figure 14.5 – An example of RBAC" width="1366" height="804"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.5 – An example of RBAC</p>
			<p>In the preceding RBAC configuration, Alex and Taylor are assigned the role of <em class="italic">Customer service support</em>, which is granted permissions to perform basic-level actions, such as updating a customer’s order. More advanced actions, such as refunding an order, can only be executed by a person such as Sam with the <em class="italic">Customer service </em><em class="italic">supervisor</em> role.</p>
			<p>RBAC is commonly used in companies in which different job functions require various levels of access. It is more efficient than assigning permissions to users individually. It is also efficient in situations such as when an employee takes a holiday and another employee temporarily takes over the duty, or a new employee requires the same level of access as their teammates.</p>
			<h2 id="_idParaDest-357"><a id="_idTextAnchor457"/>Access control lists (ACLs)</h2>
			<p>An ACL <a id="_idIndexMarker1328"/>grants a list of users or groups of users to have access to a specific resource and defines which actions are allowed. This approach <a id="_idIndexMarker1329"/>is suitable for granting permissions to resources that can be precisely specified, such as the following:</p>
			<ul>
				<li><strong class="bold">Filesystems</strong>: Folders, read/write actions, and filenames</li>
				<li><strong class="bold">HTTP paths</strong>: <strong class="bold">Uniform Resource Identifiers</strong> (<strong class="bold">URIs</strong>) and <a id="_idIndexMarker1330"/>HTTP methods</li>
				<li><strong class="bold">Networking</strong>: IP addresses, ports, and transport layer protocols</li>
				<li><strong class="bold">Database</strong>: Schemas, tables, and actions</li>
			</ul>
			<p>Some of the ACLs also support wildcard matches for more flexible configuration. This approach is suitable for managing the entitlement of resources at a fine-grained level.</p>
			<h2 id="_idParaDest-358"><a id="_idTextAnchor458"/>Policy-based access control (PBAC)</h2>
			<p>PBAC grants permissions based on pre-defined policies that consider various criteria, such as user roles, attributes, and context.</p>
			<p>These <a id="_idIndexMarker1331"/>policies are pre-defined, but they support parameters. They are usually managed by GUI tools or set up as declarative configurations. The authorization tool itself may be custom-built, but the maintenance of policies does not require code change.</p>
			<p>The policies <a id="_idIndexMarker1332"/>can be fine-grained and highly configurable. They can also be changed at runtime without deployment or restart. They are useful in dynamic environments where access needs to adapt based on real-time conditions or compliance requirements.</p>
			<p>PBAC is effective for compliance regulatory requirements because well-defined policies can be treated as a technical implementation of compliance policies.</p>
			<h2 id="_idParaDest-359"><a id="_idTextAnchor459"/>Attribute-based access control (ABAC)</h2>
			<p>ABAC grants <a id="_idIndexMarker1333"/>permissions to attributes associated <a id="_idIndexMarker1334"/>with users, resources, and the environment. It provides the most flexible way to control permissions that can be sensitive to the context such as time and geographic locations.</p>
			<p>For example, a completed customer order can only be updated by a customer service supervisor, but an open order can be updated by both customer service support and supervisor.</p>
			<p>This approach is suitable for complex environments where access decisions depend on multiple, often dynamic, factors, such as user attributes (e.g., department, clearance level), resource attributes (e.g., sensitivity), time of access request, environment configurations, and so on. The control can be as granular as it needs to be.</p>
			<p>Due to <a id="_idIndexMarker1335"/>its high flexibility, ABAC is often written <a id="_idIndexMarker1336"/>as code instead of configuration. Some of these ABAC policies may even involve the concept of permission inheritance, at either the user level or resource level. The implementation can easily become complex.</p>
			<p>Writing ABAC in code also brings the challenges of testing and maintenance. It is possible that a bug in ABAC code leads to leaks of resources to unauthorized persons.</p>
			<h2 id="_idParaDest-360"><a id="_idTextAnchor460"/>Impacts of authorization on software architecture</h2>
			<p>There are several dimensions of how authorization impacts software architecture. Microservices, nanoservices, and FaaS (as discussed in <a href="B21737_06.xhtml#_idTextAnchor212"><em class="italic">Chapter 6</em></a>) themselves require access to infrastructure resources, such as databases and filesystems.</p>
			<p>If they <a id="_idIndexMarker1337"/>are often run under cloud providers, RBAC and ALCs can be used in defining and restricting what resources which component is allowed to access, and which actions are allowed. More than often, organizations would use the cloud-native IdP to manage infrastructure permissions and data entitlements used by applications.</p>
			<p>As we mentioned when discussing PoLP, an application should be granted exactly sufficient permissions and data entitlements to perform its operations, but no more.</p>
			<p>If there is a need to grant write access to a specific resource (e.g., database schema) to more than one bounded context, then it can be a smell of unclear or leaky bounded context. An architecture review of the involved bounded context will be useful in understanding the needs and examining whether the boundary of applications can be improved.</p>
			<p>End users, external systems, and other devices require access to both infrastructure and application data. There are a few use cases where they need access to the infrastructure resources.</p>
			<h3>Use case – submit expense reimbursement request and approval</h3>
			<p>In an organization, all users are permitted to submit requests to reimburse expenses for business <a id="_idIndexMarker1338"/>authorization:expense reimbursement request and approval” purposes. The financial operation team is responsible for reviewing these requests and deciding if the request should be approved or rejected.</p>
			<p>In this setup, all users have the User role. The role is granted permissions to access these endpoints:</p>
			<ul>
				<li><code>POST /expense</code>: This is to submit a new expense reimbursement request</li>
				<li><code>GET /expense/{id}</code>: This is to see the expense reimbursement request of the given ID</li>
			</ul>
			<p>Some users are assigned to the financial operations role. This role is granted permissions to access these endpoints:</p>
			<ul>
				<li><code>GET /expense/{id}</code>: This is to see the expense reimbursement request of the given ID</li>
				<li><code>PATCH /expense/{id}/result</code>: This is to either approve or reject the expense reimbursement request of the given ID</li>
			</ul>
			<p>The corresponding permission control can be configured using RBAC and ACLs. Most IdPs, including cloud-native middleware, can support this setting.</p>
			<h3>Centralized or distributed authorization logic?</h3>
			<p>It is often a question among engineers whether the authorization logic should be centralized <a id="_idIndexMarker1339"/>or distributed when it is related to application data.</p>
			<p>This is not a simple yes or no question. It depends on the nature of the authorization logic. At the basic level, the user requesting a record of application data should have permission granted to read the data of the given type. If it is RBAC or ACL, it is reasonable to have a centralized service to confirm that u<em class="italic">ser X can read application data of </em><em class="italic">type Y</em>.</p>
			<p>Alternatively, permissions or roles can be encoded as part of the JWT custom claims. This approach reduces the time spent in resolving permissions. However, it implies the granted <a id="_idIndexMarker1340"/>permissions can linger until the JWT expires, making dynamic authorization more difficult.</p>
			<p>However, it gets complicated when deciding whether a user is entitled to see a given application’s data, which is the data entitlement question of whether <em class="italic">user X can read application data of type Y and of ID 123</em>. Answering this question often requires domain-specific knowledge that should stay within the bounded context, in other words, distributed.</p>
			<p>Moreover, other actions on application data imply that the user can read the data to begin with. The interweaving logic of permissions, data entitlement, and business logic has significantly increased the complexity of the operations. This is even more complicated with third-party API integration where data being authorized are distributed among services.</p>
			<p>Using the same example of expense reimbursement request and approval from the previous section, a sample interaction of permissions and data entitlements business flow looks like the diagram in <em class="italic">Figure 14</em><em class="italic">.6</em>:</p>
			<div><div><img src="img/B21737_14_6.jpg" alt="Figure 14.6 – A sample interaction of permission and data entitlements business flow" width="1638" height="1679"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.6 – A sample interaction of permission and data entitlements business flow</p>
			<p>A user <a id="_idIndexMarker1341"/>with a financial operations role needs to see the expense reimbursement request to decide whether to approve or reject it. So, the first request from the client is the get the expense reimbursement request by the given ID.</p>
			<p>The corresponding service, the expense service, makes a synchronous call to the authorization service, which is dedicated to user permissions, to check whether the given user has the permissions to read an expense reimbursement request.</p>
			<p>The authorization service resolves the user’s permissions by its roles and returns a list of actions granted to the user. The expense service receives the list of granted actions, and on top of that, checks whether the user can see this particular expense reimbursement request.</p>
			<p>There could be domain-specific business rules, such as expense reimbursement requests can only be approved by a user of the same geographic jurisdiction. The expense service also further filters which actions can be performed on this expense reimbursement request. For example, if it is already approved, then the action to approve or reject is no longer available due to business logic, not due to permissions.</p>
			<p>Combined with the result of permissions and data entitlements, if the user is not allowed to see the expense reimbursement request, an HTTP status 403 (Forbidden) is returned to the client. Otherwise, an HTTP status 200 (OK) is returned with the payload of a list of actions available to the user on this expense reimbursement request.</p>
			<p>Both <a id="_idIndexMarker1342"/>services could have just returned a binary answer if the user could read the expense reimbursement request or not. However, returning a list of granted actions allows the list to be populated to the frontend application. The frontend application can enable and disable buttons to give the user clear expectations.</p>
			<p>The expense reimbursement request is presented to the user on a screen, and the user has decided on the approval. The client sends a <code>PATCH</code> request to update the result of the expense reimbursement request.</p>
			<p>The expense service makes a synchronous call to the authorization service to check whether the given user has permissions to approve or reject an expense reimbursement request. The authorization service returns a list of actions granted to the user. The expense service checks further if it is possible to approve or reject this given expense reimbursement request.</p>
			<p>If the expense reimbursement request is already approved or rejected, then an HTTP status 403 (Forbidden) is returned to the client. Otherwise, the expense service updates the result of the expense reimbursement request and returns an HTTP status 200 (OK) together with the payload of the updated expense reimbursement request.</p>
			<h3>Scalability concerns for authorization</h3>
			<p>From <a id="_idIndexMarker1343"/>this sample interaction, we can foresee that the authorization service is frequently synchronously called. It raises concerns about scalability. All business requests would need to be authorized, so the authorization service would be under the load of all other business-facing services combined.</p>
			<p>Meanwhile, caching permissions locally may not be desirable, and even risky to do so. It is recommended to keep requests to the authorization service lean by designing efficient and non-chatty APIs. It is also worth considering a smaller size payload, such as a binary format.</p>
			<p>Scaling out any business-facing service that uses the authorization service would imply scaling <a id="_idIndexMarker1344"/>out the authorization service considerably too. It is advised to set up metrics and monitoring to understand the usage of the authorization service per API client, so we understand if a service scales out to handle a greater number of requests, the authorization service needs to scale out proportionately.</p>
			<p>At this point of the chapter, we can authenticate users and authorize them with a list of allowed actions and accessible resources. Business operations on top of them would result in the system keeping sensitive data. We are going to explore the topic of handling sensitive data in the next section.</p>
			<h1 id="_idParaDest-361"><a id="_idTextAnchor461"/>Handling sensitive data</h1>
			<p>Handling sensitive data requires careful consideration and implementation of best practices <a id="_idIndexMarker1345"/>to ensure its confidentiality, integrity, availability, and compliance with regulatory requirements. In this section, we’ll look at the key strategies for managing sensitive data.</p>
			<h2 id="_idParaDest-362"><a id="_idTextAnchor462"/>Data classification</h2>
			<p>We have <a id="_idIndexMarker1346"/>discussed what data can be identified as sensitive <a id="_idIndexMarker1347"/>at the beginning of the chapter. It is important for an organization to explicitly classify and document which field is sensitive. There are at least three categories of data sensitivity:</p>
			<ul>
				<li><strong class="bold">Confidential</strong>: Only designated persons or roles can access</li>
				<li><strong class="bold">Internal use</strong>: Only members of the organization can access</li>
				<li><strong class="bold">Public</strong>: Accessible to all</li>
			</ul>
			<p>The documentation should serve as a guideline for everyone, including engineers, in the organization to handle them with care and caution.</p>
			<h2 id="_idParaDest-363"><a id="_idTextAnchor463"/>Data in transit</h2>
			<p>Data in transit <a id="_idIndexMarker1348"/>under TLS communication is encrypted with session keys. This <a id="_idIndexMarker1349"/>ensures that even if data is intercepted or accessed without authorization, it remains unreadable.</p>
			<h3>How to prevent accidentally logging sensitive information</h3>
			<p>However, it <a id="_idIndexMarker1350"/>is not safe and secure yet. It is not unusual to encounter sensitive information leaked by logging unknowingly:</p>
			<ul>
				<li>The full decrypted payload of requests, responses, or messages</li>
				<li>An aggregate Kotlin object that transitively contains a sensitive field</li>
				<li>An object of a generated class that contains a sensitive field</li>
				<li>Troubleshooting or debugging information that contains sensitive information</li>
				<li>Sensitive fields themselves</li>
			</ul>
			<p>This is quite dangerous because the related code looks innocuous and the leak is often found after the fact. There are a few techniques to prevent this from happening.</p>
			<p>A common technique adopted by engineers is to override the <code>toString</code> function of a Kotlin data class:</p>
			<pre class="source-code">
data class UserAccount(
    val username: String,
    val password: String,
    val createdAt: Instant
) {
    override fun toString(): String {
        return "UserAccount(createdAt=$createdAt)"
    }
}</pre>			<p>This approach works, but it is not scalable because there are a lot of override functions to write. Alternatively, a value wrapper can work efficiently, as shown here:</p>
			<pre class="source-code">
data class Secret&lt;T&gt; (val value: T) {
    override fun toString(): String = "*"
}</pre>			<p>The <code>Secret</code> wrapper class works on a class or a field. The <code>toString</code> override function is simple as well.</p>
			<p>There <a id="_idIndexMarker1351"/>are also open source libraries that aim to solve this issue with minimal code. For example, the Redacted <a id="_idIndexMarker1352"/>compiler plugin (<a href="https://github.com/ZacSweers/redacted-compiler-plugin">https://github.com/ZacSweers/redacted-compiler-plugin</a>) enables engineers to annotate a field or a class to be redacted, and therefore, the values are masked when <code>toString</code> is invoked. The setup is quite simple as well:</p>
			<ol>
				<li>The first step of the setup is its Gradle plugin:<pre class="source-code">
plugins {
    id("dev.zacsweers.redacted") version "1.10.0"
}</pre></li>				<li>Secondly, define a custom <code>Redacted</code> annotation class:<pre class="source-code">
@Retention(AnnotationRetention.SOURCE)
@Target(AnnotationTarget.PROPERTY, AnnotationTarget.CLASS)
annotation class Redacted</pre></li>				<li>Then, configure the plugin to use this annotation and configure the mask character in <code>build.gradle.kts</code>:<pre class="source-code">
redacted {
    redactedAnnotation = "redacted/Redacted"
    replacementString = "*"
}</pre></li>			</ol>
			<p>We have <a id="_idIndexMarker1353"/>the following data classes annotated with <code>Redacted</code>:</p>
			<pre class="source-code">
@Redacted
data class BankAccount(
    val iban: String,
    val bic: String,
    val holderName: String
)
data class UserAccount(
    @Redacted val username: String,
    @Redacted val password: String,
    val createdAt: Instant
)</pre>			<p>We create one object per class and print them to the console in the main function:</p>
			<p>fun main() {</p>
			<pre class="source-code">
    println("${BankAccount("Iban", "bic", "holderName")}")
    println("${UserAccount("username", "password", LocalDate.now())}")
    println(
        "Secret wrapper: ${Secret("email@address.com")}"
    )
}</pre>			<p>We have the following result:</p>
			<pre class="console">
BankAccount(*)
UserAccount(username=*, password=*, createdAt=2024-10-09)
Secret wrapper: *</pre>			<p>So, the sensitive information is masked as part of the <code>toString</code> function result. However, the values are not masked if the program is run from the IDE with this compiler plugin. The masked values are shown if the program is executed from the command line or Gradle tasks.</p>
			<p>There <a id="_idIndexMarker1354"/>are alternative approaches that use reflection as a means to redact or hide sensitive fields. They are not recommended due to the overhead of using reflection. Compile-time redaction is the most effective method.</p>
			<p>As for the payload and objects of a generated class, a sensible way to prevent sensitive information leaks is to avoid logging them in a production environment.</p>
			<h2 id="_idParaDest-364"><a id="_idTextAnchor464"/>Data at rest</h2>
			<p>Data at rest <a id="_idIndexMarker1355"/>refers to the data stored on devices, filesystems, databases, and <a id="_idIndexMarker1356"/>cloud environments. Data sitting in infrastructure is usually protected by MFA, RBAC, and ALCs, as discussed in previous sections. However, for sensitive information, additional steps need to be taken.</p>
			<h3>Encryption</h3>
			<p>Sensitive <a id="_idIndexMarker1357"/>data needs to be stored in an encrypted state; the variations <a id="_idIndexMarker1358"/>are in the <em class="italic">how</em>. Here are the common techniques:</p>
			<ul>
				<li><strong class="bold">Encrypted databases</strong>: All data stored in a database is stored in an encrypted and unreadable format. The data is automatically decrypted upon retrieval without the application code. These databases usually support authorization to ensure that <a id="_idIndexMarker1359"/>only authorized users can interact with encrypted data. They also innately support encryption key generation, storage, and rotation for extra security. Some databases also support encryption when data is being transmitted in and out of the database. However, encrypting and decrypting all data, sensitive or not, increases latency.</li>
				<li><strong class="bold">Encrypted fields</strong>: Only fields identified as sensitive data are encrypted. This approach works with all types of storage, such as database columns, events in messaging infrastructure, and files. It has less performance overhead compared to encrypted databases, However, doing it at a field level implies that applications need to handle aspects that are automatically by encrypted databases, such as the following:<ul><li>Encryption and decryption algorithms</li><li>Symmetric or asymmetric encryption key</li><li>Key generation and secret management</li><li>Key rotation and re-encryption</li></ul></li>
				<li><strong class="bold">Hybrid</strong>: Due to the performance overhead of encrypted databases and the additional <a id="_idIndexMarker1360"/>work to handle encryption in application code, it may be justified to use a hybrid approach, in which only sensitive data are stored in encrypted databases, and the rest are kept in any type of storage.</li>
				<li><strong class="bold">Encrypted backups</strong>: Sensitive data should be regularly backed up in encrypted format to ensure data can be restored security in case of data loss or breaches.</li>
			</ul>
			<h2 id="_idParaDest-365"><a id="_idTextAnchor465"/>Data retention and anonymization</h2>
			<p>Local authorities <a id="_idIndexMarker1361"/>and regulations have clear guidelines on how long data should be maintained, including sensitive data. During the retention period, it is the organization’s responsibility to keep them secure and safe. After the <a id="_idIndexMarker1362"/>retention period, sensitive data may be deleted.</p>
			<p>There are also regulations (e.g., GDPR) that individuals have the right to request for privacy data to be erased from the system.</p>
			<p>However, there may be complications for deleting sensitive data on its own. Some of the data have referential constraints and contain useful business insights, which need not identify individuals.</p>
			<p>There are several techniques that allow sensitive data to be anonymized and become not sensitive:</p>
			<ul>
				<li><code>anonymized@data.com</code>)</li>
				<li><strong class="bold">Generalization</strong>: Reduce the precision of sensitive values so they cannot identify a <a id="_idIndexMarker1363"/>specific person or record (e.g., dates of birth reduced to months of birth, addresses trimmed to cities, etc.).</li>
				<li><strong class="bold">Aggregation</strong>: Summarize <a id="_idIndexMarker1364"/>data into statistics so there is no reference to a person or a record.</li>
				<li><strong class="bold">Lost decryption keys</strong>: Delete the decryption keys so the data cannot be traced back to the individuals.</li>
				<li><strong class="bold">Periodic anonymization</strong>: Aggressively scan data that has passed the retention period and anonymize it.</li>
				<li><strong class="bold">Broken link</strong>: An upfront database schema design that separates sensitive data and non-sensitive into different tables, and no tables have reference to the sensitive data table. This sensitive data record can be deleted anytime without issues (see an example in <em class="italic">Figure</em> <em class="italic">14</em><em class="italic">.7</em>).</li>
			</ul>
			<div><div><img src="img/B21737_14_7.jpg" alt="Figure 14.7 – Separation of sensitive and non-sensitive data for anonymization" width="851" height="173"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.7 – Separation of sensitive and non-sensitive data for anonymization</p>
			<p>The user record table has a primary key user ID and this field can be used by other tables for reference. The sensitive personal record table is merely a complimentary table to keep only PII fields.</p>
			<p>Proactively using these techniques helps organizations manage sensitive data and protect it from unauthorized access and potential breaches. They help maintain trust with customers and compliance with regulatory requirements.</p>
			<p>Coming next, we are going to briefly cover some practices for ensuring network security.</p>
			<h1 id="_idParaDest-366"><a id="_idTextAnchor466"/>Network security</h1>
			<p>Earlier in this chapter, we discussed how  TLS works and how it prevents eavesdropping on network <a id="_idIndexMarker1365"/>communications. However, there are other <a id="_idIndexMarker1366"/>malicious attacks that do not require infiltrating the authentication and authorization processes.</p>
			<p>For example, <strong class="bold">distributed denial of service</strong> (<strong class="bold">DDoS</strong>) is a type of cyberattack in which a system is overwhelmed by multiple source systems, usually as bots and automated scripts, so that legitimate users cannot access the system. Attacks generative massive volume of traffic to saturate and exhaust the system’s resources, such as CPU, memory, and network.</p>
			<p>The following are the key strategies to protect the system from these network-level attacks.</p>
			<h2 id="_idParaDest-367"><a id="_idTextAnchor467"/>Web application firewalls (WAFs)</h2>
			<p>A <strong class="bold">web application firewall</strong> (<strong class="bold">WAF</strong>) is a security solution specialized in protecting systems <a id="_idIndexMarker1367"/>on the internet. A WAF can run in <a id="_idIndexMarker1368"/>the cloud, in a data center, or a mixture of both, as a front-runner before traffic from the internet reaches deeper inside the system. It <a id="_idIndexMarker1369"/>provides a few key functions:</p>
			<ul>
				<li><strong class="bold">Geo-blocking and IP blacklisting</strong>: Block traffic coming from and going to the list of IP addresses linked to malicious activity and block traffic from certain geographic regions.</li>
				<li><strong class="bold">Rate limiting</strong>: Prevent the number of requests to the server from reaching the threshold in duration as per configuration.</li>
				<li><strong class="bold">Prevention of foreign script executions</strong>: Prevent attackers from executing scripts that <a id="_idIndexMarker1370"/>are not part of the system, such as unauthorized database commands, <strong class="bold">cross-site scripting</strong> (<strong class="bold">XSS</strong>) from web pages, and trojans.</li>
				<li><strong class="bold">Policy-based or rule-based access policies</strong>: Highly configurable and customizable <a id="_idIndexMarker1371"/>rules to set up the needs of each application at a fine-grained level.</li>
				<li><strong class="bold">Frequent updates</strong>: WAFs are updated frequently to adapt to the ever-changing <a id="_idIndexMarker1372"/>landscape of security threats. WAFs address vulnerabilities outlined in the <strong class="bold">Open Web Application Security Project</strong> (<strong class="bold">OWASP</strong>) Top 10, which is updated periodically.</li>
			</ul>
			<p class="callout-heading">Open Web Application Security Project (OWASP)</p>
			<p class="callout">OWASP is an open source project with the mission to make software security visible and accessible to engineers and organizations. It is a global community of engineers, security experts, and organizations dedicated to providing free tools and knowledge to enhance the security of the digital environment. The OWASP Top 10 is a globally recognized list of the top 10 most crucial security risks. The list is updated regularly to reflect the evolution of security threats.</p>
			<p>A WAF is <a id="_idIndexMarker1373"/>a critical part of a comprehensive <a id="_idIndexMarker1374"/>web security strategy, providing essential protection for web applications against a variety of attacks. An organization with ongoing concerns should have a WAF. A cloud-based system can choose a WAF from the native cloud provider, or from a WAF that can run in the cloud. A WAF helps organizations safeguard their applications, protect sensitive data, and maintain compliance with security standards.</p>
			<h2 id="_idParaDest-368"><a id="_idTextAnchor468"/>Traffic routing and network segmentation</h2>
			<p>In <a id="_idIndexMarker1375"/>contrast to traffic blacklisting <a id="_idIndexMarker1376"/>and <a id="_idIndexMarker1377"/>blocking, there should be explicit traffic routing that serves as an API gateway or proxy to applications. The explicit configuration serves as a whitelist of permitted traffic routes from the external world and helps conform to the PoLP.</p>
			<p>Explicitly <a id="_idIndexMarker1378"/>configured traffic routes allow applying features such as the following:</p>
			<ul>
				<li><strong class="bold">Distributed tracing</strong>: Link requests that pass through multiple components as a holistic flow</li>
				<li><strong class="bold">Metrics</strong>: Collect metrics such as packet loss, response time, connection time, and error rate</li>
				<li><strong class="bold">Retrying</strong>: Allow applications to retry an operation in the face of intermittent failures</li>
				<li><strong class="bold">Circuit breaking</strong>: Disallow applications to repeat operations that have been failing</li>
				<li><strong class="bold">Rate limiting</strong>: Overlapped with the feature of WAF, limit the number of requests over a period</li>
			</ul>
			<p>So far, the traffic routing we covered here is all for ingress, that is, traffic from the external world to internal applications. Traffic egress, from internal applications to external worlds, is equally important. For example, attackers may have installed trojans that quietly <a id="_idIndexMarker1379"/>export sensitive data to an unidentified destination. This can <a id="_idIndexMarker1380"/>be configured by routers, network switches, network <a id="_idIndexMarker1381"/>ACLs, and WAF configurations. Cloud providers also have services that manage ingress and egress routes by rules and policies.</p>
			<p>A <strong class="bold">service mesh</strong> is another <a id="_idIndexMarker1382"/>approach to configure and control network communications, but it focuses on service-to-service communication. It provides a dedicated infrastructure layer that defines how one service communicates with another, ensuring all routes among services are explicitly defined. Apart from HTTP request routing, service mesh can be extended to other types of transports, such as messaging, files, and databases. It automatically detects and registers new instances of the service, so engineers can focus on business logic instead of network communication. Service mesh <a id="_idIndexMarker1383"/>often uses the <strong class="bold">Sidecar pattern</strong> in which there is a proxy deployed alongside a backend service, and the proxy intercepts all inbound and outbound traffic for the service.</p>
			<p class="callout-heading">Sidecar pattern</p>
			<p class="callout">The <strong class="bold">Sidecar pattern</strong> is an <a id="_idIndexMarker1384"/>architectural design approach where a secondary service, known as a sidecar, is deployed alongside a primary service to extend its functions but to decouple from its code base. This sidecar typically runs in the same container or VM. The sidecar handles cross-cutting concerns, such as logging, monitoring, security, and communication. This pattern enhances the resilience and maintainability of services, but without coupling with them, and thus facilitates more efficient management of complex applications.</p>
			<p><strong class="bold">Network segmentation</strong> is another <a id="_idIndexMarker1385"/>technique that divides a network into smaller, manageable segments to limit access and reduce the risk of being <a id="_idIndexMarker1386"/>attacked. This helps contain breaches and enhances overall security. It can be implemented by setting up <strong class="bold">virtual local area networks</strong> (<strong class="bold">VLANs</strong>) or sub-networks.</p>
			<h2 id="_idParaDest-369"><a id="_idTextAnchor469"/>Antivirus and anti-malware solutions</h2>
			<p>Finally, antivirus and <a id="_idIndexMarker1387"/>anti-malware solutions should be running in the infrastructure <a id="_idIndexMarker1388"/>to scan, detect, and remove malicious software. They monitor running processes, scan stored files, and discover suspicious behaviors <a id="_idIndexMarker1389"/>without manual intervention. These solutions are also automatically updated to stay with the latest threat definitions.</p>
			<p>Most of the network security strategies involve infrastructure solutions that involve application-specific configurations. In the next section, we will cover DevSecOps in which application engineers are proactively involved.</p>
			<h1 id="_idParaDest-370"><a id="_idTextAnchor470"/>DevSecOps</h1>
			<p><strong class="bold">DevSecOps</strong> is a software <a id="_idIndexMarker1390"/>development approach that integrates security best practices in the development process. It emphasizes that the responsibility of software security is shared among all members of the team, and security is an inseparable element in the development process.</p>
			<p>There will still be security experts and potential security teams in an organization. They provide expertise, knowledge, tools, and guidance to development. DevSecOps embraces <a id="_idIndexMarker1391"/>the following principles:</p>
			<ul>
				<li><strong class="bold">Shift left</strong>: Security considerations are integrated early in the development process, as a part of the requirements. This enables the discovery, identification, and remediation of vulnerabilities before the application reaches production.</li>
				<li><strong class="bold">Compliance as code</strong>: Include regulatory requirements in the code with automated tests to validate compliance continuously.</li>
				<li><strong class="bold">Collaboration and communication</strong>: This encourages collaboration between development, security, and operations teams, fostering a culture of shared responsibility for software security.</li>
				<li><strong class="bold">Automation</strong>: Automate security processes, such as code vulnerability scanning, as <a id="_idIndexMarker1392"/>a part of the <strong class="bold">continuous integration / continuous deployment</strong> (<strong class="bold">CI/CD</strong>) pipeline to provide quick feedback on security issues, and to allow the team to address these issues early in the development process. For example, <strong class="bold">OWASP Dependency-Check</strong> is a static analysis tool that identifies known vulnerabilities in project dependencies. This tool integrates with build tools such as Maven, Gradle, and Jenkins.</li>
				<li><strong class="bold">Continuous monitoring</strong>: Continuously monitor security threats, vulnerabilities, and unusual behaviors in applications and infrastructure while running in all environments.</li>
				<li><strong class="bold">Threat modeling</strong>: Discover and identify potential threats and vulnerabilities during the early stage of development, enabling teams to proactively address security concerns.</li>
			</ul>
			<h2 id="_idParaDest-371"><a id="_idTextAnchor471"/>Benefits of DevSecOps</h2>
			<p>By integrating security throughout the whole software development cycle, organizations can identify <a id="_idIndexMarker1393"/>and mitigate vulnerabilities early. It reduces the risk of security breaches, the cost of fixing security issues, and the cost of remediation.</p>
			<p>Automation integrated within a CI/CD pipeline and collaboration helps find vulnerabilities early in the process. It saves time in delivering secure applications and reduces the time to market.</p>
			<p>Continuous monitoring and automated compliance checks help organizations meet regulatory requirements proactively and more effectively.</p>
			<p>DevSecOps is a cultural and technical shift in how an organization approaches software development and security. The practices in the DevSecOps process foster a culture of delivering resilient applications and responding to threats effectively, leading to a more secure technical ecosystem.</p>
			<h2 id="_idParaDest-372"><a id="_idTextAnchor472"/>A threat modeling exercise</h2>
			<p>We are <a id="_idIndexMarker1394"/>going to run through an exercise of threat modeling (<a href="https://owasp.org/www-project-threat-model/">https://owasp.org/www-project-threat-model/</a>) to demonstrate how everyone <a id="_idIndexMarker1395"/>in the team is involved in this activity. Product managers, the security team, and the development team should be involved in all the steps.</p>
			<p>Threat modeling starts with a business scenario. We are going to use the same real-life example throughout the book. This is a software system that allows households to exchange services with each other via an agreed contract. The goal of this threat modeling exercise is to identify potential security threats and vulnerabilities in the system.</p>
			<h3>Step 1 – visualize architecture and identify assets</h3>
			<p>The first <a id="_idIndexMarker1396"/>step of threat modeling <a id="_idIndexMarker1397"/>is to define the scope where threat modeling takes place. This includes architecture diagrams to demonstrate the following:</p>
			<ul>
				<li>Components inside the system</li>
				<li>Boundary of the system, entry points, and exit points</li>
				<li>Assets that require protection</li>
			</ul>
			<p>There are <a id="_idIndexMarker1398"/>a few choices of diagram <a id="_idIndexMarker1399"/>format for this purpose, such as <a id="_idIndexMarker1400"/>the <strong class="bold">data flow diagram</strong> (<strong class="bold">DFD</strong>) from structural analysis or <a id="_idIndexMarker1401"/>container diagram (level 2) from the <strong class="bold">C4 model</strong>, as covered in <a href="B21737_01.xhtml#_idTextAnchor013"><em class="italic">Chapter 1</em></a>. The container diagram for the system is shown in <em class="italic">Figure 14</em><em class="italic">.8</em>:</p>
			<div><div><img src="img/B21737_14_8.jpg" alt="Figure 14.8 – Container diagram of the system from a real-life example for threat modeling" width="1495" height="1665"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 14.8 – Container diagram of the system from a real-life example for threat modeling</p>
			<p>The dash-lined rectangle defines the boundary of the system and its internal network. We can assume the system runs in a cloud environment and it intends to use cloud-native <a id="_idIndexMarker1402"/>services for cross-cutting <a id="_idIndexMarker1403"/>functions. There are several components in this diagram:</p>
			<ul>
				<li><strong class="bold">Mobile application</strong>: A user interface on mobile devices for households.</li>
				<li><strong class="bold">WAF</strong>: A cloud-based firewall middleware that blocks malicious IP addresses, limits the number of incoming requests, and prevents <strong class="bold">XSS</strong>.</li>
				<li><strong class="bold">API gateway/router</strong>: A cloud-based middleware that routes requests from mobile applications to the appropriate services.</li>
				<li><strong class="bold">Household service</strong>: A backend service responsible for CRUD operations of household records.</li>
				<li><strong class="bold">Contract service</strong>: A backend service responsible for managing the life cycle of a contract from drafted to exercised.</li>
				<li><strong class="bold">Notification service</strong>: A backend service responsible for sending notifications to external users via emails.</li>
				<li><strong class="bold">Email service</strong>: A cloud-based middleware that delivers email content to given addresses.</li>
				<li><strong class="bold">IdP</strong>: A cloud-based middleware that verifies a user’s identity using MFA from the mobile application and confirms if a bearer token is valid. Used by the household service and contract service.</li>
				<li><strong class="bold">Database</strong>: A cloud-based database to allow applications to read data from and write data to. Used by the household service and contract service.</li>
				<li><strong class="bold">Messaging broker</strong>: A cloud-based middleware that receives household updates, contract updates, and notification requests. It allows interested services to consume the messages for further processing. For instance, the notification service consumes notification messages and converts them to email requests to the email service.</li>
			</ul>
			<p>From the architecture diagram, we have identified the entry points in the system. Requests <a id="_idIndexMarker1404"/>come in from the mobile application, they <a id="_idIndexMarker1405"/>pass through the WAF, and then they are routed to the corresponding services.</p>
			<p>We have also identified two exit points in the system:</p>
			<ul>
				<li>Backend services request the IdP to verify an access token</li>
				<li>The notification service requests the email service to send an email</li>
			</ul>
			<p>In addition, we have identified the following assets:</p>
			<ul>
				<li><strong class="bold">Household data</strong>: Contain PIIs such as addresses and names</li>
				<li><strong class="bold">Contract data</strong>: Private information only available between two involved households</li>
				<li><strong class="bold">Notification request</strong>: Contain email content and email addresses (PIIs)</li>
				<li><strong class="bold">Application code</strong>: Source code of all backend services and the mobile application</li>
				<li><strong class="bold">Infrastructure</strong>: Servers, databases, network components, infrastructure configurations as code</li>
			</ul>
			<p>With the architecture diagrams, entry points, exit points, and identified assets, the team can now examine the information and discover threats and vulnerabilities in the system.</p>
			<h3>Step 2 – identify threats</h3>
			<p>The team <a id="_idIndexMarker1406"/>applies the <strong class="bold">STRIDE</strong> framework to <a id="_idIndexMarker1407"/>categorize potential threats based on the identified assets. STRIDE is a combination of the first letters of the following six aspects:</p>
			<ul>
				<li><strong class="bold">Spoofing</strong>: Unauthorized users may impersonate legitimate users</li>
				<li><strong class="bold">Tampering</strong>: Malicious modification of household or contract data in transit</li>
				<li><strong class="bold">Repudiation</strong>: Household users may deny agreeing to a contract with another household</li>
				<li><strong class="bold">Information disclosure</strong>: PII, such <a id="_idIndexMarker1408"/>as names, addresses, and email addresses, are exposed through vulnerabilities</li>
				<li><strong class="bold">Denial of service</strong>: Attackers may overwhelm and exhaust the system with traffic</li>
				<li><strong class="bold">Elevation of privilege</strong>: Users gaining access to unauthorized functions</li>
			</ul>
			<p>After threats are identified, the team needs to assess the risks and determine how to respond to them.</p>
			<h3>Step 3 – assess risks and determine responses</h3>
			<p>Risks can be assessed by two factors: likelihood and impact. These two factors are multiplied <a id="_idIndexMarker1409"/>to derive the risk level and thus the priority of the responses.</p>
			<p>A simple <a id="_idIndexMarker1410"/>approach is to have three levels for each factor, and each level is associated with an integer. The multiplication of the integers is the risk level. An organization can customize the levels and integers as it sees fit. In this example, the integers are assigned to each level as follows:</p>
			<ul>
				<li><strong class="bold">Likelihood</strong>: 1 – Unlikely, 2 – Possibly, 3 – Likely</li>
				<li><strong class="bold">Impact</strong>: 1 – Low, 2 – Medium, 3 – High</li>
			</ul>
			<p>The numeric values of these two factors constitute the risk assessment table, as shown in <em class="italic">Table 14.1</em>:</p>
			<table id="table001-4" class="No-Table-Style _idGenTablePara-1">
				<colgroup>
					<col/>
					<col/>
					<col/>
					<col/>
				</colgroup>
				<tbody>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><strong class="bold">Threat</strong></p>
						</td>
						<td class="No-Table-Style">
							<p><strong class="bold">Likelihood</strong></p>
						</td>
						<td class="No-Table-Style">
							<p><strong class="bold">Impact</strong></p>
						</td>
						<td class="No-Table-Style">
							<p><strong class="bold">Risk level</strong></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><strong class="bold">Spoofing</strong>: User impersonation</p>
						</td>
						<td class="No-Table-Style">
							<p>2</p>
						</td>
						<td class="No-Table-Style">
							<p>3</p>
						</td>
						<td class="No-Table-Style">
							<p>6</p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><strong class="bold">Tampering</strong>: Malicious data modifications</p>
						</td>
						<td class="No-Table-Style">
							<p>2</p>
						</td>
						<td class="No-Table-Style">
							<p>3</p>
						</td>
						<td class="No-Table-Style">
							<p>6</p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><strong class="bold">Repudiation</strong>: Household denying actions</p>
						</td>
						<td class="No-Table-Style">
							<p>1</p>
						</td>
						<td class="No-Table-Style">
							<p>2</p>
						</td>
						<td class="No-Table-Style">
							<p>2</p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><strong class="bold">Information</strong>: PII disclosure</p>
						</td>
						<td class="No-Table-Style">
							<p>2</p>
						</td>
						<td class="No-Table-Style">
							<p>3</p>
						</td>
						<td class="No-Table-Style">
							<p>6</p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p>Denial of service</p>
						</td>
						<td class="No-Table-Style">
							<p>2</p>
						</td>
						<td class="No-Table-Style">
							<p>2</p>
						</td>
						<td class="No-Table-Style">
							<p>4</p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><strong class="bold">Elevation of privilege</strong>: Unauthorized user actions</p>
						</td>
						<td class="No-Table-Style">
							<p>1</p>
						</td>
						<td class="No-Table-Style">
							<p>3</p>
						</td>
						<td class="No-Table-Style">
							<p>3</p>
						</td>
					</tr>
				</tbody>
			</table>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Table 14.1 – Example of risk assessment table</p>
			<p>The risk <a id="_idIndexMarker1411"/>levels are effectively the priority of security threats that the team needs to respond to and address, with the highest number being the highest priority, and the lowest number the lowest priority.</p>
			<p>There are four general responses to a risk, and the team must choose one response for each security risk:</p>
			<ul>
				<li><strong class="bold">Mitigation</strong>: Reduce the negative impact of the threat</li>
				<li><strong class="bold">Transfer</strong>: Shift the risk to another party, typically by using third-party software</li>
				<li><strong class="bold">Avoidance</strong>: Eliminate the risk by developing a new strategy or solution</li>
				<li><strong class="bold">Acceptance</strong>: Accept and acknowledge the risk, but no further actions</li>
			</ul>
			<p>For each <a id="_idIndexMarker1412"/>threat identified by the STRIDE framework, a response should be outlined, as follows:</p>
			<ul>
				<li><strong class="bold">Spoofing – transfer</strong>: Use the cloud-based IdP to implement MFA and to secure passwords</li>
				<li><strong class="bold">Tampering – avoidance</strong>: Use HTTPS over TLS</li>
				<li><strong class="bold">Repudiation – mitigation</strong>: Ensure sufficient audit trails and logging of all user actions related to household and contract records</li>
				<li><strong class="bold">Information disclosure – avoidance</strong>: Use encrypted databases, encrypt sensitive data in messaging payload, integrate code vulnerability scanning in CI/CD pipelines, and conduct regular security audits</li>
				<li><strong class="bold">Denial of service – transfer</strong>: Configure WAF to protect the network from DDoS attacks</li>
				<li><strong class="bold">Elevation of privilege – mitigation</strong>: Periodically review access control settings and conduct security training with internal users</li>
			</ul>
			<p>At this <a id="_idIndexMarker1413"/>point, the architecture has been <a id="_idIndexMarker1414"/>discussed from a security perspective. Threats are identified and their risk levels are determined. Each risk has been responded to. There are only a few steps to complete one round of threat modeling, which are covered in the next step.</p>
			<h3>Step 4 – document, review, and update</h3>
			<p>After conducting all the activities in the previous steps, it is paramount to have them all documented, preferably as a single page with rough dates when the threat was modeled. The <a id="_idIndexMarker1415"/>documentation serves as a record of learning as a team and as a checklist of follow-up actions.</p>
			<p>The security <a id="_idIndexMarker1416"/>team should review the documentation and advise if there are any additional topics to discuss. Otherwise, the security team should sign off on the threat modeling document as a reviewer.</p>
			<p>The team <a id="_idIndexMarker1417"/>should convert the risk responses into work items in the backlog to ensure that the decided actions are executed.</p>
			<p>The team should also periodically review this document and decide whether there should be another round of threat modeling. Alternatively, if there is an important feature change or an architecture change, then the team should consider whether there is a need to update the threat model.</p>
			<p>Threat modeling is a tool and process used to help the team deliver secure software at the beginning of development. It benefits engineers, security team, product managers, and customers by having secure software products that are developed efficiently by addressing security issues early.</p>
			<h1 id="_idParaDest-373"><a id="_idTextAnchor473"/>Summary</h1>
			<p>We discussed the importance of security in software architecture, and how sensitive information is categorized. Afterward, we covered the CIA triad for the security principles of confidentiality, integrity, and availability.</p>
			<p>We covered authentication with the spotlight on how TLS works and how it prevents cyberattacks such as MitM eavesdropping. We delved into the details of how MFA works and its implications for software architecture.</p>
			<p>Then, we moved on to the topic of authorization, and we covered the four major access control methods (role-based, policy-based, attribute-based, and ACLs). We discussed how authorization has impacted software architecture.</p>
			<p>We mentioned the basic practices in handling sensitive data, including data classification, and protecting data in transit and in rest. A few approaches are highlighted on how Kotlin engineers can avoid accidentally logging sensitive data. A couple of strategies for anonymizing data are included in this chapter.</p>
			<p>We briefly mentioned the principles of DevSecOps and its benefits to the software development cycle by having security integrated into the development process.</p>
			<p>Finally, we ran through a threat modeling exercise with the real-life example system. We visited the details of each step, emphasized how to conclude a cycle, and when the threat model should be re-visited.</p>
			<p>There are still some aspects of engineering that go beyond just architecture. We will cover a few miscellaneous topics that are specific to Kotlin engineers in the next and last chapters. We hope you will find them useful in supporting better software architecture.</p>
		</div>
	</div></div></body></html>