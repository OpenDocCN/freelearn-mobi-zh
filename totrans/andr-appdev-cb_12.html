<html><head></head><body><div class="chapter" title="Chapter&#xA0;12.&#xA0;Telephony, Networks, and the Web"><div class="titlepage"><div><div><h1 class="title"><a id="ch12"/>Chapter 12. Telephony, Networks, and the Web</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">How to make a phone call</li><li class="listitem" style="list-style-type: disc">Monitoring phone call events</li><li class="listitem" style="list-style-type: disc">How to send SMS (text) messages</li><li class="listitem" style="list-style-type: disc">Receiving SMS messages</li><li class="listitem" style="list-style-type: disc">Displaying a web page in your application</li><li class="listitem" style="list-style-type: disc">Checking online status and connection type</li><li class="listitem" style="list-style-type: disc">Getting started with Volley for Internet requests</li><li class="listitem" style="list-style-type: disc">Canceling a Volley request</li><li class="listitem" style="list-style-type: disc">Using Volley to request a JSON response</li><li class="listitem" style="list-style-type: disc">Using Volley to request an image</li><li class="listitem" style="list-style-type: disc">Using Volley's NetworkImageView and ImageLoader</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec91"/>Introduction</h1></div></div></div><p>We'll start this chapter by looking at Telephony functionality with <span class="emphasis"><em>How to make a phone call</em></span>. After exploring how to make a call, we'll look at how to monitor a phone call with <span class="emphasis"><em>Monitoring phone call events</em></span>. We'll then move on to SMS messaging with <span class="emphasis"><em>How to send SMS Messages</em></span>, and then we'll cover receiving SMS Messages with <span class="emphasis"><em>Receiving SMS Messages.</em></span>
</p><p>We'll then explore the <code class="literal">WebView</code> for adding browser functionality to your app. At its basic level, the <code class="literal">WebView</code> is a basic HTML viewer. We'll show how you can extend a <code class="literal">WebViewClient</code> class and modify the settings through <code class="literal">WebSettings</code> to create full browser functionality, including JavaScript and Zoom features.</p><p>The remaining chapter will cover Volley, a new library made available through AOSP. The <span class="emphasis"><em>Getting started with Volley for Internet requests</em></span> introduction will give some background information on the online libraries available on Android and talk about why Volley was created. It also offers a complete walk-through of adding Volley to your Android Studio project.</p></div></div>
<div class="section" title="How to make a phone call"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec92"/>How to make a phone call</h1></div></div></div><p>As<a id="id749" class="indexterm"/> we've seen in previous recipes, we can call the default applications simply by using an Intent. To make a phone call, use <code class="literal">Intent.ACTION_DIAL</code> when creating an Intent. You can include a phone number with the <code class="literal">setData()</code> method. Here is sample code that will call up the Dialer app with the phone number specified:</p><div class="informalexample"><pre class="programlisting">Intent intent = new Intent(Intent.ACTION_DIAL);
intent.setData(Uri.parse("tel:" + number));
startActivity(intent);</pre></div><p>Since your application is not doing the dialing and the user must press the <span class="strong"><strong>Dial</strong></span> button, you do not need any dialing permissions in your app. The following recipe will show you how to place a call directly, bypassing the <code class="literal">Dial</code> activity. (For this, you will need to add a permission.)</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec334"/>Getting ready</h2></div></div></div><p>Create a new project in Android Studio and call it <code class="literal">DialPhone</code>. Use the default <span class="strong"><strong>Phone &amp; Tablet </strong></span>option and select <span class="strong"><strong>Empty Activity</strong></span> when prompted for <span class="strong"><strong>Activity Type</strong></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec335"/>How to do it...</h2></div></div></div><p>First, we need to add the appropriate permission to make the call. Then, we need to add a button to call our <code class="literal">Dial</code> method. Start by opening the Android Manifest and follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the following permission:<div class="informalexample"><pre class="programlisting">&lt;uses-permission android:name="android.permission.CALL_PHONE"&gt;&lt;/uses-permission&gt;</pre></div></li><li class="listitem">Open <code class="literal">activity_main.xml</code> and replace the existing <code class="literal">TextView</code> with the following button:<div class="informalexample"><pre class="programlisting">&lt;Button
    android:id="@+id/button"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="Dial"
    android:layout_centerInParent="true"
    android:onClick="dialPhone"/&gt;</pre></div></li><li class="listitem">Add this method that will check whether your app has been granted the <code class="literal">CALL_PHONE</code> permission:<div class="informalexample"><pre class="programlisting">private boolean checkPermission(String permission) {
    int permissionCheck = ContextCompat.checkSelfPermission(
            this, permission);
    return (permissionCheck == PackageManager.PERMISSION_GRANTED);
}</pre></div></li><li class="listitem">Add the code to dial the number:<div class="informalexample"><pre class="programlisting">public void dialPhone(View view){
    if (checkPermission("android.permission.CALL_PHONE")) {
        Intent intent = new Intent(Intent.ACTION_CALL);
        intent.setData(Uri.parse("tel:0123456789"));
        startActivity(intent);
    }
}</pre></div></li><li class="listitem">Before running this on your device, be sure to replace <code class="literal">0123456789</code> with a valid number.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec336"/>How it works...</h2></div></div></div><p>As we <a id="id750" class="indexterm"/>saw from the code in the introduction, we don't need any permissions when calling the default Dialer application. But if we want to dial a number directly, we need to add the <code class="literal">CALL_PHONE</code> permission. Starting with Android 6.0 Marshmallow (API 23), permissions are no longer granted during installation, therefore, we check whether the application has permission before attempting to dial.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec337"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For more information, refer to the<span class="emphasis"><em> The new Runtime permission model</em></span> recipe in <a class="link" href="ch14.html" title="Chapter 14. Getting your app ready for the Play Store">Chapter 14</a>, <span class="emphasis"><em>Your App Ready for the Play Store</em></span>.</li></ul></div></div></div>
<div class="section" title="Monitoring phone call events"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec93"/>Monitoring phone call events</h1></div></div></div><p>In the<a id="id751" class="indexterm"/> previous recipe, we demonstrated how to make a phone call, both with an Intent to call the default application as well as by directly dialing the number with no UI.</p><p>What if you want to be notified when the calls ends? This is where it gets a bit more complicated as you'll need to monitor the Telephony events and track the phone state. In this recipe, we'll demonstrate how to create a <code class="literal">PhoneStateListener</code> to read the phone state events.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec338"/>Getting ready</h2></div></div></div><p>Create a new project in Android Studio and call it <code class="literal">PhoneStateListener</code>. Use the default <span class="strong"><strong>Phone &amp; Tablet </strong></span>option and select <span class="strong"><strong>Empty Activity</strong></span> when prompted for <span class="strong"><strong>Activity Type</strong></span>.</p><p>Although it's not required, you can use the previous recipe to initiate a phone call to view the events. Otherwise, use the default dialer and/or watch the events from an incoming call. (The example code provided in the download files includes the previous recipe to make it easier to view the events.)</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec339"/>How to do it...</h2></div></div></div><p>We only<a id="id752" class="indexterm"/> need a single <code class="literal">TextView</code> on the layout to display the event information. If you are continuing from the previous recipe or starting a new recipe, open the <code class="literal">activity_main.xml</code> file and follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add or modify the <code class="literal">TextView</code> as follows:<div class="informalexample"><pre class="programlisting">&lt;TextView
    android:id="@+id/textView"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content" /&gt;</pre></div></li><li class="listitem">Add the following permission to the Android Manifest:<div class="informalexample"><pre class="programlisting">&lt;uses-permission android:name="android.permission.READ_PHONE_STATE"&gt;
&lt;/uses-permission&gt;</pre></div></li><li class="listitem">Open <code class="literal">MainActivity.java</code> and add the following <code class="literal">PhoneStateListener</code> class to the <code class="literal">MainActivity</code> class:<div class="informalexample"><pre class="programlisting">PhoneStateListener mPhoneStateListener = new PhoneStateListener() {
    @Override
    public void onCallStateChanged(int state, String number) {
        String phoneState = number;
        switch (state) {
            case TelephonyManager.CALL_STATE_IDLE:
                phoneState += "CALL_STATE_IDLE\n";
            case TelephonyManager.CALL_STATE_RINGING:
                phoneState += "CALL_STATE_RINGING\n";
            case TelephonyManager.CALL_STATE_OFFHOOK:
                phoneState += "CALL_STATE_OFFHOOK\n";
        }
        TextView textView = (TextView)findViewById(R.id.textView);
        textView.append(phoneState);
    }
};</pre></div></li><li class="listitem">Modify <code class="literal">onCreate()</code> to set up the listener:<div class="informalexample"><pre class="programlisting">final TelephonyManager telephonyManager = (TelephonyManager)getSystemService(Context.TELEPHONY_SERVICE);
telephonyManager.listen(mPhoneStateListener,PhoneStateListener.LISTEN_CALL_STATE);</pre></div></li><li class="listitem">Run the application on a device and initiate and/or receive phone calls to view the events.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec340"/>How it works...</h2></div></div></div><p>To <a id="id753" class="indexterm"/>demonstrate using the listener, we create the Telephony listener in the <code class="literal">onCreate()</code> with these two lines of code:</p><div class="informalexample"><pre class="programlisting">final TelephonyManager telephonyManager = (TelephonyManager)getSystemService(Context.TELEPHONY_SERVICE);
telephonyManager.listen(mPhoneStateListener,PhoneStateListener.LISTEN_CALL_STATE);</pre></div><p>When a <code class="literal">PhoneState</code> event occurs, it is sent to our <code class="literal">PhoneStateListener</code> class.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec341"/>There's more...</h2></div></div></div><p>In this recipe, we are monitoring the <a id="id754" class="indexterm"/>Call State events, as indicated with this constant: <code class="literal">LISTEN_CALL_STATE</code>. The other interesting options include the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">LISTEN_CALL_FORWARDING_INDICATOR</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">LISTEN_DATA_CONNECTION_STATE</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">LISTEN_SIGNAL_STRENGTHS</code></li></ul></div><p>Take a look at the following <code class="literal">PhoneStateListener</code> link for a complete list.</p><p>When we're done listening for events, call the <code class="literal">listen()</code> method and pass <code class="literal">LISTEN_NONE</code>, as shown here:</p><div class="informalexample"><pre class="programlisting">telephonyManager.listen(mPhoneStateListener,PhoneStateListener.LISTEN_NONE);</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec342"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Developer Docs: PhoneStateListener</strong></span> <a id="id755" class="indexterm"/>at <a class="ulink" href="https://developer.android.com/reference/android/telephony/PhoneStateListener.html">https://developer.android.com/reference/android/telephony/PhoneStateListener.html</a></li></ul></div></div></div>
<div class="section" title="How to send SMS (text) messages"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec94"/>How to send SMS (text) messages</h1></div></div></div><p>Since<a id="id756" class="indexterm"/> you're probably already familiar with SMS (or text) messages, we won't spend time explaining what they are or why they are important. (If you're not familiar with SMS or want more information, see the link provided in the <span class="emphasis"><em>See also</em></span> section of this recipe.) This recipe will demonstrate how to send an SMS Message. (The next recipe will demonstrate how to receive notifications of new messages and how to read existing messages.)</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec343"/>Getting ready</h2></div></div></div><p>Create a new project in Android Studio and call it <code class="literal">SendSMS</code>. Use the default <span class="strong"><strong>Phone &amp; Tablet </strong></span>option and select <span class="strong"><strong>Empty Activity</strong></span> when prompted for <span class="strong"><strong>Activity Type</strong></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec344"/>How to do it...</h2></div></div></div><p>First, we'll add the necessary permissions for sending an SMS. Then, we'll create a layout with a <span class="strong"><strong>Phone Number</strong></span> and <span class="strong"><strong>Message</strong></span> fields and a <span class="strong"><strong>Send</strong></span> button. When the Send button is clicked on, we'll create and send the SMS. Here are the steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the Android Manifest and add the following permission:<div class="informalexample"><pre class="programlisting">&lt;uses-permission android:name="android.permission.SEND_SMS"/&gt;</pre></div></li><li class="listitem">Open <code class="literal">activity_main.xml</code> and replace the existing <code class="literal">TextView</code> with the following XML:<div class="informalexample"><pre class="programlisting">&lt;EditText
    android:id="@+id/editTextNumber"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:inputType="number"
    android:ems="10"
    android:layout_alignParentTop="true"
    android:layout_centerHorizontal="true"
    android:hint="Number"/&gt;
&lt;EditText
    android:id="@+id/editTextMsg"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_below="@+id/editTextNumber"
    android:layout_centerHorizontal="true"
    android:hint="Message"/&gt;
&lt;Button
    android:id="@+id/buttonSend"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="Send"
    android:layout_below="@+id/editTextMsg"
    android:layout_centerHorizontal="true"
    android:onClick="send"/&gt;</pre></div></li><li class="listitem">Open <code class="literal">MainActivity.java</code> and add the following global variables:<div class="informalexample"><pre class="programlisting">final int SEND_SMS_PERMISSION_REQUEST_CODE=1;
Button mButtonSend;</pre></div></li><li class="listitem">Add<a id="id757" class="indexterm"/> the following code to the existing <code class="literal">onCreate()</code> callback:<div class="informalexample"><pre class="programlisting">mButtonSend = (Button)findViewById(R.id.buttonSend);
mButtonSend.setEnabled(false);

if (checkCallPermission(Manifest.permission.SEND_SMS)) {
    mButtonSend.setEnabled(true);
} else {
    ActivityCompat.requestPermissions(this,
            new String[]{Manifest.permission.SEND_SMS},
            SEND_SMS_PERMISSION_REQUEST_CODE);
}</pre></div></li><li class="listitem">Add the following method to check the permission:<div class="informalexample"><pre class="programlisting">private boolean checkPermission(String permission) {
    int permissionCheck = ContextCompat.checkSelfPermission(this,permission);
    return (permissionCheck == PackageManager.PERMISSION_GRANTED);
}</pre></div></li><li class="listitem">Override <code class="literal">onRequestPermissionsResult()</code> to handle the permission request response:<div class="informalexample"><pre class="programlisting">@Override
public void onRequestPermissionsResult(int requestCode,String permissions[], int[] grantResults) {
    switch (requestCode) {
        case SEND_SMS_PERMISSION_REQUEST_CODE: {
            if (grantResults.length &gt; 0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {
                mButtonSend.setEnabled(true);
            }
            return;
        }
    }
}</pre></div></li><li class="listitem">And finally, add the<a id="id758" class="indexterm"/> method to actually send the SMS:<div class="informalexample"><pre class="programlisting">public void send(View view) {
    String phoneNumber = ((EditText)findViewById(R.id.editTextNumber)).getText().toString();
    String msg = ((EditText)findViewById(R.id.editTextMsg)).getText().toString();

    if (phoneNumber==null || phoneNumber.length()==0 || msg==null || msg.length()==0 ) {
        return;
    }

    if (checkPermission(Manifest.permission.SEND_SMS)) {
        SmsManager smsManager = SmsManager.getDefault();
        smsManager.sendTextMessage(phoneNumber, null, msg, null, null);
    } else {
        Toast.makeText(MainActivity.this, "No Permission", Toast.LENGTH_SHORT).show();
    }
}</pre></div></li><li class="listitem">You're ready to run the application on a device or emulator. (Use the emulator device number, such as 5556, when sending to another emulator.)</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec345"/>How it works...</h2></div></div></div><p>The code for sending an SMS is only two lines, as shown here:</p><div class="informalexample"><pre class="programlisting">SmsManager smsManager = SmsManager.getDefault();
smsManager.sendTextMessage(phoneNumber, null, msg, null, null);</pre></div><p>The <code class="literal">sendTextMessage()</code> method does the actual sending. Most of the code for this recipe is to set up the permissions since the permission model was changed in Android 6.0 Marshmallow (API 23).</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec346"/>There's more...</h2></div></div></div><p>As simple as it is to send SMS messages, we still have a few more options.</p><div class="section" title="Multipart messages"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec46"/>Multipart messages</h3></div></div></div><p>Though it can vary depending on<a id="id759" class="indexterm"/> the carrier, 160 is typically the maximum characters allowed per text message. You could modify the preceding code to check whether the message exceeds 160 characters and if so, you can call the SMSManager <code class="literal">divideMessage()</code> method. The method returns an <code class="literal">ArrayList</code>, which you can send to <code class="literal">sendMultipartTextMessage()</code>. Here's an example:</p><div class="informalexample"><pre class="programlisting">ArrayList&lt;String&gt; messages=smsManager.divideMessage(msg);
smsManager.sendMultipartTextMessage(phoneNumber, null, messages, null, null);</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip31"/>Tip</h3><p>Note that messages sent with <code class="literal">sendMultipartTextMessage()</code> may not work correctly when using an emulator, so be sure to test on a real device.</p></div></div></div><div class="section" title="Delivery status notification"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec47"/>Delivery status notification</h3></div></div></div><p>If you'd like to be notified of the<a id="id760" class="indexterm"/> status of the messages, there are two optional fields you can use. Here's the <code class="literal">sendTextMessage()</code> method as defined in the <span class="strong"><strong>SMSManager</strong></span> documentation:</p><div class="informalexample"><pre class="programlisting">sendTextMessage(String destinationAddress, String scAddress, String text, PendingIntent sentIntent, PendingIntent deliveryIntent)</pre></div><p>You can include a pending Intent to be notified of the send status and/or delivery status. Upon receipt of your pending Intent, it will include a result code with either <code class="literal">Activity.RESULT_OK</code>, if it sent successfully, or an error code as defined in the <span class="strong"><strong>SMSManager</strong></span> documentation (link mentioned in the following <span class="emphasis"><em>See also</em></span> section):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">RESULT_ERROR_GENERIC_FAILURE</code>: Generic failure cause</li><li class="listitem" style="list-style-type: disc"><code class="literal">RESULT_ERROR_NO_SERVICE</code>: Failed because service is currently unavailable</li><li class="listitem" style="list-style-type: disc"><code class="literal">RESULT_ERROR_NULL_PDU</code>: Failed because no PDU was provided</li><li class="listitem" style="list-style-type: disc"><code class="literal">RESULT_ERROR_RADIO_OFF</code>: Failed because radio was explicitly turned off</li></ul></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec347"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Short Message Service<a id="id761" class="indexterm"/> on Wikipedia at <a class="ulink" href="https://en.wikipedia.org/wiki/Short_Message_Service">https://en.wikipedia.org/wiki/Short_Message_Service</a></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Developer Docs: SMSManager</strong></span> <a id="id762" class="indexterm"/>at <a class="ulink" href="https://developer.android.com/reference/android/telephony/SmsManager.html">https://developer.android.com/reference/android/telephony/SmsManager.html</a></li></ul></div></div></div>
<div class="section" title="Receiving SMS messages"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec95"/>Receiving SMS messages</h1></div></div></div><p>This recipe will <a id="id763" class="indexterm"/>demonstrate how to set up a Broadcast Receiver to notify you of new SMS messages. It's useful to note that your app does not need to be running to receive the SMS Intent. Android will start your service to process the SMS.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec348"/>Getting ready</h2></div></div></div><p>Create a new project in Android Studio and call it <code class="literal">ReceiveSMS</code>. Use the default <span class="strong"><strong>Phone &amp; Tablet </strong></span>option and select <span class="strong"><strong>Empty Activity</strong></span> when prompted for <span class="strong"><strong>Activity Type</strong></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec349"/>How to do it...</h2></div></div></div><p>We won't be using a layout in this demonstration as all the work will be in the Broadcast Receiver. We'll use Toasts to display incoming SMS messages. Open the Android Manifest and follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the following permission:<div class="informalexample"><pre class="programlisting">&lt;uses-permission android:name="android.permission.RECEIVE_SMS" /&gt;</pre></div></li><li class="listitem">Add the following declaration for the broadcast receiver to the <code class="literal">&lt;application&gt;</code> element:<div class="informalexample"><pre class="programlisting">&lt;receiver android:name=".SMSBroadcastReceiver"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.provider.Telephony.SMS_RECEIVED"&gt;
        &lt;/action&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;</pre></div></li><li class="listitem">Open <code class="literal">MainActivity.java</code> and add the following method:<div class="informalexample"><pre class="programlisting">private boolean checkPermission(String permission) {
    int permissionCheck = ContextCompat.checkSelfPermission(
            this, permission);
    return (permissionCheck == PackageManager.PERMISSION_GRANTED);
}</pre></div></li><li class="listitem">Modify the existing <code class="literal">onCreate()</code> callback to check the permission:<div class="informalexample"><pre class="programlisting">if (!checkPermission(Manifest.permission.RECEIVE_SMS)) {
    ActivityCompat.requestPermissions(this,new String[]{Manifest.permission.RECEIVE_SMS}, 0);
}</pre></div></li><li class="listitem">Add a new Java <a id="id764" class="indexterm"/>class to the project called <code class="literal">SMSBroadcastReceiver</code> using the following code:<div class="informalexample"><pre class="programlisting">public class SMSBroadcastReceiver extends BroadcastReceiver {
    final String SMS_RECEIVED = "android.provider.Telephony.SMS_RECEIVED";

    @Override
    public void onReceive(Context context, Intent intent) {
        if (SMS_RECEIVED.equals(intent.getAction())) {
            Bundle bundle = intent.getExtras();
            if (bundle != null) {
                Object[] pdus = (Object[]) bundle.get("pdus");
                String format = bundle.getString("format");
                final SmsMessage[] messages = new SmsMessage[pdus.length];
                for (int i = 0; i &lt; pdus.length; i++) {
                    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) {
                        messages[i] = SmsMessage.createFromPdu((byte[]) pdus[i], format);
                    } else {
                        messages[i] = SmsMessage.createFromPdu((byte[]) pdus[i]);
                    }
                    Toast.makeText(context, messages[0].getMessageBody(), Toast.LENGTH_SHORT).show();
                }
            }
        }
    }
}</pre></div></li><li class="listitem">You're ready to run the application on a device or emulator.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec350"/>How it works...</h2></div></div></div><p>Just like in the previous recipe on sending SMS messages, we first need to check whether the app has permission. (On pre-Android 6.0 devices, the manifest declaration will automatically provide the permission, but for Marshmallow and later, we'll need to prompt the user as we do here.)</p><p>As you can see, Broadcast receiver receives the notification of new SMS messages. We tell the system we want to receive the new SMS Received Broadcasts using this code in the Android Manifest:</p><div class="informalexample"><pre class="programlisting">&lt;receiver android:name=".SMSBroadcastReceiver"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.provider.Telephony.SMS_RECEIVED"&gt;&lt;/action&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;</pre></div><p>The notification comes in through the standard <code class="literal">onRecieve()</code> callback so we check the action using this code:</p><div class="informalexample"><pre class="programlisting">if (SMS_RECEIVED.equals(intent.getAction())) {}</pre></div><p>This is probably the most complicated line of code in this demonstration:</p><div class="informalexample"><pre class="programlisting">messages[i] = SmsMessage.createFromPdu((byte[]) pdus[i]);</pre></div><p>Basically, it calls the <a id="id765" class="indexterm"/>
<code class="literal">SmsMessage</code> library to create an SMSMessage object from the PDU. (The PDU, short for Protocol Data Unit, is the binary data format for SMS messages.) If you're not familiar with the PDU formation, you don't need to be. The <code class="literal">SmsMessage</code> library will take care of it for you and return an SMSMessage object.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip32"/>Tip</h3><p>If your app is not receiving SMS broadcast messages, an existing application may be blocking your app. You can try increasing the priority value in <code class="literal">intent-filter</code> as shown here, or disabling/uninstalling the other app(s):</p><div class="informalexample"><pre class="programlisting">&lt;intent-filter android:priority="100"&gt;
    &lt;action android:name="android.provider.Telephony.SMS_RECEIVED" /&gt;
&lt;/intent-filter&gt;</pre></div></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec351"/>There's more...</h2></div></div></div><p>This recipe demonstrates displaying SMS messages as they are received, but what about reading existing messages?</p><div class="section" title="Reading existing SMS messages"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec48"/>Reading existing SMS messages</h3></div></div></div><p>First, to read the existing<a id="id766" class="indexterm"/> messages, you'll need the following permission:</p><div class="informalexample"><pre class="programlisting">&lt;uses-permission android:name="android.permission.READ_SMS" /&gt;</pre></div><p>Here's an example of getting a cursor using the SMS content provider:</p><div class="informalexample"><pre class="programlisting">Cursor cursor = getContentResolver().query(Uri.parse("content://sms/"), null, null, null, null);
while (cursor.moveToNext()) {
    textView.append("From :" + cursor.getString(1) + " : " + cursor.getString(11)+"\n");
}</pre></div><p>At the time of writing, the SMS content provider has over 30 columns. Here are the first 12, which are the most useful (remember, the column count starts at zero):</p><p>0. <code class="literal">_id</code></p><p>1. <code class="literal">thread_id</code></p><p>2. <code class="literal">address</code></p><p>3. <code class="literal">person</code></p><p>4. <code class="literal">date</code></p><p>5. <code class="literal">protocol</code></p><p>6. <code class="literal">read</code></p><p>7. <code class="literal">status</code></p><p>8. <code class="literal">type</code></p><p>9. <code class="literal">reply_path_present</code></p><p>10. <code class="literal">subject</code></p><p>11. <code class="literal">body</code></p><p>Keep in mind, the content <a id="id767" class="indexterm"/>provider is not part of the public API and can change without notification.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec352"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Developer Docs: SmsManager</strong></span><a id="id768" class="indexterm"/> at <a class="ulink" href="https://developer.android.com/reference/android/telephony/SmsManager.html">https://developer.android.com/reference/android/telephony/SmsManager.html</a></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>PDU (Protocol Data Unit)</strong></span><a id="id769" class="indexterm"/> at <a class="ulink" href="https://en.wikipedia.org/wiki/Protocol_data_unit">https://en.wikipedia.org/wiki/Protocol_data_unit</a></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Developer Docs: Telephony.Sms.Intents</strong></span><a id="id770" class="indexterm"/> at <a class="ulink" href="https://developer.android.com/reference/android/provider/Telephony.Sms.Intents.html">https://developer.android.com/reference/android/provider/Telephony.Sms.Intents.html</a></li></ul></div></div></div>
<div class="section" title="Displaying a web page in your application"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec96"/>Displaying a web page in your application</h1></div></div></div><p>When you want to <a id="id771" class="indexterm"/>display HTML content on a web page, you <a id="id772" class="indexterm"/>have two choices: call the default browser or display them within your app. If you just want to call the default browser, use an Intent as follows:</p><div class="informalexample"><pre class="programlisting">Uri uri = Uri.parse("https://www.packtpub.com/");
Intent intent = new Intent(Intent.ACTION_VIEW, uri);
startActivity(intent);</pre></div><p>If you need to display<a id="id773" class="indexterm"/> the content within your own application, you <a id="id774" class="indexterm"/>can use the <code class="literal">WebView</code>. This recipe will show how to display a web page in your application, as can be seen in this screenshot:</p><div class="mediaobject"><img src="graphics/B05057_12_1.jpg" alt="Displaying a web page in your application"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec353"/>Getting ready</h2></div></div></div><p>Create a new project in Android Studio and call it <code class="literal">WebView</code>. Use the default <span class="strong"><strong>Phone &amp; Tablet </strong></span>option and select <span class="strong"><strong>Empty Activity</strong></span> when prompted for <span class="strong"><strong>Activity Type</strong></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec354"/>How to do it...</h2></div></div></div><p>We're going to create the <code class="literal">WebView</code> through code so we won't be modifying the layout. We'll start by opening the Android Manifest and following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the following permission:<div class="informalexample"><pre class="programlisting">&lt;uses-permission android:name="android.permission.INTERNET"/&gt;</pre></div></li><li class="listitem">Modify the existing <code class="literal">onCreate()</code> to include the following code:<div class="informalexample"><pre class="programlisting">WebView webview = new WebView(this);
setContentView(webview);
webview.loadUrl("https://www.packtpub.com/");</pre></div></li><li class="listitem">You're ready to run the application on a device or emulator.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec355"/>How it works...</h2></div></div></div><p>We create a <a id="id775" class="indexterm"/>
<code class="literal">WebView</code> to use as our layout and load our webpage<a id="id776" class="indexterm"/> with <code class="literal">loadUrl()</code>. The preceding code works, but at this level, it is very basic and only displays the first page. If you click on any links, the default browser will handle the request.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec356"/>There's more...</h2></div></div></div><p>What if you want full web browsing functionality so any link they click on still loads in your <code class="literal">WebView</code>? Create a <code class="literal">WebViewClient</code> as shown in this code:</p><div class="informalexample"><pre class="programlisting">webview.setWebViewClient(new WebViewClient());</pre></div><div class="section" title="Controlling page navigation"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec49"/>Controlling page navigation</h3></div></div></div><p>If you want more<a id="id777" class="indexterm"/> control over the page navigation, such as only allowing links within your own website, you can create your own <code class="literal">WebViewClient</code> class and override the <code class="literal">shouldOverrideUrlLoading()</code> callback, as shown here:</p><div class="informalexample"><pre class="programlisting">private class mWebViewClient extends WebViewClient {
    @Override
    public boolean shouldOverrideUrlLoading(WebView view, String url) {
        if (Uri.parse(url).getHost().equals("www.packtpub.com")) {
            return false;  //Don't override since it's the same //host
        } else {
            return true; //Stop the navigation since it's a //different site
        }
    }
}</pre></div></div><div class="section" title="How to enable JavaScript"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec50"/>How to enable JavaScript</h3></div></div></div><p>There are many other <a id="id778" class="indexterm"/>changes we can customize through <code class="literal">WebSettings</code> of <code class="literal">WebView</code>. If you want to enable JavaScript, get <code class="literal">WebSettings</code> of <code class="literal">WebView</code> and call <code class="literal">setJavaScriptEnabled()</code>, as shown:</p><div class="informalexample"><pre class="programlisting">WebSettings webSettings = webview.getSettings();
webSettings.setJavaScriptEnabled(true);</pre></div></div><div class="section" title="Enable built-in zoom"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec51"/>Enable built-in zoom</h3></div></div></div><p>Another<a id="id779" class="indexterm"/> <code class="literal">webSetting</code> option is <code class="literal">setBuiltInZoomControls()</code>. Continuing from the preceding code, just add:</p><div class="informalexample"><pre class="programlisting">webSettings.setBuiltInZoomControls(true);</pre></div><p>Check the <code class="literal">webSetting</code> link in the next section for a large list of additional options.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec357"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Developer Docs: WebView</strong></span><a id="id780" class="indexterm"/> at <a class="ulink" href="https://developer.android.com/reference/android/webkit/WebView.html">https://developer.android.com/reference/android/webkit/WebView.html</a></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Developer Docs: WebSettings</strong></span> <a id="id781" class="indexterm"/>at <a class="ulink" href="https://developer.android.com/reference/android/webkit/WebSettings.html">https://developer.android.com/reference/android/webkit/WebSettings.html</a></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Developer Docs: android.webkit</strong></span><a id="id782" class="indexterm"/> at <a class="ulink" href="https://developer.android.com/reference/android/webkit/package-summary.html">https://developer.android.com/reference/android/webkit/package-summary.html</a></li></ul></div></div></div>
<div class="section" title="Checking online status and connection type"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec97"/>Checking online status and connection type</h1></div></div></div><p>This is a simple recipe, but <a id="id783" class="indexterm"/>one that is very common and will probably be included in<a id="id784" class="indexterm"/> every Internet application you build: checking online status. While checking online status, we can also check the connection type: WIFI or MOBILE.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec358"/>Getting ready</h2></div></div></div><p>Create a new project in Android Studio and call it <code class="literal">isOnline</code>. Use the default <span class="strong"><strong>Phone &amp; Tablet </strong></span>option and select <span class="strong"><strong>Empty Activity</strong></span> when prompted for <span class="strong"><strong>Activity Type</strong></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec359"/>How to do it...</h2></div></div></div><p>First, we need to add the<a id="id785" class="indexterm"/> necessary permissions to access the network. Then, we'll <a id="id786" class="indexterm"/>create a simple layout with a <code class="literal">Button</code> and <code class="literal">TextView</code>. To get started, open the Android Manifest and follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the following permissions:<div class="informalexample"><pre class="programlisting">&lt;uses-permission android:name="android.permission.INTERNET"/&gt;
&lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" /&gt;</pre></div></li><li class="listitem">Open the <code class="literal">activity_main.xml</code> file and replace the existing <code class="literal">TextView</code> with the following views:<div class="informalexample"><pre class="programlisting">&lt;TextView
    android:id="@+id/textView"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="" /&gt;
&lt;Button
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="Check"
    android:layout_centerInParent="true"
    android:onClick="checkStatus"/&gt;</pre></div></li><li class="listitem">Add this method to report if connected:<div class="informalexample"><pre class="programlisting">private boolean isOnline() {
    ConnectivityManager connectivityManager = (ConnectivityManager)getSystemService(Context.CONNECTIVITY_SERVICE);
    NetworkInfo networkInfo = connectivityManager.getActiveNetworkInfo();
    return (networkInfo != null &amp;&amp; networkInfo.isConnected());
}</pre></div></li><li class="listitem">Add the following method to handle the button click:<div class="informalexample"><pre class="programlisting">public void checkStatus(View view) {
    TextView textView = (TextView)findViewById(R.id.textView);
    if (isOnline()) {
        ConnectivityManager connectivityManager = (ConnectivityManager)getSystemService(Context.CONNECTIVITY_SERVICE);
        NetworkInfo networkInfo = connectivityManager.getActiveNetworkInfo();
        textView.setText(networkInfo.getTypeName());
    } else {
        textView.setText("Offline");
    }
}</pre></div></li><li class="listitem">You're ready to run the application on a device or emulator.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec360"/>How it works...</h2></div></div></div><p>We created the <code class="literal">isOnline()</code> method to make it easy to reuse this code.</p><p>To check the status, we <a id="id787" class="indexterm"/>get an instance of <code class="literal">ConnectivityManager</code> to read <a id="id788" class="indexterm"/>the <code class="literal">NetworkInfo</code> state. If it reports we are connected, we get the name of the active network by calling <code class="literal">getType()</code>, which returns one of the following constants:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">TYPE_MOBILE</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">TYPE_WIFI</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">TYPE_WIMAX</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">TYPE_ETHERNET</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">TYPE_BLUETOOTH</code></li></ul></div><p>Also, see the <code class="literal">ConnectivityManager</code> link later for additional constants. For display purposes, we call <code class="literal">getTypeName()</code>. We could call <code class="literal">getType()</code> to get a numeric constant instead.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec361"/>There's more...</h2></div></div></div><p>Let's look at some additional constants of <code class="literal">ConnectivityManager</code>.</p><div class="section" title="Monitoring network state changes"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec52"/>Monitoring network state changes</h3></div></div></div><p>If your application needs<a id="id789" class="indexterm"/> to respond to changes in the network status, take a look at the <code class="literal">CONNECTIVITY_ACTION</code> in <code class="literal">ConnectivityManager</code>. You need to create a broadcast receiver, and then register for the event. Here's an example of how to include the action in the receiver's intent filter through the Android Manifest:</p><div class="informalexample"><pre class="programlisting">&lt;receiver android:name="com.vcs.timetrac.VCSBroadcastReceiver"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="android.net.conn.CONNECTIVITY_CHANGE" /&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;</pre></div><p>Be careful using the Android manifest as it will notify your app every time the network state changes, even if your app isn't being used. This can cause unnecessary drain on the battery. If your app only needs to respond to network changes while the user is actually using your app, create the <a id="id790" class="indexterm"/>listeners in the code instead.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec362"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Developer Docs: ConnectivityManager</strong></span><a id="id791" class="indexterm"/> at <a class="ulink" href="https://developer.android.com/reference/android/net/ConnectivityManager.html">https://developer.android.com/reference/android/net/ConnectivityManager.html</a></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Developer Docs: NetworkInfo</strong></span> <a id="id792" class="indexterm"/>at <a class="ulink" href="https://developer.android.com/reference/android/net/NetworkInfo.html">https://developer.android.com/reference/android/net/NetworkInfo.html</a></li></ul></div></div></div>
<div class="section" title="Getting started with Volley for Internet requests"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec98"/>Getting started with Volley for Internet requests</h1></div></div></div><p>Android includes multiple libraries for Internet queries, including the Apache <code class="literal">HttpClient</code> and <code class="literal">HttpURLConnection</code>. The Apache <code class="literal">HttpClient</code> was the recommended library before Android 2.3 Gingerbread (API 9). Android 2.3 Gingerbread (API 9) saw many improvements to the <code class="literal">HttpURLConnection</code> library and it became the recommended library, and still <a id="id793" class="indexterm"/>remains so today. With the release of Android 6.0, the Apache <code class="literal">HttpClient</code> has been removed completely from the SDK, leaving the <code class="literal">HttpURLConnection</code> library as the recommended replacement.</p><p>Though the <code class="literal">HttpURLConnection</code> library still works and has its uses, there are drawbacks: it's not the easiest library to use if you are new to writing web requests and it requires a lot of repetitive overhead code. Fortunately, we have a new option from <span class="emphasis"><em>Ficus Kirkpatrick</em></span>, a Google Developer from the Google Play group. He released a library called Volley, which provides a simplified wrapper. (It uses the <code class="literal">HttpURLConnection</code> library, by default, and can also be used with other libraries.)</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note20"/>Note</h3><p>You can see his Google I/O presentation<a id="id794" class="indexterm"/> here:</p><p>
<a class="ulink" href="https://www.youtube.com/watch?v=yhv8l9F44qo">https://www.youtube.com/watch?v=yhv8l9F44qo</a>
</p></div></div><p>Several reasons to use Volley over <code class="literal">HttpURLConnection</code> include the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Thread pool (defaults to four threads)</li><li class="listitem" style="list-style-type: disc">Transparent disk cache</li><li class="listitem" style="list-style-type: disc">Queue priority settings</li></ul></div><p>There are additional benefits, but these three alone make it worth learning about Volley. A fourth benefit, which if you've ever used <code class="literal">HttpURLConnection</code> will become apparent, is the lack of boilerplate code. Instead of having to write a bunch of standard <code class="literal">try</code>/<code class="literal">catch</code> code around many of your calls, the library will handle the checks internally, allowing you to focus more on the specific task at hand.</p><p>Volley has built-in support for the following<a id="id795" class="indexterm"/> request types:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">String</li><li class="listitem" style="list-style-type: disc">JSON</li><li class="listitem" style="list-style-type: disc">Image</li><li class="listitem" style="list-style-type: disc">Custom</li></ul></div><p>While Volley excels at<a id="id796" class="indexterm"/> multiple small request calls (such as when scrolling through a <code class="literal">ListView</code>), it is not good at large file downloads as the returned objects are parsed in memory. For larger file downloads, take a look at the <code class="literal">DownloadManager</code> (see the link at the end of the recipe). Also, for the same reason, it's not a solution for streaming content; for that, refer to <code class="literal">HttpURLConnection</code>.</p><p>Since Volley is currently not in the Android SDK, we need to download the code and add it to our project. This recipe will walk you through the steps of adding Volley to your application project and making a simple request.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec363"/>Getting ready</h2></div></div></div><p>Before creating your new project, download the Volley project files hosted on the <span class="strong"><strong>Android Open Source Project</strong></span> (<span class="strong"><strong>AOSP</strong></span>)<a id="id797" class="indexterm"/> website using the following Git command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>git clone https://android.googlesource.com/platform/frameworks/volley</strong></span>
</pre></div><p>If you are unfamiliar with Git, see the Git (software) link at the end of this recipe for additional information and help finding a Git client for your platform. Git<a id="id798" class="indexterm"/> is a <span class="strong"><strong>Version Control Software</strong></span> (<span class="strong"><strong>VCS</strong></span>)<a id="id799" class="indexterm"/> used on many platforms. (Once installed, you can also integrate Git VCS in Android Studio.)</p><p>Create a new project in Android Studio and call it <code class="literal">SetupVolley</code>. Use the default <span class="strong"><strong>Phone &amp; Tablet </strong></span>option and select <span class="strong"><strong>Empty Activity</strong></span> when prompted for <span class="strong"><strong>Activity Type</strong></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec364"/>How to do it...</h2></div></div></div><p>Before starting these steps, make sure you've downloaded the Volley project as described previously. We'll start the steps below by adding Volley to our project to make a simple Internet call. We'll use a single button in our layout to initiate the request and a <code class="literal">TextView</code> to display the results. Here are the steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the Android<a id="id800" class="indexterm"/> Manifest and add the following permission:<div class="informalexample"><pre class="programlisting">&lt;uses-permission android:name="android.permission.INTERNET"/&gt;</pre></div></li><li class="listitem">Import the <code class="literal">Volley</code> module by going to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New</strong></span> | <span class="strong"><strong>Import Module</strong></span> (see the following screenshot) and follow the wizard.<div class="mediaobject"><img src="graphics/B05057_12_2.jpg" alt="How to do it..."/></div></li><li class="listitem">On the second page<a id="id801" class="indexterm"/> of the <span class="strong"><strong>New Module</strong></span> Import Wizard (see the following screenshot), you need to specify the location of the Volley files and assign the <span class="strong"><strong>Module name</strong></span>. This is the name we'll need in the next step:<div class="mediaobject"><img src="graphics/B05057_12_3.jpg" alt="How to do it..."/></div></li><li class="listitem">Under the <code class="literal">Gradle Scripts</code> section, open the <code class="literal">build.gradle (Module: app)</code> file. See the following screenshot:<div class="mediaobject"><img src="graphics/B05057_12_4.jpg" alt="How to do it..."/></div></li><li class="listitem">Add/verify the <a id="id802" class="indexterm"/>following statement in the <code class="literal">dependencies</code> section:<div class="informalexample"><pre class="programlisting">compile project(":Volley")</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note21"/>Note</h3><p>The value in parenthesis needs to match the Module name you specified in the previous step.</p></div></div></li><li class="listitem">Under <code class="literal">Gradle Scripts</code>, open the <code class="literal">settings.gradle</code> file and verify the contents as follows:<div class="informalexample"><pre class="programlisting">include ':app', ':Volley'</pre></div></li><li class="listitem">Open the <code class="literal">activity_main.xml</code> file and replace the existing <code class="literal">TextView</code> with the following <code class="literal">TextView</code> and <code class="literal">Button</code> elements:<div class="informalexample"><pre class="programlisting">&lt;TextView
    android:id="@+id/textView"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:layout_alignParentTop="true"
    android:layout_alignParentLeft="true"
    android:layout_above="@+id/button" /&gt;
&lt;Button
    android:id="@+id/button"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="Request"
    android:layout_alignParentBottom="true"
    android:layout_centerHorizontal="true"
    android:onClick="sendRequest"/&gt;</pre></div></li><li class="listitem">Add<a id="id803" class="indexterm"/> the <code class="literal">sendRequest()</code> method called by the button click:<div class="informalexample"><pre class="programlisting">public void sendRequest(View view) {
    final TextView textView = (TextView)findViewById(R.id.textView);
    RequestQueue queue = Volley.newRequestQueue(this);
    String url ="https://www.packtpub.com/";
    StringRequest stringRequest = new StringRequest(Request.Method.GET, url,new Response.Listener&lt;String&gt;() {
        @Override
        public void onResponse(String response) {
            textView.setText(response.substring(0,500));
        }
    }, new Response.ErrorListener() {
        @Override
        public void onErrorResponse(VolleyError error) {
            textView.setText("onErrorResponse(): "+ error.getMessage());
        }
    });
    queue.add(stringRequest);
}</pre></div></li><li class="listitem">You're ready to run the application on a device or emulator.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec365"/>How it works...</h2></div></div></div><p>It's probably helpful to understand that in Volley, Internet transactions are called <span class="emphasis"><em>requests</em></span>. To execute a request, add it to the queue. To make this happen, we first create an instance of a Volley <code class="literal">RequestQueue</code>, and then create a <code class="literal">StringRequest</code> and add it to the queue. A <code class="literal">StringRequest</code> is just what it sounds like; we are requesting a string response.</p><p>For this recipe, we just call the Packt Publishing website and get the page as a string response. Since this is just for illustration, we only display the first 500 characters.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec366"/>There's more...</h2></div></div></div><p>Now that you have<a id="id804" class="indexterm"/> Volley properly set up and making Internet requests, this recipe will be the building block for the Volley recipes that follow.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec367"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Volley</strong></span>: Git at <a id="id805" class="indexterm"/>Google at <a class="ulink" href="https://android.googlesource.com/platform/frameworks/volley">https://android.googlesource.com/platform/frameworks/volley</a></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Git</strong></span> (software): Wikipedia, the<a id="id806" class="indexterm"/> free encyclopedia at <a class="ulink" href="https://en.wikipedia.org/wiki/Git_(software)">https://en.wikipedia.org/wiki/Git_(software)</a></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Developer Docs: DownloadManager</strong></span> <a id="id807" class="indexterm"/>at <a class="ulink" href="http://developer.android.com/reference/android/app/DownloadManager.html">http://developer.android.com/reference/android/app/DownloadManager.html</a></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Developer Docs: HttpURLConnection</strong></span> <a id="id808" class="indexterm"/>at <a class="ulink" href="https://developer.android.com/reference/java/net/HttpURLConnection.html">https://developer.android.com/reference/java/net/HttpURLConnection.html</a></li></ul></div></div></div>
<div class="section" title="Canceling a Volley request"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec99"/>Canceling a Volley request</h1></div></div></div><p>In the previous recipe, we<a id="id809" class="indexterm"/> demonstrated how to add a request to the Volley queue. What happens if you no longer need the response? This could happen if the user is scrolling through a <code class="literal">ListView</code> and you're updating the <code class="literal">ListItems</code> by fetching information from the Web. It would be wasteful of bandwidth, power, and CPU cycles to allow the requests to complete knowing you are just going to discard the response.</p><p>If you were using the <code class="literal">HTTPURLConnection</code> library, you would need to track all requests and cancel them manually. This recipe will show you how easy it is to cancel the request in Volley.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec368"/>Getting ready</h2></div></div></div><p>If you have not already completed the previous recipe, <span class="emphasis"><em>Getting started with Volley for Internet requests</em></span>, you will need to follow steps 1-5 to add the Volley module to your application.</p><p>Create a new project in Android Studio and call it <code class="literal">CancelVolleyRequest</code>. Use the default <span class="strong"><strong>Phone &amp; Tablet </strong></span>option and select <span class="strong"><strong>Empty Activity</strong></span> when prompted for <span class="strong"><strong>Activity Type</strong></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec369"/>How to do it...</h2></div></div></div><p>If you have not already added the <a id="id810" class="indexterm"/>Volley module to your application, review the previous section. With Volley added to your project, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">activity_main.xml</code> and replace the existing <code class="literal">TextView</code> with the following XML:<div class="informalexample"><pre class="programlisting">&lt;TextView
    android:id="@+id/textView"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:layout_alignParentTop="true"
    android:layout_alignParentLeft="true"
    android:layout_above="@+id/button" /&gt;
&lt;Button
    android:id="@+id/button"
    android:layout_width="100dp"
    android:layout_height="wrap_content"
    android:text="Request"
    android:layout_centerInParent="true"
    android:onClick="sendRequest"/&gt;
&lt;Button
    android:id="@+id/buttonClose"
    android:layout_width="100dp"
    android:layout_height="wrap_content"
    android:layout_below="@+id/button"
    android:layout_centerHorizontal="true"
    android:text="Close"
    android:onClick="close"/&gt;</pre></div></li><li class="listitem">Open <code class="literal">MainActivity.java</code> and add the following global variable:<div class="informalexample"><pre class="programlisting">RequestQueue mRequestQueue;</pre></div></li><li class="listitem">Edit the existing <code class="literal">onCreate()</code> to initialize the <code class="literal">RequestQueue</code>:<div class="informalexample"><pre class="programlisting">mRequestQueue = Volley.newRequestQueue(this);</pre></div></li><li class="listitem">Add the following <code class="literal">sendRequest()</code> method (note that this is similar to the <code class="literal">sendRequest()</code> method<a id="id811" class="indexterm"/> from the previous recipe with several changes):<div class="informalexample"><pre class="programlisting">public void sendRequest(View view) {
    final TextView textView = (TextView)findViewById(R.id.textView);

    String url ="https://www.packtpub.com/";
    StringRequest stringRequest = new StringRequest(Request.Method.GET, url,new Response.Listener&lt;String&gt;() {
        @Override
        public void onResponse(String response) {
            textView.setText(response.substring(0,500));
        }
    }, new Response.ErrorListener() {
        @Override
        public void onErrorResponse(VolleyError error) {
            textView.setText("onErrorResponse(): "+ error.getMessage());
        }
    });
    stringRequest.setTag(this);
    mRequestQueue.add(stringRequest);
    finish();
}</pre></div></li><li class="listitem">Add the <span class="strong"><strong>Close</strong></span> button's <code class="literal">onClick</code> method:<div class="informalexample"><pre class="programlisting">public void close(View view){
    finish();
}</pre></div></li><li class="listitem">Create the following override for the <code class="literal">onStop()</code> callback:<div class="informalexample"><pre class="programlisting">@Override
protected void onStop() {
    super.onStop();
    mRequestQueue.cancelAll(this);
}</pre></div></li><li class="listitem">You're ready to run the application on a device or emulator.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec370"/>How it works...</h2></div></div></div><p>To cancel the requests, we can call the <code class="literal">RequestQueue</code> <code class="literal">cancelAll()</code> method and pass in our tag. In this example, we used the activity, <code class="literal">this</code>, as our tag, but we could use any object as our tag. This allows<a id="id812" class="indexterm"/> you to create whatever grouping you might need for your requests.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec371"/>There's more...</h2></div></div></div><p>We're not just demonstrating how easy it is to cancel requests, we're also demonstrating a defensive programming tactic. By ensuring all our requests are canceled, we won't have to add code to check for a null activity in our responses, since Volley guarantees that we will not receive <span class="emphasis"><em>any</em></span> responses from a request after it has been canceled.</p></div></div>
<div class="section" title="Using Volley to request a JSON response"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec100"/>Using Volley to request a JSON response</h1></div></div></div><p>Since JavaScript Object <a id="id813" class="indexterm"/>Notation (JSON) is probably the <a id="id814" class="indexterm"/>most common data-interchange format, you'll likely find yourself needing to call a JSON web service. (If you are unfamiliar with JSON, review the link at the end of this recipe.) This recipe will demonstrate how to make a JSON Request using Volley.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec372"/>Getting ready</h2></div></div></div><p>Create a new project in Android Studio and call it <code class="literal">JSONRequest</code>. Use the default <span class="strong"><strong>Phone &amp; Tablet </strong></span>option and select <span class="strong"><strong>Empty Activity</strong></span> when prompted for <span class="strong"><strong>Activity Type</strong></span>.</p><p>This recipe will be using the Volley setup as described in <span class="emphasis"><em>Getting started with Volley for Internet requests</em></span>. Follow steps 1-5 to add Volley to your new project.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec373"/>How to do it...</h2></div></div></div><p>With Volley added to your project as described previously, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">activity_main.xml</code> and replace the existing <code class="literal">TextView</code> with the following XML:<div class="informalexample"><pre class="programlisting">&lt;TextView
    android:id="@+id/textView"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:layout_alignParentTop="true"
    android:layout_alignParentLeft="true"
    android:layout_above="@+id/button" /&gt;
&lt;Button
    android:id="@+id/button"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="Request"
    android:layout_alignParentBottom="true"
    android:layout_centerHorizontal="true"
    android:onClick="sendRequest"/&gt;</pre></div></li><li class="listitem">Add the following <code class="literal">sendRequest()</code> method:<div class="informalexample"><pre class="programlisting">public void sendRequest(View view) {
    final TextView textView = (TextView)findViewById(R.id.textView);
    RequestQueue queue = Volley.newRequestQueue(this);
    String url ="&lt;json service&gt;";
    //"http://ip.jsontest.com/"

    JsonObjectRequest jsonObjectRequest = new JsonObjectRequest(Request.Method.GET, url, null, new Response.Listener&lt;JSONObject&gt;() {
        @Override
        public void onResponse(JSONObject response) {
            textView.setText(response.toString());
        }
    }, new Response.ErrorListener() {
        @Override
        public void onErrorResponse(VolleyError error) {
            textView.setText("onErrorResponse(): "+ error.getMessage());
        }
    });
    queue.add(jsonObjectRequest);
}</pre></div></li><li class="listitem">Replace<a id="id815" class="indexterm"/> the <code class="literal">url</code> string in the code before<a id="id816" class="indexterm"/> you run this application.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec374"/>How it works...</h2></div></div></div><p>Requesting a JSON response using <code class="literal">JsonObjectRequest()</code> basically works the same as the <code class="literal">StringRequest()</code>. The difference is the response, which is returned as a <code class="literal">JSONObject</code>.</p><p>To run this code, you will need to replace the <code class="literal">url</code> parameter with your web service URL. If you don't have a web service to test against, you can try a link from the <a id="id817" class="indexterm"/>JSON Test website (<a class="ulink" href="http://www.jsontest.com/">http://www.jsontest.com/</a>).</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec375"/>There's more...</h2></div></div></div><p>In the preceding example, we requested a <code class="literal">JSONObject</code> with <code class="literal">JsonObjectRequest</code>. We can also request a <code class="literal">JSONARray</code> with <code class="literal">JsonArrayRequest</code>.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec376"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Visit the JSON<a id="id818" class="indexterm"/> web page at <a class="ulink" href="http://json.org/">http://json.org/</a></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Developer Docs: org.json (JSON Libraries)</strong></span><a id="id819" class="indexterm"/> at <a class="ulink" href="http://developer.android.com/reference/org/json/package-summary.html">http://developer.android.com/reference/org/json/package-summary.html</a></li></ul></div></div></div>
<div class="section" title="Using Volley to request an image"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec101"/>Using Volley to request an image</h1></div></div></div><p>Once you make<a id="id820" class="indexterm"/> your JSON Requests as demonstrated in <a id="id821" class="indexterm"/>the previous recipe, the next most likely call you'll be making is to get an image. This recipe will demonstrate how to request an image to update an <code class="literal">ImageView</code>.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec377"/>Getting ready</h2></div></div></div><p>Create a new project in Android Studio and call it <code class="literal">ImageRequest</code>. Use the default <span class="strong"><strong>Phone &amp; Tablet </strong></span>option and select <span class="strong"><strong>Empty Activity</strong></span> when prompted for <span class="strong"><strong>Activity Type</strong></span>.</p><p>This recipe will be using the setup described in the <span class="emphasis"><em>Getting started with Volley for Internet requests</em></span> recipe. Follow steps 1-5 to add Volley to your new project.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec378"/>How to do it...</h2></div></div></div><p>With Volley added to your project, as described previously, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">activity_main.xml</code> and replace the existing <code class="literal">TextView</code> with the following XML:<div class="informalexample"><pre class="programlisting">&lt;ImageView
    android:id="@+id/imageView"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:layout_centerInParent="true" /&gt;
&lt;Button
    android:id="@+id/button"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="Request"
    android:layout_alignParentBottom="true"
    android:layout_centerHorizontal="true"
    android:onClick="sendRequest"/&gt;</pre></div></li><li class="listitem">Add the<a id="id822" class="indexterm"/> following <code class="literal">sendRequest()</code> method:<div class="informalexample"><pre class="programlisting">public void sendRequest(View view) {
    final ImageView imageView = (ImageView)findViewById(R.id.imageView);
    RequestQueue queue = Volley.newRequestQueue(this);
    String url ="http://www.android.com/static/img/logos-2x/android-wordmark-8EC047.png";
    ImageRequest imageRequest = new ImageRequest(url,
        new Response.Listener&lt;Bitmap&gt;() {
            @Override
            public void onResponse(Bitmap bitmap) {
                imageView.setImageBitmap(bitmap);
            }
        }, 0, 0, ImageView.ScaleType.CENTER, null,
        new Response.ErrorListener() {
            @Override
            public void onErrorResponse(VolleyError error) {
                error.printStackTrace();
            }
        });
    queue.add(imageRequest);
}</pre></div></li><li class="listitem">Run the application on a device or emulator.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec379"/>How it works...</h2></div></div></div><p>This recipe, basically, works<a id="id823" class="indexterm"/> in the same way as the previous two Volley requests. In this recipe, we pass a URL to an image and load the <code class="literal">ImageView</code> in the response.</p><p>We've now covered the three basic request types: String, JSON, and Image.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec380"/>There's more...</h2></div></div></div><p>Though the basic types will probably cover most of your needs, Volley is extensible and you can also implement a custom response by extending <code class="literal">Request&lt;T&gt;</code>.</p><p>This recipe demonstrates a problem with our example code. If you change the orientation of the device, you'll see the image flicker as the activity is recreated.</p><div class="section" title="Creating a Volley singleton"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec53"/>Creating a Volley singleton</h3></div></div></div><p>It's recommended to instantiate <a id="id824" class="indexterm"/>Volley as a singleton. (An alternative approach would be to create the queue in the application class.) To create a singleton class in Android Studio, go to <span class="strong"><strong>New</strong></span> | <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Singleton</strong></span> and give it a class name, such as <code class="literal">VolleySingleton</code>.</p><p>Move the code to create the request queue to the singleton class. If you create a method as follows:</p><div class="informalexample"><pre class="programlisting">public &lt;T&gt; void addToRequestQueue(Request&lt;T&gt; req) {
    mRequestQueue.add(req);
}</pre></div><p>Then, you can add to your queue from anywhere using the following code:</p><div class="informalexample"><pre class="programlisting">VolleySingleton.getInstance(this).addToRequestQueue(stringRequest);</pre></div><p>The key to making this work properly is to always use the Application Context (not an Activity or Broadcast Receiver Context) by calling <code class="literal">getApplicationContext()</code> on the context passed in.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec381"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Developer Docs: Application (class)</strong></span> <a id="id825" class="indexterm"/>at <a class="ulink" href="https://developer.android.com/reference/android/app/Application.html">https://developer.android.com/reference/android/app/Application.html</a></li></ul></div></div></div>
<div class="section" title="Using Volley's NetworkImageView and ImageLoader"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec102"/>Using Volley's NetworkImageView and ImageLoader</h1></div></div></div><p>Our last recipe on Volley <a id="id826" class="indexterm"/>will not be a request per se, but a replacement for the<a id="id827" class="indexterm"/> <code class="literal">ImageView</code>. Requesting an image to populate an <code class="literal">ImageView</code> is such a common task; Volley combines the functionality to a new view called <code class="literal">NetworkImageView</code>. This recipe will demonstrate how to use a <code class="literal">NetworkImageView</code>.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec382"/>Getting ready</h2></div></div></div><p>Create a new project in Android Studio and call it <code class="literal">NetworkImageView</code>. Use the default <span class="strong"><strong>Phone &amp; Tablet </strong></span>option and select <span class="strong"><strong>Empty Activity</strong></span> when prompted for <span class="strong"><strong>Activity Type</strong></span>.</p><p>This recipe will be using the setup described in the <span class="emphasis"><em>Getting started with Volley for Internet requests</em></span> recipe. Follow Steps 1-5 to add Volley to your new project.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec383"/>How to do it...</h2></div></div></div><p>With Volley added to<a id="id828" class="indexterm"/> your project as described previously, follow<a id="id829" class="indexterm"/> these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">activity_main.xml</code> and replace the existing <code class="literal">TextView</code> with the following XML:<div class="informalexample"><pre class="programlisting">&lt;com.android.volley.toolbox.NetworkImageView
    android:id="@+id/networkImageView"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:layout_centerInParent="true" /&gt;</pre></div></li><li class="listitem">Add the following code to the existing <code class="literal">onCreate()</code> callback:<div class="informalexample"><pre class="programlisting">NetworkImageView networkImageView = (NetworkImageView)findViewById(R.id.networkImageView);
String url="http://www.android.com/static/img/logos-2x/android-wordmark-8EC047.png";
RequestQueue queue = Volley.newRequestQueue(this);
ImageLoader imageLoader = new ImageLoader(queue,new ImageLoader.ImageCache() {
        private final LruCache&lt;String, Bitmap&gt;cache = new LruCache&lt;String, Bitmap&gt;(20);

        @Override
        public Bitmap getBitmap(String url) {
            return cache.get(url);
        }

        @Override
        public void putBitmap(String url, Bitmap bitmap) {
            cache.put(url, bitmap);
        }
    });
networkImageView.setImageUrl(url,imageLoader);</pre></div></li><li class="listitem">You're ready to run the application on a device or emulator.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec384"/>How it works...</h2></div></div></div><p>This example is very different from the previous Volley examples. Instead of creating a request object, we create an <code class="literal">ImageLoader</code>. The <code class="literal">ImageLoader</code> class allows us to override the default caching behavior, such as the number of bitmaps or how the size is calculated. (We could change the cache to be based on total memory instead of image count.) See the <code class="literal">LruCache</code> link later for more information.</p><p>With the <code class="literal">ImageLoader</code> created, you can assign the image URL to the <code class="literal">NetworkImageView</code> and pass the <code class="literal">ImageLoader</code> as the second parameter.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec385"/>There's more...</h2></div></div></div><p>As we mentioned in the previous recipe, the problem with our Volley example is that we create the queue in the activity. This is most noticeable with images, but regardless, it's recommended to create a Volley singleton. See the <span class="emphasis"><em>Create a Volley singleton</em></span> section in the previous recipe for more information.</p><p>If you create a singleton as described in the previous recipe, you can also move the <code class="literal">ImageLoader</code> code to the singleton and expose the <code class="literal">ImageLoader</code> like this:</p><div class="informalexample"><pre class="programlisting">public ImageLoader getImageLoader() {
    return mImageLoader;
}</pre></div><p>With the singleton created, this recipe could be coded as follows:</p><div class="informalexample"><pre class="programlisting">NetworkImageView networkImageView = (NetworkImageView)findViewById(R.id.networkImageView);
String url="http://www.android.com/static/img/logos-2x/android-wordmark-8EC047.png";
networkImageView.setImageUrl(url, VolleySingleton.getInstance(this).getImageLoader());</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec386"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Developer Docs: LruCache</strong></span><a id="id830" class="indexterm"/> at <a class="ulink" href="https://developer.android.com/reference/android/util/LruCache.html">https://developer.android.com/reference/android/util/LruCache.html</a></li></ul></div></div></div></body></html>