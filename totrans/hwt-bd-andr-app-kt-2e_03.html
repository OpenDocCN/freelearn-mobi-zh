<html><head></head><body>
		<div id="_idContainer096" class="IMG---Figure">
			<h1 id="_idParaDest-53" class="chapter number"><a id="_idTextAnchor163"/><a id="_idTextAnchor164"/><a id="_idTextAnchor165"/><a id="_idTextAnchor166"/><a id="_idTextAnchor167"/>3</h1>
			<h1 id="_idParaDest-54"><a id="_idTextAnchor168"/>Developing the UI with Fragments</h1>
			<p><a id="_idTextAnchor169"/>This chapter covers fragments and the fragment lifecycle. It demonstrates how to use them to build efficient and dynamic layouts that respond to different screen sizes and configurations and allow you to divide your UI into different sections. By the end of this chapter, you will be able to create static and dynamic fragments, pass data to and from fragments and activities, and use the Jetpack <strong class="source inline">Navigation</strong> component to detail how fragments <span class="No-Break">fit together.</span></p>
			<p><a id="_idTextAnchor170"/>In the previous chapter, we explored the Android activity lifecycle and looked into how it is used in apps to navigate between screens. We also analyzed various types of launch modes, which defined how transitioning between screens happened. In this chapter, you’ll explore fragments. A fragment is a section, portion, or, as the name implies, fragment of an <span class="No-Break">Android activity.</span></p>
			<p>Throughout the chapter, you’ll learn how to use fragments, see how they can exist in more than one activity, and discover how multiple fragments can be used in one activity. You’ll start by adding simple fragments to an activity and then progress to learning about the difference between static and <span class="No-Break">dynamic fragments.</span></p>
			<p>Fragments can be used to simplify creating layouts for Android tablets that have larger form factors using dual-pane layouts. For example, if you have an average-sized phone screen and you want to include a list of news stories, you might only have enough space to display <span class="No-Break">the list.</span></p>
			<p>If you viewed the same list of stories on a tablet, you’d have more space available so you could display the same list and also a story itself to the right of the list. Each of these different areas of the screen can use a fragment. You can then use the same fragment on both the phone and the tablet. You benefit from reusing and simplifying the layouts and don’t have to repeat creating <span class="No-Break">similar functionality.</span></p>
			<p>Once you’ve explored how fragments are created and used, you’ll then learn how to organize your user journeys with fragments. You’ll apply some established practices for using fragments in this way. Finally, you’ll learn how to simplify fragment use by creating a navigation graph with the Android Jetpack <strong class="source inline">Navigation</strong> component, which allows you to specify linking fragments together <span class="No-Break">with destinations.</span></p>
			<p>We will cover the following topics in <span class="No-Break">this chapter:</span></p>
			<ul>
				<li>The <span class="No-Break">fragment lifecycle</span></li>
				<li>Static fragments and <span class="No-Break">dual-pane layouts</span></li>
				<li><span class="No-Break">Dynamic fragments</span></li>
				<li><span class="No-Break">Jetpack Navigation</span></li>
			</ul>
			<h1 id="_idParaDest-55"><a id="_idTextAnchor171"/><a id="_idTextAnchor172"/>Technical requirements</h1>
			<p>The complete code for all the exercises and the activity in this chapter is available on GitHub <span class="No-Break">at </span><a href="https://packt.link/KmdBZ"><span class="No-Break">https://packt.link/KmdBZ</span></a></p>
			<h1 id="_idParaDest-56"><a id="_idTextAnchor173"/>The fragment lifecycle</h1>
			<p>A fragment is a <a id="_idIndexMarker185"/>component with its own lifecycle. Understanding the fragment lifecycle is critical as it provides callbacks at certain stages of fragment creation, the running state, and destruction that configure the initialization, display, and cleanup. Fragments run in an activity, and a fragment’s lifecycle is bound to the <span class="No-Break">activity’s lifecycle.</span></p>
			<p>In many ways, the fragment lifecycle is very similar to the activity lifecycle, and at first glance, it appears that the former replicates the latter. There are as many callbacks that are the same or similar in the fragment lifecycle as there are in the activity lifecycle, such as <span class="No-Break"><strong class="source inline">onCreate(savedInstanceState: Bundle?)</strong></span><span class="No-Break">.</span></p>
			<p>The fragment lifecycle is tied to the activity lifecycle, so wherever fragments are used, the fragment callbacks are interleaved with the <span class="No-Break">activity callbacks.</span></p>
			<p>The same steps are gone through to initialize the fragment and prepare for it to be displayed to the user before being available for the user to interact with. The same teardown steps that an activity goes through happen to the fragment as well when the app is backgrounded, hidden, and exited. Fragments, like activities, have to extend/derive from a parent <strong class="source inline">Fragment</strong> class, and you can choose which callbacks to override depending on your use case. The lifecycle is displayed in the following diagram, followed by more detail about <span class="No-Break">each function.</span></p>
			<div>
				<div id="_idContainer073" class="IMG---Figure">
					<img src="image/B19411_03_01.jpg" alt="Figure 3.1 – Fragment lifecycle"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.1 – Fragment lifecycle</p>
			<p>Let’s now explore <a id="_idIndexMarker186"/>these callbacks, the order they appear in, and what <span class="No-Break">they do.</span><a id="_idTextAnchor174"/><a id="_idTextAnchor175"/></p>
			<h2 id="_idParaDest-57"><a id="_idTextAnchor176"/>onAttach</h2>
			<p><strong class="source inline">override fun onAttach(context: Context)</strong>: This is the point where your fragment<a id="_idIndexMarker187"/> becomes <a id="_idIndexMarker188"/>linked to the activity it is used in. It allows you to reference the activity, although at this stage neither the fragment nor the activity has been <span class="No-Break">fully create<a id="_idTextAnchor177"/><a id="_idTextAnchor178"/>d.</span></p>
			<h2 id="_idParaDest-58"><a id="_idTextAnchor179"/>onCreate</h2>
			<p><strong class="source inline">override fun onCreate(savedInstanceState: Bundle?)</strong>: This is where you do <a id="_idIndexMarker189"/>any<a id="_idIndexMarker190"/> initialization of your fragment. This is not where you set the layout of your fragment, as at this stage, there is no UI available to display and no <strong class="source inline">setContentView</strong> available as there is in an activity. As is the same in the activity’s <strong class="source inline">onCreate()</strong> function, you can use the <strong class="source inline">savedInstanceState</strong> parameter to restore the state of the fragment when it is <span class="No-Break">being re-crea<a id="_idTextAnchor180"/><a id="_idTextAnchor181"/>ted.</span></p>
			<h2 id="_idParaDest-59"><a id="_idTextAnchor182"/>onCreateView</h2>
			<p><strong class="source inline">override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View?</strong>: Now, this<a id="_idIndexMarker191"/> is where<a id="_idIndexMarker192"/> you get to create the layout of your fragment. The most important thing to remember here is that instead of setting the layout (as is the case with an activity), the fragment will actually return the layout <strong class="source inline">View?</strong> from <span class="No-Break">this function.</span></p>
			<p>The views you have in your layout are available to refer to here, but there are a few caveats. You need to create the layout before you can reference the views contained within it, which is why it’s preferred to do view manipulation <span class="No-Break">in </span><span class="No-Break"><strong class="source inline">onViewCr<a id="_idTextAnchor183"/><a id="_idTextAnchor184"/>eated</strong></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-60"><a id="_idTextAnchor185"/>onViewCreated</h2>
			<p><strong class="source inline">override fun onViewCreated(view View, savedInstanceState: Bundle?)</strong>: This <a id="_idIndexMarker193"/>callback<a id="_idIndexMarker194"/> is the one in between your fragment being fully created and being visible to the user. It’s where you’ll typically set up your views and add any functionality and interactivity to these views. This might be adding an <strong class="source inline">OnClickListener</strong> to a button and then calling<a id="_idIndexMarker195"/> a function <a id="_idIndexMarker196"/>when <span class="No-Break">it’<a id="_idTextAnchor186"/><a id="_idTextAnchor187"/>s clicked.</span></p>
			<h2 id="_idParaDest-61"><a id="_idTextAnchor188"/>onActivityCreated</h2>
			<p><strong class="source inline">override fun onActivityCreated(context: Context)</strong>: This is called immediately<a id="_idIndexMarker197"/> after<a id="_idIndexMarker198"/> the activity’s <strong class="source inline">onCreate</strong> has been run. Most of the initialization of the view state of the fragment will have been done, and this is the place to do the final setup <a id="_idTextAnchor189"/><a id="_idTextAnchor190"/><span class="No-Break">if required.</span></p>
			<h2 id="_idParaDest-62"><a id="_idTextAnchor191"/>onStart</h2>
			<p><strong class="source inline">override fun onStart()</strong>: This <a id="_idIndexMarker199"/>is called when the fragment is <a id="_idIndexMarker200"/>about to become visible to the user but is not yet available for the user to <a id="_idTextAnchor192"/><a id="_idTextAnchor193"/><span class="No-Break">interact with.</span></p>
			<h2 id="_idParaDest-63"><a id="_idTextAnchor194"/>onResume</h2>
			<p><strong class="source inline">override fun onResume()</strong>: At the <a id="_idIndexMarker201"/>end of this call, your <a id="_idIndexMarker202"/>fragment is available for the user to interact with. Normally, there is minimal setup or functionality defined in this callback, as when the app goes into the background and then comes back into the foreground, this callback will always <span class="No-Break">be called.</span></p>
			<p>Therefore, you don’t want to have to needlessly repeat the setup of the fragment when this could be done with a callback that isn’t run when the fragment <a id="_idTextAnchor195"/><a id="_idTextAnchor196"/><span class="No-Break">becomes visible.</span></p>
			<h2 id="_idParaDest-64"><a id="_idTextAnchor197"/>onPause</h2>
			<p><strong class="source inline">override fun onPause()</strong>: Like its <a id="_idIndexMarker203"/>counterpart, <strong class="source inline">onPause()</strong> in <a id="_idIndexMarker204"/>an activity signals that your app is going into the background or has been partially covered by something else on the screen. Use this to save any changes to the<a id="_idTextAnchor198"/><a id="_idTextAnchor199"/> <span class="No-Break">fragment’s state.</span></p>
			<h2 id="_idParaDest-65"><a id="_idTextAnchor200"/>onStop</h2>
			<p><strong class="source inline">override fun onStop()</strong>: The <a id="_idIndexMarker205"/>fragment is no longer visible<a id="_idIndexMarker206"/> at the end of this call and goes <a id="_idTextAnchor201"/><a id="_idTextAnchor202"/>into <span class="No-Break">the background.</span></p>
			<h2 id="_idParaDest-66"><a id="_idTextAnchor203"/>onDestroyView</h2>
			<p><strong class="source inline">override fun onDestroyView()</strong>: This is usually called for doing a final cleanup before the <a id="_idIndexMarker207"/>fragment <a id="_idIndexMarker208"/>is destroyed. You should use this callback if it is necessary to clean up any resources. If the fragment is pushed to the back stack and retained, then it can also be called without destroying the fragment. On completion of this callback, the fragment’s l<a id="_idTextAnchor204"/><a id="_idTextAnchor205"/>ayout view <span class="No-Break">is removed.</span></p>
			<h2 id="_idParaDest-67"><a id="_idTextAnchor206"/>onDestroy</h2>
			<p><strong class="source inline">override fun onDestroy()</strong>: The <a id="_idIndexMarker209"/>fragment is being <a id="_idIndexMarker210"/>destroyed. This can occur because the app is being killed or because this fragment is being repla<a id="_idTextAnchor207"/><a id="_idTextAnchor208"/>ced by <span class="No-Break">another fragment.</span></p>
			<h2 id="_idParaDest-68"><a id="_idTextAnchor209"/>onDetach</h2>
			<p><strong class="source inline">override fun onDetach()</strong>: This is<a id="_idIndexMarker211"/> called when the<a id="_idIndexMarker212"/> fragment has been detached from <span class="No-Break">its activity.</span></p>
			<p>There are more fragment callbacks, but these are the ones you will use for the majority of cases. Typically, you’ll only use a subset of these callbacks: <strong class="source inline">onAttach()</strong> to associate an activity with the fragment, <strong class="source inline">onCreate</strong> to initialize the fragment, <strong class="source inline">onCreateView</strong> to set the layout, and then <strong class="source inline">onViewCreated</strong>/<strong class="source inline">onActivityCreated</strong> to do further initialization, and perhaps <strong class="source inline">onPause()</strong> to do <span class="No-Break">some cleanup.</span></p>
			<p class="callout heading">Note</p>
			<p class="callout">Further details of these callbacks can be found in the official documentation <span class="No-Break">at </span><a href=""><span class="No-Break">https://developer.android.com/guide/fragments</span></a><span class="No-Break">.</span></p>
			<p>Now that we’ve gone through some of the theory of the fragment lifecycle and how it is affected by the <a id="_idIndexMarker213"/>host <a id="_idIndexMarker214"/>activity’s lifecycle, let’s see those ca<a id="_idTextAnchor210"/><a id="_idTextAnchor211"/>llbacks being run <span class="No-Break">in action.</span></p>
			<h2 id="_idParaDest-69"><a id="_idTextAnchor212"/>Exercise 3.01 – adding a basic fragment and the fragment lifecycle</h2>
			<p>In this exercise, we <a id="_idIndexMarker215"/>will create and add a basic fragment to an app. The aim of this exercise is to gain familiarity with how fragments are added to an activity and the layout they display. To do this, you will create a new blank fragment with a layout in Android Studio. You will then add the fragment to the activity and verify the fragment has been added by the display of the fragment layout. Perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Create an application in Android Studio with an empty activity called <strong class="source inline">Fragment </strong><span class="No-Break"><strong class="source inline">Lifecycle</strong></span><span class="No-Break"> .</span></li>
				<li>Once the application has been built, create a new fragment by going to <strong class="bold">File</strong> | <strong class="bold">New</strong> | <strong class="bold">Fragment (Blank)</strong>. You just want to create a plain vanilla fragment at this stage, so you use the <strong class="source inline">Fragment (Blank)</strong> option. When you’ve selected this option, you <a id="_idIndexMarker216"/>will be presented with th<a id="_idTextAnchor213"/>e screen shown in <span class="No-Break"><em class="italic">Figure 3</em></span><span class="No-Break"><em class="italic">.2</em></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer074" class="IMG---Figure">
					<img src="image/B19411_03_02.jpg" alt="Figure 3.2 – Creating a new fragment"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.2 – Creating a new fragment</p>
			<ol>
				<li value="3">Rename the fragment <strong class="source inline">MainFragment</strong> and the layout <strong class="source inline">fragment_main</strong>. Then, press <strong class="bold">Finish</strong> and the <strong class="source inline">Fragment</strong> class will be created and opened. There are two functions that have been added: <strong class="source inline">onCreate</strong>, which initializes the fragment, and <strong class="source inline">onCreateView</strong> (displayed in the following code snippet), which inflates the layout file used for <span class="No-Break">the fragment:</span><pre class="source code">
    override fun onCreateView(
        inflater: LayoutInflater, container:
            ViewGroup?,
        savedInstanceState: Bundle?
    ): View? {
        // Inflate the layout for this fragment
        return inflater.inflate(
            R.layout.fragment_main, container, false)
    }</pre></li>
				<li>When you<a id="_idIndexMarker217"/> open up the <strong class="source inline">fragment_main.xml</strong> layout file, you’ll see the <span class="No-Break">following code:</span><pre class="source code">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;FrameLayout
xmlns:android=
  "http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".MainFragment"&gt;
    &lt;!-- TODO: Update blank fragment layout --&gt;
    &lt;TextView
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:text="@string/hello_blank_fragment" /&gt;
&lt;/FrameLayout&gt;</pre></li>
			</ol>
			<p>A simple layout has been added with a <strong class="source inline">TextView</strong> and some example text using <strong class="source inline">@string/hello_blank_fragment</strong>. This string resource has the text <strong class="source inline">hello blank fragment</strong>. As <strong class="source inline">layout_width</strong> and <strong class="source inline">layout_height</strong> are specified as <strong class="source inline">match_parent</strong>, <strong class="source inline">TextView</strong> will occupy the whole of the screen. The text itself, however, will be added at the top left of the view with the <span class="No-Break">default position.</span></p>
			<ol>
				<li value="5">Add the <strong class="source inline">android:gravity="center"</strong> attribute and value to the <strong class="source inline">TextView</strong> so that <a id="_idIndexMarker218"/>the text appears in the center of <span class="No-Break">the screen:</span><pre class="source code">
    &lt;TextView
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:gravity="center"
        android:text="@string/hello_blank_fragment" /&gt;</pre></li>
			</ol>
			<p>If you run up the UI now, you’ll see the <strong class="bold">Hello<a id="_idTextAnchor214"/> World!</strong> display in <span class="No-Break"><em class="italic">Figure 3</em></span><span class="No-Break"><em class="italic">.3</em></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer075" class="IMG---Figure">
					<img src="image/B19411_03_03.jpg" alt="Figure 3.3 – Initial app layout display without a fragment added"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.3 – Initial app layout display without a fragment added</p>
			<p>Well, you can see<a id="_idIndexMarker219"/> some <strong class="bold">Hello World!</strong> text, but not the <strong class="source inline">hello blank fragment</strong> text you might have been expecting. The fragment and its layout do not automatically get added to an activity when you create it. This is a <span class="No-Break">manual process.</span></p>
			<ol>
				<li value="6">Open the <strong class="source inline">activity_main.xml</strong> file and replace the contents with <span class="No-Break">the following:</span><pre class="source code">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;androidx.constraintlayout.widget.ConstraintLayout
    xmlns:android=
      "http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context="com.example.fragmentlifecycle
        .MainActivity"&gt;
    &lt;fragment
        android:id="@+id/main_fragment"
        android:name="com.example.fragmentlifecycle
            .MainFragment"
        android:layout_width="match_parent"
        android:layout_height="match_parent" /&gt;
&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</pre></li>
			</ol>
			<p>Just as there are <a id="_idIndexMarker220"/>view declarations you can add to layouts in XML, there is also a <strong class="source inline">fragment</strong> element. You’ve added the fragment to <strong class="source inline">ConstraintLayout</strong> with constraints of <strong class="source inline">match_parent</strong> for <strong class="source inline">layout_width</strong> and <strong class="source inline">layout_height</strong> so it will occupy the whole of <span class="No-Break">the screen.</span></p>
			<p>The most important <strong class="source inline">xml</strong> attribute to examine here is <strong class="source inline">android:name</strong>. It’s here where you specify the fully qualified name of the package and the <strong class="source inline">Fragment</strong> class that you are going to add to the layout with <strong class="source inline">com.example.fragmentlifecycle.MainFragment</strong>. Now run the app, and you will see <a id="_idTextAnchor215"/>the output shown in <span class="No-Break"><em class="italic">Figure 3</em></span><span class="No-Break"><em class="italic">.4</em></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer076" class="IMG---Figure">
					<img src="image/B19411_03_04.jpg" alt="Figure 3.4 – App layout display with a fragment added"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.4 – App layout display with a fragment added</p>
			<p>This proves that<a id="_idIndexMarker221"/> your fragment with the text <strong class="source inline">Hello blank fragment</strong> has been added to the activity and the layout you defined is being displayed. Next, you’ll examine the callback methods between the activity and the fragment and how <span class="No-Break">this happened.</span></p>
			<ol>
				<li value="7">Open up the <strong class="source inline">MainFragment</strong> class and add a <strong class="source inline">TAG</strong> constant to the companion object with the value <strong class="source inline">"MainFragment"</strong> to identify <span class="No-Break">the class.</span><pre class="source code">
private const val TAG = "MainFragment"</pre></li>
			</ol>
			<p>Then, add/update the functions with appropriate <span class="No-Break">log statements.</span></p>
			<p>You will need to add the imports for the <strong class="source inline">Log</strong> statement and <strong class="source inline">context</strong> to the imports at the top of the class. The following code snippet is truncated. Follow the link<a id="_idIndexMarker222"/> shown to see the full code block you need <span class="No-Break">to use:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">MainFragment.kt</p>
			<pre class="source code">
import android.content.Context
import android.util.Log
    override fun onAttach(context: Context) {
        super.onAttach(context)
        Log.d(TAG, "onAttach: ")
    }
    override fun onCreate(savedInstanceState: Bundle?)
    {
        super.onCreate(savedInstanceState)
        Log.d(TAG,"onCreate: ")
        arguments?.let {
            param1 = it.getString(ARG_PARAM1)
            param2 = it.getString(ARG_PARAM2)
        }
    }
    override fun onCreateView(
        inflater: LayoutInflater, container:
            ViewGroup?, savedInstanceState: Bundle?
    ): View? {
        Log.d(TAG,"onCreateView: ")
        // Inflate the layout for this fragment
        return inflater.inflate(
            R.layout.fragment_main, container, false)
    }</pre>
			<p>You can find the complete code for this step <span class="No-Break">at </span><a href="https://packt.link/XcOJ4"><span class="No-Break">https://packt.link/XcOJ4</span></a><span class="No-Break">.</span></p>
			<p>You will <a id="_idIndexMarker223"/>need to add <strong class="source inline">Log.d(TAG, "onCreateView")</strong> to the <strong class="source inline">onCreateView</strong> callback and <strong class="source inline">Log.d(TAG, "onCreate")</strong> to the <strong class="source inline">onCreate</strong> callback that already exist, and then override the <strong class="source inline">onAttach</strong> function, adding <strong class="source inline">Log.d(TAG, "onAttach")</strong>, and <strong class="source inline">onViewCreated</strong>, adding <span class="No-Break"><strong class="source inline">Log.d(TAG, "onViewCreated")</strong></span><span class="No-Break">.</span></p>
			<ol>
				<li value="8">Next, open the <strong class="source inline">MainActivity</strong> class and add a companion object with a <strong class="source inline">TAG</strong> constant with the value <strong class="source inline">"MainActivity"</strong>. Then add the <strong class="source inline">Log</strong> import to the top of the class and then the common <strong class="source inline">onStart</strong> and <strong class="source inline">onResume</strong> callback methods, as shown in the following <span class="No-Break">code snippet.</span><pre class="source code">
    import android.util.Log
    override fun onCreate(savedInstanceState: Bundle?)
    {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        Log.d(TAG, "onCreate")
    }
    override fun onStart() {
        super.onStart()
        Log.d(TAG, "onStart")
    }
    override fun onResume() {
        super.onResume()
        Log.d(TAG, "onResume")
    }
    companion object {
        private const val TAG = "MainActivity"
    }</pre></li>
			</ol>
			<p>You’ll see that <a id="_idIndexMarker224"/>you also have to add the <strong class="source inline">onCreate</strong> log statement, <strong class="source inline">Log.d</strong>(<strong class="source inline">TAG,</strong> <strong class="source inline">"onCreate"</strong>), as this callback was already there when you added the activity to <span class="No-Break">the project.</span></p>
			<p>You learned in <a href="B19411_02.xhtml#_idTextAnchor103"><span class="No-Break"><em class="italic">Chapter 2</em></span></a>, <em class="italic">Building User Screen Flows</em>, how to view log statements, and you are going to open the <strong class="bold">Logcat</strong> window in Android Studio to examine the logs and the order they are called in when you run <span class="No-Break">the app.</span></p>
			<p>In <a href="B19411_02.xhtml#_idTextAnchor103"><span class="No-Break"><em class="italic">Chapter 2</em></span></a>, <em class="italic">Building User Screen Flows</em>, you viewed logs from a single activity so you could see the order they were called in. Now you’ll examine the order in which the <strong class="source inline">MainActivity</strong> and <strong class="source inline">MainFragment</strong> <span class="No-Break">callbacks happen.</span></p>
			<ol>
				<li value="9">Open up the <strong class="bold">Logcat</strong> window. (Just to remind you, it can be accessed by clicking the <strong class="bold">Logcat</strong> tab at the bottom of the screen and also from the toolbar with <strong class="bold">View</strong> | <strong class="bold">Tool Windows</strong> | <strong class="bold">Logcat</strong>.) As both <strong class="source inline">MainActivity</strong> and <strong class="source inline">MainFragment</strong> start with <strong class="source inline">Main</strong>, you can type <strong class="source inline">tag:Main</strong> in the search box to filter the logs to only show statements with this text. Run the app,<a id="_idTextAnchor216"/> and you should see <span class="No-Break">the following:</span></li>
			</ol>
			<div>
				<div id="_idContainer077" class="IMG---Figure">
					<img src="image/B19411_03_05.jpg" alt="Figure 3.5 – Logcat statements shown when starting the app"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.5 – Logcat statements shown when starting the app</p>
			<p>What’s interesting here is that the first few callbacks are from the fragment. It is linked to the activity it has been placed in with the <strong class="source inline">onAttach</strong> callback. The fragment is <a id="_idIndexMarker225"/>initialized, and its view is displayed in <strong class="source inline">onCreate</strong> and <strong class="source inline">onCreateView</strong>, before another callback, <strong class="source inline">onViewCreated</strong>, is called, confirming that the fragment UI is ready to <span class="No-Break">be displayed.</span></p>
			<p>This is before the activity’s <strong class="source inline">onCreate</strong> method is called. This makes sense as the activity creates its UI based on what it contains. As this is a fragment that defines its own layout, the activity needs to know how to measure, lay out, and draw the fragment as it does in the <span class="No-Break"><strong class="source inline">onCreate</strong></span><span class="No-Break"> method.</span></p>
			<p>Then, the fragment receives confirmation that this has been done with the <strong class="source inline">onActivityCreated</strong> callback before both the fragment and activity start to display the UI in <strong class="source inline">onStart</strong>, before preparing the user to interact with it after their respective <strong class="source inline">onResume</strong> callbacks <span class="No-Break">have finished.</span></p>
			<p class="callout heading">Note</p>
			<p class="callout">The interaction between the activity and fragment lifecycles detailed previously is for cases when static fragments, which are those defined in the layout of an activity, are created. For dynamic fragments, which can be added when the activity is already running, the interaction <span class="No-Break">can differ.</span></p>
			<p>So, now that the fragment and the containing activity are shown, what happens when the app is backgrounded or closed? The callbacks are still interleaved when the fragment and activity are paused, stopped, <span class="No-Break">and finished.</span></p>
			<ol>
				<li value="10">Add the<a id="_idIndexMarker226"/> following callbacks to the <span class="No-Break"><strong class="source inline">MainFragment</strong></span><span class="No-Break"> class:</span><pre class="source code">
override fun onPause() {
    super.onPause()
    Log.d(TAG, "onPause")
}
override fun onStop() {
    super.onStop()
    Log.d(TAG, "onStop")
}
override fun onDestroyView() {
    super.onDestroyView()
    Log.d(TAG, "onDestroyView")
}
override fun onDestroy() {
    super.onDestroy()
    Log.d(TAG, "onDestroy")
}
override fun onDetach() {
    super.onDetach()
    Log.d(TAG, "onDetach")
}</pre></li>
				<li>Then, add these callbacks <span class="No-Break">to </span><span class="No-Break"><strong class="source inline">MainActivity</strong></span><span class="No-Break">:</span><pre class="source code">
override fun onPause() {
    super.onPause()
    Log.d(TAG, "onPause")
}
override fun onStop() {
    super.onStop()
    Log.d(TAG, "onStop")
}
override fun onDestroy() {
    super.onDestroy()
    Log.d(TAG, "onDestroy")
}</pre></li>
				<li>Build the app, and <a id="_idIndexMarker227"/>once it is running, you’ll see the callbacks from before starting both the fragment and activity. You can use the dustbin icon at the top left of the <strong class="source inline">Logcat</strong> window to clear the statements. Then, rotate the app a<a id="_idTextAnchor217"/>nd review the output <span class="No-Break">log statements:</span></li>
			</ol>
			<div>
				<div id="_idContainer078" class="IMG---Figure">
					<img src="image/B19411_03_06.jpg" alt="Figure 3.6 – Logcat statements shown when closing the app"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.6 – Logcat statements shown when closing the app</p>
			<p>The <strong class="source inline">onPause</strong> and <strong class="source inline">onStop</strong> statements are as you might expect in that the fragment gets notified of these callbacks first as it is contained within the activity. You can think of this as being inward to outward in that the child elements are notified before the containing parent, so the parent knows how <span class="No-Break">to respond.</span></p>
			<p>The fragment is then torn down, removed from the activity, and then destroyed with the <strong class="source inline">onDestroyView</strong>, <strong class="source inline">onDestroy</strong>, and <strong class="source inline">onDetach</strong> functions before the activity itself is destroyed after any final cleanup is done in <strong class="source inline">onDestroy</strong>. It doesn’t make sense for the activity to finish until all the component parts that make up the activity are <span class="No-Break">themselves removed.</span></p>
			<p>The full fragment lifecycle callbacks and how they relate to the activity callbacks are complicated in Android because which callbacks are applied in which situation can differ quite substantially. To view a more detailed overview, see the official documentation <span class="No-Break">at </span><a href=""><span class="No-Break">https://developer.android.com/guide/fragments</span></a><span class="No-Break">.</span></p>
			<p>For the majority of situations, you will only use the preceding fragment callbacks. This example demonstrates both how self-contained fragments are in their creation, display, and destruction, and also their interdependence with the <span class="No-Break">containing activity.</span></p>
			<p>Now that we’ve<a id="_idIndexMarker228"/> gone through a basic example of adding a fragment to an activity and examining the interaction between the fragment and the activity, let’s see a more detailed example of how <a id="_idTextAnchor218"/><a id="_idTextAnchor219"/>you add two fragments to <span class="No-Break">an activity.</span></p>
			<h2 id="_idParaDest-70"><a id="_idTextAnchor220"/>Exercise 3.02 – adding fragments statically to an activity</h2>
			<p>This exercise will<a id="_idIndexMarker229"/> demonstrate how to add two fragments to an activity with their own UI and separate functionality. You’ll create a simple counter class that increments and decrements a number and a color class that changes the color applied programmatically to some <strong class="source inline">Hello World</strong> text. Perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Create an application in Android Studio with an empty activity called <strong class="source inline">Fragment</strong> <strong class="source inline">Intro</strong>. Then, add the following strings required for the exercise in the <strong class="source inline">res</strong> | <strong class="source inline">values</strong> | <span class="No-Break"><strong class="source inline">strings.xml</strong></span><span class="No-Break"> file:</span><pre class="source code">
    &lt;string name="hello_world"&gt;Hello World&lt;/string&gt;
    &lt;string name="red_text"&gt;Red&lt;/string&gt;
    &lt;string name="green_text"&gt;Green&lt;/string&gt;
    &lt;string name="blue_text"&gt;Blue&lt;/string&gt;
    &lt;string name="zero"&gt;0&lt;/string&gt;
    &lt;string name="plus"&gt;+&lt;/string&gt;
    &lt;string name="minus"&gt;-&lt;/string&gt;
    &lt;string name="counter_text"&gt;Counter&lt;/string&gt;</pre></li>
			</ol>
			<p>These strings are used in both the counter fragment as well as the color fragment, which you will <span class="No-Break">create next.</span></p>
			<ol>
				<li value="2">Add a new blank fragment by going to <strong class="bold">File</strong> | <strong class="bold">New</strong> | <strong class="bold">Fragment (Blank)</strong> called <strong class="source inline">CounterFragment</strong> with the <strong class="source inline">fragment_counter</strong> <span class="No-Break">layout name.</span></li>
				<li>Now, make changes to the <strong class="source inline">fragment_counter.xml</strong> file. The following code is truncated for<a id="_idIndexMarker230"/> space. Follow the link shown for the full code you need <span class="No-Break">to use:</span></li>
			</ol>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">fragment_counter.xml</p>
			<pre class="source code">
&lt;TextView
    android:id="@+id/counter_text"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="@string/counter_text"
    android:paddingTop="10dp"
    android:textSize="44sp"
    app:layout_constraintEnd_toEndOf="parent"
    app:layout_constraintStart_toStartOf="parent"
    app:layout_constraintTop_toTopOf="parent"/&gt;
&lt;TextView
    android:id="@+id/counter_value"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:text="@string/zero"
    android:textSize="54sp"
    android:textStyle="bold"
    app:layout_constraintEnd_toEndOf="parent"
    app:layout_constraintStart_toStartOf="parent"
    app:layout_constraintTop_toBottomOf=
        "@id/counter_text"
    app:layout_constraintBottom_toTopOf="@id/plus"/&gt;</pre>
			<p>You can find the complete code for this step <span class="No-Break">at </span><a href="https://packt.link/ca4EK"><span class="No-Break">https://packt.link/ca4EK</span></a><span class="No-Break">.</span></p>
			<p>We are<a id="_idIndexMarker231"/> using a simple <strong class="source inline">ConstraintLayout</strong> file that has a <strong class="source inline">TextView</strong> set up for the <strong class="source inline">@+id/counter_text</strong> header and a <strong class="source inline">TextView</strong> for the value of the counter, <strong class="source inline">android:id="@+id/counter_value"</strong> (with a default of <strong class="source inline">@string/zero</strong>), which will be changed by the <strong class="source inline">android:id="@+id/plus"</strong> and <span class="No-Break"><strong class="source inline">android:id="@+id/minus"</strong></span><span class="No-Break"> buttons.</span></p>
			<p class="callout heading">Note</p>
			<p class="callout">For a simple example such as this, you are not going to set individual styles on the views with <strong class="source inline">style="@some_style"</strong> notation, which would be best practice to avoid repeating these values on <span class="No-Break">each view.</span></p>
			<ol>
				<li value="4">Now open <strong class="source inline">CounterFragment</strong> and add a property to be the counter below the class header (it is a <strong class="source inline">var</strong> so it is mutable and can <span class="No-Break">be changed):</span><pre class="source code">
var counter  = 0</pre></li>
				<li>Now open and add the following <strong class="source inline">onViewCreated</strong> function. You <a id="_idIndexMarker232"/>will also need to add the following imports to the top of <span class="No-Break">the class:</span><pre class="source code">
import android.widget.Button
import android.widget.TextView
override fun onViewCreated(view: View,
savedInstanceState: Bundle?) {
    super.onViewCreated(view, savedInstanceState)
    val counterValue =
       view.findViewById&lt;TextView&gt;(R.id.counter_value)
    view.findViewById&lt;Button&gt;(R.id.plus)
    .setOnClickListener {
        counter++
        counterValue.text = counter.toString()
    }
    view.findViewById&lt;Button&gt;(R.id.minus)
    .setOnClickListener {
        if (counter &gt; 0) {
            counter--
            counterValue.text = counter.toString()
        }
    }
}</pre></li>
			</ol>
			<p>We’ve added <strong class="source inline">onViewCreated</strong>, which is the callback run when the layout has been applied to your fragment. The <strong class="source inline">onCreateView</strong> callback, which creates the view, was run when the fragment itself <span class="No-Break">was created.</span></p>
			<p>The buttons you’ve specified in the preceding fragment have <strong class="source inline">OnClickListener</strong> set up on them to increment and decrement the value of <span class="No-Break">the </span><span class="No-Break"><strong class="source inline">counter</strong></span><span class="No-Break">.</span></p>
			<ol>
				<li value="6">Firstly, within the plus button <strong class="source inline">OnClickListener</strong>, you are incrementing the counter and setting this value on <span class="No-Break">the view:</span><pre class="source code">
counter++
counterValue.text = counter.toString()</pre></li>
				<li>Then, within the minus button <strong class="source inline">OnClickListener</strong>, it decrements the value by one but <a id="_idIndexMarker233"/>only if the value is greater than one, so no negative numbers <span class="No-Break">are set:</span><pre class="source code">
if (counter &gt; 0) {
    counter--
    counterValue.text = counter.toString()
}</pre></li>
				<li>You have not added the fragment to the <strong class="source inline">MainActivity</strong> layout. To do this, go into <strong class="source inline">activity_main.xml</strong> and replace the contents with the <span class="No-Break">following code:</span><pre class="source code">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout
xmlns:android=
  "http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    tools:context=".MainActivity"&gt;
    &lt;fragment
        android:id="@+id/counter_fragment"
        android:name="com.example.fragmentintro
            .CounterFragment"
        android:layout_width="match_parent"
        android:layout_height="match_parent"/&gt;
&lt;/LinearLayout&gt;</pre></li>
			</ol>
			<p>You are going to<a id="_idIndexMarker234"/> change the layout from <strong class="source inline">ConstraintLayout</strong> to <strong class="source inline">LinearLayout</strong> for simplicity as you can easily add one fragment above the other when you come to the next stage. You specify the fragment to be used within the <strong class="source inline">fragment</strong> XML element with the <strong class="source inline">name</strong> attribute with the fully qualified package name used for the <span class="No-Break">class: </span><span class="No-Break"><strong class="source inline">android:name="com.example.fragmentintro.CounterFragment</strong></span><span class="No-Break">.</span></p>
			<p>If you used a different package name when you created the app, then this must refer to the <strong class="source inline">CounterFragment</strong> you created. The important thing to grasp here is that you have added a fragment to your main activity layout and the fragment also has <span class="No-Break">a layout.</span></p>
			<p>This shows some of the power of using fragments as you can encapsulate the functionality of one feature of your app, complete with a layout file and fragment class, and add it to <span class="No-Break">multiple activities.</span></p>
			<p>Once you’ve done this, run the fragme<a id="_idTextAnchor221"/>nt in the virtual device as in <span class="No-Break"><em class="italic">Figure 3</em></span><span class="No-Break"><em class="italic">.7</em></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer079" class="IMG---Figure">
					<img src="image/B19411_03_07.jpg" alt="Figure 3.7 – App displaying the counter fragment"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.7 – App displaying the counter fragment</p>
			<p>You have created<a id="_idIndexMarker235"/> a simple counter. The basic functionality works as expected, incrementing and decrementing a <span class="No-Break">counter value.</span></p>
			<ol>
				<li value="9">In the next step, you are going to add another fragment to the bottom half of the screen. This demonstrates the versatility of fragments. You can have encapsulated pieces of the UI with functionality and features in different areas of <span class="No-Break">the screen.</span></li>
				<li>Now, create a new fragment using the earlier steps for creating the <strong class="source inline">CounterFragment</strong> called <strong class="source inline">ColorFragment</strong> with the <strong class="source inline">fragment_color</strong> <span class="No-Break">layout name.</span></li>
				<li>Next, open up the <strong class="source inline">fragment_color.xml</strong> file that has been created and replace the contents with the code at the following link. The following snippet is truncated – see<a id="_idIndexMarker236"/> the link for the <span class="No-Break">full code:</span><pre class="source code">
&lt;TextView
        android:id="@+id/hello_world"
        android:layout_width="wrap_content"
        android:layout_height="0dp"
        android:textSize="34sp"
        android:paddingBottom="12dp"
        android:text="@string/hello_world"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent" /&gt;
    &lt;Button
        android:id="@+id/red_button"
        android:layout_width="wrap_content"
        android:layout_height="0dp"
        android:textSize="24sp"
        android:text="@string/red_text"
app:layout_constraintEnd_toStartOf="@+id/green_button"
app:layout_constraintStart_toStartOf="parent"
app:layout_constraintTop_toBottomOf="@id/hello_world"
/&gt;</pre></li>
			</ol>
			<p>You can find the complete code for this step <span class="No-Break">at </span><a href="https://packt.link/GCYDR"><span class="No-Break">https://packt.link/GCYDR</span></a><span class="No-Break">.</span></p>
			<p>The layout adds a <strong class="source inline">TextView</strong> with three buttons. The <strong class="source inline">TextView</strong> text and the text for all the buttons are set as string <span class="No-Break">resources (</span><span class="No-Break"><strong class="source inline">@string</strong></span><span class="No-Break">).</span></p>
			<ol>
				<li value="12">Next, go<a id="_idIndexMarker237"/> into the <strong class="source inline">activity_main.xml</strong> file and add <strong class="source inline">ColorFragment</strong> below <strong class="source inline">CounterFragment</strong> <span class="No-Break">inside </span><span class="No-Break"><strong class="source inline">LinearLayout</strong></span><span class="No-Break">:</span><pre class="source code">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout
xmlns:android=
  "http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    tools:context=".MainActivity"&gt;
    &lt;fragment
        android:id="@+id/counter_fragment"
        android:name="com.example.fragmentintro
            .CounterFragment"
        android:layout_width="match_parent"
        android:layout_height="match_parent"/&gt;
    &lt;fragment
        android:id="@+id/color_fragment"
        android:name="com.example.fragmentintro
            .ColorFragment"
        android:layout_width="match_parent"
        android:layout_height="match_parent"/&gt;
&lt;/LinearLayout&gt;</pre></li>
			</ol>
			<p>When you run<a id="_idIndexMarker238"/> the app, you will see that <strong class="source inline">Co<a id="_idTextAnchor222"/>lorFragment</strong> is not visible, as in <span class="No-Break"><em class="italic">Figure 3</em></span><span class="No-Break"><em class="italic">.8</em></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer080" class="IMG---Figure">
					<img src="image/B19411_03_071.jpg" alt="Figure 3.8 – App shown without ColorFragment displayed"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.8 – App shown without ColorFragment displayed</p>
			<p>You’ve included<a id="_idIndexMarker239"/> <strong class="source inline">ColorFragment</strong> in the layout, but because <strong class="source inline">CounterFragment</strong> has its width and height set to match its parent (<strong class="source inline">android:layout_width="match_parent android:layout_height="match_parent"</strong>) and it is the first view in the layout, it takes up all <span class="No-Break">the space.</span></p>
			<p>What you need is some way to specify the proportion of the height that each fragment should occupy. The <strong class="source inline">LinearLayout</strong> orientation is set to vertical so the fragments will appear one on top of the other when <strong class="source inline">layout_height</strong> is not set <span class="No-Break">to </span><span class="No-Break"><strong class="source inline">match_parent</strong></span><span class="No-Break">.</span></p>
			<p>In order to define the proportion of this height, you need to add another attribute, <strong class="source inline">layout_weight</strong>, to each fragment in the <strong class="source inline">activity_main.xml</strong> layout file. When you use <strong class="source inline">layout_weight</strong> to determine the proportional height the fragments should occupy, you set the <strong class="source inline">layout_height</strong> value of the fragments <span class="No-Break">to </span><span class="No-Break"><strong class="source inline">0dp</strong></span><span class="No-Break">.</span></p>
			<ol>
				<li value="13">Update the <strong class="source inline">activity_main.xml</strong> layout with the following changes, setting <strong class="source inline">layout_height</strong> for both fragments to <strong class="source inline">0dp</strong> and adding the <strong class="source inline">layout_weight</strong> attributes<a id="_idIndexMarker240"/> with the <span class="No-Break">following values:</span><pre class="source code">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout
xmlns:android=
  "http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    tools:context=".MainActivity"&gt;
    &lt;fragment
        android:id="@+id/counter_fragment"
        android:name="com.example.fragmentintro
            .CounterFragment"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="2"/&gt;
    &lt;fragment
        android:id="@+id/color_fragment"
        android:name="com.example.fragmentintro
            .ColorFragment"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="1"/&gt;
&lt;/LinearLayout&gt;</pre></li>
			</ol>
			<p>These changes<a id="_idIndexMarker241"/> make <strong class="source inline">CounterFragment</strong> occupy twice the heigh<a id="_idTextAnchor223"/>t of <strong class="source inline">ColorFragment</strong>, as shown in <span class="No-Break"><em class="italic">Figure 3</em></span><span class="No-Break"><em class="italic">.9</em></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer081" class="IMG---Figure">
					<img src="image/B19411_03_08.jpg" alt="Figure 3.9 – CounterFragment with twice the amount of vertical space allocated"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.9 – CounterFragment with twice the amount of vertical space allocated</p>
			<p>You can<a id="_idIndexMarker242"/> experiment by changing the weight values to see the differences you can make to the display of <span class="No-Break">the layout.</span></p>
			<ol>
				<li value="14">At this point, pressing the <strong class="bold">RED</strong>, <strong class="bold">GREEN</strong>, and <strong class="bold">BLUE</strong> color buttons will have no effect on the <strong class="bold">Hello World</strong> text. The button actions have not been specified. The next step involves adding interactivity to the buttons to make changes to the style of the <strong class="bold">Hello </strong><span class="No-Break"><strong class="bold">World</strong></span><span class="No-Break"> text.</span></li>
				<li>Add the following <strong class="source inline">onViewCreated</strong> function in <strong class="source inline">ColorFragment</strong>, which overrides its parent to add behavior to the fragment after the layout view has been set up. You will also need to add the <strong class="source inline">TextView</strong>, <strong class="source inline">Color</strong>, and <strong class="source inline">Button</strong> imports to<a id="_idIndexMarker243"/> change the color of <span class="No-Break">the text:</span><pre class="source code">
import android.widget.Button
import android.widget.TextView
import android.graphics.Color
override fun onViewCreated(view: View,
savedInstanceState: Bundle?) {
    super.onViewCreated(view, savedInstanceState)
    val redButton =
        view.findViewById&lt;Button&gt;(R.id.red_button)
    val greenButton =
        view.findViewById&lt;Button&gt;(R.id.green_button)
    val blueButton =
        view.findViewById&lt;Button&gt;(R.id.blue_button)
    val helloWorldTextView =
        view.findViewById&lt;TextView&gt;(R.id.hello_world)
    redButton.setOnClickListener {
        helloWorldTextView.setTextColor(Color.RED)
    }
    greenButton.setOnClickListener {
        helloWorldTextView.setTextColor(Color.GREEN)
    }
    blueButton.setOnClickListener {
        helloWorldTextView.setTextColor(Color.BLUE)
    }
}</pre></li>
			</ol>
			<p>Here, you are<a id="_idIndexMarker244"/> adding an <strong class="source inline">OnClickListener</strong> to each button defined in the layout and setting the <strong class="bold">Hello World</strong> text to the <span class="No-Break">desired color.</span></p>
			<ol>
				<li value="16">Run the app and press the <strong class="bold">RED</strong>, <strong class="bold">GREEN</strong>, and <strong class="bold">BLUE</strong> buttons. You should<a id="_idTextAnchor224"/> see a similar display to the one in <span class="No-Break"><em class="italic">Figure 3</em></span><span class="No-Break"><em class="italic">.10</em></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer082" class="IMG---Figure">
					<img src="image/B19411_03_09.jpg" alt="Figure 3.10 – ColorFragment setting text color to red, green, and blue"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.10 – ColorFragment setting text color to red, green, and blue</p>
			<p>This exercise, although<a id="_idIndexMarker245"/> simple, has demonstrated some fundamental concepts of using fragments. The features of your app that the user can interact with can be developed independently and not rely on bundling two or more features into one layout and activity. This makes fragments reusable and means you can focus your attention when developing your app on adding a well-defin<a id="_idTextAnchor225"/><a id="_idTextAnchor226"/>ed UI, logic, and features into a <span class="No-Break">single fragment.</span></p>
			<h1 id="_idParaDest-71"><a id="_idTextAnchor227"/>Static fragments and dual-pane layouts</h1>
			<p>The previous<a id="_idIndexMarker246"/> exercise introduced you to static fragments, those that can be defined in the activity XML layout file. You can also create different layouts and resources for different screen sizes. This is used for deciding which resources to display depending on whether the device is a phone or <span class="No-Break">a tablet.</span></p>
			<p>The space for laying out UI elements can increase substantially with a larger size tablet. Android allows specifying different resources depending on many different form factors. The qualifier frequently used to define a tablet in the <strong class="source inline">res</strong> (resources) folder <span class="No-Break">is </span><span class="No-Break"><strong class="source inline">sw600dp</strong></span><span class="No-Break">.</span></p>
			<p>This states that if the shortest width (<strong class="source inline">sw</strong>) of the device is over 600 dp, then use these resources. This qualifier is used for 7” tablets and larger. Tablets facilitate what is known as dual-pane layouts. A pane represents a self-contained part of the user interface. If the screen is large enough, then two panes (dual-pane layouts) can be supported. This also provides the opportunity for o<a id="_idTextAnchor228"/><a id="_idTextAnchor229"/>ne pane to interact with another to <span class="No-Break">update content.</span></p>
			<h2 id="_idParaDest-72"><a id="_idTextAnchor230"/>Exercise 3.03 – dual-pane layouts with static fragments</h2>
			<p>In this exercise, you <a id="_idIndexMarker247"/>are going to create a simple app<a id="_idIndexMarker248"/> that displays a list of star signs and specific information about each star sign. It will use different displays for phones <span class="No-Break">and tablets.</span></p>
			<p>The phone will display a list and then open the selected list item’s content on another screen while the tablet will display the same list in one pane and open the list item’s content in another pane on the same screen in a <span class="No-Break">dual-pane layout.</span></p>
			<p>In order to do this, you have to create another layout that will only be used for 7” tablets and above. Perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Firstly, create a new Android Studio project with an <strong class="source inline">Empty Activity</strong> called <strong class="source inline">Dual </strong><span class="No-Break"><strong class="source inline">Pane Layouts</strong></span><span class="No-Break">.</span></li>
				<li>Then, making sure the Android view is selected in the project view on the left-hand side, go to <strong class="bold">File</strong> | <strong class="bold">New</strong> | <strong class="bold">Android Resource File</strong> and fill in the following fields of the dialog (you need to select <strong class="bold">Smallest Screen Width</strong> in the dialog’s left-hand pane – once you ha<a id="_idTextAnchor231"/>ve selected it, the option changes to <span class="No-Break"><strong class="bold">Screen Width</strong></span><span class="No-Break">):</span></li>
			</ol>
			<div>
				<div id="_idContainer083" class="IMG---Figure">
					<img src="image/B19411_03_10.jpg" alt="Figure 3.11 – Device Variations View"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.11 – Device Variations View</p>
			<ol>
				<li value="3">This creates<a id="_idIndexMarker249"/> a <a id="_idIndexMarker250"/>new folder in the <strong class="source inline">main</strong> | <strong class="source inline">res</strong> folder named <strong class="source inline">'layou<a id="_idTextAnchor232"/>t-sw600dp'</strong> with the <strong class="source inline">activity_main.xml</strong> layout <span class="No-Break">file </span><span class="No-Break">added.</span></li>
			</ol>
			<p>At the moment, it is a duplicate of the <strong class="source inline">activity_main.xml</strong> file added when you created the app, but you will change it to customize the screen display <span class="No-Break">for tablets.</span></p>
			<p>In order to demonstrate the use of dual-pane layouts, you are going to create a list of star signs so that, when a list item is selected, it will display some basic information about the <span class="No-Break">star sign.</span></p>
			<ol>
				<li value="4">Go to the top toolbar and select <strong class="bold">File</strong> | <strong class="bold">New</strong> | <strong class="bold">Fragment</strong> | <strong class="bold">Fragment (Blank)</strong>. Call <span class="No-Break">it </span><span class="No-Break"><strong class="source inline">ListFragment</strong></span><span class="No-Break">.</span></li>
			</ol>
			<p>For this exercise, you need to update the <strong class="source inline">strings.xml</strong> and <strong class="source inline">themes.xml</strong> files, adding <a id="_idIndexMarker251"/>the<a id="_idIndexMarker252"/> <span class="No-Break">following entries:</span></p>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">strings.xml</p>
			<pre class="source code">
    &lt;string name="star_signs"&gt;Star Signs&lt;/string&gt;
    &lt;string name="symbol"&gt;Symbol: %s&lt;/string&gt;
    &lt;string name="date_range"&gt;Date Range: %s&lt;/string&gt;
    &lt;string name="aquarius"&gt;Aquarius&lt;/string&gt;
    &lt;string name="pisces"&gt;Pisces&lt;/string&gt;
    &lt;string name="aries"&gt;Aries&lt;/string&gt;
    &lt;string name="taurus"&gt;Taurus&lt;/string&gt;
    &lt;string name="gemini"&gt;Gemini&lt;/string&gt;
    &lt;string name="cancer"&gt;Cancer&lt;/string&gt;
    &lt;string name="leo"&gt;Leo&lt;/string&gt;
    &lt;string name="virgo"&gt;Virgo&lt;/string&gt;
    &lt;string name="libra"&gt;Libra&lt;/string&gt;
    &lt;string name="scorpio"&gt;Scorpio&lt;/string&gt;
    &lt;string name="sagittarius"&gt;Sagittarius&lt;/string&gt;
    &lt;string name="capricorn"&gt;Capricorn&lt;/string&gt;
    &lt;string name="unknown_star_sign"&gt;Unknown Star Sign
    &lt;/string&gt;</pre>
			<p class="SC---Heading" lang="en-US" xml:lang="en-US">themes.xml</p>
			<pre class="source code">
    &lt;style name="StarSignTextView"
    parent="Base.TextAppearance.AppCompat.Large" &gt;
        &lt;item name="android:padding"&gt;18dp&lt;/item&gt;
    &lt;/style&gt;
    &lt;style name="StarSignTextViewHeader"
    parent="Base.TextAppearance.AppCompat.Display1" &gt;
        &lt;item name="android:padding"&gt;18dp&lt;/item&gt;
    &lt;/style&gt;</pre>
			<ol>
				<li value="5">Open the <strong class="source inline">main</strong> | <strong class="source inline">res</strong> | <strong class="source inline">layout</strong> | <strong class="source inline">fragment_list.xml</strong> file and replace the default <a id="_idIndexMarker253"/>contents <a id="_idIndexMarker254"/>with <span class="No-Break">the following:</span><pre class="source code">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;ScrollView
xmlns:android=
  "http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    tools:context=".ListFragment"&gt;
    &lt;LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical"&gt;
        &lt;TextView
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:gravity="center"
            android:textSize="24sp"
            android:textStyle="bold"
            style="@style/StarSignTextView"
            android:text="@string/star_signs" /&gt;
        &lt;View
            android:layout_width="match_parent"
            android:layout_height="1dp"
            android:background="?android:attr/
                dividerVertical" /&gt;
        &lt;TextView
            android:id="@+id/aquarius"
            style="@style/StarSignTextView"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="@string/aquarius" /&gt;
    &lt;/LinearLayout&gt;
&lt;/ScrollView&gt;</pre></li>
			</ol>
			<p>You will see<a id="_idIndexMarker255"/> that <a id="_idIndexMarker256"/>the first <strong class="source inline">xml</strong> element is a <strong class="source inline">ScrollView</strong>. A <strong class="source inline">ScrollView</strong> is a <strong class="source inline">ViewGroup</strong> that allows the contents to scroll, and as you will be adding 12 star signs into the <strong class="source inline">LinearLayout</strong> it contains, this is likely to occupy more vertical space than is available on <span class="No-Break">the screen.</span></p>
			<p>Adding <strong class="source inline">ScrollView</strong> prevents the contents from being cut off vertically when there is no more room to display them and scrolls the layout. A <strong class="source inline">ScrollView</strong> can only contain one child view. Here, it’s a <strong class="source inline">LinearLayout</strong>, and as the contents will be displayed vertically, the orientation is set to vertical (<strong class="source inline">android:orientation="vertical"</strong>). Below the first title <strong class="source inline">TextView</strong>, you have added a divider <strong class="source inline">View</strong> and a <strong class="source inline">TextView</strong> for the first star <span class="No-Break">sign, Aquarius.</span></p>
			<ol>
				<li value="6">Add the other 11 star signs with the same format, adding the divider first and then the <strong class="source inline">TextView</strong>. The name of the string resource and the <strong class="source inline">id</strong> value should be the same for each <strong class="source inline">TextView</strong>. The <a id="_idIndexMarker257"/>names of the star<a id="_idIndexMarker258"/> signs you will create a view from are specified in the <span class="No-Break"><strong class="source inline">strings.xml</strong></span><span class="No-Break"> file.</span></li>
			</ol>
			<p class="callout heading">Note</p>
			<p class="callout">The technique used to lay out a list is fine for an example, but in a real-world app, you would create a <strong class="source inline">RecyclerView</strong> dedicated to displaying lists that can scroll, with the data bound to the list by an adapter. You will cover this in a <span class="No-Break">later chapter.</span></p>
			<ol>
				<li value="7">Next, create <strong class="source inline">StarSignListener</strong> above the <strong class="source inline">MainActivity</strong> class header and make <strong class="source inline">MainActivity</strong> implement it by adding <span class="No-Break">the following:</span><pre class="source code">
interface StarSignListener {
    fun onSelected(id: Int)
}
class MainActivity : AppCompatActivity(),
StarSignListener {
    ...
    override fun onSelected(id: Int) {
        TODO("not implemented yet")
    }
}</pre></li>
			</ol>
			<p>This is how the fragments will communicate back to the activity when a user selects a star sign from <strong class="source inline">ListFragment</strong> and logic will be added depending on whether a dual pane is available <span class="No-Break">or not.</span></p>
			<ol>
				<li value="8">Once you’ve created the layout file, go into the <strong class="source inline">ListFragment</strong> class and update it with the following contents, keeping <strong class="source inline">onCreateView()</strong> in place. You can see in the fragment in the <strong class="source inline">onAttach()</strong> callback you are stating that the activity implements the <strong class="source inline">StarSignListener</strong> interface so it can be notified<a id="_idIndexMarker259"/> when<a id="_idIndexMarker260"/> the user clicks an item in the list. Add the import for the <strong class="source inline">Context</strong> required for <strong class="source inline">onAttach</strong> with the other imports at the top of <span class="No-Break">the file:</span><pre class="source code">
import android.content.Context
class ListFragment : Fragment(), View.OnClickListener
{
    // TODO: Rename and change types of parameters
    private var param1: String? = null
    private var param2: String? = null
    private lateinit var starSignListener:
        StarSignListener
    override fun onAttach(context: Context) {
        super.onAttach(context)
        if (context is StarSignListener) {
            starSignListener = context
        } else {
            throw RuntimeException("Must implement
                StarSignListener")
        }
}
      override fun onCreateView(...)
      override fun onViewCreated(view: View,
      savedInstanceState:Bundle?) {
        super.onViewCreated(view, savedInstanceState)
        val starSigns = listOf&lt;View&gt;(
            view.findViewById(R.id.aquarius),
            view.findViewById(R.id.pisces),
            view.findViewById(R.id.aries),
            view.findViewById(R.id.taurus),
            view.findViewById(R.id.gemini),
            view.findViewById(R.id.cancer),
            view.findViewById(R.id.leo),
            view.findViewById(R.id.virgo),
            view.findViewById(R.id.libra),
            view.findViewById(R.id.scorpio),
            view.findViewById(R.id.sagittarius),
            view.findViewById(R.id.capricorn)
        )
        starSigns.forEach {
            it.setOnClickListener(this)
        }
    }
    override fun onClick(v: View?) {
        v?.let { starSign -&gt;
            starSignListener.onSelected(starSign.id)
        }
    }
}</pre></li>
			</ol>
			<p>The remaining<a id="_idIndexMarker261"/> callbacks<a id="_idIndexMarker262"/> are similar to what you have seen in the previous exercises. You create the fragment view with <strong class="source inline">onCreateView</strong>. You set up the buttons with an <strong class="source inline">OnClickListener</strong> in <strong class="source inline">onViewCreated</strong> and then you handle clicks <span class="No-Break">in </span><span class="No-Break"><strong class="source inline">onClick</strong></span><span class="No-Break">.</span></p>
			<p>The <strong class="source inline">listOf</strong> syntax in <strong class="source inline">onViewCreated</strong> is a way of creating a <strong class="source inline">readonly</strong> list with the specified elements, which in this case are your star sign <strong class="source inline">TextView</strong> instances. Then, in the following code, you loop over these <strong class="source inline">TextViews</strong>, setting the <strong class="source inline">OnClickListener</strong> for each of the individual <strong class="source inline">TextViews</strong> by iterating over the <strong class="source inline">TextView</strong> list with the <strong class="source inline">forEach</strong> statement. The <strong class="source inline">it</strong> syntax here refers to the element of the list that is being operated on, which will be one of the 12 star <span class="No-Break">sign </span><span class="No-Break"><strong class="source inline">TextViews</strong></span><span class="No-Break">.</span></p>
			<ol>
				<li value="9">Finally, the <strong class="source inline">onClick</strong> statement communicates back to the activity through <strong class="source inline">StarSignListener</strong> when one of the star signs in the list has <span class="No-Break">been clicked:</span><pre class="source code">
v?.let { starSign -&gt;
    starSignListener.onSelected(starSign.id)
}</pre></li>
			</ol>
			<p>You check whether the view specified as <strong class="source inline">v</strong> is null with <strong class="source inline">?</strong> and then only operate upon it with the <strong class="source inline">let</strong> scope function if it isn’t, before passing the <strong class="source inline">id</strong> value of the star sign <span class="No-Break">to </span><span class="No-Break"><strong class="source inline">Activity</strong></span><span class="No-Break">/</span><span class="No-Break"><strong class="source inline">StarSignListener</strong></span><span class="No-Break">.</span></p>
			<p class="callout heading">Note</p>
			<p class="callout">Listeners are a common way to react to changes. By specifying a <strong class="source inline">Listener</strong> interface, you are specifying a contract to be fulfilled. The implementing class is then notified of the results of the <span class="No-Break">listener operation.</span></p>
			<ol>
				<li value="10">Next, create <strong class="source inline">DetailFragment</strong>, which will display the star sign details. Create a <a id="_idIndexMarker263"/>blank<a id="_idIndexMarker264"/> fragment as you have done before and call it <strong class="source inline">DetailFragment</strong>. Replace the <strong class="source inline">fragment_detail</strong> layout file contents with the following <span class="No-Break">XML file:</span><pre class="source code">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout
xmlns:android=
  "http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    tools:context=".DetailFragment"&gt;
    &lt;TextView
        android:id="@+id/star_sign"
        style="@style/StarSignTextViewHeader"
        android:textStyle="bold"
        android:gravity="center"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        tools:text="Aquarius"/&gt;
    &lt;TextView
        android:id="@+id/symbol"
        style="@style/StarSignTextView"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        tools:text="Water Carrier"/&gt;
    &lt;TextView
        android:id="@+id/date_range"
        style="@style/StarSignTextView"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        tools:text="Date Range:
            January 20 - February 18" /&gt;
&lt;/LinearLayout&gt;</pre></li>
			</ol>
			<p>Here, you create <a id="_idIndexMarker265"/>a <a id="_idIndexMarker266"/>simple <strong class="source inline">LinearLayout</strong>, which will display the star sign name, the symbol of the star sign, and the date range. You’ll set these values <span class="No-Break">in </span><span class="No-Break"><strong class="source inline">DetailFragment</strong></span><span class="No-Break">.</span></p>
			<ol>
				<li value="11">Open <strong class="source inline">DetailFragment</strong> and update the contents with the following text and also add <strong class="source inline">TextView</strong> and <strong class="source inline">Toast</strong> imports to the <span class="No-Break">imports list:</span><pre class="source code">
import android.widget.TextView
import android.widget.Toast
class DetailFragment : Fragment() {
    // TODO: Rename and change types of parameters
    private var param1: String? = null
    private var param2: String? = null
    private val starSign: TextView?
        get() = view?.findViewById(R.id.star_sign)
    private val symbol: TextView?
        get() = view?.findViewById(R.id.symbol)
    private val dateRange: TextView?
        get() = view?.findViewById(R.id.date_range)
    override fun onCreate(...)
    override fun onCreateView(...)
    fun setStarSignData(starSignId: Int) {
        when (starSignId) {
            R.id.aquarius -&gt; {
                starSign?.text =
                    getString(R.string.aquarius)
                symbol?.text =
                    getString(R.string.symbol,
                        "Water Carrier")
                dateRange?.text =
                    getString(R.string.date_range,
                        "January 20 - February 18")
            }
        }
    }
}</pre></li>
			</ol>
			<p>The <strong class="source inline">onCreateView</strong> inflates the layout as normal. The <strong class="source inline">setStarSignData()</strong> function is what populates the data from the passed-in <strong class="source inline">starSignId</strong>. The <strong class="source inline">when</strong> expression is used to determine the ID of the star sign and set the <span class="No-Break">appropriate contents.</span></p>
			<p>The <strong class="source inline">setStarSignData</strong> function<a id="_idIndexMarker267"/> here<a id="_idIndexMarker268"/> formats text passed with the <strong class="source inline">getString</strong> function – <strong class="source inline">getString(R.string.symbol,"Water Carrier")</strong>, for example, passes the text <strong class="source inline">Water Carrier</strong> into the <strong class="source inline">symbol</strong> string, <strong class="source inline">&lt;string name="symbol"&gt;Symbol: %s&lt;/string&gt;</strong>, and replaces <strong class="source inline">%s</strong> with the passed-in value. You can see what other string formatting options there are in the official <span class="No-Break">docs: </span><a href=""><span class="No-Break">https://developer.android.com/guide/topics/resources/string-resource</span></a><span class="No-Break">.</span></p>
			<p>Following the pattern introduced by <strong class="source inline">aquarius</strong>, add the other 11 star signs below the <strong class="source inline">aquarius</strong> block from the completed file <span class="No-Break">here: </span><a href="https://packt.link/C9sWZ"><span class="No-Break">https://packt.link/C9sWZ</span></a><span class="No-Break">.</span></p>
			<p>Right now, you have added both <strong class="source inline">ListFragment</strong> and <strong class="source inline">DetailFragment</strong>. Currently, however, they have not been added to the activity layout and/or synced together, so selecting the star sign item in <strong class="source inline">ListFragment</strong> will not load contents into <strong class="source inline">DetailFragment</strong>. Let’s look at how you can <span class="No-Break">change that.</span></p>
			<ol>
				<li value="12">Firstly, you need to change the layout of <strong class="source inline">activity_main.xml</strong> in both the <strong class="source inline">layout</strong> folder <span class="No-Break">and </span><span class="No-Break"><strong class="source inline">layout-sw600dp</strong></span><span class="No-Break">.</span></li>
				<li>Open up <strong class="source inline">res</strong> | <strong class="source inline">layout</strong> | <strong class="source inline">activity_main.xml</strong> if in the Project view. In the default Android view, open up <strong class="source inline">res</strong> | <strong class="source inline">layout</strong> | <strong class="source inline">activity_main.xml</strong> and select the top <strong class="source inline">activity_main.xml</strong> file without (<strong class="source inline">sw600dp</strong>). Replace the contents with<a id="_idIndexMarker269"/> <span class="No-Break">the</span><span class="No-Break"><a id="_idIndexMarker270"/></span><span class="No-Break"> following:</span><pre class="source code">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;androidx.constraintlayout.widget.ConstraintLayout
xmlns:android=
  "http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".MainActivity"&gt;
    &lt;fragment
        android:id="@+id/star_sign_list"
        android:name="com.example.dualpanelayouts
            .ListFragment"
        android:layout_height="match_parent"
        android:layout_width="match_parent"/&gt;
&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</pre></li>
			</ol>
			<p>If you run the app and select one of the star signs now, you will get a <strong class="source inline">NotImplementedError</strong> as we need to replace the <strong class="source inline">TODO</strong> item with <span class="No-Break">this functionality.</span></p>
			<ol>
				<li value="14">Then, open up <strong class="source inline">res</strong> | <strong class="source inline">layout-sw600dp</strong> | <strong class="source inline">activity_main.xml</strong> if in the Project view. In the default Android view, open up <strong class="source inline">res</strong> | <strong class="source inline">layout</strong> | <strong class="source inline">activity_main.xml (sw600dp)</strong>. Replace <a id="_idIndexMarker271"/>the <a id="_idIndexMarker272"/>contents with <span class="No-Break">the following:</span><pre class="source code">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout
xmlns:android=
  "http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="horizontal"
    tools:context=".MainActivity"&gt;
    &lt;fragment
        android:id="@+id/star_sign_list"
        android:name="com.example.dualpanelayouts
            .ListFragment"
        android:layout_height="match_parent"
        android:layout_width="0dp"
        android:layout_weight="1"/&gt;
    &lt;View
        android:layout_width="1dp"
        android:layout_height="match_parent"
        android:background="?android:attr/
            dividerVertical" /&gt;
    &lt;fragment
        android:id="@+id/star_sign_detail"
        android:name="com.example.dualpanelayouts
            .DetailFragment"
        android:layout_height="match_parent"
        android:layout_width="0dp"
        android:layout_weight="2"/&gt;
&lt;/LinearLayout&gt;</pre></li>
			</ol>
			<p>You are adding <strong class="source inline">LinearLayout</strong>, which will by default lay out its <span class="No-Break">content horizontally.</span></p>
			<p>You add <strong class="source inline">ListFragment</strong>, a divider, and then <strong class="source inline">DetailFragment</strong> and assign the<a id="_idIndexMarker273"/> fragments <a id="_idIndexMarker274"/>appropriate IDs. Notice also that you are using the concept of weights to assign the space available for each fragment. When you do this, you specify <strong class="source inline">android:layout_width="0dp"</strong>. <strong class="source inline">layout_weight</strong> then sets the proportion of the width available by the weight measurements as <strong class="source inline">LinearLayout</strong> is set to lay out the <span class="No-Break">fragments horizontally.</span></p>
			<p><strong class="source inline">ListFragment</strong> is specified as <strong class="source inline">android:layout_weight="1"</strong> and <strong class="source inline">DetailFragment</strong> is specified as <strong class="source inline">android:layout_weight="2"</strong>, which tells the system to assign <strong class="source inline">DetailFragment</strong> twice the width of <strong class="source inline">ListFragment</strong>. In this case, where there are three views including the divider, which is a fixed dp width, this will result roughly in <strong class="source inline">ListFragment</strong> occupying one-third of the width and <strong class="source inline">DetailFragment</strong> <span class="No-Break">occupying two-thirds.</span></p>
			<ol>
				<li value="15">To see the app, create a new virtual device as shown in <a href="B19411_01.xhtml#_idTextAnchor025"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Creating Your First App</em>, and select <strong class="bold">Category</strong> | <strong class="bold">Tablet</strong> | <span class="No-Break"><strong class="bold">Nexus 7</strong></span><span class="No-Break">.</span></li>
				<li>This will create a 7” tablet. Then, launch the virtual device and run the app. This <a id="_idTextAnchor233"/>is the initial view you will see when you launch the tablet in <span class="No-Break">portrait mode:</span></li>
			</ol>
			<div>
				<div id="_idContainer084" class="IMG---Figure">
					<img src="image/B19411_03_11.jpg" alt="Figure 3.12 – Initial star sign app UI display"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.12 – Initial star sign app UI display</p>
			<p>You can see that <a id="_idIndexMarker275"/>the<a id="_idIndexMarker276"/> list takes up about a third of the screen and the blank space two-thirds of <span class="No-Break">the screen.</span></p>
			<ol>
				<li value="17">Click the <img src="image/B19411_03_12.png" alt=""/> bottom rotate button on the virtual device to turn the virtual device 90 <span class="No-Break">degrees clockwise.</span></li>
				<li>Once you’ve done that, the virtual device will go into landscape mode. It will not, however, change the screen orientation <span class="No-Break">to landscape.</span></li>
				<li>In order to do this, click on the <img src="image/B19411_03_13.png" alt="3"/> rotate button in the bottom-left corner of the virtual device. You can also select the status bar at the top of the virtual device and hold and drag down to display the quick settings bar where you can turn on auto-rotation by selecting the rotate button. (You might have to swi<a id="_idTextAnchor234"/>pe left/right within <a id="_idIndexMarker277"/>the <a id="_idIndexMarker278"/>quick settings bar to show the <span class="No-Break"><strong class="bold">Auto-rotate</strong></span><span class="No-Break"> option.)</span></li>
			</ol>
			<div>
				<div id="_idContainer087" class="IMG---Figure">
					<img src="image/B19411_03_14.jpg" alt="Figure 3.13 – Quick settings bar wi﻿th Auto-rotate selected"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.13 – Quick settings bar wi<a id="_idTextAnchor235"/>th Auto-rotate selected</p>
			<ol>
				<li value="20">This will then change the tablet layout <span class="No-Break">to landscape:</span></li>
			</ol>
			<div>
				<div id="_idContainer088" class="IMG---Figure">
					<img src="image/B19411_03_15.jpg" alt="Figure 3.14 – Initial star sign app UI display in landscape on a tablet"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.14 – Initial star sign app UI display in landscape on a tablet</p>
			<ol>
				<li value="21">The next thing to do is enable selecting a list item to load contents into the <strong class="source inline">Detail</strong> pane of <a id="_idIndexMarker279"/>the<a id="_idIndexMarker280"/> screen. For that, we need to make changes in <strong class="source inline">MainActivity</strong>. Update <strong class="source inline">MainActivity</strong> with the following code to retrieve fragments by their ID in the pattern of retrieving views by their IDs (there will be some unused imports that will be required when the phone implementation <span class="No-Break">is done):</span><pre class="source code">
package com.example.dualpanelayouts
import android.content.Intent
import android.os.Bundle
import android.view.View
import androidx.appcompat.app.AppCompatActivity
const val STAR_SIGN_ID = "STAR_SIGN_ID"
interface StarSignListener {
    fun onSelected(id: Int)
}
class MainActivity : AppCompatActivity(),
StarSignListener {
    var isDualPane: Boolean = false
    override fun onCreate(savedInstanceState: Bundle?)
    {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        isDualPane =
            findViewById&lt;View&gt;(R.id.star_sign_detail)
                != null
    }
    override fun onSelected(id: Int) {
        if (isDualPane) {
            val detailFragment =
                supportFragmentManager
                .findFragmentById(
                R.id.star_sign_detail) as
                DetailFragment
        detailFragment.setStarSignData(id)
        }
    }
}</pre></li>
			</ol>
			<p class="callout heading">Note</p>
			<p class="callout">Fragments were introduced in API 11 in 2011 with a <strong class="source inline">FragmentManager</strong> class to manage their interactions with activities. <strong class="source inline">SupportFragmentManager</strong> was introduced to support using fragments in Android versions before API 11 in the Android Support Library. <strong class="source inline">SupportFragmentManager</strong> has been further developed as the base for the Jetpack Fragment library, which adds improvements for <span class="No-Break">managing fragments.</span></p>
			<p>This example and those that follow use <strong class="source inline">supportFragmentManager.findFragmentById</strong> to retrieve fragments. You can also, however, retrieve fragments with <strong class="source inline">Tag</strong> if you add a tag to the fragment XML by <span class="No-Break">using </span><span class="No-Break"><strong class="source inline">android:tag="MyFragmentTag"</strong></span><span class="No-Break">.</span></p>
			<ol>
				<li value="22">You can <a id="_idIndexMarker281"/>then <a id="_idIndexMarker282"/>retrieve the fragment by <span class="No-Break">using </span><span class="No-Break"><strong class="source inline">supportFragmentManager.find</strong></span><strong class="source inline">
</strong><span class="No-Break"><strong class="source inline">FragmentByTag("MyFragmentTag")</strong></span><span class="No-Break">.</span></li>
				<li>In order to retrieve data from the fragment, the activity needs to implement <strong class="source inline">StarSignListener</strong>. This completes the contract set in the fragment to pass back details to the implementing class. The <strong class="source inline">onCreate</strong> function sets the layout and then checks whether <strong class="source inline">DetailFragment</strong> is in the activity’s inflated layout by checking whether the <strong class="source inline">R.id.star_sign_detail</strong> <span class="No-Break">ID exists.</span></li>
				<li>From the Project view, the <strong class="source inline">res</strong> | <strong class="source inline">layout</strong> | <strong class="source inline">activity_main.xml</strong> file only contains <strong class="source inline">ListFragment</strong>, but you’ve added the code in the <strong class="source inline">res</strong> | <strong class="source inline">layout-sw600dp</strong> | <strong class="source inline">activity_main.xml</strong> file to contain <strong class="source inline">DetailFragment</strong> <span class="No-Break">with </span><span class="No-Break"><strong class="source inline">android:id="@+id/star_sign_detail"</strong></span><span class="No-Break">.</span></li>
				<li>This will be used for the layout of the Nexus 7 tablet. In the default Android view, open up <strong class="source inline">res</strong> | <strong class="source inline">layout</strong> | <strong class="source inline">activity_main.xml</strong> and select the top <strong class="source inline">activity_main.xml</strong> file without (<strong class="source inline">sw600dp</strong>) and then select <strong class="source inline">activity_main.xml</strong> (<strong class="source inline">sw600dp</strong>) to see <span class="No-Break">these differences.</span></li>
				<li>So now we can retrieve the star sign ID passed from <strong class="source inline">ListFragment</strong> back to <strong class="source inline">MainActivity</strong> by <strong class="source inline">StarSignListener</strong> and pass it into <strong class="source inline">DetailFragment</strong>. This is achieved by checking the <strong class="source inline">isDualPane</strong> Boolean, and if that evaluates to <strong class="source inline">true</strong>, you know you can pass the star sign ID to <strong class="source inline">DetailFragment</strong> with <span class="No-Break">this code:</span><pre class="source code">
val detailFragment = supportFragmentManager
.findFragmentById (R.id.star_sign_detail) as
DetailFragment
detailFragment.setStarSignData(id)</pre></li>
				<li>You cast the fragment from <strong class="source inline">id</strong> to <strong class="source inline">DetailFragment</strong> and call <span class="No-Break">the following:</span><pre class="source code">
detailFragment.setStarSignData(id)</pre></li>
				<li>As you’ve<a id="_idIndexMarker283"/> implemented this function in the<a id="_idIndexMarker284"/><a id="_idTextAnchor236"/> fragment and are checking by the <strong class="source inline">id</strong> value which contents to display, the UI <span class="No-Break">is updated:</span></li>
			</ol>
			<div>
				<div id="_idContainer089" class="IMG---Figure">
					<img src="image/B19411_03_16.jpg" alt="Figure 3.15 – Star sign app dual-pane display in landscape on a tablet"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.15 – Star sign app dual-pane display in landscape on a tablet</p>
			<ol>
				<li value="29">Now clicking on a list item works as intended, showing the dual-pane layout with the contents <span class="No-Break">set correctly.</span></li>
				<li>If the device is not a tablet, however, even when a list item is clicked, nothing will happen as there is not an <strong class="source inline">else</strong> branch condition to do anything if the device is not a tablet, which is defined by the <strong class="source inline">isDualPane</strong> Boolean<a id="_idTextAnchor237"/>. The display will<a id="_idIndexMarker285"/> be<a id="_idIndexMarker286"/> as in <span class="No-Break"><em class="italic">Figure 3</em></span><em class="italic">.16</em> and won’t change when items <span class="No-Break">are selected:</span></li>
			</ol>
			<div>
				<div id="_idContainer090" class="IMG---Figure">
					<img src="image/B19411_03_17.jpg" alt="Figure 3.16 – Initial star sign app UI display on a phone"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.16 – Initial star sign app UI display on a phone</p>
			<ol>
				<li value="31">You are going to display the star sign detail in another activity. Create a new <strong class="source inline">DetailActivity</strong> by going to <strong class="bold">File</strong> | <strong class="bold">New</strong> | <strong class="bold">Activity</strong> | <strong class="bold">Empty Activity</strong>. Once<a id="_idIndexMarker287"/> created, update <a id="_idIndexMarker288"/><strong class="source inline">activity_detail.xml</strong> with <span class="No-Break">this layout:</span><pre class="source code">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;androidx.constraintlayout.widget.ConstraintLayout
xmlns:android=
  "http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".DetailActivity"&gt;
    &lt;fragment
        android:id="@+id/star_sign_detail"
        android:name="com.example.dualpanelayouts
            .DetailFragment"
        android:layout_height="match_parent"
        android:layout_width="match_parent"/&gt;
&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</pre></li>
				<li>This adds <strong class="source inline">DetailFragment</strong> as the only fragment in the layout. Now, update the <strong class="source inline">onCreate</strong> function of <strong class="source inline">DetailActivity</strong> with the <span class="No-Break">following contents:</span><pre class="source code">
override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    setContentView(R.layout.activity_detail)
    val starSignId =
        intent.extras?.getInt(STAR_SIGN_ID, 0) ?: 0
    val detailFragment =
        supportFragmentManager.findFragmentById(
        R.id.star_sign_detail) as DetailFragment
    detailFragment.setStarSignData(starSignId)
}</pre></li>
				<li>The star sign <strong class="source inline">id</strong> is expected<a id="_idIndexMarker289"/> to <a id="_idIndexMarker290"/>be passed from another activity to this one by setting a key in the intent’s extras (also called a bundle). We covered intents in <a href="B19411_02.xhtml#_idTextAnchor103"><span class="No-Break"><em class="italic">Chapter 2</em></span></a>, <em class="italic">Building User Screen Flows</em>, but as a reminder, they enable communication between different components and also can <span class="No-Break">send data.</span></li>
				<li>In this case, the intent that opened this activity has set a star sign ID. It will use <strong class="source inline">id</strong> to set the star sign ID in <strong class="source inline">DetailFragment</strong>. Next, you need to implement the <strong class="source inline">else</strong> branch of the <strong class="source inline">isDualPane</strong> check to launch <strong class="source inline">DetailActivity</strong>, passing through the star sign ID in <span class="No-Break">the intent.</span></li>
				<li>Update <strong class="source inline">MainActivity</strong> as follows to <span class="No-Break">do this:</span><pre class="source code">
override fun onSelected(id: Int) {
    if (isDualPane) {
        val detailFragment = supportFragmentManager
            .findFragmentById(R.id.star_sign_detail)
                as DetailFragment
        detailFragment.setStarSignData(id)
    } else {
        val detailIntent = Intent(this,
            DetailActivity::class.java)
                .apply {
                    putExtra(STAR_SIGN_ID, id)
                }
        startActivity(detailIntent)
       }
}</pre></li>
				<li>Once you click on <a id="_idIndexMarker291"/>one <a id="_idIndexMarker292"/>of the star sign names on a phone display, it show<a id="_idTextAnchor238"/>s the contents in <strong class="source inline">DetailActivity</strong> occupying the whole of the screen without <span class="No-Break">the list:</span></li>
			</ol>
			<div>
				<div id="_idContainer091" class="IMG---Figure">
					<img src="image/B19411_03_18.jpg" alt="Figure 3.17 – Single-pane star sign detail screen on a phone"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.17 – Single-pane star sign detail screen on a phone</p>
			<p>This exercise <a id="_idIndexMarker293"/>has<a id="_idIndexMarker294"/> demonstrated the flexibility of fragments. They can encapsulate the logic and display different features of your app, which can be integrated in different ways depending on the form factor of the device. They can be arranged onscreen in a variety of ways, which are constrained by the layout they are included in; therefore, they can feature as a part of dual-pane layouts or all or part of a <span class="No-Break">single-pane layout.</span></p>
			<p>This exercise showed fragments being laid out side by side on a tablet, but they can also be laid out on top of each other and in a variety of other ways. The next topic illustrates how the configuration of fragments used in<a id="_idTextAnchor239"/><a id="_idTextAnchor240"/> your app doesn’t have to be specified statically in XML but can also be <span class="No-Break">done dynamically.</span></p>
			<h1 id="_idParaDest-73"><a id="_idTextAnchor241"/>Dynamic fragments</h1>
			<p>So far, you’ve only<a id="_idIndexMarker295"/> seen fragments added in XML at compile time. Although this can satisfy many use cases, you might want to add fragments dynamically at runtime to respond to the user’s actions. This can be achieved by adding <strong class="source inline">ViewGroup</strong> as a container for fragments and then adding, replacing, and removing fragments <span class="No-Break">from </span><span class="No-Break"><strong class="source inline">ViewGroup</strong></span><span class="No-Break">.</span></p>
			<p>This technique is more flexible as the fragments can be active until they are no longer needed and then removed, instead of always being inflated in XML layouts as you have seen with static fragments. If three or four more fragments are required to fulfill separate user journeys in one activity, then the preferred option is to react to the user’s interaction in the UI by adding/replacing <span class="No-Break">fragments dynamically.</span></p>
			<p>Using static fragments works better when the user’s interaction with the UI is fixed at compile time and you know in advance how many fragments you need. F<a id="_idTextAnchor242"/><a id="_idTextAnchor243"/>or example, this would be the case for selecting items from a list to display <span class="No-Break">the contents.</span></p>
			<h2 id="_idParaDest-74"><a id="_idTextAnchor244"/>Exercise 3.04 – adding fragments dynamically to an activity</h2>
			<p>In this exercise, we<a id="_idIndexMarker296"/> will build the same star sign app as before but will demonstrate how the list and detail fragments can be added to screen layouts dynamically and not directly within an XML layout. You can also pass arguments into a fragment. For simplicity, you are going to create the same configuration for both phones and tablets. Perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Create a new project with an <strong class="source inline">Empty Activity</strong> called <span class="No-Break"><strong class="source inline">Dynamic Fragments</strong></span><span class="No-Break">.</span></li>
				<li>Once you have done that, add the following dependency – you need to use <strong class="source inline">FragmentContainerView</strong>, an optimized ViewGroup for handling fragment transactions with <strong class="source inline">app/build.gradle</strong> within the <strong class="source inline">dependences{ }</strong> <span class="No-Break">block:</span><pre class="source code">
implementation 'androidx.fragment:fragment-ktx:1.5.6'</pre></li>
				<li>Copy the contents of the following XML resource files from <em class="italic">Exercise 3.03</em> – <em class="italic">dual-pane layouts with static fragments</em>, and add them to the corresponding files in this exercise: <strong class="source inline">strings.xml</strong> (changing the <strong class="source inline">app_name</strong> string from <strong class="source inline">Dual Pane Layouts</strong> to <strong class="source inline">Dynamic Fragments</strong>), <strong class="source inline">fragment_detail.xml</strong>, and <strong class="source inline">fragment_list.xml</strong>. All of these files exist in the project created in the previous exercise and you simply add the contents to this <span class="No-Break">new project.</span></li>
				<li>Then, copy <strong class="source inline">DetailFragment</strong> and <strong class="source inline">ListFragment</strong> to the new project. You will have to change the package name from <strong class="source inline">package com.example.dualpanelayouts</strong> to <strong class="source inline">package com.example.dynamicfragments</strong> in these two files. Finally, add the styles defined below the base application style in <strong class="source inline">themes.xml</strong> from the last exercise to <strong class="source inline">themes.xml</strong> in <span class="No-Break">this project.</span></li>
				<li>You now have the same fragments set up as in the previous exercise. Now, open the <strong class="source inline">activity_main.xml</strong> layout<a id="_idIndexMarker297"/> and replace the contents <span class="No-Break">with this:</span><pre class="source code">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;androidx.fragment.app.FragmentContainerView
xmlns:android=
  "http://schemas.android.com/apk/res/android"
    android:id="@+id/fragment_container"
    android:layout_width="match_parent"
    android:layout_height="match_parent" /&gt;</pre></li>
			</ol>
			<p>This is the <strong class="source inline">FragmentContainerView</strong> you will add the fragments to. You’ll notice that there are no fragments added in the layout XML as these will be <span class="No-Break">added dynamically.</span></p>
			<ol>
				<li value="6">Go into <strong class="source inline">MainActivity</strong> and replace the content with <span class="No-Break">the following:</span><pre class="source code">
package com.example.dynamicfragments
import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import androidx.fragment.app.FragmentContainerView
const val STAR_SIGN_ID = "STAR_SIGN_ID"
interface StarSignListener {
    fun onSelected(id: Int)
}
class MainActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?)
    {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        if (savedInstanceState == null) {
            findViewById&lt;FragmentContainerView&gt;(
            R.id.fragment_container)?.let {
            frameLayout -&gt;
             val listFragment = ListFragment()
             supportFragmentManager.beginTransaction()
                 .add(frameLayout.id,
                 listFragment).commit()
            }
        }
    }
}</pre></li>
			</ol>
			<p>You are getting a reference to the <strong class="source inline">FragmentContainerView</strong> specified in <strong class="source inline">activity_main.xml</strong>, creating a new <strong class="source inline">ListFragment</strong>, and then adding this fragment to the <strong class="source inline">FragmentContainerView</strong> with the ID of <span class="No-Break">the </span><span class="No-Break"><strong class="source inline">fragment_container</strong></span><span class="No-Break">.</span></p>
			<p>The fragment transaction specified is <strong class="source inline">add</strong> as you are adding a fragment to <strong class="source inline">FrameLayout</strong> for the first time. You call <strong class="source inline">commit()</strong> to execute the transaction immediately. There is a null check with <strong class="source inline">savedInstanceState</strong> to only add this <strong class="source inline">ListFragment</strong> if there is no state to restore, which there would be if a fragment had been <span class="No-Break">previously added.</span></p>
			<ol>
				<li value="7">Next, make <strong class="source inline">MainActivity</strong> implement <strong class="source inline">StarSignListener</strong> by adding <span class="No-Break">the</span><span class="No-Break"><a id="_idIndexMarker298"/></span><span class="No-Break"> following:</span><pre class="source code">
class MainActivity : AppCompatActivity(),
StarSignListener {
...
override fun onSelected(id: Int) {
    }
}</pre></li>
				<li>Now if you run the app, you will see the star sign list being displayed on mobile <span class="No-Break">and tablet.</span></li>
			</ol>
			<p>The problem you now come to is how to pass the star sign ID to <strong class="source inline">DetailFragment</strong> now that it’s not in an <span class="No-Break">XML layout.</span></p>
			<p>One option would be to use the same technique as in the last example by creating a new activity and passing the star sign ID in an intent, but you shouldn’t have to create a new activity to add a new fragment; otherwise, you might as well dispense with fragments and just <span class="No-Break">use activities.</span></p>
			<p>You are going to replace <strong class="source inline">ListFragment</strong> in <strong class="source inline">FragmentContainerView</strong> with <strong class="source inline">DetailFragment</strong>, but first, you need to find a way to pass the star sign ID into <strong class="source inline">DetailFragment</strong>. You do this by passing this <strong class="source inline">id</strong> value as an argument when you create the fragment. The standard way to do this is by using a <strong class="source inline">Factory</strong> method in <span class="No-Break">a fragment.</span></p>
			<ol>
				<li value="9">Add the following code to the bottom of <strong class="source inline">DetailFragment</strong> (a sample <strong class="source inline">factory</strong> method will have been added when you created the fragment using the template/wizard, which you can <span class="No-Break">update here):</span><pre class="source code">
companion object {
    private const val STAR_SIGN_ID = "STAR_SIGN_ID"
    fun newInstance(starSignId: Int) =
    DetailFragment().apply {
        arguments = Bundle().apply {
            putInt(STAR_SIGN_ID, starSignId)
        }
    }
}</pre></li>
			</ol>
			<p>A <strong class="source inline">companion</strong> object<a id="_idIndexMarker299"/> allows you to add Java’s equivalent of static members into your class. Here, you are instantiating a new <strong class="source inline">DetailFragment</strong> and setting arguments passed into the fragment. The arguments of the fragment are stored in a <strong class="source inline">Bundle()</strong>, so in the same way as an activity’s intent extras (which is also a bundle), you add the values as key pairs. In this case, you are adding the <strong class="source inline">STAR_SIGN_ID</strong> key with the <span class="No-Break">value </span><span class="No-Break"><strong class="source inline">starSignId</strong></span><span class="No-Break">.</span></p>
			<ol>
				<li value="10">The next thing to do is override one of the <strong class="source inline">DetailFragment</strong> lifecycle functions to use the <span class="No-Break">passed-in argument:</span><pre class="source code">
override fun onViewCreated(view: View,
savedInstanceState: Bundle?) {
    val starSignId = arguments?.getInt(STAR_SIGN_ID,
        0) ?: 0
    setStarSignData(starSignId)
}</pre></li>
				<li>You do this in <strong class="source inline">onViewCreated</strong> as at this stage, the layout of the fragment has been set up and you can access the view hierarchy (whereas if you accessed the arguments in <strong class="source inline">onCreate</strong>, the fragment layout would not be available as this is done <span class="No-Break">in </span><span class="No-Break"><strong class="source inline">onCreateView</strong></span><span class="No-Break">):</span><pre class="source code">
val starSignId = arguments?.getInt(STAR_SIGN_ID, 0) ?: 0</pre></li>
				<li>This line gets the star sign ID from the passed-in fragment arguments, setting a default of <strong class="source inline">0</strong> if the <strong class="source inline">STAR_SIGN_ID</strong> key cannot be found. Then, you call <strong class="source inline">setStarSignData(starSignId)</strong> to display the star <span class="No-Break">sign contents.</span></li>
				<li>Now you just need to<a id="_idIndexMarker300"/> implement the <strong class="source inline">StarSignListener</strong> interface in <strong class="source inline">MainActivity</strong> to retrieve the star sign ID <span class="No-Break">from </span><span class="No-Break"><strong class="source inline">ListFragment</strong></span><span class="No-Break">:</span><pre class="source code">
class MainActivity : AppCompatActivity(),
StarSignListener {
    override fun onCreate(savedInstanceState: Bundle?)
    {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        if (savedInstanceState == null) {
            findViewById&lt;FragmentContainerView&gt;(
            R.id.fragment_container)?.let {
            frameLayout -&gt;
              val listFragment = ListFragment()
             supportFragmentManager.beginTransaction()
                 .add(frameLayout.id,
                 listFragment).commit()
            }
        }
    }
    override fun onSelected(starSignId: Int) {
        findViewById&lt;FragmentContainerView&gt;(
        R.id.fragment_container)?.let { frameLayout -&gt;
            val detailFragment =
                DetailFragment.newInstance(starSignId)
            supportFragmentManager.beginTransaction()
                .replace(frameLayout.id,
                detailFragment)
                .addToBackStack(null)
                .commit()
        }
    }
}</pre></li>
			</ol>
			<p>You create<a id="_idIndexMarker301"/> <strong class="source inline">DetailFragment</strong> as explained earlier with the <strong class="source inline">factory</strong> method passing in the star sign <span class="No-Break">ID: </span><span class="No-Break"><strong class="source inline">DetailFragment.newInstance(starSignId)</strong></span><span class="No-Break">.</span></p>
			<p>At this stage, <strong class="source inline">ListFragment</strong> is still the fragment that has been added to the activity <strong class="source inline">FrameLayout</strong>. You need to replace it with <strong class="source inline">DetailFragment</strong>, which requires another transaction. This time, however, you use the <strong class="source inline">replace</strong> function to replace <strong class="source inline">ListFragment</strong> <span class="No-Break">with </span><span class="No-Break"><strong class="source inline">DetailFragment</strong></span><span class="No-Break">.</span></p>
			<p>Before you commit the transaction, you call <strong class="source inline">.addToBackStack(null)</strong> so the app does not exit when the back button is pressed but instead goes back to <strong class="source inline">ListFragment</strong> by popping <strong class="source inline">DetailFragment</strong> off the <span class="No-Break">fragment stack.</span></p>
			<p>This exercise has introduced adding fragments dynamically to your activity. The next <a id="_idTextAnchor245"/><a id="_idTextAnchor246"/>topic introduces a<a id="_idIndexMarker302"/> more well-defined structure for creating fragments, called a <span class="No-Break">navigation graph.</span></p>
			<h1 id="_idParaDest-75"><a id="_idTextAnchor247"/>Jetpack Navigation</h1>
			<p>Using dynamic and<a id="_idIndexMarker303"/> static fragments, although very flexible, introduces a lot of boilerplate code into your app and can become quite complicated when user journeys require adding, removing, and replacing multiple fragments while managing the <span class="No-Break">back stack.</span></p>
			<p>Google introduced Jetpack components, as you learned in <a href="B19411_01.xhtml#_idTextAnchor025"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Creating Your First App</em>, to use established best practices in your code. The <strong class="source inline">Navigation</strong> component within the suite of Jetpack components enables you to reduce boilerplate co<a id="_idTextAnchor248"/><a id="_idTextAnchor249"/>de and simplify navigation within your app. We are going to use it now to update the Star <span class="No-Break">Sign app.</span></p>
			<h2 id="_idParaDest-76"><a id="_idTextAnchor250"/>Exercise 3.05 – adding a Jetpack navigation graph</h2>
			<p>In this exercise, we <a id="_idIndexMarker304"/>are going to reuse most of the classes and resources from the last exercise. We will first create an empty project and copy the resources. Next, we will add the dependencies and create a <span class="No-Break">navigation graph.</span></p>
			<p>Using a step-by-step approach, we will configure the navigation graph and add destinations to navigate between fragments. Perform the <span class="No-Break">following steps:</span></p>
			<ol>
				<li>Create a new project with an <strong class="source inline">Empty Activity</strong> called <span class="No-Break"><strong class="source inline">Jetpack Fragments</strong></span><span class="No-Break">.</span></li>
				<li>Copy <strong class="source inline">strings.xml</strong>, <strong class="source inline">fragment_detail.xml</strong>, <strong class="source inline">fragment_list.xml</strong>, <strong class="source inline">DetailFragment</strong>, and <strong class="source inline">ListFragment</strong> from the previous exercise, remembering to change the <strong class="source inline">app_name</strong> string in <strong class="source inline">strings.xml</strong> and the package name for the fragment classes. You will need to change the following line for the resources from <strong class="source inline">import com.example.dynamicfragments.R</strong> to <span class="No-Break"><strong class="source inline">import com.example.jetpacknavigation.R</strong></span><span class="No-Break">.</span></li>
				<li>Finally, add the styles defined below the base application style in <strong class="source inline">themes.xml</strong> from the last exercise to <strong class="source inline">themes.xml</strong> in this project. You will also need to add the following above the class header <span class="No-Break">in </span><span class="No-Break"><strong class="source inline">MainActivity</strong></span><span class="No-Break">:</span><pre class="source code">
const val STAR_SIGN_ID = "STAR_SIGN_ID"
interface StarSignListener {
    fun onSelected(id: Int)
}</pre></li>
				<li>Once you have<a id="_idIndexMarker305"/> done that, add the following dependencies – you need to use the <strong class="source inline">Navigation</strong> component in <strong class="source inline">app/build.gradle</strong> within the <strong class="source inline">dependences{ }</strong> <span class="No-Break">block:</span><pre class="source code">
implementation 
"androidx.navigation:navigation-fragment-ktx:2.5.3"
implementation 
"androidx.navigation:navigation-ui-ktx:2.5.3"</pre></li>
				<li>It will prompt you to <strong class="bold">Sync now </strong>in the top right-hand corner of the screen to update the dependencies. Click the button, and after they’ve updated, make sure the <strong class="source inline">app</strong> module is selected and go to <strong class="bold">File</strong> | <strong class="bold">New</strong> | <span class="No-Break"><strong class="bold">Android Resource</strong></span><span class="No-Break">.</span></li>
				<li>Once this dialog appears, change <strong class="bold">Resource type</strong> to <strong class="bold">Navigation</strong> and then name the <span class="No-Break">file </span><span class="No-Break"><strong class="source inline">nav_graph</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer092" class="IMG---Figure">
					<img src="image/B19411_03_19.jpg" alt="Figure 3.18 – New Resource File dialog"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.18 – New Resource File dialog</p>
			<p>Click <strong class="bold">OK</strong> to proceed. This <a id="_idIndexMarker306"/>creates a new folder in the <strong class="source inline">res</strong> folder called <strong class="source inline">Navigation</strong> with <strong class="source inline">nav_graph.xml</strong> <span class="No-Break">inside it.</span></p>
			<ol>
				<li value="7">Update the <strong class="source inline">nav_graph.xml</strong> navigation file with the <span class="No-Break">following code:</span><pre class="source code">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;navigation
xmlns:android=
  "http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:id="@+id/nav_graph"
    app:startDestination="@id/starSignList"&gt;
    &lt;fragment
        android:id="@+id/starSignList"
        android:name="com.example.jetpackfragments
            .ListFragment"
        android:label="List"
        tools:layout="@layout/fragment_list"&gt;
        &lt;action
            android:id="@+id/star_sign_id_action"
            app:destination="@id/starSign"&gt;
        &lt;/action&gt;
    &lt;/fragment&gt;
    &lt;fragment
        android:id="@+id/starSign"
        android:name="com.example.jetpackfragments
            .DetailFragment"
        android:label="Detail"
        tools:layout="@layout/fragment_detail" /&gt;
&lt;/navigation&gt;</pre></li>
			</ol>
			<p>The preceding <a id="_idIndexMarker307"/>file is a working navigation graph. Although the syntax is unfamiliar, it is quite straightforward <span class="No-Break">to understand:</span></p>
			<ol>
				<li><strong class="source inline">ListFragment</strong> and <strong class="source inline">DetailFragment</strong> are present as they would be if you were adding <span class="No-Break">static fragments.</span></li>
				<li>There is an <strong class="source inline">id</strong> value to identify the graph at the root <strong class="source inline">&lt;navigation&gt;</strong> element and IDs on the fragments themselves. Navigation graphs introduce the concept of destinations, so at the root <strong class="source inline">navigation</strong> level, there is <strong class="source inline">app:startDestination</strong>, which has the ID of <strong class="source inline">starSignList</strong>, which is <strong class="source inline">ListFragment</strong>, then within the <strong class="source inline">&lt;fragment&gt;</strong> tag, there is the <strong class="source inline">&lt;</strong><span class="No-Break"><strong class="source inline">action&gt;</strong></span><span class="No-Break"> element.</span></li>
				<li>Actions are what link the destinations within the navigation graph together. The destination action here has an ID, so you can refer to it in code, and has a destination, which, when used, it will <span class="No-Break">direct to.</span></li>
			</ol>
			<p>Now that you’ve added the navigation graph, you need to use it to link the activity and <span class="No-Break">fragments together.</span></p>
			<ol>
				<li value="8">Open up <strong class="source inline">activity_main.xml</strong> and replace <strong class="source inline">TextView</strong> inside <strong class="source inline">ConstraintLayout</strong> with <a id="_idIndexMarker308"/>the <span class="No-Break">following </span><span class="No-Break"><strong class="source inline">FragmentContainerView</strong></span><span class="No-Break">:</span><pre class="source code">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;androidx.fragment.app.FragmentContainerView
xmlns:android=
  "http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:id="@+id/nav_host_fragment"
    android:name="androidx.navigation.fragment
        .NavHostFragment"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    app:defaultNavHost="true"
    app:navGraph="@navigation/nav_graph" /&gt;</pre></li>
			</ol>
			<p><strong class="source inline">FragmentContainerView</strong> has been added with the name <strong class="source inline">android:name="androidx.navigation.fragment.NavHostFragment"</strong>. It will host the fragments from the <strong class="source inline">app:navGraph="@navigation/nav_graph"</strong> that you have <span class="No-Break">just created.</span></p>
			<p><strong class="source inline">app:defaultNavHost</strong> states that it is the app’s default navigation graph. It also controls the back navigation when one fragment replaces another. You can have more than one <strong class="source inline">NavHostFragment</strong> in a layout for controlling two or more areas of the screen that manage their own fragments, which you might use for dual-pane layouts in tablets, but there can only be <span class="No-Break">one default.</span></p>
			<p>There are a few changes you need to make to make the app work as expected in <span class="No-Break">the </span><span class="No-Break"><strong class="source inline">ListFragment</strong></span><span class="No-Break">.</span></p>
			<ol>
				<li value="9">Firstly, remove the <a id="_idIndexMarker309"/>class file header and references to <strong class="source inline">StarSignListener</strong>. So, the following will <span class="No-Break">be replaced:</span><pre class="source code">
interface StarSignListener {
    fun onSelected(starSignId: Int)
}
class ListFragment : Fragment(), View.OnClickListener
{
    private lateinit var starSignListener:
        StarSignListener
    override fun onAttach(context: Context) {
        super.onAttach(context)
        if (context is StarSignListener) {
            starSignListener = context
        } else {
            throw RuntimeException("Must implement
            StarSignListener")
        }
    }</pre></li>
			</ol>
			<p>And it will be replaced with the following line <span class="No-Break">of code:</span></p>
			<pre class="source code">
class ListFragment : Fragment() {</pre>
			<ol>
				<li value="10">Next, at the bottom of the class, remove the <strong class="source inline">onClick</strong> overridden method as you are not <span class="No-Break">implementing </span><span class="No-Break"><strong class="source inline">View.OnClicklistener</strong></span><span class="No-Break">:</span><pre class="source code">
override fun onClick(v: View?) {
    v?.let { starSign -&gt;
        starSignListener.onSelected(starSign.id)
    }
}</pre></li>
				<li>In the <strong class="source inline">onViewCreated</strong> method, replace <a id="_idIndexMarker310"/>the <strong class="source inline">forEach</strong> statement that loops over the star <span class="No-Break">sign views:</span><pre class="source code">
starSigns.forEach {
    it.setOnClickListener(this)
}</pre></li>
			</ol>
			<p>Replace it with the following code and add the <strong class="source inline">Navigation</strong> import to the <span class="No-Break">imports list:</span></p>
			<pre class="source code">
import androidx.navigation.Navigation
starSigns.forEach { starSign -&gt;
    val fragmentBundle = Bundle()
    fragmentBundle.putInt(STAR_SIGN_ID, starSign.id)
    starSign.setOnClickListener(
        Navigation.createNavigateOnClickListener(
            R.id.star_sign_id_action, fragmentBundle)
    )
}</pre>
			<p>Here, you are creating a bundle to pass <strong class="source inline">STAR_SIGN_ID</strong> with the view ID of the selected star sign to <strong class="source inline">NavigationClickListener</strong>. It uses the ID of the <strong class="source inline">R.id.star_sign_id_action</strong> action to load <strong class="source inline">DetailFragment</strong> when clicked as that is the destination for the action. <strong class="source inline">DetailFragment</strong> does not need any changes and uses the passed-in <strong class="source inline">fragment</strong> argument to load the details of the selected star <span class="No-Break">sign ID.</span></p>
			<ol>
				<li value="12">Run up the app, and you’ll see that the app behaves as it <span class="No-Break">did before.</span></li>
			</ol>
			<p>Now you’ve been able to remove a significant amount of boilerplate code and document the navigation within the app in the navigation graph. In addition, you have offloaded more of the management of the fragment lifecycle to the Android framework, saving more time to work <span class="No-Break">on features.</span></p>
			<p>Jetpack Navigation is a powerful <strong class="source inline">androidx</strong> component and enables you to map your whole app and the relationships between fragments, activities, and so on. You can also use it selectively to <a id="_idIndexMarker311"/>manage different areas of your app that have a defined user flow, such as the startup of your app and guiding the user through a series of welcome screens, or some wizard layout user journey, <span class="No-Break">for example.</span></p>
			<p>Wi<a id="_idTextAnchor251"/><a id="_idTextAnchor252"/>th this knowledge, let’s try completing an activity using the techniques learned from all <span class="No-Break">these exercises.</span></p>
			<h2 id="_idParaDest-77"><a id="_idTextAnchor253"/>Activity 3.01 – creating a quiz on the planets</h2>
			<p>For this <a id="_idIndexMarker312"/>activity, you will create a quiz where users have to answer one of three questions on the planets of the Solar System. The number of fragments you choose to use is up to you. However, considering this chapter’s content, which is separating the UI and logic into separate fragment components, it is likely you will use two fragments or more to <span class="No-Break">achieve this.</span></p>
			<p>The screenshots that follow show one way this could be done, but there are multiple ways to create this app. You can use one of the approaches detailed in this chapter, such as static fragments, dynamic fragments, or the Jetpack <strong class="source inline">Navigation</strong> component, or something custom that uses a combination of these and <span class="No-Break">other approaches.</span></p>
			<p>The content of the quiz is as follows. In the UI, you need to ask the user these <span class="No-Break">three questions:</span></p>
			<ul>
				<li>What is the <span class="No-Break">largest planet?</span></li>
				<li>Which planet has the <span class="No-Break">most moons?</span></li>
				<li>Which planet spins on <span class="No-Break">its side?</span></li>
			</ul>
			<p>Then, you need to provide a list of planets so the user can choose the planet that they believe is the answer<a id="_idIndexMarker313"/> to <span class="No-Break">the question:</span></p>
			<ul>
				<li><span class="No-Break"><strong class="source inline">MERCURY</strong></span></li>
				<li><span class="No-Break"><strong class="source inline">VENUS</strong></span></li>
				<li><span class="No-Break"><strong class="source inline">EARTH</strong></span></li>
				<li><span class="No-Break"><strong class="source inline">MARS</strong></span></li>
				<li><span class="No-Break"><strong class="source inline">JUPITER</strong></span></li>
				<li><span class="No-Break"><strong class="source inline">SATURN</strong></span></li>
				<li><span class="No-Break"><strong class="source inline">URANUS</strong></span></li>
				<li><span class="No-Break"><strong class="source inline">NEPTUNE</strong></span></li>
			</ul>
			<p>Once they have given their answer, you need to show them whether they are correct or wrong. The correct answer should be accompanied by some text that gives more detail about the <span class="No-Break">question’s answer:</span></p>
			<pre class="source code">
Jupiter is the largest planet and is 2.5 times the mass of all 
the other planets put together.
Saturn has the most moons and has 82 moons.
Uranus spins on its side with its axis at nearly a right angle to the Sun.</pre>
			<p>The following are some scree<a id="_idTextAnchor254"/>nshots of how the UI might look to achieve the requirements of the ap<a id="_idTextAnchor255"/>p you need <a id="_idIndexMarker314"/><span class="No-Break">to build:</span></p>
			<p><span class="No-Break"><strong class="bold">Questions screen</strong></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer093" class="IMG---Figure">
					<img src="image/B19411_03_20.jpg" alt="Figure 3.19 – Planet Quiz questi﻿ons screen"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.19 – Planet Quiz questi<a id="_idTextAnchor256"/>ons screen</p>
			<p><strong class="bold">Answer </strong><span class="No-Break"><strong class="bold">options screen</strong></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer094" class="IMG---Figure">
					<img src="image/B19411_03_21.jpg" alt="Figure 3.20 – Planet Quiz multiple-choice answer screen"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.20 – Planet Quiz multiple-choice answer screen</p>
			<p><span class="No-Break"><strong class="bold">Answer screen</strong></span><span class="No-Break">:</span></p>
			<div>
				<div id="_idContainer095" class="IMG---Figure">
					<img src="image/B19411_03_22.jpg" alt="Figure 3.21 – Planet Quiz answer screen with detailed answer"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 3.21 – Planet Quiz answer screen with detailed answer</p>
			<p>The following<a id="_idIndexMarker315"/> steps will help to complete <span class="No-Break">the activity:</span></p>
			<ol>
				<li>Create an Android project with an <span class="No-Break"><strong class="source inline">Empty Activity</strong></span><span class="No-Break">.</span></li>
				<li>Update the <strong class="source inline">strings.xml</strong> file with the entries you need for <span class="No-Break">the project.</span></li>
				<li>Amend the <strong class="source inline">themes.xml</strong> file with styles for <span class="No-Break">the project.</span></li>
				<li>Create a <strong class="source inline">QuestionsFragment</strong>, update the layout with the questions, and add interaction with buttons <span class="No-Break">and </span><span class="No-Break"><strong class="source inline">OnClickListener</strong></span><span class="No-Break">(s).</span></li>
				<li>Optionally, create a multiple-choice fragment and add answer options and button-click handling (this can also be done by adding the possible answer options <span class="No-Break">to </span><span class="No-Break"><strong class="source inline">QuestionsFragment</strong></span><span class="No-Break">).</span></li>
				<li>Create an <strong class="source inline">AnswersFragment</strong> that displays the relevant question’s answer and also displays more details about the <span class="No-Break">answer itself.</span></li>
			</ol>
			<p class="callout heading">Note</p>
			<p class="callout">The solution to this activity can be found <span class="No-Break">at </span><a href="https://packt.link/By7eE"><span class="No-Break">https://packt.link/By7eE</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-78"><a id="_idTextAnchor257"/>Summary</h1>
			<p>This chapter has covered fragments in depth, starting with learning about the fragment lifecycle and the key functions to override in your own fragments. We then moved on to adding simple fragments statically to an app in XML and demonstrating how the UI display and logic can be self-contained in individual fragments. Other options for how to add fragments to an app using a <strong class="source inline">FragmentContainerView</strong> and dynamically adding and replacing fragments were then covered. We then f<a id="_idTextAnchor258"/>inished with how this can be simplified by using the Jetpack <span class="No-Break"><strong class="source inline">Navigation</strong></span><span class="No-Break"> component.</span></p>
			<p>Fragments are one of the fundamental building blocks of Android development. The concepts you have learned about here will allow you to build upon them and progress to create increasingly more advanced apps. Fragments are at the core of building effective navigation into your apps in order to bind features and functionality that are simple and easy <span class="No-Break">to use.</span></p>
			<p>The next chapter will explore this area in detail by using established UI patterns to build clear and consistent navigation and illustrate how fragments are used to <span class="No-Break">enable this.</span></p>
		</div>
	</body></html>