<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch11"/>Chapter 11. Platform Differences, Device Information, and Quirks</h1></div></div></div><p>In this chapter, we will cover:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Gathering information about your device</li><li class="listitem" style="list-style-type: disc">Obtaining the device's screen dimensions</li><li class="listitem" style="list-style-type: disc">Understanding device orientation modes</li><li class="listitem" style="list-style-type: disc">Coding around differences between the iOS and Android APIs</li><li class="listitem" style="list-style-type: disc">Ensuring your device can make phone calls</li></ul></div><div><div><div><div><h1 class="title"><a id="ch11lvl1sec01"/>Introduction</h1></div></div></div><p>In this chapter, we are going to go through a number of platform differences between iOS and Android, as well as show you how to code around these differences. We'll also highlight how to gather information about the device your application is running on, including its screen dimensions and capabilities, such as the ability to make a phone call.</p><div><h3 class="title"><a id="note71"/>Note</h3><p>The complete source code for this entire chapter can be found in the<code class="literal"> /Chapter 11/PlatformDiffs</code> folder.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec02"/>Gathering information about your device</h1></div></div></div><p>The majority of information about the current device is available through the<code class="literal"> Titanium.Platform</code> namespace. It is here that we can determine a host of device-specific data, including the battery level, device OS and version, current device language, the screen resolution, and more. Knowing this information is important, as it will give you a series of clues as to what is happening on the physical device. One example is that you may wish to back up a user's application data if the battery dips below a certain percentage, in case the device was to shut down and data was lost. More commonly, you will use device properties such as<code class="literal"> Titanium.Platform.osname</code> to determine what operating system your app is currently running under, such as iPhone, iPad, or Android.<a id="id380" class="indexterm"/>
</p><div><div><div><div><h2 class="title"><a id="ch11lvl2sec01"/>Getting ready</h2></div></div></div><p>To prepare for this recipe, open up Titanium Studio and log in if you have not already done so. If you need to register a new account, you can do so for free directly from within the application. Once you are logged in, click on<strong> New Project</strong>, and the details window for creating a new project will appear. Enter in<strong> PlatformDiffs</strong> as the name of the app, and fill in the rest of the details with your own information. Open the<code class="literal"> app.js</code> file and remove everything apart from the instantiation of the root window and the<code class="literal"> win1</code> object's open method, so that it looks like the following:<a id="id381" class="indexterm"/>
</p><div><pre class="programlisting">//
// create root window
//
var win1 = Titanium.UI.createWindow({
title:'Tab 1',
backgroundColor:'#fff'
});
//open root window
win1.open();
</pre></div><div><h3 class="title"><a id="note72"/>Note</h3><p>The complete source code for this recipe can be found in the<code class="literal"> /Chapter 11/Recipe 1</code> folder.</p></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec02"/>How to do it…</h2></div></div></div><p>Now, back in the<code class="literal"> app.js</code> file, we are going to simply create a number of labels and request the values for each from the properties available to us in the<code class="literal"> Titanium.Platform</code> namespace. These values will then be displayed as text on-screen:</p><div><pre class="programlisting">var labelOS = Titanium.UI.createLabel({
width: 'auto',
height: 30,
top: 0,
left: 10,
font: {fontSize: 14, fontFamily: 'Helvetica'},
color: '#000',
text: 'OS Details: ' + Titanium.Platform.osname + ' (version ' + Titanium.Platform.version + ')'
});
var labelBattery = Titanium.UI.createLabel({
width: 'auto',
height: 30,
top: 40,
left: 10,
font: {fontSize: 14, fontFamily: 'Helvetica'},
color: '#000',
text: 'Battery level: ' + Titanium.Platform.batteryLevel
});
var labelMemory = Titanium.UI.createLabel({
width: 'auto',
height: 30,
top: 80,
left: 10,
font: {fontSize: 14, fontFamily: 'Helvetica'},
color: '#000',
text: 'Available memory: ' + Titanium.Platform.availableMemory + 'MB'
});
var labelArchitecture = Titanium.UI.createLabel({
width: 'auto',
height: 30,
top: 120,
left: 10,
font: {fontSize: 14, fontFamily: 'Helvetica'},
color: '#000',
text: 'Architecture: ' + Titanium.Platform.architecture
});
var labelLocale = Titanium.UI.createLabel({
width: 'auto',
height: 30,
top: 160,
left: 10,
font: {fontSize: 14, fontFamily: 'Helvetica'},
color: '#000',
text: 'Locale: ' + Titanium.Platform.locale
});
var labelModel = Titanium.UI.createLabel({
width: 'auto',
height: 30,
top: 200,
left: 10,
font: {fontSize: 14, fontFamily: 'Helvetica'},
color: '#000',
text: 'Model: ' + Titanium.Platform.model
});
win1.add(labelOS);
win1.add(labelBattery);
win1.add(labelMemory);
win1.add(labelArchitecture);
win1.add(labelLocale);
win1.add(labelModel);
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec03"/>How it works…</h2></div></div></div><p>Each of the labels in this code sample represents a different piece of information about your device and its capabilities. There is nothing particularly complicated about the code here but it's the methods themselves that are important.<a id="id382" class="indexterm"/>
</p><p>Most of these are pretty self-explanatory. The methods for Battery, Memory, Architecture, and Model all provide you with information about the device and its specific capabilities. You may use these at certain times during your application's lifecycle, for instance, auto-saving data on a form when the battery reaches a certain critical level.</p><p>The most useful of all of these methods is<code class="literal"> Titanium.Platform.osname</code>. It is this method that you will use constantly throughout the development of a Titanium cross-platform app as you will use it to check whether you're on iPhone or the Android platform, as seen in the following screenshot, and run certain code depending on that result.</p><div><img src="img/3968_11_06.jpg" alt="How it works…"/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec03"/>Obtaining the device's screen dimensions</h1></div></div></div><p>While we developers are currently very lucky with the iPhone platform and its single resolution of 320x480 pixels, the same can't be said for Android. It is the Android platform in particular that, due to the way it's distributed among many manufacturers, has a number of differing screen ratios and resolutions. It is inevitable that there will be times where you may need to calculate the position of an object depending on the size of the current screen, without constantly resorting to a series of<code class="literal"> Titanium.Platform.osname</code> checks.<a id="id383" class="indexterm"/>
</p><div><h3 class="title"><a id="note73"/>Note</h3><p>Since the introduction of the iPhone 4, all new iOS devices have a retina display. Essentially, the screen resolution is still at 320x480 but the DPI is doubled, meaning the effective resolution is actually 640x960. Implementing for both these resolutions is very easy. Simply name all of your image files as normal, and then all of the double resolution files are named in the same way with the addition of an<code class="literal"> @2x</code> flag. So if you had an image called<code class="literal"> header.png</code>, which is designed for 320x480, you can create an image of double the size and name it<code class="literal"> header@2x.png</code> and this will automatically be picked up by all iOS retina displays.</p></div><p>In this recipe, we will generate three views, one that takes up the bottom half of the screen, and another two that take up only the top. We'll do this using the<code class="literal"> Titanium.Platform.displayCaps</code> functions.<a id="id384" class="indexterm"/>
</p><div><h3 class="title"><a id="note74"/>Note</h3><p>The complete source code for this recipe can be found in the<code class="literal"> /Chapter 11/Recipe 2</code> folder.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec04"/>How to do it…</h2></div></div></div><p>In your<code class="literal"> app.js</code> file, we are going to create three different views, each taking up a separate portion of the screen. Remove any existing code and type in the following:</p><div><pre class="programlisting">//
// create root window
//
var win1 = Titanium.UI.createWindow({
title:'Tab 1',
backgroundColor:'#fff'
});
var windowWidth = Titanium.Platform.displayCaps.platformWidth;
var windowHeight = Titanium.Platform.displayCaps.platformHeight;
var viewBottom = Titanium.UI.createView({
width: windowWidth,
height: windowHeight / 2,
bottom: 0,
left: 0,
backgroundColor: 'Red'
});
win1.add(viewBottom);
var lblDeviceDPI = Titanium.UI.createLabel({
text: 'The device DPI = ' +
Titanium.Platform.displayCaps.dpi,
width: windowWidth,
height: windowHeight / 2,
textAlign: 'center',
bottom: 0,
color: '#fff'
});
viewBottom.add(lblDeviceDPI);
var viewTop1 = Titanium.UI.createView({
width: windowWidth / 2,
height: windowHeight / 2,
top: 0,
left: 0,
backgroundColor: 'Green'
});
win1.add(viewTop1);
var viewTop2 = Titanium.UI.createView({
width: windowWidth / 2,
height: windowHeight / 2,
top: 0,
left: windowWidth / 2,
backgroundColor: 'Blue'
});
win1.add(viewTop2);
//open root window
win1.open();
</pre></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec05"/>How it works…</h2></div></div></div><p>The code here is pretty straightforward. Put simply, we are assigning the width and height values of the device to the two variables called<code class="literal"> windowWidth</code> and<code class="literal"> windowHeight</code>. To do this, we are using two of the properties available to us in the<code class="literal"> Titanium.Platform.displayCaps</code> namespace; namely<code class="literal"> platformWidth</code> and<code class="literal"> platformHeight</code>. Once we have these values it's easy to then create our views and lay them out using some very simple calculations.<a id="id385" class="indexterm"/>
</p><p>The following is an example of the same screen being rendered in two very different resolutions on both the iPhone and Android:</p><div><img src="img/3968_11_01.jpg" alt="How it works…"/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec04"/>Understanding device orientation modes</h1></div></div></div><p>One of the great benefits to users with current smartphones is the ability to hold the device in any way possible and have the screen rotate to suit its orientation. Titanium allows you to fire event handlers based on orientation changes in your application.<a id="id386" class="indexterm"/>
</p><p>In this recipe, we will create an event handler that fires whenever the orientation on the device is changed, and we will re-arrange some UI components on our screen accordingly.</p><div><h3 class="title"><a id="note75"/>Note</h3><p>The complete source code for this recipe can be found in the<code class="literal"> /Chapter 11/Recipe 3</code> folder.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec06"/>How to do it…</h2></div></div></div><p>Open your<code class="literal"> app.js</code> file, remove any existing code, and type in the following:<a id="id387" class="indexterm"/>
</p><div><pre class="programlisting">//
// create root window
//
var win1 = Titanium.UI.createWindow({
title:'Tab 1',
backgroundColor:'#fff'
});
//set the allowed orientation modes for win1
//in this example, we'll say ALL modes are allowed
win1.orientationModes = [
Titanium.UI.LANDSCAPE_LEFT,
Titanium.UI.LANDSCAPE_RIGHT,
Titanium.UI.PORTRAIT,
Titanium.UI.UPSIDE_PORTRAIT
];
var view1 = Titanium.UI.createView({
width: Titanium.Platform.displayCaps.platformWidth,
height: Titanium.Platform.displayCaps.platformHeight,
backgroundColor: 'Blue'
});
var labelOrientation = Titanium.UI.createLabel({
text: 'Currently in ? mode',
width: '100%',
textAlign: 'center',
height: 30,
color: '#000'
});
view1.add(labelOrientation);
win1.add(view1);
Ti.Gesture.addEventListener('orientationchange', function(e) {
//check for landscape modes
if (e.orientation == Titanium.UI.LANDSCAPE_LEFT ||
e.orientation == Titanium.UI.LANDSCAPE_RIGHT) {
view1.width =
Titanium.Platform.displayCaps.platformWidth;
view1.height =
Titanium.Platform.displayCaps.platformHeight;
labelOrientation.text = 'Currently in LANDSCAPE mode';
view1.backgroundColor = 'Blue';
}
else {
//we must be in portrait mode!
view1.width =
Titanium.Platform.displayCaps.platformWidth;
view1.height =
Titanium.Platform.displayCaps.platformHeight;
labelOrientation.text = 'Currently in PORTRAIT mode';
view1.backgroundColor = 'Yellow';
}
});
//open root window
win1.open();
</pre></div><div><img src="img/3968_11_02.jpg" alt="How to do it…"/></div><p>Try running your app now in the emulator or on your device, and orientating the screen between landscape and potrait modes. You should see changes like those in the previous screenshot!</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec07"/>How it works…</h2></div></div></div><p>We are attaching an event listener into the<code class="literal"> Ti.Gesture</code> and once the orientation of the device changes this event handler is fired and we can re-arrange the components on the screen as we see fit. Technically, we can really do anything we want within this handler. A great example might be having a<code class="literal"> TableView</code> whilst in portrait mode and opening a new window containing a<code class="literal"> MapView</code> when the user orientates the screen into landscape mode. Here we are simply changing both the colour of our main view object and the text property of the label contained within it in order to highlight the changes in the device orientation.<a id="id388" class="indexterm"/>
</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec05"/>Coding around differences between the iOS and Android APIs</h1></div></div></div><p>Although Appcelerator Titanium makes much of the hard work of integrating with numerous operating systems and devices invisible to you, the developer, there are going to be times when you simply have to write some code that is platform specific. The most common way to do this is by checking the<code class="literal"> osname</code> property from the<code class="literal"> Titanium.Platform</code> namespace.<a id="id389" class="indexterm"/>
</p><p>In this recipe we will create a simple screen the shows a custom activity indicator when the device is an iPhone, and a standard indicator when the user is on an Android device.</p><div><h3 class="title"><a id="note76"/>Note</h3><p>The complete source code for this recipe can be found in the<code class="literal"> /Chapter 11/Recipe 4</code> folder.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec08"/>How to do it…</h2></div></div></div><p>Open your<code class="literal"> app.js</code> file, remove any existing code, and type in the following:</p><div><pre class="programlisting">// create root window
var win1 = Titanium.UI.createWindow({
title: 'Tab 1',
backgroundColor: '#fff'
});
///this next bit is a custom activity indicator for iphone
///due to too many diffs between android and ios ones
var actIndIphone = Titanium.UI.createView({
width: 320,
height: 480,
backgroundColor: '#000',
opacity: 0.75,
visible: false
});
var actIndBg = Titanium.UI.createView({
width: 280,
height: 50,
backgroundColor: '#000',
opacity: 1,
borderRadius: 5
});
var indicatorIphone = Titanium.UI.createActivityIndicator({
width: 30,
height: 30,
left: 10,
top: 10,
color: '#fff',
style: 1
});
actIndBg.add(indicatorIphone);
var actIndLabel = Titanium.UI.createLabel({
left: 50,
width: 220,
height: 'auto',
textAlign: 'left',
text: 'Please wait, loading iPhone...',
color: '#fff',
font: {fontSize: 12, fontFamily: 'Helvetica'}
});
actIndBg.add(actIndLabel);
actIndIphone.add(actIndBg);
win1.add(actIndIphone);
//the important bit!
//check if platform is android and if so, show a normal dialog
//else show our custom iPhone one
if(Ti.Platform.osname == 'android')
{
var indicatorAndroid = Titanium.UI.createActivityIndicator({
title: 'Loading',
message: 'Please wait, loading Android...'
});
indicatorAndroid.show();
}
else
{
actIndIphone.visible = true;
indicatorIphone.show();
}
//open root window
win1.open();
</pre></div><p>Now run your application in both the Android and iPhone simulators. You should be able to tell that the code we wrote has recognized which platform you're running and is displaying an activity indicator differently on each.<a id="id390" class="indexterm"/>
</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec09"/>How it works…</h2></div></div></div><p>This simple recipe shows you how to code around differences in the two platforms using the simplest of "if" statements, namely by checking the<code class="literal"> osname</code> of the current device using the<code class="literal"> Titanium.Platform.osname</code> property. We have put this check to good use by only displaying our custom activity indicator view when we're on an iPhone. On the Android platform, this is unnecessary as the activity indicator will appear as a modal view on screen above all others simply by using its<code class="literal">".show()"</code> method.</p><p>You can use this property to check the platform whenever you need to display a separate UI component or integrate with a platform independent API. An example of this recipe running on each device is shown in the following screenshot:</p><div><img src="img/3968_11_05.jpg" alt="How it works…"/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec06"/>Ensuring your device can make phone calls</h1></div></div></div><p>With all of the technical wizardry and touch-screen goodness that are now packed into modern day smartphones, it's easy to forget that their primary function is still that of a telephone which is capable of making and receiving voice calls. However, there may be times when the user's device is not capable of performing a call for whatever reason (poor network service, lack of call functionality that is iPod touch user, and so on).<a id="id391" class="indexterm"/>
</p><p>In this recipe, we will attempt to make a phone call by first checking on the device's capabilities and throwing an error message when this is not possible.</p><div><h3 class="title"><a id="note77"/>Note</h3><p>The complete source code for this recipe can be found in the<code class="literal"> /Chapter 11/Recipe 5</code> folder.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec10"/>How to do it…</h2></div></div></div><p>Open your<code class="literal"> app.js</code> file, remove any existing code, and type in the following:<a id="id392" class="indexterm"/>
</p><div><pre class="programlisting">// create root window
var win1 = Titanium.UI.createWindow({
title: 'Tab 1',
backgroundColor: '#fff'
});
//create the textfield number entry to dial
var txtNumber = Titanium.UI.createTextField({
top: 20,
left: 20,
height: 40,
width: 280,
hintText: '+44 1234 321 231',
borderStyle: 1
});
win1.add(txtNumber);
//create our call button
var btnCall = Titanium.UI.createButton({
top: 90,
left: 20,
width: 280,
height: 40,
title: 'Call Now!'
});
//attempt a phone call
btnCall.addEventListener('click', function(e){
if(txtNumber.value != '')
{
if(Titanium.Platform.osname != 'ipad'
&amp;&amp; Titanium.Platform.model != 'iPod Touch'
&amp;&amp; Titanium.Platform.model != 'google_sdk'
&amp;&amp; Titanium.Platform.model != 'Simulator')
{
Titanium.Platform.openURL('tel:' + txtNumber.value);
}
else
{
alert("Sorry, your device is not capable of making calls.");
}
}
else
{
alert("You must provide a valid phone number!");
}
});
win1.add(btnCall);
//open root window
win1.open();
</pre></div><p>Run your application now either in the simulator or on a device not capable of making calls, such as an iPod Touch. You should see an alert appear stating that the device can not action the requested phone call.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec11"/>How it works…</h2></div></div></div><p>Here we are simply using the Titanium Platform namespace to determine what kind of device the user is currently using, and providing an error message when that device is of the type iPod, iPad, or the emulator, as seen in the following screenshot. If the device in question is capable of making phone calls, such as the iPhone or an Android smartphone, then the device's phone API is called via means of a special URL request:<a id="id393" class="indexterm"/>
</p><div><pre class="programlisting">//must be a valid number, e.g. 'tel:07427555122'
Titanium.Platform.openURL('tel:' + txtNumber.value);
</pre></div><p>As long as the phone number being passed is valid, the device will launch the calling screen and attempt to place the call on the user's behalf.</p><div><img src="img/3968_11_03.jpg" alt="How it works…"/></div></div></div></body></html>