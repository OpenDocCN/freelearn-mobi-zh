<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Setting Up Your Workspace"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Setting Up Your Workspace</h1></div></div></div><p>The first chapter of this book will teach you the basics of the Arduino and Android development so that you can be sure you have the basics required for the more advanced tutorials you will find in the rest of this book.</p><p>On the Arduino side, we will build a very simple project with a relay module (which is basically a switch that can be controlled with Arduino) and a temperature and humidity sensor. We will also see the basics of the Arduino IDE and the basic commands of the aREST library, which is a framework to easily control Arduino boards. We will use this library in several chapters of this book to make it really easy to control the Arduino board from an Android device. In this first chapter, we will simply try out the commands of the aREST library by having the Arduino board connected to your computer via a USB.</p><p>From the Android development point of view, we will work together to set up a development environment and ensure that your computer and the Android device are ready for development purposes. We will start off with a simple Android app that displays the legendary text, <span class="strong"><strong>Hello World</strong></span>.</p><p>Android Studio is an IntelliJ-based<a id="id0" class="indexterm"/> <span class="strong"><strong>Integrated Development Environment</strong></span> (<span class="strong"><strong>IDE</strong></span>) fully supported by the Android development team, which will provide you with the necessary tools and resources to make sure that you develop a functional and aesthetic Android app.</p><p>
<span class="strong"><strong>Android Studio</strong></span> <a id="id1" class="indexterm"/>is in beta but the software is updated on a frequent and regular basis by a dedicated team at Google, which makes it the natural choice to develop our Android projects.</p><div class="section" title="Hardware and software requirements"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Hardware and software requirements</h1></div></div></div><p>The first thing <a id="id2" class="indexterm"/>you will need is an <a id="id3" class="indexterm"/>Arduino Uno board. We will use this board<a id="id4" class="indexterm"/> throughout this book to connect sensors, actuators, and wireless modules and make them interact with Android. Then, we will need a relay module. A relay is basically an electrical switch that we can command from Arduino, which can allow us to control devices such as lamps. This project uses a 5V relay module from <a id="id5" class="indexterm"/>Polulu, which properly integrates a relay on a <a id="id6" class="indexterm"/>board, along with all the required components to control the relay from Arduino. The following is the image of the relay module that was used in this chapter:</p><div class="mediaobject"><img src="graphics/0389OS_01_01.jpg" alt="Hardware and software requirements"/></div><p>You will also need a DHT11 (or DHT22) sensor, along with a 4.7K resistor, for temperature and <a id="id7" class="indexterm"/>humidity measurements. A resistor is basically a device to limit the current flowing into an electrical device. Here, it is necessary to ensure the correct functioning of the DHT sensor.</p><p>Finally, you will need a small breadboard and jumper wires to make the different hardware connections.</p><p>The following is the list of all hardware parts you will need for this project, along with links to find these parts on the Web:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <a id="id8" class="indexterm"/>Arduino Uno board (<a class="ulink" href="http://www.adafruit.com/product/50">http://www.adafruit.com/product/50</a>)</li><li class="listitem" style="list-style-type: disc">The <a id="id9" class="indexterm"/>5V relay module (<a class="ulink" href="http://www.pololu.com/product/2480">http://www.pololu.com/product/2480</a>)</li><li class="listitem" style="list-style-type: disc">The <a id="id10" class="indexterm"/>DHT11 sensor and <a id="id11" class="indexterm"/>4.7K Ohm resistor (<a class="ulink" href="https://www.adafruit.com/product/386">https://www.adafruit.com/product/386</a>)</li><li class="listitem" style="list-style-type: disc">The <a id="id12" class="indexterm"/>breadboard (<a class="ulink" href="https://www.adafruit.com/product/64">https://www.adafruit.com/product/64</a>)</li><li class="listitem" style="list-style-type: disc">Jumper<a id="id13" class="indexterm"/> wires (<a class="ulink" href="https://www.adafruit.com/product/758">https://www.adafruit.com/product/758</a>)</li></ul></div><p>On the software side, you <a id="id14" class="indexterm"/>will need the Arduino IDE that we will also use in the rest of this book. You can get it at <a class="ulink" href="http://arduino.cc/en/Main/Software">http://arduino.cc/en/Main/Software</a>.</p><p>The installation process of the IDE is very simple; you simply have to open the file and follow the onscreen instructions.</p><p>You will need the library for the <a id="id15" class="indexterm"/>DHT11 sensor, which can be found at <a class="ulink" href="https://github.com/adafruit/DHT-sensor-library">https://github.com/adafruit/DHT-sensor-library</a>.</p><p>You will also need the aREST library<a id="id16" class="indexterm"/> found at <a class="ulink" href="https://github.com/marcoschwartz/aREST">https://github.com/marcoschwartz/aREST</a>.</p><p>To install a given library, simply <a id="id17" class="indexterm"/>extract the folder in your <code class="literal">Arduino/libraries</code> folder (or create this folder if it doesn't exist yet). Your <code class="literal">Arduino</code> folder is where all the sketches are stored, and you can define this folder in the preferences of the Arduino IDE.</p><p>Preparing for Android development requires that we get ready to design and develop the app, and the following checklist will guide you with having the basics ready for any project:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Java Developer Kit Version 6 (or higher)</li><li class="listitem" style="list-style-type: disc">Android Studio</li><li class="listitem" style="list-style-type: disc">Android Software Development Kit</li><li class="listitem" style="list-style-type: disc">Android Device with Bluetooth SMART technology</li></ul></div><p>We will also work together to make sure that you have everything properly set up.</p></div></div>
<div class="section" title="Installing Java Developer Kit"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Installing Java Developer Kit</h1></div></div></div><p>Android Studio <a id="id18" class="indexterm"/>will <a id="id19" class="indexterm"/>not work without <span class="strong"><strong>Java Developer Kit</strong></span> (<span class="strong"><strong>JDK</strong></span>); therefore, it's necessary to know what Java version you have installed (in this particular case, the Java Runtime Environment will not be enough).</p><div class="section" title="Checking the JDK version"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec08"/>Checking the JDK version</h2></div></div></div><p>It is <a id="id20" class="indexterm"/>mandatory that you check the version of your JDK for compatibility purposes.</p><div class="section" title="Mac"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec01"/>Mac</h3></div></div></div><p>Open Terminal <a id="id21" class="indexterm"/>and type the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>java –version</strong></span>
</pre></div><p>This is what will be shown on the screen:</p><div class="mediaobject"><img src="graphics/0389OS_01_02.jpg" alt="Mac"/></div></div><div class="section" title="Windows"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec02"/>Windows</h3></div></div></div><p>Open <a id="id22" class="indexterm"/>Command Prompt and type the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>java -version</strong></span>
</pre></div><p>This is what will be shown on the screen:</p><div class="mediaobject"><img src="graphics/0389OS_01_03.jpg" alt="Windows"/></div></div></div><div class="section" title="Installing Java"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec09"/>Installing Java</h2></div></div></div><p>If you do not <a id="id23" class="indexterm"/>have Java installed, or if your version is below 6.0, install the <a id="id24" class="indexterm"/>Java JDK <a id="id25" class="indexterm"/>by clicking on the following customized and shortened link and choosing the version that applies for you:</p><p>
<a class="ulink" href="http://j.mp/javadevkit-download">http://j.mp/javadevkit-download</a>
</p><p>The following window will open:</p><div class="mediaobject"><img src="graphics/0389OS_01_04.jpg" alt="Installing Java"/></div><p>The main recommendation for these projects is that you install a version of JDK 6.0 or higher.</p><p>Select the <a id="id26" class="indexterm"/>JDK <a id="id27" class="indexterm"/>for your operating system. On an Intel-based Mac, you can follow<a id="id28" class="indexterm"/> this useful table to see whether your Mac is 32-bit or 64-bit:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Processor Name</p>
</th><th style="text-align: left" valign="bottom">
<p>32- or 64-bit processor</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Intel Core Solo</p>
</td><td style="text-align: left" valign="top">
<p>32 bit</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Intel Core Duo</p>
</td><td style="text-align: left" valign="top">
<p>32 bit</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Intel Core 2 Duo</p>
</td><td style="text-align: left" valign="top">
<p>64 bit</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Intel Quad-Core Xeon</p>
</td><td style="text-align: left" valign="top">
<p>64 bit</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Dual-Core Intel Xeon</p>
</td><td style="text-align: left" valign="top">
<p>64 bit</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Quad-Core Intel Xeon</p>
</td><td style="text-align: left" valign="top">
<p>64 bit</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Core i3</p>
</td><td style="text-align: left" valign="top">
<p>64 bit</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Core i5</p>
</td><td style="text-align: left" valign="top">
<p>64 bit</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Core i7</p>
</td><td style="text-align: left" valign="top">
<p>64 bit</p>
</td></tr></tbody></table></div><p>You can check for <span class="strong"><strong>Processor Name</strong></span> by clicking on the Apple logo in the top-left corner of your screen followed by <span class="strong"><strong>About my Mac</strong></span>.</p><p>In the case of Windows, to see whether your computer is running a 32-bit or 64-bit version of <a id="id29" class="indexterm"/>Windows, you need to do the following:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click on <a id="id30" class="indexterm"/>the Start button.</li><li class="listitem">Right-click <a id="id31" class="indexterm"/>on <span class="strong"><strong>My Computer</strong></span>, and then click on <span class="strong"><strong>Properties</strong></span>. If <span class="strong"><strong>x64 edition</strong></span> is listed under system, your processor is capable of running 64-bit-enabled applications.</li></ol></div></div></div>
<div class="section" title="Installing Android Studio"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Installing Android Studio</h1></div></div></div><p>Let's see <a id="id32" class="indexterm"/>how we install <a id="id33" class="indexterm"/>Android Studio on Mac and Windows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to the <a id="id34" class="indexterm"/>Android Developers site at <a class="ulink" href="http://developer.android.com">http://developer.android.com</a>. The following screen will appear:<div class="mediaobject"><img src="graphics/0389OS_01_05.jpg" alt="Installing Android Studio"/></div></li><li class="listitem">Click on <span class="strong"><strong>Android Studio</strong></span>; you will be directed to the landing page where your operating system version will be detected automatically, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/0389OS_01_06.jpg" alt="Installing Android Studio"/></div></li><li class="listitem">Accept<a id="id35" class="indexterm"/> the <span class="strong"><strong>Terms and Conditions</strong></span> of the software use agreement:<div class="mediaobject"><img src="graphics/0389OS_01_07.jpg" alt="Installing Android Studio"/></div></li></ol></div><div class="section" title="Mac"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>Mac</h2></div></div></div><p>Double-click <a id="id36" class="indexterm"/>on the downloaded file, follow the prompts, and then drag the Android Studio icon into your <code class="literal">Applications</code> folder:</p><div class="mediaobject"><img src="graphics/0389OS_01_08.jpg" alt="Mac"/></div></div><div class="section" title="Windows"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>Windows</h2></div></div></div><p>Open<a id="id37" class="indexterm"/> the downloaded file, and then go through the following <span class="strong"><strong>Android Studio Setup Wizard</strong></span> window to complete the installation process:</p><div class="mediaobject"><img src="graphics/0389OS_01_09.jpg" alt="Windows"/></div></div></div>
<div class="section" title="Setting up the Android Software Development Kit"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Setting up the Android Software Development Kit</h1></div></div></div><p>The process of setting up<a id="id38" class="indexterm"/> the Android <span class="strong"><strong>Software Development Kit</strong></span> (<span class="strong"><strong>SDK</strong></span>) has improved vastly with the introduction of Android Studio, as the latest SDKs come preinstalled with the Android Studio install package. In order to develop the projects detailed in the following chapters, it would be very helpful to understand how you can install (or even uninstall) SDKs within Android Studio.</p><p>There are a number of ways to access the <a id="id39" class="indexterm"/>
<span class="strong"><strong>SDK Manager</strong></span>. The most straightforward way is through the following Android Studio main toolbar:</p><div class="mediaobject"><img src="graphics/0389OS_01_10.jpg" alt="Setting up the Android Software Development Kit"/></div><p>Another option would be via the <span class="strong"><strong>Launch</strong></span> menu where you will be faced with the following options:</p><div class="mediaobject"><img src="graphics/0389OS_01_11.jpg" alt="Setting up the Android Software Development Kit"/></div><p>In order to access<a id="id40" class="indexterm"/> the SDK Manager, you will need to click on <span class="strong"><strong>Configure</strong></span>, where the following screen will appear, and then click on <span class="strong"><strong>SDK Manager</strong></span>:</p><div class="mediaobject"><img src="graphics/0389OS_01_12.jpg" alt="Setting up the Android Software Development Kit"/></div><p>The previous screenshot shows us what the SDK Manager looks like. If you need to install any packages, you need to check the mark of that particular package, click on <span class="strong"><strong>Install packages</strong></span>, and then finally accept the licenses, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/0389OS_01_13.jpg" alt="Setting up the Android Software Development Kit"/></div><div class="section" title="Setting up your physical Android device for development"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>Setting up your physical Android device for development</h2></div></div></div><p>The following<a id="id41" class="indexterm"/> are the three main steps that need to be executed in order to enable your Android device for development:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Enable <span class="strong"><strong>Developer options</strong></span> on your specific Android device.</li><li class="listitem">Enable <span class="strong"><strong>USB debugging</strong></span>.</li><li class="listitem">Entrust the computer with an installed IDE via secure USB debugging (devices with Android 4.4.2).</li></ol></div><div class="section" title="Enabling Developer options"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec03"/>Enabling Developer options</h3></div></div></div><p>Depending <a id="id42" class="indexterm"/>on your device, this option might vary slightly, but from Android 4.2 and higher, the <span class="strong"><strong>Developer options</strong></span> screen is hidden by default.</p><p>To make it available, go to <span class="strong"><strong>Settings</strong></span> | <span class="strong"><strong>About phone</strong></span> and tap on <span class="strong"><strong>Build number</strong></span> seven times. You will <a id="id43" class="indexterm"/>find <span class="strong"><strong>Developer options</strong></span> enabled by returning to the previous screen.</p></div><div class="section" title="Enabling USB debugging"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec04"/>Enabling USB debugging</h3></div></div></div><p>USB debugging <a id="id44" class="indexterm"/>enables the IDE to communicate with the device via the USB port. This can be activated after enabling <span class="strong"><strong>Developer options</strong></span> and is done by checking the <span class="strong"><strong>USB debugging</strong></span> option by navigating to <span class="strong"><strong>Settings</strong></span> | <span class="strong"><strong>Developer options</strong></span> | <span class="strong"><strong>Debugging</strong></span> | <span class="strong"><strong>USB debugging</strong></span>.</p></div><div class="section" title="Entrusting the computer with the installed IDE using secure USB debugging (devices with Android 4.4.2)"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec05"/>Entrusting the computer with the installed IDE using secure USB debugging (devices with Android 4.4.2)</h3></div></div></div><p>You have to accept the <a id="id45" class="indexterm"/>RSA key on your phone or tablet before anything can flow between the device via <span class="strong"><strong>Android Debug Bridge</strong></span> (<span class="strong"><strong>ADB</strong></span>). This is done by connecting the device to the computer via a USB, which triggers a notification entitled <span class="strong"><strong>Enable USB Debugging</strong></span>.</p><p>Check <span class="strong"><strong>Always allow from this Computer</strong></span> followed by clicking on <span class="strong"><strong>OK</strong></span>.</p></div></div></div>
<div class="section" title="Hardware configuration"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Hardware configuration</h1></div></div></div><p>For the <a id="id46" class="indexterm"/>first project of this book, there are only a few hardware connections to make. We simply need to connect the relay module and the DHT11 sensor to the Arduino board. </p><p>The following image summarizes the hardware connections for this chapter (with the DHT sensor on the left of the breadboard, and the relay module on the right):</p><div class="mediaobject"><img src="graphics/0389OS_01_14.jpg" alt="Hardware configuration"/></div><p>The first thing you <a id="id47" class="indexterm"/>need to do is to connect the power from the Arduino board to the power rails on the side of the breadboard. Connect the Arduino 5V pin to the red power rail on the breadboard, and the Arduino GND pin to the blue power rail on the breadboard.</p><p>For the DHT11 sensor, you first <a id="id48" class="indexterm"/>need to have a look at the pins configuration of the sensor by visiting <a class="ulink" href="http://www.rlocman.ru/i/Image/2012/09/06/DHT11_Pins.jpg">http://www.rlocman.ru/i/Image/2012/09/06/DHT11_Pins.jpg</a>.</p><p>You need to first connect the power supply; the VCC pin goes to the red power rail on the breadboard, and the GND pin goes to the blue power rail. You also need to connect the DATA pin to pin number 7 of the Arduino board. Finally, place the 4.7K Ohm resistor between the VCC and the DATA pin of the sensor.</p><p>For the relay module, you have three pins to connect: VCC, GND, and SIG. Connect the VCC pin to the red power rail on the breadboard, GND to the blue power rail, and finally, connect the SIG pin to Arduino pin 8.</p><p>The following is an image of the completely assembled project:</p><div class="mediaobject"><img src="graphics/0389OS_01_15.jpg" alt="Hardware configuration"/></div></div>
<div class="section" title="Learning to use the aREST library"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Learning to use the aREST library</h1></div></div></div><p>Now that our<a id="id49" class="indexterm"/> hardware is assembled, we are going to see the basics of the Arduino environment, and how to use the aREST library that we are going to use in several chapters of this book to control Arduino from an Android phone. </p><p>The <a id="id50" class="indexterm"/>aREST library will allow us to simply control the Arduino board externally using the same commands, whether it is using an USB cable, Bluetooth, or Wi-Fi. Without this library, we will have to rewrite the same code several times for all the chapters of the book. To find a complete documentation on the <a id="id51" class="indexterm"/>aREST library, you can visit <a class="ulink" href="https://github.com/marcoschwartz/aREST">https://github.com/marcoschwartz/aREST</a>.</p><p>The main window of the Arduino IDE is where you enter the code to program the Arduino board.</p><p>Arduino code files are usually <a id="id52" class="indexterm"/>called <span class="strong"><strong>sketches</strong></span>. The following screenshot is of the Arduino IDE with the code of this chapter already loaded:</p><div class="mediaobject"><img src="graphics/0389OS_01_16.jpg" alt="Learning to use the aREST library"/></div><p>You will basically<a id="id53" class="indexterm"/> use two buttons that you can find on the left-hand side of the toolbar. The first one, with the check sign, can <a id="id54" class="indexterm"/>be use to compile the code. The second one will be used to upload the code to the Arduino board. Note that if the code has not been compiled yet, the upload button will also compile the code before uploading.</p><p>The second important window of the Arduino IDE is called the <a id="id55" class="indexterm"/>
<span class="strong"><strong>serial monitor</strong></span>. This is where you can monitor what your Arduino project is doing, using the <code class="literal">Serial.print()</code> statements in the code to generate debug output. You can access it by clicking on the top-right icon of the Arduino IDE main window. </p><p>The following screenshot shows what the serial monitor looks like:</p><div class="mediaobject"><img src="graphics/0389OS_01_17.jpg" alt="Learning to use the aREST library"/></div><p>We are now going to build our first Arduino sketch in this book. What we want to achieve is simply to control the relay and read data from the DHT11 sensor. To do so, you are going to use the <a id="id56" class="indexterm"/>aREST library by sending <a id="id57" class="indexterm"/>commands from your computer. In the next chapter of this book, we are going to use the same commands but via a Bluetooth or Wi-Fi connection. The goal of this section is really to make you familiar with the commands of the aREST library.</p><p>The following code is the complete Arduino sketch for this part:</p><div class="informalexample"><pre class="programlisting">// Libraries
#include &lt;aREST.h&gt;
#include "DHT.h"

// DHT sensor
#define DHTPIN 7
#define DHTTYPE DHT11

// Create aREST instance
aREST rest = aREST();

// DHT instance
DHT dht(DHTPIN, DHTTYPE);

// Variables to be exposed to the API
int temperature;
int humidity;

void setup(void) {
  // Start Serial (with 115200 as the baud rate)
  Serial.begin(115200);
  
  // Expose variables to REST API
  rest.variable("temperature",&amp;temperature);
  rest.variable("humidity",&amp;humidity);
  
  // Give name and ID to device
  rest.set_id("001");
  rest.set_name("arduino_project");
  
  // Start temperature sensor
  dht.begin();
  
}

void loop() {  
  
  // Measure from DHT
  float h = dht.readHumidity();
  float t = dht.readTemperature();
  
  temperature = (int)t;
  humidity = (int)h;
  
  // Handle REST calls
  rest.handle(Serial);
  
}</pre></div><p>Let's explore the details <a id="id58" class="indexterm"/>of this Arduino sketch <a id="id59" class="indexterm"/>using the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The Arduino sketch starts by importing the required libraries for the project:<div class="informalexample"><pre class="programlisting">#include &lt;aREST.h&gt;
#include "DHT.h"</pre></div></li><li class="listitem">After that, we need to define on which pin the DHT11 sensor is connected to, and which is the type of the sensor:<div class="informalexample"><pre class="programlisting">#define DHTPIN 7
#define DHTTYPE DHT11</pre></div></li><li class="listitem">We also need to create an instance of the aREST library:<div class="informalexample"><pre class="programlisting">aREST rest = aREST();</pre></div></li><li class="listitem">We also need to create an instance of the DHT11 sensor so that we can measure data from it:<div class="informalexample"><pre class="programlisting">DHT dht(DHTPIN, DHTTYPE);</pre></div></li><li class="listitem">Finally, we <a id="id60" class="indexterm"/>need to create two variables that will contain our measurements:<div class="informalexample"><pre class="programlisting">int temperature;
int humidity;</pre></div></li><li class="listitem">In the <code class="literal">setup()</code> function of the sketch, we need to start the serial port:<div class="informalexample"><pre class="programlisting">Serial.begin(115200);</pre></div></li><li class="listitem">Next, we<a id="id61" class="indexterm"/> need to expose our two measurement variables so that we can access them via the serial port using the aREST library. Note that we have to pass the reference to these variables, not their values, as shown in the following code:<div class="informalexample"><pre class="programlisting">rest.variable("temperature",&amp;temperature);
rest.variable("humidity",&amp;humidity);</pre></div></li><li class="listitem">We also set an ID and name to our project. This will not play any role here, but is simply to identify our board in case we have many of them:<div class="informalexample"><pre class="programlisting">rest.set_id("001");
rest.set_name("arduino_project");</pre></div></li><li class="listitem">Finally, we start the DHT11 sensor:<div class="informalexample"><pre class="programlisting">dht.begin();</pre></div></li><li class="listitem">Now, in the <code class="literal">loop()</code> function of the sketch, we make the measurements from the DHT11 sensor, and convert these measurements to integers (which is called "casting" in C):<div class="informalexample"><pre class="programlisting">float h = dht.readHumidity();
float t = dht.readTemperature();

temperature = (int)t;
humidity = (int)h;</pre></div></li><li class="listitem">Note that here we are converting these numbers into integers because it is the only variable type supported by the aREST library. However, as the resolution of the DHT11 sensor is limited, we are not losing any information here. Finally, we handle any requests coming from the outside using the following code:<div class="informalexample"><pre class="programlisting">rest.handle(Serial);</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>Note that all the code for this chapter can be found in the GitHub repository of the book at the following link:</p><p>
<a class="ulink" href="https://github.com/marcoschwartz/arduino-android-blueprints">https://github.com/marcoschwartz/arduino-android-blueprints</a>
</p></div></div></li></ol></div><p>It's now time to upload <a id="id62" class="indexterm"/>the sketch to your <a id="id63" class="indexterm"/>Arduino board. If you have any error when compiling, make sure that you installed all the required Arduino libraries for this chapter.</p><p>When this is done, simply open the serial monitor (making sure the serial speed is set to <code class="literal">115200</code>). Note that you could do the same with your own serial terminal software, for example, CoolTerm<a id="id64" class="indexterm"/> found at <a class="ulink" href="http://freeware.the-meiers.org/">http://freeware.the-meiers.org/</a>.</p><p>Now, we are going to test that the aREST library is working correctly. Let's proceed with the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we are going to query the board for its ID and name. To do so, type the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>/id</strong></span>
</pre></div></li><li class="listitem">You should be greeted by the following answer:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>{"id": "001", "name": "arduino_project", "connected": true}</strong></span>
</pre></div></li><li class="listitem">We are now going to see how to control the relay, as this is something we are going to do several times in this book. First, we need to define that the relay pin, which is pin number 8 of the Arduino board, is an output. To do so, we can simply type:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>/mode/8/o</strong></span>
</pre></div></li><li class="listitem">You should receive the following answer on the serial monitor:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>{"message": "Pin D8 set to output", "id": "001", "name": "arduino_project", "connected": true}</strong></span>
</pre></div></li><li class="listitem">Now, to activate the relay, we need to set the pin 8 to a <code class="literal">HIGH</code> state. This is done the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>/digital/8/1</strong></span>
</pre></div></li><li class="listitem">You should instantly receive a confirmation message, and hear the relay click. To switch the relay off again, simply type the following code:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>/digital/8/0</strong></span>
</pre></div></li><li class="listitem">Now, we are going to read data from the board using the aREST library. For example, to read the temperature variable, you can simply type the following code:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>/temperature</strong></span>
</pre></div></li><li class="listitem">You will receive the following confirmation message with the value of the temperature:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>{"temperature": 28, "id": "001", "name": "arduino_project", "connected": true}</strong></span>
</pre></div></li><li class="listitem">You can do the same for humidity:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>/humidity</strong></span>
</pre></div></li><li class="listitem">You will receive a similar message back:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>{"humidity": 35, "id": "001", "name": "arduino_project", "connected": true}</strong></span>
</pre></div></li></ol></div><p>If this is <a id="id65" class="indexterm"/>working, congratulations! You now know the basics of the aREST library that we will use throughout the book. Note that <a id="id66" class="indexterm"/>for now we are using these commands via serial communications, but later in the book, we will first use the same commands via Bluetooth, and then via Wi-Fi to command the Arduino board from an Android device.</p><p>Now that we have seen how the aREST library is working, we are going to create our first Android project. Note that in this introductory chapter, we won't connect both together; this will be done in the next chapter of the book.</p></div>
<div class="section" title="Creating your first Android project"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Creating your first Android project</h1></div></div></div><p>In order to get <a id="id67" class="indexterm"/>started in the world of Android application projects, it would be very useful to set up a very basic project that goes through the two main processes in Android application development: coding the application and then testing it on an Android physical device.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div><div class="section" title="Setting up your first Hello Arduino project"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>Setting up your first Hello Arduino project</h2></div></div></div><p>Click on <span class="strong"><strong>New Project</strong></span> when <a id="id68" class="indexterm"/>Android Studio launches as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/0389OS_01_18.jpg" alt="Setting up your first Hello Arduino project"/></div><p>An important step <a id="id69" class="indexterm"/>within Android application development is configuring your project. This project will be using Android 4.3 as the minimum target SDK, since we intend to use the <a id="id70" class="indexterm"/>
<span class="strong"><strong>Bluetooth Low Energy API</strong></span>, which was introduced in this particular version of Android. In this case, we will name the project <code class="literal">Hello Arduino</code> and write down your company domain, as the convention for application package names is the reverse of your chosen domain.</p><p>Refer to the following screenshot:</p><div class="mediaobject"><img src="graphics/0389OS_01_19.jpg" alt="Setting up your first Hello Arduino project"/></div><p>For the purposes of this particular project, we will go ahead and choose the most basic project, <span class="strong"><strong>Blank Activity</strong></span>, as shown in the following screenshot. The<a id="id71" class="indexterm"/> other choices provide added functionality that we do not need at this stage.</p><div class="mediaobject"><img src="graphics/0389OS_01_20.jpg" alt="Setting up your first Hello Arduino project"/></div><p>In the following<a id="id72" class="indexterm"/> screenshot, we choose <span class="strong"><strong>Blank Activity</strong></span>, and we need to give a name to our main Java file. Let's keep it as <code class="literal">MyActivity</code>:</p><div class="mediaobject"><img src="graphics/0389OS_01_21.jpg" alt="Setting up your first Hello Arduino project"/></div><p>Once you follow through all the previous steps, you will be welcomed to this workspace, which gives a good <a id="id73" class="indexterm"/>overview of the project tree, main code editor, and the device that shows a preview of the <a id="id74" class="indexterm"/>
<span class="strong"><strong>User Interface</strong></span> (<span class="strong"><strong>UI</strong></span>), as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/0389OS_01_22.jpg" alt="Setting up your first Hello Arduino project"/></div><p>In this particular project, there will be no need to modify the existing code and therefore we will proceed with building our app and launching it on our physical Android device.</p></div><div class="section" title="Installing your app on your physical device"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>Installing your app on your physical device</h2></div></div></div><p>Previously, we <a id="id75" class="indexterm"/>have connected and enabled our physical Android device via a USB. Within Android Studio, we need to set up the configuration to run our Android application.</p><p>This is done by choosing <span class="strong"><strong>Editing Configurations</strong></span> from the main toolbar as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/0389OS_01_23.jpg" alt="Installing your app on your physical device"/></div><p>In the <span class="strong"><strong>Editing Configurations</strong></span> window, we will click on the + sign and choose <span class="strong"><strong>Android Application</strong></span> where we<a id="id76" class="indexterm"/> set up the configuration with the following settings and confirm them by pressing <span class="strong"><strong>OK</strong></span>:</p><div class="mediaobject"><img src="graphics/0389OS_01_24.jpg" alt="Installing your app on your physical device"/></div><p>After setting up everything, we are ready to run the app. Choose the <span class="strong"><strong>App</strong></span> configuration, which we previously set up, and press the <span class="strong"><strong>Play</strong></span> button (green triangle) as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/0389OS_01_25.jpg" alt="Installing your app on your physical device"/></div><p>There is the possibility of creating an<a id="id77" class="indexterm"/> <span class="strong"><strong>Android Virtual Device</strong></span> (<span class="strong"><strong>AVD</strong></span>) to install the application. However, at this point in time, there are no virtual emulators that support Bluetooth, which we <a id="id78" class="indexterm"/>will need for a number of projects in this book. So, we will focus on setting up your Android physical device running Android 4.3 or higher.</p><p>In the next step, choose your physical device and press <span class="strong"><strong>OK</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/0389OS_01_26.jpg" alt="Installing your app on your physical device"/></div><p>You should expect the following to show up on your Android device if you have set up everything in the correct manner:</p><div class="mediaobject"><img src="graphics/0389OS_01_27.jpg" alt="Installing your app on your physical device"/></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Summary</h1></div></div></div><p>Let's summarize what we did in this chapter of the book. We built a very simple Arduino project comprising an Arduino board, a relay module, and a temperature and humidity sensor. We saw how to connect these components together so that we can control the relay as an output and read data from the sensor. We also saw the basics of the aREST library, which we will use in the whole book to control the Arduino board from an Android device.</p><p>On the Android side, we have prepared our IDE and Android device for development, which will prepare us for the upcoming projects that we have prepared for you in this book and help us have a seamless experience. We also had the opportunity to compile our first app and get it up and running on our Android device.</p><p>At this stage, you can already repeat the steps we took in this chapter to really get familiar with the Arduino IDE, the commands of the aREST library, and the Android development environment. We will use these tools extensively in the rest of this book; so, it is crucial that are you familiar with them.</p></div></body></html>