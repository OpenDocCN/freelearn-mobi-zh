<html><head></head><body><div class="chapter" title="Chapter&#xA0;9.&#xA0;Graphics and Animation"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Graphics and Animation</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Scaling down large images to avoid Out of Memory exceptions</li><li class="listitem" style="list-style-type: disc">A transition animation – defining scenes and applying a transition</li><li class="listitem" style="list-style-type: disc">Creating a Compass using sensor data and RotateAnimation</li><li class="listitem" style="list-style-type: disc">Creating a slideshow with ViewPager</li><li class="listitem" style="list-style-type: disc">Creating a Card Flip Animation with Fragments</li><li class="listitem" style="list-style-type: disc">Creating a Zoom Animation with a Custom Transition</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec71"/>Introduction</h1></div></div></div><p>Animations<a id="id512" class="indexterm"/> can be both visually appealing and functional, as demonstrated with the simple button press. The graphical representation of the button press brings the app alive, plus it provides a functional value by giving the user a visual response to the event.</p><p>The Android Framework provides several animation systems to make it easier to include animations in your own application. They include the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>View Animation</strong></span>: (The original animation system.) It <a id="id513" class="indexterm"/>usually requires less code but has<a id="id514" class="indexterm"/> limited animation options</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Property Animation</strong></span>: It's a <a id="id515" class="indexterm"/>more flexible system allowing animation of any property of <a id="id516" class="indexterm"/>any object</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Drawable Animation</strong></span>: It uses <a id="id517" class="indexterm"/>drawable resources to <a id="id518" class="indexterm"/>create frame-by-frame animations (like a movie)</li></ul></div><p>The Property Animation system<a id="id519" class="indexterm"/> was introduced in Android 3.0, and it is usually preferred over View Animation because of the flexibility. The main drawbacks<a id="id520" class="indexterm"/> to View Animation include:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Limited aspects of what can be animated—such as scale and rotation</li><li class="listitem" style="list-style-type: disc">Can only animate the contents of the view—it cannot change where on the screen the view is drawn (so it cannot animate moving a ball across the screen)</li><li class="listitem" style="list-style-type: disc">Can only animate View objects</li></ul></div><p>Here is a simple example demonstrating<a id="id521" class="indexterm"/> a View Animation to "blink" a view (a simple simulation of a button press):</p><div class="informalexample"><pre class="programlisting">Animation blink =AnimationUtils.loadAnimation(this,R.anim.blink);
view.startAnimation(blink);</pre></div><p>Here are the contents for the <code class="literal">blink.xml</code> resource file, located in the <code class="literal">res/anim</code> folder:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;set &gt;
    &lt;alpha android:fromAlpha="1.0"
        android:toAlpha="0.0"
        android:background="#000000"
        android:interpolator="@android:anim/linear_interpolator"
        android:duration="100"
        android:repeatMode="restart"
        android:repeatCount="0"/&gt;
&lt;/set&gt;</pre></div><p>As you can see, it's very simple to create this animation, so if the View Animation accomplishes your goal, use it. When it doesn't meet your needs, turn to the Property Animation system. We'll demonstrate Property Animation using the new <code class="literal">objectAnimator</code> in the <span class="emphasis"><em>Creating a Card Flip Animation with Fragments</em></span> and <span class="emphasis"><em>Creating a Zoom Animation with a Custom Transition</em></span> recipes.</p><p>The <span class="emphasis"><em>A transition animation – defining scenes and applying a transition</em></span> recipe will provide additional information on the Android Transition Framework, which we will use in many of the recipes.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note17"/>Note</h3><p>Interpolator is a function that defines the rate of change for an animation.</p></div></div><p>
<code class="literal">Interpolators</code> will be mentioned in several recipes in this chapter and in the previous blink example. The Interpolator defines how the transition is calculated. A Linear Interpolator will calculate the change evenly over the set duration, whereas an <code class="literal">AccelerateInterpolator</code> <a id="id522" class="indexterm"/>function would create a faster movement through the duration. Here is the full list of Interpolators<a id="id523" class="indexterm"/> available, along with the XML Identifier:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">AccelerateDecelerateInterpolator (@android:anim/accelerate_decelerate_interpolator)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">AccelerateInterpolator (@android:anim/accelerate_interpolator)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">AnticipateInterpolator (@android:anim/anticipate_interpolator)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">AnticipateOvershootInterpolator (@android:anim/anticipate_overshoot_interpolator)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">BounceInterpolator (@android:anim/bounce_interpolator)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">CycleInterpolator (@android:anim/cycle_interpolator)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">DecelerateInterpolator (@android:anim/decelerate_interpolator)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">LinearInterpolator (@android:anim/linear_interpolator)</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">OvershootInterpolator (@android:anim/overshoot_interpolator)</code></li></ul></div><p>Although animations don't generally require much memory, the graphic resources often do. Many of the images you may want to work with often exceed the available device memory. In the first recipe of this chapter, <span class="emphasis"><em>Scaling down large images to avoid Out of Memory exceptions</em></span>, we'll discuss how to subsample (or scale down) images.</p></div></div>
<div class="section" title="Scaling down large images to avoid Out of Memory exceptions"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec72"/>Scaling down large images to avoid Out of Memory exceptions</h1></div></div></div><p>Working with images can <a id="id524" class="indexterm"/>be very memory intensive, often resulting in your application crashing with an <span class="emphasis"><em>Out of Memory</em></span> exception. This is especially true with pictures taken with the device camera, as they often have a much higher resolution than the device itself.</p><p>Since loading a higher resolution image than the UI supports doesn't provide any visual benefit in this example, this recipe will demonstrate how to take smaller samples of the image for display. We'll use the <code class="literal">BitmapFactory</code> to first check the image size then load a scaled-down image.</p><p>Here's a screenshot from this recipe showing a thumbnail of a very large image:</p><div class="mediaobject"><img src="graphics/B05057_09_01.jpg" alt="Scaling down large images to avoid Out of Memory exceptions"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec253"/>Getting ready</h2></div></div></div><p>Create a new <a id="id525" class="indexterm"/>project in Android Studio and call it: <code class="literal">LoadLargeImage</code>. Use the default <span class="strong"><strong>Phone &amp; Tablet </strong></span>options and select <span class="strong"><strong>Empty Activity</strong></span> when prompted for the <span class="strong"><strong>Activity Type</strong></span>.</p><p>We'll need a large image for this recipe; so we turned to <a class="ulink" href="http://www.Pixabay.com">www.Pixabay.com</a> for an image. Since the image itself doesn't matter, we downloaded the first image shown at the time. (The full size image is 6000 x 4000 and 3.4MB.)</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec254"/>How to do it...</h2></div></div></div><p>As stated previously in <span class="emphasis"><em>Getting ready</em></span>, we need a large image to demonstrate the scaling. Once you have the image, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Copy the image to <code class="literal">res/drawable</code> as <code class="literal">image_large.jpg</code> (use the appropriate extension if you choose a different file type).</li><li class="listitem">Open <code class="literal">activity_main.xml</code> and replace the existing <code class="literal">TextView</code> with the following <code class="literal">ImageView</code>:<div class="informalexample"><pre class="programlisting">&lt;ImageView
    android:id="@+id/imageViewThumbnail"
    android:layout_width="100dp"
    android:layout_height="100dp"
    android:layout_centerInParent="true" /&gt;</pre></div></li><li class="listitem">Now<a id="id526" class="indexterm"/> open <code class="literal">MainActivity.java</code> and add this method, which we'll explain shortly:<div class="informalexample"><pre class="programlisting">public Bitmap loadSampledResource(int imageID, int targetHeight, int targetWidth) {
    final BitmapFactory.Options options = new BitmapFactory.Options();
    options.inJustDecodeBounds = true;
    BitmapFactory.decodeResource(getResources(), imageID, options);
    final int originalHeight = options.outHeight;
    final int originalWidth = options.outWidth;
    int inSampleSize = 1;
    while ((originalHeight / (inSampleSize *2)) &gt; targetHeight &amp;&amp; (originalWidth / (inSampleSize *2)) &gt; targetWidth) {
        inSampleSize *= 2;
    }
    options.inSampleSize = inSampleSize;
    options.inJustDecodeBounds = false;
    return BitmapFactory.decodeResource(getResources(), imageID, options);
}</pre></div></li><li class="listitem">Add the following code to the existing <code class="literal">onCreate()</code> method:<div class="informalexample"><pre class="programlisting">ImageView imageView = (ImageView)findViewById(R.id.imageViewThumbnail);
imageView.setImageBitmap(loadSampledResource(R.drawable.image_large, 100, 100));</pre></div></li><li class="listitem">Run the application on a device or emulator.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec255"/>How it works...</h2></div></div></div><p>The purpose of the <code class="literal">loadSampledResource()</code> method is to load a smaller image, to reduce the memory consumption of the image. If we attempted to load the full image chosen from <a class="ulink" href="http://www.Pixabay.Com">www.Pixabay.Com</a> (see the previous <span class="emphasis"><em>Getting ready</em></span> section), the app would require over 3 MB of RAM to load. That's more memory than most devices can handle (at the moment anyway), and even if it could be loaded completely, would provide no visual benefit for our thumbnail view.</p><p>To avoid an <code class="literal">Out of Memory</code> situation, we use the <code class="literal">inSampleSize</code> property of the <code class="literal">BitmapFactory.Options</code> to reduce, or subsample, the image. (If we set the <code class="literal">inSampleSize=2</code>, it will reduce the image by half. If we use <code class="literal">inSampleSize=4</code>, it will reduce the image by one-fourth) To calculate the <code class="literal">inSampleSize</code>, first we need to know the image size. We can use the <code class="literal">inJustDecodeBounds</code> property as follows:</p><div class="informalexample"><pre class="programlisting">options.inJustDecodeBounds = true;</pre></div><p>This tells the <code class="literal">BitmapFactory</code> to get the image dimensions without actually storing the image contents. Once we have the image size, we calculate the sample using this code:</p><div class="informalexample"><pre class="programlisting">while ((originalHeight / (inSampleSize *2)) &gt; targetHeight &amp;&amp; (originalWidth / (inSampleSize *2)) &gt; targetWidth) {
        inSampleSize *= 2;
}</pre></div><p>The purpose of <a id="id527" class="indexterm"/>this code is to determine the largest sample size that does not reduce the image below the target dimensions. To do that, we double the sample size and check whether the size exceeds the target size dimensions. If it doesn't, we save the doubled sample size and repeat. Once the reduced size falls below the target dimensions, we use the last saved <code class="literal">inSampleSize</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note18"/>Note</h3><p>From the <code class="literal">inSampleSize</code> documentation (link in the following <span class="emphasis"><em>See also</em></span> section), note that the decoder uses a final value based on powers of 2, any other value will be rounded down to the nearest power of 2.</p></div></div><p>Once we have the sample size, we set the <code class="literal">inSampleSize</code> property and set <code class="literal">inJustDecodeBounds</code> to <code class="literal">false</code>, to load normally. Here is the code:</p><div class="informalexample"><pre class="programlisting">options.inSampleSize = inSampleSize;
options.inJustDecodeBounds = false;</pre></div><p>It's important to note, this recipe illustrates the concept for applying the task in your own application. Loading and processing images can be a long operation, which could cause your application to stop responding. This is not a good thing and could cause Android to show the <span class="strong"><strong>Application Not Responding</strong></span> (<span class="strong"><strong>ANR</strong></span>)<a id="id528" class="indexterm"/> dialog. It is recommended to perform long tasks on a background thread to keep your UI thread responsive. The <code class="literal">AsyncTask</code> class is available for doing background network processing, but there are many other libraries available as well (links at the end of the recipe):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Volley</strong></span>: Perform fast, scalable <a id="id529" class="indexterm"/>UI operations over the network (see <a class="link" href="ch12.html" title="Chapter 12. Telephony, Networks, and the Web">Chapter 12</a>, <span class="emphasis"><em>Telephony, Networks, and the Web</em></span>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Picasso</strong></span>: A <a id="id530" class="indexterm"/>powerful image-downloading and caching library for Android</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Android Universal Image Loader</strong></span>: Powerful and flexible library for loading, caching, and<a id="id531" class="indexterm"/> displaying images</li></ul></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec256"/>There's more...</h2></div></div></div><p>It's important to note that the <code class="literal">targetHeight</code> and <code class="literal">targetWidth</code> parameters we pass to the <code class="literal">loadSampledResource()</code> method do not actually set the image size. If you run the application using the same size image we used, the sample size will be 32, resulting in a loaded image size of 187 x 125.</p><p>If your layout needs a specific size of image, either set the size in the layout file, or you can modify the image size directly using the Bitmap class.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec257"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Developer Docs: BitmapFactory.inSampleSize()</strong></span> <a id="id532" class="indexterm"/>at <a class="ulink" href="https://developer.android.com/reference/android/graphics/BitmapFactory.Options.html#inSampleSize">https://developer.android.com/reference/android/graphics/BitmapFactory.Options.html#inSampleSize</a></li><li class="listitem" style="list-style-type: disc">Refer to the <span class="strong"><strong>Android Universal Image Loader</strong></span> page<a id="id533" class="indexterm"/> at <a class="ulink" href="https://github.com/nostra13/Android-Universal-Image-Loader">https://github.com/nostra13/Android-Universal-Image-Loader</a></li><li class="listitem" style="list-style-type: disc">Refer to <span class="strong"><strong>Picasso</strong></span><a id="id534" class="indexterm"/> at <a class="ulink" href="https://square.github.io/picasso/">https://square.github.io/picasso/</a></li><li class="listitem" style="list-style-type: disc">Check the <span class="emphasis"><em>AsyncTask</em></span> task in <a class="link" href="ch14.html" title="Chapter 14. Getting your app ready for the Play Store">Chapter 14</a>, <span class="emphasis"><em>Getting Your App Ready for the Play Store</em></span>, for processing long-running operations on a background thread.</li></ul></div></div></div>
<div class="section" title="A transition animation &#x2013; defining scenes and applying a transition"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec73"/>A transition animation – defining scenes and applying a transition</h1></div></div></div><p>The Android Transition Framework<a id="id535" class="indexterm"/> offers the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Group-level animations</strong></span>: Animation<a id="id536" class="indexterm"/> applies to all views in a hierarchy</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Transition-based animation</strong></span>: Animation <a id="id537" class="indexterm"/>based on starting and ending property change</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Built-in animations</strong></span>: Some <a id="id538" class="indexterm"/>common transition effects, such as fade-in/out and movement</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Resource file support</strong></span>: Save<a id="id539" class="indexterm"/> animation values to a resource (XML) file to load during runtime</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Lifecycle callbacks</strong></span>: Receive<a id="id540" class="indexterm"/> callback notifications during the animation</li></ul></div><p>A transition animation consists of the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Starting Scene</strong></span>: The <a id="id541" class="indexterm"/>view (or <code class="literal">ViewGroup</code>) at the start of the animation</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Transition</strong></span>: The <a id="id542" class="indexterm"/>change type (see later on)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Ending Scene</strong></span>: The ending <a id="id543" class="indexterm"/>view (or <code class="literal">ViewGroup</code>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Transitions</strong></span>: Android <a id="id544" class="indexterm"/>provides built-in support for the following three transitions:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>AutoTransition (default transition)</strong></span>: Fade<a id="id545" class="indexterm"/> out, move, and resize, then fade in (in that order)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Fade</strong></span>: Fade<a id="id546" class="indexterm"/> in, fade out (default), or both (specify order)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>ChangeBounds</strong></span>: Move<a id="id547" class="indexterm"/> and resize</li></ul></div></li></ul></div><p>The Transition Framework will automatically create the frames needed to animate from the start to end scenes.</p><p>The following are some known limitations<a id="id548" class="indexterm"/> of the Transition Framework when working with the following classes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>SurfaceView</strong></span>: Animations may not appear correct since <code class="literal">SurfaceView</code> animations are performed on a non-UI thread, so they may be out of sync with the application</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>TextView</strong></span>: Animating text size changes may not work correctly resulting in the text jumping to the final state</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>AdapterView</strong></span>: Classes that extend the <code class="literal">AdapterView</code>, such as the <code class="literal">ListView</code> and <code class="literal">GridView</code>, may hang</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>TextureView</strong></span>: Some transitions may not work</li></ul></div><p>This recipe provides a quick tutorial on using the transition animation system. We'll start by defining the scenes and transition resources, then applying the transition, which creates the animation. The following steps will walk you through creating the resources in XML, as they are generally recommended. Resources can also be created through code, which we'll discuss in the <span class="emphasis"><em>There's more</em></span> section.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec258"/>Getting ready</h2></div></div></div><p>Create a new project in Android Studio and call it: <code class="literal">TransitionAnimation</code>. On the <span class="strong"><strong>Target Android Devices</strong></span> dialog, select the <span class="strong"><strong>Phone &amp; Tablet</strong></span> option and choose API 19 (or above) for the <span class="strong"><strong>Minimum SDK. </strong></span>Select <span class="strong"><strong>Empty Activity</strong></span> when prompted for the <span class="strong"><strong>Activity Type</strong></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec259"/>How to do it...</h2></div></div></div><p>Here are the steps to create the <a id="id549" class="indexterm"/>resource files and apply the transition animation:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Change the existing <code class="literal">activity.main.xml</code> layout file as follows:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;RelativeLayout 
    
    android:id="@+id/layout"
    android:layout_width="match_parent"
    android:layout_height="match_parent"&gt;
    &lt;TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Top"
        android:id="@+id/textViewTop"
        android:layout_alignParentTop="true"
        android:layout_centerHorizontal="true" /&gt;
    &lt;TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Bottom"
        android:id="@+id/textViewBottom"
        android:layout_alignParentBottom="true"
        android:layout_centerHorizontal="true" /&gt;
    &lt;Button
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Go"
        android:id="@+id/button"
        android:layout_centerInParent="true"
        android:onClick="goAnimate"/&gt;
&lt;/RelativeLayout&gt;</pre></div></li><li class="listitem">Create a new layout file called <code class="literal">activity_main_end.xml</code> using the following XML:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;RelativeLayout 
    
    android:id="@+id/layout"
    android:layout_width="match_parent"
    android:layout_height="match_parent"&gt;
    &lt;TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Bottom"
        android:id="@+id/textViewBottom"
        android:layout_alignParentTop="true"
        android:layout_centerHorizontal="true" /&gt;
    &lt;TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Top"
        android:id="@+id/textViewTop"
        android:layout_alignParentBottom="true"
        android:layout_centerHorizontal="true" /&gt;
    &lt;Button
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Go"
        android:id="@+id/button"
        android:layout_centerInParent="true"/&gt;
&lt;/RelativeLayout&gt;</pre></div></li><li class="listitem">Make a new<a id="id550" class="indexterm"/> transition resource directory (<span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New</strong></span> | <span class="strong"><strong>Android resource directory</strong></span> and choose <span class="strong"><strong>Transition</strong></span> as the <span class="strong"><strong>Resource type</strong></span>).</li><li class="listitem">Create a new file in the <code class="literal">res/transition</code> folder called <code class="literal">transition_move.xml</code> using the following XML:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;changeBounds  /&gt;</pre></div></li><li class="listitem">Add the <code class="literal">goAnimate()</code> method using the following code:<div class="informalexample"><pre class="programlisting">public void goAnimate(View view) {
    ViewGroup root = (ViewGroup) findViewById(R.id.layout);
    Scene scene = Scene.getSceneForLayout(root, R.layout.activity_main_end, this);
    Transition transition = TransitionInflater.from(this).inflateTransition(R.transition.transition_move);
    TransitionManager.go(scene, transition);
}</pre></div></li><li class="listitem">You're ready to run the application on a device or emulator.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec260"/>How it works...</h2></div></div></div><p>You probably<a id="id551" class="indexterm"/> find the code itself rather simple. As outlined in the recipe introduction, we just need to create the starting and ending scenes and set the transition type. Here's a detailed breakdown of the code.</p><div class="section" title="Creating the start scene"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec28"/>Creating the start scene</h3></div></div></div><p>Running the following<a id="id552" class="indexterm"/> line of code will create the start scene:</p><div class="informalexample"><pre class="programlisting">ViewGroup root = (ViewGroup) findViewById(R.id.layout);</pre></div></div><div class="section" title="Creating the transition:"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec29"/>Creating the transition:</h3></div></div></div><p>Running the<a id="id553" class="indexterm"/> following line of code will create the transition:</p><div class="informalexample"><pre class="programlisting">Transition transition = TransitionInflater.from(this).inflateTransition(R.transition.transition_move);</pre></div></div><div class="section" title="Defining the ending scene:"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec30"/>Defining the ending scene:</h3></div></div></div><p>Running the<a id="id554" class="indexterm"/> following line of code will define the ending scene:</p><div class="informalexample"><pre class="programlisting">Scene scene = Scene.getSceneForLayout(root, R.layout.activity_main_end, this);</pre></div></div><div class="section" title="Starting the transition:"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec31"/>Starting the transition:</h3></div></div></div><p>Running the <a id="id555" class="indexterm"/>following line of code will start the transition:</p><div class="informalexample"><pre class="programlisting">TransitionManager.go(scene, transition);</pre></div><p>Though simple, most of the work for this recipe was in creating the necessary resource files.</p></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec261"/>There's more...</h2></div></div></div><p>Now we'll take a look at creating this same transition animation with a code-only solution (although we'll still use the initial <code class="literal">activity_main.xml</code> layout file):</p><div class="informalexample"><pre class="programlisting">ViewGroup root = (ViewGroup) findViewById(R.id.layout);
Scene scene = new Scene(root);

Transition transition = new ChangeBounds();
TransitionManager.beginDelayedTransition(root,transition);

TextView textViewTop = (TextView)findViewById(R.id.textViewTop);
RelativeLayout.LayoutParams params = (RelativeLayout.LayoutParams)textViewTop.getLayoutParams();
params.addRule(RelativeLayout.ALIGN_PARENT_BOTTOM,1);
params.addRule(RelativeLayout.ALIGN_PARENT_TOP, 0);
textViewTop.setLayoutParams(params);

TextView textViewBottom = (TextView)findViewById(R.id.textViewBottom);
params = (RelativeLayout.LayoutParams)textViewBottom.getLayoutParams();
params.addRule(RelativeLayout.ALIGN_PARENT_BOTTOM,0);
params.addRule(RelativeLayout.ALIGN_PARENT_TOP, 1);
textViewBottom.setLayoutParams(params);

TransitionManager.go(scene);</pre></div><p>We still need the starting and ending scene along with the transition; the only difference is how we create the resources. In the previous code, we created the Start Scene using the current layout.</p><p>Before we start modifying the layout through code, we call the <code class="literal">beginDelayedTransition()</code> method of <code class="literal">TransitionManager</code> with the transition type. The <code class="literal">TransitionManager</code> will track the changes for the ending scene. When we call the <code class="literal">go()</code> method, the <code class="literal">TransitionManager</code> automatically animates the change.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec262"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Refer to the Animation resources web page<a id="id556" class="indexterm"/> at <a class="ulink" href="https://developer.android.com/guide/topics/resources/animation-resource.html">https://developer.android.com/guide/topics/resources/animation-resource.html</a></li></ul></div></div></div>
<div class="section" title="Creating a Compass using sensor data and RotateAnimation"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec74"/>Creating a Compass using sensor data and RotateAnimation</h1></div></div></div><p>In the previous chapter, we <a id="id557" class="indexterm"/>demonstrated reading sensor data from the <a id="id558" class="indexterm"/>physical device sensors. In that recipe, we <a id="id559" class="indexterm"/>used the Light Sensor since the data<a id="id560" class="indexterm"/> from Environment Sensors generally don't require any extra processing. Although it's easy to get the magnetic field strength data, the numbers themselves don't have much meaning and certainly don't create an appealing display.</p><p>In this recipe, we'll demonstrate getting the magnetic field data along with the accelerometer data to calculate magnetic north. We'll use the <code class="literal">SensorManager.getRotationMatrix</code> to animate the compass while responding to the device movement. Here's a screenshot of our compass application on a physical device:</p><div class="mediaobject"><img src="graphics/B05057_09_02.jpg" alt="Creating a Compass using sensor data and RotateAnimation"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec263"/>Getting ready</h2></div></div></div><p>Create a new project<a id="id561" class="indexterm"/> in Android Studio and call it: <code class="literal">Compass</code>. Use the<a id="id562" class="indexterm"/> default <span class="strong"><strong>Phone &amp; Tablet </strong></span>options and<a id="id563" class="indexterm"/> select <span class="strong"><strong>Empty Activity</strong></span> when <a id="id564" class="indexterm"/>prompted for the <span class="strong"><strong>Activity Type</strong></span>.</p><p>We will need an image for the compass indicator. Again, we can turn to <a class="ulink" href="http://www.Pixabay.Com">www.Pixabay.Com</a> for an image. We used the following image:</p><p>
<a class="ulink" href="https://pixabay.com/en/geography-map-compass-rose-plot-42608/">https://pixabay.com/en/geography-map-compass-rose-plot-42608/</a>
</p><p>Though not required, this image has a transparent background, which looks better when rotating the image.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec264"/>How to do it...</h2></div></div></div><p>As mentioned in the <a id="id565" class="indexterm"/>previous <span class="emphasis"><em>Getting ready</em></span> section, we'll need an<a id="id566" class="indexterm"/> image for the compass. You can <a id="id567" class="indexterm"/>download the one previously linked, or<a id="id568" class="indexterm"/> use any image you prefer, then follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Copy your image to the <code class="literal">res/drawable</code> folder and name it <code class="literal">compass.png</code>.</li><li class="listitem">Open <code class="literal">activity_main.xml</code> and replace the existing <code class="literal">TextView</code> with the following <code class="literal">ImageView</code>:<div class="informalexample"><pre class="programlisting">&lt;ImageView
    android:id="@+id/imageViewCompass"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:layout_centerInParent="true"
    android:src="@drawable/compass"/&gt;</pre></div></li><li class="listitem">Now open <code class="literal">MainActivity.java</code> and add the following global variable declarations:<div class="informalexample"><pre class="programlisting">private SensorManager mSensorManager;
private Sensor mMagnetometer;
private Sensor mAccelerometer;
private ImageView mImageViewCompass;
private float[] mGravityValues=new float[3];
private float[] mAccelerationValues=new float[3];
private float[] mRotationMatrix=new float[9];
private float mLastDirectionInDegrees = 0f;</pre></div></li><li class="listitem">Add the following <code class="literal">SensorEventListener</code> class to the <code class="literal">MainActivity</code> class:<div class="informalexample"><pre class="programlisting">private SensorEventListener mSensorListener = new SensorEventListener() {
    @Override
    public void onSensorChanged(SensorEvent event) {
        calculateCompassDirection(event);
    }
    @Override
    public void onAccuracyChanged(Sensor sensor, int accuracy) {
        //Nothing to do
    }
};</pre></div></li><li class="listitem">Override <code class="literal">onResume()</code> and <code class="literal">onPause()</code> as follows:<div class="informalexample"><pre class="programlisting">@Override
protected void onResume() {
    super.onResume();
    mSensorManager.registerListener(mSensorListener, mMagnetometer, SensorManager.SENSOR_DELAY_FASTEST);
    mSensorManager.registerListener(mSensorListener, mAccelerometer, SensorManager.SENSOR_DELAY_FASTEST);
}

@Override
protected void onPause() {
    super.onPause();
    mSensorManager.unregisterListener(mSensorListener);
}</pre></div></li><li class="listitem">Add the <a id="id569" class="indexterm"/>following<a id="id570" class="indexterm"/> code to the existing<a id="id571" class="indexterm"/> <code class="literal">onCreate()</code><a id="id572" class="indexterm"/>method:<div class="informalexample"><pre class="programlisting">mImageViewCompass=(ImageView)findViewById(R.id.imageViewCompass);
mSensorManager = (SensorManager) getSystemService(Context.SENSOR_SERVICE);
mMagnetometer = mSensorManager.getDefaultSensor(Sensor.TYPE_MAGNETIC_FIELD);
mAccelerometer = mSensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER);</pre></div></li><li class="listitem">The final code does the actual calculations and animation:<div class="informalexample"><pre class="programlisting">private void calculateCompassDirection(SensorEvent event) {
    switch (event.sensor.getType()) {
        case Sensor.TYPE_ACCELEROMETER:
            mAccelerationValues = event.values.clone();
            break;
        case Sensor.TYPE_MAGNETIC_FIELD:
            mGravityValues = event.values.clone();
            break;
    }
    boolean success = SensorManager.getRotationMatrix(mRotationMatrix, null, mAccelerationValues, mGravityValues);
    if(success){
        float[] orientationValues = new float[3];
        SensorManager.getOrientation(mRotationMatrix, orientationValues);
        float azimuth = (float)Math.toDegrees(-orientationValues[0]);
        RotateAnimation rotateAnimation = new RotateAnimation(mLastDirectionInDegrees, azimuth, Animation.RELATIVE_TO_SELF, 0.5f, Animation.RELATIVE_TO_SELF, 0.5f);
        rotateAnimation.setDuration(50);
        rotateAnimation.setFillAfter(true);
        mImageViewCompass.startAnimation(rotateAnimation);
        mLastDirectionInDegrees = azimuth;
    }</pre></div></li><li class="listitem">You're ready to<a id="id573" class="indexterm"/> run the application. Although<a id="id574" class="indexterm"/> you can run this application<a id="id575" class="indexterm"/> on an emulator, without an<a id="id576" class="indexterm"/> accelerometer and magnetometer, you won't see the compass move.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec265"/>How it works...</h2></div></div></div><p>Since we've already covered reading sensor data in <span class="emphasis"><em>Reading sensor data – using the Android Sensor Framework</em></span> (from the previous chapter), we won't repeat explaining the sensor framework, and instead jump right to the <code class="literal">calculateCompassDirection()</code> method.</p><p>We call this method directly from the <code class="literal">onSensorChanged()</code> callback. Since we used the same class to handle the sensor callbacks for both the Magnetometer and Accelerometer, we first check which sensor is being reported in the <code class="literal">SensorEvent</code>. Then we call <code class="literal">SensorManager.getRotationMatrix()</code>, passing in the last sensor data. If the calculation is successful, it returns a <code class="literal">RotationMatrix,</code> which we use to call the <code class="literal">SensorManager.getOrientation()</code> method. <code class="literal">getOrientation()</code> will return the following data in the <code class="literal">orientationValues</code> array:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Azimuth</strong></span>: <code class="literal">value [0]</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Pitch</strong></span>: <code class="literal">value [1]</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Roll</strong></span>: <code class="literal">value [2]</code></li></ul></div><p>The azimuth is reported in radians, in the opposite direction, so we reverse the sign and convert it to degrees using <code class="literal">Math.toDegrees()</code>. The azimuth represents the direction of North, so we use it in our <code class="literal">RotateAnimation</code>.</p><p>With the math already done by the <code class="literal">SensorManager</code>, the actual compass animation is very simple. We create a <code class="literal">RotateAnimation</code> using the previous direction, the new direction. We use the <code class="literal">Animation.RELATIVE_TO_SELF</code> flag and 0.5f (or 50%) to set the center of the image as the rotation point. Before calling <code class="literal">startAnimation()</code> to update the compass, we set the animation duration using <code class="literal">setDuration()</code> and <code class="literal">setFillAfter(true)</code>. (Using <code class="literal">true</code> indicates we want the image to be left "as is" after the animation completes, otherwise the image would reset back to the original image.) Finally, we save the <a id="id577" class="indexterm"/>azimuth <a id="id578" class="indexterm"/>for the<a id="id579" class="indexterm"/> next sensor <a id="id580" class="indexterm"/>update.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec266"/>There's more...</h2></div></div></div><p>It's worth taking some time to experiment with the <code class="literal">RotationAnimation</code> settings and the sensor update timing. In our call to register the sensor listener, we use <code class="literal">SensorManager.SENSOR_DELAY_FASTEST</code> along with 50 milliseconds for the <code class="literal">setDuration()</code> to create a fast animation. You could also try using a slower sensor update and a slower animation, and compare the results.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec267"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="emphasis"><em>Reading sensor data – using the Android Sensor Framework</em></span> in the previous chapter for details on reading the sensor data.</li><li class="listitem" style="list-style-type: disc">Refer to the <span class="strong"><strong>getRotationMatrix() Developer Document</strong></span><a id="id581" class="indexterm"/> at <a class="ulink" href="http://developer.android.com/reference/android/hardware/SensorManager.html#getRotationMatrix(float%5B%5D,%20float%5B%5D,%20float%5B%5D,%20float%5B%5D)">http://developer.android.com/reference/android/hardware/SensorManager.html#getRotationMatrix(float[], float[], float[], float[])</a></li><li class="listitem" style="list-style-type: disc">Refer to <a id="id582" class="indexterm"/>the <span class="strong"><strong>getOrientation() Developer Document</strong></span> at <a class="ulink" href="http://developer.android.com/reference/android/hardware/SensorManager.html#getOrientation(float%5B%5D,%20float%5B%5D)">http://developer.android.com/reference/android/hardware/SensorManager.html#getOrientation(float[], float[])</a></li><li class="listitem" style="list-style-type: disc">Refer to the <span class="strong"><strong>RotateAnimation Developer Document</strong></span><a id="id583" class="indexterm"/> at <a class="ulink" href="http://developer.android.com/reference/android/view/animation/RotateAnimation.html">http://developer.android.com/reference/android/view/animation/RotateAnimation.html</a></li></ul></div></div></div>
<div class="section" title="Creating a slideshow with ViewPager"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec75"/>Creating a slideshow with ViewPager</h1></div></div></div><p>This recipe will <a id="id584" class="indexterm"/>show you how to create a slideshow using <a id="id585" class="indexterm"/>the <code class="literal">ViewPager</code> class. Here is a screenshot showing a transition from one picture to another:</p><div class="mediaobject"><img src="graphics/B05057_09_03.jpg" alt="Creating a slideshow with ViewPager"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec268"/>Getting ready</h2></div></div></div><p>Create a <a id="id586" class="indexterm"/>new project in Android Studio and call it: <code class="literal">SlideShow</code>. Use <a id="id587" class="indexterm"/>the default <span class="strong"><strong>Phone &amp; Tablet </strong></span>options and select <span class="strong"><strong>Empty Activity</strong></span> when prompted for the <span class="strong"><strong>Activity Type</strong></span>.</p><p>We need several images for the slideshow. For demonstration purposes, we downloaded four images from <a class="ulink" href="http://www.Pixabay.com">www.Pixabay.com</a> to include in the project source files, but you can use any images.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec269"/>How to do it...</h2></div></div></div><p>We'll create a Fragment to display each image for our slideshow, then set up the <code class="literal">ViewPager</code> in the Main Activity. Here are the steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Copy four images to the <code class="literal">/res/drawable</code> folder and name them <code class="literal">slide_0</code> through <code class="literal">slide_3</code>, keeping their original file extensions.</li><li class="listitem">Create a new layout file called <code class="literal">fragment_slide.xml</code> using the following XML:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout 
    android:orientation="vertical"
    android:layout_width="match_parent"
    android:layout_height="match_parent"&gt;
    &lt;ImageView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:id="@+id/imageView"
        android:layout_gravity="center_horizontal" /&gt;
&lt;/LinearLayout&gt;</pre></div></li><li class="listitem">Now create a new Java class called <code class="literal">SlideFragment.</code> It will extend <code class="literal">Fragment</code> as follows:<div class="informalexample"><pre class="programlisting">public class SlideFragment extends Fragment {</pre></div><p>Use the following import:</p><div class="informalexample"><pre class="programlisting">import android.support.v4.app.Fragment;</pre></div></li><li class="listitem">Add the following global declaration:<div class="informalexample"><pre class="programlisting">private int mImageResourceID;</pre></div></li><li class="listitem">Add the following empty, default fragment constructor:<div class="informalexample"><pre class="programlisting">public SlideFragment() {}</pre></div></li><li class="listitem">Add the following method to save the image resource ID:<div class="informalexample"><pre class="programlisting">public void setImage(int resourceID) {
    mImageResourceID=resourceID;
}</pre></div></li><li class="listitem">Override <code class="literal">onCreateView()</code> as follows:<div class="informalexample"><pre class="programlisting">@Override
public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
    ViewGroup rootView = (ViewGroup) inflater.inflate(R.layout.fragment_slide, container, false);
    ImageView imageView = (ImageView)rootView.findViewById(R.id.imageView);
    imageView.setImageResource(mImageResourceID);
    return rootView;
}</pre></div></li><li class="listitem">Our <a id="id588" class="indexterm"/>main activity will display just <a id="id589" class="indexterm"/>a <code class="literal">ViewPager</code>. Open <code class="literal">activity_main.xml</code> and replace the file contents as follows:<div class="informalexample"><pre class="programlisting">&lt;android.support.v4.view.ViewPager
    
    android:id="@+id/viewPager"
    android:layout_width="match_parent"
    android:layout_height="match_parent" /&gt;</pre></div></li><li class="listitem">Now open <code class="literal">MainActivity.java</code> and change <code class="literal">MainActivity</code> to extend <code class="literal">FragmentActivity</code> as shown:<div class="informalexample"><pre class="programlisting">public class MainActivity extends FragmentActivity {</pre></div><p>Use the following import:</p><div class="informalexample"><pre class="programlisting">import android.support.v4.app.FragmentActivity;</pre></div></li><li class="listitem">Add the <a id="id590" class="indexterm"/>following global declarations:<div class="informalexample"><pre class="programlisting">private final int PAGE_COUNT=4;
private ViewPager mViewPager;
private PagerAdapter mPagerAdapter;</pre></div><p>Use the following imports:</p><div class="informalexample"><pre class="programlisting">import android.support.v4.view.PagerAdapter;
import android.support.v4.view.ViewPager;</pre></div></li><li class="listitem">Create the <a id="id591" class="indexterm"/>following subclass within <code class="literal">MainActivity</code>:<div class="informalexample"><pre class="programlisting">private class SlideAdapter extends FragmentStatePagerAdapter {
    public SlideAdapter(FragmentManager fm) {
        super(fm);
    }
    @Override
    public Fragment getItem(int position) {
        SlideFragment slideFragment = new SlideFragment();
        switch (position) {
            case 0:
                slideFragment.setImage(R.drawable.slide_0);
                break;
            case 1:
                slideFragment.setImage(R.drawable.slide_1);
                break;
            case 2:
                slideFragment.setImage(R.drawable.slide_2);
                break;
            case 3:
                slideFragment.setImage(R.drawable.slide_3);
                break;
        }
        return slideFragment;
    }
    @Override
    public int getCount() {
        return PAGE_COUNT;
    }
}</pre></div><p>Use the following imports:</p><div class="informalexample"><pre class="programlisting">import android.support.v4.app.Fragment;
import android.support.v4.app.FragmentManager;
import android.support.v4.app.FragmentStatePagerAdapter;</pre></div></li><li class="listitem">Override<a id="id592" class="indexterm"/> <code class="literal">onBackPressed()</code> as <a id="id593" class="indexterm"/>follows:<div class="informalexample"><pre class="programlisting">@Override
public void onBackPressed() {
    if (mViewPager.getCurrentItem() == 0) {
        super.onBackPressed();
    } else {
        mViewPager.setCurrentItem(mViewPager.getCurrentItem() - 1);
    }
}</pre></div></li><li class="listitem">Add the following code to the <code class="literal">onCreate()</code> method:<div class="informalexample"><pre class="programlisting">mViewPager = (ViewPager) findViewById(R.id.viewPager);
mPagerAdapter = new SlideAdapter(getSupportFragmentManager());
mViewPager.setAdapter(mPagerAdapter);</pre></div></li><li class="listitem">Run the application on a device or emulator.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec270"/>How it works...</h2></div></div></div><p>The first step is to create a fragment. Since we're doing a slideshow, all we need is an <code class="literal">ImageViewer</code>. We also change <code class="literal">MainActivity</code> to extend <code class="literal">FragmentActivity</code> to load the fragments into the <code class="literal">ViewPager</code>.</p><p>The <code class="literal">ViewPager</code> uses a <code class="literal">FragmentStatePagerAdapter</code> as the source for the fragments to transition. We create the <code class="literal">SlideAdapter</code> to handle the two callbacks from the <code class="literal">FragmentStatePagerAdapter</code> class:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">getCount()</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">getItem()</code></li></ul></div><p>
<code class="literal">getCount()</code> simply returns the number of pages we have in our slideshow. <code class="literal">getItem()</code> returns the actual fragment to display. This is where we specify the image we want to display. As you can see, it would be very easy to add or change the slideshow.</p><p>Handling the <span class="emphasis"><em>Back</em></span> key isn't a requirement for the <code class="literal">ViewPager</code>, but it does provide a better user experience. <code class="literal">onBackPressed()</code> decrements the current page until it reaches the first page, then it sends <a id="id594" class="indexterm"/>the <span class="emphasis"><em>Back</em></span> key to the super class, which exits the<a id="id595" class="indexterm"/> application.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec271"/>There's more...</h2></div></div></div><p>As you can see from the example, the <code class="literal">ViewPager</code> takes care of most of the work, including handling the transition animations. We can customize the transition if we want, by implementing the <code class="literal">transformPage()</code> callback on the <code class="literal">ViewPager.PageTransformer</code> interface. (See the next recipe for a custom animation.)</p><div class="section" title="Creating a Setup Wizard"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec32"/>Creating a Setup Wizard</h3></div></div></div><p>The <code class="literal">ViewPager</code> <a id="id596" class="indexterm"/>can also be used to create a Setup Wizard. Instead of<a id="id597" class="indexterm"/> creating a single fragment to display an image, create a fragment for each step of your wizard and return the appropriate fragment in the <code class="literal">getItem()</code> callback.</p></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec272"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Refer to the <span class="strong"><strong>Android ViewPager Documentation</strong></span><a id="id598" class="indexterm"/> at <a class="ulink" href="http://developer.android.com/reference/android/support/v4/view/ViewPager.html">http://developer.android.com/reference/android/support/v4/view/ViewPager.html</a></li><li class="listitem" style="list-style-type: disc">Refer to the <span class="emphasis"><em>Creating a custom Zoom Animation</em></span> recipe for an example on creating a custom animation.</li></ul></div></div></div>
<div class="section" title="Creating a Card Flip Animation with Fragments"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec76"/>Creating a Card Flip Animation with Fragments</h1></div></div></div><p>The card flip is a<a id="id599" class="indexterm"/> common animation that we<a id="id600" class="indexterm"/> will demonstrate using fragment transitions. We'll use two different images—one for the front and one for the back, to create the card flip effect. We'll need four animation resources: two for the front and two for the back transitions, which we will define in XML using <code class="literal">objectAnimator</code>.</p><p>Here's a screenshot of the application we'll build showing the Card Flip Animation in action:</p><div class="mediaobject"><img src="graphics/B05057_09_04.jpg" alt="Creating a Card Flip Animation with Fragments"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec273"/>Getting ready</h2></div></div></div><p>Create a new project in Android Studio and call it: <code class="literal">CardFlip</code>. Use the default <span class="strong"><strong>Phone &amp; Tablet </strong></span>options and select <span class="strong"><strong>Empty Activity</strong></span> when prompted for the <span class="strong"><strong>Activity Type</strong></span>.</p><p>For the front and back images of the playing card, we found the following images on <a class="ulink" href="http://www.Pixabay.com">www.Pixabay.com</a>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://pixabay.com/en/ace-hearts-playing-cards-poker-28357/">https://pixabay.com/en/ace-hearts-playing-cards-poker-28357/</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://pixabay.com/en/card-game-deck-of-cards-card-game-48978/">https://pixabay.com/en/card-game-deck-of-cards-card-game-48978/</a></li></ul></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec274"/>How to do it...</h2></div></div></div><p>We'll need two <a id="id601" class="indexterm"/>fragments—one for the front of the<a id="id602" class="indexterm"/> card and the other for the back. Each fragment will define the image for the card. Then we'll need four animation files for the full card flip effect. Here are the steps to set up the project structure correctly and to create the resources needed:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Once you have front and back images for the cards, copy them to the <code class="literal">res/drawable</code> folder as <code class="literal">card_front.jpg</code> and <code class="literal">card_back.jpg</code> (keep the original file extension of your images if different).</li><li class="listitem">Create an <a id="id603" class="indexterm"/>animator resource <a id="id604" class="indexterm"/>directory: <code class="literal">res/animator</code>. (In Android Studio, go to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New</strong></span> | <span class="strong"><strong>Android resource directory</strong></span>. When the <span class="strong"><strong>New Android Resource</strong></span> dialog displays, choose <code class="literal">animator</code> in the <span class="strong"><strong>Resource Type</strong></span> dropdown.)</li><li class="listitem">Create <code class="literal">card_flip_left_enter.xml</code> in <code class="literal">res/animator</code> using the following XML:<div class="informalexample"><pre class="programlisting">&lt;set &gt;
    &lt;objectAnimator
        android:valueFrom="1.0"
        android:valueTo="0.0"
        android:propertyName="alpha"
        android:duration="0" /&gt;
    &lt;objectAnimator
        android:valueFrom="-180"
        android:valueTo="0"
        android:propertyName="rotationY"
        android:interpolator="@android:interpolator/accelerate_decelerate"
        android:duration="@integer/card_flip_duration_full"/&gt;
    &lt;objectAnimator
        android:valueFrom="0.0"
        android:valueTo="1.0"
        android:propertyName="alpha"
        android:startOffset="@integer/card_flip_duration_half"
        android:duration="1" /&gt;
&lt;/set&gt;</pre></div></li><li class="listitem">Create <code class="literal">card_flip_left_exit.xml</code> in <code class="literal">res/animator</code> using the following XML:<div class="informalexample"><pre class="programlisting">&lt;set &gt;
    &lt;objectAnimator
        android:valueFrom="0"
        android:valueTo="180"
        android:propertyName="rotationY"
        android:interpolator="@android:interpolator/accelerate_decelerate"
        android:duration="@integer/card_flip_duration_full"/&gt;
    &lt;objectAnimator
        android:valueFrom="1.0"
        android:valueTo="0.0"
        android:propertyName="alpha"
        android:startOffset="@integer/card_flip_duration_half"
        android:duration="1" /&gt;
&lt;/set&gt;</pre></div></li><li class="listitem">Create<a id="id605" class="indexterm"/> <code class="literal">card_flip_right_enter.xml</code> in <code class="literal">res/animator</code> using <a id="id606" class="indexterm"/>the following XML:<div class="informalexample"><pre class="programlisting">&lt;set &gt;
    &lt;objectAnimator
        android:valueFrom="1.0"
        android:valueTo="0.0"
        android:propertyName="alpha"
        android:duration="0" /&gt;
    &lt;objectAnimator
        android:valueFrom="180"
        android:valueTo="0"
        android:propertyName="rotationY"
        android:interpolator="@android:interpolator/accelerate_decelerate"
        android:duration="@integer/card_flip_duration_full" /&gt;
    &lt;objectAnimator
        android:valueFrom="0.0"
        android:valueTo="1.0"
        android:propertyName="alpha"
        android:startOffset="@integer/card_flip_duration_half"
        android:duration="1" /&gt;
&lt;/set&gt;</pre></div></li><li class="listitem">Create <code class="literal">card_flip_right_exit.xml</code>in <code class="literal">res/animator</code> using the following XML:<div class="informalexample"><pre class="programlisting">&lt;set &gt;
    &lt;objectAnimator
        android:valueFrom="0"
        android:valueTo="-180"
        android:propertyName="rotationY"
        android:interpolator="@android:interpolator/accelerate_decelerate"
        android:duration="@integer/card_flip_duration_full" /&gt;
    &lt;objectAnimator
        android:valueFrom="1.0"
        android:valueTo="0.0"
        android:propertyName="alpha"
        android:startOffset="@integer/card_flip_duration_half"
        android:duration="1" /&gt;
&lt;/set&gt;</pre></div></li><li class="listitem">Create a<a id="id607" class="indexterm"/> new resource file  <a id="id608" class="indexterm"/>in <code class="literal">res/values</code> called <code class="literal">timing.xml</code> using the following XML:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;resources&gt;
    &lt;integer name="card_flip_duration_full"&gt;1000&lt;/integer&gt;
    &lt;integer name="card_flip_duration_half"&gt;500&lt;/integer&gt;
&lt;/resources&gt;</pre></div></li><li class="listitem">Create a new file in <code class="literal">res/layout</code> called <code class="literal">fragment_card_front.xml</code> using the following XML:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;ImageView 
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:src="@drawable/card_front"
    android:scaleType="centerCrop" /&gt;</pre></div></li><li class="listitem">Create a new file in <code class="literal">res/layout</code> called <code class="literal">fragment_card_back.xml</code> using the following XML:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;ImageView 
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:src="@drawable/card_back"
    android:scaleType="centerCrop" /&gt;</pre></div></li><li class="listitem">Create a new Java class called <code class="literal">CardFrontFragment</code> using the following code:<div class="informalexample"><pre class="programlisting">public class CardFrontFragment extends Fragment {
    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
        return inflater.inflate(R.layout.fragment_card_front, container, false);
    }
}</pre></div></li><li class="listitem">Create a<a id="id609" class="indexterm"/> new Java class <a id="id610" class="indexterm"/>called <code class="literal">CardBackFragment</code> using the following code:<div class="informalexample"><pre class="programlisting">public class CardBackFragment extends Fragment {
    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
        return inflater.inflate(R.layout.fragment_card_back, container, false);
    }
}</pre></div></li><li class="listitem">Replace the existing <code class="literal">activity_main.xml</code> file with the following XML:<div class="informalexample"><pre class="programlisting">&lt;FrameLayout
    
    android:id="@+id/container"
    android:layout_width="match_parent"
    android:layout_height="match_parent" /&gt;</pre></div></li><li class="listitem">Open <code class="literal">MainActivity.java</code> and add the following global declaration:<div class="informalexample"><pre class="programlisting">boolean mShowingBack = false;</pre></div></li><li class="listitem">Add the following code to the existing <code class="literal">onCreate()</code> method:<div class="informalexample"><pre class="programlisting">FrameLayout frameLayout = (FrameLayout)findViewById(R.id.frameLayout);
frameLayout.setOnClickListener(new View.OnClickListener() {
    @Override
    public void onClick(View v) {
        flipCard();
    }
});

if (savedInstanceState == null) {
    getFragmentManager()
        .beginTransaction()
        .add(R.id.frameLayout, new CardFrontFragment())
        .commit();
}</pre></div></li><li class="listitem">Add the<a id="id611" class="indexterm"/> following method, which <a id="id612" class="indexterm"/>handles the actual fragment transition:<div class="informalexample"><pre class="programlisting">private void flipCard() {
    if (mShowingBack) {
        mShowingBack = false;
        getFragmentManager().popBackStack();
    } else {
        mShowingBack = true;
        getFragmentManager()
            .beginTransaction()
            .setCustomAnimations(
                R.animator.card_flip_right_enter, R.animator.card_flip_right_exit, R.animator.card_flip_left_enter, R.animator.card_flip_left_exit)
            .replace(R.id.frameLayout, new CardBackFragment())
            .addToBackStack(null)
            .commit();
    }
}</pre></div></li><li class="listitem">You're ready to run the application on a device or emulator.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec275"/>How it works...</h2></div></div></div><p>Most of the effort to create the card flip is in setting up the resources. Since we want a front and back view of the card, we create two fragments with the appropriate images. We call the <code class="literal">flipCard()</code> method when the card is pressed. The actual animation is handled by the <code class="literal">setCustomAnimations()</code>. This is where we pass in the four animation resources we defined in XML. As you can see, Android makes it very easy.</p><p>It's important to note that we did not use the Support Library Fragment Manager, as the support library does not support the <code class="literal">objectAnimator</code>. If you want support preAndroid 3.0, you'll need to include the old <code class="literal">anim</code> resources and check the OS version at runtime, or create the animation resources in code. (See the next recipe.)</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec276"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">See the next recipe, <span class="emphasis"><em>Creating a Zoom Animation with a Custom Transition</em></span>, for an example of animation resources created in code</li><li class="listitem" style="list-style-type: disc">Refer to the <span class="strong"><strong>Integer Resource Type</strong></span> web page<a id="id613" class="indexterm"/> at <a class="ulink" href="https://developer.android.com/guide/topics/resources/more-resources.html#Integer">https://developer.android.com/guide/topics/resources/more-resources.html#Integer</a></li></ul></div></div></div>
<div class="section" title="Creating a Zoom Animation with a Custom Transition"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec77"/>Creating a Zoom Animation with a Custom Transition</h1></div></div></div><p>The previous recipe, <span class="emphasis"><em>Creating a Card Flip Animation with Fragments</em></span>, demonstrated a transition animation using<a id="id614" class="indexterm"/> animation resource files. In <a id="id615" class="indexterm"/>this recipe, we will create a zoom effect using animation resources created in code. The application shows a thumbnail image then expands to an enlarged image when pressed.</p><p>The following image contains three screenshots showing the zoom animation in action:</p><div class="mediaobject"><img src="graphics/B05057_09_05.jpg" alt="Creating a Zoom Animation with a Custom Transition"/></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec277"/>Getting ready</h2></div></div></div><p>Create a new project in Android Studio and call it: <code class="literal">&lt;project name&gt;</code>. Use the default <span class="strong"><strong>Phone &amp; Tablet </strong></span>options and select <span class="strong"><strong>Empty Activity</strong></span> when prompted for the <span class="strong"><strong>Activity Type</strong></span>.</p><p>For the image needed for this recipe, we downloaded a picture from <a class="ulink" href="http://www.Pixabay.com">www.Pixabay.com</a> to include in the project source files, but you can use any image.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec278"/>How to do it...</h2></div></div></div><p>Once you have <a id="id616" class="indexterm"/>your image ready as stated<a id="id617" class="indexterm"/> previously, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Copy your image to the <code class="literal">res/drawable</code> folder and name it <code class="literal">image.jpg</code> (if not a jpeg image, keep the original file extension).</li><li class="listitem">Now open <code class="literal">activity_main.xml</code> and replace the existing XML with the following:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;FrameLayout 
    android:id="@+id/frameLayout"
    android:layout_width="match_parent"
    android:layout_height="match_parent"&gt;
    &lt;LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        android:padding="16dp"&gt;
        &lt;ImageButton
            android:id="@+id/imageViewThumbnail"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:scaleType="centerCrop"
            android:background="@android:color/transparent"/&gt;
    &lt;/LinearLayout&gt;
    &lt;ImageView
        android:id="@+id/imageViewExpanded"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:visibility="invisible" /&gt;
&lt;/FrameLayout&gt;</pre></div></li><li class="listitem">Now open <code class="literal">MainActivity.java</code> and declare the following global variables:<div class="informalexample"><pre class="programlisting">private Animator mCurrentAnimator;
private ImageView mImageViewExpanded;</pre></div></li><li class="listitem">Add the <code class="literal">loadSampledResource()</code> method we created in the <span class="emphasis"><em>Scaling down large images to avoid Out of Memory exceptions</em></span> recipe to scale the image:<div class="informalexample"><pre class="programlisting">public Bitmap loadSampledResource(int imageID, int targetHeight, int targetWidth) {
    final BitmapFactory.Options options = new BitmapFactory.Options();
    options.inJustDecodeBounds = true;
    BitmapFactory.decodeResource(getResources(), imageID, options);
    final int originalHeight = options.outHeight;
    final int originalWidth = options.outWidth;
    int inSampleSize = 1;
    while ((originalHeight / (inSampleSize *2)) &gt; targetHeight &amp;&amp; (originalWidth / (inSampleSize *2)) &gt; targetWidth) {
        inSampleSize *= 2;
    }
    options.inSampleSize =inSampleSize;
    options.inJustDecodeBounds = false;
    return (BitmapFactory.decodeResource(getResources(), imageID, options));
}</pre></div></li><li class="listitem">Add the <a id="id618" class="indexterm"/>following <a id="id619" class="indexterm"/>code to the <code class="literal">onCreate()</code> method:<div class="informalexample"><pre class="programlisting">final ImageView imageViewThumbnail = (ImageView)findViewById(R.id.imageViewThumbnail);
imageViewThumbnail.setImageBitmap(loadSampledResource(R.drawable.image, 100, 100));
imageViewThumbnail.setOnClickListener(new View.OnClickListener() {
    @Override
    public void onClick(View view) {
        zoomFromThumbnail((ImageView) view);
    }
});
mImageViewExpanded = (ImageView) findViewById(R.id.imageViewExpanded);
mImageViewExpanded.setOnClickListener(new View.OnClickListener() {
    @Override
    public void onClick(View v) {
        mImageViewExpanded.setVisibility(View.GONE);
        mImageViewExpanded.setImageBitmap(null);
        imageViewThumbnail.setVisibility(View.VISIBLE);
    }
});</pre></div></li><li class="listitem">Add the following <code class="literal">zoomFromThumbnail()</code> method, which handles the actual animation and is explained later on:<div class="informalexample"><pre class="programlisting">private void zoomFromThumbnail(final ImageView imageViewThumb) {
    if (mCurrentAnimator != null) {
        mCurrentAnimator.cancel();
    }

    final Rect startBounds = new Rect();
    final Rect finalBounds = new Rect();
    final Point globalOffset = new Point();

    imageViewThumb.getGlobalVisibleRect(startBounds);
    findViewById(R.id.frameLayout).getGlobalVisibleRect(finalBounds, globalOffset);
    mImageViewExpanded.setImageBitmap(loadSampledResource(R.drawable.image, finalBounds.height(), finalBounds.width()));

    startBounds.offset(-globalOffset.x, -globalOffset.y);
    finalBounds.offset(-globalOffset.x, -globalOffset.y);

    float startScale;
    if ((float) finalBounds.width() / finalBounds.height() &gt; (float) startBounds.width() / startBounds.height()) {
        startScale = (float) startBounds.height() / finalBounds.height();
        float startWidth = startScale * finalBounds.width();
        float deltaWidth = (startWidth - startBounds.width()) / 2;
        startBounds.left -= deltaWidth;
        startBounds.right += deltaWidth;
    } else {
        startScale = (float) startBounds.width() / finalBounds.width();
        float startHeight = startScale * finalBounds.height();
        float deltaHeight = (startHeight - startBounds.height()) / 2;
        startBounds.top -= deltaHeight;
        startBounds.bottom += deltaHeight;
    }

    imageViewThumb.setVisibility(View.GONE);
    mImageViewExpanded.setVisibility(View.VISIBLE);
    mImageViewExpanded.setPivotX(0f);
    mImageViewExpanded.setPivotY(0f);

    AnimatorSet animatorSet = new AnimatorSet();
    animatorSet.play(ObjectAnimator.ofFloat(mImageViewExpanded, View.X,startBounds.left, finalBounds.left)).with(ObjectAnimator.ofFloat(mImageViewExpanded, View.Y,startBounds.top, finalBounds.top))
                .with(ObjectAnimator.ofFloat(mImageViewExpanded, View.SCALE_X, startScale, 1f))
                .with(ObjectAnimator.ofFloat(mImageViewExpanded, View.SCALE_Y, startScale, 1f));
    animatorSet.setDuration(1000);
    animatorSet.setInterpolator(new DecelerateInterpolator());
    animatorSet.addListener(new AnimatorListenerAdapter() {
        @Override
        public void onAnimationEnd(Animator animation) {
            mCurrentAnimator = null;
        }
        @Override
        public void onAnimationCancel(Animator animation) {
            mCurrentAnimator = null;
        }
    });
    animatorSet.start();
    mCurrentAnimator = animatorSet;
}</pre></div></li><li class="listitem">Run the application on a device or emulator.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec279"/>How it works...</h2></div></div></div><p>First, take a look <a id="id620" class="indexterm"/>at the layout file we used. There<a id="id621" class="indexterm"/> are two parts—the <code class="literal">LinearLayout</code> with the thumbnail <code class="literal">ImageView</code>, and the expanded <code class="literal">ImageView</code>. We control the visibility of both views as the images are clicked. We set the starting thumbnail image using the same <code class="literal">loadSampledResource()</code> as discussed in the <span class="emphasis"><em>Scaling down large images to avoid Out of Memory exceptions</em></span> recipe.</p><p>The <code class="literal">zoomFromThumbnail()</code> is where the real work is being done for this demonstration. There's a lot of code, which breaks down as follows.</p><p>First, we store the current animation in <code class="literal">mCurrentAnimator</code>, so we can cancel if the animation is currently running.</p><p>Next, we get<a id="id622" class="indexterm"/> the starting position of the<a id="id623" class="indexterm"/> image using the <code class="literal">getGlobalVisibleRect()</code> method. This returns the screen position of the view. When we get the visible bounds of the expanded <code class="literal">ImageView</code>, we also get the <code class="literal">GlobalOffset</code> of the view to offset the coordinates from app coordinates to screen coordinates.</p><p>With the starting bounds set, the next step is to calculate the ending bounds. We want to keep the same aspect ratio for the final image to prevent it from being skewed. We need to calculate how the bounds need to be adjusted to keep the aspect ratio within the expanded <code class="literal">ImageView</code>. The screenshot shown in the introduction shows how this image was sized, but this will vary by image and device.</p><p>With the starting and ending bounds calculated, we can now create the animation—actually, four animations in this case. One animation for each point of the rectangle, as shown in this code:</p><div class="informalexample"><pre class="programlisting">animatorSet.play(ObjectAnimator.ofFloat(mImageViewExpanded, View.X,startBounds.left, finalBounds.left)).with(ObjectAnimator.ofFloat(mImageViewExpanded, View.Y,startBounds.top, finalBounds.top)).with(ObjectAnimator.ofFloat(mImageViewExpanded, View.SCALE_X,startScale, 1f)).with(ObjectAnimator.ofFloat(mImageViewExpanded, View.SCALE_Y, startScale, 1f));</pre></div><p>These two lines of code control how the animation appears:</p><div class="informalexample"><pre class="programlisting">animatorSet.setDuration(1000);
animatorSet.setInterpolator(new AccelerateInterpolator());</pre></div><p>The <code class="literal">setDuration()</code> method tells the animator object how long it should take to animate the translations set previously. <code class="literal">setInterpolator()</code> governs how the translation is made. (The Interpolator was mentioned in the <span class="emphasis"><em>Introduction</em></span>, and a link is provided further on.) After starting the animation with the <code class="literal">start()</code> method, we save the current animation to the <code class="literal">mCurrentAnimator</code> variable, so the animation can be cancelled, if needed. We create an <code class="literal">AnimatorListenerAdapter</code> to respond to the animation events, to clear the <code class="literal">mCurrentAnimator</code> variable.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec280"/>There's more...</h2></div></div></div><p>When the user presses the Expanded Image, the application just hides the expanded <code class="literal">ImageView</code> and sets the thumbnail as <code class="literal">visible</code>. We could create a reverse zoom animation in the <code class="literal">mImageViewExpanded</code> click event using the expanded bounds as the starting point returning to the thumbnail bounds. (It would probably be easier to create the <code class="literal">mImageViewExpanded</code> event in the <code class="literal">zoomFromThumbnail()</code> to avoid having to duplicate calculating the start and stop bounds again.)</p><div class="section" title="Getting the default animation duration"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec33"/>Getting the default animation duration</h3></div></div></div><p>Our code used <a id="id624" class="indexterm"/>1000 milliseconds when setting the duration with <code class="literal">setDuration()</code>. We purposely used a long duration to make it easier to view the animation. We can get the default Android animation duration using the following code:</p><div class="informalexample"><pre class="programlisting">getResources().getInteger(android.R.integer.config_shortAnimTime)</pre></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec281"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The first recipe, <span class="emphasis"><em>Scaling down large images to avoid Out of Memory exceptions</em></span>, for a detailed explanation of the <code class="literal">loadSampledResource()</code> method.</li><li class="listitem" style="list-style-type: disc">Refer to the<a id="id625" class="indexterm"/> <span class="strong"><strong>Interpolator Developer Document</strong></span> at <a class="ulink" href="http://developer.android.com/reference/android/view/animation/Interpolator.html">http://developer.android.com/reference/android/view/animation/Interpolator.html</a></li></ul></div></div></div></body></html>