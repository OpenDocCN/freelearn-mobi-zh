<html><head></head><body>
        <section>

            <header>
                <h1 class="header-title">Enemy Characters with AI</h1>
            </header>

            <article>
                
<p>In the previous chapter, we saw how to import 3D geometry and textures into the project, set up the character and add animation to the character. In this chapter, we will put that knowledge to use and start making a fighting game with basic control scheme.</p>
<p>We will import the player character first and set the different animation frames required for the different animations for the fighting like idle, punch, block, and get hit. We will also be creating the different states using the Animation Controller. Animation Controller let us decide the animation flow based on the behavior of the character.</p>
<p>We will also be looking at game balancing and how to be fair to the player. If the game is unfair, the player will get frustrated and quit the game and will not recommend the game to anyone.</p>
<p>We will be implementing controls using mouse and keyboard but, in a later chapter, we will see how to implement touch controls for handheld devices.</p>
<p>At the end of the chapter we will have a basic fighting system in which we get to hit the enemy and the enemy will take hits or block our attack.</p>
<p>This chapter includes the following topics:</p>
<ul>
<li>Importing player model</li>
<li>Creating player using Animation Controller</li>
<li>Scripting player controls</li>
<li>Adding enemy character</li>
<li>Enemy behavior and AI</li>
<li>Finalizing the fight</li>
</ul>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Importing the player model</h1>
            </header>

            <article>
                
<p>First, make sure you create a new Unity 3D project. This is not like the first project we created as this is going to be a 3D project, not a 2D project.</p>
<p>Once you've created the project, you will find the <kbd>Dude.FBX</kbd> file in the assets for this chapter, so drag and drop the file into the Unity project:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="218" src="assets/image_04_001.png" width="317"/></div>
<p>In your case the model will be gray, not red as shown here. To make it red, double-click on the <kbd>Materials</kbd> folder. You will see the <kbd>01- Default</kbd> file. When you select it, you'll will get an option to change the color of the object. Click on the gray box next to the <span class="packt_screen">Albedo</span> option in the <span class="packt_screen">Inspector</span> panel and select a red color to change the color of the character:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="183" src="assets/image_04_002.png" width="335"/></div>
<p>The next thing that needs to be done by us is to create animation clips for all the animations that we have in the game. Click on the <span class="packt_screen">Dude</span> character in the <kbd>Assets</kbd> folder of the project. Now look at the <span class="packt_screen">Inspector</span> pane. In the <span class="packt_screen">Inspector</span> pane you will see three tabs called <span class="packt_screen">Model</span>, <span class="packt_screen">Rig</span>, and <span class="packt_screen">Animations</span>, as shown in the following screenshot. Click on the <span class="packt_screen">Animations</span> tab:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="576" src="assets/image_04_003.png" width="315"/></div>
<p>This shows all the animation clips that currently exist. As of now, there is only one animation clip, called <kbd>Take 001</kbd>, that starts at 0 and ends at 80 frames. You can even preview the animation by clicking on the play button at the bottom of the panel.</p>
<p>You will see that <kbd>Take 001</kbd> has all the animations that were imported, along with the FBX file, and it has the idle, guard, punch and get hit animations. Since all the animations are in a single clip, we have to break up the animations into individual clips.</p>
<p>To do that, first we extract the <span class="packt_screen">idle</span> clip which runs from frame 0 to frame 29. So, we change the name to <span class="packt_screen">idle</span> and set the end frame to 29 for the animation clip as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="339" src="assets/image_04_004.png" width="333"/></div>
<p>Make sure to click on the <span class="packt_screen">Apply</span> button at the bottom for the changes to take effect.</p>
<p>Also, observe that the <span class="packt_screen">Loop Time</span> checkbox is ticked. This is because the animation has to be looped so if we don't check this box, then the animation will just play once and stop.</p>
<p>Now let's extract the second animation clip which is the <kbd>guard</kbd>/<kbd>defend</kbd> animation. For this click on the + icon in the <span class="packt_screen">Clips</span> menu. This will create a default animation called <kbd>Take 001</kbd> as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="71" src="assets/image_04_005.png" width="306"/></div>
<p>Now, once again, select the <span class="packt_screen">Take 001</span> clip, rename it to <span class="packt_screen">defend</span>, and change the start and end time to <span class="packt_screen">32</span> and <span class="packt_screen">49</span>. Click <span class="packt_screen">Loop Time</span> and click on the <span class="packt_screen">Apply</span> button at the end:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="323" src="assets/image_04_006.png" width="317"/></div>
<p>Now add the animation clip for <strong>punch</strong> and <strong>getHit</strong> animations as well. The <span class="packt_screen">punch</span> animation starts from 51 and ends at 60 and the <span class="packt_screen">getHit</span> animation starts at 71 and ends at 75.</p>
<p>For these animations, the <span class="packt_screen">Loop Time</span> option doesn't need to be checked as they don't need to loop. Once you have all the required animations, the <span class="packt_screen">Clips</span> window should look like the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="610" src="assets/image_04_007.png" width="306"/></div>
<p>Once we have finished extracting the animations, we can create the Animation Controller for the player character.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Player Animation Controller</h1>
            </header>

            <article>
                
<p>To create a new Animation Controller right-click on the <kbd>Assets</kbd> folder in the project, select the <span class="packt_screen">Create</span> option, and then select <span class="packt_screen">Animation Controller</span> from the list:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="378" src="assets/image_04_008.png" width="515"/></div>
<p>Rename the file to <span class="packt_screen">dudeAC</span> and double-click on it:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="78" src="assets/image_04_009.png" width="67"/></div>
<p>When you double-click on it, a new panel will open up called <span class="packt_screen">Animation</span>, as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_04_010.png"/></div>
<p>The Animation Controller basically controls the flow of the animation. There are three states that are added in by default; these are <span class="packt_screen">Entry</span>, <span class="packt_screen">Any State</span>, and <span class="packt_screen">Exit</span>:</p>
<ul>
<li>The <span class="packt_screen">Entry</span> state specifies which animation will be played at the start of the scene. So, in most cases the first animation that gets played is the idle animation.</li>
<li>The <span class="packt_screen">Any State</span> specifies which animation needs to be executed irrespective of the previous animation that is being played.</li>
<li>The <span class="packt_screen">Exit</span> state is the animation that is played at the exit of the scene.</li>
</ul>
<p>Let's set up the states for the player, which will be the same setup for the enemy as well.</p>
<p>First, we will create the default animation so that, when the scene starts, the idle animation gets played. In the <span class="packt_screen">Animator</span> panel, right-click anywhere, select <span class="packt_screen">Create</span> State option from the list, and then select the <span class="packt_screen">Empty</span> option, as depicted in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_04_011.png"/></div>
<p>Select the <span class="packt_screen">New State</span> created and open the <span class="packt_screen">Inspector</span> panel.</p>
<p>Next, we need to create a transition from the <span class="packt_screen">Entry</span> state. Right-click on it, a <span class="packt_screen">Make transition</span> option will open, so click on this option. An arrow will start from the clicked state. Now click on the state that we need to transition. This will create a transition to that new state as depicted in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_04_012.png"/></div>
<p>Next, rename the new state to <span class="packt_screen">idle</span>. Click on the new state and rename the state to <span class="packt_screen">Idle</span> and change the <span class="packt_screen">Motion</span> field to <span class="packt_screen">idle</span> by selecting the small circle next to it:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="222" src="assets/image_04_013.png" width="425"/></div>
<p>To test if the controller works, drag and drop <kbd>theDude</kbd> character on to the hierarchy and place him perpendicular to the camera as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_04_014.png"/></div>
<p>Select the <span class="packt_screen">Dude</span> character in the scene and in the <span class="packt_screen">Inspector</span> panel, then drag and drop the Animation Controller on the <span class="packt_screen">Controller</span> field in the <span class="packt_screen">Animator</span> component as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="312" src="assets/image_04_015.png" width="245"/></div>
<p>Click the play button up top and you should see the character with the idle animation playing. Now that we are sure that it is working properly, we can go into the Animation Controller and add states that are required for the game.</p>
<p>In <span class="packt_screen">Any State</span> state, we should be able to have the <span class="packt_screen">defend</span>, <span class="packt_screen">Punch</span> and also <span class="packt_screen">GetHit</span> animations. If the player is not in any of these states then he should revert to <span class="packt_screen">idle</span> state.</p>
<p>So, in the Animation Controller, add the three states, attach the respective animations in the motion, and change the name of each state accordingly. After creating the three states, we also need to transition between the <span class="packt_screen">Any State</span> state and each of these states, and when each of the states has finished, it needs to transition back to the idle state.</p>
<p>To create a transition from a given state, right-click on it: a <span class="packt_screen">Make Transition</span> option will open. Click on it, and an arrow will start from the clicked state. Next, click on the state that we want to transition to. This will create a transition to that state. The transitions are shown in the following figure:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_04_016.png"/></div>
<p>Each of these transitions will be controlled through a script. To trigger each of the states, we will use either Booleans or triggers to enable these state changes.</p>
<p>To create these parameters, click on the <span class="packt_screen">Parameters</span> tab at the side of the <span class="packt_screen">Animator</span> panel.</p>
<p>To create a new parameter, click on the + sign next to the search bar. You can either create a float, integer, Boolean, or a trigger parameter.</p>
<p>For our purpose, we created a Boolean parameter, called <span class="packt_screen">bIsDefending</span>, and two trigger parameters, called <span class="packt_screen">tGotHit</span> and <span class="packt_screen">tIsPunching</span>, as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_04_017.png"/></div>
<p>The difference between a Boolean and a trigger is that a trigger will set itself to false once it has been activated where as a Boolean has to have <kbd>true</kbd> and <kbd>false</kbd> set programmatically.</p>
<p>Let us see how it is implemented in the current game. First, we'll set the transitions for <span class="packt_screen">Punch</span> and <span class="packt_screen">GetHit</span> animations; we will then look at defend after. Select the transition arrow from <span class="packt_screen">Any State</span> to <span class="packt_screen">Punch</span>.</p>
<p>You know the transition has been selected when the arrow turns blue. The screenshot shows how the default state looks. We are going to make some changes here:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_04_018.png"/></div>
<p>First of all, we want this transition to occur only when the player is punching. So in the <span class="packt_screen">Conditions</span> tab, press the + sign and add the <span class="packt_screen">tInPunching</span> condition.</p>
<p>Secondly, uncheck the <span class="packt_screen">Has Exit Time</span> option. If this is checked then the transition will only occur once the previous animation has completed playing. We don't want that. We want the player to start playing the punching animation as soon as we click the <span class="packt_screen">Punch</span> button.</p>
<p>Thirdly, and most importantly, the animation preview window shows the animation played during the transition. Initially it shows that the animation will start from zero, play the idle animation, and then transition to the punch animation. We actually only want the punch animation to start immediately, and we just want one frame of transition between idle and punch animations.</p>
<p>So, we bring the <span class="packt_screen">Punch</span> back to the start and also make the start and stop really small as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_04_019.png"/></div>
<p>Now let's look at the <span class="packt_screen">Punch</span> to <span class="packt_screen">Idle</span> animation:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_04_020.png"/></div>
<p>Here, we keep the <span class="packt_screen">Has Exit Time</span> option checked as we want the animation to finish and then play the idle animation. Also, the idle animation is pulled back to the start and the animation play time is also reduced to one frame.</p>
<p>The same is done for the transition from <span class="packt_screen">Any State</span> to <span class="packt_screen">GetHit</span> as shown in the following screenshot. But here the condition is changed to <span class="packt_screen">tGotHit</span> instead:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_04_021.png"/></div>
<p>Similarly, from <span class="packt_screen">GetHit</span> to <span class="packt_screen">idle</span> state:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_04_022.png"/></div>
<p>Let's look at how to create transitions from <span class="packt_screen">Any State</span> to the <span class="packt_screen">defend</span> state, and then from <span class="packt_screen">defend</span> to the <span class="packt_screen">idle</span> state. The transition from <span class="packt_screen">Any State</span> to the <span class="packt_screen">defend</span> state should be changed to as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_04_023.png"/></div>
<p>Here, once again, we move the defend animation back and change the play to one frame. The <span class="packt_screen">Has Exit Time</span> option is checked and now the condition is changed to <span class="packt_screen">bIsDefending</span>, which is set to <span class="packt_screen">true</span>. For the transition from <span class="packt_screen">defend</span> to <span class="packt_screen">idle</span> animation, we set the <span class="packt_screen">bIsDefending</span> to <span class="packt_screen">false</span> and change the animation width as usual:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_04_024.png"/></div>
<p>For the transition from <span class="packt_screen">idle</span> to <span class="packt_screen">defend</span>, we do it similarly to how we did for <span class="packt_screen">Any State</span> to <span class="packt_screen">defend</span>, except we uncheck the <span class="packt_screen">Has Exit Time</span> checkbox, as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_04_025.png"/></div>
<p>With that we are through the Animation Controllers.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Scripting player controls</h1>
            </header>

            <article>
                
<p>To control the states we need to attach a script to the player. We will be using the left and right mouse clicks to control the player. The left mouse click will be for attacking, and the right mouse click will be for defending. If neither are clicked, then the idle animation will be played.</p>
<p>The controls can be changed under Unity's <span class="packt_screen">Projects Settings</span> option in the <span class="packt_screen">Edit</span> menu. Select the <span class="packt_screen">Input</span> option from the list, as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="419" src="assets/image_04_026.png" width="403"/></div>
<p>Keep the name in mind, as, while referring in the code, we will be using the name of the button. So, for left-click, we will be referring to the name <span class="packt_screen">Fire1</span>. You can check the names of the different buttons in the <span class="packt_screen">Inspector</span> panel:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="216" src="assets/image_04_027.png" width="236"/></div>
<p>Let's create a new script by right-clicking in the <span class="packt_screen">Assets</span> folder option | <span class="packt_screen">Create</span> | <span class="packt_screen">C# Script</span> and name it <kbd>playerScript</kbd>. Double-click on it and it should open in Visual Studio.</p>
<p>Add the following code to the script:</p>
<pre>
    using UnityEngine; <br/>    using System.Collections; <br/><br/>    public class playerScript : MonoBehaviour { <br/>        private Animator anim; <br/><br/>        // Use this for initialization <br/>        void Start () { <br/>            anim = GetComponent&lt;Animator&gt;(); <br/>        } // start <br/><br/><br/>        // Update is called once per frame <br/>        void Update () { <br/>            <br/>            //Defending <br/>            if (Input.GetButtonDown("Fire2")){ <br/>                // Debug.Log("Jump pressed"); <br/>                anim.SetBool("bIsDefending", true); <br/>            } else if (Input.GetButtonUp("Fire2")) { <br/>                anim.SetBool("bIsDefending", false); <br/>            } <br/><br/>            //Attacking <br/>            if (Input.GetButtonDown("Fire1")){ <br/>                anim.SetBool("bIsDefending", false); <br/>                anim.SetTrigger("tIsPunching"); <br/>                //Debug.Log("Fire pressed"); <br/>            } <br/>        } // update <br/>    } 
</pre>
<p>At the top, we create a <kbd>private</kbd> variable to get the Animator component and store it in the variable.</p>
<p>Next, in the start function, we get the Animator component and assign it to <kbd>anim,</kbd> as otherwise we would have to do this for every frame which would get very taxing.</p>
<p>In the <kbd>Update</kbd> function, we first check for defending. If the <kbd>Fire 2</kbd> button, which is the right-click on the mouse, is pressed then we set the <kbd>bIsDefending</kbd> to <kbd>true</kbd>. The <kbd>bIsDefending</kbd> variable is the same as that we defined as a parameter in the <span class="packt_screen">Animation Controller</span> option.</p>
<p>If the button is up, then we set the <kbd>bIsDefending</kbd> variable to <kbd>false</kbd>.</p>
<p>Next, we set the attacking state. If the <kbd>Fire1</kbd> button is pressed, then we first set defending to <kbd>false</kbd>, and then set <kbd>tIsPunching</kbd> to <kbd>true</kbd>. We also debug logout so that, we can see the specific code of hit.</p>
<p>To see if this really works, we have to attach it to the player character in the scene and add it as a component: drag the code and add it as a component to <kbd>theDude</kbd> character. Now, if you look in the Inspector, you can see that the script has been added:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="358" src="assets/image_04_028.png" width="227"/></div>
<p>Now, if you right-click on the mouse, the player should block, and if you left-click with the mouse, the player should punch.</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_04_029.png"/></div>
<p>Let's give the player an enemy to punch at.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Adding an enemy character</h1>
            </header>

            <article>
                
<p>Just as we dragged the player into the scene, drag theDude character from <kbd>Assets</kbd> into the <kbd>Hierarchy</kbd>. Rename this character to <span class="packt_screen">Enemy</span> in the <kbd>Hierarchy</kbd>. This dude will also be red, which we don't want, so we'll create a new material.</p>
<p>Right-click on the <span class="packt_screen">Material</span> folder and then select <span class="packt_screen">Create</span> | <span class="packt_screen">Material</span>. Name the material enemy as <kbd>Material</kbd>. Change the color next to <span class="packt_screen">Albedo</span> color control from the default to blue.</p>
<p>Now drag and drop the material to the enemy character. Also place and rotate the character so that it is standing opposite to the player character, as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/image_04_030.png"/></div>
<p>Also drag the dudeAC Animation Controller to the <span class="packt_screen">Controller</span> component in the <span class="packt_screen">Animator</span> component for the enemy as well:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="217" src="assets/image_04_031.png" width="222"/></div>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Enemy behavior and AI</h1>
            </header>

            <article>
                
<p>The enemy will start with the idle animation as you play the game. Let's add some behavior to the enemy character.</p>
<p>The AI is implemented by creating a pattern, which will determine when the next state change for the enemy will take place, and the period of time that the enemy will either be idle, defend, or attack.</p>
<p>The pattern is an array and has 20 elements in it. After all the elements are exhausted the patterns is randomized and the counter is set to 0 again.</p>
<p>Some intervals last for 10 frames, while others last for up to 120 frames or two seconds. The player has to judge and make sure that he doesn't get hit, and he has to defeat the <kbd>enemy</kbd> before they kill him. This will make more sense once we go through the code.</p>
<p>Create a new C# script and name it <kbd>enemy</kbd>. Add the following script to the code.</p>
<p>First, we initialize our variables:</p>
<pre>
    using UnityEngine; <br/>    using System.Collections; <br/><br/>    public class enemy : MonoBehaviour { <br/><br/>    private Animator anim; <br/><br/>    int myTick = 0; <br/>    int currentTick = 0; <br/>    int prevTick = 0; <br/>    int nextTick = 0; <br/>    int patternLength = 0; <br/>    int patterCount = 0; <br/><br/><br/>    int[] pattern = new[] {10, 10, 10,30, 60, 10, 40, 60, 120, 30, <br/>                           10, 10,10, 60, 60, 120, 30, 10, 10, 10}; <br/>    // Use this for initialization 
</pre>
<p>In the <kbd>Start</kbd> function, we get the <kbd>Animator</kbd> component and set the pattern, which we will randomizing later:</p>
<pre>
    void Start () { <br/><br/>    anim = GetComponent&lt;Animator&gt;(); <br/>    anim.SetBool("bIsDefending", true); <br/><br/>    Shuffle(pattern); <br/><br/>    patternLength = pattern.Length; <br/>    nextTick = pattern[0]; <br/><br/>    } // start 
</pre>
<p>In the <kbd>Update</kbd> function we update the values that we set initially:</p>
<pre>
    // Update is called once per frame <br/>    void Update () { <br/><br/>        myTick++; <br/>        currentTick = myTick;        <br/><br/>        if (currentTick == prevTick + nextTick) { <br/>            int choice = Random.Range(1, 3); <br/><br/>            switch (choice) { <br/><br/>                //will punch <br/>                case 1: anim.SetBool("bIsDefending", false); <br/>                    anim.SetTrigger("tIsPunching"); <br/>                    break; <br/><br/>                //will defend <br/>                case 2: anim.SetBool("bIsDefending", true); <br/>                    break; <br/><br/>                //will be idle  <br/>                case 3: anim.SetBool("bIsDefending", false); break; <br/>            } <br/><br/>            prevTick = currentTick; <br/>            nextTick = pattern[patterCount]; <br/><br/>            if ((patterCount + 1) &gt;= pattern.Length){ <br/>                patterCount = 0; <br/>                Shuffle(pattern); <br/>            } <br/>            else { <br/>                patterCount++; <br/>            } <br/>        } <br/>    } // Update 
</pre>
<p>The <kbd>Shuffle</kbd> function randomizes the initial pattern that we created:</p>
<pre>
    void Shuffle(int[] a){ <br/><br/>        for (inti = a.Length - 1; i&gt; 0; i--){ <br/>            int rnd = Random.Range(0, i); <br/>            int temp = a[i]; <br/>            a[i] = a[rnd]; <br/>            a[rnd] = temp; <br/>        } <br/><br/>        for (inti = 0; i&lt;a.Length; i++){ <br/>            Debug.Log(a[i]); <br/>        } <br/>     } // shuffle    
</pre>
<p>As in the case of the player at the top of the code, we create a <kbd>private</kbd> variable to store the enemy animator variable.</p>
<p>We also create a bunch of integer variables called <kbd>myTick</kbd>, <kbd>currentTick</kbd>, <kbd>prevTick</kbd>, <kbd>nextTick</kbd>, <kbd>patternLength</kbd> and <kbd>patternCount</kbd>.</p>
<p>The <kbd>myTick</kbd> variable is just a counter, which keeps incrementing. The <kbd>CurrentTick</kbd> and <kbd>prevTick</kbd> variables keep track of the current frame tick and <kbd>prevTick</kbd> keeps track of the tick when an action last occurred.</p>
<p>The <kbd>patternLength</kbd> variable keeps track of the number of the items in the pattern array and <kbd>patternCount</kbd> keeps track of the current pattern number in use.</p>
<p>Pattern is an array containing the intervals for the actions.</p>
<p>In the <kbd>Start</kbd> function, we get the Animator component and set the <kbd>isDenfendingbool</kbd> variable to <kbd>true</kbd> so that the enemy starts off defending. We shuffle the pattern and assign the <kbd>patternLength</kbd> and <kbd>nextTick</kbd> to the first element of the pattern.</p>
<p>Next in the <kbd>Update</kbd> function, we first increment the tick and assign <kbd>myTick</kbd> to the <kbd>currentTick</kbd>.</p>
<p>We then check whether it is time for the next action to perform by checking if the <kbd>currentTick</kbd> is equal to the sum of the previous tick and <kbd>nextTick</kbd>.</p>
<p>If it is equal, then we create a random number from one to three. Depending upon whether the returned value is 1, 2, or 3, there is a <kbd>switch</kbd> statement and the enemy will punch, defend, or be idle.</p>
<p>At the end, we assign the <kbd>currentTick</kbd> to <kbd>previousTick</kbd>, and <kbd>nextTick</kbd> to next <kbd>patternCount</kbd>.</p>
<p>We also need to increment the <kbd>patternCount</kbd> and to check if the <kbd>patternCount</kbd> variable's value has exceeded the length. If it is has exceeded it, then we need to reset it.</p>
<p>So, if the value of <kbd>patternCount++</kbd> is greater than or equal to the value of <kbd>patternLegth</kbd>, then we reset the pattern to zero and shuffle the pattern, otherwise we just increment the <kbd>patterCount</kbd>.</p>
<p>Finally, we also have a function which shuffles the pattern so that it doesn't get repeated. Add this script component to the enemy object in the scene and watch him be idle, block, and punch:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class="image-border" src="assets/image_04_032.png"/></div>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Finalizing the fight</h1>
            </header>

            <article>
                
<p>Let us make the player react to the enemy's attacks by changing the behavior of the player. In the <kbd>playerScript</kbd>, add the following line of code. At the top of the class, create a new <kbd>public</kbd> variable of type <kbd>GameObject</kbd> and call it <kbd>enemy</kbd>:</p>
<pre>
    public GameObject enemy; 
</pre>
<p>Next, at the start of the <kbd>Update</kbd> function, get the <kbd>Animator</kbd> component of the enemy:</p>
<pre>
    Animator eAnim = enemy.GetComponent&lt;Animator&gt;(); 
</pre>
<p>Next, after the attacking function in the update, add the following:</p>
<pre>
    // Getting Hit <br/>    if (eAnim.GetBool("tIsPunching")){ <br/>        if (anim.GetBool("bIsDefending") == false){ <br/>            //Debug.Log("I got hit"); <br/>            anim.SetTrigger("tGotHit"); <br/>        } <br/>    }  
</pre>
<p>Here, we check if the enemy is punching. If the enemy is punching and the player is not defending, then we set the <kbd>gotHit</kbd> trigger to be <kbd>true</kbd>.</p>
<p>Drag <kbd>theDude</kbd> character to the enemy script component as shown in the following screenshot:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="417" src="assets/image_04_033.png" width="254"/></div>
<p>Similarly, in the enemy script add a public GameObject variable called player.</p>
<pre>
    public GameObject player; 
</pre>
<p>Just before the end of the <kbd>Update</kbd> function, add the following.</p>
<pre>
    Animator pAnim = player.GetComponent&lt;Animator&gt;(); <br/><br/>    // Getting Hit <br/>    if (pAnim.GetBool("tIsPunching")) { <br/>        if (anim.GetBool("bIsDefending") == false) { <br/>            //Debug.Log("I got hit"); <br/>            anim.SetTrigger("tGotHit"); <br/>        } <br/>    } 
</pre>
<p>Drag and drop the player in the <kbd>GameObject</kbd> in the enemy script take a hit when he is not defending:</p>
<div class="packt_figure CDPAlignCenter CDPAlign"><img class=" image-border" height="403" src="assets/image_04_034.png" width="244"/></div>
<p>Now play the game and you will see that the enemy will take a hit when he is not defending:</p>
<p>Also, as of now the player can keep left-clicking and the hero character can keep punching. To limit the number of punches the player can do, add the following code.</p>
<p>Add the following at the top:</p>
<pre>
    float totalTime = 0.0f; <br/>    float timeSinceLastHit = 0.0f; <br/>    float hitTimeInterval = 30.0f * .016f; 
</pre>
<p>At the start of the <kbd>Update</kbd> function, increment the time:</p>
<pre>
    totalTime += Time.deltaTime; 
</pre>
<p>The attack code needs to be changed to:</p>
<pre>
    // Attacking <br/>    if (totalTime&gt;= timeSinceLastHit + hitTimeInterval){ <br/>        if (Input.GetButtonDown("Fire1")){ <br/>            anim.SetBool("bIsDefending", false); <br/>            anim.SetTrigger("tIsPunching"); <br/><br/>            timeSinceLastHit = totalTime; <br/>            //Debug.Log("Fire pressed"); <br/>        } <br/>    } 
</pre>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    

        <section>

            <header>
                <h1 class="header-title">Summary</h1>
            </header>

            <article>
                
<p>In this chapter, we saw how to import an FBX model, import the animations, and set names for the individual animations. We created an Animation Controller and transitions between animations. Once the animations controller had been created, we then controlled the animation using the code.</p>
<p>We also created player controls, created a very basic AI, and controlled the AI behavior with a pattern which we randomized to avoid pattern repetition.</p>
<p>Now that we have a basic skeleton to work with, we will improve this and add a proper game loop in the next chapter.</p>


            </article>

            <footer style="margin-top: 5em;">
                
            </footer>

        </section>
    </body></html>