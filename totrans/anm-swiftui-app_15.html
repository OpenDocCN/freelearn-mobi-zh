<html><head></head><body>
<div id="_idContainer220">
<h1 class="chapter-number" id="_idParaDest-208"><a id="_idTextAnchor219"/><span class="koboSpan" id="kobo.1.1">15</span></h1>
<h1 id="_idParaDest-209"><a id="_idTextAnchor220"/><span class="koboSpan" id="kobo.2.1">Integrating SpriteKit into Your SwiftUI Projects</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In this chapter, we will dive deeper into the world of animation in SwiftUI and create some mini-projects, highlighting different animations that can be made using other techniques and the SpriteKit framework. </span><span class="koboSpan" id="kobo.3.2">Some of the animations will be simpler, some will be more complex, and some will be dynamic and interactive </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">animations too.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">You will learn how to take advantage of the power of </span><strong class="bold"><span class="koboSpan" id="kobo.6.1">SpriteKit</span></strong><span class="koboSpan" id="kobo.7.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.8.1">particle emitters</span></strong><span class="koboSpan" id="kobo.9.1">. </span><span class="koboSpan" id="kobo.9.2">SpriteKit is a game</span><a id="_idIndexMarker840"/><span class="koboSpan" id="kobo.10.1"> development framework</span><a id="_idIndexMarker841"/><span class="koboSpan" id="kobo.11.1"> that provides a convenient and efficient way to create 2D games for iOS and macOS platforms. </span><span class="koboSpan" id="kobo.11.2">Particle emitters, on the other hand, are powerful tools in the SpriteKit framework that allow you to create special effects such as fire, smoke, rain, wind, explosions, and more. </span><span class="koboSpan" id="kobo.11.3">These emitters will bring life to your apps, making them visually stunning and engaging </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">for users.</span></span></p>
<p><span class="koboSpan" id="kobo.13.1">So, here are the topics we will cover in this </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">final chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.15.1">Animating </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">pipe smoke</span></span></li>
<li><span class="koboSpan" id="kobo.17.1">Animating </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">coffee steam</span></span></li>
<li><span class="koboSpan" id="kobo.19.1">Animating </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">rocket fire</span></span></li>
<li><span class="koboSpan" id="kobo.21.1">Animating </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">a blizzard</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.23.1">Animating rain</span></span></li>
<li><span class="koboSpan" id="kobo.24.1">Animating a </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">magic wand</span></span></li>
</ul>
<h1 id="_idParaDest-210"><a id="_idTextAnchor221"/><span class="koboSpan" id="kobo.26.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.27.1">You can find the completed projects and their code in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.28.1">Chapter 15</span></strong></span><span class="koboSpan" id="kobo.29.1"> folder on </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">GitHub: </span></span><a href="https://github.com/PacktPublishing/Animating-SwiftUI-Applications"><span class="No-Break"><span class="koboSpan" id="kobo.31.1">https://github.com/PacktPublishing/Animating-SwiftUI-Applications</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.32.1">.</span></span></p>
<h1 id="_idParaDest-211"><a id="_idTextAnchor222"/><span class="koboSpan" id="kobo.33.1">Animating pipe smoke</span></h1>
<p><span class="koboSpan" id="kobo.34.1">In this project, we will create</span><a id="_idIndexMarker842"/><span class="koboSpan" id="kobo.35.1"> a smoke effect using SpriteKit’s </span><strong class="bold"><span class="koboSpan" id="kobo.36.1">Smoke</span></strong><span class="koboSpan" id="kobo.37.1"> template, and make it come out of an image of a pipe. </span><span class="koboSpan" id="kobo.37.2">This is a good first project, as it’s not too complicated</span><a id="_idIndexMarker843"/><span class="koboSpan" id="kobo.38.1"> and gets you familiar with creating the needed </span><strong class="bold"><span class="koboSpan" id="kobo.39.1">SpriteKit Scene</span></strong><span class="koboSpan" id="kobo.40.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.41.1">SKS</span></strong><span class="koboSpan" id="kobo.42.1">) particle file and how to configure it. </span></p>
<p><span class="koboSpan" id="kobo.43.1">Let’s get started, first create a new SwiftUI project, and call it </span><strong class="source-inline"><span class="koboSpan" id="kobo.44.1">Pipe Smoke</span></strong><span class="koboSpan" id="kobo.45.1">. </span><span class="koboSpan" id="kobo.45.2">We are going to need a couple of images for this project so you can grab them over at GitHub (</span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.46.1">Chapter 15</span></strong></span><span class="koboSpan" id="kobo.47.1"> | </span><strong class="source-inline"><span class="koboSpan" id="kobo.48.1">Pipe Smoke</span></strong><span class="koboSpan" id="kobo.49.1">) and add them to the project’s Assets catalog. </span><span class="koboSpan" id="kobo.49.2">Now it’s time to create a SpriteKit </span><span class="No-Break"><span class="koboSpan" id="kobo.50.1">particle file.</span></span></p>
<h2 id="_idParaDest-212"><a id="_idTextAnchor223"/><span class="koboSpan" id="kobo.51.1">Creating a SpriteKit particle file</span></h2>
<p><span class="koboSpan" id="kobo.52.1">Next, let’s create</span><a id="_idIndexMarker844"/><span class="koboSpan" id="kobo.53.1"> a new file; this will be a SpriteKit</span><a id="_idIndexMarker845"/><span class="koboSpan" id="kobo.54.1"> particle file. </span><span class="koboSpan" id="kobo.54.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.55.1">SpriteKit Scene</span></strong><span class="koboSpan" id="kobo.56.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.57.1">SKS</span></strong><span class="koboSpan" id="kobo.58.1">) </span><strong class="bold"><span class="koboSpan" id="kobo.59.1">particle file</span></strong><span class="koboSpan" id="kobo.60.1"> is a scene file that has information about the particle system it contains, such as the shape, size, and position of the particle emitter, as well as the type of particles that will be emitted, their behavior, </span><span class="No-Break"><span class="koboSpan" id="kobo.61.1">and movements.</span></span></p>
<p><span class="koboSpan" id="kobo.62.1">To create an SKS particle file, in Xcode, you simply need to go to </span><strong class="bold"><span class="koboSpan" id="kobo.63.1">File</span></strong><span class="koboSpan" id="kobo.64.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.65.1">New</span></strong><span class="koboSpan" id="kobo.66.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.67.1">File</span></strong><span class="koboSpan" id="kobo.68.1"> | </span><strong class="bold"><span class="koboSpan" id="kobo.69.1">SpriteKit Particle File</span></strong><span class="koboSpan" id="kobo.70.1">, or press </span><em class="italic"><span class="koboSpan" id="kobo.71.1">Command + N</span></em><span class="koboSpan" id="kobo.72.1"> to bring up the template options, and scroll down until you come to a template called </span><strong class="bold"><span class="koboSpan" id="kobo.73.1">SpriteKit Particle File</span></strong><span class="koboSpan" id="kobo.74.1">. </span></p>
<p><span class="koboSpan" id="kobo.75.1">Now, we need to choose the type of template we want. </span><span class="koboSpan" id="kobo.75.2">There are several options and we’re going to explore them individually in separate projects, but the one we want now </span><span class="No-Break"><span class="koboSpan" id="kobo.76.1">is </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.77.1">Smoke</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.78.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer205">
<span class="koboSpan" id="kobo.79.1"><img alt="Figure 15.1: Particle template options " src="image/B18674_15_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.80.1">Figure 15.1: Particle template options</span></p>
<p><span class="koboSpan" id="kobo.81.1">Once you click </span><strong class="bold"><span class="koboSpan" id="kobo.82.1">Next</span></strong><span class="koboSpan" id="kobo.83.1">, name the file </span><strong class="source-inline"><span class="koboSpan" id="kobo.84.1">Smoke</span></strong><span class="koboSpan" id="kobo.85.1">, choose a save</span><a id="_idIndexMarker846"/><span class="koboSpan" id="kobo.86.1"> location, and then </span><span class="No-Break"><span class="koboSpan" id="kobo.87.1">click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.88.1">Create</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.89.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer206">
<span class="koboSpan" id="kobo.90.1"><img alt="Figure 15.2: Creating the Smoke.sks file " src="image/B18674_15_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.91.1">Figure 15.2: Creating the Smoke.sks file</span></p>
<p><span class="koboSpan" id="kobo.92.1">Now, you will see a new</span><a id="_idIndexMarker847"/><span class="koboSpan" id="kobo.93.1"> particle file in your Xcode editor that has a smoke animation playing. </span><span class="koboSpan" id="kobo.93.2">That’s because we chose the </span><strong class="bold"><span class="koboSpan" id="kobo.94.1">Smoke</span></strong><span class="koboSpan" id="kobo.95.1"> template, so the particles are pre-configured to produce smoke. </span><span class="koboSpan" id="kobo.95.2">This smoke will need to be adjusted so it’s not as wide and thick. </span><span class="koboSpan" id="kobo.95.3">We want the effect to be thin and small enough that we can make it come out of </span><span class="No-Break"><span class="koboSpan" id="kobo.96.1">a pipe.</span></span></p>
<p><span class="koboSpan" id="kobo.97.1">To configure the smoke, go to the right side of Xcode and you’ll see four buttons; if you click on the fourth button, you open up the </span><strong class="bold"><span class="koboSpan" id="kobo.98.1">Attributes</span></strong><span class="koboSpan" id="kobo.99.1"> panel, which is where we can configure our particle file to create an infinite number </span><span class="No-Break"><span class="koboSpan" id="kobo.100.1">of effects:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer207">
<span class="koboSpan" id="kobo.101.1"><img alt="Figure 15.3: Xcode’s Attributes panel " src="image/B18674_15_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.102.1">Figure 15.3: Xcode’s Attributes panel</span></p>
<p><span class="koboSpan" id="kobo.103.1">There are quite a few settings</span><a id="_idIndexMarker848"/><span class="koboSpan" id="kobo.104.1"> in this panel, and since we will be creating different particle files in this chapter, it’s a good idea to have an understanding of what each field does. </span><span class="koboSpan" id="kobo.104.2">So, I will explain each field in order for you to create this first project in the chapter, and you can use these definitions for reference as you continue working through the </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">other projects.</span></span></p>
<h3><span class="koboSpan" id="kobo.106.1">Name</span></h3>
<p><span class="koboSpan" id="kobo.107.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.108.1">Name</span></strong><span class="koboSpan" id="kobo.109.1"> field is used to give a unique</span><a id="_idIndexMarker849"/><span class="koboSpan" id="kobo.110.1"> identifier to the particle emitter so that you can easily reference it within your code or in the editor. </span><span class="koboSpan" id="kobo.110.2">The field is a string value that you can set to anything you like, as long as it’s unique within the file. </span><span class="koboSpan" id="kobo.110.3">By giving your particle emitters descriptive names, they will act as a reminder of what they do and how they’re used in your project. </span></p>
<p><span class="koboSpan" id="kobo.111.1">Additionally, you can use the </span><strong class="bold"><span class="koboSpan" id="kobo.112.1">Name</span></strong><span class="koboSpan" id="kobo.113.1"> field to access the particle emitter and modify its properties programmatically in </span><span class="No-Break"><span class="koboSpan" id="kobo.114.1">your code.</span></span></p>
<h3><span class="koboSpan" id="kobo.115.1">Background</span></h3>
<p><span class="koboSpan" id="kobo.116.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.117.1">Background</span></strong><span class="koboSpan" id="kobo.118.1"> field lets you set the background</span><a id="_idIndexMarker850"/><span class="koboSpan" id="kobo.119.1"> color of the editor. </span><span class="koboSpan" id="kobo.119.2">Sometimes, it’s useful to adjust this color to help make the particles stand </span><span class="No-Break"><span class="koboSpan" id="kobo.120.1">out more.</span></span></p>
<h3><span class="koboSpan" id="kobo.121.1">Texture</span></h3>
<p><span class="koboSpan" id="kobo.122.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.123.1">Texture</span></strong><span class="koboSpan" id="kobo.124.1"> field is used to specify the image file</span><a id="_idIndexMarker851"/><span class="koboSpan" id="kobo.125.1"> that will be used as the particle texture. </span><span class="koboSpan" id="kobo.125.2">The particle texture is essentially the appearance of the particles, and you can use any image file you like to create a wide range of particle effects. </span><span class="koboSpan" id="kobo.125.3">For example, you could use a simple dot or circle image for a simple particle effect, or a more complex image with multiple shapes and colors for a more elaborate effect. </span><span class="koboSpan" id="kobo.125.4">When you specify a particle texture in the </span><strong class="bold"><span class="koboSpan" id="kobo.126.1">Attributes</span></strong><span class="koboSpan" id="kobo.127.1"> panel, it will be used for all of the particles in the particle emitter. </span></p>
<h3><span class="koboSpan" id="kobo.128.1">Emitter</span></h3>
<p><strong class="bold"><span class="koboSpan" id="kobo.129.1">Emitter</span></strong><span class="koboSpan" id="kobo.130.1"> is the object that defines the characteristics</span><a id="_idIndexMarker852"/><span class="koboSpan" id="kobo.131.1"> of a particle, such as its initial position, speed, </span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">and lifetime.</span></span></p>
<p><span class="koboSpan" id="kobo.133.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.134.1">Emitter Birthrate</span></strong><span class="koboSpan" id="kobo.135.1"> field specifies the number of particles that are emitted per second. </span><span class="koboSpan" id="kobo.135.2">It determines how quickly the particles will be generated by the emitter – a higher birthrate will result in more particles being emitted in a shorter amount of time, while a lower birthrate will result in fewer particles being emitted over a longer period </span><span class="No-Break"><span class="koboSpan" id="kobo.136.1">of time.</span></span></p>
<p><span class="koboSpan" id="kobo.137.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.138.1">Emitter Maximum</span></strong><span class="koboSpan" id="kobo.139.1"> field sets the maximum number of particles that can exist at one time in the particle system. </span><span class="koboSpan" id="kobo.139.2">If </span><strong class="bold"><span class="koboSpan" id="kobo.140.1">Birthrate</span></strong><span class="koboSpan" id="kobo.141.1"> is set to a high value and </span><strong class="bold"><span class="koboSpan" id="kobo.142.1">Maximum</span></strong><span class="koboSpan" id="kobo.143.1"> is set to a low value, the emitter will emit particles at the specified rate until the maximum limit is reached. </span><span class="koboSpan" id="kobo.143.2">Once the maximum number of particles has been reached, the emitter will stop emitting new particles until some of the existing particles have disappeared. </span><span class="koboSpan" id="kobo.143.3">This allows you to control the overall</span><a id="_idIndexMarker853"/><span class="koboSpan" id="kobo.144.1"> number of particles in your particle system and </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">optimize performance.</span></span></p>
<h3><span class="koboSpan" id="kobo.146.1">Lifetime</span></h3>
<p><span class="koboSpan" id="kobo.147.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.148.1">Lifetime</span></strong><span class="koboSpan" id="kobo.149.1"> fields specify the amount of time that each particle</span><a id="_idIndexMarker854"/><span class="koboSpan" id="kobo.150.1"> in a particle system will be active before it disappears. </span></p>
<p><span class="koboSpan" id="kobo.151.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.152.1">Lifetime Start</span></strong><span class="koboSpan" id="kobo.153.1"> field specifies the length of time for which each particle will exist in the particle system. </span><span class="koboSpan" id="kobo.153.2">It determines how long each particle will stay visible in the scene before disappearing. </span><span class="koboSpan" id="kobo.153.3">A higher value will result in particles staying visible for a longer period of time, while a lower value will result in particles disappearing </span><span class="No-Break"><span class="koboSpan" id="kobo.154.1">more quickly.</span></span></p>
<p><span class="koboSpan" id="kobo.155.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.156.1">Lifetime Range</span></strong><span class="koboSpan" id="kobo.157.1"> field sets the range of values that the </span><strong class="bold"><span class="koboSpan" id="kobo.158.1">Lifetime</span></strong><span class="koboSpan" id="kobo.159.1"> property can take. </span><span class="koboSpan" id="kobo.159.2">Instead of specifying a fixed value for the lifetime, you can specify a range of values, and the particle system will randomly choose a value from that range for each particle that is emitted. </span><span class="koboSpan" id="kobo.159.3">This allows you to add variation to your particle system, making it look more organic and natural. </span><span class="koboSpan" id="kobo.159.4">For example, if you set </span><strong class="bold"><span class="koboSpan" id="kobo.160.1">Lifetime Start</span></strong><span class="koboSpan" id="kobo.161.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.162.1">1.0</span></strong><span class="koboSpan" id="kobo.163.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.164.1">Lifetime Range</span></strong><span class="koboSpan" id="kobo.165.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.166.1">0.5</span></strong><span class="koboSpan" id="kobo.167.1">, each particle’s lifetime will be a random value between 0.5 and </span><span class="No-Break"><span class="koboSpan" id="kobo.168.1">1.5 seconds.</span></span></p>
<h3><span class="koboSpan" id="kobo.169.1">Position Range</span></h3>
<p><span class="koboSpan" id="kobo.170.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.171.1">Position Range</span></strong><span class="koboSpan" id="kobo.172.1"> fields specify the range of values</span><a id="_idIndexMarker855"/><span class="koboSpan" id="kobo.173.1"> for the initial position of the particles in each dimension – </span><strong class="bold"><span class="koboSpan" id="kobo.174.1">X</span></strong><span class="koboSpan" id="kobo.175.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.176.1">Y</span></strong><span class="koboSpan" id="kobo.177.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.178.1">Z</span></strong><span class="koboSpan" id="kobo.179.1"> – allowing you to create particle systems that emit particles from a random position within a defined area. </span><span class="koboSpan" id="kobo.179.2">The particle system will randomly choose a position from within the specified range for each particle that is emitted, which can help add variety and realism to your </span><span class="No-Break"><span class="koboSpan" id="kobo.180.1">particle</span></span><span class="No-Break"><a id="_idIndexMarker856"/></span><span class="No-Break"><span class="koboSpan" id="kobo.181.1"> systems.</span></span></p>
<h3><span class="koboSpan" id="kobo.182.1">Angle</span></h3>
<p><span class="koboSpan" id="kobo.183.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.184.1">Angle</span></strong><span class="koboSpan" id="kobo.185.1"> fields in an SKS particle file control</span><a id="_idIndexMarker857"/><span class="koboSpan" id="kobo.186.1"> the initial direction and spread of particles when they are emitted. </span><strong class="bold"><span class="koboSpan" id="kobo.187.1">Angle Start</span></strong><span class="koboSpan" id="kobo.188.1"> sets the starting direction of the particles, while </span><strong class="bold"><span class="koboSpan" id="kobo.189.1">Angle Range</span></strong><span class="koboSpan" id="kobo.190.1"> determines the range of possible directions; the system then randomly chooses an angle within the range for each particle emitted. </span><strong class="bold"><span class="koboSpan" id="kobo.191.1">Angle Start</span></strong><span class="koboSpan" id="kobo.192.1"> is measured in degrees, with 0 degrees pointing to the right, and </span><strong class="bold"><span class="koboSpan" id="kobo.193.1">Angle Range</span></strong><span class="koboSpan" id="kobo.194.1"> specifies the spread of angles in a counterclockwise direction, again measured </span><span class="No-Break"><span class="koboSpan" id="kobo.195.1">in degrees.</span></span></p>
<h3><span class="koboSpan" id="kobo.196.1">Speed</span></h3>
<p><span class="koboSpan" id="kobo.197.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.198.1">Speed</span></strong><span class="koboSpan" id="kobo.199.1"> fields control the initial speed</span><a id="_idIndexMarker858"/><span class="koboSpan" id="kobo.200.1"> and variation of particles when emitted in an SKS particle file. </span><strong class="bold"><span class="koboSpan" id="kobo.201.1">Speed Start</span></strong><span class="koboSpan" id="kobo.202.1"> sets the starting speed, while </span><strong class="bold"><span class="koboSpan" id="kobo.203.1">Speed Range</span></strong><span class="koboSpan" id="kobo.204.1"> specifies the possible range of speeds; a random speed is then chosen within the specified range for each emitted particle. </span></p>
<p><span class="koboSpan" id="kobo.205.1">Adjusting these fields allows you to create various particle effects, with a higher value resulting in faster particles and a lower value in slower particles. </span><span class="koboSpan" id="kobo.205.2">For example, setting </span><strong class="bold"><span class="koboSpan" id="kobo.206.1">Speed Start</span></strong><span class="koboSpan" id="kobo.207.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.208.1">100</span></strong><span class="koboSpan" id="kobo.209.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.210.1">Speed Range</span></strong><span class="koboSpan" id="kobo.211.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.212.1">0</span></strong><span class="koboSpan" id="kobo.213.1"> will emit particles at a constant speed, while setting </span><strong class="bold"><span class="koboSpan" id="kobo.214.1">Speed Start</span></strong><span class="koboSpan" id="kobo.215.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.216.1">50</span></strong><span class="koboSpan" id="kobo.217.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.218.1">Speed Range</span></strong><span class="koboSpan" id="kobo.219.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.220.1">25</span></strong><span class="koboSpan" id="kobo.221.1"> will create particles with varying speeds between 25 and 75. </span><span class="koboSpan" id="kobo.221.2">These values are generally understood to be points </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">per second.</span></span></p>
<h3><span class="koboSpan" id="kobo.223.1">Acceleration</span></h3>
<p><span class="koboSpan" id="kobo.224.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.225.1">Acceleration X</span></strong><span class="koboSpan" id="kobo.226.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.227.1">Acceleration Y</span></strong><span class="koboSpan" id="kobo.228.1"> fields control the acceleration</span><a id="_idIndexMarker859"/><span class="koboSpan" id="kobo.229.1"> of the particles in the </span><em class="italic"><span class="koboSpan" id="kobo.230.1">x</span></em><span class="koboSpan" id="kobo.231.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.232.1">y</span></em><span class="koboSpan" id="kobo.233.1"> directions respectively. </span><span class="koboSpan" id="kobo.233.2">For example, you could set </span><strong class="bold"><span class="koboSpan" id="kobo.234.1">Acceleration X</span></strong><span class="koboSpan" id="kobo.235.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.236.1">0</span></strong><span class="koboSpan" id="kobo.237.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.238.1">Acceleration Y</span></strong><span class="koboSpan" id="kobo.239.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.240.1">-100</span></strong><span class="koboSpan" id="kobo.241.1"> to create a particle system that is affected by gravity, causing the particles to fall downward. </span><span class="koboSpan" id="kobo.241.2">Alternatively, you could set </span><strong class="bold"><span class="koboSpan" id="kobo.242.1">Acceleration X</span></strong><span class="koboSpan" id="kobo.243.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.244.1">50</span></strong><span class="koboSpan" id="kobo.245.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.246.1">Acceleration Y</span></strong><span class="koboSpan" id="kobo.247.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.248.1">0</span></strong><span class="koboSpan" id="kobo.249.1"> to create a particle system that moves to the right at a constant rate. </span></p>
<p><span class="koboSpan" id="kobo.250.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.251.1">Acceleration X</span></strong><span class="koboSpan" id="kobo.252.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.253.1">Acceleration Y</span></strong><span class="koboSpan" id="kobo.254.1"> fields are specified in points per second squared; positive values will cause the particles to accelerate in the positive direction, while negative values will cause the particles</span><a id="_idIndexMarker860"/><span class="koboSpan" id="kobo.255.1"> to decelerate or accelerate in the opposite direction. </span></p>
<h3><span class="koboSpan" id="kobo.256.1">Alpha</span></h3>
<p><strong class="bold"><span class="koboSpan" id="kobo.257.1">Alpha</span></strong><span class="koboSpan" id="kobo.258.1"> in an </span><strong class="source-inline"><span class="koboSpan" id="kobo.259.1">.sks</span></strong><span class="koboSpan" id="kobo.260.1"> file refers to the opacity or transparency</span><a id="_idIndexMarker861"/><span class="koboSpan" id="kobo.261.1"> of particles in a particle system. </span><span class="koboSpan" id="kobo.261.2">The alpha value controls how much of the particle is visible, with a higher value making the particle more visible and a lower value making the particle </span><span class="No-Break"><span class="koboSpan" id="kobo.262.1">more transparent.</span></span></p>
<p><span class="koboSpan" id="kobo.263.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.264.1">Alpha Start</span></strong><span class="koboSpan" id="kobo.265.1"> field specifies the starting alpha value for the particles, which can be used to control their initial transparency. </span><span class="koboSpan" id="kobo.265.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.266.1">Alpha Range</span></strong><span class="koboSpan" id="kobo.267.1"> field specifies the range of possible alpha values that the particles can take, and when the particle emitter emits a particle, it will choose a random alpha value within the specified range. </span><span class="koboSpan" id="kobo.267.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.268.1">Alpha Speed</span></strong><span class="koboSpan" id="kobo.269.1"> field specifies the rate at which the alpha value of the particles will change over time, and can be used to control the rate of fade-in or fade-out of the particles; a positive value for this field will cause the particles to fade in over time, while a negative value will cause the particles to fade out over time. </span></p>
<p><span class="koboSpan" id="kobo.270.1">By adjusting the </span><strong class="bold"><span class="koboSpan" id="kobo.271.1">Alpha Start</span></strong><span class="koboSpan" id="kobo.272.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.273.1">Alpha Range</span></strong><span class="koboSpan" id="kobo.274.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.275.1">Alpha Speed</span></strong><span class="koboSpan" id="kobo.276.1"> fields, you can control the transparency of the particles over their lifetime and create a wide range of particle effects. </span><span class="koboSpan" id="kobo.276.2">For example, you could set </span><strong class="bold"><span class="koboSpan" id="kobo.277.1">Alpha Start</span></strong><span class="koboSpan" id="kobo.278.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.279.1">1</span></strong><span class="koboSpan" id="kobo.280.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.281.1">Alpha Range</span></strong><span class="koboSpan" id="kobo.282.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.283.1">0</span></strong><span class="koboSpan" id="kobo.284.1"> to emit particles with a constant alpha value or set </span><strong class="bold"><span class="koboSpan" id="kobo.285.1">Alpha Start</span></strong><span class="koboSpan" id="kobo.286.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.287.1">1</span></strong><span class="koboSpan" id="kobo.288.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.289.1">Alpha Range</span></strong><span class="koboSpan" id="kobo.290.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.291.1">0</span></strong><span class="koboSpan" id="kobo.292.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.293.1">Alpha Speed</span></strong><span class="koboSpan" id="kobo.294.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.295.1">-0.5</span></strong><span class="koboSpan" id="kobo.296.1"> to emit particles that fade out </span><span class="No-Break"><span class="koboSpan" id="kobo.297.1">over time.</span></span></p>
<h3><span class="koboSpan" id="kobo.298.1">Scale</span></h3>
<p><span class="koboSpan" id="kobo.299.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.300.1">Scale</span></strong><span class="koboSpan" id="kobo.301.1"> fields control the size </span><a id="_idIndexMarker862"/><span class="koboSpan" id="kobo.302.1">of the particles over their lifetime. </span><span class="koboSpan" id="kobo.302.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.303.1">Scale Start</span></strong><span class="koboSpan" id="kobo.304.1"> field specifies the starting size of the particles, which can be used to control their initial size. </span><span class="koboSpan" id="kobo.304.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.305.1">Scale Range</span></strong><span class="koboSpan" id="kobo.306.1"> field specifies the range of possible sizes that the particles can take, and when the particle emitter emits a particle, it will choose a random size within the specified range. </span><span class="koboSpan" id="kobo.306.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.307.1">Scale Speed</span></strong><span class="koboSpan" id="kobo.308.1"> field specifies the rate at which the size of the particles will change over time, and can be used to control the rate of growth or shrinkage of the particles; a positive value for this will cause the particles to grow over time, while a negative value will cause the particles to shrink over time. </span></p>
<p><span class="koboSpan" id="kobo.309.1">As an example of using </span><strong class="bold"><span class="koboSpan" id="kobo.310.1">Scale</span></strong><span class="koboSpan" id="kobo.311.1">, you could set </span><strong class="bold"><span class="koboSpan" id="kobo.312.1">Scale Start</span></strong><span class="koboSpan" id="kobo.313.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.314.1">1</span></strong><span class="koboSpan" id="kobo.315.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.316.1">Scale Range</span></strong><span class="koboSpan" id="kobo.317.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.318.1">0</span></strong><span class="koboSpan" id="kobo.319.1"> to emit particles with a constant size or set </span><strong class="bold"><span class="koboSpan" id="kobo.320.1">Scale Start</span></strong><span class="koboSpan" id="kobo.321.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.322.1">1</span></strong><span class="koboSpan" id="kobo.323.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.324.1">Scale Range</span></strong><span class="koboSpan" id="kobo.325.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.326.1">0.5</span></strong><span class="koboSpan" id="kobo.327.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.328.1">Scale Speed</span></strong><span class="koboSpan" id="kobo.329.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.330.1">0.1</span></strong><span class="koboSpan" id="kobo.331.1"> to emit particles</span><a id="_idIndexMarker863"/><span class="koboSpan" id="kobo.332.1"> that grow </span><span class="No-Break"><span class="koboSpan" id="kobo.333.1">over time.</span></span></p>
<h3><span class="koboSpan" id="kobo.334.1">Rotation</span></h3>
<p><span class="koboSpan" id="kobo.335.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.336.1">Rotation Start</span></strong><span class="koboSpan" id="kobo.337.1"> field specifies the starting</span><a id="_idIndexMarker864"/><span class="koboSpan" id="kobo.338.1"> rotation of the particles, which can be used to control their initial orientation. </span><span class="koboSpan" id="kobo.338.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.339.1">Rotation Range</span></strong><span class="koboSpan" id="kobo.340.1"> field specifies the range of possible rotations that the particles can take, and when the particle emitter emits a particle, it will choose a random rotation within the specified range. </span><span class="koboSpan" id="kobo.340.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.341.1">Rotation Speed</span></strong><span class="koboSpan" id="kobo.342.1"> field specifies the rate at which the rotation of the particles will change over time, and can be used to control the rate of rotation of the particles; a positive value will cause the particles to rotate clockwise, while a negative value will cause the particles to </span><span class="No-Break"><span class="koboSpan" id="kobo.343.1">rotate counterclockwise.</span></span></p>
<p><span class="koboSpan" id="kobo.344.1">You could set </span><strong class="bold"><span class="koboSpan" id="kobo.345.1">Rotation Start</span></strong><span class="koboSpan" id="kobo.346.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.347.1">0</span></strong><span class="koboSpan" id="kobo.348.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.349.1">Rotation Range</span></strong><span class="koboSpan" id="kobo.350.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.351.1">0</span></strong><span class="koboSpan" id="kobo.352.1"> to emit particles with a constant orientation or set </span><strong class="bold"><span class="koboSpan" id="kobo.353.1">Rotation Start</span></strong><span class="koboSpan" id="kobo.354.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.355.1">0</span></strong><span class="koboSpan" id="kobo.356.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.357.1">Rotation Range</span></strong><span class="koboSpan" id="kobo.358.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.359.1">180</span></strong><span class="koboSpan" id="kobo.360.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.361.1">Rotation Speed</span></strong><span class="koboSpan" id="kobo.362.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.363.1">180</span></strong><span class="koboSpan" id="kobo.364.1"> to emit particles that rotate rapidly </span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">over time.</span></span></p>
<h3><span class="koboSpan" id="kobo.366.1">Color Blend</span></h3>
<p><span class="koboSpan" id="kobo.367.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.368.1">Color Blend</span></strong><span class="koboSpan" id="kobo.369.1"> fields control the color of the particles</span><a id="_idIndexMarker865"/><span class="koboSpan" id="kobo.370.1"> over </span><span class="No-Break"><span class="koboSpan" id="kobo.371.1">their lifetime.</span></span></p>
<p><span class="koboSpan" id="kobo.372.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.373.1">Color Blend Factor</span></strong><span class="koboSpan" id="kobo.374.1"> field specifies the amount of color blending that will be applied to the particles. </span><span class="koboSpan" id="kobo.374.2">When the particle emitter emits a particle, it will choose a random color blend factor within the specified range. </span><span class="koboSpan" id="kobo.374.3">The particle’s color will be blended with the color of the particle’s texture according to this </span><span class="No-Break"><span class="koboSpan" id="kobo.375.1">blend factor.</span></span></p>
<p><span class="koboSpan" id="kobo.376.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.377.1">Color Blend Factor Range</span></strong><span class="koboSpan" id="kobo.378.1"> field specifies the range of possible color blend factors that the particles can take. </span><span class="koboSpan" id="kobo.378.2">A value of </span><strong class="bold"><span class="koboSpan" id="kobo.379.1">0</span></strong><span class="koboSpan" id="kobo.380.1"> will result in no color blending, while a value of </span><strong class="bold"><span class="koboSpan" id="kobo.381.1">1</span></strong><span class="koboSpan" id="kobo.382.1"> will result in full color blending. </span></p>
<p><span class="koboSpan" id="kobo.383.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.384.1">Color Blend Factor Speed</span></strong><span class="koboSpan" id="kobo.385.1"> field specifies the rate at which the color blend factor of the particles will change over time, and can be used to control the rate at which the particles’ color will change. </span><span class="koboSpan" id="kobo.385.2">A positive value for the </span><strong class="bold"><span class="koboSpan" id="kobo.386.1">Color Blend Factor Speed</span></strong><span class="koboSpan" id="kobo.387.1"> field will cause the color of the particles to change over time, while a negative value will cause the color of the particles to change in reverse. </span></p>
<p><span class="koboSpan" id="kobo.388.1">Looking an example, you could set </span><strong class="bold"><span class="koboSpan" id="kobo.389.1">Color Blend Factor</span></strong><span class="koboSpan" id="kobo.390.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.391.1">0</span></strong><span class="koboSpan" id="kobo.392.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.393.1">Color Blend Factor Range</span></strong><span class="koboSpan" id="kobo.394.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.395.1">0</span></strong><span class="koboSpan" id="kobo.396.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.397.1">Color Blend Factor Speed</span></strong><span class="koboSpan" id="kobo.398.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.399.1">0</span></strong><span class="koboSpan" id="kobo.400.1"> to emit particles with constant color, or set </span><strong class="bold"><span class="koboSpan" id="kobo.401.1">Color Blend Factor</span></strong><span class="koboSpan" id="kobo.402.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.403.1">1</span></strong><span class="koboSpan" id="kobo.404.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.405.1">Color Blend Factor Range</span></strong><span class="koboSpan" id="kobo.406.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.407.1">1</span></strong><span class="koboSpan" id="kobo.408.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.409.1">Color Blend Factor Speed</span></strong><span class="koboSpan" id="kobo.410.1"> to </span><strong class="bold"><span class="koboSpan" id="kobo.411.1">0.1</span></strong><span class="koboSpan" id="kobo.412.1"> to emit particles</span><a id="_idIndexMarker866"/><span class="koboSpan" id="kobo.413.1"> that change color rapidly </span><span class="No-Break"><span class="koboSpan" id="kobo.414.1">over time.</span></span></p>
<h3><span class="koboSpan" id="kobo.415.1">Color Ramp</span></h3>
<p><span class="koboSpan" id="kobo.416.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.417.1">Color Ramp</span></strong><span class="koboSpan" id="kobo.418.1"> field is used to specify a range of colors</span><a id="_idIndexMarker867"/><span class="koboSpan" id="kobo.419.1"> that particles can take on over their lifetime. </span><span class="koboSpan" id="kobo.419.2">The colors are defined using a ramp, which is a gradient that blends two or </span><span class="No-Break"><span class="koboSpan" id="kobo.420.1">more colors.</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.421.1">Color Ramp</span></strong><span class="koboSpan" id="kobo.422.1"> allows you to create particle effects with changing colors. </span><span class="koboSpan" id="kobo.422.2">By default, particles will be emitted with a single color, but by adjusting </span><strong class="bold"><span class="koboSpan" id="kobo.423.1">Color Ramp</span></strong><span class="koboSpan" id="kobo.424.1">, you can set the particles to a fixed range of colors, change color over time, or randomize the color within a range. </span><span class="koboSpan" id="kobo.424.2">For example, you could set </span><strong class="bold"><span class="koboSpan" id="kobo.425.1">Color Ramp</span></strong><span class="koboSpan" id="kobo.426.1"> to shades of red and yellow to create a fire effect or shades of blue and white for a </span><span class="No-Break"><span class="koboSpan" id="kobo.427.1">snow effect.</span></span></p>
<p><span class="koboSpan" id="kobo.428.1">Additionally, </span><strong class="bold"><span class="koboSpan" id="kobo.429.1">Color Ramp</span></strong><span class="koboSpan" id="kobo.430.1"> can be used to create different blending modes, such as additive or subtractive blending. </span><span class="koboSpan" id="kobo.430.2">The blending mode determines how the colors of the particles are combined with the colors of the background or other particles in </span><span class="No-Break"><span class="koboSpan" id="kobo.431.1">the scene.</span></span></p>
<h3><span class="koboSpan" id="kobo.432.1">Blend Mode</span></h3>
<p><span class="koboSpan" id="kobo.433.1">Blending is a process that combines</span><a id="_idIndexMarker868"/><span class="koboSpan" id="kobo.434.1"> the colors of the particles with the colors of the objects behind them on the screen. </span><span class="koboSpan" id="kobo.434.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.435.1">Blend Mode</span></strong><span class="koboSpan" id="kobo.436.1"> field determines how the colors of the particles and the background will be combined. </span></p>
<p><span class="koboSpan" id="kobo.437.1">There are several blend modes available in SpriteKit, the choice of which depends on the desired visual effect for the particles. </span><span class="koboSpan" id="kobo.437.2">For example, the </span><strong class="bold"><span class="koboSpan" id="kobo.438.1">Alpha</span></strong><span class="koboSpan" id="kobo.439.1"> blend mode will blend the colors of the particles and the background by taking the alpha channel of the particle’s color into account. </span><span class="koboSpan" id="kobo.439.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.440.1">Add</span></strong><span class="koboSpan" id="kobo.441.1"> blend mode will add the colors of the particles and the background together. </span><span class="koboSpan" id="kobo.441.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.442.1">Multiply</span></strong><span class="koboSpan" id="kobo.443.1"> blend mode will multiply the colors of the particles and the background together. </span></p>
<p><span class="koboSpan" id="kobo.444.1">By adjusting the blend mode, you can control how the colors of the particles are blended with the colors of the objects behind them and create a wide range of particle effects. </span></p>
<h3><span class="koboSpan" id="kobo.445.1">Field Mask</span></h3>
<p><strong class="bold"><span class="koboSpan" id="kobo.446.1">Field Mask</span></strong><span class="koboSpan" id="kobo.447.1"> takes an integer value that</span><a id="_idIndexMarker869"/><span class="koboSpan" id="kobo.448.1"> is used to specify a masking bit-field, and the bit-field defines which properties of the particle are affected by the mask. </span><span class="koboSpan" id="kobo.448.2">For example, if the bit-field includes the position bit, the mask will affect the position of the particles. </span><span class="koboSpan" id="kobo.448.3">If it includes the color bit, the mask will affect the color of the particles. </span><span class="koboSpan" id="kobo.448.4">By setting the value of </span><strong class="bold"><span class="koboSpan" id="kobo.449.1">Field Mask</span></strong><span class="koboSpan" id="kobo.450.1">, you can control which properties of the particles are affected by the mask. </span><span class="koboSpan" id="kobo.450.2">This allows you to create complex and sophisticated </span><span class="No-Break"><span class="koboSpan" id="kobo.451.1">particle effects.</span></span></p>
<p><span class="koboSpan" id="kobo.452.1">For example, you could set </span><strong class="bold"><span class="koboSpan" id="kobo.453.1">Field Mask</span></strong><span class="koboSpan" id="kobo.454.1"> to include the position bit, which would cause the mask to affect the position of the particles, and create particles that follow a specific path or shape. </span><span class="koboSpan" id="kobo.454.2">Otherwise, you could set </span><strong class="bold"><span class="koboSpan" id="kobo.455.1">Field Mask</span></strong><span class="koboSpan" id="kobo.456.1"> to include the color bit, which would cause the mask to affect the color of the particles, and create particles with a specific color scheme </span><span class="No-Break"><span class="koboSpan" id="kobo.457.1">or pattern.</span></span></p>
<h3><span class="koboSpan" id="kobo.458.1">Custom Shader</span></h3>
<p><span class="koboSpan" id="kobo.459.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.460.1">Custom Shader</span></strong><span class="koboSpan" id="kobo.461.1"> field allows you to specify a custom shader</span><a id="_idIndexMarker870"/><span class="koboSpan" id="kobo.462.1"> to be used to render the particles. </span></p>
<p><span class="koboSpan" id="kobo.463.1">A </span><strong class="bold"><span class="koboSpan" id="kobo.464.1">shader</span></strong><span class="koboSpan" id="kobo.465.1"> is a program that runs on the GPU</span><a id="_idIndexMarker871"/><span class="koboSpan" id="kobo.466.1"> and is used to define the appearance and behavior of the particles. </span><span class="koboSpan" id="kobo.466.2">By using a custom shader, you can create complex and sophisticated particle effects that would be difficult or impossible to achieve using the built-in properties of the </span><span class="No-Break"><span class="koboSpan" id="kobo.467.1">particle emitter.</span></span></p>
<p><span class="koboSpan" id="kobo.468.1">For example, you could use a custom shader to create particles that respond to changes in the environment, such as light or shadows, or create particles that change shape or appearance over time. </span><span class="koboSpan" id="kobo.468.2">To use one, you need</span><a id="_idIndexMarker872"/><span class="koboSpan" id="kobo.469.1"> to write the shader code in a language such as </span><strong class="bold"><span class="koboSpan" id="kobo.470.1">OpenGL Shading Language</span></strong><span class="koboSpan" id="kobo.471.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.472.1">GLSL</span></strong><span class="koboSpan" id="kobo.473.1">) and then specify the shader code as the value of the </span><strong class="bold"><span class="koboSpan" id="kobo.474.1">Custom Shader</span></strong><span class="koboSpan" id="kobo.475.1"> field. </span><span class="koboSpan" id="kobo.475.2">Once you have specified the custom shader, SpriteKit will use it to render the particles, giving you complete control over the appearance and behavior of the particles. </span><span class="koboSpan" id="kobo.475.3">By combining custom shaders with other properties of the particle emitter, such as </span><strong class="bold"><span class="koboSpan" id="kobo.476.1">Birthrate</span></strong><span class="koboSpan" id="kobo.477.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.478.1">Lifetime</span></strong><span class="koboSpan" id="kobo.479.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.480.1">Position Range</span></strong><span class="koboSpan" id="kobo.481.1">, you can create a wide range of sophisticated and visually stunning </span><span class="No-Break"><span class="koboSpan" id="kobo.482.1">particle effects.</span></span></p>
<p><span class="koboSpan" id="kobo.483.1">Now, we have looked at all of the customization fields for the particle system. </span><span class="koboSpan" id="kobo.483.2">I know it can be a bit overwhelming, which is why I defined each field in the file so you can refer to it when you’re building your </span><span class="No-Break"><span class="koboSpan" id="kobo.484.1">particle system.</span></span></p>
<p><span class="koboSpan" id="kobo.485.1">Let’s use the following values</span><a id="_idIndexMarker873"/><span class="koboSpan" id="kobo.486.1"> to alter the smoke so it is similar to the smoke that you would see coming from a pipe. </span><span class="koboSpan" id="kobo.486.2">I have worked out all the values; you just need to fill </span><span class="No-Break"><span class="koboSpan" id="kobo.487.1">them in:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer208">
<span class="koboSpan" id="kobo.488.1"><img alt="Figure 15.4: Attributes for the pipe smoke animation " src="image/B18674_15_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.489.1">Figure 15.4: Attributes for the pipe smoke animation</span></p>
<p><span class="koboSpan" id="kobo.490.1">Make sure your file has those same values as well before proceeding, which will give you the correct smoke you need to come out of </span><span class="No-Break"><span class="koboSpan" id="kobo.491.1">the pipe.</span></span></p>
<h2 id="_idParaDest-213"><a id="_idTextAnchor224"/><span class="koboSpan" id="kobo.492.1">Integrating the Smoke file into a SwiftUI View</span></h2>
<p><span class="koboSpan" id="kobo.493.1">Before we get started</span><a id="_idIndexMarker874"/><span class="koboSpan" id="kobo.494.1"> with this</span><a id="_idIndexMarker875"/><span class="koboSpan" id="kobo.495.1"> section, a little bit of explanation is needed as to what the SpriteKit framework is all about and how it works. </span><span class="koboSpan" id="kobo.495.2">As I mentioned at the beginning of this chapter, SpriteKit is a game development framework that provides a convenient and efficient way to create 2D games for iOS and macOS platforms. </span><span class="koboSpan" id="kobo.495.3">Using the SpriteKit framework, you can create different sprites for your animation or game. </span></p>
<p><span class="koboSpan" id="kobo.496.1">A sprite is represented by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.497.1">SKSpriteNode</span></strong><span class="koboSpan" id="kobo.498.1"> class, which is a node that can display a textured image. </span><span class="koboSpan" id="kobo.498.2">A sprite can be thought of as a single frame of an animation and it can be moved, rotated, and scaled and have physics applied to it. </span><span class="koboSpan" id="kobo.498.3">A single sprite can also have multiple textures, allowing it to change appearance. </span><span class="koboSpan" id="kobo.498.4">In a game, sprites are used to represent characters, objects, </span><span class="No-Break"><span class="koboSpan" id="kobo.499.1">and backgrounds.</span></span></p>
<p><span class="koboSpan" id="kobo.500.1">You can create a sprite by initializing </span><strong class="source-inline"><span class="koboSpan" id="kobo.501.1">SKSpriteNode</span></strong><span class="koboSpan" id="kobo.502.1"> with an image or texture and then adding it to an </span><strong class="source-inline"><span class="koboSpan" id="kobo.503.1">SKScene</span></strong><span class="koboSpan" id="kobo.504.1">. </span><span class="koboSpan" id="kobo.504.2">Once added to a scene, a sprite can be manipulated using various properties and methods, such as position, scale, and rotation, and you can also add actions, physics, and gestures </span><span class="No-Break"><span class="koboSpan" id="kobo.505.1">to it.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.506.1">SKView</span></strong><span class="koboSpan" id="kobo.507.1"> is a </span><strong class="source-inline"><span class="koboSpan" id="kobo.508.1">UIView</span></strong><span class="koboSpan" id="kobo.509.1"> subclass that is used to display and interact with SpriteKit scenes. </span><span class="koboSpan" id="kobo.509.2">It acts as the container for an </span><strong class="source-inline"><span class="koboSpan" id="kobo.510.1">SKScene</span></strong><span class="koboSpan" id="kobo.511.1"> and provides the necessary infrastructure for displaying and animating sprites. </span><span class="koboSpan" id="kobo.511.2">An </span><strong class="source-inline"><span class="koboSpan" id="kobo.512.1">SKScene</span></strong><span class="koboSpan" id="kobo.513.1"> is a container for all the sprites in a SpriteKit-based project. </span><span class="koboSpan" id="kobo.513.2">It is responsible for updating and rendering the sprites, and also provides a way to handle user interactions with the sprites. </span><span class="koboSpan" id="kobo.513.3">A scene can also contain other nodes such as labels and shapes in addition to sprites. </span><span class="koboSpan" id="kobo.513.4">Each scene can have its own set of sprites, physics, and interactions. </span><span class="koboSpan" id="kobo.513.5">You will become more familiar with sprites and nodes as we progress through the projects in </span><span class="No-Break"><span class="koboSpan" id="kobo.514.1">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.515.1">Let’s do some coding now. </span><span class="koboSpan" id="kobo.515.2">Go into </span><strong class="source-inline"><span class="koboSpan" id="kobo.516.1">ContentView</span></strong><span class="koboSpan" id="kobo.517.1">, and we will create a smoke view struct in which we can use our </span><strong class="source-inline"><span class="koboSpan" id="kobo.518.1">Smoke.sks</span></strong><span class="koboSpan" id="kobo.519.1"> file. </span><span class="koboSpan" id="kobo.519.2">The first thing we need to do is import the SpriteKit framework so that we have access to the classes and methods. </span><span class="koboSpan" id="kobo.519.3">Add this line of code at the top </span><span class="No-Break"><span class="koboSpan" id="kobo.520.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.521.1">ContentView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.522.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.523.1">
import SpriteKit</span></pre>
<p><span class="koboSpan" id="kobo.524.1">Now, let’s create that </span><strong class="source-inline"><span class="koboSpan" id="kobo.525.1">SmokeView</span></strong><span class="koboSpan" id="kobo.526.1"> struct I mentioned</span><a id="_idIndexMarker876"/><span class="koboSpan" id="kobo.527.1"> by adding this under</span><a id="_idIndexMarker877"/><span class="koboSpan" id="kobo.528.1"> the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.529.1">ContentView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.530.1"> struct:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.531.1">
struct SmokeView: UIViewRepresentable {
    func makeUIView(context: 
      UIViewRepresentableContext&lt;SmokeView&gt;) -&gt; SKView {
        let view = SKView(frame: CGRect(x: 0, y: 0, width: 
          400, height: 400))
        view.backgroundColor = .clear
        let scene = SKScene(size: CGSize(width: 400, 
          height: 600))
        ///set the scenes background color to clear because 
          we will set the color in the ContentView.
</span><span class="koboSpan" id="kobo.531.2">        ///You can also use any other valid color like 
          UIColor.lightGray, UIColor.green, 
          UIColor.init(red: 1, green: 1, blue: 1, alpha: 
          0.5) or any other UIColor initializer.
</span><span class="koboSpan" id="kobo.531.3">        scene.backgroundColor = UIColor.clear
        guard let smoke = SKEmitterNode(fileNamed: 
          "Smoke.sks") else { return SKView() }
        smoke.position = CGPoint(x: scene.size.width / 2, 
          y: scene.size.height / 2)
        // set the blend mode - scale - range
        smoke.particleBlendMode = .screen
        smoke.particleScale = 0.01
        smoke.particleScaleRange = 0.05
        ///add the smoke to the scene
        scene.addChild(smoke)
        view.presentScene(scene)
        return view
    }
    func updateUIView(_ uiView: SKView, context: 
      UIViewRepresentableContext&lt;SmokeView&gt;) {
      /// Update the smoke in this function if you need to
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.532.1">Here’s how the </span><strong class="source-inline"><span class="koboSpan" id="kobo.533.1">SmokeView</span></strong><span class="koboSpan" id="kobo.534.1"> struct works, line</span><a id="_idIndexMarker878"/><span class="koboSpan" id="kobo.535.1"> by line. </span><span class="koboSpan" id="kobo.535.2">Bear in mind that the SpriteKit framework</span><a id="_idIndexMarker879"/><span class="koboSpan" id="kobo.536.1"> uses methods and classes we have not used before, so the code may seem unfamiliar at first; as you work through the chapter though, you will understand it very quickly because it is Swift code after all, and is </span><span class="No-Break"><span class="koboSpan" id="kobo.537.1">very readable:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.538.1">This code starts off by defining a struct named </span><strong class="source-inline"><span class="koboSpan" id="kobo.539.1">SmokeView</span></strong><span class="koboSpan" id="kobo.540.1">, which is used to display the smoke effect that we configured in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.541.1">Smoke.sks</span></strong><span class="koboSpan" id="kobo.542.1"> file. </span><span class="koboSpan" id="kobo.542.2">The struct conforms to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.543.1">UIViewRepresentable</span></strong><span class="koboSpan" id="kobo.544.1"> protocol. </span><span class="koboSpan" id="kobo.544.2">This allows the struct to be used as a </span><span class="No-Break"><span class="koboSpan" id="kobo.545.1">SwiftUI view.</span></span></li>
<li><span class="koboSpan" id="kobo.546.1">Next, we add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.547.1">makeUIView</span></strong><span class="koboSpan" id="kobo.548.1"> method, which is required by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.549.1">UIViewRepresentable</span></strong><span class="koboSpan" id="kobo.550.1"> protocol. </span><span class="koboSpan" id="kobo.550.2">It creates and returns </span><strong class="source-inline"><span class="koboSpan" id="kobo.551.1">SKView</span></strong><span class="koboSpan" id="kobo.552.1">, which is used to display the </span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">smoke effect.</span></span></li>
<li><span class="koboSpan" id="kobo.554.1">Then, we create an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.555.1">SKView</span></strong><span class="koboSpan" id="kobo.556.1"> with a specified frame (size and position). </span><span class="koboSpan" id="kobo.556.2">This frame is used to determine the size of the </span><span class="No-Break"><span class="koboSpan" id="kobo.557.1">smoke effect.</span></span></li>
<li><span class="koboSpan" id="kobo.558.1">We set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.559.1">backgroundColor</span></strong><span class="koboSpan" id="kobo.560.1"> property of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.561.1">SKView</span></strong><span class="koboSpan" id="kobo.562.1"> instance to </span><strong class="source-inline"><span class="koboSpan" id="kobo.563.1">clear</span></strong><span class="koboSpan" id="kobo.564.1">. </span><span class="koboSpan" id="kobo.564.2">This means that the background of the view will be transparent and will not have a solid color background; this way, any underlying views or graphics can </span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">show through.</span></span></li>
<li><span class="koboSpan" id="kobo.566.1">We create an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.567.1">SKScene</span></strong><span class="koboSpan" id="kobo.568.1"> with a specified </span><strong class="source-inline"><span class="koboSpan" id="kobo.569.1">size</span></strong><span class="koboSpan" id="kobo.570.1"> property, which determines the size of the smoke effect, and a background </span><strong class="source-inline"><span class="koboSpan" id="kobo.571.1">color</span></strong><span class="koboSpan" id="kobo.572.1"> value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.573.1">clear</span></strong><span class="koboSpan" id="kobo.574.1"> so that the background of the smoke effect will </span><span class="No-Break"><span class="koboSpan" id="kobo.575.1">be transparent.</span></span></li>
<li><span class="koboSpan" id="kobo.576.1">Next, we create an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.577.1">SKEmitterNode</span></strong><span class="koboSpan" id="kobo.578.1"> using the particle system defined in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.579.1">Smoke.sks</span></strong><span class="koboSpan" id="kobo.580.1"> file. </span><span class="koboSpan" id="kobo.580.2">The guard </span><strong class="source-inline"><span class="koboSpan" id="kobo.581.1">let</span></strong><span class="koboSpan" id="kobo.582.1"> statement is used to check whether the file was loaded correctly and if not, it returns an </span><span class="No-Break"><span class="koboSpan" id="kobo.583.1">empty </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.584.1">SKView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.585.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.586.1">Then, we position the smoke effect in the center of the scene; set the blend mode to </span><strong class="source-inline"><span class="koboSpan" id="kobo.587.1">SKBlendMode.screen</span></strong><span class="koboSpan" id="kobo.588.1">, which will make the smoke blend with the background; set the initial scale of the smoke particles, which will make the particles smaller and thinner; and set the range of the scale of the </span><span class="No-Break"><span class="koboSpan" id="kobo.589.1">smoke particles.</span></span></li>
<li><span class="koboSpan" id="kobo.590.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.591.1">addChild</span></strong><span class="koboSpan" id="kobo.592.1"> method is called on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.593.1">scene</span></strong><span class="koboSpan" id="kobo.594.1"> instance, passing in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.595.1">smoke</span></strong><span class="koboSpan" id="kobo.596.1"> node as an argument. </span><span class="koboSpan" id="kobo.596.2">This adds the particle emitter node as a child node to the scene, meaning it will be displayed in </span><span class="No-Break"><span class="koboSpan" id="kobo.597.1">the scene.</span></span></li>
<li><span class="koboSpan" id="kobo.598.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.599.1">presentScene</span></strong><span class="koboSpan" id="kobo.600.1"> method is called on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.601.1">view</span></strong><span class="koboSpan" id="kobo.602.1"> instance, passing in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.603.1">scene</span></strong><span class="koboSpan" id="kobo.604.1"> instance as an argument. </span><span class="koboSpan" id="kobo.604.2">This sets the scene as the currently displayed scene in </span><span class="No-Break"><span class="koboSpan" id="kobo.605.1">the view.</span></span></li>
<li><span class="koboSpan" id="kobo.606.1">Then, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.607.1">return</span></strong><span class="koboSpan" id="kobo.608.1"> keyword returns the </span><strong class="source-inline"><span class="koboSpan" id="kobo.609.1">view</span></strong><span class="koboSpan" id="kobo.610.1"> instance. </span></li>
<li><span class="koboSpan" id="kobo.611.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.612.1">updateUIView</span></strong><span class="koboSpan" id="kobo.613.1"> function is called when the view needs to be updated, such as when the view’s state changes. </span><span class="koboSpan" id="kobo.613.2">In this code, we leave it empty, as it is not needed in </span><span class="No-Break"><span class="koboSpan" id="kobo.614.1">our example.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.615.1">To summarize, the code</span><a id="_idIndexMarker880"/><span class="koboSpan" id="kobo.616.1"> creates and returns an </span><strong class="source-inline"><span class="koboSpan" id="kobo.617.1">SKView</span></strong><span class="koboSpan" id="kobo.618.1"> instance</span><a id="_idIndexMarker881"/><span class="koboSpan" id="kobo.619.1"> that displays a SpriteKit particle emitter as a SwiftUI view. </span><span class="koboSpan" id="kobo.619.2">Now, we have a </span><strong class="source-inline"><span class="koboSpan" id="kobo.620.1">SmokeView</span></strong><span class="koboSpan" id="kobo.621.1"> ready to go and display </span><span class="No-Break"><span class="koboSpan" id="kobo.622.1">the smoke.</span></span></p>
<p><span class="koboSpan" id="kobo.623.1">Let’s come into </span><strong class="source-inline"><span class="koboSpan" id="kobo.624.1">ContentView</span></strong><span class="koboSpan" id="kobo.625.1"> and add a background for the scene, and a smiley image that has a pipe</span><a id="_idIndexMarker882"/><span class="koboSpan" id="kobo.626.1"> in his mouth. </span><span class="koboSpan" id="kobo.626.2">Then, we will call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.627.1">SmokeView</span></strong><span class="koboSpan" id="kobo.628.1"> we just created</span><a id="_idIndexMarker883"/><span class="koboSpan" id="kobo.629.1"> to put the smoke into the pipe. </span><span class="koboSpan" id="kobo.629.2">To do this, modify </span><strong class="source-inline"><span class="koboSpan" id="kobo.630.1">ContentView</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.631.1">like so:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.632.1">
struct ContentView: View {
    var body: some View {
        ZStack {
            ///adding the pipe image and setting the size 
              and scale to fit on it
            Image("pipe")
                .resizable().frame(width: 350, height: 350)
                .scaledToFit()
            ///calling and positioning the SmokeView
            SmokeView()
            .offset(x: -140, y: 105)
        }.background(Image("background"))
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.633.1">What we have done here is create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.634.1">ZStack</span></strong><span class="koboSpan" id="kobo.635.1"> and put our image of the smiley, which is called </span><strong class="source-inline"><span class="koboSpan" id="kobo.636.1">pipe</span></strong><span class="koboSpan" id="kobo.637.1">, into the scene. </span><span class="koboSpan" id="kobo.637.2">Then, we resized it with </span><strong class="source-inline"><span class="koboSpan" id="kobo.638.1">width</span></strong><span class="koboSpan" id="kobo.639.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.640.1">height</span></strong><span class="koboSpan" id="kobo.641.1"> values of </span><strong class="source-inline"><span class="koboSpan" id="kobo.642.1">350</span></strong><span class="koboSpan" id="kobo.643.1"> points and called </span><span class="No-Break"><span class="koboSpan" id="kobo.644.1">our </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.645.1">SmokeView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.646.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.647.1">Next, we positioned the smoke so that it is directly above the pipe and appears to come out of the pipe, achieved with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.648.1">offset</span></strong><span class="koboSpan" id="kobo.649.1"> modifier. </span><span class="koboSpan" id="kobo.649.2">Finally, we add the background right onto the </span><strong class="source-inline"><span class="koboSpan" id="kobo.650.1">ZStack</span></strong><span class="koboSpan" id="kobo.651.1">, and the project </span><span class="No-Break"><span class="koboSpan" id="kobo.652.1">is finished.</span></span></p>
<p><span class="koboSpan" id="kobo.653.1">If you run the project, you’ll see realistic pipe smoke coming out of </span><span class="No-Break"><span class="koboSpan" id="kobo.654.1">the pipe:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer209">
<span class="koboSpan" id="kobo.655.1"><img alt="Figure 15.5: The pipe smoke animation " src="image/B18674_15_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.656.1">Figure 15.5: The pipe smoke animation</span></p>
<p><span class="koboSpan" id="kobo.657.1">Now that you know how to create</span><a id="_idIndexMarker884"/><span class="koboSpan" id="kobo.658.1"> smoke and have a basic foundation</span><a id="_idIndexMarker885"/><span class="koboSpan" id="kobo.659.1"> of how to get the SpriteKit particle system operational in our SwiftUI project, let’s continue and solidify what you know and use the </span><strong class="bold"><span class="koboSpan" id="kobo.660.1">Smoke</span></strong><span class="koboSpan" id="kobo.661.1"> template once again, but vary the values to create a different effect. </span></p>
<h1 id="_idParaDest-214"><a id="_idTextAnchor225"/><span class="koboSpan" id="kobo.662.1">Animating coffee steam</span></h1>
<p><span class="koboSpan" id="kobo.663.1">In this next project, we’ll modify</span><a id="_idIndexMarker886"/><span class="koboSpan" id="kobo.664.1"> the particle system file to create steam that we can use to create a steaming cup of coffee animation. </span><span class="koboSpan" id="kobo.664.2">Well also look at a technique where we can place the steam directly inside the coffee by overlapping images. </span><span class="koboSpan" id="kobo.664.3">To get started, create a new project and call it </span><strong class="source-inline"><span class="koboSpan" id="kobo.665.1">Coffee</span></strong><span class="koboSpan" id="kobo.666.1">, and then we’ll move on to creating the SpriteKit </span><span class="No-Break"><span class="koboSpan" id="kobo.667.1">particle file.</span></span></p>
<h2 id="_idParaDest-215"><a id="_idTextAnchor226"/><span class="koboSpan" id="kobo.668.1">Creating the Smoke SpriteKit particle file</span></h2>
<p><span class="koboSpan" id="kobo.669.1">To create the file, like</span><a id="_idIndexMarker887"/><span class="koboSpan" id="kobo.670.1"> before, press </span><em class="italic"><span class="koboSpan" id="kobo.671.1">Command + N</span></em><span class="koboSpan" id="kobo.672.1">, choose the </span><strong class="bold"><span class="koboSpan" id="kobo.673.1">SpriteKit Particle File</span></strong><span class="koboSpan" id="kobo.674.1"> template, and let’s pick </span><strong class="bold"><span class="koboSpan" id="kobo.675.1">Smoke</span></strong><span class="koboSpan" id="kobo.676.1"> from the particle template options again (yes, </span><strong class="bold"><span class="koboSpan" id="kobo.677.1">Smoke</span></strong><span class="koboSpan" id="kobo.678.1"> again, but we will make it look like steam </span><span class="No-Break"><span class="koboSpan" id="kobo.679.1">this time).</span></span></p>
<p><span class="koboSpan" id="kobo.680.1">Now, we will modify the various properties to create our animation. </span><span class="koboSpan" id="kobo.680.2">Change all the properties in your SKS file to look like the </span><span class="No-Break"><span class="koboSpan" id="kobo.681.1">following figure:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer210">
<span class="koboSpan" id="kobo.682.1"><img alt="Figure 15.6: The attributes of the coffee steam animation " src="image/B18674_15_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.683.1">Figure 15.6: The attributes of the coffee steam animation</span></p>
<p><span class="koboSpan" id="kobo.684.1">All of those properties have been</span><a id="_idIndexMarker888"/><span class="koboSpan" id="kobo.685.1"> explained in the previous project. </span><span class="koboSpan" id="kobo.685.2">If you’re unclear as to what each one does, revisit that section for </span><span class="No-Break"><span class="koboSpan" id="kobo.686.1">a refresher.</span></span></p>
<h2 id="_idParaDest-216"><a id="_idTextAnchor227"/><span class="koboSpan" id="kobo.687.1">Creating the Coffee Steam struct</span></h2>
<p><span class="koboSpan" id="kobo.688.1">Next, let’s go back</span><a id="_idIndexMarker889"/><span class="koboSpan" id="kobo.689.1"> into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.690.1">ContentView</span></strong><span class="koboSpan" id="kobo.691.1"> file and we’ll start assembling the project. </span><span class="koboSpan" id="kobo.691.2">In the previous project, we learned how to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.692.1">.sks</span></strong><span class="koboSpan" id="kobo.693.1"> file inside the SwiftUI view, and we’re going to do almost the exact same thing here too. </span><span class="koboSpan" id="kobo.693.2">The first thing we did was create a separate struct and use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.694.1">UIViewRepresentable</span></strong><span class="koboSpan" id="kobo.695.1"> protocol to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.696.1">.sks</span></strong><span class="koboSpan" id="kobo.697.1"> file within a SwiftUI view. </span><span class="koboSpan" id="kobo.697.2">So, in this project, underneath </span><strong class="source-inline"><span class="koboSpan" id="kobo.698.1">ContentView</span></strong><span class="koboSpan" id="kobo.699.1">, add the </span><span class="No-Break"><span class="koboSpan" id="kobo.700.1">following struct:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.701.1">
struct CoffeeSteam: UIViewRepresentable {
    func makeUIView(context: 
      UIViewRepresentableContext&lt;CoffeeSteam&gt;) -&gt; SKView {
        let view = SKView(frame: CGRect(x: 0, y: 0, width: 
          400, height: 400))
        view.backgroundColor = .clear
        let scene = SKScene(size: CGSize(width: 400, 
          height: 600))
        ///set the scenes background color to clear - we 
          only want the particles seen
        scene.backgroundColor = UIColor.clear
        guard let steam = SKEmitterNode(fileNamed: 
          "CoffeeSteam.sks") else { return SKView() }
        steam.position = CGPoint(x: scene.size.width / 2, 
          y: scene.size.height / 2)
        /// set the blend mode - scale - range
        steam.particleBlendMode = .screen
        steam.particleScale = 0.01
        steam.particleScaleRange = 0.05
        ///add the smoke to the scene
        scene.addChild(steam)
        view.presentScene(scene)
        return view
    }
    func updateUIView(_ uiView: SKView, context: 
      UIViewRepresentableContext&lt;CoffeeSteam&gt;) {
      /// Update the steam in this function if you need to
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.702.1">I explained this code in the previous</span><a id="_idIndexMarker890"/><span class="koboSpan" id="kobo.703.1"> project, but I will go over it again to help solidify </span><span class="No-Break"><span class="koboSpan" id="kobo.704.1">your understanding:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.705.1">The code starts off by defining a custom SwiftUI view named </span><strong class="source-inline"><span class="koboSpan" id="kobo.706.1">CoffeeSteam</span></strong><span class="koboSpan" id="kobo.707.1">, which is used to display the steam effect that we configured in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.708.1">CoffeeSteam.sks</span></strong><span class="koboSpan" id="kobo.709.1"> file. </span><span class="koboSpan" id="kobo.709.2">The struct conforms to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.710.1">UIViewRepresentable</span></strong><span class="koboSpan" id="kobo.711.1"> protocol. </span><span class="koboSpan" id="kobo.711.2">This allows the struct to be used as a </span><span class="No-Break"><span class="koboSpan" id="kobo.712.1">SwiftUI view.</span></span></li>
<li><span class="koboSpan" id="kobo.713.1">Next, we add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.714.1">makeUIView</span></strong><span class="koboSpan" id="kobo.715.1"> method, which is required by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.716.1">UIViewRepresentable</span></strong><span class="koboSpan" id="kobo.717.1"> protocol. </span><span class="koboSpan" id="kobo.717.2">It creates and returns an </span><strong class="source-inline"><span class="koboSpan" id="kobo.718.1">SKView</span></strong><span class="koboSpan" id="kobo.719.1">, which is used to display the </span><span class="No-Break"><span class="koboSpan" id="kobo.720.1">steam effect.</span></span></li>
<li><span class="koboSpan" id="kobo.721.1">We create an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.722.1">SKView</span></strong><span class="koboSpan" id="kobo.723.1"> with a specified frame (size and position). </span><span class="koboSpan" id="kobo.723.2">This frame is used to determine the size of the </span><span class="No-Break"><span class="koboSpan" id="kobo.724.1">steam effect.</span></span></li>
<li><span class="koboSpan" id="kobo.725.1">We set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.726.1">backgroundColor</span></strong><span class="koboSpan" id="kobo.727.1"> property of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.728.1">SKView</span></strong><span class="koboSpan" id="kobo.729.1"> instance to </span><strong class="source-inline"><span class="koboSpan" id="kobo.730.1">clear</span></strong><span class="koboSpan" id="kobo.731.1">. </span><span class="koboSpan" id="kobo.731.2">This means that the background of the view will be transparent and will not have a solid color background; this way, any underlying views or graphics can </span><span class="No-Break"><span class="koboSpan" id="kobo.732.1">show through.</span></span></li>
<li><span class="koboSpan" id="kobo.733.1">Then, we create an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.734.1">SKScene</span></strong><span class="koboSpan" id="kobo.735.1"> with a specified size, which is used to determine the size of the steam effect, and set the background color to </span><strong class="source-inline"><span class="koboSpan" id="kobo.736.1">clear</span></strong><span class="koboSpan" id="kobo.737.1">; this way, the background of the steam effect will be </span><span class="No-Break"><span class="koboSpan" id="kobo.738.1">transparent too.</span></span></li>
<li><span class="koboSpan" id="kobo.739.1">Next, we create an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.740.1">SKEmitterNode</span></strong><span class="koboSpan" id="kobo.741.1"> using the particle system defined in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.742.1">CoffeeSteam.sks</span></strong><span class="koboSpan" id="kobo.743.1"> file. </span><span class="koboSpan" id="kobo.743.2">The guard </span><strong class="source-inline"><span class="koboSpan" id="kobo.744.1">let</span></strong><span class="koboSpan" id="kobo.745.1"> statement is used to check whether the file was loaded correctly and if not, it returns an </span><span class="No-Break"><span class="koboSpan" id="kobo.746.1">empty </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.747.1">SKView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.748.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.749.1">Then, we position the steam</span><a id="_idIndexMarker891"/><span class="koboSpan" id="kobo.750.1"> in the center of the scene; set the blend mode of the steam to </span><strong class="source-inline"><span class="koboSpan" id="kobo.751.1">SKBlendMode.screen</span></strong><span class="koboSpan" id="kobo.752.1">, which will help to make the steam blend in with the background; set the initial scale of the steam particles to help them resemble a steam effect; then, we set the range of the scale of the smoke particles. </span><span class="koboSpan" id="kobo.752.2">(Again, refer to the previous project where I defined each of these property fields in the </span><span class="No-Break"><span class="koboSpan" id="kobo.753.1">SKS file).</span></span></li>
<li><span class="koboSpan" id="kobo.754.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.755.1">addChild</span></strong><span class="koboSpan" id="kobo.756.1"> method is called on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.757.1">scene</span></strong><span class="koboSpan" id="kobo.758.1"> instance, passing in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.759.1">steam</span></strong><span class="koboSpan" id="kobo.760.1"> node as an argument. </span><span class="koboSpan" id="kobo.760.2">This adds the particle emitter node as a child node to the scene, meaning it will be displayed in </span><span class="No-Break"><span class="koboSpan" id="kobo.761.1">the scene.</span></span></li>
<li><span class="koboSpan" id="kobo.762.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.763.1">presentScene</span></strong><span class="koboSpan" id="kobo.764.1"> method is called on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.765.1">view</span></strong><span class="koboSpan" id="kobo.766.1"> instance, passing in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.767.1">scene</span></strong><span class="koboSpan" id="kobo.768.1"> instance as an argument. </span><span class="koboSpan" id="kobo.768.2">This sets the scene as the currently displayed scene in </span><span class="No-Break"><span class="koboSpan" id="kobo.769.1">the view.</span></span></li>
<li><span class="koboSpan" id="kobo.770.1">Then, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.771.1">return</span></strong><span class="koboSpan" id="kobo.772.1"> keyword returns the </span><strong class="source-inline"><span class="koboSpan" id="kobo.773.1">view</span></strong><span class="koboSpan" id="kobo.774.1"> instance. </span></li>
<li><span class="koboSpan" id="kobo.775.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.776.1">updateUIView</span></strong><span class="koboSpan" id="kobo.777.1"> function is called when the view needs to be updated, such as when the view’s state changes. </span><span class="koboSpan" id="kobo.777.2">In this code, we leave it empty, as it is not needed in </span><span class="No-Break"><span class="koboSpan" id="kobo.778.1">our example.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.779.1">So, all that code creates and returns an </span><strong class="source-inline"><span class="koboSpan" id="kobo.780.1">SKView</span></strong><span class="koboSpan" id="kobo.781.1"> instance that displays a SpriteKit particle emitter as a SwiftUI view. </span><span class="koboSpan" id="kobo.781.2">Noticed that I am setting some of the properties in code here? </span><span class="koboSpan" id="kobo.781.3">You have the option of setting the properties in the SKS file by adjusting the values there, or you can set them</span><a id="_idIndexMarker892"/><span class="koboSpan" id="kobo.782.1"> in code here; however, remember that when you set them in code, they override anything you set in the </span><span class="No-Break"><span class="koboSpan" id="kobo.783.1">SKS file.</span></span></p>
<h2 id="_idParaDest-217"><a id="_idTextAnchor228"/><span class="koboSpan" id="kobo.784.1">Filling out ContentView</span></h2>
<p><span class="koboSpan" id="kobo.785.1">Now, we can just do a little</span><a id="_idIndexMarker893"/><span class="koboSpan" id="kobo.786.1"> work in </span><strong class="source-inline"><span class="koboSpan" id="kobo.787.1">ContentView</span></strong><span class="koboSpan" id="kobo.788.1"> and display the steaming cup of coffee. </span><span class="koboSpan" id="kobo.788.2">If you haven’t already done so, drop the assets into the Asset Catalog that you can find in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.789.1">Chapter 15</span></strong></span><span class="koboSpan" id="kobo.790.1"> folder titled </span><strong class="source-inline"><span class="koboSpan" id="kobo.791.1">Coffee Steam</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.792.1">on GitHub.</span></span></p>
<p><span class="koboSpan" id="kobo.793.1">Let’s modify </span><strong class="source-inline"><span class="koboSpan" id="kobo.794.1">ContentView</span></strong><span class="koboSpan" id="kobo.795.1"> to look like </span><span class="No-Break"><span class="koboSpan" id="kobo.796.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.797.1">
struct ContentView: View {
  var body: some View {
    ZStack {
        Image("background")
            .resizable().frame(width: 600, height: 900)
            .aspectRatio(contentMode: .fit)
        ZStack {
            ///adding the whole cup
            Image("cup")
                .resizable().frame(width: 350, height: 300)
                .aspectRatio(contentMode: .fit)
            ///calling and positioning the SmokeView
            CoffeeSteam().offset(x: 15, y: 80)
            ///adding the altered cup
            Image("cup 2")
                .resizable().frame(width: 350, height: 300)
                .aspectRatio(contentMode: .fit)
        }.offset(y: 250)
    }
  }
}</span></pre>
<p><span class="koboSpan" id="kobo.798.1">The code declares a </span><strong class="source-inline"><span class="koboSpan" id="kobo.799.1">ZStack</span></strong><span class="koboSpan" id="kobo.800.1"> that will hold</span><a id="_idIndexMarker894"/><span class="koboSpan" id="kobo.801.1"> our views. </span><span class="koboSpan" id="kobo.801.2">Inside </span><strong class="source-inline"><span class="koboSpan" id="kobo.802.1">ZStack</span></strong><span class="koboSpan" id="kobo.803.1">, we add a background image, resize it, and set the aspect ratio </span><span class="No-Break"><span class="koboSpan" id="kobo.804.1">on it.</span></span></p>
<p><span class="koboSpan" id="kobo.805.1">Then, the code declares another </span><strong class="source-inline"><span class="koboSpan" id="kobo.806.1">ZStack</span></strong><span class="koboSpan" id="kobo.807.1">, where we placed the first image titled </span><strong class="source-inline"><span class="koboSpan" id="kobo.808.1">cup</span></strong><span class="koboSpan" id="kobo.809.1">, resizing it and setting its aspect ratio </span><span class="No-Break"><span class="koboSpan" id="kobo.810.1">as well.</span></span></p>
<p><span class="koboSpan" id="kobo.811.1">Next, we called the </span><strong class="source-inline"><span class="koboSpan" id="kobo.812.1">CoffeeSteam</span></strong><span class="koboSpan" id="kobo.813.1"> struct and offset it a little bit so it’s centered in the middle of the cup. </span></p>
<p><span class="koboSpan" id="kobo.814.1">And after that, we added the </span><strong class="source-inline"><span class="koboSpan" id="kobo.815.1">cup 2</span></strong><span class="koboSpan" id="kobo.816.1"> image. </span><span class="koboSpan" id="kobo.816.2">This second image is used to make the steam appear as though it’s coming out of the center of the cup. </span><span class="koboSpan" id="kobo.816.3">So, what we’re essentially doing is sandwiching the animating steam in between two coffee cup images, in which one of the cup images has a little cut out in it; when we place the steam in between these two, we can create a nice steaming effect that appears to be originating from inside the coffee cup. </span></p>
<p><span class="koboSpan" id="kobo.817.1">Finally, I called the </span><strong class="source-inline"><span class="koboSpan" id="kobo.818.1">offset</span></strong><span class="koboSpan" id="kobo.819.1"> modifier on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.820.1">ZStack</span></strong><span class="koboSpan" id="kobo.821.1"> to position everything on </span><span class="No-Break"><span class="koboSpan" id="kobo.822.1">the </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.823.1">y</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.824.1">-axis.</span></span></p>
<p><span class="koboSpan" id="kobo.825.1">Now, run the project and you will see the steaming effect that’s coming right off the surface of the coffee. </span><span class="koboSpan" id="kobo.825.2">Also notice how the back of the cup glistens with the steam as it rises, as it would do in a real cup </span><span class="No-Break"><span class="koboSpan" id="kobo.826.1">of coffee.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer211">
<span class="koboSpan" id="kobo.827.1"><img alt="Figure 15.7: A cup of steaming coffee " src="image/B18674_15_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.828.1">Figure 15.7: A cup of steaming coffee</span></p>
<p><span class="koboSpan" id="kobo.829.1">Now, we have completed</span><a id="_idIndexMarker895"/><span class="koboSpan" id="kobo.830.1"> two projects using the </span><strong class="bold"><span class="koboSpan" id="kobo.831.1">Smoke</span></strong><span class="koboSpan" id="kobo.832.1"> particle template – creating pipe smoke and coffee steam – and we understand how to manipulate the particles in very different ways. </span><span class="koboSpan" id="kobo.832.2">Let’s continue and move on to the next project, where we’ll use a different particle </span><span class="No-Break"><span class="koboSpan" id="kobo.833.1">system: fire.</span></span></p>
<h1 id="_idParaDest-218"><a id="_idTextAnchor229"/><span class="koboSpan" id="kobo.834.1">Animating rocket fire</span></h1>
<p><span class="koboSpan" id="kobo.835.1">The SpriteKit Fire particle template</span><a id="_idIndexMarker896"/><span class="koboSpan" id="kobo.836.1"> generates particles that are typically colored shades of orange, yellow, and red, which give the impression of glowing embers and flames. </span><span class="koboSpan" id="kobo.836.2">The particles may also have a slight degree of transparency to mimic the flickering and shifting quality of a real fire. </span><span class="koboSpan" id="kobo.836.3">In terms of behavior, the particles are designed to move upward with a certain amount of randomness, representing the movement of hot air and flames. </span></p>
<p><span class="koboSpan" id="kobo.837.1">Rather than creating some simple flames, though, we’re going to animate </span><span class="No-Break"><span class="koboSpan" id="kobo.838.1">a rocket!</span></span></p>
<p><span class="koboSpan" id="kobo.839.1">Press </span><em class="italic"><span class="koboSpan" id="kobo.840.1">Command + N</span></em><span class="koboSpan" id="kobo.841.1">, then choose the </span><strong class="bold"><span class="koboSpan" id="kobo.842.1">SpriteKit Particle File</span></strong><span class="koboSpan" id="kobo.843.1"> template. </span><span class="koboSpan" id="kobo.843.2">After that, pick the </span><strong class="bold"><span class="koboSpan" id="kobo.844.1">Fire</span></strong><span class="koboSpan" id="kobo.845.1"> particle template and name the file </span><strong class="source-inline"><span class="koboSpan" id="kobo.846.1">Rocket</span></strong><span class="koboSpan" id="kobo.847.1">. </span><span class="koboSpan" id="kobo.847.2">Xcode will go ahead and create the fire particles that you can see them running in </span><span class="No-Break"><span class="koboSpan" id="kobo.848.1">the editor.</span></span></p>
<p><span class="koboSpan" id="kobo.849.1">Now, let’s create the SwiftUI view that will bring this </span><strong class="source-inline"><span class="koboSpan" id="kobo.850.1">.sks</span></strong><span class="koboSpan" id="kobo.851.1"> file into our </span><span class="No-Break"><span class="koboSpan" id="kobo.852.1">SwiftUI project.</span></span></p>
<h2 id="_idParaDest-219"><a id="_idTextAnchor230"/><span class="koboSpan" id="kobo.853.1">Adding FireView</span></h2>
<p><span class="koboSpan" id="kobo.854.1">To create</span><a id="_idIndexMarker897"/><span class="koboSpan" id="kobo.855.1"> the view, press </span><em class="italic"><span class="koboSpan" id="kobo.856.1">Command + N</span></em><span class="koboSpan" id="kobo.857.1"> and make a </span><strong class="source-inline"><span class="koboSpan" id="kobo.858.1">SwiftUIView</span></strong><span class="koboSpan" id="kobo.859.1"> file. </span><span class="koboSpan" id="kobo.859.2">Then, call it </span><strong class="source-inline"><span class="koboSpan" id="kobo.860.1">FireView</span></strong><span class="koboSpan" id="kobo.861.1">. </span><span class="koboSpan" id="kobo.861.2">Then, import SpriteKit, and add the following code at the top of </span><span class="No-Break"><span class="koboSpan" id="kobo.862.1">the file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.863.1">
struct FireView: UIViewRepresentable {
    func makeUIView(context: 
      UIViewRepresentableContext&lt;FireView&gt;) -&gt; SKView {
        let view = SKView(frame: CGRect(x: 0, y: 0, width: 
          400, height: 400))
        view.backgroundColor = .clear
        scene.backgroundColor = UIColor.clear
        guard let fire = SKEmitterNode(fileNamed: 
          "Fire.sks") else { return SKView() }
        fire.position = CGPoint(x: scene.size.width / 2, y: 
          scene.size.height / 2)
        ///use the particlePositionRange property to 
          constrain the fire particles so they are not so 
          wide and can fit under the rockets exhaust
        fire.particlePositionRange = CGVector(dx: 5, dy: 0)
        ///add the fire to the scene
        scene.addChild(fire)
        view.presentScene(scene)
        return view
    }
    func updateUIView(_ uiView: SKView, context: 
      UIViewRepresentableContext&lt;FireView&gt;) {
        /// Update the fire in this function if you need to
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.864.1">I’m not going to go over this code because we have done this already, but you can refer back to the previous SpriteKit projects for all the explanations, and how we use the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.865.1">UIViewRepresentable</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.866.1"> protocol.</span></span></p>
<p><span class="koboSpan" id="kobo.867.1">If you run a code</span><a id="_idIndexMarker898"/><span class="koboSpan" id="kobo.868.1"> in the previews, you’ll see that it works great and the fire is the correct dimensions to fit under the rocket. </span><span class="koboSpan" id="kobo.868.2">However, notice that the fire is upside down. </span><span class="koboSpan" id="kobo.868.3">Let’s look at how we can fix this so it looks like a proper thrust to place underneath </span><span class="No-Break"><span class="koboSpan" id="kobo.869.1">a rocket.</span></span></p>
<h2 id="_idParaDest-220"><a id="_idTextAnchor231"/><span class="koboSpan" id="kobo.870.1">Adding RocketView</span></h2>
<p><span class="koboSpan" id="kobo.871.1">Let’s now create one more</span><a id="_idIndexMarker899"/><span class="koboSpan" id="kobo.872.1"> view that we can use to put together the rocket and the fire, then rotate the fire around so it’s properly oriented under the rocket. </span><span class="koboSpan" id="kobo.872.2">Press </span><em class="italic"><span class="koboSpan" id="kobo.873.1">Command + N</span></em><span class="koboSpan" id="kobo.874.1">, create a new SwiftUI View file, and call it </span><strong class="source-inline"><span class="koboSpan" id="kobo.875.1">RocketView</span></strong><span class="koboSpan" id="kobo.876.1">. </span><span class="koboSpan" id="kobo.876.2">Then, add the following code inside </span><span class="No-Break"><span class="koboSpan" id="kobo.877.1">the struct:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.878.1">
struct RocketView: View {
        @State private var rocketAndFireOffset: CGFloat = 0
        var body: some View {
            ZStack {
                FireView().rotationEffect(Angle(degrees: 
                  180.0)).offset(y: 60)
                     ///move the fire upwards by changing y 
                       offset
                    .offset(x: 0, y: -rocketAndFireOffset)
                    /// position the fire at the bottom 
                      center of the screen
                    .position(x: 
                      UIScreen.main.bounds.width/2, y: 
                      UIScreen.main.bounds.height)
                Image("rocket")
                    .resizable().aspectRatio(contentMode: 
                      .fit).frame(width: 100, height: 200)
                     ///move the rocket upwards by changing 
                       y offset
                    .offset(x: 0, y: -rocketAndFireOffset)
                    ///position the rocket at the bottom 
                      center of the screen
                    .position(x: 
                      UIScreen.main.bounds.width/2, y: 
                      UIScreen.main.bounds.height)
                ///rotate the fire and offset it so its 
                  under the bottom of the rocket
            } .animation(Animation.linear(duration: 
              8).repeatForever(autoreverses: false),value: 
              rocketAndFireOffset) // increase the duration 
              of the animation
                .onAppear {
                    rocketAndFireOffset = 
                      UIScreen.main.bounds.height * 1.3 // 
                      move the rocket off the top of the 
                      screen, by increasing the offset
            }
        }
    }</span></pre>
<p><span class="koboSpan" id="kobo.879.1">First, we create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.880.1">rocketAndFire</span></strong><span class="koboSpan" id="kobo.881.1"> offset variable that we can use to move both the rocket and the fire upward on </span><span class="No-Break"><span class="koboSpan" id="kobo.882.1">the screen.</span></span></p>
<p><span class="koboSpan" id="kobo.883.1">Then, inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.884.1">ZStack</span></strong><span class="koboSpan" id="kobo.885.1">, we take </span><strong class="source-inline"><span class="koboSpan" id="kobo.886.1">FireView</span></strong><span class="koboSpan" id="kobo.887.1"> and rotate it 180°, and offset it on the </span><em class="italic"><span class="koboSpan" id="kobo.888.1">y</span></em><span class="koboSpan" id="kobo.889.1">-axis, which makes</span><a id="_idIndexMarker900"/><span class="koboSpan" id="kobo.890.1"> the fire extend further out from the rocket, which we will add shortly. </span><span class="koboSpan" id="kobo.890.2">Then, we animate the fire upward by changing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.891.1">y</span></strong><span class="koboSpan" id="kobo.892.1">-</span><strong class="source-inline"><span class="koboSpan" id="kobo.893.1">offset</span></strong><span class="koboSpan" id="kobo.894.1">, and positioning the fire in the center of the screen on the </span><em class="italic"><span class="koboSpan" id="kobo.895.1">x</span></em><span class="koboSpan" id="kobo.896.1">- and </span><em class="italic"><span class="koboSpan" id="kobo.897.1">y</span></em><span class="koboSpan" id="kobo.898.1">-axes using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.899.1">UIScreen</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.900.1"> property.</span></span></p>
<p><span class="koboSpan" id="kobo.901.1">Then, we can add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.902.1">rocket</span></strong><span class="koboSpan" id="kobo.903.1"> image, resize it, and animate it upward by offsetting the </span><em class="italic"><span class="koboSpan" id="kobo.904.1">y</span></em><span class="koboSpan" id="kobo.905.1">-axis using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.906.1">rocketAndFire</span></strong><span class="koboSpan" id="kobo.907.1"> variable. </span><span class="koboSpan" id="kobo.907.2">Next, we just need to position the rocket in the center of the screen using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.908.1">UIScreen</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.909.1"> property.</span></span></p>
<p><span class="koboSpan" id="kobo.910.1">Finally, we can add the animation to the closing brace of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.911.1">ZStack</span></strong><span class="koboSpan" id="kobo.912.1">, which will act on both </span><strong class="source-inline"><span class="koboSpan" id="kobo.913.1">FireView</span></strong><span class="koboSpan" id="kobo.914.1"> and the rocket image. </span><span class="koboSpan" id="kobo.914.2">Let’s give it a duration of </span><strong class="source-inline"><span class="koboSpan" id="kobo.915.1">8</span></strong><span class="koboSpan" id="kobo.916.1"> seconds, and make it repeat forever with </span><span class="No-Break"><span class="koboSpan" id="kobo.917.1">no auto-reverse.</span></span></p>
<p><span class="koboSpan" id="kobo.918.1">Now, we can launch the rocket in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.919.1">onAppear</span></strong><span class="koboSpan" id="kobo.920.1"> method by changing the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.921.1">rocketAndFire</span></strong><span class="koboSpan" id="kobo.922.1"> property. </span><span class="koboSpan" id="kobo.922.2">When the view appears, the rocket will lift off and continue off the top</span><a id="_idIndexMarker901"/><span class="koboSpan" id="kobo.923.1"> of the screen and come back up from the bottom and </span><span class="No-Break"><span class="koboSpan" id="kobo.924.1">keep flying.</span></span></p>
<p><span class="koboSpan" id="kobo.925.1">All we have to do now is add </span><span class="No-Break"><span class="koboSpan" id="kobo.926.1">the background!</span></span></p>
<h2 id="_idParaDest-221"><a id="_idTextAnchor232"/><span class="koboSpan" id="kobo.927.1">Putting things together inside ContentView</span></h2>
<p><span class="koboSpan" id="kobo.928.1">Inside </span><strong class="source-inline"><span class="koboSpan" id="kobo.929.1">ContentView</span></strong><span class="koboSpan" id="kobo.930.1">, we need very</span><a id="_idIndexMarker902"/><span class="koboSpan" id="kobo.931.1"> little code to get our rocket </span><span class="No-Break"><span class="koboSpan" id="kobo.932.1">into space:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.933.1">
struct ContentView: View {
    var body: some View {
        ZStack {
            ///add the RocketView to the scene
            RocketView()
        }.background(Image("background")
            .resizable()
            .scaledToFill().edgesIgnoringSafeArea(.all))
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.934.1">And that’s it. </span><span class="koboSpan" id="kobo.934.2">Inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.935.1">ZStack</span></strong><span class="koboSpan" id="kobo.936.1">, we added </span><strong class="source-inline"><span class="koboSpan" id="kobo.937.1">RocketView()</span></strong><span class="koboSpan" id="kobo.938.1"> to the scene, and then we added the background image right </span><span class="No-Break"><span class="koboSpan" id="kobo.939.1">onto </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.940.1">ZStack</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.941.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.942.1">Check it out in the previews and you’ll see that we now have a rocket flying </span><span class="No-Break"><span class="koboSpan" id="kobo.943.1">in space:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer212">
<span class="koboSpan" id="kobo.944.1"><img alt="Figure 15.8: Our rocket blasting off " src="image/B18674_15_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.945.1">Figure 15.8: Our rocket blasting off</span></p>
<p><span class="koboSpan" id="kobo.946.1">By leveraging the power</span><a id="_idIndexMarker903"/><span class="koboSpan" id="kobo.947.1"> of particle systems, we were able to create a realistic and dynamic visual effect that brings our rocket to life. </span><span class="koboSpan" id="kobo.947.2">We explored the various parameters and properties of the emitter to fine-tune the look and feel of the thrust and learned how to integrate it with our </span><span class="No-Break"><span class="koboSpan" id="kobo.948.1">SwiftUI view.</span></span></p>
<p><span class="koboSpan" id="kobo.949.1">Looking at another example, we’re going to return to another effect that we’ve already seen before – snow – but modify it so it creates a </span><span class="No-Break"><span class="koboSpan" id="kobo.950.1">blizzard-like effect.</span></span></p>
<h1 id="_idParaDest-222"><a id="_idTextAnchor233"/><span class="koboSpan" id="kobo.951.1">Animating a blizzard</span></h1>
<p><span class="koboSpan" id="kobo.952.1">In this next project, we’re going to create</span><a id="_idIndexMarker904"/><span class="koboSpan" id="kobo.953.1"> a blizzard scene, and add a wind effect to make the snow blow from different directions. </span><span class="koboSpan" id="kobo.953.2">We will also use that wind to make the branches of a tree blow as well, by combining images and animating them. </span><span class="koboSpan" id="kobo.953.3">We created a snow scene in the breathing flower project in </span><a href="B18674_06.xhtml#_idTextAnchor082"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.954.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.955.1">, but this time, we’re going to create this snow scene using a particle file, which gives us more options for making and controlling </span><span class="No-Break"><span class="koboSpan" id="kobo.956.1">the snow.</span></span></p>
<p><span class="koboSpan" id="kobo.957.1">Let’s start by creating a new project and calling it </span><strong class="source-inline"><span class="koboSpan" id="kobo.958.1">Snow</span></strong><span class="koboSpan" id="kobo.959.1">. </span><span class="koboSpan" id="kobo.959.2">Then, we will get right to work creating the SKS file that we need for the snow – this time, though, we’ll create </span><span class="No-Break"><span class="koboSpan" id="kobo.960.1">two files.</span></span></p>
<h2 id="_idParaDest-223"><a id="_idTextAnchor234"/><span class="koboSpan" id="kobo.961.1">Creating two Snow SpriteKit particle files</span></h2>
<p><span class="koboSpan" id="kobo.962.1">For this project, we will create</span><a id="_idIndexMarker905"/><span class="koboSpan" id="kobo.963.1"> two SpriteKit files – both will be from the </span><strong class="bold"><span class="koboSpan" id="kobo.964.1">Snow</span></strong><span class="koboSpan" id="kobo.965.1"> template, but we will use different values so the snow blows from different directions and at </span><span class="No-Break"><span class="koboSpan" id="kobo.966.1">different velocities.</span></span></p>
<p><span class="koboSpan" id="kobo.967.1">To create the first file, press </span><em class="italic"><span class="koboSpan" id="kobo.968.1">Command + N</span></em><span class="koboSpan" id="kobo.969.1">, choose the </span><strong class="bold"><span class="koboSpan" id="kobo.970.1">SpriteKit Particle File</span></strong><span class="koboSpan" id="kobo.971.1"> template, choose </span><strong class="bold"><span class="koboSpan" id="kobo.972.1">Snow</span></strong><span class="koboSpan" id="kobo.973.1"> from the particle options, and save it as </span><strong class="source-inline"><span class="koboSpan" id="kobo.974.1">Snow</span></strong><span class="koboSpan" id="kobo.975.1">. </span><span class="koboSpan" id="kobo.975.2">Now, let’s configure the particle properties so we can create a nice heavy snowfall. </span><span class="koboSpan" id="kobo.975.3">Use the same values from the </span><span class="No-Break"><span class="koboSpan" id="kobo.976.1">following figure:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer213">
<span class="koboSpan" id="kobo.977.1"><img alt="Figure 15.9: The attributes for the Snow file " src="image/B18674_15_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.978.1">Figure 15.9: The attributes for the Snow file</span></p>
<p><span class="koboSpan" id="kobo.979.1">And that creates the desired</span><a id="_idIndexMarker906"/><span class="koboSpan" id="kobo.980.1"> snowfall we are going for. </span><span class="koboSpan" id="kobo.980.2">To help you in designing your unique snowfall, the following is a guide for </span><span class="No-Break"><span class="koboSpan" id="kobo.981.1">making adjustments:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.982.1">Particle Lifetime</span></strong><span class="koboSpan" id="kobo.983.1">: Set the lifetime to a relatively long time so that the particles stay on the screen for </span><span class="No-Break"><span class="koboSpan" id="kobo.984.1">a while</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.985.1">Particle Birthrate</span></strong><span class="koboSpan" id="kobo.986.1">: Increase the birthrate to generate more particles per second, which will create a denser </span><span class="No-Break"><span class="koboSpan" id="kobo.987.1">snowfall effect</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.988.1">Particle Size</span></strong><span class="koboSpan" id="kobo.989.1">: Increase the size of the particles to make them appear larger and more prominent on </span><span class="No-Break"><span class="koboSpan" id="kobo.990.1">the screen</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.991.1">Particle Speed</span></strong><span class="koboSpan" id="kobo.992.1">: Decrease the speed of the particles to make them fall slower and </span><span class="No-Break"><span class="koboSpan" id="kobo.993.1">more gently</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.994.1">Particle Color</span></strong><span class="koboSpan" id="kobo.995.1">: Change the color of the particles to white or light blue to make them look more </span><span class="No-Break"><span class="koboSpan" id="kobo.996.1">like snowflakes</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.997.1">Emitter Shape</span></strong><span class="koboSpan" id="kobo.998.1">: Change the emitter shape to a rectangle or a line to make the snowfall appear </span><span class="No-Break"><span class="koboSpan" id="kobo.999.1">more natural</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.1000.1">Emitter Position</span></strong><span class="koboSpan" id="kobo.1001.1">: Adjust the emitter’s position to start the snowfall from the top of </span><span class="No-Break"><span class="koboSpan" id="kobo.1002.1">the screen</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1003.1">If you look at that snow in the editor, you can see that it has a pretty heavy effect, just what we need for our scene. </span><span class="koboSpan" id="kobo.1003.2">Now, let’s create the second file with different values for the snow; we’ll then combine both of these SKS files into one SwiftUI view that we can use to create a nice </span><span class="No-Break"><span class="koboSpan" id="kobo.1004.1">blizzard effect.</span></span></p>
<p><span class="koboSpan" id="kobo.1005.1">Follow the same steps to create a second file, but this time, call it </span><strong class="source-inline"><span class="koboSpan" id="kobo.1006.1">Blustery</span></strong><span class="koboSpan" id="kobo.1007.1">. </span><span class="koboSpan" id="kobo.1007.2">Now, let’s alter the attributes to the </span><span class="No-Break"><span class="koboSpan" id="kobo.1008.1">following values:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer214">
<span class="koboSpan" id="kobo.1009.1"><img alt="Figure 15.10: The attributes for the Blustery file " src="image/B18674_15_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1010.1">Figure 15.10: The attributes for the Blustery file</span></p>
<p><span class="koboSpan" id="kobo.1011.1">This new file has different </span><strong class="bold"><span class="koboSpan" id="kobo.1012.1">Birthrate</span></strong><span class="koboSpan" id="kobo.1013.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.1014.1">Angle</span></strong><span class="koboSpan" id="kobo.1015.1">, and </span><strong class="bold"><span class="koboSpan" id="kobo.1016.1">Acceleration</span></strong><span class="koboSpan" id="kobo.1017.1"> values to make the snow blow from different directions, as well as lift the snow up a little bit as if being carried by the wind. </span><span class="koboSpan" id="kobo.1017.2">When we combine</span><a id="_idIndexMarker907"/><span class="koboSpan" id="kobo.1018.1"> the two SKS files together, which will create a nice </span><span class="No-Break"><span class="koboSpan" id="kobo.1019.1">blizzard effect.</span></span></p>
<p><span class="koboSpan" id="kobo.1020.1">So, let’s do that now; we’ll need to create a struct in which you can put these two </span><span class="No-Break"><span class="koboSpan" id="kobo.1021.1">files together.</span></span></p>
<h2 id="_idParaDest-224"><a id="_idTextAnchor235"/><span class="koboSpan" id="kobo.1022.1">Creating a view that combines the two SKS files</span></h2>
<p><span class="koboSpan" id="kobo.1023.1">Working inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1024.1">ContentView</span></strong><span class="koboSpan" id="kobo.1025.1"> file, first, add</span><a id="_idIndexMarker908"/><span class="koboSpan" id="kobo.1026.1"> the SpriteKit import. </span><span class="koboSpan" id="kobo.1026.2">Then, create a new struct called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1027.1">SnowView</span></strong><span class="koboSpan" id="kobo.1028.1"> after the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1029.1">ContentView</span></strong><span class="koboSpan" id="kobo.1030.1"> struct. </span><span class="koboSpan" id="kobo.1030.2">(You could create separate files and keep things neat in the project navigator, but I’m just going to put the rest of the code into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1031.1">ContentView</span></strong><span class="koboSpan" id="kobo.1032.1"> file for </span><span class="No-Break"><span class="koboSpan" id="kobo.1033.1">this project.)</span></span></p>
<p><span class="koboSpan" id="kobo.1034.1">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1035.1">SnowView</span></strong><span class="koboSpan" id="kobo.1036.1"> created, add the following code </span><span class="No-Break"><span class="koboSpan" id="kobo.1037.1">within it:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1038.1">
struct SnowView: UIViewRepresentable {
  func makeUIView(context: 
    UIViewRepresentableContext&lt;SnowView&gt;) -&gt; SKView {
      let view = SKView(frame: CGRect(x: 0, y: 0, width: 
        400, height: 400))
      view.backgroundColor = .clear
      let scene = SKScene(size: CGSize(width: 500, 
        height: 800))
      scene.backgroundColor = UIColor.clear
      guard let snow = SKEmitterNode(fileNamed: 
        "Snow.sks") else { return SKView() }
      guard let blustery = SKEmitterNode(fileNamed: 
        "Blustery.sks") else { return SKView() }
      //snow sks file
      snow.position = CGPoint(x: scene.size.width / 2, y: 
        scene.size.height / 2)
      ///use the particlePositionRange property to spread 
        the snow particles on the screen for the x and y 
        axis
      snow.particlePositionRange = CGVector(dx: 500, dy: 
        900)
      //blustery sks file
      blustery.position = CGPoint(x: scene.size.width / 2, 
        y: scene.size.height / 2)
      ///use the particlePositionRange property to spread 
        the snow particles on the screen for the x and y 
        axis
      blustery.particlePositionRange = CGVector(dx: 500, 
        dy: 900)
      ///add the snow to the scene
      scene.addChild(snow)
      scene.addChild(blustery)
      view.presentScene(scene)
      return view
  }
  func updateUIView(_ uiView: SKView, context: 
    UIViewRepresentableContext&lt;SnowView&gt;) {
      /// Update the snow in this function if you need to
  }
}</span></pre>
<p><span class="koboSpan" id="kobo.1039.1">The code positions</span><a id="_idIndexMarker909"/><span class="koboSpan" id="kobo.1040.1"> both nodes, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1041.1">snow</span></strong><span class="koboSpan" id="kobo.1042.1"> node and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1043.1">blustery</span></strong><span class="koboSpan" id="kobo.1044.1"> node, using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1045.1">position</span></strong><span class="koboSpan" id="kobo.1046.1"> property, and then sets the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1047.1">particlePositionRange</span></strong><span class="koboSpan" id="kobo.1048.1"> property on both as well. </span><strong class="source-inline"><span class="koboSpan" id="kobo.1049.1">particlePositionRange</span></strong><span class="koboSpan" id="kobo.1050.1"> is the range of allowed random values for a particle’s position. </span><span class="koboSpan" id="kobo.1050.2">Finally, as we’ve done with our other particle files, we add them to the scene using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1051.1">addChild</span></strong><span class="koboSpan" id="kobo.1052.1"> function and passing in the view that we want to add to </span><span class="No-Break"><span class="koboSpan" id="kobo.1053.1">the scene.</span></span></p>
<p><span class="koboSpan" id="kobo.1054.1">Now, we can call this struct in </span><strong class="source-inline"><span class="koboSpan" id="kobo.1055.1">ContentView</span></strong><span class="koboSpan" id="kobo.1056.1"> to check out the blizzard, and in fact, let’s also add a background snow </span><span class="No-Break"><span class="koboSpan" id="kobo.1057.1">scene too:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1058.1">
struct ContentView: View {
    var body: some View {
        ZStack {
            Image("background")
                .resizable().frame(width: 600, height: 900)
                .aspectRatio(contentMode: .fit)
            SnowView()
        }
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.1059.1">Now, run the previews and check out the </span><span class="No-Break"><span class="koboSpan" id="kobo.1060.1">blizzard effect:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer215">
<span class="koboSpan" id="kobo.1061.1"><img alt="Figure 15.11: Our blizzard scene " src="image/B18674_15_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1062.1">Figure 15.11: Our blizzard scene</span></p>
<p><span class="koboSpan" id="kobo.1063.1">Now, let’s continue</span><a id="_idIndexMarker910"/><span class="koboSpan" id="kobo.1064.1"> with the project and add another animation to it. </span><span class="koboSpan" id="kobo.1064.2">For this one, we want to make the branches of the tree blow in the wind. </span></p>
<h2 id="_idParaDest-225"><a id="_idTextAnchor236"/><span class="koboSpan" id="kobo.1065.1">Animating the tree branches</span></h2>
<p><span class="koboSpan" id="kobo.1066.1">To animate the tree</span><a id="_idIndexMarker911"/><span class="koboSpan" id="kobo.1067.1"> branches, we’re going to wrap all the code up into several </span><strong class="source-inline"><span class="koboSpan" id="kobo.1068.1">ZStack</span></strong><span class="koboSpan" id="kobo.1069.1">. </span><span class="koboSpan" id="kobo.1069.2">Then, we will use one image of a snowy branch, replicate it many times with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1070.1">ForEach</span></strong><span class="koboSpan" id="kobo.1071.1"> loop, place the branch images over a portion of the tree, and put rotation animations on each of the axes of those images. </span><span class="koboSpan" id="kobo.1071.2">We will also randomize the animation so that it doesn’t follow a </span><span class="No-Break"><span class="koboSpan" id="kobo.1072.1">set pattern.</span></span></p>
<p><span class="koboSpan" id="kobo.1073.1">Let’s start by creating the struct that we need to hold </span><span class="No-Break"><span class="koboSpan" id="kobo.1074.1">these views:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1075.1">
struct Branches: View {
 var body: some View {
     }
}</span></pre>
<p><span class="koboSpan" id="kobo.1076.1">Next, let’s add the variables</span><a id="_idIndexMarker912"/><span class="koboSpan" id="kobo.1077.1"> we need to keep track of the animations and set some </span><span class="No-Break"><span class="koboSpan" id="kobo.1078.1">initial values:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1079.1">
   @State private var anglesX = [Double](repeating: 0, 
     count: 25)
    @State private var anglesY = [Double](repeating: 0, 
      count: 25)
    @State private var anglesZ = [Double](repeating: 0, 
      count: 25)
    @State private var positions = [CGPoint](repeating: 
      .zero, count: 25)
    @State private var durations = [Double](repeating: 0, 
      count: 25)</span></pre>
<p><span class="koboSpan" id="kobo.1080.1">This code defines five state properties in a </span><span class="No-Break"><span class="koboSpan" id="kobo.1081.1">SwiftUI view.</span></span></p>
<p><span class="koboSpan" id="kobo.1082.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1083.1">anglesX</span></strong><span class="koboSpan" id="kobo.1084.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1085.1">anglesY</span></strong><span class="koboSpan" id="kobo.1086.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1087.1">anglesZ</span></strong><span class="koboSpan" id="kobo.1088.1"> properties are arrays of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1089.1">Double</span></strong><span class="koboSpan" id="kobo.1090.1"> values, each with a length of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1091.1">25</span></strong><span class="koboSpan" id="kobo.1092.1">. </span><span class="koboSpan" id="kobo.1092.2">These arrays are used to store the rotation angles around the </span><em class="italic"><span class="koboSpan" id="kobo.1093.1">x</span></em><span class="koboSpan" id="kobo.1094.1">-, </span><em class="italic"><span class="koboSpan" id="kobo.1095.1">y</span></em><span class="koboSpan" id="kobo.1096.1">-, and </span><em class="italic"><span class="koboSpan" id="kobo.1097.1">z</span></em><span class="koboSpan" id="kobo.1098.1">-axes, respectively. </span><span class="koboSpan" id="kobo.1098.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1099.1">repeating:</span></strong><span class="koboSpan" id="kobo.1100.1"> parameter is used to initialize all the values in each array </span><span class="No-Break"><span class="koboSpan" id="kobo.1101.1">to 0.</span></span></p>
<p><span class="koboSpan" id="kobo.1102.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1103.1">positions</span></strong><span class="koboSpan" id="kobo.1104.1"> property is an array of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1105.1">CGPoint</span></strong><span class="koboSpan" id="kobo.1106.1"> values, also with a length of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1107.1">25</span></strong><span class="koboSpan" id="kobo.1108.1">. </span><span class="koboSpan" id="kobo.1108.2">This array is used to store the positions of the views. </span><span class="koboSpan" id="kobo.1108.3">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1109.1">repeating:</span></strong><span class="koboSpan" id="kobo.1110.1"> parameter is used to initialize all the values in the array to the zero point, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1111.1">(</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1112.1">0, 0)</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1113.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1114.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1115.1">durations</span></strong><span class="koboSpan" id="kobo.1116.1"> property is an array of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1117.1">Double</span></strong><span class="koboSpan" id="kobo.1118.1"> values, again with a length of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1119.1">25</span></strong><span class="koboSpan" id="kobo.1120.1">. </span><span class="koboSpan" id="kobo.1120.2">This array is used to store the durations of the animations associated with each view. </span><span class="koboSpan" id="kobo.1120.3">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1121.1">repeating:</span></strong><span class="koboSpan" id="kobo.1122.1"> parameter is used to initialize all the values in the array </span><span class="No-Break"><span class="koboSpan" id="kobo.1123.1">to 0.</span></span></p>
<p><span class="koboSpan" id="kobo.1124.1">As we have seen, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1125.1">@State</span></strong><span class="koboSpan" id="kobo.1126.1"> property wrapper</span><a id="_idIndexMarker913"/><span class="koboSpan" id="kobo.1127.1"> is used to make each of these arrays a mutable state property of the view. </span><span class="koboSpan" id="kobo.1127.2">This means that whenever any of the arrays are modified, SwiftUI will automatically re-render the view to reflect </span><span class="No-Break"><span class="koboSpan" id="kobo.1128.1">the changes.</span></span></p>
<p><span class="koboSpan" id="kobo.1129.1">Next, let’s move into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1130.1">body</span></strong><span class="koboSpan" id="kobo.1131.1"> property and add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1132.1">ZStack</span></strong><span class="koboSpan" id="kobo.1133.1"> that contains the image we want to manipulate and reproduce, as well as the animation we’re going to put </span><span class="No-Break"><span class="koboSpan" id="kobo.1134.1">on it:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1135.1">
ZStack {
    ForEach(0..&lt;8) { index in
         Image("branch")
            .resizable()
            .aspectRatio(contentMode: .fit)
            .rotationEffect(Angle(degrees: anglesX[index]))
            .rotationEffect(Angle(degrees: anglesY[index]), 
              anchor: .center)
            .rotationEffect(Angle(degrees: anglesZ[index]), 
              anchor: .center)
            .position(positions[index])
            .frame(width: 200, height: 700)
            .animation(
                Animation.easeInOut(duration: 
                  durations[index])
                    .repeatForever(autoreverses: true), 
                      value: anglesX)
            .onAppear {
                anglesX[index] = Double.random(in: 2...4)
                anglesY[index] = Double.random(in: 2...3)
                anglesZ[index] = Double.random(in: 1...3)
                positions[index] = CGPoint(x: 
                  CGFloat.random(in: 0...10), y: 
                  CGFloat.random(in: 0...5))
                durations[index] = Double.random(in: 3...5)
            }
    }
} .offset(x: 50, y: 200)</span></pre>
<p><span class="koboSpan" id="kobo.1136.1">Here’s what we’re doing</span><a id="_idIndexMarker914"/><span class="koboSpan" id="kobo.1137.1"> in here. </span><span class="koboSpan" id="kobo.1137.2">We start off with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1138.1">ZStack</span></strong><span class="koboSpan" id="kobo.1139.1"> so we can stack our views on top of each other. </span><span class="koboSpan" id="kobo.1139.2">Next is a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1140.1">ForEach</span></strong><span class="koboSpan" id="kobo.1141.1"> loop, which iterates over a range of integers from 0 to 7; the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1142.1">index</span></strong><span class="koboSpan" id="kobo.1143.1"> parameter is used to access the current iteration value in </span><span class="No-Break"><span class="koboSpan" id="kobo.1144.1">the loop.</span></span></p>
<p><span class="koboSpan" id="kobo.1145.1">Then, we add the branch image and the following modifiers: </span></p>
<ul>
<li><span class="koboSpan" id="kobo.1146.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1147.1">resizable</span></strong><span class="koboSpan" id="kobo.1148.1"> modifier resizes </span><span class="No-Break"><span class="koboSpan" id="kobo.1149.1">the image.</span></span></li>
<li><span class="koboSpan" id="kobo.1150.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1151.1">rotationEffect(_:)</span></strong><span class="koboSpan" id="kobo.1152.1"> modifier is used to rotate the image around the </span><em class="italic"><span class="koboSpan" id="kobo.1153.1">x</span></em><span class="koboSpan" id="kobo.1154.1">-, </span><em class="italic"><span class="koboSpan" id="kobo.1155.1">y</span></em><span class="koboSpan" id="kobo.1156.1">-, and </span><em class="italic"><span class="koboSpan" id="kobo.1157.1">z</span></em><span class="koboSpan" id="kobo.1158.1">-axes. </span><span class="koboSpan" id="kobo.1158.2">The angle of rotation is specified by the corresponding value in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1159.1">anglesX</span></strong><span class="koboSpan" id="kobo.1160.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1161.1">anglesY</span></strong><span class="koboSpan" id="kobo.1162.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1163.1">anglesZ</span></strong><span class="koboSpan" id="kobo.1164.1"> arrays, respectively. </span><span class="koboSpan" id="kobo.1164.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1165.1">anchor</span></strong><span class="koboSpan" id="kobo.1166.1"> parameter is used to specify the center of rotation. </span><span class="koboSpan" id="kobo.1166.2">In this case, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1167.1">.center</span></strong><span class="koboSpan" id="kobo.1168.1"> is used for both the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1169.1">anglesY</span></strong><span class="koboSpan" id="kobo.1170.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1171.1">anglesZ</span></strong><span class="koboSpan" id="kobo.1172.1"> rotations, so the image is rotated around its </span><span class="No-Break"><span class="koboSpan" id="kobo.1173.1">center point.</span></span></li>
<li><span class="koboSpan" id="kobo.1174.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1175.1">position(_:)</span></strong><span class="koboSpan" id="kobo.1176.1"> modifier is used to position the image on the screen. </span><span class="koboSpan" id="kobo.1176.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1177.1">positions</span></strong><span class="koboSpan" id="kobo.1178.1"> array stores the position for each image instance based on </span><span class="No-Break"><span class="koboSpan" id="kobo.1179.1">its index.</span></span></li>
<li><span class="koboSpan" id="kobo.1180.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1181.1">frame(width:height:)</span></strong><span class="koboSpan" id="kobo.1182.1"> modifier sets the size of </span><span class="No-Break"><span class="koboSpan" id="kobo.1183.1">the image.</span></span></li>
<li><span class="koboSpan" id="kobo.1184.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1185.1">animation(_:, value:)</span></strong><span class="koboSpan" id="kobo.1186.1"> modifier is used to animate the rotation of the image. </span><span class="koboSpan" id="kobo.1186.2">The duration of the animation is based on the value stored in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1187.1">durations</span></strong><span class="koboSpan" id="kobo.1188.1"> array, while the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1189.1">value</span></strong><span class="koboSpan" id="kobo.1190.1"> parameter specifies that the animation should be re-evaluated whenever the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1191.1">anglesX</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.1192.1">array changes.</span></span></li>
<li><span class="koboSpan" id="kobo.1193.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1194.1">onAppear</span></strong><span class="koboSpan" id="kobo.1195.1"> modifier is used to randomly generate new values for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1196.1">anglesX</span></strong><span class="koboSpan" id="kobo.1197.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1198.1">anglesY</span></strong><span class="koboSpan" id="kobo.1199.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1200.1">anglesZ</span></strong><span class="koboSpan" id="kobo.1201.1"> positions, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1202.1">durations</span></strong><span class="koboSpan" id="kobo.1203.1"> arrays whenever an image appears on </span><span class="No-Break"><span class="koboSpan" id="kobo.1204.1">the screen.</span></span></li>
<li><span class="koboSpan" id="kobo.1205.1">Finally, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1206.1">offset</span></strong><span class="koboSpan" id="kobo.1207.1"> modifier applies an offset of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1208.1">50</span></strong><span class="koboSpan" id="kobo.1209.1"> points on the </span><em class="italic"><span class="koboSpan" id="kobo.1210.1">x</span></em><span class="koboSpan" id="kobo.1211.1">-axis and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1212.1">200</span></strong><span class="koboSpan" id="kobo.1213.1"> points on the </span><em class="italic"><span class="koboSpan" id="kobo.1214.1">y</span></em><span class="koboSpan" id="kobo.1215.1">-axis to the entire </span><strong class="source-inline"><span class="koboSpan" id="kobo.1216.1">ZStack</span></strong><span class="koboSpan" id="kobo.1217.1">, which positions the tree branches in the middle-right portion of </span><span class="No-Break"><span class="koboSpan" id="kobo.1218.1">the tree.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1219.1">To summarize, what we’re doing</span><a id="_idIndexMarker915"/><span class="koboSpan" id="kobo.1220.1"> is creating eight image views of snow-covered branches, each with a different rotation, position, duration, and animation. </span><span class="koboSpan" id="kobo.1220.2">The views are stacked on top of each other within </span><strong class="source-inline"><span class="koboSpan" id="kobo.1221.1">ZStack</span></strong><span class="koboSpan" id="kobo.1222.1"> and have an offset applied to place them in </span><span class="No-Break"><span class="koboSpan" id="kobo.1223.1">the tree.</span></span></p>
<p><span class="koboSpan" id="kobo.1224.1">Now, I’d like to replicate the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1225.1">ZStack</span></strong><span class="koboSpan" id="kobo.1226.1"> several more times so we can cover the whole tree with snowy branches, rather than covering only a portion of the tree. </span><span class="koboSpan" id="kobo.1226.2">So, we’ll make four more ZStacks but with slightly different values to make the wind-blowing effect seem more random </span><span class="No-Break"><span class="koboSpan" id="kobo.1227.1">and natural:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1228.1">
ZStack {
    ForEach(0..&lt;10) { index in
        Image("branch")
            .resizable()
            .aspectRatio(contentMode: .fit)
            .rotationEffect(Angle(degrees: anglesX[index]))
            .rotationEffect(Angle(degrees: anglesY[index]), 
              anchor: .center)
            .rotationEffect(Angle(degrees: anglesZ[index]), 
              anchor: .center)
    .position(positions[index])
            .frame(width: 200, height: 700)
            .offset(x: 50, y: 200)
            .animation(
                Animation.easeInOut(duration: 
                  durations[index])
                    .repeatForever(autoreverses: 
                      true),value: anglesY)
            .onAppear {
                anglesX[index] = Double.random(in: 3...4)
                anglesY[index] = Double.random(in: 2...5)
                anglesZ[index] = Double.random(in: 1...4)
                positions[index] = CGPoint(x: 
                  CGFloat.random(in: 0...10), y: 
                  CGFloat.random(in: 0...14))
                durations[index] = Double.random(in: 2...6)
            }
    }
}.offset(x: -80, y: -156)
  ZStack {
    ForEach(0..&lt;15) { index in
      Image("branch")
          .resizable()
          .aspectRatio(contentMode: .fit)
          .rotationEffect(Angle(degrees: anglesX[index]))
          .rotationEffect(Angle(degrees: anglesY[index]), 
            anchor: .center)
          .rotationEffect(Angle(degrees: anglesZ[index]), 
            anchor: .center)
          .position(positions[index])
          .frame(width: 200, height: 700)
          .offset(x: 50, y: 200)
          .animation(
              Animation.easeInOut(duration: 
                durations[index])
                  .repeatForever(autoreverses: true)
              ,value: anglesZ)
          .onAppear {
              anglesX[index] = Double.random(in: 1...3)
              anglesY[index] = Double.random(in: 2...4)
              anglesZ[index] = Double.random(in: 3...6)
              positions[index] = CGPoint(x: 
                CGFloat.random(in: 0...10), y: 
                CGFloat.random(in: 0...8))
              durations[index] = Double.random(in: 4...6)
          }
  }
}.offset(x: -120, y: 0)
    
    ZStack {
      ForEach(0..&lt;7) { index in
        Image("branch")
          .resizable()
          .aspectRatio(contentMode: .fit)
          .rotationEffect(Angle(degrees: anglesX[index]))
          .rotationEffect(Angle(degrees: anglesY[index]), 
            anchor: .center)
          .rotationEffect(Angle(degrees: anglesZ[index]), 
            anchor: .center)
          .position(positions[index])
          .frame(width: 200, height: 700)
          .offset(x: 50, y: 200)
          .animation(
              Animation.easeInOut(duration: 
                durations[index])
                  .repeatForever(autoreverses: true)
              ,value: anglesX)
          .onAppear {
              anglesX[index] = Double.random(in: 1...3)
              anglesY[index] = Double.random(in: 2...3)
              anglesZ[index] = Double.random(in: 3...5)
              positions[index] = CGPoint(x: 
                CGFloat.random(in: 0...10), y: 
                CGFloat.random(in: 0...12))
              durations[index] = Double.random(in: 4...6)
          }
  }
  }.offset(x: -100, y: 160)
  
  ZStack {
    ForEach(0..&lt;7) { index in
      Image("branch")
          .resizable()
          .aspectRatio(contentMode: .fit)
          .rotationEffect(Angle(degrees: anglesX[index]))
          .rotationEffect(Angle(degrees: anglesY[index]), 
            anchor: .center)
          .rotationEffect(Angle(degrees: anglesZ[index]), 
            anchor: .center)
          .position(positions[index])
          .frame(width: 180, height: 700)
          .offset(x: 50, y: 200)
          .animation(
              Animation.easeInOut(duration: 
                durations[index])
                  .repeatForever(autoreverses: true)
              ,value: anglesY)
          .onAppear {
              anglesX[index] = Double.random(in: 0...2)
              anglesY[index] = Double.random(in: 0...3)
              anglesZ[index] = Double.random(in: 0...1)
              positions[index] = CGPoint(x: 
                CGFloat.random(in: 0...10), y: 
                CGFloat.random(in: 0...12))
              durations[index] = Double.random(in: 3...6)
          }
  }
  }.offset(x: 10, y: 100)</span></pre>
<p><span class="koboSpan" id="kobo.1229.1">All of these </span><strong class="source-inline"><span class="koboSpan" id="kobo.1230.1">ZStack</span></strong><span class="koboSpan" id="kobo.1231.1"> do essentially</span><a id="_idIndexMarker916"/><span class="koboSpan" id="kobo.1232.1"> the same thing, except that the code uses different values. </span><span class="koboSpan" id="kobo.1232.2">For example, in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1233.1">ForEach</span></strong><span class="koboSpan" id="kobo.1234.1"> loop, we’re using a different range of values, and we’re also changing the random values for the </span><em class="italic"><span class="koboSpan" id="kobo.1235.1">x</span></em><span class="koboSpan" id="kobo.1236.1">-, </span><em class="italic"><span class="koboSpan" id="kobo.1237.1">y</span></em><span class="koboSpan" id="kobo.1238.1">-, and </span><em class="italic"><span class="koboSpan" id="kobo.1239.1">z</span></em><span class="koboSpan" id="kobo.1240.1">-axes, as well as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1241.1">position</span></strong><span class="koboSpan" id="kobo.1242.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1243.1">duration</span></strong><span class="koboSpan" id="kobo.1244.1"> values. </span><span class="koboSpan" id="kobo.1244.2">Also, each </span><strong class="source-inline"><span class="koboSpan" id="kobo.1245.1">ZStack</span></strong><span class="koboSpan" id="kobo.1246.1"> has its own </span><strong class="source-inline"><span class="koboSpan" id="kobo.1247.1">onAppear</span></strong><span class="koboSpan" id="kobo.1248.1"> modifier, so it could randomly move its set of branches at a different pace and on a </span><span class="No-Break"><span class="koboSpan" id="kobo.1249.1">different axis.</span></span></p>
<p><span class="koboSpan" id="kobo.1250.1">Now, let’s call this struct inside </span><strong class="source-inline"><span class="koboSpan" id="kobo.1251.1">ContentView</span></strong><span class="koboSpan" id="kobo.1252.1">. </span><span class="koboSpan" id="kobo.1252.2">We will call it just before the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1253.1">SnowView</span></strong><span class="koboSpan" id="kobo.1254.1"> call; this way, the snow will appear on top of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1255.1">tree images:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1256.1">
struct ContentView: View {
    var body: some View {
        ZStack {
            Image("background")
                .resizable().frame(width: 600, height: 900)
                .aspectRatio(contentMode: .fit)
            Branches()
            SnowView()
        }
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.1257.1">Now, run the code and check out the really cool animation of the tree branches blowing in the wind as the </span><span class="No-Break"><span class="koboSpan" id="kobo.1258.1">snow falls.</span></span></p>
<p><span class="koboSpan" id="kobo.1259.1">Play around with all the values that we’ve used in the various parameters and customize them to your liking. </span><span class="koboSpan" id="kobo.1259.2">Maybe</span><a id="_idIndexMarker917"/><span class="koboSpan" id="kobo.1260.1"> you want fewer branches for a thinner-looking tree, maybe you want the wind to blow much stronger, or maybe you want to animate all the trees in the background image... </span><span class="koboSpan" id="kobo.1260.2">you can change all the settings to do just that. </span></p>
<p><span class="koboSpan" id="kobo.1261.1">Let’s continue our exploration of some interesting animations. </span><span class="koboSpan" id="kobo.1261.2">Up next, we will look at the rain </span><span class="No-Break"><span class="koboSpan" id="kobo.1262.1">particle system.</span></span></p>
<h1 id="_idParaDest-226"><a id="_idTextAnchor237"/><span class="koboSpan" id="kobo.1263.1">Animating rain</span></h1>
<p><span class="koboSpan" id="kobo.1264.1">In our next project, let’s make</span><a id="_idIndexMarker918"/><span class="koboSpan" id="kobo.1265.1"> it rain. </span><span class="koboSpan" id="kobo.1265.2">We’re going to create a realistic effect by creating rain from the </span><strong class="bold"><span class="koboSpan" id="kobo.1266.1">Rain</span></strong><span class="koboSpan" id="kobo.1267.1"> particle template and making it bounce off the ground as you would see in a rainstorm. </span><span class="koboSpan" id="kobo.1267.2">We’ll also create a puddle that will subtly grow and shrink, appearing to react to the falling rain, and it will also look like water, as we will add some blending options to it to give it a transparent look for a spectacular effect that even shows some of the ground </span><span class="No-Break"><span class="koboSpan" id="kobo.1268.1">underneath it.</span></span></p>
<h2 id="_idParaDest-227"><a id="_idTextAnchor238"/><span class="koboSpan" id="kobo.1269.1">Creating the Rain SpriteKit particle file</span></h2>
<p><span class="koboSpan" id="kobo.1270.1">Let’s get started. </span><span class="koboSpan" id="kobo.1270.2">You know</span><a id="_idIndexMarker919"/><span class="koboSpan" id="kobo.1271.1"> how to do this now – create an SKS file, choose </span><strong class="bold"><span class="koboSpan" id="kobo.1272.1">Rain</span></strong><span class="koboSpan" id="kobo.1273.1"> from the particle template list, and name the file </span><strong class="source-inline"><span class="koboSpan" id="kobo.1274.1">Rain</span></strong><span class="koboSpan" id="kobo.1275.1"> too. </span><span class="koboSpan" id="kobo.1275.2">Now, configure the file to have the </span><span class="No-Break"><span class="koboSpan" id="kobo.1276.1">following attributes:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer216">
<span class="koboSpan" id="kobo.1277.1"><img alt="Figure 15.12: The attributes of the rain animation " src="image/B18674_15_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1278.1">Figure 15.12: The attributes of the rain animation</span></p>
<p><span class="koboSpan" id="kobo.1279.1">Using the </span><strong class="bold"><span class="koboSpan" id="kobo.1280.1">Rain</span></strong><span class="koboSpan" id="kobo.1281.1"> particle template gives us rain right out of the box, but with some slight adjustments to the </span><strong class="bold"><span class="koboSpan" id="kobo.1282.1">Birthrate</span></strong><span class="koboSpan" id="kobo.1283.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.1284.1">Lifetime</span></strong><span class="koboSpan" id="kobo.1285.1"> options, we can alter how much of a rainstorm </span><span class="No-Break"><span class="koboSpan" id="kobo.1286.1">we want.</span></span></p>
<p><span class="koboSpan" id="kobo.1287.1">Let’s now create another</span><a id="_idIndexMarker920"/><span class="koboSpan" id="kobo.1288.1"> new file, this time, a SwiftUI file, which we will use to bring the rain effects into a SwiftUI view. </span></p>
<h2 id="_idParaDest-228"><a id="_idTextAnchor239"/><span class="koboSpan" id="kobo.1289.1">Creating the raindrops</span></h2>
<p><span class="koboSpan" id="kobo.1290.1">To create</span><a id="_idIndexMarker921"/><span class="koboSpan" id="kobo.1291.1"> the SwiftUI file, press </span><em class="italic"><span class="koboSpan" id="kobo.1292.1">Command + N</span></em><span class="koboSpan" id="kobo.1293.1"> and call this file </span><strong class="source-inline"><span class="koboSpan" id="kobo.1294.1">DropView</span></strong><span class="koboSpan" id="kobo.1295.1">. </span><span class="koboSpan" id="kobo.1295.2">The code we will add to this file will be responsible for creating the collision effect between a raindrop and the ground. </span><span class="koboSpan" id="kobo.1295.3">We’ll also alter the opacity and the blur to really help it blend into the scene. </span></p>
<p><span class="koboSpan" id="kobo.1296.1">Let’s now add the following code inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1297.1">DropView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1298.1"> struct:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1299.1">
struct DropView: View {
  @State private var dropScale: CGFloat = 0.1
  @State private var xOffsets = (0..&lt;300).map { _ in 
    CGFloat.random(in: -150...UIScreen.main.bounds.width)}
  @State private var yOffsets = (0..&lt;240).map { _ in 
    CGFloat.random(in: UIScreen.main.bounds.height/5...
</span><span class="koboSpan" id="kobo.1299.2">    UIScreen.main.bounds.height)}
  @State private var durations = (0..&lt;150).map { _ in 
    Double.random(in: 0.3...1.0)}
  var body: some View {
      //Color.clear.edgesIgnoringSafeArea(.all)
          ForEach(0..&lt;150) { index in
              Circle()
                  .fill(Color.white)
                      .opacity(0.6)
                    .blur(radius: 3)
                  .frame(width: 15, height: 15)
                  .scaleEffect(dropScale)
                  .rotation3DEffect(Angle(degrees: 80.0), 
                    axis: (x: 1, y: 0, z: 0))
                  .offset(x: xOffsets[index] - 140, y: 
                    yOffsets[index])
                  .animation(Animation.easeInOut(duration: 
                    durations[index]).repeatForever
                    (autoreverses: true), value: dropScale)
                  .onAppear {
                      dropScale = 0.8
                  }
          }
  }
}</span></pre>
<p><span class="koboSpan" id="kobo.1300.1">There’s a lot going</span><a id="_idIndexMarker922"/><span class="koboSpan" id="kobo.1301.1"> on here, so let’s break it down line by line. </span></p>
<p><span class="koboSpan" id="kobo.1302.1">There are four </span><strong class="source-inline"><span class="koboSpan" id="kobo.1303.1">State</span></strong><span class="koboSpan" id="kobo.1304.1"> variables we need and each one has a </span><span class="No-Break"><span class="koboSpan" id="kobo.1305.1">specific task:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1306.1">The first variable is of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1307.1">CGFloat</span></strong><span class="koboSpan" id="kobo.1308.1"> type and gets an initial value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1309.1">0.1</span></strong><span class="koboSpan" id="kobo.1310.1">. </span><span class="koboSpan" id="kobo.1310.2">This variable is used to control the scale of </span><span class="No-Break"><span class="koboSpan" id="kobo.1311.1">the drops.</span></span></li>
<li><span class="koboSpan" id="kobo.1312.1">The next two variables create arrays of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1313.1">CGFloat</span></strong><span class="koboSpan" id="kobo.1314.1"> values, stored in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1315.1">xOffsets</span></strong><span class="koboSpan" id="kobo.1316.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1317.1">yOffsets</span></strong><span class="koboSpan" id="kobo.1318.1"> state variables. </span><span class="koboSpan" id="kobo.1318.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1319.1">map</span></strong><span class="koboSpan" id="kobo.1320.1"> method is used to generate random </span><strong class="source-inline"><span class="koboSpan" id="kobo.1321.1">CGFloat</span></strong><span class="koboSpan" id="kobo.1322.1"> values and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1323.1">CGFloat.random(in:)</span></strong><span class="koboSpan" id="kobo.1324.1"> method is used to generate a random </span><strong class="source-inline"><span class="koboSpan" id="kobo.1325.1">CGFloat</span></strong><span class="koboSpan" id="kobo.1326.1"> value within a given range. </span><span class="koboSpan" id="kobo.1326.2">In short, these variables are used to set a random </span><em class="italic"><span class="koboSpan" id="kobo.1327.1">x</span></em><span class="koboSpan" id="kobo.1328.1">- and </span><em class="italic"><span class="koboSpan" id="kobo.1329.1">y</span></em><span class="koboSpan" id="kobo.1330.1">-coordinate position for </span><span class="No-Break"><span class="koboSpan" id="kobo.1331.1">each drop.</span></span></li>
<li><span class="koboSpan" id="kobo.1332.1">The final variable is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1333.1">durations</span></strong><span class="koboSpan" id="kobo.1334.1"> variable, which randomizes the duration of </span><span class="No-Break"><span class="koboSpan" id="kobo.1335.1">the animation.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1336.1">Let’s take a closer look at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1337.1">map</span></strong><span class="koboSpan" id="kobo.1338.1"> method since it is being used by three of our properties. </span><span class="koboSpan" id="kobo.1338.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1339.1">map</span></strong><span class="koboSpan" id="kobo.1340.1"> method is a higher-order function in Swift that transforms an array of values into a new array</span><a id="_idIndexMarker923"/><span class="koboSpan" id="kobo.1341.1"> of different values. </span><span class="koboSpan" id="kobo.1341.2">It takes a closure expression as an argument, which is executed for each element in the original array and returns a new value for that element. </span><span class="koboSpan" id="kobo.1341.3">The resulting array is then the combination of all of these </span><span class="No-Break"><span class="koboSpan" id="kobo.1342.1">new values.</span></span></p>
<p><span class="koboSpan" id="kobo.1343.1">In the code, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1344.1">map</span></strong><span class="koboSpan" id="kobo.1345.1"> method is being used to transform the range of integers between 0 and &lt;300 into an array of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1346.1">CGFloat</span></strong><span class="koboSpan" id="kobo.1347.1"> values, by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1348.1">CGFloat.random(in:)</span></strong><span class="koboSpan" id="kobo.1349.1"> method to generate a random value for each element in the range. </span><span class="koboSpan" id="kobo.1349.2">The closure expression passed to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1350.1">map</span></strong><span class="koboSpan" id="kobo.1351.1"> method takes a single argument, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1352.1">_</span></strong><span class="koboSpan" id="kobo.1353.1">, which is a placeholder for the current element of the range, and returns a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.1354.1">CGFloat</span></strong><span class="koboSpan" id="kobo.1355.1"> value, generated by </span><strong class="source-inline"><span class="koboSpan" id="kobo.1356.1">CGFloat.random(in: -150...UIScreen.main.bounds.width)</span></strong><span class="koboSpan" id="kobo.1357.1">. </span><span class="koboSpan" id="kobo.1357.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1358.1">map</span></strong><span class="koboSpan" id="kobo.1359.1"> method combines all of these new values into a single array, which is then assigned to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1360.1">xOffsets</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1361.1"> variable.</span></span></p>
<p><span class="koboSpan" id="kobo.1362.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1363.1">map</span></strong><span class="koboSpan" id="kobo.1364.1"> method is an important and versatile function in Swift, as it allows you to easily transform arrays and sequences of values into new arrays and sequences. </span><span class="koboSpan" id="kobo.1364.2">Additionally, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1365.1">map</span></strong><span class="koboSpan" id="kobo.1366.1"> method is often used in combination with other functional programming techniques such as filter and reduce, to perform complex operations on arrays and sequences in a more efficient and </span><span class="No-Break"><span class="koboSpan" id="kobo.1367.1">maintainable way.</span></span></p>
<p><span class="koboSpan" id="kobo.1368.1">Now, let’s move into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1369.1">body</span></strong><span class="koboSpan" id="kobo.1370.1"> property and look at what the code is </span><span class="No-Break"><span class="koboSpan" id="kobo.1371.1">doing there.</span></span></p>
<p><span class="koboSpan" id="kobo.1372.1">We use a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1373.1">ForEach</span></strong><span class="koboSpan" id="kobo.1374.1"> loop to iterate through a range from 0 and &lt;150, and create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1375.1">Circle</span></strong><span class="koboSpan" id="kobo.1376.1"> view with each iteration – the circle will be the raindrop. </span><span class="koboSpan" id="kobo.1376.2">Then, we set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1377.1">fill</span></strong><span class="koboSpan" id="kobo.1378.1"> color of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1379.1">Circle</span></strong><span class="koboSpan" id="kobo.1380.1"> view to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1381.1">white</span></strong><span class="koboSpan" id="kobo.1382.1">, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1383.1">width</span></strong><span class="koboSpan" id="kobo.1384.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1385.1">height</span></strong><span class="koboSpan" id="kobo.1386.1"> values to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1387.1">15</span></strong><span class="koboSpan" id="kobo.1388.1">, and apply a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1389.1">scaleEffect</span></strong><span class="koboSpan" id="kobo.1390.1"> with the value determined by the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1391.1">dropScale</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1392.1"> variable.</span></span></p>
<p><span class="koboSpan" id="kobo.1393.1">Next, we apply </span><strong class="source-inline"><span class="koboSpan" id="kobo.1394.1">rotation3DEffect</span></strong><span class="koboSpan" id="kobo.1395.1"> to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1396.1">Circle</span></strong><span class="koboSpan" id="kobo.1397.1"> view, with an angle of 80 degrees on the </span><em class="italic"><span class="koboSpan" id="kobo.1398.1">x</span></em><span class="koboSpan" id="kobo.1399.1">-axis; we want to rotate the drop so that it appears more like a raindrop colliding with the ground. </span><span class="koboSpan" id="kobo.1399.2">Following that, we set its offset using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1400.1">xOffsets</span></strong><span class="koboSpan" id="kobo.1401.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1402.1">yOffsets</span></strong><span class="koboSpan" id="kobo.1403.1"> variables with a value determined by </span><span class="No-Break"><span class="koboSpan" id="kobo.1404.1">the index.</span></span></p>
<p><span class="koboSpan" id="kobo.1405.1">We then add the animation, setting the duration to be determined by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1406.1">index</span></strong><span class="koboSpan" id="kobo.1407.1"> constant, and repeating the animation with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1408.1">autoreverse</span></strong><span class="koboSpan" id="kobo.1409.1"> set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1410.1">true</span></strong><span class="koboSpan" id="kobo.1411.1"> to create the realistic collision of the raindrop with the ground. </span></p>
<p><span class="koboSpan" id="kobo.1412.1">Finally, in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1413.1">onAppear</span></strong><span class="koboSpan" id="kobo.1414.1"> modifier, we give the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1415.1">DropScale</span></strong><span class="koboSpan" id="kobo.1416.1"> variable a value </span><span class="No-Break"><span class="koboSpan" id="kobo.1417.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1418.1">0.8</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1419.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1420.1">Running that in the previews</span><a id="_idIndexMarker924"/><span class="koboSpan" id="kobo.1421.1"> will be a little difficult to see because of the white background, but let’s keep going and we’ll check out the results shortly. </span></p>
<p><span class="koboSpan" id="kobo.1422.1">Let’s now create a new view that will make a puddle of water that we can animate and add to </span><span class="No-Break"><span class="koboSpan" id="kobo.1423.1">the scene.</span></span></p>
<h2 id="_idParaDest-229"><a id="_idTextAnchor240"/><span class="koboSpan" id="kobo.1424.1">Creating the puddle</span></h2>
<p><span class="koboSpan" id="kobo.1425.1">Let’s now add a puddle</span><a id="_idIndexMarker925"/><span class="koboSpan" id="kobo.1426.1"> to our scene, which we’ll do in a new SwiftUI View file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1427.1">PuddleView</span></strong><span class="koboSpan" id="kobo.1428.1">. </span><span class="koboSpan" id="kobo.1428.2">I’m going to add all the code for this view and then we’ll review how </span><span class="No-Break"><span class="koboSpan" id="kobo.1429.1">it works:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1430.1">
struct PuddleView: View {
  @State private var scaleX: CGFloat = 0.5
  @State private var scaleY: CGFloat = 0.5
  var body: some View {
    ZStack {
      Capsule()
          .fill(LinearGradient(gradient: Gradient(colors: 
            [.white,  .black,.gray, .white,.black]), 
            startPoint: .topLeading, endPoint:  
            .bottomTrailing))
          .opacity(0.5)
          .blur(radius: 5)
          .frame(width: 600, height: 500)
          .scaleEffect(x: scaleX, y: scaleY, anchor: 
        .center)
      .animation(Animation.easeInOut(duration: 
        8.0).repeatForever(autoreverses: true),value: 
        scaleX)
      //creates the ripple
          .overlay(
              Capsule()
                  .stroke(Color.gray, lineWidth: 5)
                  .opacity(0.5 )
                  .frame(width: 350, height: 200)
                  .offset(x: 0, y: -15)
                  .scaleEffect(x: scaleX + 0.03, y: scaleY 
                    + 0.03, anchor: .center)
                  .animation(Animation.easeInOut(duration: 
                    8.0).repeatForever(autoreverses: true), 
                    value: scaleY)
                  .onAppear {
                      scaleX = 0.54
                      scaleY = 0.6
                  }).rotation3DEffect(Angle(degrees: 81.0), 
                    axis: (x: 1, y: 0, z: 0))
      
  } .offset(x: -50, y: 300)
      .onAppear {
          scaleX = 0.55
          scaleY = 0.6
      }
  }
}</span></pre>
<p><span class="koboSpan" id="kobo.1431.1">This code defines a struct</span><a id="_idIndexMarker926"/><span class="koboSpan" id="kobo.1432.1"> called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1433.1">PuddleView</span></strong><span class="koboSpan" id="kobo.1434.1"> that has two properties, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1435.1">scaleX</span></strong><span class="koboSpan" id="kobo.1436.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1437.1">scaleY</span></strong><span class="koboSpan" id="kobo.1438.1">, which are both </span><strong class="source-inline"><span class="koboSpan" id="kobo.1439.1">CGFloat</span></strong><span class="koboSpan" id="kobo.1440.1"> values. </span><span class="koboSpan" id="kobo.1440.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1441.1">body</span></strong><span class="koboSpan" id="kobo.1442.1"> property of the struct is defined </span><span class="No-Break"><span class="koboSpan" id="kobo.1443.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1444.1">A </span><strong class="source-inline"><span class="koboSpan" id="kobo.1445.1">ZStack</span></strong><span class="koboSpan" id="kobo.1446.1"> view is created, which arranges views on top of </span><span class="No-Break"><span class="koboSpan" id="kobo.1447.1">each other.</span></span></li>
<li><span class="koboSpan" id="kobo.1448.1">Inside </span><strong class="source-inline"><span class="koboSpan" id="kobo.1449.1">ZStack</span></strong><span class="koboSpan" id="kobo.1450.1">, a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1451.1">Capsule</span></strong><span class="koboSpan" id="kobo.1452.1"> view is created, which will be the shape of a puddle. </span><span class="koboSpan" id="kobo.1452.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1453.1">Capsule</span></strong><span class="koboSpan" id="kobo.1454.1"> view is filled with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1455.1">LinearGradient</span></strong><span class="koboSpan" id="kobo.1456.1"> of colors and is then modified with </span><span class="No-Break"><span class="koboSpan" id="kobo.1457.1">several modifiers:</span></span><ul><li><span class="koboSpan" id="kobo.1458.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1459.1">opacity</span></strong><span class="koboSpan" id="kobo.1460.1"> modifier is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1461.1">0.5</span></strong><span class="koboSpan" id="kobo.1462.1">, making it </span><span class="No-Break"><span class="koboSpan" id="kobo.1463.1">partially transparent.</span></span></li><li><span class="koboSpan" id="kobo.1464.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1465.1">blur</span></strong><span class="koboSpan" id="kobo.1466.1"> modifier is set with a radius of </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1467.1">5</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1468.1"> pixels.</span></span></li><li><span class="koboSpan" id="kobo.1469.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1470.1">frame</span></strong><span class="koboSpan" id="kobo.1471.1"> modifier sets the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1472.1">width</span></strong><span class="koboSpan" id="kobo.1473.1"> property to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1474.1">600</span></strong><span class="koboSpan" id="kobo.1475.1"> pixels and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1476.1">height</span></strong><span class="koboSpan" id="kobo.1477.1"> to </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1478.1">500</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1479.1"> pixels.</span></span></li><li><span class="koboSpan" id="kobo.1480.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1481.1">scaleEffect</span></strong><span class="koboSpan" id="kobo.1482.1"> modifier is set with the </span><em class="italic"><span class="koboSpan" id="kobo.1483.1">x</span></em><span class="koboSpan" id="kobo.1484.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.1485.1">y</span></em><span class="koboSpan" id="kobo.1486.1"> scale values set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1487.1">scaleX</span></strong><span class="koboSpan" id="kobo.1488.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1489.1">scaleY</span></strong><span class="koboSpan" id="kobo.1490.1">, respectively. </span><span class="koboSpan" id="kobo.1490.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1491.1">anchor</span></strong><span class="koboSpan" id="kobo.1492.1"> parameter is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1493.1">.center</span></strong><span class="koboSpan" id="kobo.1494.1">, indicating that the scaling should be the center of </span><span class="No-Break"><span class="koboSpan" id="kobo.1495.1">the capsule.</span></span></li><li><span class="koboSpan" id="kobo.1496.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1497.1">animation</span></strong><span class="koboSpan" id="kobo.1498.1"> modifier has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1499.1">scaleX</span></strong><span class="koboSpan" id="kobo.1500.1"> value, with an </span><strong class="source-inline"><span class="koboSpan" id="kobo.1501.1">easeInOut</span></strong><span class="koboSpan" id="kobo.1502.1"> timing function and a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1503.1">duration</span></strong><span class="koboSpan" id="kobo.1504.1"> value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1505.1">8</span></strong><span class="koboSpan" id="kobo.1506.1"> seconds, and is set to repeat forever </span><span class="No-Break"><span class="koboSpan" id="kobo.1507.1">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1508.1">autoreverses</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1509.1">.</span></span></li></ul></li>
<li><span class="koboSpan" id="kobo.1510.1">Then,</span><strong class="source-inline"><span class="koboSpan" id="kobo.1511.1">.overlay()</span></strong><span class="koboSpan" id="kobo.1512.1"> is used to create a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.1513.1">Capsule</span></strong><span class="koboSpan" id="kobo.1514.1"> view that is placed on top of the previous one. </span><span class="koboSpan" id="kobo.1514.2">This new </span><strong class="source-inline"><span class="koboSpan" id="kobo.1515.1">Capsule</span></strong><span class="koboSpan" id="kobo.1516.1"> view is also modified with </span><span class="No-Break"><span class="koboSpan" id="kobo.1517.1">several modifiers:</span></span><ul><li><span class="koboSpan" id="kobo.1518.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1519.1">stroke</span></strong><span class="koboSpan" id="kobo.1520.1"> modifier adds a gray stroke with a line width of </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1521.1">5</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1522.1"> pixels.</span></span></li><li><span class="koboSpan" id="kobo.1523.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1524.1">opacity</span></strong><span class="koboSpan" id="kobo.1525.1"> modifier is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1526.1">0.5</span></strong><span class="koboSpan" id="kobo.1527.1">, making it </span><span class="No-Break"><span class="koboSpan" id="kobo.1528.1">partially transparent.</span></span></li><li><span class="koboSpan" id="kobo.1529.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1530.1">frame</span></strong><span class="koboSpan" id="kobo.1531.1"> modifier sets the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1532.1">width</span></strong><span class="koboSpan" id="kobo.1533.1"> property to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1534.1">350</span></strong><span class="koboSpan" id="kobo.1535.1"> pixels and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1536.1">height</span></strong><span class="koboSpan" id="kobo.1537.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1538.1">200</span></strong><span class="koboSpan" id="kobo.1539.1"> pixels. </span></li><li><span class="koboSpan" id="kobo.1540.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1541.1">offset</span></strong><span class="koboSpan" id="kobo.1542.1"> modifier shifts the capsule </span><span class="No-Break"><span class="koboSpan" id="kobo.1543.1">slightly upward.</span></span></li><li><span class="koboSpan" id="kobo.1544.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1545.1">scaleEffect</span></strong><span class="koboSpan" id="kobo.1546.1"> modifier sets the </span><em class="italic"><span class="koboSpan" id="kobo.1547.1">x</span></em><span class="koboSpan" id="kobo.1548.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.1549.1">y</span></em><span class="koboSpan" id="kobo.1550.1"> scale values, with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1551.1">scaleX</span></strong><span class="koboSpan" id="kobo.1552.1"> set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1553.1">+ 0.03</span></strong><span class="koboSpan" id="kobo.1554.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1555.1">scaleY</span></strong><span class="koboSpan" id="kobo.1556.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1557.1">+ 0.03</span></strong><span class="koboSpan" id="kobo.1558.1">, respectively. </span><span class="koboSpan" id="kobo.1558.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1559.1">anchor</span></strong><span class="koboSpan" id="kobo.1560.1"> parameter is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1561.1">.center</span></strong><span class="koboSpan" id="kobo.1562.1">, indicating that the scaling should be centered on </span><span class="No-Break"><span class="koboSpan" id="kobo.1563.1">the capsule.</span></span></li><li><span class="koboSpan" id="kobo.1564.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1565.1">animation</span></strong><span class="koboSpan" id="kobo.1566.1"> modifier has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1567.1">scaleY</span></strong><span class="koboSpan" id="kobo.1568.1"> value, with an </span><strong class="source-inline"><span class="koboSpan" id="kobo.1569.1">easeInOut</span></strong><span class="koboSpan" id="kobo.1570.1"> timing function and a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1571.1">duration</span></strong><span class="koboSpan" id="kobo.1572.1"> value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1573.1">8</span></strong><span class="koboSpan" id="kobo.1574.1"> seconds, and is set to repeat forever </span><span class="No-Break"><span class="koboSpan" id="kobo.1575.1">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1576.1">autoreverses</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1577.1">.</span></span></li><li><span class="koboSpan" id="kobo.1578.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1579.1">onAppear</span></strong><span class="koboSpan" id="kobo.1580.1"> modifier sets the initial value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1581.1">scaleX</span></strong><span class="koboSpan" id="kobo.1582.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1583.1">scaleY</span></strong><span class="koboSpan" id="kobo.1584.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1585.1">0.54</span></strong><span class="koboSpan" id="kobo.1586.1"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1587.1">0.6</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1588.1">, respectively.</span></span></li><li><span class="koboSpan" id="kobo.1589.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1590.1">rotation3DEffect</span></strong><span class="koboSpan" id="kobo.1591.1"> modifiers set an angle of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1592.1">81</span></strong><span class="koboSpan" id="kobo.1593.1"> degrees on </span><span class="No-Break"><span class="koboSpan" id="kobo.1594.1">the </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.1595.1">x</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.1596.1">-axis.</span></span></li></ul></li>
<li><span class="koboSpan" id="kobo.1597.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1598.1">ZStack</span></strong><span class="koboSpan" id="kobo.1599.1"> view is then modified with </span><strong class="source-inline"><span class="koboSpan" id="kobo.1600.1">.offset(x: -50, y: 300)</span></strong><span class="koboSpan" id="kobo.1601.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1602.1">.onAppear { scaleX = 0.55; scaleY = 0.6 }</span></strong><span class="koboSpan" id="kobo.1603.1">. </span><span class="koboSpan" id="kobo.1603.2">This shifts the group view 50 pixels to the left and 300 pixels downward. </span><span class="koboSpan" id="kobo.1603.3">This code block is executed when the view appears and sets the initial values of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1604.1">scaleX</span></strong><span class="koboSpan" id="kobo.1605.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1606.1">scaleY</span></strong><span class="koboSpan" id="kobo.1607.1"> to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1608.1">0.55</span></strong><span class="koboSpan" id="kobo.1609.1"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1610.1">0.6</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1611.1">, respectively.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1612.1">In summary, this code creates</span><a id="_idIndexMarker927"/><span class="koboSpan" id="kobo.1613.1"> a view that looks like a puddle of water by using a gradient fill that’s partially transparent and blurred, and with a ripple effect added. </span><span class="koboSpan" id="kobo.1613.2">The ripple effect is created by applying a scale effect to the second capsule view and animating the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1614.1">scaleX</span></strong><span class="koboSpan" id="kobo.1615.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.1616.1">scaleY</span></strong><span class="koboSpan" id="kobo.1617.1"> properties so that it appears to be moving. </span><span class="koboSpan" id="kobo.1617.2">The ripple effect is also rotated on the </span><em class="italic"><span class="koboSpan" id="kobo.1618.1">x</span></em><span class="koboSpan" id="kobo.1619.1">-axis to make it </span><span class="No-Break"><span class="koboSpan" id="kobo.1620.1">more interesting.</span></span></p>
<h2 id="_idParaDest-230"><a id="_idTextAnchor241"/><span class="koboSpan" id="kobo.1621.1">Putting it all together</span></h2>
<p><span class="koboSpan" id="kobo.1622.1">With </span><strong class="source-inline"><span class="koboSpan" id="kobo.1623.1">PuddleView</span></strong><span class="koboSpan" id="kobo.1624.1"> done, let’s just fill out </span><strong class="source-inline"><span class="koboSpan" id="kobo.1625.1">ContentView</span></strong><span class="koboSpan" id="kobo.1626.1"> and check</span><a id="_idIndexMarker928"/><span class="koboSpan" id="kobo.1627.1"> out the</span><a id="_idIndexMarker929"/><span class="koboSpan" id="kobo.1628.1"> animation. </span><span class="koboSpan" id="kobo.1628.2">Add the following code to </span><span class="No-Break"><span class="koboSpan" id="kobo.1629.1">modify </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1630.1">ContentView</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1631.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1632.1">
import SpriteKit
import SwiftUI
struct ContentView: View {
    var body: some View {
        ZStack {
            Image("street")
                   .resizable()
                   .scaledToFill()
            PuddleView()//.blendMode(.hardLight)
            RainView()
            DropView()
            RainView()
        }.edgesIgnoringSafeArea(.all)
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.1633.1">In </span><strong class="source-inline"><span class="koboSpan" id="kobo.1634.1">ContentView</span></strong><span class="koboSpan" id="kobo.1635.1">, we added an image of a street, resized and scaled it, then called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1636.1">PuddleView</span></strong><span class="koboSpan" id="kobo.1637.1">. </span><span class="koboSpan" id="kobo.1637.2">In </span><strong class="source-inline"><span class="koboSpan" id="kobo.1638.1">PuddleView</span></strong><span class="koboSpan" id="kobo.1639.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.1640.1">blendMode</span></strong><span class="koboSpan" id="kobo.1641.1"> is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1642.1">hardLight</span></strong><span class="koboSpan" id="kobo.1643.1">. </span><span class="koboSpan" id="kobo.1643.2">Play around with the blend mode options </span><a id="_idIndexMarker930"/><span class="koboSpan" id="kobo.1644.1">for different looks and effects, but I think the hard</span><a id="_idIndexMarker931"/><span class="koboSpan" id="kobo.1645.1"> light gives the best water effect so far, creating a glass-like look that is perfect for making a puddle of water where you can see some of the ground underneath. </span></p>
<p><span class="koboSpan" id="kobo.1646.1">Next, I called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1647.1">RainView</span></strong><span class="koboSpan" id="kobo.1648.1"> to add the rain, then </span><strong class="source-inline"><span class="koboSpan" id="kobo.1649.1">DropView</span></strong><span class="koboSpan" id="kobo.1650.1"> to add the collision effect of the raindrops hitting the ground, and then </span><strong class="source-inline"><span class="koboSpan" id="kobo.1651.1">Rainview</span></strong><span class="koboSpan" id="kobo.1652.1"> again just to add a little more rain to the mix. </span><span class="koboSpan" id="kobo.1652.2">This is </span><span class="No-Break"><span class="koboSpan" id="kobo.1653.1">the result:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer217">
<span class="koboSpan" id="kobo.1654.1"><img alt="Figure 15.13: The raindrops " src="image/B18674_15_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1655.1">Figure 15.13: The raindrops</span></p>
<p><span class="koboSpan" id="kobo.1656.1">This creates a nice effect</span><a id="_idIndexMarker932"/><span class="koboSpan" id="kobo.1657.1"> of raindrops colliding with the ground and even with</span><a id="_idIndexMarker933"/> <span class="No-Break"><span class="koboSpan" id="kobo.1658.1">the puddle.</span></span></p>
<p><span class="koboSpan" id="kobo.1659.1">Let’s continue and take a look at the </span><strong class="bold"><span class="koboSpan" id="kobo.1660.1">Magic</span></strong><span class="koboSpan" id="kobo.1661.1"> particle template and we will see how we can use an image to make </span><span class="No-Break"><span class="koboSpan" id="kobo.1662.1">the particles.</span></span></p>
<h1 id="_idParaDest-231"><a id="_idTextAnchor242"/><span class="koboSpan" id="kobo.1663.1">Animating a magic wand</span></h1>
<p><span class="koboSpan" id="kobo.1664.1">In this project, we’re going</span><a id="_idIndexMarker934"/><span class="koboSpan" id="kobo.1665.1"> to use the </span><strong class="bold"><span class="koboSpan" id="kobo.1666.1">Magic</span></strong><span class="koboSpan" id="kobo.1667.1"> particle system, and we will display that magic from the tip of a wand. </span><span class="koboSpan" id="kobo.1667.2">You will be able to move the wand around the screen with your finger, and as it moves, magic will emanate from its tip. </span><span class="koboSpan" id="kobo.1667.3">We will also have a cemetery background including a gravestone, and when you tap on the gravestone, a skeleton will rise up </span><span class="No-Break"><span class="koboSpan" id="kobo.1668.1">from it.</span></span></p>
<p><span class="koboSpan" id="kobo.1669.1">So, let’s get started with our spooky animation. </span><span class="koboSpan" id="kobo.1669.2">Create a new project and call this one </span><strong class="source-inline"><span class="koboSpan" id="kobo.1670.1">Magic</span></strong><span class="koboSpan" id="kobo.1671.1">. </span><span class="koboSpan" id="kobo.1671.2">Next, add the resources for this project by dragging them from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1672.1">Chapter 15</span></strong></span><span class="koboSpan" id="kobo.1673.1"> | </span><strong class="source-inline"><span class="koboSpan" id="kobo.1674.1">Magic</span></strong><span class="koboSpan" id="kobo.1675.1"> folder on GitHub into the Asset Catalog. </span><span class="koboSpan" id="kobo.1675.2">Then, we can make our </span><span class="No-Break"><span class="koboSpan" id="kobo.1676.1">particle file.</span></span></p>
<h2 id="_idParaDest-232"><a id="_idTextAnchor243"/><span class="koboSpan" id="kobo.1677.1">Creating the magic SpriteKit particle file</span></h2>
<p><span class="koboSpan" id="kobo.1678.1">As we’ve done before, create</span><a id="_idIndexMarker935"/><span class="koboSpan" id="kobo.1679.1"> a new SpriteKit particle file, but select the </span><strong class="bold"><span class="koboSpan" id="kobo.1680.1">Magic</span></strong><span class="koboSpan" id="kobo.1681.1"> particle template, and simply call the file </span><strong class="source-inline"><span class="koboSpan" id="kobo.1682.1">Magic</span></strong><span class="koboSpan" id="kobo.1683.1">. </span><span class="koboSpan" id="kobo.1683.2">Now, let’s do something a little different this time – using the </span><strong class="bold"><span class="koboSpan" id="kobo.1684.1">Texture</span></strong><span class="koboSpan" id="kobo.1685.1"> field in the </span><strong class="bold"><span class="koboSpan" id="kobo.1686.1">Attributes</span></strong><span class="koboSpan" id="kobo.1687.1"> panel, select the </span><strong class="bold"><span class="koboSpan" id="kobo.1688.1">star</span></strong><span class="koboSpan" id="kobo.1689.1"> image that you placed into the Asset Catalog. </span><span class="koboSpan" id="kobo.1689.2">We’re going to make the particle system based on that image, so all the particles will be stars. </span><span class="koboSpan" id="kobo.1689.3">Next, change the rest of the fields so the values look like </span><span class="No-Break"><span class="koboSpan" id="kobo.1690.1">the following:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer218">
<span class="koboSpan" id="kobo.1691.1"><img alt="Figure 15.14: The attributes of the magic animation " src="image/B18674_15_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1692.1">Figure 15.14: The attributes of the magic animation</span></p>
<p><span class="koboSpan" id="kobo.1693.1">Notice the </span><strong class="bold"><span class="koboSpan" id="kobo.1694.1">Color Ramp</span></strong><span class="koboSpan" id="kobo.1695.1"> field. </span><span class="koboSpan" id="kobo.1695.2">It has three colors</span><a id="_idIndexMarker936"/><span class="koboSpan" id="kobo.1696.1"> selected. </span><span class="koboSpan" id="kobo.1696.2">If you would like to select a color for the </span><strong class="bold"><span class="koboSpan" id="kobo.1697.1">Color Ramp</span></strong><span class="koboSpan" id="kobo.1698.1"> field, simply click anywhere along the color selector, and then a pop-up color box will come up allowing you to choose a color. </span><span class="koboSpan" id="kobo.1698.2">I’ve chosen three colors here: red will be the center of the animation, green will surround it, and the third color is yellow, which will be the outer part of the </span><span class="No-Break"><span class="koboSpan" id="kobo.1699.1">magic animation.</span></span></p>
<p><span class="koboSpan" id="kobo.1700.1">Next, we want to make this </span><strong class="source-inline"><span class="koboSpan" id="kobo.1701.1">Magic.sks</span></strong><span class="koboSpan" id="kobo.1702.1"> file available as a SwiftUI view. </span><span class="koboSpan" id="kobo.1702.2">So, let’s create a new Swift file, and call it </span><strong class="source-inline"><span class="koboSpan" id="kobo.1703.1">MagicView</span></strong><span class="koboSpan" id="kobo.1704.1">. </span><span class="koboSpan" id="kobo.1704.2">Then, add the following code to </span><span class="No-Break"><span class="koboSpan" id="kobo.1705.1">the file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1706.1">
import SwiftUI
import SpriteKit
struct MagicView: UIViewRepresentable {
    func makeUIView(context: 
      UIViewRepresentableContext&lt;MagicView&gt;) -&gt; SKView {
        let view = SKView(frame: CGRect(x: 0, y: 0, width: 
          400, height: 400))
        view.backgroundColor = .clear
        let scene = MagicScene(size: CGSize(width: 900, 
          height: 600))
        scene.backgroundColor = UIColor.clear
        scene.scaleMode = .aspectFill
        view.presentScene(scene)
        return view
    }
    func updateUIView(_ uiView: SKView, context: 
      UIViewRepresentableContext&lt;MagicView&gt;) {
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.1707.1">We’ve worked with this code in previous projects, so we’re familiar with it </span><span class="No-Break"><span class="koboSpan" id="kobo.1708.1">by now.</span></span></p>
<p><span class="koboSpan" id="kobo.1709.1">The code defines a struct called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1710.1">MagicView</span></strong><span class="koboSpan" id="kobo.1711.1">, which conforms to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1712.1">UIViewRepresentable</span></strong><span class="koboSpan" id="kobo.1713.1"> protocol in SwiftUI. </span><span class="koboSpan" id="kobo.1713.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1714.1">makeUIView</span></strong><span class="koboSpan" id="kobo.1715.1"> function creates an instance of an </span><strong class="source-inline"><span class="koboSpan" id="kobo.1716.1">SKView</span></strong><span class="koboSpan" id="kobo.1717.1"> with a given frame size and sets its background color </span><span class="No-Break"><span class="koboSpan" id="kobo.1718.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1719.1">clear</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1720.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1721.1">It then creates an instance</span><a id="_idIndexMarker937"/><span class="koboSpan" id="kobo.1722.1"> of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1723.1">MagicScene</span></strong><span class="koboSpan" id="kobo.1724.1">, specifying its size, setting its background color to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1725.1">clear</span></strong><span class="koboSpan" id="kobo.1726.1">, and scaling it to </span><strong class="source-inline"><span class="koboSpan" id="kobo.1727.1">aspectFill</span></strong><span class="koboSpan" id="kobo.1728.1">. </span><span class="koboSpan" id="kobo.1728.2">Finally, the created scene is presented on </span><strong class="source-inline"><span class="koboSpan" id="kobo.1729.1">SKView</span></strong><span class="koboSpan" id="kobo.1730.1">, and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1731.1">SKView</span></strong><span class="koboSpan" id="kobo.1732.1"> instance </span><span class="No-Break"><span class="koboSpan" id="kobo.1733.1">is returned.</span></span></p>
<p><span class="koboSpan" id="kobo.1734.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1735.1">updateUIView</span></strong><span class="koboSpan" id="kobo.1736.1"> function does not perform any actions for us, as we don’t need to update anything, but it is a required method for the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1737.1">UIViewRepresentable</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1738.1"> protocol.</span></span></p>
<p><span class="koboSpan" id="kobo.1739.1">Now, the code will give us an error because of this line: </span><strong class="source-inline"><span class="koboSpan" id="kobo.1740.1">let scene = MagicScene(size: CGSize(width: 900, height: 600))</span></strong><span class="koboSpan" id="kobo.1741.1">. </span><span class="koboSpan" id="kobo.1741.2">This is because we’re creating a scene and setting it to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1742.1">MagicScene</span></strong><span class="koboSpan" id="kobo.1743.1"> class, but we haven’t created a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1744.1">MagicScene</span></strong><span class="koboSpan" id="kobo.1745.1"> class yet. </span></p>
<p><span class="koboSpan" id="kobo.1746.1">So, let’s do that now. </span><span class="koboSpan" id="kobo.1746.2">Let’s create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1747.1">MagicScene</span></strong><span class="koboSpan" id="kobo.1748.1"> class, which will contain the  properties and functions we need to manipulate the magic coming from the wand, as well as making the skeleton rise up from the ground. </span><span class="koboSpan" id="kobo.1748.2">Create a new Swift file and call this </span><strong class="source-inline"><span class="koboSpan" id="kobo.1749.1">Magic</span></strong><span class="koboSpan" id="kobo.1750.1">. </span><span class="koboSpan" id="kobo.1750.2">I’m going to place all of the code here and then I’ll explain how </span><span class="No-Break"><span class="koboSpan" id="kobo.1751.1">it works:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1752.1">
import Foundation
import SwiftUI
import SpriteKit
class MagicScene: SKScene {
  var magic: SKEmitterNode!
</span><span class="koboSpan" id="kobo.1752.2">  var wand: SKSpriteNode!
</span><span class="koboSpan" id="kobo.1752.3">  override func touchesMoved(_ touches: Set&lt;UITouch&gt;, 
    with event: UIEvent?) {
      let touch = touches.first!
</span><span class="koboSpan" id="kobo.1752.4">      let touchLocation = touch.location(in: self)
      wand.position = CGPoint(x: touchLocation.x - 30, y: 
        touchLocation.y + wand.frame.size.height / 2 - 20)
      ///make the skeleton appear
      if touchLocation.x &lt; frame.size.width * 0.55 &amp;&amp; 
        touchLocation.y &lt; frame.size.height * 0.12 {
          let skeleton = SKSpriteNode(imageNamed: 
            "skeleton")
          skeleton.position = CGPoint(x: frame.size.width / 
            2 - 80, y: 175)
          skeleton.size = CGSize(width: skeleton.size.width 
            / 2, height: skeleton.size.height / 2)
          addChild(skeleton)
          let moveAction = SKAction.move(to: CGPoint(x: 
            frame.size.width / 2 - 50, y: frame.size.height 
            / 2), duration: 2.0)
          skeleton.run(moveAction)
      }
      wand.zPosition = 2
      let trail = SKEmitterNode(fileNamed: "Magic.sks")!
</span><span class="koboSpan" id="kobo.1752.5">      trail.particlePositionRange = CGVector(dx: 5, dy: 5)
      trail.particleSpeed = 50
      trail.position = CGPoint(x: wand.position.x - 40, y: 
        wand.position.y + wand.frame.size.height / 2 + 
        trail.particlePositionRange.dy)
      addChild(trail)
      let fadeAway = SKAction.fadeOut(withDuration: 1.2)
      trail.run(fadeAway) {
          trail.removeFromParent()
      }
  }
  override func didMove(to view: SKView) {
      let stone = SKSpriteNode(imageNamed: "stone")
      stone.position = CGPoint(x: frame.size.width / 2.3, 
        y: frame.size.height / 2 - 150)
      stone.size = CGSize(width: 120, height: 175)
      stone.zRotation = CGFloat(Double.pi / 20)
      stone.zPosition = 2
         addChild(stone)
      guard let magic = SKEmitterNode(fileNamed: 
        "Magic.sks") else { return }
      magic.particlePositionRange = CGVector(dx: 5, dy: 5)
      magic.particleSpeed = 50
      addChild(magic)
      self.magic = magic
      wand = SKSpriteNode(imageNamed: "wand")
      wand.position = CGPoint(x: frame.size.width / 2, y: 
        frame.size.height / 3)
      wand.size = CGSize(width: 80, height: 180)
      addChild(wand)
  }
}</span></pre>
<p><span class="koboSpan" id="kobo.1753.1">Okay, let’s break down</span><a id="_idIndexMarker938"/><span class="koboSpan" id="kobo.1754.1"> the code and see what it’s </span><span class="No-Break"><span class="koboSpan" id="kobo.1755.1">doing here.</span></span></p>
<p><span class="koboSpan" id="kobo.1756.1">Inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1757.1">MagicScene</span></strong><span class="koboSpan" id="kobo.1758.1"> class, there are two instance </span><span class="No-Break"><span class="koboSpan" id="kobo.1759.1">variables declared:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1760.1">magic</span></strong><span class="koboSpan" id="kobo.1761.1"> is an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1762.1">SKEmitterNode</span></strong><span class="koboSpan" id="kobo.1763.1">, which is a class from SpriteKit that represents an emitter that can create particles. </span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.1764.1">wand</span></strong><span class="koboSpan" id="kobo.1765.1"> is an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1766.1">SKSpriteNode</span></strong><span class="koboSpan" id="kobo.1767.1">, which is a class from SpriteKit that represents a </span><span class="No-Break"><span class="koboSpan" id="kobo.1768.1">textured rectangle.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1769.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1770.1">MagicScene</span></strong><span class="koboSpan" id="kobo.1771.1"> class overrides two methods </span><span class="No-Break"><span class="koboSpan" id="kobo.1772.1">from </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1773.1">SKScene</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1774.1">:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1775.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1776.1">touchesMoved(_:with:)</span></strong><span class="koboSpan" id="kobo.1777.1"> method is called when the user moves their finger across the screen. </span><span class="koboSpan" id="kobo.1777.2">Inside this method, the position of the wand sprite is updated to follow the user’s touch location. </span><span class="koboSpan" id="kobo.1777.3">If the touch location is in a specific area of the screen, a skeleton sprite is created and animated to move to a specific location on the screen, straight up. </span><span class="koboSpan" id="kobo.1777.4">Then, a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.1778.1">SKEmitterNode</span></strong><span class="koboSpan" id="kobo.1779.1"> instance is created and added as a child of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1780.1">MagicScene</span></strong><span class="koboSpan" id="kobo.1781.1"> instance. </span><span class="koboSpan" id="kobo.1781.2">This emitter is positioned relative to the wand sprite and emits particles that we created in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1782.1">.sks</span></strong><span class="koboSpan" id="kobo.1783.1"> file, and simulates the magic. </span><span class="koboSpan" id="kobo.1783.2">After a duration of 1.2 seconds, the emitter fades away and is removed from </span><span class="No-Break"><span class="koboSpan" id="kobo.1784.1">the scene.</span></span></li>
<li><span class="koboSpan" id="kobo.1785.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.1786.1">didMove(to:)</span></strong><span class="koboSpan" id="kobo.1787.1"> method is called once when the scene is first presented. </span><span class="koboSpan" id="kobo.1787.2">Inside this method, a stone sprite is created and positioned on the screen. </span><span class="koboSpan" id="kobo.1787.3">Then, an </span><strong class="source-inline"><span class="koboSpan" id="kobo.1788.1">SKEmitterNode</span></strong><span class="koboSpan" id="kobo.1789.1"> instance is created and added as a child of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1790.1">MagicScene</span></strong><span class="koboSpan" id="kobo.1791.1"> instance. </span><span class="koboSpan" id="kobo.1791.2">This emitter will also simulate magic particles. </span><span class="koboSpan" id="kobo.1791.3">Finally, a wand sprite is created and positioned on </span><span class="No-Break"><span class="koboSpan" id="kobo.1792.1">the screen.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1793.1">That completes the code for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1794.1">magic.sks</span></strong><span class="koboSpan" id="kobo.1795.1"> file. </span><span class="koboSpan" id="kobo.1795.2">Let’s continue and head into </span><strong class="source-inline"><span class="koboSpan" id="kobo.1796.1">ContentView</span></strong><span class="koboSpan" id="kobo.1797.1"> and add a little bit of code there so we can see the magic. </span><span class="koboSpan" id="kobo.1797.2">All we need to do is add the graveyard background scene and call </span><strong class="source-inline"><span class="koboSpan" id="kobo.1798.1">MagicView</span></strong><span class="koboSpan" id="kobo.1799.1">. </span><span class="koboSpan" id="kobo.1799.2">To do this, change your </span><strong class="source-inline"><span class="koboSpan" id="kobo.1800.1">ContentView</span></strong><span class="koboSpan" id="kobo.1801.1"> to </span><span class="No-Break"><span class="koboSpan" id="kobo.1802.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1803.1">
struct ContentView: View {
    var body: some View {
    ZStack {
        Image("graveyard")
            .resizable()
            .scaledToFill().frame(width: 500, height: 900)
        MagicView()
      }
  }
}</span></pre>
<p><span class="koboSpan" id="kobo.1804.1">With that bit of code, the project</span><a id="_idIndexMarker939"/><span class="koboSpan" id="kobo.1805.1"> is done. </span><span class="koboSpan" id="kobo.1805.2">Run the animation and start </span><a id="_idIndexMarker940"/><span class="No-Break"><span class="koboSpan" id="kobo.1806.1">making magic:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer219">
<span class="koboSpan" id="kobo.1807.1"><img alt="Figure 15.15: The magic wand and graveyard scene " src="image/B18674_15_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1808.1">Figure 15.15: The magic wand and graveyard scene</span></p>
<p><span class="koboSpan" id="kobo.1809.1">Move the wand around and see the magic coming out of its tip, then tap on the gravestone to wake </span><span class="No-Break"><span class="koboSpan" id="kobo.1810.1">the skeleton!</span></span></p>
<h1 id="_idParaDest-233"><a id="_idTextAnchor244"/><span class="koboSpan" id="kobo.1811.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.1812.1">With SpriteKit’s extensive support for physics and particle systems, combined with SwiftUI’s easy-to-use interface and modern design capabilities, you can create dynamic, engaging animations that bring your apps to life. </span><span class="koboSpan" id="kobo.1812.2">As we have seen here, you can create smoke, rain, fire, snow, and magic, but there are even more particle systems to try and </span><span class="No-Break"><span class="koboSpan" id="kobo.1813.1">experiment with.</span></span></p>
<p><span class="koboSpan" id="kobo.1814.1">As always, alter each project to your liking, and add your own unique creativity and ideas. </span><span class="koboSpan" id="kobo.1814.2">Add sound to various parts of each project if you want – for example, in the magic wand project, maybe when the wand is moving, play a wand sound effect. </span><span class="koboSpan" id="kobo.1814.3">Enhance the animations by altering the values, changing the images, or building out more complex scenes using the tools you now have. </span><span class="koboSpan" id="kobo.1814.4">Just have fun because the effects are only limited by </span><span class="No-Break"><span class="koboSpan" id="kobo.1815.1">your imagination.</span></span></p>
<p><span class="koboSpan" id="kobo.1816.1">And with that, we have completed the final projects, and also the </span><span class="No-Break"><span class="koboSpan" id="kobo.1817.1">final chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.1818.1">Throughout the book, we delved into both implicit and explicit animations, exploring the differences between them and how to use them to achieve different effects. </span><span class="koboSpan" id="kobo.1818.2">As we progressed through the book, we gradually introduced different modifiers and more challenging animation techniques, from basic bounces to more advanced moves. </span><span class="koboSpan" id="kobo.1818.3">We also built two complete games that you can modify in many </span><span class="No-Break"><span class="koboSpan" id="kobo.1819.1">different ways.</span></span></p>
<p><span class="koboSpan" id="kobo.1820.1">You now have the knowledge, skills, and a deeper understanding of SwiftUI animations to be able to implement a wide range of effects that will take your app to the next level and create engaging and dynamic </span><span class="No-Break"><span class="koboSpan" id="kobo.1821.1">user experiences.</span></span></p>
<p><span class="No-Break"><span class="koboSpan" id="kobo.1822.1">Happy animating!</span></span></p>
</div>
<div>
<div class="IMG---Figure" id="_idContainer221">
</div>
</div>
</body></html>