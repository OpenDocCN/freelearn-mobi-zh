<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch10"/>Chapter 10. Getting Ready for the App Store</h1></div></div></div><p>
<em>"There are two kinds of people, those who finish what they start and so on."</em>
</p><p>
<em>Robert Byrne</em>
</p><p>We have come a long way in learning RubyMotion to create iOS applications. Hopefully, we are now proficient in developing applications with RubyMotion. So far, we have gone from creating a simple iOS application to including the amazing device capabilities of iPhone and iPad with our RubyMotion project and then creating games. In the previous chapter, we learned how to write test cases and test our application automatically. We have now covered all the parts of a software life cycle, except our app is not in production yet. Apple has a specific way to share your finished app with the world. In this chapter, we will cover setting up your Mac to create your application bundle, to share it, and to distribute your application over the <a id="id535" class="indexterm"/>Apple App Store.</p><p>In this chapter, we will cover the following topics:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Generating certificates</li><li class="listitem" style="list-style-type: disc">Provisioning portals</li><li class="listitem" style="list-style-type: disc">Setting up a RubyMotion project</li><li class="listitem" style="list-style-type: disc">Testing on a device</li><li class="listitem" style="list-style-type: disc">iTunes Connect</li><li class="listitem" style="list-style-type: disc">Bundles for submission</li></ul></div><p>Before you begin setting up your Mac for app distribution, you are required to enroll into the Apple Developer Program for iOS development<a id="id536" class="indexterm"/> (<a class="ulink" href="https://developer.apple.com">https://developer.apple.com</a>). It is compulsory to enroll into this program, otherwise you will not be able to submit your application build to the App Store. Apple reviews each and every application before it is released to the App Store. You should also have a look at the Apple review guidelines, available at the iOS Dev Center, once you have your membership. These guidelines are important to understand for the smooth approval of your app; we will cover most of them as we proceed, but do go through them yourself too. These guidelines also contain <strong>Human Interface Guidelines</strong> (<strong>HIG</strong>); <a id="id537" class="indexterm"/>many consider these guidelines as Apple's way of having a controlled environment for developers, but the prime purpose of these instructions is to create applications of a set standard and make them a class apart from other smartphones. So far, Apple has been successful in maintaining their good standard.</p><p>You should also set up your profile for your apps at <a class="ulink" href="https://itunesconnect.apple.com/">https://itunesconnect.apple.com/</a>; we will discuss more about this later in the chapter.</p><div><div><div><div><h1 class="title"><a id="ch10lvl1sec54"/>Generating certificates</h1></div></div></div><p>To submit your application to the App Store, you require a developer certificate, a distribution certificate,<a id="id538" class="indexterm"/> a developer provisioning profile, and a distribution provisioning profile. In this section, we will bind your Mac with your iOS provisioning portal by generating certificates.</p><p>Once you log in to <a class="ulink" href="https://developer.apple.com">https://developer.apple.com</a>, choose the iOS provisioning portal. Select the <strong>Certificates</strong> tab from the options provided in the left-hand side column as shown in the following screenshot:</p><div><img src="img/5220OT_10_01.jpg" alt="Generating certificates"/></div><p>If you are a first-time user, you need to first install the <strong>Worldwide Developer Relations</strong>
<a id="id539" class="indexterm"/> (<strong>WWDR</strong>) intermediate certificate; this certificate binds your developer and distribution certificate to the Apple Certificate Authority. Download this and it will be installed in your keychain.</p><p>Next, let's create our developer certificate. To generate this, let's go back to our keychain application and navigate to <strong>KeyChain Access Menu</strong> | <strong>Certificate Assistant</strong> | <strong>Request a certificate from certificate authority</strong>.</p><div><img src="img/5220OT_10_02.jpg" alt="Generating certificates"/></div><p>Here, you have to use the same e-mail address with which you had registered for your developer account. <a id="id540" class="indexterm"/>We must add a unique name for this certificate and save it to the disk.</p><p>Now, let's go back to our developer account in our browser. Inside the <strong>Development</strong> tab, we have a <strong>Request Certificate</strong> option<a id="id541" class="indexterm"/> that shows all of the instructions that we have already completed and that are ready for our certificate.</p><p>Once uploaded, you will see <strong>Pending Issuance</strong>. Not a problem; refresh your browser, and your certificate will be uploaded. Download this and run; it will get stored in your keychain. Similarly, follow the same procedure for the distribution certificate.</p><p>Inside your keychain, in the certificate section you will see all of the installed certificates. Every certificate is a combination of two things: a certificate and a private key. It's good practice to make a copy of it and keep it in a safe place. In this way, if you change your machine, you will easily be able to download the certificate; but it will not work without the private key.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec69"/>Do it yourself</h2></div></div></div><p>Just like the developer profile for developing and testing in a development environment, we have a distribution <a id="id542" class="indexterm"/>profile that is used for distributing our application on the App Store.</p><p>Now that you know how to generate, upload, and install the Apple certificate on your Mac machine for your developer profile, why not try it yourself and distribute the profile. All you have to do is just follow these steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Generate the certificate using Certificate Assistant.</li><li class="listitem">Upload it on the <strong>Distribution certificate</strong> tab.</li><li class="listitem">Install it on your machine.</li></ol></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec55"/>Provisioning profile</h1></div></div></div><p>A provisioning profile binds numerous digital objects, such as our applications, certificates, and devices, together. <a id="id543" class="indexterm"/>A provisioning profile has two parts: one is our development provisioning profile and the other is the distribution profile.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec70"/>App ID</h2></div></div></div><p>Before we create a new <a id="id544" class="indexterm"/>provisioning profile, let's first create an app ID for our application. Inside the provisioning portal, we have a section for creating the app ID.<a id="id545" class="indexterm"/> It is necessary to create a new app ID for every application. This app ID is then used while generating a new provisioning profile.</p><div><img src="img/5220OT_10_03.jpg" alt="App ID"/></div><p>First, we add the description; this is how we will recognize our app ID in our provisioning portal. <a id="id546" class="indexterm"/>Next, we add a seed ID. (For first-time users, you will get an option to generate a new one.) Lastly, we add a bundle identifier. We are going to use this bundle identifier in the <code class="literal">Rakefile</code> of our RubyMotion project later on. The general nomenclature of naming a bundle identifier is the reverse domain notation, where <strong>com</strong> is followed by the domain name. In our case I have used <strong>packtpub</strong>, but you should add your domain name here. In the last part of the bundle identifier, add your application's name; in this case, we will use <strong>Restroapp</strong><a id="id547" class="indexterm"/>.</p><div><div><h3 class="title"><a id="note38"/>Note</h3><p>A bundle identifier is used to distinguish between various applications. We can use <code class="literal">com.domainname.*</code> for this purpose. An asterisk (<code class="literal">*</code>) symbol lets us use the same identifier for multiple apps. But we recommend naming your application for every identifier.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec71"/>Adding devices</h2></div></div></div><p>For development and testing purposes, we need to add our iOS devices in the <strong>Devices</strong> section of the application. Inside <a id="id548" class="indexterm"/>the <strong>Devices</strong> section, click on <strong>Add Devices</strong> as shown in the following screenshot:</p><div><img src="img/5220OT_10_04.jpg" alt="Adding devices"/></div><p>To test your application on your iPhone or iPad, simply add the UDID number of your device and a device name of your choice. The UDID number can be seen in iTunes. When you click on the iPhone name, it will show you a 40-digit sequence:</p><div><img src="img/5220OT_10_05.jpg" alt="Adding devices"/></div><p>You must add all of the devices you want to test on, which we will be using during development. If the devices you want to test on are not present, the application won't be installed on that device.</p><div><div><h3 class="title"><a id="note39"/>Note</h3><p>Apple allows you to add up to 100 iOS devices; this is strictly for development and testing purposes only.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec72"/>Developer Provisioning Profile</h2></div></div></div><p>Now that we have everything in place to create a new provisioning profile, let's do it by choosing<a id="id549" class="indexterm"/> the <strong>Provisioning</strong> option. The <strong>Create new developer profile</strong> form<a id="id550" class="indexterm"/> is divided into the following four sections:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Profile Name</strong>: This is a label to recognize the profile.</li><li class="listitem" style="list-style-type: disc"><strong>Certificates</strong>: Choose the developer certificate you have installed on your system. If it is a one-man workshop like mine, you will see only one option.</li><li class="listitem" style="list-style-type: disc"><strong>App ID</strong>: Select the one we had created from the previous section for this application.</li><li class="listitem" style="list-style-type: disc"><strong>Devices</strong>: These are the devices you want to test on.<div><img src="img/5220OT_10_06.jpg" alt="Developer Provisioning Profile"/></div></li></ul></div><p>Once you submit this, you will see a pending status. Refresh your browser, and your provisioning profile will be ready. Download it and click on the file, and it will get installed in your Xcode. You can access all of the information related to this provisioning profile by navigating to <strong>Xcode</strong> | <strong>Organiser</strong> | <strong>Provisioning Profiles</strong> | <strong>Devices</strong>.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec73"/>Do it yourself</h2></div></div></div><p>Now that you know<a id="id551" class="indexterm"/> how to create a developer provisioning profile, why don't you try creating the distribution profile for yourself by performing the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Open the <strong>Distribution</strong> tab in the <strong>Provisioning</strong> section.</li><li class="listitem">Create a new profile.</li><li class="listitem">Download and install the profile.</li></ol></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec56"/>Setting up the RubyMotion project</h1></div></div></div><p>Next, let's set up our RubyMotion project; it will include the information we have collected previously.</p><div><div><div><div><h2 class="title"><a id="ch10lvl2sec74"/>Entitlements</h2></div></div></div><p>Entitlements are used<a id="id552" class="indexterm"/> during the code-signing part of the build process. Many applications require access to device features; Apple requires you to specify the entitlements if you want to access a specific device feature. This can be added in the <code class="literal">Rakefile</code>. The entitlement method in the <code class="literal">Rakefile</code> lets you specify the appropriate keys and values in the following way:</p><div><pre class="programlisting">Motion::Project::App.setup do |app|
  # ...
  app.entitlements['keychain-access-groups'] = [
    app.seed_id + '.' + app.identifier
  ]
end</pre></div><p>In this example, if your application requires access to a keychain to store user credentials, you must send a request for <code class="literal">keychain-access-groups</code> by passing the application provisioning identifier and application identifier along with <code class="literal">seed_id</code> and the app identifier.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec75"/>Info.plist settings</h2></div></div></div><p>To provide the best experience to the users, iOS expects the presence of meta information in each application. This<a id="id553" class="indexterm"/> information is then used in various ways. Some of it is displayed to users and some may be used internally by the system to identify the application. These configuration settings are defined in <code class="literal">Info.plist</code>, <a id="id554" class="indexterm"/>which resides in the application's bundle.</p><p>In a RubyMotion project, the <code class="literal">Info.plist</code> file is defined in the <code class="literal">Rakefile</code> in a hash-like structure where you have a<a id="id555" class="indexterm"/> key-value pair. For example, we define <code class="literal">CFBundleURLTypes</code> in the following example:</p><div><pre class="programlisting">Motion::Project::App.setup do |app|
  # ...
  app.info_plist['CFBundleURLTypes'] = [
    { 'CFBundleURLName' =&gt; 'com.packtpub.restroapp'}
    
  ]
end</pre></div><p>The <code class="literal">Rakefile</code> does not cover all the possible settings, but it reveals the internal <code class="literal">Info.plist</code> data structure that one can modify, if at all needed. For more information and to check a list of other <code class="literal">Info.plist</code> properties, you can visit the Apple developer reference at <a class="ulink" href="http://developer.apple.com/library/ios/#documentation/General/Reference/InfoPlistKeyReference/Introduction/Introduction.html">http://developer.apple.com/library/ios/#documentation/General/Reference/InfoPlistKeyReference/Introduction/Introduction.html</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec76"/>Building icons</h2></div></div></div><p>Now that our machine is set up for the App Store, let's set up our RubyMotion project too. The first thing to do here is to set build icons. Since iOS devices, such as the iPhone, iPad, iPad mini, and retina <a id="id556" class="indexterm"/>displays come in a variety of screen sizes and display resolutions, Apple provides specific guidelines for creating icons to cater to each of them.</p><p>For our application icons, simply add these icons in the <code class="literal">resources</code> folder. They can have any random name, but it is a good idea to name them descriptively according to what they represent, such as <code class="literal">icon_name-114</code> or <code class="literal">icon-1024</code>. Here, <code class="literal">114</code> and <code class="literal">1024</code> represent the size 114 x 114 for a standard app icon and 1024 x 1024 for an App Store icon, respectively.</p><p>Next, add the <code class="literal">icon</code> attribute in your <code class="literal">Rakefile</code> in the following way:</p><div><pre class="programlisting">Motion::Project::App.setup do |app|
  # Use `rake config' to see complete project settings.
  app.name = 'Restaurant Application'
  app.icons  =  ['icon-114.png']
end</pre></div><p>By default, these icons have a glossy effect on the upper half of the image, which is the traditional iPhone style. But you can change this by adding the following lines in your <code class="literal">Rakefile</code>:</p><div><pre class="programlisting">Motion::Project::App.setup do |app|
  # Use `rake config' to see complete project settings.
  app.name = 'Restaurant Application'
  app.icons  =  ['icon-114.png']
  app.prerendered_icon = true
end</pre></div><p>That's it. Our Ruby<a id="id557" class="indexterm"/>Motion application is now ready with icons. Some tips for designing great icons are as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For best results, enlist the help of a professional graphic designer</li><li class="listitem" style="list-style-type: disc">Use universal imagery that people will easily recognize</li><li class="listitem" style="list-style-type: disc">Embrace simplicity</li><li class="listitem" style="list-style-type: disc">The richer the icons are in texture, the better they are to look at</li><li class="listitem" style="list-style-type: disc">Make the icons more detailed and more realistic</li><li class="listitem" style="list-style-type: disc">Add detail and depth</li></ul></div><p>As icons provide the first impression of your application, you must work extensively to ensure they look good. You can find more information related to icons and designs on the Apple developer reference at <a class="ulink" href="http://developer.apple.com/library/ios/#documentation/userexperience/conceptual/mobilehig/IconsImages/IconsImages.html">http://developer.apple.com/library/ios/#documentation/userexperience/conceptual/mobilehig/IconsImages/IconsImages.html</a>.</p><p>Besides icons, we can have other resources, such as images and sound files. These can be included in the <code class="literal">resources</code> folder, and instances of these can be used throughout our application. For example, we can create the instance of the <code class="literal">hello.png</code> image with <code class="literal">UIImage.imageNamed("hello")</code>.</p></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec77"/>Configuring your application</h2></div></div></div><p>Before we create the package that will be uploaded to the App Store review, we need to add some configuration settings so<a id="id558" class="indexterm"/> that Apple can recognize that the application is from a registered source. Here we will use the information from our provisioning profile, plus some general information related to our application.</p><p>All these settings, once again, go into our <code class="literal">Rakefile</code>. Some of the required settings that need to be fed are our iOS SDK version that we are using and our application version, such as 1.0, 1.3, and 2.0, which is always incremented for future releases. The deployment target is a minimal iOS version on which we want to run our application or anything that will work fine with our application. We also need to specify our identifier and provisioning profile <a id="id559" class="indexterm"/>details. This will be clear with the following example:</p><div><pre class="programlisting">Motion::Project::App.setup do |app|
app.sdk_version = "6.0"
app.deployment_target = "5.0"
app.version = "1.0"
app.identifier = "com.packtpub.restroapp"
app.provisiong_profile = "/Users/your_name/Provisioning_Profiles/random_sequence.mobileprovision"
end</pre></div><div><div><h3 class="title"><a id="note40"/>Note</h3><p>The provisioning profile details are different for development and distribution. Distribution profile details are used only when we want to submit or test apps on many devices.</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec78"/>Installing on a device</h2></div></div></div><p>It's a good idea to test your application before you submit it to the App Store. Now that all our settings are in place,<a id="id560" class="indexterm"/> we just need to run the <code class="literal">rake device</code> command from the console. Before doing so, make sure your registered device in the provisioning portal is connected via USB to your Mac machine. The process may fail for any of the following reasons:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The registered device is not connected to your machine via a USB</li><li class="listitem" style="list-style-type: disc">An incorrect identifier or provisioning profile's details have been added</li><li class="listitem" style="list-style-type: disc">The project uses an incorrect iOS version that is running on the device</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch10lvl2sec79"/>iTunes Connect</h2></div></div></div><p>Now we are done; but just before <a id="id561" class="indexterm"/>we create our application bundle and upload it, we need to set up our application on a separate portal (<a class="ulink" href="https://itunesconnect.apple.com">https://itunesconnect.apple.com</a>). <strong>iTunes Connect</strong>
<a id="id562" class="indexterm"/> has many options related to your application, such as <strong>Sales and Trends</strong>, <strong>Catalog Reports</strong>, <strong>Developer Forums</strong>, <strong>Payments</strong>, <strong>Manage Your Application</strong>, <strong>Manage Users</strong>, and many more. But, for now, we are just interested in the <strong>Manage Your Application</strong> option:</p><div><img src="img/5220OT_10_07.jpg" alt="iTunes Connect"/></div><p>Once you have <a id="id563" class="indexterm"/>chosen <strong>Manage Your Applications</strong>, click on the button to add a new application to your catalog. This will show you the following form:</p><div><img src="img/5220OT_10_08.jpg" alt="iTunes Connect"/></div><p>Enter your application's name in the <strong>App Name</strong> textbox. The SKU number is a desired, unique alphanumeric sequence that you have to enter. Select a <strong>Bundle ID</strong> option from the drop-down menu; since <a id="id564" class="indexterm"/>your iTunes Connect profile is coupled with your provisioning portal, you will get the right options in the dropdown automatically.</p><p>Once submitted, you will get the option of when to release the application, choosing the price tier (free or paid), and choosing which App Store will sell the application based on various countries. Following this window, another form will appear where you will have to fill in the description of your application, upload snapshots of various devices, add icons for the App Store, and fill in other logistic details, such as who to contact for support in case there are some issues related to the application.</p><p>Now that our application has been set up on iTunes Connect, we will next learn how to push our app for the App Store review.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec57"/>Creating bundles for submission</h1></div></div></div><p>The <code class="literal">rake archive</code> command<a id="id565" class="indexterm"/> generates a <code class="literal">.ipa</code> archive. This package is used for submitting our application to the App Store. The archive package can also be used for ad-hoc distribution to test the application on distributed devices.</p><p>Once we run the <code class="literal">rake archive</code> command, we will get the binary along with their appropriate distribution certificates. This is then uploaded on iTunes Connect with a special Apple utility named <a id="id566" class="indexterm"/>
<strong>Application Loader</strong>.</p><p>With the Xcode installation, we automatically get the <strong>Application Loaded</strong> utility that we can access from our application's folder or access by simply making a spotlight search:</p><div><img src="img/5220OT_10_09.jpg" alt="Creating bundles for submission"/></div><p>Choose the <a id="id567" class="indexterm"/>
<strong>Deliver Your App</strong> option; this will indicate the name of the application iTunes Connect is waiting to upload. Choose your <code class="literal">.ipa</code> package from <code class="literal">./build/iPhoneOs_sdk_verson/Release/your_application.ipa</code>. Once this is done, you will see that the status of iTunes Connect has changed to <strong>Received Binary</strong>.</p><p>Great! Finally, we <a id="id568" class="indexterm"/>have submitted our application to the App Store. The Apple App Store takes a few days to review your application; you will see the status of your application change from <strong>Waiting for Review</strong> to <strong>In Review</strong> after a few days. In case there are any issues related to your application, the Apple team will first contact you using the details provided in iTunes Connect; and if the problem is not resolved, the application will get rejected. If this happens, you can resolve the issues faced by the review team and resubmit the app.</p></div>
<div><div><div><div><h1 class="title"><a id="ch10lvl1sec58"/>Summary</h1></div></div></div><p>This chapter has covered the last step of an iOS application's life cycle. Let's recap what we have learned:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">How to generate certificates</li><li class="listitem" style="list-style-type: disc">How to use the provisioning portal</li><li class="listitem" style="list-style-type: disc">How to set up a RubyMotion project</li><li class="listitem" style="list-style-type: disc">How to test on a device</li><li class="listitem" style="list-style-type: disc">How to use iTunes Connect</li><li class="listitem" style="list-style-type: disc">How to create bundles for submission</li></ul></div><p>With this chapter, we have almost come to the end of our journey of learning how to use and craft iOS applications with RubyMotion. But this is just the tip of the iceberg. We still have to explore so many iOS SDK APIs to make the applications we have dreamt of. RubyMotion makes even this part stress-free with the use of gems. In the final chapter, we will learn how to use some of the most popular RubyMotion gems, and how to contribute back to the RubyMotion community by creating our own gems.</p></div></body></html>