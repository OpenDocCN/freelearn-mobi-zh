<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch11"/>Chapter 11. Integrating Third-party Services</h1></div></div></div><p>
<em>In the previous chapter, we polished our game by adding additional scenes and ironing out some of the quirks. After a game is over, it can now be restarted. Now that our game is pretty much finished, we need to apply some finishing touches, which will not influence the game directly, but its distribution and the experience the player has. If the user wants to play with their friends, we wouldn't need to implement a server and the networking mechanics by ourselves. There are services that take care of these problems; one of them is Apple Game Center.</em>
</p><p>In this chapter, we will integrate third-party services into our game. The following are the topics we will cover in this chapter:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Getting the word out to potential testers</li><li class="listitem" style="list-style-type: disc">The basic Game Center integration</li><li class="listitem" style="list-style-type: disc">Showing different platforms for analytics</li></ul></div><div><div><div><div><h1 class="title"><a id="ch11lvl1sec127"/>Getting word out to potential testers</h1></div></div></div><p>Distributing to potential testers can be a daunting task. First, we would need to get the <strong>Unique Device Identifier</strong> (<strong>UDID</strong>) of each and every test device. We would then need to compile a<a id="id483" class="indexterm"/> special build that is restricted to only run on the devices whose UDID we provide in the provisioning profile used in the build. We would then need to send this special build to these testers, which they need to install using iTunes. After the beta testers have installed the application, we don't have any<a id="id484" class="indexterm"/> insight on how long they actually used the application and if the application crashes, they need to sync their device with iTunes and search for the crash report on the hard drive and send it to the developer. It's much better for the application to crash in the hand of beta testers than in the hands of actual customers.</p><p>For a long<a id="id485" class="indexterm"/> time, <strong>TestFlight</strong> has provided an easy solution for both collecting UDIDs and installing apps on your tester's devices. TestFlight provides an application for mobile devices that directly installs the application on the device instead of the user manually having to do so. TestFlight also has a web application that manages all of the devices, collects crash reports, and tracks the session.</p><p>The company<a id="id486" class="indexterm"/> behind TestFlight was acquired by Apple in February 2014, the result of which is that their SDK isn't allowed to be integrated into applications any more. The distribution component of TestFlight is still available for the time being.</p><p>
<strong>Ubertesters</strong> is a <a id="id487" class="indexterm"/>very similar service that helps us to collect UDIDs of devices and helps testers to use our application. At the time of writing this book, Ubertesters is still in beta. While Ubertesters is a paid service, they do provide a free plan which only requires registering an account with them. The following is a screenshot of the Ubertesters website:</p><div><img src="img/1509OS_11_01.jpg" alt="Getting word out to potential testers"/></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec145"/>Registering at Ubertesters</h2></div></div></div><p>In <a id="id488" class="indexterm"/>order to distribute our game with Ubertesters, we first <a id="id489" class="indexterm"/>need to register an account at <a class="ulink" href="http://beta.ubertesters.com/sign_up">http://beta.ubertesters.com/sign_up</a>. Enter all the necessary data in the input fields.</p><p>We then need to create our own organization, where we can add our first application. Ubertesters guides us through this process when we register for the first time.</p><p>Let's call our application "Pirate Game" and choose iOS as its platform. Now, we are going to add our own devices; this is as simple as opening the URL <a class="ulink" href="http://beta.ubertesters.com">http://beta.ubertesters.com</a> in our mobile Safari browser following the instructions on the screen. This installs the Ubertesters app on our device and collects the UDID of the device.</p><p>After this, we<a id="id490" class="indexterm"/> see the device we just registered on the Ubertesters web interface where we get relevant data of the device such as the device name, its model, operating system, screen resolution, its locale, and the UDID.</p><p>It is also possible to set up over-the-air distribution, which means allowing testers to download the build from your site. Instructions for this setup can be found at this link: <a class="ulink" href="http://aaronparecki.com/articles/2011/01/21/1/how-to-distribute-your-ios-apps-over-the-air">http://aaronparecki.com/articles/2011/01/21/1/how-to-distribute-your-ios-apps-over-the-air</a>.</p><div><div><div><div><h3 class="title"><a id="ch11lvl3sec12"/>Integrating Ubertesters</h3></div></div></div><p>Before we can get some beta testers, we need to integrate the Ubertesters SDK into our game. Only packages with the SDK integrated can be made available for testers.</p></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec128"/>Time for action – integrating Ubertesters</h1></div></div></div><p>Use the<a id="id491" class="indexterm"/> following steps to integrate Ubertesters:</p><div><ol class="orderedlist arabic"><li class="listitem">Open our Xcode project if it's not already open.</li><li class="listitem">Download<a id="id492" class="indexterm"/> the Ubertesters SDK from <a class="ulink" href="http://ubertesters.com/sdk/ubertesters.sdk.ios.zip">http://ubertesters.com/sdk/ubertesters.sdk.ios.zip</a>.</li><li class="listitem">Extract the contents from the downloaded file somewhere on the hard drive.</li><li class="listitem">Drag the extracted contents into the project file. They should be at the root level right at the same level as <strong>Products</strong>, <strong>Frameworks</strong>, and <strong>Resources</strong>.</li><li class="listitem">Switch to the project configuration by clicking on the project's name in the project navigator. Inside the <strong>General</strong> tab, scroll down to <strong>Linked Frameworks and Libraries</strong>.</li><li class="listitem">Add the following libraries by clicking on the plus button, selecting the correct library, and clicking on <strong>Add</strong>:<div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">AdSupport.framework</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">CoreImage.framework</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">SystemConfiguration.framework</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">CoreTelephony.framework</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">CoreLocation.framework</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">CoreMotion.framework</code></li></ul></div></li><li class="listitem">Switch to the <strong>Info</strong> tab inside the project configuration.</li><li class="listitem">Add a new key inside <strong>Custom iOS Target Properties</strong> by selecting any item and clicking on the plus button.</li><li class="listitem">Call <a id="id493" class="indexterm"/>this key <code class="literal">ubertesters_project_id</code>.</li><li class="listitem">As its value, use the ID from the Ubertesters website from the application from the <strong>SDK Integration</strong> tab.</li><li class="listitem">Switch to <code class="literal">AppDelegate.m</code>.</li><li class="listitem">Import the <code class="literal">Ubertesters</code> header file, using the following line of code:<div><pre class="programlisting">#import &lt;UbertestersSDK/Ubertesters.h&gt;</pre></div></li><li class="listitem">Initialize the Ubertesters SDK by updating the <code class="literal">didFinishLaunchingWithOptions</code> method, as shown in the following code:<div><pre class="programlisting">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
    CGRect screenBounds = [UIScreen mainScreen].bounds;
    _window = [[UIWindow alloc] initWithFrame:screenBounds];
    
    _viewController = [[SPViewController alloc] init];
    
    // Enable some common settings here:
    //
    // _viewController.showStats = YES;
    // _viewController.multitouchEnabled = YES;
    // _viewController.preferredFramesPerSecond = 60;
    
    <strong>[Ubertesters initialize];</strong>
    
    [_viewController startWithRoot:[Game class] supportHighResolutions:YES doubleOnPad:YES];
    
    [_window setRootViewController:_viewController];
    [_window makeKeyAndVisible];
    
    return YES;
}</pre></div></li><li class="listitem">Run the example.<p>When we start the example, we don't see any visible changes (refer to the following screenshot), which is an indicator that everything worked as we expected it to:</p><div><img src="img/1509OS_11_02.jpg" alt="Time for action – integrating Ubertesters"/></div></li></ol></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec146"/>
<em>What just happened?</em>
</h2></div></div></div><p>To get started, we opened our Xcode project, which is what we did in step 1.</p><p>Then, we<a id="id494" class="indexterm"/> downloaded the Ubertesters SDK and extracted the contents of the downloaded file. In step 4, we dragged the contents of the extracted file into the project itself. It should be on the root level directly below the project file itself on the same level as <strong>Sparrow</strong>, <strong>Classes</strong>, <strong>Other Sources</strong>, <strong>Resources</strong>, <strong>Frameworks</strong>, and <strong>Products</strong>.</p><p>In order to make the Ubertesters SDK work, we need to link against a variety of frameworks. In step 5, we switched to the general configuration by clicking on the <strong>General</strong> tab, where we can find the linked frameworks and libraries right at the bottom of the page. We added all the frameworks described in step 6.</p><p>Then, we added an entry to the PLIST file of the application itself. This can be done in the <strong>Info</strong> tab. We selected any entry under <strong>Custom iOS Target Properties</strong> and clicked on the plus button next to it. We then set the key name for this property, which we named <code class="literal">ubertesters_project_id</code>. We already have the project ID; we got it when we registered our application on Ubertesters. In the web interface of Ubertesters, this ID can be retrieved by clicking on <strong>Projects</strong>, then on our project (Pirate Game), and after this, on the <strong>SDK Integration</strong> tab on the left-hand side. These steps are necessary so that Ubertesters knows the application we registered in the web interface belongs to our game.</p><p>To use the SDK, we imported the Ubertesters SDK header file and initialized the SDK itself. This all happened inside the <code class="literal">AppDelegate</code> file in steps 11 to 13. We added the initialization of the SDK to where the application launches inside <code class="literal">didFinishLaunchingWithOptions</code>.</p><p>When we ran the example, there wasn't any visible change and the game ran as expected. When running the game on the actual device, it may take a bit longer to load, as the Ubertesters SDK checks against an Internet connection at startup. For production builds (for example, an App Store release), it is not recommended for the SDK to be included; the SDK should be included for the builds that are specifically going to beta testers.</p><div><div><div><div><h3 class="title"><a id="ch11lvl3sec13"/>Creating a build for beta testers</h3></div></div></div><p>Now that we have integrated the Ubertesters SDK in our game, we can create a special build for our beta testers, which at the moment is just us, or more specifically, our own device.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec129"/>Time for action – creating a build for beta testers</h1></div></div></div><p>Us the<a id="id495" class="indexterm"/> following steps to create a special build for beta testers:</p><div><ol class="orderedlist arabic"><li class="listitem">Log in to<a id="id496" class="indexterm"/> the provisioning portal at <a class="ulink" href="https://developer.apple.com/account/ios/certificate/certificateList.action">https://developer.apple.com/account/ios/certificate/certificateList.action</a>.</li><li class="listitem">In <strong>Identifiers</strong>, click on <strong>App IDs</strong>. Add a new one by clicking the plus button.</li><li class="listitem">From <strong>App ID Description</strong>, choose <strong>PirateGame</strong>.</li><li class="listitem">Set an <strong>App ID Prefix</strong> of your choice. All of the available prefixes will be shown as a drop-down list, where the default is <strong>Team ID</strong>. If you are unsure which one to use, use the default one.</li><li class="listitem">In the <strong>Bundle ID</strong> input box, put in the bundle ID of our game. If you haven't chosen one, it's time to do so now. Make sure that the bundle ID is the same as <strong>Bundle identifier</strong> in the <code class="literal">App-Info.plist</code> file of our application. It is recommended that you use a reverse-domain name. Click on <strong>Continue</strong> and then <strong>Done</strong> to finish the process.</li><li class="listitem">Show all devices by clicking on <strong>All</strong> in the <strong>Devices</strong> tab.</li><li class="listitem">Add a new device by clicking on the plus button.</li><li class="listitem">In <strong>UDID</strong>, enter the UDID of our device. This can be retrieved from the Ubertesters web application.</li><li class="listitem">In <strong>Provisioning Profiles</strong>, select <strong>Distribution</strong> and add a new one by clicking the button with the plus icon.</li><li class="listitem">Select <strong>Ad Hoc</strong> as the distribution type and click on <strong>Continue</strong>.</li><li class="listitem">Select <strong>App ID</strong> we had created in step 5 and click on <strong>Continue</strong>.</li><li class="listitem">If there isn't a certificate available, you will be asked to create a new certificate in the next step and select <strong>App Store and Ad hoc</strong>. Follow the instructions to generate the certificate. If there are already certificates available, you will be asked to choose one of them.</li><li class="listitem">Open<a id="id497" class="indexterm"/> the newly created certificate and select the device we just added.</li><li class="listitem">Generate the updated certificate.</li><li class="listitem">In the Xcode project, select <strong>iOS Device</strong> as the target. This can be done through the build menu, where the product and the target are being displayed.</li><li class="listitem">In the menu, select <strong>Product</strong> and click on <strong>Archive</strong>.</li><li class="listitem">Open the Xcode organizer by clicking on <strong>Window</strong> and selecting <strong>Organizer</strong>.</li><li class="listitem">Select the latest build and click on <strong>Distribute</strong>.</li><li class="listitem">On the window that pops up, select <strong>Save for Enterprise or Ad Hoc Deployment</strong>. Confirm by clicking on <strong>Next</strong>.</li><li class="listitem">Select the provisioning profile we created earlier.</li><li class="listitem">Click on <strong>Export</strong> and save the package somewhere on the hard drive.</li></ol></div><p>After we created the build, we return to the Xcode organizer, where we can either distribute the build again or validate it, as shown in the following screenshot:</p><div><img src="img/1509OS_11_03.jpg" alt="Time for action – creating a build for beta testers"/></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec147"/>
<em>What just happened?</em>
</h2></div></div></div><p>To<a id="id498" class="indexterm"/> create a special build for testers, we created an ad-hoc distribution profile just for our game. This is something we have to do just once per application, but not per build.</p><p>To <a id="id499" class="indexterm"/>create certificates, we needed the provisioning portal from the Apple developer member center. It consists of the following three tasks:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Creating an App ID</strong>: This identifies our game (steps 2 to 5)</li><li class="listitem" style="list-style-type: disc"><strong>Adding a new device</strong>: A distribution certificate can hold a number of target devices, which need to be added before the distribution certificate is created (steps 6 to 9)</li><li class="listitem" style="list-style-type: disc"><strong>Creating a distribution certificate</strong>: This is used to sign the special build (steps 10 to 14)</li></ul></div><p>Now that the certificate is generated, we created the build with the help of this certificate. We needed to select the <strong>iOS Device</strong> (or the name of the connected iOS device—if there is one). We selected a product to create an archive which we did in step 16. After the archive is created, we can select it from the Xcode organizer. We wanted to distribute this build, so that's why we clicked on the button with the <strong>Distribute</strong> label in step 18.</p><p>As we wanted an ad hoc deployment, we selected this option. <strong>Ad hoc deployment</strong> means that we are distributing our applications to a known number of devices, while a <strong>distribution build</strong>—such as for the Apple App Store—means the application can be installed<a id="id500" class="indexterm"/> on any number of devices that got the application from the Apple App Store. When we had the option to select a provisioning profile, we chose the one we created earlier. By clicking on <strong>Export</strong>, we got an IPA file that we had put in a safe place for the moment.</p><div><div><div><div><h3 class="title"><a id="ch11lvl3sec14"/>Deploying an application</h3></div></div></div><p>Our special build is now finished, so we can go ahead and deploy our game using the Ubertesters web interface.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec130"/>Time for action – deploying an application</h1></div></div></div><p>To deploy<a id="id501" class="indexterm"/> the application, perform the following steps:</p><div><ol class="orderedlist arabic"><li class="listitem">Log<a id="id502" class="indexterm"/> in to Ubertesters at <a class="ulink" href="http://beta.ubertesters.com/sign_in">http://beta.ubertesters.com/sign_in</a>.</li><li class="listitem">Click on <strong>Projects</strong> from the top menu.</li><li class="listitem">Click on <strong>Upload revision</strong> and choose the special build we created earlier.</li><li class="listitem">We can now enter a revision title and a description.</li><li class="listitem">Select the revision we just uploaded.</li><li class="listitem">Click on <strong>Start</strong> to allow this revision to be installed on the target devices.</li><li class="listitem">On our registered device, we can now install our game.<p>On the web interface, we can track the installations of our application, as shown in the following screenshot:</p><div><img src="img/1509OS_11_04.jpg" alt="Time for action – deploying an application"/></div></li></ol></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec148"/>
<em>What just happened?</em>
</h2></div></div></div><p>To deploy the application using Ubertesters, we logged in to Ubertesters first. When we see all the available projects, we can upload a new revision for each of the projects. At the moment, we only have one project.</p><p>After the <a id="id503" class="indexterm"/>revision is uploaded, we can optionally set a title and a description for the build. The following two things need to be considered when uploading a build:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The Ubertesters SDK needs to be integrated in the application.</li><li class="listitem" style="list-style-type: disc">The bundle version must be different for each uploaded revision. This setting can be found in the <code class="literal">Info.plist</code> file.</li></ul></div><p>Before the application can be installed on the target devices, we need to start the process, which we did using the <strong>Start</strong> button. The testing phase can be stopped and restarted for every revision.</p><p>When we open the Ubertesters app in our registered device, we can now download our game. When our game is installed, we can run the game just as we expect it to.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec131"/>Explaining Game Center</h1></div></div></div><p>Game Center<a id="id504" class="indexterm"/> is a social media feature by Apple that allows leaderboards, achievements, and matchmaking. In a way, it's very similar to Steam for desktop platforms. Naturally, Game Center only works on iOS devices.</p><div><div><div><div><h2 class="title"><a id="ch11lvl2sec149"/>Integrating Game Center authentication</h2></div></div></div><p>The first thing we need to do is authenticate Game Center to be able to use its features.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec132"/>Time for action – integrating Game Center authentication</h1></div></div></div><p>Use<a id="id505" class="indexterm"/> the following steps to integrate Game Center authentication:</p><div><ol class="orderedlist arabic"><li class="listitem">Open our Xcode project if it's not already open.</li><li class="listitem">Add <code class="literal">GameKit.framework</code> to the list of frameworks to be linked.</li><li class="listitem">Switch to <code class="literal">AppDelegate.m</code>.</li><li class="listitem">Import the <code class="literal">GameKit</code> header file using the following line of code:<div><pre class="programlisting">#import &lt;GameKit/GameKit.h&gt;</pre></div></li><li class="listitem">Update the <code class="literal">didFinishLaunchingWithOptions</code> method to look like the following piece of code:<div><pre class="programlisting">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
    CGRect screenBounds = [UIScreen mainScreen].bounds;
    _window = [[UIWindow alloc] initWithFrame:screenBounds];
    
    _viewController = [[SPViewController alloc] init];
    
    [Ubertesters initialize];
    
    [_viewController startWithRoot:[Game class] supportHighResolutions:YES doubleOnPad:YES];
    
<strong>    [GKLocalPlayer localPlayer].authenticateHandler = ^(UIViewController *viewController, NSError *error) {</strong>
<strong>        if ([GKLocalPlayer localPlayer].authenticated) {</strong>
<strong>            NSLog(@"Already authenticated");</strong>
<strong>        } else if(viewController) {</strong>
<strong>            [[Sparrow currentController] presentViewController:viewController animated:YES completion:nil];//present the login form</strong>
<strong>        } else {</strong>
<strong>            NSLog(@"Problem while authenticating");</strong>
<strong>        } </strong>
<strong>    };</strong>
    
    [_window setRootViewController:_viewController];
    [_window makeKeyAndVisible];
    
    return YES;
}</pre></div></li><li class="listitem">Run the example. If we are not authenticated yet, we should get a dialog to log in to <strong>Game Center</strong>:<div><img src="img/1509OS_11_05.jpg" alt="Time for action – integrating Game Center authentication"/></div></li></ol></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec150"/>
<em>What just happened?</em>
</h2></div></div></div><p>To<a id="id506" class="indexterm"/> integrate Game Center, we linked the GameKit framework.</p><p>The next thing we did is update the <code class="literal">AppDelegate</code> class, and once more, it's the method that handles everything once the application has finished launching. In step 4, we needed to import the <code class="literal">GameKit</code> header.</p><p>In the next step, we authenticated Game Center right after we started the view controller with the <code class="literal">Game</code> class. The <code class="literal">localPlayer</code> returns the active player who interacts with the device.</p><p>We added an authentication handler that is called once Game Center is authenticated. If the player is already authenticated, we are just going to log in. The same happens if there is an error when the authentication fails.</p><p>If the player is not authenticated, we show the Game Center view controller through the current view controller from Sparrow.</p><p>Game Center is handled through iTunes Connect. The workflow is described at <a class="ulink" href="https://developer.apple.com/library/ios/documentation/LanguagesUtilities/Conceptual/iTunesConnectGameCenter_Guide/Introduction/Introduction.html">https://developer.apple.com/library/ios/documentation/LanguagesUtilities/Conceptual/iTunesConnectGameCenter_Guide/Introduction/Introduction.html</a>.</p><p>If we want to use achievements in our game, we need to add all of our achievements in the iTunes Connect window shown in the following screenshot:</p><div><img src="img/1509OS_11_06.jpg" alt="What just happened?"/></div><p>We <a id="id507" class="indexterm"/>would need a piece of code similar to the following code to set an achievement:</p><div><pre class="programlisting">GKAchievement *achievement = [[GKAchievement alloc] initWithIdentifier: @"sankALotOfShips"];
if (achievement) {
   achievement.percentComplete = 100;
   [achievement reportAchievementWithCompletionHandler:^(NSError *error) {
      if (error != nil) {
        NSLog(@"Error in reporting achievements: %@", error);
      }
   }];
}</pre></div><p>Let's assume we have an achievement called <code class="literal">sankALotOfShips</code>, which—as the name suggests—should be shown if our ship sank a whole lot of ships.</p><p>We retrieved the achievements and if the achievement exists, we set the achievement to be complete by simply adjusting the <code class="literal">percentComplete</code> property to <code class="literal">100</code>. We then reported the<a id="id508" class="indexterm"/> updated achievement. If there was an error, we logged it to the console.</p><p>To learn more about achievements in Game Center, take a look at <a class="ulink" href="https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/GameKit_Guide/Achievements/Achievements.html">https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/GameKit_Guide/Achievements/Achievements.html</a>.</p></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec151"/>Have a go hero</h2></div></div></div><p>Game Center has quite a big arsenal of things to do. The following are some suggestions of what could be done:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Currently, we only log if the player is already authenticated or the authentication failed because the player canceled the authentication. This can be improved with some basic error handling.</li><li class="listitem" style="list-style-type: disc">Game Center also provides leaderboards. As our game is very much highscore-based or gold-based to be more accurate, you could try to utilize this functionality to add leaderboards to our game. If you are not too afraid about performing some refactoring, you might even want to introduce a highscore-based system that doesn't rely on gold. This is definitely a harder, but a more balanced way to go, as the player shouldn't be punished for using in-game currency to upgrade their gear. Take a look at the official Apple documentation<a id="id509" class="indexterm"/> at <a class="ulink" href="https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/GameKit_Guide/LeaderBoards/LeaderBoards.html">https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/GameKit_Guide/LeaderBoards/LeaderBoards.html</a> to learn more about leaderboards.</li><li class="listitem" style="list-style-type: disc">Since the preceding task is definitely much more difficult and a bit far fetched, you can try to use matchmaking abilities to let two players battle against each other. This will lead to a major refactoring of the existing code though. A<a id="id510" class="indexterm"/> good starting point will be to take a look at the matchmaking documentation at <a class="ulink" href="https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/GameKit_Guide/MatchmakingwithGameCenter/MatchmakingwithGameCenter.html">https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/GameKit_Guide/MatchmakingwithGameCenter/MatchmakingwithGameCenter.html</a>.</li></ul></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec133"/>An overview of analytics services</h1></div></div></div><p>Some<a id="id511" class="indexterm"/> basic analytics are most likely provided by a beta distribution service (as Ubertesters in our case). When you have a paid app in the Apple App Store, it is often necessary to have detailed information, such as how many in-app purchases there were and accurate details about play sessions.</p><p>Analytics are usually a paid service; in most cases, there is either a free or a trial version. Let's take a look at two analytics services.</p><div><div><div><div><h2 class="title"><a id="ch11lvl2sec152"/>Flurry analytics</h2></div></div></div><p>Flurry<a id="id512" class="indexterm"/> is a service that has been around for a few years<a id="id513" class="indexterm"/> and provides support for multiple platforms. It provides the following features:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Geographical data of users</li><li class="listitem" style="list-style-type: disc">Crash analytics</li><li class="listitem" style="list-style-type: disc">Play session statistics</li></ul></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec153"/>Flox</h2></div></div></div><p>Flox is <a id="id514" class="indexterm"/>a service made by Gamua, the guys behind the Sparrow<a id="id515" class="indexterm"/> framework. Flox is a relatively new service which is available <a id="id516" class="indexterm"/>at <a class="ulink" href="http://gamua.com/flox/">http://gamua.com/flox/</a>.</p><div><img src="img/1509OS_11_07.jpg" alt="Flox"/></div><p>Flox provides<a id="id517" class="indexterm"/> the following features:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Remote logging</li><li class="listitem" style="list-style-type: disc">Leaderboards</li><li class="listitem" style="list-style-type: disc">Save games</li><li class="listitem" style="list-style-type: disc">Session and user statistics</li></ul></div><p>The Objective-C headers are available at <a class="ulink" href="https://github.com/Gamua/Flox-ObjC">https://github.com/Gamua/Flox-ObjC</a>. It even offers Game Center integration.</p><p>Let's take a look at what Flox integration would look like. The next step after registering on the Flox service is to create a game. We get its game ID and its game key.</p><p>After integrating the Flox SDK into our game, we will need to initialize Flox inside our application delegate (<code class="literal">AppDelegate.m</code>), using the following code:</p><div><pre class="programlisting">[Flox startWithGameID:@"gameID" key:@"gameKey" version:@"1.0"];</pre></div><p>After this, we<a id="id518" class="indexterm"/> can dispatch events that will show up in the Flox web<a id="id519" class="indexterm"/> interface:</p><div><pre class="programlisting">[Flox logEvent:@"GameStarted"];</pre></div><p>If we wanted to use leaderboards through Flox, we will need to create the leaderboard itself using the web interface. If we want to load all scores from the leaderboards, the following piece of code will set us up:</p><div><pre class="programlisting">[Flox loadScoresFromLeaderboard:@"default" timeScope:FXTimeScopeAllTime onComplete:^(NSArray *scores, NSError *error)
{
     NSLog(@"So much scores. Got %d", (int)scores.count);
}];</pre></div><p>To save to the leaderboards, we can use the following piece of code:</p><div><pre class="programlisting">[Flox postScore:World.gold ofPlayer:@"playerName" toLeaderboard:@"default"];</pre></div></div><div><div><div><div><h2 class="title"><a id="ch11lvl2sec154"/>Pop quiz</h2></div></div></div><p>Q1. What is Ubertesters?</p><div><ol class="orderedlist arabic"><li class="listitem">It allows private applications for beta testers to be distributed</li><li class="listitem">It is a platform to search for beta testers</li><li class="listitem">It is an online magazine that tests mobile applications</li></ol></div><p>Q2. What is Game Center?</p><div><ol class="orderedlist arabic"><li class="listitem">Apple's solution for a game's social features such as achievements and high score lists</li><li class="listitem">A publisher for mobile games</li><li class="listitem">Games that work on multiple platforms</li></ol></div><p>Q3. What does an analytics platform usually provide?</p><div><ol class="orderedlist arabic"><li class="listitem">Private data of users</li><li class="listitem">Anonymous play sessions</li><li class="listitem">Statistical data</li></ol></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch11lvl1sec134"/>Summary</h1></div></div></div><p>In this chapter, we learned about integrating third-party services into our game, especially to distribute our game and integrate it with Apple's Game Center.</p><p>Our game is now finished. Of course, there are a lot of things that we could still add or update, but all in all, we mastered the process of creating a playable game during the course of this book while learning about the Sparrow framework as well as distributing our application and creating game assets.</p></div></body></html>