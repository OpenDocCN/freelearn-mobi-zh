<html><head></head><body>
		<div><h1 id="_idParaDest-260" class="chapter number"><a id="_idTextAnchor826"/><a id="_idTextAnchor827"/><a id="_idTextAnchor828"/><a id="_idTextAnchor829"/><a id="_idTextAnchor830"/>16</h1>
			<h1 id="_idParaDest-261"><a id="_idTextAnchor831"/>Animations and Transitions with CoordinatorLayout and MotionLayout</h1>
			<p>This chapter will introduce you to animations and how to handle changing between layouts. It offers a description of moving objects using <code>MotionLayout</code> and the Motion Editor in Android, along with a detailed explanation of constraint sets. The chapter also covers modifying paths and adding keyframes to a frame’s motion.</p>
			<p>By the end of this chapter, you will be able to create animations using <code>CoordinatorLayout</code> and <code>MotionLayout</code> and use the Motion Editor in Android Studio to create <code>MotionLayout</code> animations.<a id="_idTextAnchor832"/></p>
			<p>In the previous chapter, you learned about architecture patterns such as MVVM. You now know how to improve the architecture of an app. Next, we will learn how to use animations to enhance our app’s look and feel and make it different and better than other apps.</p>
			<p>Sometimes, the apps we develop can look a little plain, so we can include some moving parts and delightful animations in our apps to make them livelier and the UI and user experience better. For example, we can add visual cues so that a user will not be confused about what to do next and can be guided through what steps they can take.</p>
			<p>Animations while loading can entertain a user while content is being fetched or processed. Pretty animations when the app encounters an error can help prevent users from getting angry about what has happened and can inform them of what options they have.</p>
			<p>In this chapter, we’ll start by looking at some of the traditional ways of doing animations with Android. We’ll end the chapter by looking at the newer <code>MotionLayout</code> option. Let’s get started with activity transitions, which are one of the easiest and most used animations.</p>
			<p>We will cover the following topics in this chapter:</p>
			<ul>
				<li>Activity transitions</li>
				<li>Animations with <code>CoordinatorLayout</code></li>
				<li>Animations with <code>MotionLayout</code><code><a id="_idTextAnchor833"/><a id="_idTextAnchor834"/></code></li>
			</ul>
			<h1 id="_idParaDest-262"><a id="_idTextAnchor835"/>Technical requirements</h1>
			<p>The complete code for all the exercises and the activity in this chapter is available on GitHub at <a href="https://packt.link/G8RoL">https://packt.link/G8RoL</a></p>
			<h1 id="_idParaDest-263"><a id="_idTextAnchor836"/>Activity transitions</h1>
			<p>When <a id="_idIndexMarker1320"/>opening and closing an activity, Android will play a default transition. We can customize the activity transition to reflect the brand and/or differentiate our app. Activity transitions are available, starting with Android 5.0 Lollipop (API level 21).</p>
			<p>Activity transitions have two parts – the <a id="_idIndexMarker1321"/>enter transition<a id="_idIndexMarker1322"/> and the <a id="_idIndexMarker1323"/>exit transition. The enter transition defines how the activity and its views will be animated when the activity is opened. The exit transition, meanwhile, describes <a id="_idIndexMarker1324"/>how the activity and views are animated when the activity is closed, or a new activity is opened. Android supports the following built-in transitions:</p>
			<ul>
				<li><strong class="bold">Explode</strong>: This moves<a id="_idIndexMarker1325"/> views in or out from the center</li>
				<li><strong class="bold">Fade</strong>: This view <a id="_idIndexMarker1326"/>slowly appears or disappears</li>
				<li><strong class="bold">Slide</strong>: This <a id="_idIndexMarker1327"/>moves views in or out from the edges</li>
			</ul>
			<p>Now, let’s see how we can add activity transitions in the following section. There are two ways to add activity transitions – through XML and through code. First, we will learn how to add transitions via XML, and then v<a id="_idTextAnchor837"/><a id="_idTextAnchor838"/>ia code.</p>
			<h2 id="_idParaDest-264"><a id="_idTextAnchor839"/>Adding activity transitions through XML</h2>
			<p>You can add <a id="_idIndexMarker1328"/>activity transitions through XML. The first<a id="_idIndexMarker1329"/> step is to enable window content transitions. This is done by adding the following in the activity’s theme in <code>themes.xml</code>:</p>
			<pre class="source code">
&lt;item name="android:windowActivityTransitions"&gt;true&lt;/item&gt;</pre>
			<p>After that, you <a id="_idIndexMarker1330"/>can then add the enter and exit transitions <a id="_idIndexMarker1331"/>with the <code>android:windowEnterTransition</code> and <code>android:windowExitTransition</code> style attributes. For example, if you want to use the default transitions from <code>@android:transition/</code>, the attributes you will need to add are as follows:</p>
			<pre class="source code">
&lt;item name="android:windowEnterTransition"&gt; @android:
    transition/slide_left&lt;/item&gt;
&lt;item name="android:windowExitTransition"&gt; @android:
    transition/explode&lt;/item&gt;</pre>
			<p>Your <code>themes.xml</code> file would then look as follows:</p>
			<pre class="source code">
    &lt;style name="AppTheme" parent=
        "Theme.AppCompat.Light.DarkActionBar"&gt;
        ...
        &lt;item name="android:
            windowActivityTransitions"&gt;true&lt;/item&gt;
        &lt;item name="android:windowEnterTransition"&gt;
            @android:transition/slide_left&lt;/item&gt;
        &lt;item name="android:windowExitTransition"&gt;
            @android:transition/explode&lt;/item&gt;
    &lt;/style&gt;</pre>
			<p>Activity<a id="_idIndexMarker1332"/> transitions are enabled with <code>&lt;</code><code>item name="android:windowActivityTransitions"</code><strong class="source inline">
&gt;true&lt;/item&gt;</strong>. The <code>&lt;item name="android:windowEnterTransition"&gt;@android:transition/slide_left&lt;/item&gt;</code> attribute sets the enter transition, while <code>@android:transition/explode</code> is the exit <a id="_idIndexMarker1333"/>transition file, as set by the <code>&lt;item </code><code>name="android:windowExitTransition"&gt;@android:transition/explode&lt;/item&gt;</code> attribute.</p>
			<p>In the next section, you will learn how to add activity transitions t<a id="_idTextAnchor840"/><a id="_idTextAnchor841"/>hrough coding.</p>
			<h2 id="_idParaDest-265"><a id="_idTextAnchor842"/>Adding activity transitions through code</h2>
			<p>Activity transitions can also be a<a id="_idIndexMarker1334"/>dded programmatically. The first step<a id="_idIndexMarker1335"/> is to enable window content transitions. You can do that by calling the following function in your activity before the call to <code>setContentView()</code>:</p>
			<pre class="source code">
window.requestFeature(Window.FEATURE_CONTENT_TRANSITIONS)</pre>
			<p>You can add the enter and exit transactions afterward with <code>window.enterTransition</code> and <code>window.exitTransition</code> respectively. We can use the built-in <code>Explode()</code>, <code>Slide()</code>, and <code>Fade()</code> transitions from the <code>android.transition</code> package. For example, if we want to use <code>Explode()</code> as an enter transition and <code>Slide()</code> as an exit transition, we can add the following code:</p>
			<pre class="source code">
window.enterTransition = Explode()
window.exitTransition = Slide()</pre>
			<p>Remember to wrap these calls with a check for <code>Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP</code> if your app’s minimum supported SDK is lower than 21.</p>
			<p>Now that you know how to add entry and exit activity transitions through code or XML, you need to learn how to activate the transition when opening the activity. We will do that in t<a id="_idTextAnchor843"/><a id="_idTextAnchor844"/>he next section.</p>
			<h2 id="_idParaDest-266"><a id="_idTextAnchor845"/>Starting an activity with an activity transition</h2>
			<p>Once you have<a id="_idIndexMarker1336"/> added activity transitions to an activity (either through XML or by coding), you can activate the transition when opening the activity. Instead of the <code>startActivity(intent)</code> call, you should pass in a bundle with the transition animation. To do that, start your activity with the following code:</p>
			<pre class="source code">
startActivity(intent, ActivityOptions
.makeSceneTransitionAnimation(this).toBundle())</pre>
			<p>The <code>ActivityOptions.makeSceneTransitionAnimation(this).toBundle()</code> argument will create a bundle with the enter and exit transition we specified for the activity (via XML or with code).</p>
			<p>Let’s try out what we have learned so far by adding activity trans<a id="_idTextAnchor846"/><a id="_idTextAnchor847"/>itions to an app.</p>
			<h2 id="_idParaDest-267"><a id="_idTextAnchor848"/>Exercise 16.01 – creating activity transitions in an app</h2>
			<p>In many<a id="_idIndexMarker1337"/> establishments, it is common to leave a tip (often called a <strong class="bold">gratuity</strong>). This is a sum of money given to show appreciation for a <a id="_idIndexMarker1338"/>service – for example, to the waiting staff in a restaurant. The tip is provided in addition to the basic charge denoted on the final bill.</p>
			<p>Throughout this chapter, we will be working with an application that calculates the amount that should be given as a tip. This value will be based on the amount of the bill (the basic charge) and the extra percentage that the user wants to give. The user will input both values, and the app will calculate the tip value.</p>
			<p>In this exercise, we will be customizing the activity transition between the input and the output screen:</p>
			<ol>
				<li>In Android Studio, open the Tip Calculator project in the <code>Chapter16</code> directory from the book code repository.</li>
				<li>Run the application. Tap on the <code>OutputActivity</code> and going back. There is a default animation while <code>MainActivity</code> is being closed and <code>OutputActivity</code> is being opened and closed.</li>
				<li>Now, let’s start adding transition animations. Open <code>themes.xml</code> and update the activity theme with the <code>windowActivityTransitions</code>, <code>windowEnterTransition</code>, and <code>windowExitTransition</code> style attributes:<pre class="source code">
    &lt;item name="android:windowActivityTransitions"&gt;
      true&lt;/item&gt;
    &lt;item name="android:windowEnterTransition"&gt;
      @android:transition/explode&lt;/item&gt;
    &lt;item name="android:windowExitTransition"&gt;
      @android:transition/slide_left&lt;/item&gt;</pre></li>
			</ol>
			<p>This will enable the activity transition, add an explode enter transition, and add a slide left exit transition to the activity.</p>
			<ol>
				<li value="4">Go back to the <code>MainActivity</code> file and replace <code>startActivity(intent)</code> with the following:<pre class="source code">
startActivity(intent, ActivityOptions
.makeSceneTransitionAnimation(this).toBundle())</pre></li>
			</ol>
			<p>This will open <code>OutputActivity</code> with the transition animation we specified in the XML file (which we set in the previous step).</p>
			<ol>
				<li value="5">Run the <a id="_idIndexMarker1339"/>application. You will see that the animation when opening and closing <code>MainActivity</code> and <code>OutputActivity</code> has changed. When the Android UI opens <code>OutputActivity</code>, note that the text is moving toward the center. While closing, the view<a id="_idTextAnchor849"/>s slide to the left:</li>
			</ol>
			<div><div><img src="img/B19411_16_01.jpg" alt="Figure 16.1 – The app screens – the input screen (on the left) and the output screen (on the right)"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.1 – The app screens – the input screen (on the left) and the output screen (on the right)</p>
			<p>We have added<a id="_idIndexMarker1340"/> an activity transition to an app. When we open a new activity, the new activity’s enter transition will be played. Its exit transition will play when the activity is closed.</p>
			<p>Sometimes, when we open another activity from one activity, there is a common element that is present in both activities. In the next section, we will learn about adding this shared<a id="_idTextAnchor850"/><a id="_idTextAnchor851"/> element transition.</p>
			<h2 id="_idParaDest-268"><a id="_idTextAnchor852"/>Adding a shared element transition</h2>
			<p>There are times <a id="_idIndexMarker1341"/>when an application moves from one activity to another and there is a common element that is present in both activities. We can add an animation to this shared element to highlight to users the link between the two activities.</p>
			<p>In a movie application, for example, an activity with a list of movies (with a thumbnail image) can open a new activity with details of the selected movie, along with a full-sized image at the top. Adding a shared element transition for the image will link the thumbnail on the list activity to the image on the details activity.</p>
			<p>The shared element transition has two parts – the enter transition and the exit transition. These transitions can be done through XML or code.</p>
			<p>The first step is to enable a window content transition. You can do this by adding the activity’s theme to <code>themes.xml</code> with the following:</p>
			<pre class="source code">
&lt;item name="android:windowContentTransitions"&gt;true&lt;/item&gt;</pre>
			<p>You can also do this programmatically by calling the following function in your activity before the call to <code>setContentView()</code>:</p>
			<pre class="source code">
window.requestFeature(Window.FEATURE_CONTENT_TRANSITIONS)</pre>
			<p>The <code>android:windowContentTransitions</code> attribute with a <code>true</code> value and <code>window.requestFeature(Window.FEATURE_CONTENT_TRANSITIONS)</code> will enable the window content transition.</p>
			<p>Afterward, you can add the shared element enter transition and the shared element exit transition. If you have <code>enter_transition.xml</code> and <code>exit_transition.xml</code> in your <code>res/transitions</code> directory, you can add the shared element enter transition by adding the following style attribute:</p>
			<pre class="source code">
&lt;item name="android:windowSharedElementEnterTransition"&gt; @transition/enter_transition&lt;/item&gt;</pre>
			<p>You can also do this through code with the following lines:</p>
			<pre class="source code">
val enterTransition = TransitionInflater.from(this)
    .inflateTransition(R.transition.enter_transition)
window.sharedElementEnterTransition = enterTransition</pre>
			<p>The <code>windowSharedElementEnterTransition</code> attribute and <code>window.shared</code><strong class="source inline">
ElementEnterTransition</strong> will set our enter transition to the <code>enter_transition.xml</code> file.</p>
			<p>To add the shared element exit transition, you can add the following style attributes:</p>
			<pre class="source code">
&lt;item name="android:windowSharedElementExitTransition"&gt;
@transition/exit_transition&lt;/item&gt;</pre>
			<p>This can be done <a id="_idIndexMarker1342"/>programmatically with the following lines of code:</p>
			<pre class="source code">
val exitTransition = TransitionInflater.from(this)
    .inflateTransition(R.transition.exit_transition)
window.sharedElementExitTransition = exitTransition</pre>
			<p>The <code>windowSharedElementExitTransition</code> attribute and <code>window.sharedElement</code><strong class="source inline">
ExitTransition</strong> will set our exit transition to the <code>exit_transition.xml</code> file.</p>
			<p>You have learned how to add shared element transitions. In the next section, we’ll learn how to start an activity with the shar<a id="_idTextAnchor853"/><a id="_idTextAnchor854"/>ed element transition.</p>
			<h2 id="_idParaDest-269"><a id="_idTextAnchor855"/>Starting an activity with the shared element transition</h2>
			<p>Once you have<a id="_idIndexMarker1343"/> added the shared element transition to an <a id="_idIndexMarker1344"/>activity (either through XML or programmatically), you can activate the transition when opening the activity. Before you do that, add a <code>transitionName</code> attribute. Set its value as the same text for the shared element in both activities.</p>
			<p>For example, in <code>ImageView</code>, we can add a <code>transition_name</code> value for the <code>transitionName</code> attribute:</p>
			<pre class="source code">
    &lt;ImageView
        ...
        android:transitionName="transition_name"
        android:id="@+id/sharedImage"
    ... /&gt;</pre>
			<p>To start the activity with shared elements, we will be passing in a bundle with the transition animation. To do that, start your activity with the following code:</p>
			<pre class="source code">
startActivity(intent, ActivityOptions
.makeSceneTransitionAnimation(this, sharedImage,
"transition_name").toBundle());</pre>
			<p>The <code>ActivityOptions.makeSceneTransitionAnimation(this, sharedImage, "transition_name").toBundle()</code> argument will create a bundle with the shared element (<code>sharedImage</code>) and the transition name (<code>transition_name</code>).</p>
			<p>If you <a id="_idIndexMarker1345"/>have more than one shared element, you can <a id="_idIndexMarker1346"/>pass the variable arguments of <code>Pair&lt;View, String&gt;</code> of <code>View</code>, and the transition name <code>String</code> instead. For example, if we have the view’s button and image as shared elements, we can do the following:</p>
			<pre class="source code">
val buttonPair: Pair&lt;View, String&gt; = Pair(button, "button")
val imagePair: Pair&lt;View, String&gt; = Pair(image, "image")
val activityOptions = ActivityOptions
    .makeSceneTransitionAnimation(this, buttonPair,
    imagePair)
startActivity(intent, activityOptions.toBundle())</pre>
			<p>This will start the activity with two shared elements (the button and image).</p>
			<p class="callout heading">Note</p>
			<p class="callout">Remember to import <code>android.util.Pair</code> instead of <code>kotlin.Pair</code>, as <code>makeSceneTransitionAnimation</code> is expecting the pair from the Android SDK.</p>
			<p>Let’s try out what we have learned so far by adding shared element transitions <a id="_idTextAnchor856"/><a id="_idTextAnchor857"/>to the <em class="italic">Tip </em><em class="italic">Calculator</em> app.</p>
			<h2 id="_idParaDest-270"><a id="_idTextAnchor858"/>Exercise 16.02 – creating the shared element transition</h2>
			<p>In the first exercise, we <a id="_idIndexMarker1347"/>customized the activity transitions for <code>MainActivity</code> and <code>OutputActivity</code>. In this exercise, we will be adding an image to both activities. This shared element will be animated when moving from the input screen to the output screen. We’ll be using the app launcher icon (<code>res/mipmap/ic_launcher</code>) for <code>ImageView</code>. You can change yours instead of using the default one:</p>
			<ol>
				<li>Open the <code>Tip Calculator</code> project we developed in the previous exercise.</li>
				<li>Go to the <code>activity_main.xml</code> file and add <code>ImageView</code> at the top of the amount text field:<pre class="source code">
    &lt;ImageView
        android:id="@+id/image"
        ...
        android:transitionName="transition_name"
        ... /&gt;</pre></li>
			</ol>
			<p>The complete code for this step can be found at <a href="https://packt.link/NvDO2">https://packt.link/NvDO2</a>.</p>
			<p>The <code>transitionName</code> value of <code>transition_name</code> will be used to identify this as a shared element.</p>
			<ol>
				<li value="3">Change the top constraint of the <code>TextInputLayout</code> with ID <code>amount_text_layout</code> by changing <code>app:layout_constraintTop_toTopOf="parent"</code> to the following:<pre class="source code">
app:layout_constraintTop_toBottomOf="@id/image"</pre></li>
			</ol>
			<p>This will move the <code>amount_text_layout</code> below the image.</p>
			<ol>
				<li value="4">Now, open<a id="_idIndexMarker1348"/> the <code>activity_output.xml</code> file and add an image above the tip <code>TextView</code>, with a height and width of 200 dp and a <code>scaleType</code> of <code>fitXY</code> to fit the image to the dimensions of <code>ImageView</code>:<pre class="source code">
&lt;ImageView
    android:id="@+id/image"
    ...
    android:transitionName="transition_name"
    ... /&gt;</pre></li>
			</ol>
			<p>The complete code for this step can be found at <a href="https://packt.link/jpgVe">https://packt.link/jpgVe</a>.</p>
			<p>The <code>transitionName</code> value of <code>transition_name</code> is the same as the value for <code>ImageView</code> from <code>MainActivity</code>.</p>
			<ol>
				<li value="5">Open <code>MainActivity</code> and change the <code>startActivity</code> code to the following:<pre class="source code">
val image: ImageView = findViewById(R.id.image)
startActivity(intent, ActivityOptions
.makeSceneTransitionAnimation(this, image,
"transition_name").toBundle())</pre></li>
			</ol>
			<p>This will start a transition from <code>ImageView</code> in <code>MainActivity</code>, with the ID image transitioning to another <code>ImageView</code> in <code>OutputActivity</code>, whose <code>transitionName</code> value is also <code>transition_name</code>.</p>
			<ol>
				<li value="6">Run the application. Provide an amount and percentage, and then tap on the <code>OutputActivity</code>:</li>
			</ol>
			<div><div><img src="img/B19411_16_02.jpg" alt="Figure 16.2 – The app screens – the input screen (on the left) and the output screen (on the right)"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.2 – The app screens – the input screen (on the left) and the output screen (on the right)</p>
			<p>We have<a id="_idIndexMarker1349"/> learned about adding activity transitions and shared element transitions. Now, let’s look into animating views inside a layout. If we have more than one element inside, it might be difficult to animate each element. <code>CoordinatorLayout</code> can be used to simplify this animation. We will discu<a id="_idTextAnchor860"/><a id="_idTextAnchor861"/>ss this in the next section.</p>
			<h1 id="_idParaDest-271"><a id="_idTextAnchor862"/>Animations with CoordinatorLayout</h1>
			<p><code>CoordinatorLayout</code> is a layout that<a id="_idIndexMarker1350"/> handles the motions between its child views. When <a id="_idIndexMarker1351"/>you use <code>CoordinatorLayout</code> as the parent view group, you can animate the views inside it with little effort. You can add <code>CoordinatorLayout</code> to your project by adding your <code>app/build.gradle</code> file dependencies with the following:</p>
			<pre class="source code">
implementation 'androidx.coordinatorlayout:
coordinatorlayout:1.2.0'</pre>
			<p>This will allow us to use <code>CoordinatorLayout</code> in our layout files.</p>
			<p>Let’s say we have a layout file with a floating action button inside <code>CoordinatorLayout</code>. When tapping on the floating action button, the UI displays a <code>Snackbar</code> message.</p>
			<p class="callout heading">Note</p>
			<p class="callout"><code>Snackbar</code> is an Android widget that provides a brief message to a user at the bottom of the screen.</p>
			<p>If you use any layout other than <code>CoordinatorLayout</code>, <code>Snackbar</code> with its message will be rendered on top of the floating action button. If we use <code>CoordinatorLayout</code> as the parent view group, the layout will push the floating action button upwards, display <code>Snackbar</code> below it, and move it back when <code>Snackbar</code> disappears. <em class="italic">Figure 16</em><em class="italic">.3</em> shows how the layout adjusts to prevent <code>Snackbar</code> from being on top <a id="_idTextAnchor863"/>of the floating action button:</p>
			<div><div><img src="img/B19411_16_03.jpg" alt="Figure 16.3 – The left screenshot displays the UI before and after the Snackbar message is shown. The screenshot on the right shows the UI while the Snackbar is visible"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.3 – The left screenshot displays the UI before and after the Snackbar message is shown. The screenshot on the right shows the UI while the Snackbar is visible</p>
			<p>The<a id="_idIndexMarker1352"/> floating action button moves and gives space to<a id="_idIndexMarker1353"/> the <code>Snackbar</code> message because it has a default behavior called <code>FloatingActionButton.Behavior</code>, a subclass of <code>CoordinatorLayout.Behavior</code>. The <code>FloatingActionButton.Behavior</code> subclass moves the floating action button while <code>Snackbar</code> is being displayed so that <code>Snackbar</code> won’t cover the floating action button.</p>
			<p>Not all views have the <code>CoordinatorLayout</code> behavior. To implement custom behavior, you can start by extending <code>CoordinatorLayout.Behavior</code>. You can then attach it to the view with the <code>layout_behavior</code> attribute. For example, if we made <code>CustomBehavior</code> in the <code>com.example.behavior</code> package for a button, we can update the button in the layout with the following:</p>
			<pre class="source code">
...
&lt;Button
    ...
    app:layout_behavior="com.example.behavior.CustomBehavior"&gt;
    .../&gt;</pre>
			<p>We have <a id="_idIndexMarker1354"/>learned how to create animations and transitions <a id="_idIndexMarker1355"/>with <code>CoordinatorLayout</code>. In the next section, we will look into another layout, <code>MotionLayout</code>, which allows dev<a id="_idTextAnchor864"/><a id="_idTextAnchor865"/>elopers more control over motion.</p>
			<h1 id="_idParaDest-272"><a id="_idTextAnchor866"/>Animations with MotionLayout</h1>
			<p>Creating <a id="_idIndexMarker1356"/>animations in Android is sometimes time-consuming. You need<a id="_idIndexMarker1357"/> to work on XML and code files even to create simple animations. More complicated animations and transitions take even more time to make.</p>
			<p>To help developers easily make animations, Google created <code>MotionLayout</code>. This is a new way to create motion and animations through XML. It is available starting at API level 14 (Android 4.0).</p>
			<p>With <code>MotionLayout</code>, we can animate the position, width/height, visibility, alpha, color, rotation, elevation, and other attributes of one or more views. Normally, some of these are hard to do with code, but <code>MotionLayout</code> allows us to easily adjust them using declarative XML so that we can focus more on our application.</p>
			<p>Let’s get started by addi<a id="_idTextAnchor867"/><a id="_idTextAnchor868"/>ng <code>MotionLayout</code> to our application.</p>
			<h2 id="_idParaDest-273"><a id="_idTextAnchor869"/>Adding MotionLayout</h2>
			<p>To add <code>MotionLayout</code> to your<a id="_idIndexMarker1358"/> project, you just need to add the dependency for <code>ConstraintLayout 2.0</code>. <code>ConstraintLayout 2.0</code> is the new version of <code>ConstraintLayout</code>, with new features added, including <code>MotionLayout</code>. Add to your app/<code>build.gradle</code> file dependencies with the following:</p>
			<pre class="source code">
implementation 'androidx.constraintlayout:
constraintlayout:2.1.4'</pre>
			<p>This will add the latest version of ConstraintLayout (2.1.4 at the time of writing) to your app.</p>
			<p>After adding the <a id="_idIndexMarker1359"/>dependency, we can now use <code>MotionLayout</code> to create animations. We’<a id="_idTextAnchor870"/><a id="_idTextAnchor871"/>ll be doing that in the next section.</p>
			<h2 id="_idParaDest-274"><a id="_idTextAnchor872"/>Creating animations with MotionLayout</h2>
			<p><code>MotionLayout</code> is a subclass <a id="_idIndexMarker1360"/>of our good old friend ConstraintLayout. To <a id="_idIndexMarker1361"/>create animations with <code>MotionLayout</code>, open the layout file where we will add the animations. Replace the root <code>ConstraintLayout</code> container with <code>androidx.constraintlayout.motion.widget.MotionLayout</code>.</p>
			<p>The animation itself won’t be in the layout file but in another XML file, called <code>motion_scene</code>. This will specify how <code>MotionLayout</code> will animate the views inside it. <code>motion_scene</code> files should be placed in the <code>res/xml</code> directory. The layout file will link to this <code>motion_scene</code> file with the <code>app:layoutDescription</code> attribute in the root view group. Your layout file should look similar to the following:</p>
			<pre class="source code">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;androidx.constraintlayout.motion.widget.MotionLayout
    ...
    app:layoutDescription="@xml/motion_scene"&gt;
    ...
&lt;/androidx.constraintlayout.motion.widget.MotionLayout&gt;</pre>
			<p>To create animations with <code>MotionLayout</code>, we must have the initial state and final state of our views. <code>MotionLayout</code> will automatically animate the transition between the two. You can specify these two states in the same <code>motion_scene</code> file. If you have a lot of views inside the layout, you can also use two different layouts for the beginning and ending states of the animation.</p>
			<p>The root <a id="_idIndexMarker1362"/>container of the <code>motion_scene</code> file is <code>motion_scene</code>. This is where we add the constraints and animation for <code>MotionLayout</code>. It contains<a id="_idIndexMarker1363"/> the following:</p>
			<ul>
				<li><strong class="bold">ConstraintSet</strong>: Specifies the beginning and ending position and style for the view/layout to animate</li>
				<li><strong class="bold">Transition</strong>: Specifies the start, end, duration, and other details of the animation to be done on the views</li>
			</ul>
			<p>Let’s try adding animations with <code>MotionLayou<a id="_idTextAnchor873"/><a id="_idTextAnchor874"/>t</code> by adding it to our <em class="italic">Tip </em><em class="italic">Calculator</em> app.</p>
			<h2 id="_idParaDest-275"><a id="_idTextAnchor875"/>Exercise 16.03 – adding animations with MotionLayout</h2>
			<p>In this exercise, we<a id="_idIndexMarker1364"/> will be updating our <em class="italic">Tip Calculator</em> app <a id="_idIndexMarker1365"/>with a <code>MotionLayout</code> animation. In the output screen, the image above the tip text will move down when tapped and will go back to its original position when tapped again:</p>
			<ol>
				<li>Open the <em class="italic">Tip Calculator</em> project in Android Studio 4.0 or higher.</li>
				<li>Open the <code>activity_output.xml</code> file and change the root <code>ConstraintLayout</code> tag to <code>MotionLayout</code>. Change <code>androidx.constraintlayout.widget.ConstraintLayout</code> to the following:<pre class="source code">
androidx.constraintlayout.motion.widget.MotionLayout</pre></li>
				<li>Add <code>app:layoutDescription="@xml/motion_scene"</code> to the <code>MotionLayout</code> tag. The IDE will warn you that this file does not yet exist. Ignore that for now, as we will be adding it in the next step. Your file should look similar to this:<pre class="source code">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;androidx.constraintlayout.motion.widget.MotionLayout
      ...
    app:layoutDescription="@xml/motion_scene"&gt;
    ...
&lt;/androidx.constraintlayout.motion.widget
.MotionLayout&gt;</pre></li>
				<li>Create a <code>motion_scene.xml</code> file in the <code>res/xml</code> directory. This will be our <code>motion_scene</code> file where the animation configuration will be defined. Use <code>motion_scene</code> as the root element for the file.</li>
				<li>Add the<a id="_idIndexMarker1366"/> starting <code>Constraint</code> element by<a id="_idIndexMarker1367"/> adding the following to the <code>motion_scene</code> file:<pre class="source code">
   &lt;ConstraintSet android:id="@+id/start_constraint"&gt;
        &lt;Constraint
            android:id="@id/image"
            .../&gt;
    &lt;/ConstraintSet&gt;</pre></li>
			</ol>
			<p>The complete code for this step can be found at <a href="https://packt.link/jdJrD">https://packt.link/jdJrD</a>.</p>
			<p>This is how the image looks at the current position (constrained to the top of the screen).</p>
			<ol>
				<li value="6">Next, add the ending <code>Constraint</code> element by adding the following to the <code>motion_scene</code> file:<pre class="source code">
    &lt;ConstraintSet android:id="@+id/end_constraint"&gt;
        &lt;Constraint
            android:id="@id/image"
            ... /&gt;
    &lt;/ConstraintSet&gt;</pre></li>
			</ol>
			<p>The complete code for this step can be found at <a href="https://packt.link/jdJrD">https://packt.link/jdJrD</a>.</p>
			<p>In the ending animation, <code>ImageView</code> will be at the bottom of the screen.</p>
			<ol>
				<li value="7">Let’s now<a id="_idIndexMarker1368"/> add in the transition for our <code>ImageView</code> after <a id="_idIndexMarker1369"/>the <code>ConstraintSet</code>:<pre class="source code">
    &lt;Transition
        app:constraintSetEnd="@id/end_constraint"
        app:constraintSetStart="@id/start_constraint"
        app:duration="2000"&gt;
        &lt;OnClick
            app:clickAction="toggle"
            app:targetId="@id/image" /&gt;
    &lt;/Transition&gt;</pre></li>
			</ol>
			<p>Here, we’re specifying the start and end constraints, which will animate for 2,000 milliseconds (2 seconds). We also added an <code>OnClick</code> event to <code>ImageView</code>. The toggle will animate the view from start to end, and if the view is already in the end state, it will animate back to the start state.</p>
			<ol>
				<li value="8">Run the application and tap on <code>ImageView</code>. It will move straight downward in around 2 seconds. Tap it again, and it will move back up in 2 seconds. <em class="italic">Figure 16</em><em class="italic">.4<a id="_idTextAnchor876"/></em> shows the start and the end of this animation:</li>
			</ol>
			<div><div><img src="img/B19411_16_04.jpg" alt="Figure 16.4 – The starting animation (left) and the ending animation (right)"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.4 – The starting animation (left) and the ending animation (right)</p>
			<p>In this exercise, we<a id="_idIndexMarker1370"/> have animated <code>ImageView</code> in <code>MotionLayout</code> by specifying the start constraint, end constraint, and transition with a<a id="_idIndexMarker1371"/> duration and <code>OnClick</code> event. <code>MotionLayout</code> automatically plays the animation from the start to the end position (which to us looks like it’s moving up or down in a straight line automatically when tapped).</p>
			<p>We have created animations with <code>MotionLayout</code>. In the next section, we will be using Android Studio’s <a id="_idTextAnchor877"/><a id="_idTextAnchor878"/>Motion Editor to create <code>MotionLayout</code> animations.</p>
			<h2 id="_idParaDest-276"><a id="_idTextAnchor879"/>The Motion Editor</h2>
			<p>Android Studio, starting with <a id="_idIndexMarker1372"/>version 4.0, includes the Motion Editor. The Motion Editor can help developers create animations with <code>MotionLayout</code>. This makes it easier for developers to create and preview transitions and other motions, instead of doing it by hand and running the app to see the changes. The editor will also generate the corresponding files automatically.</p>
			<p>You can convert your ConstraintLayout to <code>MotionLayout</code> in the Layout Editor by right-clicking the preview and clicking on the <strong class="bold">Convert to MotionLayout</strong> item. Android Studio will do the conversion and also create the motion scene file for you.</p>
			<p>When viewing a layout file that has <code>MotionLayout</code> as the root in the <strong class="bold">Design</strong> view, the Motion Editor UI will be incl<a id="_idTextAnchor880"/>uded in the <strong class="bold">Design</strong> view, as shown in <em class="italic">Figure 16</em><em class="italic">.5</em>:</p>
			<div><div><img src="img/B19411_16_05.jpg" alt="Figure 16.5 – The Motion Editor in Android Studio 4.0"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.5 – The Motion Editor in Android Studio 4.0</p>
			<p>In the upper-right window (the <code>MotionLayout</code> and the start and end constraint. The transition is displayed as an arrow coming from the start constraint. The dot near the start constraint shows the click action for the transition. <em class="italic">Figure 16</em><em class="italic">.6</em> shows th<a id="_idTextAnchor881"/>e <code>start_constraint</code> selected:</p>
			<div><div><img src="img/B19411_16_06.jpg" alt="Figure 16.6 – The Motion Editor’s Overview panel with start_constraint selected"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.6 – The Motion Editor’s Overview panel with start_constraint selected</p>
			<p>The bottom-right <a id="_idIndexMarker1373"/>window is the <code>MotionLayout</code> selected in the <code>start_constraint</code> is selected:</p>
			<div><div><img src="img/B19411_16_07.jpg" alt="Figure 16.7 – The Motion Editor’s Selection panel showing ConstraintSet for start_constraint"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.7 – The Motion Editor’s Selection panel showing ConstraintSet for start_constraint</p>
			<p>When you click on <code>MotionLayout</code> on the left of the <strong class="bold">Overview</strong> panel, the <strong class="bold">Selection</strong> panel below will display the views <a id="_idTextAnchor883"/>and their constraints, as shown in <em class="italic">Figure 16</em><em class="italic">.8</em>:</p>
			<div><div><img src="img/B19411_16_08.jpg" alt="Figure 16.8 – The Overview and Selection panels when MotionLayout is selected"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.8 – The Overview and Selection panels when MotionLayout is selected</p>
			<p>When you click on <code>start_constraint</code> or <code>end_constraint</code>, the preview window on the left will display <a id="_idIndexMarker1374"/>how the start or end state looks. The <code>start_constraint</code> is selected:</p>
			<div><div><img src="img/B19411_16_09.jpg" alt="Figure 16.9 – How the Motion Editor looks when start_constraint is selected"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.9 – How the Motion Editor looks when start_constraint is selected</p>
			<p><em class="italic">Figure 16</em><em class="italic">.10</em> shows how the <a id="_idIndexMarker1375"/>Motion<a id="_idTextAnchor885"/> Editor will look if you select <code>end_constraint</code>:</p>
			<div><div><img src="img/B19411_16_10.jpg" alt="Figure 16.10 – How the Motion Editor looks with end_constraint selected"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.10 – How the Motion Editor looks with end_constraint selected</p>
			<p>The arrow connecting <code>start_constraint</code> and <code>end_constraint</code> represents the transition of <code>MotionLayout</code>. On the <strong class="bold">Selection</strong> panel, there are controls to play or go to the first or last state. You can also drag the arrow to a specific position. <em class="italic">Figure 16</em><em class="italic">.11 </em>shows how <a id="_idTextAnchor886"/>it looks in the middle (50% of the animation):</p>
			<div><div><img src="img/B19411_16_11.jpg" alt="Figure 16.11 – The transition in the middle of the animation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.11 – The transition in the middle of the animation</p>
			<p>During the<a id="_idIndexMarker1376"/> development of animations with <code>MotionLayout</code>, it would be better if we could debug the animations to make sure we’re doing the animations correctly. We’ll d<a id="_idTextAnchor887"/><a id="_idTextAnchor888"/>iscuss how we can do this in the next section.</p>
			<h2 id="_idParaDest-277"><a id="_idTextAnchor889"/>Debugging MotionLayout</h2>
			<p>To help you visualize <a id="_idIndexMarker1377"/>the <code>MotionLayout</code> animation before running the app, you can show the motion path and the animation’s progress in the Motion Editor. The motion path is the straight route that the object to animate will take from the start to the end state.</p>
			<p>To show the path and/or progress animation, we can add a <code>motionDebug</code> attribute to the <code>MotionLayout</code> container.</p>
			<p>We can use the following values for <code>motionDebug</code>:</p>
			<ul>
				<li><code>SHOW_PATH</code>: This displays the path of the motion only</li>
				<li><code>SHOW_PROGRESS</code>: This displays the animation progress only</li>
				<li><code>SHOW_ALL</code>: This displays both the path and the progress of the animation</li>
				<li><code>NO_DEBUG</code>: This hides all animations</li>
			</ul>
			<p>To display the <code>MotionLayout</code> path and progress, we can use the following:</p>
			<pre class="source code">
&lt;androidx.constraintlayout.motion.widget.MotionLayout
    ...
    app:motionDebug="SHOW_ALL"
    ...&gt;</pre>
			<p>The <code>SHOW_ALL</code> value<a id="_idIndexMarker1378"/> will display the path and the progress of the animation. <em class="italic">Figure 16</em><em class="italic">.12</em> shows how it wi<a id="_idTextAnchor890"/><a id="_idTextAnchor891"/>ll look when we use <code>SHOW_PATH</code> and <code>SHOW_PROGRESS</code>:</p>
			<div><div><img src="img/B19411_16_12.jpg" alt="Figure 16.12 – Using SHOW_PATH (left) shows the animation path, while SHOW_PROGRESS (right) shows the animation progress"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.12 – Using SHOW_PATH (left) shows the animation path, while SHOW_PROGRESS (right) shows the animation progress</p>
			<p>While <code>motionDebug</code> sounds like something that only appears in debug mode, it will also appear in release builds, so it should be removed when you’re preparing your app for publishing.</p>
			<p>During the <code>MotionLayout</code> animation, the<a id="_idIndexMarker1379"/> start constraint will transition to the end constraint, even if there’s an element or elements that can block the objects in motion. We’ll discuss how we ca<a id="_idTextAnchor892"/><a id="_idTextAnchor893"/>n avoid this from happening in the next section.</p>
			<h2 id="_idParaDest-278"><a id="_idTextAnchor894"/>Modifying the MotionLayout path</h2>
			<p>In an animation with <code>MotionLayout</code>, the UI <a id="_idIndexMarker1380"/>will play the motion from the start constraint to the end constraint, even if there are elements in the middle that can block our moving views. For example, if <code>MotionLayout</code> involves text that moves from the top to the bottom of the screen and vice versa, and we add a button to the middle, the button will cover the moving text.</p>
			<p><em class="italic">Figure 16</em><em class="italic">.13</em> shows how the <strong class="bold">OK</strong> button block<a id="_idTextAnchor895"/><a id="_idTextAnchor896"/>s the moving text in the middle of the animation:</p>
			<div><div><img src="img/B19411_16_13.jpg" alt="Figure 16.13 – The OK button is blocking the middle of the text animation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.13 – The OK button is blocking the middle of the text animation</p>
			<p><code>MotionLayout</code> plays the animation from the start to the end constraint in a straight path and adjusts the views, based on the specified attributes. We can add keyframes between the start and end constraints to adjust the animation path and/or the view attributes. For example, during the animation, as well as changing the position of the moving text to avoid the button, we can also change the attributes of the text or other views.</p>
			<p>Keyframes can be<a id="_idIndexMarker1381"/> added in <code>KeyFrameSet</code> as a child of the transition attribute of <code>motion_scene</code>. We can use the following keyframes:</p>
			<ul>
				<li><code>KeyPosition</code>: This specifies the view’s position at a specific point during the animation to adjust the path</li>
				<li><code>KeyAttribute</code>: This specifies the view’s attributes at a specific point during the animation</li>
				<li><code>KeyCycle</code>: This adds oscillations during animations</li>
				<li><code>KeyTimeCycle</code>: This allows cycles to be driven by time instead of animation progress</li>
				<li><code>KeyTrigger</code>: This adds an element that can trigger an event based on the animation progress</li>
			</ul>
			<p>We will focus on <code>KeyPosition</code> and <code>KeyAttribute</code>, as <code>KeyCycle</code>, <code>KeyTimeCycle</code>, and <code>KeyTrigger</code> are more advanced keyframes.</p>
			<p><code>KeyPosition</code> allows us to change the location of views in the middle of the <code>MotionLayout</code> animation. It has the following attributes:</p>
			<ul>
				<li><code>motionTarget</code>: This specifies the object controlled by the keyframe.</li>
				<li><code>framePosition</code>: Numbered from 1 to 99, this specifies the percentage of the motion when the position is changed. For example, 25 means it is at one-quarter of the animation, and 50 is the halfway point.</li>
				<li><code>percentX</code>: This specifies how much the <em class="italic">x</em> value of the path will be modified.</li>
				<li><code>percentY</code>: This specifies how much the <em class="italic">y</em> value of the path will be modified.</li>
				<li><code>keyPositionType</code>: This specifies how <code>KeyPosition</code> modifies the path.</li>
			</ul>
			<p>The <code>keyPositionType</code> attribute can have the following values:</p>
			<ul>
				<li><code>parentRelative</code>: <code>percentX</code> and <code>percentY</code> are specified based on the parent of the view</li>
				<li><code>pathRelative</code>: <code>percentX</code> and <code>percentY</code> are specified based on the straight path from the start constraint to the end constraint</li>
				<li><code>deltaRelative</code>: <code>percentX</code> and <code>percentY</code> are specified based on the position of the view</li>
			</ul>
			<p>For example, if we<a id="_idIndexMarker1382"/> want to modify the path of <code>TextView</code> with the <code>text_view</code> ID at the exact middle of the animation (50%), by moving it 10% by <em class="italic">x</em> and 10% by <em class="italic">y</em>, relative to the parent container of <code>TextView</code>, we will have the following key position in <code>motion_scene</code>:</p>
			<pre class="source code">
&lt;KeyPosition
    app:motionTarget="@+id/text_view"
    app:framePosition="50"
    app:keyPositionType="parentRelative"
    app:percentY="0.1"
    app:percentX="0.1"
/&gt;</pre>
			<p>Meanwhile, <code>KeyAttribute</code> allows us to change the attributes of views while the <code>MotionLayout</code> animation is ongoing. Some of the view attributes we can change are <code>visibility</code>, <code>alpha</code>, <code>elevation</code>, <code>rotation</code>, <code>scale</code>, and <code>translation</code>. <code>KeyAttribute</code> has the following attributes:</p>
			<ul>
				<li><code>motionTarget</code>: This specifies the object controlled by the keyframe.</li>
				<li><code>framePosition</code>: Numbered from 1 to 99, this specifies the percentage of the motion when the view attributes are applied. For example, 20 means it is one-fifth of the animation, and 75 is the three-quarter point of the animation.</li>
			</ul>
			<p>Let’s try adding<a id="_idIndexMarker1383"/> keyframes to the <em class="italic">Tip Calculator</em> app. When the <code>ImageView</code> animates, it goes on top of the text<a id="_idTextAnchor897"/><a id="_idTextAnchor898"/> displaying the tip. We’ll fix that with keyframes.</p>
			<h2 id="_idParaDest-279"><a id="_idTextAnchor899"/>Exercise 16.04 – modifying the animation path with keyframes</h2>
			<p>In the <a id="_idIndexMarker1384"/>previous exercise, we animated the image to move<a id="_idIndexMarker1385"/> straight down when tapped (or upward when it’s already at the bottom). When it is in the middle, the image is covering the tip <code>TextView</code>. We’ll be solving this issue in this exercise by adding <code>KeyFrame</code> to <code>motion_scene</code> using Android Studio’s Motion Editor:</p>
			<ol>
				<li>Open the <em class="italic">Tip Calculator</em> app with Android Studio 4.0 or higher.</li>
				<li>Open the <code>activity_output.xml</code> file in the <code>res/layout</code> directory.</li>
				<li>Add <code>app:motionDebug="SHOW_ALL"</code> to the <code>MotionLayout</code> container. This will allow us to see the path and progress information in Android Studio and on our device/emulator. Your <code>MotionLayout</code> container will look like the following:<pre class="source code">
&lt;androidx.constraintlayout.motion.widget.MotionLayout
      ...
    app:motionDebug="SHOW_ALL"&gt;</pre></li>
				<li>Run the app and make a computation. On the output screen, tap on the image. Look at the tip text while the animation is in progress. Note that the text is covered by the image in t<a id="_idTextAnchor900"/><a id="_idTextAnchor901"/>he middle of the animation, as shown in <em class="italic">Figure 16</em><em class="italic">.14</em>:</li>
			</ol>
			<div><div><img src="img/B19411_16_14.jpg" alt="Figure 16.14 – The image hides the TextView displaying the tip"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.14 – The image hides the TextView displaying the tip</p>
			<ol>
				<li value="5">Go back <a id="_idIndexMarker1386"/>to the <code>activity_output.xml</code> file in <a id="_idIndexMarker1387"/>Android Studio. Make sure it’s opened in the <strong class="bold">Design</strong> view.</li>
				<li>In the <code>start_constraint</code> and <code>end_constraint</code>. Drag the down arrow in the <strong class="bold">Selectio<a id="_idTextAnchor902"/><a id="_idTextAnchor903"/>n</strong> panel to the middle (50%), as shown in <em class="italic">Figure 16</em><em class="italic">.15</em>:</li>
			</ol>
			<div><div><img src="img/B19411_16_15.jpg" alt="Figure 16.15 – Selecting the arrow representing  transition between  start and end constraints"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.15 – Selecting the arrow representing  transition between  start and end constraints</p>
			<ol>
				<li value="7">Click<a id="_idIndexMarker1388"/> the <strong class="bold">Create KeyFrames</strong> icon to<a id="_idIndexMarker1389"/> the right of <strong class="bold">Transition</strong> in the <strong class="bold">Selection</strong> panel (th<a id="_idTextAnchor904"/><a id="_idTextAnchor905"/>e one with a green <strong class="bold">+</strong> symbol), as shown in <em class="italic">Figure 16</em><em class="italic">.16</em>:</li>
			</ol>
			<div><div><img src="img/B19411_16_16.jpg" alt="Figure 16.16 – The Create KeyFrames icon"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.16 – The Create KeyFrames icon</p>
			<ol>
				<li value="8">Select <strong class="bold">KeyPosition</strong>. We <a id="_idIndexMarker1390"/>will be using <strong class="bold">KeyPosition</strong> to adjust<a id="_idIndexMarker1391"/> the image in the output screen so that it will not overlap with the text containing the tip.</li>
				<li>Select <code>50</code>. The type is <code>parentRelative</code>, and the <code>1.5</code>, as shown in <em class="italic">Figure 16</em><em class="italic">.17</em>. This will add a <strong class="bold">KeyPosition</strong> attribute for the image in the middle (50%) of the transition, <a id="_idTextAnchor906"/><a id="_idTextAnchor907"/>which is 1.5 times relative to the <em class="italic">x</em> axis of the parent:</li>
			</ol>
			<div><div><img src="img/B19411_16_17.jpg" alt="Figure 16.17 – Provide the input to the key position to be made"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.17 – Provide the input to the key position to be made</p>
			<ol>
				<li value="10">Click the <code>ImageView</code>. That will now be to the right of <code>TextView</code>:</li>
			</ol>
			<div><div><img src="img/B19411_16_18.jpg" alt="Figure 16.18 – Path will now be curved;  Transition panel will have new item for KeyPosition"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.18 – Path will now be curved;  Transition panel will have new item for KeyPosition</p>
			<ol>
				<li value="11">Click the<a id="_idIndexMarker1394"/> play icon to see how it will <a id="_idIndexMarker1395"/>animate. Run the application to verify it on a device or emulator. You will see that the animation is now curving to the right instead of ta<a id="_idTextAnchor910"/>kin<a id="_idTextAnchor911"/>g its previous straight path, as shown in <em class="italic">Figure 16</em><em class="italic">.19</em>:</li>
			</ol>
			<div><div><img src="img/B19411_16_19.jpg" alt="Figure 16.19 – The animation now avoids TextView with the tip"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.19 – The animation now avoids TextView with the tip</p>
			<ol>
				<li value="12">The <a id="_idIndexMarker1396"/>Motion Editor will automatically <a id="_idIndexMarker1397"/>generate the code for <code>KeyPosition</code>. If you go to the <code>motion_scene.xml</code> file, you will see that the Motion Editor added the following code in the transition attribute:<pre class="source code">
&lt;KeyFrameSet&gt;
    &lt;KeyPosition
        app:framePosition="50"
        app:keyPositionType="parentRelative"
        app:motionTarget="@+id/image"
        app:percentX="1.5" /&gt;
&lt;/KeyFrameSet&gt;</pre></li>
			</ol>
			<p>A <code>KeyPosition</code> attribute was added to the keyframes during the transition. At 50% of the animation, the image’s <em class="italic">x</em> position is moved 1.5 times relative to its parent view. This <a id="_idIndexMarker1398"/>allows the image to avoid other <a id="_idIndexMarker1399"/>elements during the animation process.</p>
			<p>In this exercise, you have added a key position that will adjust the <code>MotionLayout</code> animation, ensuring that it will not block or be blocked by another view in its path.</p>
			<p>Le<a id="_idTextAnchor912"/>t’s test everything yo<a id="_idTextAnchor913"/>u’ve learned by doing another activity.</p>
			<h2 id="_idParaDest-280"><a id="_idTextAnchor914"/>Activity 16.01 – Password Generator</h2>
			<p>Using a strong password is <a id="_idIndexMarker1400"/>important to secure our online accounts. It must be unique and must include uppercase and lowercase letters, numbers, and special characters. In this activity, you will develop an app that can generate a strong password.</p>
			<p>The app will have two screens – the input screen and the output screen. In the input screen, a user can provide the length of a password and specify whether it must have uppercase or lowercase letters, numbers, or special characters.</p>
			<p>The output screen will display three possible passwords, and when the user selects one, the other passwords will move away, and a button will display to copy the password to the clipboard. You should customize the transition from the input screen to the output screen.</p>
			<p>The steps to complete are as follows:</p>
			<ol>
				<li>Create a new project in Android Studio 4.0 or higher and name it <code>Password Generator</code>. Set its package name and <strong class="bold">Minimum SDK</strong>.</li>
				<li>Add the <code>MaterialComponents</code> dependency to your <code>app/build.gradle</code> file.</li>
				<li>Update the dependency for <code>ConstraintLayout</code>.</li>
				<li>Make sure that the activity’s theme uses one from <code>MaterialComponents</code> in the <code>themes.xml</code> file.</li>
				<li>In the <code>activity_main.xml</code> file, remove the <code>Hello World</code> <code>TextView</code> and add the input text field for the length.</li>
				<li>Add the code for checkboxes for uppercase, numbers, and special characters.</li>
				<li>Add a <strong class="bold">Generate</strong> button at the bottom of the checkboxes.</li>
				<li>Create another activity and name it <code>OutputActivity</code>.</li>
				<li>Customize the activity transition from the input screen (<code>MainActivity</code>) as <code>OutputActivity</code>. Open <code>themes.xml</code> and update the activity theme with the <code>windowActivityTransitions</code>, <code>windowEnterTransition</code>, and <code>windowExitTransition</code> style attributes.</li>
				<li>Update the end of the <code>onCreate</code> function in <code>MainActivity</code>.</li>
				<li>Update the code for <code>androidx.constraintlayout.widget.ConstraintLayout</code> in the <code>activity_output.xml</code> file.</li>
				<li>Add <code>app:layoutDescription="@xml/motion_scene"</code> and <code>app:motion</code><strong class="source inline">
Debug="SHOW_ALL"</strong> to the <code>MotionLayout</code> tag.</li>
				<li>Add three instances of <code>TextView</code> to the output activity for the three passwords generated.</li>
				<li>Add a <strong class="bold">Copy</strong> button at <a id="_idIndexMarker1401"/>the bottom of the screen.</li>
				<li>Add the <code>generatePassword</code> function in <code>OutputActivity</code>.</li>
				<li>Add the code to generate the three passwords based on user input, and add a <code>ClickListener</code> component to the <strong class="bold">Copy</strong> button for a user to copy the selected password to the clipboard.</li>
				<li>In <code>OutputActivity</code>, create an animation per the password <code>TextView</code>.</li>
				<li>Create <code>ConstraintSet</code> for the default view.</li>
				<li>Add <code>ConstraintSet</code> when the first, second, and third passwords are selected.</li>
				<li>Next, add <code>Transition</code> when each password is selected.</li>
				<li>Run the application by going to the <strong class="bold">Run</strong> menu and clicking the <strong class="bold">Run app</strong> menu item.</li>
				<li>Input a length, select the checkboxes for uppercase, numbers, and special characters, and tap on the <strong class="bold">Generate</strong> button. Three passwords will be displayed.</li>
				<li>Select one and the rest will move out of view. A <strong class="bold">Copy</strong> button will also be displayed. Click on it and check whether the password you selected is now on the clipboard. The initial and<a id="_idIndexMarker1402"/> f<a id="_idTextAnchor915"/><a id="_idTextAnchor916"/>inal state of the output screen will be similar to <em class="italic">Figure 16</em><em class="italic">.20</em>:</li>
			</ol>
			<div><div><img src="img/B19411_16_20.jpg" alt="Figure 16.20 – The start and end state of MotionLayout in the Password Generator app"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.20 – The start and end state of MotionLayout in the Password Generator app</p>
			<p class="callout heading">Note</p>
			<p class="callout">The solution to this activity can be found at <a href="https://packt.link/By7eE">https://packt.link/By7eE</a>.</p>
			<h1 id="_idParaDest-281"><a id="_idTextAnchor917"/>Summary</h1>
			<p>This chapter covered creating animations and transitions with <code>CoordinatorLayout</code> and <code>MotionLayout</code>. Animations can improve the usability of our app and make it stand out compared to other apps.</p>
			<p>We started by customizing the transition when opening and closing an activity with activity transitions. We also learned about adding shared element transitions when an activity and the activity that it opens both contain the same elements, enabling us to highlight this link between the shared elements to users.</p>
			<p>We learned how we can use <code>CoordinatorLayout</code> to handle the motion of its child views. Some views have built-in behaviors that handle how they work inside <code>CoordinatorLayout</code>. You can add custom behaviors to other views too. Then, we moved on to using <code>MotionLayout</code> to create animations by specifying the start constraint, end constraint, and the transition between them. We also looked into modifying the motion path by adding keyframes in the middle of an animation. We learned about keyframes such as <code>KeyPosition</code>, which can change a view’s position, and <code>KeyAttribute</code>, which can change the view’s style. We also looked into using the Motion Editor in Android Studio to simplify the creation and previewing of animations and modifying the path.</p>
			<p>In the next chapter, we’ll learn about the Google Play store. We’ll discuss how you can create an account and prepare your apps for release, as well as how you can publish them for users to download and use.</p>
		</div>
	</body></html>