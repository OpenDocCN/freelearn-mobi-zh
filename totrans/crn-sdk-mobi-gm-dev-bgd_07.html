<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Physics: Falling Objects"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Physics: Falling Objects</h1></div></div></div><div class="blockquote"><blockquote class="blockquote"><p>There are many variations on how to incorporate the physics engine using display objects. So far we have worked with removing objects with collisions, moving objects through the stage area, and launching objects by applying force against gravity, just to name a few. Now we're going to explore another mechanism that allows gravity to control the environment. The next game we'll be creating deals with falling physical objects.</p></blockquote></div><p>Points that will be discussed in this chapter are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Working with more physics bodies</li><li class="listitem" style="list-style-type: disc">Customizing the body construction</li><li class="listitem" style="list-style-type: disc">Tracking the objects caught</li><li class="listitem" style="list-style-type: disc">Working with post-collisions</li><li class="listitem" style="list-style-type: disc">Creating falling objects</li></ul></div><p>Here's to creating another fun simple game in this segment. Let's get cracking!</p><div class="section" title="Creating our new game: Egg Drop"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec01"/>Creating our new game: Egg Drop</h1></div></div></div><p>Every step taken so far has taught us more about game development on the iOS/Android devices. In this new segment, our game will include sound effects, which will enhance the sensory experience in our games.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip07"/>Tip</h3><p>Be sure that you are using the latest stable build of Corona SDK Version 2011.704.</p></div><p>The new game we will be creating is called<span class="strong"><strong> Egg Drop.</strong></span> The player controls the main character, which is a lumberjack with a frying pan. During gameplay, eggs start falling from the sky and it is the lumberjack's job to catch the eggs in his frying pan and not let them hit the ground. Every egg caught earns 500 points. The player starts with 3 lives. When an egg fails to hit the frying pan and hits the ground, a life is lost. When all 3 lives are gone, the game is over.<a id="id490" class="indexterm"/>
</p><p>When starting the new game project, be sure to grab the <code class="literal">Egg Drop</code> file from the <code class="literal">Chapter 7</code> folder. You can download the project files accompanying this book from the Packt website<a class="ulink" href="http://www.packt.com"> www.packt.com</a>. It contains all the necessary files that are built-out for you, such as the <code class="literal">build.settings, config.lua, ui.lua</code>, audio files, and art assets needed for the game. You'll then have to create a brand new <code class="literal">main.lua</code> file in the project folder before you start coding.</p><div class="mediaobject"><img src="graphics/1888_07_01.jpg" alt="Creating our new game: Egg Drop"/></div><div class="section" title="Starting variables"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec01"/>Starting variables</h2></div></div></div><p>This will be our first full game setup filled with notable Corona SDK features. We'll be combining our base knowledge of what we learned so far with variables, display objects, the physics engine, touch/accelerometer events, and audio. Many of Corona's APIs are easy to use and understand. This shows the fast learning curve with Corona just by having basic to no knowledge of programming.<a id="id491" class="indexterm"/>
</p></div></div></div>
<div class="section" title="Time for action&#x2014;setting up the variables"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec02"/>Time for action—setting up the variables</h1></div></div></div><p>Let's get started with introducing the variables we'll be using to create our game. There will be a combination of display objects, integers to keep count, and pre-loading the main sound effects during gameplay.<a id="id492" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Hide the status bar and add in <code class="literal">display.newGroup()</code> called <code class="literal">gameGroup</code>.<div class="informalexample"><pre class="programlisting">display.setStatusBar( display.HiddenStatusBar )
local gameGroup = display.newGroup()
</pre></div></li><li class="listitem">Include the external modules in the game.<div class="informalexample"><pre class="programlisting">local sprite = require "sprite"
local physics = require "physics"
local ui = require "ui"
</pre></div></li><li class="listitem">Add in the display objects.<div class="informalexample"><pre class="programlisting">local background
local ground
local charObject
local friedEgg
local scoreText
local eggText
local livesText
local shade
local gameOverScreen
</pre></div></li><li class="listitem">Add in the variables.<div class="informalexample"><pre class="programlisting">local gameIsActive = false
local startDrop
local gameLives = 3
local gameScore = 0
local eggCount = 0
local mRand = math.random
</pre></div></li><li class="listitem">Create the egg boundaries and density.<div class="informalexample"><pre class="programlisting">local eggDensity = 1.0
local eggShape = { -12,-13, 12,-13, 12,13, -12,13 }
local panShape = { 15,-13, 65,-13, 65,13, 15,13 }
</pre></div></li><li class="listitem">Set up the accelerometer and audio.<div class="informalexample"><pre class="programlisting">system.setAccelerometerInterval( 100 )
local eggCaughtSound = audio.loadSound( "friedEgg.wav" )
local gameOverSound = audio.loadSound( "gameover.wav" )
</pre></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec02"/>What just happened?</h2></div></div></div><p>We have continued creating a similar setup of our variables like in the Panda Star Catcher game. It's more efficient to organize them by separating groups, display objects, audio, and so on.<a id="id493" class="indexterm"/>
</p><p>Many of the variables displayed have designated integers that fulfill the goals of gameplay. This includes values such as <code class="literal">gameLives = 3</code> and <code class="literal">eggCount = 0</code>.</p></div><div class="section" title="Controlling the main character"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec03"/>Controlling the main character</h2></div></div></div><p>Accelerometer events work best with the main scope of the game. It enables you to view the full real estate of the game environment without having to interact with touches on the screen. Necessary touch events would make sense for user interface buttons such as pause, menu, play, and so on.<a id="id494" class="indexterm"/>
</p></div></div>
<div class="section" title="Time for action&#x2014;moving the character"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec03"/>Time for action—moving the character</h1></div></div></div><p>Eggs will be falling in all different areas of the screen from the sky. Let's prepare our main character to move through all potential areas on the screen.<a id="id495" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Set up a new local function called <code class="literal">moveChar()</code> with an <code class="literal">event</code> parameter.<div class="informalexample"><pre class="programlisting">local moveChar = function(event)
</pre></div></li><li class="listitem">Add in the accelerometer movement for the character.<div class="informalexample"><pre class="programlisting">charObject.x = display.contentCenterX -
(display.contentCenterX * (event.yGravity * 3))
</pre></div></li><li class="listitem">Create character boundaries where they moves on the screen. This enables the character to stay within the game screen and not go past the offscreen boundaries.<div class="informalexample"><pre class="programlisting">if((charObject.x - charObject.width * 0.5) &lt; 0) then
charObject.x = charObject.width * 0.5
elseif((charObject.x + charObject.width * 0.5) &gt;
display.contentWidth) then
charObject.x = display.contentWidth - charObject.width *
0.5
end
end
</pre></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec04"/>What just happened?</h2></div></div></div><p>To make the accelerometer movement work with a device, we have to use <code class="literal">yGravity</code>.<a id="id496" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note18"/>Note</h3><p>Accelerometer events are based on portrait scale when <code class="literal">xGravity</code> and <code class="literal">yGravity</code> are used accordingly. When display objects are designated for landscape mode, <code class="literal">xGravity</code> and <code class="literal">yGravity</code> values are switched to compensate for the events to work properly.</p></div><p>You will notice that the code in step 3 keeps the <code class="literal">charObject</code> from going past any wall border boundaries.</p></div><div class="section" title="Have a go hero—adding touch events"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec05"/>Have a go hero—adding touch events</h2></div></div></div><p>The character is currently controlled by the accelerometer. Another option to control the character is through a touch event. Try replacing the event listener with<code class="literal">"touch"</code> and using event parameters so the touch event works properly.<a id="id497" class="indexterm"/>
</p><p>If you remember how we incorporated the paddle movement with Breakout in<a class="link" href="ch03.html" title="Chapter 3. Building our First Game: Breakout"> Chapter 3</a>,<span class="emphasis"><em> Building our First Game: Breakout</em></span> and<a class="link" href="ch04.html" title="Chapter 4. Game Controls"> Chapter 4</a>,<span class="emphasis"><em> Game Controls</em></span> for the simulator, it should be very similar.</p></div><div class="section" title="Updating the score"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec06"/>Updating the score</h2></div></div></div><p>When the score is updated, it refers to our text display objects and translates the value from the number into a string.<a id="id498" class="indexterm"/>
</p><p>For example:</p><div class="informalexample"><pre class="programlisting">gameScore = 100
scoreText = display.newText( "Score: " .. gameScore, 0, 0, "Arial",
45 )
scoreText:setTextColor( 255, 255, 255, 255 )
scoreText.x = 160; scoreText.y = 100
</pre></div><p>In the previous example, you will notice that we have set a values of <code class="literal">100</code> to <code class="literal">gameScore</code>. In the following lines for <code class="literal">scoreText</code>, the <code class="literal">gameScore</code> is used to concatenate the string,<code class="literal">"Score: "</code> and the value of <code class="literal">gameScore</code>. Doing so displays the value of <code class="literal">gameScore</code> in a string format by <code class="literal">scoreText</code>.</p></div></div>
<div class="section" title="Time for action&#x2014;setting the score"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec04"/>Time for action—setting the score</h1></div></div></div><p>Who doesn't like some friendly competition? We're familiar with scoreboards from the games we've made in the previous chapters. So we are no strangers on how to track the score.<a id="id499" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create a local function called <code class="literal">setScore()</code> with a parameter called <code class="literal">scoreNum</code>.<div class="informalexample"><pre class="programlisting">local setScore = function( scoreNum )
</pre></div></li><li class="listitem">Set variables to count the score.<div class="informalexample"><pre class="programlisting">local newScore = scoreNum
gameScore = newScore
if gameScore &lt; 0 then gameScore = 0; end
</pre></div></li><li class="listitem">Have the score updated when points are earned in gameplay and close the function.<div class="informalexample"><pre class="programlisting">scoreText.text = "Score: " .. gameScore
scoreText.xScale = 0.5; scoreText.yScale = 0.5
scoreText.x = (scoreText.contentWidth * 0.5) + 15
scoreText.y = 15
end
</pre></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec07"/>What just happened?</h2></div></div></div><p>When <code class="literal">setScore(scoreNum)</code> is called within any function, it will refer to all methods using the variable <code class="literal">gameScore</code>. Assuming that the <code class="literal">gameScore = 0</code> at the start of the application, the value increments to what the <code class="literal">gameScore</code> is set to.</p><p>In <code class="literal">scoreText.text = "Score: " .. gameScore, "Score: "</code> is the string that displays on the device during gameplay. <code class="literal">gameScore</code> takes the current value given to the variable and displays it as a string.</p></div><div class="section" title="Displaying the environment"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec08"/>Displaying the environment</h2></div></div></div><p>A logical setting for your display objects helps the player envision the relationship between the main character and the environment. Since our main character is a lumberjack, it would make sense to have him set in a forest or an area focused entirely on nature.<a id="id500" class="indexterm"/>
</p></div></div>
<div class="section" title="Time for action&#x2014;drawing the background"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec05"/>Time for action—drawing the background</h1></div></div></div><p>In this section, we'll be filling the screen with our environment display objects. This includes our background and ground objects respectively and adding physical elements to our ground so that we can designate collision events for it.<a id="id501" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create a local function called <code class="literal">drawBackground()</code>.<div class="informalexample"><pre class="programlisting">local drawBackground = function()
</pre></div></li><li class="listitem">Add in the background image.<div class="informalexample"><pre class="programlisting">background = display.newImageRect( "bg.png", 480, 320 )
background.x = 240; background.y = 160
gameGroup:insert( background )
</pre></div></li><li class="listitem">Add in the ground elements and create the ground physical boundary. Close the function.<a id="id502" class="indexterm"/><div class="informalexample"><pre class="programlisting">ground = display.newImageRect( "grass.png", 480, 75 )
ground.x = 240; ground.y = 325
ground.myName = "ground"
local groundShape = { -285,-18, 285,-18, 285,18, -285,18 }
physics.addBody( ground, "static", { density=1.0, bounce=0,
friction=0.5, shape=groundShape } )
gameGroup:insert( ground )
end
</pre></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec09"/>What just happened?</h2></div></div></div><p>The <code class="literal">background</code> and <code class="literal">ground</code> display objects are placed in the function called <code class="literal">drawBackground()</code>. The function <code class="literal">display.newImageRect()</code> is used since we are incorporating<span class="strong"><strong> Dynamic Scaling</strong></span> on some of our images. The <code class="literal">ground</code> display object has a customized physical shape that is not of the same size as the original display object.</p><p>Our <code class="literal">background</code> object is centered to the dimensions of the device screen area and inserted into <code class="literal">gameGroup</code>.</p><p>The <code class="literal">ground</code> display object is placed near the bottom of the display area. It is assigned a name through <code class="literal">ground.myName = "ground"</code>. We'll be using the name<code class="literal">"ground"</code> later on for determining collision events. A customized physical boundary is made for ground through <code class="literal">groundShape</code>. This allows the body of the ground to affect the assigned dimensions of the display object. When <code class="literal">physics.addBody()</code> is initialized, we use <code class="literal">groundShape</code> as the shape parameter. Next, <code class="literal">ground</code> is set to <code class="literal">gameGroup</code> as well.</p></div><div class="section" title="Displaying the heads-up display"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec10"/>Displaying the heads-up display</h2></div></div></div><p>In gaming, the<span class="strong"><strong> heads-up display (HUD)</strong></span> is the method used to relay information visually to the player. In many games, the common features displayed are health/lives, time, weapons, menus, maps, and so on. This keeps your player on alert to what is currently happening during gameplay. When it comes to tracking your lives, you want to be informed how many are left before your character runs out of chances to continue playing and the game ends.<a id="id503" class="indexterm"/>
</p></div></div>
<div class="section" title="Time for action&#x2014;designing the HUD"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec06"/>Time for action—designing the HUD</h1></div></div></div><p>While trying to make the player's gaming experience an enjoyable one, it's important that the information displayed is relevant to the game and placed strategically so it doesn't interfere with the main gaming area.<a id="id504" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create a new local function called <code class="literal">hud()</code>.<div class="informalexample"><pre class="programlisting">local hud = function()
</pre></div></li><li class="listitem">Display the text for the eggs that are caught during gameplay.<div class="informalexample"><pre class="programlisting">eggText = display.newText( "Caught: " .. eggCount, 0, 0,
"Arial", 45 )
eggText:setTextColor( 255, 255, 255, 255 )
eggText.xScale = 0.5; eggText.yScale = 0.5
eggText.x = (480 - (eggText.contentWidth * 0.5)) - 15
eggText.y = 305
gameGroup:insert( eggText )
</pre></div></li><li class="listitem">Add in the text to track the lives.<div class="informalexample"><pre class="programlisting">livesText = display.newText( "Lives: " .. gameLives, 0, 0,
"Arial", 45 )
livesText:setTextColor( 255, 255, 255, 255 ) --&gt; white
livesText.xScale = 0.5; livesText.yScale = 0.5 --&gt; for
clear retina display text
livesText.x = (480 - (livesText.contentWidth * 0.5)) - 15
livesText.y = 15
gameGroup:insert( livesText )
</pre></div></li><li class="listitem">Add in text for the score and close the function.<div class="informalexample"><pre class="programlisting">scoreText = display.newText( "Score: " .. gameScore, 0, 0,
"Arial", 45 )
scoreText:setTextColor( 255, 255, 255, 255 ) --&gt; white
scoreText.xScale = 0.5; scoreText.yScale = 0.5 --&gt; for
clear retina display text
scoreText.x = (scoreText.contentWidth * 0.5) + 15
scoreText.y = 15
gameGroup:insert( scoreText )
end
</pre><div class="mediaobject"><img src="graphics/1888_07_02.jpg" alt="Time for action—designing the HUD"/></div></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec11"/>What just happened?</h2></div></div></div><p>The <code class="literal">eggText</code> display object will be found near the bottom-right corner of the screen. It's still in view to the user while in gameplay and stays out of the main focus point at the same time. Notice that <code class="literal">eggText = display.newText( "Caught: " .. eggCount, 0, 0, "Arial", 45 )</code> will refer to <code class="literal">eggCount</code> when the value is updated.<a id="id505" class="indexterm"/>
</p><p>The <code class="literal">livesText</code> display object setup is similar to <code class="literal">eggText</code>. It is placed in the top right-hand corner of the screen. The placement for this object is rather prominent because of its importance in the game. It's in an area that is noticeable from the background and allows the player to refer to during the game. <code class="literal">livesText</code> decrements the number when <code class="literal">gameLives</code> is updated.</p><p>The initial setup for <code class="literal">scoreText</code> starts in the <code class="literal">hud()</code> function. It is placed on the top left-hand corner of the screen, opposite from <code class="literal">livesText</code>.</p></div><div class="section" title="Creating the game lives"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec12"/>Creating the game lives</h2></div></div></div><p>If there are no consequences in a game, then there is no sense of urgency to complete the main objectives. To keep a player engaged during gameplay, introducing elements that add some challenging aspects will keep the competitiveness and excitement going. Adding consequences in a game creates tension for the player and gives them more motivation to stay alive.<a id="id506" class="indexterm"/>
</p></div></div>
<div class="section" title="Time for action&#x2014;counting the lives"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec07"/>Time for action—counting the lives</h1></div></div></div><p>Tracking the lives left in the game keeps the player updated on how much sooner it will be until the game is over.<a id="id507" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Set up the function called <code class="literal">livesCount()</code>.<div class="informalexample"><pre class="programlisting">local livesCount = function()
</pre></div></li><li class="listitem">Display the text for lives every time the number is decremented.<div class="informalexample"><pre class="programlisting">gameLives = gameLives - 1
livesText.text = "Lives: " .. gameLives
livesText.xScale = 0.5; livesText.yScale = 0.5 --&gt; for
clear retina display text
livesText.x = (480 - (livesText.contentWidth * 0.5)) - 15
livesText.y = 15
print(gameLives .. " eggs left")
if gameLives &lt; 1 then
callGameOver()
end
end
</pre></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec13"/>What just happened?</h2></div></div></div><p>
<code class="literal">livesCount()</code> is a separate function that updates <code class="literal">gameLives</code>. It makes sure that you're aware that <code class="literal">gameLives = gameLives -1</code>. This decreases the set value instantiated at the beginning of the code. When <code class="literal">gameLives</code> changes values, it displays the update through <code class="literal">livesText</code>. The <code class="literal">print</code> statement is used towards the end of the function to track the count in the terminal window.</p><p>When <code class="literal">gameLives &lt; 1</code>, the <code class="literal">callGameOver()</code> function will be called, which will show the game over elements of the game.</p></div><div class="section" title="Have a go hero—adding images for the game lives"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec14"/>Have a go hero—adding images for the game lives</h2></div></div></div><p>Currently, the game uses display text on screen to show the count of how many lives are left during gameplay. A way to make the HUD display more appealing is by creating/adding small icons that correlate with the game such as eggs or a frying pan.<a id="id508" class="indexterm"/>
</p><p>Three separate display objects need to be created and placed in an orderly fashion so that when a life is taken away, the alpha of the object is reduced to <code class="literal">0.5</code>.</p><p>A method needs to be created so that all the three display objects are affected when the game lives are reduced to <code class="literal">0.</code>
<a id="id509" class="indexterm"/>
</p></div><div class="section" title="Introducing the main character"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec15"/>Introducing the main character</h2></div></div></div><p>Our main character will be animated for every action applied during gameplay. We will also create a<span class="strong"><strong> complex body construction</strong></span> since the focus on its collision points will be towards the object he is holding and not his entire body.<a id="id510" class="indexterm"/>
</p><div class="section" title="Complex body construction"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec01"/>Complex body construction</h3></div></div></div><p>It is also possible to construct a body from multiple elements. Each body element is specified as a separate polygon shape with its own physical properties.<a id="id511" class="indexterm"/>
</p><p>Since collision polygons in<span class="strong"><strong> Box2D</strong></span> must be convex, any game object with a concave shape must be constructed by appending multiple body elements.</p><p>The constructor for a complex body is the same as the simple polygon body constructor, except with more than one body element listed:</p><div class="informalexample"><pre class="programlisting">physics.addBody( displayObject, [bodyType,] bodyElement1,
[bodyElement2, ...] )
</pre></div><p>Each body element may have its own physical properties, along with a shape definition for its collision boundaries. For example:</p><div class="informalexample"><pre class="programlisting">local hexagon = display.newImage("hexagon.png")
hexagon.x = hexagon.contentWidth
hexagon.y = hexagon.contentHeight
hexagonShape = { -20,-40, 20, -40, 40, 0, 20,40, -20,40, -40,0 }
physics.addBody( hexagon, "static", { density = 1.0, friction = 0.8,
bounce = 0.3, shape=hexagonShape } )
</pre></div><p>As in simpler cases, the <code class="literal">bodyType</code> attribute is optional and will default to<code class="literal">"dynamic"</code> if not specified.</p></div></div></div>
<div class="section" title="Time for action&#x2014;creating the character"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec08"/>Time for action—creating the character</h1></div></div></div><p>The main character was created with a sprite sheet and needs to be set up to view the animation it provides. Other display images that will make an appearance include a cracked egg when a collision to a physical object has been made.<a id="id512" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create a new local function called <code class="literal">createChar()</code>.<div class="informalexample"><pre class="programlisting">local createChar = function()
</pre></div></li><li class="listitem">Create the sprite sheet for the main character.<div class="informalexample"><pre class="programlisting">local characterSheet = sprite.newSpriteSheet
( "charSprite.png",128, 128 )
local spriteSet = sprite.newSpriteSet(characterSheet, 1, 4)
sprite.add( spriteSet, "move", 1, 4, 400, 0 )
charObject = sprite.newSprite( spriteSet )
charObject:prepare("move")
charObject:play()
</pre></div></li><li class="listitem">Set the starting position and physical properties for the main character.<a id="id513" class="indexterm"/><div class="informalexample"><pre class="programlisting">charObject.x = 240; charObject.y = 250
physics.addBody( charObject, "static", { density=1.0,
bounce=0.4, friction=0.15, shape=panShape } )
charObject.rotation = 0
charObject.isHit = false
charObject.myName = "character"
</pre></div></li><li class="listitem">Add in the transition image after the egg has made a collision.<div class="informalexample"><pre class="programlisting">friedEgg = display.newImageRect( "friedEgg.png", 40, 23 )
friedEgg.alpha = 1.0
friedEgg.isVisible = false
gameGroup:insert( charObject )
gameGroup:insert( friedEgg )
end
</pre><div class="mediaobject"><img src="graphics/1888_07_03.jpg" alt="Time for action—creating the character"/></div></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec16"/>What just happened?</h2></div></div></div><p>The sprite sheet being referred to is called <code class="literal">spriteSet</code> and takes the first <code class="literal">4</code> frames of animation from<code class="literal">"charSprite.png"</code>. We created an animation set through <code class="literal">sprite.add( spriteSet, "move", 1, 4, 400, 0 )</code>. Every time<code class="literal">"move"</code> is called, it starts the animation from frame <code class="literal">1</code> and plays <code class="literal">4</code> frames from the start at <code class="literal">400</code> milliseconds.<a id="id514" class="indexterm"/>
</p><p>The main display object is called <code class="literal">charObject</code> that takes on the characteristics of <code class="literal">spriteSet</code>. When it calls <code class="literal">prepare("move")</code>, that animation sequence plays when the <code class="literal">play()</code> command is executed.</p><p>An important change to the physical body of the character is that its main collision point will be directed towards the frying pan used in the animation. Any collision detection on the character's body will not be read. The <code class="literal">charObject</code> is given a name called<code class="literal">"character"</code>, which will be used to detect the collision even with the falling egg.</p><p>We have also placed the fried egg in this function for preparation on the collision.</p></div><div class="section" title="Adding post-collisions"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec17"/>Adding post-collisions</h2></div></div></div><p>We want to make sure that an event type occurs right after an object has interacted with another object. At the instance of a post-collision, we can confirm the collision force between two objects. This helps us determine that the object that is destroyed was completed with a set amount of force.<a id="id515" class="indexterm"/>
</p><div class="section" title="Collision handling"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec02"/>Collision handling</h3></div></div></div><p>Be careful on how you handle the Box2D physics engine. It will crash during a collision if Corona code attempts to modify objects still involved in the collision, since Box2D is still working out iterated mathematics on them.<a id="id516" class="indexterm"/>
</p><p>For crash-proof collision detection, do not have collisions occur immediately.</p><p>Do not modify/create/destroy physics objects during a collision in order to prevent crashing.</p><p>If you need to modify/create/destroy an object as a result of a collision, your collision handler should set a flag or add a time delay so the change can occur later with <code class="literal">timer.performWithDelay()</code>.</p></div></div><div class="section" title="Body properties"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec18"/>Body properties</h2></div></div></div><p>Many of the native Box2D methods have been made into simpler dot properties for display objects. The following examples show that a body, <code class="literal">newBody</code>, has been created using one of the constructor methods.<a id="id517" class="indexterm"/>
</p><div class="section" title="body.isAwake"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec03"/>body.isAwake</h3></div></div></div><p>This is a Boolean for the current awake state. By default, all bodies automatically<span class="emphasis"><em> go to sleep</em></span> when there is no interaction with them for a couple of seconds. Bodies stop simulating until some kind of collision or other interaction wakes them up.<a id="id518" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">newBody.isAwake = true
local object = newBody.isAwake
</pre></div></div><div class="section" title="body.isBodyActive"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec04"/>body.isBodyActive</h3></div></div></div><p>This is a Boolean for the active state of a body. Inactive bodies are not destroyed, but they are removed from the simulation and cease to interact with other bodies.<a id="id519" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">newBody.isBodyActive = true
local object = newBody.isBodyActive
</pre></div></div><div class="section" title="body.isBullet"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec05"/>body.isBullet</h3></div></div></div><p>This is a Boolean for a body that is treated like a<span class="emphasis"><em> bullet</em></span>. Bullets are subject to continuous collision detection. The default is <code class="literal">false.</code>
<a id="id520" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">newBody.isBullet = true
local object = newBody.isBullet
</pre></div></div><div class="section" title="body.isSensor"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec06"/>body.isSensor</h3></div></div></div><p>This is a Boolean property that sets the <code class="literal">isSensor</code> property across all elements in the body. A sensor passes through other objects instead of bouncing off them, but detects some collision. This property acts across all body elements and will override any <code class="literal">isSensor</code> settings on the elements themselves.<a id="id521" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">newBody.isSensor = true
</pre></div></div><div class="section" title="body.isSleepingAllowed"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec07"/>body.isSleepingAllowed</h3></div></div></div><p>This is a Boolean for a body that is allowed to go to sleep. A body that is awake is useful in cases such as tilt-gravity since sleeping bodies do not respond to changes in global gravity. The default is <code class="literal">true.</code>
<a id="id522" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">newBody.isSleepingAllowed = true
local object = newBody.isSleepingAllowed
</pre></div></div><div class="section" title="body.isFixedRotation"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec08"/>body.isFixedRotation</h3></div></div></div><p>This is a Boolean for a body whose rotation should be locked, even if the body is about to load or subjected to off-center forces. The default is <code class="literal">false.</code>
<a id="id523" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">newBody.isFixedRotation = true
local object = newBody.isFixedRotation
</pre></div></div><div class="section" title="body.angularVelocity"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec09"/>body.angularVelocity</h3></div></div></div><p>This is the value of the current rotational velocity in degrees per second.<a id="id524" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">newBody.angularVelocity = 50
local myVelocity = newBody.angularVelocity
</pre></div></div><div class="section" title="body.linearDamping"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec10"/>body.linearDamping</h3></div></div></div><p>This is the value for how much the linear motion of a body is damped. This is the rate of decrease of angular velocity over time. The default is <code class="literal">0</code>
<a id="id525" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">newBody.linearDamping = 5
local object = newBody.linearDamping
<a id="id526" class="indexterm"/>
</pre></div></div><div class="section" title="body.angularDamping"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec11"/>body.angularDamping</h3></div></div></div><p>The value for how much the rotation of a body should be damped. The default is <code class="literal">0.</code>
<a id="id527" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">newBody.angularDamping = 5
local object = newBody.angularDamping
</pre></div></div><div class="section" title="body.bodyType"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl3sec12"/>body.bodyType</h3></div></div></div><p>This is a string value for the type of physical body being simulated. The available values are<code class="literal">"static", "dynamic"</code>, and<code class="literal">"kinematic":</code>
<a id="id528" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">static</code> bodies don't move or interact with each other. Examples of static objects would include the ground or the walls of a maze.</li><li class="listitem" style="list-style-type: disc"><code class="literal">dynamic</code> bodies are affected by gravity and collisions with other body types.</li><li class="listitem" style="list-style-type: disc"><code class="literal">kinematic</code> objects are affected by forces but not by gravity. Bodies that are draggable objects should be set to<code class="literal">"kinematic"</code> for the duration of the drag event.</li></ul></div><p>The default body type is<code class="literal">"dynamic"</code>.</p><div class="informalexample"><pre class="programlisting">newBody.bodyType = "kinematic"
local currentBodyType = newBody.bodyType
</pre></div></div></div></div>
<div class="section" title="Time for action&#x2014;creating the egg collision"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec09"/>Time for action—creating the egg collision</h1></div></div></div><p>We have handled collisions in the previous sample games we created. Handling post-collisions requires the introduction of force to execute the completion of a post-collision event.<a id="id529" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create a new local function called <code class="literal">onEggCollision()</code> with two parameters called <code class="literal">self</code> and <code class="literal">event</code>.<div class="informalexample"><pre class="programlisting">local onEggCollision = function( self, event )
</pre></div></li><li class="listitem">Create an <code class="literal">if</code> statement when force is greater than <code class="literal">1</code> and <code class="literal">not self.isHit</code>. Add in the <code class="literal">eggCaughtSound</code> sound effect.<div class="informalexample"><pre class="programlisting">if event.force &gt; 1 and not self.isHit then
audio.play( eggCaughtSound )
</pre></div></li><li class="listitem">Make <code class="literal">self</code> invisible and inactive and replace it with the <code class="literal">friedEgg</code> display object.<a id="id530" class="indexterm"/><div class="informalexample"><pre class="programlisting">self.isHit = true
print( "Egg destroyed!")
self.isVisible = false
friedEgg.x = self.x; friedEgg.y = self.y
friedEgg.alpha = 0
friedEgg.isVisible = true
</pre></div></li><li class="listitem">Create a function that transitions the <code class="literal">friedEgg</code> display object and makes it fade on the stage using the <code class="literal">onComplete</code> command.<div class="informalexample"><pre class="programlisting">local fadeEgg = function()
transition.to( friedEgg, { time=500, alpha=0 } )
end
transition.to( friedEgg, { time=50, alpha=1.0,
onComplete=fadeEgg } )
self.parent:remove( self )
self = nil
</pre></div></li><li class="listitem">Using <code class="literal">if event.other.myName == "character"</code>, update the <code class="literal">eggCount</code> when the main character catches the eggs. Also update the <code class="literal">gameScore</code> by <code class="literal">500</code> points for every collision. If the egg hits the ground, use <code class="literal">elseif event.other.myName == "ground"</code> and decrement the lives using <code class="literal">livesCount()</code>.<div class="informalexample"><pre class="programlisting">if event.other.myName == "character" then
eggCount = eggCount + 1
eggText.text = "Caught: " .. eggCount
eggText.xScale = 0.5; eggText.yScale = 0.5 --&gt; for
clear retina display text
eggText.x = (480 - (eggText.contentWidth * 0.5)) - 15
eggText.y = 305
print("egg caught")
local newScore = gameScore + 500
setScore( newScore )
elseif event.other.myName == "ground" then
livesCount()
print("ground hit")
end
end
end
</pre><div class="mediaobject"><img src="graphics/1888_07_04.jpg" alt="Time for action—creating the egg collision"/></div></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec19"/>What just happened?</h2></div></div></div><p>Using <code class="literal">onEggCollision( self, event )</code>, we set up the function with the <code class="literal">if</code> statement for <code class="literal">event.force &gt; 1 and not self.isHit</code>. When both statements return <code class="literal">true</code>, the sound effect for the egg plays. The initial egg falling from the sky is removed from the scene upon collision and replaced by the <code class="literal">friedEgg</code> display object in the same location using <code class="literal">friedEgg.x = self.x; friedEgg.y = self.y</code>.<a id="id531" class="indexterm"/>
</p><p>The function <code class="literal">fadeEgg()</code> makes the newly replaced egg object appear in <code class="literal">50</code> milliseconds by <code class="literal">transition.to( eggCrack, { time=50, alpha=1.0, onComplete=fadeCrack } )</code> and then with the <code class="literal">onComplete</code> command, returns the object to an invisible state with <code class="literal">transition.to( eggCrack, { time=500, alpha=0 } )</code>.</p><p>When the name<code class="literal">"character"</code> is called from <code class="literal">event.other.myName</code>, every collision is assigned to that name increments <code class="literal">eggCount + 1</code>. Therefore, the <code class="literal">eggText</code> is updated with <code class="literal">eggCount</code> value. <code class="literal">setScore( newScore )</code> increments the score by <code class="literal">500</code> with every collision made to<code class="literal">"character"</code>. When a collision is made to<code class="literal">"ground"</code>, the <code class="literal">livesCount()</code> function is called, which subtracts a life by <code class="literal">1</code>.</p></div><div class="section" title="Making the display objects fall"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec20"/>Making the display objects fall</h2></div></div></div><p>We're going to apply the main asset by learning how to add physical objects to the scene and have them fall in random areas in the game. The physics engine will take into account a dynamic physics body that we will create for the egg display object.<a id="id532" class="indexterm"/>
</p></div></div>
<div class="section" title="Time for action&#x2014;adding the egg object"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec10"/>Time for action—adding the egg object</h1></div></div></div><p>Imagine a world full of falling eggs. It's not entirely too realistic, but in this game, we're creating this element. At least we'll be making sure that the gravity and real-world physics will be applied.<a id="id533" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create a new local function called <code class="literal">eggDrop()</code>.<div class="informalexample"><pre class="programlisting">local eggDrop = function()
</pre></div></li><li class="listitem">Add in the <code class="literal">egg</code> display object properties.<div class="informalexample"><pre class="programlisting">local egg = display.newImageRect( "egg.png", 26, 30 )
egg.x = 240 + mRand( 120 ); egg.y = -100
egg.isHit = false
physics.addBody( egg, "dynamic",{ density=eggDensity,
bounce=0,friction=0.5, shape=eggShape } )
egg.isFixedRotation = true
gameGroup:insert( egg )
</pre></div></li><li class="listitem">Add in the <code class="literal">postCollision</code> event for the <code class="literal">egg</code> display object.<div class="informalexample"><pre class="programlisting">egg.postCollision = onEggCollision
egg:addEventListener( "postCollision", egg )
end
</pre><div class="mediaobject"><img src="graphics/1888_07_05.jpg" alt="Time for action—adding the egg object"/></div></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec21"/>What just happened?</h2></div></div></div><p>We have set the <code class="literal">egg</code> value for <code class="literal">x</code> to <code class="literal">240 + mRand( 120 )</code>. The <code class="literal">mRand</code> function equals to <code class="literal">math.random</code> , which will allow the <code class="literal">egg</code> to appear in randomized places in an area of <code class="literal">120</code> pixels starting at 50 in the x-direction.<a id="id534" class="indexterm"/>
</p><p>It is vital to make sure <code class="literal">egg.isHit = false</code> for the collision event to apply correctly. The physics body is set to<code class="literal">"dynamic"</code> so it reacts to gravity and makes the object fall. There is a customized density and shape made for the <code class="literal">egg</code> that we created, which is already made at the beginning of the code.</p><p>The last important detail for the collision to work is adding <code class="literal">egg</code> to the <code class="literal">onEggCollision()</code> function with <code class="literal">egg.postCollision = onEggCollision</code> and then making the event listener use the<code class="literal">"postCollision"</code> event with <code class="literal">egg:addEventListener( "postCollision", egg )</code>.</p></div></div>
<div class="section" title="Time for action&#x2014;making the egg drop"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec11"/>Time for action—making the egg drop</h1></div></div></div><p>We're going to execute the timer for the egg so they can start dropping them on the screen.<a id="id535" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create a local function called <code class="literal">eggTimer()</code> and use <code class="literal">timer.performWithDelay</code> to drop an egg every 1 second (1000 milliseconds) repeatedly. Use <code class="literal">eggDrop()</code> to activate the drop.<div class="informalexample"><pre class="programlisting">local eggTimer = function()
startDrop = timer.performWithDelay( 1000, eggDrop, 0 )
end
</pre></div></li><li class="listitem">Within the first <code class="literal">if</code> statement in the <code class="literal">onEggCollision()</code> function, cancel the timer using the <code class="literal">timerID, startDrop</code>. Add the statement <code class="literal">if gameLives &lt; 1</code> to stop the eggs from falling.<a id="id536" class="indexterm"/><div class="informalexample"><pre class="programlisting">if gameLives &lt; 1 then
timer.cancel( startDrop )
print("timer cancelled")
end
</pre></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec22"/>What just happened?</h2></div></div></div><p>In order for the eggs to start dropping from the sky, we created a function called <code class="literal">eggTimer()</code>. It activates the <code class="literal">eggDrop()</code> function by letting an egg drop after <code class="literal">1000</code> milliseconds (1 second) every time infinitely using <code class="literal">startDrop = timer.performWithDelay( 1000, eggDrop, 0 )</code>.</p><p>Backtracking to <code class="literal">onEggCollision()</code>, we want to check that <code class="literal">gameLives</code> has reached less than <code class="literal">1</code>. When this statement is true, the eggs will stop dropping. This is done by <code class="literal">timer.cancel( startDrop ). startDrop</code> is the <code class="literal">timerID</code> we set in <code class="literal">eggTimer()</code>.</p></div><div class="section" title="Ending the gameplay"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec23"/>Ending the gameplay</h2></div></div></div><p>Every start of a game always has an ending. Whether it is a simple<span class="emphasis"><em> You Win</em></span> or<span class="emphasis"><em> You lose</em></span> or just a<span class="emphasis"><em> Game Over</em></span> it gives closure for the player. It's important to notify a player of such events so that they can reflect on the achievements earned.<a id="id537" class="indexterm"/>
</p></div></div>
<div class="section" title="Time for action&#x2014;calling game over"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec12"/>Time for action—calling game over</h1></div></div></div><p>We are going to make sure that when a<span class="strong"><strong> Game Over</strong></span> display screen pops up, any of our display objects currently in motion stop moving and the event listeners are deactivated. Aside from the visual display of our<span class="strong"><strong> Game Over</strong></span> screen, we'll be adding a sound notification that will also help to trigger the event.<a id="id538" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create a new local function called <code class="literal">callGameOver()</code> and place it after the <code class="literal">setScore()</code> function and before the <code class="literal">drawBackground()</code> function.<div class="informalexample"><pre class="programlisting">local callGameOver = function()
</pre></div></li><li class="listitem">Introduce the sound effects when the<span class="strong"><strong> Game Over</strong></span> display pops up. Have <code class="literal">gameIsActive</code> set to <code class="literal">false</code> and pause the physics in the game.<div class="informalexample"><pre class="programlisting">audio.play( gameOverSound )
gameIsActive = false
physics.pause()
</pre></div></li><li class="listitem">Create a shade that overlays over the current background.<a id="id539" class="indexterm"/><div class="informalexample"><pre class="programlisting">shade = display.newRect( 0, 0, 570, 320 )
shade:setFillColor( 0, 0, 0, 255 )
shade.x = 240; shade.y = 160
shade.alpha = 0
</pre></div></li><li class="listitem">Display the<span class="strong"><strong> Game Over</strong></span> window and reiterate the final score.<div class="informalexample"><pre class="programlisting">gameOverScreen = display.newImageRect( "gameOver.png", 400,
300 )
local newScore = gameScore
setScore( newScore )
gameOverScreen.x = 240; gameOverScreen.y = 160
gameOverScreen.alpha = 0
gameGroup:insert( shade )
gameGroup:insert( gameOverScreen )
transition.to( shade, { time=200, alpha=0.65 } )
transition.to( gameOverScreen, { time=500, alpha=1 } )
</pre></div></li><li class="listitem">Have the<span class="strong"><strong> Score</strong></span> displayed on the<span class="strong"><strong> Game Over</strong></span> screen.<div class="informalexample"><pre class="programlisting">scoreText.isVisible = false
scoreText.text = "Score: " .. gameScore
scoreText.xScale = 0.5; scoreText.yScale = 0.5 --&gt; for
clear retina display text
scoreText.x = 240
scoreText.y = 160
scoreText:toFront()
timer.performWithDelay( 0,
function() scoreText.isVisible = true; end, 1 )
end
</pre><div class="mediaobject"><img src="graphics/1888_07_06.jpg" alt="Time for action—calling game over"/></div></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec24"/>What just happened?</h2></div></div></div><p>Our <code class="literal">gameOver()</code> function triggers our <code class="literal">gameOverSound</code> sound effect that we pre-loaded at the beginning of our code. We made sure no events such as the motion from the accelerometer are disabled through <code class="literal">gameIsActive = false</code>.<a id="id540" class="indexterm"/>
</p><p>The elements of our display objects appear at this point in time with <code class="literal">shade, gameOverScreen</code>, and <code class="literal">scoreText</code>.</p><p>If you notice, <code class="literal">scoreText</code> disappears when gameplay has ended by <code class="literal">scoreText.isVisible = false</code> and then reappears in a different area of the screen using <code class="literal">timer.performWithDelay( 0, function() scoreText.isVisible = true; end, 1 )</code>.</p></div><div class="section" title="Starting the game"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec25"/>Starting the game</h2></div></div></div><p>We're going to activate all the remaining functions and have them run accordingly.</p></div></div>
<div class="section" title="Time for action&#x2014;activating the game"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec13"/>Time for action—activating the game</h1></div></div></div><p>With all the gameplay elements set in place, it is time to get the application started.<a id="id541" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem">Create a new local function called <code class="literal">gameActivate()</code> and insert <code class="literal">gameIsActive = true</code>. Place the function above the <code class="literal">moveChar()</code> function.<div class="informalexample"><pre class="programlisting">local gameActivate = function()
gameIsActive = true
end
</pre></div></li><li class="listitem">Initialize all the game actions by making a new function called <code class="literal">gameStart()</code>.<div class="informalexample"><pre class="programlisting">local gameStart = function()
</pre></div></li><li class="listitem">Start the physics property and set the gravity for the falling object.<a id="id542" class="indexterm"/><div class="informalexample"><pre class="programlisting">physics.start( true )
physics.setGravity( 0, 9.8 )
</pre></div></li><li class="listitem">Activate all the functions instantiated. Add an event listener for the <code class="literal">charObject</code> using the<code class="literal">"touch"</code> for the <code class="literal">moveChar()</code> function.<div class="informalexample"><pre class="programlisting">drawBackground()
createChar()
eggTimer()
hud()
gameActivate()
Runtime:addEventListener("accelerometer", moveChar)
end
</pre></div></li><li class="listitem">Instantiate the <code class="literal">gameStart()</code> function and return the group <code class="literal">gameGroup</code>.<div class="informalexample"><pre class="programlisting">gameStart()
return gameGroup
</pre></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec26"/>What just happened?</h2></div></div></div><p>If you remember, in the beginning of our code, we set <code class="literal">gameIsActive = false</code>. We then changed that status through the <code class="literal">gameActivate()</code> function and made <code class="literal">gameIsActive = true</code>. We made the <code class="literal">gameStart()</code> function apply all the initial gameplay elements. This included the start of the physics engine and gravity. At the same time, we took the remainder of all the functions and initialize them.<a id="id543" class="indexterm"/>
</p><p>Once all the functions are activated, <code class="literal">gameGroup</code> needs to be returned so that all the display objects appear during the gameplay.</p><p>To make sure that your physical object boundaries for your display objects are in the right place, use <code class="literal">physics.setDrawMode( "hybrid" )</code> in the <code class="literal">gameStart()</code> function.</p></div><div class="section" title="Pop quiz—animating the graphics"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec27"/>Pop quiz—animating the graphics</h2></div></div></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem">What retrieves or sets the text string of a text object?<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">a. <code class="literal">object.text</code></li><li class="listitem" style="list-style-type: none">b. <code class="literal">object.size</code></li><li class="listitem" style="list-style-type: none">c. <code class="literal">object:setTextColor()</code></li><li class="listitem" style="list-style-type: none">d. None of the above</li></ul></div></li><li class="listitem">What function converts any argument into a string?<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">a. <code class="literal">tonumber()</code></li><li class="listitem" style="list-style-type: none">b. <code class="literal">print()</code></li><li class="listitem" style="list-style-type: none">c. <code class="literal">tostring()</code></li><li class="listitem" style="list-style-type: none">d. <code class="literal">nil</code></li></ul></div></li><li class="listitem">What body type is affected by gravity and collisions with other body types?<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">a. Dynamic</li><li class="listitem" style="list-style-type: none">b. Kinematic</li><li class="listitem" style="list-style-type: none">c. Static</li><li class="listitem" style="list-style-type: none">d. None of the above</li></ul></div></li></ol></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec14"/>Summary</h1></div></div></div><p>The gameplay construction of our application is now completed. Now that we're familiar with a variety of ways to use the physics engine, it goes to show the ease of using Box2D and designing other games that involve physics bodies.</p><p>We have a better idea of:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Applying the uses of dynamic and static physics bodies</li><li class="listitem" style="list-style-type: disc">Constructing a customized shape for the physical properties of our display objects</li><li class="listitem" style="list-style-type: disc">Tracking the number of objects caught using values from variables that are given</li><li class="listitem" style="list-style-type: disc">Using post-collisions to switch out images</li></ul></div><p>In the next chapter, we will complete the gaming experience by creating versatile menu screens using<span class="strong"><strong> Storyboard API</strong></span>. We will also learn how to add the pause action, save high scores, and understand more about data saving and unloading files.</p><p>Using Corona SDK has helped us design and develop games in a minimal amount of time. Let us continue adding the final touches to our game!</p></div></body></html>