<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Behavior Driven Development</h1></div></div></div><p>Behavior Driven Development can be understood as the evolution and confluence of Test Driven Development and Acceptance Testing. Both techniques were discussed in previous chapters, so you may want to look back at<a class="link" href="ch01.html" title="Chapter 1. Getting Started with Testing"> Chapter 1</a>,<em> Getting Started with Testing</em> and<a class="link" href="ch04.html" title="Chapter 4. Test Driven Development"> Chapter 4</a>,<em> Test Driven Development</em> before proceeding.<a class="indexterm" id="id306"/>
</p><p>Behavior Driven Development introduces some new concepts, such as the use of a common vocabulary to describe the tests and the inclusion of business participants in the software development project. And some people still believe that it is only Test Driven Development done right.</p><p>We have visited Test Driven Development before and we focused on converting low level requirements into tests that could drive our development process. Behavior Driven Development forces us to concentrate on higher level requirements and on using a specific vocabulary we can express these requirements in a way that can be further analyzed or evaluated.</p><p>We will explore these concepts so that you can make your own conclusions.</p><div><div><div><div><h1 class="title"><a id="ch06lvl1sec01"/>Brief history</h1></div></div></div><p>Behavior Driven Development was a term introduced by Dan North back in 2003 to describe a technique that focuses on collaboration between developers and other stakeholders by using a process usually called<strong> outside-in</strong> software development. Its primary goal is to satisfy the business needs of the client.<a class="indexterm" id="id307"/>
</p><p>Behavior Driven Development grew out of a thought experiment based on<strong> Neuro Linguistic Programming</strong> (<strong>NLP</strong>) techniques.</p><p>The primary idea is that the words used to describe a thought severely influence that thought to the point that we seem to think in the language we speak.</p><p>There is empirical proof of the fact that subjects in memory tests are more likely to remember a specific color if their mother language has a specific word for that color. So if we have a specific language to describe our requirements, it would probably influence the way we think about them and hence improve the way we write them.</p><p>Therefore, the words used by Behavior Driven Development were carefully selected to influence the way you think about the specification of features. They are closely related to the notion of cause-effect and follow this concept to describe a feature starting from a known state, applying some process, and expecting some results.<a class="indexterm" id="id308"/>
</p><p>These words are described in the next section.</p></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec02"/>Given, when, then</h1></div></div></div><p>
<strong>Given/When/Then</strong> words are the common vocabulary that spans the divide between business and technology, and as described at<a class="ulink" href="http://behaviour-driven.org/"> http://behaviour-driven.org/</a> they can also be referred to as the ubiquitous language of Behavior Driven Development. The framework is based on three core principles that we reproduce here verbatim:<a class="indexterm" id="id309"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Business and Technology should refer to the same system in the same way</li><li class="listitem" style="list-style-type: disc">Any system should have an identified, verifiable value to the business</li><li class="listitem" style="list-style-type: disc">Up-front analysis, design, and planning all have a diminishing return</li></ul></div><p>Behavior Driven Development relies on the use of this specific vocabulary. Additionally, the format in which requirements are expressed is predetermined allowing tools to interpret and execute them.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Given</strong>, is to describe the initial state before external stimuli is received.</li><li class="listitem" style="list-style-type: disc"><strong>When</strong>, is to describe the key action the user performs.</li><li class="listitem" style="list-style-type: disc"><strong>Then</strong>, is to analyze the results of the actions. To be observable the actions performed should have some kind of outcome.</li></ul></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec03"/>FitNesse</h1></div></div></div><p>FitNesse is a software development collaboration tool. Strictly speaking FitNesse is a set of tools, described as follows:<a class="indexterm" id="id310"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">As a software testing tool, FitNesse is a lightweight, open source framework that allows teams to collaborate</li><li class="listitem" style="list-style-type: disc">It is also a Wiki where you can easily create and edit pages and share information</li><li class="listitem" style="list-style-type: disc">FitNesse is also a web server so it doesn't require additional configuration or administrative privileges to set up or configure</li></ul></div><p>Download the FitNesse distribution from<a class="ulink" href="http://fitnesse.org/"> http://fitnesse.org/</a>. The distribution is a JAR file that installs itself on first run. Throughout these examples we used FitNesse release 20100303 but newer versions should also work.<a class="indexterm" id="id311"/>
</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec01"/>Running FitNesse from the command line</h2></div></div></div><p>By default when FitNesse runs it listens on port 80, so to run unprivileged you should change the port on the command line. In this example we use<code class="literal"> 8900:</code>
<a class="indexterm" id="id312"/>
</p><div><pre class="programlisting"><strong>$ java -jar fitnesse.jar -p 8900</strong>
</pre></div><p>This is the output obtained when we run the command:</p><p>
<strong>FitNesse (v20100303) Started..</strong>.</p><p>
<strong>port: 8900</strong>
</p><p>
<strong>root page: fitnesse.wiki.FileSystemPage at ./FitNesseRoot</strong>
</p><p>
<strong>logger: none</strong>
</p><p>
<strong>authenticator: fitnesse.authentication.PromiscuousAuthenticator</strong>
</p><p>
<strong>html page factory: fitnesse.html.HtmlPageFactory</strong>
</p><p>
<strong>page version expiration set to 14 days</strong>.</p><p>Once running, you can direct your browser to the local FitNesse server home page and you will be presented with this content:</p><div><img alt="Running FitNesse from the command line" src="img/3500_06_01.jpg"/></div></div><div><div><div><div><h2 class="title"><a id="ch06lvl2sec02"/>Creating a TemperatureConverterTests subwiki</h2></div></div></div><p>Once FitNesse is up and running, we can start by creating a subwiki to organize our tests.<a class="indexterm" id="id313"/>
</p><p>You may already be familiar with the wiki concept. If not, a wiki is a website that allows page editing and creation by its users. This editing process is done from within the browser and uses a markup language that greatly simplifies the process.</p><div><h3 class="title"><a id="note14"/>Note</h3><p>You can find out more about wikis in what could perhaps be the most famous wiki:<a class="ulink" href="http://en.wikipedia.org/wiki/Wiki"> http://en.wikipedia.org/wiki/Wiki</a>.</p></div><p>Though this subwiki organization is not mandatory, it is highly recommended, especially if you plan to use FitNesse for acceptance testing on multiple projects.</p><p>One of the most simplified processes is hyperlink creation which is done only by using<em> CamelCase</em> or<em> WikiWords</em>; that is a word that starts with a capital letter and has at least one more capital letter in it. This WikiWord will be converted into a hyperlink to a page with that name.</p><p>To create the<strong> TemperatureConverterTests</strong> subwiki, we simply press the<strong> Edit</strong> button below the FitNesse logo to edit the home page, adding the following:<a class="indexterm" id="id314"/>
</p><div><pre class="programlisting">| '''My Tests''' |
| TemperatureConverterTests | ''Temperature Converter Tests'' |
</pre></div><p>This adds a new table to the page, by using the "|" markup as the first character and to delimit the columns.</p><p>Then a wiki page<code class="literal"> TemperatureConverterTests</code> will be created and we also add a column with a descriptive comment about the tests. This comment is turned into italics by surrounding it by double single quotes ('').</p><p>Press<strong> Save</strong> and the page will be modified.</p><p>Once the page is displayed we can verify that<code class="literal"> TemperatureConverterTests</code> is now followed by<strong> [?]</strong> (question mark) because the page has not been created yet and will be created when we click on it.</p><p>We can add some comments to clearly identify this newly-created front page of the subwiki.</p><div><pre class="programlisting">!contents -R2 -g -p -f -h
This is the !-TemperatureConverterTests SubWiki-!.
</pre></div><p>Here, the text<code class="literal"> TemperatureConverterTests SubWiki</code> is escaped using !- and -! to prevent it from being converted to another page link.</p><p>
<strong>Save</strong> again.</p><div><div><div><div><h3 class="title"><a id="ch06lvl3sec01"/>Adding child pages to the subwiki</h3></div></div></div><p>Now we add a new child page by using the<strong> [add child]</strong> link that appears next to the page title.<a class="indexterm" id="id315"/>
</p><p>There are different options for creating the child page, and we can select:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>Normal</strong>, for a normal wiki page</li><li class="listitem" style="list-style-type: disc"><strong>Test</strong>, a page that contains tests</li><li class="listitem" style="list-style-type: disc"><strong>Suite</strong>, a page containing other tests composing a suite</li><li class="listitem" style="list-style-type: disc"><strong>Default</strong>, a default page</li></ul></div><div><img alt="Adding child pages to the subwiki" src="img/3500_06_02.jpg"/></div><p>These are the values to use:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Field</p>
</th><th style="text-align: left" valign="bottom">
<p>Value</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Type of page:</p>
</td><td style="text-align: left" valign="top">
<p>Suite</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Name:</p>
</td><td style="text-align: left" valign="top">
<p>TemperatureConverterTestSuite</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Content:</p>
</td><td style="text-align: left" valign="top">
<p>!contents</p>
</td></tr></tbody></table></div><p>After pressing<strong> Add</strong>, this page is created and automatically added as a link to the subwiki.</p><p>Let's follow this newly-created link to reach the test suite page.<a class="indexterm" id="id316"/>
</p><p>Once you're here, add another child using the<strong> [add child]</strong> link. This time, let's add a Test page and name it<strong> TemperatureConverterCelsiusToFahrenheitFixture</strong> as this will contain our fixture.</p><p>These are the values to use:</p><div><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Field</p>
</th><th style="text-align: left" valign="bottom">
<p>Value</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Type of page:</p>
</td><td style="text-align: left" valign="top">
<p>Test</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Name:</p>
</td><td style="text-align: left" valign="top">
<p>TemperatureConverterCelsiusToFahrenheitFixture</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Content:</p>
</td><td style="text-align: left" valign="top">
<p>!contents</p>
</td></tr></tbody></table></div><p>Click on<strong> Add</strong> to finish the operation.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec02"/>Adding the acceptance test fixture</h3></div></div></div><p>Up until now, we were only creating wiki pages. Nothing exciting about that! But now we will be adding our acceptance test fixture directly to the page. Be sure of navigating to the newly added page,<strong> TemperatureConverterCelsiusToFahrenheitFixture</strong>, click on<strong> Edit</strong> as usual, and add the following:<a class="indexterm" id="id317"/>
</p><div><pre class="programlisting">!contents
!|TemperatureConverterCelsiusToFahrenheitFixture |
|celsius|fahrenheit? |
|0.0 |~= 32 |
|100.0 |212.0 |
|-1.0 |30.2 |
|-100.0 |-148.0 |
|32.0 |89.6 |
|-40.0 |-40.0 |
|-273.0 |~= -459.4 |
|-273 |~= -459.4 |
|-273 |~= -459 |
|-273 |~= -459.40000000000003 |
|-273 |-459.40000000000003 |
|-273 |-459.41 &lt; _ &lt; -459.40 |
|-274.0 |Invalid temperature: -274.00C below absolute zero|
</pre></div><p>This table defines several items for our text feature:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">TemperatureConverterCelsiusToFahrenheitFixture:</code> This is the table title and the test fixture name.</li><li class="listitem" style="list-style-type: disc"><code class="literal">celsius:</code> This is the column name for the value we are providing as input to the test.</li><li class="listitem" style="list-style-type: disc"><code class="literal">fahrenheit?:</code> This is the column name for the value expected as the result of the conversion. The question mark indicates that this is a result value.</li><li class="listitem" style="list-style-type: disc"><code class="literal">~=:</code> This indicates that the result is approximately this value.</li><li class="listitem" style="list-style-type: disc"><code class="literal">&lt; _ &lt;:</code> This indicates that the expected value is within this range.</li><li class="listitem" style="list-style-type: disc">Invalid temperature: -274.00C below absolute zero, is the value expected by the failed conversion.</li></ul></div><p>Save this content by clicking on<strong> Save</strong>.</p></div><div><div><div><div><h3 class="title"><a id="ch06lvl3sec03"/>Adding the supporting test classes</h3></div></div></div><p>If we just press the<strong> Test</strong> button, which is below the FitNesse logo (see the next screenshot for details), we will receive an error. In some way this is expected because we haven't created the supporting test fixture yet. This is a very simple class that invokes the<code class="literal"> TemperatureConverter</code> methods.<a class="indexterm" id="id318"/>
</p><p>FitNesse supports two different test systems:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><strong>fit:</strong> This is the older of the two methods, and uses HTML, parsed just prior to the fixture being called.</li><li class="listitem" style="list-style-type: disc"><strong>slim:</strong> This is newer, all the table processing is done inside FitNesse, within slim runners.</li></ul></div><p>Further information about these test systems can be found at<a class="ulink" href="http://fitnesse.org/FitNesse.UserGuide.TestSystems"> http://fitnesse.org/FitNesse.UserGuide.TestSystems</a>.<a class="indexterm" id="id319"/>
</p><p>In this example we are using slim, which is selected by setting the variable<code class="literal"> TEST_SYSTEM</code> within the same page as:</p><div><pre class="programlisting">!define TEST_SYSTEM {slim}
</pre></div><p>To create the slim test fixture we simply create a new package, named<code class="literal"> com.example.aatg.tc.test.fitnesse.fixture</code>, in our existing Android test project<code class="literal"> TemperatureConverterTest</code>. We will be creating the fixture inside this package.</p><p>Next, we have to create the<code class="literal"> TemperatureConverterCelsiusToFahrenheitFixture</code> class that we defined in our acceptance test table:</p><div><pre class="programlisting">package com.example.aatg.tc.test.fitnesse.fixture;
import com.example.aatg.tc.TemperatureConverter;
public class TemperatureConverterCelsiusToFahrenheitFixture {
private double celsius;
public void setCelsius(double celsius) {
this.celsius = celsius;
}
public String fahrenheit() throws Exception {
try {
return String.valueOf( TemperatureConverter.celsiusToFahrenheit(celsius));
}
catch (RuntimeException e) {
return e.getLocalizedMessage();
}
}
}
</pre></div><p>This fixture should delegate on real code and not do anything by itself. We decided to return<code class="literal"> String</code> from<code class="literal"> fahrenheit</code> so we can return the<code class="literal"> Exception</code> message in the same method.<a class="indexterm" id="id320"/>
</p><p>In the test page we should also define the import statement used by the tests:</p><div><pre class="programlisting">|import|
|com.example.aatg.tc.test.fitnesse.fixture|
</pre></div><div><h3 class="title"><a id="note15"/>Note</h3><p>Note that in the next variable you should change the paths to the ones appropriate to your system and the classpath to locate the classes.</p></div><div><pre class="programlisting"><strong>!path /opt/fitnesse/fitnesse.jar:/home/diego/aatg/TemperatureConverter/bin/:/home/diego/aatg/TemperatureConverterTest/bin/</strong>
</pre></div><div><h3 class="title"><a id="note16"/>Note</h3><p>This should be adapted to your system paths.</p></div><p>After finishing these steps we can click on the<strong> Test</strong> button to run the tests and the page will reflect the results:</p><div><img alt="Adding the supporting test classes" src="img/3500_06_03.jpg"/></div><p>We can easily identify every test that succeeded by their green color and failed ones by their red color. In this example, we don't have any failure so everything is green.</p><p>FitNesse has another useful feature which is the<strong> Test History</strong>. All the test runs and a specific number of results are saved for a period of time so that you can review the results later on and compare the results, and thus analyze the evolution of your changes.</p><p>This feature is accessed by clicking<strong> Test History</strong> at the bottom of the list of options on the left pane.<a class="indexterm" id="id321"/>
</p><p>In the following image we can see the results for the last 4 test runs, where 3 failed and 1 succeeded. Also by clicking on the "+" (plus) or "-" (minus) signs, you can expand or collapse the view to show or hide detailed information about the test run.</p><div><img alt="Adding the supporting test classes" src="img/3500_06_04.jpg"/></div></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec04"/>GivWenZen</h1></div></div></div><p>GivWenZen is a framework that builds upon FitNesse and Slim to allow the user to exploit the Behavior Driven Development technique of expressing the tests using the<strong> Given-When-Then</strong> vocabulary to describe tests. These test descriptions are also created using the FitNesse wiki facility of expressing the tests as plain text contained in tables in a wiki page.<a class="indexterm" id="id322"/>
</p><p>The idea is pretty simple and straightforward and follows up what we have been doing with FitNesse, but this time instead of writing acceptance tests giving a table of values we will use the three Behavior Driven Development magic words<strong> Given-When-Then</strong> to describe our scenarios.</p><p>Firstly, let's install GivWenZen. Download the full distribution from its download list page at<a class="ulink" href="http://code.google.com/p/givwenzen/downloads/list"> http://code.google.com/p/givwenzen/downloads/list</a> and follow the instructions on its website. We used givwenzen 1.0.1 in these examples but newer versions should work as well.<a class="indexterm" id="id323"/>
</p><p>The GivWenZen full distribution includes all the dependencies needed, including FitNesse, so if you have FitNesse running from previous examples it is better to stop it or you must use a different port for GivWenZen.</p><p>Upon startup, point your browser to the home page and you will find a familiar FitNesse front page. You can take some time to explore the examples included.<a class="indexterm" id="id324"/>
</p><div><div><div><div><h2 class="title"><a id="ch06lvl2sec03"/>Creating the test scenario</h2></div></div></div><p>Let's create a simple scenario for our Temperature Converter to understand things better.<a class="indexterm" id="id325"/>
</p><p>In plain tests, our scenario would be:</p><p>
<em>Given</em> I'm using the Temperature Converter,<em> When</em> I enter 100 into Celsius field,<em> Then</em> I obtain 212 in the Fahrenheit field.</p><p>And it is directly translated into a GivWenZen scenario by adding this to a wiki page:</p><div><pre class="programlisting">-|script|
|given |I'm using the !-TemperatureConverter-!|
|when |I enter 100 into Celsius field |
|then |I obtain 212 in Fahrenheit field |
</pre></div><p>The translation is straightforward. The table title must be<code class="literal"> script</code>, and in this case it is preceded by a dash (-) to hide it. Then each of the<strong> Give-When-Then</strong> scenarios is placed in a column and the predicate in the other column.</p><p>Before running this script, when the whole page is executed, we need to initialize GivWenZen by running yet another script. In this case it would be:</p><div><pre class="programlisting">|script |
|start|giv wen zen for slim|
</pre></div><p>We need to initialize the classpath and add the corresponding imports before the script that starts GivWenZen. Usually this is done in one of the<strong> SetUp</strong> pages, which are executed before running every test script, but for the sake of simplicity we are adding the initialization to this same page:</p><div><pre class="programlisting">!define TEST_SYSTEM {slim}
!path ./target/classes/main
!path ./target/classes/examples
!path ./lib/commons-logging.jar
!path ./lib/fitnesse.jar
!path ./lib/log4j-1.2.9.jar
!path ./lib/slf4j-simple-1.5.6.jar
!path ./lib/slf4j-api-1.5.6.jar
!path ./lib/javassist.jar
!path ./lib/google-collect-1.0-rc4.jar
!path ./lib/dom4j-1.6.1.jar
!path ./lib/commons-vfs-1.0.jar
!path ./lib/clover-2.6.1.jar
!path /home/diego/workspace/TemperatureConverter/bin
!path /home/diego/workspace/TemperatureConverterTest/bin
</pre></div><p>If you just run the test here by clicking the<strong> Test</strong> button, you will receive the following message:</p><p>
<strong>__EXCEPTION__:org.givwenzen.DomainStepNotFoundException:</strong>
</p><p>You need a step class with an annotated method matching this pattern: "I'm using the TemperatureConverter".<a class="indexterm" id="id326"/>
</p><p>Typical causes of this error are:<a class="indexterm" id="id327"/>
</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">StepClass</code> is missing the<code class="literal"> @DomainSteps</code> annotation</li><li class="listitem" style="list-style-type: disc"><code class="literal">StepMethod</code> is missing the<code class="literal"> @DomainStep</code> annotation</li><li class="listitem" style="list-style-type: disc">The step method annotation has a regular expression that is not matching the current test step</li></ul></div><p>This, and the other exception messages are very helpful in implementing the steps class, however you should add some behavior.</p><p>The step class should be placed in the package or subpackage of<code class="literal"> bdd.steps</code>, or your own custom package if defined.</p><p>For example:</p><div><pre class="programlisting"><strong>@DomainSteps
public class StepClass {
@DomainStep("I'm using the TemperatureConverter")
public void domainStep() {
// TODO implement step
} }</strong>
</pre></div><p>In our particular case this will be the implementation of the<code class="literal"> StepClass:</code>
</p><div><pre class="programlisting">package bdd.steps.tc;
import org.givwenzen.annotations.DomainStep;
import org.givwenzen.annotations.DomainSteps;
import com.example.aatg.tc.TemperatureConverter;
@DomainSteps
public class TemperatureConverterSteps {
private static final String CELSIUS = "Celsius";
private static final String FAHRENHEIT = "Fahrenheit";
private static final String ANY_TEMPERATURE =
"([-+]?\\d+(?:\\.\\d+)?)";
private static final String UNIT = "(C|F)";
private static final String UNIT_NAME =
"(" + CELSIUS + "|" + FAHRENHEIT + ")";
private static final double DELTA = 0.01d;
private double mValue = Double.NaN;
@DomainStep("I(?: a|')m using the TemperatureConverter")
public void createTemperatureConverter() {
// do nothing
}
@DomainStep("I enter " + ANY_TEMPERATURE + " into " + UNIT_NAME + " field")
public void setField(double value, String unitName) {
mValue = value;
}
@DomainStep("I obtain " + ANY_TEMPERATURE + " in " + UNIT_NAME + " field")
public boolean verifyConversion(double value, String unitName) {
try {
final double t = (FAHRENHEIT.compareTo(unitName) == 0) ? getFahrenheit() : getCelsius();
return (Math.abs(t-value) &lt; DELTA);
}
catch (RuntimeException ex) {
return false;
}
}
@DomainStep("Celsius")
public double getCelsius() {
return TemperatureConverter.fahrenheitToCelsius(mValue);
}
@DomainStep("Fahrenheit")
public double getFahrenheit() {
return TemperatureConverter.celsiusToFahrenheit(mValue);
}
}
</pre></div><p>In this example, we are using a subpackage of<code class="literal"> bdd.steps</code> because, by default, this is the package hierarchy GivWenZen searches for steps implementations. Otherwise, extra configuration is needed.</p><p>Classes implementing steps should be annotated by<code class="literal"> @DomainSteps</code> and the step's methods annotated by<code class="literal"> @DomainStep</code>. The latter receives a regular expression String as a parameter. This regular expression is used by GivWenZen to match the steps.</p><p>For example, in our scenario we have defined this step:</p><div><pre class="programlisting">I enter 100 into Celsius field
</pre></div><p>Our annotation is:</p><div><pre class="programlisting">@DomainStep("I enter " + ANY_TEMPERATURE + " into " + UNIT_NAME + " field")
</pre></div><p>This will match, and the regular expression group values defined by<code class="literal"> ANY_TEMPERATURE</code> and<code class="literal"> UNIT_NAME</code> will be obtained and provided to the method as its argument's value and<code class="literal"> unitName:</code>
<a class="indexterm" id="id328"/>
</p><div><pre class="programlisting">public void setField(double value, String unitName)
</pre></div><p>Recall that in a previous chapter, I recommended reviewing regular expressions because they could be useful. Well this is probably one of these places where they are extremely useful. In<code class="literal"> ANY_TEMPERATURE</code> we are matching every possible temperature value with the optional sign and decimal point. Consequently<code class="literal"> UNIT</code> and<code class="literal"> UNIT_NAME</code> match the unit symbol or its name; that is Celsius or Fahrenheit.<a class="indexterm" id="id329"/>
</p><p>These regular expressions are used in the construction of the<code class="literal"> @DomainStep</code> annotation parameters. Groups, delimited by "()" parenthesis in these regular expressions are converted into method parameters. This is how<code class="literal"> setField()</code> obtains its parameters.</p><p>Then we have a<code class="literal"> verifyConversion()</code> method that returns true or false depending on whether the actual conversion is within a<code class="literal"> DELTA</code> value of the expected one.</p><p>Finally, we have some methods that actually invoke the conversion methods in the<code class="literal"> TemperatureConverter</code> class.</p><p>On running the tests once again, all the tests pass. We can confirm this by analyzing the output message:</p><p>
<strong>Assertions: 2 right, 0 wrong, 0 ignored, 0 exceptions</strong>.</p><p>Notice that we are receiving the results for 2 assertions as one is for the invocation of the GivWenZen initialization script we added to the page and the other is for our scenario.</p><p>We should not only create scenarios for normal situations but cover exceptional conditions as well. Say, in plain text, our scenario is something like this:</p><div><h3 class="title"><a id="note17"/>Note</h3><p>
<em>Given</em> I'm using the Temperature Converter,<em> When</em> I enter -274 into Celsius field,<em> Then</em> I obtain 'Invalid temperature: -274.00C below absolute zero' exception.</p></div><p>It can be translated into a GivWenZen table like the following:</p><div><pre class="programlisting">-|script|
|given|I am using the !-TemperatureConverter-! |
|when |I enter -274 into Celsius field |
|then |I obtain 'Invalid temperature: -274.00C below absolute zero' exception|
</pre></div><p>And by adding a supporting step method, we will be able to run it. The step method can be implemented like this:<a class="indexterm" id="id330"/>
</p><div><pre class="programlisting">@DomainStep("I obtain '(Invalid temperature: " + ANY_TEMPERATURE + UNIT + " below absolute zero)' exception")
public boolean verifyException(String message, String value, String unit) {
try {
if ( "C".compareTo(unit) == 0 ) {
getFahrenheit();
}
else {
getCelsius();
}
}
catch (RuntimeException ex) {
return ex.getMessage().contains(message);
}
return false;
}
</pre></div><p>This method obtains the exception message, temperature value, and unit from the regular expression. Then this is compared against the actual exception message to verify that it matches.</p><p>Additionally, we can create other scenarios which, in this situation, will be supported by the existing steps methods. These scenarios could be:</p><div><pre class="programlisting">-|script|
|given |I'm using the !-TemperatureConverter-! |
|when |I enter -100 into Celsius field |
|then |I obtain -148 in Fahrenheit field |
-|script|
|given |I'm using the !-TemperatureConverter-! |
|when |I enter -100 into Fahrenheit field |
|then |I obtain -73.33 in Celsius field |
|show |then |Celsius |
-|script|
|given|I'm using the !-TemperatureConverter-! |
|when |I enter -460 into Fahrenheit field |
|then |I obtain 'Invalid temperature: -460.00F below absolute zero' exception|
</pre></div><p>Because GivWenZen is based on FitNesse, we are free to combine both approaches and include the tests from our previous session in the same suite. Doing so, we can run the entire suite from the suite page obtaining the overall results.<a class="indexterm" id="id331"/>
</p><div><img alt="Creating the test scenario" src="img/3500_06_05.jpg"/></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch06lvl1sec05"/>Summary</h1></div></div></div><p>In this chapter we covered Behavior Driven Development as an evolution of Test Driven Development which we examined in previous chapters.</p><p>We discussed the origin and driving forces behind Behavior Driven development. We analyzed the concepts serving as the foundations, explored the Given-When-Then vocabulary idea, and introduced FitNesse and Slim as helpful tools in deploying tests.</p><p>We presented GivWenZen, a tool based on FitNesse that gives us the ability to create scenarios and test them.</p><p>We introduced these techniques and tools to our sample Android project. However, we are still limited to test subjects that are testable under the JVM avoiding the use of Android-specific classes and mainly the User Interface. We will be exploring some alternatives to overcome this limitation in<a class="link" href="ch10.html" title="Chapter 10. Alternative Testing Tactics"> Chapter 10</a>, <em>Alternative Testing Tactics.</em></p><p>The next chapter presents practical examples of different common situations that you will encounter, applying all the disciplines and techniques discussed so far.</p></div></body></html>