<html><head></head><body>
<div id="_idContainer264" class="calibre2">
<h1 class="chapter-number" id="_idParaDest-178"><a id="_idTextAnchor215" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.1.1">15</span></h1>
<h1 id="_idParaDest-179" class="calibre6"><a id="_idTextAnchor216" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.2.1">Improving Your App</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.3.1">After we complete the development and publishing of our app, it is important to always be on the lookout when using things that help improve our apps, such as Firebase Messaging or Crashlytics. </span><span class="kobospan" id="kobo.3.2">We are going to be learning how to use Firebase Messaging and Crashlytics in </span><span><span class="kobospan" id="kobo.4.1">this chapter.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.5.1">In this chapter, we will learn step-by-step techniques on how to improve our apps by adding analytics—Firebase Crashlytics—and how to use cloud messaging to increase user engagement. </span><span class="kobospan" id="kobo.5.2">We will learn how to send notifications to our apps from the Firebase console. </span><span class="kobospan" id="kobo.5.3">Additionally, we will learn some tips and tricks for securing our apps to ensure that user data is </span><span><span class="kobospan" id="kobo.6.1">not compromised.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.7.1">In this chapter, we’re going to cover the following </span><span><span class="kobospan" id="kobo.8.1">main topics:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.9.1">Using Firebase Crashlytics to </span><span><span class="kobospan" id="kobo.10.1">detect crashes</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.11.1">Improving app engagement with </span><span><span class="kobospan" id="kobo.12.1">Firebase Messaging</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.13.1">Securing </span><span><span class="kobospan" id="kobo.14.1">your app</span></span></li>
</ul>
<h1 id="_idParaDest-180" class="calibre6"><a id="_idTextAnchor217" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.15.1">Technical requirements</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.16.1">To follow the instructions in this chapter, you will need to have Android Studio Hedgehog or a later version (</span><a href="https://developer.android.com/studio" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.17.1">https://developer.android.com/studio</span></span></a><span><span class="kobospan" id="kobo.18.1">) </span></span><span><span class="kobospan" id="kobo.19.1">downloaded</span></span><span><span class="kobospan" id="kobo.20.1">.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.21.1">You can use the previous chapter’s code to follow the instructions in this chapter. </span><span class="kobospan" id="kobo.21.2">You can find the code for this chapter on GitHub </span><span><span class="kobospan" id="kobo.22.1">at </span></span><a href="https://github.com/PacktPublishing/Mastering-Kotlin-for-Android/tree/main/chapterfifteen" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.23.1">https://github.com/PacktPublishing/Mastering-Kotlin-for-Android/tree/main/chapterfifteen</span></span></a><span><span class="kobospan" id="kobo.24.1">.</span></span></p>
<h1 id="_idParaDest-181" class="calibre6"><a id="_idTextAnchor218" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.25.1">Using Firebase Crashlytics to detect crashes</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.26.1">Crashes can happen in our </span><a id="_idIndexMarker766" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.27.1">apps for a variety of reasons, including common coding issues such as null pointer exceptions, memory leaks, and improper data handling. </span><span class="kobospan" id="kobo.27.2">Device fragmentation caused by different device hardware configurations and different Android operation systems introduces compatibility issues that may at times cause crashes too. </span><span class="kobospan" id="kobo.27.3">Network issues, insufficient resources, or mismanagement of external dependencies, such as third-party libraries, can cause crashes too. </span><span class="kobospan" id="kobo.27.4">Sometimes, we can anticipate and handle them gracefully. </span><span class="kobospan" id="kobo.27.5">Other times, they are unexpected and we need to know about them so we can fix them. </span><span class="kobospan" id="kobo.27.6">Our app is already on Google Play Store, so at times, we might not have the luxury to debug on the devices that are having</span><a id="_idIndexMarker767" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.28.1"> issues. </span><span class="kobospan" id="kobo.28.2">Tools such as </span><strong class="bold"><span class="kobospan" id="kobo.29.1">Firebase Crashlytics</span></strong><span class="kobospan" id="kobo.30.1"> can help us detect crashes in our apps and provide us with the information we need to fix them. </span><span class="kobospan" id="kobo.30.2">In this section, we will be setting up Firebase Crashlytics in our app and seeing how we can use it to </span><span><span class="kobospan" id="kobo.31.1">detect crashes.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.32.1">Android Studio has a built-in Firebase tool to help us quickly add Firebase to our app. </span><span class="kobospan" id="kobo.32.2">We can access it from </span><strong class="bold"><span class="kobospan" id="kobo.33.1">Tools</span></strong><span class="kobospan" id="kobo.34.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.35.1">Firebase</span></strong><span class="kobospan" id="kobo.36.1">, which should open a side panel on the right, as shown in the </span><span><span class="kobospan" id="kobo.37.1">following figure:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer244">
<span class="kobospan" id="kobo.38.1"><img alt="Figure 15.1 – Firebase setup" src="image/B19779_15_01.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.39.1">Figure 15.1 – Firebase setup</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.40.1">As seen in </span><span><em class="italic"><span class="kobospan" id="kobo.41.1">Figure 15</span></em></span><em class="italic"><span class="kobospan" id="kobo.42.1">.1</span></em><span class="kobospan" id="kobo.43.1">, we can set up a variety of Firebase SDKs from this tool. </span><span class="kobospan" id="kobo.43.2">We are interested in setting</span><a id="_idIndexMarker768" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.44.1"> up </span><strong class="bold"><span class="kobospan" id="kobo.45.1">Crashlytics</span></strong><span class="kobospan" id="kobo.46.1">. </span><span class="kobospan" id="kobo.46.2">Tap on the </span><strong class="bold"><span class="kobospan" id="kobo.47.1">Crashlytics</span></strong><span class="kobospan" id="kobo.48.1"> option and we will see the </span><span><span class="kobospan" id="kobo.49.1">following options:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer245">
<span class="kobospan" id="kobo.50.1"><img alt="Figure 15.2 – Firebase Crashlytics setup" src="image/B19779_15_02.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.51.1">Figure 15.2 – Firebase Crashlytics setup</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.52.1">Since our project is written in Kotlin, we are going to select </span><strong class="bold"><span class="kobospan" id="kobo.53.1">Get started with Firebase Crashlytics</span></strong><span class="kobospan" id="kobo.54.1"> as an</span><a id="_idIndexMarker769" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.55.1"> option. </span><span class="kobospan" id="kobo.55.2">This will open a new window with the </span><span><span class="kobospan" id="kobo.56.1">following instructions:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer246">
<span class="kobospan" id="kobo.57.1"><img alt="Figure 15.3 – Steps to set up Crashlytics" src="image/B19779_15_03.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.58.1">Figure 15.3 – Steps to set up Crashlytics</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.59.1">As seen from </span><span><em class="italic"><span class="kobospan" id="kobo.60.1">Figure 15</span></em></span><em class="italic"><span class="kobospan" id="kobo.61.1">.3</span></em><span class="kobospan" id="kobo.62.1">, it provides all the steps necessary for us to set up Firebase Crashlytics in our app. </span><span class="kobospan" id="kobo.62.2">Let us tap the </span><strong class="bold"><span class="kobospan" id="kobo.63.1">Connect to Firebase</span></strong><span class="kobospan" id="kobo.64.1"> option. </span><span class="kobospan" id="kobo.64.2">This opens a new tab in our browser with the Firebase console opened (see </span><span><em class="italic"><span class="kobospan" id="kobo.65.1">Figure 15</span></em></span><em class="italic"><span class="kobospan" id="kobo.66.1">.4</span></em><span class="kobospan" id="kobo.67.1">). </span><span class="kobospan" id="kobo.67.2">It shows all the Firebase projects that we have on our console (if we have any). </span><span class="kobospan" id="kobo.67.3">Use the </span><strong class="bold"><span class="kobospan" id="kobo.68.1">Create a project</span></strong><span class="kobospan" id="kobo.69.1"> option and specify your preferred </span><span><span class="kobospan" id="kobo.70.1">project name:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer247">
<span class="kobospan" id="kobo.71.1"><img alt="Figure 15.4 – New Firebase project" src="image/B19779_15_04.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.72.1">Figure 15.4 – New Firebase project</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.73.1">Click </span><strong class="bold"><span class="kobospan" id="kobo.74.1">Continue</span></strong><span class="kobospan" id="kobo.75.1"> to proceed</span><a id="_idIndexMarker770" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.76.1"> to the next step. </span><span class="kobospan" id="kobo.76.2">This will take us to the </span><span><span class="kobospan" id="kobo.77.1">following screen:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer248">
<span class="kobospan" id="kobo.78.1"><img alt="Figure 15.5 –Google Analytics setup" src="image/B19779_15_05.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.79.1">Figure 15.5 –Google Analytics setup</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.80.1">In this screen, we configure Google Analytics for our app. </span><span class="kobospan" id="kobo.80.2">It also shows the functionalities that</span><a id="_idIndexMarker771" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.81.1"> Google Analytics provides for our app. </span><span class="kobospan" id="kobo.81.2">Google Analytics collects usage and behavior data for our apps. </span><span class="kobospan" id="kobo.81.3">We use it for tracking user events, system events, or errors, analyzing app performance, collecting user properties such as language preference and geographic location, and </span><span><span class="kobospan" id="kobo.82.1">so on.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.83.1">Click </span><strong class="bold"><span class="kobospan" id="kobo.84.1">Continue</span></strong><span class="kobospan" id="kobo.85.1"> to proceed to the </span><span><span class="kobospan" id="kobo.86.1">next step:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer249">
<span class="kobospan" id="kobo.87.1"><img alt="Figure 15.6 – Configuring Google Analytics" src="image/B19779_15_06.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.88.1">Figure 15.6 – Configuring Google Analytics</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.89.1">In this step, we configure more options for Google Analytics. </span><span class="kobospan" id="kobo.89.2">We must select a Google Analytics account. </span><span class="kobospan" id="kobo.89.3">Selecting</span><a id="_idIndexMarker772" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.90.1"> the default account hides the other questions if you have already configured other projects. </span><span class="kobospan" id="kobo.90.2">When done, click </span><strong class="bold"><span class="kobospan" id="kobo.91.1">Create project</span></strong><span class="kobospan" id="kobo.92.1"> to finalize creating the project and you will see the </span><span><span class="kobospan" id="kobo.93.1">following dialog:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer250">
<span class="kobospan" id="kobo.94.1"><img alt="Figure 15.7 – Finalizing setup dialog" src="image/B19779_15_07.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.95.1">Figure 15.7 – Finalizing setup dialog</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.96.1">Clicking </span><strong class="bold"><span class="kobospan" id="kobo.97.1">Connect</span></strong><span class="kobospan" id="kobo.98.1"> after our</span><a id="_idIndexMarker773" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.99.1"> project is created finalizes the setup of Firebase Crashlytics with Android Studio. </span><span class="kobospan" id="kobo.99.2">Let us head back to Android Studio and see what has changed. </span><span class="kobospan" id="kobo.99.3">We can see that the Firebase Crashlytics option is </span><span><span class="kobospan" id="kobo.100.1">now checked:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer251">
<span class="kobospan" id="kobo.101.1"><img alt="Figure 15.8 – App connected" src="image/B19779_15_08.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.102.1">Figure 15.8 – App connected</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.103.1">The next step is to add the Firebase Crashlytics SDK to our app. </span><span class="kobospan" id="kobo.103.2">We can do this by clicking the </span><strong class="bold"><span class="kobospan" id="kobo.104.1">Add Crashlytics SDK and plugin to your app</span></strong><span class="kobospan" id="kobo.105.1"> button. </span><span class="kobospan" id="kobo.105.2">This will add the necessary dependencies to our app. </span><span class="kobospan" id="kobo.105.3">You can check the Gradle files to see </span><span><span class="kobospan" id="kobo.106.1">these changes.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.107.1">With all the steps </span><a id="_idIndexMarker774" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.108.1">complete, we can now </span><strong class="bold"><span class="kobospan" id="kobo.109.1">force-crash</span></strong><span class="kobospan" id="kobo.110.1"> our app to see if the Firebase Crashlytics setup is working. </span><span class="kobospan" id="kobo.110.2">We can do this by adding the following code to our </span><strong class="source-inline"><span class="kobospan" id="kobo.111.1">MainActivity.kt</span></strong><span class="kobospan" id="kobo.112.1"> file inside the </span><span><strong class="source-inline"><span class="kobospan" id="kobo.113.1">onCreate()</span></strong></span><span><span class="kobospan" id="kobo.114.1"> function:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.115.1">
throw RuntimeException("Test Crash")</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.116.1">Now, run the app. </span><span class="kobospan" id="kobo.116.2">The app will crash with the following </span><span><span class="kobospan" id="kobo.117.1">stack trace:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer252">
<span class="kobospan" id="kobo.118.1"><img alt="Figure 15.9 – Crash stack trace" src="image/B19779_15_09.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.119.1">Figure 15.9 – Crash stack trace</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.120.1">We can head over to our newly created project in the Firebase console and see if the crash has been reported. </span><span class="kobospan" id="kobo.120.2">In the </span><a id="_idIndexMarker775" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.121.1">Firebase console, Crashlytics is normally found under the </span><strong class="bold"><span class="kobospan" id="kobo.122.1">Release and Monitor</span></strong><span class="kobospan" id="kobo.123.1"> section on the navigation drawer, which is on the left side of the screen. </span><span class="kobospan" id="kobo.123.2">It shows the </span><span><span class="kobospan" id="kobo.124.1">following screen:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer253">
<span class="kobospan" id="kobo.125.1"><img alt="Figure 15.10 – Firebase console crash overview" src="image/B19779_15_10.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.126.1">Figure 15.10 – Firebase console crash overview</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.127.1">We can see that the crash has been reported. </span><span class="kobospan" id="kobo.127.2">We can click on the </span><strong class="source-inline"><span class="kobospan" id="kobo.128.1">MainActivity.onCreate</span></strong><span class="kobospan" id="kobo.129.1"> crash to see more details about it. </span><span class="kobospan" id="kobo.129.2">It shows the </span><span><span class="kobospan" id="kobo.130.1">following screen:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer254">
<span class="kobospan" id="kobo.131.1"><img alt="Figure 15.11 – Firebase console crash details" src="image/B19779_15_11.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.132.1">Figure 15.11 – Firebase console crash details</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.133.1">As seen in </span><span><em class="italic"><span class="kobospan" id="kobo.134.1">Figure 15</span></em></span><em class="italic"><span class="kobospan" id="kobo.135.1">.10</span></em><span class="kobospan" id="kobo.136.1">, we have the </span><a id="_idIndexMarker776" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.137.1">following details from the </span><span><span class="kobospan" id="kobo.138.1">Firebase console:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.139.1">Stack trace</span></strong><span class="kobospan" id="kobo.140.1">: This shows the stack trace of </span><span><span class="kobospan" id="kobo.141.1">the crash.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.142.1">Device</span></strong><span class="kobospan" id="kobo.143.1">: This shows the device that the crash happened on. </span><span class="kobospan" id="kobo.143.2">We can see the device model, the OS version, and the </span><span><span class="kobospan" id="kobo.144.1">device state.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.145.1">App version</span></strong><span class="kobospan" id="kobo.146.1">: This shows the version of the app that crashed. </span><span class="kobospan" id="kobo.146.2">It also shows the total number of crashes that have happened for </span><span><span class="kobospan" id="kobo.147.1">that version.</span></span></li>
</ul>
<p class="calibre4"><span class="kobospan" id="kobo.148.1">This information is very helpful when debugging crashes. </span><span class="kobospan" id="kobo.148.2">Android Studio Hedgehog and more recent versions also have a useful tool, </span><strong class="bold"><span class="kobospan" id="kobo.149.1">App Quality Insights</span></strong><span class="kobospan" id="kobo.150.1">, that helps us view the Firebase crashes right from Android Studio. </span><span class="kobospan" id="kobo.150.2">We can access it from the bottom tool tabs, </span><span><span class="kobospan" id="kobo.151.1">as shown:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer255">
<span class="kobospan" id="kobo.152.1"><img alt="Figure 15.12 – App Quality Insights" src="image/B19779_15_12.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.153.1">Figure 15.12 – App Quality Insights</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.154.1">As seen in </span><span><em class="italic"><span class="kobospan" id="kobo.155.1">Figure 15</span></em></span><em class="italic"><span class="kobospan" id="kobo.156.1">.11</span></em><span class="kobospan" id="kobo.157.1">, we need to log in to our Firebase account that has the project we are working on. </span><span class="kobospan" id="kobo.157.2">We can</span><a id="_idIndexMarker777" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.158.1"> do this by clicking on the </span><strong class="bold"><span class="kobospan" id="kobo.159.1">Log in</span></strong><span class="kobospan" id="kobo.160.1"> button and completing the login process on our browser. </span><span class="kobospan" id="kobo.160.2">Once logged in, we can see the crashes that have happened in </span><span><span class="kobospan" id="kobo.161.1">our app:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer256">
<span class="kobospan" id="kobo.162.1"><img alt="Figure 15.13 – App Quality Insights crash details" src="image/B19779_15_13.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.163.1">Figure 15.13 – App Quality Insights crash details</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.164.1">This shows all the details, as we saw earlier in our Firebase console. </span><span class="kobospan" id="kobo.164.2">We can see the stack trace too. </span><span class="kobospan" id="kobo.164.3">The beauty of this is that we can easily navigate to the file and line causing the crash without having to switch context and go to </span><span><span class="kobospan" id="kobo.165.1">the browser.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.166.1">With Firebase Crashlytics set up, we can now detect crashes in our app and fix them. </span><span class="kobospan" id="kobo.166.2">This will help us improve the quality of our app and make our </span><span><span class="kobospan" id="kobo.167.1">users happy.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.168.1">Important note</span></p>
<p class="callout"><span class="kobospan" id="kobo.169.1">Remember to remove the code that we added to force a crash in </span><span><span class="kobospan" id="kobo.170.1">our app.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.171.1">Next, let us set up </span><strong class="bold"><span class="kobospan" id="kobo.172.1">Firebase Analytics</span></strong><span class="kobospan" id="kobo.173.1">, which also</span><a id="_idIndexMarker778" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.174.1"> gathers useful information about our app. </span><span class="kobospan" id="kobo.174.2">This will help us understand how our users are using our app and help us make informed decisions on how to </span><span><span class="kobospan" id="kobo.175.1">improve it.</span></span></p>
<h2 id="_idParaDest-182" class="calibre7"><a id="_idTextAnchor219" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.176.1">Setting up Google Analytics</span></h2>
<p class="calibre4"><span class="kobospan" id="kobo.177.1">Setting up Google </span><a id="_idIndexMarker779" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.178.1">Analytics is like setting up Firebase Crashlytics. </span><span class="kobospan" id="kobo.178.2">Repeat</span><a id="_idIndexMarker780" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.179.1"> the following steps that you took for </span><span><span class="kobospan" id="kobo.180.1">Firebase Crashlytics:</span></span></p>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.181.1">Open the Firebase tool from </span><strong class="bold"><span class="kobospan" id="kobo.182.1">Tools</span></strong><span class="kobospan" id="kobo.183.1"> | </span><span><strong class="bold"><span class="kobospan" id="kobo.184.1">Firebase</span></strong></span><span><span class="kobospan" id="kobo.185.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.186.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.187.1">Analytics</span></strong><span class="kobospan" id="kobo.188.1"> from the list of options that is similar to the list we saw in </span><span><em class="italic"><span class="kobospan" id="kobo.189.1">Figure 15</span></em></span><span><em class="italic"><span class="kobospan" id="kobo.190.1">.1</span></em></span><span><span class="kobospan" id="kobo.191.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.192.1">Select the </span><strong class="bold"><span class="kobospan" id="kobo.193.1">Get started with Google </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.194.1">Analytics</span></strong></span><span><span class="kobospan" id="kobo.195.1"> option.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.196.1">Since our app is already connected to Firebase, we can skip the first step and proceed to the </span><span><span class="kobospan" id="kobo.197.1">next step.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.198.1">Tap the </span><strong class="bold"><span class="kobospan" id="kobo.199.1">Add Analytics to your app</span></strong><span class="kobospan" id="kobo.200.1"> button to add the necessary dependencies to </span><span><span class="kobospan" id="kobo.201.1">our app.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.202.1">Once Gradle sync is complete, we have finalized setting up Firebase Analytics in </span><span><span class="kobospan" id="kobo.203.1">our app.</span></span></li>
</ol>
<p class="calibre4"><span class="kobospan" id="kobo.204.1">With that set, we can always view the analytics from the Firebase console. </span><span class="kobospan" id="kobo.204.2">We can access it from the navigation drawer under the </span><strong class="bold"><span class="kobospan" id="kobo.205.1">Analytics</span></strong><span class="kobospan" id="kobo.206.1"> section. </span><span class="kobospan" id="kobo.206.2">It shows the </span><span><span class="kobospan" id="kobo.207.1">following screen:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer257">
<span class="kobospan" id="kobo.208.1"><img alt="Figure 15.14 – App analytics" src="image/B19779_15_14.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.209.1">Figure 15.14 – App analytics</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.210.1">We have learned how to set </span><a id="_idIndexMarker781" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.211.1">up Firebase Crashlytics and Firebase Analytics in our app. </span><span class="kobospan" id="kobo.211.2">We can now detect crashes in our app and gather useful information about our app. </span><span class="kobospan" id="kobo.211.3">This will help us</span><a id="_idIndexMarker782" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.212.1"> improve the quality of our app and make our </span><span><span class="kobospan" id="kobo.213.1">users happy.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.214.1">In the next section, we will learn how to use Firebase Cloud Messaging to send notifications to </span><span><span class="kobospan" id="kobo.215.1">our app.</span></span></p>
<h1 id="_idParaDest-183" class="calibre6"><a id="_idTextAnchor220" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.216.1">Improving app engagement with Firebase Messaging</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.217.1">When users install our app, they </span><a id="_idIndexMarker783" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.218.1">might not use it again after they finish what they want to do. </span><span class="kobospan" id="kobo.218.2">This can lead to a decline in the number of active users, which can have different impacts on </span><span><span class="kobospan" id="kobo.219.1">different apps.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.220.1">We can leverage </span><strong class="bold"><span class="kobospan" id="kobo.221.1">Firebase Cloud Messaging</span></strong><span class="kobospan" id="kobo.222.1"> to send notifications to our users to remind them of our app. </span><span class="kobospan" id="kobo.222.2">This will help us improve our app’s engagement and increase the number of active users. </span><span class="kobospan" id="kobo.222.3">In this section, we will be setting up Firebase Cloud Messaging in our app and see how we can use it to send notifications to our </span><span><span class="kobospan" id="kobo.223.1">app users.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.224.1">First, we need to set up the Firebase Cloud Messaging SDK on our app. </span><span class="kobospan" id="kobo.224.2">This allows us to use the SDK within our project and enables our app to receive Firebase notifications once the setup is complete. </span><span class="kobospan" id="kobo.224.3">We will do it the same way we did for Firebase Crashlytics and Firebase Analytics. </span><span class="kobospan" id="kobo.224.4">Repeat</span><a id="_idIndexMarker784" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.225.1"> the </span><span><span class="kobospan" id="kobo.226.1">following steps:</span></span></p>
<ol class="calibre14">
<li class="calibre15"><span class="kobospan" id="kobo.227.1">Open the Firebase tool from </span><strong class="bold"><span class="kobospan" id="kobo.228.1">Tools</span></strong><span class="kobospan" id="kobo.229.1"> | </span><span><strong class="bold"><span class="kobospan" id="kobo.230.1">Firebase</span></strong></span><span><span class="kobospan" id="kobo.231.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.232.1">Select </span><strong class="bold"><span class="kobospan" id="kobo.233.1">Cloud Messaging</span></strong><span class="kobospan" id="kobo.234.1"> from the list of options that is similar to the list we saw in </span><span><em class="italic"><span class="kobospan" id="kobo.235.1">Figure 15</span></em></span><span><em class="italic"><span class="kobospan" id="kobo.236.1">.1</span></em></span><span><span class="kobospan" id="kobo.237.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.238.1">Select the </span><strong class="bold"><span class="kobospan" id="kobo.239.1">Setup Firebase Cloud </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.240.1">Messaging</span></strong></span><span><span class="kobospan" id="kobo.241.1"> option.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.242.1">Since our app is already connected to Firebase, we can skip the first step and proceed to the </span><span><span class="kobospan" id="kobo.243.1">next step.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.244.1">Tap the </span><strong class="bold"><span class="kobospan" id="kobo.245.1">Add FCM to your app</span></strong><span class="kobospan" id="kobo.246.1"> button to add the necessary dependencies to </span><span><span class="kobospan" id="kobo.247.1">the app.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.248.1">Once Gradle sync is complete, the FCM SDK is already set up in </span><span><span class="kobospan" id="kobo.249.1">our app.</span></span></li>
</ol>
<p class="calibre4"><span class="kobospan" id="kobo.250.1">We need to create a new service to handle notifications when they are received and to also get the device token. </span><span class="kobospan" id="kobo.250.2">Let us create a new package called </span><strong class="source-inline"><span class="kobospan" id="kobo.251.1">firebase</span></strong><span class="kobospan" id="kobo.252.1">. </span><span class="kobospan" id="kobo.252.2">Inside this package, let us create a new file called </span><strong class="source-inline"><span class="kobospan" id="kobo.253.1">FirebaseMessagingService.kt</span></strong><span class="kobospan" id="kobo.254.1">. </span><span class="kobospan" id="kobo.254.2">This will be our service that will handle notifications that </span><span><span class="kobospan" id="kobo.255.1">are received.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.256.1">Let us add the following code </span><span><span class="kobospan" id="kobo.257.1">to it:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.258.1">
class FirebaseNotificationService: FirebaseMessagingService() {
    override fun onNewToken(token: String) {
        super.onNewToken(token)
        Log.d("Firebase Token", token)
    }
    override fun onMessageReceived(remoteMessage: RemoteMessage) {
        super.onMessageReceived(remoteMessage)
        sendNotification(remoteMessage)
    }
    private fun sendNotification(remoteMessage: RemoteMessage) {
        val notification = NotificationCompat.Builder(applicationContext, "Pets Apps")
            .setContentTitle(remoteMessage.notification?.title)
            .setTicker(remoteMessage.notification?.ticker)
            .setContentText(remoteMessage.notification?.body)
            .setContentInfo(remoteMessage.notification?.body)
             .setStyle(NotificationCompat.BigTextStyle().bigText(remoteMessage.notification?.body))
            .setSmallIcon(R.drawable.ic_launcher_background)
        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {
            createChannel(notification, "Pets Apps")
        }
    }
    @RequiresApi(Build.VERSION_CODES.O)
    private fun createChannel(notificationBuilder: NotificationCompat.Builder, id: String) {
        notificationBuilder.setDefaults(Notification.DEFAULT_VIBRATE)
        val channel = NotificationChannel(
            id,
            "Pets Apps",
            NotificationManager.IMPORTANCE_HIGH
        )
        channel.description = "Pets Apps"
        val notificationManager: NotificationManager =
            getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
        notificationManager.createNotificationChannel(channel)
    }
}</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.259.1">The following is a breakdown of the </span><span><span class="kobospan" id="kobo.260.1">preceding code:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.261.1">We have created a class called </span><strong class="source-inline1"><span class="kobospan" id="kobo.262.1">FirebaseNotificationService</span></strong><span class="kobospan" id="kobo.263.1"> that extends </span><strong class="source-inline1"><span class="kobospan" id="kobo.264.1">FirebaseMessagingService</span></strong><span class="kobospan" id="kobo.265.1">. </span><span class="kobospan" id="kobo.265.2">This is the service that will handle notifications that </span><span><span class="kobospan" id="kobo.266.1">are received.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.267.1">We have </span><a id="_idIndexMarker785" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.268.1">overridden the </span><strong class="source-inline1"><span class="kobospan" id="kobo.269.1">onNewToken()</span></strong><span class="kobospan" id="kobo.270.1"> function. </span><span class="kobospan" id="kobo.270.2">This function is called when a new token is generated. </span><span class="kobospan" id="kobo.270.3">We can use this token to send notifications to our app. </span><span class="kobospan" id="kobo.270.4">We have added a log message to log the token to our Logcat. </span><span class="kobospan" id="kobo.270.5">Alternatively, we can send the token to our backend server to be used to send notifications to our app if we have such </span><span><span class="kobospan" id="kobo.271.1">a requirement.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.272.1">We have overridden the </span><strong class="source-inline1"><span class="kobospan" id="kobo.273.1">onMessageReceived()</span></strong><span class="kobospan" id="kobo.274.1"> function. </span><span class="kobospan" id="kobo.274.2">This function is called when a notification is received. </span><span class="kobospan" id="kobo.274.3">We have called the </span><strong class="source-inline1"><span class="kobospan" id="kobo.275.1">sendNotification()</span></strong><span class="kobospan" id="kobo.276.1"> function and passed the </span><strong class="source-inline1"><span class="kobospan" id="kobo.277.1">RemoteMessage</span></strong><span class="kobospan" id="kobo.278.1"> object </span><span><span class="kobospan" id="kobo.279.1">to it.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.280.1">The </span><strong class="source-inline1"><span class="kobospan" id="kobo.281.1">sendNotification()</span></strong><span class="kobospan" id="kobo.282.1"> function creates a notification and shows it to the user. </span><span class="kobospan" id="kobo.282.2">We have used the </span><strong class="source-inline1"><span class="kobospan" id="kobo.283.1">NotificationCompat.Builder</span></strong><span class="kobospan" id="kobo.284.1"> class to create the notification. </span><span class="kobospan" id="kobo.284.2">We have also used the </span><strong class="source-inline1"><span class="kobospan" id="kobo.285.1">RemoteMessage</span></strong><span class="kobospan" id="kobo.286.1"> object to get the notification </span><strong class="source-inline1"><span class="kobospan" id="kobo.287.1">title</span></strong><span class="kobospan" id="kobo.288.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.289.1">body</span></strong><span class="kobospan" id="kobo.290.1">, and </span><strong class="source-inline1"><span class="kobospan" id="kobo.291.1">ticker</span></strong><span class="kobospan" id="kobo.292.1">. </span><span class="kobospan" id="kobo.292.2">We have also set up a small icon to be used for the notification. </span><span class="kobospan" id="kobo.292.3">We additionally set the notification channel if the device is running on Android Oreo or more </span><span><span class="kobospan" id="kobo.293.1">recent versions.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.294.1">Lastly, we have created the </span><strong class="source-inline1"><span class="kobospan" id="kobo.295.1">createChannel()</span></strong><span class="kobospan" id="kobo.296.1"> function, which creates the notification </span><a id="_idIndexMarker786" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.297.1">channel using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.298.1">NotificationChannel</span></strong><span class="kobospan" id="kobo.299.1"> class. </span><span class="kobospan" id="kobo.299.2">We have also set the channel description and the importance of the channel. </span><span class="kobospan" id="kobo.299.3">Additionally, we have set the default vibration for the channel. </span><span class="kobospan" id="kobo.299.4">Finally, we have created the notification manager and used it to create </span><span><span class="kobospan" id="kobo.300.1">the channel.</span></span></li>
</ul>
<p class="calibre4"><span class="kobospan" id="kobo.301.1">With the service created, we need to register it in our </span><strong class="source-inline"><span class="kobospan" id="kobo.302.1">AndroidManifest.xml</span></strong><span class="kobospan" id="kobo.303.1"> file. </span><span class="kobospan" id="kobo.303.2">Let us add the following code </span><span><span class="kobospan" id="kobo.304.1">to it:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.305.1">
&lt;service
    android:name=".firebase.FirebaseNotificationService"
    android:exported="false"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="com.google.firebase.MESSAGING_EVENT" /&gt;
    &lt;/intent-filter&gt;
&lt;/service&gt;</span></pre> <p class="calibre4"><span class="kobospan" id="kobo.306.1">With the service registered, we can now receive notifications in our app. </span><span class="kobospan" id="kobo.306.2">Run the app with the </span><span><span class="kobospan" id="kobo.307.1">recent changes.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.308.1">Next, let us test this by sending a notification from the Firebase console. </span><span class="kobospan" id="kobo.308.2">We can do this by going to our Firebase </span><a id="_idIndexMarker787" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.309.1">console and selecting the </span><strong class="bold"><span class="kobospan" id="kobo.310.1">Cloud Messaging</span></strong><span class="kobospan" id="kobo.311.1"> option from the navigation drawer, which is in the </span><strong class="bold"><span class="kobospan" id="kobo.312.1">Engage</span></strong><span class="kobospan" id="kobo.313.1"> category. </span><span class="kobospan" id="kobo.313.2">It shows the </span><span><span class="kobospan" id="kobo.314.1">following screen:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer258">
<span class="kobospan" id="kobo.315.1"><img alt="Figure 15.15 – Firebase Cloud Messaging landing page" src="image/B19779_15_15.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.316.1">Figure 15.15 – Firebase Cloud Messaging landing page</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.317.1">This is our first time using Cloud Messaging, so we need to create a new campaign. </span><span class="kobospan" id="kobo.317.2">Tap the </span><strong class="bold"><span class="kobospan" id="kobo.318.1">Create your first campaign</span></strong><span class="kobospan" id="kobo.319.1"> button. </span><span class="kobospan" id="kobo.319.2">This opens a new dialog with the </span><span><span class="kobospan" id="kobo.320.1">following options:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer259">
<span class="kobospan" id="kobo.321.1"><img alt="Figure 15.16 – Firebase Cloud Messaging options" src="image/B19779_15_16.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.322.1">Figure 15.16 – Firebase Cloud Messaging options</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.323.1">We can send either </span><strong class="bold"><span class="kobospan" id="kobo.324.1">Firebase Notification messages</span></strong><span class="kobospan" id="kobo.325.1"> or </span><strong class="bold"><span class="kobospan" id="kobo.326.1">Firebase In-App messages</span></strong><span class="kobospan" id="kobo.327.1">. </span><span class="kobospan" id="kobo.327.2">Firebase notifications are designed to reach users outside of the app, delivering messages through </span><a id="_idIndexMarker788" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.328.1">push notifications even when our app is inactive. </span><span class="kobospan" id="kobo.328.2">In contrast, Firebase in-app messages are tailored to engage users actively using our app by displaying content directly within the app’s interface. </span><span class="kobospan" id="kobo.328.3">Firebase notifications are suitable for sending timely updates or promotions, while in-app messages are effective for delivering contextual content and enhancing the user experience within our app. </span><span class="kobospan" id="kobo.328.4">We are interested in </span><strong class="bold"><span class="kobospan" id="kobo.329.1">Firebase Notification messages</span></strong><span class="kobospan" id="kobo.330.1">. </span><span class="kobospan" id="kobo.330.2">Select the </span><strong class="bold"><span class="kobospan" id="kobo.331.1">Firebase Notification messages</span></strong><span class="kobospan" id="kobo.332.1"> option and tap </span><strong class="bold"><span class="kobospan" id="kobo.333.1">Create</span></strong><span class="kobospan" id="kobo.334.1">. </span><span class="kobospan" id="kobo.334.2">This brings us to the </span><span><span class="kobospan" id="kobo.335.1">following screen:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer260">
<span class="kobospan" id="kobo.336.1"><img alt="Figure 15.17 – Creating a new notification" src="image/B19779_15_17.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.337.1">Figure 15.17 – Creating a new notification</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.338.1">In this screen, we add the</span><a id="_idIndexMarker789" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.339.1"> title and text for our notification. </span><span class="kobospan" id="kobo.339.2">Once you fill in these details, tap </span><strong class="bold"><span class="kobospan" id="kobo.340.1">Next</span></strong><span class="kobospan" id="kobo.341.1"> to proceed to the </span><span><span class="kobospan" id="kobo.342.1">next steps:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer261">
<span class="kobospan" id="kobo.343.1"><img alt="Figure 15.18 – Target and Scheduling settings" src="image/B19779_15_18.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.344.1">Figure 15.18 – Target and Scheduling settings</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.345.1">As seen in </span><span><em class="italic"><span class="kobospan" id="kobo.346.1">Figure 15</span></em></span><em class="italic"><span class="kobospan" id="kobo.347.1">.17</span></em><span class="kobospan" id="kobo.348.1">, we set the target app for our notification. </span><span class="kobospan" id="kobo.348.2">In this case, it is the app that we created earlier</span><a id="_idIndexMarker790" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.349.1"> in the </span><em class="italic"><span class="kobospan" id="kobo.350.1">Using Firebase Crashlytics to detect crashes</span></em><span class="kobospan" id="kobo.351.1"> section of this chapter. </span><span class="kobospan" id="kobo.351.2">We then set the schedule for our notification. </span><span class="kobospan" id="kobo.351.3">We have set the scheduling setting to </span><strong class="bold"><span class="kobospan" id="kobo.352.1">Send now</span></strong><span class="kobospan" id="kobo.353.1">. </span><span class="kobospan" id="kobo.353.2">Tap the </span><strong class="bold"><span class="kobospan" id="kobo.354.1">Review</span></strong><span class="kobospan" id="kobo.355.1"> button, which shows a dialog with the information we </span><span><span class="kobospan" id="kobo.356.1">have set:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer262">
<span class="kobospan" id="kobo.357.1"><img alt="Figure 15.19 – Review message dialog" src="image/B19779_15_19.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.358.1">Figure 15.19 – Review message dialog</span></p>
<p class="calibre4"><span class="kobospan" id="kobo.359.1">Tap the </span><strong class="bold"><span class="kobospan" id="kobo.360.1">Publish</span></strong><span class="kobospan" id="kobo.361.1"> button to publish the notification. </span><span class="kobospan" id="kobo.361.2">This will send a notification to our app. </span><span class="kobospan" id="kobo.361.3">We can now see the </span><a id="_idIndexMarker791" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.362.1">notification from </span><span><span class="kobospan" id="kobo.363.1">our app:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer263">
<span class="kobospan" id="kobo.364.1"><img alt="Figure 15.20 – First notification" src="image/B19779_15_20.jpg" class="calibre5"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.365.1">Figure 15.20 – First notification</span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.366.1">Important note</span></p>
<p class="callout"><span class="kobospan" id="kobo.367.1">Ensure that you always test using a real device to see </span><span><span class="kobospan" id="kobo.368.1">your notifications.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.369.1">We learned how to set up Firebase Cloud Messaging in our app and how to send notifications to it. </span><span class="kobospan" id="kobo.369.2">In the next section, we will cover yet another critical topic—securing </span><span><span class="kobospan" id="kobo.370.1">our app.</span></span></p>
<h1 id="_idParaDest-184" class="calibre6"><a id="_idTextAnchor221" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.371.1">Securing your app</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.372.1">Ensuring your apps are secure is particularly important. </span><span class="kobospan" id="kobo.372.2">We need to ensure that our users’ data is safe and secure. </span><span class="kobospan" id="kobo.372.3">We also need to ensure that our app is not vulnerable to attacks. </span><span class="kobospan" id="kobo.372.4">Attacks such as malware, man-in-the-middle attacks, and data interception pose risks to sensitive information, while vulnerabilities such as SQL injection and privilege escalation can lead to</span><a id="_idIndexMarker792" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.373.1"> unauthorized access and manipulation of databases or app functionalities. </span><span class="kobospan" id="kobo.373.2">Cross-site scripting and code injection present avenues for attackers to execute malicious scripts or commands within the app, potentially compromising user sessions and data. </span><span class="kobospan" id="kobo.373.3">Insecure data storage practices may expose sensitive information, and denial-of-service attacks can disrupt </span><span><span class="kobospan" id="kobo.374.1">app services.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.375.1">In this section, we are going to see some tips and tricks for securing our app. </span><span class="kobospan" id="kobo.375.2">The following are some of the things that we can do to secure </span><span><span class="kobospan" id="kobo.376.1">our app:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.377.1">HTTPS</span></strong><span class="kobospan" id="kobo.378.1">: We should always use </span><strong class="source-inline1"><span class="kobospan" id="kobo.379.1">HTTPS</span></strong><span class="kobospan" id="kobo.380.1"> for all our network requests, which adds an extra layer of security to </span><span><span class="kobospan" id="kobo.381.1">our app.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.382.1">Code minification and obfuscation</span></strong><span class="kobospan" id="kobo.383.1">: We should always minify and obfuscate our code to make it harder for attackers to reverse engineer our app. </span><span class="kobospan" id="kobo.383.2">We already did this in </span><a href="B19779_13.xhtml#_idTextAnchor175" class="calibre3 pcalibre pcalibre1"><span><em class="italic"><span class="kobospan" id="kobo.384.1">Chapter 13</span></em></span></a><span class="kobospan" id="kobo.385.1"> for our </span><span><span class="kobospan" id="kobo.386.1">release build.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.387.1">Encryption</span></strong><span class="kobospan" id="kobo.388.1">: We should always encrypt sensitive data that we store in </span><span><span class="kobospan" id="kobo.389.1">our app.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.390.1">Passwords and private keys</span></strong><span class="kobospan" id="kobo.391.1">: Never store passwords and private keys in Shared Preferences. </span><span class="kobospan" id="kobo.391.2">We can always store them in other secure alternatives, such as the Android Keystore system used for storing </span><span><span class="kobospan" id="kobo.392.1">cryptographic keys.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.393.1">Minimizing logged information</span></strong><span class="kobospan" id="kobo.394.1">: We should always minimize the information that we log. </span><span class="kobospan" id="kobo.394.2">We should never log sensitive information such as passwords and </span><span><span class="kobospan" id="kobo.395.1">private keys.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.396.1">Internal storage</span></strong><span class="kobospan" id="kobo.397.1">: We should always use internal storage for sensitive data. </span><span class="kobospan" id="kobo.397.2">This is because internal storage is private to our app and other apps cannot </span><span><span class="kobospan" id="kobo.398.1">access it.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.399.1">WebView</span></strong><span class="kobospan" id="kobo.400.1">: We use WebView to display web content in our app. </span><span class="kobospan" id="kobo.400.2">This can introduce security issues on our app, so we should be careful when </span><span><span class="kobospan" id="kobo.401.1">using WebView.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.402.1">Dependencies</span></strong><span class="kobospan" id="kobo.403.1">: We should always keep all our dependencies up to date. </span><span class="kobospan" id="kobo.403.2">This is because new versions of dependencies might have security fixes that we need to apply to our app. </span><span class="kobospan" id="kobo.403.3">We use tools such as Dependabot (</span><a href="https://github.com/dependabot" class="calibre3 pcalibre pcalibre1"><span class="kobospan" id="kobo.404.1">https://github.com/dependabot</span></a><span class="kobospan" id="kobo.405.1">) to automate </span><span><span class="kobospan" id="kobo.406.1">dependency updates.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.407.1">Emulators or rooted devices</span></strong><span class="kobospan" id="kobo.408.1">: For payment or banking apps, ensure that they do not work on emulators or</span><a id="_idIndexMarker793" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.409.1"> rooted devices. </span><span class="kobospan" id="kobo.409.2">With emulators and rooted devices, it is easy to change your code or view the data that is being sent to the server or stored in our app. </span><span class="kobospan" id="kobo.409.3">This can lead to </span><span><span class="kobospan" id="kobo.410.1">security issues.</span></span></li>
<li class="calibre15"><strong class="bold"><span class="kobospan" id="kobo.411.1">Permissions</span></strong><span class="kobospan" id="kobo.412.1">: We should always use the necessary permissions in our app. </span><span class="kobospan" id="kobo.412.2">We should not use permissions that we do not need. </span><span class="kobospan" id="kobo.412.3">This is because permissions can be used to access sensitive data in </span><span><span class="kobospan" id="kobo.413.1">our app.</span></span></li>
</ul>
<p class="calibre4"><span class="kobospan" id="kobo.414.1">As you develop your apps, always keep security in mind. </span><span class="kobospan" id="kobo.414.2">This will help you ensure that your app is secure and that your users’ data is safe. </span><span class="kobospan" id="kobo.414.3">You can learn more about Android security from the official Android documentation </span><span><span class="kobospan" id="kobo.415.1">at </span></span><a href="https://developer.android.com/privacy-and-security/security-tips" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.416.1">https://developer.android.com/privacy-and-security/security-tips</span></span></a><span><span class="kobospan" id="kobo.417.1">.</span></span></p>
<h1 id="_idParaDest-185" class="calibre6"><a id="_idTextAnchor222" class="calibre3 pcalibre pcalibre1"/><span class="kobospan" id="kobo.418.1">Summary</span></h1>
<p class="calibre4"><span class="kobospan" id="kobo.419.1">In this chapter, we have learned techniques for improving our apps by adding analytics—in this case, Firebase Crashlytics—and how to use cloud messaging to increase user engagement in our apps. </span><span class="kobospan" id="kobo.419.2">Additionally, we learned some tips and tricks for securing </span><span><span class="kobospan" id="kobo.420.1">our apps.</span></span></p>
<p class="calibre4"><span class="kobospan" id="kobo.421.1">We have come to the end of this chapter and book. </span><span class="kobospan" id="kobo.421.2">We hope that you’ve enjoyed following along with the chapters and that you’re now in a position to develop Android apps with the knowledge gained from this book. </span><span class="kobospan" id="kobo.421.3">What are the next steps? </span><span class="kobospan" id="kobo.421.4">Here are some of the things that you </span><span><span class="kobospan" id="kobo.422.1">can do:</span></span></p>
<ul class="calibre16">
<li class="calibre15"><span class="kobospan" id="kobo.423.1">Secure your app using the tips and tricks we went over in </span><span><span class="kobospan" id="kobo.424.1">this chapter.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.425.1">Inspect, improve, and monitor the performance of your app. </span><span class="kobospan" id="kobo.425.2">You can learn more about this from the official documentation </span><span><span class="kobospan" id="kobo.426.1">at </span></span><a href="https://developer.android.com/topic/performance/overview" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.427.1">https://developer.android.com/topic/performance/overview</span></span></a><span><span class="kobospan" id="kobo.428.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.429.1">Learn more about </span><strong class="bold"><span class="kobospan" id="kobo.430.1">Modern Android Development</span></strong><span class="kobospan" id="kobo.431.1"> (</span><strong class="bold"><span class="kobospan" id="kobo.432.1">MAD</span></strong><span class="kobospan" id="kobo.433.1">). </span><span class="kobospan" id="kobo.433.2">MAD is a set of tools and libraries that help us develop Android apps faster and better. </span><span class="kobospan" id="kobo.433.3">You can learn more about M.A.D from the official documentation </span><span><span class="kobospan" id="kobo.434.1">at </span></span><a href="https://developer.android.com/modern-android-development" class="calibre3 pcalibre pcalibre1"><span><span class="kobospan" id="kobo.435.1">https://developer.android.com/modern-android-development</span></span></a><span><span class="kobospan" id="kobo.436.1">.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.437.1">Learn more about Google Play Vitals and how you can use the information at </span><a href="https://play.google.com/console/about/vitals/" class="calibre3 pcalibre pcalibre1"><span class="kobospan" id="kobo.438.1">https://play.google.com/console/about/vitals/</span></a><span class="kobospan" id="kobo.439.1"> to improve the quality of </span><span><span class="kobospan" id="kobo.440.1">your app.</span></span></li>
<li class="calibre15"><span class="kobospan" id="kobo.441.1">Keep learning about Kotlin and Android. </span><span class="kobospan" id="kobo.441.2">Build more apps and share them with the world. </span><span class="kobospan" id="kobo.441.3">You can also contribute to open </span><span><span class="kobospan" id="kobo.442.1">source projects.</span></span></li>
</ul>
</div>
</body></html>