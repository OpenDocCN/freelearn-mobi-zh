<html><head></head><body>
<div><h1 class="chapter-number" id="_idParaDest-178"><a id="_idTextAnchor215" class="calibre3 pcalibre pcalibre1"/>15</h1>
<h1 id="_idParaDest-179" class="calibre6"><a id="_idTextAnchor216" class="calibre3 pcalibre pcalibre1"/>Improving Your App</h1>
<p class="calibre4">After we complete the development and publishing of our app, it is important to always be on the lookout when using things that help improve our apps, such as Firebase Messaging or Crashlytics. We are going to be learning how to use Firebase Messaging and Crashlytics in this chapter.</p>
<p class="calibre4">In this chapter, we will learn step-by-step techniques on how to improve our apps by adding analytics—Firebase Crashlytics—and how to use cloud messaging to increase user engagement. We will learn how to send notifications to our apps from the Firebase console. Additionally, we will learn some tips and tricks for securing our apps to ensure that user data is not compromised.</p>
<p class="calibre4">In this chapter, we’re going to cover the following main topics:</p>
<ul class="calibre16">
<li class="calibre15">Using Firebase Crashlytics to detect crashes</li>
<li class="calibre15">Improving app engagement with Firebase Messaging</li>
<li class="calibre15">Securing your app</li>
</ul>
<h1 id="_idParaDest-180" class="calibre6"><a id="_idTextAnchor217" class="calibre3 pcalibre pcalibre1"/>Technical requirements</h1>
<p class="calibre4">To follow the instructions in this chapter, you will need to have Android Studio Hedgehog or a later version (<a href="https://developer.android.com/studio" class="calibre3 pcalibre pcalibre1">https://developer.android.com/studio</a>) downloaded.</p>
<p class="calibre4">You can use the previous chapter’s code to follow the instructions in this chapter. You can find the code for this chapter on GitHub at <a href="https://github.com/PacktPublishing/Mastering-Kotlin-for-Android/tree/main/chapterfifteen" class="calibre3 pcalibre pcalibre1">https://github.com/PacktPublishing/Mastering-Kotlin-for-Android/tree/main/chapterfifteen</a>.</p>
<h1 id="_idParaDest-181" class="calibre6"><a id="_idTextAnchor218" class="calibre3 pcalibre pcalibre1"/>Using Firebase Crashlytics to detect crashes</h1>
<p class="calibre4">Crashes can happen in our <a id="_idIndexMarker766" class="calibre3 pcalibre pcalibre1"/>apps for a variety of reasons, including common coding issues such as null pointer exceptions, memory leaks, and improper data handling. Device fragmentation caused by different device hardware configurations and different Android operation systems introduces compatibility issues that may at times cause crashes too. Network issues, insufficient resources, or mismanagement of external dependencies, such as third-party libraries, can cause crashes too. Sometimes, we can anticipate and handle them gracefully. Other times, they are unexpected and we need to know about them so we can fix them. Our app is already on Google Play Store, so at times, we might not have the luxury to debug on the devices that are having<a id="_idIndexMarker767" class="calibre3 pcalibre pcalibre1"/> issues. Tools such as <strong class="bold">Firebase Crashlytics</strong> can help us detect crashes in our apps and provide us with the information we need to fix them. In this section, we will be setting up Firebase Crashlytics in our app and seeing how we can use it to detect crashes.</p>
<p class="calibre4">Android Studio has a built-in Firebase tool to help us quickly add Firebase to our app. We can access it from <strong class="bold">Tools</strong> | <strong class="bold">Firebase</strong>, which should open a side panel on the right, as shown in the following figure:</p>
<div><div><img alt="Figure 15.1 – Firebase setup" src="img/B19779_15_01.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.1 – Firebase setup</p>
<p class="calibre4">As seen in <em class="italic">Figure 15</em><em class="italic">.1</em>, we can set up a variety of Firebase SDKs from this tool. We are interested in setting<a id="_idIndexMarker768" class="calibre3 pcalibre pcalibre1"/> up <strong class="bold">Crashlytics</strong>. Tap on the <strong class="bold">Crashlytics</strong> option and we will see the following options:</p>
<div><div><img alt="Figure 15.2 – Firebase Crashlytics setup" src="img/B19779_15_02.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.2 – Firebase Crashlytics setup</p>
<p class="calibre4">Since our project is written in Kotlin, we are going to select <strong class="bold">Get started with Firebase Crashlytics</strong> as an<a id="_idIndexMarker769" class="calibre3 pcalibre pcalibre1"/> option. This will open a new window with the following instructions:</p>
<div><div><img alt="Figure 15.3 – Steps to set up Crashlytics" src="img/B19779_15_03.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.3 – Steps to set up Crashlytics</p>
<p class="calibre4">As seen from <em class="italic">Figure 15</em><em class="italic">.3</em>, it provides all the steps necessary for us to set up Firebase Crashlytics in our app. Let us tap the <strong class="bold">Connect to Firebase</strong> option. This opens a new tab in our browser with the Firebase console opened (see <em class="italic">Figure 15</em><em class="italic">.4</em>). It shows all the Firebase projects that we have on our console (if we have any). Use the <strong class="bold">Create a project</strong> option and specify your preferred project name:</p>
<div><div><img alt="Figure 15.4 – New Firebase project" src="img/B19779_15_04.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.4 – New Firebase project</p>
<p class="calibre4">Click <strong class="bold">Continue</strong> to proceed<a id="_idIndexMarker770" class="calibre3 pcalibre pcalibre1"/> to the next step. This will take us to the following screen:</p>
<div><div><img alt="Figure 15.5 –Google Analytics setup" src="img/B19779_15_05.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.5 –Google Analytics setup</p>
<p class="calibre4">In this screen, we configure Google Analytics for our app. It also shows the functionalities that<a id="_idIndexMarker771" class="calibre3 pcalibre pcalibre1"/> Google Analytics provides for our app. Google Analytics collects usage and behavior data for our apps. We use it for tracking user events, system events, or errors, analyzing app performance, collecting user properties such as language preference and geographic location, and so on.</p>
<p class="calibre4">Click <strong class="bold">Continue</strong> to proceed to the next step:</p>
<div><div><img alt="Figure 15.6 – Configuring Google Analytics" src="img/B19779_15_06.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.6 – Configuring Google Analytics</p>
<p class="calibre4">In this step, we configure more options for Google Analytics. We must select a Google Analytics account. Selecting<a id="_idIndexMarker772" class="calibre3 pcalibre pcalibre1"/> the default account hides the other questions if you have already configured other projects. When done, click <strong class="bold">Create project</strong> to finalize creating the project and you will see the following dialog:</p>
<div><div><img alt="Figure 15.7 – Finalizing setup dialog" src="img/B19779_15_07.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.7 – Finalizing setup dialog</p>
<p class="calibre4">Clicking <strong class="bold">Connect</strong> after our<a id="_idIndexMarker773" class="calibre3 pcalibre pcalibre1"/> project is created finalizes the setup of Firebase Crashlytics with Android Studio. Let us head back to Android Studio and see what has changed. We can see that the Firebase Crashlytics option is now checked:</p>
<div><div><img alt="Figure 15.8 – App connected" src="img/B19779_15_08.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.8 – App connected</p>
<p class="calibre4">The next step is to add the Firebase Crashlytics SDK to our app. We can do this by clicking the <strong class="bold">Add Crashlytics SDK and plugin to your app</strong> button. This will add the necessary dependencies to our app. You can check the Gradle files to see these changes.</p>
<p class="calibre4">With all the steps <a id="_idIndexMarker774" class="calibre3 pcalibre pcalibre1"/>complete, we can now <code>MainActivity.kt</code> file inside the <code>onCreate()</code> function:</p>
<pre class="source-code">
throw RuntimeException("Test Crash")</pre> <p class="calibre4">Now, run the app. The app will crash with the following stack trace:</p>
<div><div><img alt="Figure 15.9 – Crash stack trace" src="img/B19779_15_09.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.9 – Crash stack trace</p>
<p class="calibre4">We can head over to our newly created project in the Firebase console and see if the crash has been reported. In the <a id="_idIndexMarker775" class="calibre3 pcalibre pcalibre1"/>Firebase console, Crashlytics is normally found under the <strong class="bold">Release and Monitor</strong> section on the navigation drawer, which is on the left side of the screen. It shows the following screen:</p>
<div><div><img alt="Figure 15.10 – Firebase console crash overview" src="img/B19779_15_10.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.10 – Firebase console crash overview</p>
<p class="calibre4">We can see that the crash has been reported. We can click on the <code>MainActivity.onCreate</code> crash to see more details about it. It shows the following screen:</p>
<div><div><img alt="Figure 15.11 – Firebase console crash details" src="img/B19779_15_11.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.11 – Firebase console crash details</p>
<p class="calibre4">As seen in <em class="italic">Figure 15</em><em class="italic">.10</em>, we have the <a id="_idIndexMarker776" class="calibre3 pcalibre pcalibre1"/>following details from the Firebase console:</p>
<ul class="calibre16">
<li class="calibre15"><strong class="bold">Stack trace</strong>: This shows the stack trace of the crash.</li>
<li class="calibre15"><strong class="bold">Device</strong>: This shows the device that the crash happened on. We can see the device model, the OS version, and the device state.</li>
<li class="calibre15"><strong class="bold">App version</strong>: This shows the version of the app that crashed. It also shows the total number of crashes that have happened for that version.</li>
</ul>
<p class="calibre4">This information is very helpful when debugging crashes. Android Studio Hedgehog and more recent versions also have a useful tool, <strong class="bold">App Quality Insights</strong>, that helps us view the Firebase crashes right from Android Studio. We can access it from the bottom tool tabs, as shown:</p>
<div><div><img alt="Figure 15.12 – App Quality Insights" src="img/B19779_15_12.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.12 – App Quality Insights</p>
<p class="calibre4">As seen in <em class="italic">Figure 15</em><em class="italic">.11</em>, we need to log in to our Firebase account that has the project we are working on. We can<a id="_idIndexMarker777" class="calibre3 pcalibre pcalibre1"/> do this by clicking on the <strong class="bold">Log in</strong> button and completing the login process on our browser. Once logged in, we can see the crashes that have happened in our app:</p>
<div><div><img alt="Figure 15.13 – App Quality Insights crash details" src="img/B19779_15_13.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.13 – App Quality Insights crash details</p>
<p class="calibre4">This shows all the details, as we saw earlier in our Firebase console. We can see the stack trace too. The beauty of this is that we can easily navigate to the file and line causing the crash without having to switch context and go to the browser.</p>
<p class="calibre4">With Firebase Crashlytics set up, we can now detect crashes in our app and fix them. This will help us improve the quality of our app and make our users happy.</p>
<p class="callout-heading">Important note</p>
<p class="callout">Remember to remove the code that we added to force a crash in our app.</p>
<p class="calibre4">Next, let us set up <strong class="bold">Firebase Analytics</strong>, which also<a id="_idIndexMarker778" class="calibre3 pcalibre pcalibre1"/> gathers useful information about our app. This will help us understand how our users are using our app and help us make informed decisions on how to improve it.</p>
<h2 id="_idParaDest-182" class="calibre7"><a id="_idTextAnchor219" class="calibre3 pcalibre pcalibre1"/>Setting up Google Analytics</h2>
<p class="calibre4">Setting up Google <a id="_idIndexMarker779" class="calibre3 pcalibre pcalibre1"/>Analytics is like setting up Firebase Crashlytics. Repeat<a id="_idIndexMarker780" class="calibre3 pcalibre pcalibre1"/> the following steps that you took for Firebase Crashlytics:</p>
<ol class="calibre14">
<li class="calibre15">Open the Firebase tool from <strong class="bold">Tools</strong> | <strong class="bold">Firebase</strong>.</li>
<li class="calibre15">Select <strong class="bold">Analytics</strong> from the list of options that is similar to the list we saw in <em class="italic">Figure 15</em><em class="italic">.1</em>.</li>
<li class="calibre15">Select the <strong class="bold">Get started with Google </strong><strong class="bold">Analytics</strong> option.</li>
<li class="calibre15">Since our app is already connected to Firebase, we can skip the first step and proceed to the next step.</li>
<li class="calibre15">Tap the <strong class="bold">Add Analytics to your app</strong> button to add the necessary dependencies to our app.</li>
<li class="calibre15">Once Gradle sync is complete, we have finalized setting up Firebase Analytics in our app.</li>
</ol>
<p class="calibre4">With that set, we can always view the analytics from the Firebase console. We can access it from the navigation drawer under the <strong class="bold">Analytics</strong> section. It shows the following screen:</p>
<div><div><img alt="Figure 15.14 – App analytics" src="img/B19779_15_14.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.14 – App analytics</p>
<p class="calibre4">We have learned how to set <a id="_idIndexMarker781" class="calibre3 pcalibre pcalibre1"/>up Firebase Crashlytics and Firebase Analytics in our app. We can now detect crashes in our app and gather useful information about our app. This will help us<a id="_idIndexMarker782" class="calibre3 pcalibre pcalibre1"/> improve the quality of our app and make our users happy.</p>
<p class="calibre4">In the next section, we will learn how to use Firebase Cloud Messaging to send notifications to our app.</p>
<h1 id="_idParaDest-183" class="calibre6"><a id="_idTextAnchor220" class="calibre3 pcalibre pcalibre1"/>Improving app engagement with Firebase Messaging</h1>
<p class="calibre4">When users install our app, they <a id="_idIndexMarker783" class="calibre3 pcalibre pcalibre1"/>might not use it again after they finish what they want to do. This can lead to a decline in the number of active users, which can have different impacts on different apps.</p>
<p class="calibre4">We can leverage <strong class="bold">Firebase Cloud Messaging</strong> to send notifications to our users to remind them of our app. This will help us improve our app’s engagement and increase the number of active users. In this section, we will be setting up Firebase Cloud Messaging in our app and see how we can use it to send notifications to our app users.</p>
<p class="calibre4">First, we need to set up the Firebase Cloud Messaging SDK on our app. This allows us to use the SDK within our project and enables our app to receive Firebase notifications once the setup is complete. We will do it the same way we did for Firebase Crashlytics and Firebase Analytics. Repeat<a id="_idIndexMarker784" class="calibre3 pcalibre pcalibre1"/> the following steps:</p>
<ol class="calibre14">
<li class="calibre15">Open the Firebase tool from <strong class="bold">Tools</strong> | <strong class="bold">Firebase</strong>.</li>
<li class="calibre15">Select <strong class="bold">Cloud Messaging</strong> from the list of options that is similar to the list we saw in <em class="italic">Figure 15</em><em class="italic">.1</em>.</li>
<li class="calibre15">Select the <strong class="bold">Setup Firebase Cloud </strong><strong class="bold">Messaging</strong> option.</li>
<li class="calibre15">Since our app is already connected to Firebase, we can skip the first step and proceed to the next step.</li>
<li class="calibre15">Tap the <strong class="bold">Add FCM to your app</strong> button to add the necessary dependencies to the app.</li>
<li class="calibre15">Once Gradle sync is complete, the FCM SDK is already set up in our app.</li>
</ol>
<p class="calibre4">We need to create a new service to handle notifications when they are received and to also get the device token. Let us create a new package called <code>firebase</code>. Inside this package, let us create a new file called <code>FirebaseMessagingService.kt</code>. This will be our service that will handle notifications that are received.</p>
<p class="calibre4">Let us add the following code to it:</p>
<pre class="source-code">
class FirebaseNotificationService: FirebaseMessagingService() {
    override fun onNewToken(token: String) {
        super.onNewToken(token)
        Log.d("Firebase Token", token)
    }
    override fun onMessageReceived(remoteMessage: RemoteMessage) {
        super.onMessageReceived(remoteMessage)
        sendNotification(remoteMessage)
    }
    private fun sendNotification(remoteMessage: RemoteMessage) {
        val notification = NotificationCompat.Builder(applicationContext, "Pets Apps")
            .setContentTitle(remoteMessage.notification?.title)
            .setTicker(remoteMessage.notification?.ticker)
            .setContentText(remoteMessage.notification?.body)
            .setContentInfo(remoteMessage.notification?.body)
             .setStyle(NotificationCompat.BigTextStyle().bigText(remoteMessage.notification?.body))
            .setSmallIcon(R.drawable.ic_launcher_background)
        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {
            createChannel(notification, "Pets Apps")
        }
    }
    @RequiresApi(Build.VERSION_CODES.O)
    private fun createChannel(notificationBuilder: NotificationCompat.Builder, id: String) {
        notificationBuilder.setDefaults(Notification.DEFAULT_VIBRATE)
        val channel = NotificationChannel(
            id,
            "Pets Apps",
            NotificationManager.IMPORTANCE_HIGH
        )
        channel.description = "Pets Apps"
        val notificationManager: NotificationManager =
            getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
        notificationManager.createNotificationChannel(channel)
    }
}</pre> <p class="calibre4">The following is a breakdown of the preceding code:</p>
<ul class="calibre16">
<li class="calibre15">We have created a class called <strong class="source-inline1">FirebaseNotificationService</strong> that extends <strong class="source-inline1">FirebaseMessagingService</strong>. This is the service that will handle notifications that are received.</li>
<li class="calibre15">We have <a id="_idIndexMarker785" class="calibre3 pcalibre pcalibre1"/>overridden the <strong class="source-inline1">onNewToken()</strong> function. This function is called when a new token is generated. We can use this token to send notifications to our app. We have added a log message to log the token to our Logcat. Alternatively, we can send the token to our backend server to be used to send notifications to our app if we have such a requirement.</li>
<li class="calibre15">We have overridden the <strong class="source-inline1">onMessageReceived()</strong> function. This function is called when a notification is received. We have called the <strong class="source-inline1">sendNotification()</strong> function and passed the <strong class="source-inline1">RemoteMessage</strong> object to it.</li>
<li class="calibre15">The <strong class="source-inline1">sendNotification()</strong> function creates a notification and shows it to the user. We have used the <strong class="source-inline1">NotificationCompat.Builder</strong> class to create the notification. We have also used the <strong class="source-inline1">RemoteMessage</strong> object to get the notification <strong class="source-inline1">title</strong>, <strong class="source-inline1">body</strong>, and <strong class="source-inline1">ticker</strong>. We have also set up a small icon to be used for the notification. We additionally set the notification channel if the device is running on Android Oreo or more recent versions.</li>
<li class="calibre15">Lastly, we have created the <strong class="source-inline1">createChannel()</strong> function, which creates the notification <a id="_idIndexMarker786" class="calibre3 pcalibre pcalibre1"/>channel using the <strong class="source-inline1">NotificationChannel</strong> class. We have also set the channel description and the importance of the channel. Additionally, we have set the default vibration for the channel. Finally, we have created the notification manager and used it to create the channel.</li>
</ul>
<p class="calibre4">With the service created, we need to register it in our <code>AndroidManifest.xml</code> file. Let us add the following code to it:</p>
<pre class="source-code">
&lt;service
    android:name=".firebase.FirebaseNotificationService"
    android:exported="false"&gt;
    &lt;intent-filter&gt;
        &lt;action android:name="com.google.firebase.MESSAGING_EVENT" /&gt;
    &lt;/intent-filter&gt;
&lt;/service&gt;</pre> <p class="calibre4">With the service registered, we can now receive notifications in our app. Run the app with the recent changes.</p>
<p class="calibre4">Next, let us test this by sending a notification from the Firebase console. We can do this by going to our Firebase <a id="_idIndexMarker787" class="calibre3 pcalibre pcalibre1"/>console and selecting the <strong class="bold">Cloud Messaging</strong> option from the navigation drawer, which is in the <strong class="bold">Engage</strong> category. It shows the following screen:</p>
<div><div><img alt="Figure 15.15 – Firebase Cloud Messaging landing page" src="img/B19779_15_15.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.15 – Firebase Cloud Messaging landing page</p>
<p class="calibre4">This is our first time using Cloud Messaging, so we need to create a new campaign. Tap the <strong class="bold">Create your first campaign</strong> button. This opens a new dialog with the following options:</p>
<div><div><img alt="Figure 15.16 – Firebase Cloud Messaging options" src="img/B19779_15_16.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.16 – Firebase Cloud Messaging options</p>
<p class="calibre4">We can send either <strong class="bold">Firebase Notification messages</strong> or <strong class="bold">Firebase In-App messages</strong>. Firebase notifications are designed to reach users outside of the app, delivering messages through <a id="_idIndexMarker788" class="calibre3 pcalibre pcalibre1"/>push notifications even when our app is inactive. In contrast, Firebase in-app messages are tailored to engage users actively using our app by displaying content directly within the app’s interface. Firebase notifications are suitable for sending timely updates or promotions, while in-app messages are effective for delivering contextual content and enhancing the user experience within our app. We are interested in <strong class="bold">Firebase Notification messages</strong>. Select the <strong class="bold">Firebase Notification messages</strong> option and tap <strong class="bold">Create</strong>. This brings us to the following screen:</p>
<div><div><img alt="Figure 15.17 – Creating a new notification" src="img/B19779_15_17.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.17 – Creating a new notification</p>
<p class="calibre4">In this screen, we add the<a id="_idIndexMarker789" class="calibre3 pcalibre pcalibre1"/> title and text for our notification. Once you fill in these details, tap <strong class="bold">Next</strong> to proceed to the next steps:</p>
<div><div><img alt="Figure 15.18 – Target and Scheduling settings" src="img/B19779_15_18.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.18 – Target and Scheduling settings</p>
<p class="calibre4">As seen in <em class="italic">Figure 15</em><em class="italic">.17</em>, we set the target app for our notification. In this case, it is the app that we created earlier<a id="_idIndexMarker790" class="calibre3 pcalibre pcalibre1"/> in the <em class="italic">Using Firebase Crashlytics to detect crashes</em> section of this chapter. We then set the schedule for our notification. We have set the scheduling setting to <strong class="bold">Send now</strong>. Tap the <strong class="bold">Review</strong> button, which shows a dialog with the information we have set:</p>
<div><div><img alt="Figure 15.19 – Review message dialog" src="img/B19779_15_19.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.19 – Review message dialog</p>
<p class="calibre4">Tap the <strong class="bold">Publish</strong> button to publish the notification. This will send a notification to our app. We can now see the <a id="_idIndexMarker791" class="calibre3 pcalibre pcalibre1"/>notification from our app:</p>
<div><div><img alt="Figure 15.20 – First notification" src="img/B19779_15_20.jpg" class="calibre5"/>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US">Figure 15.20 – First notification</p>
<p class="callout-heading">Important note</p>
<p class="callout">Ensure that you always test using a real device to see your notifications.</p>
<p class="calibre4">We learned how to set up Firebase Cloud Messaging in our app and how to send notifications to it. In the next section, we will cover yet another critical topic—securing our app.</p>
<h1 id="_idParaDest-184" class="calibre6"><a id="_idTextAnchor221" class="calibre3 pcalibre pcalibre1"/>Securing your app</h1>
<p class="calibre4">Ensuring your apps are secure is particularly important. We need to ensure that our users’ data is safe and secure. We also need to ensure that our app is not vulnerable to attacks. Attacks such as malware, man-in-the-middle attacks, and data interception pose risks to sensitive information, while vulnerabilities such as SQL injection and privilege escalation can lead to<a id="_idIndexMarker792" class="calibre3 pcalibre pcalibre1"/> unauthorized access and manipulation of databases or app functionalities. Cross-site scripting and code injection present avenues for attackers to execute malicious scripts or commands within the app, potentially compromising user sessions and data. Insecure data storage practices may expose sensitive information, and denial-of-service attacks can disrupt app services.</p>
<p class="calibre4">In this section, we are going to see some tips and tricks for securing our app. The following are some of the things that we can do to secure our app:</p>
<ul class="calibre16">
<li class="calibre15"><strong class="bold">HTTPS</strong>: We should always use <strong class="source-inline1">HTTPS</strong> for all our network requests, which adds an extra layer of security to our app.</li>
<li class="calibre15"><strong class="bold">Code minification and obfuscation</strong>: We should always minify and obfuscate our code to make it harder for attackers to reverse engineer our app. We already did this in <a href="B19779_13.xhtml#_idTextAnchor175" class="calibre3 pcalibre pcalibre1"><em class="italic">Chapter 13</em></a> for our release build.</li>
<li class="calibre15"><strong class="bold">Encryption</strong>: We should always encrypt sensitive data that we store in our app.</li>
<li class="calibre15"><strong class="bold">Passwords and private keys</strong>: Never store passwords and private keys in Shared Preferences. We can always store them in other secure alternatives, such as the Android Keystore system used for storing cryptographic keys.</li>
<li class="calibre15"><strong class="bold">Minimizing logged information</strong>: We should always minimize the information that we log. We should never log sensitive information such as passwords and private keys.</li>
<li class="calibre15"><strong class="bold">Internal storage</strong>: We should always use internal storage for sensitive data. This is because internal storage is private to our app and other apps cannot access it.</li>
<li class="calibre15"><strong class="bold">WebView</strong>: We use WebView to display web content in our app. This can introduce security issues on our app, so we should be careful when using WebView.</li>
<li class="calibre15"><strong class="bold">Dependencies</strong>: We should always keep all our dependencies up to date. This is because new versions of dependencies might have security fixes that we need to apply to our app. We use tools such as Dependabot (<a href="https://github.com/dependabot" class="calibre3 pcalibre pcalibre1">https://github.com/dependabot</a>) to automate dependency updates.</li>
<li class="calibre15"><strong class="bold">Emulators or rooted devices</strong>: For payment or banking apps, ensure that they do not work on emulators or<a id="_idIndexMarker793" class="calibre3 pcalibre pcalibre1"/> rooted devices. With emulators and rooted devices, it is easy to change your code or view the data that is being sent to the server or stored in our app. This can lead to security issues.</li>
<li class="calibre15"><strong class="bold">Permissions</strong>: We should always use the necessary permissions in our app. We should not use permissions that we do not need. This is because permissions can be used to access sensitive data in our app.</li>
</ul>
<p class="calibre4">As you develop your apps, always keep security in mind. This will help you ensure that your app is secure and that your users’ data is safe. You can learn more about Android security from the official Android documentation at <a href="https://developer.android.com/privacy-and-security/security-tips" class="calibre3 pcalibre pcalibre1">https://developer.android.com/privacy-and-security/security-tips</a>.</p>
<h1 id="_idParaDest-185" class="calibre6"><a id="_idTextAnchor222" class="calibre3 pcalibre pcalibre1"/>Summary</h1>
<p class="calibre4">In this chapter, we have learned techniques for improving our apps by adding analytics—in this case, Firebase Crashlytics—and how to use cloud messaging to increase user engagement in our apps. Additionally, we learned some tips and tricks for securing our apps.</p>
<p class="calibre4">We have come to the end of this chapter and book. We hope that you’ve enjoyed following along with the chapters and that you’re now in a position to develop Android apps with the knowledge gained from this book. What are the next steps? Here are some of the things that you can do:</p>
<ul class="calibre16">
<li class="calibre15">Secure your app using the tips and tricks we went over in this chapter.</li>
<li class="calibre15">Inspect, improve, and monitor the performance of your app. You can learn more about this from the official documentation at <a href="https://developer.android.com/topic/performance/overview" class="calibre3 pcalibre pcalibre1">https://developer.android.com/topic/performance/overview</a>.</li>
<li class="calibre15">Learn more about <strong class="bold">Modern Android Development</strong> (<strong class="bold">MAD</strong>). MAD is a set of tools and libraries that help us develop Android apps faster and better. You can learn more about M.A.D from the official documentation at <a href="https://developer.android.com/modern-android-development" class="calibre3 pcalibre pcalibre1">https://developer.android.com/modern-android-development</a>.</li>
<li class="calibre15">Learn more about Google Play Vitals and how you can use the information at <a href="https://play.google.com/console/about/vitals/" class="calibre3 pcalibre pcalibre1">https://play.google.com/console/about/vitals/</a> to improve the quality of your app.</li>
<li class="calibre15">Keep learning about Kotlin and Android. Build more apps and share them with the world. You can also contribute to open source projects.</li>
</ul>
</div>
</body></html>