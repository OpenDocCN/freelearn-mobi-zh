<html><head></head><body><div><div><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Continuous Integration</h1></div></div></div><p>Continuous Integration is one of the most used terminologies in today's software world. Wherever you go in the software world, everybody talks about continuous integration. So what is continuous integration?</p><p>Continuous Integration is the practice of integrating all of the software code in a shared repository; prepare an automated build for every commit, and run the automated tests without any manual effort. It helps developers to detect problems early in fail fast mode. Here, early means as soon as a developer commits the code; within a couple of seconds or minutes (as per the project size), continuous integration process will notify about the success or failure of the build. Since errors are caught in the early stages, it saves a lot of effort while performing integration and functional testing of the application.</p><p>In this chapter, we will explore the popular Continuous Integration tools, Jenkins and TeamCity. As this is a Gradle book, we will limit our discussion to basic setup and configuration for these tools. We will also introduce a new topic, code quality management with Gradle. We will learn how <a id="id391" class="indexterm"/>
<strong>Checkstyle</strong>, <strong>PMD</strong>, and <strong>Sonar Runner</strong> plugins<a id="id392" class="indexterm"/> can be integrated with Gradle, and how it can be integrated <a id="id393" class="indexterm"/>with Continuous Integration tools.</p><div><div><div><div><h1 class="title"><a id="ch07lvl1sec57"/>Jenkins walk-through</h1></div></div></div><p>Jenkins is one of the most popular open source continuous integration tools which helps to automate software<a id="id394" class="indexterm"/> build and the deployment process. It can work with build tools such as Maven, Gradle, and Ant. It supports various source code management systems such as CVS, Git, Subversion, and Perforce. Even simple shell or batch script execution is supported. The main advantage of Jenkins lies in its plugin support. There are more than 1000+ plugins for different functionalities, and if needed, it can be extended to support new requirements.</p><p>Some of the main features of Jenkins are: </p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Easy to install and configure. Simple web-based UI for managing the server</li><li class="listitem" style="list-style-type: disc">Support for a variety of plugins for different builds and deployment related tasks</li><li class="listitem" style="list-style-type: disc">A very large community forum</li><li class="listitem" style="list-style-type: disc">Support for different repositories like SVN, Git, CVS, and Perforce etc.</li><li class="listitem" style="list-style-type: disc">Support for <a id="id395" class="indexterm"/>post build hook</li></ul></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec90"/>Jenkins installation</h2></div></div></div><p>Jenkins installation is just a two-step process. You need to download <code class="literal">jenkins.war</code> from <a class="ulink" href="http://jenkins-ci.org/">http://jenkins-ci.org/</a>. You will always<a id="id396" class="indexterm"/> get the latest version from this URL. For any previous releases, click on the <strong>past releases</strong> option and decide which version<a id="id397" class="indexterm"/> you want.</p><p>Once the war file is <a id="id398" class="indexterm"/>downloaded, it can be deployed in a container such as Tomcat, or it can be executed using the following command:</p><div><pre class="programlisting">
<strong>$ java -jar jenkins.war</strong>
<strong>Running from: /jenkins/jenkins.war</strong>
<strong>webroot: $user.home/.jenkins</strong>
<strong>….</strong>
<strong>Apr 02, 2015 3:30:32 PM org.eclipse.jetty.util.log.JavaUtilLog info</strong>
<strong>INFO: Started SelectChannelConnector@0.0.0.0:8080</strong>
<strong>…..</strong>
<strong>Apr 02, 2015 3:30:37 PM org.jenkinsci.main.modules.sshd.SSHD start</strong>
<strong>INFO: Started SSHD at port 50566</strong>
<strong>Apr 02, 2015 3:30:37 PM jenkins.InitReactorRunner$1 onAttained</strong>
<strong>INFO: Completed initialization</strong>
<strong>Apr 02, 2015 3:30:37 PM hudson.WebAppMain$3 run</strong>
<strong>INFO: Jenkins is fully up and running</strong>
</pre></div><p>Here, Jenkins started with an inbuilt Jetty container at 8080 port. Default Jenkins home directory will be set to <code class="literal">&lt;USER_HOME&gt;/.jenkins</code>. By setting the <code class="literal">JENKINS_HOME</code> environment variable, you can set it to any other location. This directory stores all the Jenkins related information such as job information, user account details, plugin information, and Jenkins general settings.</p><p>Now open a browser and type the following: <code class="literal">http://localhost:8080</code> and the Jenkins welcome page will be displayed. That is all. Jenkins is ready for you:</p><div><img src="img/B02000_07_01.jpg" alt="Jenkins installation"/><div><p>Figure 7.1</p></div></div><p>Since this is<a id="id399" class="indexterm"/> not a Jenkins user guide, we will not be covering Jenkins functionalities in detail. You can go through the tutorials available on Jenkins main website. We<a id="id400" class="indexterm"/> will be mostly covering the topics that will be helpful to automate the build process with Gradle.</p></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec91"/>Jenkins configuration</h2></div></div></div><p>Only installation is not enough for Jenkins to get started with the Gradle build process. We need to configure some plugins before we start with our first job in Jenkins. Like <code class="literal">task</code> in Gradle, the <a id="id401" class="indexterm"/>unit of execution in Jenkins is job. A build job can perform compilation, run automated tests, package or even deployment related tasks. But before we start working with jobs, we will configure the following plugins for Jenkins.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Gradle Plugin</li><li class="listitem" style="list-style-type: disc">Git Plugin (required if you are using Git as a repository)</li></ul></div><p>Click on the <strong>Manage Jenkins</strong> on the left-hand side vertical menu. You will find a list of different categories available. Click on <strong>Manage Plugins</strong>. You will find the following four tabs:</p><div><img src="img/B02000_07_02.jpg" alt="Jenkins configuration"/><div><p>Figure 7.2</p></div></div><p>Go to the <strong>Available</strong> tab and filter (top right) for <code class="literal">Gradle Plugin</code>. You will find Gradle Plugin with the following details:</p><p>
<strong>Gradle Plugin</strong>
</p><p>
<strong>This plugin makes it possible to invoke Gradle build script as the main build step.</strong>
</p><p>Select the plugin<a id="id402" class="indexterm"/> and click on <strong>Download now and Install after restart</strong>. It is better to restart Jenkins after an installation, in order to avoid any issues.</p><p>This will add Gradle build execution capability to the Jenkins server. You will be able to see a success message once installation is successful. You might get an error if the system is firewall protected, which can restrict the system when connecting to the internet. In such cases, manually download the plugin (<code class="literal">*.hpi</code> files) and copy it to <code class="literal">&lt;Jenkins_home&gt;/plugins</code> directory. Jenkins plugins<a id="id403" class="indexterm"/> can be downloaded from <a class="ulink" href="https://updates.jenkins-ci.org/download/plugins/">https://updates.jenkins-ci.org/download/plugins/</a>.</p><p>For the examples in this chapter, we are using GitHub as a repository. To work with GitHub, we will add the GitHub plugin to the Jenkins server. We can add it in the same way we added the Gradle plugin. If the plugin is dependent on other plugins, then Jenkins will automatically download the required plugins. You can observe this when we install the GitHub plugin. Jenkins automatically installs the other required plugins such as the Git client plugin, and the Git API Plugin. As mentioned earlier, some plugins might require the Jenkins server to be restarted. In such cases, stop the current process and restart the Jenkins server in order to make the plugin effective.</p><p>The next important step is to configure JDK, Gradle, and Git with Jenkins. To configure these settings, open Jenkins URL and click on <strong>Manage Jenkins</strong>, and then <strong>Configure System</strong>.</p><p>Enter the correct path to the JDK and save the settings. Jenkins also has an option to install the software automatically from the internet. Take a look at the following screenshot:</p><div><img src="img/B02000_07_03.jpg" alt="Jenkins configuration"/><div><p>Figure 7.3</p></div></div><p>Figure 7.4 shows how to configure Gradle in Jenkins:</p><div><img src="img/B02000_07_04.jpg" alt="Jenkins configuration"/><div><p>Figure 7.4</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec92"/>Create job</h2></div></div></div><p>After the Gradle plugin has been successfully installed, we will create the first Gradle build job. Go to Jenkins home page and click on <strong>create new jobs</strong>. There are different categories of jobs that can be created in<a id="id404" class="indexterm"/> Jenkins. We will create a <strong>Freestyle project</strong> in this example. For simplicity, we will build the plugin project that we created in <a class="link" href="ch04.html" title="Chapter 4. Plugin Management">Chapter 4</a>, <em>Plugin Management</em>. A project can be created by simply giving it a name, such as <code class="literal">PluginProject</code>, as shown in Figure 7.5. Also, try to avoid spaces in job names, as it is considered as a bad practice. </p><p>If you want words to be separated, you can use underscore(<code class="literal">_</code>):</p><div><img src="img/B02000_07_05.jpg" alt="Create job"/><div><p>Figure 7.5</p></div></div><p>Once you click on <strong>OK</strong>, in the next page you will have to configure the job. You will have to configure a few details as follows:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Source code management location to download the project</li><li class="listitem" style="list-style-type: disc">Build step for the project</li><li class="listitem" style="list-style-type: disc">Schedule the Build task (daily, hourly, after every commit etc.)</li><li class="listitem" style="list-style-type: disc">Put in any post build action to perform</li></ul></div><p>First, we will configure the repository under <strong>Source Code Management</strong>. As we are using the GitHub repository, we need to select the <strong>Git</strong> option.</p><div><img src="img/B02000_07_06.jpg" alt="Create job"/><div><p>Figure 7.6</p></div></div><p>Provide the repository URL and add the authentication (username/password) using the <strong>Credentials</strong> option as configured in Figure 7.6.</p><p>Git executable must be set in the Jenkins system configuration, otherwise you will not be able to execute Git commands. If there is any issue with connecting to the URL, Jenkins will show you a proper error message. This helps to debug and resolve the issues. If the URL is validated to<a id="id405" class="indexterm"/> be successful, the next step is to choose the build options from one of the options displayed in the following figure:</p><div><img src="img/B02000_07_07.jpg" alt="Create job"/><div><p>Figure 7.7</p></div></div><p>For our project we have selected the option <strong>Build when a change is pushed to GitHub</strong>, which helps to validate every commit by running a build script. You can set any other option as per the build requirement.</p><p>The next step is to select a build tool for the project. From the options available, such as shell, Ant, and batch, we will select Gradle as the build tool for this project. This option is highlighted in the next figure:</p><div><img src="img/B02000_07_08.jpg" alt="Create job"/><div><p>Figure 7.8</p></div></div><p>Select the option <strong>Invoke Gradle script</strong> and configure a few basic parameters:</p><div><img src="img/B02000_07_09.jpg" alt="Create job"/><div><p>Figure 7.9</p></div></div><p>We have configured the installed Gradle on the system <code class="literal">gradle-2.4</code> as the working Gradle version. To <a id="id406" class="indexterm"/>build the <code class="literal">PluginProject</code>, tasks can be set as <code class="literal">clean build</code> in the <strong>Tasks</strong> text box. If the <code class="literal">build.gradle</code> file is in the home/root folder of the project, then you can leave the <strong>Root Build Script</strong> textbox empty. However, if it is in another directory, you will have to mention the path relative to the workspace location. Our <code class="literal">build.gradle</code> file is in the <code class="literal">Chapter7/PluginProject</code> folder. So we can enter the Root Build script as <code class="literal">${workspace}/Chapter7/PluginProject</code>. As we are using the build file name as <code class="literal">build.gradle</code>, which is the default naming convention in Gradle, we do not need to specify the file name in the <strong>Build File</strong> text box. If you are using any other build file name, it has to be mentioned in the <strong>Build file</strong> text box.</p><p>You can also add <strong>Post-build Actions</strong> such as publish Java doc, send email notifications, build other projects as per the project requirements.</p><p>Now, save the configurations and you will be able to see the project on the dashboard:</p><div><img src="img/B02000_07_10.jpg" alt="Create job"/><div><p>Figure 7.10</p></div></div></div><div><div><div><div><h2 class="title"><a id="ch07lvl2sec93"/>Execute job</h2></div></div></div><p>Although we configured the build to be executed when a change is pushed to the source code management system, build can always be executed manually if you do not want to wait for changes to happen<a id="id407" class="indexterm"/> in the repository. Click on the <strong>PluginProject</strong> job on the Jenkins home page, which you had created earlier. You will be navigated to the<a id="id408" class="indexterm"/> job console at <code class="literal">http://localhost:8080/job/PluginProject/</code>.</p><div><img src="img/B02000_07_11.jpg" alt="Execute job"/><div><p>Figure 7.11</p></div></div><p>On the job console, you will find the <strong>Build Now</strong> option on the left-hand side. Click on the option to execute the job manually. In the console page, you can configure the job at any time by selecting the <strong>Configure</strong> option. Once the job has been executed successfully, you will find similar output as displayed in Figure 7.12 by clicking the <strong>build no</strong> link in the <strong>Build History</strong> section:</p><div><img src="img/B02000_07_12.jpg" alt="Execute job"/><div><p>Figure 7.12</p></div></div><p>Build history<a id="id409" class="indexterm"/> is displayed in the UI with the latest job execution status on top. Figure 7.13 shows that the 1st and 2nd execution failed with some error, but the 3rd execution was successful. In the <strong>Build History</strong> section, if a job has failed, it will be marked in red. For success, it is blue, and aborted jobs can be identified in gray:</p><div><img src="img/B02000_07_13.jpg" alt="Execute job"/><div><p>Figure 7.13</p></div></div><p>The default location for this job is <code class="literal">&lt;USER_HOME&gt;/.jenkins/jobs/&lt;JOB_NAME&gt;/workspace</code>. If you browse to <code class="literal">&lt;USER_HOME&gt;/.jenkins/jobs</code> location, you will find a directory created with a job name, that is <code class="literal">PluginProject</code>, which further contains <code class="literal">config.xml</code> for job configuration. The job directory <a id="id410" class="indexterm"/>has two further sub-directories, builds for executed jobs and workspace where the build actually runs. If you go inside the <code class="literal">builds</code> directory, you will find the build execution details for each run.</p><div><img src="img/B02000_07_14.jpg" alt="Execute job"/><div><p>Figure 7.14</p></div></div><p>The workspace directory contains the project that we have configured for the job. Earlier in the build configuration, we specified the <code class="literal">Build Root</code> as <code class="literal">${workspace}/Chapter7/PluginProject</code>. Now if we go to this location, we will find the build folder created for this project:</p><div><pre class="programlisting">
<strong>/workspace/Chapter7/PluginProject$ ls -l</strong>
<strong>total 12</strong>
<strong>drwxrwxr-x 6 mainak mainak 4096 Apr  6 00:31 build</strong>
<strong>-rw-rw-r-- 1 mainak mainak  328 Apr  5 23:15 build.gradle</strong>
<strong>drwxrwxr-x 3 mainak mainak 4096 Apr  5 23:15 src</strong>
</pre></div><p>This is just a brief overview of <a id="id411" class="indexterm"/>Jenkins configuration. More details can <a id="id412" class="indexterm"/>be found at <a class="ulink" href="https://jenkins-ci.org/">https://jenkins-ci.org/</a>. In the next two sections, we will explore Checkstyle, PMD, and Sonar Runner plugins.</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec58"/>Checkstyle and PMD plugins</h1></div></div></div><p>We have seen how simple it is to create a Gradle build job in Jenkins. We will now add <strong>Checkstyle</strong> and <strong>PMD</strong> plugins to our project for quality checking purposes. There are different approaches that <a id="id413" class="indexterm"/>we can follow in order to use these plugins. We can directly add these plugins to Jenkins and run it for our project, or we can use Gradle Checkstyle and PMD plugins and evaluate the project.</p><p>We will use the Gradle<a id="id414" class="indexterm"/> approach to add Checkstyle and PMD plugins for code quality check, and execute this using Jenkins. Let's create two Gradle files, one for Checkstyle and the other for PMD:</p><p>
<code class="literal">build_checkstyle.gradle</code>
</p><div><pre class="programlisting">apply plugin: 'groovy'
apply plugin: 'eclipse'
apply plugin: 'checkstyle'


version = '1.0'

repositories {
  mavenCentral()
}
checkstyle {
  toolVersion = 6.5
  ignoreFailures = true
}


dependencies {
  compile gradleApi()
  compile localGroovy()
  compile group: 'commons-collections', name: 'commons-collections', version: '3.2'
  testCompile group: 'junit', name: 'junit', version: '4.+'
}</pre></div><p>In the build file, we have added additional configuration in the closure <code class="literal">checkstyle { … }</code>. If the source code does not pass the CheckStyle rules, it results in build failure. To ignore any build failure<a id="id415" class="indexterm"/> due to Checkstyle rule violation; we need to add the <code class="literal">ignoreFailures=true</code> property in the <code class="literal">checkstyle</code> closure.</p><p>Checkstyle plugin <a id="id416" class="indexterm"/>provides the following tasks:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">checkstyleMain</code>: This executes Checkstyle against the Java source files</li><li class="listitem" style="list-style-type: disc"><code class="literal">checkstyleTest</code>: This executes Checkstyle against the Java test source files</li><li class="listitem" style="list-style-type: disc"><code class="literal">checkstyleSourceSet</code>: This executes Checkstyle against the given source set's Java source files</li></ul></div><p>For Checkstyle plugin, we need a <code class="literal">checkstyle.xml</code> file in the <code class="literal">&lt;Project&gt;/config/checkstyle/</code> directory. This is<a id="id417" class="indexterm"/> the default location. You can find a sample <code class="literal">checkstyle.xml</code> at: <a class="ulink" href=" https://github.com/google/google-api-java-client/blob/dev/checkstyle.xml">https://github.com/google/google-api-java-client/blob/dev/checkstyle.xml</a>.</p><p>It provides a standard quality checks for projects. You can write customized <code class="literal">checkstyle.xml</code> for your requirements as well.</p><p>To use PMD plugin, you can copy the above file and replace <code class="literal">checkstyle</code> closure with <code class="literal">pmd</code> closure and remove the <code class="literal">toolVersion</code> property. If you don't specify a version, Gradle downloads PMD version 5.1.1 by default. You will also need to add apply plugin: <code class="literal">pmd</code>.</p><p>
<code class="literal">build_pmd.gradle</code>
</p><div><pre class="programlisting">apply plugin: 'groovy'
apply plugin: 'pmd'

version = '1.0'

repositories {
  mavenCentral()
}

pmd{
  ignoreFailures = true
}

dependencies {
  compile gradleApi()
  compile localGroovy()
  compile group: 'commons-collections', name: 'commons-collections', version: '3.2'
  testCompile group: 'junit', name: 'junit', version: '4.+'
}</pre></div><p>PMD plugin provides the following tasks:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">pmdMain</code>: This executes PMD against the Java source files.</li><li class="listitem" style="list-style-type: disc"><code class="literal">pmdTest</code>: This executes PMD against the Java test source files.</li><li class="listitem" style="list-style-type: disc"><code class="literal">pmdSourceSet</code>: This executes PMD against the given source set's Java source files</li></ul></div><p>Both the <a id="id418" class="indexterm"/>Checkstyle and PMD plugins can be executed using <code class="literal">check</code> task.</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">If you add<a id="id419" class="indexterm"/> Checkstyle plugin and execute <code class="literal">check</code> task, it will call all checkstyle tasks</li><li class="listitem" style="list-style-type: disc">If you add PMD plugin and execute <code class="literal">check</code> tasks, it will execute <code class="literal">pmd</code> tasks</li></ul></div><p>We will create a new project <code class="literal">QualityCheck</code> and add the following files to the project:</p><div><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">build_checkstyle.gradle</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">build_pmd.gradle</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">config/checkstyle/checkstyle.xml</code></li></ul></div><p>Checkstyle and PMD plugin are executed in Java code, so we will add some sample Java files under the <code class="literal">src/main/java/</code> directory. To create a build step in Jenkins, we will create a build step to execute a Checkstyle task (<code class="literal">check</code> task), as shown in Figure 7.15. You can repeat the same steps for PMD plugin.</p><p>For a new configuration, <code class="literal">Root Build script</code> is set to <code class="literal">${workspace}/Chapter7/QualityCheck</code>. Also, we added the <strong>Build file</strong> name in the text box as <code class="literal">build_checkstyle.gradle</code>.</p><div><img src="img/B02000_07_15.jpg" alt="Checkstyle and PMD plugins"/><div><p>Figure 7.15</p></div></div><p>Save this configuration and execute the job again. As configured, <code class="literal">build_checkstyle.gradle</code> file executed on java source code and generated CheckStyle<a id="id420" class="indexterm"/> reports for it. You<a id="id421" class="indexterm"/> can find the reports under <code class="literal">${workspace}\Chapter7\QualityCheck\build\reports\checkstyle\main.xml</code>
</p></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec59"/>The Sonar Runner plugin</h1></div></div></div><p>Sonar is one of the most popular quality management tools which gives complete analysis of a project in terms of lines of code, documentation, test coverage, issues and complexities. Gradle provides seamless integration with Sonar. The only prerequisite is that sonar server should be installed <a id="id422" class="indexterm"/>and running. Details on Sonar can be found at <a class="ulink" href="http://www.sonarqube.org/">http://www.sonarqube.org/</a>.</p><p>To run sonar runner plugin, we just need to apply plugin <code class="literal">sonar-runner</code> and configure it to connect to the sonar server.</p><p>Create build file <code class="literal">build_sonar.gradle</code> for your project with the following contents:</p><div><pre class="programlisting">apply plugin: 'groovy'
apply plugin: 'eclipse'
apply plugin: "sonar-runner"

repositories {
  mavenCentral()
}

version = '1.0'

sonarRunner {

  sonarProperties {
    property "sonar.host.url", "http://&lt;IP_ADDRESS&gt;:9000"
    property "sonar.jdbc.url", "jdbc:h2:tcp://&lt;IP_ADDRESS&gt;:9092/sonar"
    property "sonar.jdbc.driverClassName", "org.h2.Driver"
    property "sonar.jdbc.username", "sonar"
    property "sonar.jdbc.password", "sonar"
  }
}</pre></div><p>The preceding <a id="id423" class="indexterm"/>configuration is self-explanatory. You need to add configurations such as Sonar URL, DB URL, JDBC driver details. Our build file is ready. The next step is to configure a job in the Jenkins server. To configure <code class="literal">sonarRunner</code> task in Jenkins, we can add a few basic steps as shown in Figure 7.16:</p><div><img src="img/B02000_07_16.jpg" alt="The Sonar Runner plugin"/><div><p>Figure 7.16</p></div></div><p>Here, the task name is <code class="literal">sonarRunner</code> and the build file name is <code class="literal">build_sonar.gradle</code>. Now, execute this job in Jenkins and you will find the output in the console. The output contains a link to the Sonar server. You can follow the link, which will redirect you to the Sonar report, as displayed in Figure 7.17:</p><div><img src="img/B02000_07_17.jpg" alt="The Sonar Runner plugin"/><div><p>Figure 7.17</p></div></div><p>As mentioned <a id="id424" class="indexterm"/>preceding, Sonar gives an analysis of the project in different areas and you can find the details in the Sonar UI.</p></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec60"/>TeamCity walk-through</h1></div></div></div><p>In the previous section, we learned how to configure a Gradle project in Jenkins and how to integrate quality plugins. In this section, we will explore one more popular continuous integration tool, TeamCity. We<a id="id425" class="indexterm"/> are assuming that TeamCity is already installed and running on your machine. Therefore, we will skip the TeamCity installation and configuration details. Actually, the installation process is very simple and it can be completed in a few minutes. You can<a id="id426" class="indexterm"/> download TeamCity from the following URL: <a class="ulink" href="https://www.jetbrains.com/teamcity/download/">https://www.jetbrains.com/teamcity/download/</a> and installation instructions are available at <a class="ulink" href="https://confluence.jetbrains.com/display/TCD9/Installation">https://confluence.jetbrains.com/display/TCD9/Installation</a>.</p><p>By default, TeamCity runs on <code class="literal">http://localhost:8111/</code> and it has one build agent that runs on the server. We will build the same plugin project using TeamCity.</p><p>Log in to TeamCtiy and click on Create a project. Provide a project name and description:</p><div><img src="img/B02000_07_18.jpg" alt="TeamCity walk-through"/><div><p>Figure 7.18</p></div></div><p>Save and then click on the <strong>Create Build Configuration</strong> button. You will need to provide general settings for<a id="id427" class="indexterm"/> the project. After general settings, proceed to <strong>Version Control Settings</strong>:</p><div><img src="img/B02000_07_19.jpg" alt="TeamCity walk-through"/><div><p>Figure 7.19</p></div></div><p>The next step is to configure <strong>Create and attach new VCS root</strong>. Choose Git from the drop down, since we are using Git as a repository, as shown in Figure 7.20:</p><div><img src="img/B02000_07_20.jpg" alt="TeamCity walk-through"/><div><p>Figure 7.20</p></div></div><p>Provide <strong>General settings</strong><a id="id428" class="indexterm"/> and the <strong>Fetch URL</strong> of the plugin project, also provide authentication, such as username/password and the Git exe location in <strong>Path To Git</strong>.</p><p>At the end of the screen, click on <strong>Test Connection</strong>. If the connection is successful, click on <strong>Save</strong>. The next step is <strong>Add Build Step</strong>.</p><p>In the build step, you need to configure the <strong>PluginProject</strong> build file details and build tasks details. For example, we need to provide some basic information such as <code class="literal">clean build</code> for task, working directory as <code class="literal">Chapter7/PluginProject</code>, and Gradle and JDK home directory:</p><div><img src="img/B02000_07_21.jpg" alt="TeamCity walk-through"/><div><p>Figure 7.21</p></div></div><p>Save this configuration and the project will then be ready. The details of the build step can be reviewed in the build <a id="id429" class="indexterm"/>configuration screen, as shown in the following screenshot:</p><div><img src="img/B02000_07_22.jpg" alt="TeamCity walk-through"/><div><p>Figure 7.22</p></div></div><p>TeamCity executes the project through TeamCity Agents. TeamCity server installs an agent with the server. You can use this agent to execute the job. Otherwise, you can configure more agents through<a id="id430" class="indexterm"/> the <strong>Agents</strong> tab.</p><div><img src="img/B02000_07_23.jpg" alt="TeamCity walk-through"/><div><p>Figure 7.23</p></div></div><p>Once the agent is configured and connected, you can map the project with the build agent and you are ready to run the build job.</p><div><img src="img/B02000_07_24.jpg" alt="TeamCity walk-through"/><div><p>Figure 7.24</p></div></div><p>On clicking on the <strong>Run</strong> button, TeamCity server will execute the build job on mapped agent, and you can see the output of the build job as a success or failure.</p><p>In the <strong>Build Log</strong> console, you can also analyze the complete log, as shown in the following screenshot:</p><div><img src="img/B02000_07_25.jpg" alt="TeamCity walk-through"/><div><p>Figure 7.25</p></div></div></div>
<div><div><div><div><h1 class="title"><a id="ch07lvl1sec61"/>Summary</h1></div></div></div><p>In this chapter, we discussed briefly the need for continuous integration in the software development world, and looked into the two most popular continuous integration tools, Jenkins and TeamCity. In this chapter, we learned how easy it is to configure these tools and how we can integrate Gradle with these CI tools. We also learned three different quality plugins of Gradle: Checkstyle, PMD and Sonar Runner. And we executed these quality tasks with the help of Jenkins. There are so many topics to learn in Continuous Integration, Jenkins or TeamCity. Unfortunately, we won't be able to take up those topics in this book. We strongly recommend readers to do further reading in every area left uncovered.</p><p>In the next chapter, we will discuss different migration strategies from Ant and Maven to Gradle. This will help to migrate existing Ant or Maven scripts to Gradle.</p></div></body></html>