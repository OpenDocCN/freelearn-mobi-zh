<html><head></head><body>
      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Universal</h1>
            
         </header>
         
         
         <article>
            
            
            <p>We have spent most of this entire book focusing on logic for our app and getting the
               app to work on the iPhone. We have not paid much attention to the app working on iPads
               or other devices. During this chapter, we will look at the app on an iPad, as well
               as updating the app on all iPhone devices. You will be surprised at how much is already
               working and that only minor changes will need to be made to get our app to look how
               we want. We will also take the time to clean up some of our design elements to match
               the design more closely.
            </p>
            
            <p>In this chapter, we will cover the following:</p>
            
            <ul>
               
               <li>Updating our app to be supported on all devices</li>
               
               <li>Learning about multitasking and how to code for it</li>
               
               <li>Cleaning up design elements and using global settings</li>
               
            </ul>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Explore</h1>
            
         </header>
         
         
         <article>
            
            
            <p>Let's do some design tweaks before we jump into making our layout work for every device
               and start to get this app more polished.
            </p>
            
            <p>Let's compare what we see on the iPhone 8 with the original design:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="434" src="assets/276a2ef0-2d30-4084-9b40-b274b1196c21.png" width="488"/></div>
            
            <p>There are a few things we need to fix:</p>
            
            <ul>
               
               <li>Implement rounded corners</li>
               
               <li>Remove the grey background</li>
               
               <li>Navigation bar appears</li>
               
               <li>Fix spacing</li>
               
               <li>Tab bar color</li>
               
            </ul>
            
            <p>We will fix all of these, but we will focus on first four right now. We have rounded
               corners in our photo filter list. We can implement these here. Open the <kbd>ExploreCell.swift</kbd> file by hitting <em>cmd</em> + <em>Shift</em> + <em>o</em>, type <kbd>ExploreCell</kbd>, and hit <em>Enter</em>. Add the following extension:
            </p>
            <pre>private extension ExploreCell {<br/>    func roundedCorners() {<br/>        imgExplore.layer.cornerRadius = 9<br/>        imgExplore.layer.masksToBounds = true<br/>    }<br/>}</pre>
            <p>Add a <kbd>roundedCorners()</kbd> call inside the <kbd>–layoutSubviews</kbd> method.
            </p>
            
            <p>Now that we have fixed the first issue let's fix the second by removing the background
               color. Open <kbd>Explore.storyboard</kbd> and select the <kbd>exploreCell</kbd> in the Outline view. Under the Utility panel, in the Attributes inspector update
               the <span class="packt_screen">Background</span> from <span class="packt_screen">LetsEat Dark Grey</span> to <span class="packt_screen">White Color</span>. The third issue, that the navigation bar is displayed, is pretty easy to fix as
               well.  Open the <kbd>ExploreViewController.swift</kbd> file by hitting <em>cmd</em> + <em>Shift</em> + <em>o</em> and type <kbd>ExploreViewController</kbd> and hit <em>Enter</em>. After <kbd>viewDidLoad()</kbd> add the following method:
            </p>
            <pre>override func viewWillAppear(_ animated: Bool) {<br/>    super.viewWillAppear(animated)<br/>    navigationController?.setNavigationBarHidden(true, animated: false)<br/>}</pre>
            <p>That is all we need to do; now, every time we go to this view, we will always hide
               the Navigation bar at the top. Finally, let's update our app so that our tab bar buttons
               are the correct color. We need to add a new color to our <span class="packt_screen">Color Set</span> called <span class="packt_screen">LetsEat Red</span> and set the <span class="packt_screen">Hex</span> value to <kbd>D0021B</kbd>. Now, open up the <kbd>AppDelegate.swift</kbd> file at the bottom of the file after the last curly brace adds the following:
            </p>
            <pre>private extension AppDelegate {<br/>    func initialize() {<br/>        setupDefaultColors()<br/>    }<br/><br/>    func setupDefaultColors() {<br/>        guard let red = UIColor(named: "Lets Eat Red") else { return }<br/>        UITabBar.appearance().tintColor = red<br/>        UITabBar.appearance().barTintColor = .white<br/>        UITabBarItem.appearance()<br/>            .setTitleTextAttributes(<br/>                [NSAttributedStringKey.foregroundColor: UIColor.black],<br/>                for: UIControlState.normal)<br/>        UITabBarItem.appearance()<br/>            .setTitleTextAttributes(<br/>                [NSAttributedStringKey.foregroundColor: red],<br/>                for: UIControlState.selected)<br/>        UINavigationBar.appearance().tintColor = red<br/>        UINavigationBar.appearance().barTintColor = .white<br/>        UITabBar.appearance().isTranslucent = false<br/>        UINavigationBar.appearance().isTranslucent = false<br/>    }<br/>}</pre>
            <p>Now inside the <kbd>-application:didFinishLaunchingWithOptions:</kbd> add the <kbd>initialize()</kbd> method call. Build and run the project by hitting the Play button (or using ⌘ + <em>R</em>).
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="449" src="assets/2823eee5-1d18-42c4-8622-3b40f6b7eaa1.png" width="256"/></div>
            
            <p>You should now see we have completed the first four items.  Let's address the spacing
               issue next. Before we do, let's first switch our device to any iPad (I typically use
               the iPad Air 2, but you can pick whatever one you like). Then build and run the project
               by hitting the Play button (or using ⌘ + <em>R</em>). You will see that it is not too bad currently, but the spacing is different on
               each device. Now, we have set up values that only work for one device. However, we
               need this to work on all devices.
            </p>
            
            <p>Let's start with our <kbd>Explore.storyboard</kbd>. First, we need to update some Auto Layout for our explore cells. Right now, we have
               a width set up for our image that needs to be more dynamic:
            </p>
            
            <ol>
               
               <li>Open up <kbd>Explore.storyboard</kbd>.
               </li>
               
               <li>Select the image inside the <kbd>exploreCell</kbd>.
               </li>
               
               <li>Then, in the Utilities panel, select the Attributes inspector and change the <span class="packt_screen">Content Mode</span> under the <span class="packt_screen">View</span> section to <span class="packt_screen">Aspect Fill</span>. This will keep the images from looking stretched, while still filling the entire
                  area.
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="294" src="assets/69a6a749-5d34-4618-96e3-8b917e775397.png" width="584"/></div>
            
            <p style="padding-left: 60px">These are the only updates we need to make to our explore cell. Next, we are going
               to create a file that will let us know which device is used. We can then use this
               to set up different looks, depending on the device. Let's create this file:
            </p>
            
            <ol start="4">
               
               <li>Right-click the <kbd>Misc</kbd> folder and select <span class="packt_screen">New File</span>.
               </li>
               
               <li>Inside of the <span class="packt_screen">Choose a template for your new file screen</span>, select <span class="packt_screen">iOS</span> at the top and then <span class="packt_screen">Swift File</span>. Then, hit <span class="packt_screen">Next</span>.
               </li>
               
               <li>Name this file <kbd>Device</kbd> and then hit <span class="packt_screen">Create</span>.
               </li>
               
            </ol>
            
            <p>First, we need to update our <kbd>import</kbd> <span>statement from</span> <kbd>import Foundation</kbd> <span>to</span> <kbd>import UIKit</kbd><span>.</span></p>
            
            <p>Next, add the following to the <kbd>import</kbd> <span>statement:</span></p>
            <pre>struct Device {<br/>   static var currentDevice: UIDevice {<br/>         struct Singleton {<br/>               static let device = UIDevice.current<br/>         }<br/>         return Singleton.device<br/>   }<br/><br/>   static var isPhone: Bool {<br/>         return currentDevice.userInterfaceIdiom == .phone<br/>   }<br/><br/>   static var isPad: Bool {<br/>         return currentDevice.userInterfaceIdiom == .pad<br/>   }<br/>}</pre>
            <p>Our new struct will now tell us whether we are on an iPad or an iPhone. Having a file
               like this is good because it allows you to avoid having to rewrite the same code.
               To implement this code, all we need to do is add a snippet of code like the following:
            </p>
            <pre>if Device.isPhone{ }</pre>
            <p>This statement will make our code more readable;  if we need to add any more checks
               for particular devices, we can do it all in the same file. One more great use of putting
               code like this into its file is that, when you build the next app, you can just add
               this file to your project and continue.
            </p>
            
            <p>Next, let's open the <kbd>ExploreViewController.swift</kbd> file and make some more updates to our code. We need to create a variable that we
               will use for the spacing we want between items. Add the following before our <kbd>viewDidLoad()</kbd> method:
            </p>
            <pre>fileprivate let minItemSpacing: CGFloat = 7</pre>
            <p>Now, we need to create a function to set up some default Collection View values. We
               also need to create an <kbd>initialize()</kbd> method to call our setup function. Add the following method call inside of the <kbd>initialize()</kbd> method:
            </p>
            <pre>setupCollectionView()</pre>
            <p>Next, add the following inside of the <kbd>private</kbd> extension after the <kbd>initialize()</kbd> method:
            </p>
            <pre>func setupCollectionView() {<br/>    let flow = UICollectionViewFlowLayout()<br/>    flow.sectionInset = UIEdgeInsets(top: 7, left: 7, bottom: 7, right: 7)<br/>    flow.minimumInteritemSpacing = 0<br/>    flow.minimumLineSpacing = 7<br/>    collectionView?.collectionViewLayout = flow<br/>}</pre>
            <p>This method will make sure that we have seven pixels of spacing all the way around. 
               We finally need to create an extension that will let us handle all of the spacing
               programmatically. After the last curly brace add the following extension:
            </p>
            <pre>extension ExploreViewController: UICollectionViewDelegateFlowLayout {<br/>    func collectionView(_ collectionView: UICollectionView, layout collectionViewLayout: UICollectionViewLayout, sizeForItemAt indexPath: IndexPath) -&gt; CGSize {<br/>        if Device.isPad {<br/>            let factor = traitCollection.horizontalSizeClass == .compact ? 2:3<br/>            let screenRect = collectionView.frame.size.width<br/>            let screenWidth = screenRect - (CGFloat(minItemSpacing) * CGFloat(factor + 1))<br/>            let cellWidth = screenWidth / CGFloat(factor)<br/><br/>            return CGSize(width: cellWidth, height: 195)<br/>        }<br/>        else {<br/>            let screenRect = collectionView.frame.size.width<br/>            let screenWidth = screenRect - 21<br/>            let cellWidth = screenWidth / 2.0<br/><br/>            return CGSize(width: cellWidth, height: 195)<br/>        }<br/>    }<br/><br/>    func collectionView(_ collectionView: UICollectionView, layout collectionViewLayout: UICollectionViewLayout, referenceSizeForHeaderInSection section: Int) -&gt; CGSize {<br/><br/>        return CGSize(width: self.collectionView.frame.width, height: 100)<br/>    }<br/>}</pre>
            <p>Adding the <kbd>UICollectionViewDelegateFlowLayout</kbd> allows us to update our cell item size in code. Let's discuss each part of this extension
               we just added.  The <kbd>-collectionView:layout:sizeForItemAtIndexPath:</kbd> method is used to set the size of the cell. Inside of this method, we are using the
               struct we created. We are checking to see if we are using an iPad or an iPhone.
            </p>
            
            <p>In the if part of the <kbd>if...else</kbd> statement, we are checking whether the screen is compact or not. If the screen is
               compact, then we want a two-column grid; otherwise, we want a three-column grid. We
               are also distributing our items evenly across the width of the screen.
            </p>
            
            <p>In the else part of the <kbd>if...else</kbd> statement, we are just setting up a two-column grid on all phones. We get the screen
               width then subtract <kbd>21</kbd>, and then we divide the result by <kbd>2</kbd> to distribute the cells evenly.
            </p>
            
            <p>If you run the project, everything will look good.</p>
            
            <p>There is one more thing that's broken if you attempt to rotate the device by using
               ⌘ + right arrow or ⌘ + left arrow. Then, you will see that our layout spacing does
               not update.
            </p>
            
            <p>In order to fix this, we need to make one more update. After <kbd>-shouldPerformSegueWithIdentifier:sender:</kbd>, add the following:
            </p>
            <pre>override func viewWillTransition(to size: CGSize, with coordinator: UIViewControllerTransitionCoordinator) {<br/>   collectionView.reloadData()<br/>}</pre>
            <p>Now, build and run your project again by hitting the Play button (or using ⌘ + <em>R</em>) and rotate the device. You will see that our layout spacing now updates.
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="503" src="assets/a7a75460-e4de-483b-804e-2689b9af04fb.png" width="287"/></div>
            
            <p class="mce-root">Explore is now complete; let's move to our locations list.</p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Location listing </h1>
            
         </header>
         
         
         <article>
            
            
            <p>Let's compare our current location listing with the design:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="450" src="assets/47bc3ec3-cbb4-40de-9528-1293124f5f06.png" width="506"/></div>
            
            <p>We have one thing that needs fixing: the large title. This is a simple update. Open
               up the <kbd>LocationViewController</kbd> and, inside of the <kbd>initialize()</kbd> method, add the following code after <kbd>manager.fetch()</kbd>:
            </p>
            <pre>title = "Select a Location"<br/>navigationController?.navigationBar.prefersLargeTitles = true</pre>
            <p>In this code, we are setting a new iOS 11 feature <kbd>prefersLargeTitles</kbd> to <kbd>true</kbd>.  If you build and run, you will see that we are good here now. Next, we will direct
               our attention to the restaurant listing page and go into more detail on the iPad and
               multitasking.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Restaurant listing </h1>
            
         </header>
         
         
         <article>
            
            
            <p>For our restaurant listing page, we want a one-column grid on all phones and a two-column
               grid on all iPads. If you build and run the project by hitting the Play button (or
               using ⌘ + <em>R</em>) and go to a restaurant listing page, you will see that we need to fix the spacing
               on the iPad to show two columns correctly:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="425" src="assets/8f84d088-f3dc-432f-920c-a11a99911a6f.png" width="564"/></div>
            
            <p>Let's see how we can fix this. Remember that we still want one column on the iPhone
               and a grid on the iPad. Open the <kbd>RestaurantViewController.swift</kbd> file and add the following above the <kbd>createData()</kbd> method inside of the <kbd>private</kbd> extension:
            </p>
            <pre>func initialize() {<br/>   createData()<br/>   setupTitle()<br/>   if Device.isPad{ setupCollectionView() }<br/>}</pre>
            <p>You will get an error for the <kbd>setupCollectionView()</kbd> method. Ignore it for now, as we will fix it shortly. This method checks if the device
               is an iPad; if it is, it calls the method <kbd>setupCollectionView()</kbd>. Next, add the following under the <kbd>initialize()</kbd> method we just added:
            </p>
            <pre>func setupCollectionView() {<br/>   let flow = UICollectionViewFlowLayout()<br/>   flow.sectionInset = UIEdgeInsets(top: 7, left: 7, bottom: 7, right: 7)<br/>   flow.minimumInteritemSpacing = 0<br/>   flow.minimumLineSpacing = 7<br/>   collectionView?.collectionViewLayout = flow<br/>}</pre>
            <p>The preceding method is the same thing we previously added in the storyboard regarding
               spacing between items, but here we are implementing it programmatically.
            </p>
            
            <p>We have a couple of more things that we need to address. First, we are going to have
               the size of the screen calculated for us programmatically. Just like we did in <kbd>ExploreViewController</kbd>, we are going to a new extension to handle our Collection View layout. Add the following
               before our <kbd>viewDidLoad()</kbd> method:
            </p>
            <pre>fileprivate let minItemSpacing: CGFloat = 7</pre>
            <p>Now, add the following at the bottom of the file after the last curly brace:</p>
            <pre>extension RestaurantViewController: UICollectionViewDelegateFlowLayout {<br/><br/>    func collectionView(_ collectionView: UICollectionView, layout collectionViewLayout: UICollectionViewLayout, sizeForItemAt indexPath: IndexPath) -&gt; CGSize {<br/>        if Device.isPad {<br/>            let factor = traitCollection.horizontalSizeClass == .compact ? 2:3<br/>            let screenRect = collectionView.frame.size.width<br/>            let screenWidth = screenRect - (CGFloat(minItemSpacing) * CGFloat(factor + 1))<br/>            let cellWidth = screenWidth / CGFloat(factor)<br/>            return CGSize(width: cellWidth, height: 325)<br/>        }<br/><br/>        else {<br/>            let screenRect = collectionView.frame.size.width<br/>            let screenWidth = screenRect - 21<br/>            let cellWidth = screenWidth / 2.0<br/><br/>            return CGSize(width: cellWidth, height: 325)<br/>        }<br/>    }<br/>}</pre>
            <p>This code states that, if the device is an iPhone, a one-column grid will be shown;
               if it is an iPad, a two-column grid will be shown. Now, we need to update our <kbd>viewDidAppear()</kbd> method. Currently, we are calling both <kbd>createData()</kbd> and <kbd>setupTitle()</kbd>. We need to remove both of these calls and just call <kbd>initialize()</kbd> instead. When you are finished, <kbd>viewDidAppear()</kbd> should look like the following:
            </p>
            <pre>override func viewDidAppear(_ animated: Bool) {<br/>    super.viewDidAppear(animated)<br/>    initialize()<br/>}</pre>
            <p>Let's build and run the project for the iPad by hitting the Play button (or using
               ⌘ + <em>R</em>):
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="447" src="assets/dd2cc7da-f9e2-4133-aaee-1e40debd61be.png" width="594"/></div>
            
            <p>The two-column grid is what we want for the iPad for our restaurant listing page,
               but we need to verify that we did not change the one-column grid on the iPhone. Switch
               the device back to any iPhone simulator and, after building and rerunning the project,
               you should still see a one-column grid on the iPhone.
            </p>
            
            <p>There are still issues with the iPad setup. Switch back to the iPad and build and
               rerun the project by hitting the Play button (or using ⌘ + <em>R</em>). When the project launches, hit ⌘ + right arrow to rotate the device. Then, return
               to your restaurant listing page. The first issue is that, if you turn the device,
               the cell spacing does not update. Another problem is that, if you multitask, your
               app resizes and you need to make sure that your layout adjusts accordingly.
            </p>
            
            <p>To see multitasking, swipe up from the bottom:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="440" src="assets/2b6016ba-1acf-4e27-8d7e-2e7b7bcd0077.png" width="585"/></div>
            
            <p>Then, drag the app to the right side of our app:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="456" src="assets/6210c5f5-0596-4870-a30e-5a5e186f9e87.png" width="619"/></div>
            
            <p>Grab the small tab that will be in the middle of this new screen and pull it to the
               left. This tab will split the screen with our app and allow you to take over more
               (or less, if you move it back to the right) of the screen :
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="429" src="assets/c769c07b-6e75-4969-9936-9fba0e76ed73.png" width="570"/></div>
            
            <p>When you move the tab to the left, you will notice that the <em>Let's Eat</em> app does not resize the cells and instead shows one column. Our app needs to adjust
               no matter the size it has available when splitting the screen between our app and
               another app.
            </p>
            
            <p>Resolving these problems is a really simple fix. In your <kbd>RestaurantViewController</kbd>, before the last curly brace, add the following code:
            </p>
            <pre>override func viewWillTransition(to size: CGSize, with coordinator<br/>: UIViewControllerTransitionCoordinator) {   collectionView.reloadData()<br/>}</pre>
            <p class="mce-root">Build and rerun the project by hitting the Play button (or using ⌘ + <em>R</em>) and rotate the device by using ⌘ + right arrow. You will now see that, every time
               you update the size of the restaurant listing page, the grid updates as well to fit
               the new size. Let's now move to the restaurant detail page.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Updating restaurant details </h1>
            
         </header>
         
         
         <article>
            
            
            <p>If you click on a restaurant and go to a restaurant detail page, you should see something
               similar to the following screenshot:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="445" src="assets/a0d573dc-950d-492c-913b-2a500804ed24.png" width="590"/></div>
            
            <p>We do not have much to fix on this screen.  If you scroll down to the bottom, you
               will see that the image we create is not sized correctly. We need to update this so
               that, depending on the device, we render the appropriate image size. We also need
               to update the Auto Layout. You can try other <span>device </span>sizes; you should see the same display on all the screens.
            </p>
            
            <ol>
               
               <li>Open <kbd>RestaurantDetail.storyboard</kbd>.
               </li>
               
               <li>Select the image map using the Outline view and in the Attributes inspector update
                  the <span class="packt_screen">Content Mode</span> to <span class="packt_screen">Aspect Fill</span>.
               </li>
               
            </ol>
            
            <p class="mce-root">If you build and run now, you will see that our map now fills the area, but our image
               is stretched. We can leave this but, if this were being submitted, making our image
               size based off device would be a much better way to handle this. We are done with
               cleaning up and making our app ready for the iPad. You should now be able to see how
               powerful Collection Views are and how they make it easy to have a custom look with
               very little code.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Summary</h1>
            
         </header>
         
         
         <article>
            
            
            <p>You now have an app that functions perfectly on all devices. You can see how using
               the Collection View gives your app some variety on different devices with very little
               code. As you get more and more comfortable with this, you will find other ways to
               make your app look unique on various devices.
            </p>
            
            <p>We could submit the app as-is right now and it would be perfectly fine, but why not
               take advantage of some additional features you can implement?
            </p>
            
            <p>In the next chapter, we will do just that by creating an iMessage app for our app.</p>
            
            
            
         </article>
         
         
         
      </section>
      
   </body></html>