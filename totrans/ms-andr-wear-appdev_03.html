<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Developing Android Wear Applications" id="aid-QMFO1"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Developing Android Wear Applications</h1></div></div></div><div class="blockquote"><table border="0" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p>
<span class="emphasis"><em>"All compromise is based on give and take, but there can be no give and take on fundamentals. Any compromise on mere fundamentals is a surrender. For it is all give and no take."</em></span>
</p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution"><span class="emphasis"><em>Mahatma Gandhi</em></span></span></td></tr></table></div><p>In this chapter, we will be covering the concepts involved in the sample skeleton project that we imported using Android Studio in the previous chapter. We will be discussing the code involved in detail to help us gain some understanding of the fundamental building blocks of an Android Wear application.</p><p>Then, we'll be creating a new Android Wear app from scratch using Android Studio. We'll walk through the steps involved in creating the app and discuss the code changes needed and run the app to see the desired outcome.</p><p>Let's roll up our sleeves and see some code in action.</p><div class="section" title="Skeleton app"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec21"/>Skeleton app</h1></div></div></div><p>If you recall from the previous chapter, we used Android Studio to import the sample project to build a skeleton wearable application. If you wonder where we got all the code from, here is the GitHub repository link for that project, <a class="ulink" href="https://github.com/googlesamples/android-SkeletonWearableApp/">https://github.com/googlesamples/android-SkeletonWearableApp/</a>.</p><p>Android Studio gets updated all the time. At the time of writing, Android Studio 2.0 preview 7 is the latest version currently available. It may or may not be the same version while you are reading this book.</p><p>If, for some reason, Android Studio doesn't let you import the Skeleton wearable app or the repository of the sample code is not available in Google's Samples GitHub repository, you can clone it from the fork I created for that project in my GitHub repository,
<a class="ulink" href="https://github.com/siddii/android-SkeletonWearableApp">https://github.com/siddii/android-SkeletonWearableApp</a>.</p><div class="note" title="Note"><h3 class="title"><a id="note5"/>Note</h3><p>If you have done any Android app development before, you'll be able to follow this chapter. If not, this is a good time to brush up on some Android application development basic concepts and foundations.</p></div></div></div>
<div class="section" title="The Android manifest file" id="aid-RL0A1"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec22"/>The Android manifest file</h1></div></div></div><p>Every Android application consists of an Android manifest file named <code class="literal">AndroidManifest.xml</code>. It contains all the essential information needed for the Android operating system to launch the application. The manifest file is used for declaring the activities, services, intents, SDK versions, features, permissions, and other
application-specific components and behavioral elements for the Android application.</p><p>We should pay close attention to line number <span class="emphasis"><em>23</em></span> of the Android manifest file that was included in the Skeleton wearable app:</p><pre class="programlisting">&lt;uses-feature android:name="android.hardware.type.watch" /&gt;</pre><p>This line basically explains to the Android operating system that it is an Android Wear app. To prove this out, let's try commenting out this line from the <code class="literal">AndroidManifest.xml</code> file and launch the application. You should see the following error message when you launch the application using an emulator:</p><p>
</p><div class="mediaobject"><img src="../Images/image00147.jpeg" alt="The Android manifest file"/></div><p style="clear:both; height: 1em;"> </p><p>
</p></div>
<div class="section" title="Gradle build files"><div class="titlepage" id="aid-SJGS2"><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Gradle build files</h1></div></div></div><p>Let's take a look at how the Gradle build files are configured. The <code class="literal">settings.gradle</code> file in the root folder includes all the modules for this project. In this case, it's just one module, which is the <code class="literal">Wearable</code> module folder:</p><p>
</p><div class="mediaobject"><img src="../Images/image00148.jpeg" alt="Gradle build files"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>You will notice that there are two <code class="literal">build.gradle</code> files. One is at the project level and the other is inside the <code class="literal">Wearable</code> folder's module level.</p><p>The project's <code class="literal">build.gradle</code> file is empty because we don't have anything specific to the project build settings, whereas the <code class="literal">build.gradle</code> file in the <code class="literal">Wearable</code> module contains all the build configurations for this app:</p><p>
</p><div class="mediaobject"><img src="../Images/image00149.jpeg" alt="Gradle build files"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Lines 20, 21, and 22 of the <code class="literal">build.gradle</code> file specifies the external build dependencies for this project. Line 20 includes the dependency for <span class="strong"><strong>Google Play Services</strong></span>, which is an integral part of the Android Wear platform. Google Play Services is used heavily for data synchronization and communication between the Android phones and wearable devices. We'll be covering them in detail in later chapters.</p><p>Line 21 includes the dependency for the <code class="literal">v13</code> support library. The reason is that we use <span class="strong"><strong>Fragment</strong></span> inside the <code class="literal">GridExampleActivity</code> class. </p><p>Obviously, line 22 includes the dependency for the wearable support library since it's a wearable application.</p><p>The rest of the configuration is pretty standard for Android applications, including the source path, compile and target SDK versions, and the app's version settings.</p></div>
<div class="section" title="App activities"><div class="titlepage" id="aid-TI1E2"><div><div><h1 class="title"><a id="ch03lvl1sec24"/>App activities</h1></div></div></div><p>The skeleton project consists of two activities, <code class="literal">MainActivity</code> and <code class="literal">GridExampleActivity</code>. The <code class="literal">MainActivity</code> activity contains a header text with <code class="literal">Main Activity</code> and three buttons inside <code class="literal">ScrollView</code> layout.</p><p>Let's take a look at the <code class="literal">main_activity.xml</code> file to see how the component layout is structured. One of the biggest advantages to developing Android applications using Android Studio is its layout editor. Although it may not be precisely the same during runtime, it can give a closer idea in terms of how the UI components are rendered during runtime.</p><p>After you have opened the <code class="literal">main_activity.xml</code> file, make sure you have the <span class="strong"><strong>Preview</strong></span> tool window selected on the right side of Android Studio:</p><p>
</p><div class="mediaobject"><img src="../Images/image00150.jpeg" alt="App activities"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>The Android Studio layout editor will display the live preview for changes to layout files. It also helps to get an understanding of how the components will be laid out for different form factors. As we know, Android Wear comes in square and circle-shaped form factors, so it will be a good idea to check how the components are laid out in both square and circle forms.</p><p>Clicking on the layout drop-down menu will display all the form factors available in the SDK and tool configurations:</p><p>
</p><div class="mediaobject"><img src="../Images/image00151.jpeg" alt="App activities"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>If you select the <span class="strong"><strong>Android Wear Round</strong></span> layout, then you'll be able to see how the <code class="literal">main_activity.xml</code> file will be rendered on round-faced Android Wear watches.</p><p>In order to provide the best user experience, you should make sure that the components are laid out and the users are able to access the UI elements without a problem. The only way we can do that is to test the app on various form factors and layout settings:</p><p>
</p><div class="mediaobject"><img src="../Images/image00152.jpeg" alt="App activities"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>As we progress further through the book, we'll use techniques that will help serve both square-shaped and circle-shaped Android Wear devices by leveraging some Android support libraries.</p><p>By now, you'll have a basic understanding of how the skeleton wearable app was developed using some basic Android Wear API objects and components. Spend some time reading through <code class="literal">GridExampleActivity</code> and other parts of this project to get an idea of how all these pieces of the project are connected together.</p><p>If you don't follow much of the code in this project, do not fear. We'll be digging into all these aspects of Android Wear application development in later chapters of this book.</p></div>
<div class="section" title="Let's build an Android Wear app"><div class="titlepage" id="aid-UGI02"><div><div><h1 class="title"><a id="ch03lvl1sec25"/>Let's build an Android Wear app</h1></div></div></div><p>So far, we've been looking at the Skeleton wearable sample app that we cloned from Google's GitHub repository. We familiarized ourselves with how the skeleton app was structured and got some ideas of how the code and components are structured.</p><p>Now, it's time for us to build our own Android Wear app. We'll be using Android Studio to create this app from scratch.</p><p>From the Android Studio welcome screen, click on <span class="strong"><strong>Start a new Android Studio project</strong></span> option as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="../Images/image00153.jpeg" alt="Let's build an Android Wear app"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Configure the project with an application name, domain, and package name that suits your system settings:</p><p>
</p><div class="mediaobject"><img src="../Images/image00154.jpeg" alt="Let's build an Android Wear app"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>In the <span class="strong"><strong>Target Android Devices</strong></span> screen, uncheck the <span class="strong"><strong>Phone and Tablet</strong></span> option and make sure you select the <span class="strong"><strong>Wear</strong></span> option. Android Studio will automatically select the safest minimum SDK needed to create the app based on the SDKs and system images you have installed on the system.</p><p>We're going to the default settings that were selected by Android Studio for this app:</p><p>
</p><div class="mediaobject"><img src="../Images/image00155.jpeg" alt="Let's build an Android Wear app"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>After you click the <span class="strong"><strong>Next</strong></span> button, select <span class="strong"><strong>Blank Wear Activity</strong></span>. By default, Android Studio will select  <span class="strong"><strong>Always On Wear Activity</strong></span>:</p><p>
</p><div class="mediaobject"><img src="../Images/image00156.jpeg" alt="Let's build an Android Wear app"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>On the next screen, keep the activity name and other configurations unchanged:</p><p>
</p><div class="mediaobject"><img src="../Images/image00157.jpeg" alt="Let's build an Android Wear app"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>After you click on the <span class="strong"><strong>Finish</strong></span> button, Android Studio will take some time to compile and build the project.</p><p>Once it's done, you'll see the project with <code class="literal">MainActivity</code> and three layout files, <code class="literal">activity_main.xml</code>, <code class="literal">rect_activity_main.xml</code>, and <code class="literal">round_activity_main.xml</code>.</p><p>Android Studio will also create a default run configuration for running the app:</p><p>
</p><div class="mediaobject"><img src="../Images/image00158.jpeg" alt="Let's build an Android Wear app"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Clicking on <span class="strong"><strong>Run</strong></span> will list all the Android device emulators. You can select one from the list we created earlier.</p><p>After you select the emulator, the device will boot up and the Android Studio will deploy the app to the emulator. Be patient at this stage, because it might take a while for the device to start and run the app we just built. Try not to interfere with the running emulator as it might cause issues running the app.</p><div class="note" title="Note"><h3 class="title"><a id="tip6"/>Tip</h3><p>Although it might sound easy to develop an Android application using emulators, the frustrating part is the emulator's boot-up and application load times. If you have the option to develop using a physical device, go for that rather than wasting lots of time waiting and watching.</p><p>At some point during the course of this book, we'll be developing using a physical Android phone and a wearable device. We'll cover the settings and configurations needed to develop using those devices when we get there.</p></div><p>Here is a screenshot of how the screen looks after successfully running this app:</p><p>
</p><div class="mediaobject"><img src="../Images/image00159.jpeg" alt="Let's build an Android Wear app"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><p>Let's add some customization to this project now. Update the <code class="literal">onCreate</code> method of the <code class="literal">MainActivity</code> file with the following code:</p><pre class="programlisting">protected void onCreate(Bundle savedInstanceState){&#13;
  super.onCreate(savedInstanceState);&#13;
  setContentView(R.layout.activity_main);&#13;
  final WatchViewStub stub = (WatchViewStub) findViewById(R.id.watch_view_stub);&#13;
  &#13;
  stub.setOnLayoutInflatedListener(new   WatchViewStub.OnLayoutInflatedListener() &#13;
  {&#13;
    @Override&#13;
    public void onLayoutInflated(WatchViewStub stub) &#13;
    {&#13;
      mTextView = (TextView) stub.findViewById(R.id.text);&#13;
      Date today = new Date();&#13;
      SimpleDateFormat dateFormat = new SimpleDateFormat("EEEE, MMMM d - yyyy");mTextView.setText("Today is " + dateFormat.format(today));&#13;
    }     &#13;
  });&#13;
}</pre><p>What we are doing here is basically setting a dynamic text to <code class="literal">mTextView</code> component with the content saying today's date.</p><p>Update the <code class="literal">rect_activity_main.xml</code> file with the following content. We have just updated the background color of the layout and updated the text view's color and padding options:</p><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;&#13;
&#13;
&lt;LinearLayout&#13;
  &#13;
  &#13;
  android:layout_width="match_parent"&#13;
  android:layout_height="match_parent"&#13;
  android:orientation="vertical"&#13;
  tools:context="com.siddique.androidwear.today.MainActivity"&#13;
  tools:deviceIds="wear_square"&#13;
  android:background="@color/orange"&#13;
&gt;&#13;
&#13;
&lt;TextView&#13;
  android:id="@+id/text"&#13;
  android:layout_width="wrap_content"&#13;
  android:layout_height="wrap_content"&#13;
  android:text="@string/hello_square"&#13;
  android:textSize="25sp"&#13;
  android:textAlignment="center"&#13;
  android:textColor="@color/black"&#13;
  android:paddingTop="25dp"&#13;
/&gt;&#13;
 &#13;
&lt;/LinearLayout&gt;</pre><p>When you re-run the app, your output should look like the following screenshot:</p><p>
</p><div class="mediaobject"><img src="../Images/image00160.jpeg" alt="Let's build an Android Wear app"/></div><p style="clear:both; height: 1em;"> </p><p>
</p><div class="note" title="Note"><h3 class="title"><a id="note7"/>Note</h3><p>If you got stuck with any of the preceding steps, don't worry. The code we discussed is available on the GitHub repository
(<a class="ulink" href="https://github.com/siddii/mastering-android-wear/tree/master/Chapter_3">https://github.com/siddii/mastering-android-wear/tree/master/Chapter_3</a>). Use that for reference or to compare against your project.</p></div></div>
<div class="section" title="Summary" id="aid-VF2I1"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Summary</h1></div></div></div><p>We discussed various components and aspects of our Android Wear project by going over the sample code from the skeleton wearable app. We looked at Android Studio's layout editor and saw how it was used to preview live updates to layout files.</p><p>We developed <code class="literal">Today</code>, an Android Wear app, from scratch using Android Studio. We'll be extending that app as we progress further through this book.</p></div></body></html>