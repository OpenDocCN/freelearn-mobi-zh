<html><head></head><body>
      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Displaying Data in Restaurant Detail</h1>
            
         </header>
         
         
         <article>
            
            
            <p>Our app is coming together nicely, but we have one more section to do before we can
               start adding features. We have data in all of our views except for in our restaurant
               detail. In the last chapter, we passed data using segues, and we are going to do this
               again in this chapter.  We have a few other things in this view that we need to set
               up before we move on to some of the features of the app; so in this chapter, we will
               cover:
            </p>
            
            <ul>
               
               <li>Passing data using segues</li>
               
               <li>Connecting IBOutlet to display data</li>
               
               <li>Displaying one annotation in a Map view</li>
               
            </ul>
            
            <p>Let's set up our <kbd>RestaurantDetailViewController</kbd> by adding the following:
            </p>
            
            <ol>
               
               <li>Add the following variables after the class declaration and before the <kbd>selectedRestaurant</kbd> variable:
               </li>
               
            </ol>
            <pre style="padding-left: 60px">   // Nav Bar<br/>    @IBOutlet weak var btnHeart: UIBarButtonItem!<br/><br/>    // Cell One<br/>    @IBOutlet weak var lblName: UILabel!<br/>    @IBOutlet weak var lblCuisine: UILabel!<br/>    @IBOutlet weak var lblHeaderAddress: UILabel!<br/><br/>    // Cell Two<br/>    @IBOutlet weak var lblTableDetails: UILabel!<br/><br/>    // Cell Three<br/>    @IBOutlet weak var lblOverallRating: UILabel!<br/><br/>    // Cell Eight<br/>    @IBOutlet weak var lblAddress: UILabel!<br/>    @IBOutlet weak var imgMap: UIImageView! </pre>
            <ol start="2">
               
               <li>Make sure you save the file.</li>
               
            </ol>
            
            <p>Now that we've created our <kbd>IBOutlet</kbd>, we need to connect them: 
            </p>
            
            <ol>
               
               <li>Open the <kbd>RestaurantDetail.storyboard</kbd>, select the Restaurant Detail View Controller in the Outline view, and then open
                  the Connections inspector in the Utilities panel.
               </li>
               
               <li>Now click on and drag from the empty circle of each of the following variables we
                  just added under Outlets to their respective elements listed as follows in either
                  the scene or Outline view.
               </li>
               
               <li>An empty circle for <kbd>imgMap</kbd> to the Map View in the Outline view:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="396" src="assets/ff6e39c9-1aa9-44d7-9d37-3ac1dedb6f8d.png" width="331"/></div>
            
            <ol start="4">
               
               <li>An empty circle for <kbd>lblAddress</kbd> to the address <span class="packt_screen">Label</span> above the map:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="547" src="assets/e6b2d9af-605c-4016-94ab-95eb6c9e5881.png" width="457"/></div>
            
            <ol start="5">
               
               <li>An empty circle for <kbd>lblOverallRating</kbd> to the <span class="packt_screen">Label</span> inside the <span class="packt_screen">Reviews</span> cell:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="553" src="assets/63b0ffe4-f29c-4b27-ae49-4349ec06c1be.png" width="459"/></div>
            
            <ol start="6">
               
               <li>An empty circle for <kbd>lblTableDetails</kbd> to the <span class="packt_screen">Label</span> under the header in the scene:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="563" src="assets/88fc7ed3-0f37-4124-8881-8cc8404076a0.png" width="468"/></div>
            
            <ol start="7">
               
               <li>An empty circle for <kbd>lblName</kbd> to the <span class="packt_screen">Label</span> under the logo in the scene:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="574" src="assets/de5080c3-2bf2-4eb2-a5c0-2ce4eba827a8.png" width="475"/></div>
            
            <ol start="8">
               
               <li>An empty circle for <kbd>lblCuisine</kbd> to the <span class="packt_screen">Label</span> under <kbd>lblName</kbd> in the scene:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="536" src="assets/af0ddf35-a74f-4cc6-911f-c6eca0f2cb20.png" width="444"/></div>
            
            <ol start="9">
               
               <li>An empty circle for <kbd>lblHeaderAddress</kbd> to the <span class="packt_screen">Label</span> under <kbd>lblCuisine</kbd> in the scene:
               </li>
               
            </ol>
            
            <div class="mce-root CDPAlignCenter CDPAlign"><img height="594" src="assets/3a020d3e-f0f2-4380-a1b5-99fbff35e0d2.png" width="493"/></div>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Adding a navigation button </h1>
            
         </header>
         
         
         <article>
            
            
            <p>Adding a navigation button used to be as simple as just dragging out the button; however,
               for some reason that isn't the case anymore. To display a heart in the navigation
               bar, we will have to do the following:
            </p>
            
            <ol>
               
               <li>Select the Restaurant Detail View Controller in the Outline view.</li>
               
               <li>Next, go to <span class="packt_screen">Editor</span> | <span class="packt_screen">Embed In</span> | <span class="packt_screen">Navigation Controller</span>.
               </li>
               
            </ol>
            
            <p>            When complete, you should see the following:</p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="419" src="assets/78204bb9-9cfc-4d9e-b34c-05911f2ea1ab.png" width="522"/></div>
            
            <ol start="3">
               
               <li>Next, open the Utilities panel, and in the filter bar of the object library, type
                  <kbd>bar</kbd>; drag a bar button item to the top-right of the Restaurant Detail View Controller.
                  You will see an outline appear in this area, as follows:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="533" src="assets/7409004b-29c6-4fa8-96ee-d24c2ef9d64e.png" width="488"/></div>
            
            <p style="padding-left: 60px">In the Attributes inspector, under <span class="packt_screen">Bar Item</span>, delete the text <span class="packt_screen">Item</span> for <span class="packt_screen">Title</span> and <span class="packt_screen">Image</span> and update the image value to heart-unselected. When complete, you should see the
               following:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="399" src="assets/b9f4740a-64de-4846-99ee-99054ee0a3cc.png" width="556"/></div>
            
            <ol start="4">
               
               <li>Now we need to connect our favorite icon in the navigation bar. Select the Restaurant
                  Detail View Controller in the Outline view. Then, in the Outlet inspector, click and
                  drag <kbd>btnHeart</kbd> to our newly created button, as follows:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="513" src="assets/23563ce0-65e3-4a4a-a765-b1ae31670d02.png" width="712"/></div>
            
            <ol start="5">
               
               <li>Next, with the View Controller still selected, in the Attributes inspector click on
                  the checkbox next to <span class="packt_screen">Is Initial View Controller</span>. When complete, you should see the following:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="467" src="assets/177d7ed6-ce61-46b4-a867-20b860ced851.png" width="572"/></div>
            
            <ol start="6">
               
               <li>Now select the Navigation Controller and delete it. When you are done, you should
                  see the following:
               </li>
               
            </ol>
            
            <div class="CDPAlignCenter CDPAlign"><img height="456" src="assets/9970e8bf-8e63-49a4-b453-f1d26578fef0.png" width="310"/></div>
            
            <p>For some reason, we had to go through all of that just to add the bar button item,
               even though typically we could just drag it and drop it. Now that we have everything
               connected, we can now jump into coding and get our detail page displaying data.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Displaying data in our static Table View</h1>
            
         </header>
         
         
         <article>
            
            
            <p> </p>
            
            <p>Next, we need to create a method that will display all of our data in our labels.</p>
            
            <p>So, open the <kbd>RestaurantDetailViewController.swift</kbd> file and add the following before the last curly brace:
            </p>
            <pre>func setupLabels() {<br/>    guard let restaurant = selectedRestaurant else { return }<br/>    if let name = restaurant.name {<br/>        lblName.text = name<br/>        title = name<br/>    }<br/><br/>    if let cuisine = restaurant.subtitle { lblCuisine.text = cuisine }<br/>    if let address = restaurant.address {<br/>        lblAddress.text = address<br/>        lblHeaderAddress.text = address<br/>    }<br/><br/>    lblTableDetails.text = "Table for 7, tonight at 10:00 PM"<br/>}</pre>
            <p>This method will now get the data and display it inside our labels. Next, we want
               to display a map of the restaurant location at the bottom of our Detail view.  Now,
               you might be wondering why we are using an image and not a map. Using a map uses a
               lot more resources, whereas an image makes things a lot smoother.  Let's arrange for
               an image of a map to display, and also show our custom annotation in the image. Add
               the following method under the <kbd>setupLabels()</kbd> method and before the last curly brace:
            </p>
            <pre>func createMap() {<br/>    guard let annotation = selectedRestaurant, let long = annotation.longitude, let lat = annotation.latitude else { return }<br/>    let location = CLLocationCoordinate2D(<br/>        latitude: lat,<br/>        longitude: long<br/>    )<br/><br/>    takeSnapShot(with: location)<br/>}</pre>
            <p>In this method, we get the longitude and latitude and enter the values into a <kbd>CLLocationCoordinate2D</kbd> object. We then pass the location to a method called <kbd>takeSnapShot(with:)</kbd>.  Add the following method under the <kbd>createMap()</kbd> method:
            </p>
            <pre>func takeSnapShot(with location: CLLocationCoordinate2D) {<br/>    let mapSnapshotOptions = MKMapSnapshotOptions()<br/>    var loc = location<br/>    let polyLine = MKPolyline(coordinates: &amp;loc, count: 1)<br/>    let region = MKCoordinateRegionForMapRect(polyLine.boundingMapRect)<br/>    <br/>    mapSnapshotOptions.region = region<br/>    mapSnapshotOptions.scale = UIScreen.main.scale<br/>    mapSnapshotOptions.size = CGSize(width: 340, height: 208)<br/>    mapSnapshotOptions.showsBuildings = true<br/>    mapSnapshotOptions.showsPointsOfInterest = true<br/><br/>    let snapShotter = MKMapSnapshotter(options: mapSnapshotOptions)<br/>    snapShotter.start() { snapshot, error in<br/>        guard let snapshot = snapshot else {<br/>            return<br/>        }<br/><br/>        UIGraphicsBeginImageContextWithOptions(mapSnapshotOptions.size, true, 0)<br/>        snapshot.image.draw(at: .zero)<br/><br/>        let identifier = "custompin"<br/>        let annotation = MKPointAnnotation()<br/>        annotation.coordinate = location<br/><br/>        let pinView = MKPinAnnotationView(annotation: annotation, reuseIdentifier: identifier)<br/>        pinView.image = UIImage(named: "custom-annotation")!<br/>        let pinImage = pinView.image<br/>        var point = snapshot.point(for: location)<br/><br/>        let rect = self.imgMap.bounds<br/>        if rect.contains(point) {<br/>            let pinCenterOffset = pinView.centerOffset<br/>            point.x -= pinView.bounds.size.width / 2<br/>            point.y -= pinView.bounds.size.height / 2<br/>            point.x += pinCenterOffset.x<br/>            point.y += pinCenterOffset.y<br/>            pinImage?.draw(at: point)<br/>        }<br/><br/>        if let image = UIGraphicsGetImageFromCurrentImageContext() {<br/>            UIGraphicsEndImageContext()<br/>            DispatchQueue.main.async {<br/>                self.imgMap.image = image<br/>            }<br/>        }<br/>    }<br/>}</pre>
            <p> </p>
            
            <p>This method is long, but it allows us to create a map at the size we need. We then
               pass all of our settings to our snapshotter to create a picture. Once we have created
               our image, we then add our custom annotation to it. Although this requires a lot of
               code, it is the best way to understand it in its entirety. Here, we would recommend
               changing values line-by-line to see how it affects the image.
            </p>
            
            <p>Now that we have created our functions, we just need to call them, as follows:</p>
            
            <p>Add the following after the <kbd>viewDidLoad()</kbd> method in the <kbd>RestaurantDetailViewController.swift</kbd> file:
            </p>
            <pre>func initialize() {<br/>   setupLabels()<br/>   createMap()<br/>}</pre>
            <p>This method now needs to be called inside your <kbd>viewDidLoad()</kbd> method.  Replace the <kbd>dump</kbd> statement in the <kbd>viewDidLoad()</kbd> method with the following:
            </p>
            <pre>initialize()</pre>
            <p>Now we have finished with our Restaurant Detail View Controller.  Let's build and
               run the project by hitting the Play button (or using <em>cmd</em> + <em>R</em>). When you select a restaurant, you should see all of the restaurant's information
               on the details page.  
            </p>
            
            <p>Also, you should see a pin dropped at the restaurant's location on the map, which
               is actually an image:
            </p>
            
            <div class="CDPAlignCenter CDPAlign"><img height="526" src="assets/77e1d5b1-0086-4fd4-9c5c-4af292901419.png" width="300"/></div>
            
            <p>We are done with the restaurant detail for now, but we still need to be able to show
               ratings, reviews, and photos. We will work on all of these features in upcoming chapters.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   

      
      <section>
         
         
         <header>
            
            <h1 class="header-title">Summary</h1>
            
         </header>
         
         
         <article>
            
            
            <p>We now have JSON data loading into our app.  As you can see, going from a plist to
               a JSON file was not a huge step. Our app is now looking more and more like it should
               be available on the App Store. In the following chapters, we will turn our attention
               to adding features that you might want to use in your app. These features will enhance
               the user experience, and therefore learning them will be invaluable. Even if the features
               don't seem like something you want or need, it will be beneficial in the long run
               to understand what they are and how they work.
            </p>
            
            <p>In the next chapter, you will work with the camera and learn how to apply filters
               and save images to the Camera Roll.
            </p>
            
            
            
         </article>
         
         
         
      </section>
      
   </body></html>