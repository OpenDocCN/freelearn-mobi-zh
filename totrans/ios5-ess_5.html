<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Using AirPlay and Core Image"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Using AirPlay and Core Image</h1></div></div></div><p>Starting with the release of iOS 4.2, developers could use AirPlay to stream videos, audios, and photos to an Apple TV capable device. In iOS 5, it is now even easier to wirelessly mirror everything, automatically, on your iPad 2 to an HDTV through Apple TV.</p><p>With the additional set of APIs that come as a part of iOS 5, applications which are built using the AV Foundation framework now support encrypted audio and video streams, which are delivered through HTTP Live Streaming, and can also display different content on each of the HDTV and the iPad 2 screens.</p><p>The Core Image framework is a hardware-accelerated framework that provides an easy way to enhance photos and videos. This enables you to create amazing effects in your camera and image editing applications.<span class="strong"><strong> Core Image</strong></span> provides several built-in filters, such as color effects, distortions, and transitions. It also includes advanced features, such as auto-enhance, red-eye reduction, and facial recognition.<a id="id208" class="indexterm"/>
</p><p>In this chapter, we will be taking a closer look into what each of these frameworks are, and how to go about implementing these within our applications. We will take a look at how to incorporate AirPlay within our applications, and have this information directed to another output device using Apple TV. We will also be taking a look into the Core Image framework, and how to use the various filter effects using the<code class="literal"> CIImage</code> class.<a id="id209" class="indexterm"/>
</p><p>In this chapter, we will:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Learn about the AirPlay and Core Image frameworks</li><li class="listitem" style="list-style-type: disc">Create a simple AirPlay and Core Image application</li><li class="listitem" style="list-style-type: disc">Learn how to output application content to an Apple TV device</li><li class="listitem" style="list-style-type: disc">Take a look at how to apply various filter effects for distortions, transitions, and color effects, using the<code class="literal"> CIImage</code> class</li></ul></div><p>We have some fantastic stuff to cover in this chapter. So, let's get started.</p><div class="section" title="Understanding the AirPlay framework"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec01"/>Understanding the AirPlay framework</h1></div></div></div><p>The AirPlay framework is an updated framework that lets you stream audio and video content from any iOS-based device to any Airplay-enabled device that is capable of playing audio and video, such as television sets and audio systems. Starting with iOS 5, developers now have the flexibility to incorporate Airplay content into their applications, and have this information presented out to a nearby Apple TV 2 receiver.<a id="id210" class="indexterm"/>
</p><p>In this section, we will take a look at how to create a simple application to playback video content on an iOS device, and then take a look at the steps involved to output this to an Apple TV 2 device.</p><div class="section" title="Creating a simple AirPlay application"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec01"/>Creating a simple AirPlay application</h2></div></div></div><p>Playing videos is one of the most common tasks that can be done on any iOS device, all videos must be played and displayed in full-screen. Before we can play any videos, we need to add the Media Player framework into our application project.<a id="id211" class="indexterm"/>
</p><p>Before we can proceed, we first need to create our<code class="literal"> AirPlayExample</code> project. To refresh your memory on how to go about creating a new project, you can refer to the section that we covered in<a class="link" href="ch01.html" title="Chapter 1. What's New in iOS5"> Chapter 1</a>,<span class="emphasis"><em> What's New in iOS5</em></span>, under the section named<span class="emphasis"><em> Creating the MyEmailApp application</em></span>.</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Launch Xcode from the<code class="literal"> /Xcode4/Applications</code> folder.</li><li class="listitem"> Choose<span class="strong"><strong> Create a new Xcode project</strong></span>, or<span class="strong"><strong> File | New Project</strong></span>.</li><li class="listitem"> Select the<span class="strong"><strong> Single View Application</strong></span> template from the list of available templates.</li><li class="listitem"> Select<span class="strong"><strong> iPhone</strong></span> from under the<span class="strong"><strong> Device Family</strong></span> drop-down.</li><li class="listitem"> Click on the<span class="strong"><strong> Next</strong></span> button to proceed to the next step in the wizard.<div class="mediaobject"><img src="graphics/2267EXP_05_01.jpg" alt="Creating a simple AirPlay application"/></div></li><li class="listitem"> Enter in<code class="literal"> AirPlayExample</code> as the name for your project, and then click on the<span class="strong"><strong> Next</strong></span> button to proceed to the next step of the wizard.<a id="id212" class="indexterm"/></li><li class="listitem"> Specify the location where you would like to save your project.</li><li class="listitem"> Click on the<span class="strong"><strong> Save</strong></span> button to continue and display the Xcode workspace environment.</li></ol></div><p>Now that we have created our<code class="literal"> AirPlayExample</code> project, we now need to add an important framework to our project to enable our application with the ability to play movie files. To add the Media Player framework to your project, select the<span class="strong"><strong> Project Navigator Group</strong></span>, and then follow these simple steps:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Click and select your project from the<span class="strong"><strong> Project Navigator</strong></span>.</li><li class="listitem"> Then select your project target from under the<span class="strong"><strong> TARGETS</strong></span> group.</li><li class="listitem"> Select the<span class="strong"><strong> Build Phases</strong></span> tab.</li><li class="listitem"> Expand the<span class="strong"><strong> Link binary with Libraries disclosure</strong></span> triangle.</li><li class="listitem"> Finally, use the<span class="strong"><strong> +</strong></span> to add the library you want.</li><li class="listitem"> Select the<span class="strong"><strong> MediaPlayer.framework</strong></span> from the list of available frameworks. You can also search if you can't find the framework you are after, from within the list.</li></ol></div><p>If you are still confused how to go about adding the frameworks, follow this screenshot, which highlights the areas that you need to select (surrounded by a red rectangle):<a id="id213" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/2267EXP_05_02.jpg" alt="Creating a simple AirPlay application"/></div><p>Now that you have added the<code class="literal"> MediaPlayer.framework</code> into your project, we need to start building our user interface that will be responsible for playing the movie:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> From the Project Navigator, select and open the<span class="strong"><strong> ViewController.xib</strong></span> file.</li><li class="listitem"> From the<span class="strong"><strong> Object Library</strong></span>, select and drag a (<code class="literal">UIButton</code>) Round Rect Button control, and add this to our view.</li><li class="listitem"> Resize accordingly, then modify the<span class="strong"><strong> Object Attributes</strong></span> section of the Round Rect Button, and set its title to<code class="literal"> Play Movie</code>.</li></ol></div><p>We don't need to add a stop button, as we will be adding an event that will handle this for us when the movie has finished playing. If you have followed the steps correctly, your view should look something like that shown in the following screenshot. If it doesn't look quite the same as mine, feel free to adjust yours:</p><div class="mediaobject"><img src="graphics/2267EXP_05_03.jpg" alt="Creating a simple AirPlay application"/></div><p>As you can see, our form doesn't do much at this stage, and if you were to run this application in the simulator, you would see the controls as placed out on your screen. The following steps will show you how to connect your buttons up to action events which will each perform the task of playing the video. So let's get started:<a id="id214" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Open the<code class="literal"> ViewController.h</code> interface file, and create the following highlighted entries as shown in the code snippet:<div class="informalexample"><pre class="programlisting">#import &lt;UIKit/UIKit.h&gt;<span class="strong"><strong>
#import &lt;MediaPlayer/MediaPlayer.h&gt;</strong></span>
@interface ViewController : UIViewController<span class="strong"><strong>
-(IBAction)playMovie:(id)sender;</strong></span>
@end
</pre></div></li><li class="listitem"> We need to create an action event. Select the<span class="strong"><strong> Play Movie</strong></span> button, and hold down the Control key while you drag this into the<code class="literal"> ViewController.m</code> implementation file class, as shown in the following screenshot:<a id="id215" class="indexterm"/><div class="mediaobject"><img src="graphics/2267EXP_05_04.jpg" alt="Creating a simple AirPlay application"/></div></li><li class="listitem"> Specify a name for the action that you want to create. Enter in<code class="literal"> playMovie</code> as the name of the action.</li><li class="listitem"> Set the type of event to be<span class="strong"><strong> Touch Up Inside</strong></span>.<div class="mediaobject"><img src="graphics/2267EXP_05_05.jpg" alt="Creating a simple AirPlay application"/></div></li><li class="listitem"> Click on the<span class="strong"><strong> Connect</strong></span> button to have Xcode create the event.<a id="id216" class="indexterm"/></li><li class="listitem"> We now need to add the code to our<code class="literal"> playMovie</code> function which will handle playing our sample movie file. Enter in the following code snippet for this function:<a id="id217" class="indexterm"/><div class="informalexample"><pre class="programlisting">-(IBAction)playMovie:(id)sender{
NSString *filepath = [[NSBundle mainBundle] pathForResource:@"GenieCompanyVideo" ofType:@"mp4"];
NSURL *fileURL = [NSURL fileURLWithPath:filepath];
MPMoviePlayerController *moviePlayerController = [[MPMoviePlayerController alloc]initWithContentURL:fileURL];
[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(moviePlaybackComplete:) name:MPMoviePlayerPlaybackDidFinishNotification object:moviePlayerController];
[self.view addSubview:moviePlayerController.view];
moviePlayerController.fullscreen = YES;
moviePlayerController.scalingMode = MPMovieScalingModeAspectFit;
[moviePlayerController play];
}
</pre></div></li></ol></div><p>We have just declared a variable (NSString)<code class="literal"> filePath</code> which will contain the file path to our movie file. Next, we create a (NSURL)<code class="literal"> fileUrl</code> that converts our file path to an object, which is what the<code class="literal"> MPMoviePlayerController</code> needs when it is being initialized. We then add the<code class="literal"> MPMoviePlayerController</code> view to our custom view controller, so that it will appear on the screen. We specify that we want to display this full screen, and finally we tell the<code class="literal"> moviePlayerController</code> to commence playback.<a id="id218" class="indexterm"/>
</p><p>Since we have allocated memory to our<code class="literal"> moviePlayerController</code> object, at this stage we haven't released it yet, this being due to not knowing when the movie playback will actually finish.</p><p>Fortunately, the<code class="literal"> MPMoviePlayerController</code> object comes pre-built with methods to handle this scenario, and will dispatch a notification method called<code class="literal"> MPMoviePlayerPlaybackDidFinishNotification</code> to the<code class="literal"> NSNotificationCenter</code> when the movie playback completes, as shown in the highlighted code in the previous snippet.</p><p>When we playback video content within our iPhone applications, you will sometimes need to modify the<code class="literal"> scalingMode</code> property of the<code class="literal"> MPMoviePlayerController</code> object. By setting this property, it will determine how the movie image adapts to fill the playback size that you have defined. The following scaling modes currently exist, and are displayed here:<a id="id219" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">MPMovieScalingModeNone</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">MPMovieScalingModeAspectFit</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">MPMovieScalingModeAspectFill</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">MPMovieScalingModeFill</code></li></ul></div><p>The two main common scaling modes used are the<code class="literal"> MPMovieScalingModeAspectFill</code> and<code class="literal"> MPMovieScalingModeFill</code>.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note22"/>Note</h3><p>For more information on the comparison between the different scaling modes, refer to the<span class="emphasis"><em> MPMoviePlayerController Class Reference</em></span> at the following location<code class="literal"> http://developer.apple.com/library/ios/#documentation/mediaplayer/reference/MPMoviePlayerController_Class/Reference/Reference.html#//apple_ref/doc/c_ref/MPMoviePlayerController</code>.</p></div><p>In order to implement this property in your application, insert the following line of code just before the<code class="literal"> [moviePlayerController play]</code> statement:</p><div class="informalexample"><pre class="programlisting">moviePlayerController.scalingMode = MPMovieScalingModeFill;
</pre></div><p>When you run your application, you will notice that the video fills the entire available space. Next, we need to create the<code class="literal"> moviePlaybackComplete:</code> method that will be responsible for releasing our<code class="literal"> moviePlayerController</code> object, as shown in the following code snippet:<a id="id220" class="indexterm"/>
</p><div class="informalexample"><pre class="programlisting">- (void)moviePlaybackComplete:(NSNotification *)notification{
MPMoviePlayerController *moviePlayerController = [notification object];
[[NSNotificationCenter defaultCenter] removeObserver:self name:MPMoviePlayerPlaybackDidFinishNotification object:moviePlayerController];
[moviePlayerController.view removeFromSuperview];
[moviePlayerController release];
}
</pre></div><p>In this code snippet, we passed an object to the notification method. This is whatever we have passed in the previous code snippet, due to the<code class="literal"> moviePlayerController</code> object. We start by retrieving the object using the<code class="literal"> [notification object]</code> statement, and then referencing it with the new<code class="literal"> MPMoviePlayerController</code> pointer.</p><p>We then send a message back to the<code class="literal"> NSNotificationCenter</code> method that removes the observer we previously registered within our<code class="literal"> playMovie</code> function. We finally proceed with cleaning up our custom view controller from our display, and then release the memory we previously allocated to our<code class="literal"> moviePlayerController</code> object.<a id="id221" class="indexterm"/>
</p><p>The following screenshot shows our<code class="literal"> AirPlayExample</code> application running within the iOS simulator with movie playback set up to be viewed in landscape mode; support is available to display this in portrait mode:</p><div class="mediaobject"><img src="graphics/2267EXP_05_06.jpg" alt="Creating a simple AirPlay application"/></div><p>In this section, we learned about the<code class="literal"> MediaPlayer</code> framework, and how we can use this within our applications to give us the ability to play audio and video.<a id="id222" class="indexterm"/>
</p><p>As you can see, by using the Media Player framework and the<code class="literal"> MPMoviePlayerController</code> class, you can incorporate movie playback within your iOS applications. In the next section, we will look at steps involved in modifying our application, so that this can be displayed on a TV screen using Apple TV. We learned about the various scaling modes for video playback and how to implement these.<a id="id223" class="indexterm"/>
</p></div><div class="section" title="Using AirPlay to present application content to Apple TV"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec02"/>Using AirPlay to present application content to Apple TV</h2></div></div></div><p>Starting with iOS 4.3, Apple decided to provide its developers with one of the most impressive frameworks ever imagined, which would allow developers to integrate AirPlay features into their applications. With just a few lines of code, any iOS application can be modified to have the ability to stream video directly out to an Apple TV device.<a id="id224" class="indexterm"/>
</p><p>To enable AirPlay functionality, we will need to enable a special property on our<code class="literal"> MPMoviePlayerController</code> object, by setting the<code class="literal"> allowsAirPlay</code> property to<code class="literal"> YES</code>.<a id="id225" class="indexterm"/>
</p><p>To enable AirPlay functionality within your application, follow these simple steps:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Open the<code class="literal"> ViewController.m</code> implementation file that is located within the<code class="literal"> AirPlayExample</code> folder, and locate the following statement within the<code class="literal"> playMovie</code> function:<div class="informalexample"><pre class="programlisting">[self.view addSubview:moviePlayerController.view];
</pre></div></li><li class="listitem"> Next, add the following code snippet:<div class="informalexample"><pre class="programlisting">if([moviePlayerController respondsToSelector:@selector(setAllowsAirPlay:)]){
[moviePlayerController setAllowsAirPlay:YES];
}
</pre></div></li><li class="listitem">In this code snippet, we use the <code class="literal">.respondsToSelector:</code> method of the <code class="literal">MPMoviePlayerController</code> object to cater for older iOS devices that don't support the <code class="literal">allowsAirPlay</code> property.<a id="id226" class="indexterm"/><p>If we don't do this, it will cause a run-time error exception to occur which will crash your application. In order to offer AirPlay only to those devices that support it, we need to place a conditional statement around the statement which will check to see if the <code class="literal">MPMoviePlayerController</code> object supports the <code class="literal">allowsAirPlay</code> option.
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note23"/>Note</h3><p>When this is set, it will cause an additional icon to appear within the movie player controller pane. You have no control, programmatically, over this icon placement.</p></div></li><li class="listitem"> Finally, build and run your application, and click on the<span class="strong"><strong> Play Movie</strong></span> button. The following screenshot shows what this icon looks like when AirPlay has been enabled:<div class="mediaobject"><img src="graphics/2267EXP_05_07.jpg" alt="Using AirPlay to present application content to Apple TV"/></div></li><li class="listitem"> When the AirPlay icon has been pressed, you will be presented with a pop-up list of detected output device options to choose from.<div class="mediaobject"><img src="graphics/2267EXP_05_08.jpg" alt="Using AirPlay to present application content to Apple TV"/></div></li><li class="listitem"> If you choose the<span class="strong"><strong> Apple TV</strong></span> option as shown in this screenshot, the output on your iOS device will disappear, and you will be notified that the video is being played on the Apple TV device. This is shown in the following screenshot:<a id="id227" class="indexterm"/><div class="mediaobject"><img src="graphics/2267EXP_05_09.jpg" alt="Using AirPlay to present application content to Apple TV"/></div></li><li class="listitem"> Finally, you will see your video being displayed on an Apple TV device, as shown in the following screenshot:<a id="id228" class="indexterm"/></li></ol></div><div class="mediaobject"><img src="graphics/2267EXP_05_10.jpg" alt="Using AirPlay to present application content to Apple TV"/></div><p>As you can see, by following a few simple steps, you can easily incorporate the functionality needed to turn your existing applications into Airplay-aware applications.</p><p>In the following list, you will find a few considerations to keep in mind when implementing AirPlay into your projects:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Apple has only made this feature available on its most recent devices with the AirPlay 4.3 SDK. So, there is no AirPlay support for iPhone 3G devices.</li><li class="listitem" style="list-style-type: disc">When launching an AirPlay-enabled application, you will need to ensure that both your iOS device and your Apple TV software are running the same version of the OS, otherwise you could run into some problems.</li><li class="listitem" style="list-style-type: disc">In order for iOS devices to find other Apple AirPlay-enabled devices, you will need to ensure that you are on the same Wi-Fi network that your AirPlay devices are connected to.<a id="id229" class="indexterm"/></li></ul></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note24"/>Note</h3><p>For more information about the AirPlay framework, you can refer the following Apple Developer website:<a class="ulink" href="http://developer.apple.com/library/ios/#releasenotes/General/WhatsNewIniPhoneOS/Articles/iOS4_3.html#//apple_ref/doc/uid/TP40010567-SW1"> http://developer.apple.com/library/ios/#releasenotes/General/WhatsNewIniPhoneOS/Articles/iOS4_3.html#//apple_ref/doc/uid/TP40010567-SW1</a>.</p></div></div><div class="section" title="Understanding the Core Image framework"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec03"/>Understanding the Core Image framework</h2></div></div></div><p>The Core Image framework is an extensible image processing technology architecture that has been built into Mac OS X v10.4 and iOS 5.0. This framework leverages the programmable graphics hardware to provide near real-time, pixel-accurate image processing of graphics, as well as video processing. The Core Image comes with over 100 built-in filters that are ready-to-use by filter clients who want to support image processing in their application.<a id="id230" class="indexterm"/>
</p><p>The Core Image filter reference describes these filters; the list of built-in filters can change, so for that reason, Core Image provides you with the methods that let you query the system for these available filters. You can also load filters that third-party developers package as image units. The Core Image<span class="strong"><strong> Application Programming Interface</strong></span> (<span class="strong"><strong>API</strong></span>) is part of the<span class="strong"><strong> Quartz Core framework</strong></span> (<span class="strong"><strong>QuartzCore.framework</strong></span>), and provides access to built-in image filters for both video and still images, and provides support for creating custom filters.<a id="id231" class="indexterm"/>
</p><p>You can use the Core Image from the Cocoa and Carbon frameworks by linking to Core Image framework. By using the Core Image framework, you can perform the following types of operations, by using filters that are bundled in Core Image or that you or another developer create:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Crop images and correct color, such as perform white point adjustment</li><li class="listitem" style="list-style-type: disc">Apply color effects, such as sepia tone</li><li class="listitem" style="list-style-type: disc">Blur or sharpen images</li><li class="listitem" style="list-style-type: disc">Composite images and warp or transform the geometry of an image</li><li class="listitem" style="list-style-type: disc">Generate color, checkerboard patterns, Gaussian gradients, and other pattern images</li><li class="listitem" style="list-style-type: disc">Add transition effects to images or video</li><li class="listitem" style="list-style-type: disc">Provide real-time color adjustment on video</li></ul></div><p>The following screenshot provides you with a general idea of where Core Image fits with other graphics technologies in Mac OS X:<a id="id232" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/2267EXP_05_11.jpg" alt="Understanding the Core Image framework"/></div><p>As you can see, the<span class="strong"><strong> Core Image</strong></span> framework has been integrated with these technologies, allowing you to use them together to achieve a wide range of results. You can use Core Image to process images created in Quartz 2D (Core Graphics) and textures created in OpenGL. You can also apply Core Image filters to videos played using Core Video.</p><p>The Core Image comes with over 100 built-in filters ready-to-use by filter clients who want to support image processing in their application. The Core Image filter reference describes these filters; the list of built-in filters can change, so for that reason, Core Image provides you with the methods that let you query the system for these available filters. You can also load filters that third-party developers package as image units.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note25"/>Note</h3><p>For more information on the built-in filters that are available in the Core Image API, refer to the<span class="emphasis"><em> Mac OS X Developer Library</em></span> at:<a class="ulink" href="http://developer.apple.com/library/mac/#documentation/graphicsimaging/reference/CoreImageFilterReference/Reference/reference.html">http://developer.apple.com/library/mac/#documentation/graphicsimaging/reference/CoreImageFilterReference/Reference/reference.html</a>.</p></div><p>The following code snippet displays a list of the available built-in Core Image filters.</p><div class="informalexample"><pre class="programlisting">NSArray *builtInFilterList = [CIFilter filterNamesInCategory:kCICategoryBuiltIn];
NSLog(@"%@", builtInFilterList);
</pre></div><p>The following table displays a list of available core image filters when this code is executed:<a id="id233" class="indexterm"/>
</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><tbody><tr><td style="text-align: left" valign="top">
<p>Core image filter name</p>
</td><td style="text-align: left" valign="top">
<p>Core image filter name</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CIAdditionCompositing</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIAffineTransform</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CICheckerboardGenerator</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIColorBlendMode</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CIColorBurnBlendMode</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIColorControls</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CIColorCube</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIColorDodgeBlendMode</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CIColorInvert</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIColorMatrix</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CIColorMonochrome</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIConstantColorGenerator</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CICrop</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIDarkenBlendMode</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CIDifferenceBlendMode</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIExclusionBlendMode</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CIExposureAdjust</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIFalseColor</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CIGammaAdjust</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIGaussianGradient</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CIHardLightBlendMode</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIHighlightShadowAdjust</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CIHueAdjust</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIHueBlendMode</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CILightenBlendMode</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CILinearGradient</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CILuminosityBlendMode</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIMaximumCompositing</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CIMinimumCompositing</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIMultiplyBlendMode</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CIMultiplyCompositing</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIOverlayBlendMode</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CIRadialGradient</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CISaturationBlendMode</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CIScreenBlendMode</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CISepiaTone</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CISoftLightBlendMode</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CISourceAtopCompositing</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CISourceInCompositing</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CISourceOutCompositing</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CISourceOverCompositing</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIStraightenFilter</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CIStripesGenerator</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CITemperatureAndTint</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CIToneCurve</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIVibrance</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">CIVignette</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">CIWhitePointAdjust</code>
</p>
</td></tr></tbody></table></div><p>The list displayed contains filters pertaining to both Mac OS X and iOS 5 operating systems, so it would be advisable to refer to the Core Image filter reference documentation to determine which filter applies to what technology.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note26"/>Note</h3><p>For more information on the Core Image framework and Core Image filter reference documentation, you can obtain these from the Apple Developer website at:<a class="ulink" href="http://developer.apple.com/library/ios/#documentation/GraphicsImaging/Conceptual/CoreImaging/ci_intro/ci_intro.html"> http://developer.apple.com/library/ios/#documentation/GraphicsImaging/Conceptual/CoreImaging/ci_intro/ci_intro.html</a>.</p></div></div><div class="section" title="Creating a simple Core Image application"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec04"/>Creating a simple Core Image application</h2></div></div></div><p>Apple provides more than 100 image-processing filters with Core Image, so it's easy for you to enable support for image processing within your application, using these built-in features. Image processing involves applying an effect to a photo to either flip or rotate an image, enhance the sharpness of an image, or even red eye from family photographs. Before we can do this, we need to include the Core Image framework as part of our application project.<a id="id234" class="indexterm"/>
</p><p>Before we can proceed, we first need to create our<code class="literal"> CIFilterEffectsproject</code>. To refresh your memory, you can refer to the section that we covered in<a class="link" href="ch01.html" title="Chapter 1. What's New in iOS5"> Chapter 1</a>,<span class="emphasis"><em> What's New in iOS5</em></span>, under the section<span class="emphasis"><em> Creating the MyEmailApp application</em></span>.</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Launch Xcode from the<code class="literal"> /Xcode4/Applications</code> folder.</li><li class="listitem"> Choose<span class="strong"><strong> Create a new Xcode project</strong></span>, or<span class="strong"><strong> File | New Project</strong></span>.</li><li class="listitem"> Select the<span class="strong"><strong> Single View Application</strong></span> template from the list of available templates.</li><li class="listitem"> Select<span class="strong"><strong> iPhone</strong></span> from under the<span class="strong"><strong> Device Family</strong></span> drop-down.</li><li class="listitem"> Click on the<span class="strong"><strong> Next</strong></span> button to proceed to the next step in the wizard.<div class="mediaobject"><img src="graphics/2267EXP_05_12.jpg" alt="Creating a simple Core Image application"/></div></li><li class="listitem"> Enter in<code class="literal"> CIFilterEffects</code> as the name for your project, and then click on the<span class="strong"><strong> Next</strong></span> button to proceed to the next step of the wizard.</li><li class="listitem"> Specify the location where you would like to save your project.</li><li class="listitem"> Click on the<span class="strong"><strong> Save</strong></span> button to continue and display the Xcode workspace environment.<a id="id235" class="indexterm"/></li></ol></div><p>Now that we have created our<code class="literal"> CIFilterEffects</code> project, we now need to add an important framework to our project that will enable us to apply a number of different image effects. To add the Core Image framework to your project, select the<span class="strong"><strong> Project Navigator Group</strong></span>, and then follow these simple steps:<a id="id236" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Click and select your project from the<span class="strong"><strong> Project Navigator</strong></span>.</li><li class="listitem"> Then select your project target from under the<span class="strong"><strong> TARGETS</strong></span> group.</li><li class="listitem">3 Select the<span class="strong"><strong> Build Phases</strong></span> tab.</li><li class="listitem"> Expand the<span class="strong"><strong> Link binary with Libraries</strong></span> disclosure triangle.</li><li class="listitem"> Use the<span class="strong"><strong> +</strong></span> to add the library you want.</li><li class="listitem"> Select the<span class="strong"><strong> CoreImage.framework</strong></span> from the list of available frameworks. You can also search if you can't find the framework you are after, from within the list.</li></ol></div><p>If you are still confused as to how to go about adding the frameworks, take a look at this screenshot, which highlights the areas that you need to select (surrounded by a red rectangle):<a id="id237" class="indexterm"/>
</p><div class="mediaobject"><img src="graphics/2267EXP_05_13.jpg" alt="Creating a simple Core Image application"/></div><p>Now that you have added the<span class="strong"><strong> CoreImage.framework</strong></span> into your project, we need to start building our user interface, which will be responsible for allowing the ability to choose an image and apply the filter effects:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> From the Project Navigator, select and open the<span class="strong"><strong> ViewController.xib</strong></span> file.</li><li class="listitem"> From the<span class="strong"><strong> Object Library</strong></span>, select and drag the (<code class="literal">UIImageView</code>) image view control to our view.</li><li class="listitem"> Resize this control accordingly, so that it takes up the area of the screen.</li><li class="listitem"> From the<span class="strong"><strong> Object Library</strong></span>, select and drag a (<code class="literal">UIButton</code>) Round Rect Button control to our view.</li><li class="listitem"> Resize accordingly and then modify the<span class="strong"><strong> Object</strong></span> Attributes section of the Round Rect Button, and set its title to<code class="literal"> Choose Image</code>.</li><li class="listitem"> Next, from the<span class="strong"><strong> Object Library</strong></span>, select-and-drag a (<code class="literal">UIButton</code>) Round Rect Button control to our view to the right of the<span class="strong"><strong> Choose Image</strong></span> button.</li><li class="listitem"> Resize accordingly, then modify the<span class="strong"><strong> Object Attributes</strong></span> section of the Round Rect Button, and set its title to<code class="literal"> Filter Effects</code>.<a id="id238" class="indexterm"/></li></ol></div><p>If you have followed the steps correctly, your view should look like something shown in the following screenshot. If it doesn't look quite the same as mine, feel free to adjust yours.</p><div class="mediaobject"><img src="graphics/2267EXP_05_14.jpg" alt="Creating a simple Core Image application"/></div><p>As you can see, our form doesn't do much at this stage, and if you were to run this application on the simulator, you would see the controls as placed out on your screen. The following steps will show you how to connect your buttons up to action events that will each perform the task of choosing an image, and apply the filter effects. So let's get started:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Open the<code class="literal"> ViewController.h</code> interface file, and create the following highlighted entries as shown in the following code snippet:<div class="informalexample"><pre class="programlisting">#import &lt;UIKit/UIKit.h&gt;<span class="strong"><strong>
@interface ViewController : UIViewController&lt;UIImagePickerControllerDelegate, UINavigationControllerDelegate, UIAlertViewDelegate, UIActionSheetDelegate&gt; {
UIImageView *imageView;
UIButton *chooseImage;
UIButton *filterEffects;
}
@property (nonatomic, retain) IBOutlet UIImageView *imageView;
@property (nonatomic, retain) IBOutlet UIButton *chooseImage;
@property (nonatomic, retain) IBOutlet UIButton *filterEffects;
-(IBAction) getImage:(id) sender;
-(IBAction) getFilterEffects:(id) sender;</strong></span>
@end
</pre></div></li><li class="listitem"> We need to create an action event. Select the<span class="strong"><strong> Choose Image</strong></span> button, and hold down the<span class="emphasis"><em> Ctrl</em></span> key while you drag this into the<code class="literal"> ViewController.m</code> implementation file class, as shown in the following screenshot:<a id="id239" class="indexterm"/><div class="mediaobject"><img src="graphics/2267EXP_05_15.jpg" alt="Creating a simple Core Image application"/></div></li><li class="listitem"> Specify a name for the action that you want to create. Enter in<code class="literal"> getImage</code> as the name of the action.<a id="id240" class="indexterm"/></li><li class="listitem"> Set the type of event to be<span class="strong"><strong> Touch Up Inside:</strong></span><div class="mediaobject"><img src="graphics/2267EXP_05_16.jpg" alt="Creating a simple Core Image application"/></div></li><li class="listitem"> Click on the<span class="strong"><strong> Connect</strong></span> button to have Xcode create the event.</li><li class="listitem"> We need to create an action event. Select the<span class="strong"><strong> Filter Effects</strong></span> button, and hold down the<span class="emphasis"><em> Ctrl</em></span> key while you drag this into the<code class="literal"> ViewController.m</code> implementation file class, as shown in the following screenshot:<a id="id241" class="indexterm"/><div class="mediaobject"><img src="graphics/2267EXP_05_17.jpg" alt="Creating a simple Core Image application"/></div></li><li class="listitem"> Specify a name for the action that you want to create. Enter in<code class="literal"> getFilterEffects</code> as the name of the action.</li><li class="listitem"> Set the type of event to be<span class="strong"><strong> Touch Up Inside:</strong></span><div class="mediaobject"><img src="graphics/2267EXP_05_18.jpg" alt="Creating a simple Core Image application"/></div></li><li class="listitem"> Click on the<span class="strong"><strong> Connect</strong></span> button to have Xcode create the event.</li></ol></div><p>Now that we have connected up our action events, we now need to synthesize our user-interface controls so that we can access these within our view controller.</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Open the<code class="literal"> ViewController.m</code> implementation file that is located within the<code class="literal"> CIFilterEffects</code> folder, and add the following highlighted statement underneath the<code class="literal"> @implementation</code> statement.<a id="id242" class="indexterm"/><div class="informalexample"><pre class="programlisting">#import "ViewController.h"<span class="strong"><strong>
#import "QuartzCore/QuartzCore.h"</strong></span>
@implementation ViewController<span class="strong"><strong>
@synthesize imageView, chooseImage, filterEffects;</strong></span>
</pre></div></li><li class="listitem">In this code snippet, we are making our implementation file aware of the controls that are located on our user interface form. If these are not declared, we will receive warning messages, which could potentially cause your program to produce some weird results, or may even crash your application on the iOS device.</li><li class="listitem"> Next, we need to add the code into our<code class="literal"> getImage</code> function that will enable us to select an image from the Photo library, and have this displayed into our<code class="literal"> UIViewImage</code> control. Enter the following code snippet for this function:<div class="informalexample"><pre class="programlisting">-(IBAction) getImage:(id) sender {
UIImagePickerController * picker = [[UIImagePickerController alloc] init];
picker.delegate = self;
picker.sourceType = UIImagePickerControllerSourceTypeSavedPhotosAlbum;
[self presentModalViewController:picker animated:YES];
}
- (void)imagePickerController:(UIImagePickerController *) picker didFinishPickingMediaWithInfo:(NSDictionary *)info {
[picker dismissModalViewControllerAnimated:YES];
imageView.image = [info objectForKey:@"UIImagePickerControllerOriginalImage"];
[picker release];
}
</pre></div></li><li class="listitem">This code snippet creates an instance of the UIImagePickerController that will enable us to choose a photo image from the iOS devices photo album. We then modify and initialize the sourceType property of the picker control, and tell it to use the UIImagePickerControllerSourceTypeSavedPhotosAlbum constant. The final statement displays the photo album, and allows you to select an image.</li><li class="listitem"> We then declare another method,<code class="literal"> imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary *)info</code>, that gets called after the image is chosen. The picker is then closed, and the image is then displayed into the<code class="literal"> UIImageView</code> control, which we placed on our user interface. The<code class="literal"> UIImagePickerController</code> class adopts the<code class="literal"> UIImagePickerControllerDelegate</code> and the<code class="literal"> UINavigationControllerDelegate</code> protocols.<a id="id243" class="indexterm"/></li><li class="listitem"> Next, we need to add the code into our<code class="literal"> getFilterEffects</code> function that will enable us to choose a filter effect from a list of options, and have this applied to our loaded image within the<code class="literal"> imageView</code> control.</li><li class="listitem"> Enter in the following code snippet for this function:<div class="informalexample"><pre class="programlisting">// Displays our Action Sheet
- (IBAction)getFilterEffects:(id)sender {
// Define an instance of our Action Sheet
UIActionSheet *actionSheet;
// Initialise our Action Sheet with options
actionSheet=[[UIActionSheet alloc]initWithTitle:@"Available Actions" delegate:self cancelButtonTitle:@"Cancel" destructiveButtonTitle:@"Close" otherButtonTitles: @"Hue Adjust",@"Vibrance",@"Color Invert",@"Straighten Filter",@"Ripple Effect", nil];
[actionSheet showInView:self.view];
[actionSheet release];
}
</pre></div></li><li class="listitem">This code snippet declares, creates, and initializes an <code class="literal">actionSheet</code> variable that sets up a list of filter options that can be chosen from, and then applied to an image. It is worth mentioning that the <code class="literal">UIActionSheet</code> class adopts the protocol <code class="literal">UIActionSheetDelegate</code>. The following screenshot shows you how these options will look when they are displayed:<div class="mediaobject"><img src="graphics/2267EXP_05_19.jpg" alt="Creating a simple Core Image application"/></div></li><li class="listitem"> Next, we need to create the<code class="literal"> actionSheet</code> function that will handle and apply the required filter type to the image, based on the button index chosen within the list.<a id="id244" class="indexterm"/></li><li class="listitem"> Enter in the following code snippet for this function:<div class="informalexample"><pre class="programlisting">// Delegate which handles the processing of the option buttons //selected
- (void)actionSheet:(UIActionSheet *)actionSheet clickedButtonAtIndex:(NSInteger)buttonIndex{}
</pre></div></li><li class="listitem">This code snippet will be used to determine what button has been selected from the action sheet options panel. This is derived by the <code class="literal">buttonIndex</code> property that is passed into this function. In the next section, we will look at how to apply these image effects, based on what has been chosen from within the list.</li></ol></div></div><div class="section" title="Learn how to apply image filter effects using the CIImage class"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec05"/>Learn how to apply image filter effects using the CIImage class</h2></div></div></div><p>The Core Image class is used when you want to apply effects to images. These can be when you want to pixelate an image, or to handle red eye removal from your images. You can use the<code class="literal"> CIImage</code> objects in conjunction with other Core Image classes, such as the<code class="literal"> CIFilter, CIContent, CIVector</code>, and<code class="literal"> CIColor</code> classes. In order to take advantage of the built-in Core Image filters when processing images, you can create<code class="literal"> CIImage</code> objects with data supplied from a variety of sources, including Quartz 2D images and Core Video image buffers, using the<code class="literal"> CVImageBufferRef</code>.<a id="id245" class="indexterm"/>
</p><p>The<code class="literal"> CIImage</code> object has image data associated with it, but it is not an image. A<code class="literal"> CIImage</code> object has all the information necessary to produce an image, but Core Image doesn't actually render an image until it is told to do so. This method allows Core Image to operate as efficiently as possible. When using the<code class="literal"> CIImage</code> class, this contains a number of parameters, which are explained in the following table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p><span class="strong"><strong>CIImage class parameters</strong></span></p>
</th><th style="text-align: left" valign="bottom">
<p><span class="strong"><strong>Description</strong></span></p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Filter Category</p>
</td><td style="text-align: left" valign="top">
<p>This specifies the type of effect (blur, distortion, generator, and so forth) or its intended use (still images, video, non-square pixels, and so on). A filter can be a member of more than one category.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Display Name</p>
</td><td style="text-align: left" valign="top">
<p>This is the name that should be shown in the user interface</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Filter Name</p>
</td><td style="text-align: left" valign="top">
<p>This is the name you use to access the filter programmatically.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Input Parameters</p>
</td><td style="text-align: left" valign="top">
<p>These can contain one or more input parameters that let you control how processing is done.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Attribute Class</p>
</td><td style="text-align: left" valign="top">
<p>Every input parameter that you create contains an attribute class that specifies its data type, such as NSNumber. An input parameter can optionally have other attributes, such as its default value, the allowable minimum and maximum values, the display name for the parameter, and any other attributes that are described in CIFilter.</p>
</td></tr></tbody></table></div><p>If you take, for instance, the color monochrome filter, this contains three input parameters: the image to process, a monochrome color, and the color intensity. You supply the image and have the option to set a color and color intensity.</p><p>Most filters, including the color monochrome filter, have default values for each non-image input parameter. Core Image uses the default values to process your image, if you choose not to supply your own values for the input parameters. Filter attributes are stored as key-value pairs.</p><p>The<span class="strong"><strong> key</strong></span> is a constant that identifies the attribute, and the<span class="strong"><strong> value</strong></span> is the setting associated with the key. Core Image attribute values are typically one of the following data types:<a id="id246" class="indexterm"/>
</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Strings:</strong></span> These are used for things, such as display names.<a id="id247" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Floating-point numbers:</strong></span> They are used to specify scalar values, such as intensity levels and radii.<a id="id248" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Vectors:</strong></span> They can have two, three, or four elements, each of which is a floating-point number. These are used to specify positions, areas, and color values.<a id="id249" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Colors:</strong></span> They specify color values and a color space to interpret the values in.<a id="id250" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Images:</strong></span> They are lightweight objects that specify images.<a id="id251" class="indexterm"/></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Transforms:</strong></span> They specify an affine transformation to apply to an<code class="literal"> image.CIContext</code>.</li></ul></div><p>In the next section, we will take a look at how we can use some of these techniques when applying the various types of color effects to our<code class="literal"> CIFilterEffects</code> application, when a filter type has been selected from our action sheet list of options.<a id="id252" class="indexterm"/>
</p><p>Open the<code class="literal"> ViewController.m</code> implementation file that is located within the<code class="literal"> CIFilterEffects</code> folder, locate the<code class="literal"> - (void)actionSheet:(UIActionSheet *)actionSheet clickedButtonAtIndex:(NSInteger)buttonIndex</code>, and add the following code statement after the function declaration.</p><div class="informalexample"><pre class="programlisting">CIContext *context = [CIContext contextWithOptions:nil];
CIImage *cImage = [CIImage imageWithCGImage:[imageView.image CGImage]];
CIImage *result;
</pre></div><p>In this code snippet, we declare a<code class="literal"> CIContext</code> variable context. This variable will be used for rendering the image object<code class="literal"> cImage</code> to the view. We then declare a cImage variable object of type<code class="literal"> CIImage</code>, which contains a pointer to the image within our<code class="literal"> imageView</code>. Finally, we then declare a<code class="literal"> CIImage result</code> variable that will be used to apply the image filter changes, and then output this modified image to the<code class="literal"> imageView</code> control.</p><div class="section" title="Color effects"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec01"/>Color effects</h3></div></div></div><p>In this section, we will look at applying each of the options displayed within our action sheet pop-up to our image of the Apple logo, which we have chosen from our iOS Photo library.<a id="id253" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Open the<code class="literal"> ViewController.m</code> implementation file that is located within the<code class="literal"> CIFilterEffects</code> folder.<a id="id254" class="indexterm"/></li><li class="listitem"> Next, locate the<code class="literal"> - (void)actionSheet:(UIActionSheet *)actionSheet clickedButtonAtIndex:(NSInteger)buttonIndex</code>, and add the following code statement after the variable declarations that we applied in the previous code snippet:<div class="informalexample"><pre class="programlisting">// Handle when the Hue Adjust Filter option has been chosen.
if (buttonIndex == 1){
CIFilter *hueAdjust = [CIFilter filterWithName:@"CIHueAdjust"];
[hueAdjust setDefaults];
[hueAdjust setValue: cImage forKey: @"inputImage"];
[hueAdjust setValue: [NSNumber numberWithFloat: 2.094] forKey: @"inputAngle"];
result = [hueAdjust valueForKey: @"outputImage"];
}
</pre></div></li><li class="listitem">In this code snippet, we start by declaring a <code class="literal">CIFilter</code> variable called <code class="literal">hueAdjust</code>. This will be used to denote the type of filter that we want to apply to our image.</li><li class="listitem"> In the next step, we assign the variable<code class="literal"> cImage</code> of type<code class="literal"> CIImage</code>, which points to the chosen image within our<code class="literal"> UIImageView</code> control, and assign this to be the<code class="literal"> inputImage</code>.</li></ol></div><p>Next, we assign the level of hue to apply to the image, by setting the value of the<code class="literal"> inputAngle</code> property. Once we have done all of this, we then apply the<code class="literal"> hue Adjustment</code> to the image, and return this to our<code class="literal"> UIImage</code> result, based on the<code class="literal"> outputImage</code> property, and then output this back to our<code class="literal"> UIImageView</code> control.<a id="id255" class="indexterm"/>
</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note27"/>Note</h3><p>When setting the values of the<code class="literal"> inputAngle</code> property, these have a starting range from a minimum value of<code class="literal"> -3.14</code> to a maximum value of<code class="literal"> 3.14</code>. There is also a default value of<code class="literal"> 0.00</code>.</p></div><p>The following screenshot displays the image output with the Hue Saturation applied. You will notice that it changes the overall hue or tint of the source pixels:</p><div class="mediaobject"><img src="graphics/2267EXP_05_20.jpg" alt="Color effects"/></div><p>Next, we will take a look at the<span class="strong"><strong> Vibrance</strong></span> option and see what happens when this Core Image filter has been chosen from the list of options within our action sheet.<a id="id256" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Open the<code class="literal"> ViewController.m</code> implementation file that is located within the<code class="literal"> CIFilterEffects</code> folder, and add the following code statement underneath the previous code block that we applied in the previous code snippet:<div class="informalexample"><pre class="programlisting">// Handle when the Vibrance Filter option has been chosen.
else if (buttonIndex == 2){
CIFilter *vibrance = [CIFilter filterWithName:@"CIVibrance"];
[vibrance setDefaults];
[vibrance setValue: cImage forKey: @"inputImage"];
[vibrance setValue: [NSNumber numberWithFloat: 1.00] forKey: @"inputAmount"];
result = [vibrance valueForKey: @"outputImage"];
}
</pre></div></li><li class="listitem">In this code snippet, we start by declaring a <code class="literal">CIFilter</code> variable called <code class="literal">vibrance</code>. This will be used to denote the type of filter we want to apply to our image.</li><li class="listitem"> In the next step, we assign the variable<code class="literal"> cImage</code> of type<code class="literal"> CIImage</code>, which points to the chosen image within our<code class="literal"> UIImageView</code> control, and assign this to be the<code class="literal"> inputImage</code>. Finally, we assign the level of saturation to apply to the image, by setting the value of the<code class="literal"> inputAmount</code> property.<a id="id257" class="indexterm"/></li></ol></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note28"/>Note</h3><p>When setting the values of the<code class="literal"> inputAmount</code> property, these have a starting range from a minimum value of<code class="literal"> -1.00</code> to a maximum value of<code class="literal"> 1.00</code>. There is also a default value of<code class="literal"> 0.00</code>.</p></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">The following screenshot displays the image output with the Vibrance saturation applied. You will notice that it reduces the image colors, while keeping a good balance of skin tones:</li></ul></div><div class="mediaobject"><img src="graphics/2267EXP_05_21.jpg" alt="Color effects"/></div><p>Next, we will take a look at the<span class="strong"><strong> Color Invert</strong></span> option and see what happens when this Core Image filter has been chosen from the list of options within our actionsheet.<a id="id258" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Open the<code class="literal"> ViewController.m</code> implementation file that is located within the<code class="literal"> CIFilterEffects</code> folder, and add the following code statement underneath the previous code block that we applied in the previous code snippet.<a id="id259" class="indexterm"/><div class="informalexample"><pre class="programlisting">// Handle when the Color Invert option has been chosen.
else if (buttonIndex == 3){
CIFilter *invert = [CIFilter
filterWithName:@"CIColorInvert"];
[invert setDefaults];
[invert setValue: cImage forKey:@"inputImage"];
result = [invert valueForKey:@"outputImage"];
}
</pre></div></li><li class="listitem">In this code snippet, we start by declaring a <code class="literal">CIFilter</code> variable called <code class="literal">invert</code>. This will be used to denote the type of filter we want to apply to our image.</li><li class="listitem"> In the next step, we assign the variable<code class="literal"> cImage</code> of type<code class="literal"> CIImage</code>, which points to the chosen image within our<code class="literal"> UIImageView</code> control, and assign this to be the<code class="literal"> inputImage</code>.<a id="id260" class="indexterm"/><p>The following screenshot displays the image output with the Color Invert filter applied. You will notice that the image colors have been inverted to show more of a negative image:
</p></li></ol></div><div class="mediaobject"><img src="graphics/2267EXP_05_22.jpg" alt="Color effects"/></div><p>Next, we will take a look at the<span class="strong"><strong> Straighten Filter</strong></span> option and see what happens when this Core Image filter has been chosen from the list of options within our actionsheet.<a id="id261" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Open the<code class="literal"> ViewController.m</code> implementation file that is located within the<code class="literal"> CIFilterEffects</code> folder, and add the following code statement underneath the previous code block that we applied in the previous code snippet.<div class="informalexample"><pre class="programlisting">// Handle when the Straighten Filter option has been chosen.
else if (buttonIndex == 4){
CIFilter *straightenFilter = [CIFilter filterWithName:@"CIStraightenFilter"];
[straightenFilter setDefaults];
[straightenFilter setValue: cImage forKey:@"inputImage"];
[straightenFilter setValue: [NSNumber numberWithFloat: 3.10] forKey: @"inputAngle"];
result = [straightenFilter valueForKey:@"outputImage"];
}
</pre></div></li><li class="listitem">In this code snippet, we start by declaring a CIFilter variable called straightenFilter. This will be used to denote the type of filter we want to apply to our image.</li><li class="listitem"> In the next step, we assign the variable<code class="literal"> cImage</code> of type<code class="literal"> CIImage</code>, which points to the chosen image within our<code class="literal"> UIImageView</code> control, and assign this to be the<code class="literal"> inputImage</code>. Finally, we assign the angle level rotation to apply to the image, by setting the value of the<code class="literal"> inputAngle</code> property.</li></ol></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note29"/>Note</h3><p>When setting the values of the<code class="literal"> inputAngle</code> property, these have a starting range from a minimum value of -3.14 to a maximum value of<code class="literal"> 3.14</code>. There is also a default value of<code class="literal"> 0.00</code>.</p></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none">The following screenshot displays the image output with the Straighten filter applied. You will notice that it rotates the source image by the specified angle in radians. The image is then scaled and cropped, so that the rotated image fits within the view:</li></ul></div><div class="mediaobject"><img src="graphics/2267EXP_05_23.jpg" alt="Color effects"/></div><p>Next, we need to add the code that will be used to output the updated image once this has been applied based on our Core Image filters.</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Open the<code class="literal"> ViewController.m</code> implementation file that is located within the<code class="literal"> CIFilterEffects</code> folder, and add the following code statement underneath the previous code block that we applied in the previous code snippet:<div class="informalexample"><pre class="programlisting">// Only process when button index is based on the list of //options.Ignore the Close and Cancel buttons and then display
// our update image to our UIImageView Control.
if (buttonIndex != 0 &amp;&amp; buttonIndex != 5 &amp;&amp; buttonIndex != 6) {
self.imageView.image = [UIImage imageWithCGImage:[context createCGImage:result fromRect:CGRectMake(0, 0, self.imageView.image.size.width, self.imageView.image.size.height)]];
}
</pre></div></li><li class="listitem">In this code snippet, we start by checking to ensure that we are not processing our <span class="strong"><strong>Close</strong></span> and <span class="strong"><strong>Cancel</strong></span> buttons, as those buttons do not apply the core image filters to the image. This is a general way of safeguarding our application to prevent it from crashing.<p>Next, we use the <code class="literal">imageWithCGImage</code> method to create and return an image object representing the specified Quartz image, then displaying this image back to our <code class="literal">UIImageView imageView</code>&gt; control, and setting it to be displayed to the width and height of the image view.
<a id="id262" class="indexterm"/>
</p></li></ol></div><p>In the next section, we will take a look at how we can apply transition effects to an image while making use of the Quartz Core framework.</p></div><div class="section" title="Transitions"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec02"/>Transitions</h3></div></div></div><p>
<span class="strong"><strong>Transitions</strong></span> are typically used to apply some sort of effect to an image. These effects are rendered over time and require that you set up a timer event. In this section, we will be adding some code to our<code class="literal"> CIFilterEffects</code> example application to show one of the easiest ways in which we can apply a water ripple effect to an image.<a id="id263" class="indexterm"/>
</p><p>Fortunately, you don't need to worry as there is already a ripple effect component that comes part of the QuartzCore framework, and this will take advantage of the graphics hardware acceleration when rendering this effect.</p><p>In order for us to start using transitions within our application, we will need to add an important framework to our project that will enable us to apply a number of different image effects.</p><p>To add the QuartzCore framework to your project, select the<span class="strong"><strong> Project Navigator Group</strong></span>, and then follow these simple steps:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Click and select your project from the<span class="strong"><strong> Project Navigator</strong></span>.</li><li class="listitem"> Then select your project target from under the<span class="strong"><strong> TARGETS</strong></span> group.</li><li class="listitem"> Select the<span class="strong"><strong> Build Phases</strong></span> tab.</li><li class="listitem"> Expand the<span class="strong"><strong> Link binary with Libraries</strong></span> disclosure triangle.</li><li class="listitem"> Finally, use the<span class="strong"><strong> +</strong></span> to add the library you want.</li><li class="listitem"> Select the<span class="strong"><strong> QuartzCore.framework</strong></span> from the list of available frameworks. You can also search if you can't find the framework you are after, from within the list.</li></ol></div><p>If you are still confused how to go about adding the frameworks, take a look at this screenshot, which highlights the areas that you need to select (surrounded by a rectangle):</p><div class="mediaobject"><img src="graphics/2267EXP_05_24.jpg" alt="Transitions"/></div><p>Now that we have added the<code class="literal"> QuartzCore.framework</code> into your project, we can start to add the necessary code to our example project, to apply a water rippling effect.<a id="id264" class="indexterm"/>
</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"> Open the<code class="literal"> ViewController.m</code> implementation file that is located within the<code class="literal"> CIFilterEffects</code> folder, and add the following code statement underneath the Straighten filter code block:<div class="informalexample"><pre class="programlisting">else if (buttonIndex == 5){
CATransition *animation = [CATransition animation];
[animation setDelegate:self];
[animation setDuration:3.0f];
[animation setTimingFunction:UIViewAnimationCurveEaseInOut];
[animation setType:@"rippleEffect" ];
[self.view.layer addAnimation:animation forKey:NULL];
}
</pre></div></li><li class="listitem">In this code snippet, we start by declaring a variable called <code class="literal">animation</code> that will be responsible for handling the transition animations for our <code class="literal">UIView</code> layer. In the next step, we specify the duration of our ripple effect that will be used to define how long, in seconds, a single iteration of an animation will take to display.<p>Next, we set up a timing function. This will be used to specify <code class="literal">UIViewAnimationCurveEaseInOut</code> as the type of animation that we want to use. This causes the animation to start off slowly, then accelerate through the middle of its duration, and then begin to slow-down towards the end of its iteration.
<a id="id265" class="indexterm"/>
</p><p>This is the default curve for most animations. In the next step, we specify that the type of animation we want to use is the <code class="literal">rippleEffect</code> transition effect. Finally, we then apply the animation effect to our view. The following screenshot displays the output with the water rippling effect applied. You will notice how it curves from the inside out, more like a vacuum effect:
<a id="id266" class="indexterm"/>
</p></li></ol></div><div class="mediaobject"><img src="graphics/2267EXP_05_25.jpg" alt="Transitions"/></div><p>As you can see, by using both the Core Image and QuartzCore frameworks, you can create some fantastic visual effects within your applications, and bring them to life.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note30"/>Note</h3><p>For more information on Core Image and the QuartzCore frameworks, please refer to the following link:<a class="ulink" href="http://developer.apple.com/library/mac/#documentation/GraphicsImaging/Conceptual/CoreImaging/ci_intro/ci_intro.html"> http://developer.apple.com/library/mac/#documentation/GraphicsImaging/Conceptual/CoreImaging/ci_intro/ci_intro.html</a>.</p><p>For more information on the Core Image filters, please refer to the following link:<a class="ulink" href="http://developer.apple.com/library/mac/#documentation/GraphicsImaging/Reference/CoreImageFilterReference/Reference/reference.html"> http://developer.apple.com/library/mac/#documentation/GraphicsImaging/Reference/CoreImageFilterReference/Reference/reference.html</a>.</p></div></div></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec02"/>Summary</h1></div></div></div><p>In this chapter, we learned about the AirPlay and Core Image frameworks, and looked at how we can implement these into our applications to output them to an external device, such as Apple TV.</p><p>We then learned about the Core Image filters class, and how we can apply the different image filter effects to enhance images through the different built-in filters, such as color effects. We then familiarized ourselves with the QuartzCore framework, and looked at how we can use this framework, using the built-in filters for distortions and transition effects, to apply a water ripple effect to an image.</p><p>In the next chapter, we will learn about the improvements that have been made to the Xcode development tools, and take a look at<span class="strong"><strong> Automatic Reference Counting</strong></span> (ARC). This is the latest addition to the LLVM compiler. We will also be taking a look at improvements made to Interface Builder, the iOS Location simulator, and the set of debugging tools for OpenGL ES.</p></div></body></html>