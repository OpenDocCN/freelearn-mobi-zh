<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Google Play Services"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Google Play Services</h1></div></div></div><p>Now that we have become familiar with the use of components on layouts, it is time to start thinking about extra functionality. Google Play services give you features, such as Google Maps, Google+, and more, to attract users. What are all the available features? How can you add these features to your application? What are the Android version requirements to use Google Play services?</p><p>This chapter focuses on the creation, integration, and use of Google Play services using Android Studio. You will learn what Google services are available. You will also learn about the standard authorization API that provides a safe way to grant and receive access tokens to Google Play services. Then, you will learn about the limitations of these services and also the benefits of using them.</p><p>These are the topics we'll be covering in this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Existing Google Services</li><li class="listitem" style="list-style-type: disc">Adding Google Play Services from the IDE</li><li class="listitem" style="list-style-type: disc">Integrating Google Play Services in your app</li><li class="listitem" style="list-style-type: disc">Understanding automatic updates</li><li class="listitem" style="list-style-type: disc">Using Google services in your app</li></ul></div><div class="section" title="How Google Play services work"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec41"/>How Google Play services work</h1></div></div></div><p>When <a class="indexterm" id="id276"/>Google previewed Google Play services at Google I/O 2012, it said that the platform "consists of a services component that runs on<a class="indexterm" id="id277"/> the device and a thin client library that you package with your app" (<a class="ulink" href="https://developers.google.com/events/io/2012/">https://developers.google.com/events/io/2012/</a>).</p><p>This means that Google Play services work thanks to two main components:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google Play services client library</strong></span>: The Google Play services client library includes<a class="indexterm" id="id278"/> interfaces to each Google service used by your app. The library is included when you pack your app and it allows your users to authorize the app with access to these services using their credentials. The client library is upgraded from <a class="indexterm" id="id279"/>time to time by Google, adding new features and services. You may upgrade the library in your app through an update to your app, although this is not necessary if you are not including any of the new features.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google Play services APK</strong></span>: The Google Play services APK runs as a background <a class="indexterm" id="id280"/>service in the Android operating system. Using the client library, your app accesses this service, which carries out the actions during runtime. The APK is not guaranteed to be installed on all devices. If the device does not come with the APK installed, you can get it from the Google Play store.</li></ul></div><p>In this <a class="indexterm" id="id281"/>way, Google manages to separate the runtime of their services from the implementation you do as a developer, so you do not need to upgrade your application every time Google Play services are upgraded.</p><p>The Google Play services APK is automatically updated by the Google Play store. Any Android device running Android 2.3 or newer is ready to install any application that uses Google Play services.</p></div></div>
<div class="section" title="Available services"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec42"/>Available services</h1></div></div></div><p>Google Play<a class="indexterm" id="id282"/> services let you easily add more features to attract users on a wide range of devices, while using well-known features powered by Google. Using these services, you can add new revenue sources, manage the distribution of the app, access statistics, learn about your application users' habits, and improve your application with easy-to-implement Google features such as Maps or Google's social network, Google+. Some of the services are explained as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google+</strong></span>: Using the <a class="indexterm" id="id283"/>Google+ Platform for Android, you can authenticate the user of your app. Once they are authenticated, you can also access their public profile and social graph, among other actions.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google Analytics</strong></span>: By integrating this service, you can allow your app to send information to <a class="indexterm" id="id284"/>Google Analytics. It is a tool that collects the metrics of your app. Metrics can help you to learn how users use your app by tracking events, like the number of taps on a button or by tracking the visualization of screens and components.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google App Indexing</strong></span>: By integrating this service, you can make the content <a class="indexterm" id="id285"/>of your app available to the Google app index. This will make your app easier for users to find.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google Cast</strong></span>: By integrating this service, you can make you app interact with Google Cast <a class="indexterm" id="id286"/>devices, such as Chromecast or Android TV.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google Cloud Messaging</strong></span>: Using <span class="strong"><strong>Google Cloud Messaging</strong></span> (<span class="strong"><strong>GCM</strong></span>) for Android, you <a class="indexterm" id="id287"/>can exchange data between the app running in an Android-based device and your server. Using GCM, your server can start the communication with your app, which can generate push notifications to the user.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google Drive</strong></span>: Using the <a class="indexterm" id="id288"/>Google Drive API, you can enable your application to access and manage your users' files stored in their <a class="indexterm" id="id289"/>Google Drive account.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google Fit</strong></span>: Using the <a class="indexterm" id="id290"/>Google Fit APIs, you can interact <a class="indexterm" id="id291"/>with <span class="strong"><strong>Bluetooth Low Energy</strong></span> (<span class="strong"><strong>BLE</strong></span>) devices (a heart rate monitor, a cycling sensor, or a pedometer), access data, or manage user activity in Google Fit.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google In-app Billing</strong></span>: Using Google Play In-app Billing makes it possible for you to <a class="indexterm" id="id292"/>sell digital content from your apps. You can use this service to sell one-time billing or temporal subscriptions to premium services and features.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google Location</strong></span>: By<a class="indexterm" id="id293"/> integrating the location APIs, you can make your application location aware.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google Maps</strong></span>: By<a class="indexterm" id="id294"/> integrating the Google Maps API, you can use the maps provided by Google in your app and customize them.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google Mobile Ads</strong></span>: Using <a class="indexterm" id="id295"/>the Google Mobile Ads API, you can add AdMob banner ads to your app.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google Nearby</strong></span>: By<a class="indexterm" id="id296"/> integrating the Google Nearby service, you can make your app interact with nearby devices and execute actions based on proximity.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google Panorama Viewer</strong></span>: By integrating this service, you can enable the user to see a <a class="indexterm" id="id297"/>360-degree panorama picture.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google Places</strong></span>: By<a class="indexterm" id="id298"/> integrating the Google Places API, you can use the places information provided by Google in your app.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google Play Game services</strong></span>: Using the Google Play Game services, you can improve your<a class="indexterm" id="id299"/> gaming with a more social experience, such achievements, leaderboards, game gifts, or player stats.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google Sign-In</strong></span>: By integrating Google Sign-In, users can securely register into your<a class="indexterm" id="id300"/> app using their Google account.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Google Wallet</strong></span>: By integrating Google Wallet, you can store objects such as gift cards or<a class="indexterm" id="id301"/> loyalty programs in the cloud and <a class="indexterm" id="id302"/>use them to pay in stores or online.</li></ul></div></div>
<div class="section" title="Adding Google Play services to Android Studio"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec43"/>Adding Google Play services to Android Studio</h1></div></div></div><p>The first<a class="indexterm" id="id303"/> thing we need to know is what we <a class="indexterm" id="id304"/>need to add to our Android Studio. You just learned that the APK is available in the Google Play store and it is the actual runtime of the services. We, as developers, only need this package in our testing device while debugging our application. What we need to add to Android Studio is the Google Play services client library.</p><p>This library has to be declared as a dependency to your application, so perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">build.gradle</code> file for your application module (<code class="literal">/app/build.gradle</code>).</li><li class="listitem">Add a new dependency to the build of your app by typing the following line inside the <code class="literal">dependencies</code> block:<div class="informalexample"><pre class="programlisting">dependencies {
   …
   <span class="strong"><strong>compile 'com.google.android.gms:play-services:8.4.0'</strong></span>
}</pre></div><p>The latest Google Play Services version is 8.4 (December 2015). When new updates of the library are published, you will need to update the version number in the <code class="literal">build.gradle</code> file.</p></li><li class="listitem">Navigate to <span class="strong"><strong>Tools</strong></span> | <span class="strong"><strong>Android</strong></span> | <span class="strong"><strong>Sync Project with Gradle Files</strong></span> to synchronize your project with the new dependency on Google Play services.</li><li class="listitem">Finally, add it to the manifest file of your application inside the application block:<div class="informalexample"><pre class="programlisting">&lt;meta-data android:name="com.google.android.gms.version"
  android:value="@integer/google_play_services_version" /&gt;</pre></div><p>You should have the library inside the <code class="literal">build</code> folder of your application project at <code class="literal">app/build/intermediates/exploded-aar/com.google.android.gms/</code>, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Adding Google Play services to Android Studio" src="graphics/B05459_07_01.jpg"/></div></li></ol></div><p>As you can<a class="indexterm" id="id305"/> notice both in the previous<a class="indexterm" id="id306"/> screenshot and in your project, all the Google Play services have been included: <code class="literal">play-services-ads</code>, <code class="literal">play-services-analytics</code>, <code class="literal">play-services-appindexing</code>, and so on. This could be completely unnecessary if you only need some of the services and you don't want to include all of them. Since Google Play services Version 6.5, you can add the services independently.</p><p>For example, if you only want to add the Google Maps and the Google Places APIs, replace the dependency that we had before in the <code class="literal">build.gradle</code> file with the following two dependencies:</p><div class="informalexample"><pre class="programlisting">dependencies {
   …
   <span class="strong"><strong>compile 'com.google.android.gms:play-services-maps:8.4.0'</strong></span>
<span class="strong"><strong>   compile 'com.google.android.gms:play-services-location:8.4.0'</strong></span>
}</pre></div><p>Navigate<a class="indexterm" id="id307"/> to <span class="strong"><strong>Tools</strong></span> | <span class="strong"><strong>Android</strong></span> | <span class="strong"><strong>Sync Project with Gradle Files</strong></span> to synchronize your project. Inside the <code class="literal">build</code> folder of your<a class="indexterm" id="id308"/> application project at <code class="literal">app/build/intermediates/exploded-aar/com.google.android.gms/</code>, now you can only find the Google Maps and the Google Places APIs, as shown in the next screenshot:</p><div class="mediaobject"><img alt="Adding Google Play services to Android Studio" src="graphics/B05459_07_02.jpg"/></div><p>If you still have all the <code class="literal">play-services</code> folders, clean the project by navigating to <span class="strong"><strong>Build</strong></span> | <span class="strong"><strong>Clean Project</strong></span>.</p><p>Although we recommend using Gradle dependencies to include the Google Play services in your app, there is another way to use them in your app. You can download and install the Google Play services library in our system. This library is distributed through the Android SDK Manager. Now, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>Tools</strong></span> | <span class="strong"><strong>Android</strong></span> | <span class="strong"><strong>SDK Manager</strong></span>. Open the standalone SDK Manager. We can find Google Play services in the packages list under the <code class="literal">Extras</code> folder.</li><li class="listitem">Select<a class="indexterm" id="id309"/> the <span class="strong"><strong>Google Play services</strong></span> checkbox <a class="indexterm" id="id310"/>and click on the <span class="strong"><strong>Install 1 package...</strong></span> button:<div class="mediaobject"><img alt="Adding Google Play services to Android Studio" src="graphics/B05459_07_03.jpg"/></div><p>Performing these actions will add the library project into the location of our SDK installation folder, <code class="literal">/sdk/extras/google/google_play_services/</code>. You can check the exact path by hovering the mouse over the <span class="strong"><strong>Google Play services</strong></span> row in the SDK manager and looking at the tool tip.</p></li><li class="listitem">Navigate to the folder to examine its content. The <code class="literal">samples</code> folder contains some sample projects, for example, projects of Google Analytics (<code class="literal">analytics/</code>), authentication service (<code class="literal">auth/</code>), Google Cast (<code class="literal">cast/</code>), Google Drive (<code class="literal">drive/</code>), Google Maps (<code class="literal">maps/</code>), Google Panorama (<code class="literal">panorama/</code>), or Google Wallet (<code class="literal">wallet/</code>). The <code class="literal">libproject/</code> folder contains the Google Play services library project. The <code class="literal">google-play-services.jar</code> file is placed in this folder at <code class="literal">libproject/google-play-services_lib/libs/google-play-services.jar</code>. The <code class="literal">docs/</code> folder contains the documentation.</li><li class="listitem">Add this<a class="indexterm" id="id311"/> JAR file to your <a class="indexterm" id="id312"/>project simply by dragging it into the <code class="literal">libs/</code> folder.</li><li class="listitem">Select the JAR file and right-click on it.</li><li class="listitem">Select the <span class="strong"><strong>Add as Library...</strong></span> option, as highlighted in the next screenshot:<div class="mediaobject"><img alt="Adding Google Play services to Android Studio" src="graphics/B05459_07_04.jpg"/></div><p>Select your application module in the <span class="strong"><strong>Create Library</strong></span> dialog and click on <span class="strong"><strong>OK</strong></span>. You now have the <code class="literal">google-play-services.jar</code> available in your project libraries, under the <code class="literal">libs/</code> folder, and you will now be able to reference Google Play services from your code.</p></li><li class="listitem">Finally, you <a class="indexterm" id="id313"/>will need to add<a class="indexterm" id="id314"/> the library to your Gradle's build file. To do this, just edit the <code class="literal">build.gradle</code> file under <code class="literal">MyApplication/</code> and add the following line in the <code class="literal">dependencies</code> section:<div class="informalexample"><pre class="programlisting">dependencies {
   …
  compile files('libs/google-play-services.jar')
}</pre></div></li></ol></div></div>
<div class="section" title="Google Maps Android API"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec44"/>Google Maps Android API</h1></div></div></div><p>Google Maps Android API allows the users of your application to explore maps available through a <a class="indexterm" id="id315"/>Google service. It offers functionalities such as 3D maps, indoor and satellite maps, efficient caching and drawing using vector-based technology, and animated transitions through the map. Add the following dependency, to your Gradle's build file, to include the Google Maps API package in your app:</p><div class="informalexample"><pre class="programlisting">compile 'com.google.android.gms:play-services-maps:8.4.0'</pre></div><p>Let's create a new activity, <span class="strong"><strong>Google Maps Activity</strong></span>, to examine the most important generated classes. Navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New</strong></span> | <span class="strong"><strong>Activity</strong></span> | <span class="strong"><strong>Gallery...</strong></span>. In the <span class="strong"><strong>Add an Activity to Mobile</strong></span> dialog, select a <span class="strong"><strong>Google Maps Activity</strong></span> and click on <span class="strong"><strong>Next</strong></span>. In the <span class="strong"><strong>Customize the Activity</strong></span> step, leave the default values like they are in the screenshot: <code class="literal">MapsActivity</code> for <span class="strong"><strong>Activity Name</strong></span>, <code class="literal">activity_maps</code> for <span class="strong"><strong>Layout Name</strong></span>, and <code class="literal">Map</code> for <span class="strong"><strong>Title</strong></span>:</p><div class="mediaobject"><img alt="Google Maps Android API" src="graphics/B05459_07_05.jpg"/></div><p>Click on <span class="strong"><strong>Finish</strong></span>. Three new files were created: the activity <code class="literal">MapsActivity.java</code> (at <code class="literal">src/main/java</code>), the layout <code class="literal">activity_maps.xml</code> (at <code class="literal">src/main/res/layout</code>), and one resource file, <code class="literal">google_maps_api.xml</code> (at <code class="literal">/src/debug/res/values</code> and at <code class="literal">/src/release/res/values</code>). This resource file contains the Google Maps API Key that you<a class="indexterm" id="id316"/> need to be able to use the Google Maps API. Open the link provided in the resource file and follow the directions. Once you have created your key, paste it in the resource file, replacing the <code class="literal">YOUR_KEY_HERE</code> text.</p><p>Open the <code class="literal">MapsActivity</code> class under <code class="literal">src/main/java/</code>. Check the <code class="literal">import</code> clauses in the activity and notice that the <code class="literal">com.google.android.gms.maps</code> package contains the Google Maps Android API classes. The activity has a <code class="literal">private</code> variable of class type <code class="literal">GoogleMap</code>, which is the main class of the API, and this is the entry point for all the methods related to a map. You may change the theme colors and the icons of your map to match your application style. You can also customize your map by adding markers to it. To add a simple marker, you can use the <code class="literal">addMarker</code> method of the <code class="literal">GoogleMap</code> class. Examine the <code class="literal">onMapReady</code> method in <code class="literal">MapsActivity</code> to see the following code:</p><div class="informalexample"><pre class="programlisting">LatLng sydney = new LatLng(-34, 151);
mMap.addMarker(new MarkerOptions().position(sydney).title("Marker in Sydney"));</pre></div><p>The <code class="literal">addMarker</code> method has a <code class="literal">MarkerOptions</code> object as a parameter. Using the <code class="literal">position</code> method, we indicate the coordinates of the marker on the map and use the <code class="literal">title</code> method, we can add a custom string to show up on the marker.</p><p>To add a<a class="indexterm" id="id317"/> map into a layout, we can use the <code class="literal">MapView</code> class, which extends the <code class="literal">View</code> class and displays a map. However, the easiest way to place a map in an application is using a <code class="literal">MapFragment</code> object. A <code class="literal">fragment</code> represents a piece of the user interface or behavior that can be embedded in an activity. A <code class="literal">fragment</code> is a reusable module.</p><p>The <code class="literal">MapFragment</code> class wraps a view of a map to handle the necessary life cycle requirements of a component automatically. To see this code in use, open the layout associated with the <code class="literal">MapsActivity</code> class. This is the <code class="literal">activity_maps.xml</code> file found under <code class="literal">/res/layout/</code>. The <code class="literal">MapFragment</code> class extends the <code class="literal">Fragment</code> class, so it can be added to a layout by adding the following XML code:</p><div class="informalexample"><pre class="programlisting">&lt;fragment
    android:id="@+id/map"
	android:name="com.google.android.gms.maps.SupportMapFragment"
    android:layout_width="match_parent"
    android:layout_height="match_parent" /&gt;</pre></div><p>Finally, we need the code to obtain the <code class="literal">GoogleMap</code> object from the fragment. We can find the <code class="literal">Fragment</code> map using the <code class="literal">findFragmentById</code> method, and then we get the map from the <code class="literal">Fragment</code> using the <code class="literal">getMap</code> method:</p><div class="informalexample"><pre class="programlisting">MapFragment mapFragment = (MapFragment)  
   getFragmentManager().findFragmentById(R.id.map);</pre></div><p>You can see an example of this code in the <code class="literal">MapsActivity</code> class in the <code class="literal">onCreate</code> method.</p><p>The last important class to cover is the <code class="literal">GoogleMapOptions</code> class, which can be used if you create your map programmatically. It defines the configuration for a map. You can also modify the initial state of a map by editing the layout XML code or using the setters' methods of the map from your activity code. Here are some interesting options that are available:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">mapType</code>: This<a class="indexterm" id="id318"/> specifies the type of a map. Its value can be <code class="literal">none</code>, <code class="literal">normal</code>, <code class="literal">hybrid</code>, <code class="literal">satellite</code>, or <code class="literal">terrain</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">compassEnabled</code>: This <a class="indexterm" id="id319"/>defines whether compass controls are enabled or disabled.</li><li class="listitem" style="list-style-type: disc"><code class="literal">zoomControlsEnabled</code>: This <a class="indexterm" id="id320"/>defines whether zoom controls are enabled or disabled.</li><li class="listitem" style="list-style-type: disc"><code class="literal">rotateGesturesEnabled</code>: This <a class="indexterm" id="id321"/>defines whether rotation gestures are enabled or disabled.</li></ul></div><p>There are<a class="indexterm" id="id322"/> some<a class="indexterm" id="id323"/> sample demos at Google Map's GitHub: <a class="ulink" href="https://github.com/googlemaps/android-samples">https://github.com/googlemaps/android-samples</a>.</p></div>
<div class="section" title="Google Places"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec45"/>Google Places</h1></div></div></div><p>Using the Google Places API, your app can access the Google's places database. This database<a class="indexterm" id="id324"/> has information about business and local places: name, address, photos, phone number, rating, type, coordinates, website, or price level. Add the following dependency in your Gradle's build file to include the Google Places API package in your app:</p><div class="informalexample"><pre class="programlisting">compile 'com.google.android.gms:play-services-location:8.4.0'</pre></div><p>To use the Google Places API, an API key is needed. This key is the same one that you obtained to use the Google Maps API. Once you have it, add it to your app's manifest file, inside the <code class="literal">application</code> element, using the following code:</p><div class="informalexample"><pre class="programlisting">&lt;meta-data android:name="com.google.android.geo.API_KEY"
android:value="YOUR_API_KEY_HERE"/&gt;</pre></div><p>The <code class="literal">GoogleApiClient</code> class is used to access the API. Add the Google Places API in the <code class="literal">Build</code> method by indicating any of the two available Places API keys:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Geo Data API</strong></span>: This API provides access to Google's database, which contains<a class="indexterm" id="id325"/> the information about local places and <a class="indexterm" id="id326"/>businesses. The key for this API is <code class="literal">Places.GEO_DATA_API</code>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Place Detection API</strong></span>: This API gets the device location and detects the nearby places. The<a class="indexterm" id="id327"/> key for this API is <code class="literal">Places.PLACE_DETECTION_API</code>.</li></ul></div><p>You can also add <a class="indexterm" id="id328"/>both of them. See the following code as an example for the <code class="literal">onCreate</code> method of your activity:</p><div class="informalexample"><pre class="programlisting">GoogleApiClient gac = new GoogleApiClient
        .Builder(this)
        .addApi(Places.GEO_DATA_API)
        .addApi(Places.PLACE_DETECTION_API)
        .addConnectionCallbacks(this)
        .addOnConnectionFailedListener(this)
        .build();</pre></div><p>In addition to these two APIs, there is a default dialog that your app can display to let the user pick a place in a map—the <a class="indexterm" id="id329"/>
<span class="strong"><strong>Place Picker UI</strong></span>. Using this element, you don't need to implement your own custom dialog. Use the <code class="literal">IntentBuilder</code> method of the <code class="literal">PlacePicker</code> class to create an <code class="literal">Intent</code> and start the activity like in the following code:</p><div class="informalexample"><pre class="programlisting">PlacePicker.IntentBuilder builder = 
   new PlacePicker.IntentBuilder();
startActivityForResult(builder.build(this), PLACE_PICKER_REQUEST);</pre></div><p>The<a class="indexterm" id="id330"/> activity's result will return you the place selected by the user, which you can obtain using the <code class="literal">getPlace</code> method of the <code class="literal">PlacePicker</code> class:</p><div class="informalexample"><pre class="programlisting">@Override
public void onActivityResult(int requestCode, int resultCode, Intenta data) {
   if (requestCode == PLACE_PICKER_REQUEST) {
      if (resultCode == Activity.RESULT_OK) {
         Place place = PlacePicker.getPlace(data, getActivity());
      }
   }
}</pre></div><div class="section" title="Geo Data API"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec21"/>Geo Data API</h2></div></div></div><p>Using the<a class="indexterm" id="id331"/> Geo Data API, which is connected to Google's database, you can find places by their identifiers or by query, you can get photos of the places, or you can add new places. These are the main methods available in the <code class="literal">GeoDataApi</code> interface:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">addPlace</code>: This<a class="indexterm" id="id332"/> method allows you to add a new place to Google's database. The place will be available for your app, but it needs to be reviewed before being added to Google's database. Information about the new place is included in an <code class="literal">AddPlaceRequest</code> object.</li><li class="listitem" style="list-style-type: disc"><code class="literal">getAutocompletePredictions</code>: This method returns a list of places based on a <a class="indexterm" id="id333"/>query that looks for names and addresses of places. In addition to the search string, you can add more filters, such as latitude and longitude limits or a flag to return only businesses.</li><li class="listitem" style="list-style-type: disc"><code class="literal">getPlaceById</code>: This<a class="indexterm" id="id334"/> method returns a list of <code class="literal">Place</code> objects with the indicated place IDs.</li><li class="listitem" style="list-style-type: disc"><code class="literal">getPlacePhotos</code>: This<a class="indexterm" id="id335"/> method returns up to 10 photos of the place indicated by its ID.</li></ul></div></div><div class="section" title="Place Detection API"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec22"/>Place Detection API</h2></div></div></div><p>To get an <a class="indexterm" id="id336"/>estimation of the place where the user is located, you need to use the Place Detection API. The <code class="literal">PlaceDetectionApi</code> interface provides the <code class="literal">getCurrentPlace</code> method that returns a buffer (<code class="literal">PlaceLikelihoodBuffer</code> object) containing a list of candidate places and the associated likelihood of the user being in those places (<code class="literal">PlaceLikelihood</code> objects). A <code class="literal">PlaceLikelihood</code> object has two public methods:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">getLikelihood</code>: This<a class="indexterm" id="id337"/> method returns a <code class="literal">float</code> value, which represents the likelihood with a value from 0.0 to 1.0. The higher the value, the higher the confidence that the user is at that candidate place.</li><li class="listitem" style="list-style-type: disc"><code class="literal">getPlace</code>: This<a class="indexterm" id="id338"/> method returns the <code class="literal">Place</code> object, which contains all the information about the candidate place.</li></ul></div><p>The <code class="literal">getCurrentPlace</code> method can receive a filter to refine the results (<code class="literal">PlaceFilter</code> object). You can filter the places that are currently open or not and you can filter by specific place identifiers.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>To see more <a class="indexterm" id="id339"/>code and examples, check the sample demo at Google's GitHub: <a class="ulink" href="https://github.com/googlesamples/android-play-places">https://github.com/googlesamples/android-play-places</a>.</p></div></div></div></div>
<div class="section" title="Google Sign-In"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec46"/>Google Sign-In</h1></div></div></div><p>Google Sign-In for Android lets the developer authenticate users using the same credentials they<a class="indexterm" id="id340"/> use on Google. Users will be able to sign in to your app using their Google credentials. Add the following dependency in your Gradle's build file to include the Google Sign-In package in your app:</p><div class="informalexample"><pre class="programlisting">compile 'com.google.android.gms:play-services-auth:8.4.0'</pre></div><p>These are the main Google Sign-In API classes that you need to know about:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">SignInButton</code>: This is the default Google Sign-In button. You need to add the default<a class="indexterm" id="id341"/> or a custom button to your app so the user can trigger the Sign-In flow. You can add the default button using this code in your layout file:<div class="informalexample"><pre class="programlisting">&lt;com.google.android.gms.common.SignInButton
 android:id="@+id/sign_in_button"
 android:layout_width="wrap_content"
 android:layout_height="wrap_content" /&gt;</pre></div><p>This default button can be customized in size and color depending on the scope. For example, you can choose among these size values, which you <a class="indexterm" id="id342"/>can compare in the next screenshot: <code class="literal">SignInButton.SIZE_ICON_ONLY</code>, <code class="literal">SignInButton.SIZE_STANDARD</code>, or <code class="literal">SignInButton.SIZE_WIDE</code>.</p><div class="mediaobject"><img alt="Google Sign-In" src="graphics/B05459_07_06.jpg"/></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">GoogleSignInOptions</code>: This class configures the Google Sign-In API options. You <a class="indexterm" id="id343"/>can request the user's ID and basic profile using the <code class="literal">GoogleSignInOptions.DEFAULT_SIGN_IN</code> option. You can also build a new option to request additional information such as the user's e-mail using the following code:<div class="informalexample"><pre class="programlisting">GoogleSignInOptions gsio = new
  GoogleSignInOptions.Builder(
      GoogleSignInOptions.DEFAULT_SIGN_IN)
  .requestEmail()
  .build();</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">GoogleApiClient</code>: This <a class="indexterm" id="id344"/>class is used to access the API. Add the Google Sign-In API in the <code class="literal">Build</code> method by indicating the <code class="literal">Auth.GOOGLE_SIGN_IN_API</code> key. The build method also receives a <code class="literal">GoogleSignInOptions</code> object. You can add the following code to the <code class="literal">onCreate</code> method of your activity to get a <code class="literal">GoogleApiClient</code> object:<div class="informalexample"><pre class="programlisting">GoogleApiClient gac = new GoogleApiClient.Builder(this)
    .enableAutoManage(this, this)
    .addApi(Auth.GOOGLE_SIGN_IN_API, gsio)
    .build();</pre></div></li></ul></div><p>To see more code <a class="indexterm" id="id345"/>and examples, check the sample demo at Google's GitHub: <a class="ulink" href="https://github.com/googlesamples/google-services/tree/master/android/signin">https://github.com/googlesamples/google-services/tree/master/android/signin</a>.</p></div>
<div class="section" title="Google+ Platform for Android"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec47"/>Google+ Platform for Android</h1></div></div></div><p>Google+ Platform for Android is now part of Google Sign-In. You need to add Google Sign-In to<a class="indexterm" id="id346"/> use Google+ in your app. This enables the use of the public profile and social graph to welcome the users by name, display their pictures, or connect with friends.</p><p>Create a <code class="literal">GoogleApiClient</code> object to access the API and use the Sign-In feature. Add the Google+ API by indicating the key <code class="literal">Plus.API</code> and these two scopes: <code class="literal">Scopes.PLUS_LOGIN</code> and <code class="literal">Scopes.PLUS_ME</code>, like in the following code:</p><div class="informalexample"><pre class="programlisting">GoogleApiClient gac = new GoogleApiClient.Builder(this)
        .enableAutoManage(this, this)
        .addApi(Plus.API)
        .addScope(Scopes.PLUS_LOGIN)
        .addScope(Scopes.PLUS_ME)
        .build();</pre></div><p>The <code class="literal">PlusShare</code> class includes resources in posts shared on Google+. The <code class="literal">PlusOneButton</code> class implements a <span class="strong"><strong>+1</strong></span> button to recommend a URL on Google+. The available sizes for the <span class="strong"><strong>+1</strong></span> button are small, medium, tall, or standard. Add it to a layout using the following code:</p><div class="informalexample"><pre class="programlisting">&lt;com.google.android.gms.plus.PlusOneButton
  android:layout_width="wrap_content"
  android:layout_height="wrap_content"
  plus:size="standard" /&gt;</pre></div><p>To see more<a class="indexterm" id="id347"/> code and examples, check the sample demo at Google's GitHub: <a class="ulink" href="https://github.com/googleplus/gplus-haiku-client-android">https://github.com/googleplus/gplus-haiku-client-android</a>.</p></div>
<div class="section" title="Google Play In-App Billing"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec48"/>Google Play In-App Billing</h1></div></div></div><p>In-app Billing<a class="indexterm" id="id348"/> allows you to sell virtual content from your apps. This virtual content could be paid content with a one-time billing or a time concession through subscriptions or fees. Using this service, you can allows you to charge for extra features and access to premium content.</p><p>Any app published in Google Play store can implement the In-app Billing API, since it only requires the same assets as publishing an app: a Google Play Developer Console account and a Google Wallet Merchant account.</p><p>Using the Google Play Developer Console, you can define your products, including the type, identification code (SKU), price, description, and more. Once you have your products defined, you can access this content from this application. When the user wants to buy this content, the following purchase flow will occur between your In-app billing application<a class="indexterm" id="id349"/> and Google Play:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Your app calls <code class="literal">isBillingSupported()</code> to Google Play to check if the In-app Billing version your are using is supported.</li><li class="listitem">If the In-app Billing API version is supported, you may use <code class="literal">getPurchases()</code> to get a list of the SKUs of the purchased items. This list will be returned in a <code class="literal">Bundle</code> object.</li><li class="listitem">You will probably want to inform your user of the available in-app purchases. To do this, your app may send a <code class="literal">getSkuDetails()</code> request, which will result in a list with the price, title, description, and more information available for the item being offered.</li></ol></div><p>To see more code <a class="indexterm" id="id350"/>and examples, check the sample demo at Google's GitHub: <a class="ulink" href="https://github.com/googlesamples/android-play-billing">https://github.com/googlesamples/android-play-billing</a>.</p></div>
<div class="section" title="Google Cloud Messaging"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec49"/>Google Cloud Messaging</h1></div></div></div><p>
<span class="strong"><strong>Google Cloud Messaging</strong></span> (<span class="strong"><strong>GCM</strong></span>) for Android allows the communication between your server and <a class="indexterm" id="id351"/>your application using asynchronous messages. You need the client implementation in your Android app, but you also need the implementation in your server to send the messages and to store the client's data. You don't have to worry about handling low-level aspects of this communication, such as queuing and message construction. Using this service, you can easily implement a notification system for your application.</p><p>The following image shows how GCM works. The process involves three elements: your app, your server, and the GCM servers.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Your app first needs to register in GCM to get a registration ID, which identifies your app in a specific device.</li><li class="listitem">Your app has to send the registration ID to your server so that it can be saved. This second step is necessary since your server needs to know the registration IDs of the user's device to send a message to your app in that device.</li><li class="listitem">When your server wants to send a message, it will send it to the GCM servers, indicating the message information and the registration IDs of the devices that will receive the message.</li><li class="listitem">Finally, GCM will send the message to your app in those devices.<div class="mediaobject"><img alt="Google Cloud Messaging" src="graphics/B05459_07_07.jpg"/></div></li></ol></div><p>You have <a class="indexterm" id="id352"/>two options when using GCM:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The server can inform your app when there is new data available to be fetched from the server, and then the application gets this data.</li><li class="listitem" style="list-style-type: disc">The server can send the data directly in a message. The message payload can be up to 4 KB. This allows your application to access the data at once and act accordingly.</li></ul></div><p>Add the following dependency, in your Gradle's build file, to include the Google Maps API package in your app:</p><div class="informalexample"><pre class="programlisting">compile 'com.google.android.gms:play-services-<span class="strong"><strong>gcm</strong></span>:8.4.0'</pre></div><p>In order to send or receive messages from your app (client side), you will need to get a registration ID. This identifies the combination of device and application. To allow your app to use the GCM service, you need to add the following line to the manifest file of your project:</p><div class="informalexample"><pre class="programlisting">&lt;uses-permission android:name="com.google.android.c2dm.permission.RECEIVE"/&gt;</pre></div><p>You also have to add the declaration of the following three classes to your manifest file:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>GCM Receiver</strong></span>: This <a class="indexterm" id="id353"/>class manages the messages received in your app. This receiver already belongs to the GCM API and you don't need to create it. Use the<a class="indexterm" id="id354"/> following code to add it to your manifest file:<div class="informalexample"><pre class="programlisting">&lt;receiver 
android:name=<span class="strong"><strong>"com.google.android.gms.gcm.GcmReceiver</strong></span>"
android:exported="true" android:permission=<span class="strong"><strong>"com.google.android.c2dm.permission.SEND</strong></span>"&gt;
   &lt;intent-filter&gt;
      &lt;action
      android:name=<span class="strong"><strong>"com.google.android.c2dm.intent.RECEIVE</strong></span>" /&gt;
      &lt;category android:name="com.example.gcm" /&gt;
   &lt;/intent-filter&gt;
&lt;/receiver&gt;</pre></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>GCM Listener Service</strong></span>: This service class, which you have to create in your app, should extend the <code class="literal">GcmListenerService</code> class. By implementing this service <a class="indexterm" id="id355"/>subclass, you can handle the messages in its <code class="literal">onMessageReceived</code> method. Use the following code to add it to your manifest file:<div class="informalexample"><pre class="programlisting">&lt;service
android:name=<span class="strong"><strong>"com.example.MyGcmListenerService</strong></span>"
android:exported="false" &gt;
   &lt;intent-filter&gt;
      &lt;action
      android:name=<span class="strong"><strong>"com.google.android.c2dm.intent.RECEIVE</strong></span>" /&gt;
   &lt;/intent-filter&gt;
&lt;/service&gt;</pre></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Instance ID Listener Service</strong></span>: This service class, which you have to create in your <a class="indexterm" id="id356"/>app, should extend the <code class="literal">InstanceIDListenerService</code> class. By implementing this service subclass, you can handle the registration ID. Use the following code to add it to your manifest file:<div class="informalexample"><pre class="programlisting">&lt;service
android:name="com.example.MyInstanceIDListenerService"
android:exported="false"&gt;
   &lt;intent-filter&gt;
      &lt;action
      android:name="com.google.android.gms.iid.InstanceID" /&gt;
   &lt;/intent-filter&gt;
&lt;/service&gt;</pre></div></li></ul></div><p>To see <a class="indexterm" id="id357"/>more code and examples, check the sample demo at Google's GitHub: <a class="ulink" href="https://github.com/googlesamples/google-services/tree/master/android/gcm">https://github.com/googlesamples/google-services/tree/master/android/gcm</a>.</p></div>
<div class="section" title="More sample apps"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec50"/>More sample apps</h1></div></div></div><p>If you are interested in Google Play services, there are sample apps available at Google's GitHub. Here are<a class="indexterm" id="id358"/> the links to them:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Google+: <a class="ulink" href="https://github.com/googleplus/gplus-haiku-client-android">https://github.com/googleplus/gplus-haiku-client-android</a>.</li><li class="listitem" style="list-style-type: disc">Google Analytics: <a class="ulink" href="https://github.com/googlesamples/google-services/tree/master/android/analytics">https://github.com/googlesamples/google-services/tree/master/android/analytics</a>.</li><li class="listitem" style="list-style-type: disc">Google App Indexing: <a class="ulink" href="https://github.com/google/search-samples/tree/master/app-indexing">https://github.com/google/search-samples/tree/master/app-indexing</a>.</li><li class="listitem" style="list-style-type: disc">Google Cast: <a class="ulink" href="https://github.com/googlecast/CastVideos-android">https://github.com/googlecast/CastVideos-android</a> or <a class="ulink" href="https://github.com/googlecast/GameManagerSamples">https://github.com/googlecast/GameManagerSamples</a>.</li><li class="listitem" style="list-style-type: disc">Google Cloud Messaging: <a class="ulink" href="https://github.com/googlesamples/google-services/tree/master/android/gcm">https://github.com/googlesamples/google-services/tree/master/android/gcm</a>.</li><li class="listitem" style="list-style-type: disc">Google Drive: <a class="ulink" href="https://github.com/googledrive/android-demos">https://github.com/googledrive/android-demos</a>.</li><li class="listitem" style="list-style-type: disc">Google Fit: <a class="ulink" href="https://github.com/googlesamples/android-fit">https://github.com/googlesamples/android-fit</a>.</li><li class="listitem" style="list-style-type: disc">Google In-app Billing: <a class="ulink" href="https://github.com/googlesamples/android-play-billing">https://github.com/googlesamples/android-play-billing</a>.</li><li class="listitem" style="list-style-type: disc">Google Location: <a class="ulink" href="https://github.com/googlesamples/android-play-location/">https://github.com/googlesamples/android-play-location/</a>.</li><li class="listitem" style="list-style-type: disc">Google Maps: <a class="ulink" href="https://github.com/googlemaps/android-samples">https://github.com/googlemaps/android-samples</a>.</li><li class="listitem" style="list-style-type: disc">Google Mobile Ads: <a class="ulink" href="https://github.com/googleads/googleads-mobile-android-examples">https://github.com/googleads/googleads-mobile-android-examples</a>.</li><li class="listitem" style="list-style-type: disc">Google Nearby: <a class="ulink" href="https://github.com/googlesamples/android-nearby">https://github.com/googlesamples/android-nearby</a>.</li><li class="listitem" style="list-style-type: disc">Google Places: <a class="ulink" href="https://github.com/googlesamples/android-play-places">https://github.com/googlesamples/android-play-places</a>.</li><li class="listitem" style="list-style-type: disc">Google Play Games services: <a class="ulink" href="https://github.com/playgameservices/android-basic-samples">https://github.com/playgameservices/android-basic-samples</a>.</li><li class="listitem" style="list-style-type: disc">Google Sign-In: <a class="ulink" href="https://github.com/googlesamples/google-services/tree/master/android/signin">https://github.com/googlesamples/google-services/tree/master/android/signin</a>.</li><li class="listitem" style="list-style-type: disc">Google Wallet: <a class="ulink" href="https://github.com/android-pay/androidpay-quickstart">https://github.com/android-pay/androidpay-quickstart</a>.</li></ul></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec51"/>Summary</h1></div></div></div><p>In this chapter, we discussed the available Google Play services. You learned how to improve our application using Google Play Services through its client library and Android package. You should have successfully installed the Google Play Services client library in Android Studio using the SDK Manager and should now be able to build applications using the library features. You also learned some tips about Google Maps v2, Google+ Platform for Android authentication, Google Play In-app Billing, and GCM.</p><p>In the next chapter, you will learn about some useful tools available in Android Studio. We will use the SDK Manager frequently to install different packages. You will also learn about the AVD Manager for different virtual devices to test our applications on. We will generate Javadoc documentation for our project using the Javadoc utility and you will learn about the version control systems available in Android Studio.</p></div></body></html>