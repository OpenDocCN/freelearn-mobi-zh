- en: Chapter 7. Alerts and Notifications
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: Lights, Action, and Sound – getting the user's attention!
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating a Toast using a custom layout
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Displaying a message box with AlertDialog
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Displaying a progress dialog
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Lights, Action, and Sound Redux using Notifications
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating a Media Player Notification
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Making a Flashlight with a Heads-Up Notification
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Android provides many ways to notify your user—from non-visual methods, including
    sounds, lights, and vibration, to visual methods including Toasts, Dialogs, and
    Status Bar notifications.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: Keep in mind, notifications distract your user, so it's a good idea to be very
    judicious when using any notification. Users like to be in control of their device
    (it is theirs, after all) so give them the option to enable and disable notifications
    as they desire. Otherwise, your user might get annoyed and uninstall your app
    altogether.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: 'We''ll start by reviewing the following non-UI based notification options:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: Flash LED
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Vibrate phone
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Play ringtone
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Then we''ll move on to visual notifications, including:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
- en: Toasts
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`AlertDialog`'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`ProgressDialog`'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Status Bar Notifications
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The recipes that follow will show you how to implement these features in your
    own applications. It''s worth reading the following link to understand "best practices"
    when using notifications:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  id: totrans-22
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Refer to **Android Notification Design Guidelines** at [http://developer.android.com/design/patterns/notifications.html](http://developer.android.com/design/patterns/notifications.html)
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: Lights, Action, and Sound – getting the user's attention!
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Most of the recipes in this chapter use the Notification object to alert your
    users, so this recipe will show an alternative approach for when you don't actually
    need a notification.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: 'As the recipe title implies, we''re going to use lights, action, and sound:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: '**Lights**: Normally, you''d use the LED device, but that is only available
    through the Notification object, which we''ll demonstrate later in the chapter.
    Instead we''ll take this opportunity to use `setTorchMode()` (added in API 23—Android
    6.0), to use the camera flash as a flashlight. (Note: as you''ll see in the code,
    this feature will only work on an Android 6.0 device with a camera flash.)'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Action**: We''ll vibrate the phone.'
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Sound**: We''ll use the `RingtoneManager` to play the default notification
    sound.'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: As you'll see, the code for each of these is quite simple.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
- en: 'As demonstrated in the following *Lights, Action, and Sound Redux using Notifications*
    recipe, all three options: LED, vibrate, and sounds, are available through the
    Notification object. The Notification object would certainly be the most appropriate
    method to provide alerts and reminders when the user is not actively engaged in
    your app. But for those times when you want to provide feedback while they are
    using your app, these options are available. The vibrate option is a good example;
    if you want to provide haptic feedback to a button press (common with keyboard
    apps), call the vibrate method directly.'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Create a new project in Android Studio and call it: `LightsActionSound`. When
    prompted for the API level, we need API 21 or above to compile the project. Select
    **Empty Activity** when prompted for the **Activity Type**.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-34
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We''ll use three buttons to initiate each action, so start by opening `activity_main.xml`
    and follow these steps:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: 'Replace the existing `<TextView>` element with the following three buttons:'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-37
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Add the following permission to the Android Manifest:'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Open `ActivityMain.java` and add the following global variables:'
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-41
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Add the following method to get the Camera ID:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Add the following code to the `onCreate()` method:'
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-45
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Now add the code to handle each of the button clicks:'
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: You're ready to run the application on a physical device. The code presented
    here will need Android 6.0 (or higher) to use the flashlight option.
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'As you can see from the previous paragraphs, most of the code is related to
    finding and opening the camera to use the flash feature. `setTorchMode()` was
    introduced in API 23, which is why we have the API version check:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: This app demonstrates using the new `camera2` libraries, which were introduced
    in Lollipop (API 21). The `vibrate` and `ringtone` methods have both been available
    since API 1.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: The `getCameraId()` method is where we check for the camera. We want an outward-facing
    camera with a flash. If one is found, the ID is returned, otherwise it is null.
    If the camera id is null, we disable the button.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
- en: 'For playing the sound, we use the `Ringtone` object from the `RingtoneManager`.
    Besides it being relatively easy to implement, another benefit to this method
    is that we can use the default notification sound, which we get with this code:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: This way, if the user changes their preferred notification sound, we use it
    automatically.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: 'Last is the call to vibrate the phone. This was the simplest code to use, but
    it does require permission, which we added to the Manifest:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: There's more...
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In a production-level application, you wouldn't want to simply disable the button
    if you didn't have to. In this case, there are other means to use the camera flash
    as a flashlight. Take a look at the multi-media chapter for additional examples
    on using the camera, where we'll see `getCameraId()` used again.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
- en: See also
  id: totrans-61
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Refer to the *Lights, Action, and Sound Redux with Notifications* recipe later
    in this chapter to see the equivalent features using the Notification object
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Refer to [Chapter 11](ch11.html "Chapter 11. Multimedia"), *Multimedia*, for
    examples using the new camera API and other sound options
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating a Toast using a custom layout
  id: totrans-64
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We've used Toasts quite a bit already in previous chapters as they provide a
    quick and easy way to display information—both for the user and for ourselves
    when debugging.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
- en: The previous examples have all used the simple one-line syntax, but the Toast
    isn't limited to this. Toasts, like most components in Android, can be customized,
    as we'll demonstrate in this recipe.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: 'Android Studio offers a shortcut for making the simple Toast statement. As
    you start to type the Toast command, press *Ctrl* + *Spacebar* and you''ll see
    the following:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a Toast using a custom layout](img/B05057_07_01.jpg)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
- en: 'Press *Enter* to auto-complete. Then, press *Ctrl* + *Spacebar* again and you''ll
    see the following:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a Toast using a custom layout](img/B05057_07_02.jpg)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
- en: 'When you press *Enter* again, it will auto-complete with the following:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'In this recipe, we''ll use the Toast Builder to change the default layout,
    and gravity to create a custom Toast as shown in this screenshot:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a Toast using a custom layout](img/B05057_07_03.jpg)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
- en: Getting ready
  id: totrans-75
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Create a new project in Android Studio and call it: `CustomToast`. Use the
    default **Phone & Tablet** options and select **Empty Activity** when prompted
    for the **Activity Type**.'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-77
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We''re going to change the shape of the Toast to a square and create a custom
    layout to display an image and text message. Start by opening `activity_main.xml`
    and follow these steps:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
- en: 'Replace the existing `<TextView>` element with a `<Button>` as follows:'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Create a new resource file in the `res/drawable` folder named: `border_square.xml`
    and type the following code:'
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-82
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Create a new resource file in the `res/layout` folder named: `toast_custom.xml`
    and type the following code:'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-84
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Now open `ActivityMain.java` and type the following method:'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-86
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Run the program on a device or emulator.
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-88
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This custom Toast changes the default gravity, shape, and adds an image just
    to show that "it can be done".
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
- en: The first step is to create a new Toast layout, which we do by inflating our
    `custom_toast` layout. Once we have the new layout, we need to get the `TextView`
    so we can set our message, which we do with the standard `setText()` method. With
    this done, we create a Toast object and set the individual properties. We set
    the Toast gravity with the `setGravity()` method. The gravity determines where
    on the screen our Toast will display. We specify our custom layout with the `setView()`
    method call. And just like in the single line variation, we display the Toast
    with the `show()` method.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
- en: Displaying a message box with AlertDialog
  id: totrans-91
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In [Chapter 4](ch04.html "Chapter 4. Menus"), *Menus*, we created a theme to
    make an Activity look like a dialog. In this recipe, we''ll demonstrate how to
    create a dialog using the `AlertDialog` class. The `AlertDialog` offers a Title,
    up to three buttons, and a list or custom layout area, as shown in this example:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
- en: '![Displaying a message box with AlertDialog](img/B05057_07_04.jpg)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
- en: Note
  id: totrans-94
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The button placement can vary depending on the OS version.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-96
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Create a new project in Android Studio and call it: `AlertDialog`. Use the
    default **Phone & Tablet** options and select the **Empty Activity** option when
    prompted for the **Activity Type**.'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-98
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To demonstrate, we''ll create a **Confirm Delete** dialog to prompt the user
    for confirmation after pressing the *Delete* button. Start by opening the `main_activity.xml`
    layout file and follow these steps:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
- en: 'Add the following `<Button>`:'
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Add the `confirmDelete()` method called by the button:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Run the application on a device or emulator.
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-105
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This dialog is meant to serve as a simple confirmation dialog—such as confirming
    a delete action. Basically, just create an `AlertDialog.Builder` object and set
    the properties as needed. We use a Toast message to indicate the user selection
    and we don't even have to close the dialog; it's taken care of by the base class.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-107
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'As shown in the recipe introduction screenshot, the `AlertDialog` also has
    a third button, called the Neutral button, and can be set using the following
    method:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Add an icon
  id: totrans-110
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To add an icon to the dialog, use the `setIcon()` method. Here is an example:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Using a list
  id: totrans-113
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'We can also create a list of items to select with various list-setting methods,
    including:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: As you can see, there are also methods for single-choice (using a radio button)
    and multi-choice lists (using a checkbox).
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  id: totrans-117
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You can't use both the Message and the Lists, as `setMessage()` will take priority.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
- en: Custom Layout
  id: totrans-119
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Finally, we can also create a custom layout, and set it using:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: If you use a custom layout and replace the standard buttons, you are also responsible
    for closing the dialog. Use `hide()` if you plan to reuse the dialog and `dismiss()`
    when finished to release the resources.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
- en: Displaying a progress dialog
  id: totrans-123
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The `ProgressDialog` has been available since API 1, and is widely used. As
    we''ll demonstrate in this recipe, it''s simple to use, but keep this statement
    in mind (from the Android Dialog Guidelines site):'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
- en: Avoid ProgressDialog
  id: totrans-125
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  id: totrans-126
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Android includes another dialog class called ProgressDialog that shows a dialog
    with a progress bar. However, if you need to indicate loading or indeterminate
    progress, you should instead follow the design guidelines for Progress & Activity
    and use a ProgressBar in your layout.
  id: totrans-127
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '[http://developer.android.com/guide/topics/ui/dialogs.html](http://developer.android.com/guide/topics/ui/dialogs.html)'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
- en: This message doesn't mean the `ProgressDialog` is deprecated or is bad code.
    It's suggesting that the use of the `ProgressDialog` should be avoided, since
    the user cannot interact with your app while the dialog is displayed. If possible,
    use a layout that includes a progress bar, instead of using a `ProgressDialog`.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
- en: The Google Play app provides a good example. When adding items to download,
    Google Play shows a progress bar, but it's not a dialog, so the user can continue
    interacting with the app, even adding more items to download. If possible, use
    that approach instead.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
- en: 'There are times when you may not have that luxury, such as after placing an
    order, the user is going to expect an order confirmation. (Even with Google Play,
    you still see a confirmation dialog when actually purchasing apps.) So, remember,
    avoid the progress dialog if possible. But, for those times when something must
    complete before continuing, this recipe provides an example of how to use the
    `ProgressDialog`. The following screenshot shows the `ProgressDialog` from the
    recipe:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
- en: '![Displaying a progress dialog](img/B05057_07_05.jpg)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
- en: Getting ready
  id: totrans-133
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Create a new project in Android Studio and call it: `ProgressDialog`. Use the
    default **Phone & Tablet** options and select **Empty Activity** when prompted
    for the **Activity Type**.'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-135
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Since this is just a demonstration on using the ProgressDialog, we will create
    a button to show the dialog. To simulate waiting for a server response, we will
    use a delayed message to dismiss the dialog. To start, open `activity_main.xml`
    and follow these steps:'
  id: totrans-136
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Replace the `<TextView>` with the following `<Button>`:'
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE20]'
  id: totrans-138
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Open `MainActivity.java` and add the following two global variables:'
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  id: totrans-140
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Add the `showDialog()` method referenced by the button click:'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE22]'
  id: totrans-142
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Run the program on a device or emulator. When you press the **Show Dialog**
    button, you'll see the dialog as shown in the screen from the Intro.
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-144
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We use the `ProgressDialog` class to display our dialog. The options should
    be self-explanatory, but this setting is worth noting:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Normally, a dialog can be cancelled using the *back* key, but when this is set
    to false, the user is stuck on the dialog until it is hidden/dismissed from the
    code. To simulate a delayed response from a server, we use a `Handler` and the
    `postDelayed()` method. After the specified milliseconds (30,000 in this case,
    to represent 30 seconds), the `run()` method will be called, which dismisses our
    dialog.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-148
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We used the default `ProgressDialog` settings for this recipe, which creates
    an indeterminate dialog indicator, for example, the continuously spinning circle.
    If you can measure the task at hand, such as loading files, you can use a determinate
    style instead. Add and run this line of code:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'You will get the following dialog style as an output to the preceding line
    of code:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
- en: '![There''s more...](img/B05057_07_06.jpg)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
- en: Lights, Action, and Sound Redux using Notifications
  id: totrans-153
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You're probably already familiar with Notifications as they've become a prominent
    feature (even making their way to the desktop environment) and for good reason.
    They provide an excellent means to send information to your user. They provide
    the least intrusive option of all the alerts and notification options available.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
- en: As we saw in the first recipe, *Lights, Action, and Sound – getting the user's
    attention!*, lights, vibration, and sound are all very useful for getting the
    user's attention. That's why the Notification object includes support for all
    three methods, as we'll demonstrate in this recipe. Given this ability to get
    your user's attention, care should still be taken not to abuse your user. Otherwise,
    they'll likely uninstall your app. It's generally a good idea to give your users
    the option to enable/disable notifications and even how to present the notification—with
    sound or without, and so on.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-156
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Create a new project in Android Studio and call it: `LightsActionSoundRedux`.
    Use the default **Phone & Tablet** options and select **Empty Activity** when
    prompted for the **Activity Type**.'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-158
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We''ll need permission to use the vibrate option, so start by opening the Android
    Manifest file, and follow these steps:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
- en: 'Add the following permission:'
  id: totrans-160
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE25]'
  id: totrans-161
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Open `activity_main.xml` and replace the existing `<TextView>` with the following
    buttons:'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE26]'
  id: totrans-163
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Now open `MainActivity.java` and add the following methods to handle the button
    click:'
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE27]'
  id: totrans-165
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Run the program on a device or emulator.
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-167
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'First, we combined all three actions into a single notification, simply because
    we could. You don''t have to use all three extra notification options, or even
    any. Only the following are required:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE28]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: If you don't set both the icon and text, the notification will not show.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
- en: Second, we used the `NotificationCompat` to build our notification. This comes
    from the support library and makes it easier to be backward compatible with older
    OS versions. If we request a notification feature that is not available on the
    user's version of OS, it will simply be ignored.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
- en: 'The three lines of code that produce our extra notification options include
    the following:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE29]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: It's worth noting that we use the same sound URI with the notification as we
    did with the `RingtoneManager` from the earlier *Lights, Action, and Sound* recipe.
    The vibrate feature also required the same vibrate permission as the previous
    recipe, but notice the value we send is different. Instead of sending just a duration
    for the vibration, we are sending a vibrate pattern. The first value represents
    the `off` duration (in milliseconds), the next value represents the vibration
    `on` duration, and repeats.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  id: totrans-175
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: On devices with LED notification, you won't see the LED notification while the
    screen is active.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-177
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This recipe shows the basics of a notification, but like many features on Android,
    options have expanded with later OS releases.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
- en: Adding a button to the notification using addAction()
  id: totrans-179
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'There are several design considerations you should keep in mind when adding
    action buttons, as listed in the Notification Guidelines linked in the chapter
    introduction. You can add a button (up to three) using the `addAction()` method
    on the notification builder. Here''s an example of a notification with one action
    button:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
- en: '![Adding a button to the notification using addAction()](img/B05057_07_07.jpg)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
- en: 'Here''s the code to create this notification:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE30]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: An `Action` requires three parameters—the image, the text, and a `PendingIntent`.
    The first two items are for the visual display, while the third item, the `PendingIntent`,
    is called when the user presses the button.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
- en: 'The previous code creates a very simple `PendingIntent;` it just launches the
    app. This is probably the most common intent for notifications, and is often used
    for when the user presses the notification. To set the notification intent, use
    the following code:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE31]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'A button action would probably require more information as it should take the
    user to the specific item in your app. You should also create an application back-stack
    for the best user experience. Take a look at the topic "**Preserving Navigation
    when Starting an Activity**" at the following link:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
- en: '[http://developer.android.com/guide/topics/ui/notifiers/notifications.html#NotificationResponse](http://developer.android.com/guide/topics/ui/notifiers/notifications.html#NotificationResponse)'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
- en: Expanded notifications
  id: totrans-189
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Expanded notifications were introduced in Android 4.1 (API 16) and are available
    by using the `setStyle()` method on the Notification Builder. If the user's OS
    does not support expanded notifications, the notification will appear as a normal
    notification.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
- en: 'The three expanded styles currently available in the `NotificationCompat` library
    include:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
- en: '`InboxStyle`'
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`BigPictureStyle`'
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`BigTextStyle`'
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Here''s an example of each notification style, and the code used to create
    the example:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
- en: '![Expanded notifications](img/B05057_07_08.jpg)'
  id: totrans-196
  prefs: []
  type: TYPE_IMG
- en: '`InboxStyle`:'
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE32]'
  id: totrans-198
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '![Expanded notifications](img/B05057_07_09.jpg)'
  id: totrans-199
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: '`BigPictureStyle`:'
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE33]'
  id: totrans-201
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: '![Expanded notifications](img/B05057_07_10.jpg)'
  id: totrans-202
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: '`BigTextStyle`'
  id: totrans-203
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE34]'
  id: totrans-204
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Lock screen notifications
  id: totrans-205
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Android 5.0 (API 21) and above can show notifications on the lock screen, based
    on the user''s lock screen visibility. Use `setVisibility()` to specify the notification
    visibility using the following values:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
- en: '`VISIBILITY_PUBLIC`: All content can be displayed'
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`VISIBILITY_SECRET`: No content should be displayed'
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`VISIBILITY_PRIVATE`: Display the basic content (title and icon) but the rest
    is hidden'
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: See also
  id: totrans-210
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: See the *Creating a Media Player Notification* and *Making a Flashlight with
    a Heads-Up Notification* recipes for additional notification options with Android
    5.0 (API 21) and greater
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Creating a Media Player Notification
  id: totrans-212
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This recipe is going to take a look at the new Media Player style introduced
    in Android 5.0 (API 21). Unlike the previous recipe, *Lights, Action, and Sound
    Redux using Notifications,* which used `NotificationCompat`, this recipe does
    not, as this style is not available in the support library.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
- en: 'Here''s a screenshot showing how the notification will appear:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a Media Player Notification](img/B05057_07_11.jpg)'
  id: totrans-215
  prefs: []
  type: TYPE_IMG
- en: 'This screenshot shows an example of the Media Player Notification on a lock
    screen:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a Media Player Notification](img/B05057_07_12.jpg)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
- en: Getting ready
  id: totrans-218
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Create a new project in Android Studio and call it: `MediaPlayerNotification`.
    When prompted for the API level, we need API 21 (or higher) for this project.
    Select **Empty Activity** when prompted for the **Activity Type**.'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-220
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We just need a single button to call our code to send the notification. Open
    `activity_main.xml` and follow these steps:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
- en: 'Replace the existing `<TextView>` with the following button code:'
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE35]'
  id: totrans-223
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Open `MainActivity.java` and add the `showNotification()` method:'
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE36]'
  id: totrans-225
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: Run the program on a device or emulator.
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-227
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The first detail to note is that we decorate our `showNotification()` method
    with:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE37]'
  id: totrans-229
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'This tells the compiler we know we are using deprecated calls. (Without this,
    the compiler will flag the code.) We follow this with an API check, using this
    call:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE38]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: The icon resource was changed in API 23, but we want this application to run
    on API 21 (Android 5.0) and later, so we still need to call the old methods when
    running on API 21 and API 22.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
- en: If the user is running on Android 6.0 (or higher), we use the new `Icon` class
    to create our icons, otherwise we use the old constructor. (You'll notice the
    IDE will show the deprecated calls with a strikethrough.) Checking the current
    OS version during runtime is a common strategy for remaining backward compatible.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
- en: We create three actions using `addAction()` to handle the media player functionality.
    Since we don't really have a media player going, we use the same intent for all
    the actions, but you'll want to create separate intents in your application.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
- en: 'To make the notification visible on the lock screen, we need to set the visibility
    level to `VISIBILITY_PUBLIC`, which we do with the following call:'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE39]'
  id: totrans-236
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'This call is worth noting:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE40]'
  id: totrans-238
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: Just as the method name implies, this sets the actions to show when the notification
    is shown with a reduced layout. (See the lock screen image in the recipe introduction.)
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-240
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We only created the visual notification in this recipe. If we were creating
    an actual media player, we could instantiate a `MediaSession` class and pass in
    the session token with this call:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE41]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: This will allow the system to recognize the media content and react accordingly,
    such as updating the lock screen with the current album artwork.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
- en: See also
  id: totrans-244
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Refer to **Developer doc – MediaSession** at [https://developer.android.com/reference/android/media/session/MediaSession.html](https://developer.android.com/reference/android/media/session/MediaSession.html)
  id: totrans-245
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The *Lock Screen Visibility* section in the *Lights, Action, and Sound Redux
    using Notifications* recipe discusses the visibility options.
  id: totrans-246
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Making a Flashlight with a Heads-Up Notification
  id: totrans-247
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Android 5.0—Lollipop (API 21) introduced a new type of notification called the
    Heads-Up Notification. Many people do not care for this new notification as it
    can be extremely intrusive, as it forces its way on top of other apps. (See the
    following screenshot.) Keep this in mind when using this type of notification.
    We're going to demonstrate the Heads-Up Notification with a Flashlight as this
    demonstrates a good use-case scenario.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
- en: 'Here''s a screenshot showing the Heads-Up Notification we''ll create further
    on:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
- en: '![Making a Flashlight with a Heads-Up Notification](img/B05057_07_13.jpg)'
  id: totrans-250
  prefs: []
  type: TYPE_IMG
- en: If you have a device running Android 6.0, you may have noticed the new Flashlight
    settings option. As a demonstration, we're going to create something similar in
    this recipe.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-252
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Create a new project in Android Studio and call it: `FlashlightWithHeadsUp`.
    When prompted for the API level, we need API 23 (or higher) for this project.
    Select **Empty Activity** when prompted for the **Activity Type**.'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-254
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Our activity layout will consist of just a `ToggleButton` to control the flashlight
    mode. We''ll be using the same `setTorchMode()` code as the *Lights, Action, and
    Sound – getting the user''s attention!* recipe presented earlier, and add a Heads-Up
    Notification. We''ll need permission to use the vibrate option, so start by opening
    the Android Manifest and following these steps:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
- en: 'Add the following permission:'
  id: totrans-256
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE42]'
  id: totrans-257
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Specify that we only want a single instance of `MainActivity` by adding `android:launchMode="singleInstance"`
    to the `<MainActivity>` element. It will look as follows:'
  id: totrans-258
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE43]'
  id: totrans-259
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'With the changes to `AndroidManifest` done, open the `activity_main.xml` layout
    and replace the existing `<TextView>` element with this `<ToggleButton>` code:'
  id: totrans-260
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE44]'
  id: totrans-261
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Now open `ActivityMain.java` and add the following global variables:'
  id: totrans-262
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE45]'
  id: totrans-263
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'Add the following code to the `onCreate()` to set up the camera:'
  id: totrans-264
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE46]'
  id: totrans-265
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Add the following method to handle the response when the user presses the notification:'
  id: totrans-266
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE47]'
  id: totrans-267
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Add the method to get the camera id:'
  id: totrans-268
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE48]'
  id: totrans-269
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Add these two methods to handle the flashlight mode:'
  id: totrans-270
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE49]'
  id: totrans-271
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Finally, add this method to create the notification:'
  id: totrans-272
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE50]'
  id: totrans-273
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE50]'
- en: You're ready to run the application on a physical device. As noted previously,
    you'll need an Android 6.0 (or higher) device, with an outward-facing camera flash.
  id: totrans-274
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-275
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Since this recipe uses the same flashlight code as *Lights, Action, and Sound
    – getting the user''s attention!*, we''ll jump to the `showNotification()` method.
    Most of the notification builder calls are the same as previous examples, but
    there are two significant differences:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE51]'
  id: totrans-277
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: Tip
  id: totrans-278
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Notifications will not be escalated to Heads-Up Notifications unless the priority
    is set to `HIGH` (or above) and uses either vibrate or sound.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 除非优先级设置为 `HIGH`（或更高），并且使用振动或声音，否则通知不会被提升为“抬头显示”通知。
- en: 'Note this from the Developer documentation given at: [http://developer.android.com/reference/android/app/Notification.html#headsUpContentView](http://developer.android.com/reference/android/app/Notification.html#headsUpContentView):'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 注意以下内容，这是在开发者文档中给出的：[http://developer.android.com/reference/android/app/Notification.html#headsUpContentView](http://developer.android.com/reference/android/app/Notification.html#headsUpContentView)
- en: '"At its discretion, the system UI may choose to show this as a heads-up notification."'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: “系统界面可以自行决定是否将其显示为“抬头显示”通知。”
- en: 'We create a `PendingIntent` as we''ve done previously, but here we set the
    action with:'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 我们创建一个 `PendingIntent`，就像我们之前做的那样，但在这里我们使用以下方式设置动作：
- en: '[PRE52]'
  id: totrans-283
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: We set the app to only allow a single instance in the `AndroidManifest` file,
    as we don't want to start a new instance of the app when the user presses the
    notification. The `PendingIntent` we created sets the action, which we check in
    the `onNewIntent()` callback. If the user opens the app without pressing the notification,
    they can still disable the flashlight with the `ToggleButton`.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在 `AndroidManifest` 文件中将应用程序设置为只允许一个实例，因为我们不希望在用户按下通知时启动应用程序的新实例。我们创建的 `PendingIntent`
    设置了动作，我们在 `onNewIntent()` 回调中检查这个动作。如果用户在不按下通知的情况下打开应用程序，他们仍然可以使用 `ToggleButton`
    禁用手电筒。
- en: There's more...
  id: totrans-285
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'Just like in the *Creating a Toast using a custom layout* recipe earlier, we
    can use a custom layout with notifications. Use the following method on the builder
    to specify the layout:'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 就像之前在 *使用自定义布局创建吐司* 的食谱中一样，我们可以在通知中使用自定义布局。在构建器上使用以下方法来指定布局：
- en: '[PRE53]'
  id: totrans-287
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: See also
  id: totrans-288
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: Refer to the *Lights, Action, and Sou**nd – getting the user's attention!* recipe
  id: totrans-289
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 请参阅 *灯光、动作和声音 – 引起用户的注意!* 食谱
