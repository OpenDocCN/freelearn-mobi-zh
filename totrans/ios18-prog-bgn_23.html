<html><head></head><body><div><div><div><h1 class="chapterNumber">20</h1>
    <h1 id="_idParaDest-260" class="chapterTitle">Getting Started with the Camera and Photo Library</h1>
    <p class="normal">In the previous chapter, you created the <code class="inlineCode">RatingView</code> class and added it to the Add New Journal Entry and Journal Entry Detail screens.</p>
    <p class="normal">In this chapter, you will complete the implementation of the Add New Journal Entry screen by adding a way for the user to get a <a id="_idIndexMarker872"/>photo from <a id="_idIndexMarker873"/>the <strong class="keyWord">camera</strong> or <strong class="keyWord">photo library</strong>, which they can then add to a new journal entry. You’ll start by <a id="_idIndexMarker874"/>adding a <strong class="keyWord">tap gesture recognizer</strong> to the image view in the <strong class="screenText">New Entry Scene</strong>, and configure it to display an <strong class="keyWord">image picker controller</strong> instance. Then, you <a id="_idIndexMarker875"/>will implement methods from the <code class="inlineCode">UIImagePickerControllerDelegate</code> protocol, which allows you to get a photo from the camera or photo library and make the photo smaller before it is saved to the journal entry instance. You’ll also modify the <code class="inlineCode">Info.plist</code> file to allow you to access the camera or photo library.</p>
    <p class="normal">By the end of this chapter, you’ll have learned how to access the camera or photo library in your own apps.</p>
    <p class="normal">The following topics will be covered in this chapter:</p>
    <ul>
      <li class="bulletList">Creating a new <code class="inlineCode">UIImagePickerController</code> instance</li>
      <li class="bulletList">Implementing <code class="inlineCode">UIImagePickerControllerDelegate</code> methods</li>
      <li class="bulletList">Getting permission to use the camera or photo library</li>
    </ul>
    <h1 id="_idParaDest-261" class="heading-1">Technical requirements</h1>
    <p class="normal">You will continue working on the <code class="inlineCode">JRNL</code> project that you modified in the previous chapter.</p>
    <p class="normal">The resource files and completed Xcode project for this chapter are in the <code class="inlineCode">Chapter20</code> folder of the code bundle for this book, which can be downloaded here:</p>
    <p class="normal"><a href="https://github.com/PacktPublishing/iOS-18-Programming-for-Beginners-Ninth-Edition%0D">https://github.com/PacktPublishing/iOS-18-Programming-for-Beginners-Ninth-Edition</a></p>
    <p class="normal">Check out the following video to see the code in action:</p>
    <p class="normal"><a href="https://youtu.be/MvOOKyBcVak%0D">https://youtu.be/MvOOKyBcVak</a></p>
    <p class="normal">Let’s start by modifying the Add New Journal Entry screen to display an image picker controller, which allows you to use the device camera or select a photo from the user’s photo library.</p>
    <h1 id="_idParaDest-262" class="heading-1">Creating a new UIImagePickerController instance</h1>
    <p class="normal">To make it easy for a <a id="_idIndexMarker876"/>user to use the camera or photo library, Apple implemented the <code class="inlineCode">UIImagePickerController</code> class. This class manages the system interfaces for taking photos and choosing items from the user’s photo library. An instance of this class is called an image picker controller, and it can display an image picker on the screen.</p>
    <p class="normal">If you have ever added a photo to a social media post, you will have seen what the image picker looks like. It typically displays either the view from your camera or a grid of photos from your photo library, and you can then choose a photo to be added to your post:</p>
    <figure class="mediaobject"><img src="img/B31371_20_01.png" alt="" width="575" height="644"/></figure>
    <p class="packt_figref">Figure 20.1: Simulator showing the image picker</p>
    <div><p class="normal">To learn more <a id="_idIndexMarker877"/>about the <code class="inlineCode">UIImagePickerController</code> class, see <a href="https://developer.apple.com/documentation/uikit/uiimagepickercontroller">https://developer.apple.com/documentation/uikit/uiimagepickercontroller</a>.</p>
    </div>
    <p class="normal">To display the image picker on the Add New Journal Entry screen, you’ll add a tap gesture recognizer instance to the image view in the <strong class="screenText">New Entry Scene</strong>, and you’ll add a method to create and display an image picker controller when the image view is tapped. Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">In the Project navigator, click the <strong class="screenText">Main</strong> storyboard file. Click <strong class="screenText">New Entry Scene</strong> in the document outline.</li>
      <li class="numberedList">Click the image view in the <strong class="screenText">New Entry</strong> <strong class="screenText">Scene</strong>. Click the Attributes inspector button and,<a id="_idIndexMarker878"/> under <strong class="screenText">View</strong>, tick the <strong class="screenText">User Interaction Enabled</strong> checkbox:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B31371_20_02.png" alt="" width="812" height="620"/></figure>
    <p class="packt_figref">Figure 20.2: Attributes inspector showing the User Interaction Enabled checkbox</p>
    <ol>
      <li class="numberedList" value="3">Click the Library button to display the library. Type <code class="inlineCode">tap</code> in the filter field. A <strong class="screenText">Tap Gesture Recognizer</strong> object will appear as one of the results. Drag it to the image view:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B31371_20_03.png" alt="" width="759" height="391"/></figure>
    <p class="packt_figref">Figure 20.3: Library with Tap Gesture Recognizer object selected</p>
    <ol>
      <li class="numberedList" value="4">Click the Navigator <a id="_idIndexMarker879"/>and Inspector buttons if you need more room to work. Click the Adjust Editor Options button and choose <strong class="screenText">Assistant</strong> from the pop-up menu:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B31371_20_04.png" alt="" width="691" height="375"/></figure>
    <p class="packt_figref">Figure 20.4: Adjust Editor Options menu with Assistant selected</p>
    <ol>
      <li class="numberedList" value="5">You should see the contents of the <code class="inlineCode">AddJournalEntryViewController</code> file in the assistant<a id="_idIndexMarker880"/> editor. <em class="keystroke">Ctrl</em> + <em class="keystroke">Drag</em> from the <strong class="screenText">Tap Gesture Recognizer</strong> in the document outline to the space between the <code class="inlineCode">locationSwitchValueChanged(_:)</code> method and the closing curly brace:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B31371_20_05.png" alt="" width="812" height="375"/></figure>
    <p class="packt_figref">Figure 20.5: Editor area showing drag destination</p>
    <ol>
      <li class="numberedList" value="6">In the pop-up dialog box, set <strong class="screenText">Name</strong> to <code class="inlineCode">getPhoto</code> and set <strong class="screenText">Type</strong> to <code class="inlineCode">UITapGestureRecognizer</code>. Click <strong class="screenText">Connect</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B31371_20_06.png" alt="" width="450" height="216"/></figure>
    <p class="packt_figref">Figure 20.6: Pop-up dialog box for action creation</p>
    <ol>
      <li class="numberedList" value="7">Verify that <a id="_idIndexMarker881"/>the <code class="inlineCode">getPhoto(_:)</code> method has been created in the <code class="inlineCode">AddJournalEntryViewController</code> class. Click the <strong class="screenText">x</strong> to close the assistant editor window:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B31371_20_07.png" alt="" width="467" height="436"/></figure>
    <p class="packt_figref">Figure 20.7: Assistant editor showing getPhoto(_:) method</p>
    <p class="normal">You have successfully <a id="_idIndexMarker882"/>added a tap gesture recognizer to the image view in the <strong class="screenText">New Entry</strong> <strong class="screenText">Scene</strong> and linked it to a <code class="inlineCode">getPhoto()</code> method in the <code class="inlineCode">AddJournalEntryViewController</code> class. Now you’ll modify the <code class="inlineCode">getPhoto()</code> method to create and display a <code class="inlineCode">UIImagePickerController</code> instance.</p>
    <p class="normal">Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">In the Project navigator, click the <strong class="screenText">AddJournalEntryViewController</strong> file. Add a new extension after all other code in the file to make the <code class="inlineCode">AddJournalEntryViewController</code> class declaration conform to the <code class="inlineCode">UIImagePickerControllerDelegate</code> and <code class="inlineCode">UINavigationControllerDelegate</code> protocols:
        <pre class="programlisting code-one"><code class="hljs-code">extension AddJournalEntryViewController: UIImagePickerControllerDelegate, UINavigationControllerDelegate {
}
</code></pre>
      </li>
      <li class="numberedList">Modify the <code class="inlineCode">getPhoto()</code> method as shown:
        <pre class="programlisting code-one"><code class="hljs-code">@IBAction func getPhoto(_ sender: UITapGestureRecognizer) {
<strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">let</strong><strong class="hljs-slc"> </strong><strong class="hljs-params-slc">imagePickerController</strong><strong class="hljs-slc"> </strong><strong class="hljs-params-slc">=</strong><strong class="hljs-slc"> </strong><strong class="hljs-type-slc">UIImagePickerController</strong><strong class="hljs-slc">()</strong>
<strong class="hljs-slc">  </strong><strong class="hljs-params-slc">imagePickerController.</strong><strong class="hljs-con-attribute-slc">delegate</strong><strong class="hljs-slc"> </strong><strong class="hljs-params-slc">=</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">self</strong>
<strong class="hljs-slc">  </strong><strong class="hljs-con-section-slc">#if</strong><strong class="hljs-slc"> </strong><strong class="hljs-con-section-slc">targetEnvironment(simulator)</strong>
<strong class="hljs-slc">  </strong><strong class="hljs-params-slc">imagePickerController.</strong><strong class="hljs-con-attribute-slc">sourceType</strong><strong class="hljs-slc"> </strong><strong class="hljs-params-slc">=</strong><strong class="hljs-slc"> </strong><strong class="hljs-params-slc">.</strong><strong class="hljs-con-attribute-slc">photoLibrary</strong>
<strong class="hljs-slc">  </strong><strong class="hljs-con-section-slc">#else</strong>
<strong class="hljs-params-slc">  imagePickerController.</strong><strong class="hljs-con-attribute-slc">sourceType</strong><strong class="hljs-params-slc"> = .</strong><strong class="hljs-con-attribute-slc">camera</strong>
<strong class="hljs-params-slc">  imagePickerController.</strong><strong class="hljs-con-attribute-slc">showsCameraControls</strong><strong class="hljs-params-slc"> = </strong><strong class="hljs-keyword-slc">true</strong>
<strong class="hljs-params-slc">  </strong><strong class="hljs-con-section-slc">#endif</strong>
<strong class="hljs-params-slc">  </strong><strong class="hljs-con-attribute-slc">present</strong><strong class="hljs-params-slc">(imagePickerController, </strong><strong class="hljs-con-attribute-slc">animated</strong><strong class="hljs-params-slc">: </strong><strong class="hljs-keyword-slc">true</strong><strong class="hljs-params-slc">)</strong>
}
</code></pre>
     
    <p class="normal-one">Let’s break this down:</p>
    <pre class="programlisting code-one"><code class="hljs-code">let imagePickerController = UIImagePickerController()
</code></pre>
    <p class="normal-one">This statement <a id="_idIndexMarker883"/>creates an instance of the <code class="inlineCode">UIImagePickerController</code> class and assigns it to <code class="inlineCode">imagePickerController</code>.</p>
    <pre class="programlisting code-one"><code class="hljs-code">imagePickerController.delegate = self
</code></pre>
    <p class="normal-one">This statement sets the image picker controller’s <code class="inlineCode">delegate</code> property to the <code class="inlineCode">AddJournalEntryViewController</code> instance.</p>
    <pre class="programlisting code-one"><code class="hljs-code">#if targetEnvironment(simulator)
imagePickerController.sourceType = .photoLibrary
#else
imagePickerController.sourceType = .camera
imagePickerController.showsCameraControls = true
#endif
</code></pre>
    <p class="normal-one">This block of code is known as a conditional compilation block. It starts with an <code class="inlineCode">#if</code> compilation directive and ends with an <code class="inlineCode">#endif</code> compilation directive. If you’re running in Simulator, only the statement setting the image picker controller’s <code class="inlineCode">sourceType</code> property to the photo library is compiled.</p>
    <p class="normal-one">If you’re running on an actual device, the statements setting the image picker controller’s <code class="inlineCode">sourceType</code> property to the camera and displaying the camera controls are compiled. This means that the image picker controller will use the photo library when running in Simulator and will use the camera when running on an actual device.</p>
    <div><p class="normal">You can learn more about conditional compilation blocks at this link: https://docs.swift.org/swift-book/documentation/the-swift-programming-language/statements/#Conditional-Compilation-Block.</p>
    </div>
    <pre class="programlisting code-one"><code class="hljs-code">present(imagePickerController, animated: true)
</code></pre>
    <p class="normal-one">This statement presents the image picker controller on the screen.</p> </li>
    </ol>
    <p class="normal">You’ve implemented all the code required to present the image picker controller when the image view is <a id="_idIndexMarker884"/>tapped. In the next section, you’ll implement the <code class="inlineCode">UIImagePickerControllerDelegate</code> methods that will be called when the user chooses an image or cancels.</p>
    <h1 id="_idParaDest-263" class="heading-1">Implementing UIImagePickerControllerDelegate methods</h1>
    <p class="normal">The <code class="inlineCode">UIImagePickerControllerDelegate</code> protocol has a set of methods that you must implement in your <a id="_idIndexMarker885"/>delegate object to interact with the image picker controller interface.</p>
    <div><p class="normal">To learn more about the <code class="inlineCode">UIImagePickerControllerDelegate</code> protocol, see <a href="https://developer.apple.com/documentation/uikit/uiimagepickercontrollerdelegate">https://developer.apple.com/documentation/uikit/uiimagepickercontrollerdelegate</a>.</p>
    </div>
    <p class="normal">When the image picker controller appears on screen, the user has the option of selecting a photo or canceling. If the user cancels, the <code class="inlineCode">imagePickerControllerDidCancel(_:)</code> method is triggered, and if the user selects a photo, the <code class="inlineCode">imagePickerController(_:didFinishPickingMediaWithInfo:)</code> method is triggered.</p>
    <p class="normal">You’ll implement these methods in your <code class="inlineCode">AddJournalEntryViewController</code> class now. In the Project navigator, click the <strong class="screenText">AddJournalEntryViewController</strong> file. Type the following code in the <code class="inlineCode">UIImagePickerControllerDelegate </code>extension:</p>
    <pre class="programlisting code"><code class="hljs-code">// MARK: - UIImagePickerControllerDelegate
func imagePickerControllerDidCancel(_ picker: UIImagePickerController) {
  dismiss(animated: true)
}
func imagePickerController(_ picker: UIImagePickerController, didFinishPickingMediaWithInfo info: [UIImagePickerController.InfoKey : Any]) {
  guard let selectedImage =
  info[UIImagePickerController.InfoKey.originalImage]
  as? UIImage else {
    fatalError("Expected a dictionary containing an image,
    but was provided the following: \(info)")
  }
  let smallerImage = selectedImage.preparingThumbnail(
  of: CGSize(width: 300, height: 300))
  photoImageView.image = smallerImage
  dismiss(animated: true)
}
</code></pre>
    <p class="normal">The <code class="inlineCode">imagePickerControllerDidCancel(_:)</code> method is triggered when the user cancels. The image picker controller <a id="_idIndexMarker886"/>is dismissed and the user is returned to the Add New Journal Entry screen.</p>
    <p class="normal">The <code class="inlineCode">imagePickerController(_:didFinishPickingMediaWithInfo:)</code> method is triggered when the user selects a photo. This photo is then assigned to <code class="inlineCode">selectedImage</code>. Next, the <code class="inlineCode">selectedImage</code> instance’s <code class="inlineCode">preparingThumbnail(of:)</code> method will be used to create a smaller image with a width and height of 300 points, the same as the size of the image view on the Journal Entry Detail screen. This image will then be assigned to the <code class="inlineCode">photoImageView</code> property and the image picker controller will be dismissed</p>
    <div><p class="normal">You can learn more about the <code class="inlineCode">preparingThumbnail(of:)</code> method at this link: <a href="https://developer.apple.com/documentation/uikit/uiimage/3750835-preparingthumbnail">https://developer.apple.com/documentation/uikit/uiimage/3750835-preparingthumbnail</a>.</p>
    </div>
    <p class="normal">All the required <code class="inlineCode">UIImagePickerController</code> delegate methods have been implemented. In the next section, you’ll modify the <code class="inlineCode">Info.plist</code> file so that your app will ask for permission to use<a id="_idIndexMarker887"/> the camera or photo library.</p>
    <h1 id="_idParaDest-264" class="heading-1">Getting permission to use the camera or photo library</h1>
    <p class="normal">Apple stipulates <a id="_idIndexMarker888"/>that your app must inform the user if it wishes to<a id="_idIndexMarker889"/> access the camera or photo library. If you don’t do this, your app will be rejected and will not be allowed on the App Store.</p>
    <p class="normal">You’ll modify the <code class="inlineCode">Info.plist</code> file in your project to make your app display messages when it tries to access the camera or photo library. Follow these steps:</p>
    <ol>
      <li class="numberedList" value="1">Click the <strong class="screenText">Info</strong> file in the Project navigator. Move your pointer over the <strong class="screenText">Information Property List</strong> row and click the <strong class="screenText">+</strong> button to create a new row.</li>
      <li class="numberedList">In the new row, set the <strong class="screenText">Key</strong> to <strong class="screenText">Privacy – Photo Library Usage Description</strong> and set the <strong class="screenText">Value</strong> to <code class="inlineCode">This app uses photos in your photo library when creating journal entries</code>.</li>
      <li class="numberedList">Add a second row using the <strong class="screenText">+</strong> button. This time, set the <strong class="screenText">Key</strong> to <strong class="screenText">Privacy – Camera Usage Description</strong> and set the <strong class="screenText">Value</strong> to <code class="inlineCode">This app uses your camera when creating journal entries</code>. Your <code class="inlineCode">Info.plist</code> file should look like the following when done:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B31371_20_08.png" alt="" width="812" height="164"/></figure>
    <p class="packt_figref">Figure 20.8: Info.plist with additional keys added</p>
    <ol>
      <li class="numberedList" value="4">Build and run your app. Go to the Add New Journal Entry screen and tap the image view. The image picker will appear:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B31371_20_09.png" alt="" width="527" height="825"/></figure>
    <p class="packt_figref">Figure 20.9: Simulator showing image picker</p>
    <p class="normal-one">If you run the app <a id="_idIndexMarker890"/>on<a id="_idIndexMarker891"/> an actual iOS device, a dialog box will appear asking for permission to use the camera. Click <strong class="screenText">OK</strong> to continue.</p>
    <ol>
      <li class="numberedList" value="5">Select a photo and it will appear in the image view on the Add New Journal Entry screen. Enter sample details for the journal entry and click <strong class="screenText">Save</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B31371_20_10.png" alt="" width="519" height="806"/></figure>
    <p class="packt_figref">Figure 20.10: Simulator showing photo on Add New Journal Entry screen</p>
    <ol>
      <li class="numberedList" value="6">You will be returned <a id="_idIndexMarker892"/>to<a id="_idIndexMarker893"/> the Journal List screen. Tap the newly added journal entry. You will see the photo is displayed on the Journal Entry Detail screen:</li>
    </ol>
    <figure class="mediaobject"><img src="img/B31371_20_11.png" alt="" width="502" height="825"/></figure>
    <p class="packt_figref">Figure 20.11: Simulator showing photo on the Journal Entry Detail screen</p>
    <p class="normal">You can now add photos to a <a id="_idIndexMarker894"/>new<a id="_idIndexMarker895"/> journal entry on the Add New Journal Entry screen and display them on the Journal Entry Detail screen. Fantastic!</p>
    <h1 id="_idParaDest-265" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, you completed the implementation of the Add New Journal Entry screen by adding a way for the user to get a photo from the camera or photo library, which then can be added to a new journal entry. First, you added a tap gesture recognizer to the image view in the New Entry scene and configured it to display an image picker controller. Then, you implemented the <code class="inlineCode">UIImagePickerDelegate</code> protocol, which allows you to get a photo from the camera or the photo library, and made the photo smaller before it is saved to the journal entry instance. You also modified the <code class="inlineCode">Info.plist</code> file to allow you to access the camera and photo library.</p>
    <p class="normal">You are now able to write your own apps that import photos from your camera or photo library.</p>
    <p class="normal">In the next chapter, you’ll implement a way for the user to search through the journal entries on the Journal List screen.</p>
    <h1 id="_idParaDest-266" class="heading-1">Join us on Discord!</h1>
    <p class="normal">Read this book alongside other users, experts, and the author himself. Ask questions, provide solutions to other readers, chat with the author via Ask Me Anything sessions, and much more. Scan the QR code or visit the link to join the community.</p>
    <p class="normal"><a href="https://packt.link/ios-Swift%0D">https://packt.link/ios-Swift</a></p>
    <p class="normal"><a href="https://packt.link/ios-Swift%0D"><img src="img/QR_Code2370024260177612484.png" alt="" width="177" height="177"/></a></p>
  </div>
</div></div></body></html>