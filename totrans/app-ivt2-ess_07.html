<html><head></head><body>
<div><div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch07" class="calibre1"/>Chapter 7. Learning About Loops with a Raffle App</h1></div></div></div><p class="calibre9">In the previous chapters, you used the <code class="email">if-then-else</code> control block several times. The <strong class="calibre10">if then else</strong> block enables apps to make decisions. It is one of the fundamental computing concepts that is present in any programming language. There is a second fundamental programming concept—the <strong class="calibre10">loop</strong>, which we will explore in this chapter. A loop allows a program to repeat code. More specifically, in App Inventor, a loop will let us execute a stack of blocks multiple times.</p><p class="calibre9">To illustrate the concept of a loop, we will create a digital raffle App in this chapter. In case you aren't familiar with a regular (nondigital) raffle, we will explain. A raffle organizer gives participants a ticket with a number on it and puts a duplicate of that ticket in a bowl. When all the tickets have been given out (and put in the bowl), the raffle organizer then randomly picks a ticket out of the bowl (often times with a blindfold on) and announces the winning ticket number. The participant with the matching ticket number then claims a prize.</p><p class="calibre9">Creating a digital raffle app using App Inventor is not a new idea. Others have created similar apps before. For example, <a class="calibre1" href="http://www.appinventor.org/content/howDoYou/RecordingInfo/phone">http://www.appinventor.org/content/howDoYou/RecordingInfo/phone</a> shows how to create a very simple digital raffle app. We will extend this idea and create a more versatile digital raffle app. For our digital Raffle App, participants send a text message with a specific code to the raffle organizer. The raffle organizer runs the app on his or her phone, which keeps track of all the participants' incoming text messages and phone numbers and selects a random winner. Then, the app notifies the winner that she or he has won and notifies the rest of the participants that they did not win. This is a fun participatory game for a party, event, or a meeting break.</p><p class="calibre9">In this chapter, you will learn how to do the following:</p><div><ul class="itemizedlist"><li class="listitem">Create a user interface for the Raffle App</li><li class="listitem">Create and initialize a list and a variable</li><li class="listitem">Use a texting component to send/receive text messages</li><li class="listitem">Add items to a list</li><li class="listitem">Select a random winner</li><li class="listitem">Notify the winner that he or she has won</li><li class="listitem">Use a loop to send the same notification e-mail to all the participants who did not win</li><li class="listitem">Clear out the list and the variable</li></ul></div></div>

<div><div><div><div><div><h1 class="title" id="calibre_pb_1"><a id="ch07lvl1sec47" class="calibre1"/>Creating the project and building the GUI</h1></div></div></div><p class="calibre9">In <a id="id318" class="calibre1"/>preparation of using the Raffle App, the raffle organizer will give two pieces <a id="id319" class="calibre1"/>of information to everyone who wishes to participate in the raffle: the organizer's phone number and a code. The raffle organizer can distribute this information by either sharing them verbally or writing then down for everyone to see. The participants will then send a text message to the raffle organizer's phone number with the code typed in the body of the text message. When the app (running on the raffle organizer's phone) receives all of the text messages containing the code, it will save the all the senders' phone numbers in a list. Then, the raffle organizer will click on a button to randomly select a winner from the list of phone numbers. The winning phone number will be displayed on the raffle organizer's phone <a id="id320" class="calibre1"/>screen, and the app will also send a text message notification <a id="id321" class="calibre1"/>to the winner's phone indicating that he or she has won. Meanwhile, the app will notify the rest of the participants that they did not win.</p></div></div>

<div><div><div><div><div><div><h2 class="title1" id="calibre_pb_2"><a id="ch07lvl2sec39" class="calibre1"/>Creating a new project</h2></div></div></div><p class="calibre9">You will start by <a id="id322" class="calibre1"/>creating a new project. At this point, this step will probably be very familiar to you as you have already done this several times in the previous chapters. As shown in the following screenshot, click on the <strong class="calibre10">Start new project</strong> button after logging into App Inventor. Then, in the following pop-up message box, give an appropriate name for this app. We will use the name <code class="email">Digital_Raffle</code>.</p><div><img src="img/00206.jpeg" alt="Creating a new project" class="calibre11"/></div><p class="calibre12"> </p></div></div></div>

<div><div><div><div><div><div><h2 class="title1" id="calibre_pb_3"><a id="ch07lvl2sec40" class="calibre1"/>Creating the User Interface (UI)</h2></div></div></div><p class="calibre9">Now that we <a id="id323" class="calibre1"/>have created a new project, it is time to add the first component that we will use, a Label. The raffle organizer will create a code to share with all the participants. Since the raffle organizer may conduct several raffles, we will use a label to display the code on the organizer's phone. For this app, we chose the code: <strong class="calibre10">I want to win</strong>. We will program the app to compare this code, <strong class="calibre10">I want to win</strong>, to any text message that the raffle organizer's phone receives. If it is a match, the app will save the associated phone number into a list. As shown in the following screenshot, drag a <strong class="calibre10">Label</strong> from the <strong class="calibre10">User Interface</strong> Palette drawer onto the <strong class="calibre10">Viewer</strong>:</p><div><img src="img/00207.jpeg" alt="Creating the User Interface (UI)" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">At this time, we would like to reiterate the importance of naming components appropriately. Proper naming helps programmers when they are creating behavior in the Blocks editor. Additionally, appropriate names make it easier to understand the logic of the code. Lastly, should you decide to extend this app six months after first creating it, aptly named components will help you remember the purpose of each component.</p><p class="calibre9">Given that, rename <strong class="calibre10">Label1</strong> as <code class="email">CodeLabel</code>. To rename <strong class="calibre10">Label1</strong>, select <strong class="calibre10">Label1</strong> in the <strong class="calibre10">Components</strong> column. Recall that selecting a component will make its background green on the screen, which indicates that it is active. Then, click on the <strong class="calibre10">Rename</strong> button at the bottom of the panel. In the pop-up window, enter the new name.</p><p class="calibre9">We will use this label to display the code (text) <strong class="calibre10">I want to win</strong>. Enter <strong class="calibre10">I want to win</strong> (without the quotes) in the <strong class="calibre10">Text</strong> property <a id="id324" class="calibre1"/>box. To make the code easily visible, we make the <strong class="calibre10">FontSize</strong> property <code class="email">45</code>. Finally, set <strong class="calibre10">Width</strong> of this label to <strong class="calibre10">Fill parent</strong>.</p><div><img src="img/00208.jpeg" alt="Creating the User Interface (UI)" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Next, we will add a button right below <strong class="calibre10">CodeLabel</strong>. This is the button that the raffle organizer will click on to select a winner. Drag a <strong class="calibre10">Button</strong> from the <strong class="calibre10">User Interface</strong> palette onto the <strong class="calibre10">Viewer</strong>, as shown in the following screenshot:</p><div><img src="img/00209.jpeg" alt="Creating the User Interface (UI)" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Rename <strong class="calibre10">Button1</strong> to <code class="email">WinnerButton</code>. By default, the <strong class="calibre10">Text</strong> property of the button shows <strong class="calibre10">Text for Button1</strong>. Change the <strong class="calibre10">Text</strong> property to something more informative by clicking in the text box and typing <strong class="calibre10">Pick Winner</strong>. Also, change the <strong class="calibre10">Width</strong> property to <strong class="calibre10">Fill parent</strong> so that the button is of the same width as the label above it.</p><div><img src="img/00210.jpeg" alt="Creating the User Interface (UI)" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">After adding CodeLabel and WinnerButton, add a third component, another label, to display the phone number of the winner. Just like the <strong class="calibre10">CodeLabel</strong>, Drag another <strong class="calibre10">Label</strong> below WinnerButton and rename it, <code class="email">WinnerLabel</code>. Since we will only use this label after a winner is selected, thus delete everything <a id="id325" class="calibre1"/>under the <strong class="calibre10">Text</strong> property, so that <strong class="calibre10">WinnerLabel</strong> does not show anything. To have a consistent look, set the <strong class="calibre10">Width</strong> property to <strong class="calibre10">Fill parent</strong>.</p><p class="calibre9">Finally, set the <strong class="calibre10">FontSize</strong> property to <code class="email">35</code> so that the winner's phone number when displayed is not too small. The following screenshot shows the app after <strong class="calibre10">WinnerLabel</strong> is added and configured:</p><div><img src="img/00211.jpeg" alt="Creating the User Interface (UI)" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Since the Raffle app might be used many times, we need to have a mechanism to reset the app. For this purpose, add <a id="id326" class="calibre1"/>one more button below <strong class="calibre10">WinnerLabel</strong>. Rename it <code class="email">ClearButton</code>, change the <strong class="calibre10">Width</strong> property of the button to <strong class="calibre10">Fill parent</strong>, and finally, change the <strong class="calibre10">Text</strong> property to <code class="email">Clear</code>, as shown in the following screenshot:</p><div><img src="img/00212.jpeg" alt="Creating the User Interface (UI)" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Next, we need some way for the app to send and receive text messages. For this, use the <strong class="calibre10">Texting</strong> component. You will find the <strong class="calibre10">Texting</strong> component in the <strong class="calibre10">Social</strong> Palette drawer. Drag the <strong class="calibre10">Texting</strong> Component onto the <strong class="calibre10">Viewer</strong>. As shown in the following image, the <strong class="calibre10">Texting</strong> component is a <strong class="calibre10">Non-visible component</strong> and is housed below the Viewer. We do not need to set any properties for this component.</p><div><img src="img/00213.jpeg" alt="Creating the User Interface (UI)" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">This completes the GUI of the Raffle app. In the next section, we will program the behavior of the app in Blocks editor.</p></div></div></div>

<div><div><div><div><div><div><h2 class="title1" id="calibre_pb_4"><a id="ch07lvl2sec41" class="calibre1"/>Programming the behavior of the Digital Raffle app</h2></div></div></div><p class="calibre9">To <a id="id327" class="calibre1"/>summarize, when the app receives text messages from participants, if a text message contains the indicated code (in this case, <strong class="calibre10">I want to win</strong>) in the body of the message, then the sender's phone number is added to a list. When the raffle organizer clicks the WinnerButton, the app will randomly select a winner from that list of phone numbers. Then, the app will send the winner a text message notifying him or her of the win. The app will also send text messages to all the other participants letting them know that they did not win.</p><p class="calibre9">We will achieve all of this by completing the following substeps:</p><div><ul class="itemizedlist"><li class="listitem">Create and initialize a list and a variable</li><li class="listitem">Receive text messages, and if the code matches, add the sender's number to the list</li><li class="listitem">Select a random item from the list (winner)</li><li class="listitem">Send a winner notification</li><li class="listitem">Send other participants a notification letting them know that they did not win</li></ul></div></div></div></div>

<div><div><div><div><div><div><h2 class="title1" id="calibre_pb_5"><a id="ch07lvl2sec42" class="calibre1"/>Creating and initializing the variable and list</h2></div></div></div><p class="calibre9">For this app, we will need a list to store all the participant's phone numbers. And we will also use a variable to temporarily store the winning number. To create the list and the variable, go to the <strong class="calibre10">Variables</strong> blocks panel and drag the topmost block <strong class="calibre10">initialize global name</strong> to as shown in the following screenshot. Do this twice.</p><div><img src="img/00214.jpeg" alt="Creating and initializing the variable and list" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Double-click on "<strong class="calibre10">name</strong>" inside both the blocks and type in new names, <strong class="calibre10">ListOfNumbers</strong> for the list and <strong class="calibre10">WinningNumber</strong> for the variable, as shown in the following screenshot:</p><div><img src="img/00215.jpeg" alt="Creating and initializing the variable and list" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Whenever you (as a programmer) create a list or variable, you need to initialize it with an initial value. For our list, we want to start out with an empty list. App Inventor makes this easy. In the <strong class="calibre10">Lists</strong> blocks, select the <strong class="calibre10">create empty list</strong> block, as shown in the following screenshot, and connect it to the <strong class="calibre10">initialize global ListOfNumbers to</strong> block:</p><div><img src="img/00216.jpeg" alt="Creating and initializing the variable and list" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">For the <strong class="calibre10">WinningNumber</strong> variable, we will initialize it to be <code class="email">0</code>. In the <strong class="calibre10">Math</strong> blocks, select the <strong class="calibre10">0</strong> block (shown in the following screenshot) and connect it to the <strong class="calibre10">initialize global WinningNumber to</strong> block:</p><div><img src="img/00217.jpeg" alt="Creating and initializing the variable and list" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">After completing these steps, the initialization blocks for the list and the variable will look like the following screenshot:</p><div><img src="img/00218.jpeg" alt="Creating and initializing the variable and list" class="calibre11"/></div><p class="calibre12"> </p></div></div></div>

<div><div><div><div><div><div><h2 class="title1" id="calibre_pb_6"><a id="ch07lvl2sec43" class="calibre1"/>Receiving text messages from participants</h2></div></div></div><p class="calibre9">In this <a id="id328" class="calibre1"/>section, you will learn how to receive text messages from participants and store their numbers in a list.</p><p class="calibre9">We added the nonvisible Texting1 component in the Designer tab when we created the UI. We will use this component to send and receive text messages. As shown in the following screenshot, this component has a single gold event block, when Texting1.MessageReceived. Whenever the raffle organizer's device receives any text message, this event will get triggered.</p><p class="calibre9">Click on the <strong class="calibre10">when Texting1.MessageReceived</strong> event block to add it to the <strong class="calibre10">Viewer</strong>. As shown in the following screenshot, this event has two associated variables—<strong class="calibre10">number</strong> and <strong class="calibre10">messageText</strong>. Whenever a text message is received and this event is triggered, the <strong class="calibre10">number</strong> variable contains the sender's phone number and <strong class="calibre10">messageText</strong> contains the content of the message.</p><div><h3 class="title2"><a id="note10" class="calibre1"/>Note</h3><p class="calibre9">When you want to store some data, you can create global variables. In previous steps, we explicitly created our own global variables called <strong class="calibre10">ListOfNumbers</strong> and <strong class="calibre10">WinningNumber</strong> and initialized them. Once you create a global variable, any block in your app can use that variable.</p><p class="calibre9">On the other hand, when an app is running, various events might also need to temporarily store data and hence, may need a variable. These variables, which are built into blocks, are called local variables. They appear in a block and can be accessed by hovering over them with a mouse. Their existence is limited to a particular event. Other blocks of the app cannot use them. In fact, if you try to use a variable outside the event block that they are a part of, you will get an error message. Examples of local variables are <strong class="calibre10">number</strong> and <strong class="calibre10">messageText</strong>; they are associated specifically with the block, <strong class="calibre10">when Texting1.MessageReceived</strong>.</p></div><p class="calibre9">Thus, the <strong class="calibre10">number</strong> and <strong class="calibre10">messageText</strong> variables store important data related to the <strong class="calibre10">when Texting1.MessageReceived</strong> event block. Whenever a text message is received, this event is triggered and the information <a id="id329" class="calibre1"/>related to the text message (the sender's number and the message text) is placed into these two variables and can be used by the blocks within that event.</p><div><img src="img/00219.jpeg" alt="Receiving text messages from participants" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Since the raffle organizer's phone can receive text messages unrelated to the raffle at the same time that it receives raffle text messages, we want to filter out the raffle related text messages. This is the main reason we include the code (<strong class="calibre10">I want to win</strong>) in our design, to filter out raffle related text messages.</p><p class="calibre9">Recall that the <strong class="calibre10">messageText</strong> variable associated with the <strong class="calibre10">when Texting1.MessageReceived</strong> event contains the text of the message. So, once a text message is received, we want the app to check whether the <strong class="calibre10">messageText</strong> variable matches <strong class="calibre10">I want to win</strong> or not. Can you think of what type of block we would use to determine whether or not the code matches?</p><p class="calibre9">If you thought of an <strong class="calibre10">if then</strong> block, you are right! Do you recall where to find it? Select an <strong class="calibre10">if then</strong> block and connect it to the <strong class="calibre10">when Texting1.MessageReceived</strong> event. As you already know, we need to plug in a condition block into the <code class="email">if</code> socket. In this case, we want to match two texts. App Inventor makes this easy. As shown in the following screenshot, in the <strong class="calibre10">Text</strong> blocks, select and connect the <strong class="calibre10">compare texts</strong> block to the empty <strong class="calibre10">if</strong> socket:</p><div><img src="img/00220.jpeg" alt="Receiving text messages from participants" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Since we want to check whether the two texts match, click on the downward pointing triangle next to the less-than sign and select the equals sign, as shown in the following screenshot:</p><div><img src="img/00221.jpeg" alt="Receiving text messages from participants" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Hover the mouse pointer over the light orange <strong class="calibre10">messageText</strong> variable in the event block. This will trigger a pop-up window, as shown in the following screenshot. Select the <strong class="calibre10">getMessageText</strong> block and place it within the first <a id="id330" class="calibre1"/>opening in the <strong class="calibre10">compare texts</strong> block to the left of the equals sign. This block will get the text from the incoming text message (any text message):</p><div><img src="img/00222.jpeg" alt="Receiving text messages from participants" class="calibre11"/></div><p class="calibre12"> </p><div><img src="img/00223.jpeg" alt="Receiving text messages from participants" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">For the second opening, we want to input the code we created so we can compare it to the text message received. If you recall, in the <code class="email">Designer</code> property, we set the <code class="email">Text</code> property of <strong class="calibre10">Codelabel</strong> to our code, <strong class="calibre10">I want to win</strong>. So, under <strong class="calibre10">Screen1</strong>, go to the <strong class="calibre10">CodeLabel</strong> blocks and select the <strong class="calibre10">CodeLabel.Text</strong> block.</p><p class="calibre9">Insert the <strong class="calibre10">CodeLabel.Text</strong> block into the opening to the right of the equals sign in the <strong class="calibre10">compare texts</strong> block, as shown in the following screenshot. We have now programmed the app to check to see whether the text message (<strong class="calibre10">messageText</strong>) matches the <code class="email">Text</code> property of the <strong class="calibre10">CodeLabel</strong> (the code, <strong class="calibre10">I want to win</strong>).</p><div><img src="img/00224.jpeg" alt="Receiving text messages from participants" class="calibre11"/></div><p class="calibre12"> </p></div></div></div>

<div><div><div><div><div><div><h2 class="title1" id="calibre_pb_7"><a id="ch07lvl2sec44" class="calibre1"/>Adding the phone numbers of all the participants to the list</h2></div></div></div><p class="calibre9">If the text <a id="id331" class="calibre1"/>message indeed contains the correct code, we know that the text message came from a raffle participant. Thus, we want the app to add the sender's phone number to the list that we created earlier. To do this, go to the <strong class="calibre10">List</strong> blocks and select the <strong class="calibre10">add items to list</strong> block, as shown in the following screenshot. Add it to the <strong class="calibre10">then</strong> opening of the <strong class="calibre10">if/then</strong> block.</p><div><img src="img/00225.jpeg" alt="Adding the phone numbers of all the participants to the list" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">The <strong class="calibre10">add items to list</strong> block needs two pieces of information, which we will attach to the empty sockets—the name of the list to add items to and the item to be added. To specify the list, go to the <strong class="calibre10">Variables</strong> block and select the <strong class="calibre10">get</strong> block and connect it to the <strong class="calibre10">list</strong> socket of the <strong class="calibre10">add items to list</strong> block.</p><div><img src="img/00226.jpeg" alt="Adding the phone numbers of all the participants to the list" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Then, click on the downward pointing triangle of the <strong class="calibre10">get</strong> block and select <strong class="calibre10">global ListOfNumbers</strong> from the drop-down menu as shown in the following screenshot. When we initialize a global variable, like we did for <strong class="calibre10">ListOfNumbers</strong>, it is then available for us to use throughout the app. This is why the name appears in the drop-down menu as an option.</p><div><img src="img/00227.jpeg" alt="Adding the phone numbers of all the participants to the list" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">As we mentioned before, the <strong class="calibre10">number</strong> variable associated with this <strong class="calibre10">Texting1.MessageReceived</strong> block contains the sender's phone number. You can use the <strong class="calibre10">get number</strong> block to access this number. Hover your mouse over <strong class="calibre10">number</strong> variable to view the pop-up window, as shown in the following image. Select the <strong class="calibre10">get number</strong> <a id="id332" class="calibre1"/>block and connect it to the <strong class="calibre10">item</strong> socket of the <strong class="calibre10">add items to list</strong> block.</p><div><img src="img/00228.jpeg" alt="Adding the phone numbers of all the participants to the list" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">The following screenshot shows the completed set of blocks for receiving text messages:</p><div><img src="img/00229.jpeg" alt="Adding the phone numbers of all the participants to the list" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Thus far, we have programmed the app to do the following: receive text messages, verify that the message texts contains the <strong class="calibre10">I want to win</strong> code, and if so, add the sender's phone number to the list that we created (<strong class="calibre10">ListOfNumbers</strong>). If the text message does not match the CodeLabel Text, then nothing happens (the phone number does not get added to the list.)</p></div></div></div>

<div><div><div><div><div><div><h2 class="title1" id="calibre_pb_8"><a id="ch07lvl2sec45" class="calibre1"/>Selecting a winner</h2></div></div></div><p class="calibre9">When designing the <a id="id333" class="calibre1"/>UI, we added a <strong class="calibre10">WinnerButton</strong> that the raffle organizer will click to randomly select a winner. App Inventor also makes this easy. We will use the <strong class="calibre10">pick a random item</strong> block to select a winner from <strong class="calibre10">ListOfNumbers</strong>. You can find the <strong class="calibre10">pick a random item</strong> block under the <strong class="calibre10">Lists</strong> Blocks, as shown in the following screenshot:</p><div><img src="img/00230.jpeg" alt="Selecting a winner" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Since the raffle organizer will click a button to pick a winner select the <strong class="calibre10">WinnerButton.Click</strong> event (found in the <strong class="calibre10">WinnerButton</strong> blocks). Next, go to the <strong class="calibre10">Variables</strong> blocks, select a <strong class="calibre10">set to</strong> block, and place it within the <strong class="calibre10">WinnerButton.Click</strong> event. In the <strong class="calibre10">set to</strong> block, click on the downward pointing triangle and select <strong class="calibre10">global WinningNumber</strong>. Connect to this block with the <strong class="calibre10">pick a random item</strong> block that we selected earlier. The <strong class="calibre10">pick a random item</strong> block has an open socket indicating a list. Can you figure out which block would connect to it? Since we want the random item (phone number) to be selected from our list of numbers, copy and paste the <strong class="calibre10">get global ListOfNumbers</strong> block from the <strong class="calibre10">add items to list</strong> block (in the previous section) and connect it to the <strong class="calibre10">pick a random item</strong> block. The following <a id="id334" class="calibre1"/>screenshot shows the completed set of blocks up to this point:</p><div><img src="img/00231.jpeg" alt="Selecting a winner" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">What exactly are we coding here? We are programming the app to select a random item (phone number) from the list (of all the phone numbers) and store it in the <strong class="calibre10">WinningNumber</strong> variable (<strong class="calibre10">set global WinningNumber to block</strong>). You might be wondering why do we need to do this. As it will be evident later in this chapter, we will reuse this winning number several times. Hence, we need to temporarily store it somewhere.</p><p class="calibre9">Once we get the winning number, we want the app to display the winning number on the organizer's phone. To do this, we will set the <strong class="calibre10">Text</strong> property of <strong class="calibre10">WinnerLabel</strong> to <strong class="calibre10">WinningNumber</strong>. As shown in the following screenshot, select <strong class="calibre10">set WinnerLabel.Text to</strong> (under the <strong class="calibre10">WinnerLabel</strong> blocks) and connect it to the <strong class="calibre10">get global WinningNumber</strong> block (which you will find in the <strong class="calibre10">Variables</strong> block drawer). It will be listed just as an orange <strong class="calibre10">get</strong> block, and you will need to click on the downward pointing triangle to select <strong class="calibre10">global WinningNumber</strong> from the drop-down list. Your blocks should resemble those in the following screenshot:</p><div><img src="img/00232.jpeg" alt="Selecting a winner" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Let's recap. We have programmed the app to randomly select a winner (phone number) from all the participant phone numbers (global <strong class="calibre10">ListOfNumbers</strong>), we will have saved the winning phone number into the <strong class="calibre10">Variable Global WinningNumber</strong> variable and displayed the winning number in <strong class="calibre10">WinnerLabel</strong>. The next step is notifying the winner by sending a text message to the winning number.</p></div></div></div>

<div><div><div><div><div><div><h2 class="title1" id="calibre_pb_9"><a id="ch07lvl2sec46" class="calibre1"/>Notifying the winner</h2></div></div></div><p class="calibre9">The non-visible <a id="id335" class="calibre1"/>
<strong class="calibre10">Texting1</strong> component that we used before to receive the text messages from participants will be used here again. To send a text message to the winner, we will set both the <strong class="calibre10">Texting1.Message</strong> property and the <strong class="calibre10">Texting1.PhoneNumber</strong> property. Find the set blocks under the <strong class="calibre10">Texting1</strong> blocks. Select and place them inside the <strong class="calibre10">WinnerButton.Click</strong> event, as shown in the following screenshot. For the <strong class="calibre10">Texting1.Message</strong> property, connect a <strong class="calibre10">blank Text</strong> block and type in the message <strong class="calibre10">"Congratulations!! You won"</strong>. For the <strong class="calibre10">Texting1.PhoneNumber</strong> property, copy and paste the <strong class="calibre10">global WinningNumber</strong> block and connect it to the empty socket.</p><p class="calibre9">The <strong class="calibre10">Texting1</strong> component has a purple block called <strong class="calibre10">call Texting1.SendMessage</strong>. This is the block that actually sends a text message. The <strong class="calibre10">PhoneNumber</strong> property of the <strong class="calibre10">Texting1</strong> component is used for the recipient's number and the <strong class="calibre10">Message</strong> property is used for the body of the text. Hence, it is important to set these two properties correctly before actually sending the text with the <strong class="calibre10">call Texting1.SendMessage</strong> <a id="id336" class="calibre1"/>block. As shown in the following screenshot, go to the <strong class="calibre10">Texting1</strong> blocks again, and drag the purple <strong class="calibre10">call Texting1.SendMessage</strong> block and place it at the bottom of all the blocks:</p><div><img src="img/00233.jpeg" alt="Notifying the winner" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">We have now coded the Raffle app to send a congratulatory notification to the winner.</p></div></div></div>

<div><div><div><div><div><div><h2 class="title1" id="calibre_pb_10"><a id="ch07lvl2sec47" class="calibre1"/>Notifying everyone else</h2></div></div></div><p class="calibre9">Usually, the <a id="id337" class="calibre1"/>winner is excited to have won, and announces aloud that she or he has won. But in case this doesn't happen, we want to send a notification message to all the participants who did not win to ensure that no one is left wondering about the raffle outcome. It seems logical to send a <strong class="calibre10">"Sorry, You did not win"</strong> notification to all the items in <strong class="calibre10">ListOfNumbers</strong>, since it is storing all of the participants' phone numbers. However, there is a flaw to this logic. Can you guess what the problem is? Currently, <strong class="calibre10">ListOfNumbers</strong> contains all of numbers, including the winning number. So, before we use the <strong class="calibre10">ListOfNumbers</strong> as the source for the "<strong class="calibre10">Sorry</strong>" notification, we need to remove the winning number from this list.</p><p class="calibre9">As shown in the following screenshot, we will use the <strong class="calibre10">remove list item</strong> block to remove the winning number. You can find <strong class="calibre10">remove list item</strong> in the <strong class="calibre10">List</strong> blocks. This block needs two pieces of information (hence, the two empty sockets): the name of the list and the position (index) of the item to be removed. Specifying the name of the list is easy. Just copy and paste and connect the <strong class="calibre10">global ListOfNumbers</strong> block.</p><div><img src="img/00234.jpeg" alt="Notifying everyone else" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Finding the position of the winning number is a little more involved. We will need to add another <strong class="calibre10">List</strong> block, that is, the <a id="id338" class="calibre1"/>
<strong class="calibre10">index in list</strong> block to figure out this position. As shown in the following screenshot, connect the <strong class="calibre10">index in list</strong> block to the empty <strong class="calibre10">index</strong> socket in the <strong class="calibre10">remove list item</strong> block:</p><div><img src="img/00235.jpeg" alt="Notifying everyone else" class="calibre11"/></div><p class="calibre12"> </p><div><h3 class="title2"><a id="note11" class="calibre1"/>Note</h3><p class="calibre9"><strong class="calibre10">Index</strong> is the position of an item in a list.</p><p class="calibre9">The <strong class="calibre10">remove</strong> list item block can remove an item from a certain position. First, we need to figure out the position of the winning number (the thing) in the list. Then, we will use this position to remove the winning number.</p></div><p class="calibre9">The <strong class="calibre10">index in list</strong> block finds the position of the item specified in the <strong class="calibre10">thing</strong> socket from the list specified in the <strong class="calibre10">list</strong> socket. So, we will copy and paste, connect the get <strong class="calibre10">global WinningNumber</strong> block to the <strong class="calibre10">thing</strong> socket, and add another <strong class="calibre10">get global ListOfNumbers</strong> block to the <strong class="calibre10">list</strong> socket. Your code will look as follows:</p><div><img src="img/00236.jpeg" alt="Notifying everyone else" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Let's recap. We have identified the position of the winning number in the list and have removed the item at that position, thereby removing the winning number from the list. Now, we are ready to use this list to send a notification to the participants who did not win.</p><p class="calibre9">Just like the notification message we created for the winner previously, we will reuse the <strong class="calibre10">Texting1</strong> component to send out <a id="id339" class="calibre1"/>notifications to all the participants who did not win. Copy and paste the <strong class="calibre10">set Texting1. Message to</strong> block (that will copy the attached text block). Change the text in the Text block from "<strong class="calibre10">Congratulations !! You won</strong>" to "<strong class="calibre10">Sorry, You did not win</strong>". Feel free to change this message and personalize it to your liking.</p><div><h3 class="title2"><a id="note12" class="calibre1"/>Note</h3><p class="calibre9">Note that blocks execution is always top down. So effectively, the winning number is removed from <strong class="calibre10">ListOfNumbers</strong> before the notification is sent to the losing participants. And, <strong class="calibre10">Texting1.Message</strong> set to the block message "<strong class="calibre10">Sorry, You did not win.</strong>" overwrites the previous text message "<strong class="calibre10">Congratulations!! You won</strong>".</p></div><div><img src="img/00237.jpeg" alt="Notifying everyone else" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">An important difference between sending the notification to the winner and this notification is that this notification will be sent to <em class="calibre19">all</em> the numbers in the list <strong class="calibre10">ListOfNumbers</strong>, except the winning number. Essentially, this <a id="id340" class="calibre1"/>means that we need to repeat the <strong class="calibre10">set Texting1.PhoneNumber to</strong> block, followed by the <strong class="calibre10">callTexting1.SendMessage</strong> block—once for each item in <strong class="calibre10">ListOfNumbers</strong>. And this brings us to the concept of loops!</p></div></div></div>

<div><div><div><div><div><div><h2 class="title1" id="calibre_pb_11"><a id="ch07lvl2sec48" class="calibre1"/>Using loops</h2></div></div></div><p class="calibre9">A basic programming <a id="id341" class="calibre1"/>concept present in any programming language, including App Inventor, is called loop. Loops let us repeat code and thus we will use a loop here. We will place two blocks in the loop: <strong class="calibre10">set Texting1.PhoneNumber to</strong> and <strong class="calibre10">call Texting1.SendMessage</strong>.</p><p class="calibre9">Loops are available in the <strong class="calibre10">Control</strong> blocks drawer. There are different types of loops. We will use the <strong class="calibre10">for each item in list</strong> loop, as shown in the following screenshot. Select the <strong class="calibre10">for each item in list</strong> loop and place it at the bottom of the <strong class="calibre10">when WinnerButton.Click</strong> event. This loop requires us to specify a list that will be used in conjunction with the loop. The loop lets us repeat whatever block we place within the loop once for each item in the associated list. While the loop is running, during any iteration, the corresponding item from the list will be placed in the item variable as well. When the loop executes for the first time, the first item of <strong class="calibre10">ListOfNumbers</strong> will be available in the item variable associated with the loop. Similarly, when the loop executes for the second time, the second item will be available in the item variable and so on:</p><div><img src="img/00238.jpeg" alt="Using loops" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">This loop will execute as many times as the number of number of phone numbers in <strong class="calibre10">ListOfNumbers</strong>. To specify the list, just copy and paste and connect the <strong class="calibre10">get global ListOfNumbers</strong> block to the empty list socket in the loop.</p><div><img src="img/00239.jpeg" alt="Using loops" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Now that the outline <a id="id342" class="calibre1"/>of the loop is ready, we need specify the body of the loop. First, drag the <strong class="calibre10">set Texting1.PhoneNumber to</strong> block into the <em class="calibre19">do</em> part of the loop, as shown in the following screenshot:</p><div><img src="img/00240.jpeg" alt="Using loops" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Next, hover your mouse over the item variable in the <strong class="calibre10">for each item in list</strong> block, and drag the <strong class="calibre10">get item</strong> block and connect it to the empty socket in the <strong class="calibre10">set Texting1.PhoneNumber to</strong> block, as shown in the following screenshot:</p><div><img src="img/00241.jpeg" alt="Using loops" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">Next, copy <a id="id343" class="calibre1"/>and paste and place the purple <strong class="calibre10">call Texting1.SendMessage</strong> block into the <strong class="calibre10">do</strong> part of the loop at the very bottom, as shown in the following screenshot:</p><div><img src="img/00242.jpeg" alt="Using loops" class="calibre11"/></div><p class="calibre12"> </p><p class="calibre9">This loop accesses each item on the list one at a time, sets it as <strong class="calibre10">Texting1.PhoneNumbers</strong>, and sends out a text message to that phone number. So, this loop is allowing us to repeat the <strong class="calibre10">set Texting1.PhoneNumber to</strong> block, followed by the <strong class="calibre10">call Texting1.SendMessage</strong> block multiple times (for each item in <strong class="calibre10">ListofNumbers</strong>).</p><p class="calibre9">The digital raffle is <a id="id344" class="calibre1"/>now complete. The winner has been notified of the win and the rest of the participants have been notified that they did not win (note that a prize of some sort is usually given to the winner).</p></div></div></div>

<div><div><div><div><div><div><h2 class="title1" id="calibre_pb_12"><a id="ch07lvl2sec49" class="calibre1"/>Clearing out the list and variable</h2></div></div></div><p class="calibre9">After using the <a id="id345" class="calibre1"/>Raffle app, if you want to conduct another raffle with a different group of participants, you will need to clear out the list <strong class="calibre10">ListOfNumbers</strong> the variable <strong class="calibre10">WinningNumber</strong>, two things that were expressly created by us (the programmers). The other variables used in the app were local variables (<strong class="calibre10">number</strong> and <strong class="calibre10">messageText</strong> from the <strong class="calibre10">Texting1.MessageReceived</strong> event). These were not created by us, but rather generated by the blocks themselves; thus, these are used and cleared out automatically by the program.</p><p class="calibre9">There are two ways to clear out the list and variable to reset the app. The first way doesn't require programming. You can simply close the application and reopen it. This will reset the list to empty and the <strong class="calibre10">WinningNumber</strong> to 0. Can you guess the second way to reset the app? If you recall, we created a <strong class="calibre10">ClearButton</strong> feature for the UI in the Designer. We can program this <strong class="calibre10">ClearButton</strong> to clear out the app.</p><p class="calibre9">In the <strong class="calibre10">ClearButton</strong> blocks, select the <strong class="calibre10">ClearButton.Click</strong> event. This block will help us clear out the list that stored the participants' phone numbers and the variable that stored the <strong class="calibre10">WinningNumber</strong>. Recall when we started coding the app, we initialized our global variables. We set <strong class="calibre10">list</strong> to be empty and the variable to be <code class="email">0</code>. So now, in the <strong class="calibre10">when ClearButton.Click</strong> event, add blocks to do the same thing. You've already programmed this once before in this app, so we imagine that you will be a pro at configuring these blocks again. But, just in case you need a review, select the <strong class="calibre10">set global ListOfNumbers</strong> block and connect it to the <strong class="calibre10">create empty list</strong> block, and select the <strong class="calibre10">set global WinningNumber</strong> block and set it to <code class="email">0</code>. Your final set of blocks will resemble the following screenshot:</p><div><img src="img/00243.jpeg" alt="Clearing out the list and variable" class="calibre11"/></div><p class="calibre12"> </p></div></div></div>
<div><div><div><div><h1 class="title" id="calibre_pb_0"><a id="ch07lvl1sec48" class="calibre1"/>Summary</h1></div></div></div><p class="calibre9">In this chapter, we created a useful and fun app that you can use to conduct a digital raffle. We explored global and local variables along with many facets of the Texting Component to send and receive text messages. We also learned about some advanced blocks related to lists—selecting random list items, searching for an item on a list, and removing an item. Finally, we explored an important fundamental concept of programming—loops. We saw how loops enabled us to repeat behaviors (a stack of blocks) multiple times.</p><p class="calibre9">In the next chapter, we will provide some tips on expanding your mobile app development skills with designing hints and sharing options.</p></div></body></html>