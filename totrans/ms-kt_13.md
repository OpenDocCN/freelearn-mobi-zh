# 13

# 发布您的应用

一旦我们出色的应用开发完成，接下来的阶段就是将这些应用交付给我们的目标受众。这是通过在 Google Play 商店发布我们的应用来实现的。本章将重点介绍这一过程。

在本章中，我们将逐步学习如何在 Google Play 商店发布新应用。我们将介绍如何创建签名应用包，以及回答有关我们应用内容的问题、创建发布、设置用户如何访问我们的应用——无论是通过受控测试轨道还是公开，以及更多。所有这些是我们发布第一个应用到 Play 商店所必需的。此外，我们还将了解一些 Google Play 商店政策以及如何始终遵守规定，以避免我们的应用被移除或我们的账户被禁用。

在本章中，我们将介绍以下主要主题：

+   为发布准备我们的应用

+   将我们的应用发布到 Google Play 商店

+   Google Play 商店政策概述

# 技术要求

要遵循本章的说明，您需要下载 Android Studio Hedgehog 或更高版本([`developer.android.com/studio`](https://developer.android.com/studio))。

您可以使用上一章的代码来遵循本章的说明。您可以在 GitHub 上找到本章的代码([`github.com/PacktPublishing/Mastering-Kotlin-for-Android/tree/main/chapterthirteen`](https://github.com/PacktPublishing/Mastering-Kotlin-for-Android/tree/main/chapterthirteen))。

# 为发布准备我们的应用

在我们将应用上传到 Google Play 商店之前，我们必须做一些准备工作来为发布做准备。我有一个**清单**，每次发布应用时我都会过一遍。在本节中，我们将讨论这个清单。这个清单有助于确保我们在发布应用时不会忘记任何事情，并且应用是可用的。我们将在本书的*第十五章*中稍后处理一些清单项目，但在这里提一下它们是有价值的。

这里是清单：

+   向您的应用中添加分析

+   将崩溃报告添加到您的应用中

+   关闭日志和调试

+   国际化和本地化您的应用

+   改进错误信息

+   在不同的设备上测试您的应用

+   提供适当的反馈渠道

+   减小应用的大小

+   使用 Android App Bundle

+   启用最小化和混淆

现在，让我们更详细地了解每一项。

## 向您的应用中添加分析

向应用中添加**分析**有助于获取关于应用发布后表现的数据。这有助于我们做出改进应用的决策。Firebase Analytics、Google Analytics、Flurry 和 Mixpanel 等平台提供此类服务。我们将在本书的*第十五章*中添加 Firebase Analytics 到我们的应用。

## 将崩溃报告添加到您的应用中

**崩溃报告**库帮助我们获取我们应用的崩溃报告。这有助于修复导致崩溃的 bug。这在用户使用我们的应用时捕捉崩溃和堆栈跟踪时非常有帮助。我们将在本书的*第十五章*中将 Firebase Crashlytics 添加到我们的应用中作为我们的崩溃报告库。还有其他可以使用的崩溃报告工具，例如 Sentry、Bugsnag 和 Raygun。始终权衡哪种工具最适合我们的用例是很好的。

## 关闭日志和调试

为了确保我们不向其他用户暴露我们应用的任何敏感信息，我们必须确保我们的发布构建中没有启用**日志**或**调试**。

## 国际化和本地化您的应用

如果一个应用针对不同的国家，我们必须确保我们本地化和国际化该应用。这意味着我们必须将应用翻译成我们目标国家的语言。通过国际化，一个结构良好的代码库可以无缝集成辅助功能并支持多种语言。Unicode 支持确保与各种语言的字符兼容，增强可访问性。本地化适应内容、语言和文化细微差别，使我们的应用更容易满足有语言相关需求的用户。适应日期、时间和数字格式，以及视觉元素，有助于提高应用的可访问性和可用性。我们必须确保我们的应用在我们目标的不同国家运行良好。

## 改进错误信息

随着我们的应用发布，我们必须确保以用户易于理解的方式显示**错误信息**。我们必须避免显示针对开发者的错误信息。有了分析工具，我们总能记录错误的详细技术信息，并能够知道是什么原因导致错误。

## 在不同设备上测试您的应用

这是一个非常重要的清单项。由于最终用户通常不使用相同的设备和操作系统，因此我们在不同设备上测试应用非常重要。这有助于我们确保我们的应用在不同设备上运行良好，包括不同屏幕尺寸和不同操作系统。我们可以始终利用 Firebase Test Lab 等服务在不同设备上测试应用。Firebase Test Lab([`firebase.google.com/docs/test-lab`](https://firebase.google.com/docs/test-lab))提供各种物理和虚拟设备，我们可以使用这些设备来测试应用。

## 提供适当的反馈渠道

有时，即使完成了所有这些清单项，用户可能还是会遇到我们没有预料到的问题。我们必须确保我们为用户提供适当的 **反馈渠道**，以便他们可以联系我们。这有助于确保我们收到用户的反馈，并能修复他们可能遇到的问题。这也让用户感觉到我们关心他们，并准备好帮助他们。反馈渠道可以是电子邮件、社交媒体、电话号码或任何其他我们可以用来回应用户的渠道。

## 减小你的应用大小

我们必须确保我们的应用不要太大，尽可能减小其大小。这有助于确保我们的应用下载和安装得更快。我们通过从应用中移除任何未使用的资源来实现这一点。我们还可以压缩与应用捆绑的任何音频或图像。对于图像，我们应尽可能使用矢量图像。这些图像尺寸非常小，并且在不同屏幕尺寸上都能很好地缩放。

## 使用 Android App Bundle

**Android App Bundle** (**AAB**) 是一种发布格式，它包含了应用的所有编译代码和资源，但将 **Android 包工具包** (**APK**) 的生成和签名推迟到 Google Play。这有助于减小应用的大小。使用 Android App Bundle，我们可以从更小的应用中受益，能够按需提供一些功能，并且可以向用户交付即时应用体验。

**Android Studio** 提供了一种创建已签名的 Android App Bundle 的方法。Android 要求所有 AAB 必须在上传到 Google Play 商店之前使用证书进行签名。签名包允许进行大小优化和动态交付，并简化了应用签名过程。

要创建一个已签名的 Android App Bundle，我们需要导航到 **构建** | **生成已签名的包或 APK**，如图所示：

![图 13.1 – 生成已签名的包](img/B19779_13_01.jpg)

图 13.1 – 生成已签名的包

如前一个屏幕截图所示，AAB 提供了我们已经讨论过的各种好处。点击 **下一步** 继续此过程：

![图 13.2 – 选择你的密钥库证书](img/B19779_13_02.jpg)

图 13.2 – 选择你的密钥库证书

在此步骤中，我们选择创建一个新的密钥库证书或使用现有的一个。点击 **创建新...** 来创建一个新的密钥库证书。然后，你会看到一个以下对话框：

![图 13.3 – 创建新的密钥库证书](img/B19779_13_03.jpg)

图 13.3 – 创建新的密钥库证书

在此对话框中，我们填写密钥库证书的详细信息。确保你使用一个你可以记住并存储在一个你可以随时访问的地方的密码。这是因为后续的发布将需要使用相同的证书进行签名。

此外，确保以 `.jks` 扩展名保存它。一旦填写完表格，点击**确定**以保存证书。这会将您带回到 *图 13**.2* 中显示的对话框，但现在已填写了证书详情。点击**下一步**继续处理过程。您将看到一个以下对话框：

![图 13.4 – 选择构建变体](img/B19779_13_04.jpg)

图 13.4 – 选择构建变体

在这里，我们将选择要签名的构建变体。我们将选择**发布**构建变体。点击**创建**以创建已签名的 Android App Bundle。Gradle 将构建已签名的 Android App Bundle。一旦过程完成，您将看到一个以下通知：

![图 13.5 – 生成已签名包的通知](img/B19779_13_05.jpg)

图 13.5 – 生成已签名包的通知

您可以选择**分析**来分析包，或者选择**定位**来定位包所在的文件夹。我们稍后将在将我们的应用上传到 Google Play 商店时使用这个包。

## 启用压缩和混淆

压缩和混淆有助于减小应用的大小。压缩会移除应用中的任何未使用代码。混淆有助于使代码不可读。压缩通过移除不必要的字符和重命名变量来减小代码库的大小，从而减小 APK 的大小并提高应用性能。另一方面，混淆侧重于重命名类、方法和字段以掩盖其原始名称，增强应用的安全性并防止逆向工程。这些技术共同通过优化代码大小并使黑客难以逆向工程应用，有助于创建更小、更快、更安全的 Android 应用程序。我们这样做是为了发布构建。

让我们转到我们的应用级别的 `build.gradle.kts` 文件并修改如此处所示的 `buildTypes` 块：

```kt
buildTypes {
    release {
        isMinifyEnabled = true
        isShrinkResources = true
        setProguardFiles(
            listOf(
                getDefaultProguardFile("proguard-android.txt"),
                "proguard-rules.pro"
            )
        )
    }
    debug {
        isMinifyEnabled = false
        isShrinkResources = false
    }
}
```

我们已经为我们的发布构建启用了压缩和混淆。我们还将调试构建的压缩和混淆禁用。这是因为我们希望在开发时能够调试我们的应用。完成此操作后，建议在将发布构建上传到 Google Play 商店之前，在本地运行发布构建。

这是因为当我们启用压缩和混淆时，可能会移除一些代码。这可能会导致我们的应用崩溃。我们必须检查并确定是否需要添加关于如何混淆我们的代码的规则。

我们通过在 `proguard-rules.pro` 文件中添加规则来实现这一点。例如，为了使 Retrofit 仍然对我们的 JSON 响应进行序列化，我们必须确保我们的模型类没有被混淆。

现在，让我们导航到 `proguard-rules.pro` 文件并添加以下规则：

```kt
-keep class com.packt.chapterthirteen.data.Cat.** { *; }
-keep class com.packt.chapterthirteen.data.CatEntity.** { *; }
# With R8 full mode generic signatures are stripped for classes that are not
# kept. Suspend functions are wrapped in continuations where the type rgument
# is used.
-keep,allowobfuscation,allowshrinking class kotlin.coroutines.Continuation
-keep,allowobfuscation,allowshrinking interface retrofit2.Call
-keep,allowobfuscation,allowshrinking class retrofit2.Response
```

在这些规则生效的情况下，当我们的代码被压缩时，我们指定的类将不会被混淆。由于我们的应用不是很大，我们没有很多规则。对于大型应用，请确保您彻底测试并检查您的依赖项文档，以确定您需要添加哪些规则。

在 **构建变体** 选项卡上，选择 **发布** 构建变体并运行发布构建，如下所示：

![图 13.6 – 发布构建变体](img/B19779_13_06.jpg)

图 13.6 – 发布构建变体

在选择发布构建变体后，我们需要设置我们之前创建的密钥签名证书，以便我们的发布变体可以运行。为此，让我们在我们的应用级别的 `build.gradle.kts` 文件中添加以下内容：

```kt
signingConfigs {
    create("release") {
        storeFile = file("../keystore/packt.jks")
        storePassword = "android"
        keyAlias = "packt"
        keyPassword = "android"
    }
}
```

在前面的代码中，我们在 `signingConfigs` 块中创建了一个新的配置，名为 `release`。我们指定了 `keyAlias`、`keyPassword`、`storeFile` 和 `storePassword`。密钥库文件位于此项目的根目录中，如代码片段所示。如果您将其保存在了不同的位置，请确保更改路径。

点击 `signingConfig` 以选择我们的发布构建类型。为此，让我们在我们的发布构建类型中添加以下内容：

```kt
signingConfig = signingConfigs.getByName("release")
```

现在我们可以本地运行发布构建。然而，发布构建的构建时间比调试构建长。应用运行后，我们应该能够在应用中看到我们的可爱猫咪图片：

![图 13.7 – 在应用中查看可爱的猫咪图片](img/B19779_13_07.jpg)

图 13.7 – 在应用中查看可爱的猫咪图片

我们的清单已经完成，我们已经有了一个已签名的 AAB。在下一节中，我们将把我们的应用上传到 Google Play 商店。

# 将我们的应用发布到 Google Play 商店

在您可以将应用发布到 Google Play 商店之前，您需要有一个开发者账户。您可以通过在 Google Play 上注册（[`play.google.com/console/signup`](https://play.google.com/console/signup)）来获取一个账户。

您可以创建自己的账户或组织的账户，如下所示：

![图 13.8 – 创建开发者账户](img/B19779_13_08.jpg)

图 13.8 – 创建开发者账户

选择 **Yourself** 选项将显示创建个人账户的说明：

![图 13.9 – 为自己创建开发者账户](img/B19779_13_09.jpg)

图 13.9 – 为自己创建开发者账户

如前图所示，您需要一个用户可以联系您的电子邮件地址，以及 Google Play 可以联系您的另一个电子邮件地址。您还需要为 Google Play 账户支付 25 美元的终身注册费。如果您还没有账户，您可以继续购买，因为这是一个非常简单的流程。

一旦您开通了 Google Play Console 账户，您将看到以下界面：

![图 13.10 – Google Play Console 登录页面](img/B19779_13_10.jpg)

图 13.10 – Google Play Console 登录页面

这显示了如果您已经有一些应用，则会显示您所有应用的列表。它还显示了开发者账户名称和账户 ID。在左侧，我们有一个导航抽屉，提供了与我们的开发者账户相关的几个选项。在右上角，我们有一个按钮，我们可以点击创建一个应用。让我们点击“**创建应用**”按钮。然后我们将看到一个需要填写一些字段的页面：

![图 13.11 – 创建您的应用](img/B19779_13_11.jpg)

图 13.11 – 创建您的应用

在这里，我们需要填写应用名称并设置默认语言。我们还要选择我们的应用是应用还是游戏，并指定它将是免费应用还是付费应用。

最后，我们接受显示的声明。让我们通过点击底部的“**创建应用**”来完成。这将创建一个新的应用。然而，该应用在 Google Play 商店中还不能被用户访问。这是因为我们还有许多待完成的任务，如创建应用后显示的应用仪表板所示。

![图 13.12 – 设置您的应用](img/B19779_13_12.jpg)

图 13.12 – 设置您的应用

如 *图 13*.12 所见，第一部分涉及设置应用详情。或者，您也可以选择使用一组内部测试人员测试应用。每个步骤都有自己的任务，列在列表中，Play Console 显示每个任务的进度。第二部分涉及为我们的应用创建发布。正是在这个部分，我们使用之前创建的应用程序包：

![图 13.13 – 设置发布](img/B19779_13_13.jpg)

图 13.13 – 设置发布

如 *图 13*.13 所见，本节包含不同的子节，涉及创建和发布我们的发布，测试我们的应用以获得许多用户的反馈，以及创建我们应用的预注册步骤等选项。所有步骤都有一个任务列表，指导我们如何处理它们。

由于这是我们第一个应用，让我们通过点击“**查看任务**”按钮在“**设置您的** **应用**”步骤中扩展任务：

![图 13.14 – 在“设置您的应用”步骤下列出的任务](img/B19779_13_14.jpg)

图 13.14 – 在“设置您的应用”步骤下列出的任务

这为我们提供了一份需要完成的任务列表。所有这些任务都提供了有关我们应用内容的更多详细信息。正是在这里，我们提供我们应用的隐私政策，指定用户是否需要特殊访问来使用我们应用的功能，指定我们是否在我们的应用上投放广告，填写内容评级问卷和数据安全表格，并指定我们的目标受众，以及其他任务。我们将逐一处理这些任务：

1.  **设置** **隐私政策**

    在本节中，我们添加一个隐私政策链接，以提供有关我们如何使用从用户收集的数据的信息。未将隐私政策添加到您的应用中可能会导致应用被从 Google Play 商店移除。

    隐私政策应由法律团队完成。然而，许多在线工具可以帮助生成隐私政策。其中一个工具是[`app-privacy-policy-generator.firebaseapp.com/`](https://app-privacy-policy-generator.firebaseapp.com/)。我们将使用此工具为我们的应用生成隐私政策。一旦我们有了隐私政策，我们应该将其放在公开链接上，并在**隐私政策 URL**字段中添加隐私政策链接，如图所示：

![图 13.15 – 隐私政策部分](img/B19779_13_15.jpg)

图 13.15 – 隐私政策部分

点击**保存**以添加您的更改。然后您可以返回主任务列表，继续下一部分。

1.  **应用访问**

    在本节中，我们指定用户是否需要特殊访问权限来使用我们应用中的功能。如果需要，我们必须提供登录凭证或说明如何能够访问这些功能。

    它们是必需的，因为应用审查过程涉及测试所有应用功能。未能提供说明可能会导致我们的应用被从 Google Play 商店中移除。由于我们的应用不需要特殊访问权限，我们选择**我的应用中所有功能均可在没有任何访问限制的情况下使用**并保存答案。

![图 13.16 – 应用访问部分](img/B19779_13_16.jpg)

图 13.16 – 应用访问部分

1.  **广告**

    在这个任务中，我们指定我们的应用是否包含广告。包含广告的应用在 Play 商店上有一个**包含广告**的标签。由于我们的应用没有广告，我们选择**否，我的应用不包含广告**选项并保存答案。

![图 13.17 – 广告部分](img/B19779_13_17.jpg)

图 13.17 – 广告部分

1.  **内容评级**

    在这个任务中，我们回答几个问题，这些问题决定了我们应用的内容评级。

![图 13.18 – 内容评级部分](img/B19779_13_18.jpg)

图 13.18 – 内容评级部分

点击**开始问卷**按钮开始问卷。您将分三步展示问题。第一步是关于应用的类别：

![图 13.19 – 内容评级类别](img/B19779_13_19.jpg)

图 13.19 – 内容评级类别

在这里，我们指定一个可以用来联系我们的关于内容评级和类别应用的电子邮件地址。我们有三个类别，每个类别都有一个描述和示例来指导我们选择正确的类别。我们将选择**所有其他应用类型**并在页面底部点击**下一步**继续到下一个步骤，如图所示：

![图 13.20 – 内容评级问卷](img/B19779_13_20.jpg)

图 13.20 – 内容评级问卷

本节包含许多关于应用内容的问题。在回答这些问题时，我们必须非常小心，以确保我们正确回答。一旦我们完成这一步骤，我们点击**下一步**继续到下一个步骤，该步骤将显示我们的答案摘要以及我们应用的评级：

![图 13.21 – 内容评级摘要](img/B19779_13_21.jpg)

图 13.21 – 内容评级摘要

我们还可以看到我们应用在世界不同地区的评分。我们可以保存评分并返回到主要任务列表。

1.  **目标受众**

    本节包含关于我们应用目标受众的几个问题。如果我们针对的是 18 岁以下的群体，我们必须确保我们的内容适合该年龄段的用户。

![图 13.22 – 目标受众和内容部分](img/B19779_13_22.jpg)

图 13.22 – 目标受众和内容部分

我们的应用针对的是 18 岁以上的群体。下一个问题是应用是否会无意中吸引儿童。

![图 13.23 – 对儿童的呼吁](img/B19779_13_23.jpg)

图 13.23 – 对儿童的呼吁

我们选择了**否**选项。这将跳过本节中的广告部分，因为我们表示我们的应用没有广告。

让我们点击**下一步**继续到下一个步骤，该步骤显示我们答案的摘要：

![图 13.24 – 目标受众摘要](img/B19779_13_24.jpg)

图 13.24 – 目标受众摘要

如*图 13.24*所示，如果审查团队不同意本节中的答案，我们将无法更新我们的应用。因此，在回答问题时我们必须谨慎。我们可以保存答案并返回到主要任务列表。返回后，我们可以看到各个任务的进度：

![图 13.25 – 设置任务进度](img/B19779_13_25.jpg)

图 13.25 – 设置任务进度

1.  **新闻应用**

    在本节中，我们指定我们的应用是否是新闻应用。请注意，我们必须遵守 Google Play 商店关于新闻政策的指南，我们可以在发布新闻应用时了解更多信息。在这里，我们选择**否**选项并保存答案。我们可以返回到主要任务列表。

![图 13.26 – 新闻应用部分](img/B19779_13_26.jpg)

图 13.26 – 新闻应用部分

1.  **COVID-19 接触追踪和状态应用**

    本节适用于与 COVID-19 相关的应用。

![图 13.27 – COVID-19 应用部分](img/B19779_13_27.jpg)

图 13.27 – COVID-19 应用部分

我们将选择**我的应用不是公开的 COVID-19 接触追踪或状态应用**选项并保存答案。

1.  **数据安全**

    在本节中，我们披露我们应用收集的数据类型以及我们如何使用这些数据。关于数据的收集、安全性、数据类型和使用的几个问题。如果我们的应用收集个人或敏感数据，我们必须提供隐私政策并在此节中回答问题。

![图 13.28 – 数据安全部分](img/B19779_13_28.jpg)

图 13.28 – 数据安全部分

我们选择**否**选项，因为我们应用中不收集任何数据，并保存答案。填写完表格后，我们可以预览我们提供的答案并交叉检查一切是否就绪，如图所示：

![图 13.29 – 数据安全摘要](img/B19779_13_29.jpg)

图 13.29 – 数据安全摘要

如*图 13.29*所示，我们可以看到我们答案的摘要和隐私政策链接。你必须确保我们正确回答本节，特别是如果你正在发布收集个人或敏感数据的应用程序。

1.  **政府应用程序**

    本节适用于与政府相关的应用程序。

![图 13.30 – 政府应用程序部分](img/B19779_13_30.jpg)

图 13.30 – 政府应用程序部分

我们选择**否**选项，因为我们的应用程序不是政府应用程序，并保存答案。

1.  **金融功能**

    本节适用于具有金融功能的应用程序。如果我们的应用程序提供个人贷款、银行服务或其他金融服务，我们必须回答本节中的问题。

![图 13.31 – 金融功能部分](img/B19779_13_31.jpg)

图 13.31 – 金融功能部分

我们选择**我的应用程序不提供任何金融功能**选项，因为我们的应用程序不提供任何服务，并保存答案。

1.  **商店设置**

    在本节中，我们提供联系详细信息，例如**电子邮件地址**、**电话号码**和**网站**。**电子邮件地址**字段是唯一必填字段。

![图 13.32 – 商店列表联系详细信息](img/B19779_13_32.jpg)

图 13.32 – 商店列表联系详细信息

在填写联系详细信息后，我们还需要指定类别。

![图 13.33 – 应用程序类别](img/B19779_13_33.jpg)

图 13.33 – 应用程序类别

选择最能描述你的应用程序功能的类别。

1.  **商店列表**

    在本节中，我们完成我们应用程序的详细信息。我们提供关于我们应用程序的简短和完整描述。我们还提供我们应用程序的不同图形。我们必须添加应用程序图标、手机和平板截图以及功能图形。这些信息将显示在我们应用程序的 Google Play 页面上。对于所有图形，我们都提供了所需的尺寸。

![图 13.34 – 商店列表部分](img/B19779_13_34.jpg)

图 13.34 – 商店列表部分

在填写所有这些部分后，我们现在准备好将我们的第一个版本推送到 Google Play 商店。如果我们需要编辑前面的任何部分，我们总是可以前往**应用程序内容**部分和**商店设置**部分，并编辑我们想要编辑的部分。此外，请注意，自本章编写以来，可能已添加了几个部分。Google Play 商店团队始终向开发者发送他们所做的任何更改的更新。

现在，让我们在下一节创建我们的第一个版本。

## 创建我们的第一个版本

Google Play 商店提供以下类型的发布：

+   **内部应用程序共享**：这允许我们快速与内部团队成员共享我们的应用程序以进行测试。他们通过我们与他们共享的链接访问应用程序。在我们向公众发布之前，如果我们想在小范围内测试我们的应用程序，这非常有用。

+   **内部应用程序测试**：这允许我们添加一组测试者——最多 100 人，他们可以自愿测试我们的应用程序。测试者可以是来自我们组织的一组人员或外部测试者。

+   **封闭测试**：这允许我们创建一个或多个测试轨道，以便与更大规模的测试者群体测试我们应用程序的预发布版本。

+   **公开测试**：这允许任何人自愿测试应用程序。测试者数量没有限制。

+   **生产版本**：这是我们应用程序的最终版本。这是在 Google Play 商店对所有用户可用的版本。

对于所有这些发布，我们必须上传一个 Android App Bundle。我们已经有了一个之前创建的 Android App Bundle。让我们转到 **测试** 部分，并选择 **内部测试** 选项来创建我们的第一个发布。我们将创建一个 *内部* *测试发布*：

1.  *添加测试者*

    我们需要创建一个新的电子邮件列表，包含测试者的电子邮件。

![图 13.35 – 创建电子邮件列表](img/B19779_13_35.jpg)

图 13.35 – 创建电子邮件列表

只有在这个电子邮件列表中的人才可以通过 Google Play 提供的特殊自愿链接访问应用程序。您可以在保存电子邮件列表后始终访问该链接，如图所示：

![图 13.36 – 测试自愿链接](img/B19779_13_36.jpg)

图 13.36 – 测试自愿链接

1.  *创建* *一个版本*

    在本节中，我们上传我们之前创建的 AAB。在上传之前，我们可以看到我们有一个警告来选择签名密钥，如图 *图 13*.37* 所示：

![图 13.37 – 签名密钥警告](img/B19779_13_37.jpg)

图 13.37 – 签名密钥警告

我们必须选择“Play 签名”选项，以及我们自己的选项。这确保了如果签名密钥丢失，我们可以恢复它。一旦我们选择，我们就可以上传我们的 AAB。选择我们的签名密钥后，我们可以继续创建我们的发布。

![图 13.38 – 设置发布轨道](img/B19779_13_38.jpg)

图 13.38 – 设置发布轨道

对于首次发布，请确保 **应用 ID** 正确，因为一旦上传 AAB，您就无法更改它。一旦我们的包成功上传，我们就可以看到正在填充的发布详情：

![图 13.39 – 包详情](img/B19779_13_39.jpg)

图 13.39 – 包详情

点击 **下一步** 继续处理流程。您将看到以下屏幕：

![图 13.40 – 发布摘要](img/B19779_13_40.jpg)

图 13.40 – 发布摘要

这显示了我们的发布摘要以及我们提供的所有详细信息。点击 **保存** 创建发布，如图所示：

![图 13.41 – 内部测试轨道摘要](img/B19779_13_41.jpg)

图 13.41 – 内部测试轨道摘要

我们可以点击 **测试者** 选项卡，在那里我们可以看到我们添加的测试者以及我们可以与测试者分享的自愿链接。

![图 13.42 – 查看测试者](img/B19779_13_42.jpg)

图 13.42 – 查看测试者

我们可以随时添加更多测试人员并按照本节所述的方式创建更多版本。所有其他轨道都有相同的过程，但受众不同。

恭喜您发布了第一个版本！您已经能够将您的第一个应用程序发布到 Google Play 商店。您随时可以返回并编辑应用程序的详细信息。

现在，您可以推广这个版本到生产环境，以便您的应用程序可以在 Google Play 商店上线，如下所示：

![图 13.43 – 推广发布](img/B19779_13_43.jpg)

图 13.43 – 推广发布

在下一节中，让我们看看在您开发应用程序时需要考虑的一些政策。

# Google Play 商店政策的概述

Google Play 政策是我们发布的一部分。因此，作为开发者，我们必须了解其中大部分，如果不是全部。这是因为如果我们违反了任何政策，我们的应用程序可能会被从 Google Play 商店移除。我们还需要了解它们，因为其中一些政策会影响我们开发应用程序的方式。

在本节中，我们将查看在开发应用程序时我们需要了解的一些政策：

+   **后台位置访问**：除非应用程序提供高质量、有益的用户体验，否则应用程序被限制在后台访问用户的地理位置。这是为了确保应用程序不会耗尽用户设备的电池。如果您的应用程序需要在后台访问位置，您必须提供一个令人信服的理由说明为什么它需要在后台访问位置。您还必须提供一个隐私政策，解释您如何使用您收集的位置数据。

+   **数据安全**：随着较新版本的 Android，数据安全得到了重视。正如所述，在填写**数据安全**部分时，我们必须确保我们的应用程序符合政策。我们必须提供隐私政策、条款和条件，并告知用户我们如何使用他们的数据。

+   **金融应用程序**：不同国家对金融应用程序有不同的规定。我们必须确保我们了解我们目标国家的规则。一些国家提供许可证，Google Play 要求我们上传这些许可证作为合规性的证明。如果我们正在开发金融应用程序，我们必须确保我们符合规定并拥有必要的许可证。

+   **受限内容**：Google Play 有几种类型的受限内容。我们必须检查我们的应用程序是否包含任何受限内容。

+   **知识产权**：我们必须确保我们的应用程序不侵犯任何知识产权。我们必须确保我们有权使用应用程序中的任何内容。

+   **使用短信或通话记录权限组**：使用短信或通话记录权限组的应用程序需要经过 Google Play 的审核。这是为了确保应用程序不会滥用权限。如果我们的应用程序使用了这些权限中的任何一项，我们必须提交一份权限声明表。

+   **健康内容和服务**：Google Play 现在不允许应用暴露用户于有害的健康相关内容。我们必须确保我们的应用不会暴露用户于此类内容。

要了解更多关于这些政策的信息，您可以在 Google Play 控制台帮助页面阅读更多内容（[`support.google.com/googleplay/android-developer/answer/13837496?hl=en`](https://support.google.com/googleplay/android-developer/answer/13837496?hl=en)）。该页面提供了关于政策的广泛概述，并包含违规行为的深入示例。您还可以访问 Google Play 学院（[`playacademy.withgoogle.com/`](https://playacademy.withgoogle.com/)）以了解更多关于 Google Play 的信息。

# 摘要

在本章中，我们逐步学习了如何在 Google Play Store 发布新应用。我们了解了如何创建签名应用包以及发布我们第一个应用到 Google Play Store 所需的事项。此外，我们还了解了一些 Google Play Store 政策以及如何始终保持合规，以避免我们的应用被移除或账户被禁用。

在下一章中，我们将学习如何使用 GitHub Actions 来自动化一些手动任务，例如将新构建部署到 Play Store。我们将学习如何在**持续集成和持续交付**（**CI/CD**）管道上运行测试，并使用 GitHub Actions 将构建推送到 Google Play Store。
